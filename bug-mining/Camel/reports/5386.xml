<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:42:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-15350] SJMS Batch Consumer error recovery</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-15350</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;If the SJMS-Batch consumption loop encounters anything other than a javax.jms.IllegalStateException (&lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-sjms/src/main/java/org/apache/camel/component/sjms/batch/SjmsBatchConsumer.java#L330&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-sjms/src/main/java/org/apache/camel/component/sjms/batch/SjmsBatchConsumer.java#L330&lt;/a&gt;) then it logs a warning and stops consuming messages (&lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-sjms/src/main/java/org/apache/camel/component/sjms/batch/SjmsBatchConsumer.java#L348)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-sjms/src/main/java/org/apache/camel/component/sjms/batch/SjmsBatchConsumer.java#L348)&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Example log after message broker is shut down:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 2020-07-29 10:33:32.060 WARN ||| 34468 --- [msBatchConsumer] o.a.c.c.sjms.batch.SjmsBatchConsumer     : Exception caught consuming from myQueue. Caused by: [javax.jms.JMSException - Connection refused: no further information: localhost/127.0.0.1:5672]

javax.jms.JMSException: Connection refused: no further information: localhost/127.0.0.1:5672
    at org.apache.qpid.jms.provider.ProviderException.toJMSException(ProviderException.java:34)
    at org.apache.qpid.jms.exceptions.JmsExceptionSupport.create(JmsExceptionSupport.java:80)
    at org.apache.qpid.jms.exceptions.JmsExceptionSupport.create(JmsExceptionSupport.java:112)
    at org.apache.qpid.jms.JmsConnection.pull(JmsConnection.java:915)
    at org.apache.qpid.jms.JmsConnection.pull(JmsConnection.java:899)
    at org.apache.qpid.jms.JmsMessageConsumer.performPullIfRequired(JmsMessageConsumer.java:732)
    at org.apache.qpid.jms.JmsMessageConsumer.dequeue(JmsMessageConsumer.java:332)
    at org.apache.qpid.jms.JmsMessageConsumer.receive(JmsMessageConsumer.java:213)
    at org.springframework.jms.connection.CachedMessageConsumer.receive(CachedMessageConsumer.java:86)
    at org.apache.camel.component.sjms.batch.SjmsBatchConsumer$BatchConsumptionLoop$BatchConsumptionTask.consumeBatchesOnLoop(SjmsBatchConsumer.java:427)
    at org.apache.camel.component.sjms.batch.SjmsBatchConsumer$BatchConsumptionLoop$BatchConsumptionTask.access$1300(SjmsBatchConsumer.java:381)
    at org.apache.camel.component.sjms.batch.SjmsBatchConsumer$BatchConsumptionLoop.run(SjmsBatchConsumer.java:326)
    at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
    at java.util.concurrent.FutureTask.run(FutureTask.java:266)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
Caused by: org.apache.qpid.jms.provider.exceptions.ProviderIOException: Connection refused: no further information: localhost/127.0.0.1:5672&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;{{}}&lt;/p&gt;

&lt;p&gt;It is not obvious from this log message that the route is now broken and will not receive any more messages. The route state is still &quot;Started&quot;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Expected Behaviour: The batch consumer can recover after errors (including a broker restart or failover) and continue to consume messages once the broker is available again.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A simple change is to catch any exception instead of only&#160;javax.jms.IllegalStateException.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13319967">CAMEL-15350</key>
            <summary>SJMS Batch Consumer error recovery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="bradhgbst">Brad Harvey</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Jul 2020 11:53:01 +0000</created>
                <updated>Thu, 6 Aug 2020 04:39:58 +0000</updated>
                            <resolved>Wed, 5 Aug 2020 05:46:27 +0000</resolved>
                                    <version>3.4.1</version>
                                    <fixVersion>3.4.3</fixVersion>
                    <fixVersion>3.5.0</fixVersion>
                                    <component>camel-sjms</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17169768" author="davsclaus" created="Mon, 3 Aug 2020 07:07:17 +0000"  >&lt;p&gt;Are you able to work an a fix and submit a PR?&lt;/p&gt;</comment>
                            <comment id="17169773" author="bradhgbst" created="Mon, 3 Aug 2020 07:16:09 +0000"  >&lt;p&gt;Yes hopefully this week.&#160; Is there a planned release date for 3.4.3?&lt;/p&gt;</comment>
                            <comment id="17170780" author="bradhgbst" created="Tue, 4 Aug 2020 12:59:29 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;You were too fast for me.&#160; I have tested out the simple fix but unfortunately it is too simple.&lt;/p&gt;

&lt;p&gt;First, I saw no change in behaviour.&#160; I had to set &quot;keepAliveDelay&quot; on the endpoint otherwise it just rethrows the exception anyway - a bit of a trap for new players.&#160; After setting keepAliveDelay to a positive value it did retry, but only once.&#160; The reason is that it fails on the createSession call which is outside the try/catch block that was changed, so again it just logs a warning and stops doing anything else.&#160;&#160;&lt;/p&gt;

&lt;p&gt;My test case is to restart the message broker.&lt;/p&gt;

&lt;p&gt;It does work OK if the message broker is restarted and ready in time for the first retry (before keepAliveDelay is exceeded).&#160; It is possible Spring&apos;s SingleConnectionFactory is helping out here, allowing createSession to recover the connection under the covers.&lt;/p&gt;

&lt;p&gt;Regards, Brad&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Interesting bits of the log below:&lt;/p&gt;

&lt;p&gt;First error&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
WARN ||| 62704 --- [msBatchConsumer] o.a.c.c.sjms.batch.SjmsBatchConsumer&#160; &#160; &#160;: Exception caught consuming from myQueue. Caused by: [javax.jms.IllegalStateException - The Consumer is closed]&quot; 

org.apache.camel.component.sjms.batch.SjmsBatchConsumer$BatchConsumptionLoop$BatchConsumptionTask.consumeBatchesOnLoop(SjmsBatchConsumer.java:426) at &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Second error (first and only retry).&#160; After this there is nothing.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
WARN ||| 62704 --- [msBatchConsumer] o.a.c.c.sjms.batch.SjmsBatchConsumer&#160; &#160; &#160;: Exception caught consuming from myQueue. Caused by: [javax.jms.JMSException - Could not connect to broker URL: tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:61616. Reason: java.net.ConnectException: Connection refused: connect] javax.jms.JMSException: Could not connect to broker URL: tcp://localhost:61616. Reason: java.net.ConnectException: Connection refused: connect at  
&lt;/span&gt;
org.apache.camel.component.sjms.batch.SjmsBatchConsumer$BatchConsumptionLoop.run(SjmsBatchConsumer.java:318) at &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This is the full log from just prior to stopping activemq.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2020-08-04 22:36:50.857 TRACE||| 62704 --- [msBatchConsumer] o.a.c.c.sjms.batch.SjmsBatchConsumer&#160; &#160; &#160;: No message received2020-08-04 22:36:50.857 TRACE||| 62704 --- [msBatchConsumer] o.a.c.c.sjms.batch.SjmsBatchConsumer&#160; &#160; &#160;: No message received2020-08-04 22:36:50.857 TRACE||| 62704 --- [msBatchConsumer] o.a.c.c.sjms.batch.SjmsBatchConsumer&#160; &#160; &#160;: BatchConsumptionTask running2020-08-04 22:36:51.364 INFO ||| 62704 --- [0.1:61616@64353] o.s.j.c.CachingConnectionFactory&#160; &#160; &#160; &#160; &#160;: Encountered a JMSException - resetting the underlying JMS Connection
javax.jms.JMSException: java.io.EOFException at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:54) at org.apache.activemq.ActiveMQConnection.onAsyncException(ActiveMQConnection.java:1960) at org.apache.activemq.ActiveMQConnection.onException(ActiveMQConnection.java:1979) at org.apache.activemq.transport.TransportFilter.onException(TransportFilter.java:114) at org.apache.activemq.transport.ResponseCorrelator.onException(ResponseCorrelator.java:126) at org.apache.activemq.transport.TransportFilter.onException(TransportFilter.java:114) at org.apache.activemq.transport.TransportFilter.onException(TransportFilter.java:114) at org.apache.activemq.transport.WireFormatNegotiator.onException(WireFormatNegotiator.java:173) at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:345) at org.apache.activemq.transport.TransportSupport.onException(TransportSupport.java:96) at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:219) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)Caused by: java.io.EOFException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; at java.io.DataInputStream.readInt(DataInputStream.java:392) at org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:268) at org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:240)Caused by: java.io.EOFException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
 at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:232) at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:215) ... 1 common frames omitted
2020-08-04 22:36:51.366 TRACE||| 62704 --- [msBatchConsumer] o.a.c.c.sjms.batch.SjmsBatchConsumer&#160; &#160; &#160;: No message received2020-08-04 22:36:51.366 TRACE||| 62704 --- [msBatchConsumer] o.a.c.c.sjms.batch.SjmsBatchConsumer&#160; &#160; &#160;: BatchConsumptionTask running2020-08-04 22:36:51.368 WARN ||| 62704 --- [msBatchConsumer] o.a.c.c.sjms.batch.SjmsBatchConsumer&#160; &#160; &#160;: Exception caught consuming from myQueue. Caused by: [javax.jms.IllegalStateException - The Consumer is closed]
javax.jms.IllegalStateException: The Consumer is closed at org.apache.activemq.ActiveMQMessageConsumer.checkClosed(ActiveMQMessageConsumer.java:879) at org.apache.activemq.ActiveMQMessageConsumer.receive(ActiveMQMessageConsumer.java:640) at org.apache.camel.component.sjms.batch.SjmsBatchConsumer$BatchConsumptionLoop$BatchConsumptionTask.consumeBatchesOnLoop(SjmsBatchConsumer.java:426) at org.apache.camel.component.sjms.batch.SjmsBatchConsumer$BatchConsumptionLoop$BatchConsumptionTask.access$1300(SjmsBatchConsumer.java:380) at org.apache.camel.component.sjms.batch.SjmsBatchConsumer$BatchConsumptionLoop.run(SjmsBatchConsumer.java:325) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
2020-08-04 22:36:51.369 WARN ||| 62704 --- [0.1:61616@64353] o.s.j.c.CachingConnectionFactory&#160; &#160; &#160; &#160; &#160;: Could not close shared JMS Connection
javax.jms.JMSException: Disposed due to prior exception at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:72) at org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1421) at org.apache.activemq.ActiveMQConnection.close(ActiveMQConnection.java:688) at org.springframework.jms.connection.SingleConnectionFactory.closeConnection(SingleConnectionFactory.java:501) at org.springframework.jms.connection.SingleConnectionFactory.resetConnection(SingleConnectionFactory.java:389) at org.springframework.jms.connection.CachingConnectionFactory.resetConnection(CachingConnectionFactory.java:205) at org.springframework.jms.connection.SingleConnectionFactory.onException(SingleConnectionFactory.java:367) at org.springframework.jms.connection.SingleConnectionFactory$AggregatedExceptionListener.onException(SingleConnectionFactory.java:721) at org.apache.activemq.ActiveMQConnection$5.run(ActiveMQConnection.java:1967) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)Caused by: org.apache.activemq.transport.TransportDisposedIOException: Disposed due to prior exception at org.apache.activemq.transport.ResponseCorrelator.onException(ResponseCorrelator.java:125) at org.apache.activemq.transport.TransportFilter.onException(TransportFilter.java:114) at org.apache.activemq.transport.TransportFilter.onException(TransportFilter.java:114)Caused by: org.apache.activemq.transport.TransportDisposedIOException: Disposed due to prior exception
 at org.apache.activemq.transport.WireFormatNegotiator.onException(WireFormatNegotiator.java:173) at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:345) at org.apache.activemq.transport.TransportSupport.onException(TransportSupport.java:96) at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:219) ... 1 common frames omittedCaused by: java.io.EOFException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; at java.io.DataInputStream.readInt(DataInputStream.java:392)Caused by: java.io.EOFException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
 at org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:268) at org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:240) at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:232) at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:215) ... 1 common frames omitted
2020-08-04 22:36:53.944 WARN ||| 62704 --- [msBatchConsumer] o.a.c.c.sjms.batch.SjmsBatchConsumer&#160; &#160; &#160;: Exception caught consuming from myQueue. Caused by: [javax.jms.JMSException - Could not connect to broker URL: tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:61616. Reason: java.net.ConnectException: Connection refused: connect]
&lt;/span&gt;javax.jms.JMSException: Could not connect to broker URL: tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:61616. Reason: java.net.ConnectException: Connection refused: connect at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:36) at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:374) at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:304) at org.apache.activemq.ActiveMQConnectionFactory.createConnection(ActiveMQConnectionFactory.java:244) at org.springframework.jms.connection.SingleConnectionFactory.doCreateConnection(SingleConnectionFactory.java:409) at org.springframework.jms.connection.SingleConnectionFactory.initConnection(SingleConnectionFactory.java:349) at org.springframework.jms.connection.SingleConnectionFactory.getConnection(SingleConnectionFactory.java:327) at org.springframework.jms.connection.SingleConnectionFactory$SharedConnectionInvocationHandler.invoke(SingleConnectionFactory.java:649) at com.sun.proxy.$Proxy131.createSession(Unknown Source) at org.apache.camel.component.sjms.batch.SjmsBatchConsumer$BatchConsumptionLoop.run(SjmsBatchConsumer.java:318) at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511) at java.util.concurrent.FutureTask.run(FutureTask.java:266) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)Caused by: java.net.ConnectException: Connection refused: connect at java.net.DualStackPlainSocketImpl.waitForConnect(Native Method)Caused by: java.net.ConnectException: Connection refused: connect
&lt;/span&gt; at java.net.DualStackPlainSocketImpl.socketConnect(DualStackPlainSocketImpl.java:85) at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350) at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206) at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188) at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:172) at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392) at java.net.Socket.connect(Socket.java:607) at org.apache.activemq.transport.tcp.TcpTransport.connect(TcpTransport.java:525) at org.apache.activemq.transport.tcp.TcpTransport.doStart(TcpTransport.java:488) at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:55) at org.apache.activemq.transport.AbstractInactivityMonitor.start(AbstractInactivityMonitor.java:169) at org.apache.activemq.transport.InactivityMonitor.start(InactivityMonitor.java:52) at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:64) at org.apache.activemq.transport.WireFormatNegotiator.start(WireFormatNegotiator.java:72) at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:64) at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:64) at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:354) ... 13 common frames omitted &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17170800" author="bradhgbst" created="Tue, 4 Aug 2020 13:36:09 +0000"  >&lt;p&gt;This patch on 3.4.x is what I am thinking - just move where the session is created.&#160; I can create a PR and maybe add a test case, hopefully tomorrow.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13009043/13009043_CAMEL-15350-patch.txt&quot; title=&quot;CAMEL-15350-patch.txt attached to CAMEL-15350&quot;&gt;CAMEL-15350-patch.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17170803" author="bradhgbst" created="Tue, 4 Aug 2020 13:41:15 +0000"  >&lt;p&gt;Also would you consider a change to the default&#160;keepAliveDelay of -1, which effectively disables the retry?&#160; The comments imply that it is like that for backwards compatibility so that it can shut down / exit on failure, but I don&apos;t quite follow how anything would notice the shutdown.&lt;/p&gt;</comment>
                            <comment id="17171081" author="davsclaus" created="Tue, 4 Aug 2020 19:36:44 +0000"  >&lt;p&gt;Thanks Brad, yeah that is a better patch. I have applied it to master and 3.4 branches.&lt;/p&gt;</comment>
                            <comment id="17171087" author="davsclaus" created="Tue, 4 Aug 2020 19:48:48 +0000"  >&lt;p&gt;Yeah it seems that there are 2 options for controlling this&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;recoveryInterval&lt;/li&gt;
	&lt;li&gt;keepAliveDelay&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The first is during startup only, and the latter is during consuming. Ideally there would just have been one option that has automatic refresh (like camel-jms has).&lt;/p&gt;

&lt;p&gt;So yeah we can make the keepAlive have same value as the recovery, eg 5000 in Camel 3.5 onwards. We can&apos;t change a default value in a patch release like 3.4.3&lt;/p&gt;
</comment>
                            <comment id="17171193" author="bradhgbst" created="Tue, 4 Aug 2020 23:18:06 +0000"  >&lt;p&gt;Thanks. Yes that makes sense.&lt;/p&gt;</comment>
                            <comment id="17171268" author="davsclaus" created="Wed, 5 Aug 2020 05:46:38 +0000"  >&lt;p&gt;changed the default in camel 3.5&lt;/p&gt;</comment>
                            <comment id="17172027" author="bradhgbst" created="Thu, 6 Aug 2020 04:39:58 +0000"  >&lt;p&gt;For whatever it is worth, here&apos;s a reproducer unit test.&#160; It currently fails even with the fix because the consumer never gets a new connection from the connection factory.&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13009166/13009166_CAMEL-15350-reproducer-patch.txt&quot; title=&quot;CAMEL-15350-reproducer-patch.txt attached to CAMEL-15350&quot;&gt;CAMEL-15350-reproducer-patch.txt&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The fix does work with Spring&apos;s CachingConnectionFactory as it is able to recover a broken connection.&#160;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13009043" name="CAMEL-15350-patch.txt" size="2421" author="bradhgbst" created="Tue, 4 Aug 2020 13:31:48 +0000"/>
                            <attachment id="13009166" name="CAMEL-15350-reproducer-patch.txt" size="5971" author="bradhgbst" created="Thu, 6 Aug 2020 04:37:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hazc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>