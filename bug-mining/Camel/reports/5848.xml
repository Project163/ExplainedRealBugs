<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:49:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-16927] camel-spring - Using Spring XML can create multiple SpringCamelContext instances causing a deadlock when multiple camel proxies involved</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-16927</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;My scenario:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Http client -&amp;gt; Transactional servlet consumer&lt;/li&gt;
	&lt;li&gt;Servlet route calls java bean&lt;/li&gt;
	&lt;li&gt;Java bean calls another route using Camel Proxy and direct-vm&lt;/li&gt;
	&lt;li&gt;CamelInvocationHandler calls direct-vm route and then hangs as route is never executed, waiting for worker&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;At this point it is all deadlocked and it never ends.&lt;br/&gt;
 From what I can see the problem happens in&#160;DefaultReactiveExecutor.Worker.&lt;/p&gt;

&lt;p&gt;From debugging I can see there are two&#160;DefaultReactiveExecutor.Workers at the point of deadlock.&lt;/p&gt;

&lt;p&gt;At point 3, Worker number 2 executes SimpleTask which waits for it to finish- this task is to execute bean as per step 3.&lt;br/&gt;
 Bean execution then attempts to trigger another route using Camel Proxy and direct-vm and schedules it on Worker number 2.&lt;br/&gt;
However immediately after scheduling on Worker number 2 the direct-vm processor, Worker 1 executes&#160;executeFromQueue (triggered by countdownLatch waiting for direct-vm call to finish) which then causes deadlock because task added to Worker number 2 is never executed.&lt;/p&gt;

&lt;p&gt;I have confirmed above in debugging, will try to come up with simple test case as our scenario is rather complex and involves multiple projects.&lt;/p&gt;

&lt;p&gt;Unfortunately for us this is blocker as our solution which was working perfectly fine with camel 2 is not working.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13399620">CAMEL-16927</key>
            <summary>camel-spring - Using Spring XML can create multiple SpringCamelContext instances causing a deadlock when multiple camel proxies involved</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nannou9">Piotr Klimczak</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Sep 2021 18:15:04 +0000</created>
                <updated>Fri, 8 Oct 2021 19:14:26 +0000</updated>
                            <resolved>Wed, 22 Sep 2021 05:11:54 +0000</resolved>
                                    <version>3.7.5</version>
                    <version>3.7.2</version>
                                    <fixVersion>3.7.6</fixVersion>
                    <fixVersion>3.12.0</fixVersion>
                                    <component>camel-spring</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17411282" author="nannou9" created="Tue, 7 Sep 2021 14:40:10 +0000"  >&lt;p&gt;Got fix already, just need to do simplified test coverage.&lt;br/&gt;
 Fix is also likely to improve startup performance as spring context creation was to blame.&lt;/p&gt;</comment>
                            <comment id="17412363" author="davsclaus" created="Thu, 9 Sep 2021 06:27:08 +0000"  >&lt;p&gt;Do you have a fix handy soon, then put it on as a PR or a patch file on this JIRA.&lt;/p&gt;</comment>
                            <comment id="17412430" author="nannou9" created="Thu, 9 Sep 2021 08:16:56 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;, yes I&apos;ve got it, just need to craft simplified unit test without servlets and all other unnecessary stuff as we were testing it using rather complex scenario in one of our projects which is not suitable for submission to Apache as is.&lt;br/&gt;
I am planning to submit it by the EOW.&lt;/p&gt;</comment>
                            <comment id="17417092" author="davsclaus" created="Sat, 18 Sep 2021 08:47:10 +0000"  >&lt;p&gt;Any update?&lt;/p&gt;</comment>
                            <comment id="17417240" author="nannou9" created="Sat, 18 Sep 2021 21:49:17 +0000"  >&lt;p&gt;Hi Claus,&lt;/p&gt;

&lt;p&gt;Got the simplified test, finally&#160;no transactions, no async, just pure direct and proxies and it hangs forever.&lt;br/&gt;
But even then it requires very specific context to trigger it.&lt;/p&gt;

&lt;p&gt;New need some more time now to put the test in camel project- hopefully tomorrow will create patch.&lt;br/&gt;
Sorry I have very limited time due to challenging situation at work and real life.&lt;/p&gt;</comment>
                            <comment id="17426344" author="nannou9" created="Fri, 8 Oct 2021 19:12:30 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Just noticed that Jira issue subject has been changed, while not fully correct.&lt;br/&gt;
 The problem does not happen when we use multiple context. The problem is that Spring creates multiple contexts for single real camel context.&lt;/p&gt;

&lt;p&gt;Updated it to be closer to reality.&lt;br/&gt;
Hopefully you don&apos;t mind.&lt;/p&gt;

&lt;p&gt;Cheers&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 5 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0unnc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>