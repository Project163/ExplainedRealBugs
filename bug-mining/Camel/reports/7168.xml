<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:11:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-22174] camel-smb : doesn&apos;t recover from TransportException if smb share disappears from network</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-22174</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;From the user list :&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://lists.apache.org/thread/69052pqx07brzzscn6dn4kvjgv1vyc40&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread/69052pqx07brzzscn6dn4kvjgv1vyc40&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
I&apos;m using a simple route to consume files from an SMB share and store them in a database.
When the remote server becomes unreachable, the consumer keeps trying to reconnect but seems to reuse a broken connection that wasn&#8217;t properly closed.
The only fix is restarting the whole route.
It looks like disconnect() in SmbOperations doesn&apos;t fully close the connection after an exception:https:&lt;span class=&quot;code-comment&quot;&gt;//github.com/apache/camel/blob/a2fe5b8057d0c990da048a49b380b705ad2237c6/components/camel-smb/src/main/java/org/apache/camel/component/smb/SmbOperations.java#L116-L134
&lt;/span&gt;https:&lt;span class=&quot;code-comment&quot;&gt;//github.com/apache/camel/blob/a2fe5b8057d0c990da048a49b380b705ad2237c6/components/camel-smb/src/main/java/org/apache/camel/component/smb/SmbOperations.java#L116-L134
&lt;/span&gt;&#160;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;trace :&#160;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
com.hierynomus.smbj.common.SMBRuntimeException: com.hierynomus.protocol.transport.TransportException: java.net.SocketException: Broken pipe
at com.hierynomus.smbj.connection.SMBSessionBuilder.establish(SMBSessionBuilder.java:124)
at com.hierynomus.smbj.connection.Connection.authenticate(Connection.java:206)
at org.apache.camel.component.smb.SmbOperations.connectIfNecessary(SmbOperations.java:91)
at org.apache.camel.component.smb.SmbConsumer.prePollCheck(SmbConsumer.java:207)
at org.apache.camel.component.file.GenericFileConsumer.poll(GenericFileConsumer.java:129)
at org.apache.camel.support.ScheduledPollConsumer.doRun(ScheduledPollConsumer.java:208)
at org.apache.camel.support.ScheduledPollConsumer.run(ScheduledPollConsumer.java:119)
at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source)
at java.base/java.util.concurrent.FutureTask.runAndReset(Unknown Source)
at java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(Unknown Source)
at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)
at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)
at io.opentelemetry.context.Context.lambda$wrap$1(Context.java:241)
at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source)
Caused by: com.hierynomus.protocol.transport.TransportException: java.net.SocketException: Broken pipe
at com.hierynomus.smbj.transport.tcp.direct.DirectTcpTransport.write(DirectTcpTransport.java:86)
at com.hierynomus.smbj.connection.Connection.send(Connection.java:242)
at com.hierynomus.smbj.connection.Connection.sendAndReceive(Connection.java:247)
at com.hierynomus.smbj.connection.SMBSessionBuilder.initiateSessionSetup(SMBSessionBuilder.java:217)
at com.hierynomus.smbj.connection.SMBSessionBuilder.setupSession(SMBSessionBuilder.java:136)
at com.hierynomus.smbj.connection.SMBSessionBuilder.establish(SMBSessionBuilder.java:119)
... 13 more
Caused by: java.net.SocketException: Broken pipe
at java.base/sun.nio.ch.SocketDispatcher.write0(Native Method)
at java.base/sun.nio.ch.SocketDispatcher.write(Unknown Source)
at java.base/sun.nio.ch.NioSocketImpl.tryWrite(Unknown Source)
at java.base/sun.nio.ch.NioSocketImpl.implWrite(Unknown Source)
at java.base/sun.nio.ch.NioSocketImpl.write(Unknown Source)
at java.base/sun.nio.ch.NioSocketImpl$2.write(Unknown Source)
at java.base/java.net.Socket$SocketOutputStream.write(Unknown Source)
at java.base/java.io.BufferedOutputStream.flushBuffer(Unknown Source)
at java.base/java.io.BufferedOutputStream.implWrite(Unknown Source)
at java.base/java.io.BufferedOutputStream.write(Unknown Source)
at com.hierynomus.smbj.transport.tcp.direct.DirectTcpTransport.writeDirectTcpPacketHeader(DirectTcpTransport.java:163)
at com.hierynomus.smbj.transport.tcp.direct.DirectTcpTransport.write(DirectTcpTransport.java:81) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13621144">CAMEL-22174</key>
            <summary>camel-smb : doesn&apos;t recover from TransportException if smb share disappears from network</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tcunning">Thomas Cunningham</assignee>
                                    <reporter username="tcunning">Thomas Cunningham</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Jun 2025 18:09:36 +0000</created>
                <updated>Thu, 14 Aug 2025 05:10:47 +0000</updated>
                            <resolved>Thu, 19 Jun 2025 05:18:58 +0000</resolved>
                                    <version>4.10.0</version>
                    <version>4.12.0</version>
                                    <fixVersion>4.10.7</fixVersion>
                    <fixVersion>4.14.0</fixVersion>
                                    <component>camel-smb</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17981674" author="davsclaus" created="Wed, 18 Jun 2025 05:44:49 +0000"  >&lt;p&gt;The streamDownload=true functionality is no longer working. But it may be okay as its a bit risky to use as the session can be closed when you attempt to read.&lt;/p&gt;

&lt;p&gt;Instead its better to use localWorkDir to stream the file into a local file for further processing.&lt;/p&gt;

&lt;p&gt;I have disabled those tests but you are welcome to see if we can get those tests fixed again, if not then we remove the streamDownload option and add a note in the migration guide about this and that they should use localWorkDir instead&lt;/p&gt;</comment>
                            <comment id="17981696" author="JIRAUSER308679" created="Wed, 18 Jun 2025 08:09:01 +0000"  >&lt;p&gt;Thanks for the quick fix!&lt;/p&gt;

&lt;p&gt;Is it possible to include this in 4.10.6? Or is that difficult because of the streamDownload breakage?&lt;/p&gt;</comment>
                            <comment id="17982686" author="tcunning" created="Wed, 18 Jun 2025 11:26:15 +0000"  >&lt;p&gt;I&apos;ll look into the stream download breakage today&lt;/p&gt;</comment>
                            <comment id="17982746" author="tcunning" created="Wed, 18 Jun 2025 16:35:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/pull/18397&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/18397&lt;/a&gt; should fix the stream download breakage and reenable the integration tests there, if this PR looks good I&apos;ll submit PRs to 4.10.6&lt;/p&gt;</comment>
                            <comment id="17982795" author="davsclaus" created="Wed, 18 Jun 2025 19:49:08 +0000"  >&lt;p&gt;Thanks Tom, yes it works on main, you are welcome to backport to 4.10.x&lt;/p&gt;</comment>
                            <comment id="17983439" author="davsclaus" created="Thu, 19 Jun 2025 05:18:58 +0000"  >&lt;p&gt;Thanks Tom&lt;/p&gt;</comment>
                            <comment id="18013831" author="davsclaus" created="Thu, 14 Aug 2025 05:10:47 +0000"  >&lt;p&gt;An additional fix:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/camel/commit/22012d350ddb9c877b3416a62473401b08ecf5f5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/22012d350ddb9c877b3416a62473401b08ecf5f5&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13622294">CAMEL-22211</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1wddc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>