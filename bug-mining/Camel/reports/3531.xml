<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:13:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-9560] RabbitMQ InOut Producer generates a null body response when a correlationId is used</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-9560</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The use case uses a correlationId with RabbitMQ InOut Producer :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:route&quot;&lt;/span&gt;)
   .setHeader(RabbitMQConstants.EXCHANGE_NAME, constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;exchange&quot;&lt;/span&gt;))
   .setHeader(RabbitMQConstants.CORRELATIONID, constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt;))
   .inOut(&lt;span class=&quot;code-quote&quot;&gt;&quot;rabbitmq:&lt;span class=&quot;code-comment&quot;&gt;//...&quot;&lt;/span&gt;)&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The response always contains a null out body message.&lt;/p&gt;

&lt;p&gt;The problem is located when restoring the original correlation id in org.apache.camel.component.rabbitmq.reply.ReplyManagerSupport : &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void processReply(ReplyHolder holder)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// restore correlation id in &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; the remote server messed with it
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (holder.getOriginalCorrelationId() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (exchange.getOut() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      exchange.getOut().setHeader(RabbitMQConstants.CORRELATIONID, 
         holder.getOriginalCorrelationId());
   } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      exchange.getIn().setHeader(RabbitMQConstants.CORRELATIONID, 
         holder.getOriginalCorrelationId());
   }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The test exchange.getOut() is always successful because of the lazy creation in DefaultExchange.getOut&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Message getOut() {
   &lt;span class=&quot;code-comment&quot;&gt;// lazy create
&lt;/span&gt;   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (out == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      out = (in != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; in &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; MessageSupport)
      ? ((MessageSupport)in).newInstance() : &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultMessage();
      configureMessage(out);
   }
   &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; out;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The in body message contains the correct response from RabbitMQ. However, since the out message will be always created with a null body, the null body response will be returned in the pipeline&lt;/p&gt;</description>
                <environment></environment>
        <key id="12935986">CAMEL-9560</key>
            <summary>RabbitMQ InOut Producer generates a null body response when a correlationId is used</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="arnaudchotard">Arnaud CHOTARD</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Feb 2016 15:04:00 +0000</created>
                <updated>Thu, 4 Feb 2016 18:43:56 +0000</updated>
                            <resolved>Thu, 4 Feb 2016 18:43:56 +0000</resolved>
                                    <version>2.16.2</version>
                                    <fixVersion>2.16.3</fixVersion>
                    <fixVersion>2.17.0</fixVersion>
                                    <component>camel-rabbitmq</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15128574" author="arnaudchotard" created="Tue, 2 Feb 2016 17:08:13 +0000"  >&lt;p&gt;Maybe replacing exchange.getOut() by exchange.hasOut() should resolve the bug &lt;/p&gt;</comment>
                            <comment id="15129953" author="davsclaus" created="Wed, 3 Feb 2016 07:25:10 +0000"  >&lt;p&gt;Yes it should be hasOut().&lt;/p&gt;

&lt;p&gt;You are welcome to provide a patch or PR&lt;br/&gt;
&lt;a href=&quot;http://camel.apache.org/contributing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/contributing&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15132758" author="davsclaus" created="Thu, 4 Feb 2016 18:43:56 +0000"  >&lt;p&gt;Thanks Arnaud for the patch. Keep testing rabbitmq and work on patches for it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12786269" name="camel_9560.patch" size="1058" author="onurakdemir" created="Thu, 4 Feb 2016 14:47:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 41 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2sapb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>