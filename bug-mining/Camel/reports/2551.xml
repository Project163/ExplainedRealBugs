<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:00:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-6988] 2.12.1 caches groovy call - resulting with previous caller state</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-6988</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;2.12.1&lt;br/&gt;
Works&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &amp;lt;simple&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;${body.subOrderName}Endpoint&quot;&lt;/span&gt;&amp;lt;/simple&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Fails &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;         &amp;lt;groovy&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;${request.body.subOrderName}Endpoint&quot;&lt;/span&gt;&amp;lt;/groovy&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.11.1&lt;br/&gt;
Works&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &amp;lt;simple&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;${body.subOrderName}Endpoint&quot;&lt;/span&gt;&amp;lt;/simple&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Works&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &amp;lt;groovy&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;${request.body.subOrderName}Endpoint&quot;&lt;/span&gt;&amp;lt;/groovy&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;*Fails by returning a previous calls result for subOrderName. &lt;br/&gt;
To reproduce you must make several calls in a timely manner with different bean data (OGNL/subOrderName).&lt;/p&gt;

&lt;p&gt;Route:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
&amp;lt;setHeader headerName=&lt;span class=&quot;code-quote&quot;&gt;&quot;RSSX_ORDER_ROUTING_SLIP&quot;&lt;/span&gt;&amp;gt;
&amp;lt;groovy&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;${request.body.subOrderName}Endpoint&quot;&lt;/span&gt;&amp;lt;/groovy&amp;gt;
&amp;lt;/setHeader&amp;gt;
&amp;lt;!-- Route the order by the routing slip header --&amp;gt;
&amp;lt;routingSlip&amp;gt;
&amp;lt;header&amp;gt;RSSX_ORDER_ROUTING_SLIP&amp;lt;/header&amp;gt;
&amp;lt;/routingSlip&amp;gt;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Log:&lt;br/&gt;
1st execution&lt;br/&gt;
Before set header:    UpdatePortIn&lt;/p&gt;

&lt;p&gt;After set header:   RSSX_ORDER_ROUTING_SLIP=UpdatePortInEndpoint&lt;/p&gt;

&lt;p&gt;2nd execution (in a timely manner &#8211; exposing a LRU Cache issue?)&lt;br/&gt;
Before set header: ResellerAddSubscriberPortIn&lt;br/&gt;
After set header:    RSSX_ORDER_ROUTING_SLIP=UpdatePortInEndpoint&lt;/p&gt;

&lt;p&gt;Same logic works in 2.11.1&lt;/p&gt;

&lt;p&gt;Additionally this does not appear OGNL related:&lt;br/&gt;
I just ran into the case where       &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;setHeader headerName=&lt;span class=&quot;code-quote&quot;&gt;&quot;RSSX_ORDER_ROUTING_SLIP&quot;&lt;/span&gt;&amp;gt;
        &amp;lt;groovy&amp;gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;${request.body.getSubOrderName()}Endpoint&quot;&lt;/span&gt;&amp;lt;/groovy&amp;gt;
      &amp;lt;/setHeader&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;returns the cached subOrderName from the previous transaction&lt;/p&gt;

&lt;p&gt;So this appears to be isolated to the &amp;lt;groovy&amp;gt; component changes (LRU Cache?) that were introduced in 2.12.1&lt;/p&gt;</description>
                <environment>&lt;p&gt;same results using java 7 on osx, ubuntu, and windoze&lt;/p&gt;</environment>
        <key id="12680319">CAMEL-6988</key>
            <summary>2.12.1 caches groovy call - resulting with previous caller state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="7erry">Terry Walters</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Nov 2013 16:34:01 +0000</created>
                <updated>Tue, 4 Feb 2014 21:36:59 +0000</updated>
                            <resolved>Fri, 31 Jan 2014 16:18:43 +0000</resolved>
                                    <version>2.12.1</version>
                                    <fixVersion>2.11.4</fixVersion>
                    <fixVersion>2.12.3</fixVersion>
                    <fixVersion>2.13.0</fixVersion>
                                    <component>camel-groovy</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13829262" author="davsclaus" created="Thu, 21 Nov 2013 19:35:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-6340&quot; title=&quot;Improve Groovy performance&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-6340&quot;&gt;&lt;del&gt;CAMEL-6340&lt;/del&gt;&lt;/a&gt; was also introduced in Camel 2.11.1. Are you sure its that version? Can you double check.&lt;/p&gt;</comment>
                            <comment id="13829269" author="davsclaus" created="Thu, 21 Nov 2013 19:46:39 +0000"  >&lt;p&gt;How many different values do you return in the &lt;tt&gt;getSubOrderName&lt;/tt&gt; method? Is there only these 2 values or do you have many more?&lt;/p&gt;</comment>
                            <comment id="13829281" author="davsclaus" created="Thu, 21 Nov 2013 19:59:55 +0000"  >&lt;p&gt;Just pushed some unit tests to master. Cannot reproduce this.&lt;/p&gt;

&lt;p&gt;Can you double check again what version doesnt work for you.&lt;br/&gt;
And if possible put together an unit test or small sample project that demonstrates/reproduces this issue?&lt;/p&gt;</comment>
                            <comment id="13829282" author="davsclaus" created="Thu, 21 Nov 2013 20:00:23 +0000"  >&lt;p&gt;Also what is the code logic in the method &lt;tt&gt;subOrderName&lt;/tt&gt;?&lt;/p&gt;</comment>
                            <comment id="13829329" author="7erry" created="Thu, 21 Nov 2013 20:52:20 +0000"  >&lt;p&gt;This is directly related to 2.12.1 since it works correctly in 2.11.1.&lt;br/&gt;
Also if we change from &amp;lt;groovy&amp;gt; to &amp;lt;simple&amp;gt; it works.&lt;br/&gt;
The exchange accepts an xml payload and then gets converted to a bean:&lt;br/&gt;
      &amp;lt;bean ref=&quot;orderConverter&quot; method=&quot;newExchangeOrder&quot;/&amp;gt;&lt;br/&gt;
The bean uses Stax to marshal from XML into an ExchangeOrder bean.&lt;br/&gt;
The ExchangeOrder bean contains a getSubOrderName:&lt;br/&gt;
	String getSubOrderName()&lt;/p&gt;
{ 	
		String s = order?.subOrder[0]?.class.simpleName
		
		(s.startsWith(&quot;Lessee&quot;))? s.replace(&apos;Lessee&apos;, &apos;Reseller&apos;) : s	
	}</comment>
                            <comment id="13829860" author="davsclaus" created="Fri, 22 Nov 2013 10:28:34 +0000"  >&lt;p&gt;Groovy itself has likely been upgraded between Camel 2.11 and 2.12. Can you try downgrading and use same Groovy version, and test on your end.&lt;br/&gt;
And can you make a simpler unit test / sample project that reproduces this problem?&lt;/p&gt;

&lt;p&gt;We cannot reproduce this issue you see on your end.&lt;/p&gt;

&lt;p&gt;And frankly the setHeader logic you use is so simple you can just use the simple language.&lt;/p&gt;</comment>
                            <comment id="13830014" author="7erry" created="Fri, 22 Nov 2013 14:39:51 +0000"  >&lt;p&gt;These dependencies work:&lt;br/&gt;
    &amp;lt;camel-version&amp;gt;2.11.1&amp;lt;/camel-version&amp;gt;&lt;br/&gt;
    &amp;lt;groovy-version&amp;gt;2.1.6&amp;lt;/groovy-version&amp;gt;&lt;br/&gt;
These do not:&lt;br/&gt;
    &amp;lt;camel-version&amp;gt;2.12.1&amp;lt;/camel-version&amp;gt;&lt;br/&gt;
    &amp;lt;groovy-version&amp;gt;2.1.6&amp;lt;/groovy-version&amp;gt;&lt;/p&gt;

&lt;p&gt;I have recommended the use of &amp;lt;simple&amp;gt; however it is a large project and there is some concern about how many conditional statements can be scoped ( (a&amp;amp;b)||(c&amp;amp;d) ) using simple.&lt;br/&gt;
I am still working on a localized test to reproduce this issue. It is is a timing issue; if you wait a few seconds before sending the second request it will have the correct value which is why I &lt;b&gt;assumed&lt;/b&gt; it was related to caching groovy.&lt;/p&gt;</comment>
                            <comment id="13830028" author="7erry" created="Fri, 22 Nov 2013 15:10:27 +0000"  >&lt;p&gt;This is isolated to the camel-groovy component given the following &lt;b&gt;working&lt;/b&gt; configuration:&lt;br/&gt;
    &amp;lt;camel-version&amp;gt;2.12.1&amp;lt;/camel-version&amp;gt;&lt;br/&gt;
    &amp;lt;groovy-version&amp;gt;2.1.6&amp;lt;/groovy-version&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;dependency&amp;gt;&lt;br/&gt;
      &amp;lt;groupId&amp;gt;org.apache.camel&amp;lt;/groupId&amp;gt;&lt;br/&gt;
      &amp;lt;artifactId&amp;gt;camel-script&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
      &amp;lt;version&amp;gt;2.11.1&amp;lt;/version&amp;gt;&lt;br/&gt;
    &amp;lt;/dependency&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13887877" author="davsclaus" created="Fri, 31 Jan 2014 16:18:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-7143&quot; title=&quot;camel-groovy - Evaluation returns 1st result only&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-7143&quot;&gt;&lt;del&gt;CAMEL-7143&lt;/del&gt;&lt;/a&gt; fixes this.&lt;/p&gt;</comment>
                            <comment id="13891247" author="7erry" created="Tue, 4 Feb 2014 21:36:59 +0000"  >&lt;p&gt;Thank you! I&apos;ll have (big phone company) move back to groovy from simple once 2.12.3 is GA.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12689846">CAMEL-7143</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12646401">CAMEL-6340</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359584</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pzlr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359883</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>