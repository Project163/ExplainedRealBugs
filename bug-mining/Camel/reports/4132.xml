<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:24:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-11352] duplicated/missing logs when camel-paxlogging work with pax-logging-log4j2</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-11352</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;This problem is found after switch to the karaf 4.1.x, which using pax-logging-log4j2 insteadof pax-logging-service.&lt;/p&gt;

&lt;p&gt;I created a small test case project for reproduce this issue. &lt;a href=&quot;https://github.com/xldai/test/tree/master/test-paxlogging-camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/xldai/test/tree/master/test-paxlogging-camel&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The findings from me is that, when PaxLoggingConsumer class &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; work together with pax-logging-service (karaf 4.0.x), it creates new threads to process the incoming PaxLoggingEvent and using MDC to filter the possible duplicated logs from PaxAppenderProxy class &lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;but when PaxLoggingConsumer class work together with pax-logging-log4j2, the multi thread mechanism for processing the PaxLoggingEvent will lead to duplicated/missing logs output to the camel Exchange.&lt;/p&gt;

&lt;p&gt;Since the L63 from &lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; fixed the possible duplicated logs come from PaxAppenderProxy class, I found that the multi thread mechanism and MDC checking can be removed from PaxLoggingConsumer class, then it works again as expected from my test result.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-paxlogging/src/main/java/org/apache/camel/component/paxlogging/PaxLoggingConsumer.java#L58&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/master/components/camel-paxlogging/src/main/java/org/apache/camel/component/paxlogging/PaxLoggingConsumer.java#L58&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/ops4j/org.ops4j.pax.logging/blob/logging-1.9.1/pax-logging-service/src/main/java/org/ops4j/pax/logging/service/internal/PaxAppenderProxy.java#L63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ops4j/org.ops4j.pax.logging/blob/logging-1.9.1/pax-logging-service/src/main/java/org/ops4j/pax/logging/service/internal/PaxAppenderProxy.java#L63&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://github.com/ops4j/org.ops4j.pax.logging/blob/logging-1.9.1/pax-logging-log4j2/src/main/java/org/ops4j/pax/logging/log4j2/internal/PaxAppenderProxy.java#L63&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/ops4j/org.ops4j.pax.logging/blob/logging-1.9.1/pax-logging-log4j2/src/main/java/org/ops4j/pax/logging/log4j2/internal/PaxAppenderProxy.java#L63&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13075473">CAMEL-11352</key>
            <summary>duplicated/missing logs when camel-paxlogging work with pax-logging-log4j2</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="xldai">Xilai Dai</reporter>
                        <labels>
                    </labels>
                <created>Sun, 28 May 2017 14:02:37 +0000</created>
                <updated>Thu, 1 Jun 2017 07:13:33 +0000</updated>
                            <resolved>Tue, 30 May 2017 07:08:53 +0000</resolved>
                                    <version>2.17.6</version>
                    <version>2.19.0</version>
                                    <fixVersion>2.19.1</fixVersion>
                    <fixVersion>2.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16027837" author="davsclaus" created="Sun, 28 May 2017 14:45:38 +0000"  >&lt;p&gt;So are you saying its a issue that is fixed in pax-logging. &lt;/p&gt;</comment>
                            <comment id="16028275" author="xldai" created="Mon, 29 May 2017 12:11:56 +0000"  >&lt;p&gt;Claus, from my test result, the pax-logging-service bundle (support log4j 1.x) sent duplicated log entries sometimes, so I think that&apos;s why the doAppend() of PaxLoggingConsumer made multi thread/add MDC checking to avoid these situation from camel side. but with pax-logging-log4j2 bundle installed, I don&apos;t see duplicated log entries any longer from it, but the new problem is, we got a lot duplicated logs from camel-paxlogging side.&lt;/p&gt;

&lt;p&gt;For example the logs from my test case above:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Apache Camel 2.19.0 (CamelContext: camel-1) started in 0.234 seconds
Apache Camel 2.19.0 (CamelContext: camel-1) started in 0.234 seconds
Apache Camel 2.19.0 (CamelContext: camel-1) started in 0.234 seconds
Started bundle: file:/G:/download/apache-karaf-4.1.1/deploy/test-paxlogging-camel-1.0.0.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the original logs from pax-logging-log4j2 are (as expected):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Route: route1 started and consuming from: Endpoint[paxlogging:&lt;span class=&quot;code-comment&quot;&gt;//mylog]
&lt;/span&gt;Total 1 routes, of which 1 are started.
Apache Camel 2.17.6 (CamelContext: camel-1) started in 0.234 seconds
Started bundle: file:/G:/download/apache-karaf-4.1.1/deploy/test-paxlogging-camel-1.0.0.jar
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16028277" author="davsclaus" created="Mon, 29 May 2017 12:18:11 +0000"  >&lt;p&gt;Well you are welcome to provide a github PR to fix this in camel-paxlogging&lt;/p&gt;</comment>
                            <comment id="16028793" author="githubbot" created="Tue, 30 May 2017 06:58:57 +0000"  >&lt;p&gt;GitHub user xldai opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1727&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1727&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    fix &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11352&quot; title=&quot;duplicated/missing logs when camel-paxlogging work with pax-logging-log4j2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11352&quot;&gt;&lt;del&gt;CAMEL-11352&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/xldai/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/xldai/camel&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1727.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1727.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #1727&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 2689846973276af9d9105924e8299bba10fc7b73&lt;br/&gt;
Author: xldai &amp;lt;xldai@talend.com&amp;gt;&lt;br/&gt;
Date:   2017-05-30T06:56:47Z&lt;/p&gt;

&lt;p&gt;    fix &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-11352&quot; title=&quot;duplicated/missing logs when camel-paxlogging work with pax-logging-log4j2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-11352&quot;&gt;&lt;del&gt;CAMEL-11352&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16028797" author="davsclaus" created="Tue, 30 May 2017 07:08:53 +0000"  >&lt;p&gt;Thanks for the PR&lt;/p&gt;</comment>
                            <comment id="16032567" author="githubbot" created="Thu, 1 Jun 2017 07:13:33 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/1727&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/1727&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 24 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fkmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>