<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:11:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-8460] camel-spring-boot - Routes restart during startup</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8460</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The latest snapshot fixes the issue with my routes not being found.&lt;br/&gt;
But there is still some undesirable behaviour with routes being restarted during the context refresh.&lt;/p&gt;

&lt;p&gt;Here&apos;s the console log that shows shutdown handlers being run during app startup... tia&lt;/p&gt;

&lt;p&gt;.   ____          _            __ _ _&lt;br/&gt;
/&lt;br class=&quot;atl-forced-newline&quot; /&gt; / __&lt;em&gt;&apos;&lt;/em&gt; __ _ &lt;em&gt;(&lt;/em&gt;)_ __  __ _ \ \ \ \&lt;br/&gt;
( ( )&amp;#95;__ | &apos;_ | &apos;&lt;em&gt;| | &apos;&lt;/em&gt; \/ _` | \ \ \ \
&lt;br class=&quot;atl-forced-newline&quot; /&gt;/  __&lt;em&gt;)| |&lt;/em&gt;)| | | | | || (_| |  ) ) ) )&lt;br/&gt;
&apos;  |___&lt;em&gt;| .&lt;/em&gt;&lt;em&gt;|&lt;/em&gt;| |&lt;em&gt;|&lt;/em&gt;| |&lt;em&gt;&amp;#95;&lt;/em&gt;, | / / / /&lt;br/&gt;
=========|&lt;em&gt;|==============|&lt;/em&gt;_&lt;em&gt;/=/&lt;/em&gt;/&lt;em&gt;/&lt;/em&gt;/&lt;br/&gt;
:: Spring Boot ::        (v1.2.2.RELEASE)&lt;/p&gt;

&lt;p&gt;2015-03-09 08:40:55.162  INFO 81935 &amp;#8212; [           main] mediaroom.MRServicesApp                  : Starting MRServicesApp on MBP13.local with PID 81935 (/Users/srnm/Documents/workspace-buffdubs/MRServices/target/classes started by srnm in /Users/srnm/Documents/workspace-buffdubs/MRServices)&lt;br/&gt;
2015-03-09 08:40:55.165 DEBUG 81935 &amp;#8212; [           main] mediaroom.MRServicesApp                  : Running with Spring Boot v1.2.2.RELEASE, Spring v4.1.5.RELEASE&lt;br/&gt;
...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;AppClassLoader@14dad5dc&amp;#93;&lt;/span&gt; info AspectJ Weaver Version 1.8.5 built on Thursday Jan 29, 2015 at 01:03:58 GMT&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;AppClassLoader@14dad5dc&amp;#93;&lt;/span&gt; info register classloader sun.misc.Launcher$AppClassLoader@14dad5dc&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;AppClassLoader@14dad5dc&amp;#93;&lt;/span&gt; info using configuration /Users/srnm/Documents/workspace-buffdubs/MRServices/src/main/resources/META-INF/aop.xml&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;AppClassLoader@14dad5dc&amp;#93;&lt;/span&gt; info register aspect com.amazonaws.services.simpleworkflow.flow.aspectj.AsynchronousAspect&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;AppClassLoader@14dad5dc&amp;#93;&lt;/span&gt; info register aspect com.amazonaws.services.simpleworkflow.flow.aspectj.ExponentialRetryAspect&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;AppClassLoader@14dad5dc&amp;#93;&lt;/span&gt; warning javax.* types are not being woven because the weaver option &apos;-Xset:weaveJavaxPackages=true&apos; has not been specified&lt;br/&gt;
2015-03-09 08:41:03.406  INFO 81935 &amp;#8212; [           main] o.a.c.i.converter.DefaultTypeConverter   : Loaded 183 type converters&lt;br/&gt;
2015-03-09 08:41:04.345 DEBUG 81935 &amp;#8212; [           main] o.a.camel.spring.boot.RoutesCollector    : Post-processing CamelContext bean: camel-1&lt;br/&gt;
2015-03-09 08:41:04.346 DEBUG 81935 &amp;#8212; [           main] o.a.camel.spring.boot.RoutesCollector    : Injecting following route into the CamelContext: Routes: []&lt;br/&gt;
2015-03-09 08:41:04.394  INFO 81935 &amp;#8212; [           main] o.a.camel.component.log.LogComponent     : Using custom Logger: Logger&lt;span class=&quot;error&quot;&gt;&amp;#91;camelLogger&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:04.630 DEBUG 81935 &amp;#8212; [           main] o.a.camel.spring.boot.RoutesCollector    : Injecting following route into the CamelContext: Routes: []&lt;br/&gt;
2015-03-09 08:41:04.632  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Apache Camel 2.15-SNAPSHOT (CamelContext: camel-1) is starting&lt;br/&gt;
2015-03-09 08:41:04.633  INFO 81935 &amp;#8212; [           main] o.a.c.m.ManagedManagementStrategy        : JMX is enabled&lt;br/&gt;
2015-03-09 08:41:04.932  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : AllowUseOriginalMessage is enabled. If access to the original message is not needed, then its recommended to turn this option off as it may improve performance.&lt;br/&gt;
2015-03-09 08:41:04.932  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at &lt;a href=&quot;http://camel.apache.org/stream-caching.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/stream-caching.html&lt;/a&gt;&lt;br/&gt;
2015-03-09 08:41:05.089  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: roomSyncDLQ started and consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://roomSyncDLQ&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:05.090  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: syncAllRooms started and consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;timer://roomSyncTimer?delay=3s&amp;amp;period=30s&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:05.092  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: writeRoomSync started and consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://writeRoomSync&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:05.095  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: updateRoomRepo started and consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://updateRoomRepo&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:05.096  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: transcodeWorkflowDLQ started and consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://transcodeWorkflowDLQ&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:05.098  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: transcodeWorkflowStart started and consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://transcodeWorkflowStart&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:05.106  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Total 6 routes, of which 6 is started.&lt;br/&gt;
2015-03-09 08:41:05.108  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Apache Camel 2.15-SNAPSHOT (CamelContext: camel-1) started in 0.474 seconds&lt;br/&gt;
...&lt;br/&gt;
2015-03-09 08:41:07.020 DEBUG 81935 &amp;#8212; [           main] o.a.camel.spring.boot.RoutesCollector    : Post-processing CamelContext bean: camel-1&lt;br/&gt;
2015-03-09 08:41:07.022 DEBUG 81935 &amp;#8212; [           main] o.a.camel.spring.boot.RoutesCollector    : Injecting following route into the CamelContext: Routes: [Route(roomSyncDLQ)[[From&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://roomSyncDLQ&amp;#93;&lt;/span&gt;] -&amp;gt; [To&lt;span class=&quot;error&quot;&gt;&amp;#91;browse:roomSyncDLQ&amp;#93;&lt;/span&gt;]], Route(syncAllRooms)[[From&lt;span class=&quot;error&quot;&gt;&amp;#91;timer://roomSyncTimer?delay=3s&amp;amp;period=30s&amp;#93;&lt;/span&gt;] -&amp;gt; [process&lt;span class=&quot;error&quot;&gt;&amp;#91;Processor@0x64910b2d&amp;#93;&lt;/span&gt;, Split[&lt;/p&gt;
{body}
&lt;p&gt; -&amp;gt; [process&lt;span class=&quot;error&quot;&gt;&amp;#91;Processor@0x1247c72e&amp;#93;&lt;/span&gt;, process&lt;span class=&quot;error&quot;&gt;&amp;#91;Processor@0x6fef75c6&amp;#93;&lt;/span&gt;, Multicast[[To&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://writeRoomSync&amp;#93;&lt;/span&gt;, To&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://updateRoomRepo&amp;#93;&lt;/span&gt;, To&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://transcodeWorkflowStart&amp;#93;&lt;/span&gt;]]]]]], Route(writeRoomSync)[[From&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://writeRoomSync&amp;#93;&lt;/span&gt;] -&amp;gt; [Choice[[When[simple{${body.isNoChange}} -&amp;gt; [To&lt;span class=&quot;error&quot;&gt;&amp;#91;log://?level=OFF&amp;#93;&lt;/span&gt;]]] Otherwise[[process&lt;span class=&quot;error&quot;&gt;&amp;#91;Processor@0x5f61e002&amp;#93;&lt;/span&gt;, Marshal&lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.camel.model.DataFormatDefinition@334540a0&amp;#93;&lt;/span&gt;, To&lt;a href=&quot;file:///Users/srnm/MR-reports/RoomSync?fileExist=Fail&amp;amp;fileName=%24%7Bfile%3Aonlyname.noext%7D.json&amp;amp;tempFileName=%24%7Bfile%3Aonlyname.noext%7D_%24%7Bfile%3Aname.ext%7D.inprogress&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:///Users/srnm/MR-reports/RoomSync?fileExist=Fail&amp;amp;fileName=%24%7Bfile%3Aonlyname.noext%7D.json&amp;amp;tempFileName=%24%7Bfile%3Aonlyname.noext%7D_%24%7Bfile%3Aname.ext%7D.inprogress&lt;/a&gt;]]]]], Route(updateRoomRepo)[[From&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://updateRoomRepo&amp;#93;&lt;/span&gt;] -&amp;gt; [Split[&lt;/p&gt;
{ognl(body, asUpdatesJava)}
&lt;p&gt; -&amp;gt; [process&lt;span class=&quot;error&quot;&gt;&amp;#91;Processor@0x1f179f51&amp;#93;&lt;/span&gt;, To&lt;span class=&quot;error&quot;&gt;&amp;#91;browse:updateRoomRepoComplete&amp;#93;&lt;/span&gt;]]]]]&lt;br/&gt;
2015-03-09 08:41:07.023  INFO 81935 &amp;#8212; [           main] o.a.camel.impl.DefaultShutdownStrategy   : Starting to graceful shutdown 1 routes (timeout 300 seconds)&lt;br/&gt;
2015-03-09 08:41:07.029  INFO 81935 &amp;#8212; [ - ShutdownTask] o.a.camel.impl.DefaultShutdownStrategy   : Route: roomSyncDLQ shutdown complete, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://roomSyncDLQ&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.029  INFO 81935 &amp;#8212; [           main] o.a.camel.impl.DefaultShutdownStrategy   : Graceful shutdown of 1 routes completed in 0 seconds&lt;br/&gt;
2015-03-09 08:41:07.031  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: roomSyncDLQ is stopped, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://roomSyncDLQ&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.032  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: roomSyncDLQ is shutdown and removed, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://roomSyncDLQ&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.034  INFO 81935 &amp;#8212; [           main] o.a.camel.impl.DefaultShutdownStrategy   : Starting to graceful shutdown 1 routes (timeout 300 seconds)&lt;br/&gt;
2015-03-09 08:41:07.035  INFO 81935 &amp;#8212; [ - ShutdownTask] o.a.camel.impl.DefaultShutdownStrategy   : Route: syncAllRooms shutdown complete, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;timer://roomSyncTimer?delay=3s&amp;amp;period=30s&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.035  INFO 81935 &amp;#8212; [           main] o.a.camel.impl.DefaultShutdownStrategy   : Graceful shutdown of 1 routes completed in 0 seconds&lt;br/&gt;
2015-03-09 08:41:07.037  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: syncAllRooms is stopped, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;timer://roomSyncTimer?delay=3s&amp;amp;period=30s&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.038  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: syncAllRooms is shutdown and removed, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;timer://roomSyncTimer?delay=3s&amp;amp;period=30s&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.039  INFO 81935 &amp;#8212; [           main] o.a.camel.impl.DefaultShutdownStrategy   : Starting to graceful shutdown 1 routes (timeout 300 seconds)&lt;br/&gt;
2015-03-09 08:41:07.039  INFO 81935 &amp;#8212; [ - ShutdownTask] o.a.camel.impl.DefaultShutdownStrategy   : Route: writeRoomSync shutdown complete, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://writeRoomSync&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.039  INFO 81935 &amp;#8212; [           main] o.a.camel.impl.DefaultShutdownStrategy   : Graceful shutdown of 1 routes completed in 0 seconds&lt;br/&gt;
2015-03-09 08:41:07.040  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: writeRoomSync is stopped, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://writeRoomSync&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.041  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: writeRoomSync is shutdown and removed, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://writeRoomSync&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.042  INFO 81935 &amp;#8212; [           main] o.a.camel.impl.DefaultShutdownStrategy   : Starting to graceful shutdown 1 routes (timeout 300 seconds)&lt;br/&gt;
2015-03-09 08:41:07.042  INFO 81935 &amp;#8212; [ - ShutdownTask] o.a.camel.impl.DefaultShutdownStrategy   : Route: updateRoomRepo shutdown complete, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://updateRoomRepo&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.043  INFO 81935 &amp;#8212; [           main] o.a.camel.impl.DefaultShutdownStrategy   : Graceful shutdown of 1 routes completed in 0 seconds&lt;br/&gt;
2015-03-09 08:41:07.044  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: updateRoomRepo is stopped, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://updateRoomRepo&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.045  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: updateRoomRepo is shutdown and removed, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://updateRoomRepo&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.057  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: roomSyncDLQ started and consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://roomSyncDLQ&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.091  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: syncAllRooms started and consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;timer://roomSyncTimer?delay=3s&amp;amp;period=30s&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.113  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: writeRoomSync started and consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://writeRoomSync&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.129  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: updateRoomRepo started and consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://updateRoomRepo&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.129 DEBUG 81935 &amp;#8212; [           main] o.a.camel.spring.boot.RoutesCollector    : Injecting following route into the CamelContext: Routes: [Route(transcodeWorkflowDLQ)[[From&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://transcodeWorkflowDLQ&amp;#93;&lt;/span&gt;] -&amp;gt; [To&lt;span class=&quot;error&quot;&gt;&amp;#91;browse:transcodeWorkflowDLQ&amp;#93;&lt;/span&gt;]], Route(transcodeWorkflowStart)[[From&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://transcodeWorkflowStart&amp;#93;&lt;/span&gt;] -&amp;gt; [process&lt;span class=&quot;error&quot;&gt;&amp;#91;Processor@0x4a6a6a69&amp;#93;&lt;/span&gt;]]]&lt;br/&gt;
2015-03-09 08:41:07.130  INFO 81935 &amp;#8212; [           main] o.a.camel.impl.DefaultShutdownStrategy   : Starting to graceful shutdown 1 routes (timeout 300 seconds)&lt;br/&gt;
2015-03-09 08:41:07.130  INFO 81935 &amp;#8212; [ - ShutdownTask] o.a.camel.impl.DefaultShutdownStrategy   : Route: transcodeWorkflowDLQ shutdown complete, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://transcodeWorkflowDLQ&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.130  INFO 81935 &amp;#8212; [           main] o.a.camel.impl.DefaultShutdownStrategy   : Graceful shutdown of 1 routes completed in 0 seconds&lt;br/&gt;
2015-03-09 08:41:07.131  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: transcodeWorkflowDLQ is stopped, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://transcodeWorkflowDLQ&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.132  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: transcodeWorkflowDLQ is shutdown and removed, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://transcodeWorkflowDLQ&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.132  INFO 81935 &amp;#8212; [           main] o.a.camel.impl.DefaultShutdownStrategy   : Starting to graceful shutdown 1 routes (timeout 300 seconds)&lt;br/&gt;
2015-03-09 08:41:07.132  INFO 81935 &amp;#8212; [ - ShutdownTask] o.a.camel.impl.DefaultShutdownStrategy   : Route: transcodeWorkflowStart shutdown complete, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://transcodeWorkflowStart&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.133  INFO 81935 &amp;#8212; [           main] o.a.camel.impl.DefaultShutdownStrategy   : Graceful shutdown of 1 routes completed in 0 seconds&lt;br/&gt;
2015-03-09 08:41:07.133  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: transcodeWorkflowStart is stopped, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://transcodeWorkflowStart&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.134  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: transcodeWorkflowStart is shutdown and removed, was consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://transcodeWorkflowStart&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.144  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: transcodeWorkflowDLQ started and consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://transcodeWorkflowDLQ&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.150  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Route: transcodeWorkflowStart started and consuming from: Endpoint&lt;span class=&quot;error&quot;&gt;&amp;#91;direct://transcodeWorkflowStart&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-03-09 08:41:07.151  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Apache Camel 2.15-SNAPSHOT (CamelContext: camel-1) is starting&lt;br/&gt;
2015-03-09 08:41:07.151  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Total 6 routes, of which 6 is started.&lt;br/&gt;
2015-03-09 08:41:07.151  INFO 81935 &amp;#8212; [           main] o.a.camel.spring.SpringCamelContext      : Apache Camel 2.15-SNAPSHOT (CamelContext: camel-1) started in 0.000 seconds&lt;br/&gt;
2015-03-09 08:41:07.164  INFO 81935 &amp;#8212; [           main] mediaroom.MRServicesApp                  : Started MRServicesApp in 12.586 seconds (JVM running for 13.145)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12780354">CAMEL-8460</key>
            <summary>camel-spring-boot - Routes restart during startup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10001">Pending Closed</resolution>
                                        <assignee username="hekonsek">Henryk Konsek</assignee>
                                    <reporter username="srnm">Steven Marcus</reporter>
                        <labels>
                    </labels>
                <created>Sun, 8 Mar 2015 21:59:38 +0000</created>
                <updated>Wed, 28 Jun 2017 19:16:52 +0000</updated>
                            <resolved>Tue, 12 May 2015 16:16:23 +0000</resolved>
                                    <version>2.15.0</version>
                                    <fixVersion>2.15.3</fixVersion>
                    <fixVersion>2.16.0</fixVersion>
                                    <component>camel-spring-boot</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14356675" author="hekonsek" created="Wed, 11 Mar 2015 10:24:08 +0000"  >&lt;p&gt;I will take a look at this soon. Stay tuned!&lt;/p&gt;</comment>
                            <comment id="14376166" author="davsclaus" created="Mon, 23 Mar 2015 16:43:55 +0000"  >&lt;p&gt;Did you have a chance to look at this?&lt;/p&gt;

&lt;p&gt;We are working on closing down for a 2.15.1 patch release&lt;/p&gt;</comment>
                            <comment id="14377274" author="srnm" created="Tue, 24 Mar 2015 04:46:16 +0000"  >&lt;p&gt;I tested against 2.15.1-SNAPSHOT available just before I replied here.&lt;/p&gt;

&lt;p&gt;The undesirable behaviour of routes being shutdown and restarted during startup was still visible in the app logs.&lt;/p&gt;

&lt;p&gt;HTH,&lt;br/&gt;
Steven&lt;/p&gt;</comment>
                            <comment id="14378165" author="hekonsek" created="Tue, 24 Mar 2015 17:07:34 +0000"  >&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;I think I will take a look at this by the end of this week.&lt;/p&gt;

&lt;p&gt;Stay tuned!&lt;/p&gt;</comment>
                            <comment id="14501564" author="hekonsek" created="Sat, 18 Apr 2015 19:53:35 +0000"  >&lt;p&gt;Hi Steven,&lt;/p&gt;

&lt;p&gt;I&apos;ve just tried to execute the following test against the Camel master (2.16-SNAPSHOT):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@SpringBootApplication
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;DoubleStartTest &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; FatJarRouter {

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:test&quot;&lt;/span&gt;).to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:test&quot;&lt;/span&gt;);
    }

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void xxx() {
        DoubleStartTest.main(&lt;span class=&quot;code-quote&quot;&gt;&quot;--spring.main.sources=&quot;&lt;/span&gt; + DoubleStartTest.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName());
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Everything seems to work like a charm. The routes and context have been started only once:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Running org.apache.camel.spring.boot.testme.DoubleStartTest
  .   ____          _            __ _ _
 /\\ / ___&apos;_ __ _ _(_)_ __  __ _ \ \ \ \
( ( )\___ | &lt;span class=&quot;code-quote&quot;&gt;&apos;_ | &apos;&lt;/span&gt;_| | &apos;_ \/ _` | \ \ \ \
 \\/  ___)| |_)| | | | | || (_| |  ) ) ) )
  &apos;  |____| .__|_| |_|_| |_\__, | / / / /
 =========|_|==============|___/=/_/_/_/
 :: Spring Boot ::        (v1.2.3.RELEASE)

2015-04-18 21:46:40.823  INFO 28438 --- [           main] o.apache.camel.spring.boot.FatJarRouter  : Starting FatJarRouter on henryberg with PID 28438 (/home/hekonsek/projects/camel/components/camel-spring-boot/target/classes started by hekonsek in /home/hekonsek/projects/camel/components/camel-spring-boot)
2015-04-18 21:46:40.856  INFO 28438 --- [           main] ationConfigEmbeddedWebApplicationContext : Refreshing org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@402e37bc: startup date [Sat Apr 18 21:46:40 CEST 2015]; root of context hierarchy
2015-04-18 21:46:41.273  INFO 28438 --- [           main] o.s.b.f.s.DefaultListableBeanFactory     : Overriding bean definition &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; bean &lt;span class=&quot;code-quote&quot;&gt;&apos;beanNameViewResolver&apos;&lt;/span&gt;: replacing [Root bean: class [&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;]; scope=; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt;=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; lazyInit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; autowireMode=3; dependencyCheck=0; autowireCandidate=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; primary=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; factoryBeanName=org.springframework.boot.autoconfigure.web.ErrorMvcAutoConfiguration$WhitelabelErrorViewConfiguration; factoryMethodName=beanNameViewResolver; initMethodName=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; destroyMethodName=(inferred); defined in &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;path resource [org/springframework/boot/autoconfigure/web/ErrorMvcAutoConfiguration$WhitelabelErrorViewConfiguration.class]] with [Root bean: class [&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;]; scope=; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt;=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; lazyInit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; autowireMode=3; dependencyCheck=0; autowireCandidate=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;; primary=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;; factoryBeanName=org.springframework.boot.autoconfigure.web.WebMvcAutoConfiguration$WebMvcAutoConfigurationAdapter; factoryMethodName=beanNameViewResolver; initMethodName=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; destroyMethodName=(inferred); defined in &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;path resource [org/springframework/boot/autoconfigure/web/WebMvcAutoConfiguration$WebMvcAutoConfigurationAdapter.class]]
2015-04-18 21:46:41.597  INFO 28438 --- [           main] trationDelegate$BeanPostProcessorChecker : Bean &lt;span class=&quot;code-quote&quot;&gt;&apos;org.apache.camel.spring.boot.CamelAutoConfiguration&apos;&lt;/span&gt; of type [&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.camel.spring.boot.CamelAutoConfiguration$$EnhancerBySpringCGLIB$$369735a8] is not eligible &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; getting processed by all BeanPostProcessors (&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; example: not eligible &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; auto-proxying)
2015-04-18 21:46:41.895  INFO 28438 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat initialized with port(s): 8080 (http)
2015-04-18 21:46:42.088  INFO 28438 --- [           main] o.apache.catalina.core.StandardService   : Starting service Tomcat
2015-04-18 21:46:42.090  INFO 28438 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet Engine: Apache Tomcat/8.0.20
2015-04-18 21:46:42.217  INFO 28438 --- [ost-startStop-1] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext
2015-04-18 21:46:42.217  INFO 28438 --- [ost-startStop-1] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 1365 ms
2015-04-18 21:46:42.757  INFO 28438 --- [ost-startStop-1] o.s.b.c.e.ServletRegistrationBean        : Mapping servlet: &lt;span class=&quot;code-quote&quot;&gt;&apos;dispatcherServlet&apos;&lt;/span&gt; to [/]
2015-04-18 21:46:42.760  INFO 28438 --- [ost-startStop-1] o.s.b.c.embedded.FilterRegistrationBean  : Mapping filter: &lt;span class=&quot;code-quote&quot;&gt;&apos;characterEncodingFilter&apos;&lt;/span&gt; to: [/*]
2015-04-18 21:46:42.760  INFO 28438 --- [ost-startStop-1] o.s.b.c.embedded.FilterRegistrationBean  : Mapping filter: &lt;span class=&quot;code-quote&quot;&gt;&apos;hiddenHttpMethodFilter&apos;&lt;/span&gt; to: [/*]
2015-04-18 21:46:43.031  INFO 28438 --- [           main] s.w.s.m.m.a.RequestMappingHandlerAdapter : Looking &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; @ControllerAdvice: org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@402e37bc: startup date [Sat Apr 18 21:46:40 CEST 2015]; root of context hierarchy
2015-04-18 21:46:43.081  INFO 28438 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &lt;span class=&quot;code-quote&quot;&gt;&quot;{[/error],methods=[],params=[],headers=[],consumes=[],produces=[text/html],custom=[]}&quot;&lt;/span&gt; onto &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; org.springframework.web.servlet.ModelAndView org.springframework.boot.autoconfigure.web.BasicErrorController.errorHtml(javax.servlet.http.HttpServletRequest)
2015-04-18 21:46:43.081  INFO 28438 --- [           main] s.w.s.m.m.a.RequestMappingHandlerMapping : Mapped &lt;span class=&quot;code-quote&quot;&gt;&quot;{[/error],methods=[],params=[],headers=[],consumes=[],produces=[],custom=[]}&quot;&lt;/span&gt; onto &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; org.springframework.http.ResponseEntity&amp;lt;java.util.Map&amp;lt;java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt;&amp;gt; org.springframework.boot.autoconfigure.web.BasicErrorController.error(javax.servlet.http.HttpServletRequest)
2015-04-18 21:46:43.106  INFO 28438 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/webjars/**] onto handler of type [&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2015-04-18 21:46:43.107  INFO 28438 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [/**] onto handler of type [&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2015-04-18 21:46:43.148  INFO 28438 --- [           main] o.s.w.s.handler.SimpleUrlHandlerMapping  : Mapped URL path [&lt;span class=&quot;code-comment&quot;&gt;/**/&lt;/span&gt;favicon.ico] onto handler of type [&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.springframework.web.servlet.resource.ResourceHttpRequestHandler]
2015-04-18 21:46:43.417  INFO 28438 --- [           main] o.a.c.i.converter.DefaultTypeConverter   : Loaded 197 type converters
2015-04-18 21:46:43.507  INFO 28438 --- [           main] o.s.j.e.a.AnnotationMBeanExporter        : Registering beans &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; JMX exposure on startup
2015-04-18 21:46:44.174  INFO 28438 --- [           main] o.a.camel.spring.SpringCamelContext      : Apache Camel 2.16-SNAPSHOT (CamelContext: camel-1) is starting
2015-04-18 21:46:44.174  INFO 28438 --- [           main] o.a.c.m.ManagedManagementStrategy        : JMX is enabled
2015-04-18 21:46:44.314  INFO 28438 --- [           main] o.a.camel.spring.SpringCamelContext      : AllowUseOriginalMessage is enabled. If access to the original message is not needed, then its recommended to turn &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; option off as it may improve performance.
2015-04-18 21:46:44.314  INFO 28438 --- [           main] o.a.camel.spring.SpringCamelContext      : StreamCaching is not in use. If using streams then its recommended to enable stream caching. See more details at http:&lt;span class=&quot;code-comment&quot;&gt;//camel.apache.org/stream-caching.html
&lt;/span&gt;2015-04-18 21:46:44.345  INFO 28438 --- [           main] o.a.camel.spring.SpringCamelContext      : Route: route1 started and consuming from: Endpoint[direct:&lt;span class=&quot;code-comment&quot;&gt;//test]
&lt;/span&gt;2015-04-18 21:46:44.347  INFO 28438 --- [           main] o.a.camel.spring.SpringCamelContext      : Route: route2 started and consuming from: Endpoint[direct:&lt;span class=&quot;code-comment&quot;&gt;//xmlAutoLoading]
&lt;/span&gt;2015-04-18 21:46:44.348  INFO 28438 --- [           main] o.a.camel.spring.SpringCamelContext      : Total 2 routes, of which 2 is started.
2015-04-18 21:46:44.349  INFO 28438 --- [           main] o.a.camel.spring.SpringCamelContext      : Apache Camel 2.16-SNAPSHOT (CamelContext: camel-1) started in 0.175 seconds
2015-04-18 21:46:44.398  INFO 28438 --- [           main] s.b.c.e.t.TomcatEmbeddedServletContainer : Tomcat started on port(s): 8080 (http)
2015-04-18 21:46:44.400  INFO 28438 --- [           main] o.apache.camel.spring.boot.FatJarRouter  : Started FatJarRouter in 3.928 seconds (JVM running &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 4.837)
2015-04-18 21:46:44.401  INFO 28438 --- [           main] org.apache.camel.main.MainSupport        : Apache Camel 2.16-SNAPSHOT starting
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can you create the example that reproduces the issue on the Camel master branch?&lt;/p&gt;

&lt;p&gt;Laters!&lt;/p&gt;</comment>
                            <comment id="14501648" author="srnm" created="Sun, 19 Apr 2015 00:36:56 +0000"  >&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;I can confirm that I see cleaner context startup with 2.16-SNAPSHOT.&lt;/p&gt;

&lt;p&gt;But I am not sure that the lifecycle contracts are being maintained?&lt;br/&gt;
A processor registered in a route is being started twice:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2015-04-19 10:28:20.535  INFO 21330 --- [           main] melLifecycleMonitorRoute$$anon$1$$anon$2 : create: 1
2015-04-19 10:28:20.644  INFO 21330 --- [           main] melLifecycleMonitorRoute$$anon$1$$anon$2 : start: 1
2015-04-19 10:28:20.656  INFO 21330 --- [           main] melLifecycleMonitorRoute$$anon$1$$anon$2 : start: 2
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here&apos;s the code I used:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Configuration
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CamelLifecycleMonitorConfiguration {
  @Bean def CamelLifecycleMonitorRoutes(ef: ExchangeFormatter): RouteBuilder = {
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
      override def configure(): Unit = {

        val creates = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AtomicInteger()
        val starts = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AtomicInteger()
        val stops = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AtomicInteger()

        from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:camelLifecycleMonitor&quot;&lt;/span&gt;)
          .process(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Processor with Service with StrictLogging {

            {
              val c = creates.incrementAndGet()
              logger.info(s&lt;span class=&quot;code-quote&quot;&gt;&quot;create: $c&quot;&lt;/span&gt;)
            }

            override def stop(): Unit = {
              val c = stops.incrementAndGet()
              logger.info(s&lt;span class=&quot;code-quote&quot;&gt;&quot;stop: $c&quot;&lt;/span&gt;)
            }

            override def start(): Unit = {
              val c = starts.incrementAndGet()
              logger.info(s&lt;span class=&quot;code-quote&quot;&gt;&quot;start: $c&quot;&lt;/span&gt;)
            }

            override def process(exchange: Exchange): Unit = {
              logger.info(ef.format(exchange))
            }
          })
      }
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Do I not understand the lifecycle contract? Is my test wrong?&lt;br/&gt;
Or is there a bug in the framework code?&lt;/p&gt;

&lt;p&gt;TIA,&lt;br/&gt;
Steven&lt;/p&gt;</comment>
                            <comment id="14501698" author="davsclaus" created="Sun, 19 Apr 2015 05:47:57 +0000"  >&lt;p&gt;Ah you should override doStart / doStop as those are the callbacks where end users have their logic. start|stop may trigger more than once but there is logic in there by default that check the state and only call doStart / doStop appropriately.&lt;/p&gt;</comment>
                            <comment id="14505749" author="hekonsek" created="Tue, 21 Apr 2015 21:01:23 +0000"  >&lt;p&gt;Also if you create your processor as a Spring bean, you are guaranteed that it follows the Spring lifecycle. I.e. it is a singleton created/destroyed together with the Spring context.&lt;/p&gt;</comment>
                            <comment id="14505758" author="hekonsek" created="Tue, 21 Apr 2015 21:04:03 +0000"  >&lt;p&gt;Let me close this one. It is a corner case, which is hard to reproduce even in Camel 2.15, while it is definitely fixed in Camel 2.16. Feel free to reopen the case if you don&apos;t agree with me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; .&lt;/p&gt;</comment>
                            <comment id="14530608" author="jhberges" created="Wed, 6 May 2015 14:16:10 +0000"  >&lt;p&gt;I think this is a case of multiple levels of application contexts.&lt;br/&gt;
I&apos;ve debugged this down to &lt;tt&gt;org.apache.camel.spring.boot.RoutesCollector&lt;/tt&gt;.&lt;br/&gt;
For my clients case, this seems to happen when spring-boot-actuator-starter is used.&lt;/p&gt;

&lt;p&gt;One fix might be that &lt;tt&gt;RoutesCollector&lt;/tt&gt; only process the route beans when it is the root context that has been refreshed?&lt;/p&gt;

&lt;p&gt;Details: the &lt;tt&gt;onApplicationEvent&lt;/tt&gt; callback is called twice with the following contexts, from breakpoint &lt;a href=&quot;https://github.com/apache/camel/blob/master/components/camel-spring-boot/src/main/java/org/apache/camel/spring/boot/RoutesCollector.java#L52&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.springframework.context.event.ContextRefreshedEvent[source=org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@26be9a6: startup date [Wed May 06 15:56:32 CEST 2015]; parent: org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@28b46423]
org.springframework.context.event.ContextRefreshedEvent[source=org.springframework.boot.context.embedded.AnnotationConfigEmbeddedWebApplicationContext@28b46423: startup date [Wed May 06 15:55:18 CEST 2015]; root of context hierarchy]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Adding the routes on the latter would be correct for our case.&lt;/p&gt;

&lt;p&gt;I&apos;ll investigate wether or not some dependency management may solve it, else I&apos;ll do a forked tweak for my specific use&lt;/p&gt;</comment>
                            <comment id="14530648" author="githubbot" created="Wed, 6 May 2015 14:47:19 +0000"  >&lt;p&gt;GitHub user jhberges opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/511&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/511&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Simplistic workaround for ...&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8460&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-8460&lt;/a&gt;, that works for me.&lt;/p&gt;

&lt;p&gt;    A bit difficult to write unit test for, since this requires multiple ApplicationContext instances to have been started.&lt;/p&gt;

&lt;p&gt;    I also would image there&apos;s a better way to implement this - perhaps by checking for existing routes before adding them?&lt;br/&gt;
    I don&apos;t know, but this simple tweak works for us - so it&apos;s good enough for us, for now.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jhberges/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jhberges/camel&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/511.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/511.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #511&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit f268a0c200a915d042d4d05b124e99a981ca60ea&lt;br/&gt;
Author: Jan-Helge Bergesen &amp;lt;jan.helgebergesen@free2.no&amp;gt;&lt;br/&gt;
Date:   2015-05-06T14:42:14Z&lt;/p&gt;

&lt;p&gt;    Simplistic workaround for &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8460&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-8460&lt;/a&gt;, that works for me&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14531266" author="hekonsek" created="Wed, 6 May 2015 19:37:10 +0000"  >&lt;p&gt;Yeah, parent application context might be the corner case here. Let me verify this with the unit test and merge your fix. Thanks for catching this!&lt;/p&gt;</comment>
                            <comment id="14540109" author="hekonsek" created="Tue, 12 May 2015 16:01:13 +0000"  >&lt;p&gt;Resolved in 98902f02d143b6e81c8d7f0b8048b1788ecbcb50. Great thanks for the patch!&lt;/p&gt;</comment>
                            <comment id="14540284" author="githubbot" created="Tue, 12 May 2015 17:26:16 +0000"  >&lt;p&gt;Github user jhberges closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/511&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/511&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14984134" author="mranest" created="Sat, 31 Oct 2015 20:21:18 +0000"  >&lt;p&gt;Fix as implemented fails to properly initialize Camel context when Spring instantiates the application context as a child of another, parent context. This is the case for example when using spring-cloud-config. See:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://projects.spring.io/spring-cloud/docs/1.0.3/spring-cloud.html#_the_bootstrap_application_context&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://projects.spring.io/spring-cloud/docs/1.0.3/spring-cloud.html#_the_bootstrap_application_context&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As soon as spring-cloud-config is enabled in a camel spring boot application (i.e. include the org.springframework.cloud:spring-cloud-starter-config dependency) Camel context does not get to be initialized, as test expression at line 58 evaluates to false even for the initial context refresh event at application initialization.&lt;/p&gt;

&lt;p&gt;The same problem will arise for any applications that use Spring Boot&apos;s fluent builder API (see: &lt;a href=&quot;http://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-spring-application.html#boot-features-fluent-builder-api&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.spring.io/spring-boot/docs/current/reference/html/boot-features-spring-application.html#boot-features-fluent-builder-api&lt;/a&gt;) that provides methods to programmatically create multiple contexts with a parent/child relationship.&lt;/p&gt;</comment>
                            <comment id="14984308" author="githubbot" created="Sun, 1 Nov 2015 09:10:18 +0000"  >&lt;p&gt;GitHub user mranest opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/666&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/666&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8460&quot; title=&quot;camel-spring-boot - Routes restart during startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8460&quot;&gt;&lt;del&gt;CAMEL-8460&lt;/del&gt;&lt;/a&gt;: Revert simplistic workaround&lt;/p&gt;

&lt;p&gt;    Workaround failed to initialize routes in case of multiple contexts&lt;br/&gt;
    with parent/child relationship. Reverted check for `null` parent&lt;br/&gt;
    application context in `onApplicationEvent()` and added assertions in&lt;br/&gt;
    unit test to verify correct initialization.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/mranest/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/mranest/camel&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/666.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/666.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #666&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 43c9cf1e8e86ef3e37c0fd017dd127a055cb25f4&lt;br/&gt;
Author: Anestis Georgiadis &amp;lt;mranest@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-11-01T09:06:15Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8460&quot; title=&quot;camel-spring-boot - Routes restart during startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8460&quot;&gt;&lt;del&gt;CAMEL-8460&lt;/del&gt;&lt;/a&gt;: Revert simplistic workaround&lt;/p&gt;

&lt;p&gt;    Workaround failed to initialize routes in case of multiple contexts&lt;br/&gt;
    with parent/child relationship. Reverted check for null parent&lt;br/&gt;
    application context in onApplicationEvent() and added assertions in&lt;br/&gt;
    unit test to verify correct initialization.&lt;/p&gt;

&lt;p&gt;commit c55ff829ef21d9ab733afa54e8e3574cc510c7bc&lt;br/&gt;
Author: Anestis Georgiadis &amp;lt;mranest@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-11-01T09:06:58Z&lt;/p&gt;

&lt;p&gt;    Merge remote-tracking branch &apos;upstream/master&apos;&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14987093" author="githubbot" created="Tue, 3 Nov 2015 11:07:30 +0000"  >&lt;p&gt;GitHub user msparer opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/668&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/668&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    adapted the changes of &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8460&quot; title=&quot;camel-spring-boot - Routes restart during startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8460&quot;&gt;&lt;del&gt;CAMEL-8460&lt;/del&gt;&lt;/a&gt; to only refresh routes on ContextRe&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;freshEvents from &quot;own&quot; applicationContext. Previously route refreshs were initiated only if the parent applicationContext of the event&apos;s context was null. This doesn&apos;t work when Spring instantiates the Camel&apos;s application context as child of another applicationContext. This e.g. happens as soon as you&apos;re using spring-cloud-config.&lt;/p&gt;

&lt;p&gt;    This proposed change brings back RouteCollector&apos;s constructor from camel version 2.15.2 and aims to fix both &lt;span class=&quot;error&quot;&gt;&amp;#91;the initial reason for the change&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/spring-cloud/spring-cloud-netflix/issues/438&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/spring-cloud/spring-cloud-netflix/issues/438&lt;/a&gt;) and the &lt;span class=&quot;error&quot;&gt;&amp;#91;bug introduced with the change&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8460&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-8460&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;    Furthermore it should replace &lt;a href=&quot;#666&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;PR#666&lt;/a&gt;(&lt;a href=&quot;https://github.com/apache/camel/pull/666&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/666&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/msparer/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/msparer/camel&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/668.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/668.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #668&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7d56055294e0bfe13acd336945e10249f37b3531&lt;br/&gt;
Author: msparer &amp;lt;msp+git@molindo.at&amp;gt;&lt;br/&gt;
Date:   2015-11-03T11:01:14Z&lt;/p&gt;

&lt;p&gt;    adapted the changes of &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-8460&quot; title=&quot;camel-spring-boot - Routes restart during startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-8460&quot;&gt;&lt;del&gt;CAMEL-8460&lt;/del&gt;&lt;/a&gt; to only refresh routes on ContextRefreshEvents from &quot;own&quot; applicationContext. Previously route refreshs were initiated only if the parent applicationContext of the event&apos;s context was null. This doesn&apos;t work when Spring instantiates the Camel&apos;s application context as child of another applicationContext. This e.g. happens as soon as you&apos;re using spring-cloud-config&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14987153" author="githubbot" created="Tue, 3 Nov 2015 12:00:17 +0000"  >&lt;p&gt;Github user mranest closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/666&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/666&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15000070" author="githubbot" created="Wed, 11 Nov 2015 07:36:06 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/668&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/668&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12781815">CAMEL-8482</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13083151">CAMEL-11476</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26hvj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>