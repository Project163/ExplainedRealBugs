<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:03:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-19968] camel-opentelemetry - The Tracing Strategy is failing when using pollEnrich with seda endpoint</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-19968</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;The Tracing Strategy is failing when using pollEnrich with seda endpoint.&lt;/p&gt;

&lt;p&gt;Here is the reproducer &lt;a href=&quot;https://github.com/RuslanHryn/camel-tracing-issue&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/RuslanHryn/camel-tracing-issue&lt;/a&gt;&lt;br/&gt;
Run RouteTest to reproduce the issue&lt;/p&gt;

&lt;p&gt;This issue is reproducible on both tracing strategies: OpenTracingTracingStrategy&lt;br/&gt;
&#160;and OpenTelemetryTracingStrategy&lt;br/&gt;
For example, we have the following routes:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:firstRoute&quot;&lt;/span&gt;)
        .pollEnrich(&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:secondRoute&quot;&lt;/span&gt;, 0)
        .process(exchange -&amp;gt; {
            &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;        });

from(&lt;span class=&quot;code-quote&quot;&gt;&quot;seda:secondRoute&quot;&lt;/span&gt;)
        .process(exchange -&amp;gt; {
            &lt;span class=&quot;code-comment&quot;&gt;//
&lt;/span&gt;        }); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and we set a tracing strategy&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
ottracer.setTracingStrategy(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OpenTelemetryTracingStrategy(ottracer));
or  
ottracer.setTracingStrategy(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; OpenTracingTracingStrategy(ottracer));&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After sending messages the route will fail with&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.NullPointerException: Cannot invoke &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.camel.opentelemetry.OpenTelemetrySpanAdapter.getOpenTelemetrySpan()&quot;&lt;/span&gt; because &lt;span class=&quot;code-quote&quot;&gt;&quot;spanWrapper&quot;&lt;/span&gt; is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&#160; &#160; at org.apache.camel.opentelemetry.OpenTelemetryTracingStrategy.lambda$wrapProcessorInInterceptors$0(OpenTelemetryTracingStrategy.java:52)
&#160; &#160; at org.apache.camel.support.AsyncProcessorConverterHelper$ProcessorToAsyncProcessorBridge.process(AsyncProcessorConverterHelper.java:66)
&#160; &#160; at org.apache.camel.support.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:104)
&#160; &#160; at org.apache.camel.support.processor.DelegateAsyncProcessor.process(DelegateAsyncProcessor.java:104)
&#160; &#160; at org.apache.camel.processor.errorhandler.RedeliveryErrorHandler$SimpleTask.run(RedeliveryErrorHandler.java:477)
&#160; &#160; at org.apache.camel.impl.engine.DefaultReactiveExecutor$Worker.schedule(DefaultReactiveExecutor.java:181)
&#160; &#160; at org.apache.camel.impl.engine.DefaultReactiveExecutor.scheduleMain(DefaultReactiveExecutor.java:59)
&#160; &#160; at org.apache.camel.processor.Pipeline.process(Pipeline.java:165)
&#160; &#160; at org.apache.camel.impl.engine.CamelInternalProcessor.process(CamelInternalProcessor.java:390)
&#160; &#160; at org.apache.camel.component.direct.DirectProducer.process(DirectProducer.java:96)
&#160; &#160; at org.apache.camel.impl.engine.SharedCamelInternalProcessor.process(SharedCamelInternalProcessor.java:214)
&#160; &#160; at org.apache.camel.impl.engine.SharedCamelInternalProcessor$1.process(SharedCamelInternalProcessor.java:111)
&#160; &#160; at org.apache.camel.impl.engine.DefaultAsyncProcessorAwaitManager.process(DefaultAsyncProcessorAwaitManager.java:83)
&#160; &#160; at org.apache.camel.impl.engine.SharedCamelInternalProcessor.process(SharedCamelInternalProcessor.java:108)
&#160; &#160; at org.apache.camel.support.cache.DefaultProducerCache.send(DefaultProducerCache.java:199)
&#160; &#160; at org.apache.camel.impl.engine.DefaultProducerTemplate.send(DefaultProducerTemplate.java:176)
&#160; &#160; at org.apache.camel.impl.engine.DefaultProducerTemplate.send(DefaultProducerTemplate.java:172)
&#160; &#160; at org.apache.camel.impl.engine.DefaultProducerTemplate.send(DefaultProducerTemplate.java:153)
&#160; &#160; at org.apache.camel.impl.engine.DefaultProducerTemplate.sendBody(DefaultProducerTemplate.java:187) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13553400">CAMEL-19968</key>
            <summary>camel-opentelemetry - The Tracing Strategy is failing when using pollEnrich with seda endpoint</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rhuanrocha">Rhuan Rocha</assignee>
                                    <reporter username="ruslan.hryn25">Ruslan Hryn</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Oct 2023 12:35:25 +0000</created>
                <updated>Mon, 16 Oct 2023 06:28:30 +0000</updated>
                            <resolved>Mon, 16 Oct 2023 06:28:30 +0000</resolved>
                                    <version>3.21.1</version>
                                    <fixVersion>3.21.2</fixVersion>
                    <fixVersion>3.22.0</fixVersion>
                    <fixVersion>4.0.2</fixVersion>
                    <fixVersion>4.2.0</fixVersion>
                                    <component>camel-tracing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17773636" author="davsclaus" created="Tue, 10 Oct 2023 10:19:14 +0000"  >&lt;p&gt;Can you test with 4.0.1 / 4.1.0 also to see if this bug is there too &lt;/p&gt;</comment>
                            <comment id="17773673" author="JIRAUSER301929" created="Tue, 10 Oct 2023 13:16:46 +0000"  >&lt;p&gt;I&apos;ve tested it on 4.0.1 and the bug is there as well. Please fix this bug in 4.x.x as well&lt;/p&gt;</comment>
                            <comment id="17775279" author="JIRAUSER297305" created="Sat, 14 Oct 2023 17:55:27 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ruslan.hryn25&quot; class=&quot;user-hover&quot; rel=&quot;ruslan.hryn25&quot;&gt;ruslan.hryn25&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I&apos;m currently debugging it, and it appears that the calls were initiated before all services had fully started. After introducing a &lt;tt&gt;Thread.sleep(1000)&lt;/tt&gt; delay, the issue no longer occurs.&lt;/p&gt;

&lt;p&gt;I think the code should have the null verification to &lt;a href=&quot;https://github.com/apache/camel/blob/main/components/camel-opentelemetry/src/main/java/org/apache/camel/opentelemetry/OpenTelemetryTracingStrategy.java#L52&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;OpenTelemetryTracingStrategy.java#L52&lt;/a&gt; , as the method can return null to OpenTelemetrySpanAdapter. However, I think we have another problem here, with the services startup.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davsclaus&quot; class=&quot;user-hover&quot; rel=&quot;davsclaus&quot;&gt;davsclaus&lt;/a&gt; does this make sense to you?&lt;/p&gt;</comment>
                            <comment id="17775369" author="JIRAUSER297305" created="Sun, 15 Oct 2023 14:04:41 +0000"  >&lt;p&gt;The OpenTelemetryTracingStrategy works with an AsyncProcessor. Looks like the issue is just the NPE verification, as the OpenTelemetrySpanAdapter will be available after the ActiveSpanManager.activate was executed. I sent a PR to solve this problem. I&apos;ll send it to 4.x.x as well.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 4 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ktpk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>