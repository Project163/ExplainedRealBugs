<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:11:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-8393] Redelivery doesn&apos;t work correctly on Dynamic Routers</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-8393</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;When redelivery occurs for dynamic routers, the properties are being kept. So if the dynamic router uses a property to store the current state such as used in example &lt;a href=&quot;http://camel.apache.org/dynamic-router.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://camel.apache.org/dynamic-router.html&lt;/a&gt; , then the redelivery actually ends up skipping the endpoint that caused the exception&lt;/p&gt;

&lt;p&gt;Here is my dynamic router class&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public class Router {
	public String route(Exchange exchange) {
		Boolean invoked = exchange.getProperty(&quot;invoked&quot;, Boolean.class);
		if (invoked == null) {
			exchange.setProperty(&quot;invoked&quot;, true);
			return &quot;mock:route&quot;;
		} else
			return null;
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is my unit test class&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;@RunWith(CamelSpringJUnit4ClassRunner.class)
@ContextConfiguration(loader = CamelSpringDelegatingTestContextLoader.class)
public class DynamicRouterTest {

	@Produce(uri = &quot;direct:start&quot;)
	private ProducerTemplate producerTemplate;

	@EndpointInject(uri = &quot;mock:end&quot;)
	private MockEndpoint end;

	@EndpointInject(uri = &quot;mock:route&quot;)
	private MockEndpoint route;

	@Configuration
	public static class JavaConfig extends SingleRouteCamelConfiguration {

		@Override
		public RouteBuilder route() {
			return new SpringRouteBuilder() {

				@Override
				public void configure() throws Exception {
					this.getContext().setTracing(true);
					from(&quot;direct:start&quot;).onException(IOException.class).maximumRedeliveries(-1).end()

					.dynamicRouter().method(Router.class).to(&quot;mock:end&quot;);
				}
			};
		}

	}

	@Test
	public void test() throws InterruptedException {
		route.whenAnyExchangeReceived(new Processor() {

			@Override
			public void process(Exchange exchange) throws Exception {
				exchange.getIn().setBody(&quot;mock route&quot;);
			}
		});
		route.expectedBodiesReceived(&quot;before&quot;);
		end.expectedBodiesReceived(&quot;mock route&quot;);

		producerTemplate.sendBody(&quot;before&quot;);
		route.assertIsSatisfied();
		end.assertIsSatisfied();
	}

	@Test
	public void test_exception() throws InterruptedException {
		route.whenExchangeReceived(1, new Processor() {

			@Override
			public void process(Exchange exchange) throws Exception {
				exchange.setException(new IOException());
			}
		});
		route.whenExchangeReceived(2, new Processor() {

			@Override
			public void process(Exchange exchange) throws Exception {
				exchange.getIn().setBody(&quot;mock route&quot;);
			}
		});

                // this bit fails
		route.expectedBodiesReceived(&quot;before&quot;, &quot;before&quot;);

		end.expectedBodiesReceived(&quot;mock route&quot;);
		producerTemplate.sendBody(&quot;before&quot;);
		route.assertIsSatisfied();
		end.assertIsSatisfied();
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The test method runs successfully but the test_exception method which tests the redelivery does not. Fails with &quot;java.lang.AssertionError: mock://route Received message count. Expected: &amp;lt;2&amp;gt; but was: &amp;lt;1&amp;gt;&quot; which shows that the dynamic router only called the mock:route once.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;mac&lt;/p&gt;</environment>
        <key id="12776771">CAMEL-8393</key>
            <summary>Redelivery doesn&apos;t work correctly on Dynamic Routers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="mtran">Minh Tran</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Feb 2015 05:27:55 +0000</created>
                <updated>Wed, 16 Sep 2015 13:04:57 +0000</updated>
                            <resolved>Wed, 16 Sep 2015 13:04:57 +0000</resolved>
                                    <version>2.14.1</version>
                                    <fixVersion>2.16.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14362386" author="davsclaus" created="Sun, 15 Mar 2015 13:44:45 +0000"  >&lt;p&gt;Requires routing slip and dynamic router to include similar outbound error handling that we added to multicast/recipinentlist/splitter.&lt;/p&gt;

&lt;p&gt;This requires a fair amount of work to incorporate in camel-core.&lt;/p&gt;</comment>
                            <comment id="14768902" author="davsclaus" created="Wed, 16 Sep 2015 13:04:57 +0000"  >&lt;p&gt;Thanks for reporting&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12787342">CAMEL-8587</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10063"><![CDATA[Advanced]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 9 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25wvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>