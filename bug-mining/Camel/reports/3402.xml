<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:11:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-9151] Wrong statistics for subroutes</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-9151</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Some statistics seem to be wrong for subroutes.&lt;/p&gt;

&lt;p&gt;MetricsStatistics.onExchangeDone method is called several times for a same exchange: first by the subroute and then by its parent route.&lt;/p&gt;

&lt;p&gt;The problem is that context.stop() is called several times so counters is greater than 1 for the subroute instead of one.&lt;/p&gt;

&lt;p&gt;A solution could be to reset the context into the exchange as soon as the stop method has been called:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;MetricsRoutePolicy.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MetricsStatistics {
        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Timer responses;

        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; MetricsStatistics(Timer responses) {
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.responses = responses;
        }

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void onExchangeBegin(Exchange exchange) {
            Timer.Context context = responses.time();
            exchange.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;MetricsRoutePolicy&quot;&lt;/span&gt;, context);
        }

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void onExchangeDone(Exchange exchange) {
            Timer.Context context = exchange.getProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;MetricsRoutePolicy&quot;&lt;/span&gt;, Timer.Context.class);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (context != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                context.stop();
                &lt;span class=&quot;code-comment&quot;&gt;// BUGFIX: reset to &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; so that context.stop() cannot be called
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// more than once.
&lt;/span&gt;                exchange.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;MetricsRoutePolicy&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);

            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12895368">CAMEL-9151</key>
            <summary>Wrong statistics for subroutes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="vlebreil">Vincent Lebreil</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Sep 2015 08:43:44 +0000</created>
                <updated>Tue, 22 Sep 2015 09:23:26 +0000</updated>
                            <resolved>Tue, 22 Sep 2015 09:23:26 +0000</resolved>
                                    <version>2.15.2</version>
                                    <fixVersion>2.16.0</fixVersion>
                    <fixVersion>2.15.4</fixVersion>
                                    <component>camel-metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14902287" author="davsclaus" created="Tue, 22 Sep 2015 09:23:26 +0000"  >&lt;p&gt;Thanks for reporting. the timers should be per route.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ldyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>