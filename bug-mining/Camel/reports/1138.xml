<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:40:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-3047] JettyHttpComponent.doStop() shuts down all servers in the VM, not just those associated with the component</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-3047</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;We are running several bundles in Karaf with separate Camel contexts, each of which uses the camel-jetty component to expose services over HTTP.  Each bundle has an assigned port and may listen on multiple URIs.  We noticed that when we updated or shut down one of these bundles, all of the Jetty servers in the other bundles would stop listening on their respective ports.&lt;/p&gt;

&lt;p&gt;The problem is that the map of ConnectorRef objects in JettyHttpComponent is static, and therefore shared across the entire VM.  Changing this from static to an instance variable fixed the issue for us.  &lt;/p&gt;</description>
                <environment>&lt;p&gt;Java 1.6.0_20, Karaf 1.6.0, OSX 10.6.4&lt;/p&gt;</environment>
        <key id="12487534">CAMEL-3047</key>
            <summary>JettyHttpComponent.doStop() shuts down all servers in the VM, not just those associated with the component</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="pegli">Paul Mietz Egli</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Aug 2010 22:33:45 +0000</created>
                <updated>Sun, 24 Apr 2011 09:58:02 +0000</updated>
                            <resolved>Thu, 19 Aug 2010 09:43:32 +0000</resolved>
                                    <version>2.4.0</version>
                                    <fixVersion>2.5.0</fixVersion>
                                    <component>camel-jetty</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12945957" author="pegli" created="Wed, 11 Aug 2010 22:35:09 +0000"  >&lt;p&gt;patch against trunk 984599&lt;/p&gt;</comment>
                            <comment id="12946032" author="davsclaus" created="Thu, 12 Aug 2010 06:47:44 +0000"  >&lt;p&gt;I don&apos;t think changing to not static solves the problem.&lt;/p&gt;

&lt;p&gt;What if you want to use the same connector in multiple bundles? eg you want to use port 8080 in bundle A and bundle B.&lt;/p&gt;</comment>
                            <comment id="12945964" author="pegli" created="Thu, 12 Aug 2010 22:00:54 +0000"  >&lt;p&gt;Patch against trunk 984912 which maintains the static connectors map and uses reference counting to determine whether a connector should be shut down completely.&lt;/p&gt;</comment>
                            <comment id="12945979" author="pegli" created="Thu, 12 Aug 2010 22:02:57 +0000"  >&lt;p&gt;Claus, this new patch should address the issue of sharing connectors across different bundles (really, across different CamelContexts in the same VM).  I&apos;m pressed for time right now, but will try to get a unit test that exercises the multiple-context case soon.&lt;/p&gt;</comment>
                            <comment id="12946009" author="davsclaus" created="Fri, 13 Aug 2010 07:59:20 +0000"  >&lt;p&gt;Thanks Paul for the revised path.&lt;/p&gt;

&lt;p&gt;Yeah would be good with an unit test in both camel-jetty and in camel-itest-osgi&lt;/p&gt;</comment>
                            <comment id="12945984" author="davsclaus" created="Fri, 13 Aug 2010 08:00:39 +0000"  >&lt;p&gt;Willem do you mind patching this?&lt;/p&gt;

&lt;p&gt;And if possible create an unit test in osgi which has 2 bundles using jetty. And then stop one of the bundles. And send in a http request to the 2nd bundle to ensure it still runs.&lt;/p&gt;</comment>
                            <comment id="12945864" author="njiang" created="Thu, 19 Aug 2010 09:43:32 +0000"  >&lt;p&gt;Applied the patch with thanks to Paul,  I also fix an issue which could shutdown the server still has one reference.&lt;br/&gt;
I also added an OSGi unit test for it.&lt;/p&gt;</comment>
                            <comment id="12945863" author="davsclaus" created="Thu, 19 Aug 2010 10:23:53 +0000"  >&lt;p&gt;Perfect. Great work both guys.&lt;/p&gt;</comment>
                            <comment id="12957188" author="ialex" created="Wed, 20 Oct 2010 09:44:56 +0000"  >&lt;p&gt;It is a bit irrelevant, since 2.5 is almost out, but i think the patch has a little problem.&lt;/p&gt;

&lt;p&gt;The line : &lt;br/&gt;
if (connectorRef != null &amp;amp;&amp;amp; connectorRef.decrement() == 0)&lt;br/&gt;
should be &lt;br/&gt;
if (connectorRef != null &amp;amp;&amp;amp; connectorRef.refCount == 0)&lt;/p&gt;

&lt;p&gt;Otherwise, it gets decremented twice &lt;del&gt;in disconnect too?&lt;/del&gt;  (in my example i had 2 routes and the problem was still there after a restart of one of them).&lt;br/&gt;
In 2.5 it is ok though, just the attached patch has this code.&lt;/p&gt;</comment>
                            <comment id="12957190" author="njiang" created="Wed, 20 Oct 2010 11:49:11 +0000"  >&lt;p&gt;@Ioannis,&lt;br/&gt;
Yes, the patch has a defect, and I already fixed it before committed the patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
You can check the change here &lt;a href=&quot;https://issues.apache.org/activemq/browse/CAMEL-3047?page=com.atlassian.jira.plugin.ext.subversion%3Asubversion-commits-tabpanel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/activemq/browse/CAMEL-3047?page=com.atlassian.jira.plugin.ext.subversion%3Asubversion-commits-tabpanel&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13024032" author="davsclaus" created="Sun, 24 Apr 2011 09:58:02 +0000"  >&lt;p&gt;Closing all resolved tickets from 2010 or older&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12463326" name="CAMEL-3047-refcount.patch" size="2098" author="pegli" created="Thu, 12 Aug 2010 22:00:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76363</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 31 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01sbz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8359</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>