<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 11:02:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-19837] Converters - unpredictable behavior linked to type hierarchy (flatpack)</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-19837</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Consequence of &lt;a href=&quot;https://github.com/apache/camel/pull/11225/commits/e4007f2b1dfc982e5ea6a45427cbec8835ea58a5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/11225/commits/e4007f2b1dfc982e5ea6a45427cbec8835ea58a5&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Camel-flatpack registers 2 converters:&#160;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;from net.sf.flatpack.DataSet to Map&lt;/li&gt;
	&lt;li&gt;from net.sf.flatpack.Record to Map&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Problematic case: If data for conversion is instance of net.sf.flatpack.DefaultDataSet&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Direct conversion is not possible (there is no DefaultDataSet -&amp;gt; Map converter)&lt;/p&gt;

&lt;p&gt;therefore matching via interface is used (see &lt;a href=&quot;https://github.com/apache/camel/blob/main/core/camel-api/src/main/java/org/apache/camel/converter/TypeConvertible.java#L101-L110)&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/blob/main/core/camel-api/src/main/java/org/apache/camel/converter/TypeConvertible.java#L101-L110)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Problem is that `DefaultDataSet` implements `DataSet`, which extends `Record`.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Therefore based on the order of converters in the cache (map), &quot;random&quot; converter is selected and used. Unfortunately one of these selection might cause a problem.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I was trying to run test `fixedHeaderAndTrailerShouldSucceed` in camel-quarkus from branch `camel-main`. &#160;&lt;a href=&quot;https://github.com/apache/camel-quarkus/blob/camel-main/integration-tests/flatpack/src/test/java/org/apache/camel/quarkus/component/flatpack/it/FlatpackTest.java#L133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;code&lt;/a&gt;&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;In case that converter `DataSet` -&amp;gt; `Map` is selected, the test &lt;b&gt;succeeds&lt;/b&gt;.&lt;/li&gt;
	&lt;li&gt;If `Record` -&amp;gt; `Map` is selected, test &lt;b&gt;fails&lt;/b&gt;.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;d suggest to add a logic, which takes into consideration the fact, that some of the matched interfaces are more general and some are more specific (in this case, `DataSet` conversion should have higher priority).&lt;/p&gt;

&lt;p&gt;There might be other approaches, but ^^ this one makes sense and should be implementable (I&apos;m not sure about possible performance affect)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;(another way might be defining order of the converters, `DataSet` is always tried before `Record` in Flatpack, performance should be better)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13549683">CAMEL-19837</key>
            <summary>Converters - unpredictable behavior linked to type hierarchy (flatpack)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="orpiske">Otavio Rodolfo Piske</assignee>
                                    <reporter username="jondruse">Jiri Ondrusek</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Sep 2023 14:39:25 +0000</created>
                <updated>Thu, 4 Apr 2024 13:00:09 +0000</updated>
                            <resolved>Wed, 6 Sep 2023 09:25:26 +0000</resolved>
                                    <version>4.x</version>
                                    <fixVersion>4.1.0</fixVersion>
                                    <component>came-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17762121" author="jondruse" created="Tue, 5 Sep 2023 14:40:07 +0000"  >&lt;p&gt;FYI&#160; ^ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=orpiske&quot; class=&quot;user-hover&quot; rel=&quot;orpiske&quot;&gt;orpiske&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17762130" author="orpiske" created="Tue, 5 Sep 2023 15:09:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jondruse&quot; class=&quot;user-hover&quot; rel=&quot;jondruse&quot;&gt;jondruse&lt;/a&gt; what test is this one? &lt;/p&gt;</comment>
                            <comment id="17762286" author="jondruse" created="Wed, 6 Sep 2023 06:21:48 +0000"  >&lt;p&gt;This test: &lt;a href=&quot;https://github.com/apache/camel-quarkus/blob/camel-main/integration-tests/flatpack/src/test/java/org/apache/camel/quarkus/component/flatpack/it/FlatpackTest.java#L135-L161&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel-quarkus/blob/camel-main/integration-tests/flatpack/src/test/java/org/apache/camel/quarkus/component/flatpack/it/FlatpackTest.java#L135-L161&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17762325" author="orpiske" created="Wed, 6 Sep 2023 09:25:26 +0000"  >&lt;p&gt;Should have been resolved with: &lt;a href=&quot;https://github.com/apache/camel/pull/11305&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/11305&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1k6sw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>