<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:42:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-3572] Camel transport for cxf does not forward exception to camel exchange</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-3572</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;I encountered a problem that happens if you run a route like&lt;br/&gt;
from(&quot;servlet:///test&quot;).to(&quot;direct:cxfendpoint&quot;)&lt;/p&gt;

&lt;p&gt;Behind the direct endpoint there is a cxf jax-rs endpoint that is secured by spring-security. If spring security denies access based on method annotations it throws an AccessDeniedException. As JAX-RS does not handle it the exception hits the CamelDestination. There it is only logged and swallowed. As the client then gets no error it tries to handle the reponse with jaxb which fails. (See below)&lt;/p&gt;

&lt;p&gt;21.01.2011 11:19:51 org.apache.cxf.jaxrs.provider.AbstractJAXBProvider handleJAXBException&lt;br/&gt;
WARNUNG: javax.xml.bind.UnmarshalException&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;with linked exception:&lt;br/&gt;
[com.ctc.wstx.exc.WstxEOFException: Unexpected EOF in prolog&lt;br/&gt;
 at [row,col 
{unknown-source}]: &lt;span class=&quot;error&quot;&gt;&amp;#91;1,0&amp;#93;&lt;/span&gt;]&lt;br/&gt;
	at com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.handleStreamException(UnmarshallerImpl.java:426)&lt;br/&gt;
	at com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.unmarshal0(UnmarshallerImpl.java:362)&lt;br/&gt;
	at com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.unmarshal(UnmarshallerImpl.java:332)&lt;br/&gt;
	at org.apache.cxf.jaxrs.provider.JAXBElementProvider.unmarshalFromInputStream(JAXBElementProvider.java:229)&lt;br/&gt;
	at org.apache.cxf.jaxrs.provider.JAXBElementProvider.doUnmarshal(JAXBElementProvider.java:195)&lt;br/&gt;
	at org.apache.cxf.jaxrs.provider.JAXBElementProvider.readFrom(JAXBElementProvider.java:166)&lt;br/&gt;
	at org.apache.cxf.jaxrs.client.AbstractClient.readBody(AbstractClient.java:445)&lt;br/&gt;
	at org.apache.cxf.jaxrs.client.ClientProxyImpl.handleResponse(ClientProxyImpl.java:463)&lt;br/&gt;
	at org.apache.cxf.jaxrs.client.ClientProxyImpl.doChainedInvocation(ClientProxyImpl.java:445)&lt;br/&gt;
	at org.apache.cxf.jaxrs.client.ClientProxyImpl.invoke(ClientProxyImpl.java:177)&lt;br/&gt;
	at $Proxy18.getUsers(Unknown Source)&lt;br/&gt;
	at client.RESTClient.sayHelloAsUser(RESTClient.java:63)&lt;br/&gt;
	at client.RESTClient.main(RESTClient.java:34)&lt;br/&gt;
Caused by: com.ctc.wstx.exc.WstxEOFException: Unexpected EOF in prolog&lt;br/&gt;
 at [row,col {unknown-source}
&lt;p&gt;]: &lt;span class=&quot;error&quot;&gt;&amp;#91;1,0&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at com.ctc.wstx.sr.StreamScanner.throwUnexpectedEOF(StreamScanner.java:682)&lt;br/&gt;
	at com.ctc.wstx.sr.BasicStreamReader.handleEOF(BasicStreamReader.java:2090)&lt;br/&gt;
	at com.ctc.wstx.sr.BasicStreamReader.nextFromProlog(BasicStreamReader.java:1996)&lt;br/&gt;
	at com.ctc.wstx.sr.BasicStreamReader.next(BasicStreamReader.java:1100)&lt;br/&gt;
	at com.sun.xml.bind.v2.runtime.unmarshaller.StAXStreamConnector.bridge(StAXStreamConnector.java:160)&lt;br/&gt;
	at com.sun.xml.bind.v2.runtime.unmarshaller.UnmarshallerImpl.unmarshal0(UnmarshallerImpl.java:360)&lt;br/&gt;
	... 11 more&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12496255">CAMEL-3572</key>
            <summary>Camel transport for cxf does not forward exception to camel exchange</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cschneider">Christian Schneider</assignee>
                                    <reporter username="cschneider">Christian Schneider</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Jan 2011 10:41:03 +0000</created>
                <updated>Tue, 25 Oct 2011 11:35:37 +0000</updated>
                            <resolved>Fri, 21 Jan 2011 11:09:42 +0000</resolved>
                                                    <fixVersion>2.6.0</fixVersion>
                                    <component>camel-cxf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12984673" author="chris@die-schneider.net" created="Fri, 21 Jan 2011 10:44:54 +0000"  >&lt;p&gt;I have tracked the problem to:&lt;/p&gt;

&lt;p&gt;public class CamelDestination extends AbstractDestination implements Configurable {&lt;br/&gt;
protected class ConsumerProcessor implements Processor {&lt;br/&gt;
        public void process(Exchange exchange) {&lt;br/&gt;
            try &lt;/p&gt;
{
                incoming(exchange);
            }
&lt;p&gt; catch (Throwable ex) &lt;/p&gt;
{
                getLogger().log(Level.WARNING, &quot;Failed to process incoming message: &quot;, ex);
                
            }
&lt;p&gt;        }&lt;br/&gt;
    }&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;By exchanging the logging with&lt;br/&gt;
exchange.setException(ex);&lt;/p&gt;

&lt;p&gt;The processing error is correctly transmitted to the client and the exception on client side does not happen anymore.&lt;/p&gt;</comment>
                            <comment id="12984686" author="chris@die-schneider.net" created="Fri, 21 Jan 2011 11:09:42 +0000"  >&lt;p&gt;Committed the fix. As we are near the release date please review&lt;/p&gt;</comment>
                            <comment id="12984709" author="njiang" created="Fri, 21 Jan 2011 12:19:08 +0000"  >&lt;p&gt;@Christian&lt;br/&gt;
Can I have a look at the configure of the a cxf jax-rs endpoint ?&lt;br/&gt;
Here is an unit test&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; which works with old CamelDestination,  I&apos;m not sure how the &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;incoming(exchange)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; throw the exception.&lt;/p&gt;

&lt;p&gt;As the below code will take care or the exception which is thrown from ServiceImplementor.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;incomingObserver.onMessage(inMessage);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;https://svn.apache.org/repos/asf/camel/trunk/examples/camel-example-cxf/src/test/java/org/apache/camel/example/camel/transport/CamelTransportClientServerTest.java&lt;/p&gt;</comment>
                            <comment id="12984715" author="chris@die-schneider.net" created="Fri, 21 Jan 2011 12:29:15 +0000"  >&lt;p&gt;The jaxrs server is configured like below. The exception is thrown by Spring Security when it intercepts the call the the implementation method&lt;/p&gt;

&lt;p&gt;     &amp;lt;global-method-security jsr250-annotations=&quot;enabled&quot; xmlns=&quot;http://www.springframework.org/schema/security&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;     &amp;lt;jaxrs:server id=&quot;hello_rest&quot; address=&quot;camel://direct:HelloWorldRestServerEndpoint&quot;&amp;gt;&lt;br/&gt;
       &amp;lt;jaxrs:serviceBeans&amp;gt;&lt;br/&gt;
         &amp;lt;ref bean=&quot;hello-world-bean&quot;/&amp;gt;&lt;br/&gt;
       &amp;lt;/jaxrs:serviceBeans&amp;gt;&lt;br/&gt;
       &amp;lt;jaxrs:features&amp;gt;&lt;br/&gt;
         &amp;lt;bean class=&quot;org.apache.cxf.feature.LoggingFeature&quot; /&amp;gt;&lt;br/&gt;
       &amp;lt;/jaxrs:features&amp;gt;&lt;br/&gt;
     &amp;lt;/jaxrs:server&amp;gt;&lt;/p&gt;

&lt;p&gt;     &amp;lt;bean id=&quot;hello-world-bean&quot; class=&quot;server.HelloWorldImpl&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;The impl class has this method:&lt;br/&gt;
@RolesAllowed(&quot;ROLE_ADMIN&quot;)&lt;br/&gt;
    public Map&amp;lt;Integer, User&amp;gt; getUsers()&lt;/p&gt;

&lt;p&gt;Sergey already told me that I should use an interceptor to handle the exception from spring security and translate it. Still I think we should handle any exceptions in the CamelDestination that slip thorugh.&lt;/p&gt;</comment>
                            <comment id="12984729" author="njiang" created="Fri, 21 Jan 2011 13:07:49 +0000"  >&lt;p&gt;@Christian,&lt;br/&gt;
If we just throw the exception into camel route,  you need to take care the marshal the exception into the stream as not all the camel component support it out of box.&lt;/p&gt;
</comment>
                            <comment id="12984730" author="njiang" created="Fri, 21 Jan 2011 13:08:39 +0000"  >&lt;p&gt;BTW, I think this change should be OK.&lt;/p&gt;</comment>
                            <comment id="12984734" author="chris@die-schneider.net" created="Fri, 21 Jan 2011 13:28:43 +0000"  >&lt;p&gt;Yes. You are right about the marshalling but it is not so important as the exception in this place is rather a last resort. Normally the exceptions should be handled by cxf interceptors.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>76223</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 44 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01vkf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8883</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>