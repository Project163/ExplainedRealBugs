<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:35:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-13587] InflightRepository, InflightEntry getElapsed is 0</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-13587</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I made a camel-route&#160;that checks about inflight messages on other server through JMX connection.&lt;br/&gt;
It was working fine in 2.17.x but now we upgrade to 2.22.1 and I always obtain a result of 0 millisecond for the elapsed field.&lt;/p&gt;

&lt;p&gt;I use the browse() operation of JMX bean. You can use jconsole to run a simple test.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12969922/12969922_image-2019-05-27-17-04-12-319.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;This is a major bug for us, since we use the code to monitoring production&#160;routes. Is there any workaround like get the echange historymessage from the exchage id?&lt;/p&gt;

&lt;p&gt;Thank you&lt;/p&gt;</description>
                <environment>&lt;p&gt;Camel 2.22.1&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</environment>
        <key id="13235838">CAMEL-13587</key>
            <summary>InflightRepository, InflightEntry getElapsed is 0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="jkike">Barbara De Vido</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 May 2019 15:07:08 +0000</created>
                <updated>Tue, 28 May 2019 13:09:14 +0000</updated>
                            <resolved>Tue, 28 May 2019 13:09:14 +0000</resolved>
                                    <version>2.22.1</version>
                                    <fixVersion>3.0.0-M3</fixVersion>
                    <fixVersion>2.23.3</fixVersion>
                    <fixVersion>2.22.5</fixVersion>
                    <fixVersion>2.24.1</fixVersion>
                    <fixVersion>3.0.0</fixVersion>
                    <fixVersion>2.25.0</fixVersion>
                                    <component>came-core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16849013" author="davsclaus" created="Mon, 27 May 2019 15:14:28 +0000"  >&lt;p&gt;You need to turn on message history&lt;br/&gt;
context.setMessageHistory(true);&lt;/p&gt;
</comment>
                            <comment id="16849390" author="jkike" created="Tue, 28 May 2019 06:53:48 +0000"  >&lt;p&gt;hi claus, &lt;br/&gt;
it is set to true. &lt;/p&gt;

&lt;p&gt;the elapsed is not computed on current node since no one invoke the method nodeProcessingDone. &lt;/p&gt;

&lt;p&gt;Please consider to reopen the issue. &lt;/p&gt;</comment>
                            <comment id="16849601" author="jkike" created="Tue, 28 May 2019 11:03:01 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I did this as workaround.&lt;/p&gt;

&lt;p&gt;Implemented a custom infligth repository, that has the same logic of the DefaultInflightRepository and then in the new inner class (the original cannot be extended/overriden) InflightExchangeEntry I modified the code for getElapsed() as follow&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 @Override
        @SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;)
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; getElapsed() {
            LinkedList&amp;lt;MessageHistory&amp;gt; list = exchange.getProperty(Exchange.MESSAGE_HISTORY, LinkedList.class);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (list == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || list.isEmpty()) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 0;
            }

            &lt;span class=&quot;code-comment&quot;&gt;// get latest entry
&lt;/span&gt;            MessageHistory history = list.getLast();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (history != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis() - history.getTime();  &lt;span class=&quot;code-comment&quot;&gt;// MY FIX!!!!!
&lt;/span&gt;            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 0;
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


</comment>
                            <comment id="16849650" author="davsclaus" created="Tue, 28 May 2019 12:07:13 +0000"  >&lt;p&gt;Thanks for the suggested fix. I updated it a little bit in this commit&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/camel/commit/02b2f265a57b757155757fc330c1d7108574bcfa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/commit/02b2f265a57b757155757fc330c1d7108574bcfa&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I wonder if you could do a PR for the camel-2.x branch based on this so we can backport the fix. This needs manual work as master and camel-2.x has drifted part.&lt;/p&gt;</comment>
                            <comment id="16849671" author="jkike" created="Tue, 28 May 2019 12:32:51 +0000"  >&lt;p&gt;I did the PR.&lt;br/&gt;
Hope I did it right.&lt;/p&gt;

&lt;p&gt;Thank you&lt;br/&gt;
Barbara&lt;/p&gt;</comment>
                            <comment id="16849702" author="davsclaus" created="Tue, 28 May 2019 13:09:14 +0000"  >&lt;p&gt;Thanks that was correct PR&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12969922" name="image-2019-05-27-17-04-12-319.png" size="90242" author="jkike" created="Mon, 27 May 2019 15:04:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 25 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z034bk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>