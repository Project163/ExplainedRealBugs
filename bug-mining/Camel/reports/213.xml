<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 09:26:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-655] Jython Expressions always return null/false</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-655</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;A Jython expression used for example like this always returns null, which is now translated to false:&lt;/p&gt;

&lt;p&gt;from(&quot;...&quot;).choice().when().jython(&quot;some expression&quot;).to(...)&lt;/p&gt;

&lt;p&gt;For example, here&apos;s an expression that always evaluates to null/false:&lt;/p&gt;

&lt;p&gt;request.headers&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;foo&amp;#39;&amp;#93;&lt;/span&gt; == &apos;bar&apos;&lt;/p&gt;

&lt;p&gt;To see this, look at the test PythonExpressionTest in the camel-script module.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Jython 2.2.1, camel-script 1.3.0/1.4.0-SNAPSHOT, jython integration lib from java.net or logicblaze.com repo&lt;/p&gt;</environment>
        <key id="12485069">CAMEL-655</key>
            <summary>Jython Expressions always return null/false</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                            <parent id="12485300">CAMEL-458</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="njiang">Willem Jiang</assignee>
                                    <reporter username="ammulder">Aaron Mulder</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Jul 2008 20:03:50 +0000</created>
                <updated>Wed, 23 Jul 2008 03:57:31 +0000</updated>
                            <resolved>Thu, 10 Jul 2008 04:49:47 +0000</resolved>
                                    <version>1.3.0</version>
                    <version>1.4.0</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>camel-script</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12947755" author="ammulder" created="Tue, 1 Jul 2008 20:04:39 +0000"  >&lt;p&gt;I asked a Jython guy and here&apos;s what I got:&lt;/p&gt;

&lt;p&gt;---------&lt;/p&gt;

&lt;p&gt;The Python syntax is correct, but the Jython script engine does not return the value of the expression from engine.eval.  I think you need to put the value into the context.  This is how it used to work pre-JSR, and a quick test show this still works.  &lt;/p&gt;

&lt;p&gt;In the following quick and dirty example, the output is always null, but the result.flag is getting set correctly.&lt;/p&gt;

&lt;p&gt;---------&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.FileReader;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.Reader;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.HashMap;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.Map;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.script.ScriptEngine;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.script.ScriptException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.script.ScriptEngineFactory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.script.ScriptEngineManager;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ScriptEval {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ScriptEngineManager manager = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ScriptEngineManager();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ScriptEngine engine = manager.getEngineByName(&lt;span class=&quot;code-quote&quot;&gt;&quot;jython&quot;&lt;/span&gt;);

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; MyRequest request = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyRequest(args[0]);
        engine.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;request&quot;&lt;/span&gt;, request);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; EvalResult result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; EvalResult();
        engine.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;result&quot;&lt;/span&gt;, result);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Reader script = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileReader(args[1]);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;Output: %s\n&quot;&lt;/span&gt;, engine.eval(script));
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;Result value: %s\n&quot;&lt;/span&gt;, result.getFlag());
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyRequest {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; headers;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; MyRequest(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value) {
        headers = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
        headers.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;console&quot;&lt;/span&gt;, value);
        headers.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;other_key&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;other_value&quot;&lt;/span&gt;);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; getHeaders() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; headers;
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;EvalResult {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; flag;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setFlag(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; flag) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.flag = flag;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; getFlag() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; flag;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12947678" author="ammulder" created="Tue, 1 Jul 2008 20:23:37 +0000"  >&lt;p&gt;A follow-up from Dave, my Jython guy.  We&apos;d obviously need to massage this a bit if we were going to go this way, but it&apos;s an option.&lt;/p&gt;

&lt;p&gt;-----------&lt;/p&gt;

&lt;p&gt;It figures that I found Invocable right after I sent that out.  This works:&lt;/p&gt;

&lt;p&gt;args&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; should be the value you want for request.headers&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;foo&amp;#39;&amp;#93;&lt;/span&gt;&lt;br/&gt;
args&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; should be the name of the script file&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;JyScript.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.*;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.*;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.script.*;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;JyScript {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ScriptEngineManager manager = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ScriptEngineManager();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ScriptEngine engine = manager.getEngineByName(&lt;span class=&quot;code-quote&quot;&gt;&quot;jython&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; MyRequest request = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyRequest(args[0]);
        engine.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;request&quot;&lt;/span&gt;, request);
        engine.eval(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedReader(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileReader(args[1])));
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Invocable invocable = (Invocable) engine;
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; result = invocable.invokeFunction(&lt;span class=&quot;code-quote&quot;&gt;&quot;is_console_header_value&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;Result is: %s&quot;&lt;/span&gt;, result);
    }
}

&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MyRequest {
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; headers;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; MyRequest(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value) {
        headers = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
        headers.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;, value);
        headers.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;other_key&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;other_value&quot;&lt;/span&gt;);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; getHeaders() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; headers;
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;my_func.py&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;def is_console_header_value(val):
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; request.headers[&lt;span class=&quot;code-quote&quot;&gt;&apos;foo&apos;&lt;/span&gt;] == val
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12947700" author="njiang" created="Thu, 3 Jul 2008 08:39:45 +0000"  >&lt;p&gt;Jython engin.eval(&quot;print a&quot;) always return null,&lt;br/&gt;
I got a way to walk around it by set the result value to result variable.&lt;/p&gt;

&lt;p&gt;Please check the latest camel svn trunk for more information.&lt;/p&gt;
</comment>
                            <comment id="12947797" author="davsclaus" created="Thu, 3 Jul 2008 08:48:00 +0000"  >&lt;p&gt;Willem, please add code comments that you do this deliberately for the phyton, jython engines - with the result stuff.&lt;/p&gt;

&lt;p&gt;And a small cosmetic issue. Please uppercase the first letter when outputting to debugger.&lt;/p&gt;</comment>
                            <comment id="12947758" author="davsclaus" created="Thu, 3 Jul 2008 08:48:41 +0000"  >&lt;p&gt;And Willem, there is another jira ticket for script unit test is not running - you have fixed this now - great. You can close that ticket.&lt;/p&gt;</comment>
                            <comment id="12947917" author="dcoleman" created="Tue, 8 Jul 2008 06:06:34 +0000"  >&lt;p&gt;The Jython JSR-223 engine defaults to compiling code in &quot;exec&quot; mode.&lt;br/&gt;
Changing this to &quot;eval&quot; mode allows Py.runCode() to return results to engine.eval()&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isPython()) {
    ScriptContext context = engine.getContext();
    context.setAttribute(&lt;span class=&quot;code-quote&quot;&gt;&quot;com.sun.script.jython.comp.mode&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;eval&quot;&lt;/span&gt;, ScriptContext.ENGINE_SCOPE);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-655&quot; title=&quot;Jython Expressions always return null/false&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-655&quot;&gt;&lt;del&gt;CAMEL-655&lt;/del&gt;&lt;/a&gt;.patch.txt fixes ScriptBuilder.java and the unit tests&lt;/p&gt;</comment>
                            <comment id="12947885" author="njiang" created="Tue, 8 Jul 2008 06:38:32 +0000"  >&lt;p&gt;cool, I will take care of this patch.&lt;/p&gt;</comment>
                            <comment id="12947937" author="hadrian" created="Thu, 10 Jul 2008 04:25:32 +0000"  >&lt;p&gt;Not critical for the 1.4 release, I suppose.&lt;/p&gt;</comment>
                            <comment id="12947823" author="njiang" created="Thu, 10 Jul 2008 04:49:20 +0000"  >&lt;p&gt;I think the patch resolved that issue, and I also committed it into the trunk.&lt;br/&gt;
Now it is a port of camel 1.4 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12947955" author="njiang" created="Thu, 10 Jul 2008 04:49:47 +0000"  >&lt;p&gt;The patch is in the trunk now.&lt;/p&gt;</comment>
                            <comment id="12948053" author="davsclaus" created="Wed, 23 Jul 2008 03:57:31 +0000"  >&lt;p&gt;Closing 1.4 issues.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12462551" name="CAMEL-655.patch.txt" size="4820" author="dcoleman" created="Tue, 8 Jul 2008 06:06:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>83180</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01dkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5969</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10092"><![CDATA[Unit Test Broken]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>