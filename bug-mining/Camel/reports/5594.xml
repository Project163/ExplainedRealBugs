<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:45:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-16083] OnCompletion with After Consumer mode does not fire if defined in routeScope</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-16083</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;After upgrading from Camel 3.7.0 to 3.7.1 we noticed a regression where routes that had onCompletion defined in the route scope no longer fired.&#160; EX&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:start&quot;&lt;/span&gt;)
        .transform(constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;))
        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:a&quot;&lt;/span&gt;)
        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:sub&quot;&lt;/span&gt;)
        .transform(constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;))
        .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:c&quot;&lt;/span&gt;);
 
    from(&lt;span class=&quot;code-quote&quot;&gt;&quot;direct:sub&quot;&lt;/span&gt;)
         .transform(constant(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;))
         .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:b&quot;&lt;/span&gt;)
         .onCompletion()
	     .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;mock:end&quot;&lt;/span&gt;)
	 .end(); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In following the change made in &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-13553&quot; title=&quot;OnCompletion behaves strange in combination with direct subroutes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-13553&quot;&gt;&lt;del&gt;CAMEL-13553&lt;/del&gt;&lt;/a&gt; the onCompletion does not fire since the routeId of the direct:sub route where the onCompletion is scoped does not match the route id of direct:start where the onCompletion fires.&#160;&lt;/p&gt;

&lt;p&gt;This works fine if I move the onCompletion defintion into direct:start.&lt;/p&gt;

&lt;p&gt;While on one hand this breaks our existing code it also makes me think it might just be a bad practice to define an AfterConsumerOnCompletion in a sub route.&#160; So perhaps this should not be supported? If it should be supported I think we&apos;ll need to evaluate the routeId compare in the after route so that we do the compare in the same scope as the definition.&#160; Open to other suggestions.&#160; Will provide a PR with a potential approach to the supported use case.&#160;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Java 11&lt;/p&gt;

&lt;p&gt;Apache Karaf&lt;/p&gt;</environment>
        <key id="13354762">CAMEL-16083</key>
            <summary>OnCompletion with After Consumer mode does not fire if defined in routeScope</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="bob">Bob Paulin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Jan 2021 21:12:43 +0000</created>
                <updated>Fri, 5 Feb 2021 10:09:38 +0000</updated>
                            <resolved>Thu, 4 Feb 2021 08:56:56 +0000</resolved>
                                    <version>3.7.1</version>
                                    <fixVersion>3.7.2</fixVersion>
                    <fixVersion>3.8.0</fixVersion>
                                    <component>camel-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="17272468" author="bob" created="Tue, 26 Jan 2021 22:25:31 +0000"  >&lt;p&gt;The attached PR is one approach that could address this.&#160; I think adding the array list may be a bit heavy but I&apos;m unsure if there&apos;s a better way to track multiple routeScope onCompletions.&#160; Happy to discuss other options!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10060"><![CDATA[Unknown]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0n0m0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>