<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 10:26:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CAMEL-12016] Invalid Pool Exhausted error on camel-netty4</title>
                <link>https://issues.apache.org/jira/browse/CAMEL-12016</link>
                <project id="12311211" key="CAMEL">Camel</project>
                    <description>&lt;p&gt;Hey guys,&lt;/p&gt;

&lt;p&gt;Since camel 2.17.4, our application who made some &quot;ping request&quot; brings a &quot;Pool exhausted&quot; error after 100 trying.&lt;/p&gt;

&lt;p&gt;After analysis, since 2.17.4, when camel-netty4 try to connect to a down host, the connection (ChannelFuture) stay in the pool.&lt;/p&gt;

&lt;p&gt;Here is the code to show you :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.CamelContext;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.Exchange;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.builder.RouteBuilder;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.camel.impl.DefaultCamelContext;
 
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.NoSuchElementException;
 
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;main {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; args[]) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        CamelContext context = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultCamelContext();
        context.addRoutes(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RouteBuilder() {
            &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void configure() {
                onException(NoSuchElementException.class).process(exchange -&amp;gt; {
                    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(exchange.getProperty(Exchange.EXCEPTION_CAUGHT, Exception.class));
                });
 
                from(&lt;span class=&quot;code-quote&quot;&gt;&quot;timer:&lt;span class=&quot;code-comment&quot;&gt;//myTimer?period=2000&quot;&lt;/span&gt;).
&lt;/span&gt;                    setBody()
                        .simple(&lt;span class=&quot;code-quote&quot;&gt;&quot;Trying to connect to localhost:12345&quot;&lt;/span&gt;)
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;stream:out&quot;&lt;/span&gt;)
                    .to(&lt;span class=&quot;code-quote&quot;&gt;&quot;netty4:tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:12345?producerPoolMaxActive=4&quot;&lt;/span&gt;);
&lt;/span&gt;            }
        });
        context.start();
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(8000000);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The producerPoolMaxActive is set to 4 to bring the error faster.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;The output in 2.17.3 just bellow (all work perfectly)&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;_Trying to connect to localhost:12345&lt;br/&gt;
Trying to connect to localhost:12345&lt;br/&gt;
Trying to connect to localhost:12345&lt;br/&gt;
Trying to connect to localhost:12345&lt;br/&gt;
Trying to connect to localhost:12345&lt;br/&gt;
...._&lt;/p&gt;

&lt;p&gt;*But in version &amp;gt; 2.17.3, we&apos;ve got this : *&lt;/p&gt;

&lt;p&gt;_Trying to connect to localhost:12345&lt;br/&gt;
Trying to connect to localhost:12345&lt;br/&gt;
Trying to connect to localhost:12345&lt;br/&gt;
Trying to connect to localhost:12345&lt;br/&gt;
Trying to connect to localhost:12345&lt;br/&gt;
java.util.NoSuchElementException: Pool exhausted&lt;br/&gt;
Trying to connect to localhost:12345&lt;br/&gt;
java.util.NoSuchElementException: Pool exhausted&lt;br/&gt;
Trying to connect to localhost:12345&lt;br/&gt;
java.util.NoSuchElementException: Pool exhausted&lt;br/&gt;
Trying to connect to localhost:12345&lt;br/&gt;
java.util.NoSuchElementException: Pool exhausted&lt;br/&gt;
_&lt;/p&gt;

&lt;p&gt;I&apos;ve made a pull request to fix it.&lt;/p&gt;

&lt;p&gt;Thanks for your help !&lt;/p&gt;</description>
                <environment>&lt;p&gt;Same behaviour on : Linux, Windows 7, AIX&lt;br/&gt;
Using Intelli-J&lt;/p&gt;</environment>
        <key id="13119605">CAMEL-12016</key>
            <summary>Invalid Pool Exhausted error on camel-netty4</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="acosentino">Andrea Cosentino</assignee>
                                    <reporter username="dvor4x">dvor4x</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Nov 2017 10:12:32 +0000</created>
                <updated>Mon, 20 Nov 2017 12:07:16 +0000</updated>
                            <resolved>Mon, 20 Nov 2017 12:06:48 +0000</resolved>
                                    <version>2.17.4</version>
                    <version>2.18.0</version>
                    <version>2.19.0</version>
                    <version>2.20.0</version>
                    <version>2.20.1</version>
                                    <fixVersion>2.19.5</fixVersion>
                    <fixVersion>2.20.2</fixVersion>
                    <fixVersion>2.21.0</fixVersion>
                    <fixVersion>2.18.6</fixVersion>
                                    <component>camel-netty4</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16259052" author="githubbot" created="Mon, 20 Nov 2017 10:18:27 +0000"  >&lt;p&gt;dvor4x opened a new pull request #2101: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12016&quot; title=&quot;Invalid Pool Exhausted error on camel-netty4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12016&quot;&gt;&lt;del&gt;CAMEL-12016&lt;/del&gt;&lt;/a&gt; : ChannelFuture is not clearly erased from the pool on connection error&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2101&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2101&lt;/a&gt;&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;Since 2.17.4, ChannelFuture was never release when a connection error occurs.&lt;br/&gt;
   &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12016&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-12016&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16259053" author="githubbot" created="Mon, 20 Nov 2017 10:18:28 +0000"  >&lt;p&gt;GitHub user dvor4x opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2101&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2101&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12016&quot; title=&quot;Invalid Pool Exhausted error on camel-netty4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12016&quot;&gt;&lt;del&gt;CAMEL-12016&lt;/del&gt;&lt;/a&gt; : ChannelFuture is not clearly erased from the pool on connection error&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Since 2.17.4, ChannelFuture was never release when a connection error occurs.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12016&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CAMEL-12016&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dvor4x/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dvor4x/camel&lt;/a&gt; bugfix/camelNetty4ReleaseChannelFutureOnConnectionError&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2101.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2101.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #2101&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 436cd46724b94406b0c83a2678b06577eced1b50&lt;br/&gt;
Author: dvor4x &amp;lt;dvor4x@hackerzvoice.net&amp;gt;&lt;br/&gt;
Date:   2017-11-18T13:54:54Z&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Since 2.16.3, ChannelFuture was never release when a connection error occurs. The fact is, pool.borrowObject(); (L224) didn&apos;t throw connection exception anymore.&lt;/li&gt;
&lt;/ul&gt;


&lt;hr /&gt;</comment>
                            <comment id="16259150" author="githubbot" created="Mon, 20 Nov 2017 11:57:18 +0000"  >&lt;p&gt;oscerd closed pull request #2101: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12016&quot; title=&quot;Invalid Pool Exhausted error on camel-netty4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12016&quot;&gt;&lt;del&gt;CAMEL-12016&lt;/del&gt;&lt;/a&gt; : ChannelFuture is not clearly erased from the pool on connection error&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2101&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2101&lt;/a&gt;&lt;/p&gt;




&lt;p&gt;This is a PR merged from a forked repository.&lt;br/&gt;
As GitHub hides the original diff on merge, it is displayed below for&lt;br/&gt;
the sake of provenance:&lt;/p&gt;

&lt;p&gt;As this is a foreign pull request (from a fork), the diff is supplied&lt;br/&gt;
below (as it won&apos;t show otherwise due to GitHub magic):&lt;/p&gt;

&lt;p&gt;diff --git a/components/camel-netty4/src/main/java/org/apache/camel/component/netty4/NettyProducer.java b/components/camel-netty4/src/main/java/org/apache/camel/component/netty4/NettyProducer.java&lt;br/&gt;
index a3756818233..cd3d12afcb2 100644&lt;br/&gt;
&amp;#8212; a/components/camel-netty4/src/main/java/org/apache/camel/component/netty4/NettyProducer.java&lt;br/&gt;
+++ b/components/camel-netty4/src/main/java/org/apache/camel/component/netty4/NettyProducer.java&lt;br/&gt;
@@ -642,6 +642,7 @@ public void operationComplete(ChannelFuture future) {&lt;br/&gt;
                 }&lt;br/&gt;
                 exchange.setException(cause);&lt;br/&gt;
                 callback.done(false);&lt;br/&gt;
+                releaseChannel(future);&lt;br/&gt;
                 return;&lt;br/&gt;
             }&lt;/p&gt;





&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                            <comment id="16259151" author="githubbot" created="Mon, 20 Nov 2017 11:57:19 +0000"  >&lt;p&gt;Github user oscerd closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/camel/pull/2101&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2101&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16259165" author="githubbot" created="Mon, 20 Nov 2017 12:07:16 +0000"  >&lt;p&gt;oscerd commented on issue #2101: &lt;a href=&quot;https://issues.apache.org/jira/browse/CAMEL-12016&quot; title=&quot;Invalid Pool Exhausted error on camel-netty4&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CAMEL-12016&quot;&gt;&lt;del&gt;CAMEL-12016&lt;/del&gt;&lt;/a&gt; : ChannelFuture is not clearly erased from the pool on connection error&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/camel/pull/2101#issuecomment-345677314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/camel/pull/2101#issuecomment-345677314&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;   Thanks for the PR. It has been merged on master and backported to 2.20.x, 2.19.x and 2.18.x&lt;/p&gt;

&lt;p&gt;----------------------------------------------------------------&lt;br/&gt;
This is an automated message from the Apache Git Service.&lt;br/&gt;
To respond to the message, please log on GitHub and use the&lt;br/&gt;
URL above to go to the specific comment.&lt;/p&gt;

&lt;p&gt;For queries about this service, please contact Infrastructure at:&lt;br/&gt;
users@infra.apache.org&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12310060" key="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        <customfieldname>Estimated Complexity</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10061"><![CDATA[Novice]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mzqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>