diff --git a/camel-core/src/main/java/org/apache/camel/model/ProcessorDefinitionHelper.java b/camel-core/src/main/java/org/apache/camel/model/ProcessorDefinitionHelper.java
index e11c3846379..63d0131aced 100644
--- a/camel-core/src/main/java/org/apache/camel/model/ProcessorDefinitionHelper.java
+++ b/camel-core/src/main/java/org/apache/camel/model/ProcessorDefinitionHelper.java
@@ -262,18 +262,21 @@ public final class ProcessorDefinitionHelper {
                     found.add((T) choice);
                 }
 
-                for (WhenDefinition when : choice.getWhenClauses()) {
-                    if (type.isInstance(when)) {
-                        found.add((T) when);
+                // only look at when/otherwise if current < maxDeep (or max deep is disabled)
+                if (maxDeep < 0 || current < maxDeep) {
+                    for (WhenDefinition when : choice.getWhenClauses()) {
+                        if (type.isInstance(when)) {
+                            found.add((T) when);
+                        }
+                        List<ProcessorDefinition<?>> children = when.getOutputs();
+                        doFindType(children, type, found, ++current, maxDeep);
                     }
-                    List<ProcessorDefinition<?>> children = when.getOutputs();
-                    doFindType(children, type, found, ++current, maxDeep);
-                }
 
-                // otherwise is optional
-                if (choice.getOtherwise() != null) {
-                    List<ProcessorDefinition<?>> children = choice.getOtherwise().getOutputs();
-                    doFindType(children, type, found, ++current, maxDeep);
+                    // otherwise is optional
+                    if (choice.getOtherwise() != null) {
+                        List<ProcessorDefinition<?>> children = choice.getOtherwise().getOutputs();
+                        doFindType(children, type, found, ++current, maxDeep);
+                    }
                 }
 
                 // do not check children as we already did that
@@ -289,16 +292,19 @@ public final class ProcessorDefinitionHelper {
                     found.add((T) doTry);
                 }
 
-                List<ProcessorDefinition<?>> doTryOut = doTry.getOutputsWithoutCatches();
-                doFindType(doTryOut, type, found, ++current, maxDeep);
+                // only look at children if current < maxDeep (or max deep is disabled)
+                if (maxDeep < 0 || current < maxDeep) {
+                    List<ProcessorDefinition<?>> doTryOut = doTry.getOutputsWithoutCatches();
+                    doFindType(doTryOut, type, found, ++current, maxDeep);
 
-                List<CatchDefinition> doTryCatch = doTry.getCatchClauses();
-                for (CatchDefinition doCatch : doTryCatch) {
-                    doFindType(doCatch.getOutputs(), type, found, ++current, maxDeep);
-                }
+                    List<CatchDefinition> doTryCatch = doTry.getCatchClauses();
+                    for (CatchDefinition doCatch : doTryCatch) {
+                        doFindType(doCatch.getOutputs(), type, found, ++current, maxDeep);
+                    }
 
-                if (doTry.getFinallyClause() != null) {
-                    doFindType(doTry.getFinallyClause().getOutputs(), type, found, ++current, maxDeep);
+                    if (doTry.getFinallyClause() != null) {
+                        doFindType(doTry.getFinallyClause().getOutputs(), type, found, ++current, maxDeep);
+                    }
                 }
 
                 // do not check children as we already did that
diff --git a/camel-core/src/test/java/org/apache/camel/processor/interceptor/AdviceWithWeaveLastCBRTest.java b/camel-core/src/test/java/org/apache/camel/processor/interceptor/AdviceWithWeaveLastCBRTest.java
new file mode 100644
index 00000000000..b47b256ce58
--- /dev/null
+++ b/camel-core/src/test/java/org/apache/camel/processor/interceptor/AdviceWithWeaveLastCBRTest.java
@@ -0,0 +1,58 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.camel.processor.interceptor;
+
+import org.apache.camel.ContextTestSupport;
+import org.apache.camel.builder.AdviceWithRouteBuilder;
+import org.apache.camel.builder.RouteBuilder;
+
+/**
+ * Advice with tests
+ */
+public class AdviceWithWeaveLastCBRTest extends ContextTestSupport {
+
+    public void testWeaveAddLast() throws Exception {
+        context.getRouteDefinitions().get(0).adviceWith(context, new AdviceWithRouteBuilder() {
+            @Override
+            public void configure() throws Exception {
+                // insert at the end of the existing route, the given piece of route
+                weaveAddLast().to("mock:last");
+            }
+        });
+
+        getMockEndpoint("mock:foo").expectedMessageCount(1);
+        getMockEndpoint("mock:bar").expectedMessageCount(0);
+        getMockEndpoint("mock:last").expectedMessageCount(1);
+
+        template.sendBodyAndHeader("direct:start", "Hello World", "foo", "yeah");
+
+        assertMockEndpointsSatisfied();
+    }
+
+    @Override
+    protected RouteBuilder createRouteBuilder() throws Exception {
+        return new RouteBuilder() {
+            @Override
+            public void configure() throws Exception {
+                from("direct:start")
+                    .choice()
+                        .when().header("foo").to("mock:foo")
+                        .otherwise().to("mock:bar");
+            }
+        };
+    }
+}
\ No newline at end of file
