diff --git a/camel-core/src/main/java/org/apache/camel/converter/stream/CachedOutputStream.java b/camel-core/src/main/java/org/apache/camel/converter/stream/CachedOutputStream.java
index 391ff042ca5..3ebcc4f4c19 100644
--- a/camel-core/src/main/java/org/apache/camel/converter/stream/CachedOutputStream.java
+++ b/camel-core/src/main/java/org/apache/camel/converter/stream/CachedOutputStream.java
@@ -72,6 +72,8 @@ public class CachedOutputStream extends OutputStream {
                 try {
                     // cleanup temporary file
                     if (tempFile != null) {
+                        // close the stream first and than delete the file
+                        close();
                         boolean deleted = tempFile.delete();
                         if (!deleted) {
                             LOG.warn("Cannot delete temporary cache file: " + tempFile);
diff --git a/camel-core/src/test/java/org/apache/camel/component/file/strategy/GenericFileDeleteProcessStrategyTest.java b/camel-core/src/test/java/org/apache/camel/component/file/strategy/GenericFileDeleteProcessStrategyTest.java
index 4fa037e39a4..e5a3394b449 100644
--- a/camel-core/src/test/java/org/apache/camel/component/file/strategy/GenericFileDeleteProcessStrategyTest.java
+++ b/camel-core/src/test/java/org/apache/camel/component/file/strategy/GenericFileDeleteProcessStrategyTest.java
@@ -24,6 +24,7 @@ import org.apache.camel.component.file.GenericFile;
 import org.apache.camel.component.file.GenericFileEndpoint;
 import org.apache.camel.component.file.GenericFileOperationFailedException;
 import org.apache.camel.component.file.GenericFileOperations;
+import org.apache.camel.util.FileUtil;
 
 /**
  * Unit test about retrying deleting processed file, that can be a bit more tricky
@@ -49,8 +50,8 @@ public class GenericFileDeleteProcessStrategyTest extends ContextTestSupport {
 
         public boolean existsFile(String name) throws GenericFileOperationFailedException {
             existsCounter++;
-
-            if ("target/foo/boom.txt".equals(name)) {
+            // The file name should be normalized
+            if (FileUtil.normalizePath("target/foo/boom.txt").equals(name)) {
                 // test that we can newer delete this file
                 return true;
             }
diff --git a/camel-core/src/test/java/org/apache/camel/converter/stream/CachedOutputStreamTest.java b/camel-core/src/test/java/org/apache/camel/converter/stream/CachedOutputStreamTest.java
index c0ad0686cbf..55f420aee6f 100644
--- a/camel-core/src/test/java/org/apache/camel/converter/stream/CachedOutputStreamTest.java
+++ b/camel-core/src/test/java/org/apache/camel/converter/stream/CachedOutputStreamTest.java
@@ -109,10 +109,13 @@ public class CachedOutputStreamTest extends ContextTestSupport {
         cache.reset();
         temp = toString((InputStream)cache);
         assertEquals("Cached a wrong file", temp, TEST_STRING);
-        
+        // windows can't delet the file which is open , so we close the stream first
+        if (System.getProperty("os.name").startsWith("Windows")) {
+            ((InputStream)cache).close();
+        }
         exchange.getUnitOfWork().done(exchange);
-
         ((InputStream)cache).close();
+        
         files = file.list();
         assertEquals("we should have no temp file", files.length, 0);       
     }
diff --git a/camel-core/src/test/java/org/apache/camel/processor/ChoiceWithEndTest.java b/camel-core/src/test/java/org/apache/camel/processor/ChoiceWithEndTest.java
index 7aaedd9ef52..242f5d4b278 100644
--- a/camel-core/src/test/java/org/apache/camel/processor/ChoiceWithEndTest.java
+++ b/camel-core/src/test/java/org/apache/camel/processor/ChoiceWithEndTest.java
@@ -21,6 +21,7 @@ import java.util.List;
 import org.apache.camel.ContextTestSupport;
 import org.apache.camel.Navigate;
 import org.apache.camel.Processor;
+import org.apache.camel.Route;
 import org.apache.camel.builder.RouteBuilder;
 
 /**
@@ -30,7 +31,7 @@ public class ChoiceWithEndTest extends ContextTestSupport {
 
     public void testRouteIsCorrectAtRuntime() throws Exception {
         // use navigate to find that the end works as expected
-        Navigate<Processor> nav = context.getRoutes().get(0).navigate();
+        Navigate<Processor> nav = getRoute("direct://start").navigate();
         List<Processor> node = nav.next();
         node = ((Navigate) node.get(0)).next();
 
@@ -44,6 +45,18 @@ public class ChoiceWithEndTest extends ContextTestSupport {
         assertIsInstanceOf(TransformProcessor.class, unwrapChannel(node.get(2)).getNextProcessor());
         assertIsInstanceOf(SendProcessor.class, unwrapChannel(node.get(3)).getNextProcessor());
     }
+    
+    private Route getRoute(String routeEndpointURI) {
+        Route answer = null;
+        for (Route route : context.getRoutes()) {
+            if (routeEndpointURI.equals(route.getEndpoint().getEndpointUri())) {
+                answer = route;
+                break;
+            }
+        }
+        return answer;
+        
+    }
 
     public void testChoiceHello() throws Exception {
         getMockEndpoint("mock:start").expectedBodiesReceived("Hello World");
