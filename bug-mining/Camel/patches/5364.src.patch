diff --git a/components/camel-weather/src/generated/java/org/apache/camel/component/weather/WeatherComponentConfigurer.java b/components/camel-weather/src/generated/java/org/apache/camel/component/weather/WeatherComponentConfigurer.java
index 6cf87cbf146..a1a233773c3 100644
--- a/components/camel-weather/src/generated/java/org/apache/camel/component/weather/WeatherComponentConfigurer.java
+++ b/components/camel-weather/src/generated/java/org/apache/camel/component/weather/WeatherComponentConfigurer.java
@@ -23,8 +23,6 @@ public class WeatherComponentConfigurer extends PropertyConfigurerSupport implem
         case "basicPropertyBinding": target.setBasicPropertyBinding(property(camelContext, boolean.class, value)); return true;
         case "bridgeerrorhandler":
         case "bridgeErrorHandler": target.setBridgeErrorHandler(property(camelContext, boolean.class, value)); return true;
-        case "httpclient":
-        case "httpClient": target.setHttpClient(property(camelContext, org.apache.http.impl.client.CloseableHttpClient.class, value)); return true;
         case "lazystartproducer":
         case "lazyStartProducer": target.setLazyStartProducer(property(camelContext, boolean.class, value)); return true;
         default: return false;
@@ -36,7 +34,6 @@ public class WeatherComponentConfigurer extends PropertyConfigurerSupport implem
         Map<String, Object> answer = new CaseInsensitiveMap();
         answer.put("basicPropertyBinding", boolean.class);
         answer.put("bridgeErrorHandler", boolean.class);
-        answer.put("httpClient", org.apache.http.impl.client.CloseableHttpClient.class);
         answer.put("lazyStartProducer", boolean.class);
         return answer;
     }
@@ -49,8 +46,6 @@ public class WeatherComponentConfigurer extends PropertyConfigurerSupport implem
         case "basicPropertyBinding": return target.isBasicPropertyBinding();
         case "bridgeerrorhandler":
         case "bridgeErrorHandler": return target.isBridgeErrorHandler();
-        case "httpclient":
-        case "httpClient": return target.getHttpClient();
         case "lazystartproducer":
         case "lazyStartProducer": return target.isLazyStartProducer();
         default: return null;
diff --git a/components/camel-weather/src/generated/java/org/apache/camel/component/weather/WeatherEndpointConfigurer.java b/components/camel-weather/src/generated/java/org/apache/camel/component/weather/WeatherEndpointConfigurer.java
index c560917bb70..40dd24bb02a 100644
--- a/components/camel-weather/src/generated/java/org/apache/camel/component/weather/WeatherEndpointConfigurer.java
+++ b/components/camel-weather/src/generated/java/org/apache/camel/component/weather/WeatherEndpointConfigurer.java
@@ -36,6 +36,8 @@ public class WeatherEndpointConfigurer extends PropertyConfigurerSupport impleme
         case "exceptionHandler": target.setExceptionHandler(property(camelContext, org.apache.camel.spi.ExceptionHandler.class, value)); return true;
         case "exchangepattern":
         case "exchangePattern": target.setExchangePattern(property(camelContext, org.apache.camel.ExchangePattern.class, value)); return true;
+        case "geolocationprovider":
+        case "geoLocationProvider": target.getConfiguration().setGeoLocationProvider(property(camelContext, org.apache.camel.component.weather.geolocation.GeoLocationProvider.class, value)); return true;
         case "geolocationaccesskey":
         case "geolocationAccessKey": target.getConfiguration().setGeolocationAccessKey(property(camelContext, java.lang.String.class, value)); return true;
         case "geolocationrequesthostip":
@@ -43,6 +45,8 @@ public class WeatherEndpointConfigurer extends PropertyConfigurerSupport impleme
         case "greedy": target.setGreedy(property(camelContext, boolean.class, value)); return true;
         case "headername":
         case "headerName": target.getConfiguration().setHeaderName(property(camelContext, java.lang.String.class, value)); return true;
+        case "httpclient":
+        case "httpClient": target.getConfiguration().setHttpClient(property(camelContext, org.apache.http.impl.client.CloseableHttpClient.class, value)); return true;
         case "ids": target.getConfiguration().setIds(property(camelContext, java.lang.String.class, value)); return true;
         case "initialdelay":
         case "initialDelay": target.setInitialDelay(property(camelContext, long.class, value)); return true;
@@ -100,10 +104,12 @@ public class WeatherEndpointConfigurer extends PropertyConfigurerSupport impleme
         answer.put("delay", long.class);
         answer.put("exceptionHandler", org.apache.camel.spi.ExceptionHandler.class);
         answer.put("exchangePattern", org.apache.camel.ExchangePattern.class);
+        answer.put("geoLocationProvider", org.apache.camel.component.weather.geolocation.GeoLocationProvider.class);
         answer.put("geolocationAccessKey", java.lang.String.class);
         answer.put("geolocationRequestHostIP", java.lang.String.class);
         answer.put("greedy", boolean.class);
         answer.put("headerName", java.lang.String.class);
+        answer.put("httpClient", org.apache.http.impl.client.CloseableHttpClient.class);
         answer.put("ids", java.lang.String.class);
         answer.put("initialDelay", long.class);
         answer.put("language", org.apache.camel.component.weather.WeatherLanguage.class);
@@ -154,6 +160,8 @@ public class WeatherEndpointConfigurer extends PropertyConfigurerSupport impleme
         case "exceptionHandler": return target.getExceptionHandler();
         case "exchangepattern":
         case "exchangePattern": return target.getExchangePattern();
+        case "geolocationprovider":
+        case "geoLocationProvider": return target.getConfiguration().getGeoLocationProvider();
         case "geolocationaccesskey":
         case "geolocationAccessKey": return target.getConfiguration().getGeolocationAccessKey();
         case "geolocationrequesthostip":
@@ -161,6 +169,8 @@ public class WeatherEndpointConfigurer extends PropertyConfigurerSupport impleme
         case "greedy": return target.isGreedy();
         case "headername":
         case "headerName": return target.getConfiguration().getHeaderName();
+        case "httpclient":
+        case "httpClient": return target.getConfiguration().getHttpClient();
         case "ids": return target.getConfiguration().getIds();
         case "initialdelay":
         case "initialDelay": return target.getInitialDelay();
diff --git a/components/camel-weather/src/generated/resources/org/apache/camel/component/weather/weather.json b/components/camel-weather/src/generated/resources/org/apache/camel/component/weather/weather.json
index e792b52e8f9..e3c410ebc66 100644
--- a/components/camel-weather/src/generated/resources/org/apache/camel/component/weather/weather.json
+++ b/components/camel-weather/src/generated/resources/org/apache/camel/component/weather/weather.json
@@ -23,8 +23,7 @@
   "componentProperties": {
     "bridgeErrorHandler": { "kind": "property", "displayName": "Bridge Error Handler", "group": "consumer", "label": "consumer", "required": false, "type": "boolean", "javaType": "boolean", "deprecated": false, "secret": false, "defaultValue": false, "description": "Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored." },
     "lazyStartProducer": { "kind": "property", "displayName": "Lazy Start Producer", "group": "producer", "label": "producer", "required": false, "type": "boolean", "javaType": "boolean", "deprecated": false, "secret": false, "defaultValue": false, "description": "Whether the producer should be started lazy (on the first message). By starting lazy you can use this to allow CamelContext and routes to startup in situations where a producer may otherwise fail during starting and cause the route to fail being started. By deferring this startup to be lazy then the startup failure can be handled during routing messages via Camel's routing error handlers. Beware that when the first message is processed then creating and starting the producer may take a little time and prolong the total processing time of the processing." },
-    "basicPropertyBinding": { "kind": "property", "displayName": "Basic Property Binding", "group": "advanced", "label": "advanced", "required": false, "type": "boolean", "javaType": "boolean", "deprecated": false, "secret": false, "defaultValue": false, "description": "Whether the component should use basic property binding (Camel 2.x) or the newer property binding with additional capabilities" },
-    "httpClient": { "kind": "property", "displayName": "Http Client", "group": "advanced", "label": "advanced", "required": false, "type": "object", "javaType": "org.apache.http.impl.client.CloseableHttpClient", "deprecated": false, "secret": false, "description": "To use an existing configured http client (for example with http proxy)" }
+    "basicPropertyBinding": { "kind": "property", "displayName": "Basic Property Binding", "group": "advanced", "label": "advanced", "required": false, "type": "boolean", "javaType": "boolean", "deprecated": false, "secret": false, "defaultValue": false, "description": "Whether the component should use basic property binding (Camel 2.x) or the newer property binding with additional capabilities" }
   },
   "properties": {
     "name": { "kind": "path", "displayName": "Name", "group": "common", "label": "", "required": true, "type": "string", "javaType": "java.lang.String", "deprecated": false, "deprecationNote": "", "secret": false, "configurationClass": "org.apache.camel.component.weather.WeatherConfiguration", "configurationField": "configuration", "description": "The name value is not used." },
@@ -34,7 +33,7 @@
     "mode": { "kind": "parameter", "displayName": "Mode", "group": "common", "label": "", "required": false, "type": "object", "javaType": "org.apache.camel.component.weather.WeatherMode", "enum": [ "HTML", "JSON", "XML" ], "deprecated": false, "secret": false, "defaultValue": "JSON", "configurationClass": "org.apache.camel.component.weather.WeatherConfiguration", "configurationField": "configuration", "description": "The output format of the weather data." },
     "period": { "kind": "parameter", "displayName": "Period", "group": "common", "label": "", "required": false, "type": "string", "javaType": "java.lang.String", "deprecated": false, "secret": false, "configurationClass": "org.apache.camel.component.weather.WeatherConfiguration", "configurationField": "configuration", "description": "If null, the current weather will be returned, else use values of 5, 7, 14 days. Only the numeric value for the forecast period is actually parsed, so spelling, capitalisation of the time period is up to you (its ignored)" },
     "units": { "kind": "parameter", "displayName": "Units", "group": "common", "label": "", "required": false, "type": "object", "javaType": "org.apache.camel.component.weather.WeatherUnits", "enum": [ "IMPERIAL", "METRIC" ], "deprecated": false, "secret": false, "configurationClass": "org.apache.camel.component.weather.WeatherConfiguration", "configurationField": "configuration", "description": "The units for temperature measurement." },
-    "weatherApi": { "kind": "parameter", "displayName": "Weather Api", "group": "common", "label": "", "required": false, "type": "object", "javaType": "org.apache.camel.component.weather.WeatherApi", "enum": [ "Current", "Station", "Hourly", "Daily" ], "deprecated": false, "secret": false, "configurationClass": "org.apache.camel.component.weather.WeatherConfiguration", "configurationField": "configuration", "description": "The API to be use (current, forecast\/3 hour, forecast daily, station)" },
+    "weatherApi": { "kind": "parameter", "displayName": "Weather Api", "group": "common", "label": "", "required": false, "type": "object", "javaType": "org.apache.camel.component.weather.WeatherApi", "enum": [ "Current", "Station", "Hourly", "Daily" ], "deprecated": false, "secret": false, "configurationClass": "org.apache.camel.component.weather.WeatherConfiguration", "configurationField": "configuration", "description": "The API to use (current, forecast\/3 hour, forecast daily, station)" },
     "bridgeErrorHandler": { "kind": "parameter", "displayName": "Bridge Error Handler", "group": "consumer", "label": "consumer", "required": false, "type": "boolean", "javaType": "boolean", "deprecated": false, "secret": false, "defaultValue": false, "description": "Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored." },
     "sendEmptyMessageWhenIdle": { "kind": "parameter", "displayName": "Send Empty Message When Idle", "group": "consumer", "label": "consumer", "required": false, "type": "boolean", "javaType": "boolean", "deprecated": false, "secret": false, "defaultValue": false, "description": "If the polling consumer did not poll any files, you can enable this option to send an empty message (no body) instead." },
     "exceptionHandler": { "kind": "parameter", "displayName": "Exception Handler", "group": "consumer (advanced)", "label": "consumer,advanced", "required": false, "type": "object", "javaType": "org.apache.camel.spi.ExceptionHandler", "optionalPrefix": "consumer.", "deprecated": false, "secret": false, "description": "To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this option is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored." },
@@ -42,6 +41,8 @@
     "pollStrategy": { "kind": "parameter", "displayName": "Poll Strategy", "group": "consumer (advanced)", "label": "consumer,advanced", "required": false, "type": "object", "javaType": "org.apache.camel.spi.PollingConsumerPollStrategy", "deprecated": false, "secret": false, "description": "A pluggable org.apache.camel.PollingConsumerPollingStrategy allowing you to provide your custom implementation to control error handling usually occurred during the poll operation before an Exchange have been created and being routed in Camel." },
     "lazyStartProducer": { "kind": "parameter", "displayName": "Lazy Start Producer", "group": "producer", "label": "producer", "required": false, "type": "boolean", "javaType": "boolean", "deprecated": false, "secret": false, "defaultValue": false, "description": "Whether the producer should be started lazy (on the first message). By starting lazy you can use this to allow CamelContext and routes to startup in situations where a producer may otherwise fail during starting and cause the route to fail being started. By deferring this startup to be lazy then the startup failure can be handled during routing messages via Camel's routing error handlers. Beware that when the first message is processed then creating and starting the producer may take a little time and prolong the total processing time of the processing." },
     "basicPropertyBinding": { "kind": "parameter", "displayName": "Basic Property Binding", "group": "advanced", "label": "advanced", "required": false, "type": "boolean", "javaType": "boolean", "deprecated": false, "secret": false, "defaultValue": false, "description": "Whether the endpoint should use basic property binding (Camel 2.x) or the newer property binding with additional capabilities" },
+    "geoLocationProvider": { "kind": "parameter", "displayName": "Geo Location Provider", "group": "advanced", "label": "advanced", "required": false, "type": "object", "javaType": "org.apache.camel.component.weather.geolocation.GeoLocationProvider", "deprecated": false, "secret": false, "configurationClass": "org.apache.camel.component.weather.WeatherConfiguration", "configurationField": "configuration", "description": "A custum geolocation provider to determine the longitude and latitude to use when no location information is set. The default implementaion uses the ipstack API and requires geolocationAccessKey and geolocationRequestHostIP" },
+    "httpClient": { "kind": "parameter", "displayName": "Http Client", "group": "advanced", "label": "advanced", "required": false, "type": "object", "javaType": "org.apache.http.impl.client.CloseableHttpClient", "deprecated": false, "secret": false, "configurationClass": "org.apache.camel.component.weather.WeatherConfiguration", "configurationField": "configuration", "description": "To use an existing configured http client (for example with http proxy)" },
     "synchronous": { "kind": "parameter", "displayName": "Synchronous", "group": "advanced", "label": "advanced", "required": false, "type": "boolean", "javaType": "boolean", "deprecated": false, "secret": false, "defaultValue": "false", "description": "Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported)." },
     "cnt": { "kind": "parameter", "displayName": "Cnt", "group": "filter", "label": "filter", "required": false, "type": "integer", "javaType": "java.lang.Integer", "deprecated": false, "secret": false, "configurationClass": "org.apache.camel.component.weather.WeatherConfiguration", "configurationField": "configuration", "description": "Number of results to be found" },
     "ids": { "kind": "parameter", "displayName": "Ids", "group": "filter", "label": "filter", "required": false, "type": "string", "javaType": "java.lang.String", "deprecated": false, "secret": false, "configurationClass": "org.apache.camel.component.weather.WeatherConfiguration", "configurationField": "configuration", "description": "List of id's of city\/stations. You can separate multiple ids by comma." },
diff --git a/components/camel-weather/src/main/docs/weather-component.adoc b/components/camel-weather/src/main/docs/weather-component.adoc
index 616b7f4b56d..ed531befd61 100644
--- a/components/camel-weather/src/main/docs/weather-component.adoc
+++ b/components/camel-weather/src/main/docs/weather-component.adoc
@@ -42,7 +42,7 @@ weather://<unused name>[?options]
 
 == REMARK
 
-Since the 9th of October, an Api Key is required to access the
+Since 9 October 2015, an Api Key is required to access the
 openweather service. This key is passed as parameter to the URI
 definition of the weather endpoint using the appid param !
 
@@ -56,7 +56,7 @@ from where you're using the API now on.
 
 
 // component options: START
-The Weather component supports 4 options, which are listed below.
+The Weather component supports 3 options, which are listed below.
 
 
 
@@ -66,7 +66,6 @@ The Weather component supports 4 options, which are listed below.
 | *bridgeErrorHandler* (consumer) | Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored. | false | boolean
 | *lazyStartProducer* (producer) | Whether the producer should be started lazy (on the first message). By starting lazy you can use this to allow CamelContext and routes to startup in situations where a producer may otherwise fail during starting and cause the route to fail being started. By deferring this startup to be lazy then the startup failure can be handled during routing messages via Camel's routing error handlers. Beware that when the first message is processed then creating and starting the producer may take a little time and prolong the total processing time of the processing. | false | boolean
 | *basicPropertyBinding* (advanced) | Whether the component should use basic property binding (Camel 2.x) or the newer property binding with additional capabilities | false | boolean
-| *httpClient* (advanced) | To use an existing configured http client (for example with http proxy) |  | CloseableHttpClient
 |===
 // component options: END
 
@@ -91,7 +90,7 @@ with the following path and query parameters:
 |===
 
 
-=== Query Parameters (40 parameters):
+=== Query Parameters (42 parameters):
 
 
 [width="100%",cols="2,5,^1,2",options="header"]
@@ -103,7 +102,7 @@ with the following path and query parameters:
 | *mode* (common) | The output format of the weather data. The value can be one of: HTML, JSON, XML | JSON | WeatherMode
 | *period* (common) | If null, the current weather will be returned, else use values of 5, 7, 14 days. Only the numeric value for the forecast period is actually parsed, so spelling, capitalisation of the time period is up to you (its ignored) |  | String
 | *units* (common) | The units for temperature measurement. The value can be one of: IMPERIAL, METRIC |  | WeatherUnits
-| *weatherApi* (common) | The API to be use (current, forecast/3 hour, forecast daily, station). The value can be one of: Current, Station, Hourly, Daily |  | WeatherApi
+| *weatherApi* (common) | The API to use (current, forecast/3 hour, forecast daily, station). The value can be one of: Current, Station, Hourly, Daily |  | WeatherApi
 | *bridgeErrorHandler* (consumer) | Allows for bridging the consumer to the Camel routing Error Handler, which mean any exceptions occurred while the consumer is trying to pickup incoming messages, or the likes, will now be processed as a message and handled by the routing Error Handler. By default the consumer will use the org.apache.camel.spi.ExceptionHandler to deal with exceptions, that will be logged at WARN or ERROR level and ignored. | false | boolean
 | *sendEmptyMessageWhenIdle* (consumer) | If the polling consumer did not poll any files, you can enable this option to send an empty message (no body) instead. | false | boolean
 | *exceptionHandler* (consumer) | To let the consumer use a custom ExceptionHandler. Notice if the option bridgeErrorHandler is enabled then this option is not in use. By default the consumer will deal with exceptions, that will be logged at WARN or ERROR level and ignored. |  | ExceptionHandler
@@ -111,6 +110,8 @@ with the following path and query parameters:
 | *pollStrategy* (consumer) | A pluggable org.apache.camel.PollingConsumerPollingStrategy allowing you to provide your custom implementation to control error handling usually occurred during the poll operation before an Exchange have been created and being routed in Camel. |  | PollingConsumerPollStrategy
 | *lazyStartProducer* (producer) | Whether the producer should be started lazy (on the first message). By starting lazy you can use this to allow CamelContext and routes to startup in situations where a producer may otherwise fail during starting and cause the route to fail being started. By deferring this startup to be lazy then the startup failure can be handled during routing messages via Camel's routing error handlers. Beware that when the first message is processed then creating and starting the producer may take a little time and prolong the total processing time of the processing. | false | boolean
 | *basicPropertyBinding* (advanced) | Whether the endpoint should use basic property binding (Camel 2.x) or the newer property binding with additional capabilities | false | boolean
+| *geoLocationProvider* (advanced) | A custum geolocation provider to determine the longitude and latitude to use when no location information is set. The default implementaion uses the ipstack API and requires geolocationAccessKey and geolocationRequestHostIP |  | GeoLocationProvider
+| *httpClient* (advanced) | To use an existing configured http client (for example with http proxy) |  | CloseableHttpClient
 | *synchronous* (advanced) | Sets whether synchronous processing should be strictly used, or Camel is allowed to use asynchronous processing (if supported). | false | boolean
 | *cnt* (filter) | Number of results to be found |  | Integer
 | *ids* (filter) | List of id's of city/stations. You can separate multiple ids by comma. |  | String
diff --git a/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherComponent.java b/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherComponent.java
index 5bfe20abf01..f7c218f544e 100644
--- a/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherComponent.java
+++ b/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherComponent.java
@@ -19,12 +19,8 @@ package org.apache.camel.component.weather;
 import java.util.Map;
 
 import org.apache.camel.Endpoint;
-import org.apache.camel.spi.Metadata;
 import org.apache.camel.spi.annotations.Component;
 import org.apache.camel.support.DefaultComponent;
-import org.apache.camel.util.IOHelper;
-import org.apache.http.impl.client.CloseableHttpClient;
-import org.apache.http.impl.client.HttpClients;
 
 /**
  * A <a href="http://camel.apache.org/weather.html">Weather Component</a>.
@@ -34,70 +30,18 @@ import org.apache.http.impl.client.HttpClients;
 @Component("weather")
 public class WeatherComponent extends DefaultComponent {
 
-    @Metadata(label = "advanced")
-    private CloseableHttpClient httpClient;
-    private String geolocationAccessKey;
-    private String geolocationRequestHostIP;
 
     public WeatherComponent() {
+
     }
 
     @Override
     protected Endpoint createEndpoint(String uri, String remaining, Map<String, Object> parameters) throws Exception {
-        WeatherConfiguration configuration = new WeatherConfiguration(this);
-        configuration.setGeolocationAccessKey(geolocationAccessKey);
-        configuration.setGeolocationRequestHostIP(geolocationRequestHostIP);
+        WeatherConfiguration configuration = new WeatherConfiguration();
 
         WeatherEndpoint endpoint = new WeatherEndpoint(uri, this, configuration);
         setProperties(endpoint, parameters);
 
-        if (httpClient == null) {
-            httpClient = HttpClients.createDefault();
-        }
-
         return endpoint;
     }
-
-    public CloseableHttpClient getHttpClient() {
-        return httpClient;
-    }
-
-    /**
-     * To use an existing configured http client (for example with http proxy)
-     */
-    public void setHttpClient(CloseableHttpClient httpClient) {
-        this.httpClient = httpClient;
-    }
-
-    public String getGeolocationAccessKey() {
-        return geolocationAccessKey;
-    }
-
-    /**
-     * The geolocation service now needs an accessKey to be used
-     */
-    public void setGeolocationAccessKey(String geolocationAccessKey) {
-        this.geolocationAccessKey = geolocationAccessKey;
-    }
-
-    public String getGeolocationRequestHostIP() {
-        return geolocationRequestHostIP;
-    }
-
-    /**
-     * The geolocation service now needs to specify the IP associated to the accessKey you're using
-     */
-    public void setGeolocationRequestHostIP(String geolocationRequestHostIP) {
-        this.geolocationRequestHostIP = geolocationRequestHostIP;
-    }
-
-    @Override
-    protected void doShutdown() throws Exception {
-        super.doShutdown();
-
-        if (httpClient != null) {
-            IOHelper.close(httpClient);
-            httpClient = null;
-        }
-    }
 }
diff --git a/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherConfiguration.java b/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherConfiguration.java
index 40a47373ce1..6bf63d43e64 100644
--- a/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherConfiguration.java
+++ b/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherConfiguration.java
@@ -22,13 +22,14 @@ import java.util.List;
 import java.util.Scanner;
 
 import org.apache.camel.component.weather.geolocation.FreeGeoIpGeoLocationProvider;
+import org.apache.camel.component.weather.geolocation.GeoLocationProvider;
 import org.apache.camel.spi.Metadata;
 import org.apache.camel.spi.UriParam;
 import org.apache.camel.spi.UriParams;
 import org.apache.camel.spi.UriPath;
 import org.apache.camel.support.ObjectHelper;
-import org.apache.http.conn.HttpClientConnectionManager;
-
+import org.apache.http.impl.client.CloseableHttpClient;
+import org.apache.http.impl.client.HttpClients;
 
 import static org.apache.camel.component.weather.WeatherLanguage.en;
 import static org.apache.camel.component.weather.WeatherMode.JSON;
@@ -37,9 +38,6 @@ import static org.apache.camel.util.ObjectHelper.notNull;
 @UriParams
 public class WeatherConfiguration {
 
-    private final WeatherComponent component;
-    private final WeatherQuery weatherQuery;
-
     @UriPath(description = "The name value is not used.")
     @Metadata(required = true)
     private String name;
@@ -82,14 +80,15 @@ public class WeatherConfiguration {
     @UriParam(label = "security")
     @Metadata(required = true)
     private String geolocationRequestHostIP;
+    @UriParam(label = "advanced")
+    private CloseableHttpClient httpClient = HttpClients.createDefault();
+    @UriParam(label = "advanced")
+    private GeoLocationProvider geoLocationProvider = new FreeGeoIpGeoLocationProvider(this);
+    
+    public WeatherConfiguration() {
 
-    public WeatherConfiguration(WeatherComponent component) {
-        this.component = notNull(component, "component");
-        weatherQuery = new WeatherQuery(this);
-        FreeGeoIpGeoLocationProvider geoLocationProvider = new FreeGeoIpGeoLocationProvider(component, geolocationAccessKey);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
     }
-
+    
     public String getPeriod() {
         return period;
     }
@@ -208,14 +207,6 @@ public class WeatherConfiguration {
         return appid;
     }
 
-    String getQuery() throws Exception {
-        return weatherQuery.getQuery();
-    }
-
-    String getQuery(String location) throws Exception {
-        return weatherQuery.getQuery(location);
-    }
-
     public WeatherLanguage getLanguage() {
         return language;
     }
@@ -312,7 +303,7 @@ public class WeatherConfiguration {
     }
 
     /**
-     * The API to be use (current, forecast/3 hour, forecast daily, station)
+     * The API to use (current, forecast/3 hour, forecast daily, station)
      */
     public void setWeatherApi(WeatherApi weatherApi) {
         this.weatherApi = weatherApi;
@@ -340,4 +331,30 @@ public class WeatherConfiguration {
     public void setGeolocationRequestHostIP(String geolocationRequestHostIP) {
         this.geolocationRequestHostIP = geolocationRequestHostIP;
     }
+
+    public CloseableHttpClient getHttpClient() {
+        return httpClient;
+    }
+
+    /**
+     * To use an existing configured http client (for example with http proxy)
+     */
+    public void setHttpClient(CloseableHttpClient httpClient) {
+        this.httpClient = httpClient;
+    }
+
+    public GeoLocationProvider getGeoLocationProvider() {
+        return geoLocationProvider;
+    }
+
+    /**
+     * A custum geolocation provider to determine the longitude and latitude
+     * to use when no location information is set.
+     * 
+     * The default implementaion uses the ipstack API and requires
+     * geolocationAccessKey and geolocationRequestHostIP
+     */
+    public void setGeoLocationProvider(GeoLocationProvider geoLocationProvider) {
+        this.geoLocationProvider = geoLocationProvider;
+    }
 }
diff --git a/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherConsumer.java b/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherConsumer.java
index e983570d806..779318c467d 100644
--- a/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherConsumer.java
+++ b/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherConsumer.java
@@ -48,7 +48,7 @@ public class WeatherConsumer extends ScheduledPollConsumer {
     @Override
     protected int poll() throws Exception {
         LOG.debug("Going to execute the Weather query {}", query);
-        HttpClient httpClient = ((WeatherComponent) getEndpoint().getComponent()).getHttpClient();
+        HttpClient httpClient = getEndpoint().getConfiguration().getHttpClient();
         HttpGet getMethod = new HttpGet(query);
         try {
             HttpResponse response = httpClient.execute(getMethod);
diff --git a/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherEndpoint.java b/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherEndpoint.java
index 09c708a44cb..5a8caec2610 100644
--- a/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherEndpoint.java
+++ b/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherEndpoint.java
@@ -23,38 +23,54 @@ import org.apache.camel.Producer;
 import org.apache.camel.spi.UriEndpoint;
 import org.apache.camel.spi.UriParam;
 import org.apache.camel.support.DefaultPollingEndpoint;
+import org.apache.http.client.utils.HttpClientUtils;
 
 /**
  * Poll the weather information from Open Weather Map.
  */
 @UriEndpoint(firstVersion = "2.12.0", scheme = "weather", title = "Weather", syntax = "weather:name", category = {Category.API})
 public class WeatherEndpoint extends DefaultPollingEndpoint {
-
+    
     @UriParam
     private WeatherConfiguration configuration;
-
+    
+    private WeatherQuery weatherQuery;
+    
     public WeatherEndpoint(String uri, WeatherComponent component, WeatherConfiguration properties) {
         super(uri, component);
         this.configuration = properties;
+        this.weatherQuery = new WeatherQuery(getConfiguration());
     }
-
+ 
     @Override
     public Consumer createConsumer(Processor processor) throws Exception {
-        WeatherConsumer answer = new WeatherConsumer(this, processor, this.configuration.getQuery());
-
+        WeatherConsumer answer = new WeatherConsumer(this, processor, getWeatherQuery().getQuery());
+        
         // ScheduledPollConsumer default delay is 500 millis and that is too often for polling a feed, so we override
         // with a new default value. End user can override this value by providing a consumer.delay parameter
         answer.setDelay(WeatherConsumer.DEFAULT_CONSUMER_DELAY);
         configureConsumer(answer);
         return answer;
     }
-
+    
     @Override
     public Producer createProducer() throws Exception {
-        return new WeatherProducer(this, configuration.getQuery());
+        return new WeatherProducer(this, getWeatherQuery().getQuery());
     }
-
+    
     public WeatherConfiguration getConfiguration() {
         return configuration;
     }
+
+    public WeatherQuery getWeatherQuery() {
+        return this.weatherQuery;
+    }
+    
+    @Override
+    protected void doStop() throws Exception {
+        super.doStop();
+        
+        HttpClientUtils.closeQuietly(getConfiguration().getHttpClient());
+    }
+
 }
diff --git a/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherProducer.java b/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherProducer.java
index 5479ed06bc6..54ea9f701d1 100644
--- a/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherProducer.java
+++ b/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherProducer.java
@@ -48,10 +48,10 @@ public class WeatherProducer extends DefaultProducer {
         String q = query;
         String location = exchange.getIn().getHeader(WeatherConstants.WEATHER_LOCATION, String.class);
         if (location != null) {
-            q = getEndpoint().getConfiguration().getQuery(location);
+            q = getEndpoint().getWeatherQuery().getQuery(location);
         }
 
-        HttpClient httpClient = ((WeatherComponent) getEndpoint().getComponent()).getHttpClient();
+        HttpClient httpClient = getEndpoint().getConfiguration().getHttpClient();
         HttpGet method = new HttpGet(q);
         try {
             LOG.debug("Going to execute the Weather query {}", q);
diff --git a/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherQuery.java b/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherQuery.java
index 3f1ce1fdc9f..727121f353a 100644
--- a/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherQuery.java
+++ b/components/camel-weather/src/main/java/org/apache/camel/component/weather/WeatherQuery.java
@@ -17,7 +17,6 @@
 package org.apache.camel.component.weather;
 
 import org.apache.camel.component.weather.geolocation.GeoLocation;
-import org.apache.camel.component.weather.geolocation.GeoLocationProvider;
 
 import static org.apache.camel.component.weather.WeatherMode.JSON;
 import static org.apache.camel.util.ObjectHelper.isEmpty;
@@ -28,7 +27,6 @@ import static org.apache.camel.util.ObjectHelper.isEmpty;
  */
 public class WeatherQuery {
     private final WeatherConfiguration weatherConfiguration;
-    private GeoLocationProvider geoLocationProvider;
 
     public WeatherQuery(WeatherConfiguration weatherConfiguration) {
         this.weatherConfiguration = weatherConfiguration;
@@ -147,10 +145,7 @@ public class WeatherQuery {
     }
 
     GeoLocation getCurrentGeoLocation() throws Exception {
-        return geoLocationProvider.getCurrentGeoLocation();
+        return weatherConfiguration.getGeoLocationProvider().getCurrentGeoLocation();
     }
 
-    void setGeoLocationProvider(GeoLocationProvider geoLocationProvider) {
-        this.geoLocationProvider = geoLocationProvider;
-    }
 }
diff --git a/components/camel-weather/src/main/java/org/apache/camel/component/weather/geolocation/FreeGeoIpGeoLocationProvider.java b/components/camel-weather/src/main/java/org/apache/camel/component/weather/geolocation/FreeGeoIpGeoLocationProvider.java
index 45e377d802b..c74ae273925 100644
--- a/components/camel-weather/src/main/java/org/apache/camel/component/weather/geolocation/FreeGeoIpGeoLocationProvider.java
+++ b/components/camel-weather/src/main/java/org/apache/camel/component/weather/geolocation/FreeGeoIpGeoLocationProvider.java
@@ -18,7 +18,7 @@ package org.apache.camel.component.weather.geolocation;
 
 import com.fasterxml.jackson.databind.JsonNode;
 import com.fasterxml.jackson.databind.ObjectMapper;
-import org.apache.camel.component.weather.WeatherComponent;
+import org.apache.camel.component.weather.WeatherConfiguration;
 import org.apache.http.HttpResponse;
 import org.apache.http.HttpStatus;
 import org.apache.http.client.HttpClient;
@@ -30,23 +30,23 @@ import static org.apache.camel.util.ObjectHelper.notNull;
 
 public class FreeGeoIpGeoLocationProvider implements GeoLocationProvider {
 
-    private final WeatherComponent component;
+    private final WeatherConfiguration configuration;
 
-    public FreeGeoIpGeoLocationProvider(WeatherComponent component, String accessKey) {
-        this.component = component;
+    public FreeGeoIpGeoLocationProvider(WeatherConfiguration configuration) {
+        this.configuration = configuration;
     }
 
     @Override
     public GeoLocation getCurrentGeoLocation() throws Exception {
-        HttpClient httpClient = component.getHttpClient();
-        if (isEmpty(component.getGeolocationAccessKey())) {
+        HttpClient httpClient = configuration.getHttpClient();
+        if (isEmpty(configuration.getGeolocationAccessKey())) {
             throw new IllegalStateException("The geolocation service requires a mandatory geolocationAccessKey");
         }
-        if (isEmpty(component.getGeolocationRequestHostIP())) {
+        if (isEmpty(configuration.getGeolocationRequestHostIP())) {
             throw new IllegalStateException("The geolocation service requires a mandatory geolocationRequestHostIP");
         }
 
-        String url = String.format("http://api.ipstack.com/%s?access_key=%s&legacy=1&output=json", component.getGeolocationRequestHostIP(), component.getGeolocationAccessKey());
+        String url = String.format("http://api.ipstack.com/%s?access_key=%s&legacy=1&output=json", configuration.getGeolocationRequestHostIP(), configuration.getGeolocationAccessKey());
         HttpGet getMethod = new HttpGet(url);
         try {
             HttpResponse response = httpClient.execute(getMethod);
diff --git a/components/camel-weather/src/test/java/org/apache/camel/component/weather/CurrentWeatherConsumerGeolocationProviderTest.java b/components/camel-weather/src/test/java/org/apache/camel/component/weather/CurrentWeatherConsumerGeolocationProviderTest.java
new file mode 100644
index 00000000000..2795c5e60d7
--- /dev/null
+++ b/components/camel-weather/src/test/java/org/apache/camel/component/weather/CurrentWeatherConsumerGeolocationProviderTest.java
@@ -0,0 +1,44 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.camel.component.weather;
+
+import org.apache.camel.test.junit4.CamelTestSupport;
+import org.junit.Test;
+
+public class CurrentWeatherConsumerGeolocationProviderTest extends CamelTestSupport {
+
+    private static final String APPID = "test";
+    private static final String GEOLOCATION_ACCESS_KEY = "IPSTACK_ACCESS_KEY";
+    private static final String GEOLOCATION_REQUEST_HOST_IP = "LOCAL_IP";
+    
+
+    @Test
+    public void checkGeolocationProviderConfig() {
+        WeatherEndpoint endpoint = context().getEndpoint("weather:foo?"
+            + "geolocationRequestHostIP=" + GEOLOCATION_REQUEST_HOST_IP 
+            + "&geolocationAccessKey=" + GEOLOCATION_ACCESS_KEY 
+            + "&appid=" + APPID, 
+            WeatherEndpoint.class);
+
+        WeatherConfiguration configuration = endpoint.getConfiguration();
+        assertEquals(APPID, configuration.getAppid());
+        assertEquals(GEOLOCATION_ACCESS_KEY, configuration.getGeolocationAccessKey());
+        assertEquals(GEOLOCATION_REQUEST_HOST_IP, configuration.getGeolocationRequestHostIP());
+        assertNotNull(configuration.getGeoLocationProvider());
+    }
+
+}
diff --git a/components/camel-weather/src/test/java/org/apache/camel/component/weather/WeatherQueryTest.java b/components/camel-weather/src/test/java/org/apache/camel/component/weather/WeatherQueryTest.java
index d2fe2fa7112..e0065493c0d 100644
--- a/components/camel-weather/src/test/java/org/apache/camel/component/weather/WeatherQueryTest.java
+++ b/components/camel-weather/src/test/java/org/apache/camel/component/weather/WeatherQueryTest.java
@@ -24,8 +24,8 @@ import org.junit.runner.RunWith;
 import org.mockito.Mock;
 import org.mockito.junit.MockitoJUnitRunner;
 
+import static org.hamcrest.MatcherAssert.assertThat;
 import static org.hamcrest.core.Is.is;
-import static org.junit.Assert.assertThat;
 import static org.mockito.Mockito.when;
 
 @RunWith(MockitoJUnitRunner.class)
@@ -49,7 +49,7 @@ public class WeatherQueryTest {
 
     @Test
     public void testBoxedQuery() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setLon("4");
         weatherConfiguration.setLat("52");
         weatherConfiguration.setRightLon("6");
@@ -58,14 +58,14 @@ public class WeatherQueryTest {
         weatherConfiguration.setUnits(WeatherUnits.METRIC);
         weatherConfiguration.setAppid(APPID);
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/box/city?bbox=4,52,6,54,8&cluster=yes&lang=en&units=metric&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
 
     @Test
     public void testBoxedStationQuery() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setLon("4");
         weatherConfiguration.setLat("52");
         weatherConfiguration.setRightLon("6");
@@ -75,68 +75,68 @@ public class WeatherQueryTest {
         weatherConfiguration.setAppid(APPID);
         weatherConfiguration.setWeatherApi(WeatherApi.Station);
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/box/station?bbox=4,52,6,54,8&cluster=yes&lang=en&units=metric&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
 
     @Test
     public void testLatLonQuery() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setLon("4");
         weatherConfiguration.setLat("52");
         weatherConfiguration.setMode(WeatherMode.XML);
         weatherConfiguration.setLanguage(WeatherLanguage.nl);
         weatherConfiguration.setAppid(APPID);
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/weather?lat=52&lon=4&lang=nl&mode=xml&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
 
     @Test
     public void testZipQuery() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setZip("2493CJ,nl");
         weatherConfiguration.setMode(WeatherMode.XML);
         weatherConfiguration.setLanguage(WeatherLanguage.nl);
         weatherConfiguration.setAppid(APPID);
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/weather?zip=2493CJ,nl&lang=nl&mode=xml&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
 
     @Test
     public void testSingleIdQuery() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setIds("524901");
         weatherConfiguration.setMode(WeatherMode.XML);
         weatherConfiguration.setLanguage(WeatherLanguage.nl);
         weatherConfiguration.setAppid(APPID);
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/weather?id=524901&lang=nl&mode=xml&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
 
     @Test
     public void testSingleIdDailyForecastQuery() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setIds("524901");
         weatherConfiguration.setMode(WeatherMode.XML);
         weatherConfiguration.setLanguage(WeatherLanguage.nl);
         weatherConfiguration.setAppid(APPID);
         weatherConfiguration.setPeriod("20");
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/forecast/daily?id=524901&lang=nl&cnt=20&mode=xml&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
 
     @Test
     public void testSingleIdHourlyForecastQuery() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setIds("524901");
         weatherConfiguration.setMode(WeatherMode.XML);
         weatherConfiguration.setLanguage(WeatherLanguage.nl);
@@ -144,41 +144,41 @@ public class WeatherQueryTest {
         weatherConfiguration.setWeatherApi(WeatherApi.Hourly);
         weatherConfiguration.setPeriod("20");
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/forecast?id=524901&lang=nl&cnt=20&mode=xml&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
 
     @Test
     public void testSingleIdStationQuery() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setIds("52");
         weatherConfiguration.setMode(WeatherMode.JSON);
         weatherConfiguration.setLanguage(WeatherLanguage.nl);
         weatherConfiguration.setAppid(APPID);
         weatherConfiguration.setWeatherApi(WeatherApi.Station);
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/station?id=52&lang=nl&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
 
     @Test
     public void testMultiIdQuery() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setIds("524901,703448");
         weatherConfiguration.setMode(WeatherMode.JSON);
         weatherConfiguration.setLanguage(WeatherLanguage.nl);
         weatherConfiguration.setAppid(APPID);
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/group?id=524901,703448&lang=nl&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
 
     @Test
     public void testFindInCircleQuery() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setLat(LATITUDE);
         weatherConfiguration.setLon(LONGITUDE);
         weatherConfiguration.setCnt(25);
@@ -186,14 +186,14 @@ public class WeatherQueryTest {
         weatherConfiguration.setLanguage(WeatherLanguage.nl);
         weatherConfiguration.setAppid(APPID);
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/find?lat=51.98&lon=4.13&lang=nl&cnt=25&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
 
     @Test
     public void testFindStationInCircleQuery() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setLat(LATITUDE);
         weatherConfiguration.setLon(LONGITUDE);
         weatherConfiguration.setCnt(25);
@@ -202,28 +202,28 @@ public class WeatherQueryTest {
         weatherConfiguration.setAppid(APPID);
         weatherConfiguration.setWeatherApi(WeatherApi.Station);
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/station/find?lat=51.98&lon=4.13&lang=nl&cnt=25&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
 
     @Test
     public void testCurrentLocationQuery() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setMode(WeatherMode.XML);
         weatherConfiguration.setPeriod("3");
         weatherConfiguration.setLanguage(WeatherLanguage.nl);
         weatherConfiguration.setUnits(WeatherUnits.IMPERIAL);
         weatherConfiguration.setAppid(APPID);
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/forecast/daily?lat=51.98&lon=4.13&lang=nl&cnt=3&units=imperial&mode=xml&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
 
     @Test
     public void testCurrentLocationHourlyQuery() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setMode(WeatherMode.XML);
         weatherConfiguration.setPeriod("3");
         weatherConfiguration.setLanguage(WeatherLanguage.nl);
@@ -231,14 +231,14 @@ public class WeatherQueryTest {
         weatherConfiguration.setAppid(APPID);
         weatherConfiguration.setWeatherApi(WeatherApi.Hourly);
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/forecast?lat=51.98&lon=4.13&lang=nl&cnt=3&units=imperial&mode=xml&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
 
     @Test
     public void testCurrentLocationQuery2() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setMode(WeatherMode.XML);
         weatherConfiguration.setLocation("current");
         weatherConfiguration.setPeriod("3");
@@ -246,20 +246,20 @@ public class WeatherQueryTest {
         weatherConfiguration.setUnits(WeatherUnits.IMPERIAL);
         weatherConfiguration.setAppid(APPID);
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/forecast/daily?lat=51.98&lon=4.13&lang=nl&cnt=3&units=imperial&mode=xml&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
     @Test
     public void testGivenLocation() throws Exception {
-        WeatherConfiguration weatherConfiguration = new WeatherConfiguration(new WeatherComponent());
+        WeatherConfiguration weatherConfiguration = new WeatherConfiguration();
         weatherConfiguration.setMode(WeatherMode.XML);
         weatherConfiguration.setLocation("Scheveningen,NL");
         weatherConfiguration.setLanguage(WeatherLanguage.nl);
         weatherConfiguration.setUnits(WeatherUnits.IMPERIAL);
         weatherConfiguration.setAppid(APPID);
         WeatherQuery weatherQuery = new WeatherQuery(weatherConfiguration);
-        weatherQuery.setGeoLocationProvider(geoLocationProvider);
+        weatherConfiguration.setGeoLocationProvider(geoLocationProvider);
         String query = weatherQuery.getQuery();
         assertThat(query, is("http://api.openweathermap.org/data/2.5/weather?q=Scheveningen,NL&lang=nl&units=imperial&mode=xml&APPID=9162755b2efa555823cfe0451d7fff38"));
     }
diff --git a/core/camel-componentdsl/src/generated/java/org/apache/camel/builder/component/dsl/WeatherComponentBuilderFactory.java b/core/camel-componentdsl/src/generated/java/org/apache/camel/builder/component/dsl/WeatherComponentBuilderFactory.java
index 66a6c9ccfd1..a962bbce514 100644
--- a/core/camel-componentdsl/src/generated/java/org/apache/camel/builder/component/dsl/WeatherComponentBuilderFactory.java
+++ b/core/camel-componentdsl/src/generated/java/org/apache/camel/builder/component/dsl/WeatherComponentBuilderFactory.java
@@ -102,20 +102,6 @@ public interface WeatherComponentBuilderFactory {
             doSetProperty("basicPropertyBinding", basicPropertyBinding);
             return this;
         }
-        /**
-         * To use an existing configured http client (for example with http
-         * proxy).
-         * 
-         * The option is a:
-         * <code>org.apache.http.impl.client.CloseableHttpClient</code> type.
-         * 
-         * Group: advanced
-         */
-        default WeatherComponentBuilder httpClient(
-                org.apache.http.impl.client.CloseableHttpClient httpClient) {
-            doSetProperty("httpClient", httpClient);
-            return this;
-        }
     }
 
     class WeatherComponentBuilderImpl
@@ -136,7 +122,6 @@ public interface WeatherComponentBuilderFactory {
             case "bridgeErrorHandler": ((WeatherComponent) component).setBridgeErrorHandler((boolean) value); return true;
             case "lazyStartProducer": ((WeatherComponent) component).setLazyStartProducer((boolean) value); return true;
             case "basicPropertyBinding": ((WeatherComponent) component).setBasicPropertyBinding((boolean) value); return true;
-            case "httpClient": ((WeatherComponent) component).setHttpClient((org.apache.http.impl.client.CloseableHttpClient) value); return true;
             default: return false;
             }
         }
diff --git a/core/camel-endpointdsl/src/generated/java/org/apache/camel/builder/endpoint/StaticEndpointBuilders.java b/core/camel-endpointdsl/src/generated/java/org/apache/camel/builder/endpoint/StaticEndpointBuilders.java
index a71249e74ee..c3ff6d12c1c 100644
--- a/core/camel-endpointdsl/src/generated/java/org/apache/camel/builder/endpoint/StaticEndpointBuilders.java
+++ b/core/camel-endpointdsl/src/generated/java/org/apache/camel/builder/endpoint/StaticEndpointBuilders.java
@@ -14589,7 +14589,7 @@ public class StaticEndpointBuilders {
      * 
      * @param path name
      */
-    public static org.apache.camel.builder.endpoint.dsl.WeatherEndpointBuilderFactory.WeatherEndpointBuilder weather(
+    static org.apache.camel.builder.endpoint.dsl.WeatherEndpointBuilderFactory.WeatherEndpointBuilder weather(
             String path) {
         return org.apache.camel.builder.endpoint.dsl.WeatherEndpointBuilderFactory.endpointBuilder("weather", path);
     }
@@ -14610,7 +14610,7 @@ public class StaticEndpointBuilders {
      * instead of the default name
      * @param path name
      */
-    public static org.apache.camel.builder.endpoint.dsl.WeatherEndpointBuilderFactory.WeatherEndpointBuilder weather(
+    static org.apache.camel.builder.endpoint.dsl.WeatherEndpointBuilderFactory.WeatherEndpointBuilder weather(
             String componentName,
             String path) {
         return org.apache.camel.builder.endpoint.dsl.WeatherEndpointBuilderFactory.endpointBuilder(componentName, path);
diff --git a/core/camel-endpointdsl/src/generated/java/org/apache/camel/builder/endpoint/dsl/WeatherEndpointBuilderFactory.java b/core/camel-endpointdsl/src/generated/java/org/apache/camel/builder/endpoint/dsl/WeatherEndpointBuilderFactory.java
index 459b526fdff..e91f1fddd40 100644
--- a/core/camel-endpointdsl/src/generated/java/org/apache/camel/builder/endpoint/dsl/WeatherEndpointBuilderFactory.java
+++ b/core/camel-endpointdsl/src/generated/java/org/apache/camel/builder/endpoint/dsl/WeatherEndpointBuilderFactory.java
@@ -162,8 +162,7 @@ public interface WeatherEndpointBuilderFactory {
             return this;
         }
         /**
-         * The API to be use (current, forecast/3 hour, forecast daily,
-         * station).
+         * The API to use (current, forecast/3 hour, forecast daily, station).
          * 
          * The option is a:
          * <code>org.apache.camel.component.weather.WeatherApi</code> type.
@@ -175,8 +174,7 @@ public interface WeatherEndpointBuilderFactory {
             return this;
         }
         /**
-         * The API to be use (current, forecast/3 hour, forecast daily,
-         * station).
+         * The API to use (current, forecast/3 hour, forecast daily, station).
          * 
          * The option will be converted to a
          * <code>org.apache.camel.component.weather.WeatherApi</code> type.
@@ -932,6 +930,66 @@ public interface WeatherEndpointBuilderFactory {
             doSetProperty("basicPropertyBinding", basicPropertyBinding);
             return this;
         }
+        /**
+         * A custum geolocation provider to determine the longitude and latitude
+         * to use when no location information is set. The default implementaion
+         * uses the ipstack API and requires geolocationAccessKey and
+         * geolocationRequestHostIP.
+         * 
+         * The option is a:
+         * <code>org.apache.camel.component.weather.geolocation.GeoLocationProvider</code> type.
+         * 
+         * Group: advanced
+         */
+        default AdvancedWeatherEndpointConsumerBuilder geoLocationProvider(
+                Object geoLocationProvider) {
+            doSetProperty("geoLocationProvider", geoLocationProvider);
+            return this;
+        }
+        /**
+         * A custum geolocation provider to determine the longitude and latitude
+         * to use when no location information is set. The default implementaion
+         * uses the ipstack API and requires geolocationAccessKey and
+         * geolocationRequestHostIP.
+         * 
+         * The option will be converted to a
+         * <code>org.apache.camel.component.weather.geolocation.GeoLocationProvider</code> type.
+         * 
+         * Group: advanced
+         */
+        default AdvancedWeatherEndpointConsumerBuilder geoLocationProvider(
+                String geoLocationProvider) {
+            doSetProperty("geoLocationProvider", geoLocationProvider);
+            return this;
+        }
+        /**
+         * To use an existing configured http client (for example with http
+         * proxy).
+         * 
+         * The option is a:
+         * <code>org.apache.http.impl.client.CloseableHttpClient</code> type.
+         * 
+         * Group: advanced
+         */
+        default AdvancedWeatherEndpointConsumerBuilder httpClient(
+                Object httpClient) {
+            doSetProperty("httpClient", httpClient);
+            return this;
+        }
+        /**
+         * To use an existing configured http client (for example with http
+         * proxy).
+         * 
+         * The option will be converted to a
+         * <code>org.apache.http.impl.client.CloseableHttpClient</code> type.
+         * 
+         * Group: advanced
+         */
+        default AdvancedWeatherEndpointConsumerBuilder httpClient(
+                String httpClient) {
+            doSetProperty("httpClient", httpClient);
+            return this;
+        }
         /**
          * Sets whether synchronous processing should be strictly used, or Camel
          * is allowed to use asynchronous processing (if supported).
@@ -1086,8 +1144,7 @@ public interface WeatherEndpointBuilderFactory {
             return this;
         }
         /**
-         * The API to be use (current, forecast/3 hour, forecast daily,
-         * station).
+         * The API to use (current, forecast/3 hour, forecast daily, station).
          * 
          * The option is a:
          * <code>org.apache.camel.component.weather.WeatherApi</code> type.
@@ -1099,8 +1156,7 @@ public interface WeatherEndpointBuilderFactory {
             return this;
         }
         /**
-         * The API to be use (current, forecast/3 hour, forecast daily,
-         * station).
+         * The API to use (current, forecast/3 hour, forecast daily, station).
          * 
          * The option will be converted to a
          * <code>org.apache.camel.component.weather.WeatherApi</code> type.
@@ -1370,6 +1426,66 @@ public interface WeatherEndpointBuilderFactory {
             doSetProperty("basicPropertyBinding", basicPropertyBinding);
             return this;
         }
+        /**
+         * A custum geolocation provider to determine the longitude and latitude
+         * to use when no location information is set. The default implementaion
+         * uses the ipstack API and requires geolocationAccessKey and
+         * geolocationRequestHostIP.
+         * 
+         * The option is a:
+         * <code>org.apache.camel.component.weather.geolocation.GeoLocationProvider</code> type.
+         * 
+         * Group: advanced
+         */
+        default AdvancedWeatherEndpointProducerBuilder geoLocationProvider(
+                Object geoLocationProvider) {
+            doSetProperty("geoLocationProvider", geoLocationProvider);
+            return this;
+        }
+        /**
+         * A custum geolocation provider to determine the longitude and latitude
+         * to use when no location information is set. The default implementaion
+         * uses the ipstack API and requires geolocationAccessKey and
+         * geolocationRequestHostIP.
+         * 
+         * The option will be converted to a
+         * <code>org.apache.camel.component.weather.geolocation.GeoLocationProvider</code> type.
+         * 
+         * Group: advanced
+         */
+        default AdvancedWeatherEndpointProducerBuilder geoLocationProvider(
+                String geoLocationProvider) {
+            doSetProperty("geoLocationProvider", geoLocationProvider);
+            return this;
+        }
+        /**
+         * To use an existing configured http client (for example with http
+         * proxy).
+         * 
+         * The option is a:
+         * <code>org.apache.http.impl.client.CloseableHttpClient</code> type.
+         * 
+         * Group: advanced
+         */
+        default AdvancedWeatherEndpointProducerBuilder httpClient(
+                Object httpClient) {
+            doSetProperty("httpClient", httpClient);
+            return this;
+        }
+        /**
+         * To use an existing configured http client (for example with http
+         * proxy).
+         * 
+         * The option will be converted to a
+         * <code>org.apache.http.impl.client.CloseableHttpClient</code> type.
+         * 
+         * Group: advanced
+         */
+        default AdvancedWeatherEndpointProducerBuilder httpClient(
+                String httpClient) {
+            doSetProperty("httpClient", httpClient);
+            return this;
+        }
         /**
          * Sets whether synchronous processing should be strictly used, or Camel
          * is allowed to use asynchronous processing (if supported).
@@ -1525,8 +1641,7 @@ public interface WeatherEndpointBuilderFactory {
             return this;
         }
         /**
-         * The API to be use (current, forecast/3 hour, forecast daily,
-         * station).
+         * The API to use (current, forecast/3 hour, forecast daily, station).
          * 
          * The option is a:
          * <code>org.apache.camel.component.weather.WeatherApi</code> type.
@@ -1538,8 +1653,7 @@ public interface WeatherEndpointBuilderFactory {
             return this;
         }
         /**
-         * The API to be use (current, forecast/3 hour, forecast daily,
-         * station).
+         * The API to use (current, forecast/3 hour, forecast daily, station).
          * 
          * The option will be converted to a
          * <code>org.apache.camel.component.weather.WeatherApi</code> type.
@@ -1768,6 +1882,64 @@ public interface WeatherEndpointBuilderFactory {
             doSetProperty("basicPropertyBinding", basicPropertyBinding);
             return this;
         }
+        /**
+         * A custum geolocation provider to determine the longitude and latitude
+         * to use when no location information is set. The default implementaion
+         * uses the ipstack API and requires geolocationAccessKey and
+         * geolocationRequestHostIP.
+         * 
+         * The option is a:
+         * <code>org.apache.camel.component.weather.geolocation.GeoLocationProvider</code> type.
+         * 
+         * Group: advanced
+         */
+        default AdvancedWeatherEndpointBuilder geoLocationProvider(
+                Object geoLocationProvider) {
+            doSetProperty("geoLocationProvider", geoLocationProvider);
+            return this;
+        }
+        /**
+         * A custum geolocation provider to determine the longitude and latitude
+         * to use when no location information is set. The default implementaion
+         * uses the ipstack API and requires geolocationAccessKey and
+         * geolocationRequestHostIP.
+         * 
+         * The option will be converted to a
+         * <code>org.apache.camel.component.weather.geolocation.GeoLocationProvider</code> type.
+         * 
+         * Group: advanced
+         */
+        default AdvancedWeatherEndpointBuilder geoLocationProvider(
+                String geoLocationProvider) {
+            doSetProperty("geoLocationProvider", geoLocationProvider);
+            return this;
+        }
+        /**
+         * To use an existing configured http client (for example with http
+         * proxy).
+         * 
+         * The option is a:
+         * <code>org.apache.http.impl.client.CloseableHttpClient</code> type.
+         * 
+         * Group: advanced
+         */
+        default AdvancedWeatherEndpointBuilder httpClient(Object httpClient) {
+            doSetProperty("httpClient", httpClient);
+            return this;
+        }
+        /**
+         * To use an existing configured http client (for example with http
+         * proxy).
+         * 
+         * The option will be converted to a
+         * <code>org.apache.http.impl.client.CloseableHttpClient</code> type.
+         * 
+         * Group: advanced
+         */
+        default AdvancedWeatherEndpointBuilder httpClient(String httpClient) {
+            doSetProperty("httpClient", httpClient);
+            return this;
+        }
         /**
          * Sets whether synchronous processing should be strictly used, or Camel
          * is allowed to use asynchronous processing (if supported).
diff --git a/docs/user-manual/modules/ROOT/pages/camel-3x-upgrade-guide-3_5.adoc b/docs/user-manual/modules/ROOT/pages/camel-3x-upgrade-guide-3_5.adoc
index 2635f1a877c..950badc6334 100644
--- a/docs/user-manual/modules/ROOT/pages/camel-3x-upgrade-guide-3_5.adoc
+++ b/docs/user-manual/modules/ROOT/pages/camel-3x-upgrade-guide-3_5.adoc
@@ -14,3 +14,9 @@ and use the existing bean (for singleton scope) instead of creating a new instan
 === Camel Karaf
 
 The following features has been removed due they become not compatible with OSGi: `camel-couchbase`.
+
+=== camel-weather
+
+The option `httpClient` is now a query parameter.
+
+A new parameter `geoLocationProvider` was introduced to allow the use of a custom `GeolocationProvider` implementation.
