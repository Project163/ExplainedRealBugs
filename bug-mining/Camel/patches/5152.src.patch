diff --git a/components/camel-spring/src/test/java/org/apache/camel/spring/config/ConsumerTemplateMaximumCacheSizeTest.java b/components/camel-spring/src/test/java/org/apache/camel/spring/config/ConsumerTemplateMaximumCacheSizeTest.java
index e849d5b7026..db6b91415fb 100644
--- a/components/camel-spring/src/test/java/org/apache/camel/spring/config/ConsumerTemplateMaximumCacheSizeTest.java
+++ b/components/camel-spring/src/test/java/org/apache/camel/spring/config/ConsumerTemplateMaximumCacheSizeTest.java
@@ -16,18 +16,13 @@
  */
 package org.apache.camel.spring.config;
 
-import java.util.concurrent.TimeUnit;
-
 import org.apache.camel.CamelContext;
 import org.apache.camel.ConsumerTemplate;
-import org.apache.camel.Endpoint;
 import org.apache.camel.spring.SpringRunWithTestSupport;
 import org.junit.Test;
 import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.test.context.ContextConfiguration;
 
-import static org.awaitility.Awaitility.await;
-
 @ContextConfiguration
 public class ConsumerTemplateMaximumCacheSizeTest extends SpringRunWithTestSupport {
 
@@ -45,22 +40,6 @@ public class ConsumerTemplateMaximumCacheSizeTest extends SpringRunWithTestSuppo
         assertNotNull("Should lookup consumer template", lookup);
 
         assertEquals(50, template.getMaximumCacheSize());
-        assertEquals("Size should be 0", 0, template.getCurrentCacheSize());
-
-        // test that we cache around 50 producers to avoid it eating too much memory
-        for (int i = 0; i <= 55; i++) {
-            Endpoint e = context.getEndpoint("direct:queue:" + i);
-            template.receiveNoWait(e);
-        }
-
-        // the eviction is async so force cleanup
-        template.cleanUp();
-        await().atMost(2, TimeUnit.SECONDS).until(() -> template.getCurrentCacheSize() == 50);
-        assertEquals("Size should be 50", 50, template.getCurrentCacheSize());
-
-        // should be 0
-        template.stop();
-        assertEquals("Size should be 0", 0, template.getCurrentCacheSize());
     }
 
 }
diff --git a/components/camel-spring/src/test/java/org/apache/camel/spring/config/ProducerTemplateMaximumCacheSizeTest.java b/components/camel-spring/src/test/java/org/apache/camel/spring/config/ProducerTemplateMaximumCacheSizeTest.java
index e95eab4b81e..b21d56e05c4 100644
--- a/components/camel-spring/src/test/java/org/apache/camel/spring/config/ProducerTemplateMaximumCacheSizeTest.java
+++ b/components/camel-spring/src/test/java/org/apache/camel/spring/config/ProducerTemplateMaximumCacheSizeTest.java
@@ -16,18 +16,13 @@
  */
 package org.apache.camel.spring.config;
 
-import java.util.concurrent.TimeUnit;
-
 import org.apache.camel.CamelContext;
-import org.apache.camel.Endpoint;
 import org.apache.camel.ProducerTemplate;
 import org.apache.camel.spring.SpringRunWithTestSupport;
 import org.junit.Test;
 import org.springframework.beans.factory.annotation.Autowired;
 import org.springframework.test.context.ContextConfiguration;
 
-import static org.awaitility.Awaitility.await;
-
 @ContextConfiguration
 public class ProducerTemplateMaximumCacheSizeTest extends SpringRunWithTestSupport {
 
@@ -45,22 +40,6 @@ public class ProducerTemplateMaximumCacheSizeTest extends SpringRunWithTestSuppo
         assertNotNull("Should lookup producer template", lookup);
 
         assertEquals(50, template.getMaximumCacheSize());
-        assertEquals("Size should be 0", 0, template.getCurrentCacheSize());
-
-        // test that we cache at most 50 producers to avoid it eating to much memory
-        for (int i = 0; i < 53; i++) {
-            Endpoint e = context.getEndpoint("seda:queue:" + i);
-            template.sendBody(e, "Hello");
-        }
-
-        // the eviction is async so force cleanup
-        template.cleanUp();
-        await().atMost(2, TimeUnit.SECONDS).until(() -> template.getCurrentCacheSize() == 50);
-        assertEquals("Size should be 50", 50, template.getCurrentCacheSize());
-
-        // should be 0
-        template.stop();
-        assertEquals("Size should be 0", 0, template.getCurrentCacheSize());
     }
 
 }
\ No newline at end of file
diff --git a/core/camel-api/src/main/java/org/apache/camel/ConsumerTemplate.java b/core/camel-api/src/main/java/org/apache/camel/ConsumerTemplate.java
index 70d7964935b..6222a482680 100644
--- a/core/camel-api/src/main/java/org/apache/camel/ConsumerTemplate.java
+++ b/core/camel-api/src/main/java/org/apache/camel/ConsumerTemplate.java
@@ -85,7 +85,6 @@ public interface ConsumerTemplate extends Service {
     /**
      * Cleanup the cache (purging stale entries)
      */
-    @Deprecated
     void cleanUp();
 
     // Synchronous methods
diff --git a/core/camel-api/src/main/java/org/apache/camel/ProducerTemplate.java b/core/camel-api/src/main/java/org/apache/camel/ProducerTemplate.java
index 13ea61a4714..807c460f8d4 100644
--- a/core/camel-api/src/main/java/org/apache/camel/ProducerTemplate.java
+++ b/core/camel-api/src/main/java/org/apache/camel/ProducerTemplate.java
@@ -153,7 +153,6 @@ public interface ProducerTemplate extends Service {
     /**
      * Cleanup the cache (purging stale entries)
      */
-    @Deprecated
     void cleanUp();
 
     // Synchronous methods
diff --git a/core/camel-api/src/main/java/org/apache/camel/spi/ConsumerCache.java b/core/camel-api/src/main/java/org/apache/camel/spi/ConsumerCache.java
index 79bcfd3e342..d2ab04a1e76 100644
--- a/core/camel-api/src/main/java/org/apache/camel/spi/ConsumerCache.java
+++ b/core/camel-api/src/main/java/org/apache/camel/spi/ConsumerCache.java
@@ -116,7 +116,6 @@ public interface ConsumerCache extends Service {
     /**
      * Cleanup the cache (purging stale entries)
      */
-    @Deprecated
     void cleanUp();
 
     /**
diff --git a/core/camel-api/src/main/java/org/apache/camel/spi/ProducerCache.java b/core/camel-api/src/main/java/org/apache/camel/spi/ProducerCache.java
index 0eca02f9a19..75dcfb3aaa0 100644
--- a/core/camel-api/src/main/java/org/apache/camel/spi/ProducerCache.java
+++ b/core/camel-api/src/main/java/org/apache/camel/spi/ProducerCache.java
@@ -115,7 +115,6 @@ public interface ProducerCache extends Service {
     /**
      * Cleanup the cache (purging stale entries)
      */
-    @Deprecated
     void cleanUp();
 
     /**
diff --git a/core/camel-base/src/main/java/org/apache/camel/impl/engine/DefaultConsumerCache.java b/core/camel-base/src/main/java/org/apache/camel/impl/engine/DefaultConsumerCache.java
index 9167ef331ba..a3346e777be 100644
--- a/core/camel-base/src/main/java/org/apache/camel/impl/engine/DefaultConsumerCache.java
+++ b/core/camel-base/src/main/java/org/apache/camel/impl/engine/DefaultConsumerCache.java
@@ -24,6 +24,7 @@ import org.apache.camel.Endpoint;
 import org.apache.camel.Exchange;
 import org.apache.camel.FailedToCreateConsumerException;
 import org.apache.camel.PollingConsumer;
+import org.apache.camel.Producer;
 import org.apache.camel.spi.ConsumerCache;
 import org.apache.camel.spi.EndpointUtilizationStatistics;
 import org.apache.camel.support.CamelContextHelper;
@@ -47,7 +48,7 @@ public class DefaultConsumerCache extends ServiceSupport implements ConsumerCach
         this.source = source;
         this.camelContext = camelContext;
         this.maxCacheSize = cacheSize <= 0 ? CamelContextHelper.getMaximumCachePoolSize(camelContext) : cacheSize;
-        this.consumers = new PollingConsumerServicePool(Endpoint::createPollingConsumer, Consumer::getEndpoint, maxCacheSize);
+        this.consumers = createServicePool(camelContext, maxCacheSize);
         // only if JMX is enabled
         if (camelContext.getManagementStrategy().getManagementAgent() != null) {
             this.extendedStatistics = camelContext.getManagementStrategy().getManagementAgent().getStatisticsLevel().isExtended();
@@ -56,6 +57,10 @@ public class DefaultConsumerCache extends ServiceSupport implements ConsumerCach
         }
     }
 
+    protected PollingConsumerServicePool createServicePool(CamelContext camelContext, int cacheSize) {
+        return new PollingConsumerServicePool(Endpoint::createPollingConsumer, Consumer::getEndpoint, cacheSize);
+    }
+
     public boolean isExtendedStatistics() {
         return extendedStatistics;
     }
diff --git a/core/camel-base/src/main/java/org/apache/camel/impl/engine/DefaultConsumerTemplate.java b/core/camel-base/src/main/java/org/apache/camel/impl/engine/DefaultConsumerTemplate.java
index 9869699a8b7..3acec668bac 100644
--- a/core/camel-base/src/main/java/org/apache/camel/impl/engine/DefaultConsumerTemplate.java
+++ b/core/camel-base/src/main/java/org/apache/camel/impl/engine/DefaultConsumerTemplate.java
@@ -126,7 +126,7 @@ public class DefaultConsumerTemplate extends ServiceSupport implements ConsumerT
 
     @Override
     public Object receiveBody(String endpointUri, long timeout) {
-        Object answer = null;
+        Object answer;
         Exchange exchange = receive(endpointUri, timeout);
         try {
             answer = extractResultBody(exchange);
@@ -143,7 +143,7 @@ public class DefaultConsumerTemplate extends ServiceSupport implements ConsumerT
 
     @Override
     public Object receiveBodyNoWait(String endpointUri) {
-        Object answer = null;
+        Object answer;
         Exchange exchange = receiveNoWait(endpointUri);
         try {
             answer = extractResultBody(exchange);
@@ -161,7 +161,7 @@ public class DefaultConsumerTemplate extends ServiceSupport implements ConsumerT
     @Override
     @SuppressWarnings("unchecked")
     public <T> T receiveBody(String endpointUri, Class<T> type) {
-        Object answer = null;
+        Object answer;
         Exchange exchange = receive(endpointUri);
         try {
             answer = extractResultBody(exchange);
@@ -180,7 +180,7 @@ public class DefaultConsumerTemplate extends ServiceSupport implements ConsumerT
     @Override
     @SuppressWarnings("unchecked")
     public <T> T receiveBody(String endpointUri, long timeout, Class<T> type) {
-        Object answer = null;
+        Object answer;
         Exchange exchange = receive(endpointUri, timeout);
         try {
             answer = extractResultBody(exchange);
@@ -199,7 +199,7 @@ public class DefaultConsumerTemplate extends ServiceSupport implements ConsumerT
     @Override
     @SuppressWarnings("unchecked")
     public <T> T receiveBodyNoWait(String endpointUri, Class<T> type) {
-        Object answer = null;
+        Object answer;
         Exchange exchange = receiveNoWait(endpointUri);
         try {
             answer = extractResultBody(exchange);
diff --git a/core/camel-base/src/main/java/org/apache/camel/impl/engine/DefaultProducerCache.java b/core/camel-base/src/main/java/org/apache/camel/impl/engine/DefaultProducerCache.java
index f8405eb1368..edf61e98e20 100644
--- a/core/camel-base/src/main/java/org/apache/camel/impl/engine/DefaultProducerCache.java
+++ b/core/camel-base/src/main/java/org/apache/camel/impl/engine/DefaultProducerCache.java
@@ -64,7 +64,7 @@ public class DefaultProducerCache extends ServiceSupport implements ProducerCach
         this.source = source;
         this.camelContext = camelContext;
         this.maxCacheSize = cacheSize <= 0 ? CamelContextHelper.getMaximumCachePoolSize(camelContext) : cacheSize;
-        this.producers = new ProducerServicePool(Endpoint::createAsyncProducer, Producer::getEndpoint, maxCacheSize);
+        this.producers = createServicePool(camelContext, maxCacheSize);
 
         // only if JMX is enabled
         if (camelContext.getManagementStrategy() != null && camelContext.getManagementStrategy().getManagementAgent() != null) {
@@ -77,6 +77,10 @@ public class DefaultProducerCache extends ServiceSupport implements ProducerCach
         internalProcessor = new SharedCamelInternalProcessor(new CamelInternalProcessor.UnitOfWorkProcessorAdvice(null));
     }
 
+    protected ProducerServicePool createServicePool(CamelContext camelContext, int cacheSize) {
+        return new ProducerServicePool(Endpoint::createAsyncProducer, Producer::getEndpoint, cacheSize);
+    }
+
     @Override
     public boolean isEventNotifierEnabled() {
         return eventNotifierEnabled;
diff --git a/core/camel-base/src/main/java/org/apache/camel/impl/engine/PollingConsumerServicePool.java b/core/camel-base/src/main/java/org/apache/camel/impl/engine/PollingConsumerServicePool.java
index 38f426540c5..582856b8e04 100644
--- a/core/camel-base/src/main/java/org/apache/camel/impl/engine/PollingConsumerServicePool.java
+++ b/core/camel-base/src/main/java/org/apache/camel/impl/engine/PollingConsumerServicePool.java
@@ -1,3 +1,19 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
 package org.apache.camel.impl.engine;
 
 import java.util.function.Function;
diff --git a/core/camel-base/src/main/java/org/apache/camel/impl/engine/ProducerServicePool.java b/core/camel-base/src/main/java/org/apache/camel/impl/engine/ProducerServicePool.java
index 3bd7ddd7b0f..774ec692f79 100644
--- a/core/camel-base/src/main/java/org/apache/camel/impl/engine/ProducerServicePool.java
+++ b/core/camel-base/src/main/java/org/apache/camel/impl/engine/ProducerServicePool.java
@@ -1,3 +1,19 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
 package org.apache.camel.impl.engine;
 
 import java.util.function.Function;
diff --git a/core/camel-base/src/main/java/org/apache/camel/impl/engine/ServicePool.java b/core/camel-base/src/main/java/org/apache/camel/impl/engine/ServicePool.java
index 334df602d27..1456dab323c 100644
--- a/core/camel-base/src/main/java/org/apache/camel/impl/engine/ServicePool.java
+++ b/core/camel-base/src/main/java/org/apache/camel/impl/engine/ServicePool.java
@@ -88,7 +88,7 @@ abstract class ServicePool<S extends Service> extends ServiceSupport implements
      * Therefore we mark the entries to be evicted from this thread only,
      * and then let SinglePool and MultiPool handle the evictions when they are acquiring/releases producers/consumers.
      */
-    private void onEvict(S s) {
+    protected void onEvict(S s) {
         Endpoint e = getEndpoint.apply(s);
         Pool<S> p = pool.get(e);
         if (p != null) {
@@ -128,7 +128,9 @@ abstract class ServicePool<S extends Service> extends ServiceSupport implements
      * @param s the producer/consumer
      */
     public void release(Endpoint endpoint, S s) {
-        getPool(endpoint).release(s);
+        if (pool.containsKey(endpoint)) {
+            getPool(endpoint).release(s);
+        }
     }
 
     private Pool<S> getPool(Endpoint endpoint) {
@@ -173,9 +175,12 @@ abstract class ServicePool<S extends Service> extends ServiceSupport implements
 
     @Override
     protected void doStop() throws Exception {
+        cleanUp();
+
         pool.values().forEach(Pool::stop);
         pool.clear();
         if (cache != null) {
+            cache.values().forEach(ServicePool::stop);
             cache.clear();
         }
     }
@@ -297,8 +302,8 @@ abstract class ServicePool<S extends Service> extends ServiceSupport implements
             if (!evicts.isEmpty()) {
                 synchronized (this) {
                     if (!evicts.isEmpty()) {
-                        evicts.forEach(queue::remove);
                         evicts.forEach(this::doStop);
+                        evicts.forEach(queue::remove);
                         evicts.clear();
                         if (queue.isEmpty()) {
                             pool.remove(endpoint);
@@ -339,7 +344,6 @@ abstract class ServicePool<S extends Service> extends ServiceSupport implements
         public void stop() {
             queue.forEach(this::doStop);
             queue.clear();
-            evicts.clear();
             pool.remove(endpoint);
         }
 
diff --git a/core/camel-core-engine/src/main/java/org/apache/camel/impl/DefaultCamelContext.java b/core/camel-core-engine/src/main/java/org/apache/camel/impl/DefaultCamelContext.java
index be76067c2d5..c69fff26644 100644
--- a/core/camel-core-engine/src/main/java/org/apache/camel/impl/DefaultCamelContext.java
+++ b/core/camel-core-engine/src/main/java/org/apache/camel/impl/DefaultCamelContext.java
@@ -16,9 +16,10 @@
  */
 package org.apache.camel.impl;
 
-import javax.naming.Context;
 import java.util.Map;
 
+import javax.naming.Context;
+
 import org.apache.camel.CamelContext;
 import org.apache.camel.Consumer;
 import org.apache.camel.Endpoint;
@@ -28,7 +29,6 @@ import org.apache.camel.health.HealthCheckRegistry;
 import org.apache.camel.impl.converter.DefaultTypeConverter;
 import org.apache.camel.impl.engine.BeanProcessorFactoryResolver;
 import org.apache.camel.impl.engine.BeanProxyFactoryResolver;
-import org.apache.camel.impl.engine.PollingConsumerServicePool;
 import org.apache.camel.impl.engine.DefaultAsyncProcessorAwaitManager;
 import org.apache.camel.impl.engine.DefaultBeanIntrospection;
 import org.apache.camel.impl.engine.DefaultCamelBeanPostProcessor;
@@ -55,6 +55,7 @@ import org.apache.camel.impl.engine.DefaultUnitOfWorkFactory;
 import org.apache.camel.impl.engine.DefaultUuidGenerator;
 import org.apache.camel.impl.engine.EndpointKey;
 import org.apache.camel.impl.engine.HeadersMapFactoryResolver;
+import org.apache.camel.impl.engine.PollingConsumerServicePool;
 import org.apache.camel.impl.engine.ProducerServicePool;
 import org.apache.camel.impl.engine.PropertiesComponentFactoryResolver;
 import org.apache.camel.impl.engine.ReactiveExecutorResolver;
diff --git a/core/camel-core/src/test/java/org/apache/camel/impl/DefaultProducerCacheTest.java b/core/camel-core/src/test/java/org/apache/camel/impl/DefaultProducerCacheTest.java
index a80b67049b3..1e7c0a7711a 100644
--- a/core/camel-core/src/test/java/org/apache/camel/impl/DefaultProducerCacheTest.java
+++ b/core/camel-core/src/test/java/org/apache/camel/impl/DefaultProducerCacheTest.java
@@ -19,21 +19,25 @@ package org.apache.camel.impl;
 import java.util.Map;
 import java.util.concurrent.TimeUnit;
 import java.util.concurrent.atomic.AtomicInteger;
+import java.util.function.Function;
 
 import org.apache.camel.AsyncProducer;
 import org.apache.camel.CamelContext;
 import org.apache.camel.Consumer;
 import org.apache.camel.ContextTestSupport;
 import org.apache.camel.Endpoint;
+import org.apache.camel.EndpointAware;
 import org.apache.camel.Exchange;
 import org.apache.camel.Processor;
 import org.apache.camel.Producer;
 import org.apache.camel.impl.engine.DefaultProducerCache;
+import org.apache.camel.impl.engine.ProducerServicePool;
 import org.apache.camel.spi.EndpointUtilizationStatistics;
 import org.apache.camel.support.DefaultComponent;
 import org.apache.camel.support.DefaultEndpoint;
 import org.apache.camel.support.DefaultProducer;
 import org.apache.camel.support.service.ServiceSupport;
+import org.apache.camel.util.function.ThrowingFunction;
 import org.junit.Test;
 
 
@@ -41,6 +45,7 @@ import static org.awaitility.Awaitility.await;
 
 public class DefaultProducerCacheTest extends ContextTestSupport {
 
+    private final AtomicInteger producerCounter = new AtomicInteger();
     private final AtomicInteger stopCounter = new AtomicInteger();
     private final AtomicInteger shutdownCounter = new AtomicInteger();
 
@@ -146,6 +151,92 @@ public class DefaultProducerCacheTest extends ContextTestSupport {
         cache.stop();
     }
 
+    @Test
+    public void testCacheEvictWhileInUse() throws Exception {
+        producerCounter.set(0);
+
+        MyProducerCache cache = new MyProducerCache(this, context, 2);
+        cache.start();
+
+        assertEquals("Size should be 0", 0, cache.size());
+
+        Endpoint e = newEndpoint(false, 1);
+        e.setCamelContext(context);
+
+        AsyncProducer p1 = cache.acquireProducer(e);
+        assertEquals("Size should be 0", 0, cache.size());
+
+        AsyncProducer p2 = cache.acquireProducer(e);
+        assertEquals("Size should be 0", 0, cache.size());
+
+        cache.releaseProducer(e, p2);
+        cache.releaseProducer(e, p1);
+
+        assertEquals("Size should be 2", 2, cache.size());
+
+        // nothing has stopped yet
+        assertEquals(0, stopCounter.get());
+
+        p1 = cache.acquireProducer(e);
+        p2 = cache.acquireProducer(e);
+        AsyncProducer p3 = cache.acquireProducer(e);
+
+        assertEquals("Size should be 0", 0, cache.size());
+
+        // nothing has stopped yet even we have 3 producers and a cache limit of 2
+        assertEquals(0, stopCounter.get());
+
+        // force evict p1 while its in use (eg simulate someone else grabbing it while evicting race condition)
+        cache.forceEvict(p1);
+
+        // and should still not be stopped
+        assertEquals(0, stopCounter.get());
+
+        // now release the others back
+        cache.releaseProducer(e, p3);
+        cache.releaseProducer(e, p2);
+
+        // which should trigger the eviction run to stop one of the producers as we have 3 and the cache size is 2
+        assertEquals(1, stopCounter.get());
+
+        cache.stop();
+
+        // should have stopped all 3 when the cache is stopped
+        await().atMost(3, TimeUnit.SECONDS).untilAsserted(() -> assertEquals(3, stopCounter.get()));
+    }
+
+    private class MyProducerCache extends DefaultProducerCache {
+
+        private MyServicePool myServicePool;
+
+        public MyProducerCache(Object source, CamelContext camelContext, int cacheSize) {
+            super(source, camelContext, cacheSize);
+        }
+
+        @Override
+        protected ProducerServicePool createServicePool(CamelContext camelContext, int cacheSize) {
+            myServicePool = new MyServicePool(Endpoint::createAsyncProducer, Producer::getEndpoint, cacheSize);
+            return myServicePool;
+        }
+
+        public void forceEvict(AsyncProducer producer) {
+            myServicePool.onEvict(producer);
+        }
+
+    }
+
+    private class MyServicePool extends ProducerServicePool {
+
+        public MyServicePool(ThrowingFunction<Endpoint, AsyncProducer, Exception> creator, Function<AsyncProducer, Endpoint> getEndpoint, int capacity) {
+            super(creator, getEndpoint, capacity);
+        }
+
+        @Override
+        protected void onEvict(AsyncProducer asyncProducer) {
+            super.onEvict(asyncProducer);
+        }
+    }
+
     @Override
     public void setUp() throws Exception {
         super.setUp();
@@ -196,8 +287,11 @@ public class DefaultProducerCacheTest extends ContextTestSupport {
 
     private final class MyProducer extends DefaultProducer {
 
+        private int id;
+
         MyProducer(Endpoint endpoint) {
             super(endpoint);
+            id = producerCounter.incrementAndGet();
         }
 
         @Override
@@ -214,5 +308,10 @@ public class DefaultProducerCacheTest extends ContextTestSupport {
         protected void doShutdown() throws Exception {
             shutdownCounter.incrementAndGet();
         }
+
+        @Override
+        public String toString() {
+            return "MyProducer[" + id + "]";
+        }
     }
 }
