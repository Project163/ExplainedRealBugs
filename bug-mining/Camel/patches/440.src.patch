diff --git a/components/camel-mina/src/main/java/org/apache/camel/component/mina/MinaComponent.java b/components/camel-mina/src/main/java/org/apache/camel/component/mina/MinaComponent.java
index e1d07a26432..e9c2fb6bbb1 100644
--- a/components/camel-mina/src/main/java/org/apache/camel/component/mina/MinaComponent.java
+++ b/components/camel-mina/src/main/java/org/apache/camel/component/mina/MinaComponent.java
@@ -113,7 +113,31 @@ public class MinaComponent extends DefaultComponent {
         IoAcceptor acceptor = new VmPipeAcceptor();
         SocketAddress address = new VmPipeAddress(connectUri.getPort());
         IoConnector connector = new VmPipeConnector();
-        return new MinaEndpoint(uri, this, address, acceptor, null, connector, null, false, 0, false, false);
+
+        // connector config
+        configureCodecFactory("MinaProducer", connector.getDefaultConfig(), textline, encoding, codec);
+        if (minaLogger) {
+            connector.getFilterChain().addLast("logger", new LoggingFilter());
+        }
+
+        // acceptor connectorConfig
+        configureCodecFactory("MinaConsumer", acceptor.getDefaultConfig(), textline, encoding, codec);
+        if (minaLogger) {
+            acceptor.getFilterChain().addLast("logger", new LoggingFilter());
+        }
+
+        MinaEndpoint endpoint = new MinaEndpoint(uri, this, address, acceptor, null, connector, null, false, timeout, transferExchange, sync);
+        if (encoding != null) {
+            endpoint.setCharsetName(getEncodingParameter("MinaProducer", encoding).name());
+        }
+        // set sync or async mode after endpoint is created
+        if (sync) {
+            endpoint.setExchangePattern(ExchangePattern.InOut);
+        } else {
+            endpoint.setExchangePattern(ExchangePattern.InOnly);
+        }
+
+        return endpoint;
     }
 
     protected MinaEndpoint createSocketEndpoint(String uri, URI connectUri, Map parameters) {
@@ -123,7 +147,7 @@ public class MinaComponent extends DefaultComponent {
 
         // connector config
         SocketConnectorConfig connectorConfig = new SocketConnectorConfig();
-        configureSocketCodecFactory("MinaProducer", connectorConfig, textline, encoding, codec);
+        configureCodecFactory("MinaProducer", connectorConfig, textline, encoding, codec);
         if (minaLogger) {
             connectorConfig.getFilterChain().addLast("logger", new LoggingFilter());
         }
@@ -133,7 +157,7 @@ public class MinaComponent extends DefaultComponent {
 
         // acceptor connectorConfig
         SocketAcceptorConfig acceptorConfig = new SocketAcceptorConfig();
-        configureSocketCodecFactory("MinaConsumer", acceptorConfig, textline, encoding, codec);
+        configureCodecFactory("MinaConsumer", acceptorConfig, textline, encoding, codec);
         acceptorConfig.setReuseAddress(true);
         acceptorConfig.setDisconnectOnUnbind(true);
         if (minaLogger) {
@@ -154,7 +178,7 @@ public class MinaComponent extends DefaultComponent {
         return endpoint;
     }
 
-    protected void configureSocketCodecFactory(String type, IoServiceConfig config, boolean textline, String encoding, String codec) {
+    protected void configureCodecFactory(String type, IoServiceConfig config, boolean textline, String encoding, String codec) {
         ProtocolCodecFactory codecFactory = getCodecFactory(type, codec);
 
         if (codecFactory == null) {
@@ -217,7 +241,7 @@ public class MinaComponent extends DefaultComponent {
         return endpoint;
     }
 
-    private Charset getEncodingParameter(String type, String encoding) {
+    private static Charset getEncodingParameter(String type, String encoding) {
         if (encoding == null) {
             encoding = Charset.defaultCharset().name();
             if (LOG.isDebugEnabled()) {
diff --git a/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaCustomCodecTest.java b/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaCustomCodecTest.java
index 121a66743d0..6329be3d327 100644
--- a/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaCustomCodecTest.java
+++ b/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaCustomCodecTest.java
@@ -23,6 +23,7 @@ import org.apache.camel.component.mock.MockEndpoint;
 import org.apache.camel.impl.JndiRegistry;
 import org.apache.mina.common.ByteBuffer;
 import org.apache.mina.common.IoSession;
+import org.apache.mina.filter.codec.CumulativeProtocolDecoder;
 import org.apache.mina.filter.codec.ProtocolCodecFactory;
 import org.apache.mina.filter.codec.ProtocolDecoder;
 import org.apache.mina.filter.codec.ProtocolDecoderOutput;
@@ -41,7 +42,8 @@ public class MinaCustomCodecTest extends ContextTestSupport {
         mock.expectedMessageCount(1);
         mock.expectedBodiesReceived("Bye World");
 
-        template.requestBody(uri, "Hello World");
+        Object out = template.requestBody(uri, "Hello World");
+        assertEquals("Bye World", out);
 
         mock.assertIsSatisfied();
     }
@@ -90,20 +92,15 @@ public class MinaCustomCodecTest extends ContextTestSupport {
         }
 
         public ProtocolDecoder getDecoder() throws Exception {
-            return new ProtocolDecoder() {
-                public void decode(IoSession ioSession, ByteBuffer in,
-                                   ProtocolDecoderOutput out) throws Exception {
-                    in.acquire();
-                    out.write(in);
-                }
-
-                public void finishDecode(IoSession ioSession, ProtocolDecoderOutput protocolDecoderOutput)
-                    throws Exception {
-                    // do nothing
-                }
-
-                public void dispose(IoSession ioSession) throws Exception {
-                    // do nothing
+            return new CumulativeProtocolDecoder() {
+                protected boolean doDecode(IoSession session, ByteBuffer in, ProtocolDecoderOutput out) throws Exception {
+                    if (in.remaining() > 0) {
+                        byte[] buf = MinaConverter.toByteArray(in);
+                        out.write(new String(buf));
+                        return true;
+                    } else {
+                        return false;
+                    }
                 }
             };
         }
diff --git a/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaTransferExchangeOptionTest.java b/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaTransferExchangeOptionTest.java
index ad8b35775b5..dc1f8cb38f2 100644
--- a/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaTransferExchangeOptionTest.java
+++ b/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaTransferExchangeOptionTest.java
@@ -36,7 +36,7 @@ import org.apache.camel.builder.RouteBuilder;
  */
 public class MinaTransferExchangeOptionTest extends ContextTestSupport {
 
-    private static final String URI = "mina:tcp://localhost:6321?sync=true&encoding=UTF-8&transferExchange=true";
+    protected String uri = "mina:tcp://localhost:6321?sync=true&encoding=UTF-8&transferExchange=true";
 
     public void testMianTransferExchangeOptionWithoutException() throws Exception {
         Exchange exchange = sendExchange(false);
@@ -49,7 +49,7 @@ public class MinaTransferExchangeOptionTest extends ContextTestSupport {
     }
 
     private Exchange sendExchange(boolean setException) throws Exception {
-        Endpoint endpoint = context.getEndpoint(URI);
+        Endpoint endpoint = context.getEndpoint(uri);
         Exchange exchange = endpoint.createExchange();
 
         Message message = exchange.getIn();
@@ -92,7 +92,7 @@ public class MinaTransferExchangeOptionTest extends ContextTestSupport {
     protected RouteBuilder createRouteBuilder() {
         return new RouteBuilder() {
             public void configure() {
-                from(URI).process(new Processor() {
+                from(uri).process(new Processor() {
                     public void process(Exchange e) throws InterruptedException {
                         Assert.assertNotNull(e.getIn().getBody());
                         Assert.assertNotNull(e.getIn().getHeaders());
diff --git a/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaVMCustomCodecTest.java b/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaVMCustomCodecTest.java
new file mode 100644
index 00000000000..911cf3ed492
--- /dev/null
+++ b/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaVMCustomCodecTest.java
@@ -0,0 +1,109 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.camel.component.mina;
+
+import org.apache.camel.ContextTestSupport;
+import org.apache.camel.ResolveEndpointFailedException;
+import org.apache.camel.builder.RouteBuilder;
+import org.apache.camel.component.mock.MockEndpoint;
+import org.apache.camel.impl.JndiRegistry;
+import org.apache.mina.common.ByteBuffer;
+import org.apache.mina.common.IoSession;
+import org.apache.mina.filter.codec.CumulativeProtocolDecoder;
+import org.apache.mina.filter.codec.ProtocolCodecFactory;
+import org.apache.mina.filter.codec.ProtocolDecoder;
+import org.apache.mina.filter.codec.ProtocolDecoderOutput;
+import org.apache.mina.filter.codec.ProtocolEncoder;
+import org.apache.mina.filter.codec.ProtocolEncoderOutput;
+
+/**
+ * Unit test with custom codec using the VM protocol.
+ */
+public class MinaVMCustomCodecTest extends ContextTestSupport {
+
+    private String uri = "mina:vm://localhost:11301?sync=true&codec=myCodec";
+
+    public void testMyCodec() throws Exception {
+        MockEndpoint mock = getMockEndpoint("mock:result");
+        mock.expectedMessageCount(1);
+        mock.expectedBodiesReceived("Bye World");
+
+        Object out = template.requestBody(uri, "Hello World");
+        assertEquals("Bye World", out);
+
+        mock.assertIsSatisfied();
+    }
+
+    public void testBadConfiguration() throws Exception {
+        try {
+            template.sendBody("mina:vm://localhost:11300?sync=true&codec=XXX", "Hello World");
+            fail("Should have thrown a ResolveEndpointFailedException");
+        } catch (ResolveEndpointFailedException e) {
+            // ok
+        }
+    }
+
+    protected JndiRegistry createRegistry() throws Exception {
+        JndiRegistry jndi = super.createRegistry();
+        jndi.bind("myCodec", new MyCodec());
+        return jndi;
+    }
+
+    protected RouteBuilder createRouteBuilder() throws Exception {
+        return new RouteBuilder() {
+            public void configure() throws Exception {
+                from(uri).transform(constant("Bye World")).to("mock:result");
+            }
+        };
+    }
+
+    private class MyCodec implements ProtocolCodecFactory {
+
+        public ProtocolEncoder getEncoder() throws Exception {
+            return new ProtocolEncoder() {
+                public void encode(IoSession ioSession, Object message, ProtocolEncoderOutput out)
+                    throws Exception {
+                    ByteBuffer bb = ByteBuffer.allocate(32).setAutoExpand(true);
+                    String s = (String) message;
+                    bb.put(s.getBytes());
+                    bb.flip();
+                    out.write(bb);
+                }
+
+                public void dispose(IoSession ioSession) throws Exception {
+                    // do nothing
+                }
+            };
+
+        }
+
+        public ProtocolDecoder getDecoder() throws Exception {
+            return new CumulativeProtocolDecoder() {
+                protected boolean doDecode(IoSession session, ByteBuffer in, ProtocolDecoderOutput out) throws Exception {
+                    if (in.remaining() > 0) {
+                        byte[] buf = MinaConverter.toByteArray(in);
+                        out.write(new String(buf));
+                        return true;
+                    } else {
+                        return false;
+                    }
+                }
+            };
+        }
+    }
+
+}
\ No newline at end of file
diff --git a/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaVMFileTcpTest.java b/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaVMFileTcpTest.java
new file mode 100644
index 00000000000..632103f255b
--- /dev/null
+++ b/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaVMFileTcpTest.java
@@ -0,0 +1,46 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.camel.component.mina;
+
+import org.apache.camel.ContextTestSupport;
+import org.apache.camel.builder.RouteBuilder;
+import org.apache.camel.component.mock.MockEndpoint;
+
+/**
+ * @version $Revision$
+ */
+public class MinaVMFileTcpTest extends ContextTestSupport {
+
+    public void testMinaRoute() throws Exception {
+        MockEndpoint endpoint = getMockEndpoint("mock:results");
+        endpoint.expectedMessageCount(1);
+
+        assertMockEndpointsSatisfied();
+    }
+
+    protected RouteBuilder createRouteBuilder() {
+        return new RouteBuilder() {
+            public void configure() {
+                // lets setup a server
+                from("mina:vm://localhost:9123").to("mock:results");
+
+                from("file:src/test/data?noop=true").
+                        to("mina:vm://localhost:9123");
+            }
+        };
+    }
+}
\ No newline at end of file
diff --git a/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaVMTextlineProtocolTest.java b/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaVMTextlineProtocolTest.java
new file mode 100644
index 00000000000..3f61644f219
--- /dev/null
+++ b/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaVMTextlineProtocolTest.java
@@ -0,0 +1,28 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.camel.component.mina;
+
+/**
+ * @version $Revision$
+ */
+public class MinaVMTextlineProtocolTest extends MinaVmTest {
+    @Override
+    protected void setUp() throws Exception {
+        uri = "mina:vm://localhost:6124?textline=true&sync=false";
+        super.setUp();
+    }
+}
\ No newline at end of file
diff --git a/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaVMTransferExchangeOptionTest.java b/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaVMTransferExchangeOptionTest.java
new file mode 100644
index 00000000000..5d6f14e7c0a
--- /dev/null
+++ b/components/camel-mina/src/test/java/org/apache/camel/component/mina/MinaVMTransferExchangeOptionTest.java
@@ -0,0 +1,32 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.camel.component.mina;
+
+/**
+ * Unit test for the <tt>transferExchange=true</tt> option.
+ *
+ * @version $Revision$
+ */
+public class MinaVMTransferExchangeOptionTest extends MinaTransferExchangeOptionTest {
+
+    @Override
+    protected void setUp() throws Exception {
+        uri = "mina:vm://localhost:6321?sync=true&encoding=UTF-8&transferExchange=true";
+        super.setUp();
+    }
+
+}
\ No newline at end of file
diff --git a/components/camel-mina/src/test/resources/log4j.properties b/components/camel-mina/src/test/resources/log4j.properties
index 19c8c3e6d8a..ad1c86c87be 100644
--- a/components/camel-mina/src/test/resources/log4j.properties
+++ b/components/camel-mina/src/test/resources/log4j.properties
@@ -32,4 +32,5 @@ log4j.appender.file.layout.ConversionPattern=%d %-5p %c{1} - %m %n
 log4j.appender.file.file=target/camel-mina-test.log
 
 # debug logging for camel-mina
-#log4j.logger.org.apache.camel.component.mina=DEBUG
+log4j.logger.org.apache.camel.component.mina=DEBUG
+#log4j.logger.org.apache.camel=DEBUG
