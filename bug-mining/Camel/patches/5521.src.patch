diff --git a/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackAck.java b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackAck.java
new file mode 100644
index 00000000000..8178b23ff44
--- /dev/null
+++ b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackAck.java
@@ -0,0 +1,35 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.camel.component.lumberjack.io;
+
+public class LumberjackAck {
+    private final byte version;
+    private final int windowSize;
+
+    public LumberjackAck(byte version, int windowSize) {
+        this.version = version;
+        this.windowSize = windowSize;
+    }
+
+    public byte getVersion() {
+        return version;
+    }
+
+    public int getWindowSize() {
+        return windowSize;
+    }
+}
diff --git a/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackAckEncoder.java b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackAckEncoder.java
new file mode 100644
index 00000000000..93d2967b907
--- /dev/null
+++ b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackAckEncoder.java
@@ -0,0 +1,35 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.camel.component.lumberjack.io;
+
+import io.netty.buffer.ByteBuf;
+import io.netty.channel.ChannelHandlerContext;
+import io.netty.handler.codec.MessageToByteEncoder;
+import org.slf4j.Logger;
+import org.slf4j.LoggerFactory;
+
+public class LumberjackAckEncoder extends MessageToByteEncoder<LumberjackAck> {
+    private static final Logger LOG = LoggerFactory.getLogger(LumberjackAckEncoder.class);
+
+    @Override
+    protected void encode(ChannelHandlerContext channelHandlerContext, LumberjackAck lumberjackAck, ByteBuf byteBuf) {
+        LOG.debug("Window size is {}, Version is {}. Sending ACK", lumberjackAck.getWindowSize(), lumberjackAck.getVersion());
+        byteBuf.writeByte(lumberjackAck.getVersion());
+        byteBuf.writeByte('A');
+        byteBuf.writeInt(lumberjackAck.getWindowSize());
+    }
+}
diff --git a/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackChannelInitializer.java b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackChannelInitializer.java
index 6a0eca3150f..badbdfa1d47 100644
--- a/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackChannelInitializer.java
+++ b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackChannelInitializer.java
@@ -48,15 +48,10 @@ final class LumberjackChannelInitializer extends ChannelInitializer<Channel> {
             pipeline.addLast(new SslHandler(sslEngine));
         }
 
-        LumberjackSessionHandler sessionHandler = new LumberjackSessionHandler();
+        // add ack encoder
+        pipeline.addLast(new LumberjackAckEncoder());
 
-        // Add the primary lumberjack frame decoder
-        pipeline.addLast(new LumberjackFrameDecoder(sessionHandler));
-
-        // Add the secondary lumberjack frame decoder, used when the first one is processing compressed frames
-        pipeline.addLast(new LumberjackFrameDecoder(sessionHandler));
-
-        // Add the bridge to Camel
-        pipeline.addLast(messageExecutorService, new LumberjackMessageHandler(sessionHandler, messageProcessor));
+        // Add the lumberjack frame decoder and bridge to Camel
+        pipeline.addLast(messageExecutorService, new LumberjackFrameDecoder(), new LumberjackMessageHandler(messageProcessor));
     }
 }
diff --git a/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackConstants.java b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackConstants.java
index 81895deeafc..deb0a6ff76f 100644
--- a/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackConstants.java
+++ b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackConstants.java
@@ -17,8 +17,8 @@
 package org.apache.camel.component.lumberjack.io;
 
 final class LumberjackConstants {
-    static final int VERSION_V1 = '1';
-    static final int VERSION_V2 = '2';
+    static final byte VERSION_V1 = '1';
+    static final byte VERSION_V2 = '2';
 
     static final int TYPE_ACKNOWLEDGE = 'A';
 
@@ -31,8 +31,6 @@ final class LumberjackConstants {
 
     static final int FRAME_HEADER_LENGTH = 1 + 1; // version(byte) + type(byte)
 
-    static final int FRAME_ACKNOWLEDGE_LENGTH = FRAME_HEADER_LENGTH + INT_LENGTH; // sequence number(int)
-
     static final int FRAME_JSON_HEADER_LENGTH = INT_LENGTH + INT_LENGTH; // sequence number(int) + payload length(int)
 
     static final int FRAME_DATA_HEADER_LENGTH = INT_LENGTH + INT_LENGTH; // sequence number(int) + key/value pair count(int)
diff --git a/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackFrameDecoder.java b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackFrameDecoder.java
index 9ae60aa999f..b27ca86181c 100644
--- a/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackFrameDecoder.java
+++ b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackFrameDecoder.java
@@ -22,9 +22,11 @@ import java.util.LinkedHashMap;
 import java.util.List;
 import java.util.Map;
 import java.util.zip.Inflater;
+import java.util.zip.InflaterOutputStream;
 
 import com.fasterxml.jackson.databind.ObjectMapper;
 import io.netty.buffer.ByteBuf;
+import io.netty.buffer.ByteBufOutputStream;
 import io.netty.channel.ChannelHandlerContext;
 import io.netty.handler.codec.ByteToMessageDecoder;
 import org.slf4j.Logger;
@@ -40,6 +42,8 @@ import static org.apache.camel.component.lumberjack.io.LumberjackConstants.TYPE_
 import static org.apache.camel.component.lumberjack.io.LumberjackConstants.TYPE_DATA;
 import static org.apache.camel.component.lumberjack.io.LumberjackConstants.TYPE_JSON;
 import static org.apache.camel.component.lumberjack.io.LumberjackConstants.TYPE_WINDOW;
+import static org.apache.camel.component.lumberjack.io.LumberjackConstants.VERSION_V1;
+import static org.apache.camel.component.lumberjack.io.LumberjackConstants.VERSION_V2;
 
 /**
  * Decode lumberjack protocol frames. Support protocol V1 and V2 and frame types D, J, W and C.<br/>
@@ -57,12 +61,8 @@ import static org.apache.camel.component.lumberjack.io.LumberjackConstants.TYPE_
 final class LumberjackFrameDecoder extends ByteToMessageDecoder {
     private static final Logger LOG = LoggerFactory.getLogger(LumberjackFrameDecoder.class);
 
-    private final LumberjackSessionHandler sessionHandler;
     private final ObjectMapper jackson = new ObjectMapper();
-
-    LumberjackFrameDecoder(LumberjackSessionHandler sessionHandler) {
-        this.sessionHandler = sessionHandler;
-    }
+    private LumberjackWindow window;
 
     @Override
     protected void decode(ChannelHandlerContext ctx, ByteBuf in, List<Object> out) throws Exception {
@@ -76,8 +76,10 @@ final class LumberjackFrameDecoder extends ByteToMessageDecoder {
                 return;
             }
 
-            int frameVersion = in.readUnsignedByte();
-            sessionHandler.versionRead(frameVersion);
+            byte frameVersion = in.readByte();
+
+            // make sure we get the right version
+            verifyVersion(frameVersion);
 
             int frameType = in.readUnsignedByte();
             LOG.debug("Received a lumberjack frame of type {}", (char) frameType);
@@ -90,7 +92,7 @@ final class LumberjackFrameDecoder extends ByteToMessageDecoder {
                     frameDecoded = handleDataFrame(in, out);
                     break;
                 case TYPE_WINDOW:
-                    frameDecoded = handleWindowFrame(in);
+                    frameDecoded = handleWindowFrame(in, frameVersion, out);
                     break;
                 case TYPE_COMPRESS:
                     frameDecoded = handleCompressedFrame(ctx, in, out);
@@ -122,8 +124,8 @@ final class LumberjackFrameDecoder extends ByteToMessageDecoder {
 
         Object jsonMessage = jackson.readValue(jsonStr, Object.class);
 
-        // put message in the pipeline
-        out.add(new LumberjackMessage(sequenceNumber, jsonMessage));
+        window.addMessage(new LumberjackMessage(sequenceNumber, jsonMessage));
+        sendWindowIfComplete(out);
         return true;
     }
 
@@ -151,17 +153,27 @@ final class LumberjackFrameDecoder extends ByteToMessageDecoder {
             dataMessage.put(key, value);
         }
 
-        out.add(new LumberjackMessage(sequenceNumber, dataMessage));
+        window.addMessage(new LumberjackMessage(sequenceNumber, dataMessage));
+        sendWindowIfComplete(out);
         return true;
     }
 
-    private boolean handleWindowFrame(ByteBuf in) {
+    private boolean handleWindowFrame(ByteBuf in, byte frameVersion, List<Object> out) {
         if (!in.isReadable(FRAME_WINDOW_HEADER_LENGTH)) {
             return false;
         }
 
-        // update window size
-        sessionHandler.windowSizeRead(in.readInt());
+        // receive a new window in the pipeline while another one is still processing (should not happen)
+        // inspired from logstash-input-beats : https://github.com/logstash-plugins/logstash-input-beats
+        if (window != null) {
+            LOG.warn("New window size received but the current window was not complete, sending the current window");
+            out.add(window);
+            // init window for this pipeline
+            window = null;
+        }
+
+        int windowSize = in.readInt();
+        window = new LumberjackWindow(frameVersion, windowSize);
         return true;
     }
 
@@ -176,25 +188,24 @@ final class LumberjackFrameDecoder extends ByteToMessageDecoder {
         }
 
         // decompress payload
+        // inspired from logstash-input-beats : https://github.com/logstash-plugins/logstash-input-beats
         Inflater inflater = new Inflater();
-        if (in.hasArray()) {
-            inflater.setInput(in.array(), in.arrayOffset() + in.readerIndex(), compressedPayloadLength);
-            in.skipBytes(compressedPayloadLength);
-        } else {
-            byte[] array = new byte[compressedPayloadLength];
-            in.readBytes(array);
-            inflater.setInput(array);
+        ByteBuf decompressed = ctx.alloc().buffer(compressedPayloadLength);
+        try (
+             ByteBufOutputStream buffOutput = new ByteBufOutputStream(decompressed);
+             InflaterOutputStream inflaterStream = new InflaterOutputStream(buffOutput, inflater)) {
+            in.readBytes(inflaterStream, compressedPayloadLength);
+        } finally {
+            inflater.end();
         }
 
-        while (!inflater.finished()) {
-            ByteBuf decompressed = ctx.alloc().heapBuffer(1024, 1024);
-            byte[] outArray = decompressed.array();
-            int count = inflater.inflate(outArray, decompressed.arrayOffset(), decompressed.writableBytes());
-            decompressed.writerIndex(count);
-            // put data in the pipeline
-            out.add(decompressed);
+        try {
+            while (decompressed.readableBytes() > 0) {
+                decode(ctx, decompressed, out);
+            }
+        } finally {
+            decompressed.release();
         }
-
         return true;
     }
 
@@ -217,4 +228,29 @@ final class LumberjackFrameDecoder extends ByteToMessageDecoder {
         in.skipBytes(length);
         return str;
     }
+
+    /**
+     * reads version
+     *
+     * @param version
+     */
+    private void verifyVersion(byte version) {
+        if (this.window == null || this.window.getVersion() == -1) {
+            if (version != VERSION_V1 && version != VERSION_V2) {
+                throw new RuntimeException("Unsupported frame version=" + version);
+            }
+            LOG.debug("Lumberjack protocol version is {}", (char) version);
+        } else if (window.getVersion() != version) {
+            throw new IllegalStateException(
+                    "Protocol version changed during session from " + window.getVersion() + " to " + version);
+        }
+    }
+
+    public void sendWindowIfComplete(List<Object> out) {
+        if (window.isComplete()) {
+            out.add(window);
+            // init window to handle other windows
+            window = null;
+        }
+    }
 }
diff --git a/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackMessageHandler.java b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackMessageHandler.java
index ce47affaf5b..767803e582e 100644
--- a/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackMessageHandler.java
+++ b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackMessageHandler.java
@@ -26,16 +26,14 @@ import org.slf4j.LoggerFactory;
 /**
  * This handler connects the Netty pipeline to the Camel endpoint.
  */
-final class LumberjackMessageHandler extends SimpleChannelInboundHandler<LumberjackMessage> {
+final class LumberjackMessageHandler extends SimpleChannelInboundHandler<LumberjackWindow> {
     private static final Logger LOG = LoggerFactory.getLogger(LumberjackMessageHandler.class);
 
-    private final LumberjackSessionHandler sessionHandler;
     private final LumberjackMessageProcessor messageProcessor;
 
     private volatile boolean process = true;
 
-    LumberjackMessageHandler(LumberjackSessionHandler sessionHandler, LumberjackMessageProcessor messageProcessor) {
-        this.sessionHandler = sessionHandler;
+    LumberjackMessageHandler(LumberjackMessageProcessor messageProcessor) {
         this.messageProcessor = messageProcessor;
     }
 
@@ -50,18 +48,37 @@ final class LumberjackMessageHandler extends SimpleChannelInboundHandler<Lumberj
     }
 
     @Override
-    protected void channelRead0(ChannelHandlerContext ctx, LumberjackMessage msg) throws Exception {
-        if (process) {
-            messageProcessor.onMessageReceived(msg.getPayload(), success -> {
-                if (success) {
-                    sessionHandler.notifyMessageProcessed(ctx, msg.getSequenceNumber());
-                } else {
-                    ctx.close();
-
-                    // Mark that we shouldn't process the next messages that are already decoded and are waiting in netty queues
-                    process = false;
+    protected void channelRead0(ChannelHandlerContext ctx, LumberjackWindow window) throws Exception {
+        try {
+            for (LumberjackMessage msg : window) {
+                if (process) {
+                    messageProcessor.onMessageReceived(msg.getPayload(), success -> {
+                        if (success) {
+                            notifyMessageProcessed(ctx, msg.getSequenceNumber(), window);
+                        } else {
+                            ctx.close();
+                            // Mark that we shouldn't process the next messages that are already decoded and are waiting in netty queues
+                            process = false;
+                        }
+                    });
                 }
-            });
+            }
+        } finally {
+            ctx.flush();
         }
     }
+
+    /**
+     * Notify message processed if end of window
+     *
+     * @param ctx
+     * @param sequenceNumber
+     * @param window
+     */
+    private void notifyMessageProcessed(ChannelHandlerContext ctx, int sequenceNumber, LumberjackWindow window) {
+        if (sequenceNumber == window.getSize()) {
+            ctx.writeAndFlush(new LumberjackAck(window.getVersion(), sequenceNumber));
+        }
+    }
+
 }
diff --git a/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackSessionHandler.java b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackSessionHandler.java
deleted file mode 100644
index 7e49d7e7a39..00000000000
--- a/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackSessionHandler.java
+++ /dev/null
@@ -1,86 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.camel.component.lumberjack.io;
-
-import java.util.concurrent.Phaser;
-import java.util.concurrent.TimeUnit;
-
-import io.netty.buffer.ByteBuf;
-import io.netty.channel.ChannelHandlerContext;
-import org.slf4j.Logger;
-import org.slf4j.LoggerFactory;
-
-import static org.apache.camel.component.lumberjack.io.LumberjackConstants.FRAME_ACKNOWLEDGE_LENGTH;
-import static org.apache.camel.component.lumberjack.io.LumberjackConstants.TYPE_ACKNOWLEDGE;
-import static org.apache.camel.component.lumberjack.io.LumberjackConstants.VERSION_V1;
-import static org.apache.camel.component.lumberjack.io.LumberjackConstants.VERSION_V2;
-
-/**
- * Handles lumberjack window and send acknowledge when required.
- */
-final class LumberjackSessionHandler {
-    private static final Logger LOG = LoggerFactory.getLogger(LumberjackSessionHandler.class);
-    private static final int ACK_UNSET = -1;
-
-    private volatile int version = -1;
-    private volatile int windowSize = 1;
-    private volatile int nextAck = ACK_UNSET;
-    // this phaser will handle one window processed at a time for each session
-    private final Phaser phaser = new Phaser();
-
-    void versionRead(int version) {
-        if (this.version == -1) {
-            if (version != VERSION_V1 && version != VERSION_V2) {
-                throw new RuntimeException("Unsupported frame version=" + version);
-            }
-            LOG.debug("Lumberjack protocol version is {}", (char) version);
-            this.version = version;
-        } else if (this.version != version) {
-            throw new IllegalStateException("Protocol version changed during session from " + this.version + " to " + version);
-        }
-    }
-
-    void windowSizeRead(int windowSize) {
-        LOG.debug("Lumberjack window size is {}", windowSize);
-        // register a new window process
-        phaser.register();
-        // if another window is being processed in the same session, wait until it ends processing
-        phaser.arriveAndAwaitAdvance();
-        this.windowSize = windowSize;
-        nextAck = ACK_UNSET;
-    }
-
-    void notifyMessageProcessed(ChannelHandlerContext ctx, int sequenceNumber) {
-        if (nextAck == ACK_UNSET) {
-            nextAck = sequenceNumber + windowSize - 1;
-        }
-
-        if (sequenceNumber == nextAck) {
-            LOG.debug("Sequence number is {}. Sending ACK", sequenceNumber);
-            ByteBuf response = ctx.alloc().heapBuffer(FRAME_ACKNOWLEDGE_LENGTH, FRAME_ACKNOWLEDGE_LENGTH);
-            response.writeByte(version);
-            response.writeByte(TYPE_ACKNOWLEDGE);
-            response.writeInt(sequenceNumber);
-            // pause before send, in order to make sure all ACK are received by the client
-            ctx.executor().schedule(() -> {
-                ctx.writeAndFlush(response);
-            }, 10, TimeUnit.MILLISECONDS);
-            // prepare to read another pending window
-            phaser.arriveAndDeregister();
-        }
-    }
-}
diff --git a/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackWindow.java b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackWindow.java
new file mode 100644
index 00000000000..b9d06574ea1
--- /dev/null
+++ b/components/camel-lumberjack/src/main/java/org/apache/camel/component/lumberjack/io/LumberjackWindow.java
@@ -0,0 +1,54 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.camel.component.lumberjack.io;
+
+import java.util.ArrayList;
+import java.util.Iterator;
+import java.util.List;
+
+public class LumberjackWindow implements Iterable<LumberjackMessage> {
+
+    private final byte version;
+    private final int size;
+    private List<LumberjackMessage> messages = new ArrayList<>();
+
+    public LumberjackWindow(byte version, int size) {
+        this.version = version;
+        this.size = size;
+    }
+
+    @Override
+    public Iterator<LumberjackMessage> iterator() {
+        return messages.iterator();
+    }
+
+    void addMessage(LumberjackMessage message) {
+        messages.add(message);
+    }
+
+    public byte getVersion() {
+        return version;
+    }
+
+    public boolean isComplete() {
+        return size == messages.size();
+    }
+
+    public int getSize() {
+        return size;
+    }
+}
