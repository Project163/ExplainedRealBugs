diff --git a/wicket-core/src/main/java/org/apache/wicket/request/handler/resource/ResourceStreamRequestHandler.java b/wicket-core/src/main/java/org/apache/wicket/request/handler/resource/ResourceStreamRequestHandler.java
index c0e3328f1d..4da268f854 100644
--- a/wicket-core/src/main/java/org/apache/wicket/request/handler/resource/ResourceStreamRequestHandler.java
+++ b/wicket-core/src/main/java/org/apache/wicket/request/handler/resource/ResourceStreamRequestHandler.java
@@ -109,10 +109,14 @@ public class ResourceStreamRequestHandler implements IRequestHandler
 		ResourceStreamResource resource = new ResourceStreamResource(resourceStream);
 		resource.setFileName(fileName);
 		if (contentDisposition != null)
+		{
 			resource.setContentDisposition(contentDisposition);
+		}
 		else
+		{
 			resource.setContentDisposition(Strings.isEmpty(fileName) ? ContentDisposition.INLINE
 				: ContentDisposition.ATTACHMENT);
+		}
 
 		resource.respond(attributes);
 	}
diff --git a/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java b/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java
index e507f3651a..449c344663 100644
--- a/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java
+++ b/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java
@@ -175,11 +175,11 @@ public class PackageResource extends AbstractResource implements IStaticCacheabl
 	}
 
 	/**
-	 * be aware that method takes the current wicket session's locale 
-	 * and style into account when locating the stream.
+	 * be aware that method takes the current wicket session's locale and style into account when
+	 * locating the stream.
 	 * 
 	 * @return resource stream
-	 *
+	 * 
 	 * @see org.apache.wicket.request.resource.caching.IStaticCacheableResource#getCacheableResourceStream()
 	 * @see #getResourceStream()
 	 */
@@ -190,11 +190,10 @@ public class PackageResource extends AbstractResource implements IStaticCacheabl
 			.getResourceSettings()
 			.getResourceStreamLocator();
 
-		// determine current resource stream 
+		// determine current resource stream
 		// taking client locale and style into account
-		return locator.locate(getScope(), absolutePath,
-		                      getCurrentStyle(), variation, getCurrentLocale(),
-		                      null, false);
+		return locator.locate(getScope(), absolutePath, getCurrentStyle(), variation,
+			getCurrentLocale(), null, false);
 	}
 
 	public Serializable getCacheKey()
@@ -207,8 +206,8 @@ public class PackageResource extends AbstractResource implements IStaticCacheabl
 			return null;
 		}
 
-		return new CacheKey(scopeName, absolutePath, 
-		                    stream.getLocale(), stream.getStyle(), stream.getVariation());
+		return new CacheKey(scopeName, absolutePath, stream.getLocale(), stream.getStyle(),
+			stream.getVariation());
 	}
 
 	/**
@@ -253,8 +252,13 @@ public class PackageResource extends AbstractResource implements IStaticCacheabl
 				return sendResourceError(resourceResponse, HttpServletResponse.SC_NOT_FOUND,
 					"Unable to find resource");
 
+			String contentType = resourceStream.getContentType();
+			if (contentType == null && Application.exists())
+			{
+				contentType = Application.get().getMimeType(path);
+			}
 			// set Content-Type (may be null)
-			resourceResponse.setContentType(resourceStream.getContentType());
+			resourceResponse.setContentType(contentType);
 
 			// add Last-Modified header (to support HEAD requests and If-Modified-Since)
 			final Time lastModified = resourceStream.lastModifiedTime();
@@ -348,35 +352,35 @@ public class PackageResource extends AbstractResource implements IStaticCacheabl
 	 * locate resource stream for current resource
 	 * <p/>
 	 * Unfortunately this method has changed from scope 'public' in wicket 1.4 to scope 'protected'
-	 * in wicket 1.5. We realized this too late and now changing it would break the api. So
-	 * in case you need access to this method you have the following options:
+	 * in wicket 1.5. We realized this too late and now changing it would break the api. So in case
+	 * you need access to this method you have the following options:
 	 * 
 	 * <ul>
-	 *     <li>
-	 *         copy-paste the code in the method body of {@link #getResourceStream()} 
-	 *         and wait for wicket 1.6
-	 *     </li>
-	 *     <li>
-	 *         extend PackageResource, passing the package resources 
-	 *         attributes and make {@link #getResourceStream()} public again:
-	 *         
-	 *       <pre>
-	 *       public class MyPackageResource extends PackageResource
-	 *       { 
-	 *           public MyPackageResource(Class<?> scope, String name, Locale locale, String style,
-	 *                 String variation)
-	 *         {
-	 *           super(scope, name, locale, style, variation);
-	 *         }
-	 *
-	 *         // change access to public here
-	 *         public IResourceStream getResourceStream()
-	 *         {
-	 *           return super.getResourceStream();
-	 *         }
-	 *       }
-	 *       </pre>
-	 *     </li>
+	 * <li>
+	 * copy-paste the code in the method body of {@link #getResourceStream()} and wait for wicket
+	 * 1.6</li>
+	 * <li>
+	 * extend PackageResource, passing the package resources attributes and make
+	 * {@link #getResourceStream()} public again:
+	 * 
+	 * <pre>
+	 * public class MyPackageResource extends PackageResource
+	 * {
+	 * 	public MyPackageResource(Class&lt;?&gt; scope, String name, Locale locale, String style,
+	 * 		String variation)
+	 * 	{
+	 * 		super(scope, name, locale, style, variation);
+	 * 	}
+	 * 
+	 * 	// change access to public here
+	 * 	public IResourceStream getResourceStream()
+	 * 	{
+	 * 		return super.getResourceStream();
+	 * 	}
+	 * }
+	 * </pre>
+	 * 
+	 * </li>
 	 * </ul>
 	 * 
 	 * 
@@ -559,7 +563,8 @@ public class PackageResource extends AbstractResource implements IStaticCacheabl
 				return false;
 			if (style != null ? !style.equals(cacheKey.style) : cacheKey.style != null)
 				return false;
-			if (variation != null ? !variation.equals(cacheKey.variation) : cacheKey.variation != null)
+			if (variation != null ? !variation.equals(cacheKey.variation)
+				: cacheKey.variation != null)
 				return false;
 
 			return true;
diff --git a/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceStreamResource.java b/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceStreamResource.java
index de5ed576cb..e9d25f0563 100644
--- a/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceStreamResource.java
+++ b/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceStreamResource.java
@@ -21,6 +21,7 @@ import java.io.InputStream;
 
 import javax.servlet.http.HttpServletResponse;
 
+import org.apache.wicket.Application;
 import org.apache.wicket.util.lang.Args;
 import org.apache.wicket.util.lang.Bytes;
 import org.apache.wicket.util.resource.IResourceStream;
@@ -121,7 +122,13 @@ public class ResourceStreamResource extends AbstractResource
 				data.setContentLength(length.bytes());
 			}
 			data.setFileName(fileName);
-			data.setContentType(stream.getContentType());
+
+			String contentType = stream.getContentType();
+			if (contentType == null && fileName != null && Application.exists())
+			{
+				contentType = Application.get().getMimeType(fileName);
+			}
+			data.setContentType(contentType);
 			data.setTextEncoding(textEncoding);
 
 			if (stream instanceof IResourceStreamWriter)
diff --git a/wicket-core/src/main/java/org/apache/wicket/util/resource/UrlResourceStream.java b/wicket-core/src/main/java/org/apache/wicket/util/resource/UrlResourceStream.java
index 2aad8d242c..e96156ff32 100644
--- a/wicket-core/src/main/java/org/apache/wicket/util/resource/UrlResourceStream.java
+++ b/wicket-core/src/main/java/org/apache/wicket/util/resource/UrlResourceStream.java
@@ -22,7 +22,6 @@ import java.net.URL;
 import java.net.URLConnection;
 
 import org.apache.wicket.Application;
-import org.apache.wicket.protocol.http.WebApplication;
 import org.apache.wicket.util.io.Connections;
 import org.apache.wicket.util.lang.Args;
 import org.apache.wicket.util.lang.Bytes;
@@ -59,7 +58,7 @@ public class UrlResourceStream extends AbstractResourceStream
 
 	/** Last known time the stream was last modified. */
 	private Time lastModified;
-	
+
 	/**
 	 * Meta data class for the stream attributes
 	 */
@@ -108,18 +107,9 @@ public class UrlResourceStream extends AbstractResourceStream
 
 				if (streamData.contentType == null || streamData.contentType.contains("unknown"))
 				{
-					if (Application.exists() && Application.get() instanceof WebApplication)
+					if (Application.exists())
 					{
-						// TODO Post 1.2: General: For non webapplication another method
-						// should be implemented (getMimeType on application?)
-						streamData.contentType = WebApplication.get()
-							.getServletContext()
-							.getMimeType(url.getFile());
-						if (streamData.contentType == null)
-						{
-							streamData.contentType = URLConnection.getFileNameMap()
-								.getContentTypeFor(url.getFile());
-						}
+						streamData.contentType = Application.get().getMimeType(url.getFile());
 					}
 					else
 					{
@@ -193,7 +183,7 @@ public class UrlResourceStream extends AbstractResourceStream
 			if (Objects.equal(time, lastModified) == false)
 			{
 				lastModified = time;
-				this.updateContentLength();
+				updateContentLength();
 			}
 			return lastModified;
 		}
@@ -210,7 +200,7 @@ public class UrlResourceStream extends AbstractResourceStream
 	{
 		StreamData data = getData(false);
 
-		if(data != null)
+		if (data != null)
 		{
 			URLConnection connection = url.openConnection();
 			data.contentLength = connection.getContentLength();
