diff --git a/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java b/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java
index 26fe0f9e2e..b3c4300b94 100644
--- a/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java
+++ b/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java
@@ -2051,13 +2051,16 @@ public abstract class MarkupContainer extends Component implements Iterable<Comp
 
 		// pull the close tag off
 		ComponentTag close = dequeue.takeTag();
-		if (!close.closes(tag))
+		do
 		{
-			// sanity check
-			throw new IllegalStateException(String.format(
-				"Tag '%s' should be the closing one for '%s'", close, tag));
-		}
+			if (close != null && close.closes(tag))
+			{
+				return;
+			}
+		} while ((close = dequeue.takeTag()) != null);
 
+		throw new IllegalStateException(String.format(
+				"Could not find the closing for '%s'", tag));
 	}
 
     /** @see IQueueRegion#newDequeueContext() */
diff --git a/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingCompatibilityTest.java b/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingCompatibilityTest.java
index 254e951c6e..7cc703b30a 100644
--- a/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingCompatibilityTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingCompatibilityTest.java
@@ -17,13 +17,14 @@
 package org.apache.wicket.queueing;
 
 import org.apache.wicket.util.tester.WicketTestCase;
-import org.junit.Ignore;
 import org.junit.Test;
 
 public class ComponentQueueingCompatibilityTest extends WicketTestCase
 {
+	/**
+	 * https://issues.apache.org/jira/browse/WICKET-6036
+	 */
 	@Test
-	@Ignore("WICKET-6036")
 	public void nestedTags()
 	{
 		IncorrectCloseTagPanel p = new IncorrectCloseTagPanel("test");
