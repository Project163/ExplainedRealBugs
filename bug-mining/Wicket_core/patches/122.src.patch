diff --git a/wicket-core/src/main/java/org/apache/wicket/util/string/JavaScriptUtils.java b/wicket-core/src/main/java/org/apache/wicket/util/string/JavaScriptUtils.java
index 6101006071..8897e62110 100644
--- a/wicket-core/src/main/java/org/apache/wicket/util/string/JavaScriptUtils.java
+++ b/wicket-core/src/main/java/org/apache/wicket/util/string/JavaScriptUtils.java
@@ -27,22 +27,22 @@ import org.apache.wicket.request.Response;
 public class JavaScriptUtils
 {
 	/** Script open tag */
-	public final static String SCRIPT_OPEN_TAG = "<script type=\"text/javascript\"><!--/*--><![CDATA[/*><!--*/\n";
+	public final static String SCRIPT_OPEN_TAG = "<script type=\"text/javascript\">\n/*<![CDATA[*/\n";
 
 	/** Script close tag */
-	public final static String SCRIPT_CLOSE_TAG = "\n/*-->]]>*/</script>\n";
+	public final static String SCRIPT_CLOSE_TAG = "\n/*]]>*/\n</script>\n";
 
 	/**
 	 * Script open tag. If this tag is changed, also update Wicket.Head.Contributor.processScript()
 	 * function from wicket-ajax.js
 	 */
-	public final static String SCRIPT_CONTENT_PREFIX = "<!--/*--><![CDATA[/*><!--*/\n";
+	public final static String SCRIPT_CONTENT_PREFIX = "\n/*<![CDATA[*/\n";
 
 	/**
 	 * Script close tag. If this tag is changed, also update Wicket.Head.Contributor.processScript()
 	 * function from wicket-ajax.js
 	 */
-	public final static String SCRIPT_CONTENT_SUFFIX = "\n/*-->]]>*/";
+	public final static String SCRIPT_CONTENT_SUFFIX = "\n/*]]>*/\n";
 
 
 	/** The response object */
diff --git a/wicket-core/src/test/java/org/apache/wicket/TestDetachPageAjaxResult.html b/wicket-core/src/test/java/org/apache/wicket/TestDetachPageAjaxResult.html
index cdc03eaf36..eb5b9a9bd1 100644
--- a/wicket-core/src/test/java/org/apache/wicket/TestDetachPageAjaxResult.html
+++ b/wicket-core/src/test/java/org/apache/wicket/TestDetachPageAjaxResult.html
@@ -1,10 +1,14 @@
 <?xml version="1.0" encoding="UTF-8"?><ajax-response><header-contribution encoding="wicket1" ><![CDATA[<head xmlns:wicket="http://wicket.apache.org"><script type="text/javascript" src="./resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="./resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="./resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]^]^>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]^]^>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/page?0-1.IBehaviorListener.0-comp";
-/*-->]^]^>*/</script>
+/*]^]^>*/
+</script>
 </head>]]></header-contribution><component id="comp1" ><![CDATA[<span wicket:id="comp" id="comp1" onclick="var wcall=wicketAjaxGet(&#039;./page?0-1.IBehaviorListener.0-comp&#039;,function() { }.bind(this),function() { }.bind(this), function() {return Wicket.$(&#039;comp1&#039;) != null;}.bind(this));">body</span>]]></component></ajax-response>
\ No newline at end of file
diff --git a/wicket-core/src/test/java/org/apache/wicket/TestDetachPageExpectedResult.html b/wicket-core/src/test/java/org/apache/wicket/TestDetachPageExpectedResult.html
index 91e41e75ff..c219c8c4cf 100644
--- a/wicket-core/src/test/java/org/apache/wicket/TestDetachPageExpectedResult.html
+++ b/wicket-core/src/test/java/org/apache/wicket/TestDetachPageExpectedResult.html
@@ -2,12 +2,16 @@
 <head><script type="text/javascript" src="../resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]]>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/bookmarkable/org.apache.wicket.TestDetachPage?0";
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 </head><body>
   <span wicket:id="comp" id="comp1" onclick="var wcall=wicketAjaxGet(&#039;../page?0-1.IBehaviorListener.0-comp&#039;,function() { }.bind(this),function() { }.bind(this), function() {return Wicket.$(&#039;comp1&#039;) != null;}.bind(this));">body</span>
 </body>
diff --git a/wicket-core/src/test/java/org/apache/wicket/ajax/AjaxHeaderContributionPage2_expected.html b/wicket-core/src/test/java/org/apache/wicket/ajax/AjaxHeaderContributionPage2_expected.html
index 8379626244..7a0df1c181 100644
--- a/wicket-core/src/test/java/org/apache/wicket/ajax/AjaxHeaderContributionPage2_expected.html
+++ b/wicket-core/src/test/java/org/apache/wicket/ajax/AjaxHeaderContributionPage2_expected.html
@@ -3,29 +3,41 @@
 <link href="../../test"/>
 <script type="text/javascript" src="../../javascripturl"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
-<script type="text/javascript" ><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" >
+/*<![CDATA[*/
 Wicket.Event.add(window, "domready", function(event) { domReady();;});
-/*-->]]>*/</script>
-<script type="text/javascript" ><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" >
+/*<![CDATA[*/
 Wicket.Event.add(window, "load", function(event) { onLoad();;});
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 
 <link href="../../test2"/>
 <script type="text/javascript" src="../../javascripturlB"></script>
-<script type="text/javascript" ><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" >
+/*<![CDATA[*/
 Wicket.Event.add(window, "domready", function(event) { domReadyB();;});
-/*-->]]>*/</script>
-<script type="text/javascript" ><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" >
+/*<![CDATA[*/
 Wicket.Event.add(window, "load", function(event) { onLoadB();;});
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]]>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/bookmarkable/org.apache.wicket.ajax.AjaxHeaderContributionPage2?0";
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 </head><body>
 <span wicket:id="test1" id="test11"><wicket:panel>
 test
diff --git a/wicket-core/src/test/java/org/apache/wicket/ajax/AjaxHeaderContributionPage_expected.html b/wicket-core/src/test/java/org/apache/wicket/ajax/AjaxHeaderContributionPage_expected.html
index 127d8f805e..ba482c359c 100644
--- a/wicket-core/src/test/java/org/apache/wicket/ajax/AjaxHeaderContributionPage_expected.html
+++ b/wicket-core/src/test/java/org/apache/wicket/ajax/AjaxHeaderContributionPage_expected.html
@@ -3,20 +3,28 @@
 <link href="../../test"/>
 <script type="text/javascript" src="../../javascripturl"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
-<script type="text/javascript" ><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" >
+/*<![CDATA[*/
 Wicket.Event.add(window, "domready", function(event) { domReady();;});
-/*-->]]>*/</script>
-<script type="text/javascript" ><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" >
+/*<![CDATA[*/
 Wicket.Event.add(window, "load", function(event) { onLoad();;});
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]]>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/bookmarkable/org.apache.wicket.ajax.AjaxHeaderContributionPage?0";
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 </head><body>
 <span wicket:id="test1" id="test11"><wicket:panel>
 test
diff --git a/wicket-core/src/test/java/org/apache/wicket/ajax/DomReadyOrderPage_ajax_expected.html b/wicket-core/src/test/java/org/apache/wicket/ajax/DomReadyOrderPage_ajax_expected.html
index 408d1d6c1b..8a99294dda 100644
--- a/wicket-core/src/test/java/org/apache/wicket/ajax/DomReadyOrderPage_ajax_expected.html
+++ b/wicket-core/src/test/java/org/apache/wicket/ajax/DomReadyOrderPage_ajax_expected.html
@@ -1,10 +1,14 @@
 <?xml version="1.0" encoding="UTF-8"?><ajax-response><header-contribution encoding="wicket1" ><![CDATA[<head xmlns:wicket="http://wicket.apache.org"><script type="text/javascript" src="./resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="./resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="./resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]^]^>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]^]^>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/page?0-1.IBehaviorListener.0-test";
-/*-->]^]^>*/</script>
+/*]^]^>*/
+</script>
 </head>]]></header-contribution><component id="test1" ><![CDATA[<a href="./page?0-1.ILinkListener-test" wicket:id="test" id="test1" onclick="var wcall=wicketAjaxGet(&#039;./page?0-1.IBehaviorListener.0-test&#039;,function() { }.bind(this),function() { }.bind(this), function() {return Wicket.$(&#039;test1&#039;) != null;}.bind(this));return !wcall;">Test</a>]]></component><evaluate><![CDATA[test1();]]></evaluate><evaluate><![CDATA[test2();]]></evaluate></ajax-response>
\ No newline at end of file
diff --git a/wicket-core/src/test/java/org/apache/wicket/ajax/DomReadyOrderPage_expected.html b/wicket-core/src/test/java/org/apache/wicket/ajax/DomReadyOrderPage_expected.html
index 88ff87b0ca..73fc17a06e 100644
--- a/wicket-core/src/test/java/org/apache/wicket/ajax/DomReadyOrderPage_expected.html
+++ b/wicket-core/src/test/java/org/apache/wicket/ajax/DomReadyOrderPage_expected.html
@@ -2,18 +2,26 @@
 <head><script type="text/javascript" src="../resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]]>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/bookmarkable/org.apache.wicket.ajax.DomReadyOrderPage?0";
-/*-->]]>*/</script>
-<script type="text/javascript" ><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" >
+/*<![CDATA[*/
 Wicket.Event.add(window, "domready", function(event) { test1();;});
-/*-->]]>*/</script>
-<script type="text/javascript" ><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" >
+/*<![CDATA[*/
 Wicket.Event.add(window, "domready", function(event) { test2();;});
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 </head><body>
 <a href="../page?0-1.ILinkListener-test" wicket:id="test" id="test1" onclick="var wcall=wicketAjaxGet(&#039;../page?0-1.IBehaviorListener.0-test&#039;,function() { }.bind(this),function() { }.bind(this), function() {return Wicket.$(&#039;test1&#039;) != null;}.bind(this));return !wcall;">Test</a>
 </body>
diff --git a/wicket-core/src/test/java/org/apache/wicket/ajax/MockComponent1-expected.html b/wicket-core/src/test/java/org/apache/wicket/ajax/MockComponent1-expected.html
index cb73bf22e0..146d40ba32 100644
--- a/wicket-core/src/test/java/org/apache/wicket/ajax/MockComponent1-expected.html
+++ b/wicket-core/src/test/java/org/apache/wicket/ajax/MockComponent1-expected.html
@@ -1,5 +1,6 @@
 <![CDATA[<head xmlns:wicket="http://wicket.apache.org">
-<style type="text/css" id="org-apache-wicket-ajax-MockComponent1-0"><!--/*--><![CDATA[/*><!--*/
+<style type="text/css" id="org-apache-wicket-ajax-MockComponent1-0">
+/*<![CDATA[*/
 
 .onTheFlyClass {
 	background-color: red;
@@ -7,5 +8,6 @@
 	width: 200px;
 }
 
-/*-->]^]^>*/</style>
+/*]^]^>*/
+</style>
 </head>]]>
\ No newline at end of file
diff --git a/wicket-core/src/test/java/org/apache/wicket/ajax/form/AjaxFormSubmitTestPage_expected.html b/wicket-core/src/test/java/org/apache/wicket/ajax/form/AjaxFormSubmitTestPage_expected.html
index a71da60ad2..b69f4964bf 100644
--- a/wicket-core/src/test/java/org/apache/wicket/ajax/form/AjaxFormSubmitTestPage_expected.html
+++ b/wicket-core/src/test/java/org/apache/wicket/ajax/form/AjaxFormSubmitTestPage_expected.html
@@ -2,12 +2,16 @@
 	<head><script type="text/javascript" src="../resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]]>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/bookmarkable/org.apache.wicket.ajax.form.AjaxFormSubmitTestPage?0";
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 </head><body>
 		<form wicket:id="form" id="form1" method="post" action="../page?0-1.IFormSubmitListener-form"><div style="width:0px;height:0px;position:absolute;left:-100px;top:-100px;overflow:hidden"><input type="hidden" name="form1_hf_0" id="form1_hf_0" /></div>
 			<input type="text" wicket:id="txt1" value="foo" name="txt1"/>
diff --git a/wicket-core/src/test/java/org/apache/wicket/ajax/form/OnChangeAjaxBehaviorTestPage_expected.html b/wicket-core/src/test/java/org/apache/wicket/ajax/form/OnChangeAjaxBehaviorTestPage_expected.html
index 9dc8196a3a..1496c708b7 100644
--- a/wicket-core/src/test/java/org/apache/wicket/ajax/form/OnChangeAjaxBehaviorTestPage_expected.html
+++ b/wicket-core/src/test/java/org/apache/wicket/ajax/form/OnChangeAjaxBehaviorTestPage_expected.html
@@ -2,15 +2,21 @@
 	<head><script type="text/javascript" src="../resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]]>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/bookmarkable/org.apache.wicket.ajax.form.OnChangeAjaxBehaviorTestPage?0";
-/*-->]]>*/</script>
-<script type="text/javascript" ><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" >
+/*<![CDATA[*/
 Wicket.Event.add(window, "domready", function(event) { new Wicket.ChangeHandler('field1');;});
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 </head><body>
 		<form wicket:id="form" id="form2" method="post" action="../page?0-1.IFormSubmitListener-form"><div style="width:0px;height:0px;position:absolute;left:-100px;top:-100px;overflow:hidden"><input type="hidden" name="form2_hf_0" id="form2_hf_0" /></div>
 			<input type="text" wicket:id="field" value="" name="field" id="field1" onchange="var wcall=wicketAjaxPost(&#039;../page?0-1.IBehaviorListener.0-form-field&#039;, wicketSerialize(Wicket.$(&#039;field1&#039;)),function() { }.bind(this),function() { }.bind(this), function() {return Wicket.$(&#039;field1&#039;) != null;}.bind(this));"/>
diff --git a/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/ajaxLink/AjaxLinkPageExpectedResult.html b/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/ajaxLink/AjaxLinkPageExpectedResult.html
index e770d86fbc..ecdfd88965 100644
--- a/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/ajaxLink/AjaxLinkPageExpectedResult.html
+++ b/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/ajaxLink/AjaxLinkPageExpectedResult.html
@@ -2,12 +2,16 @@
 <head><script type="text/javascript" src="../resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]]>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/bookmarkable/org.apache.wicket.ajax.markup.html.ajaxLink.AjaxLinkPage";
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 </head><body>
   <span wicket:id="ajaxLabel" id="ajaxLabel1">UpdateMe</span>
   <a href="#" wicket:id="ajaxLink" id="ajaxLink2" onclick="var wcall=wicketAjaxGet(&#039;../page?0-1.IBehaviorListener.0-ajaxLink&#039;,function() { }.bind(this),function() { }.bind(this), function() {return Wicket.$(&#039;ajaxLink2&#039;) != null;}.bind(this));return !wcall;">Update</a>
diff --git a/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/ajaxLink/AjaxLinkWithBorderPageExpectedResult.html b/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/ajaxLink/AjaxLinkWithBorderPageExpectedResult.html
index 538dc70479..d3cd4f9f97 100644
--- a/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/ajaxLink/AjaxLinkWithBorderPageExpectedResult.html
+++ b/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/ajaxLink/AjaxLinkWithBorderPageExpectedResult.html
@@ -2,12 +2,16 @@
 <head><script type="text/javascript" src="../resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]]>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/bookmarkable/org.apache.wicket.ajax.markup.html.ajaxLink.AjaxLinkWithBorderPage";
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 </head><body>
   <span wicket:id="border"><wicket:border>
     Border
diff --git a/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/ajaxLink/AjaxPage2_ExpectedResult.html b/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/ajaxLink/AjaxPage2_ExpectedResult.html
index 6218ec4049..1bc06213c2 100644
--- a/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/ajaxLink/AjaxPage2_ExpectedResult.html
+++ b/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/ajaxLink/AjaxPage2_ExpectedResult.html
@@ -2,12 +2,16 @@
 <head><script type="text/javascript" src="../resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]]>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/bookmarkable/org.apache.wicket.ajax.markup.html.ajaxLink.AjaxPage2";
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 </head><body>
   <span wicket:id="pageLayout"><wicket:border>
         <table width = "0%" border = "0" cellspacing = "0" cellpadding = "1" bgcolor = "black">
diff --git a/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/componentMap/SimpleTestPageExpectedResult-1.html b/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/componentMap/SimpleTestPageExpectedResult-1.html
index 13487069eb..57ad6fe070 100644
--- a/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/componentMap/SimpleTestPageExpectedResult-1.html
+++ b/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/componentMap/SimpleTestPageExpectedResult-1.html
@@ -1,10 +1,14 @@
 <?xml version="1.0" encoding="UTF-8"?><ajax-response><header-contribution encoding="wicket1" ><![CDATA[<head xmlns:wicket="http://wicket.apache.org"><script type="text/javascript" src="./resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="./resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="./resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]^]^>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]^]^>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/page?0-1.IBehaviorListener.0-testPanel-baseSpan-linja1";
-/*-->]^]^>*/</script>
+/*]^]^>*/
+</script>
 </head>]]></header-contribution><component id="linja11" ><![CDATA[<span wicket:id="linja1" id="linja11">1</span>]]></component><evaluate><![CDATA[setTimeout("var wcall=wicketAjaxGet('./page?0-1.IBehaviorListener.0-testPanel-baseSpan-linja1',function() { }.bind(this),function() { }.bind(this), function() {var c = Wicket.$('linja11'); return typeof(c) != 'undefined' && c != null}.bind(this));", 2000);]]></evaluate></ajax-response>
\ No newline at end of file
diff --git a/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/componentMap/SimpleTestPageExpectedResult.html b/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/componentMap/SimpleTestPageExpectedResult.html
index 79a2180b2c..eeeaec43a9 100644
--- a/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/componentMap/SimpleTestPageExpectedResult.html
+++ b/wicket-core/src/test/java/org/apache/wicket/ajax/markup/html/componentMap/SimpleTestPageExpectedResult.html
@@ -4,15 +4,21 @@
 <script type="text/javascript" src="../resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]]>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/bookmarkable/org.apache.wicket.ajax.markup.html.componentMap.SimpleTestPage?0";
-/*-->]]>*/</script>
-<script type="text/javascript" ><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" >
+/*<![CDATA[*/
 Wicket.Event.add(window, "load", function(event) { setTimeout("var wcall=wicketAjaxGet('../page?0-1.IBehaviorListener.0-testPanel-baseSpan-linja1',function() { }.bind(this),function() { }.bind(this), function() {var c = Wicket.$('linja11'); return typeof(c) != 'undefined' && c != null}.bind(this));", 2000);;});
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 </head>
 <body>
   <span wicket:id="testPanel"><wicket:panel>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/MarkupParserTest.java b/wicket-core/src/test/java/org/apache/wicket/markup/MarkupParserTest.java
index c2620076e3..3b19ce8cd9 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/MarkupParserTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/MarkupParserTest.java
@@ -389,8 +389,7 @@ public final class MarkupParserTest extends WicketTestCase
 		assertEquals(5, markup.size());
 		assertEquals("html", ((ComponentTag)markup.get(0)).getName());
 		assertEquals("html", ((ComponentTag)markup.get(4)).getName());
-		assertEquals("<!--/*--><![CDATA[/*><!--*/\n... <x a> ...\n/*-->]]>*/", markup.get(2)
-			.toString());
+		assertEquals("\n/*<![CDATA[*/\n... <x a> ...\n/*]]>*/\n", markup.get(2).toString());
 	}
 
 	/**
@@ -456,7 +455,7 @@ public final class MarkupParserTest extends WicketTestCase
 		tag = markup.get(0);
 		assertEquals("<script>", tag.toString());
 		tag = markup.get(1);
-		assertEquals("<!--/*--><![CDATA[/*><!--*/\n text \n/*-->]]>*/", tag.toString());
+		assertEquals("\n/*<![CDATA[*/\n text \n/*]]>*/\n", tag.toString());
 		tag = markup.get(2);
 		assertEquals("</script>", tag.toString());
 
@@ -492,7 +491,7 @@ public final class MarkupParserTest extends WicketTestCase
 		tag = markup.get(1);
 		assertEquals("<script>", tag.toString());
 		tag = markup.get(2);
-		assertEquals("<!--/*--><![CDATA[/*><!--*/\n text \n/*-->]]>*/", tag.toString());
+		assertEquals("\n/*<![CDATA[*/\n text \n/*]]>*/\n", tag.toString());
 		tag = markup.get(3);
 		assertEquals("</script>", tag.toString());
 
@@ -501,7 +500,7 @@ public final class MarkupParserTest extends WicketTestCase
 		tag = markup.get(1);
 		assertEquals("<script>", tag.toString());
 		tag = markup.get(2);
-		assertEquals("<!--/*--><![CDATA[/*><!--*/\n text \n/*-->]]>*/", tag.toString());
+		assertEquals("\n/*<![CDATA[*/\n text \n/*]]>*/\n", tag.toString());
 		tag = markup.get(3);
 		assertEquals("</script>", tag.toString());
 	}
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/basic/SimplePageExpectedResult_12.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/basic/SimplePageExpectedResult_12.html
index 5bf88f4853..4bfb373dd5 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/basic/SimplePageExpectedResult_12.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/basic/SimplePageExpectedResult_12.html
@@ -5,7 +5,11 @@
   <title>CSS-basiertes Layout</title>
   <link rel="stylesheet" type="text/css" href="../../basis.css">
 
-  <style type="text/css">@import url(modern_ohne_ie.css) all;</style>
+  <style type="text/css">
+/*<![CDATA[*/
+@import url(modern_ohne_ie.css) all;
+/*]]>*/
+</style>
 
   <wicket:link>
   <!--[if IE]>
@@ -29,23 +33,43 @@
   <![endif]-->
   
   <!--[if IE]>
-    <style type="text/css">@import url(ie.css);</style>
+    <style type="text/css">
+/*<![CDATA[*/
+@import url(ie.css);
+/*]]>*/
+</style>
   <![endif]-->
 
   <!--[if IE 6]>
-    <style type="text/css">@import url(ie.css);</style>
+    <style type="text/css">
+/*<![CDATA[*/
+@import url(ie.css);
+/*]]>*/
+</style>
   <![endif]-->
 
   <!--[if gte IE 5.5]>
-    <style type="text/css">@import url(ie.css);</style>
+    <style type="text/css">
+/*<![CDATA[*/
+@import url(ie.css);
+/*]]>*/
+</style>
   <![endif]-->
 
   <!--[if lte IE 5.5999]>
-    <style type="text/css">@import url(ie.css);</style>
+    <style type="text/css">
+/*<![CDATA[*/
+@import url(ie.css);
+/*]]>*/
+</style>
   <![endif]-->
 
   <!--[if lt IE 5.1]>
-    <style type="text/css">@import url(ie.css);</style>
+    <style type="text/css">
+/*<![CDATA[*/
+@import url(ie.css);
+/*]]>*/
+</style>
   <![endif]-->
   </wicket:link>
 
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/basic/SimplePageExpectedResult_13.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/basic/SimplePageExpectedResult_13.html
index f8d262eb74..d7cf3c255e 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/basic/SimplePageExpectedResult_13.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/basic/SimplePageExpectedResult_13.html
@@ -5,12 +5,16 @@
   <head><script type="text/javascript" src="../resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]]>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/bookmarkable/org.apache.wicket.markup.html.basic.SimplePage_13";
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 <link rel="stylesheet" type="text/css" href="../../BasePage.css" />
 </head><body>
   </body>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/border/HideableBorderPage_ExpectedResult.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/border/HideableBorderPage_ExpectedResult.html
index ffdcb34816..0d6008db68 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/border/HideableBorderPage_ExpectedResult.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/border/HideableBorderPage_ExpectedResult.html
@@ -2,12 +2,16 @@
 <head><script type="text/javascript" src="../resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]]>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/bookmarkable/org.apache.wicket.markup.html.border.HideableBorderPage";
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 </head><body>
   <div wicket:id="hideable"><wicket:border>
   <a wicket:id="hideLink" id="hideLink1" href="#" onclick="var wcall=wicketAjaxGet(&#039;../page?0-1.IBehaviorListener.0-hideable-hideLink&#039;,function() { }.bind(this),function() { }.bind(this), function() {return Wicket.$(&#039;hideLink1&#039;) != null;}.bind(this));return !wcall;">Hide contents</a>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/header/MyPageExpectedResult.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/header/MyPageExpectedResult.html
index 8848255aed..4d9184eabd 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/header/MyPageExpectedResult.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/header/MyPageExpectedResult.html
@@ -5,8 +5,12 @@
     <title>My Page</title>
   
     <script id="org-apache-wicket-markup-html-header-PanelA-0">
+/*<![CDATA[*/
+
         alert("BASE");
-    </script>
+    
+/*]]>*/
+</script>
   
     AA
   
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/header/inheritance/ExpectedResult2.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/header/inheritance/ExpectedResult2.html
index ddeed998ff..dd40e2ae18 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/header/inheritance/ExpectedResult2.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/header/inheritance/ExpectedResult2.html
@@ -3,9 +3,13 @@
   <title>AbstractPage.html</title>
 
   <script type="text/javascript" id="org-apache-wicket-markup-html-header-inheritance-MyPanel2-0">
+/*<![CDATA[*/
+
   function foo() {
      alert("Hello, World!");
   }
+
+/*]]>*/
 </script>
 </head>
 <body>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/header/testing/TestPage_ExpectedResult.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/header/testing/TestPage_ExpectedResult.html
index 5c6cb24934..a9f4be1d6f 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/header/testing/TestPage_ExpectedResult.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/header/testing/TestPage_ExpectedResult.html
@@ -4,8 +4,12 @@
   <title>test page</title>
 
     <script languange="javascript" id="org-apache-wicket-markup-html-header-testing-TestExtendedPanel-0">
+/*<![CDATA[*/
+
       alert('wicket head works in extended panel !');
-    </script>
+    
+/*]]>*/
+</script>
   </head>
 <body>
   body text here<br>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/InlinePanelPageExpectedResult_7.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/InlinePanelPageExpectedResult_7.html
index 590de64fe0..7983196bc7 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/InlinePanelPageExpectedResult_7.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/InlinePanelPageExpectedResult_7.html
@@ -2,12 +2,16 @@
 <head><script type="text/javascript" src="../resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]]>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/bookmarkable/org.apache.wicket.markup.html.panel.InlinePanelPage_7";
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 </head><body>
 
 <div wicket:id="container">
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/InlinePanelPageExpectedResult_8.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/InlinePanelPageExpectedResult_8.html
index 325b48be3a..67c6590a73 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/InlinePanelPageExpectedResult_8.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/InlinePanelPageExpectedResult_8.html
@@ -2,12 +2,16 @@
 <head><script type="text/javascript" src="../resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.WicketAjaxReference/wicket-ajax.js"></script>
 <script type="text/javascript" src="../resource/org.apache.wicket.ajax.AbstractDefaultAjaxBehavior/wicket-ajax-debug.js"></script>
-<script type="text/javascript" id="wicket-ajax-debug-enable"><!--/*--><![CDATA[/*><!--*/
+<script type="text/javascript" id="wicket-ajax-debug-enable">
+/*<![CDATA[*/
 wicketAjaxDebugEnable=true;
-/*-->]]>*/</script>
-<script type="text/javascript" id="wicket-ajax-base-url"><!--/*--><![CDATA[/*><!--*/
+/*]]>*/
+</script>
+<script type="text/javascript" id="wicket-ajax-base-url">
+/*<![CDATA[*/
 Wicket.Ajax.baseUrl="wicket/bookmarkable/org.apache.wicket.markup.html.panel.InlinePanelPage_8";
-/*-->]]>*/</script>
+/*]]>*/
+</script>
 </head><body>
 
 <div wicket:id="first">
