diff --git a/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java b/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java
index b55b405861..bf81f1445f 100644
--- a/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java
+++ b/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java
@@ -273,14 +273,7 @@ public class PackageResource extends AbstractResource implements IStaticCacheabl
 				// read resource data
 				final byte[] bytes;
 
-				try
-				{
-					bytes = IOUtils.toByteArray(resourceStream.getInputStream());
-				}
-				finally
-				{
-					resourceStream.close();
-				}
+				bytes = IOUtils.toByteArray(resourceStream.getInputStream());
 
 				final byte[] processed = processResponse(attributes, bytes);
 
@@ -307,6 +300,16 @@ public class PackageResource extends AbstractResource implements IStaticCacheabl
 				log.debug(e.getMessage(), e);
 				return sendResourceError(resourceResponse, 500, "Unable to open resource stream");
 			}
+			finally
+			{
+				try {
+					resourceStream.close();
+				}
+				catch (IOException e)
+				{
+					log.warn("Unable to close the resource stream", e);
+				}
+			}
 		}
 
 		return resourceResponse;
diff --git a/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceReference.java b/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceReference.java
index be47e7eada..49c354d37d 100644
--- a/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceReference.java
+++ b/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceReference.java
@@ -490,7 +490,7 @@ public abstract class ResourceReference implements Serializable
 	}
 
 	/**
-	 * @return the resoureces this ResourceReference depends on.
+	 * @return the resources this ResourceReference depends on.
 	 */
 	public Iterable<? extends HeaderItem> getDependencies()
 	{
diff --git a/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceStreamResource.java b/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceStreamResource.java
index 9d24d5bec4..7600aa8615 100644
--- a/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceStreamResource.java
+++ b/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceStreamResource.java
@@ -46,7 +46,6 @@ public class ResourceStreamResource extends AbstractResource
 	private String fileName;
 	private ContentDisposition contentDisposition = ContentDisposition.INLINE;
 	private String textEncoding;
-	private String mimeType;
 
 	private Duration cacheDuration;
 
@@ -145,15 +144,11 @@ public class ResourceStreamResource extends AbstractResource
 			}
 			data.setFileName(fileName);
 
-			final String contentType;
-			if (fileName != null && Application.exists())
+			String contentType = stream.getContentType();
+			if (contentType == null && fileName != null && Application.exists())
 			{
 				contentType = Application.get().getMimeType(fileName);
 			}
-			else
-			{
-				contentType = stream.getContentType();
-			}
 			data.setContentType(contentType);
 			data.setTextEncoding(textEncoding);
 
diff --git a/wicket-core/src/main/java/org/apache/wicket/request/resource/caching/version/MessageDigestResourceVersion.java b/wicket-core/src/main/java/org/apache/wicket/request/resource/caching/version/MessageDigestResourceVersion.java
index b30eb8af82..a320fd69df 100644
--- a/wicket-core/src/main/java/org/apache/wicket/request/resource/caching/version/MessageDigestResourceVersion.java
+++ b/wicket-core/src/main/java/org/apache/wicket/request/resource/caching/version/MessageDigestResourceVersion.java
@@ -138,7 +138,7 @@ public class MessageDigestResourceVersion implements IResourceVersion
 			}
 			finally
 			{
-				IOUtils.close(inputStream);
+				IOUtils.close(stream);
 			}
 		}
 		catch (IOException e)
diff --git a/wicket-core/src/main/java/org/apache/wicket/util/resource/UrlResourceStream.java b/wicket-core/src/main/java/org/apache/wicket/util/resource/UrlResourceStream.java
index 10d10e42c5..a3904bf1c7 100644
--- a/wicket-core/src/main/java/org/apache/wicket/util/resource/UrlResourceStream.java
+++ b/wicket-core/src/main/java/org/apache/wicket/util/resource/UrlResourceStream.java
@@ -230,8 +230,11 @@ public class UrlResourceStream extends AbstractResourceStream
 		if (data != null)
 		{
 			URLConnection connection = url.openConnection();
-			data.contentLength = connection.getContentLength();
-			Connections.close(connection);
+			try {
+				data.contentLength = connection.getContentLength();
+			} finally {
+				Connections.close(connection);
+			}
 		}
 	}
 
