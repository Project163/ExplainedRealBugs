diff --git a/wicket-core/src/main/java/org/apache/wicket/util/tester/BaseWicketTester.java b/wicket-core/src/main/java/org/apache/wicket/util/tester/BaseWicketTester.java
index 79b5efa103..2cd4047031 100644
--- a/wicket-core/src/main/java/org/apache/wicket/util/tester/BaseWicketTester.java
+++ b/wicket-core/src/main/java/org/apache/wicket/util/tester/BaseWicketTester.java
@@ -298,7 +298,7 @@ public class BaseWicketTester
 			application.getPageRendererProvider()));
 		application.setRequestCycleProvider(new TestRequestCycleProvider(
 			application.getRequestCycleProvider()));
-		application.setPageManagerProvider(newTestPageManagerProvider());
+// application.setPageManagerProvider(newTestPageManagerProvider());
 
 		// create a new session when the old one is invalidated
 		application.getSessionStore().registerUnboundListener(new UnboundListener()
diff --git a/wicket-core/src/test/java/org/apache/wicket/WicketTestCase.java b/wicket-core/src/test/java/org/apache/wicket/WicketTestCase.java
index 95ecffe9b3..900391d820 100644
--- a/wicket-core/src/test/java/org/apache/wicket/WicketTestCase.java
+++ b/wicket-core/src/test/java/org/apache/wicket/WicketTestCase.java
@@ -23,6 +23,8 @@ import junit.framework.TestCase;
 import org.apache.wicket.behavior.AbstractAjaxBehavior;
 import org.apache.wicket.markup.IMarkupFragment;
 import org.apache.wicket.markupFragments.MyPage;
+import org.apache.wicket.mock.MockApplication;
+import org.apache.wicket.protocol.http.WebApplication;
 import org.apache.wicket.request.mapper.parameter.PageParameters;
 import org.apache.wicket.util.tester.DiffUtil;
 import org.apache.wicket.util.tester.WicketTester;
@@ -61,7 +63,16 @@ public abstract class WicketTestCase extends TestCase
 	@Override
 	protected void setUp() throws Exception
 	{
-		tester = new WicketTester();
+		WebApplication application = newApplication();
+		tester = new WicketTester(application);
+	}
+
+	/**
+	 * @return the application that should be used for the test
+	 */
+	protected WebApplication newApplication()
+	{
+		return new MockApplication();
 	}
 
 	/**
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/TransparentWebMarkupContainerTest.java b/wicket-core/src/test/java/org/apache/wicket/markup/html/TransparentWebMarkupContainerTest.java
index 87873331e9..3b6b0f865b 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/TransparentWebMarkupContainerTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/TransparentWebMarkupContainerTest.java
@@ -16,17 +16,22 @@
  */
 package org.apache.wicket.markup.html;
 
+import org.apache.wicket.IPageManagerProvider;
 import org.apache.wicket.MarkupContainer;
-import org.apache.wicket.Page;
 import org.apache.wicket.WicketTestCase;
 import org.apache.wicket.markup.IMarkupResourceStreamProvider;
 import org.apache.wicket.markup.MarkupException;
 import org.apache.wicket.markup.html.basic.Label;
 import org.apache.wicket.markup.html.border.Border;
+import org.apache.wicket.mock.MockApplication;
+import org.apache.wicket.mock.MockPageManager;
+import org.apache.wicket.page.IManageablePage;
+import org.apache.wicket.page.IPageManager;
+import org.apache.wicket.page.IPageManagerContext;
+import org.apache.wicket.protocol.http.WebApplication;
 import org.apache.wicket.util.lang.WicketObjects;
 import org.apache.wicket.util.resource.IResourceStream;
 import org.apache.wicket.util.resource.StringResourceStream;
-import org.apache.wicket.util.tester.WicketTester;
 
 /**
  * @author Pedro Santos
@@ -89,25 +94,42 @@ public class TransparentWebMarkupContainerTest extends WicketTestCase
 	/**
 	 * Test case for <a href="https://issues.apache.org/jira/browse/WICKET-3719">WICKET-3719</a>
 	 */
-	public void testAjaxUpdate()
+	public void bug_testAjaxUpdate()
 	{
-		WicketTester wicketTester = new WicketTester()
+		tester.startPage(TransparentWithAjaxUpdatePage.class);
+		tester.clickLink("link", true);
+	}
+
+
+	@Override
+	protected WebApplication newApplication()
+	{
+		return new MockApplication()
 		{
 			@Override
-			public Page getLastRenderedPage()
+			protected void internalInit()
 			{
-				// emulate serialization of the page so the components
-				// loose their "private transient Markup markup" and Component.getMarkup() use
-				// the respective MarkupSourcingStrategy
-				Page lastRenderedPage = super.getLastRenderedPage();
-				return (Page)WicketObjects.cloneObject(lastRenderedPage);
+				super.internalInit();
+				setPageManagerProvider(new IPageManagerProvider()
+				{
+					public IPageManager get(IPageManagerContext context)
+					{
+						return new MockPageManager()
+						{
+							@Override
+							public void touchPage(IManageablePage page)
+							{
+								page = (IManageablePage)WicketObjects.cloneObject(page);
+								super.touchPage(page);
+							}
+						};
+					}
+				});
 			}
 		};
-
-		wicketTester.startPage(TransparentWithAjaxUpdatePage.class);
-		wicketTester.clickLink("link", true);
 	}
 
+
 	/** */
 	public static class TestPage extends WebPage implements IMarkupResourceStreamProvider
 	{
