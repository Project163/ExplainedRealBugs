diff --git a/wicket-core/src/main/java/org/apache/wicket/util/tester/BaseWicketTester.java b/wicket-core/src/main/java/org/apache/wicket/util/tester/BaseWicketTester.java
index c97505f3eb..50f8c158a9 100644
--- a/wicket-core/src/main/java/org/apache/wicket/util/tester/BaseWicketTester.java
+++ b/wicket-core/src/main/java/org/apache/wicket/util/tester/BaseWicketTester.java
@@ -50,6 +50,7 @@ import org.apache.wicket.Session;
 import org.apache.wicket.ThreadContext;
 import org.apache.wicket.WicketRuntimeException;
 import org.apache.wicket.ajax.AbstractAjaxTimerBehavior;
+import org.apache.wicket.ajax.AbstractDefaultAjaxBehavior;
 import org.apache.wicket.ajax.AjaxEventBehavior;
 import org.apache.wicket.ajax.AjaxRequestTarget;
 import org.apache.wicket.ajax.form.AjaxFormSubmitBehavior;
@@ -654,18 +655,22 @@ public class BaseWicketTester
 	}
 
 	/**
+	 * This method tries to parse the last response to return the encoded base URL and will throw an
+	 * exception if there none was encoded.
 	 * 
-	 * @return last Wicket-Ajax-BaseURL set on AJAX HTTP request header
+	 * @return Wicket-Ajax-BaseURL set on last response by {@link AbstractDefaultAjaxBehavior}
+	 * @throws IOException
+	 * @throws ResourceStreamNotFoundException
+	 * @throws ParseException
 	 */
-	public String getWicketAjaxBaseUrlFromLastRequest() throws IOException,
+	public String getWicketAjaxBaseUrlEncodedInLastResponse() throws IOException,
 		ResourceStreamNotFoundException, ParseException
 	{
 		XmlPullParser parser = new XmlPullParser();
 		parser.parse(getLastResponseAsString());
 		XmlTag tag;
-		do
+		while ((tag = (XmlTag)parser.nextTag()) != null)
 		{
-			tag = (XmlTag)parser.nextTag();
 			if (tag.isOpen() && tag.getName().equals("script") &&
 				"wicket-ajax-base-url".equals(tag.getString("id")))
 			{
@@ -673,8 +678,8 @@ public class BaseWicketTester
 				return parser.getString().toString().split("\\\"")[1];
 			}
 		}
-		while (tag != null);
-		return null;
+		throw new WicketRuntimeException(
+			"Last response has no AJAX base URL set by AbstractDefaultAjaxBehavior.");
 	}
 
 	/**
diff --git a/wicket-core/src/test/java/org/apache/wicket/request/handler/PageProviderTest.java b/wicket-core/src/test/java/org/apache/wicket/request/handler/PageProviderTest.java
index d72790a0c8..7ddcafcaf0 100644
--- a/wicket-core/src/test/java/org/apache/wicket/request/handler/PageProviderTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/request/handler/PageProviderTest.java
@@ -109,7 +109,7 @@ public class PageProviderTest extends WicketTestCase
 	{
 		tester.getRequest().setUrl(url);
 		tester.getRequest().addHeader("Wicket-Ajax-BaseURL",
-			tester.getWicketAjaxBaseUrlFromLastRequest());
+			tester.getWicketAjaxBaseUrlEncodedInLastResponse());
 		tester.getRequest().addHeader("Wicket-Ajax", "true");
 		tester.processRequest();
 	}
