diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/html/panel/FragmentMarkupSourcingStrategy.java b/wicket-core/src/main/java/org/apache/wicket/markup/html/panel/FragmentMarkupSourcingStrategy.java
index 81efccf62f..ac47e37d07 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/html/panel/FragmentMarkupSourcingStrategy.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/html/panel/FragmentMarkupSourcingStrategy.java
@@ -21,9 +21,11 @@ import org.apache.wicket.MarkupContainer;
 import org.apache.wicket.markup.ComponentTag;
 import org.apache.wicket.markup.IMarkupFragment;
 import org.apache.wicket.markup.Markup;
+import org.apache.wicket.markup.MarkupElement;
 import org.apache.wicket.markup.MarkupException;
 import org.apache.wicket.markup.MarkupNotFoundException;
 import org.apache.wicket.markup.MarkupStream;
+import org.apache.wicket.markup.WicketTag;
 import org.apache.wicket.util.lang.Args;
 
 /**
@@ -143,6 +145,16 @@ public class FragmentMarkupSourcingStrategy extends AbstractMarkupSourcingStrate
 			throw new MarkupNotFoundException("No Markup found for Fragment " + markupId +
 				" in providing markup container " + getMarkupProvider(container));
 		}
+		else
+		{
+			MarkupElement fragmentTag = childMarkup.get(0);
+			if ((fragmentTag instanceof WicketTag && ((WicketTag)fragmentTag).isFragementTag()) == false)
+			{
+				throw new MarkupNotFoundException("Markup found for Fragment '" + markupId
+					+ "' in providing markup container " + getMarkupProvider(container)
+					+ " is not a fragment tag");
+			}
+		}
 
 		if (child == null)
 		{
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/FragmentTestCase.java b/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/FragmentTestCase.java
index 61accdced4..48b0b62101 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/FragmentTestCase.java
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/FragmentTestCase.java
@@ -17,6 +17,7 @@
 package org.apache.wicket.markup.html.panel;
 
 import org.apache.wicket.WicketTestCase;
+import org.apache.wicket.markup.MarkupNotFoundException;
 import org.junit.Test;
 
 /**
@@ -29,4 +30,18 @@ public class FragmentTestCase extends WicketTestCase
 	{
 		tester.startComponentInPage(FragmentTestPanel.class);
 	}
+
+	@Test
+	public void testComponentAndFragmentWithSameId()
+	{
+		try
+		{
+			tester.startComponentInPage(FragmentTestPanel_2.class);
+			fail();
+		}
+		catch (MarkupNotFoundException ex)
+		{
+			assertTrue(ex.getMessage().contains("is not a fragment tag"));
+		}
+	}
 }
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/FragmentTestPanel.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/FragmentTestPanel.html
index 87a5f2a472..c85f2cfb89 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/FragmentTestPanel.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/FragmentTestPanel.html
@@ -3,12 +3,13 @@
 
 <wicket:panel>
 	<div wicket:id="test">[test fragment goes here]</div>
-</wicket:panel>
+	
+	<wicket:fragment wicket:id="testFrag">
+		<wicket:message key="message.test">[test message]</wicket:message>
+		<span wicket:id="label">[test label]</span>
+	</wicket:fragment>
 
-<wicket:fragment wicket:id="testFrag">
-	<wicket:message key="message.test">[test message]</wicket:message>
-	<span wicket:id="label">[test label]</span>
-</wicket:fragment>
+</wicket:panel>
 
 </body>
 </html>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/FragmentTestPanel_2.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/FragmentTestPanel_2.html
new file mode 100644
index 0000000000..6d21336d8e
--- /dev/null
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/FragmentTestPanel_2.html
@@ -0,0 +1,14 @@
+<html xmlns:wicket="http://wicket.apache.org">
+<body>
+
+<wicket:panel>
+	<div wicket:id="testFrag">[same id as fragment below]</div>
+	<div wicket:id="test">[test fragment goes here]</div>
+
+	<wicket:fragment wicket:id="testFrag">
+	</wicket:fragment>
+
+</wicket:panel>
+
+</body>
+</html>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/FragmentTestPanel_2.java b/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/FragmentTestPanel_2.java
new file mode 100644
index 0000000000..a6348d7b4e
--- /dev/null
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/panel/FragmentTestPanel_2.java
@@ -0,0 +1,58 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.wicket.markup.html.panel;
+
+import org.apache.wicket.markup.html.WebMarkupContainer;
+
+/**
+ * 
+ */
+public class FragmentTestPanel_2 extends Panel
+{
+	private static final long serialVersionUID = 1L;
+
+	/**
+	 * Construct.
+	 * 
+	 * @param id
+	 */
+	public FragmentTestPanel_2(String id)
+	{
+		super(id);
+
+		add(new WebMarkupContainer("testFrag"));
+		add(new TestFragment("test"));
+	}
+
+	/**
+	 * 
+	 */
+	private class TestFragment extends Fragment
+	{
+		private static final long serialVersionUID = 1L;
+
+		/**
+		 * Construct.
+		 * 
+		 * @param id
+		 */
+		public TestFragment(String id)
+		{
+			super(id, "testFrag", FragmentTestPanel_2.this);
+		}
+	}
+}
