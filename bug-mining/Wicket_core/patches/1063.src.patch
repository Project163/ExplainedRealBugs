diff --git a/wicket-core/src/main/java/org/apache/wicket/Component.java b/wicket-core/src/main/java/org/apache/wicket/Component.java
index c1d1826fe9..d998680381 100644
--- a/wicket-core/src/main/java/org/apache/wicket/Component.java
+++ b/wicket-core/src/main/java/org/apache/wicket/Component.java
@@ -2977,6 +2977,9 @@ public abstract class Component
 			modelChanging();
 			setModelImpl(wrap(model));
 			modelChanged();
+
+			// WICKET-3413 reset 'inherited model' when model is explicitely set
+			setFlag(FLAG_INHERITABLE_MODEL, false);
 		}
 
 		return this;
@@ -3005,12 +3008,6 @@ public abstract class Component
 			if (model != null)
 			{
 				data_set(0, model);
-				// WICKET-3413 reset 'inherited model' flag if model changed
-				// and a new one is not IComponentInheritedModel
-				if (getFlag(FLAG_INHERITABLE_MODEL) && !(model instanceof IComponentInheritedModel))
-				{
-					setFlag(FLAG_INHERITABLE_MODEL, false);
-				}
 			}
 			else
 			{
diff --git a/wicket-core/src/test/java/org/apache/wicket/model/InheritedModelTest.java b/wicket-core/src/test/java/org/apache/wicket/model/InheritedModelTest.java
index 66ed35361f..fe625fe24e 100644
--- a/wicket-core/src/test/java/org/apache/wicket/model/InheritedModelTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/model/InheritedModelTest.java
@@ -104,4 +104,33 @@ public class InheritedModelTest extends WicketTestCase
 		tester.startPage(page);
 		assertEquals("bar", page.label.getDefaultModelObject());
 	}
+
+	/**
+	 * Tests if Component#FLAG_INHERITABLE_MODEL reset after model change (WICKET-5655).
+	 */
+	@Test
+	public void testResetInheritedModelFlag2()
+	{
+		ValueMap data1 = new ValueMap();
+		data1.put("label", "foo");
+
+		ValueMap data2 = new ValueMap();
+		data2.put("value", "bar");
+
+		InheritedTestPage page = new InheritedTestPage();
+
+		page.setDefaultModel(new CompoundPropertyModel<>(data1));
+		tester.startPage(page);
+		assertEquals("foo", page.label.getDefaultModelObject());
+
+		page.label.setDefaultModel(new CompoundPropertyModel<String>(new PropertyModel<String>(
+			data2, "value")));
+		tester.startPage(page);
+		assertEquals("bar", page.label.getDefaultModelObject());
+
+		page.detach();
+
+		tester.startPage(page);
+		assertEquals("bar", page.label.getDefaultModelObject());
+	}
 }
