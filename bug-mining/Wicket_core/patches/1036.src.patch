diff --git a/wicket-core/src/main/java/org/apache/wicket/protocol/http/servlet/ServletWebResponse.java b/wicket-core/src/main/java/org/apache/wicket/protocol/http/servlet/ServletWebResponse.java
index e665aaf1db..e7e32d17a2 100644
--- a/wicket-core/src/main/java/org/apache/wicket/protocol/http/servlet/ServletWebResponse.java
+++ b/wicket-core/src/main/java/org/apache/wicket/protocol/http/servlet/ServletWebResponse.java
@@ -173,29 +173,39 @@ public class ServletWebResponse extends WebResponse
 	{
 		Args.notNull(url, "url");
 
+		UrlRenderer urlRenderer = RequestCycle.get().getUrlRenderer();
+
+		Url originalUrl = Url.parse(url);
+
 		/*
 		  WICKET-4645 - always pass absolute url to the web container for encoding
 		  because when REDIRECT_TO_BUFFER is in use Wicket may render PageB when
 		  PageA is actually the requested one and the web container cannot resolve
 		  the base url properly
 		 */
-		UrlRenderer urlRenderer = RequestCycle.get().getUrlRenderer();
-		Url relativeUrl = Url.parse(url);
-		String fullUrl = urlRenderer.renderFullUrl(relativeUrl);
+		String fullUrl = urlRenderer.renderFullUrl(originalUrl);
 		String encodedFullUrl = httpServletResponse.encodeURL(fullUrl);
-		final String encodedRelativeUrl;
-		if (fullUrl.equals(encodedFullUrl))
+
+		final String encodedUrl;
+		if (originalUrl.isFull())
 		{
-			// no encoding happened so just reuse the relative url
-			encodedRelativeUrl = url.toString();
+			encodedUrl = encodedFullUrl;
 		}
 		else
 		{
-			// get the relative url with the jsessionid encoded in it
-			Url _encoded = Url.parse(encodedFullUrl);
-			encodedRelativeUrl = urlRenderer.renderRelativeUrl(_encoded);
+			if (fullUrl.equals(encodedFullUrl))
+			{
+				// no encoding happened so just reuse the original url
+				encodedUrl = url.toString();
+			}
+			else
+			{
+				// get the relative url with the jsessionid encoded in it
+				Url _encoded = Url.parse(encodedFullUrl);
+				encodedUrl = urlRenderer.renderRelativeUrl(_encoded);
+			}
 		}
-		return encodedRelativeUrl;
+		return encodedUrl;
 	}
 
 	@Override
@@ -203,29 +213,38 @@ public class ServletWebResponse extends WebResponse
 	{
 		Args.notNull(url, "url");
 
+		UrlRenderer urlRenderer = RequestCycle.get().getUrlRenderer();
+
+		Url originalUrl = Url.parse(url);
+
 		/*
-		  WICKET-4854 - always pass absolute url to the web container for encoding
-		  because when REDIRECT_TO_BUFFER is in use Wicket may render PageB when
-		  PageA is actually the requested one and the web container cannot resolve
-		  the base url properly
+		 * WICKET-4645 - always pass absolute url to the web container for encoding because when
+		 * REDIRECT_TO_BUFFER is in use Wicket may render PageB when PageA is actually the requested
+		 * one and the web container cannot resolve the base url properly
 		 */
-		UrlRenderer urlRenderer = new UrlRenderer(webRequest);
-		Url relativeUrl = Url.parse(url);
-		String fullUrl = urlRenderer.renderFullUrl(relativeUrl);
+		String fullUrl = urlRenderer.renderFullUrl(originalUrl);
 		String encodedFullUrl = httpServletResponse.encodeRedirectURL(fullUrl);
-		final String encodedRelativeUrl;
-		if (fullUrl.equals(encodedFullUrl))
+
+		final String encodedUrl;
+		if (originalUrl.isFull())
 		{
-			// no encoding happened so just reuse the relative url
-			encodedRelativeUrl = url.toString();
+			encodedUrl = encodedFullUrl;
 		}
 		else
 		{
-			// get the relative url with the jsessionid encoded in it
-			Url _encoded = Url.parse(encodedFullUrl);
-			encodedRelativeUrl = urlRenderer.renderRelativeUrl(_encoded);
+			if (fullUrl.equals(encodedFullUrl))
+			{
+				// no encoding happened so just reuse the original url
+				encodedUrl = url.toString();
+			}
+			else
+			{
+				// get the relative url with the jsessionid encoded in it
+				Url _encoded = Url.parse(encodedFullUrl);
+				encodedUrl = urlRenderer.renderRelativeUrl(_encoded);
+			}
 		}
-		return encodedRelativeUrl;
+		return encodedUrl;
 	}
 
 	@Override
diff --git a/wicket-core/src/test/java/org/apache/wicket/protocol/http/servlet/ServletWebResponseTest.java b/wicket-core/src/test/java/org/apache/wicket/protocol/http/servlet/ServletWebResponseTest.java
index 1fe3627a65..5c5e9eb44c 100644
--- a/wicket-core/src/test/java/org/apache/wicket/protocol/http/servlet/ServletWebResponseTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/protocol/http/servlet/ServletWebResponseTest.java
@@ -27,9 +27,12 @@ import java.io.StringWriter;
 import javax.servlet.http.HttpServletRequest;
 import javax.servlet.http.HttpServletResponse;
 
+import org.apache.wicket.ThreadContext;
 import org.apache.wicket.protocol.http.mock.MockHttpServletRequest;
 import org.apache.wicket.protocol.http.mock.MockHttpServletResponse;
 import org.apache.wicket.request.Url;
+import org.apache.wicket.request.UrlRenderer;
+import org.apache.wicket.request.cycle.RequestCycle;
 import org.junit.Assert;
 import org.junit.Test;
 import org.mockito.Matchers;
@@ -153,4 +156,62 @@ public class ServletWebResponseTest extends Assert
 			"attachment; filename=\"name%20with%20%D0%B1%D1%8A%D0%BB%D0%B3%D0%B0%D1%80%D1%81%D0%BA%D0%B8\"; filename*=UTF-8''name%20with%20%D0%B1%D1%8A%D0%BB%D0%B3%D0%B0%D1%80%D1%81%D0%BA%D0%B8",
 			header);
 	}
+
+	/**
+	 * WICKET-5582 absolute URLs stay absolute after encoding
+	 */
+	@Test
+	public void encodeAbsoluteUrl()
+	{
+		final String url = "http://localhost:8080/path";
+
+		ServletWebRequest webRequest = mock(ServletWebRequest.class);
+		when(webRequest.isAjax()).thenReturn(Boolean.FALSE);
+		Url baseUrl = Url.parse("./baseUrl");
+		baseUrl.setProtocol("http");
+		baseUrl.setHost("someHost");
+		baseUrl.setPort(80);
+		when(webRequest.getClientUrl()).thenReturn(baseUrl);
+
+		UrlRenderer renderer = new UrlRenderer(webRequest);
+
+		RequestCycle requestCycle = mock(RequestCycle.class);
+		ThreadContext.setRequestCycle(requestCycle);
+		when(requestCycle.getUrlRenderer()).thenReturn(renderer);
+
+		HttpServletResponse httpServletResponse = mock(HttpServletResponse.class);
+		when(httpServletResponse.encodeURL(Matchers.eq(url))).thenReturn(url + ";foo");
+
+		ServletWebResponse webResponse = new ServletWebResponse(webRequest, httpServletResponse);
+		assertEquals(url + ";foo", webResponse.encodeURL(url));
+	}
+
+	/**
+	 * WICKET-5582 absolute URLs stay absolute after encoding
+	 */
+	@Test
+	public void encodeRedirectAbsoluteUrl()
+	{
+		final String url = "http://localhost:8080/path";
+
+		ServletWebRequest webRequest = mock(ServletWebRequest.class);
+		when(webRequest.isAjax()).thenReturn(Boolean.FALSE);
+		Url baseUrl = Url.parse("./baseUrl");
+		baseUrl.setProtocol("http");
+		baseUrl.setHost("someHost");
+		baseUrl.setPort(80);
+		when(webRequest.getClientUrl()).thenReturn(baseUrl);
+
+		UrlRenderer renderer = new UrlRenderer(webRequest);
+
+		RequestCycle requestCycle = mock(RequestCycle.class);
+		ThreadContext.setRequestCycle(requestCycle);
+		when(requestCycle.getUrlRenderer()).thenReturn(renderer);
+
+		HttpServletResponse httpServletResponse = mock(HttpServletResponse.class);
+		when(httpServletResponse.encodeRedirectURL(Matchers.eq(url))).thenReturn(url + ";foo");
+
+		ServletWebResponse webResponse = new ServletWebResponse(webRequest, httpServletResponse);
+		assertEquals(url + ";foo", webResponse.encodeRedirectURL(url));
+	}
 }
\ No newline at end of file
