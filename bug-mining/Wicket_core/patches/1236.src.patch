diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/EnclosureHandler.java b/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/EnclosureHandler.java
index b29da3bef7..507494420f 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/EnclosureHandler.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/EnclosureHandler.java
@@ -144,7 +144,7 @@ public final class EnclosureHandler extends AbstractMarkupFilter implements ICom
 		// Are we inside a wicket:enclosure tag?
 		else if (stack != null)
 		{
-			ComponentTag lastEnclosure = stack.getLast();
+			ComponentTag lastEnclosure = stack.getFirst();
 
 			// If the enclosure tag has NO child attribute, then ...
 			if (Strings.isEmpty(lastEnclosure.getAttribute(CHILD_ATTRIBUTE)))
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/EnclosureTest.java b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/EnclosureTest.java
index c0e8d33534..8ddc60aca1 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/EnclosureTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/EnclosureTest.java
@@ -432,4 +432,48 @@ public class EnclosureTest extends WicketTestCase
 
 		tester.assertContainsNot(ChildWithDeeperPathInTransparentContainerPage.LABEL_TEXT);
 	}
+	
+	@Test
+	public void nestedEnclousers()
+	{
+		TestPageMarkup p = new TestPageMarkup();
+		p.setPageMarkup("<wicket:enclosure child='labelOuter'>tOuter Enclosure <span wicket:id='labelOuter'/>"
+				+ "<wicket:enclosure>Inner Enclosure <span wicket:id='labelInner' /></wicket:enclosure>"
+				+ "</wicket:enclosure>");
+		
+		p.add(new Label("labelOuter"), new Label("labelInner"));
+		tester.startPage(p);
+	}
+	
+	private static class TestPageMarkup extends WebPage implements IMarkupResourceStreamProvider
+	{
+		private String markup;
+
+		public TestPageMarkup()
+		{
+		}
+
+		public TestPageMarkup(String markup)
+		{
+			this.markup = markup;
+		}
+
+		protected String getPageMarkup()
+		{
+			return markup;
+		}
+
+		public void setPageMarkup(String markup)
+		{
+			this.markup = markup;
+		}
+
+		@Override
+		public IResourceStream getMarkupResourceStream(MarkupContainer container,
+			Class<?> containerClass)
+		{
+			return new StringResourceStream(getPageMarkup());
+		}
+
+	}
 }
diff --git a/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingTest.java b/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingTest.java
index 3912d6289f..463999db32 100644
--- a/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingTest.java
@@ -19,6 +19,7 @@ package org.apache.wicket.queueing;
 import static org.apache.wicket.queueing.WicketMatchers.hasPath;
 import static org.hamcrest.Matchers.is;
 import static org.hamcrest.Matchers.nullValue;
+import static org.junit.Assert.*;
 
 import java.util.ArrayList;
 
