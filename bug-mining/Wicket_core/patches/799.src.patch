diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/html/IPackageResourceGuard.java b/wicket-core/src/main/java/org/apache/wicket/markup/html/IPackageResourceGuard.java
index 8607d3778a..9c90af60e2 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/html/IPackageResourceGuard.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/html/IPackageResourceGuard.java
@@ -32,11 +32,11 @@ public interface IPackageResourceGuard
 	 * 
 	 * @param scope
 	 *            This argument will be used to get the class loader for loading the package
-	 *            resource, and to determine what package it is in
-	 * @param path
-	 *            The path to the resource
+	 *            resource
+	 * @param absolutePath
+	 *            The absolute path to the resource
 	 * 
 	 * @return True if access is permitted, false otherwise
 	 */
-	boolean accept(final Class<?> scope, final String path);
+	boolean accept(final Class<?> scope, final String absolutePath);
 }
diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/html/PackageResourceGuard.java b/wicket-core/src/main/java/org/apache/wicket/markup/html/PackageResourceGuard.java
index 393c6a6303..94156f3a07 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/html/PackageResourceGuard.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/html/PackageResourceGuard.java
@@ -20,7 +20,6 @@ import java.util.HashSet;
 import java.util.Set;
 
 import org.apache.wicket.Application;
-import org.apache.wicket.util.lang.Packages;
 import org.apache.wicket.util.string.Strings;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
@@ -65,10 +64,9 @@ public class PackageResourceGuard implements IPackageResourceGuard
 	 * @see org.apache.wicket.markup.html.IPackageResourceGuard#accept(java.lang.Class,
 	 *      java.lang.String)
 	 */
-	@Override
-	public boolean accept(Class<?> scope, String path)
+	public boolean accept(Class<?> scope, String absolutePath)
 	{
-		String absolutePath = Packages.absolutePath(scope, path);
+		// path is already absolute
 		return acceptAbsolutePath(absolutePath);
 	}
 
diff --git a/wicket-core/src/test/java/org/apache/wicket/ParentResourceEscapePathTest.java b/wicket-core/src/test/java/org/apache/wicket/ParentResourceEscapePathTest.java
index 1f29840c77..eac7f42fd5 100644
--- a/wicket-core/src/test/java/org/apache/wicket/ParentResourceEscapePathTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/ParentResourceEscapePathTest.java
@@ -18,6 +18,7 @@ package org.apache.wicket;
 
 import java.io.InputStream;
 
+import org.apache.wicket.markup.html.PackageResourceGuard;
 import org.apache.wicket.request.Url;
 import org.apache.wicket.request.resource.PackageResourceReference;
 import org.apache.wicket.request.resource.ResourceReference;
@@ -93,6 +94,10 @@ public class ParentResourceEscapePathTest extends WicketTestCase
 	@Test
 	public void requestHandlingOfResourceUrlWithEscapeStringInsideTest()
 	{
+		((PackageResourceGuard)tester.getApplication()
+			.getResourceSettings()
+			.getPackageResourceGuard()).setAllowAccessToRootResources(true);
+
 		tester.getApplication().getResourceSettings().setParentFolderPlaceholder("-updir-");
 		requestHandlingOfResourceUrlWithEscapeStringInside();
 
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/PackageResourceTest.java b/wicket-core/src/test/java/org/apache/wicket/markup/html/PackageResourceTest.java
index 056fad9314..a995e4eff5 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/PackageResourceTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/PackageResourceTest.java
@@ -23,10 +23,10 @@ import org.apache.wicket.SharedResources;
 import org.apache.wicket.WicketTestCase;
 import org.apache.wicket.protocol.http.WebApplication;
 import org.apache.wicket.request.resource.JavaScriptPackageResource;
-import org.apache.wicket.request.resource.JavaScriptResourceReference;
 import org.apache.wicket.request.resource.PackageResource;
 import org.apache.wicket.request.resource.PackageResourceReference;
 import org.apache.wicket.request.resource.ResourceReference;
+import org.apache.wicket.util.lang.Packages;
 import org.junit.Before;
 import org.junit.Test;
 
@@ -75,13 +75,20 @@ public class PackageResourceTest extends WicketTestCase
 		assertFalse(guard.acceptExtension("java"));
 		assertTrue(guard.acceptAbsolutePath("foo/Bar.txt"));
 		assertFalse(guard.acceptAbsolutePath("foo/Bar.java"));
-		assertTrue(guard.accept(PackageResourceTest.class, "Bar.txt"));
-		assertTrue(guard.accept(PackageResourceTest.class, "Bar.txt."));
-		assertTrue(guard.accept(PackageResourceTest.class, ".Bar.txt"));
-		assertTrue(guard.accept(PackageResourceTest.class, ".Bar.txt."));
-		assertTrue(guard.accept(PackageResourceTest.class, ".Bar"));
-		assertTrue(guard.accept(PackageResourceTest.class, ".java"));
-		assertFalse(guard.accept(PackageResourceTest.class, "Bar.java"));
+		assertTrue(guard.accept(PackageResourceTest.class,
+			Packages.absolutePath(PackageResourceTest.class, "Bar.txt")));
+		assertTrue(guard.accept(PackageResourceTest.class,
+			Packages.absolutePath(PackageResourceTest.class, "Bar.txt.")));
+		assertTrue(guard.accept(PackageResourceTest.class,
+			Packages.absolutePath(PackageResourceTest.class, ".Bar.txt")));
+		assertTrue(guard.accept(PackageResourceTest.class,
+			Packages.absolutePath(PackageResourceTest.class, ".Bar.txt.")));
+		assertTrue(guard.accept(PackageResourceTest.class,
+			Packages.absolutePath(PackageResourceTest.class, ".Bar")));
+		assertTrue(guard.accept(PackageResourceTest.class,
+			Packages.absolutePath(PackageResourceTest.class, ".java")));
+		assertFalse(guard.accept(PackageResourceTest.class,
+			Packages.absolutePath(PackageResourceTest.class, "Bar.java")));
 	}
 
 	/**
@@ -163,11 +170,11 @@ public class PackageResourceTest extends WicketTestCase
 	public void textFileWithEncoding()
 	{
 		final String encoding = "Klingon-8859-42";
-		final PackageResource resource =
-			new PackageResource(PackageResourceTest.class, "packaged1.txt", null, null, null)
-			{
-				private static final long serialVersionUID = 1L;
-			};
+		final PackageResource resource = new PackageResource(PackageResourceTest.class,
+			"packaged1.txt", null, null, null)
+		{
+			private static final long serialVersionUID = 1L;
+		};
 		resource.setTextEncoding(encoding);
 		tester.startResource(resource);
 		final String contentType = tester.getLastResponse().getContentType();
@@ -178,11 +185,11 @@ public class PackageResourceTest extends WicketTestCase
 	public void javascriptFileWithEncoding()
 	{
 		final String encoding = "Klingon-8859-42";
-		final JavaScriptPackageResource resource =
-			new JavaScriptPackageResource(PackageResourceTest.class, "packaged3.js", null, null, null)
-			{
-				private static final long serialVersionUID = 1L;
-			};
+		final JavaScriptPackageResource resource = new JavaScriptPackageResource(
+			PackageResourceTest.class, "packaged3.js", null, null, null)
+		{
+			private static final long serialVersionUID = 1L;
+		};
 		resource.setTextEncoding(encoding);
 		tester.startResource(resource);
 		final String contentType = tester.getLastResponse().getContentType();
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/SecurePackageResourceGuardTest.java b/wicket-core/src/test/java/org/apache/wicket/markup/html/SecurePackageResourceGuardTest.java
index 158b08b896..3c859ce71c 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/SecurePackageResourceGuardTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/SecurePackageResourceGuardTest.java
@@ -18,6 +18,7 @@ package org.apache.wicket.markup.html;
 
 import org.apache.wicket.Application;
 import org.apache.wicket.WicketTestCase;
+import org.apache.wicket.util.lang.Packages;
 import org.junit.Test;
 
 /**
@@ -34,22 +35,29 @@ public class SecurePackageResourceGuardTest extends WicketTestCase
 		SecurePackageResourceGuard guard = new SecurePackageResourceGuard();
 		guard.setAllowAccessToRootResources(false);
 		guard.addPattern("+*.gif");
-		assertTrue(guard.accept(Application.class, "test.gif"));
-		assertTrue(guard.accept(Application.class, "mydir/test.gif"));
+		assertTrue(guard.accept(Application.class,
+			Packages.absolutePath(Application.class, "test.gif")));
+		assertTrue(guard.accept(Application.class,
+			Packages.absolutePath(Application.class, "mydir/test.gif")));
 		assertTrue(guard.accept(Application.class, "/root/mydir/test.gif"));
-		assertTrue(guard.accept(Application.class, "../test.gif"));
-		assertTrue(guard.accept(Application.class, "../../test.gif"));
+		assertTrue(guard.accept(Application.class,
+			Packages.absolutePath(Application.class, "../test.gif")));
+		assertTrue(guard.accept(Application.class,
+			Packages.absolutePath(Application.class, "../../test.gif")));
 
-		// root package
-		assertFalse(guard.accept(Application.class, "../../../test.gif"));
+		// web-inf (root package)
+		assertFalse(guard.accept(Application.class,
+			Packages.absolutePath(Application.class, "../../../test.gif")));
 		guard.setAllowAccessToRootResources(true);
-		assertTrue(guard.accept(Application.class, "../../../test.gif"));
+		assertTrue(guard.accept(Application.class,
+			Packages.absolutePath(Application.class, "../../../test.gif")));
 
 		boolean hit = false;
 		try
 		{
 			// you can not go below root
-			assertTrue(guard.accept(Application.class, "../../../../test.gif"));
+			assertTrue(guard.accept(Application.class,
+				Packages.absolutePath(Application.class, "../../../../test.gif")));
 		}
 		catch (IllegalArgumentException ex)
 		{
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/link/AutolinkPageExpectedResult_2.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/link/AutolinkPageExpectedResult_2.html
index 8be45639ca..a1e1633fde 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/link/AutolinkPageExpectedResult_2.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/link/AutolinkPageExpectedResult_2.html
@@ -27,6 +27,7 @@
 <link href="../resource/org.apache.wicket.markup.html.link.AutolinkPage_2/test.css"/>
 <a href="/root/test.html">Home</a>
 <a href="./org.apache.wicket.markup.html.link.Page1">Home</a>
+<a href="org/apache/wicket/markup/html/link/Page1.html">Home</a>
   <a href="http://www.google.com">Google</a>
 </body>
 </html>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/link/AutolinkPage_2.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/link/AutolinkPage_2.html
index 46e2e11f4f..834d6d4fa6 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/link/AutolinkPage_2.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/link/AutolinkPage_2.html
@@ -26,6 +26,7 @@
 <a href="subdir/Page1.html">Home</a>
 <link href="test.css"/>
 <a href="/root/test.html">Home</a>
+<a href="/org/apache/wicket/markup/html/link/Page1.html">Home</a>
 <a href="org/apache/wicket/markup/html/link/Page1.html">Home</a>
   <a href="http://www.google.com">Google</a>
 </body>
