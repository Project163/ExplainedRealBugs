diff --git a/wicket-core/src/main/java/org/apache/wicket/protocol/http/mock/MockServletContext.java b/wicket-core/src/main/java/org/apache/wicket/protocol/http/mock/MockServletContext.java
index 42a8996a18..392e921cd2 100755
--- a/wicket-core/src/main/java/org/apache/wicket/protocol/http/mock/MockServletContext.java
+++ b/wicket-core/src/main/java/org/apache/wicket/protocol/http/mock/MockServletContext.java
@@ -107,7 +107,7 @@ public class MockServletContext implements ServletContext
 		mimeTypes.put("htm", "text/html");
 		mimeTypes.put("css", "text/css");
 		mimeTypes.put("xml", "text/xml");
-		mimeTypes.put("js", "text/plain");
+		mimeTypes.put("js", "text/javascript");
 		mimeTypes.put("gif", "image/gif");
 		mimeTypes.put("jpg", "image/jpeg");
 		mimeTypes.put("png", "image/png");
diff --git a/wicket-core/src/main/java/org/apache/wicket/request/resource/ByteArrayResource.java b/wicket-core/src/main/java/org/apache/wicket/request/resource/ByteArrayResource.java
index d156c11563..d11cab8809 100644
--- a/wicket-core/src/main/java/org/apache/wicket/request/resource/ByteArrayResource.java
+++ b/wicket-core/src/main/java/org/apache/wicket/request/resource/ByteArrayResource.java
@@ -16,6 +16,8 @@
  */
 package org.apache.wicket.request.resource;
 
+import java.net.URLConnection;
+
 import org.apache.wicket.WicketRuntimeException;
 import org.apache.wicket.util.time.Time;
 
@@ -95,6 +97,22 @@ public class ByteArrayResource extends AbstractResource
 	{
 		final ResourceResponse response = new ResourceResponse();
 
+		String contentType = this.contentType;
+
+		if (contentType == null)
+		{
+			if (filename != null)
+			{
+				contentType = URLConnection.getFileNameMap().getContentTypeFor(filename);
+			}
+
+			if (contentType == null)
+			{
+				contentType = "application/octet-stream";
+			}
+		}
+
+
 		response.setContentType(contentType);
 		response.setLastModified(lastModified);
 
diff --git a/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java b/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java
index 449c344663..a4ce0fe962 100644
--- a/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java
+++ b/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java
@@ -252,11 +252,15 @@ public class PackageResource extends AbstractResource implements IStaticCacheabl
 				return sendResourceError(resourceResponse, HttpServletResponse.SC_NOT_FOUND,
 					"Unable to find resource");
 
-			String contentType = resourceStream.getContentType();
-			if (contentType == null && Application.exists())
+			final String contentType;
+			if (Application.exists())
 			{
 				contentType = Application.get().getMimeType(path);
 			}
+			else
+			{
+				contentType = resourceStream.getContentType();
+			}
 			// set Content-Type (may be null)
 			resourceResponse.setContentType(contentType);
 
diff --git a/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceStreamResource.java b/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceStreamResource.java
index e9d25f0563..e83257aecc 100644
--- a/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceStreamResource.java
+++ b/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceStreamResource.java
@@ -123,11 +123,15 @@ public class ResourceStreamResource extends AbstractResource
 			}
 			data.setFileName(fileName);
 
-			String contentType = stream.getContentType();
-			if (contentType == null && fileName != null && Application.exists())
+			final String contentType;
+			if (fileName != null && Application.exists())
 			{
 				contentType = Application.get().getMimeType(fileName);
 			}
+			else
+			{
+				contentType = stream.getContentType();
+			}
 			data.setContentType(contentType);
 			data.setTextEncoding(textEncoding);
 
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/PackageResourceTest.java b/wicket-core/src/test/java/org/apache/wicket/markup/html/PackageResourceTest.java
index 06d8bbd83c..f575a2122e 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/PackageResourceTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/PackageResourceTest.java
@@ -95,7 +95,7 @@ public class PackageResourceTest extends WicketTestCase
 		ResourceReference invalidResource = new PackageResourceReference(PackageResourceTest.class,
 			"i_do_not_exist.txt", Locale.ENGLISH, null, null);
 		assertNotNull(
-			"resource packaged3.txt SHOULD be available as a packaged resource even if it doesn't exist",
+			"resource i_do_not_exist.txt SHOULD be available as a packaged resource even if it doesn't exist",
 			invalidResource.getResource());
 
 		assertTrue(PackageResource.exists(PackageResourceTest.class, "packaged1.txt", null, null,
@@ -131,4 +131,31 @@ public class PackageResourceTest extends WicketTestCase
 		assertFalse(tester.processRequest());
 
 	}
+
+	/**
+	 * Test that {@link PackageResource} writes its Content-Type header in the response
+	 * 
+	 * https://issues.apache.org/jira/browse/WICKET-4119
+	 */
+	@Test
+	public void contentType()
+	{
+		PackageResource textResource = new PackageResource(PackageResourceTest.class,
+			"packaged1.txt", null, null, null)
+		{
+			private static final long serialVersionUID = 1L;
+		};
+
+		tester.startResource(textResource);
+		assertEquals("text/plain", tester.getLastResponse().getContentType());
+
+		PackageResource jsResource = new PackageResource(PackageResourceTest.class, "packaged3.js",
+			null, null, null)
+		{
+			private static final long serialVersionUID = 1L;
+		};
+
+		tester.startResource(jsResource);
+		assertEquals("text/javascript", tester.getLastResponse().getContentType());
+	}
 }
diff --git a/wicket-core/src/test/java/org/apache/wicket/request/resource/ByteArrayResourceTest.java b/wicket-core/src/test/java/org/apache/wicket/request/resource/ByteArrayResourceTest.java
index 9673894fdd..b2a0d1d29e 100644
--- a/wicket-core/src/test/java/org/apache/wicket/request/resource/ByteArrayResourceTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/request/resource/ByteArrayResourceTest.java
@@ -21,6 +21,7 @@ import static org.mockito.Matchers.same;
 import static org.mockito.Mockito.mock;
 import static org.mockito.Mockito.verify;
 
+import org.apache.wicket.WicketTestCase;
 import org.apache.wicket.request.http.WebRequest;
 import org.apache.wicket.request.http.WebResponse;
 import org.apache.wicket.request.resource.IResource.Attributes;
@@ -29,7 +30,7 @@ import org.junit.Test;
 /**
  * Unit tests for {@link ByteArrayResource}
  */
-public class ByteArrayResourceTest
+public class ByteArrayResourceTest extends WicketTestCase
 {
 
 	/**
@@ -38,7 +39,7 @@ public class ByteArrayResourceTest
 	@Test
 	public void staticResource()
 	{
-		String contentType = "application/x-octet";
+		String contentType = "application/octet-stream";
 		byte[] array = new byte[] { 1, 2, 3 };
 		ByteArrayResource resource = new ByteArrayResource(contentType, array)
 		{
@@ -68,7 +69,7 @@ public class ByteArrayResourceTest
 	@Test
 	public void dynamicResource()
 	{
-		String contentType = "application/x-octet";
+		String contentType = "application/octet-stream";
 		final byte[] array = new byte[] { 1, 2, 3 };
 		ByteArrayResource resource = new ByteArrayResource(contentType)
 		{
@@ -97,4 +98,37 @@ public class ByteArrayResourceTest
 		verify(response).setContentLength(eq(3L));
 		verify(response).setContentType(eq(contentType));
 	}
+
+	/**
+	 * Content-Type should be resolved in the following way:
+	 * <ol>
+	 * <li>first check if the user passed it</li>
+	 * <li>fallback to check by filename extension</li>
+	 * <li>as final resort always use 'application/octet-stream'</li>
+	 * </ol>
+	 * 
+	 * See https://issues.apache.org/jira/browse/WICKET-4119
+	 */
+	@Test
+	public void contentType()
+	{
+		String userSpecifiedContentType = "text/custom";
+		ByteArrayResource userSpecified = new ByteArrayResource(userSpecifiedContentType,
+			new byte[] { 1, 2, 3 });
+
+		tester.startResource(userSpecified);
+		assertEquals(userSpecifiedContentType, tester.getLastResponse().getContentType());
+
+		ByteArrayResource resolvedByExtension = new ByteArrayResource(null, new byte[] { 1, 2, 3 },
+			"image.png");
+
+		tester.startResource(resolvedByExtension);
+		assertEquals("image/png", tester.getLastResponse().getContentType());
+
+		ByteArrayResource finalResortOctetStream = new ByteArrayResource(null,
+			new byte[] { 1, 2, 3 }, null);
+
+		tester.startResource(finalResortOctetStream);
+		assertEquals("application/octet-stream", tester.getLastResponse().getContentType());
+	}
 }
