diff --git a/wicket-core/src/main/java/org/apache/wicket/core/util/objects/checker/CheckingObjectOutputStream.java b/wicket-core/src/main/java/org/apache/wicket/core/util/objects/checker/CheckingObjectOutputStream.java
index 1cf95d6ecc..6eef7d9cee 100644
--- a/wicket-core/src/main/java/org/apache/wicket/core/util/objects/checker/CheckingObjectOutputStream.java
+++ b/wicket-core/src/main/java/org/apache/wicket/core/util/objects/checker/CheckingObjectOutputStream.java
@@ -27,9 +27,7 @@ import java.lang.reflect.Field;
 import java.lang.reflect.InvocationTargetException;
 import java.lang.reflect.Method;
 import java.lang.reflect.Proxy;
-import java.util.ArrayDeque;
 import java.util.Date;
-import java.util.Deque;
 import java.util.HashSet;
 import java.util.IdentityHashMap;
 import java.util.Iterator;
@@ -424,12 +422,13 @@ public class CheckingObjectOutputStream extends ObjectOutputStream
 							return;
 						}
 
-						checked.put(streamObj, null);
 						CharSequence arrayPos = new StringBuilder(10).append("[write:").append(count++).append(']');
 						simpleName = arrayPos;
 						fieldDescription += arrayPos;
 
 						check(streamObj);
+						
+						checked.put(streamObj, null);
 					}
 				});
 			}
@@ -492,11 +491,11 @@ public class CheckingObjectOutputStream extends ObjectOutputStream
 							return null;
 						}
 
-						checked.put(streamObj, null);
 						CharSequence arrayPos = new StringBuilder(10).append("[write:").append(counter).append(']');
 						simpleName = arrayPos;
 						fieldDescription += arrayPos;
 						check(streamObj);
+						checked.put(streamObj, null);
 						return streamObj;
 					}
 				}
diff --git a/wicket-core/src/test/java/org/apache/wicket/core/util/objects/checker/SessionCheckerTest.java b/wicket-core/src/test/java/org/apache/wicket/core/util/objects/checker/SessionCheckerTest.java
index 2e85e1c0f3..94e8ea7735 100644
--- a/wicket-core/src/test/java/org/apache/wicket/core/util/objects/checker/SessionCheckerTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/core/util/objects/checker/SessionCheckerTest.java
@@ -22,6 +22,8 @@ import java.io.OutputStream;
 
 import org.apache.wicket.Session;
 import org.apache.wicket.markup.html.WebComponent;
+import org.apache.wicket.markup.html.WebMarkupContainer;
+import org.apache.wicket.markup.html.basic.Label;
 import org.apache.wicket.mock.MockWebRequest;
 import org.apache.wicket.protocol.http.WebSession;
 import org.apache.wicket.request.Url;
@@ -51,8 +53,12 @@ public class SessionCheckerTest extends WicketTestCase
 			}
 		};
 
-		WebComponent component = new ComponentWithAReferenceToTheSession("id");
-		byte[] serialized = serializer.serialize(component);
+		WebMarkupContainer container = new WebMarkupContainer("container");
+		// WICKET-6196 force container#children to be an array
+		container.add(new Label("id1"));
+		container.add(new ComponentWithAReferenceToTheSession("id2"));
+		
+		byte[] serialized = serializer.serialize(container);
 		assertNull("The produced byte[] must be null if there was an error", serialized);
 	}
 
