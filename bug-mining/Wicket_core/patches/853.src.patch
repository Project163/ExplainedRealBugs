diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/InlineEnclosureHandler.java b/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/InlineEnclosureHandler.java
index 181c91dbd2..6b3eb5b81e 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/InlineEnclosureHandler.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/InlineEnclosureHandler.java
@@ -206,10 +206,10 @@ public final class InlineEnclosureHandler extends AbstractMarkupFilter
 		if (Strings.isEmpty(inlineEnclosureChildId) == false)
 		{
 			String id = tag.getId();
-			if (container instanceof LoopItem)
+			LoopItem loopItemParent = findLoopItemParent(container);
+			if (loopItemParent != null)
 			{
-				LoopItem item = (LoopItem) container;
-				id = id + '_' + item.getIndex();
+				id = id + '_' + loopItemParent.getIndex();
 			}
 
 			// Yes, we handled the tag
@@ -223,4 +223,18 @@ public final class InlineEnclosureHandler extends AbstractMarkupFilter
 	private String getInlineEnclosureAttributeName(MarkupStream markupStream) {
 		return getWicketNamespace(markupStream) + ':' + INLINE_ENCLOSURE_ATTRIBUTE_NAME;
 	}
+
+	private LoopItem findLoopItemParent(MarkupContainer parent)
+	{
+		LoopItem loopItemParent;
+		if (parent instanceof LoopItem)
+		{
+			loopItemParent = (LoopItem) parent;
+		}
+		else
+		{
+			loopItemParent = parent.findParent(LoopItem.class);
+		}
+		return loopItemParent;
+	}
 }
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/AjaxEnclosureTest.java b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/AjaxEnclosureTest.java
index 9fe3eb3a1b..7bb680edf6 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/AjaxEnclosureTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/AjaxEnclosureTest.java
@@ -16,14 +16,18 @@
  */
 package org.apache.wicket.markup.html.internal;
 
+import java.util.concurrent.atomic.AtomicInteger;
 import java.util.regex.Pattern;
 
 import org.apache.wicket.Component;
+import org.apache.wicket.MarkupContainer;
 import org.apache.wicket.Page;
 import org.apache.wicket.WicketTestCase;
 import org.apache.wicket.markup.html.basic.Label;
 import org.apache.wicket.mock.MockApplication;
 import org.apache.wicket.protocol.http.WebApplication;
+import org.apache.wicket.util.visit.IVisit;
+import org.apache.wicket.util.visit.IVisitor;
 import org.junit.Test;
 
 
@@ -36,9 +40,9 @@ public class AjaxEnclosureTest extends WicketTestCase
 {
 	private final String inlineEnclosureIdPrefix = "wicket_InlineEnclosure-";
 	private final String inlineEnclosureHiddenPattern = "<div id=\"" + inlineEnclosureIdPrefix +
-		"0\" style=\"display:none\"></div>";
+		"\\d\" style=\"display:none\"></div>";
 	private final String inlineEnclosureVisiblePattern = "<div id=\"" + inlineEnclosureIdPrefix +
-		"0\">";
+		"\\d\">";
 
 	@Override
 	protected WebApplication newApplication()
@@ -104,11 +108,10 @@ public class AjaxEnclosureTest extends WicketTestCase
 	@Test
 	public void ajaxTogglingNonControllingChildShouldNotToggleEnclosure()
 	{
-		final String enclosurePath = "wicket_InlineEnclosure-0";
 		{
 			// label 2 On
 			AjaxEnclosurePage_1 ajaxPage = tester.startPage(AjaxEnclosurePage_1.class);
-			ensureEnclosureIsVisible(enclosurePath, ajaxPage);
+			ensureEnclosureIsVisible(ajaxPage, new AtomicInteger(1));
 			assertVisible(ajaxPage.getLabel1(), true);
 			assertVisible(ajaxPage.getLabel2(), true);
 			tester.clickLink(ajaxPage.getToggleLabel2Link().getPageRelativePath());
@@ -116,7 +119,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 		{
 			// label 2 Off
 			AjaxEnclosurePage_1 ajaxPage = (AjaxEnclosurePage_1)tester.getLastRenderedPage();
-			ensureEnclosureIsVisible(enclosurePath, ajaxPage);
+			ensureEnclosureIsVisible(ajaxPage, new AtomicInteger(1));
 			assertVisible(ajaxPage.getLabel1(), false);
 			assertInvisible(ajaxPage.getLabel2());
 			tester.clickLink(ajaxPage.getToggleLabel2Link().getPageRelativePath());
@@ -124,7 +127,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 		{
 			// label 2 On
 			AjaxEnclosurePage_1 ajaxPage = (AjaxEnclosurePage_1)tester.getLastRenderedPage();
-			ensureEnclosureIsVisible(enclosurePath, ajaxPage);
+			ensureEnclosureIsVisible(ajaxPage, new AtomicInteger(1));
 			assertVisible(ajaxPage.getLabel1(), false);
 			assertVisible(ajaxPage.getLabel2(), false);
 			tester.clickLink(ajaxPage.getToggleLabel2Link().getPageRelativePath());
@@ -132,7 +135,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 		{
 			// label 2 Off
 			AjaxEnclosurePage_1 ajaxPage = (AjaxEnclosurePage_1)tester.getLastRenderedPage();
-			ensureEnclosureIsVisible(enclosurePath, ajaxPage);
+			ensureEnclosureIsVisible(ajaxPage, new AtomicInteger(1));
 			assertVisible(ajaxPage.getLabel1(), false);
 			assertInvisible(ajaxPage.getLabel2());
 			tester.clickLink(ajaxPage.getToggleLabel2Link().getPageRelativePath());
@@ -145,13 +148,11 @@ public class AjaxEnclosureTest extends WicketTestCase
 	@Test
 	public void nestedInlineEnclosuresShouldToggleNormally()
 	{
-		final String enclosure1Path = "wicket_InlineEnclosure-0";
-
 		{
 			// 1. test that enclosure1, enclosure2, label1, label2 are visible, click link1,
 			// hiding label1 and the whole enclosure
 			AjaxEnclosurePage_2 ajaxPage = tester.startPage(AjaxEnclosurePage_2.class);
-			ensureEnclosureIsVisible(enclosure1Path, ajaxPage);
+			ensureEnclosureIsVisible(ajaxPage, new AtomicInteger(1));
 			assertVisible(ajaxPage.getEnclosure2Marker(), true);
 			assertVisible(ajaxPage.getLabel1(), true);
 			assertVisible(ajaxPage.getLabel2(), true);
@@ -161,7 +162,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 			// 2. test that enclosure1, enclosure2, label1, label2 are INvisible, click link 1,
 			// bringing all back
 			AjaxEnclosurePage_2 ajaxPage = (AjaxEnclosurePage_2)tester.getLastRenderedPage();
-			ensureEnclosureIsInVisible(enclosure1Path, ajaxPage);
+			ensureEnclosureIsInvisible(ajaxPage, new AtomicInteger(2));
 			assertInvisible(ajaxPage.getEnclosure2Marker());
 			assertInvisible(ajaxPage.getLabel1());
 			assertInvisible(ajaxPage.getLabel2());
@@ -171,7 +172,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 			// 3. test that enclosure1, enclosure2, label1, label2 are visble, click link 2,
 			// hiding label 2 and enclosure 2
 			AjaxEnclosurePage_2 ajaxPage = (AjaxEnclosurePage_2)tester.getLastRenderedPage();
-			ensureEnclosureIsVisible(enclosure1Path, ajaxPage);
+			ensureEnclosureIsVisible(ajaxPage, new AtomicInteger(1));
 			// ensureEnclosureIsVisible(enclosure2Path, ajaxPage);
 			assertVisible(ajaxPage.getEnclosure2Marker(), false);
 			assertVisible(ajaxPage.getLabel1(), false);
@@ -182,7 +183,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 			// 4. test that enclosure1, label1 are visible and enclosure2, label2 INvisible.
 			// click link 2 again
 			AjaxEnclosurePage_2 ajaxPage = (AjaxEnclosurePage_2)tester.getLastRenderedPage();
-			ensureEnclosureIsVisible(enclosure1Path, ajaxPage);
+			ensureEnclosureIsVisible(ajaxPage, new AtomicInteger(2));
 			assertVisible(ajaxPage.getLabel1(), false);
 			assertInvisible(ajaxPage.getEnclosure2Marker());
 			assertInvisible(ajaxPage.getLabel2());
@@ -192,7 +193,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 			// 3. test that enclosure1, enclosure2, label1, label2 are visble, Click link 1,
 			// hiding all
 			AjaxEnclosurePage_2 ajaxPage = (AjaxEnclosurePage_2)tester.getLastRenderedPage();
-			ensureEnclosureIsVisible(enclosure1Path, ajaxPage);
+			ensureEnclosureIsVisible(ajaxPage, new AtomicInteger(1));
 			assertVisible(ajaxPage.getEnclosure2Marker(), false);
 			assertVisible(ajaxPage.getLabel1(), false);
 			assertVisible(ajaxPage.getLabel2(), false);
@@ -201,7 +202,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 		{
 			// 4. test that enclosure1, enclosure2 label1, label2 are invisible. click link 2
 			AjaxEnclosurePage_2 ajaxPage = (AjaxEnclosurePage_2)tester.getLastRenderedPage();
-			ensureEnclosureIsInVisible(enclosure1Path, ajaxPage);
+			ensureEnclosureIsInvisible(ajaxPage, new AtomicInteger(2));
 			assertInvisible(ajaxPage.getEnclosure2Marker());
 			assertInvisible(ajaxPage.getLabel1());
 			assertInvisible(ajaxPage.getLabel2());
@@ -210,7 +211,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 		{
 			// 5. test that enclosure1, enclosure2 label1, label2 are invisible. click link 1
 			AjaxEnclosurePage_2 ajaxPage = (AjaxEnclosurePage_2)tester.getLastRenderedPage();
-			ensureEnclosureIsInVisible(enclosure1Path, ajaxPage);
+			ensureEnclosureIsInvisible(ajaxPage, new AtomicInteger(1));
 			assertInvisible(ajaxPage.getEnclosure2Marker());
 			assertInvisible(ajaxPage.getLabel1());
 			assertInvisible(ajaxPage.getLabel2());
@@ -220,7 +221,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 			// 6. test that enclosure1, label1 are visible, and enclosure2, label2 invisible
 			// (because of step 4)
 			AjaxEnclosurePage_2 ajaxPage = (AjaxEnclosurePage_2)tester.getLastRenderedPage();
-			ensureEnclosureIsVisible(enclosure1Path, ajaxPage);
+			ensureEnclosureIsVisible(ajaxPage, new AtomicInteger(2));
 			assertInvisible(ajaxPage.getEnclosure2Marker());
 			assertVisible(ajaxPage.getLabel1(), false);
 			assertInvisible(ajaxPage.getLabel2());
@@ -235,13 +236,11 @@ public class AjaxEnclosureTest extends WicketTestCase
 	@Test
 	public void controllingChildShouldDefaultToTheSingleComponentInsideEnclosure()
 	{
-		final String enclosurePath = "wicket_InlineEnclosure-0";
-
 		{
 			// enclosure On
 			AjaxEnclosurePage_3 ajaxPage = tester.startPage(AjaxEnclosurePage_3.class);
 			assertVisible(ajaxPage.getLabel1(), true);
-			ensureEnclosureIsVisible(enclosurePath, ajaxPage);
+			ensureEnclosureIsVisible(ajaxPage, new AtomicInteger(1));
 			tester.clickLink(ajaxPage.getToggleLabel1Link().getPageRelativePath());
 		}
 		{
@@ -249,7 +248,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 			AjaxEnclosurePage_3 ajaxPage = (AjaxEnclosurePage_3)tester.getLastRenderedPage();
 			tester.assertContains(inlineEnclosureHiddenPattern);
 			assertInvisible(ajaxPage.getLabel1());
-			ensureEnclosureIsInVisible(enclosurePath, ajaxPage);
+			ensureEnclosureIsInvisible(ajaxPage, new AtomicInteger(1));
 			tester.clickLink(ajaxPage.getToggleLabel1Link().getPageRelativePath());
 		}
 		{
@@ -257,7 +256,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 			AjaxEnclosurePage_3 ajaxPage = (AjaxEnclosurePage_3)tester.getLastRenderedPage();
 			tester.assertContains(inlineEnclosureVisiblePattern);
 			assertVisible(ajaxPage.getLabel1(), true);
-			ensureEnclosureIsVisible(enclosurePath, ajaxPage);
+			ensureEnclosureIsVisible(ajaxPage, new AtomicInteger(1));
 			tester.clickLink(ajaxPage.getToggleLabel1Link().getPageRelativePath());
 		}
 		{
@@ -265,26 +264,43 @@ public class AjaxEnclosureTest extends WicketTestCase
 			AjaxEnclosurePage_3 ajaxPage = (AjaxEnclosurePage_3)tester.getLastRenderedPage();
 			tester.assertContains(inlineEnclosureHiddenPattern);
 			assertInvisible(ajaxPage.getLabel1());
-			ensureEnclosureIsInVisible(enclosurePath, ajaxPage);
+			ensureEnclosureIsInvisible(ajaxPage, new AtomicInteger(1));
 			tester.clickLink(ajaxPage.getToggleLabel1Link().getPageRelativePath());
 		}
 	}
 
-	private void ensureEnclosureIsVisible(final String enclosurePath, Page ajaxPage)
+	private void ensureEnclosureIsVisible(Page ajaxPage, AtomicInteger n)
 	{
-		Component enclosure = ajaxPage.get(enclosurePath);
+		InlineEnclosure enclosure = findNthComponent(InlineEnclosure.class, ajaxPage, n);
 		assertTrue("Is not visible", enclosure.determineVisibility());
 	}
 
-	private void ensureEnclosureIsInVisible(final String enclosurePath, Page ajaxPage)
+	private void ensureEnclosureIsInvisible(Page ajaxPage, AtomicInteger n)
 	{
-		Component enclosure = ajaxPage.get(enclosurePath);
+		InlineEnclosure enclosure = findNthComponent(InlineEnclosure.class, ajaxPage, n);
 		if (enclosure != null)
 		{
 			assertFalse("Is visible", enclosure.determineVisibility());
 		}
 	}
 
+	private <T> T findNthComponent(final Class<T> type, MarkupContainer container, final AtomicInteger n)
+	{
+		// finds the Nth InlineEnclosure in the children
+		Component instance = container.visitChildren(new IVisitor<Component, Component>()
+		{
+			@Override
+			public void component(Component object, IVisit<Component> visit)
+			{
+				if (type.isInstance(object) && n.decrementAndGet() == 0)
+				{
+					visit.stop(object);
+				}
+			}
+		});
+		return type.cast(instance);
+	}
+
 	protected void assertVisible(Label label, boolean checkAlsoMarkup)
 	{
 		tester.assertVisible(label.getPageRelativePath());
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureDifferentNamespaceExpectedResult.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureDifferentNamespaceExpectedResult.html
index 26a2a7a0dc..1b0da5aaf4 100755
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureDifferentNamespaceExpectedResult.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureDifferentNamespaceExpectedResult.html
@@ -2,8 +2,8 @@
 <body>
 
 <!-- nested inline enclosures with separate child depths. -->
-<div id="w_InlineEnclosure-0"><span>Test Label 1</span>
-	<div id="w_InlineEnclosure-1">
+<div id="w_InlineEnclosure-26"><span>Test Label 1</span>
+	<div id="w_InlineEnclosure-27">
 		<table>
 			<tr>
 				<td><span>Test Label 2</span></td>
@@ -13,15 +13,15 @@
 </div>
 
 <!-- nested inline enclosures with same child depth. -->
-<div id="w_InlineEnclosure-2">
-	<div id="w_InlineEnclosure-3">
+<div id="w_InlineEnclosure-28">
+	<div id="w_InlineEnclosure-29">
 		<span>Test Label 3</span>
 		<span>Test Label 4</span>
 	</div>
 </div>
 
 <!-- enclosure tag nested inside inline enclosure with separate child depths. -->
-<div id="w_InlineEnclosure-4"> <span>Test Label 5</span>
+<div id="w_InlineEnclosure-30"> <span>Test Label 5</span>
 	
 		<table>
 			<tr>
@@ -34,7 +34,7 @@
 </div>
 
 <!-- enclosure tag nested inside inline enclosure with same child depth. -->
-<div id="w_InlineEnclosure-5">
+<div id="w_InlineEnclosure-31">
 	
 		<table>
 			<tr>
@@ -49,7 +49,7 @@
 
 <!--  inline enclosure nested inside enclosure tag with separate child depths. -->
 
-	<div id="w_InlineEnclosure-6"> <span>Test Label 9</span>
+	<div id="w_InlineEnclosure-32"> <span>Test Label 9</span>
 		<table>
 			<tr>
 				<td><span>Test Label 10</span></td>
@@ -59,7 +59,7 @@
 
 
 <!--  inline enclosure nested inside enclosure tag with same child depth. -->
-<div id="w_InlineEnclosure-7">
+<div id="w_InlineEnclosure-33">
 	
 		<table>
 			<tr>
@@ -74,7 +74,7 @@
 
 <!--  inline enclosure nested inside enclosure tag with same child depth inside a wicket container. -->
 
-	<div id="w_InlineEnclosure-8">
+	<div id="w_InlineEnclosure-34">
 		<div>
 			<table>
 				<tr>
@@ -90,8 +90,8 @@
 
 
 <!-- nested inline enclosures without explicitly determining children -->
-<div id="w_InlineEnclosure-9">
-	<div id="w_InlineEnclosure-10">
+<div id="w_InlineEnclosure-35">
+	<div id="w_InlineEnclosure-36">
 		<table>
 			<tr>
 				<td>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_1.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_1.html
index 5bc9ca2ac5..055976e951 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_1.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_1.html
@@ -1,9 +1,9 @@
 <html>
 <body>
 
-<span id="wicket_InlineEnclosure-0"> <span>Test Label 1</span> </span>
+<span id="wicket_InlineEnclosure-7"> <span>Test Label 1</span> </span>
 
-<div id="wicket_InlineEnclosure-1">
+<div id="wicket_InlineEnclosure-8">
 	<table>
 		<tr>
 			<td><span>Test Label 2</span></td>
@@ -11,9 +11,9 @@
 	</table>
 </div>
 
-<span id="wicket_InlineEnclosure-2" style="display:none"></span>
+<span id="wicket_InlineEnclosure-9" style="display:none"></span>
 
-<div id="wicket_InlineEnclosure-3">
+<div id="wicket_InlineEnclosure-10">
 	<table>
 		<tr>
 			<td><span>Test Label 4</span></td>
@@ -36,9 +36,9 @@
 	</table>
 </div>
 
-<div id="wicket_InlineEnclosure-4"><span> <span>Test Label 8</span> </span></div>
+<div id="wicket_InlineEnclosure-11"><span> <span>Test Label 8</span> </span></div>
 
-<div id="wicket_InlineEnclosure-5"><span>Test Label 9</span></div>
+<div id="wicket_InlineEnclosure-12"><span>Test Label 9</span></div>
 
 <div id="customInlineEnclosureId"><span>Test Label 10</span>
 </div>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_2.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_2.html
index 7183087f83..1f7ec1b03c 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_2.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_2.html
@@ -2,8 +2,8 @@
 <body>
 
 <!-- nested inline enclosures with separate child depths. -->
-<div id="wicket_InlineEnclosure-0"><span>Test Label 1</span>
-	<div id="wicket_InlineEnclosure-1">
+<div id="wicket_InlineEnclosure-13"><span>Test Label 1</span>
+	<div id="wicket_InlineEnclosure-14">
 		<table>
 			<tr>
 				<td><span>Test Label 2</span></td>
@@ -13,15 +13,15 @@
 </div>
 
 <!-- nested inline enclosures with same child depth. -->
-<div id="wicket_InlineEnclosure-2"> 
-	<div id="wicket_InlineEnclosure-3"> 
+<div id="wicket_InlineEnclosure-15"> 
+	<div id="wicket_InlineEnclosure-16"> 
 		<span>Test Label 3</span>
 		<span>Test Label 4</span> 
 	</div> 
 </div>
 
 <!-- enclosure tag nested inside inline enclosure with separate child depths. -->
-<div id="wicket_InlineEnclosure-4"> <span>Test Label 5</span>
+<div id="wicket_InlineEnclosure-17"> <span>Test Label 5</span>
 	
 		<table>
 			<tr>
@@ -34,7 +34,7 @@
 </div>
 
 <!-- enclosure tag nested inside inline enclosure with same child depth. -->
-<div id="wicket_InlineEnclosure-5"> 
+<div id="wicket_InlineEnclosure-18"> 
 	
 		<table>
 			<tr>
@@ -49,7 +49,7 @@
 
 <!--  inline enclosure nested inside enclosure tag with separate child depths. -->
 
-	<div id="wicket_InlineEnclosure-6"> <span>Test Label 9</span>
+	<div id="wicket_InlineEnclosure-19"> <span>Test Label 9</span>
 		<table>
 			<tr>
 				<td><span>Test Label 10</span></td>
@@ -59,7 +59,7 @@
 
 
 <!--  inline enclosure nested inside enclosure tag with same child depth. -->
-<div id="wicket_InlineEnclosure-7"> 
+<div id="wicket_InlineEnclosure-20"> 
 	
 		<table>
 			<tr>
@@ -74,7 +74,7 @@
 
 <!--  inline enclosure nested inside enclosure tag with same child depth inside a wicket container. -->
 
-	<div id="wicket_InlineEnclosure-8"> 
+	<div id="wicket_InlineEnclosure-21"> 
 		<div>
 			<table>
 				<tr>
@@ -90,8 +90,8 @@
 
 
 <!-- nested inline enclosures without explicitly determining children -->
-<div id="wicket_InlineEnclosure-9"> 
-	<div id="wicket_InlineEnclosure-10">
+<div id="wicket_InlineEnclosure-22"> 
+	<div id="wicket_InlineEnclosure-23">
 		<table>
 			<tr>
 				<td>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePanelPageExpectedResult.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePanelPageExpectedResult.html
index 107750a1c2..afdad7a40a 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePanelPageExpectedResult.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePanelPageExpectedResult.html
@@ -1,13 +1,13 @@
 <html>
 <body>
-	<div id="wicket_InlineEnclosure-0">
+	<div id="wicket_InlineEnclosure-24">
 		<div>
 			<div>
 	This is a simple test panel. This contains a label and an inline enclosure
 	with a label inside it.
 	<span>Inside InlineEnclosure and Panel: hello world</span>
 	
-	<div id="wicket_InlineEnclosure-0">
+	<div id="wicket_InlineEnclosure-25">
 		<span>Inside InlineEnclosure, Panel and another InlineEnclosure: hello again.</span>
 	</div>
 	
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/TogglePageTest.java b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/TogglePageTest.java
index 2b6cd45beb..018e4e9caf 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/TogglePageTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/TogglePageTest.java
@@ -155,10 +155,10 @@ public class TogglePageTest extends WicketTestCase
 		String inlineEnclosureIdPrefix = "wicket_InlineEnclosure-";
 
 		String inlineEnclosureHiddenPattern = "<tr id=\"" + inlineEnclosureIdPrefix +
-			"0\" style=\"display:none\"></tr>";
+			"\\d\" style=\"display:none\"></tr>";
 
 		String inlineEnclosureVisiblePattern = "<tr bgcolor=\"red\" id=\"" +
-			inlineEnclosureIdPrefix + "0\">";
+			inlineEnclosureIdPrefix + "\\d\">";
 
 		{
 			// On
diff --git a/wicket-core/src/test/java/org/apache/wicket/protocol/http/request/WebClientInfoTest.java b/wicket-core/src/test/java/org/apache/wicket/protocol/http/request/WebClientInfoTest.java
index 02d9c9e2b8..4256dd66a1 100644
--- a/wicket-core/src/test/java/org/apache/wicket/protocol/http/request/WebClientInfoTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/protocol/http/request/WebClientInfoTest.java
@@ -749,6 +749,9 @@ public class WebClientInfoTest
 
 	/**
 	 * Test X-Forwarded-For ip address extraction with fallback when no ip is contained.
+	 *
+	 * Note mgrigorov: this test could fail in network setups where unknown addresses, like "blah",
+	 * will resolve to some DNS service saying "'blah' domain is free. Buy it."
 	 */
 	@Test
 	public void testExtractFromContainerRequestUnknownXForwardedFor()
