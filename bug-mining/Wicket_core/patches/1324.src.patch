diff --git a/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java b/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java
index 558c13fb2c..062eda2149 100644
--- a/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java
+++ b/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java
@@ -2033,7 +2033,7 @@ public abstract class MarkupContainer extends Component implements Iterable<Comp
 		if (childType == ChildToDequeueType.NULL || 
 			childType == ChildToDequeueType.QUEUE_REGION)
 		{
-				dequeue.skipToCloseTag();
+			dequeue.skipToCloseTag();
 		}
 
 		// pull the close tag off
diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/html/border/Border.java b/wicket-core/src/main/java/org/apache/wicket/markup/html/border/Border.java
index ceef55108e..15c9dbe1f7 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/html/border/Border.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/html/border/Border.java
@@ -16,13 +16,14 @@
  */
 package org.apache.wicket.markup.html.border;
 
+import java.util.Objects;
+
 import org.apache.wicket.Component;
 import org.apache.wicket.DequeueContext;
 import org.apache.wicket.DequeueTagAction;
 import org.apache.wicket.IQueueRegion;
 import org.apache.wicket.MarkupContainer;
 import org.apache.wicket.markup.ComponentTag;
-import org.apache.wicket.markup.ContainerInfo;
 import org.apache.wicket.markup.IMarkupFragment;
 import org.apache.wicket.markup.MarkupElement;
 import org.apache.wicket.markup.MarkupException;
@@ -675,15 +676,14 @@ public abstract class Border extends WebMarkupContainer implements IComponentRes
 
 	private boolean canDequeueBody(ComponentTag tag)
 	{
-		ContainerInfo containerInfo = (ContainerInfo)tag.getUserData(
-			WicketTagIdentifier.CONTAINER_INFO);
-		Class<?> containerClass = containerInfo != null ? 
-			containerInfo.getContainerClass() : null;
+		String tagCacheKey = (String)tag.getUserData(
+			WicketTagIdentifier.MARKUP_CACHE_KEY);
+		String borderCacheKey = getAssociatedMarkup().getMarkupResourceStream().getCacheKey();
 		
 		boolean isBodyTag = (tag instanceof WicketTag) && ((WicketTag)tag).isBodyTag();
 		
 		//the body tag might belong to an outer body component
-		boolean isBorderBodyTag = containerClass == null || containerClass.equals(getClass());
+		boolean isBorderBodyTag = Objects.equals(tagCacheKey, borderCacheKey);
 		
 		return isBodyTag && isBorderBodyTag;
 	}
diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/WicketTagIdentifier.java b/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/WicketTagIdentifier.java
index 99b7ee5a2d..18a8b37e2f 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/WicketTagIdentifier.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/WicketTagIdentifier.java
@@ -59,6 +59,7 @@ public final class WicketTagIdentifier extends AbstractMarkupFilter
 	public static final String CHILD = "child";
 
 	public static final String EXTEND = "extend";
+	public static final String MARKUP_CACHE_KEY = "markupCacheKey";
 
 	static {
 		WELL_KNOWN_TAG_NAMES.add(Border.BORDER);
@@ -123,6 +124,7 @@ public final class WicketTagIdentifier extends AbstractMarkupFilter
 				// Make it a Wicket component.
 				tag.setId(namespace + "_" + tag.getName() + getRequestUniqueId());
 				tag.setUserData(CONTAINER_INFO, getMarkupResourceStream().getContainerInfo());
+				tag.setUserData(MARKUP_CACHE_KEY, getMarkupResourceStream().getCacheKey());
 				tag.setModified(true);
 				
 				if (isRaw(tag)) 
