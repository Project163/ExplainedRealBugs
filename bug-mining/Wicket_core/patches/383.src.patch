diff --git a/wicket-core/src/main/java/org/apache/wicket/Component.java b/wicket-core/src/main/java/org/apache/wicket/Component.java
index 5f0a97d4a1..fe0c89a81a 100644
--- a/wicket-core/src/main/java/org/apache/wicket/Component.java
+++ b/wicket-core/src/main/java/org/apache/wicket/Component.java
@@ -4213,9 +4213,9 @@ public abstract class Component
 			}
 		}
 
-		if ((id != null) && (id.indexOf(':') != -1))
+		if ((id != null) && (id.indexOf(':') != -1|| id.indexOf('~') != -1))
 		{
-			throw new WicketRuntimeException("The component ID must not contain ':' chars.");
+			throw new WicketRuntimeException("The component ID must not contain ':' or '~' chars.");
 		}
 
 		this.id = id;
diff --git a/wicket-core/src/test/java/org/apache/wicket/request/mapper/info/ComponentInfoTest.java b/wicket-core/src/test/java/org/apache/wicket/request/mapper/info/ComponentInfoTest.java
index c8069db8cf..775adbe014 100644
--- a/wicket-core/src/test/java/org/apache/wicket/request/mapper/info/ComponentInfoTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/request/mapper/info/ComponentInfoTest.java
@@ -93,10 +93,10 @@ public class ComponentInfoTest extends TestCase
 	 */
 	public void test6()
 	{
-		String s = "listener-compo--nent-path";
+		String s = "listener-compo~~nent-path";
 		ComponentInfo info = ComponentInfo.parse(s);
 		assertEquals("listener", info.getListenerInterface());
-		assertEquals("compo-nent:path", info.getComponentPath());
+		assertEquals("compo--nent:path", info.getComponentPath());
 		assertNull(info.getBehaviorId());
 
 		assertEquals(s, info.toString());
@@ -107,7 +107,7 @@ public class ComponentInfoTest extends TestCase
 	 */
 	public void test7()
 	{
-		String s = "listener-co--mpo----nent-path";
+		String s = "listener-co~mpo~~nent-path";
 		ComponentInfo info = ComponentInfo.parse(s);
 		assertEquals("listener", info.getListenerInterface());
 		assertEquals("co-mpo--nent:path", info.getComponentPath());
@@ -157,4 +157,23 @@ public class ComponentInfoTest extends TestCase
 		assertEquals(s, info.toString());
 	}
 
+	public void test11_encode_decode()
+	{
+		final Integer renderCount = 1;
+		final String listenerInterface = "ILinkListener";
+		final String componentPath = "-nav-container-:-nav:1:link";
+		final Integer behaviorId = null;
+
+		ComponentInfo info = new ComponentInfo(renderCount, listenerInterface, componentPath,
+			behaviorId);
+
+		final String encoded = info.toString();
+		assertEquals("1.ILinkListener-~nav~container~-~nav-1-link", encoded);
+
+		ComponentInfo decoded = ComponentInfo.parse(encoded);
+		assertEquals(renderCount, decoded.getRenderCount());
+		assertEquals(listenerInterface, decoded.getListenerInterface());
+		assertEquals(componentPath, decoded.getComponentPath());
+		assertEquals(behaviorId, decoded.getBehaviorId());
+	}
 }
