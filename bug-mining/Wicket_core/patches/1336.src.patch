diff --git a/wicket-core/src/main/java/org/apache/wicket/Component.java b/wicket-core/src/main/java/org/apache/wicket/Component.java
index 5aab92ba6b..c2b6a92231 100644
--- a/wicket-core/src/main/java/org/apache/wicket/Component.java
+++ b/wicket-core/src/main/java/org/apache/wicket/Component.java
@@ -83,6 +83,7 @@ import org.apache.wicket.util.convert.IConverter;
 import org.apache.wicket.util.io.IClusterable;
 import org.apache.wicket.util.lang.Args;
 import org.apache.wicket.util.lang.Classes;
+import org.apache.wicket.util.lang.Objects;
 import org.apache.wicket.util.string.PrependingStringBuffer;
 import org.apache.wicket.util.string.Strings;
 import org.apache.wicket.util.value.ValueMap;
@@ -726,7 +727,7 @@ public abstract class Component
 	public IMarkupFragment getMarkup()
 	{
 		// Markup already determined or preset?
-		if (markup != null)
+		if (markup != null && markupHasCurrentVariation())
 		{
 			return markup;
 		}
@@ -757,6 +758,18 @@ public abstract class Component
 		return markup;
 	}
 
+	/**
+	 * Check if the loaded markup has the current 
+	 * variation.
+	 * 
+	 * @return true if the markup has the current variation
+	 */
+	private boolean markupHasCurrentVariation()
+	{
+		return Objects.equal(getVariation(), 
+			markup.getMarkupResourceStream().getVariation());
+	}
+
 	/**
 	 * @return The 'id' attribute from the associated markup tag
 	 */
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/MarkupVariationTest.java b/wicket-core/src/test/java/org/apache/wicket/markup/MarkupVariationTest.java
index 65cc4d2880..705e075a5c 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/MarkupVariationTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/MarkupVariationTest.java
@@ -25,6 +25,7 @@ import org.apache.wicket.markup.html.form.Form;
 import org.apache.wicket.markup.html.panel.Panel;
 import org.apache.wicket.util.resource.IResourceStream;
 import org.apache.wicket.util.resource.StringResourceStream;
+import org.apache.wicket.util.tester.FormTester;
 import org.apache.wicket.util.tester.WicketTestCase;
 import org.junit.Test;
 
@@ -61,6 +62,20 @@ public class MarkupVariationTest extends WicketTestCase
 	{
 		return (MarkupContainer) tester.getComponentFromLastRenderedPage("p");
 	}
+	
+	/**
+	 * https://issues.apache.org/jira/browse/WICKET-6231
+	 */
+	@Test
+	public void changeVariationBeforeRendering() throws Exception
+	{
+		tester.startPage(new VariationPage());
+		FormTester formTester = tester.newFormTester("p:a_form");
+		
+		formTester.submit();
+		
+		tester.assertContainsNot("One");
+	}
 
 	private static class VariationPage extends WebPage implements IMarkupResourceStreamProvider
 	{
@@ -95,14 +110,22 @@ public class MarkupVariationTest extends WicketTestCase
 				@Override
 				public void onClick(AjaxRequestTarget target)
 				{
-					variation = "one".equals(variation) ? "two" : "one";
+					changeVariation();
 					target.add(VariationPanel.this);
 				}
 			});
 
 			add(new Label("simpleLabel", "Label"));
 
-			add(new Form<Void>("a_form"));
+			add(new Form<Void>("a_form")
+			{
+				@Override
+				protected void onSubmit()
+				{
+					super.onSubmit();
+					changeVariation();
+				}
+			});
 
 			add(new Label("child", "Inline Enclosure child text"));
 			add(new Label("nestedChild", "Nested Inline Enclosure child text"));
@@ -114,5 +137,10 @@ public class MarkupVariationTest extends WicketTestCase
 		{
 			return variation;
 		}
+
+		private void changeVariation()
+		{
+			variation = "one".equals(variation) ? "two" : "one";
+		}
 	}
 }
