diff --git a/wicket-core/src/main/java/org/apache/wicket/request/mapper/CryptoMapper.java b/wicket-core/src/main/java/org/apache/wicket/request/mapper/CryptoMapper.java
index 398925e49d..a86b527fea 100755
--- a/wicket-core/src/main/java/org/apache/wicket/request/mapper/CryptoMapper.java
+++ b/wicket-core/src/main/java/org/apache/wicket/request/mapper/CryptoMapper.java
@@ -175,6 +175,11 @@ public class CryptoMapper implements IRequestMapper
 			Url originalUrl = Url.parse(decryptedUrl, request.getCharset());
 
 			int originalNumberOfSegments = originalUrl.getSegments().size();
+			if (originalNumberOfSegments == 0 &&
+				originalUrl.getQueryParameters().isEmpty() == false)
+			{
+				originalNumberOfSegments = 1;
+			}
 			int numberOfSegments = encryptedUrl.getSegments().size();
 
 			char[] encryptedChars = encryptedUrlString.toCharArray();
@@ -195,7 +200,8 @@ public class CryptoMapper implements IRequestMapper
 				segment += String.format("%02x", Math.abs(hash % 256));
 				hash = hashString(segment);
 
-				if (segment.equals(segments.get(segNo)))
+				if (segment.equals(segments.get(segNo)) &&
+					originalUrl.getSegments().size() >= segNo)
 				{
 					url.getSegments().add(originalUrl.getSegments().get(segNo - 1));
 				}
diff --git a/wicket-core/src/test/java/org/apache/wicket/request/mapper/CryptoMapperTest.java b/wicket-core/src/test/java/org/apache/wicket/request/mapper/CryptoMapperTest.java
index eac8a10f2a..e64aeb88e5 100644
--- a/wicket-core/src/test/java/org/apache/wicket/request/mapper/CryptoMapperTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/request/mapper/CryptoMapperTest.java
@@ -121,4 +121,28 @@ public class CryptoMapperTest extends AbstractMapperTest
 		PageParameters actualParameters = handler.getPageParameters();
 		assertEquals(expectedParameters, actualParameters);
 	}
+
+	/**
+	 * https://issues.apache.org/jira/browse/WICKET-3926
+	 */
+	public void testHomePageWithParameters()
+	{
+		String expectedEncrypted = "0lhSFdMIt3yZUNwbtLuXgDePMclxSbks/0lh9b";
+		PageParameters expectedParameters = new PageParameters();
+		expectedParameters.add("namedKey1", "namedValue1");
+
+		RenderPageRequestHandler renderPageRequestHandler = new RenderPageRequestHandler(
+			new PageProvider(tester.getApplication().getHomePage(), expectedParameters));
+		Url url = mapper.mapHandler(renderPageRequestHandler);
+		assertEquals(expectedEncrypted, url.toString());
+
+		Request request = getRequest(url);
+		IRequestHandler requestHandler = mapper.mapRequest(request);
+		assertTrue(requestHandler instanceof RenderPageRequestHandler);
+
+		RenderPageRequestHandler handler = (RenderPageRequestHandler)requestHandler;
+		assertEquals(tester.getApplication().getHomePage(), handler.getPageClass());
+		PageParameters actualParameters = handler.getPageParameters();
+		assertEquals(expectedParameters, actualParameters);
+	}
 }
