diff --git a/wicket-core/src/main/java/org/apache/wicket/core/request/mapper/BasicResourceReferenceMapper.java b/wicket-core/src/main/java/org/apache/wicket/core/request/mapper/BasicResourceReferenceMapper.java
index 320796d710..500370145a 100755
--- a/wicket-core/src/main/java/org/apache/wicket/core/request/mapper/BasicResourceReferenceMapper.java
+++ b/wicket-core/src/main/java/org/apache/wicket/core/request/mapper/BasicResourceReferenceMapper.java
@@ -130,10 +130,20 @@ public class BasicResourceReferenceMapper extends AbstractResourceReferenceMappe
 
 			Class<?> scope = resolveClass(className);
 
-			// attributes = PackageResource.sanitize(attributes, scope, name.toString());
-
 			if (scope != null && scope.getPackage() != null)
 			{
+				ResourceReference auxRes = getContext().getResourceReferenceRegistry()
+					.getResourceReference(scope, name.toString(), attributes.getLocale(),
+						attributes.getStyle(), attributes.getVariation(), true, true, false);
+				if (auxRes != null)
+				{
+					IResource resource = auxRes.getResource();
+					if (resource instanceof PackageResource packageResource)
+					{
+						attributes = PackageResource.sanitize(attributes, scope, name.toString());
+					}
+				}
+
 				ResourceReference res = getContext().getResourceReferenceRegistry()
 					.getResourceReference(scope, name.toString(), attributes.getLocale(),
 						attributes.getStyle(), attributes.getVariation(), true, true);
diff --git a/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java b/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java
index 06c20f588c..8d5fe26a7a 100644
--- a/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java
+++ b/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResource.java
@@ -737,15 +737,50 @@ public class PackageResource extends AbstractResource implements IStaticCacheabl
 	 * @param variation
 	 *            The component's variation (of the style)
 	 * @return {@code true} if a resource could be loaded, {@code false} otherwise
+	 *
+	 * @deprecated @see {@link PackageResource#exists(Class, String, Locale, String, String, boolean)}
 	 */
 	public static boolean exists(final Class<?> scope, final String path, final Locale locale,
 		final String style, final String variation)
+	{
+		return exists(scope, path, locale, style, variation, true);
+	}
+
+	/**
+	 * Checks whether a resource for a given set of criteria exists.
+	 *
+	 * @param scope
+	 *            This argument will be used to get the class loader for loading the package
+	 *            resource, and to determine what package it is in. Typically this is the class in
+	 *            which you call this method
+	 * @param path
+	 *            The path to the resource
+	 * @param locale
+	 *            The locale of the resource
+	 * @param style
+	 *            The style of the resource (see {@link org.apache.wicket.Session})
+	 * @param variation
+	 *            The component's variation (of the style)
+	 * @param updateCache
+	 *            if the server resource stream reference cache should be updated
+	 * @return {@code true} if a resource could be loaded, {@code false} otherwise
+	 */
+	public static boolean exists(final Class<?> scope, final String path, final Locale locale,
+		final String style, final String variation, final boolean updateCache)
 	{
 		String absolutePath = Packages.absolutePath(scope, path);
-		return Application.get()
-			.getResourceSettings()
-			.getResourceStreamLocator()
-			.locate(scope, absolutePath, style, variation, locale, null, false) != null;
+		IResourceStreamLocator resourceStreamLocator = Application.get().getResourceSettings()
+			.getResourceStreamLocator();
+		if (resourceStreamLocator instanceof CachingResourceStreamLocator cache)
+		{
+			return cache.locate(scope, absolutePath, style, variation, locale, null, false,
+				updateCache) != null;
+		}
+		else
+		{
+			return resourceStreamLocator.locate(scope, absolutePath, style, variation, locale, null,
+				false) != null;
+		}
 	}
 
 	@Override
diff --git a/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceReferenceRegistry.java b/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceReferenceRegistry.java
index b021342f8d..8167277064 100644
--- a/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceReferenceRegistry.java
+++ b/wicket-core/src/main/java/org/apache/wicket/request/resource/ResourceReferenceRegistry.java
@@ -74,9 +74,15 @@ public class ResourceReferenceRegistry
 	{
 		@Override
 		public ResourceReference create(Key key)
+		{
+			return create(key, true);
+		}
+
+		public ResourceReference create(Key key, boolean updateCache)
 		{
 			ResourceReference result = null;
-			if (PackageResource.exists(key))
+			if (PackageResource.exists(key.getScopeClass(), key.getName(), key.getLocale(),
+				key.getStyle(), key.getVariation(), updateCache))
 			{
 				result = new PackageResourceReference(key);
 			}
@@ -180,6 +186,17 @@ public class ResourceReferenceRegistry
 		return removed;
 	}
 
+	/**
+	 * @deprecated @see {@link ResourceReferenceRegistry#getResourceReference(Class, String, Locale, String, String, boolean, boolean, boolean)}
+	 */
+	public final ResourceReference getResourceReference(final Class<?> scope, final String name,
+		final Locale locale, final String style, final String variation, final boolean strict,
+		final boolean createIfNotFound)
+	{
+		return getResourceReference(scope, name, locale, style, variation, strict, createIfNotFound,
+			true);
+	}
+
 	/**
 	 * Get a resource reference matching the parameters from the registry or if not found and
 	 * requested, create an default resource reference and add it to the registry.
@@ -187,10 +204,10 @@ public class ResourceReferenceRegistry
 	 * Part of the search is scanning the class (scope) and it's superclass for static
 	 * ResourceReference fields. Found fields get registered automatically (but are different from
 	 * auto-generated ResourceReferences).
-	 * 
+	 *
 	 * @see #createDefaultResourceReference(org.apache.wicket.request.resource.ResourceReference.Key)
 	 * @see ClassScanner
-	 * 
+	 *
 	 * @param scope
 	 *            The scope of resource reference (e.g. the Component's class)
 	 * @param name
@@ -206,16 +223,25 @@ public class ResourceReferenceRegistry
 	 * @param createIfNotFound
 	 *            If true a default resource reference is created if no entry can be found in the
 	 *            registry. The newly created resource reference will be added to the registry.
+	 * @param updateCache
+	 *            If true, the server resource stream reference cache should be updated
 	 * @return Either the resource reference found in the registry or, if requested, a resource
 	 *         reference automatically created based on the parameters provided. The automatically
 	 *         created resource reference will automatically be added to the registry.
 	 */
-	public final ResourceReference getResourceReference(final Class<?> scope, final String name,
-		final Locale locale, final String style, final String variation, final boolean strict,
-		final boolean createIfNotFound)
+	public ResourceReference getResourceReference(Class<?> scope, String name, Locale locale,
+		String style, String variation, boolean strict, boolean createIfNotFound, boolean updateCache)
 	{
 		return getResourceReference(new Key(scope.getName(), name, locale, style, variation),
-			strict, createIfNotFound);
+			strict, createIfNotFound, updateCache);
+	}
+
+	/**
+	 * @deprecated @see {@link ResourceReferenceRegistry#getResourceReference(Key, boolean, boolean, boolean)}
+	 */
+	public final ResourceReference getResourceReference(final Key key, final boolean strict,
+		final boolean createIfNotFound){
+		return getResourceReference(key, strict, createIfNotFound, true);
 	}
 
 	/**
@@ -236,12 +262,14 @@ public class ResourceReferenceRegistry
 	 * @param createIfNotFound
 	 *            If true a default resource reference is created if no entry can be found in the
 	 *            registry. The newly created resource reference will be added to the registry.
+	 * @param strict
+	 *            If true, the server resource stream reference cache should be updated
 	 * @return Either the resource reference found in the registry or, if requested, a resource
 	 *         reference automatically created based on the parameters provided. The automatically
 	 *         created resource reference will automatically be added to the registry.
 	 */
 	public final ResourceReference getResourceReference(final Key key, final boolean strict,
-		final boolean createIfNotFound)
+		final boolean createIfNotFound, boolean updateCache)
 	{
 		ResourceReference resource = _getResourceReference(key.getScope(), key.getName(),
 			key.getLocale(), key.getStyle(), key.getVariation(), strict);
@@ -262,7 +290,7 @@ public class ResourceReferenceRegistry
 			// Still nothing found => Shall a new reference be auto-created?
 			if ((resource == null) && createIfNotFound)
 			{
-				resource = addDefaultResourceReference(key);
+				resource = addDefaultResourceReference(key, updateCache);
 			}
 		}
 
@@ -334,12 +362,12 @@ public class ResourceReferenceRegistry
 	 *      the data making up the resource reference
 	 * @return The default resource created
 	 */
-	private ResourceReference addDefaultResourceReference(final Key key)
+	private ResourceReference addDefaultResourceReference(final Key key, final boolean updateCache)
 	{
 		// Can be subclassed to create other than PackagedResourceReference
-		ResourceReference reference = createDefaultResourceReference(key);
+		ResourceReference reference = createDefaultResourceReference(key, updateCache);
 
-		if (reference != null)
+		if (reference != null && updateCache)
 		{
 			// number of RRs which can be auto-added is restricted (cache size). Remove entries, and
 			// unregister excessive ones, if needed.
@@ -383,6 +411,14 @@ public class ResourceReferenceRegistry
 		}
 	}
 
+	/**
+	 * @deprecated @see {@link ResourceReferenceRegistry#createDefaultResourceReference(Key, boolean)}
+	 */
+	protected ResourceReference createDefaultResourceReference(final Key key)
+	{
+		return createDefaultResourceReference(key, true);
+	}
+
 	/**
 	 * Creates a default resource reference in case no registry entry and it was requested to create
 	 * one.
@@ -393,14 +429,20 @@ public class ResourceReferenceRegistry
 	 *      the data making up the resource reference
 	 * @return The {@link ResourceReference} created or {@code null} if not successful
 	 */
-	protected ResourceReference createDefaultResourceReference(final Key key)
+	protected ResourceReference createDefaultResourceReference(final Key key, final boolean updateCache)
 	{
 		IResourceReferenceFactory factory = getResourceReferenceFactory();
 		if (factory == null)
 		{
 			factory = new DefaultResourceReferenceFactory();
 		}
-		return factory.create(key);
+		if (factory instanceof DefaultResourceReferenceFactory defaultFactory)
+		{
+			return defaultFactory.create(key, updateCache);
+
+		} else {
+			return factory.create(key);
+		}
 	}
 
 	/**
