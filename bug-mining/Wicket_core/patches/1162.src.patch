diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/parser/AbstractMarkupFilter.java b/wicket-core/src/main/java/org/apache/wicket/markup/parser/AbstractMarkupFilter.java
index 2ce2fab061..6478da2654 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/parser/AbstractMarkupFilter.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/parser/AbstractMarkupFilter.java
@@ -17,7 +17,9 @@
 package org.apache.wicket.markup.parser;
 
 import java.text.ParseException;
+import java.util.concurrent.atomic.AtomicLong;
 
+import org.apache.wicket.MetaDataKey;
 import org.apache.wicket.markup.ComponentTag;
 import org.apache.wicket.markup.HtmlSpecialTag;
 import org.apache.wicket.markup.Markup;
@@ -25,6 +27,7 @@ import org.apache.wicket.markup.MarkupElement;
 import org.apache.wicket.markup.MarkupParser;
 import org.apache.wicket.markup.MarkupResourceStream;
 import org.apache.wicket.markup.MarkupStream;
+import org.apache.wicket.request.cycle.RequestCycle;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
 
@@ -45,7 +48,12 @@ public abstract class AbstractMarkupFilter implements IMarkupFilter
 
 	/** The next MarkupFilter in the chain */
 	private IMarkupFilter parent;
-
+	
+	/** A key for a request-relative counter (see {@link #getRequestUniqueId()}) **/
+	private final static MetaDataKey<AtomicLong> REQUEST_COUNTER_KEY = new MetaDataKey<AtomicLong>()
+	{
+	};
+		
 	/**
 	 * Construct.
 	 */
@@ -190,4 +198,25 @@ public abstract class AbstractMarkupFilter implements IMarkupFilter
 		}
 		return wicketNamespace;
 	}
+	
+	/**
+	 * Returns an id using a request-relative counter. This can be
+	 * useful for autocomponent tags that needs to get tag id.
+	 * 
+	 * @return
+	 * 		the request-relative id
+	 */
+	protected long getRequestUniqueId()
+	{
+		AtomicLong counter = RequestCycle.get().getMetaData(REQUEST_COUNTER_KEY);
+		
+		if (counter == null)
+		{
+			counter = new AtomicLong();
+			
+			RequestCycle.get().setMetaData(REQUEST_COUNTER_KEY, counter);
+		}
+		
+		return counter.getAndIncrement();
+	}
 }
diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/EnclosureHandler.java b/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/EnclosureHandler.java
index 7739cd0b46..b29da3bef7 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/EnclosureHandler.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/EnclosureHandler.java
@@ -19,7 +19,6 @@ package org.apache.wicket.markup.parser.filter;
 import java.text.ParseException;
 import java.util.ArrayDeque;
 import java.util.Deque;
-import java.util.concurrent.atomic.AtomicLong;
 
 import org.apache.wicket.Component;
 import org.apache.wicket.MarkupContainer;
@@ -73,14 +72,6 @@ public final class EnclosureHandler extends AbstractMarkupFilter implements ICom
 	/** Stack of <wicket:enclosure> tags */
 	private Deque<ComponentTag> stack;
 
-	/**
-	 * Used to assign unique ids to enclosures
-	 * 
-	 * TODO queueing: there has to be a better way of doing this, perhaps some merged-markup-unique
-	 * counter
-	 */
-	private static final AtomicLong index = new AtomicLong();
-
 	/** The id of the first wicket tag inside the enclosure */
 	private String childId;
 
@@ -109,7 +100,7 @@ public final class EnclosureHandler extends AbstractMarkupFilter implements ICom
 			// If open tag, than put the tag onto the stack
 			if (tag.isOpen())
 			{
-				tag.setId(tag.getId() + index.getAndIncrement());
+				tag.setId(tag.getId() + getRequestUniqueId());
 				tag.setModified(true);
 				tag.setAutoComponentFactory(FACTORY);
 
diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/RelativePathPrefixHandler.java b/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/RelativePathPrefixHandler.java
index 0523d9aee3..554df3edb0 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/RelativePathPrefixHandler.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/RelativePathPrefixHandler.java
@@ -18,7 +18,6 @@ package org.apache.wicket.markup.parser.filter;
 
 import java.text.ParseException;
 import java.util.Iterator;
-import java.util.concurrent.atomic.AtomicInteger;
 
 import org.apache.wicket.Component;
 import org.apache.wicket.MarkupContainer;
@@ -109,14 +108,6 @@ public final class RelativePathPrefixHandler extends AbstractMarkupFilter
 		}
 	};
 
-	
-	/** 
-	 * https://issues.apache.org/jira/browse/WICKET-5724
-	 * 
-	 * Unique index to generate new tag ids.
-	 * */
-	private final AtomicInteger componentIndex = new AtomicInteger();
-
 	/**
 	 * Constructor for the IComponentResolver role.
 	 */
@@ -164,7 +155,7 @@ public final class RelativePathPrefixHandler extends AbstractMarkupFilter
 				if (tag.getId() == null)
 				{
 					tag.setId(getWicketRelativePathPrefix(null)
-						+ componentIndex.getAndIncrement());
+						+ getRequestUniqueId());
 					tag.setAutoComponentTag(true);
 				}
 
