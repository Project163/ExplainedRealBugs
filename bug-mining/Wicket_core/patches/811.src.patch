diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/html/internal/InlineEnclosure.java b/wicket-core/src/main/java/org/apache/wicket/markup/html/internal/InlineEnclosure.java
index 6ce1edc351..3e4d230dfe 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/html/internal/InlineEnclosure.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/html/internal/InlineEnclosure.java
@@ -19,7 +19,6 @@ package org.apache.wicket.markup.html.internal;
 import org.apache.wicket.Page;
 import org.apache.wicket.markup.ComponentTag;
 import org.apache.wicket.markup.IMarkupFragment;
-import org.apache.wicket.markup.Markup;
 import org.apache.wicket.markup.MarkupParser;
 import org.apache.wicket.markup.MarkupResourceStream;
 import org.apache.wicket.markup.parser.filter.InlineEnclosureHandler;
@@ -47,8 +46,6 @@ public class InlineEnclosure extends Enclosure
 
 	private static final Logger log = LoggerFactory.getLogger(InlineEnclosure.class);
 
-	private String enclosureMarkupAsString;
-
 	/**
 	 * Construct.
 	 * 
@@ -59,8 +56,6 @@ public class InlineEnclosure extends Enclosure
 	{
 		super(id, childId);
 
-		enclosureMarkupAsString = null;
-
 		// ensure that the Enclosure is ready for ajax updates
 		setOutputMarkupPlaceholderTag(true);
 		setMarkupId(getId());
@@ -87,34 +82,6 @@ public class InlineEnclosure extends Enclosure
 		return visible;
 	}
 
-	/**
-	 * {@link InlineEnclosure}s keep their own cache of their markup because Component#markup is
-	 * detached and later during Ajax request it is hard to re-lookup {@link InlineEnclosure}'s
-	 * markup from its parent.
-	 * 
-	 * @see org.apache.wicket.Component#getMarkup()
-	 */
-	@Override
-	public IMarkupFragment getMarkup()
-	{
-		IMarkupFragment enclosureMarkup = null;
-		if (enclosureMarkupAsString == null)
-		{
-			IMarkupFragment markup = super.getMarkup();
-			if (markup != null && markup != Markup.NO_MARKUP)
-			{
-				enclosureMarkup = markup;
-				enclosureMarkupAsString = markup.toString(true);
-			}
-		}
-		else
-		{
-			enclosureMarkup = Markup.of(enclosureMarkupAsString, getWicketNamespace());
-		}
-
-		return enclosureMarkup;
-	}
-
 	/**
 	 * @return the markup namespace for Wicket elements and attributes.
 	 */
diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/InlineEnclosureHandler.java b/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/InlineEnclosureHandler.java
index 7e9ea8e519..507339b5e6 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/InlineEnclosureHandler.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/parser/filter/InlineEnclosureHandler.java
@@ -64,6 +64,12 @@ public final class InlineEnclosureHandler extends AbstractMarkupFilter
 	/** enclosures inside enclosures */
 	private Stack<ComponentTag> enclosures;
 
+	/**
+	 * InlinceEnclosures are not removed after render as other auto-components,
+	 * thus they have to have a stable id.
+	 */
+	private int counter;
+
 	/**
 	 * Construct.
 	 */
@@ -107,7 +113,8 @@ public final class InlineEnclosureHandler extends AbstractMarkupFilter
 				{
 					if (Strings.isEmpty(htmlId))
 					{
-						String id = getWicketNamespace() + "_" + INLINE_ENCLOSURE_ID_PREFIX;
+						String id = getWicketNamespace() + "_" + INLINE_ENCLOSURE_ID_PREFIX +
+							(counter++);
 						tag.setId(id);
 					}
 					else
@@ -198,10 +205,7 @@ public final class InlineEnclosureHandler extends AbstractMarkupFilter
 		if (Strings.isEmpty(inlineEnclosureChildId) == false)
 		{
 			String id = tag.getId();
-			if (id.startsWith(getWicketNamespace(markupStream)))
-			{
-				id = id + container.getPage().getAutoIndex();
-			}
+
 			// Yes, we handled the tag
 			return new InlineEnclosure(id, inlineEnclosureChildId);
 		}
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/AjaxEnclosureTest.java b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/AjaxEnclosureTest.java
index 9955eae975..9fe3eb3a1b 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/AjaxEnclosureTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/AjaxEnclosureTest.java
@@ -36,9 +36,9 @@ public class AjaxEnclosureTest extends WicketTestCase
 {
 	private final String inlineEnclosureIdPrefix = "wicket_InlineEnclosure-";
 	private final String inlineEnclosureHiddenPattern = "<div id=\"" + inlineEnclosureIdPrefix +
-		"1\" style=\"display:none\"></div>";
+		"0\" style=\"display:none\"></div>";
 	private final String inlineEnclosureVisiblePattern = "<div id=\"" + inlineEnclosureIdPrefix +
-		"1\">";
+		"0\">";
 
 	@Override
 	protected WebApplication newApplication()
@@ -54,7 +54,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 		};
 		return webApplication;
 	}
-	
+
 	/**
 	 * Test toggling the controlling child inside the inline enclosure
 	 */
@@ -104,7 +104,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 	@Test
 	public void ajaxTogglingNonControllingChildShouldNotToggleEnclosure()
 	{
-		final String enclosurePath = "wicket_InlineEnclosure-1";
+		final String enclosurePath = "wicket_InlineEnclosure-0";
 		{
 			// label 2 On
 			AjaxEnclosurePage_1 ajaxPage = tester.startPage(AjaxEnclosurePage_1.class);
@@ -145,7 +145,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 	@Test
 	public void nestedInlineEnclosuresShouldToggleNormally()
 	{
-		final String enclosure1Path = "wicket_InlineEnclosure-1";
+		final String enclosure1Path = "wicket_InlineEnclosure-0";
 
 		{
 			// 1. test that enclosure1, enclosure2, label1, label2 are visible, click link1,
@@ -235,7 +235,7 @@ public class AjaxEnclosureTest extends WicketTestCase
 	@Test
 	public void controllingChildShouldDefaultToTheSingleComponentInsideEnclosure()
 	{
-		final String enclosurePath = "wicket_InlineEnclosure-1";
+		final String enclosurePath = "wicket_InlineEnclosure-0";
 
 		{
 			// enclosure On
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureDifferentNamespaceExpectedResult.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureDifferentNamespaceExpectedResult.html
index 0bf49ad911..26a2a7a0dc 100755
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureDifferentNamespaceExpectedResult.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureDifferentNamespaceExpectedResult.html
@@ -2,8 +2,8 @@
 <body>
 
 <!-- nested inline enclosures with separate child depths. -->
-<div id="w_InlineEnclosure-1"><span>Test Label 1</span>
-	<div id="w_InlineEnclosure-2">
+<div id="w_InlineEnclosure-0"><span>Test Label 1</span>
+	<div id="w_InlineEnclosure-1">
 		<table>
 			<tr>
 				<td><span>Test Label 2</span></td>
@@ -13,15 +13,15 @@
 </div>
 
 <!-- nested inline enclosures with same child depth. -->
-<div id="w_InlineEnclosure-3">
-	<div id="w_InlineEnclosure-4">
+<div id="w_InlineEnclosure-2">
+	<div id="w_InlineEnclosure-3">
 		<span>Test Label 3</span>
 		<span>Test Label 4</span>
 	</div>
 </div>
 
 <!-- enclosure tag nested inside inline enclosure with separate child depths. -->
-<div id="w_InlineEnclosure-5"> <span>Test Label 5</span>
+<div id="w_InlineEnclosure-4"> <span>Test Label 5</span>
 	
 		<table>
 			<tr>
@@ -34,7 +34,7 @@
 </div>
 
 <!-- enclosure tag nested inside inline enclosure with same child depth. -->
-<div id="w_InlineEnclosure-7">
+<div id="w_InlineEnclosure-5">
 	
 		<table>
 			<tr>
@@ -49,7 +49,7 @@
 
 <!--  inline enclosure nested inside enclosure tag with separate child depths. -->
 
-	<div id="w_InlineEnclosure-10"> <span>Test Label 9</span>
+	<div id="w_InlineEnclosure-6"> <span>Test Label 9</span>
 		<table>
 			<tr>
 				<td><span>Test Label 10</span></td>
@@ -59,7 +59,7 @@
 
 
 <!--  inline enclosure nested inside enclosure tag with same child depth. -->
-<div id="w_InlineEnclosure-11">
+<div id="w_InlineEnclosure-7">
 	
 		<table>
 			<tr>
@@ -74,7 +74,7 @@
 
 <!--  inline enclosure nested inside enclosure tag with same child depth inside a wicket container. -->
 
-	<div id="w_InlineEnclosure-14">
+	<div id="w_InlineEnclosure-8">
 		<div>
 			<table>
 				<tr>
@@ -90,8 +90,8 @@
 
 
 <!-- nested inline enclosures without explicitly determining children -->
-<div id="w_InlineEnclosure-15">
-	<div id="w_InlineEnclosure-16">
+<div id="w_InlineEnclosure-9">
+	<div id="w_InlineEnclosure-10">
 		<table>
 			<tr>
 				<td>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_1.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_1.html
index 15d30dcd59..5bc9ca2ac5 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_1.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_1.html
@@ -1,9 +1,9 @@
 <html>
 <body>
 
-<span id="wicket_InlineEnclosure-1"> <span>Test Label 1</span> </span>
+<span id="wicket_InlineEnclosure-0"> <span>Test Label 1</span> </span>
 
-<div id="wicket_InlineEnclosure-2">
+<div id="wicket_InlineEnclosure-1">
 	<table>
 		<tr>
 			<td><span>Test Label 2</span></td>
@@ -11,9 +11,9 @@
 	</table>
 </div>
 
-<span id="wicket_InlineEnclosure-3" style="display:none"></span>
+<span id="wicket_InlineEnclosure-2" style="display:none"></span>
 
-<div id="wicket_InlineEnclosure-4">
+<div id="wicket_InlineEnclosure-3">
 	<table>
 		<tr>
 			<td><span>Test Label 4</span></td>
@@ -36,9 +36,9 @@
 	</table>
 </div>
 
-<div id="wicket_InlineEnclosure-5"><span> <span>Test Label 8</span> </span></div>
+<div id="wicket_InlineEnclosure-4"><span> <span>Test Label 8</span> </span></div>
 
-<div id="wicket_InlineEnclosure-6"><span>Test Label 9</span></div>
+<div id="wicket_InlineEnclosure-5"><span>Test Label 9</span></div>
 
 <div id="customInlineEnclosureId"><span>Test Label 10</span>
 </div>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_2.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_2.html
index e2e2b17c41..7183087f83 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_2.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePageExpectedResult_2.html
@@ -2,8 +2,8 @@
 <body>
 
 <!-- nested inline enclosures with separate child depths. -->
-<div id="wicket_InlineEnclosure-1"><span>Test Label 1</span>
-	<div id="wicket_InlineEnclosure-2">
+<div id="wicket_InlineEnclosure-0"><span>Test Label 1</span>
+	<div id="wicket_InlineEnclosure-1">
 		<table>
 			<tr>
 				<td><span>Test Label 2</span></td>
@@ -13,15 +13,15 @@
 </div>
 
 <!-- nested inline enclosures with same child depth. -->
-<div id="wicket_InlineEnclosure-3"> 
-	<div id="wicket_InlineEnclosure-4"> 
+<div id="wicket_InlineEnclosure-2"> 
+	<div id="wicket_InlineEnclosure-3"> 
 		<span>Test Label 3</span>
 		<span>Test Label 4</span> 
 	</div> 
 </div>
 
 <!-- enclosure tag nested inside inline enclosure with separate child depths. -->
-<div id="wicket_InlineEnclosure-5"> <span>Test Label 5</span>
+<div id="wicket_InlineEnclosure-4"> <span>Test Label 5</span>
 	
 		<table>
 			<tr>
@@ -34,7 +34,7 @@
 </div>
 
 <!-- enclosure tag nested inside inline enclosure with same child depth. -->
-<div id="wicket_InlineEnclosure-7"> 
+<div id="wicket_InlineEnclosure-5"> 
 	
 		<table>
 			<tr>
@@ -49,7 +49,7 @@
 
 <!--  inline enclosure nested inside enclosure tag with separate child depths. -->
 
-	<div id="wicket_InlineEnclosure-10"> <span>Test Label 9</span>
+	<div id="wicket_InlineEnclosure-6"> <span>Test Label 9</span>
 		<table>
 			<tr>
 				<td><span>Test Label 10</span></td>
@@ -59,7 +59,7 @@
 
 
 <!--  inline enclosure nested inside enclosure tag with same child depth. -->
-<div id="wicket_InlineEnclosure-11"> 
+<div id="wicket_InlineEnclosure-7"> 
 	
 		<table>
 			<tr>
@@ -74,7 +74,7 @@
 
 <!--  inline enclosure nested inside enclosure tag with same child depth inside a wicket container. -->
 
-	<div id="wicket_InlineEnclosure-14"> 
+	<div id="wicket_InlineEnclosure-8"> 
 		<div>
 			<table>
 				<tr>
@@ -90,8 +90,8 @@
 
 
 <!-- nested inline enclosures without explicitly determining children -->
-<div id="wicket_InlineEnclosure-15"> 
-	<div id="wicket_InlineEnclosure-16">
+<div id="wicket_InlineEnclosure-9"> 
+	<div id="wicket_InlineEnclosure-10">
 		<table>
 			<tr>
 				<td>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePanelPageExpectedResult.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePanelPageExpectedResult.html
index 2b6aa45de9..107750a1c2 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePanelPageExpectedResult.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosurePanelPageExpectedResult.html
@@ -1,13 +1,13 @@
 <html>
 <body>
-	<div id="wicket_InlineEnclosure-1">
+	<div id="wicket_InlineEnclosure-0">
 		<div>
 			<div>
 	This is a simple test panel. This contains a label and an inline enclosure
 	with a label inside it.
 	<span>Inside InlineEnclosure and Panel: hello world</span>
 	
-	<div id="wicket_InlineEnclosure-2">
+	<div id="wicket_InlineEnclosure-0">
 		<span>Inside InlineEnclosure, Panel and another InlineEnclosure: hello again.</span>
 	</div>
 	
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureTest.java b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureTest.java
index ed29a7078a..03b4a3bd2e 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureTest.java
@@ -18,17 +18,43 @@ package org.apache.wicket.markup.html.internal;
 
 import org.apache.wicket.Page;
 import org.apache.wicket.WicketTestCase;
+import org.apache.wicket.markup.parser.filter.InlineEnclosureHandler;
 import org.apache.wicket.protocol.http.WebApplication;
 import org.junit.Test;
 
 
 /**
- * Simple test using the WicketTester
+ * Test for {@link InlineEnclosure} and {@link InlineEnclosureHandler}.
  * 
  * @author Joonas Hamalainen
  */
 public class InlineEnclosureTest extends WicketTestCase
 {
+	/**
+	 * WICKET-5085: Since {@link InlineEnclosure}s are not removed as other auto-Components, they must be
+	 * resolved once only.
+	 * 
+	 * @throws Exception
+	 */
+	@Test
+	public void inlineEnclosuresAreResolvedOnceOnly() throws Exception
+	{
+		InlineEnclosurePanelPage page = new InlineEnclosurePanelPage();
+
+		tester.startPage(page);
+
+		assertEquals(2, page.visitChildren(InlineEnclosure.class).toList().size());
+
+		tester.startPage(page);
+
+		assertEquals(2, page.visitChildren(InlineEnclosure.class).toList().size());
+
+		tester.startPage(page);
+
+		assertEquals(2, page.visitChildren(InlineEnclosure.class).toList().size());
+	}
+
+
 	/**
 	 * @throws Exception
 	 */
@@ -60,27 +86,27 @@ public class InlineEnclosureTest extends WicketTestCase
 	public void inlineEnclosurePageDifferentNamespace() throws Exception
 	{
 		executeTest(InlineEnclosureDifferentNamespacePage.class,
-		"InlineEnclosureDifferentNamespaceExpectedResult.html");
+			"InlineEnclosureDifferentNamespaceExpectedResult.html");
 	}
 
 	/**
 	 * https://issues.apache.org/jira/browse/WICKET-4520
-	 *
+	 * 
 	 * Tests that wicket:enclosure and wicket:message attributes can co-exist
-	 *
+	 * 
 	 * @throws Exception
 	 */
 	@Test
 	public void inlineEnclosureWithWicketMessageVisible() throws Exception
 	{
 		executeTest(new InlineEnclosureWithWicketMessagePage(true),
-				"InlineEnclosureWithWicketMessagePage_visible_expected.html");
+			"InlineEnclosureWithWicketMessagePage_visible_expected.html");
 	}
 
 	/**
-	 *
+	 * 
 	 * https://issues.apache.org/jira/browse/WICKET-4520
-	 *
+	 * 
 	 * Tests that wicket:enclosure and wicket:message attributes can co-exist
 	 * 
 	 * @throws Exception
@@ -89,7 +115,7 @@ public class InlineEnclosureTest extends WicketTestCase
 	public void inlineEnclosureWithWicketMessageInvisible() throws Exception
 	{
 		executeTest(new InlineEnclosureWithWicketMessagePage(false),
-				"InlineEnclosureWithWicketMessagePage_invisible_expected.html");
+			"InlineEnclosureWithWicketMessagePage_invisible_expected.html");
 	}
 
 	@Override
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureWithWicketMessagePage_invisible_expected.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureWithWicketMessagePage_invisible_expected.html
index 0e8e9118e8..8545cd321f 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureWithWicketMessagePage_invisible_expected.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureWithWicketMessagePage_invisible_expected.html
@@ -21,6 +21,6 @@
 	<title>Wicket 4520</title>
 </head>
 <body>
-	<div id="wicket_message_attr_1" style="display:none"></div>
+	<div id="wicket_message_attr_" style="display:none"></div>
 </body>
 </html>
\ No newline at end of file
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureWithWicketMessagePage_visible_expected.html b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureWithWicketMessagePage_visible_expected.html
index 6d8d995ecb..1fa487d057 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureWithWicketMessagePage_visible_expected.html
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/InlineEnclosureWithWicketMessagePage_visible_expected.html
@@ -21,7 +21,7 @@
 	<title>Wicket 4520</title>
 </head>
 <body>
-	<div id="wicket_message_attr_1" title="Some title">
+	<div id="wicket_message_attr_" title="Some title">
 		<div>Inner div
 			<span>A Label</span>
 		</div>
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/TogglePageTest.java b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/TogglePageTest.java
index 0380f8dadc..2b6cd45beb 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/TogglePageTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/internal/TogglePageTest.java
@@ -155,10 +155,10 @@ public class TogglePageTest extends WicketTestCase
 		String inlineEnclosureIdPrefix = "wicket_InlineEnclosure-";
 
 		String inlineEnclosureHiddenPattern = "<tr id=\"" + inlineEnclosureIdPrefix +
-			"1\" style=\"display:none\"></tr>";
+			"0\" style=\"display:none\"></tr>";
 
 		String inlineEnclosureVisiblePattern = "<tr bgcolor=\"red\" id=\"" +
-			inlineEnclosureIdPrefix + "1\">";
+			inlineEnclosureIdPrefix + "0\">";
 
 		{
 			// On
