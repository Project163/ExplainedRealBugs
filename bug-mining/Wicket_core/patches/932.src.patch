diff --git a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/ReferenceB.java b/wicket-core/src/main/java/org/apache/wicket/markup/head/IHeaderItemWrapper.java
similarity index 67%
rename from wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/ReferenceB.java
rename to wicket-core/src/main/java/org/apache/wicket/markup/head/IHeaderItemWrapper.java
index 4ceee09176..a23a233a2f 100644
--- a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/ReferenceB.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/head/IHeaderItemWrapper.java
@@ -14,17 +14,22 @@
  * See the License for the specific language governing permissions and
  * limitations under the License.
  */
-package org.apache.wicket.resource.aggregator.bundlepriority;
-
-import org.apache.wicket.request.resource.JavaScriptResourceReference;
+package org.apache.wicket.markup.head;
 
 /**
- *
+ * An interface for all HeaderItems which delegate to another HeaderItem and can re-wrap an existing
+ * item.
+ * 
+ * @since 6.12
  */
-public class ReferenceB extends JavaScriptResourceReference
+public interface IHeaderItemWrapper extends IWrappedHeaderItem
 {
-	public ReferenceB()
-	{
-		super(ReferenceB.class, "b.js");
-	}
+	/**
+	 * Wraps an existing HeaderItem
+	 * 
+	 * @param item
+	 *            The item to wrap
+	 * @return the wrapped header item
+	 */
+	HeaderItem wrap(HeaderItem item);
 }
diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/head/PriorityHeaderItem.java b/wicket-core/src/main/java/org/apache/wicket/markup/head/PriorityHeaderItem.java
index 50cddcac28..42054fe128 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/head/PriorityHeaderItem.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/head/PriorityHeaderItem.java
@@ -28,7 +28,7 @@ import org.apache.wicket.request.Response;
  * 
  * @author papegaaij
  */
-public class PriorityHeaderItem extends HeaderItem implements IWrappedHeaderItem
+public class PriorityHeaderItem extends HeaderItem implements IHeaderItemWrapper
 {
 	private HeaderItem wrapped;
 
@@ -52,6 +52,12 @@ public class PriorityHeaderItem extends HeaderItem implements IWrappedHeaderItem
 		return wrapped;
 	}
 
+	@Override
+	public PriorityHeaderItem wrap(HeaderItem item)
+	{
+		return new PriorityHeaderItem(item);
+	}
+
 	@Override
 	public Iterable<?> getRenderTokens()
 	{
@@ -70,7 +76,7 @@ public class PriorityHeaderItem extends HeaderItem implements IWrappedHeaderItem
 		List<PriorityHeaderItem> ret = new ArrayList<>();
 		for (HeaderItem curDependency : getWrapped().getDependencies())
 		{
-			ret.add(new PriorityHeaderItem(curDependency));
+			ret.add(wrap(curDependency));
 		}
 		List<HeaderItem> dependencies = super.getDependencies();
 		dependencies.addAll(ret);
diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/head/ResourceAggregator.java b/wicket-core/src/main/java/org/apache/wicket/markup/head/ResourceAggregator.java
index b68628455b..39c74c6bb4 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/head/ResourceAggregator.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/head/ResourceAggregator.java
@@ -371,6 +371,10 @@ public class ResourceAggregator extends DecoratingHeaderResponse
 		if (wasRendered(item))
 			return false;
 
+		if (item instanceof IWrappedHeaderItem)
+		{
+			getRealResponse().markRendered(((IWrappedHeaderItem)item).getWrapped());
+		}
 		getRealResponse().markRendered(item);
 		for (HeaderItem curProvided : item.getProvidedResources())
 		{
@@ -400,6 +404,14 @@ public class ResourceAggregator extends DecoratingHeaderResponse
 		}
 
 		HeaderItem bundle = Application.get().getResourceBundles().findBundle(innerItem);
-		return bundle == null ? item : bundle;
+		if (bundle == null)
+		{
+			return item;
+		}
+		if (item instanceof IHeaderItemWrapper)
+		{
+			bundle = ((IHeaderItemWrapper)item).wrap(bundle);
+		}
+		return bundle;
 	}
 }
diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/head/filter/FilteredHeaderItem.java b/wicket-core/src/main/java/org/apache/wicket/markup/head/filter/FilteredHeaderItem.java
index e6db34c492..d814993392 100644
--- a/wicket-core/src/main/java/org/apache/wicket/markup/head/filter/FilteredHeaderItem.java
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/head/filter/FilteredHeaderItem.java
@@ -20,7 +20,7 @@ import java.util.ArrayList;
 import java.util.List;
 
 import org.apache.wicket.markup.head.HeaderItem;
-import org.apache.wicket.markup.head.IWrappedHeaderItem;
+import org.apache.wicket.markup.head.IHeaderItemWrapper;
 import org.apache.wicket.request.Response;
 
 /**
@@ -32,7 +32,7 @@ import org.apache.wicket.request.Response;
  * 
  * @author papegaaij
  */
-public class FilteredHeaderItem extends HeaderItem implements IWrappedHeaderItem
+public class FilteredHeaderItem extends HeaderItem implements IHeaderItemWrapper
 {
 	private HeaderItem wrapped;
 
@@ -61,6 +61,12 @@ public class FilteredHeaderItem extends HeaderItem implements IWrappedHeaderItem
 		return wrapped;
 	}
 
+	@Override
+	public FilteredHeaderItem wrap(HeaderItem item)
+	{
+		return new FilteredHeaderItem(item, getFilterName());
+	}
+
 	/**
 	 * @return the name of the filter this item belongs to
 	 */
@@ -87,7 +93,7 @@ public class FilteredHeaderItem extends HeaderItem implements IWrappedHeaderItem
 		List<FilteredHeaderItem> ret = new ArrayList<>();
 		for (HeaderItem curDependency : getWrapped().getDependencies())
 		{
-			ret.add(new FilteredHeaderItem(curDependency, getFilterName()));
+			ret.add(wrap(curDependency));
 		}
 		List<HeaderItem> dependencies = super.getDependencies();
 		dependencies.addAll(ret);
diff --git a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/ResourceAggregatorTest.java b/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/ResourceAggregatorTest.java
index 3c077220f8..bd3acb3939 100644
--- a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/ResourceAggregatorTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/ResourceAggregatorTest.java
@@ -195,7 +195,8 @@ public class ResourceAggregatorTest extends WicketTestCase
 	}
 
 	/**
-	 * bundle {a, b->a} and {c->a, d->c->a}, render [priority(b), d], should render [ab, cd]
+	 * bundle {a, b->a} and {c->a, d->c->a}, render [priority(b), d], should render [priority(ab),
+	 * cd]
 	 */
 	@Test
 	public void testTwoBundlesWithDependenciesAndPriority()
@@ -210,7 +211,7 @@ public class ResourceAggregatorTest extends WicketTestCase
 				new ResourceReferenceD());
 		aggregator.render(new PriorityHeaderItem(forReference(new ResourceReferenceB())));
 		aggregator.render(forReference(new ResourceReferenceD()));
-		assertItems(bundleAB, bundleCD);
+		assertItems(new PriorityHeaderItem(bundleAB), bundleCD);
 	}
 
 	/**
@@ -252,4 +253,19 @@ public class ResourceAggregatorTest extends WicketTestCase
 		assertItems(forReference(new ResourceReferenceX()), forReference(new ResourceReferenceY()),
 			bundle12);
 	}
+
+	/**
+	 * bundle {a, b -> a}, render [x, priority(a)], should render [priority(ab), x]
+	 */
+	@Test
+	public void testBundleWithPriority()
+	{
+		HeaderItem bundleAB = Application.get()
+			.getResourceBundles()
+			.addJavaScriptBundle(Application.class, "ab.js", new ResourceReferenceA(),
+				new ResourceReferenceB());
+		aggregator.render(forReference(new ResourceReferenceX()));
+		aggregator.render(new PriorityHeaderItem(forReference(new ResourceReferenceA())));
+		assertItems(new PriorityHeaderItem(bundleAB), forReference(new ResourceReferenceX()));
+	}
 }
diff --git a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/BundlePriorityApplication.java b/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/BundlePriorityApplication.java
deleted file mode 100644
index 1eea36b8f6..0000000000
--- a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/BundlePriorityApplication.java
+++ /dev/null
@@ -1,42 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.wicket.resource.aggregator.bundlepriority;
-
-import org.apache.wicket.Page;
-import org.apache.wicket.protocol.http.WebApplication;
-
-/**
- *
- */
-public class BundlePriorityApplication extends WebApplication
-{
-
-	@Override
-	public Class<? extends Page> getHomePage()
-	{
-		return BundlePriorityPage.class;
-	}
-
-	@Override
-	protected void init()
-	{
-		super.init();
-
-		getResourceBundles().addJavaScriptBundle(BundlePriorityApplication.class, "bundle-a.js", new ReferenceA());
-		getResourceBundles().addJavaScriptBundle(BundlePriorityApplication.class, "bundle-b.js", new ReferenceB());
-	}
-}
diff --git a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/BundlePriorityPage.java b/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/BundlePriorityPage.java
deleted file mode 100644
index 9a5c43904b..0000000000
--- a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/BundlePriorityPage.java
+++ /dev/null
@@ -1,49 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.wicket.resource.aggregator.bundlepriority;
-
-import org.apache.wicket.MarkupContainer;
-import org.apache.wicket.markup.IMarkupResourceStreamProvider;
-import org.apache.wicket.markup.head.IHeaderResponse;
-import org.apache.wicket.markup.head.JavaScriptHeaderItem;
-import org.apache.wicket.markup.head.PriorityHeaderItem;
-import org.apache.wicket.markup.head.StringHeaderItem;
-import org.apache.wicket.markup.html.WebPage;
-import org.apache.wicket.util.resource.IResourceStream;
-import org.apache.wicket.util.resource.StringResourceStream;
-
-/**
- *
- */
-public class BundlePriorityPage extends WebPage implements IMarkupResourceStreamProvider
-{
-	@Override
-	public void renderHead(IHeaderResponse response)
-	{
-		super.renderHead(response);
-
-		response.render(StringHeaderItem.forString("<style>some style</style>"));
-		response.render(JavaScriptHeaderItem.forReference(new ReferenceB()));
-		response.render(new PriorityHeaderItem(JavaScriptHeaderItem.forReference(new ReferenceA())));
-	}
-
-	@Override
-	public IResourceStream getMarkupResourceStream(MarkupContainer container, Class<?> containerClass)
-	{
-		return new StringResourceStream("<html><body></body></html>");
-	}
-}
diff --git a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/BundlePriorityTest.java b/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/BundlePriorityTest.java
deleted file mode 100644
index 8838f595e0..0000000000
--- a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/BundlePriorityTest.java
+++ /dev/null
@@ -1,40 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.wicket.resource.aggregator.bundlepriority;
-
-import org.apache.wicket.WicketTestCase;
-import org.apache.wicket.protocol.http.WebApplication;
-import org.junit.Test;
-
-/**
- *
- */
-public class BundlePriorityTest extends WicketTestCase
-{
-	@Override
-	protected WebApplication newApplication()
-	{
-		return new BundlePriorityApplication();
-	}
-
-	@Test
-	public void bundleAShouldBeAtTheTop()
-	{
-		tester.startPage(new BundlePriorityPage());
-		System.err.println(tester.getLastResponseAsString());
-	}
-}
diff --git a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/ReferenceA.java b/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/ReferenceA.java
deleted file mode 100644
index 0fb5a334f5..0000000000
--- a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/ReferenceA.java
+++ /dev/null
@@ -1,30 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.wicket.resource.aggregator.bundlepriority;
-
-import org.apache.wicket.request.resource.JavaScriptResourceReference;
-
-/**
- *
- */
-public class ReferenceA extends JavaScriptResourceReference
-{
-	public ReferenceA()
-	{
-		super(ReferenceA.class, "a.js");
-	}
-}
diff --git a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/a.js b/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/a.js
deleted file mode 100644
index b7e14eb62c..0000000000
--- a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/a.js
+++ /dev/null
@@ -1,17 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-var a = "A";
diff --git a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/b.js b/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/b.js
deleted file mode 100644
index 19c773cbf3..0000000000
--- a/wicket-core/src/test/java/org/apache/wicket/resource/aggregator/bundlepriority/b.js
+++ /dev/null
@@ -1,17 +0,0 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-var b = "B";
