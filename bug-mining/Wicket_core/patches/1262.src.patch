diff --git a/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java b/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java
index 916b9947e2..d4f4630767 100644
--- a/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java
+++ b/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java
@@ -1010,7 +1010,7 @@ public abstract class MarkupContainer extends Component implements Iterable<Comp
 		
 		// if we have a path to page dequeue any container children.
 		// we can do it only if page is not already rendering!
-		if (page != null && !page.getFlag(FLAG_RENDERING) && child instanceof MarkupContainer)
+		if (page != null && child instanceof MarkupContainer)
 		{
 		    MarkupContainer childContainer = (MarkupContainer)child;
 		    // if we are already dequeueing there is no need to dequeue again
@@ -1873,13 +1873,12 @@ public abstract class MarkupContainer extends Component implements Iterable<Comp
 		modCounter = 0;
 		removals_clear();
 
-		if (queue != null && !queue.isEmpty())
+		if (queue != null && !queue.isEmpty() && hasBeenRendered())
 		{
 			throw new WicketRuntimeException(
 					String.format("Detach called on component with id '%s' while it had a non-empty queue: %s",
 							getId(), queue));
 		}
-		queue = null;
 	}
 
 	private transient ComponentQueue queue;
diff --git a/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingTest.java b/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingTest.java
index 3039a27ada..58445bc2ab 100644
--- a/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingTest.java
@@ -606,7 +606,25 @@ public class ComponentQueueingTest extends WicketTestCase
 		tester.startPage(p);
 		assertEquals("", tester.getLastResponseAsString());
 	}
+	
+	/**
+	 * Test autocomponent inside not-queue region
+	 */
+	@Test
+	public void autosInsideNotQueueRegion()
+	{
+		TestPage p = new TestPage();
+		p.setPageMarkup("<div wicket:id='outerContainer'><wicket:enclosure><div wicket:id='a'></div></wicket:enclosure></div>");
+		Label a = new Label("a", "a");
+		WebMarkupContainer outer;
+		p.add(outer = new WebMarkupContainer("outerContainer"));
+		outer.queue(a);
+		
+		tester.startPage(p);
 
+		assertTrue(a.getParent() instanceof Enclosure);
+	}
+	
 	@Test
 	public void border1()
 	{
