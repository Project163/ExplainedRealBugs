diff --git a/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java b/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java
index 016efeb7d2..17001c56f4 100644
--- a/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java
+++ b/wicket-core/src/main/java/org/apache/wicket/MarkupContainer.java
@@ -1616,7 +1616,8 @@ public abstract class MarkupContainer extends Component implements Iterable<Comp
 					.getAutoComponentFactory();
 				if (autoComponentFactory != null)
 				{
-					queue(autoComponentFactory.newComponent(this, tag));
+					Component autoComponent = autoComponentFactory.newComponent(this, tag);
+					addDequeuedComponent(autoComponent, tag);
 				}
 
 				// Every component is responsible just for its own auto components
diff --git a/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingTest.java b/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingTest.java
index b2bd7c4f76..4307063a5a 100644
--- a/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/queueing/ComponentQueueingTest.java
@@ -745,15 +745,38 @@ public class ComponentQueueingTest extends WicketTestCase
 	{
 		TestPage page = new TestPage();
 		page.setPageMarkup("<wicket:link>"
-				+ "<a href='test.html'>"
-				+ "<wicket:container wicket:id='test'>test</wicket:container>"
-				+ "</a></wicket:link>");
+			+ "<a href='test.html'>"
+			+ "<wicket:container wicket:id='test'>test</wicket:container>"
+			+ "</a></wicket:link>");
 		
 		page.queue(new WebMarkupContainer("test"));
-
+		
 		tester.startPage(page);	
+	}
+
+	@Test
+	public void queueNestedEnclosure()
+	{
+		TestPage page = new TestPage();
+		page.setPageMarkup( "<div wicket:enclosure='outer'>" +
+			"<div wicket:id='outer'>" +
+			"	<div wicket:enclosure='middle'>" +
+			"		<div wicket:enclosure='inner'>" +
+			"			<div wicket:id='inner'>inner</div>" +
+			"		</div>" +
+			"		<div wicket:id='middle'>middle</div>" +
+			"	</div>" +
+			"	outer" +
+			"</div>" +
+			"</div>");
 		
-	
+		WebMarkupContainer container = new WebMarkupContainer("outer");
+		container.add(new WebMarkupContainer("middle"));
+		container.add(new WebMarkupContainer("inner"));
+		
+		page.add(container);
+		
+		tester.startPage(page);	
 	}
 
 	/**
