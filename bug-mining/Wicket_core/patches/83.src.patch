diff --git a/wicket-core/src/main/java/org/apache/wicket/mock/MockWebRequest.java b/wicket-core/src/main/java/org/apache/wicket/mock/MockWebRequest.java
index 1ab5a2abec..7cf67ceadd 100644
--- a/wicket-core/src/main/java/org/apache/wicket/mock/MockWebRequest.java
+++ b/wicket-core/src/main/java/org/apache/wicket/mock/MockWebRequest.java
@@ -43,6 +43,9 @@ public class MockWebRequest extends WebRequest
 	private Map<String, List<Object>> headers = new HashMap<String, List<Object>>();
 	private MockRequestParameters postRequestParameters = new MockRequestParameters();
 	private Locale locale = Locale.getDefault();
+	private String contextPath;
+	private String filterPath;
+	private String prefixToContextPath;
 
 	/**
 	 * Construct.
@@ -54,6 +57,21 @@ public class MockWebRequest extends WebRequest
 		this.url = url;
 	}
 
+	/**
+	 * Construct.
+	 * 
+	 * @param url
+	 * @param contextPath
+	 * @param filterPath
+	 */
+	public MockWebRequest(Url url, String contextPath, String filterPath, String prefixToContextPath)
+	{
+		this.url = url;
+		this.contextPath = contextPath;
+		this.filterPath = filterPath;
+		this.prefixToContextPath = prefixToContextPath;
+	}
+
 	MockWebRequest(Url url, List<Cookie> cookies, Map<String, List<Object>> headers,
 		MockRequestParameters postRequestParameters, Locale locale)
 	{
@@ -262,4 +280,42 @@ public class MockWebRequest extends WebRequest
 	{
 		return this;
 	}
+
+	@Override
+	public String getContextPath()
+	{
+		return contextPath;
+	}
+
+	public MockWebRequest setContextPath(String contextPath)
+	{
+		this.contextPath = contextPath;
+		return this;
+	}
+
+	@Override
+	public String getFilterPath()
+	{
+		return filterPath;
+	}
+
+	public MockWebRequest setFilterPath(String filterPath)
+	{
+		this.filterPath = filterPath;
+		return this;
+	}
+
+	@Override
+	public String getPrefixToContextPath()
+	{
+		return prefixToContextPath;
+	}
+
+	public MockWebRequest setPrefixToContextPath(String prefixToContextPath)
+	{
+		this.prefixToContextPath = prefixToContextPath;
+		return this;
+	}
+
+
 }
diff --git a/wicket-core/src/main/java/org/apache/wicket/protocol/http/servlet/ServletWebRequest.java b/wicket-core/src/main/java/org/apache/wicket/protocol/http/servlet/ServletWebRequest.java
index 8dd0be80af..3fb21bbfac 100644
--- a/wicket-core/src/main/java/org/apache/wicket/protocol/http/servlet/ServletWebRequest.java
+++ b/wicket-core/src/main/java/org/apache/wicket/protocol/http/servlet/ServletWebRequest.java
@@ -406,5 +406,15 @@ public class ServletWebRequest extends WebRequest
 		return httpServletRequest;
 	}
 
+	@Override
+	public String getContextPath()
+	{
+		return httpServletRequest.getContextPath();
+	}
 
+	@Override
+	public String getFilterPath()
+	{
+		return filterPrefix;
+	}
 }
diff --git a/wicket-core/src/main/java/org/apache/wicket/request/cycle/RequestCycle.java b/wicket-core/src/main/java/org/apache/wicket/request/cycle/RequestCycle.java
index 2e91cae48e..21f9fe43d3 100644
--- a/wicket-core/src/main/java/org/apache/wicket/request/cycle/RequestCycle.java
+++ b/wicket-core/src/main/java/org/apache/wicket/request/cycle/RequestCycle.java
@@ -142,7 +142,7 @@ public class RequestCycle implements IRequestCycle, IEventSink
 	protected UrlRenderer newUrlRenderer()
 	{
 		// All URLs will be rendered relative to current request (can be overridden afterwards)
-		return new UrlRenderer(getRequest().getClientUrl(), getRequest().getPrefixToContextPath());
+		return new UrlRenderer(getRequest());
 	}
 
 	/**
diff --git a/wicket-core/src/test/java/org/apache/wicket/request/cycle/UrlRendererTest.java b/wicket-core/src/test/java/org/apache/wicket/request/cycle/UrlRendererTest.java
index faaaaf2a47..8b8cf88753 100644
--- a/wicket-core/src/test/java/org/apache/wicket/request/cycle/UrlRendererTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/request/cycle/UrlRendererTest.java
@@ -16,14 +16,11 @@
  */
 package org.apache.wicket.request.cycle;
 
-import javax.servlet.http.HttpServletRequest;
-
 import junit.framework.TestCase;
 
-import org.apache.wicket.protocol.http.servlet.ServletWebRequest;
+import org.apache.wicket.mock.MockWebRequest;
 import org.apache.wicket.request.Url;
 import org.apache.wicket.request.UrlRenderer;
-import org.mockito.Mockito;
 
 /**
  * @author Matej Knopp
@@ -35,7 +32,7 @@ public class UrlRendererTest extends TestCase
 	 */
 	public void test1()
 	{
-		UrlRenderer r1 = new UrlRenderer(Url.parse("foo/bar/baz?a=b"), "");
+		UrlRenderer r1 = new UrlRenderer(new MockWebRequest(Url.parse("foo/bar/baz?a=b")));
 		assertEquals("./xyz?x=y", r1.renderUrl(Url.parse("foo/bar/xyz?x=y")));
 		assertEquals("./baz/xyz?x=y", r1.renderUrl(Url.parse("foo/bar/baz/xyz?x=y")));
 		assertEquals("../aaa/xyz?x=y", r1.renderUrl(Url.parse("foo/aaa/xyz?x=y")));
@@ -47,7 +44,7 @@ public class UrlRendererTest extends TestCase
 	 */
 	public void test2()
 	{
-		UrlRenderer r1 = new UrlRenderer(Url.parse("foo/bar/baz?a=b"), "");
+		UrlRenderer r1 = new UrlRenderer(new MockWebRequest(Url.parse("foo/bar/baz?a=b")));
 		assertEquals("../../foo?x=y", r1.renderUrl(Url.parse("foo?x=y")));
 		assertEquals("../../aaa?x=y", r1.renderUrl(Url.parse("aaa?x=y")));
 	}
@@ -57,7 +54,7 @@ public class UrlRendererTest extends TestCase
 	 */
 	public void test3()
 	{
-		UrlRenderer r1 = new UrlRenderer(Url.parse("?a=b"), "");
+		UrlRenderer r1 = new UrlRenderer(new MockWebRequest(Url.parse("?a=b")));
 		assertEquals("a/b/c?x=y", r1.renderUrl(Url.parse("a/b/c?x=y")));
 	}
 
@@ -66,7 +63,7 @@ public class UrlRendererTest extends TestCase
 	 */
 	public void test5()
 	{
-		UrlRenderer r1 = new UrlRenderer(Url.parse("url"), "");
+		UrlRenderer r1 = new UrlRenderer(new MockWebRequest(Url.parse("url")));
 		assertEquals("./url?1", r1.renderUrl(Url.parse("url?1")));
 	}
 
@@ -75,7 +72,7 @@ public class UrlRendererTest extends TestCase
 	 */
 	public void test6()
 	{
-		UrlRenderer r1 = new UrlRenderer(Url.parse("url/"), "");
+		UrlRenderer r1 = new UrlRenderer(new MockWebRequest(Url.parse("url/")));
 		assertEquals("./x?1", r1.renderUrl(Url.parse("url/x?1")));
 	}
 
@@ -84,8 +81,8 @@ public class UrlRendererTest extends TestCase
 	 */
 	public void test7()
 	{
-		UrlRenderer r1 = new UrlRenderer(
-			Url.parse("MyTestPage/indexed1/indexed2/indexed3?10-27.ILinkListener-l2&p1=v1"), "");
+		UrlRenderer r1 = new UrlRenderer(new MockWebRequest(
+			Url.parse("MyTestPage/indexed1/indexed2/indexed3?10-27.ILinkListener-l2&p1=v1")));
 		assertEquals("../../../MyTestPage?10", r1.renderUrl(Url.parse("MyTestPage?10")));
 	}
 
@@ -94,7 +91,8 @@ public class UrlRendererTest extends TestCase
 	 */
 	public void test8()
 	{
-		UrlRenderer r1 = new UrlRenderer(Url.parse("en/first-test-page?16-1.ILinkListener-l1"), "");
+		UrlRenderer r1 = new UrlRenderer(new MockWebRequest(
+			Url.parse("en/first-test-page?16-1.ILinkListener-l1")));
 		assertEquals("./first-test-page/indexed1/indexed2/indexed3?p1=v1",
 			r1.renderUrl(Url.parse("en/first-test-page/indexed1/indexed2/indexed3?p1=v1")));
 	}
@@ -104,7 +102,7 @@ public class UrlRendererTest extends TestCase
 	 */
 	public void test9()
 	{
-		UrlRenderer r1 = new UrlRenderer(Url.parse("a/b/q/d/e"), "");
+		UrlRenderer r1 = new UrlRenderer(new MockWebRequest(Url.parse("a/b/q/d/e")));
 		assertEquals("../../../q/c/d/e", r1.renderUrl(Url.parse("a/q/c/d/e")));
 	}
 
@@ -113,23 +111,18 @@ public class UrlRendererTest extends TestCase
 	 */
 	public void test10()
 	{
+		MockWebRequest request = new MockWebRequest(Url.parse("a/b/q/d/e"), "/contextPath",
+			"/filterPath", "../");
 
-		HttpServletRequest httpRequest = Mockito.mock(HttpServletRequest.class);
-		Mockito.when(httpRequest.getCharacterEncoding()).thenReturn("UTF-8");
-		Mockito.when(httpRequest.getContextPath()).thenReturn("/contextPath");
-		Mockito.when(httpRequest.getRequestURI()).thenReturn("/contextPath/filterPath/anything");
-
-		ServletWebRequest request = new ServletWebRequest(httpRequest, "filterPath/");
-		UrlRenderer r1 = new UrlRenderer(Url.parse("a/b/q/d/e"), request.getPrefixToContextPath());
-
-		assertEquals("../../../../../", r1.renderContextPathRelativeUrl(""));
-		assertEquals("../../../../../", r1.renderContextPathRelativeUrl("/"));
-		assertEquals("../../../../../f", r1.renderContextPathRelativeUrl("/f"));
-		assertEquals("../../../../../../f", r1.renderContextPathRelativeUrl("../f"));
+		UrlRenderer r = new UrlRenderer(request);
+		assertEquals("../../../../../", r.renderContextPathRelativeUrl(""));
+		assertEquals("../../../../../", r.renderContextPathRelativeUrl("/"));
+		assertEquals("../../../../../f", r.renderContextPathRelativeUrl("/f"));
+		assertEquals("../../../../../../f", r.renderContextPathRelativeUrl("../f"));
 
 		try
 		{
-			r1.renderContextPathRelativeUrl(null);
+			r.renderContextPathRelativeUrl(null);
 			fail("Null 'url' is not allowed!");
 		}
 		catch (IllegalArgumentException iax)
@@ -143,7 +136,7 @@ public class UrlRendererTest extends TestCase
 	 */
 	public void test11()
 	{
-		UrlRenderer r1 = new UrlRenderer(Url.parse("a"), "");
+		UrlRenderer r1 = new UrlRenderer(new MockWebRequest(Url.parse("a")));
 		assertEquals(".", r1.renderUrl(Url.parse("")));
 	}
 }
