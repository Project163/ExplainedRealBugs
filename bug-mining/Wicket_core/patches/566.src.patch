diff --git a/wicket-core/src/main/java/org/apache/wicket/util/tester/BaseWicketTester.java b/wicket-core/src/main/java/org/apache/wicket/util/tester/BaseWicketTester.java
index dfadad6a4c..dd0addd956 100644
--- a/wicket-core/src/main/java/org/apache/wicket/util/tester/BaseWicketTester.java
+++ b/wicket-core/src/main/java/org/apache/wicket/util/tester/BaseWicketTester.java
@@ -152,10 +152,6 @@ public class BaseWicketTester
 	/** log. */
 	private static final Logger log = LoggerFactory.getLogger(BaseWicketTester.class);
 
-	/** matches the last closing tag before </body> */
-	private static final Pattern pattern = Pattern.compile(".*(<\\/.*[^<\\/])<\\/body>.*",
-		Pattern.MULTILINE | Pattern.DOTALL);
-
 	private final ServletContext servletContext;
 	private MockHttpSession httpSession;
 
@@ -878,14 +874,11 @@ public class BaseWicketTester
 			return response;
 		}
 
-		// remove the markup for the auto-generated page. leave just component's markup body
-		String componentId = componentInPage.component.getId();
-		String before = "wicket:id=\"" + componentId + "\">";
-		Matcher matcher = pattern.matcher(response);
-		if (matcher.matches())
+		// remove the markup for the auto-generated page. leave just component's markup
+		int end = response.lastIndexOf("</body>");
+		if (end > -1)
 		{
-			int start = response.indexOf(before) + before.length();
-			int end = matcher.start(1);
+			int start = response.indexOf("<body>") + "<body>".length();
 			response = response.substring(start, end);
 		}
 
diff --git a/wicket-core/src/test/java/org/apache/wicket/markup/html/form/formComponentPanel/SimplePageTest.java b/wicket-core/src/test/java/org/apache/wicket/markup/html/form/formComponentPanel/SimplePageTest.java
index cda96da178..8b80868db5 100644
--- a/wicket-core/src/test/java/org/apache/wicket/markup/html/form/formComponentPanel/SimplePageTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/markup/html/form/formComponentPanel/SimplePageTest.java
@@ -38,7 +38,7 @@ public class SimplePageTest extends WicketTestCase
 		tester.startComponentInPage(MyFormComponentPanel.class);
 		String doc = tester.getLastResponseAsString();
 		// log.error(doc);
-		assertEquals("<wicket:panel>test</wicket:panel>", doc);
+		assertEquals("<span wicket:id=\"testObject\"><wicket:panel>test</wicket:panel></span>", doc);
 	}
 
 	/**
diff --git a/wicket-core/src/test/java/org/apache/wicket/util/tester/WicketTesterTest.java b/wicket-core/src/test/java/org/apache/wicket/util/tester/WicketTesterTest.java
index 8b922b861c..71a63e268b 100644
--- a/wicket-core/src/test/java/org/apache/wicket/util/tester/WicketTesterTest.java
+++ b/wicket-core/src/test/java/org/apache/wicket/util/tester/WicketTesterTest.java
@@ -37,13 +37,13 @@ import org.apache.wicket.ajax.AjaxRequestTarget;
 import org.apache.wicket.ajax.markup.html.AjaxLink;
 import org.apache.wicket.authorization.Action;
 import org.apache.wicket.authorization.IAuthorizationStrategy;
+import org.apache.wicket.markup.ComponentTag;
 import org.apache.wicket.markup.html.WebPage;
 import org.apache.wicket.markup.html.basic.Label;
 import org.apache.wicket.markup.html.form.Button;
 import org.apache.wicket.markup.html.form.FormComponent;
 import org.apache.wicket.markup.html.form.TextField;
 import org.apache.wicket.markup.html.link.Link;
-import org.apache.wicket.markup.html.link.PageWithLink;
 import org.apache.wicket.markup.html.link.ResourceLink;
 import org.apache.wicket.markup.html.pages.AccessDeniedPage;
 import org.apache.wicket.model.IModel;
@@ -59,7 +59,6 @@ import org.apache.wicket.request.mapper.parameter.PageParameters;
 import org.apache.wicket.request.resource.ByteArrayResource;
 import org.apache.wicket.request.resource.PackageResource.PackageResourceBlockedException;
 import org.apache.wicket.resource.DummyPage;
-import org.apache.wicket.util.crypt.CharEncoding;
 import org.apache.wicket.util.string.StringValue;
 import org.apache.wicket.util.tester.DummyHomePage.TestLink;
 import org.apache.wicket.util.tester.MockPageParameterPage.MockInnerClassPage;
@@ -1181,4 +1180,29 @@ public class WicketTesterTest extends WicketTestCase
 		assertEquals(tester.getContentTypeFromResponseHeader(), "text/plain");
 		assertEquals(content, tester.getLastResponseAsString());
 	}
+
+	/**
+	 * https://issues.apache.org/jira/browse/WICKET-4507
+	 *
+	 * When WicketTester#startComponentInPage() is used then #getLastResponseAsString()
+	 * should return only the component's markup, without the autogenerated markup for the page
+	 */
+	@Test
+	public void renderOnlyComponentsMarkup()
+	{
+		tester.startComponentInPage(new Label("label", "content")
+		{
+			private static final long serialVersionUID = 1L;
+
+			@Override
+			protected void onComponentTag(ComponentTag tag)
+			{
+				super.onComponentTag(tag);
+				tag.put("test", "123");
+			}
+		});
+
+		assertEquals("<span wicket:id=\"label\" test=\"123\">content</span>",
+			tester.getLastResponseAsString());
+	}
 }
