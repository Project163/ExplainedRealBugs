<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:21:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-4995] Using CryptoMapper causes page to render twice</title>
                <link>https://issues.apache.org/jira/browse/WICKET-4995</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;Using Wicket 1.5.9 and CryptoMapper causes our Wicket pages to be rendered twice. I was investigating a problem where a DAO query was executed two times when navigating to a single page.&lt;/p&gt;

&lt;p&gt;In debug call stack I found out that first render is made at  WebPageRenderer.respond(RequestCycle) line: 246	&lt;br/&gt;
and second at WebPageRenderer.respond(RequestCycle) line: 263	&lt;/p&gt;

&lt;p&gt;Removing CryptoMapper from our app configuration fixes the problem.&lt;/p&gt;

&lt;p&gt;It is also possible we are doing something wrong so any help is appreciated.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12628531">WICKET-4995</key>
            <summary>Using CryptoMapper causes page to render twice</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="svenmeier">Sven Meier</assignee>
                                    <reporter username="seco">Jukka Siivonen</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Jan 2013 10:44:50 +0000</created>
                <updated>Fri, 9 Aug 2013 11:14:18 +0000</updated>
                            <resolved>Thu, 28 Feb 2013 12:36:36 +0000</resolved>
                                                    <fixVersion>6.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13561833" author="svenmeier" created="Thu, 24 Jan 2013 18:35:56 +0000"  >&lt;p&gt;The culprit lies in WebPageRenderer#257:&lt;/p&gt;

&lt;p&gt;	if (targetUrl.getSegments().equals(targetUrl2.getSegments()) == false)&lt;/p&gt;
	{
		// the amount of segments is different - generated relative URLs will not work, we
		// need to rerender the page. This shouldn&apos;t happen, but in theory it can - with
		// RequestHandlerEncoders that produce different URLs with different amount of
		// segments for stateless and stateful pages
		response = renderPage(targetUrl2, requestCycle);
	}

&lt;p&gt;With CryptoMapper the page id is included in the segments, the following urls:&lt;/p&gt;

&lt;p&gt;wicket/bookmarkable/org.apache.wicket.examples.compref.LinkPage&lt;br/&gt;
wicket/bookmarkable/org.apache.wicket.examples.compref.LinkPage?0&lt;/p&gt;

&lt;p&gt;... produce different encrypted segments:&lt;/p&gt;

&lt;p&gt;/L7ExSNbPC4sb6TPJDblCAopL53TWmZP5y7BQEaJSJABliOBEOWyBWvlruzSupJSCrybkqQ-xa2Ib_nrhWXToPw/L7E59/JDb97/SJA39&lt;br/&gt;
/L7ExSNbPC4sb6TPJDblCAopL53TWmZP5y7BQEaJSJABliOBEOWyBWvlruzSupJSCrybkqQ-xa2J5M_AzHZAUgh-GKNtYnL4t/L7E59/TPJfd/YnLa6&lt;/p&gt;</comment>
                            <comment id="13561923" author="svenmeier" created="Thu, 24 Jan 2013 20:07:03 +0000"  >&lt;p&gt;Is there a reason why we render the page with the initial targetUrl first, just to initiate another render when targetUrl2 doesn&apos;t match after rendering?&lt;/p&gt;

&lt;p&gt;Why not create the page first and then render with the final url right away?&lt;/p&gt;

&lt;p&gt;diff --git a/wicket-core/src/main/java/org/apache/wicket/request/handler/render/WebPageRenderer.java b/wicket-core/src/main/java/org/apache/wicket/request/handler/render/WebPageRenderer.java&lt;br/&gt;
index 8c94d1f..7208f50 100644&lt;br/&gt;
&amp;#8212; a/wicket-core/src/main/java/org/apache/wicket/request/handler/render/WebPageRenderer.java&lt;br/&gt;
+++ b/wicket-core/src/main/java/org/apache/wicket/request/handler/render/WebPageRenderer.java&lt;br/&gt;
@@ -242,25 +242,17 @@&lt;br/&gt;
 						&quot;matched. Details: &quot; + details);&lt;br/&gt;
 			}&lt;/p&gt;

&lt;p&gt;+			// force creation of possible stateful page to get the final target url&lt;br/&gt;
+			getPage();&lt;br/&gt;
+&lt;br/&gt;
+			Url targetUrl2 = requestCycle.mapUrlFor(getRenderPageRequestHandler());&lt;br/&gt;
+&lt;br/&gt;
 			// redirect to buffer&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;BufferedWebResponse response = renderPage(targetUrl, requestCycle);&lt;br/&gt;
+			BufferedWebResponse response = renderPage(targetUrl2, requestCycle);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			if (response == null)&lt;/p&gt;
 			{
 				return;
-			}
&lt;p&gt;-&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;// check if the url hasn&apos;t changed after page has been rendered&lt;/li&gt;
	&lt;li&gt;// (i.e. the stateless flag might have changed which could result in different page url)&lt;/li&gt;
	&lt;li&gt;Url targetUrl2 = requestCycle.mapUrlFor(getRenderPageRequestHandler());&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;if (targetUrl.getSegments().equals(targetUrl2.getSegments()) == false)&lt;/li&gt;
	&lt;li&gt;{
-				// the amount of segments is different - generated relative URLs will not work, we
-				// need to rerender the page. This shouldn&apos;t happen, but in theory it can - with
-				// RequestHandlerEncoders that produce different URLs with different amount of
-				// segments for stateless and stateful pages
-				response = renderPage(targetUrl2, requestCycle);
 			}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 			if (currentUrl.equals(targetUrl2))&lt;/p&gt;


&lt;p&gt;This would solve the double-rendering for CryptoMapper, but I&apos;m not sure if this has any negative side effects.&lt;/p&gt;</comment>
                            <comment id="13584108" author="mgrigorov" created="Fri, 22 Feb 2013 09:12:17 +0000"  >&lt;p&gt;@Sven: please commit your suggestion so we can test it before 6.7.0 is released.&lt;/p&gt;</comment>
                            <comment id="13589484" author="mgrigorov" created="Thu, 28 Feb 2013 12:36:36 +0000"  >&lt;p&gt;The improvement is committed by Sven and so far there are no problems&lt;/p&gt;</comment>
                            <comment id="13734670" author="svenmeier" created="Fri, 9 Aug 2013 11:14:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-5309&quot; title=&quot;No page id appended to some stateful pages using repeaters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-5309&quot;&gt;&lt;del&gt;WICKET-5309&lt;/del&gt;&lt;/a&gt; showed that the url of a page can indeed change after being rendered, when stateful components are added to an otherwise stateless page during rendering (e.g. by repeaters).&lt;/p&gt;

&lt;p&gt;Since CryptoMapper changes a url&apos;s segments for stateful pages, the page will be re-rendered. To prevent this, call #setStatelessHint(false) on your page.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12662487">WICKET-5309</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>306615</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 15 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i19x07:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>265981</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>