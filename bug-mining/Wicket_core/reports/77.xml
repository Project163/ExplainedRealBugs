<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:17:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-3477] Exception when setting session default timezone with GatherExtendedBrowserInfo</title>
                <link>https://issues.apache.org/jira/browse/WICKET-3477</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;I want to set a default timezone for client sessions so I added the following line at the end of my CustomSession constructor:&lt;br/&gt;
getClientInfo().getProperties().setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));&lt;/p&gt;

&lt;p&gt;Doing this coupled with getGatherExtendedBrowserInfo() == true however yields a null pointer exception.&lt;/p&gt;

&lt;p&gt;Some analysis:&lt;br/&gt;
In WebSession#getClientInfo(), there is no clientInfo yet and getGatherExtendedBrowserInfo() is true so a redirect is attempted.&lt;br/&gt;
The line &quot;IRequestHandler activeRequestHandler = requestCycle.getActiveRequestHandler();&quot; produces activeRequestHandler == null.&lt;br/&gt;
Since there is no request handler, the following line &quot;String url = requestCycle.urlFor(activeRequestHandler).toString();&quot; gives a null pointer exception as urlFor returns null.&lt;/p&gt;

&lt;p&gt;If getGatherExtendedBrowserInfo() == false, the default timezone set in the Session constructor works fine.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12499538">WICKET-3477</key>
            <summary>Exception when setting session default timezone with GatherExtendedBrowserInfo</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="berniegp">Bertrand Guay-Paquet</reporter>
                        <labels>
                            <label>nullpointerexception</label>
                    </labels>
                <created>Wed, 23 Feb 2011 22:11:29 +0000</created>
                <updated>Mon, 11 Apr 2011 21:33:44 +0000</updated>
                            <resolved>Sun, 27 Feb 2011 09:58:22 +0000</resolved>
                                    <version>1.5-RC1</version>
                                    <fixVersion>1.4.17</fixVersion>
                    <fixVersion>1.5-RC3</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12998579" author="berniegp" created="Wed, 23 Feb 2011 22:12:21 +0000"  >&lt;p&gt;Quickstart project&lt;/p&gt;</comment>
                            <comment id="12998751" author="mgrigorov" created="Thu, 24 Feb 2011 08:34:27 +0000"  >&lt;p&gt;This indeed will not work.&lt;br/&gt;
There are two problems:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;there is no request handler yet at that time (thus the NPE)&lt;/li&gt;
	&lt;li&gt;I fixed this locally by using app.getHomePage&apos;s url as start point in this case and then the problem is that you call &quot;getClientInfo()&quot; from the Session constructor. Combined with &quot;setGatherExtendedBrowserInfo(true)&quot; this tries to use BrowserInfoPage to get the client info from the browser by doing temporary redirect to BrowserInfoPage and then this page needs the current session at one point and since the call has started from the session constructor this session is not yet completely constructed and the session is not set in the current ThreadContext (ThreadLocal) and a new call to Application.newSession() is made and all starts from the beginning.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The working and simple (IMO) solution is:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;remove getRequestCycleSettings().setGatherExtendedBrowserInfo(true); from MyApp.ini()&lt;/li&gt;
	&lt;li&gt;in CustomSession&apos;s constructor do:&lt;br/&gt;
WebClientInfo ci = new WebClientInfo(RequestCycle.get());&lt;br/&gt;
ci.getProperties().setTimeZone(TimeZone.getTimeZone(&quot;GMT&quot;));&lt;br/&gt;
setClientInfo(ci);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This way it wont make temp redirect (flash) to the BrowserInfoPage.&lt;/p&gt;

&lt;p&gt;If you need more client info props then you&apos;ll have to use your code but move it to the constructor of a base page, where a Session exists and all this will work.&lt;/p&gt;</comment>
                            <comment id="12998861" author="berniegp" created="Thu, 24 Feb 2011 14:26:41 +0000"  >&lt;p&gt;Thank you Martin for the excellent explanation.&lt;/p&gt;

&lt;p&gt;I did not know setClientInfo() existed which allowed me to create the WebClientInfo instance myself.&lt;/p&gt;

&lt;p&gt;Should I put that as &quot;resolved&quot; then?&lt;/p&gt;

&lt;p&gt;(for the record, the only information I could find for setting default ClientInfo values was : &lt;a href=&quot;http://apache-wicket.1842946.n4.nabble.com/Using-ClientProperties-Object-for-User-selectable-Timezone-td1846293.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://apache-wicket.1842946.n4.nabble.com/Using-ClientProperties-Object-for-User-selectable-Timezone-td1846293.html&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="12999916" author="mgrigorov" created="Sun, 27 Feb 2011 09:58:22 +0000"  >&lt;p&gt;With r1075014 (1.4.x) and r1075014 (1.5.x) a javadoc is added explaining that getClientInfo() should not be called in Session constructor.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12471778" name="DefaultTimeZone.zip" size="21410" author="berniegp" created="Wed, 23 Feb 2011 22:12:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204261</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 38 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0kav3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116577</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>