<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:18:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-3910] o.a.w.pageStore.AsynchronousDataStore#getData() returns null if the StoreEntryRunnable is currently running</title>
                <link>https://issues.apache.org/jira/browse/WICKET-3910</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;I am running &quot;mvn clean package&quot; on the command line and based on the jdk I get different results (reproducable).&lt;/p&gt;

&lt;p&gt;With jdk6 the test fails and the following is logged:&lt;br/&gt;
ERROR - DiskDataStoreTest          - data[] should never be null&lt;br/&gt;
ERROR - DiskDataStoreTest          - Detected error number: 1&lt;br/&gt;
ERROR - DiskDataStoreTest          - data[] should never be null&lt;br/&gt;
ERROR - DiskDataStoreTest          - Detected error number: 2&lt;br/&gt;
Exception in thread &quot;Thread-22&quot; java.lang.NullPointerException&lt;br/&gt;
	at org.apache.wicket.page.persistent.disk.DiskDataStoreTest$Read1Runnable.run(DiskDataStoreTest.java:231)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
Exception in thread &quot;Thread-42&quot; java.lang.NullPointerException&lt;br/&gt;
	at org.apache.wicket.page.persistent.disk.DiskDataStoreTest$Read2Runnable.run(DiskDataStoreTest.java:264)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;

&lt;p&gt;With jdk5 everything goes fine and above message is not logged.&lt;/p&gt;

&lt;p&gt;The datastore in the test is returning null in the Read1Runnable and Read2Runnable which is causing the NPE.&lt;/p&gt;</description>
                <environment>Hostspot 1.6.0_26, 1.5.0_22</environment>
        <key id="12514320">WICKET-3910</key>
            <summary>o.a.w.pageStore.AsynchronousDataStore#getData() returns null if the StoreEntryRunnable is currently running</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="akiraly">Attila Kir&#225;ly</reporter>
                        <labels>
                    </labels>
                <created>Sat, 16 Jul 2011 12:29:15 +0000</created>
                <updated>Wed, 20 Jul 2011 11:15:58 +0000</updated>
                            <resolved>Tue, 19 Jul 2011 08:31:24 +0000</resolved>
                                    <version>1.5-RC5.1</version>
                                    <fixVersion>1.5-RC6</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13067095" author="mgrigorov" created="Mon, 18 Jul 2011 15:47:42 +0000"  >&lt;p&gt;The test fails at Apache Jenkins as well but I can&apos;t make it fail locally ...&lt;br/&gt;
I tried with Maven 2/3, JDK 1.5/6, en_US/bg_BG locales.&lt;/p&gt;</comment>
                            <comment id="13067255" author="akiraly" created="Mon, 18 Jul 2011 19:58:11 +0000"  >&lt;p&gt;Attaching a patch that modifies the test to fail more consistently (start reading threads before the saving ones).&lt;/p&gt;

&lt;p&gt;Also note that junit can not handle well some aspects of multi thread tests: in this case an exception thrown in a runnable does not cause the junit test to fail. So I modified that too to store exception thrown in runnables and fail test in main test thread.&lt;/p&gt;</comment>
                            <comment id="13067259" author="akiraly" created="Mon, 18 Jul 2011 20:00:54 +0000"  >&lt;p&gt;Attaching a fix.&lt;/p&gt;

&lt;p&gt;This is a timing issue in the AsynchronousDataStore (and I only had the luck that the two different jdk produced different timing in my env).&lt;/p&gt;

&lt;p&gt;It seems that if the following happens the error is raised:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;SaveRunnable passes file to datastore (dataStore.storeData...)&lt;/li&gt;
	&lt;li&gt;SaveRunnable puts file on the read1 queue (filesToRead1.add...)&lt;/li&gt;
	&lt;li&gt;Read1Runnable reads the file from its queue&lt;/li&gt;
	&lt;li&gt;Read1Runnable tries to get the data for the file from the dataSource but gets null, because the asynch thread for saving the data in the datastore is currently running so it is not on the asynch work queue anymore and the data is still not in the underlying datastore either.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So the fix adds a Set to Asynch data store to track all waiting, running runnables in one place.&lt;/p&gt;</comment>
                            <comment id="13067577" author="mgrigorov" created="Tue, 19 Jul 2011 08:28:22 +0000"  >&lt;p&gt;With this fix AsynchronousDataStore looks like its previous impl.&lt;br/&gt;
The previous impl was stable and it works even with your improvement in the test, so I&apos;ll revert to the previous impl.&lt;/p&gt;</comment>
                            <comment id="13067579" author="mgrigorov" created="Tue, 19 Jul 2011 08:31:24 +0000"  >&lt;p&gt;With r1148226 I reverted to the previous impl of AsynchronousDataStore.&lt;/p&gt;</comment>
                            <comment id="13068282" author="bitstorm" created="Wed, 20 Jul 2011 11:13:04 +0000"  >&lt;p&gt;Should we reopen &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-3876&quot; title=&quot;Improve synchronization in AsynchronousDataStore buffer structure&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-3876&quot;&gt;&lt;del&gt;WICKET-3876&lt;/del&gt;&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="13068283" author="mgrigorov" created="Wed, 20 Jul 2011 11:15:58 +0000"  >&lt;p&gt;There are no known problems at the moment. The problem in the 3876 has been fixed before introducing your impl.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12486915" name="fix-WICKET-3910.patch" size="5357" author="akiraly" created="Mon, 18 Jul 2011 20:00:54 +0000"/>
                            <attachment id="12486913" name="modify-test-WICKET-3910.patch" size="2798" author="akiraly" created="Mon, 18 Jul 2011 19:58:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>67405</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 18 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0k9qv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116396</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>