<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:18:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-3921] No HTTP response cache headers are set in Wicket Ajax redirects</title>
                <link>https://issues.apache.org/jira/browse/WICKET-3921</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;Usually HTTP response cache headers are being set in AjaxRequestTarget for Ajax responses. But for redirects, the handling is done in WebResponse where no cache headers are being set, which could lead to some trouble.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12514618">WICKET-3921</key>
            <summary>No HTTP response cache headers are set in Wicket Ajax redirects</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="timoweber">Timo Weber</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Jul 2011 18:35:20 +0000</created>
                <updated>Thu, 28 Jul 2011 08:19:10 +0000</updated>
                            <resolved>Thu, 28 Jul 2011 08:19:10 +0000</resolved>
                                    <version>1.4.17</version>
                                    <fixVersion>1.4.18</fixVersion>
                    <fixVersion>1.5-RC6</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13068854" author="mgrigorov" created="Thu, 21 Jul 2011 08:24:05 +0000"  >&lt;p&gt;Can you provide quickstart application that shows the problem ?&lt;/p&gt;</comment>
                            <comment id="13068871" author="timoweber" created="Thu, 21 Jul 2011 09:00:11 +0000"  >&lt;p&gt;It&apos;s probably easier for me to give you an entry point.&lt;/p&gt;

&lt;p&gt;Method respond(:RequestCycle) in AjaxRequestTarget does part of the response handling. If the page itself hasn&apos;t been added to the request target, everything&apos;s fine. The cache headers will be set to make sure that the response won&apos;t be cached by the browser (line 570-572 in AjaxRequestTarget). &lt;/p&gt;

&lt;p&gt;But if the page has been added, the handling is done by WebResponse.redirect(String url). This ajax redirect isn&apos;t performed as an HTTP redirect (some 30x code) but with the code 200 and the content &quot;&amp;lt;ajax-response&amp;gt;&amp;lt;redirect&amp;gt;&amp;lt;![CDATA&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot; + url + &amp;quot;&amp;#93;&lt;/span&gt;]&amp;gt;&amp;lt;/redirect&amp;gt;&amp;lt;/ajax-response&amp;gt;&quot; that is being interpreted by wicket-ajax in the browser. This response doesn&apos;t get any cache headers. Because of that it may be cached by the browser. As the payload contains a stateful url, this constellation could very likely be troublesome in some situations leading to obscure errors.&lt;/p&gt;

&lt;p&gt;I&apos;d suggest that - if you also think, that it is a bug - you set these cache headers in a more central place for all ajax responses, WebRequestCycle.onEndRequest() would be a possible solution. That&apos;s where we put our workaround for now. &lt;/p&gt;

&lt;p&gt;Regards, Timo&lt;/p&gt;</comment>
                            <comment id="13071662" author="mgrigorov" created="Wed, 27 Jul 2011 11:37:02 +0000"  >&lt;p&gt;Hi Timo,&lt;/p&gt;

&lt;p&gt;Does that mean that if we move the setting of cache related headers before the redirect in AjaxRequestTarget#respond(RequestCycle) the problem will be solved ?&lt;br/&gt;
That&apos;s why I need failing case to verify that the fix works.&lt;/p&gt;</comment>
                            <comment id="13071670" author="mgrigorov" created="Wed, 27 Jul 2011 11:55:00 +0000"  >&lt;p&gt;Index: wicket/src/main/java/org/apache/wicket/protocol/http/WebResponse.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; wicket/src/main/java/org/apache/wicket/protocol/http/WebResponse.java	(revision 1146974)&lt;br/&gt;
+++ wicket/src/main/java/org/apache/wicket/protocol/http/WebResponse.java	(working copy)&lt;br/&gt;
@@ -312,6 +312,9 @@&lt;br/&gt;
 		// Set content type based on markup type for page&lt;br/&gt;
 		setCharacterEncoding(encoding);&lt;br/&gt;
 		setContentType(&quot;text/xml; charset=&quot; + encoding);&lt;br/&gt;
+		setHeader(&quot;Expires&quot;, &quot;Mon, 26 Jul 1997 05:00:00 GMT&quot;);&lt;br/&gt;
+		setHeader(&quot;Cache-Control&quot;, &quot;no-cache, must-revalidate&quot;);&lt;br/&gt;
+		setHeader(&quot;Pragma&quot;, &quot;no-cache&quot;);&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;Here is the possible fix.&lt;br/&gt;
WebResponse#redirect() is called not only when AjaxRequestTarget.addComponent(Page) is used but also when setResponsePage() is used in Ajax request.&lt;/p&gt;

&lt;p&gt;The fix is similar for 1.5.&lt;/p&gt;</comment>
                            <comment id="13071699" author="timoweber" created="Wed, 27 Jul 2011 12:54:21 +0000"  >&lt;p&gt;Hi Martin,&lt;/p&gt;

&lt;p&gt;yes, thanks. This looks good to me and will solve the problem for sure. I&apos;ve appended a very simple repo case below. It&apos;s a bit tricky to catch the redirect response in Firebug, if I can be of any further help, please let me know.  &lt;/p&gt;


&lt;p&gt;public class AjaxResponseHeadersPage extends WebPage {&lt;/p&gt;

&lt;p&gt;    public AjaxResponseHeadersPage() {&lt;br/&gt;
        setOutputMarkupId(true);&lt;/p&gt;

&lt;p&gt;        add(new AjaxFallbackLink(&quot;link1&quot;) {&lt;br/&gt;
            @Override&lt;br/&gt;
            public void onClick(AjaxRequestTarget target) &lt;/p&gt;
{
                // adding the page to the target will produce a wicket ajax redirect
                // without any cache headers
                target.addComponent(getPage());
            }
&lt;p&gt;        });&lt;/p&gt;

&lt;p&gt;        add(new AjaxFallbackLink(&quot;link2&quot;) {&lt;br/&gt;
            @Override&lt;br/&gt;
            public void onClick(AjaxRequestTarget target) &lt;/p&gt;
{
                // this produces an ajax response with cache headers set properly
                target.addComponent(this);
            }
&lt;p&gt;        }.setOutputMarkupId(true));&lt;br/&gt;
    }&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;br/&gt;
&amp;lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot; xmlns:wicket=&quot;http://wicket.apache.org/dtds.data/wicket-xhtml1.4-strict.dtd&quot;&amp;gt;&lt;br/&gt;
&amp;lt;body&amp;gt;&lt;br/&gt;
    &amp;lt;a wicket:id=&quot;link1&quot; href=&quot;#&quot;&amp;gt;Ajax response (Redirect) without any cache headers.&amp;lt;/a&amp;gt;&lt;br/&gt;
    &amp;lt;a wicket:id=&quot;link2&quot; href=&quot;#&quot;&amp;gt;Ajax response with proper cache headers.&amp;lt;/a&amp;gt;&lt;br/&gt;
&amp;lt;/body&amp;gt;&lt;br/&gt;
&amp;lt;/html&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13072248" author="mgrigorov" created="Thu, 28 Jul 2011 08:19:10 +0000"  >&lt;p&gt;Fixed!&lt;br/&gt;
Thanks Timo!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>66743</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 17 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0k9p3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116388</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>