<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:26:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-7028] CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT</title>
                <link>https://issues.apache.org/jira/browse/WICKET-7028</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;We&apos;re busy with a project to replace every page in our application with a newer version. We don&apos;t want to break existing bookmarks, but we also don&apos;t want to have untested new pages in production.&#160; As a solution, all our new pages are only accessible via a feature toggle.&lt;/p&gt;

&lt;p&gt;A simplified version looks like:&lt;/p&gt;

&lt;p&gt;SimplePage.html&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;!DOCTYPE html&amp;gt;
&amp;lt;html xmlns:wicket=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//wicket.apache.org&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;&amp;lt;head&amp;gt;
&amp;lt;meta http-equiv=&lt;span class=&quot;code-quote&quot;&gt;&quot;Content-Type&quot;&lt;/span&gt; content=&lt;span class=&quot;code-quote&quot;&gt;&quot;text/html; charset=UTF-8&quot;&lt;/span&gt;/&amp;gt;
&amp;lt;title&amp;gt;&amp;lt;/title&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body&amp;gt;
    &amp;lt;div wicket:id=&lt;span class=&quot;code-quote&quot;&gt;&quot;label&quot;&lt;/span&gt;&amp;gt;&amp;lt;/div&amp;gt;
&amp;lt;/body&amp;gt;
&amp;lt;/html&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&#160;SimplePage.java&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;SimplePage &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; WebPage {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; SimplePage() {
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;();
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
OldPage.java&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;OldPage &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; SimplePage {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; OldPage() {

    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void onInitialize() {
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.onInitialize();
        add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Label(&lt;span class=&quot;code-quote&quot;&gt;&quot;label&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;OldPage&quot;&lt;/span&gt;));
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
NewPage.java&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;NewPage &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; SimplePage {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; NewPage() {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (featureFlagDisabled()) {
            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; page is not ready yet, show users the old page
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RestartResponseException(
                    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PageProvider(OldPage.class),
                    RedirectPolicy.NEVER_REDIRECT
                    );
        }
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; featureFlagDisabled() {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void onInitialize() {
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.onInitialize();
        add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Label(&lt;span class=&quot;code-quote&quot;&gt;&quot;label&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;NewPage&quot;&lt;/span&gt;));
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;br/&gt;
And in our application class:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        mountPage(&lt;span class=&quot;code-quote&quot;&gt;&quot;page1&quot;&lt;/span&gt;, NewPage.class);
        mountPage(&lt;span class=&quot;code-quote&quot;&gt;&quot;page2&quot;&lt;/span&gt;, OldPage.class);
            getCspSettings()
                .blocking();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The url &apos;page1&apos; is known to our users. The url &apos;page2&apos; is not known to our users. Besides ending up with outdated bookmarks, there&apos;s no harm if they would access it directly.&lt;/p&gt;

&lt;p&gt;Regardless of which url you open, the RestartResponseException ensures the reponse in the browser is always &apos;OldPage&apos;.&lt;/p&gt;

&lt;p&gt;However, the CSP is not included if wicket performs the internal redirect. If I open the url &apos;page2&apos; directly, the result does include a CSP. See attached screenshots.&lt;/p&gt;

&lt;p&gt;A workaround for this issue is a client side redirect; but then the users would see the url change.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13524969">WICKET-7028</key>
            <summary>CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="reiern70">Ernesto Reinaldo Barreiro</assignee>
                                    <reporter username="Youri219">Youri de Boer</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Feb 2023 07:44:10 +0000</created>
                <updated>Thu, 25 Apr 2024 16:39:20 +0000</updated>
                            <resolved>Thu, 6 Apr 2023 07:45:22 +0000</resolved>
                                    <version>9.12.0</version>
                                    <fixVersion>10.0.0-M1</fixVersion>
                    <fixVersion>9.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17689903" author="svenmeier" created="Thu, 16 Feb 2023 18:23:34 +0000"  >&lt;p&gt;Could you please the two pages into a quickstart, so I can debug the problem?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17691100" author="JIRAUSER287238" created="Mon, 20 Feb 2023 09:31:18 +0000"  >&lt;p&gt;I&apos;ve added a zip with the above code snippets to a quickstart application.&lt;/p&gt;

&lt;p&gt;The url&apos;s are:&lt;br/&gt;
&lt;a href=&quot;http://localhost:8080/page1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/page1&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://localhost:8080/page2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/page2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17691822" author="svenmeier" created="Tue, 21 Feb 2023 23:13:54 +0000"  >&lt;p&gt;Problem is, that CSPRequestCycleListener sets the CSP headers as soon as a request handler is resolved.&lt;/p&gt;

&lt;p&gt;But RestartResponseException sets a new ResponseResettingDecorator as handler, which triggers onRequestHandlerResolved() again and thus settings the CSP headers a second time.&lt;br/&gt;
But then ResponseResettingDecorator resets the response, before handing over to the actual handler. The CSP headers are lost at that point.&lt;/p&gt;

&lt;p&gt;I think we will have to move setting of the CSP headers to a later moment, e.g. to onEndRequest(). I will try that and report back.&lt;/p&gt;</comment>
                            <comment id="17701609" author="JIRAUSER287238" created="Fri, 17 Mar 2023 09:46:08 +0000"  >&lt;p&gt;I just noticed 2 &apos;Cross-Origin&apos; headers also went missing.&lt;/p&gt;</comment>
                            <comment id="17708393" author="bitstorm" created="Tue, 4 Apr 2023 12:01:43 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;any news on this issue?&lt;/p&gt;</comment>
                            <comment id="17708468" author="svenmeier" created="Tue, 4 Apr 2023 15:29:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bitstorm&quot; class=&quot;user-hover&quot; rel=&quot;bitstorm&quot;&gt;bitstorm&lt;/a&gt; I&apos;ve tried to find a solution for this, but wasn&apos;t successful:&lt;/p&gt;

&lt;p&gt;As I have written above, settings the CSP headers in #onRequestHandlerResolved is too early, since a ResponseResettingDecorator clears the headers.&lt;/p&gt;

&lt;p&gt;I&apos;ve tried out settings the CSP headers in #onEndRequest, but this is too late in cases where the response is rendered into a buffer which is then redirected too.&lt;/p&gt;

&lt;p&gt;Maybe I missed something, but I didn&apos;t find any good request cycle hook to hook into. Maybe we need another hook for this (#pageisRendered?), but it&apos;s strange to me that we didn&apos;t have a need for that before.&lt;/p&gt;

&lt;p&gt;Regretfully I don&apos;t have time at the moment to continue my investigations on this.&lt;/p&gt;</comment>
                            <comment id="17708700" author="JIRAUSER287238" created="Wed, 5 Apr 2023 06:41:19 +0000"  >&lt;p&gt;We did find a workaround. It&apos;s not the cleanest solution, but it will have to do until you come up with a real solution.&lt;br/&gt;
We copied both ResetResponseException and RestartResponseException to our own codebase (with a new class/package name), then replaced the ResponseResettingDecorator.respond method with the following code:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&#160; &#160; &#160; &#160; @Override&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; public void respond(final IRequestCycle requestCycle)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; {&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; Response response = requestCycle.getResponse();&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; response.reset();&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; if (response instanceof WebResponse) {&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; WebResponse webResponse = (WebResponse) response;&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; ContentSecurityPolicySettings cspSettings = WebApplication.get().getCspSettings();&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; cspSettings.getConfiguration()&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .entrySet()&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .stream()&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .filter(entry -&amp;gt; entry.getValue().isSet())&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; .forEach(entry -&amp;gt; {&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; CSPHeaderMode mode = entry.getKey();&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; CSPHeaderConfiguration config = entry.getValue();&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; String headerValue = config.renderHeaderValue(cspSettings, (RequestCycle) requestCycle);&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; webResponse.setHeader(mode.getHeader(), headerValue);&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; if (config.isAddLegacyHeaders()) {&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; webResponse.setHeader(mode.getLegacyHeader(), headerValue);&lt;/tt&gt;&lt;br/&gt;
}&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; });&lt;/tt&gt;&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; webResponse.setHeader(&quot;Cross-Origin-Embedder-Policy-Report-Only&quot;, &quot;require-corp&quot;);&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; webResponse.setHeader(&quot;Cross-Origin-Opener-Policy&quot;, &quot;same-origin&quot;);&lt;/tt&gt;&lt;br/&gt;
}&lt;br/&gt;
&lt;tt&gt;&#160; &#160; &#160; &#160; &#160; &#160; delegate.respond(requestCycle);&lt;/tt&gt;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Whenever we want to preserve&#160; the URL, we use this code. In case we want a normal client side redirect (http 302) we use the original exceptions.&lt;/p&gt;</comment>
                            <comment id="17708709" author="reiern70" created="Wed, 5 Apr 2023 07:00:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Youri219&quot; class=&quot;user-hover&quot; rel=&quot;Youri219&quot;&gt;Youri219&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thansk for the update.&lt;/p&gt;</comment>
                            <comment id="17708740" author="reiern70" created="Wed, 5 Apr 2023 08:02:37 +0000"  >&lt;p&gt;With change bellow wicket 9.x still builds properly and headers are still preserved&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13057051/13057051_image-2023-04-05-10-58-33-645.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The reset of the request seem to be there since the begining of times. Does anyone knows why is this needed or if we will break applications by removing it?&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17708751" author="jira-bot" created="Wed, 5 Apr 2023 08:35:37 +0000"  >&lt;p&gt;Commit f5e01f33c24ae68fcf457e152e3fdf51cdd39fff in wicket&apos;s branch refs/heads/reiern70/&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt; from reiern70&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=f5e01f33c2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=f5e01f33c2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt; move generation of CSP related header(s) to onRequestHandlerExecuted&lt;/p&gt;</comment>
                            <comment id="17708752" author="githubbot" created="Wed, 5 Apr 2023 08:36:23 +0000"  >&lt;p&gt;reiern70 opened a new pull request, #568:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/568&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   move generation of CSP related header(s) to onRequestHandlerExecuted&lt;/p&gt;

</comment>
                            <comment id="17708754" author="reiern70" created="Wed, 5 Apr 2023 08:38:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;PR &lt;a href=&quot;https://github.com/apache/wicket/pull/568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/568&lt;/a&gt; seems to work but I don&apos;t know how to add you as reviewer in GH. Thanks for your analysis of issue!&lt;/p&gt;</comment>
                            <comment id="17708757" author="reiern70" created="Wed, 5 Apr 2023 08:54:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Youri219&quot; class=&quot;user-hover&quot; rel=&quot;Youri219&quot;&gt;Youri219&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;It would be nice if you could test your application againts branch&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;reiern70/&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;and report back if that change fixes your issue (without your work-around). Thanks is advance&lt;/p&gt;</comment>
                            <comment id="17708760" author="githubbot" created="Wed, 5 Apr 2023 09:06:22 +0000"  >&lt;p&gt;solomax commented on PR #568:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/568#issuecomment-1497161522&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/568#issuecomment-1497161522&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   @svenmeier maybe you can take a look? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/p&gt;

</comment>
                            <comment id="17708779" author="githubbot" created="Wed, 5 Apr 2023 09:37:49 +0000"  >&lt;p&gt;reiern70 merged PR #568:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/568&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/568&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17708780" author="jira-bot" created="Wed, 5 Apr 2023 09:37:49 +0000"  >&lt;p&gt;Commit f5e01f33c24ae68fcf457e152e3fdf51cdd39fff in wicket&apos;s branch refs/heads/wicket-9.x from reiern70&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=f5e01f33c2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=f5e01f33c2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt; move generation of CSP related header(s) to onRequestHandlerExecuted&lt;/p&gt;</comment>
                            <comment id="17708781" author="jira-bot" created="Wed, 5 Apr 2023 09:42:56 +0000"  >&lt;p&gt;Commit 111bf43ee78d98597cc7a34a3464b25e0171d43d in wicket&apos;s branch refs/heads/master from reiern70&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=111bf43ee7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=111bf43ee7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt; move generation of CSP related header(s) to onRequestHandlerExecuted&lt;/p&gt;</comment>
                            <comment id="17708783" author="svenmeier" created="Wed, 5 Apr 2023 09:43:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reiern70&quot; class=&quot;user-hover&quot; rel=&quot;reiern70&quot;&gt;reiern70&lt;/a&gt; I&apos;m afraid your change breaks the case I mentioned above, i.e. when the page response is rendered into a buffer and #onRequestHandlerExecuted() comes too late to add the headers to the buffered response.&lt;/p&gt;</comment>
                            <comment id="17708794" author="reiern70" created="Wed, 5 Apr 2023 10:13:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Hum... I tested the mini application and I had the impression headers were delivered to OldPage too...&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13057055/13057055_image-2023-04-05-13-13-46-451.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17708795" author="reiern70" created="Wed, 5 Apr 2023 10:14:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt; Could you pelase double check?&lt;/p&gt;</comment>
                            <comment id="17708797" author="reiern70" created="Wed, 5 Apr 2023 10:21:07 +0000"  >&lt;p&gt;Changed example to:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13057056/13057056_image-2023-04-05-13-19-40-207.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;and&#160; headers are still added&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13057057/13057057_image-2023-04-05-13-21-01-849.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17708812" author="svenmeier" created="Wed, 5 Apr 2023 11:02:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reiern70&quot; class=&quot;user-hover&quot; rel=&quot;reiern70&quot;&gt;reiern70&lt;/a&gt; You have to make NewPage stateful (e.g. add an AjaxLink to it).&lt;/p&gt;

&lt;p&gt;Then you&apos;ll get the redirect to a buffered response, where the CSP header is missing.&lt;/p&gt;</comment>
                            <comment id="17708823" author="reiern70" created="Wed, 5 Apr 2023 11:36:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Oh. Yes you are right:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13057058/13057058_image-2023-04-05-14-35-49-714.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17708832" author="jira-bot" created="Wed, 5 Apr 2023 11:48:21 +0000"  >&lt;p&gt;Commit 766dbb8bac50936bbde212798e4d84b2721772f7 in wicket&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt;-take-II from reiern70&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=766dbb8bac&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=766dbb8bac&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt; do CSP related header generation both at onRequestHandlerResolved and onRequestHandlerExecuted&lt;/p&gt;</comment>
                            <comment id="17708833" author="githubbot" created="Wed, 5 Apr 2023 11:49:11 +0000"  >&lt;p&gt;reiern70 opened a new pull request, #569:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/569&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   do CSP related header generation both at onRequestHandlerResolved and onRequestHandlerExecuted&lt;/p&gt;

</comment>
                            <comment id="17708834" author="githubbot" created="Wed, 5 Apr 2023 11:50:33 +0000"  >&lt;p&gt;reiern70 commented on PR #569:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/569#issuecomment-1497355736&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/569#issuecomment-1497355736&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   @svenmeier ?&lt;/p&gt;

</comment>
                            <comment id="17708836" author="JIRAUSER287238" created="Wed, 5 Apr 2023 12:01:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reiern70&quot; class=&quot;user-hover&quot; rel=&quot;reiern70&quot;&gt;reiern70&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I just tested the branch with the quickstart example. I also added an AjaxLink and have to agree with Sven. The proposed solution only seems to work with stateless pages. This is rarely the case in real wicket applications.&lt;/p&gt;

&lt;p&gt;It also doesn&apos;t fix the 2 Cross-Origin headers, which I believe are added in CrossOriginEmbedderPolicyRequestCycleListener and CrossOriginOpenerPolicyRequestCycleListener. Even if you do the same change there you still have the same issue with stateful pages.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17708838" author="reiern70" created="Wed, 5 Apr 2023 12:04:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Youri219&quot; class=&quot;user-hover&quot; rel=&quot;Youri219&quot;&gt;Youri219&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Did you tested with&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/wicket/pull/569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/569&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;?&lt;/p&gt;</comment>
                            <comment id="17708840" author="JIRAUSER287238" created="Wed, 5 Apr 2023 12:07:09 +0000"  >&lt;p&gt;The branch you proposed earlier, I think you merged it already. Will try again with the new changes.&lt;/p&gt;</comment>
                            <comment id="17708857" author="githubbot" created="Wed, 5 Apr 2023 12:33:42 +0000"  >&lt;p&gt;svenmeier commented on PR #569:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/569#issuecomment-1497413462&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/569#issuecomment-1497413462&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   Can&apos;t check ATM, but don&apos;t we have to check for duplicated headers then?&lt;/p&gt;

&lt;p&gt;   I wonder whether we should go with a completely different solution:&lt;br/&gt;
   Aren&apos;t the headers specific to the page? We could add a behavior to the page (via Component instantiation/Initialization listener) and thus always add the header when the page is rendered.&lt;/p&gt;

</comment>
                            <comment id="17708861" author="githubbot" created="Wed, 5 Apr 2023 12:38:55 +0000"  >&lt;p&gt;reiern70 commented on PR #569:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/569#issuecomment-1497419624&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/569#issuecomment-1497419624&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   &amp;gt; Can&apos;t check ATM, but don&apos;t we have to check for duplicated headers then?&lt;br/&gt;
   &amp;gt; &lt;br/&gt;
   Maybe yes... but they do not seem to be duplicated. I do agree thsi solution &quot;sucks&quot;&lt;/p&gt;

&lt;p&gt;   &amp;gt; I wonder whether we should go with a completely different solution: Aren&apos;t the headers specific to the page? We could add a behavior to the page (via Component instantiation/Initialization listener) and thus always add the header when the page is rendered.&lt;/p&gt;

&lt;p&gt;   Do you mean...&lt;/p&gt;

&lt;p&gt;   1. The setting register a compoent instantiation listener &lt;br/&gt;
   2. The listener adds a behavior to teh page that adds these headers?&lt;/p&gt;

&lt;p&gt;   This idea could work and it maybe be cleaner that what we have now. Mind that teh same problem we have for CrossOriginEmbedderPolicyRequestCycleListener&lt;/p&gt;






</comment>
                            <comment id="17708872" author="githubbot" created="Wed, 5 Apr 2023 12:55:17 +0000"  >&lt;p&gt;reiern70 commented on PR #569:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/569#issuecomment-1497439735&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/569#issuecomment-1497439735&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   &amp;gt; Can&apos;t check ATM, but don&apos;t we have to check for duplicated headers then?&lt;br/&gt;
   &amp;gt; &lt;br/&gt;
   &amp;gt; I wonder whether we should go with a completely different solution: Aren&apos;t the headers specific to the page? We could add a behavior to the page (via Component instantiation/Initialization listener) and thus always add the header when the page is rendered.&lt;/p&gt;

&lt;p&gt;   !&lt;span class=&quot;error&quot;&gt;&amp;#91;image&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://user-images.githubusercontent.com/462655/230086539-72b86e09-64ec-436a-9465-1d9542f72611.png&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://user-images.githubusercontent.com/462655/230086539-72b86e09-64ec-436a-9465-1d9542f72611.png&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;   There is no need to check for duplication it seems.&lt;/p&gt;

</comment>
                            <comment id="17708876" author="JIRAUSER287238" created="Wed, 5 Apr 2023 12:57:48 +0000"  >&lt;p&gt;PR 569 seems to work a lot better for stateful pages, but it only fixes the problem for the CSPRequestCycleListener. I identified 2 other headers in my previous comment which could be fixed in a similar way, but then the question arises, which one is next?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17708877" author="jira-bot" created="Wed, 5 Apr 2023 12:58:43 +0000"  >&lt;p&gt;Commit 5cc8ee7138000a1327d91a2ee9ef90bbf7f2fa99 in wicket&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt;-take-II from reiern70&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=5cc8ee7138&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=5cc8ee7138&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt; do CSP related header generation both at onRequestHandlerResolved and onRequestHandlerExecuted. The same is applied for CrossOriginEmbedderPolicyRequestCycleListener&lt;/p&gt;</comment>
                            <comment id="17708880" author="reiern70" created="Wed, 5 Apr 2023 13:03:18 +0000"  >&lt;p&gt;Also CrossOriginOpenerPolicyRequestCycleListener is broken&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17708887" author="jira-bot" created="Wed, 5 Apr 2023 13:12:07 +0000"  >&lt;p&gt;Commit 98bda871550f1c326c872340cd642b943103b982 in wicket&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt;-take-II from reiern70&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=98bda87155&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=98bda87155&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt; do CSP related header generation both at onRequestHandlerResolved and onRequestHandlerExecuted. The same is applied for CrossOriginEmbedderPolicyRequestCycleListener and CrossOriginOpenerPolicyRequestCycleListener&lt;/p&gt;</comment>
                            <comment id="17708888" author="jira-bot" created="Wed, 5 Apr 2023 13:13:17 +0000"  >&lt;p&gt;Commit eb6ceebe3a858b46391eef90446ff9fe335f2b38 in wicket&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt;-take-II from reiern70&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=eb6ceebe3a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=eb6ceebe3a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt; do CSP related header generation both at onRequestHandlerResolved and onRequestHandlerExecuted. The same is applied for CrossOriginEmbedderPolicyRequestCycleListener and CrossOriginOpenerPolicyRequestCycleListener&lt;/p&gt;</comment>
                            <comment id="17708891" author="reiern70" created="Wed, 5 Apr 2023 13:19:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/wicket/pull/569/commits/eb6ceebe3a858b46391eef90446ff9fe335f2b38&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/569/commits/eb6ceebe3a858b46391eef90446ff9fe335f2b38&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Does the same for the other listeners. Maybe we should try later on teh idea sugested by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17709053" author="githubbot" created="Wed, 5 Apr 2023 18:21:37 +0000"  >&lt;p&gt;svenmeier commented on PR #569:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/569#issuecomment-1497926276&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/569#issuecomment-1497926276&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   Not beautiful, but it seems to work.&lt;/p&gt;

&lt;p&gt;   Maybe let #onRequestHandlerResolved() and #onRequestHandlerExecuted() both delegate to a private method #protect() ... the way the one calls the other now I find confusing.&lt;/p&gt;

</comment>
                            <comment id="17709219" author="githubbot" created="Thu, 6 Apr 2023 06:29:16 +0000"  >&lt;p&gt;reiern70 commented on PR #569:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/569#issuecomment-1498557849&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/569#issuecomment-1498557849&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;   &amp;gt; Not beautiful, but it seems to work.&lt;br/&gt;
   &amp;gt; &lt;br/&gt;
   &amp;gt; Maybe let #onRequestHandlerResolved() and #onRequestHandlerExecuted() both delegate to a private method #protect() ... the way the one calls the other now I find confusing.&lt;/p&gt;

&lt;p&gt;   This sounds like a goog idea. I will do and push those changes and merge. After that I can try to explore the other idea you proposed (that seems less fragile that doing it this way). Wondering if we should also add some tests covering actual generation of headers for these corrner cases.&lt;/p&gt;

</comment>
                            <comment id="17709251" author="jira-bot" created="Thu, 6 Apr 2023 07:35:08 +0000"  >&lt;p&gt;Commit 409e6f798cc858b1cd696f40b71655abc27dd29b in wicket&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt;-take-II from reiern70&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=409e6f798c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=409e6f798c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt; do CSP related header generation both at onRequestHandlerResolved and onRequestHandlerExecuted. The same is applied for CrossOriginEmbedderPolicyRequestCycleListener and CrossOriginOpenerPolicyRequestCycleListener&lt;/p&gt;</comment>
                            <comment id="17709252" author="githubbot" created="Thu, 6 Apr 2023 07:35:26 +0000"  >&lt;p&gt;reiern70 merged PR #569:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/569&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/569&lt;/a&gt;&lt;/p&gt;

</comment>
                            <comment id="17709253" author="jira-bot" created="Thu, 6 Apr 2023 07:35:26 +0000"  >&lt;p&gt;Commit 409e6f798cc858b1cd696f40b71655abc27dd29b in wicket&apos;s branch refs/heads/wicket-9.x from reiern70&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=409e6f798c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=409e6f798c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt; do CSP related header generation both at onRequestHandlerResolved and onRequestHandlerExecuted. The same is applied for CrossOriginEmbedderPolicyRequestCycleListener and CrossOriginOpenerPolicyRequestCycleListener&lt;/p&gt;</comment>
                            <comment id="17709258" author="githubbot" created="Thu, 6 Apr 2023 07:38:39 +0000"  >&lt;p&gt;solomax commented on code in PR #569:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/569#discussion_r1159399210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/569#discussion_r1159399210&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
wicket-core/src/main/java/org/apache/wicket/coep/CrossOriginEmbedderPolicyRequestCycleListener.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -36,15 +36,15 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&amp;lt;code&amp;gt;Cross-Origin-Embedder-Policy&amp;lt;/code&amp;gt;. The header is not set for the paths that are exempted&lt;/li&gt;
	&lt;li&gt;from COEP. The only valid value of COEP is &amp;lt;code&amp;gt;require-corp&amp;lt;/code&amp;gt;, so if the listener is&lt;/li&gt;
	&lt;li&gt;enabled the policy value will be specified as so.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;*&lt;br/&gt;
+ * &amp;lt;p&amp;gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   I believe, this one will produce JavaDoc warning &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


</comment>
                            <comment id="17709259" author="jira-bot" created="Thu, 6 Apr 2023 07:40:57 +0000"  >&lt;p&gt;Commit f2719ba321ff308852279deeb5396c915e4de3a5 in wicket&apos;s branch refs/heads/master from reiern70&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=f2719ba321&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=f2719ba321&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt; do CSP related header generation both at onRequestHandlerResolved and onRequestHandlerExecuted. The same is applied for CrossOriginEmbedderPolicyRequestCycleListener and CrossOriginOpenerPolicyRequestCycleListener&lt;/p&gt;</comment>
                            <comment id="17709260" author="githubbot" created="Thu, 6 Apr 2023 07:42:44 +0000"  >&lt;p&gt;reiern70 commented on code in PR #569:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/569#discussion_r1159405132&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/569#discussion_r1159405132&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
wicket-core/src/main/java/org/apache/wicket/coep/CrossOriginEmbedderPolicyRequestCycleListener.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -36,15 +36,15 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&amp;lt;code&amp;gt;Cross-Origin-Embedder-Policy&amp;lt;/code&amp;gt;. The header is not set for the paths that are exempted&lt;/li&gt;
	&lt;li&gt;from COEP. The only valid value of COEP is &amp;lt;code&amp;gt;require-corp&amp;lt;/code&amp;gt;, so if the listener is&lt;/li&gt;
	&lt;li&gt;enabled the policy value will be specified as so.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;*&lt;br/&gt;
+ * &amp;lt;p&amp;gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I had a warining locally... And this fixed it. DO we have some IJ settings I could use as default for wicket?&lt;/p&gt;


</comment>
                            <comment id="17709264" author="reiern70" created="Thu, 6 Apr 2023 07:45:22 +0000"  >&lt;p&gt;This seems to be fixed now for 9.x and 10.x branches.&lt;/p&gt;</comment>
                            <comment id="17709267" author="githubbot" created="Thu, 6 Apr 2023 07:51:45 +0000"  >&lt;p&gt;solomax commented on code in PR #569:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/569#discussion_r1159414745&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/569#discussion_r1159414745&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
wicket-core/src/main/java/org/apache/wicket/coep/CrossOriginEmbedderPolicyRequestCycleListener.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -36,15 +36,15 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&amp;lt;code&amp;gt;Cross-Origin-Embedder-Policy&amp;lt;/code&amp;gt;. The header is not set for the paths that are exempted&lt;/li&gt;
	&lt;li&gt;from COEP. The only valid value of COEP is &amp;lt;code&amp;gt;require-corp&amp;lt;/code&amp;gt;, so if the listener is&lt;/li&gt;
	&lt;li&gt;enabled the policy value will be specified as so.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;*&lt;br/&gt;
+ * &amp;lt;p&amp;gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   you are right &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
   no specific warning at this line, sorry for the noise &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;   I&apos;m not using IJ, I believe checkstyle and javadoc maven plugins can be configured to be more strict&lt;/p&gt;


</comment>
                            <comment id="17709273" author="githubbot" created="Thu, 6 Apr 2023 08:04:01 +0000"  >&lt;p&gt;reiern70 commented on code in PR #569:&lt;br/&gt;
URL: &lt;a href=&quot;https://github.com/apache/wicket/pull/569#discussion_r1159427006&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/pull/569#discussion_r1159427006&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;##########&lt;br/&gt;
wicket-core/src/main/java/org/apache/wicket/coep/CrossOriginEmbedderPolicyRequestCycleListener.java:&lt;br/&gt;
##########&lt;br/&gt;
@@ -36,15 +36,15 @@&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&amp;lt;code&amp;gt;Cross-Origin-Embedder-Policy&amp;lt;/code&amp;gt;. The header is not set for the paths that are exempted&lt;/li&gt;
	&lt;li&gt;from COEP. The only valid value of COEP is &amp;lt;code&amp;gt;require-corp&amp;lt;/code&amp;gt;, so if the listener is&lt;/li&gt;
	&lt;li&gt;enabled the policy value will be specified as so.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;*&lt;br/&gt;
+ * &amp;lt;p&amp;gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Review Comment:&lt;br/&gt;
   &amp;gt; you are right &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; no specific warning at this line, sorry for the noise &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;   No problem. Everything that makes wicket code better is welcomed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;   &amp;gt; &lt;br/&gt;
   &amp;gt; I&apos;m not using IJ, I believe checkstyle and javadoc maven plugins can be configured to be more strict&lt;/p&gt;

&lt;p&gt;   Oh! I didn&apos;t check the result of those. Just that code build with maven clean install on terminal in my linux box.&lt;/p&gt;

&lt;p&gt;   At work we have the same &quot;warnings war&quot; because some people use IJ and other use eclipse and we use gradle instead of  maven and it is very diffcult to get all the parties agree about what a warning is &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;



</comment>
                            <comment id="17713868" author="jira-bot" created="Wed, 19 Apr 2023 03:35:04 +0000"  >&lt;p&gt;Commit 111bf43ee78d98597cc7a34a3464b25e0171d43d in wicket&apos;s branch refs/heads/fileupload2 from reiern70&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=111bf43ee7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=111bf43ee7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt; move generation of CSP related header(s) to onRequestHandlerExecuted&lt;/p&gt;</comment>
                            <comment id="17713869" author="jira-bot" created="Wed, 19 Apr 2023 03:35:04 +0000"  >&lt;p&gt;Commit f2719ba321ff308852279deeb5396c915e4de3a5 in wicket&apos;s branch refs/heads/fileupload2 from reiern70&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=f2719ba321&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=f2719ba321&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-7028&quot; title=&quot;CSP header not rendered when using RedirectPolicy.NEVER_REDIRECT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-7028&quot;&gt;&lt;del&gt;WICKET-7028&lt;/del&gt;&lt;/a&gt; do CSP related header generation both at onRequestHandlerResolved and onRequestHandlerExecuted. The same is applied for CrossOriginEmbedderPolicyRequestCycleListener and CrossOriginOpenerPolicyRequestCycleListener&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13576893">WICKET-7107</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13055626" name="examplecsp.zip" size="30897" author="Youri219" created="Mon, 20 Feb 2023 09:29:27 +0000"/>
                            <attachment id="13057051" name="image-2023-04-05-10-58-33-645.png" size="59471" author="reiern70" created="Wed, 5 Apr 2023 07:58:33 +0000"/>
                            <attachment id="13057055" name="image-2023-04-05-13-13-46-451.png" size="121502" author="reiern70" created="Wed, 5 Apr 2023 10:13:47 +0000"/>
                            <attachment id="13057056" name="image-2023-04-05-13-19-40-207.png" size="40290" author="reiern70" created="Wed, 5 Apr 2023 10:19:40 +0000"/>
                            <attachment id="13057057" name="image-2023-04-05-13-21-01-849.png" size="140024" author="reiern70" created="Wed, 5 Apr 2023 10:21:02 +0000"/>
                            <attachment id="13057058" name="image-2023-04-05-14-35-49-714.png" size="133589" author="reiern70" created="Wed, 5 Apr 2023 11:35:50 +0000"/>
                            <attachment id="13055502" name="withcsp.png" size="80693" author="Youri219" created="Thu, 16 Feb 2023 07:26:31 +0000"/>
                            <attachment id="13055501" name="withoutcsp.png" size="48071" author="Youri219" created="Thu, 16 Feb 2023 07:26:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 29 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1fz6g:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>