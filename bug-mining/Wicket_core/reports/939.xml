<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:22:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-5392] Responses for package resources cannot be compressed</title>
                <link>https://issues.apache.org/jira/browse/WICKET-5392</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;Applying Jetty&apos;s GZipFilter in web.xml works only for the page content but doesn&apos;t for any AbstractResource.&lt;/p&gt;

&lt;p&gt;The problem is that org.apache.wicket.request.resource.AbstractResource#flushResponseAfterHeaders flushes the headers and GZipFilter cannot do anything after this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12675209">WICKET-5392</key>
            <summary>Responses for package resources cannot be compressed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="mgrigorov">Martin Tzvetanov Grigorov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Oct 2013 08:04:48 +0000</created>
                <updated>Tue, 7 Apr 2015 10:37:44 +0000</updated>
                            <resolved>Mon, 28 Oct 2013 09:24:20 +0000</resolved>
                                    <version>6.11.0</version>
                                    <fixVersion>7.0.0-M1</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13802697" author="mgrigorov" created="Wed, 23 Oct 2013 08:16:14 +0000"  >&lt;p&gt;Attaching possible solution.&lt;br/&gt;
Unfortunately Clirr plugin breaks the build because the patch introduces new methods in IResourceSettings interface.&lt;/p&gt;

&lt;p&gt;Suggestions how to apply this change in 6.x ?&lt;/p&gt;</comment>
                            <comment id="13802779" author="svenmeier" created="Wed, 23 Oct 2013 10:43:13 +0000"  >&lt;p&gt;Isn&apos;t this a bug in Jetty?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;org.eclipse.jetty.http.gzip.CompressedResponseWrapper.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void flushBuffer() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (_writer!=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            _writer.flush();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (_compressedStream!=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            _compressedStream.finish();
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
            getResponse().flushBuffer();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When AbstractResponse flushes the headers, no body was written yet, thus the response is just flushed.&lt;br/&gt;
Later on - after writing something to the body - AbstractCompressedStream#flush() takes care of setting the appropriate &quot;Content-Encoding&quot; before flushing. But that&apos;s too late for Wicket, because we flush the headers before the body.&lt;/p&gt;</comment>
                            <comment id="13802805" author="mgrigorov" created="Wed, 23 Oct 2013 11:22:30 +0000"  >&lt;p&gt;IMO the flush for the resources is not really needed these days.&lt;br/&gt;
I think it is a workaround for some obsolete issue with Firefox version that is fixed in newer versions.&lt;br/&gt;
I remember a Wicket user needing to disable the flushing of the headers exactly for a case where the response is an image and the browser is Firefox.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure whether it is a bug in Jetty&apos;s GZipFilter classes. I also think it should not try to do anything if the application flushes the response earlier.&lt;/p&gt;</comment>
                            <comment id="13803957" author="svenmeier" created="Thu, 24 Oct 2013 07:37:51 +0000"  >&lt;p&gt;I didn&apos;t find the originating commit, but I agree it&apos;s probably safe to not flush after the headers by default.&lt;/p&gt;</comment>
                            <comment id="13803965" author="mgrigorov" created="Thu, 24 Oct 2013 07:51:31 +0000"  >&lt;p&gt;I&apos;ll apply an improvement only in master branch (7.x).&lt;br/&gt;
The behavior will be the same - flush the headers by default, but with the new setting this can be suppressed application-wide. It is possible even now to suppress it for particular AbstractResource by overriding #flushResponseAfterHeaders() and leaving it empty.&lt;/p&gt;

&lt;p&gt;6.x users can use frontend proxy, like httpd or nginx, to gzip/deflate when needed.&lt;/p&gt;</comment>
                            <comment id="13803967" author="mgrigorov" created="Thu, 24 Oct 2013 07:55:08 +0000"  >&lt;p&gt;Here is a new patch for master branch.&lt;br/&gt;
It passes the AbstractResourse as parameter to the new IResourceSettings#shouldFlushResponseHeaders() method.&lt;/p&gt;

&lt;p&gt;This way the logic could be more flexible, but to apply it the application developer should extend ResourceSettings, instead of just calling a setter method.&lt;/p&gt;

&lt;p&gt;Is that OK ?&lt;/p&gt;</comment>
                            <comment id="13804073" author="svenmeier" created="Thu, 24 Oct 2013 11:10:03 +0000"  >&lt;p&gt;Extending a settings object is rather unusual in Wicket, isn&apos;t it?&lt;/p&gt;</comment>
                            <comment id="13804076" author="mgrigorov" created="Thu, 24 Oct 2013 11:18:06 +0000"  >&lt;p&gt;I have never did it. But it is not impossible - org.apache.wicket.Application#setResourceSettings.&lt;br/&gt;
And this is the main reason why Clirr doesn&apos;t allow the change in 6.x branch.&lt;/p&gt;

&lt;p&gt;I think the new patch is much more flexible. The AbstractResource is passed as argument and the custom impl of IResourceSettings can make more complex decisions.&lt;/p&gt;</comment>
                            <comment id="13806052" author="svenmeier" created="Sat, 26 Oct 2013 10:51:03 +0000"  >&lt;p&gt;Yes, it&apos;s possible to subclass settings. But currently all their properties have setter/getter pairs, so I don&apos;t think it&apos;s a good idea to introduce that new usage just for this issue.&lt;/p&gt;

&lt;p&gt;How about introducing&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;IResourceStrategy (similar to IResourceCachingStrategy)&lt;/li&gt;
	&lt;li&gt;IResourceStrategy#decorateHeaders(AbstractResource, AbstractResource.ResourceResponse)&lt;/li&gt;
	&lt;li&gt;DefaultResourceStrategy calls response.flush() in decorateHeaders()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Perhaps we should just remove the I*Settings interfaces in 7.x, so we make it easier to add new settings in the future.&lt;/p&gt;</comment>
                            <comment id="13806639" author="mgrigorov" created="Mon, 28 Oct 2013 09:05:52 +0000"  >&lt;p&gt;Removing IResourceSettings and introducing IResourceStrategy will lead to the same problem - not able to add new settings in IRStrategy for the lifetime of the stable release.&lt;/p&gt;

&lt;p&gt;How about not applying my suggested patches at all and just remove the flush of the headers for resources in 7.x ? &lt;/p&gt;</comment>
                            <comment id="13806644" author="svenmeier" created="Mon, 28 Oct 2013 09:14:27 +0000"  >&lt;p&gt;+1 keep it simple&lt;/p&gt;</comment>
                            <comment id="13806649" author="mgrigorov" created="Mon, 28 Oct 2013 09:24:20 +0000"  >&lt;p&gt;Done.&lt;br/&gt;
Thanks for the discussion, Sven!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12818630">WICKET-5873</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12610067" name="WICKET-5392.patch" size="3656" author="mgrigorov" created="Thu, 24 Oct 2013 07:55:08 +0000"/>
                            <attachment id="12609821" name="WICKET-5392.patch" size="3349" author="mgrigorov" created="Wed, 23 Oct 2013 08:16:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>354829</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 3 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1p67r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>355118</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>