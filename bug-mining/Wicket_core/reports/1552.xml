<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:26:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-6908] Possible bug / edge case where page is not detached</title>
                <link>https://issues.apache.org/jira/browse/WICKET-6908</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;Today I spent the better part of my day investigating a bug report regarding a hibernate LazyInitializationException.&lt;br/&gt;
Since we use detaching models everywhere and (in general) never see such issues anymore, this one was interesting &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
&#160;&lt;br/&gt;
After much debugging I found out what is happening.&lt;br/&gt;
&#160;&lt;br/&gt;
We have a page which has a database model + links for prev/next item (in the database).&lt;br/&gt;
When the users double-clicks on one of the links, the first click is OK, and the second click throws a StalePageException during request cycle processing.&lt;br/&gt;
&#160;&lt;br/&gt;
So far, normal.&lt;br/&gt;
&#160;&lt;br/&gt;
However, stepping through the wicket code, this is what happens:&lt;br/&gt;
&#160;&lt;br/&gt;
1) Resolve to ListenerRequestHandler, execute it, throws StalePageException&lt;br/&gt;
2) exception mapper handles this and we execute a RenderPageRequestHandler, which re-renders the page&lt;br/&gt;
3) the request cycle detaches, which delegates in part to&#160;RequestHandlerExecutor.detach()&lt;br/&gt;
4) The handlers to detach are both handlers from step 1 and 2; During the detach of ListenerRequestHandler, it initializes ListenerLogData, which (in the PageLogData ctor) throws the StalePageException again!&lt;br/&gt;
5) The second handler (RenderPageRequestHandler) is not detached, thus all models in the page are not detached&lt;br/&gt;
6) The user clicks on a link and boom, the models are all still attached and there we get the LazyInitializationException&lt;br/&gt;
&#160;&lt;br/&gt;
I think that (a)&#160;RequestHandlerExecutor.detach() should ensure all handlers are detached, and (b) that failing to collect LogData should not stop the detaching of a request handler.&lt;br/&gt;
&#160;&lt;br/&gt;
What do you think?&lt;br/&gt;
&#160;&lt;br/&gt;
I tried to make the simplest possible Quickstart to demonstrate this.&lt;br/&gt;
&#160;&lt;br/&gt;
Weird stuff: on the homepage of the quick start, the page is properly detached when a stale link is clicked;&lt;br/&gt;
On another (test) page, the page is not properly detached.&lt;br/&gt;
&#160;&lt;br/&gt;
Steps to reproduce:&lt;br/&gt;
&#160;&lt;br/&gt;
Run Quickstart&lt;br/&gt;
Click on &#8220;Test&#8221; link on homepage&lt;br/&gt;
Observe that the following is logged:&lt;br/&gt;
&#160;&lt;br/&gt;
Model still attached? false&lt;br/&gt;
Page detaching&lt;br/&gt;
&#160;&lt;br/&gt;
Now click on &quot;Click me (stale link)!&#8221;&lt;br/&gt;
Now refresh the page (re-render)&lt;br/&gt;
&#160;&lt;br/&gt;
Observe that the following is logged:&lt;br/&gt;
&#160;&lt;br/&gt;
Model still attached? true&lt;br/&gt;
Page detaching&lt;br/&gt;
&#160;&lt;br/&gt;
&#8212;&amp;gt; So the page was not detached&lt;br/&gt;
&#160;&lt;br/&gt;
These steps don&#8217;t have the same result on the homepage. So my guess is there is some relation to the fact that we are interacting with a stateful, non-mounted page.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13391705">WICKET-6908</key>
            <summary>Possible bug / edge case where page is not detached</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="svenmeier">Sven Meier</assignee>
                                    <reporter username="bgooren">Sebastian Gooren</reporter>
                        <labels>
                    </labels>
                <created>Sun, 25 Jul 2021 07:06:14 +0000</created>
                <updated>Fri, 30 Jul 2021 14:31:50 +0000</updated>
                            <resolved>Tue, 27 Jul 2021 22:43:42 +0000</resolved>
                                    <version>9.4.0</version>
                    <version>8.13.0</version>
                                    <fixVersion>10.0.0-M1</fixVersion>
                    <fixVersion>9.5.0</fixVersion>
                    <fixVersion>8.14.0</fixVersion>
                                    <component>wicket-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17387602" author="jira-bot" created="Mon, 26 Jul 2021 20:03:21 +0000"  >&lt;p&gt;Commit 6dceb0cd86eee796203e335b8d23f667758aca41 in wicket&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6908&quot; title=&quot;Possible bug / edge case where page is not detached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6908&quot;&gt;&lt;del&gt;WICKET-6908&lt;/del&gt;&lt;/a&gt;-detach-failure from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=6dceb0c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=6dceb0c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6908&quot; title=&quot;Possible bug / edge case where page is not detached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6908&quot;&gt;&lt;del&gt;WICKET-6908&lt;/del&gt;&lt;/a&gt; wrap exceptions for log data&lt;/p&gt;</comment>
                            <comment id="17387603" author="jira-bot" created="Mon, 26 Jul 2021 20:03:22 +0000"  >&lt;p&gt;Commit 05ab77655fb00d27ade1402b72db1dc6968b3dbe in wicket&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6908&quot; title=&quot;Possible bug / edge case where page is not detached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6908&quot;&gt;&lt;del&gt;WICKET-6908&lt;/del&gt;&lt;/a&gt;-detach-failure from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=05ab776&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=05ab776&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6908&quot; title=&quot;Possible bug / edge case where page is not detached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6908&quot;&gt;&lt;del&gt;WICKET-6908&lt;/del&gt;&lt;/a&gt; detach all handlers&lt;/p&gt;

&lt;p&gt;even if one throws a RuntimeException&lt;/p&gt;</comment>
                            <comment id="17387606" author="svenmeier" created="Mon, 26 Jul 2021 20:07:06 +0000"  >&lt;p&gt;&amp;gt; that (a) RequestHandlerExecutor.detach() should ensure all handlers are detached, and (b) that failing to collect LogData should not stop the detaching of a request handler&lt;/p&gt;

&lt;p&gt;Couldn&apos;t agree more, see branch &lt;a href=&quot;https://github.com/apache/wicket/compare/wicket-9.x...WICKET-6908-detach-failure&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/compare/wicket-9.x...WICKET-6908-detach-failure&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If we really drop component-queueing in Wicket 10, then we can remove that strange rethrow in RequestHandlerExecutor (was introduced with &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6001&quot; title=&quot;Exception raised while refreshing a page with queued components missing in the markup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6001&quot;&gt;&lt;del&gt;WICKET-6001&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="17388336" author="jira-bot" created="Tue, 27 Jul 2021 22:37:49 +0000"  >&lt;p&gt;Commit b1c2d67d656970111407d384feabda87050b8ecd in wicket&apos;s branch refs/heads/wicket-9.x from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=b1c2d67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=b1c2d67&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6908&quot; title=&quot;Possible bug / edge case where page is not detached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6908&quot;&gt;&lt;del&gt;WICKET-6908&lt;/del&gt;&lt;/a&gt; wrap exceptions for log data&lt;/p&gt;</comment>
                            <comment id="17388337" author="jira-bot" created="Tue, 27 Jul 2021 22:37:50 +0000"  >&lt;p&gt;Commit 6c88207455fb7e523b598c5fed760917ca6f00b5 in wicket&apos;s branch refs/heads/wicket-9.x from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=6c88207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=6c88207&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6908&quot; title=&quot;Possible bug / edge case where page is not detached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6908&quot;&gt;&lt;del&gt;WICKET-6908&lt;/del&gt;&lt;/a&gt; detach all handlers&lt;/p&gt;

&lt;p&gt;even if one throws a RuntimeException&lt;/p&gt;</comment>
                            <comment id="17388338" author="jira-bot" created="Tue, 27 Jul 2021 22:40:47 +0000"  >&lt;p&gt;Commit 494657d2b7b8e1eb297b76120be20d41e0e9f5fe in wicket&apos;s branch refs/heads/master from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=494657d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=494657d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6908&quot; title=&quot;Possible bug / edge case where page is not detached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6908&quot;&gt;&lt;del&gt;WICKET-6908&lt;/del&gt;&lt;/a&gt; wrap exceptions for log data&lt;/p&gt;</comment>
                            <comment id="17388339" author="jira-bot" created="Tue, 27 Jul 2021 22:40:48 +0000"  >&lt;p&gt;Commit 7c0009c8dffcaa625525a87c9b1a381127594787 in wicket&apos;s branch refs/heads/master from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=7c0009c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=7c0009c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6908&quot; title=&quot;Possible bug / edge case where page is not detached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6908&quot;&gt;&lt;del&gt;WICKET-6908&lt;/del&gt;&lt;/a&gt; detach all handlers&lt;/p&gt;

&lt;p&gt;even if one throws a RuntimeException&lt;/p&gt;</comment>
                            <comment id="17388340" author="jira-bot" created="Tue, 27 Jul 2021 22:41:48 +0000"  >&lt;p&gt;Commit 8bacc08cffd026acbb0e9fc317ebe347babcc079 in wicket&apos;s branch refs/heads/wicket-8.x from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=8bacc08&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=8bacc08&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6908&quot; title=&quot;Possible bug / edge case where page is not detached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6908&quot;&gt;&lt;del&gt;WICKET-6908&lt;/del&gt;&lt;/a&gt; wrap exceptions for log data&lt;/p&gt;</comment>
                            <comment id="17388341" author="jira-bot" created="Tue, 27 Jul 2021 22:41:49 +0000"  >&lt;p&gt;Commit 53b487c8849419e68afb6055148432cb9ca86bc9 in wicket&apos;s branch refs/heads/wicket-8.x from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=53b487c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=53b487c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6908&quot; title=&quot;Possible bug / edge case where page is not detached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6908&quot;&gt;&lt;del&gt;WICKET-6908&lt;/del&gt;&lt;/a&gt; detach all handlers&lt;/p&gt;

&lt;p&gt;even if one throws a RuntimeException&lt;/p&gt;</comment>
                            <comment id="17388342" author="svenmeier" created="Tue, 27 Jul 2021 22:43:42 +0000"  >&lt;p&gt;All handlers are now properly detached again.&lt;/p&gt;</comment>
                            <comment id="17388343" author="jira-bot" created="Tue, 27 Jul 2021 22:51:25 +0000"  >&lt;p&gt;Commit db80c7e74673c582cb5be1ceb335af89694df8e3 in wicket&apos;s branch refs/heads/wicket-8.x from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=db80c7e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=db80c7e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6908&quot; title=&quot;Possible bug / edge case where page is not detached&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6908&quot;&gt;&lt;del&gt;WICKET-6908&lt;/del&gt;&lt;/a&gt; adjusted test to junit 4&lt;/p&gt;</comment>
                            <comment id="17390620" author="bgooren" created="Fri, 30 Jul 2021 14:31:50 +0000"  >&lt;p&gt;Thank you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12905383">WICKET-6001</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13031017" name="quickstart.zip" size="52331" author="bgooren" created="Sun, 25 Jul 2021 07:06:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 15 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0tatk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>