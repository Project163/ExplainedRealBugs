<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:18:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-3891] in development mode Wicket stops picking up markup changes</title>
                <link>https://issues.apache.org/jira/browse/WICKET-3891</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;I have wicket application running via mvn jetty:run under JRebel to facilitate code hotswap.&lt;/p&gt;

&lt;p&gt;With 1.5RC5.1 Wicket does not pick markup changes unless I change requested version, and it still put version on URL even I have getPageSettings.setVersionPagesByDefault(false); , but that is a minor inconvenience.&lt;/p&gt;

&lt;p&gt;More annoying that after awhile Wicket stops picking up changes in the markup of components used on my page. I mean that I can change markup for my components and it gets reflected upon page refresh (with requesting non existent version), but at some point it stops, changes to the markup of subcomponents are not picked up.&lt;/p&gt;

&lt;p&gt;That forces me to restart application, which is major productivity killer....&lt;/p&gt;</description>
                <environment>OS X </environment>
        <key id="12513851">WICKET-3891</key>
            <summary>in development mode Wicket stops picking up markup changes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdonnerstag">Juegen Donnerstag</assignee>
                                    <reporter username="kgignatyev">Konstantin Ignatyev</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Jul 2011 21:36:49 +0000</created>
                <updated>Mon, 25 Jul 2011 11:25:25 +0000</updated>
                            <resolved>Thu, 21 Jul 2011 20:07:57 +0000</resolved>
                                    <version>1.5-RC5.1</version>
                                    <fixVersion>1.5-RC6</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13064237" author="robmcguinness" created="Tue, 12 Jul 2011 23:45:16 +0000"  >&lt;p&gt;Is it similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-3878?&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/WICKET-3878?&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13064241" author="ivaynberg" created="Tue, 12 Jul 2011 23:51:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-3878&quot; title=&quot;When base markup file has been removed from the cache, the the derived markup should be removed as well&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-3878&quot;&gt;&lt;del&gt;WICKET-3878&lt;/del&gt;&lt;/a&gt; had to do with parent-child markup relationships. does all markup stop reloading for you after a while? does it do the same if you run without jrebel?&lt;/p&gt;</comment>
                            <comment id="13064354" author="mgrigorov" created="Wed, 13 Jul 2011 04:36:41 +0000"  >&lt;p&gt;A quickstart will help us debug it!&lt;/p&gt;</comment>
                            <comment id="13064692" author="kgignatyev" created="Wed, 13 Jul 2011 16:48:38 +0000"  >&lt;p&gt;Did not try without JRebel as am so addicted to the tool &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; however before RC5.1 all was working well therefore I think there is little reason to believe that JRebel causes this to happen.&lt;/p&gt;

&lt;p&gt;Would it make sense to add something like &apos;flush markup cache&apos; to the ajax debug panel that floats at the bottom of the screen in dev mode anyway? &lt;/p&gt;

&lt;p&gt;I wish I had time to recreate this behavior in a repro application - it takes awhile for that behavior to manifest. Is there anything helpful you can get from logs? I could enable them or add logging statement in relevant places in the source if that would be any help for you.&lt;/p&gt;</comment>
                            <comment id="13064718" author="mgrigorov" created="Wed, 13 Jul 2011 17:34:46 +0000"  >&lt;p&gt;Can you try with 1.5-SNAPSHOT ?&lt;br/&gt;
Recently we fixed something similar: &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-3878&quot; title=&quot;When base markup file has been removed from the cache, the the derived markup should be removed as well&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-3878&quot;&gt;&lt;del&gt;WICKET-3878&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13064766" author="kgignatyev" created="Wed, 13 Jul 2011 18:51:01 +0000"  >&lt;p&gt;Just compiled SNAPSHOT from trunk and tried: now that is easy to reproduce I think - markup refresh does not work at all.&lt;/p&gt;

&lt;p&gt;I have this chain CorePage &amp;lt;- BaseDecoratedPage &amp;lt;- SubsectionBasePage&amp;lt;- SusectionRealPage1&lt;/p&gt;

&lt;p&gt;so I am looking at SusectionRealPage1 that inherits markup from the above chain, and I am changing markup for its superclass  - SubsectionBasePage. The change does not get reflected when I refresh browser pointing at SusectionRealPage1, even if I manually specify new version number for the page - that used to help in RC5.1, see my comment above&lt;/p&gt;</comment>
                            <comment id="13064775" author="mgrigorov" created="Wed, 13 Jul 2011 19:07:45 +0000"  >&lt;p&gt;The problem is not in MarkupCache.&lt;br/&gt;
The problem seems to be that org.apache.wicket.page.PageStoreManager.SessionEntry doesn&apos;t get serialized and thus the transient field Page#markup is never null-ified, thus the markup cache is not asked at all.&lt;/p&gt;</comment>
                            <comment id="13064787" author="mgrigorov" created="Wed, 13 Jul 2011 19:22:06 +0000"  >&lt;p&gt;&amp;#8212; wicket-core/src/main/java/org/apache/wicket/Component.java	(revision 1145858)&lt;br/&gt;
+++ wicket-core/src/main/java/org/apache/wicket/Component.java	(working copy)&lt;br/&gt;
@@ -3807,6 +3807,10 @@&lt;br/&gt;
 	 */&lt;br/&gt;
 	protected void onDetach()&lt;br/&gt;
 	{&lt;br/&gt;
+		if (getApplication().usesDevelopmentConfig())&lt;br/&gt;
+		&lt;/p&gt;
{
+			markup = null;
+		}
&lt;p&gt; 		setFlag(FLAG_DETACHING, false);&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;This solves the problem but I&apos;m not sure how it worked before.&lt;br/&gt;
The pages touched in one request are cached in the http session so that they are ready to use for the next request. On the next request the new touched pages override the previous ones. &lt;/p&gt;</comment>
                            <comment id="13064797" author="kgignatyev" created="Wed, 13 Jul 2011 19:38:27 +0000"  >&lt;p&gt;applied, recompiled, does not help, still superclass markup changes are not reflected&lt;/p&gt;</comment>
                            <comment id="13064801" author="mgrigorov" created="Wed, 13 Jul 2011 19:40:41 +0000"  >&lt;p&gt;Please provide a quickstart with steps to reproduce.&lt;/p&gt;</comment>
                            <comment id="13065538" author="kgignatyev" created="Thu, 14 Jul 2011 21:11:48 +0000"  >&lt;p&gt;Tried to create repro project, but cannot. Simple code works fine, but real project does not. However there are couple of things I have noticed: in real project I see version in the page URL even I have disabled it.&lt;/p&gt;

&lt;p&gt; override def init()  {&lt;br/&gt;
    super.init()&lt;br/&gt;
    getPageSettings.setVersionPagesByDefault(false)&lt;/p&gt;

&lt;p&gt;Project is in Scala if that makes any difference for Wicket&lt;/p&gt;

&lt;p&gt;And it does not pick up changes to the super class markup, if I update page&apos;s markupt then ALL the changes are picked up- in the superclass&apos; markup and in the page&apos;s markup&lt;/p&gt;</comment>
                            <comment id="13067415" author="kgignatyev" created="Tue, 19 Jul 2011 00:15:05 +0000"  >&lt;p&gt;Here is the exception I saw in the log and after that W stopped picking up markup changes: &lt;br/&gt;
&amp;lt;2011-07-18 15:54:42,502&amp;gt; ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.wicket.util.thread.Task$1&amp;#93;&lt;/span&gt; - Unhandled exception thrown by user code in task ModificationWatcher (ModificationWatcher Task)&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.wicket.markup.MarkupCache.removeMarkupWhereBaseMarkupIsNoLongerInTheCache(MarkupCache.java:201)&lt;br/&gt;
	at org.apache.wicket.markup.MarkupCache.removeMarkup(MarkupCache.java:149)&lt;br/&gt;
	at org.apache.wicket.markup.MarkupCache$1.onChange(MarkupCache.java:518)&lt;br/&gt;
	at org.apache.wicket.util.listener.ChangeListenerSet$1.notify(ChangeListenerSet.java:45)&lt;br/&gt;
	at org.apache.wicket.util.listener.ChangeListenerSet$1.notify(ChangeListenerSet.java:43)&lt;br/&gt;
	at org.apache.wicket.util.listener.ListenerCollection.notify(ListenerCollection.java:79)&lt;br/&gt;
	at org.apache.wicket.util.listener.ChangeListenerSet.notifyListeners(ChangeListenerSet.java:40)&lt;br/&gt;
	at org.apache.wicket.util.watch.ModificationWatcher$1.run(ModificationWatcher.java:158)&lt;br/&gt;
	at org.apache.wicket.util.thread.Task$1.run(Task.java:115)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:680)&lt;/p&gt;


&lt;p&gt;At the time application had one page opened in one browser and that page has timer tasks that pings server for updates every second.&lt;br/&gt;
Hope that helps&lt;/p&gt;
</comment>
                            <comment id="13067521" author="kgignatyev" created="Tue, 19 Jul 2011 05:53:36 +0000"  >&lt;p&gt;The following changes fix problem for me:&lt;/p&gt;

&lt;p&gt;Index: wicket-core/src/main/java/org/apache/wicket/Component.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; wicket-core/src/main/java/org/apache/wicket/Component.java	(revision 1148111)&lt;br/&gt;
+++ wicket-core/src/main/java/org/apache/wicket/Component.java	(working copy)&lt;br/&gt;
@@ -3807,6 +3807,10 @@&lt;br/&gt;
 	 */&lt;br/&gt;
 	protected void onDetach()&lt;br/&gt;
 	{&lt;br/&gt;
+		if (getApplication().usesDevelopmentConfig())&lt;br/&gt;
+	    &lt;/p&gt;
{
+		markup = null;
+		}
&lt;p&gt; 		setFlag(FLAG_DETACHING, false);&lt;br/&gt;
 	}&lt;/p&gt;

&lt;p&gt;Index: wicket-core/src/main/java/org/apache/wicket/markup/MarkupCache.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; wicket-core/src/main/java/org/apache/wicket/markup/MarkupCache.java	(revision 1148111)&lt;br/&gt;
+++ wicket-core/src/main/java/org/apache/wicket/markup/MarkupCache.java	(working copy)&lt;br/&gt;
@@ -197,7 +197,7 @@&lt;br/&gt;
 				// Check if the markup associated with key has a base markup. And if yes, test&lt;br/&gt;
 				// if that is cached. If the base markup has been removed, than remove the derived&lt;br/&gt;
 				// markup as well.&lt;br/&gt;
-&lt;br/&gt;
+try&lt;/p&gt;
{
 				MarkupResourceStream resourceStream = markup.getMarkupResourceStream()
 					.getBaseMarkupResourceStream();
 
@@ -213,7 +213,13 @@
 							markup.getMarkupResourceStream());
 					}
&lt;p&gt; 				}&lt;br/&gt;
+			}catch(Exception e)&lt;/p&gt;
{
+				e.printStackTrace();
+				log.info(&quot;kgi catch happened&quot;);
+				iter.remove();
+				count++;
 			}
&lt;p&gt;+			}&lt;br/&gt;
 		}&lt;br/&gt;
 	}&lt;/p&gt;</comment>
                            <comment id="13067658" author="mgrigorov" created="Tue, 19 Jul 2011 12:23:29 +0000"  >&lt;p&gt;I think the proper fix for MarkupCache is:&lt;/p&gt;

&lt;p&gt;&amp;#8212; wicket-core/src/main/java/org/apache/wicket/markup/MarkupCache.java	(revision 1148203)&lt;br/&gt;
+++ wicket-core/src/main/java/org/apache/wicket/markup/MarkupCache.java	(working copy)&lt;br/&gt;
@@ -198,19 +198,22 @@&lt;br/&gt;
 				// if that is cached. If the base markup has been removed, than remove the derived&lt;br/&gt;
 				// markup as well.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;MarkupResourceStream resourceStream = markup.getMarkupResourceStream()&lt;/li&gt;
	&lt;li&gt;.getBaseMarkupResourceStream();&lt;br/&gt;
-&lt;/li&gt;
	&lt;li&gt;// Is the base markup available in the cache?&lt;/li&gt;
	&lt;li&gt;if ((resourceStream != null) &amp;amp;&amp;amp; !isMarkupCached(resourceStream))&lt;br/&gt;
+				if (Markup.NO_MARKUP != markup)&lt;br/&gt;
 				{&lt;/li&gt;
	&lt;li&gt;iter.remove();&lt;/li&gt;
	&lt;li&gt;count++;&lt;br/&gt;
+					MarkupResourceStream resourceStream = markup.getMarkupResourceStream()&lt;br/&gt;
+						.getBaseMarkupResourceStream();&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (log.isDebugEnabled())&lt;br/&gt;
+					// Is the base markup available in the cache?&lt;br/&gt;
+					if ((resourceStream != null) &amp;amp;&amp;amp; !isMarkupCached(resourceStream))&lt;br/&gt;
 					{&lt;/li&gt;
	&lt;li&gt;log.debug(&quot;Removed derived markup from cache: &quot; +&lt;/li&gt;
	&lt;li&gt;markup.getMarkupResourceStream());&lt;br/&gt;
+						iter.remove();&lt;br/&gt;
+						count++;&lt;br/&gt;
+&lt;br/&gt;
+						if (log.isDebugEnabled())&lt;br/&gt;
+						
{
+							log.debug(&quot;Removed derived markup from cache: &quot; +
+								markup.getMarkupResourceStream());
+						}
&lt;p&gt; 					}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I.e. if (markup != Markup.NO_MARKUP) then do the rest. This is the only way markup.getMarkupResourceStream() can return &apos;null&apos;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12515245">WICKET-3931</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>67044</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0k9sn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116404</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>