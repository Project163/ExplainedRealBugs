<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:20:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-4550] jsessionid is not added to resources if cookies are disabled by the server</title>
                <link>https://issues.apache.org/jira/browse/WICKET-4550</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;When I configure the container (either Jetty or Tomcat) to not support cookies, I expect the jsessionid to be added to all resource links in the page. However, with Wicket 1.5.5 this isn&apos;t the case, i.e. all URLs are lacking the jsessionid, both in development and deployment mode.&lt;/p&gt;

&lt;p&gt;Example IS:&lt;br/&gt;
&amp;lt;script type=&quot;text/javascript&quot; src=&quot;wicket/resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event-ver-1331911540000.js&quot;&amp;gt;&amp;lt;/script&amp;gt;&lt;/p&gt;

&lt;p&gt;Example SHOULD:&lt;br/&gt;
&amp;lt;script type=&quot;text/javascript&quot; src=&quot;wicket/resource/org.apache.wicket.markup.html.WicketEventReference/wicket-event-ver-1331911540000.js;jsessionid=${something}&quot;&amp;gt;&amp;lt;/script&amp;gt;&lt;/p&gt;

&lt;p&gt;This creates a new session for each and every resource in the page, which is an undesirable behavior. I have found a few issues regarding this topic, e.g. &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-4334&quot; title=&quot;Prevent Wicket from causing redundant download of stateless resources (.js, .css etc.,) on browser with cookies enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-4334&quot;&gt;&lt;del&gt;WICKET-4334&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-4312&quot; title=&quot;Do not strip the jsessionid from the url for resources&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-4312&quot;&gt;&lt;del&gt;WICKET-4312&lt;/del&gt;&lt;/a&gt;, but none of them could give me a clue about why it doesn&apos;t work the way I expect it. In Wicket 1.4.x the jsessionid was added to all resource links, so everything worked fine and the current session was reused.&lt;/p&gt;

&lt;p&gt;I created a quickstart do demonstrate the behavior - please see the attached file. The file jetty-web.xml tells Jetty to not support cookies, so mvn jetty:run can be run without any further configuration.&lt;/p&gt;

&lt;p&gt;By the way, I found a suggestion to use a custom IResourceCachingStrategy to append the jsessionid (or whatever) to URLs of resources in the archive of the mailinglist. Unfortunately, this doesn&apos;t work because the URL is encoded afterwards and the ; is turned into %3B.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12554659">WICKET-4550</key>
            <summary>jsessionid is not added to resources if cookies are disabled by the server</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="miggel">Michael Bruns</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 May 2012 09:16:12 +0000</created>
                <updated>Mon, 18 Jun 2012 08:42:12 +0000</updated>
                            <resolved>Wed, 16 May 2012 07:58:40 +0000</resolved>
                                    <version>1.5.5</version>
                                    <fixVersion>1.5.7</fixVersion>
                    <fixVersion>6.0.0-beta3</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13272208" author="miggel" created="Thu, 10 May 2012 09:18:29 +0000"  >&lt;p&gt;Quickstart to show the behavior described above. Please execute mvn verify jetty:run, open the application in the browser and look at the &amp;lt;script&amp;gt; tages in the source of the page.&lt;/p&gt;</comment>
                            <comment id="13272211" author="mgrigorov" created="Thu, 10 May 2012 09:20:54 +0000"  >&lt;p&gt;The reason is explained in &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-4334&quot; title=&quot;Prevent Wicket from causing redundant download of stateless resources (.js, .css etc.,) on browser with cookies enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-4334&quot;&gt;&lt;del&gt;WICKET-4334&lt;/del&gt;&lt;/a&gt; - static resources do not need sessionid.&lt;br/&gt;
Only temporary Wicket sessions are created which are discarded at the end of the request. No http sessions are created.&lt;/p&gt;</comment>
                            <comment id="13272226" author="miggel" created="Thu, 10 May 2012 09:47:28 +0000"  >&lt;p&gt;I still can&apos;t exactly understand the reason for this.&lt;/p&gt;

&lt;p&gt;In our scenario, we have two Tomcat instances running on the same machine. One is considered as active, i.e. new sessions are created on this instance, the other is considered as passive, i.e. it only serves sessions which are already open until they expire. When we deploy a new version of our application we deploy it to the passive instance and then switch the configuration of active and passive.&lt;/p&gt;

&lt;p&gt;Let&apos;s consider the following scenario:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Instance A is active, B is passive.&lt;/li&gt;
	&lt;li&gt;The application contains a static resource something.js, which has the hash ABC appended as its version.&lt;/li&gt;
	&lt;li&gt;something.js is changed in a new version of the application, so its new hash is now 123.&lt;/li&gt;
	&lt;li&gt;Then, this new version is deployed to B and B is then made the active instance.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The page served by A now contains a resource link to something-ver-ABC.js. As the jsessionid is lacking, this request will be redirected to the active Tomcat instance, which is B. But B doesn&apos;t know the version ABC of something.js, it only knows something-ver-123.js. The result is a 404.&lt;/p&gt;

&lt;p&gt;Or am I missing something here?&lt;/p&gt;</comment>
                            <comment id="13272282" author="miggel" created="Thu, 10 May 2012 12:45:47 +0000"  >&lt;p&gt;As (bad) luck would have it we just tripped over another error caused by this bug &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Our Tomcats are clustered, i.e. there are three of them behind a load balancer. The sessions are sticky, so that a user stays on the same Tomcat throughout his session. Now we ran into this constellation:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;A new version of our application has been freshly deployed to the three Tomcats T1, T2 and T3.&lt;/li&gt;
	&lt;li&gt;A page mounted at /somePage (or a component used in this page) mounts an image to static URL /img/something.png on instantiation, i.e. when the page is accessed for the first time.&lt;/li&gt;
	&lt;li&gt;A user logs into a new session on Tomcat T1 and accesses the page /somePage.&lt;/li&gt;
	&lt;li&gt;The resource link to /img/something.png served by T1 on page /somePage doesn&apos;t contain a jsessionid.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This will lead to the fact that the new session for /img/something.png, be it temporary or not, will be created on either of the three Tomcats. However, /somePage has only been accessed on T1, which means that both T2 and T3 have not yet mounted the image on the given path and will thus answer with a 404. Only when /somePage has been accessed on all three Tomcats the image will always be delivered. Before that, there is always a chance of 2/3 or 1/3 that you&apos;ll get a 404.&lt;/p&gt;</comment>
                            <comment id="13272859" author="chrisc" created="Thu, 10 May 2012 22:44:01 +0000"  >&lt;p&gt;After 4334 was fixed we confirmed that Wicket was serving static resources without creating a new session - and this is perfect. Static resources should never need a session in order to serve them (definition of static - unchanging regardless of session).&lt;/p&gt;

&lt;p&gt;If you are seeing a session being created now then maybe your code is creating one somehow or something has changed in Wicket since the release we tested that now does create a session even though it is not needed.&lt;/p&gt;

&lt;p&gt;From memory the problem in the Wicket code was a call to &quot;get session&quot; style of method that really was only checking if there was a session, it didn&apos;t really need a session, but it in fact created one in the process if there wasn&apos;t one.&lt;/p&gt;

&lt;p&gt;Check that you don&apos;t have any other filters in the chain in web.xml that might be creating a session. We use exPOJO for Dependency Injection and we need to tell it to ignore requests for wicket resources that have the path wicket/resource like this:&lt;/p&gt;

&lt;p&gt;	&amp;lt;filter&amp;gt;&lt;br/&gt;
		&amp;lt;filter-name&amp;gt;exPOJO Filter&amp;lt;/filter-name&amp;gt;&lt;br/&gt;
		&amp;lt;filter-class&amp;gt;com.sas.framework.expojo.servlet.ExpojoServletFilter&amp;lt;/filter-class&amp;gt;&lt;br/&gt;
		&amp;lt;!-- exPOJO uses &apos;startsWith&apos; method to match, not any regular expression matching so &lt;br/&gt;
			don&apos;t use blah/* here --&amp;gt;&lt;br/&gt;
		&amp;lt;init-param&amp;gt;&lt;br/&gt;
			&amp;lt;param-name&amp;gt;ignorePaths&amp;lt;/param-name&amp;gt;&lt;br/&gt;
			&amp;lt;param-value&amp;gt;wicket/resource/,robots.txt,index.html,static/,css/,images/,swf/,fckeditor&amp;lt;/param-value&amp;gt;&lt;br/&gt;
		&amp;lt;/init-param&amp;gt;&lt;br/&gt;
	&amp;lt;/filter&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13273105" author="mgrigorov" created="Fri, 11 May 2012 07:39:13 +0000"  >&lt;p&gt;The problem is not that a Wicket Session is created but that there is no jsessionid in the url for static resources and thus the routing doesn&apos;t work.&lt;br/&gt;
The problem can be solved by decorating the url of the resources. This way you can transform some/resource.ext to some/resource-server1.ext or some/resource.ext;server=1 and use this as a condition.&lt;/p&gt;

&lt;p&gt;I&apos;d like to not revert 4334 because as its description says: the first request for a page comes with jsessionid in all urls for static resources and then the web container realizes that cookies are supported and removes the jsessionid for the next requests and this leads to double download of all static resources. &lt;/p&gt;</comment>
                            <comment id="13275799" author="mgrigorov" created="Tue, 15 May 2012 14:31:30 +0000"  >&lt;p&gt;Using custom IResourceCachingStrategy is not an option because adding &apos;;jsessionid=...&apos; is later url encoded and the &apos;;&apos; is being lost.&lt;br/&gt;
Using custom request parameter is an option only if you have control on the load balancers. Most of the time the developers have no such control.&lt;/p&gt;

&lt;p&gt;I tried the brutal way: make a quickstart that enables the encoding of the jsessionid in the url even for static resources by either extending classes or copy/paste them but I faced several problems:&lt;br/&gt;
1) org.apache.wicket.request.cycle.RequestCycle#renderUrl(Url, IRequestHandler) decides whether to pass the url to HttpServletResponse#encodeURL()&lt;br/&gt;
By providing my own RequestCycle impl that overrides public CharSequence urlFor(IRequestHandler handler) I partially solved the problem, but &lt;br/&gt;
#urlFor(Class&amp;lt;C&amp;gt; pageClass, PageParameters parameters) and #urlFor(ResourceReference reference, PageParameters params) are final and it is not possible to override them.&lt;/p&gt;

&lt;p&gt;2) HeaderResponse#internalRenderXyzResourceReference() also strips the jsessionid from the url. &lt;br/&gt;
The only way I see here is to copy/paste HeaderResponse and setup it by using IHeaderResponseDecorator (this works)&lt;/p&gt;


&lt;p&gt;After all these hacks I think it will be much easier to introduce a new setting in IResourceSettings with which the application will be able to enable encoding of jsessionid even for the static resources. By default its value will be &apos;do-not-encode-for-static-resources&apos;.&lt;/p&gt;

&lt;p&gt;A patch will come soon.&lt;/p&gt;</comment>
                            <comment id="13275885" author="miggel" created="Tue, 15 May 2012 15:35:11 +0000"  >&lt;p&gt;That&apos;s perfect, thank you &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12593952">WICKET-4609</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12527360" name="WICKET-4550.patch" size="7902" author="mgrigorov" created="Tue, 15 May 2012 15:33:17 +0000"/>
                            <attachment id="12526323" name="jsessionid-quickstart.tar.gz" size="19376" author="miggel" created="Thu, 10 May 2012 09:18:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>238909</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0k8l3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116208</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>