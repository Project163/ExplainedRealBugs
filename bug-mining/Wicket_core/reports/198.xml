<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:17:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-3705] AjaxSubmit in modal window doesn&apos;t call form.onSubmit() before ending request</title>
                <link>https://issues.apache.org/jira/browse/WICKET-3705</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;When a AjaxSubmitLink is used to submit a form inside a ModalWindow, and inside the AjaxSubmitLink#onSubmit() the window is closed, wicket doesn&apos;t call Form.onSubmit()&lt;/p&gt;

&lt;p&gt;See attached quickstart for the scenario.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12506975">WICKET-3705</key>
            <summary>AjaxSubmit in modal window doesn&apos;t call form.onSubmit() before ending request</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dashorst">Martijn Dashorst</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 May 2011 12:51:23 +0000</created>
                <updated>Mon, 7 Nov 2011 09:47:32 +0000</updated>
                                            <version>1.5-RC4</version>
                                                    <component>wicket</component>
                    <component>wicket-extensions</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13032390" author="dashorst" created="Thu, 12 May 2011 13:15:48 +0000"  >&lt;p&gt;Wicket 1.4 quickstart showing that this is in fact a regression&lt;/p&gt;</comment>
                            <comment id="13032414" author="dashorst" created="Thu, 12 May 2011 13:50:21 +0000"  >&lt;p&gt;The processing of form.onSubmit is not executed because in our submitlink#onSubmit() we close the modalWindow, causing the containing panel to be no longer marked visible.&lt;/p&gt;</comment>
                            <comment id="13032535" author="pete" created="Thu, 12 May 2011 17:44:07 +0000"  >&lt;p&gt;Fixed in trunk.&lt;/p&gt;

&lt;p&gt;The test cases report no errors so far. We had a few differences between 1.4 and 1.5. Should be similar again.&lt;/p&gt;

&lt;p&gt;The only remaining difference I see is a different order in processing of the submit:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;First AjaxSubmitLink#onSubmit is invoked&lt;/li&gt;
	&lt;li&gt;Secondly, Form#onSubmit is invoked&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;We also have a test case that demands this order:&lt;/p&gt;

&lt;p&gt;  FormWithMultipleButtonsTest#testAjaxFallbackButtonInvokedFirst&lt;/p&gt;

&lt;p&gt;It points to &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-1894&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/WICKET-1894&lt;/a&gt; where this order is also required.&lt;/p&gt;

&lt;p&gt;So the processing order is different in 1.5 but I think this still is correct.&lt;/p&gt;

&lt;p&gt;If you can confirm that, too, we probably should mention that in the migration guide.&lt;/p&gt;</comment>
                            <comment id="13032579" author="mgrigorov" created="Thu, 12 May 2011 18:54:03 +0000"  >&lt;p&gt;&amp;gt; The test cases report no errors so far.&lt;/p&gt;

&lt;p&gt;Without new test the tests will pass again when someone change the logic.&lt;/p&gt;</comment>
                            <comment id="13032588" author="mgrigorov" created="Thu, 12 May 2011 19:02:42 +0000"  >&lt;p&gt;Reopening the ticket because the order of calling onSubmit is wrong:&lt;/p&gt;

&lt;p&gt;ivaynberg:&lt;br/&gt;
doesnt make sense, onsubmit should go from most inner to outer. means&lt;br/&gt;
also processingForm.onSubmit(); should be called last...&lt;/p&gt;

&lt;p&gt;A test case should be added as well.&lt;/p&gt;</comment>
                            <comment id="13032593" author="ivaynberg" created="Thu, 12 May 2011 19:09:48 +0000"  >&lt;p&gt;...if calling onsubmit at all makes sense... after all it is the parent whose button was pressed that is being submitted....&lt;/p&gt;</comment>
                            <comment id="13032702" author="pete" created="Thu, 12 May 2011 21:55:54 +0000"  >&lt;p&gt;Allright, I see that the current coding is not satisfying...&lt;/p&gt;

&lt;p&gt;I have several questions and would love to get some feedback:&lt;/p&gt;

&lt;p&gt;1. form processing order:&lt;/p&gt;

&lt;p&gt;  this is the order of form processing in 1.4.x (outer to inner form):&lt;/p&gt;

&lt;p&gt;		// call onSubmit on nested forms&lt;br/&gt;
		formToProcess.visitChildren(Form.class, new IVisitor&amp;lt;Form&amp;lt;?&amp;gt;&amp;gt;()&lt;br/&gt;
		{&lt;br/&gt;
			public Object component(Form&amp;lt;?&amp;gt; component)&lt;br/&gt;
			{&lt;br/&gt;
				Form&amp;lt;?&amp;gt; form = component;&lt;br/&gt;
				if (form.isEnabledInHierarchy() &amp;amp;&amp;amp; form.isVisibleInHierarchy())&lt;/p&gt;
				{
					form.onSubmit();
					return IVisitor.CONTINUE_TRAVERSAL;
				}
&lt;p&gt;				return IVisitor.CONTINUE_TRAVERSAL_BUT_DONT_GO_DEEPER;&lt;br/&gt;
			}&lt;br/&gt;
		});&lt;/p&gt;

&lt;p&gt;so do we really want to change that in 1.5 (inner to outer form) ?&lt;/p&gt;

&lt;p&gt;2. in Martijn&apos;s case (= quickstart) the form visibility is changed during form submit processing. Therefore the submitting component&apos;s onSubmit is called but Form#onSubmit not since the submitting component hides the modal windows which implicitly hides the contained form. Do we want that form visibility (and enabled) state changes during submit processing affect subsequent processing?&lt;/p&gt;

&lt;p&gt;3. is staying as close to 1.4.x processing as possible to make migration seamless an issue?&lt;/p&gt;</comment>
                            <comment id="13032706" author="ivaynberg" created="Thu, 12 May 2011 22:04:23 +0000"  >&lt;p&gt;while changes in visibility/enableness should not effect processing within current-request we cannot guarantee it. those changes become live immediately just like with any other component. perhaps what martijn should do is rewrite that code to use a boolean flag and onconfigure to modify visibility...&lt;/p&gt;</comment>
                            <comment id="13032729" author="pete" created="Thu, 12 May 2011 22:46:23 +0000"  >&lt;p&gt;I changed the code so form submit processing goes from innermost (most deeply nested form) to outermost (topmost form) and invisible or disabled forms to not get Form#onSubmit() invoked. Basically that&apos;s the way it was before.&lt;/p&gt;

&lt;p&gt;Only difference is that now in case the submit is caused by a form submitting component (instead of a default submit using basic html behavior) we traverse the form the submitting component is bound to (which could be different from the form the submitting component is added to).&lt;/p&gt;</comment>
                            <comment id="13032899" author="dashorst" created="Fri, 13 May 2011 08:14:34 +0000"  >&lt;p&gt;While we certainly will improve our form processing for this particular case, the issue is that this fails silently in an unexpected manner. While I have the guts to step into Wicket internals to find out what went wrong and discovered what went wrong pretty easily (after creating a quickstart), casual users will not venture that far.&lt;/p&gt;

&lt;p&gt;IMO we should revisit visibility/enabled flags in 1.6 (wicket 3?) and maybe try to move to a more immutable state representation. But for now, I&apos;d rather have we determine which components need to participate in the form processing beforehand based on visibility/enabled flags and then call all listeners that are affected by the submit.&lt;/p&gt;</comment>
                            <comment id="13034327" author="pedrosans" created="Mon, 16 May 2011 21:27:06 +0000"  >&lt;p&gt;This problem can be addressed by freeze the component tree state while processing the form. It can be done by queuing state change actions to be applied only after the form processing end.&lt;br/&gt;
I&apos;m sending a patch with an initial implementation that already solves this ticket problem and test cases preventing it.&lt;/p&gt;

&lt;p&gt;@devs, what do you think about this strategy to increase the state consistency while processing the form? If it is OK then we can start coding the real solution (the patch is only to show up this idea in code).&lt;/p&gt;</comment>
                            <comment id="13034351" author="ivaynberg" created="Mon, 16 May 2011 21:49:15 +0000"  >&lt;p&gt;i really dont like this. we would have to buffer every possible action that modifies the hierarchy.&lt;/p&gt;

&lt;p&gt;visible and enabled are easy enough. but what if i replace an inner form with another one? we cant buffer all possible operations.&lt;/p&gt;

&lt;p&gt;i think the users should simply be aware of what they are doing.&lt;/p&gt;

&lt;p&gt;also what will help here is to call onsubmit() in reverse order since it is a much less likely usecase that a child form modifies it&apos;s parent hierarchy.&lt;/p&gt;

&lt;p&gt;so onsubmit() on inner forms first going up to the root form. cant in 1.4.x but in 1.5.x we can.&lt;/p&gt;

&lt;p&gt;as a work around in 1.4.x we can visit the forms first and store them in a list, then iterate the list and call onsubmit() - which i think is what martijn suggested above.&lt;/p&gt;</comment>
                            <comment id="13034741" author="pedrosans" created="Tue, 17 May 2011 12:58:23 +0000"  >&lt;p&gt;Sure, I noticed that I miss the involved complexity about state caching.&lt;/p&gt;

&lt;p&gt;The same work around in 1.4 would have to be done in 1.5 because only reverse onsubmit() sequence is not enough for all use cases.&lt;/p&gt;

&lt;p&gt;Mark a flag to trigger some action coded in onConfigure is a good user solution. What if we try to make clear that it&apos;s user responsibility to delay form processing sensitive changes to render phase? An possible improvement is this direction would be create the FormProcessing type that would be visible by all submit callbacks, and would provide an API do schedule post submit actions.&lt;br/&gt;
e.g.&lt;br/&gt;
add(new Button(){&lt;br/&gt;
  onSubmit(processing){&lt;br/&gt;
    //here code not involving interface like queries or data manipulation&lt;br/&gt;
    processing.schedule(new Action()&lt;/p&gt;
{ rootForm.disableBecauseSomeDataReachedSomeState();}
&lt;p&gt;);&lt;br/&gt;
  };&lt;br/&gt;
});&lt;/p&gt;</comment>
                            <comment id="13034871" author="ivaynberg" created="Tue, 17 May 2011 16:43:13 +0000"  >&lt;p&gt;i still think its too complex. and this is a very rare usecase - first time it happened since wicket has been around. i say we just memoize the set of forms we have to visit and visit them.&lt;/p&gt;</comment>
                            <comment id="13049063" author="mgrigorov" created="Tue, 14 Jun 2011 08:35:35 +0000"  >&lt;p&gt;Do we have an agreement how to solve this problem ?&lt;br/&gt;
We have to solve it soon unless it is OK to leave for 1.5.0+.&lt;/p&gt;</comment>
                            <comment id="13088620" author="dashorst" created="Mon, 22 Aug 2011 11:39:13 +0000"  >&lt;p&gt;The use case is not very rare since it only happens after changes made to stricter visibility checks in late 1.4 and 1.5 releases. Previous versions didn&apos;t check visibility that strict AFAIK. The code in question in our app worked fine with 1.4.x (not sure when we left the 1.4 train).&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12479383" name="WICKET-3705.patch" size="11237" author="pedrosans" created="Mon, 16 May 2011 21:27:06 +0000"/>
                            <attachment id="12478960" name="myproject-1.4.tgz" size="18986" author="dashorst" created="Thu, 12 May 2011 13:15:48 +0000"/>
                            <attachment id="12478958" name="myproject.tgz" size="19020" author="dashorst" created="Thu, 12 May 2011 12:52:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2600</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00wnb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3221</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>