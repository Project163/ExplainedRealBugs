<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:20:36 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-4646] atomicity violation bugs of using concurrent collections</title>
                <link>https://issues.apache.org/jira/browse/WICKET-4646</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;My name is Yu Lin. I&apos;m a Ph.D. student in the CS department at&lt;br/&gt;
UIUC. I&apos;m currently doing research on mining Java concurrent library&lt;br/&gt;
misusages. I found some misusages of ConcurrentHashMap in wicket&lt;br/&gt;
1.5.7, which may result in potential atomicity violation bugs.&lt;/p&gt;

&lt;p&gt;The code below is a snapshot of the code in file&lt;br/&gt;
src/wicket-core/src/main/java/org/apache/wicket/request/resource/PackageResourceReference.java from line 152 to 157&lt;/p&gt;

&lt;p&gt;L152        UrlAttributes value = urlAttributesCacheMap.get(key);&lt;br/&gt;
L153        if (value == null)&lt;br/&gt;
L154        &lt;/p&gt;
{
L155            value = getUrlAttributes(locale, style, variation);
L156            urlAttributesCacheMap.put(key, value);
L157        }

&lt;p&gt;In the code above, an atomicity violation may occur between lines &amp;lt;154&lt;br/&gt;
and 156&amp;gt;. Suppose a thread T1 executes line 152 and finds out the&lt;br/&gt;
concurrent hashmap does not contain the key &quot;key&quot;. Before it gets to&lt;br/&gt;
execute line 156, another thread T2 puts a pair &amp;lt;key, v&amp;gt; in the&lt;br/&gt;
concurrent hashmap &quot;urlAttributesCacheMap&quot;. Now thread T1 resumes&lt;br/&gt;
execution and it will overwrite the value written by thread T2. Thus,&lt;br/&gt;
the code no longer preserves the &quot;put-if-absent&quot; semantics. By using&lt;br/&gt;
putIfAbsent method, we can eliminated this atomicity violation (see&lt;br/&gt;
patch).&lt;/p&gt;

&lt;p&gt;I found some similar atomicity violations in other files:&lt;/p&gt;

&lt;p&gt;In&lt;br/&gt;
src/wicket-core/src/main/java/org/apache/wicket/util/lang/PropertyResolver.java,&lt;br/&gt;
atomicity violation may occur if thread T2 puts a value to the map&lt;br/&gt;
between lines &amp;lt;385 and 522&amp;gt; or &amp;lt;234 and 260&amp;gt;. However, it seems map&lt;br/&gt;
&quot;getAndSetters&quot; is not always a ConcurrentHashMap that the first&lt;br/&gt;
atomicity violation at line 522 cannot be fixed by using putIfAbsent,&lt;br/&gt;
so should we use synchronized?&lt;/p&gt;

&lt;p&gt;In&lt;br/&gt;
src/wicket-core/src/main/java/org/apache/wicket/session/DefaultPageFactory.java,&lt;br/&gt;
atomicity violation may occur if thread T2 puts a value to the map&lt;br/&gt;
between lines &amp;lt;124 and 131&amp;gt; or &amp;lt;234 and 260&amp;gt;.&lt;/p&gt;

&lt;p&gt;In&lt;br/&gt;
src/wicket-core/src/test/java/org/apache/wicket/versioning/InMemoryPageStore.java,&lt;br/&gt;
atomicity violation may occur if thread T2 puts a value to the map&lt;br/&gt;
between lines &amp;lt;95 and 97&amp;gt;.&lt;/p&gt;

&lt;p&gt;In&lt;br/&gt;
src/wicket-spring/src/main/java/org/apache/wicket/spring/injection/annot/AnnotProxyFieldValueFactory.java,&lt;br/&gt;
atomicity violation may occur if thread T2 puts a value to the map&lt;br/&gt;
between lines &amp;lt;127 and 142&amp;gt; or &amp;lt;165 and 170&amp;gt;.&lt;/p&gt;

&lt;p&gt;In &lt;br/&gt;
src/wicket-util/src/main/java/org/apache/wicket/util/convert/converter/AbstractIntegerConverter.java,&lt;br/&gt;
atomicity violation may occur if thread T2 puts a value to the map&lt;br/&gt;
between lines &amp;lt;47 and 51&amp;gt;.&lt;/p&gt;

&lt;p&gt;In &lt;br/&gt;
src/wicket-util/src/main/java/org/apache/wicket/util/watch/ModificationWatcher.java,&lt;br/&gt;
atomicity violation may occur if thread T2 puts a value to the map&lt;br/&gt;
between lines &amp;lt;95 and 107&amp;gt;.&lt;/p&gt;

&lt;p&gt;Meanwhile, there may be an atomicty violation between lines &amp;lt;190 and 200&amp;gt; in &lt;br/&gt;
src/wicket-core/src/main/java/org/apache/wicket/feedback/FeedbackMessages.java.&lt;br/&gt;
Suppose thread T1 finds list &quot;messages&quot; is not empty at line&lt;br/&gt;
187. Before T1 removes &quot;toDelete&quot; from &quot;messages&quot; at line 200, T1&lt;br/&gt;
suspends and another thread T2 removes the same &quot;toDelete&quot; from &quot;messages&quot;. &lt;br/&gt;
When T1 resumes, it will remove nothing and &quot;clear&quot; will return the wrong value (in&lt;br/&gt;
this case, &quot;clear&quot; method should return 0). Though I&apos;m not sure whether this scenario &lt;br/&gt;
will happen, I also provide a patch for this atomicty violation.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12598123">WICKET-4646</key>
            <summary>atomicity violation bugs of using concurrent collections</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="jacklondongood">Yu Lin</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Tue, 10 Jul 2012 03:01:17 +0000</created>
                <updated>Mon, 23 Jul 2012 10:58:12 +0000</updated>
                            <resolved>Mon, 23 Jul 2012 10:58:12 +0000</resolved>
                                    <version>1.5.7</version>
                                    <fixVersion>1.5.8</fixVersion>
                    <fixVersion>6.0.0</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="1814400">504h</timeoriginalestimate>
                            <timeestimate seconds="1814400">504h</timeestimate>
                                        <comments>
                            <comment id="13410023" author="jacklondongood" created="Tue, 10 Jul 2012 03:03:43 +0000"  >&lt;p&gt;This is a patch that can fix the atomicity violation bugs.&lt;/p&gt;</comment>
                            <comment id="13420555" author="mgrigorov" created="Mon, 23 Jul 2012 10:58:12 +0000"  >&lt;p&gt;Thank you!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12535779" name="fix-WICKET-4646.patch" size="9368" author="jacklondongood" created="Tue, 10 Jul 2012 03:03:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>257732</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0k8dz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116176</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>