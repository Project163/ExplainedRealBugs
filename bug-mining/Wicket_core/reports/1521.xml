<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:26:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-6810] Asynchronous+encrypted pagestore leads to WicketRuntimeException</title>
                <link>https://issues.apache.org/jira/browse/WICKET-6810</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;If you have a Wicket application with the default DefaultPageManagerProvider (which sets a chain of PageStores) and with the storesettings &quot;encrypted&quot; and &quot;asynchronous&quot; on true (so your chain contains the&#160;AsynchronousPageStore and the&#160;CryptingPageStore), you get a WicketRuntimeException on the asynchronous pagestore thread upon the first page load.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;This is because the asynchronous thread has no session, which the CryptingPageStore requires, leading to an exception (stacktrace below).&lt;/p&gt;

&lt;p&gt;A working test is somewhat difficult to achieve without mocking &lt;em&gt;everything&lt;/em&gt; to simulate this behaviour (because the default mocked wicket stuff such as MockPageContext avoid this bug) but it should be enough to just add&#160;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
getStoreSettings().setAsynchronous(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;).setEncrypted(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to the init of a default wicket application that has the DefaultPageManagerProvider.&lt;/p&gt;

&lt;p&gt;This might not be easy to solve and therefore an unsupported configuration but given that you can create it by simply setting two properties to true, without any indication that it is wrong, it seems like a configuration bug at the least.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Stacktrace:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2020-08-05 21:02:39,303 ERROR [stderr] (Wicket-AsyncPageStore-PageSavingThread) Exception in thread &quot;Wicket-AsyncPageStore-PageSavingThread&quot; org.apache.wicket.WicketRuntimeException: There is no application attached to current thread Wicket-AsyncPageStore-PageSavingThread
2020-08-05 21:02:39,303 ERROR [stderr] (Wicket-AsyncPageStore-PageSavingThread) 	at deployment.keyhub-web-console.war//org.apache.wicket.Application.get(Application.java:213)
2020-08-05 21:02:39,304 ERROR [stderr] (Wicket-AsyncPageStore-PageSavingThread) 	at deployment.keyhub-web-console.war//org.apache.wicket.Session.get(Session.java:181)
2020-08-05 21:02:39,304 ERROR [stderr] (Wicket-AsyncPageStore-PageSavingThread) 	at deployment.keyhub-web-console.war//org.apache.wicket.pageStore.DefaultPageContext.getSessionData(DefaultPageContext.java:74)
2020-08-05 21:02:39,304 ERROR [stderr] (Wicket-AsyncPageStore-PageSavingThread) 	at deployment.keyhub-web-console.war//org.apache.wicket.pageStore.AsynchronousPageStore$PendingAdd.getSessionData(AsynchronousPageStore.java:214)
2020-08-05 21:02:39,304 ERROR [stderr] (Wicket-AsyncPageStore-PageSavingThread) 	at deployment.keyhub-web-console.war//org.apache.wicket.pageStore.CryptingPageStore.getSessionData(CryptingPageStore.java:90)
2020-08-05 21:02:39,304 ERROR [stderr] (Wicket-AsyncPageStore-PageSavingThread) 	at deployment.keyhub-web-console.war//org.apache.wicket.pageStore.CryptingPageStore.addPage(CryptingPageStore.java:135)
2020-08-05 21:02:39,304 ERROR [stderr] (Wicket-AsyncPageStore-PageSavingThread) 	at deployment.keyhub-web-console.war//org.apache.wicket.pageStore.SerializingPageStore.addPage(SerializingPageStore.java:82)
2020-08-05 21:02:39,304 ERROR [stderr] (Wicket-AsyncPageStore-PageSavingThread) 	at deployment.keyhub-web-console.war//org.apache.wicket.pageStore.AsynchronousPageStore$PageAddingRunnable.run(AsynchronousPageStore.java:278)
2020-08-05 21:02:39,304 ERROR [stderr] (Wicket-AsyncPageStore-PageSavingThread) 	at java.base/java.lang.Thread.run(Thread.java:832)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13321145">WICKET-6810</key>
            <summary>Asynchronous+encrypted pagestore leads to WicketRuntimeException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="svenmeier">Sven Meier</assignee>
                                    <reporter username="buurman.sven@gmail.com">Sven Haster</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Aug 2020 19:04:46 +0000</created>
                <updated>Wed, 5 Aug 2020 21:54:16 +0000</updated>
                            <resolved>Wed, 5 Aug 2020 21:54:16 +0000</resolved>
                                    <version>9.0.0</version>
                                    <fixVersion>9.1.0</fixVersion>
                                    <component>wicket-core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17171736" author="buurman.sven@gmail.com" created="Wed, 5 Aug 2020 20:20:10 +0000"  >&lt;p&gt;The problem is the AsyncronousPageContext, on its page-adding-thread, delegates the getSessionData call to the original IPageContext, which is most likely a DefaultPageContext, which then tries to get the Session (via Session.get())from the current (page-adding-)thread. &lt;br/&gt;
This thread of course has no Session but it tries to instantiate one via the Application (Application.get()), which then throws the error because this (page-adding-)thread also doesn&apos;t have an Application bound.&lt;/p&gt;</comment>
                            <comment id="17171742" author="buurman.sven@gmail.com" created="Wed, 5 Aug 2020 20:33:21 +0000"  >&lt;p&gt;The CryptingPageStore (and some other stores as well) needs the session metadata to get and store specific information, such as the cryptographic key used to encrypt the pages. It can&apos;t use a dummy or fresh session because then the original session doesn&apos;t have this key. The asynchronous pagestore also can&apos;t cache this data because it&apos;s outside its responsibilities (also, should it do the same for other pagestores? What about non-wicket pagestores?).&lt;/p&gt;

&lt;p&gt;I don&apos;t think the asynchronous pagestore can keep a reference to the original session(&apos;s metadata) because that would probably defeat the purpose of the session store.&lt;/p&gt;

&lt;p&gt;I think this is also a problem for other stores which store specific information in the session&apos;s metadata, such as the GroupingPageStore, but it might not have been that big of a problem there.&lt;/p&gt;</comment>
                            <comment id="17171745" author="buurman.sven@gmail.com" created="Wed, 5 Aug 2020 20:38:27 +0000"  >&lt;p&gt;Apart from disallowing this combination of pagestores (and all other combinations with asynchronous and session metadata?), the only solution I can think of off the top of my head is for the asynchronous pagestore to ask all its delegate stores what data they need so it can cache it in its PendingAdd pagecontext. But is quite a rewrite, an API add and not a full solution (since a situation is conceivable where a delegate store&apos;s answer would be different on a different thread or at a different time).&lt;/p&gt;</comment>
                            <comment id="17171783" author="jira-bot" created="Wed, 5 Aug 2020 21:48:37 +0000"  >&lt;p&gt;Commit c26f3dc315dfdae9e51e7fdb97c13113d6845073 in wicket&apos;s branch refs/heads/master from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=c26f3dc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=c26f3dc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6810&quot; title=&quot;Asynchronous+encrypted pagestore leads to WicketRuntimeException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6810&quot;&gt;&lt;del&gt;WICKET-6810&lt;/del&gt;&lt;/a&gt; fix asynchronous encryption&lt;/p&gt;</comment>
                            <comment id="17171788" author="svenmeier" created="Wed, 5 Aug 2020 21:54:16 +0000"  >&lt;p&gt;The API for stores to prepare for asynchronous adding of pages is already in place: AsynchronousPageStore asks IPageStore#canBeAsynchronous(), which allows store implementations to pre-fetch required session attributes.&lt;/p&gt;

&lt;p&gt;When implementing I just forgot to cache session metadata too (which is used by CryptingPageStore).&lt;/p&gt;

&lt;p&gt;This is fixed in 9.1.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 14 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hi7k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>