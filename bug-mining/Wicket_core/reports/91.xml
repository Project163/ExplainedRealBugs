<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:17:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-3511] Mapping ResourceReferences to Urls is slow</title>
                <link>https://issues.apache.org/jira/browse/WICKET-3511</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;PackageResourceReference is often used for stylesheets and JavaScript resources, many of which can appear on a typical page (WicketAjaxReference is one common example). Every time the page is rendered, these resources are mapped to urls in order to build the appropriate &amp;lt;link href=&quot;...&quot;&amp;gt; or &amp;lt;script src=&quot;...&quot;&amp;gt; tags.&lt;/p&gt;

&lt;p&gt;The trouble is that this mapping process is extremely inefficient. To map a ResourceReference to a url, ResourceReference#getLastModified() must be consulted for FilenameWithTimestampResourceCachingStrategy, and ResourceReference#getUrlAttributes() is called to append appropriate query parameters.&lt;/p&gt;

&lt;p&gt;In PackageResourceReference, both of these methods delegate to the very expensive PackageResourceReference#lookupStream(), which makes several attempts to locate the underlying file or classpath item using various permutations of locale, style, and variation. Each of these attempts involves I/O. The default ResourceStreamLocator, which does the actual file and classpath queries, does no caching whatsoever.&lt;/p&gt;

&lt;p&gt;On a trivial Wicket page containing 7 total PackageResourceReferences for images, stylesheets and JavaScript files, the average response time in my tests was 211 ms. The vast majority of that time was spent in ResourceStreamLocator, due to the expensive steps described above.&lt;/p&gt;

&lt;p&gt;It seems that putting caching at the ResourceStreamLocator would be extremely beneficial. I am attaching a simple implementation. With caching enabled in ResourceStreamLocator, the response time of my test page dropped from 211 ms to 49 ms.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12500583">WICKET-3511</key>
            <summary>Mapping ResourceReferences to Urls is slow</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="mbrictson">Matt Brictson</reporter>
                        <labels>
                    </labels>
                <created>Sun, 6 Mar 2011 22:00:26 +0000</created>
                <updated>Thu, 31 Mar 2011 16:13:08 +0000</updated>
                            <resolved>Thu, 31 Mar 2011 16:13:08 +0000</resolved>
                                    <version>1.5-RC2</version>
                                    <fixVersion>1.5-RC3</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13004159" author="mgrigorov" created="Tue, 8 Mar 2011 19:45:30 +0000"  >&lt;p&gt;Here is a bit lighter version from me.&lt;br/&gt;
Indeed the Wicket tests run 10 secs less here.&lt;br/&gt;
If my patch doesn&apos;t take away the benefit for your app then I&apos;ll update the javadoc and commit it.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13004182" author="mbrictson" created="Tue, 8 Mar 2011 20:21:34 +0000"  >&lt;p&gt;Martin, I tested your patch and it yields the same performance benefit. Looks good to me. Thanks!&lt;/p&gt;</comment>
                            <comment id="13004281" author="ivaynberg" created="Tue, 8 Mar 2011 23:19:30 +0000"  >&lt;p&gt;i think it may make more sense to handle this outside the hierarchy of IResourceStreamLocator, something like IResourceStreamCache that would have its own getter/setter.&lt;/p&gt;

&lt;p&gt;otherwise all custom resource stream locators would have to wrap themselves in caching decorators or build caching on their own, which seems a waste since caching is very much orthogonal in this case.&lt;/p&gt;</comment>
                            <comment id="13004730" author="mgrigorov" created="Wed, 9 Mar 2011 19:03:01 +0000"  >&lt;p&gt;A better implementation which may be used with any kind of IResourceStreamLocator implementation.&lt;/p&gt;


&lt;p&gt;org.apache.wicket.settings.def.ResourceSettings.getResourceStreamLocator() is called from many places and introducing IResourceStreamCache would not be that simple.&lt;/p&gt;

&lt;p&gt;What do you think ?&lt;/p&gt;</comment>
                            <comment id="13004759" author="ivaynberg" created="Wed, 9 Mar 2011 19:46:31 +0000"  >&lt;p&gt;i guess we can live with it in 1.5. i dont think many people implement custom ones anyways...we should add a big javadoc to the setter letting people know to wrap their stuff in the caching decorator. also i think settings should keep a copy of the original so that get will return the naked one, not the caching decorator one.&lt;/p&gt;</comment>
                            <comment id="13004763" author="ivaynberg" created="Wed, 9 Mar 2011 19:57:50 +0000"  >&lt;p&gt;of course the above doesnt make sense, unless we add another getter...not sure. might be too much. i think the javadoc should be enough.&lt;/p&gt;</comment>
                            <comment id="13004766" author="mbrictson" created="Wed, 9 Mar 2011 20:00:33 +0000"  >&lt;p&gt;Martin, I don&apos;t think your latest patch accomplishes what I was originally setting out to do with the cache. The most time consuming operations are the multiple calls that PackageResourceReference makes to locate(Class&amp;lt;?&amp;gt;, String, String, String, Locale, String, boolean). For the sake of discussion let&apos;s call that method &quot;complex locate&quot;. By subclassing ResourceStreamLocator and overriding the simpler locate(Class&amp;lt;?&amp;gt;, String) (let&apos;s call it &quot;simple locate&quot;, we are taking advantage of the fact that ResourceStreamLocate internally delegates to the simple locate method in order to implement the complex one.&lt;/p&gt;

&lt;p&gt;So for example, calling the complex locate may internally involve many calls to the simple locate. By overriding the simple locate and putting caching there, we therefore get caching for both methods.&lt;/p&gt;

&lt;p&gt;However this approach (that is, putting caching on just the simple locate()) will not work as a decorator pattern. Therefore the decorator needs to implement caching for both the simple and complex locate method in order to be effective.&lt;/p&gt;</comment>
                            <comment id="13004767" author="mbrictson" created="Wed, 9 Mar 2011 20:04:25 +0000"  >&lt;p&gt;Also, I should point out that adding caching like this may frustrate developers running their app in development mode: they might not be able to add localized resources to the app on the fly, since those resources could already be cached as &quot;not found&quot;. They will potentially need to restart the app in order to flush the cache and pick up new resources.&lt;/p&gt;

&lt;p&gt;Perhaps we should only apply the decorator in deployment mode?&lt;/p&gt;</comment>
                            <comment id="13004920" author="pete" created="Thu, 10 Mar 2011 01:13:01 +0000"  >&lt;p&gt;+1 for the disabling in development mode&lt;/p&gt;</comment>
                            <comment id="13004984" author="mgrigorov" created="Thu, 10 Mar 2011 07:13:59 +0000"  >&lt;p&gt;A patch that uses the caching only in deployment mode.&lt;/p&gt;</comment>
                            <comment id="13004985" author="mgrigorov" created="Thu, 10 Mar 2011 07:21:25 +0000"  >&lt;p&gt;Matt, I see my mistake. Indeed the caching doesn&apos;t work with my latest patch. I&apos;ll think it.&lt;/p&gt;</comment>
                            <comment id="13005270" author="mgrigorov" created="Thu, 10 Mar 2011 19:23:13 +0000"  >&lt;p&gt;See r1080326 in trunk.&lt;br/&gt;
If you think it is ok then we may port it to 1.4.x too.&lt;/p&gt;</comment>
                            <comment id="13005289" author="mgrigorov" created="Thu, 10 Mar 2011 19:53:12 +0000"  >&lt;p&gt;Oh, working late is not very productive.&lt;br/&gt;
Caching misses is broken. Will improve it soon.&lt;/p&gt;</comment>
                            <comment id="13005313" author="ivaynberg" created="Thu, 10 Mar 2011 20:25:53 +0000"  >&lt;p&gt;im wondering why this isnt a problem in 1.4, maybe that already has caching in place that we lost with the rewrite of this portion of code. if you have time to research i would love to know the details.&lt;/p&gt;</comment>
                            <comment id="13006256" author="mgrigorov" created="Sun, 13 Mar 2011 19:15:19 +0000"  >&lt;p&gt;With r1081200 the broken caching for misses is fixed.&lt;/p&gt;

&lt;p&gt;Matt can you verify that everything is as supposed now ?&lt;br/&gt;
Also can you make the same measurements for Wicket 1.4. I guess we need to merge this improvement there as well.&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="13006532" author="mbrictson" created="Mon, 14 Mar 2011 17:55:19 +0000"  >&lt;p&gt;Martin, I tested your latest changes in trunk and they work great.&lt;/p&gt;

&lt;p&gt;I don&apos;t think this needs to be merged into Wicket 1.4.x since the performance isn&apos;t a problem there. From what I can tell, ResourceReferences in Wicket 1.4. are resolved and cached upon first access, which minimizes the number of times ResourceStreamLocator is used.&lt;/p&gt;</comment>
                            <comment id="13014048" author="mgrigorov" created="Thu, 31 Mar 2011 16:13:08 +0000"  >&lt;p&gt;Close as fixed in RC3 which will be announced soon.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12472790" name="CachingResourceStreamLocator.java" size="2537" author="mbrictson" created="Sun, 6 Mar 2011 22:00:42 +0000"/>
                            <attachment id="12473242" name="WICKET-3511.patch" size="9122" author="mgrigorov" created="Thu, 10 Mar 2011 07:13:59 +0000"/>
                            <attachment id="12473174" name="WICKET-3511.patch" size="8725" author="mgrigorov" created="Wed, 9 Mar 2011 19:03:01 +0000"/>
                            <attachment id="12473032" name="WICKET-3511.patch" size="5716" author="mgrigorov" created="Tue, 8 Mar 2011 19:45:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204291</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 34 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0kaqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116557</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>