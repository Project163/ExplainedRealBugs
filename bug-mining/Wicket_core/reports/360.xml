<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:18:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-4012] Component&apos;s onAfterRender() is called so many times as it is depth in the component tree + 1</title>
                <link>https://issues.apache.org/jira/browse/WICKET-4012</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;org.apache.wicket.Component.afterRender() calls org.apache.wicket.Component.onAfterRenderChildren() which for MarkupContainers calls afterRender() for its children.&lt;/p&gt;

&lt;p&gt;So for code like:&lt;/p&gt;

&lt;p&gt; WebMarkupContainer comp1 = new WebMarkupContainer(&quot;c1&quot;);&lt;br/&gt;
        add(comp1);&lt;/p&gt;

&lt;p&gt;        WebMarkupContainer comp2 = new WebMarkupContainer(&quot;c2&quot;);&lt;br/&gt;
        comp1.add(comp2);&lt;/p&gt;

&lt;p&gt;        WebMarkupContainer comp3 = new WebMarkupContainer(&quot;c3&quot;) {&lt;/p&gt;

&lt;p&gt;            @Override&lt;br/&gt;
            protected void onAfterRender() &lt;/p&gt;
{
                super.onAfterRender();
                System.err.println(&quot;called&quot;);
            }

&lt;p&gt;        };&lt;br/&gt;
        comp2.add(comp3);&lt;/p&gt;

&lt;p&gt;you&apos;ll see &quot;called&quot; printed 4 times in a single request.&lt;/p&gt;

&lt;p&gt;Additionally I think onAfterRenderChildren() should be called before onAfterRender() in Component.afterRender(). The flow should be first-in last-out: onBeforeRender &amp;gt; onBeforeRenderChildren &amp;gt; onAfterRenderChildren &amp;gt; onAfterRender,&lt;/p&gt;</description>
                <environment></environment>
        <key id="12520974">WICKET-4012</key>
            <summary>Component&apos;s onAfterRender() is called so many times as it is depth in the component tree + 1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="mgrigorov">Martin Tzvetanov Grigorov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Aug 2011 20:53:22 +0000</created>
                <updated>Mon, 5 Sep 2011 14:41:38 +0000</updated>
                            <resolved>Mon, 5 Sep 2011 14:41:38 +0000</resolved>
                                    <version>1.5-RC7</version>
                                    <fixVersion>1.5.1</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13094887" author="mgrigorov" created="Wed, 31 Aug 2011 20:54:21 +0000"  >&lt;p&gt;A quickstart showing the problem&lt;/p&gt;</comment>
                            <comment id="13094891" author="mgrigorov" created="Wed, 31 Aug 2011 20:55:15 +0000"  >&lt;p&gt;I tried to add new request flag and call #afterRender() just once but then 4 tests failed. Needs some more investigation.&lt;/p&gt;</comment>
                            <comment id="13095145" author="mgrigorov" created="Thu, 1 Sep 2011 06:57:56 +0000"  >&lt;p&gt;The same pattern is used for onDetach().&lt;/p&gt;

&lt;p&gt;Modify the quickstart to:&lt;br/&gt;
WebMarkupContainer comp3 = new WebMarkupContainer(&quot;c3&quot;) {&lt;/p&gt;

&lt;p&gt;            @Override&lt;br/&gt;
            protected void onAfterRender() &lt;/p&gt;
{
                super.onAfterRender();
                System.err.println(&quot;called&quot;);
            }

&lt;p&gt;            @Override&lt;br/&gt;
            protected void onDetach() &lt;/p&gt;
{
                super.onDetach();
                System.err.println(&quot;onDetach&quot;);
            }
&lt;p&gt;        };&lt;/p&gt;

&lt;p&gt;And you&apos;ll see onDetach twice per request. Again the parent component calls onDetach for all its children and this call is recursive.&lt;/p&gt;

&lt;p&gt;Is there a hidden purpose here ?&lt;/p&gt;</comment>
                            <comment id="13095147" author="mgrigorov" created="Thu, 1 Sep 2011 07:00:47 +0000"  >&lt;p&gt;In 1.4 both onAfterRender and onDetach are called just once per component. So this is definitely a bug.&lt;/p&gt;</comment>
                            <comment id="13095168" author="mgrigorov" created="Thu, 1 Sep 2011 07:30:10 +0000"  >&lt;p&gt;The reason for onDetach called twice is org.apache.wicket.request.handler.RenderPageRequestHandler.detach(IRequestCycle). It calls pageInstance.detach() and later org.apache.wicket.page.RequestAdapter.commitRequest() also calls page.detach().&lt;/p&gt;</comment>
                            <comment id="13095177" author="dashorst" created="Thu, 1 Sep 2011 08:08:47 +0000"  >&lt;p&gt;The latter is because you can have many page instances scheduled during a request, and they all should be detached: hence RenderPageRequestHandler.detach().&lt;/p&gt;</comment>
                            <comment id="13095179" author="mgrigorov" created="Thu, 1 Sep 2011 08:13:56 +0000"  >&lt;p&gt;All scheduled pages are &quot;touched&quot; during their construction (see the call to init() at org.apache.wicket.Page.Page(PageParameters, IModel&amp;lt;?&amp;gt;)). At the end of the request all touched pages are detached in org.apache.wicket.page.RequestAdapter.commitRequest() and only the stateful ones are stored in the page stores.&lt;/p&gt;

&lt;p&gt;I&apos;d be grateful for some help with onAfterRender() problem.&lt;/p&gt;</comment>
                            <comment id="13095202" author="mgrigorov" created="Thu, 1 Sep 2011 09:32:51 +0000"  >&lt;p&gt;org.apache.wicket.ComponentTest.detachPage() should be improved too.&lt;br/&gt;
It checks whether onDetach() is called at least once, but it seems OK to be called 2+ times in a request.&lt;/p&gt;</comment>
                            <comment id="13095367" author="mgrigorov" created="Thu, 1 Sep 2011 15:56:12 +0000"  >&lt;p&gt;Attaching the patch for onDetach().&lt;br/&gt;
According to Igor we can ignore that because onDetach() is noop most of the time or just detaches some non-default models in the rare cases when it is used.&lt;br/&gt;
I&apos;m attaching the patch just in case it may be needed some day. It should be cleaned if ever applied.&lt;/p&gt;</comment>
                            <comment id="13095580" author="mgrigorov" created="Thu, 1 Sep 2011 20:21:47 +0000"  >&lt;p&gt;The solution for the problem with onAfterRender() is to remove org.apache.wicket.MarkupContainer.onAfterRenderChildren().&lt;br/&gt;
There is no need of this method. Component.afterRender() is called right after internalRender() in Component.render().&lt;br/&gt;
Parent&apos;s afterRender() comes after its children afterRender() so there is no reason to call it again.&lt;/p&gt;

&lt;p&gt;But now there are 4 tests for Enclosures which fail...&lt;/p&gt;</comment>
                            <comment id="13095842" author="mgrigorov" created="Fri, 2 Sep 2011 07:44:32 +0000"  >&lt;p&gt;Attaching a patch for onAfterRender() problem.&lt;br/&gt;
Now instead of calling onAfterRender() on the children components which normally already had executed this method we just set RENDERING_FLAG to false. This is needed because of two reasons:&lt;br/&gt;
1) this flag is being set even for invisible components (see org.apache.wicket.Component.internalRender(), line 2320 and the check in 2332)&lt;br/&gt;
2) in Ajax request Enclosure needs to update this flag for its child component. The specifics are not very clear to me.&lt;/p&gt;</comment>
                            <comment id="13096038" author="ivaynberg" created="Fri, 2 Sep 2011 15:19:36 +0000"  >&lt;p&gt;looks ok&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12492724" name="WICKET-4012-afterRender.patch" size="1865" author="mgrigorov" created="Fri, 2 Sep 2011 07:44:32 +0000"/>
                            <attachment id="12492618" name="detachedTwice.patch" size="5485" author="mgrigorov" created="Thu, 1 Sep 2011 15:56:12 +0000"/>
                            <attachment id="12492522" name="wicket-4012.tar.gz" size="18093" author="mgrigorov" created="Wed, 31 Aug 2011 20:54:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62679</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0k9i7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116357</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>