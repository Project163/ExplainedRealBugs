<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:19:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-4161] AbstractResourceAggregatingHeaderResponse does not order javascript properly</title>
                <link>https://issues.apache.org/jira/browse/WICKET-4161</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;I decided to give AbstractResourceAggregatingHeaderResponse a try but I found a problem in its design that, I think, makes it unusable.&lt;/p&gt;

&lt;p&gt;How it works:&lt;br/&gt;
1-the IHeaderResponse#renderJavaScriptReference(ResourceReference) methods are intercepted and the resource references are stored in a list and not rendered right away. Each resource ref is assigned a key for grouping.&lt;/p&gt;

&lt;p&gt;2-When close() is called on the response, the aggregator writes out all the accumulated resource references which have not been rendered yet. This step can be used to group multiple resources into a single merged resource.&lt;/p&gt;

&lt;p&gt;The problem:&lt;br/&gt;
AbstractResourceAggregatingHeaderResponse does not intercept calls to IHeaderResponse#renderJavaScriptReference(url) or IHeaderResponse#renderJavaScript(Script). They are directly executed by the underlying response.&lt;/p&gt;

&lt;p&gt;example:&lt;br/&gt;
AbstractDefaultAjaxBehavior#renderHead() does the following :&lt;br/&gt;
        response.renderJavaScriptReference(WicketEventReference.INSTANCE);&lt;br/&gt;
        response.renderJavaScriptReference(WicketAjaxReference.INSTANCE);&lt;br/&gt;
        response.renderJavaScript(&quot;Wicket.Ajax.baseUrl=&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;&quot;);&lt;/p&gt;

&lt;p&gt;With the non-aggregating header response, the Wicket .js ref script tags are rendered in the markup before the inline javascript code and all is well.&lt;br/&gt;
With the aggregating version, the Wicket js resource references are rendered last (in close()). This means that the inline javascript code (which uses Wicket.Ajax) is executed before the Wicket .js files are loaded, causing a javascript error (Wicket is undefined).&lt;/p&gt;

&lt;p&gt;This problem also applies to css resource references because order of inclusion is important for them too.&lt;/p&gt;

&lt;p&gt;Short of a big refactor to force each rendered javascript to list its dependencies, I don&apos;t see how this problem can be solved. I opened this ticket primarily to share my findings and let people comment on possible solutions other than removing the code.&lt;/p&gt;

&lt;p&gt;The problem is also present in AbstractDependencyRespectingResourceAggregatingHeaderResponse.&lt;/p&gt;

&lt;p&gt;NOTE:&lt;br/&gt;
wiQuery uses AbstractResourceAggregatingHeaderResponse, but resolves the issue by intercepting all renderJavaScript* methods and keeping their order.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12528304">WICKET-4161</key>
            <summary>AbstractResourceAggregatingHeaderResponse does not order javascript properly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="berniegp">Bertrand Guay-Paquet</reporter>
                        <labels>
                            <label>javascript</label>
                            <label>resource</label>
                    </labels>
                <created>Fri, 21 Oct 2011 18:09:20 +0000</created>
                <updated>Thu, 24 Nov 2011 05:05:16 +0000</updated>
                            <resolved>Wed, 26 Oct 2011 13:51:33 +0000</resolved>
                                    <version>1.5.1</version>
                                    <fixVersion>1.5.3</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13133890" author="mgrigorov" created="Mon, 24 Oct 2011 08:26:55 +0000"  >&lt;p&gt;I think this should be easy to solve.&lt;br/&gt;
We just need to extend org.apache.wicket.resource.aggregation.ResourceReferenceAndStringData to work with either ResourceReference or url (String),&lt;br/&gt;
Then org.apache.wicket.resource.ResourceUtil.renderTo(IHeaderResponse, ResourceReference, boolean, String) delegating to org.apache.wicket.resource.ResourceUtil.renderTo(IHeaderResponse, ResourceReference, boolean, String) will use the proper method of org.apache.wicket.markup.html.IHeaderResponse to render the ResourceReference or String.&lt;/p&gt;

&lt;p&gt;Please create a quickstart that shows the problem and I&apos;ll see whether my approach will work.&lt;/p&gt;</comment>
                            <comment id="13134058" author="berniegp" created="Mon, 24 Oct 2011 13:24:25 +0000"  >&lt;p&gt;quickstart&lt;/p&gt;</comment>
                            <comment id="13134927" author="mgrigorov" created="Tue, 25 Oct 2011 10:43:29 +0000"  >&lt;p&gt;Here is a patch that fixes the problem.&lt;br/&gt;
It has a small API break in the constructor of ResourceReferenceAndStringData but I think this code deserves even more work.&lt;/p&gt;

&lt;p&gt;Check it and let us know whether it works for your real app.&lt;br/&gt;
I&apos;ll ask Hielke (WiQuery) also for review.&lt;br/&gt;
I&apos;m not sure how many people actually use this code but I doubt there are a lot.&lt;/p&gt;</comment>
                            <comment id="13135073" author="berniegp" created="Tue, 25 Oct 2011 14:07:00 +0000"  >&lt;p&gt;patch for quickstart showing grouping problem&lt;/p&gt;</comment>
                            <comment id="13135080" author="berniegp" created="Tue, 25 Oct 2011 14:17:15 +0000"  >&lt;p&gt;Your patch does fix the problem if grouping is only done by aggregating css and js in 2 groups. However, the AbstractResourceAggregatingHeaderResponse is still vulnerable to whatever aggregating method given by its subclass. My last quickstart patch shows this problem. Of course, the newGroupingKey() method I used was artificially manufactured explicitly to trigger the problem, but it shows that the aggregating functionality can easily break the required ordering of resources.&lt;/p&gt;

&lt;p&gt;From my understanding, the subclass AbstractDependencyRespectingResourceAggregatingHeaderResponse of AbstractResourceAggregatingHeaderResponse is designed to overcome this issue by using ResourceDependentResourceReference. However, no part of Wicket currently uses the latter so a simple dependent ordering like the one in AbstractDefaultAjaxBehavior#renderHead() is still vulnerable.&lt;/p&gt;</comment>
                            <comment id="13135986" author="mgrigorov" created="Wed, 26 Oct 2011 13:50:56 +0000"  >&lt;p&gt;I think this is responsibility of the developer to provide proper implementation of org.apache.wicket.resource.aggregation.AbstractResourceAggregatingHeaderResponse.newGroupingKey(ResourceReferenceAndStringData).&lt;/p&gt;

&lt;p&gt;The problem that Wicket itself doesn&apos;t use these classes should be discussed in another ticket.&lt;br/&gt;
As I wrote in my mail to dev@ yesterday: we should decide which way to go: improve the classes in o.a.w.resource.aggregation or use JavaScript library that does this. For example RequireJS.&lt;/p&gt;</comment>
                            <comment id="13135987" author="mgrigorov" created="Wed, 26 Oct 2011 13:51:33 +0000"  >&lt;p&gt;The problem in this ticket is solved.&lt;br/&gt;
Any other issues should be discussed in separate tickets.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12500646" name="WICKET-4161.patch" size="17095" author="mgrigorov" created="Tue, 25 Oct 2011 10:43:29 +0000"/>
                            <attachment id="12500438" name="WICKET-4161.zip" size="26682" author="berniegp" created="Mon, 24 Oct 2011 13:24:25 +0000"/>
                            <attachment id="12500675" name="quickstart2.patch" size="1041" author="berniegp" created="Tue, 25 Oct 2011 14:06:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>97931</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 4 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0k953:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116298</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>