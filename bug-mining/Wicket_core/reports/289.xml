<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:18:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-3845] support custom response headers in AbstractResource.ResourceResponse</title>
                <link>https://issues.apache.org/jira/browse/WICKET-3845</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;I&apos;m converting an application to Wicket 1.5 and I see some problems with resources.&lt;/p&gt;

&lt;p&gt;There is a case I need to add headers (not present in ResourceResponse properties) and it looks ugly.&lt;/p&gt;

&lt;p&gt;This is what I need to do:&lt;/p&gt;

&lt;p&gt;    @Override&lt;br/&gt;
    protected void configureCache(ResourceResponse data, Attributes attributes)&lt;/p&gt;
    {
        super.configureCache(data, attributes);
        ((WebResponse) attributes.getResponse()).setHeader(&quot;Accept-Ranges&quot;, &quot;bytes&quot;);
    }

&lt;p&gt;It&apos;s a hack to use configureCache here, but this can&apos;t be added to setResponseHeaders, which seams a better apparent method name for it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12512219">WICKET-3845</key>
            <summary>support custom response headers in AbstractResource.ResourceResponse</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pete">Peter Ertl</assignee>
                                    <reporter username="asfernandes">Adriano dos Santos Fernandes</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Jun 2011 13:32:49 +0000</created>
                <updated>Tue, 5 Jul 2011 12:42:19 +0000</updated>
                            <resolved>Sat, 2 Jul 2011 09:36:22 +0000</resolved>
                                    <version>1.5-RC5.1</version>
                                    <fixVersion>1.5-RC6</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13057238" author="mgrigorov" created="Wed, 29 Jun 2011 14:02:38 +0000"  >&lt;p&gt;Looking at it you can do it as:&lt;/p&gt;

&lt;p&gt;@Override&lt;br/&gt;
protected void setResponseHeaders(final ResourceResponse data, final Attributes attributes) {&lt;br/&gt;
   ((WebResponse) attributes.getResponse()).setHeader(&quot;Accept-Ranges&quot;, &quot;bytes&quot;); &lt;br/&gt;
   super.setResponseHeaders(data, attributes);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Or we can add #setCustomHeaders(Attributes) which will be called &lt;b&gt;before&lt;/b&gt; the error/status headers are eventually set.&lt;/p&gt;</comment>
                            <comment id="13057795" author="pete" created="Thu, 30 Jun 2011 12:34:25 +0000"  >&lt;p&gt;reopened the ticket, did not intend to close it but jira somehow successfully confused me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13057827" author="pete" created="Thu, 30 Jun 2011 13:59:11 +0000"  >&lt;p&gt;patch (= proposal) attached:&lt;/p&gt;

&lt;p&gt;the following methods will be added:&lt;/p&gt;

&lt;p&gt;  ResourceResponse#setCustomHeader(name, value)&lt;br/&gt;
  ResourceResponse#getCustomHeaders()&lt;/p&gt;

&lt;p&gt;Having a callback like&lt;/p&gt;

&lt;p&gt;  configureHeaders(...)&lt;/p&gt;

&lt;p&gt;will not be as good &lt;b&gt;imho&lt;/b&gt; since the callback has no relationship to the code that actually creates the resource in AbstractResource#newResourceResponse(..).&lt;/p&gt;

&lt;p&gt;With these additional methods you can simply add custom headers like &apos;Range&apos;, &apos;X-Special-Header&apos;, etc. in #newResourceResponse when generating the response.&lt;/p&gt;</comment>
                            <comment id="13057830" author="asfernandes" created="Thu, 30 Jun 2011 14:03:31 +0000"  >&lt;p&gt;Looks fine for me.&lt;/p&gt;</comment>
                            <comment id="13057835" author="mgrigorov" created="Thu, 30 Jun 2011 14:07:37 +0000"  >&lt;p&gt;I&apos;ve been thinking about renaming current setResponseHeaders() to internalSetResponseHeaders() and adding new setResponseHeaders() which can be overridden by the user.&lt;br/&gt;
See this patch.&lt;/p&gt;

&lt;p&gt;The only thing that I don&apos;t like is that the method will not be invoked for non-web response. I don&apos;t see non-web usage of AbstractResource but there is WebResponse specialization for Response class. &lt;br/&gt;
I&apos;m trying to say that AbstractResponse is too webby even now with all the headers it already handles.&lt;/p&gt;</comment>
                            <comment id="13057841" author="asfernandes" created="Thu, 30 Jun 2011 14:22:53 +0000"  >&lt;p&gt;Martin, while you talk about non-web responses, I&apos;d like to add that I had something to render pages to string, and when I used StringResponse some core class threw ClassCastException while converting it to WebResponse.&lt;/p&gt;

&lt;p&gt;But it has nothing to resources, it was about pages.&lt;/p&gt;</comment>
                            <comment id="13057851" author="mgrigorov" created="Thu, 30 Jun 2011 14:40:04 +0000"  >&lt;p&gt;Next time sends us the stacktrace.&lt;/p&gt;</comment>
                            <comment id="13057891" author="pete" created="Thu, 30 Jun 2011 15:45:54 +0000"  >&lt;p&gt;I think you should be able to set the headers inside #newResourceResponse() when actually creating the response to have all the context information available for setting headers that relate to that content. For example you could conditionally downscale an image resource and set header &quot;X-Original-Size&quot; with the original image dimensions. Doing things like that with an callback will be very hard.&lt;/p&gt;</comment>
                            <comment id="13057947" author="pete" created="Thu, 30 Jun 2011 17:37:23 +0000"  >&lt;p&gt;fix committed to 1.5-trunk&lt;/p&gt;</comment>
                            <comment id="13058147" author="pete" created="Fri, 1 Jul 2011 00:19:28 +0000"  >&lt;p&gt;Committed another patch so multi-valued http response headers are working now, too. Please test &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13058148" author="pete" created="Fri, 1 Jul 2011 00:25:56 +0000"  >&lt;p&gt;adding headers work like this:&lt;/p&gt;

&lt;p&gt;example:&lt;/p&gt;

&lt;p&gt;  resourceResponse.getHeaders().addHeader(&quot;Accept-Ranges&quot;, &quot;bytes&quot;)&lt;/p&gt;

&lt;p&gt;caution: you are not allowed to set internal headers like for example &quot;Content-Type&quot; and will get a runtime error in that case. Access these values using the methods in ResourceResponse that are supposed to do it, like &quot;responseResponse.setContentType(type)&quot;&lt;/p&gt;</comment>
                            <comment id="13059594" author="asfernandes" created="Mon, 4 Jul 2011 19:57:06 +0000"  >&lt;p&gt;Please allow to use empty header values, like the WebServletResponse.&lt;/p&gt;

&lt;p&gt;Current it throws in addHeader:&lt;br/&gt;
  value = Args.notEmpty(value, &quot;value&quot;).trim();&lt;/p&gt;</comment>
                            <comment id="13059676" author="mgrigorov" created="Tue, 5 Jul 2011 04:37:15 +0000"  >&lt;p&gt;What is the use case for empty header values ?&lt;br/&gt;
I&apos;m not sure about the case with response but if you set a header with empty value in a request then this header is ignored and not existing at the server side.&lt;/p&gt;</comment>
                            <comment id="13059828" author="asfernandes" created="Tue, 5 Jul 2011 10:40:58 +0000"  >&lt;p&gt;In my case I used it to do communication of custom &quot;services&quot; using the HTTP protocol.&lt;/p&gt;

&lt;p&gt;It worked in Wicket 1.4 and using the raw HttpServletResponse interfaces.&lt;/p&gt;</comment>
                            <comment id="13059864" author="pete" created="Tue, 5 Jul 2011 12:36:09 +0000"  >&lt;p&gt;Surprisingly&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/warning.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; headers with empty values seem to be valid from looking at the RFC:&lt;/p&gt;

&lt;p&gt;url:&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.w3.org/Protocols/rfc2616/rfc2616-sec4.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;definition:&lt;/p&gt;

&lt;p&gt;   message-header = field-name &quot;:&quot; [ field-value ]&lt;/p&gt;

&lt;p&gt;being compliant to the RFC is mandary &lt;b&gt;imho&lt;/b&gt; so we should support this...&lt;/p&gt;</comment>
                            <comment id="13059867" author="mgrigorov" created="Tue, 5 Jul 2011 12:39:39 +0000"  >&lt;p&gt;+1 since the spec says so.&lt;/p&gt;</comment>
                            <comment id="13059869" author="pete" created="Tue, 5 Jul 2011 12:42:19 +0000"  >&lt;p&gt;added the possibility for empty header values in 1.5-trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12484771" name="custom-headers.patch" size="2246" author="pete" created="Thu, 30 Jun 2011 13:59:11 +0000"/>
                            <attachment id="12484773" name="wicket-3845.patch" size="2922" author="mgrigorov" created="Thu, 30 Jun 2011 14:07:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>69134</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 20 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0a57b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57116</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>