<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:26:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-6869] StalePageException does not refresh page</title>
                <link>https://issues.apache.org/jira/browse/WICKET-6869</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;After migration from version 7.4.0 to 8.9.0 we realized, that in some scenarios &lt;em&gt;StalePageException&lt;/em&gt; does not refresh entire page, but is displayed on the page when working with multiple tabs/windows.&lt;/p&gt;

&lt;p&gt;When debugging and comparing with version 7.4.0, I would say, that problem is in lazy initialization of &lt;em&gt;PageProvider.provision&lt;/em&gt; class member, which did not exist in 7.4.0 (attributes were not wrapped in &lt;em&gt;provision&lt;/em&gt;, but placed directly in &lt;em&gt;PageProvider&lt;/em&gt;).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Provision getProvision()
	{
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (provision == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
		{
			provision = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Provision().resolve();
		}
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; provision;
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The problem with that is calling &lt;em&gt;resolve()&lt;/em&gt; method within assigning new &lt;em&gt;Provision&lt;/em&gt; to &lt;em&gt;PageProvider.provision&lt;/em&gt;. If &lt;em&gt;resolve()&lt;/em&gt; method throws &lt;em&gt;StalePageException&lt;/em&gt; then &lt;em&gt;PageProvider.provision&lt;/em&gt; remains null and later calls to &lt;em&gt;getProvisison()&lt;/em&gt; repeats the same flow and throws &lt;em&gt;StalePageException&lt;/em&gt; again. &lt;em&gt;Resolve()&lt;/em&gt; method sets &lt;em&gt;Provision.page&lt;/em&gt; attribute before throwing &lt;em&gt;StalePageException&lt;/em&gt;, but &lt;em&gt;page&lt;/em&gt; attribute cannot be used later, because it is wrapped in created &lt;em&gt;Provision&lt;/em&gt;, which is never assigned to &lt;em&gt;PageProvider.provision&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&lt;em&gt;PageProvider.getProvisison()&lt;/em&gt; is often called by request cycle and whether page is refreshed or exception is displayed, depends on where in request cycle &lt;em&gt;StalePageException&lt;/em&gt; is thrown:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;em&gt;resolveRequestHandler&lt;/em&gt; - refresh (depends on what request mapper is used - some does not call &lt;em&gt;PageProvider.getProvisison()&lt;/em&gt;, like &lt;em&gt;PageInstanceMapper&lt;/em&gt;, and processing continues to execute handler)&lt;/li&gt;
	&lt;li&gt;&lt;em&gt;execute handler&lt;/em&gt; - ready to handle &lt;em&gt;StalePageException&lt;/em&gt;.&lt;/li&gt;
	&lt;li&gt;&lt;em&gt;detach&lt;/em&gt; - not ready to handle &lt;em&gt;StalePageException&lt;/em&gt; - exception is bubbled up and displayed on page.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Whether &lt;em&gt;StalePageException&lt;/em&gt; is thrown or not during detach phase depends on the content of &lt;em&gt;RequestHandlerExecutor.inactiveRequestHandlers&lt;/em&gt; - for example, if &lt;em&gt;resolveRequestHandler()&lt;/em&gt; throws &lt;em&gt;StalePageException&lt;/em&gt;, then &lt;em&gt;inactiveRequestHandleres&lt;/em&gt; contains only one &lt;em&gt;RenderPageRequestHandler&lt;/em&gt; (responsible for redirection/refresh), if not, then there are two handlers - original for processing request (e.g. &lt;em&gt;ListenerRequestHandler&lt;/em&gt;) and &lt;em&gt;RenderPageRequestHandler&lt;/em&gt; for redirection/refresh. Then &lt;em&gt;detach()&lt;/em&gt; is called on every handler in &lt;em&gt;RequestHandlerExecutor.inactiveRequestHandlers&lt;/em&gt; and if there is also original one (with &lt;em&gt;pageProvider&lt;/em&gt; with unitiliazed provision), then &lt;em&gt;StalePageException&lt;/em&gt; is thrown again (because of &lt;em&gt;PageLogData&lt;/em&gt; creation calls &lt;em&gt;PageProvider.getProvisison()&lt;/em&gt; and tries to initialize provision again).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Ok, that&apos;s for 8.9.0. A little different story is for 8.11.0. Some changes have been made meanwhile - detaching catches and only logs exception instead of rethrowing exception: &lt;a href=&quot;https://github.com/apache/wicket/commit/e5cd09ba8c1c02f213b1e47bbe9dff0e626120ea&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/commit/e5cd09ba8c1c02f213b1e47bbe9dff0e626120ea&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The consequence in 8.11.0 is the page is refreshed (instead of showing exception on page) if StalePageException happens, but there is still ERROR message in the log:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[qtp598446861-30] ERROR org.apache.wicket.request.cycle.RequestCycle - Error detaching RequestCycle
org.apache.wicket.core.request.mapper.StalePageException: A request to page &apos;[Page class = com.mycompany.Page, id = 1, render count = 4]&apos; has been made with stale &apos;renderCount&apos;. The page will be re-rendered.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It has been &quot;fixed&quot; by coincidence, I would say, and still there is an unwanted ERROR message in the log which should not be there because of StalePageException (operation guys report every ERROR in the log). It would be better to fix the real cause of the problem - inappropriate lazy initializaion of &lt;em&gt;PageProvider.provision&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Attached quickstarts for 8.9.0 and 8.11.0:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;run src/test/java/Start.java&lt;/li&gt;
	&lt;li&gt;open &lt;a href=&quot;http://localhost:8080/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080&lt;/a&gt; and click on Start and then on Continue&lt;/li&gt;
	&lt;li&gt;then copy url and open it in another tab/window and then click on ajaxLink on both tabs/windows and look for ERROR in a log (8.11.0) or on page itself (8.9.0)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13359646">WICKET-6869</key>
            <summary>StalePageException does not refresh page</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="pmichalco">Pavol M</reporter>
                        <labels>
                    </labels>
                <created>Fri, 19 Feb 2021 18:38:19 +0000</created>
                <updated>Fri, 19 Mar 2021 12:49:44 +0000</updated>
                            <resolved>Fri, 19 Mar 2021 12:49:13 +0000</resolved>
                                    <version>8.9.0</version>
                    <version>8.11.0</version>
                                    <fixVersion>9.3.0</fixVersion>
                    <fixVersion>8.12.0</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17304876" author="jira-bot" created="Fri, 19 Mar 2021 12:46:59 +0000"  >&lt;p&gt;Commit 97fcc5b4e2b72e5c0c8507e12841061fdfdf9771 in wicket&apos;s branch refs/heads/wicket-8.x from Martin Tzvetanov Grigorov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=97fcc5b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=97fcc5b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6869&quot; title=&quot;StalePageException does not refresh page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6869&quot;&gt;&lt;del&gt;WICKET-6869&lt;/del&gt;&lt;/a&gt; StalePageException does not refresh page&lt;/p&gt;

&lt;p&gt;Do not lod Wicket internal exceptions in the detach phase.&lt;br/&gt;
Internal exceptions are handled in a special way during the request processing phase. In the detach phase nothing could be done.&lt;br/&gt;
In this particular case StalePageException is being thrown in the RequestLogger.&lt;/p&gt;</comment>
                            <comment id="17304878" author="jira-bot" created="Fri, 19 Mar 2021 12:48:52 +0000"  >&lt;p&gt;Commit 9682ef7544c3db86b20c2a2f1d09b5c7e655cf9c in wicket&apos;s branch refs/heads/master from Martin Tzvetanov Grigorov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=9682ef7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=9682ef7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6869&quot; title=&quot;StalePageException does not refresh page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6869&quot;&gt;&lt;del&gt;WICKET-6869&lt;/del&gt;&lt;/a&gt; StalePageException does not refresh page&lt;/p&gt;

&lt;p&gt;Do not lod Wicket internal exceptions in the detach phase.&lt;br/&gt;
Internal exceptions are handled in a special way during the request processing phase. In the detach phase nothing could be done.&lt;br/&gt;
In this particular case StalePageException is being thrown in the RequestLogger.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 97fcc5b4e2b72e5c0c8507e12841061fdfdf9771)&lt;/p&gt;</comment>
                            <comment id="17304879" author="mgrigorov" created="Fri, 19 Mar 2021 12:49:44 +0000"  >&lt;p&gt;&quot;Do not lod &quot; should be read &quot;Do not log ...&quot;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13020718" name="wicket_8.11.0.zip" size="48962" author="pmichalco" created="Fri, 19 Feb 2021 18:38:48 +0000"/>
                            <attachment id="13020719" name="wicket_8.9.0.zip" size="48806" author="pmichalco" created="Fri, 19 Feb 2021 18:38:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 34 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0nuq8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>