<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:19:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-4390] MarkupParser#add(IMarkupFilter filter,Class beforeFilter) doesn&apos;t add the filter into the correct place.</title>
                <link>https://issues.apache.org/jira/browse/WICKET-4390</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;The documentation comment of MarkupParser#add(IMarkupFilter filter,Class&amp;lt;? extends IMarkupFilter&amp;gt; beforeFilter) says that &apos;filter&apos; will be added before the &apos;beforeFilter&apos;, but the filter passed is always added as the last element of MarkupFilterList.&lt;/p&gt;

&lt;p&gt;Technically, MarkupParser#add() internally uses an inner-class MarkupFilterList for managing filters. But the MarkupFilterList#add(IMarkupFilter filter,Class&amp;lt;? extends IMarkupFilter&amp;gt; beforeFilter) does not implemented correctly.&lt;/p&gt;

&lt;p&gt;The method uses &apos;indexOf&apos; of ArrayList for finding the matched instance of IMarkupFilter, though the parameter is not an instance of IMarkupFilter, but a Class&amp;lt;? extends IMarkupFilter&amp;gt;.&lt;/p&gt;

&lt;p&gt;We must iterate all registered IMarkupFilters and check if the Class of the IMarkupFilter matches with the parameter Class object for finding the index of &apos;beforeFilter&apos;.&lt;/p&gt;


&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;HOW TO REPRODUCE&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Unpack, build and run the attached project &apos;wicket-bug.tar.gz&apos;. &lt;br/&gt;
jp.javelindev.wicket.MyMarkupFactory will log all registered filters with source below:&lt;/p&gt;

&lt;p&gt;&amp;lt;pre&amp;gt;&lt;br/&gt;
    @Override&lt;br/&gt;
    public MarkupParser newMarkupParser(MarkupResourceStream resource) {&lt;br/&gt;
        MarkupParser parser = super.newMarkupParser(resource);&lt;br/&gt;
        parser.add(new MyMarkupFilter(), WicketTagIdentifier.class);&lt;br/&gt;
        parser.add(new MyMarkupFilter2());&lt;/p&gt;

&lt;p&gt;        for (IMarkupFilter filter : parser.getMarkupFilters()) {&lt;br/&gt;
            LOGGER.info(&quot;filter class: {}&quot;, filter.getClass());&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;        return parser;&lt;br/&gt;
    }&lt;br/&gt;
&amp;lt;/pre&amp;gt;&lt;/p&gt;

&lt;p&gt;If MarkupParser add filters at correct place, &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;MyMarkupFilter must be displayed at first (because WicketTagIdentifier is the first filter in default implementation) and&lt;/li&gt;
	&lt;li&gt;MyMarkupFilter2 must be displayed before RelativePathPrefixHandler (because the default implementation of add() of MarkupFilterList is like &apos;add(filter, RelativePathPrefixHandler.class)&apos;).&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;But with trunk and wicket-1.5.4, both filters is displayed at last.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;WORK AROUND **&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I can avoid this issue by getting raw MarkupFilterList through getMarkupFilters() and writing code manually to find correct place for add().&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;PATCH **&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I attached a patch to fix this issue. see the source of MarkupParser.&lt;/p&gt;</description>
                <environment>any platform</environment>
        <key id="12541581">WICKET-4390</key>
            <summary>MarkupParser#add(IMarkupFilter filter,Class beforeFilter) doesn&apos;t add the filter into the correct place.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="t_yano">Tsutomu YANO</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Feb 2012 08:55:45 +0000</created>
                <updated>Thu, 9 Feb 2012 13:05:56 +0000</updated>
                            <resolved>Thu, 9 Feb 2012 13:02:12 +0000</resolved>
                                    <version>1.5.4</version>
                    <version>6.0.0-beta1</version>
                                    <fixVersion>1.5.5</fixVersion>
                    <fixVersion>6.0.0-beta1</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13202180" author="t_yano" created="Tue, 7 Feb 2012 08:58:26 +0000"  >&lt;p&gt;a project for preproduction this issue and a patch.&lt;/p&gt;</comment>
                            <comment id="13204494" author="mgrigorov" created="Thu, 9 Feb 2012 13:02:12 +0000"  >&lt;p&gt;Fixed!&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="13204495" author="mgrigorov" created="Thu, 9 Feb 2012 13:05:56 +0000"  >&lt;p&gt;Some notes:&lt;br/&gt;
StyleAndScriptIdentifier markup filter should be added &lt;b&gt;after&lt;/b&gt; RelativePathPrefixHandler because otherwise the latter overrides the (auto-)component&apos;s id and later HeaderPartContainer cannot find its child with id &apos;_ScriptStyle&apos; and thus doesn&apos;t execute its onComponentTag and as a result RelativePathPrefixHandler.RELATIVE_PATH_BEHAVIOR doesn&apos;t do its job for header contributions coming from &amp;lt;wicket:head&amp;gt; (see MarkupHeadFirstTest).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12513587" name="fix-WICKET-4390.patch" size="1483" author="t_yano" created="Tue, 7 Feb 2012 08:58:25 +0000"/>
                            <attachment id="12513586" name="wicket-bug.tar.gz" size="21952" author="t_yano" created="Tue, 7 Feb 2012 08:58:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>226868</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00vvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3097</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>