<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:23:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-5911] Re-rendering page after exception in render phase does not call onBeforeRender()</title>
                <link>https://issues.apache.org/jira/browse/WICKET-5911</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;(I sent this to the mailing list originaly, Sven Meier replied this is probably a bug and requested creating a JIRA issue for it.)&lt;/p&gt;

&lt;p&gt;I got page with structure like: &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Page&lt;br/&gt;
  +- ListView &amp;#8211; items &lt;br/&gt;
  \ - Footer panel &lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Now the scenario (heavily simplified): &lt;/p&gt;

&lt;p&gt;One of the items in ListView gets exception from backend during onInitialize(). Required behavior in this case is to keep user on the page and replace ListView with a panel stating &quot;Sorry, backend outage&quot;. &lt;/p&gt;

&lt;p&gt;So I catch the backend exception using aspect, replace view in the structure with the message panel and throw NonResettingRestartException to restart rendering the page. &lt;/p&gt;

&lt;p&gt;Page is rendered and seems OK, BUT I realize onBeforeRender() of Footer panel is never called. &lt;/p&gt;

&lt;p&gt;I debugged it and found the cause: &lt;/p&gt;

&lt;p&gt;ListView adds items in onPopulate() method which is called from onBeforeRender(). When page starts rendering, its onBeforeRender() is called. Page does: &lt;/p&gt;

&lt;p&gt;setFlag(FLAG_PREPARED_FOR_RENDER, true); &lt;/p&gt;

&lt;p&gt;and calls onBeforeRenderChildren(). This calls onBeforeRender() of ListView, causes exception, so that onBeforeRender() of the footer is not called this time. &lt;/p&gt;

&lt;p&gt;When second rendering is attempted, call flow gets to internalBeforeRender() of the page component. There is check: &lt;/p&gt;

&lt;p&gt;if ((determineVisibility()) &amp;amp;&amp;amp; !getFlag(FLAG_RENDERING) &amp;amp;&amp;amp; !getFlag(FLAG_PREPARED_FOR_RENDER)) { &lt;br/&gt;
  ... &lt;br/&gt;
  onBeforeRender(); &lt;br/&gt;
  ... &lt;br/&gt;
} &lt;/p&gt;

&lt;p&gt;But since FLAG_PREPARED_FOR_RENDER is set from previous attempt, onBeforeRender() of the page is not called (again) which means onBeforeRender() of the children is not called. &lt;/p&gt;

&lt;p&gt;I found that if I call &lt;/p&gt;

&lt;p&gt;markRendering(false); &lt;/p&gt;

&lt;p&gt;on the page before throwing the NonResettingRestartException, all goes well. But I am quite uneasy about this solution, so I have two questions: &lt;/p&gt;

&lt;p&gt;1) Cannot this cause some unforeseen troubles? (Supposing my components are correctly written so that their onBeforeRender() / onConfigure() / onAfterRender() procedures can be safely called multiple times.) &lt;/p&gt;

&lt;p&gt;2) Should not Wicket itself reset the FLAG_PREPARED_FOR_RENDER when response restarting exception is caught and processed? &lt;/p&gt;


&lt;p&gt;I created a Wicket quickstart project demonstrating the bug here: &lt;a href=&quot;http://lemming.hofyland.cz/restartbug.zip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://lemming.hofyland.cz/restartbug.zip&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12831273">WICKET-5911</key>
            <summary>Re-rendering page after exception in render phase does not call onBeforeRender()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="svenmeier">Sven Meier</assignee>
                                    <reporter username="lemmingucwcz">Michal Kara</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 May 2015 05:27:30 +0000</created>
                <updated>Thu, 4 Jun 2015 08:45:28 +0000</updated>
                            <resolved>Wed, 20 May 2015 19:16:16 +0000</resolved>
                                    <version>7.0.0-M6</version>
                                    <fixVersion>6.20.0</fixVersion>
                    <fixVersion>7.0.0-M6</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14551842" author="lemmingucwcz" created="Wed, 20 May 2015 05:29:52 +0000"  >&lt;p&gt;I originally encountered this bug in 6.14, but it &quot;works&quot; in 7.0.0-SNAPSHOT too.&lt;/p&gt;</comment>
                            <comment id="14552885" author="jira-bot" created="Wed, 20 May 2015 19:11:12 +0000"  >&lt;p&gt;Commit a58cf45bd865fd488fac86b94202830a3354a934 in wicket&apos;s branch refs/heads/wicket-6.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=a58cf45&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=a58cf45&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-5911&quot; title=&quot;Re-rendering page after exception in render phase does not call onBeforeRender()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-5911&quot;&gt;&lt;del&gt;WICKET-5911&lt;/del&gt;&lt;/a&gt; reset all flags after render&lt;/p&gt;</comment>
                            <comment id="14552903" author="jira-bot" created="Wed, 20 May 2015 19:13:35 +0000"  >&lt;p&gt;Commit 010f0efdef14977bfef83f5975b96f24ac808ebe in wicket&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=010f0ef&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=010f0ef&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-5911&quot; title=&quot;Re-rendering page after exception in render phase does not call onBeforeRender()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-5911&quot;&gt;&lt;del&gt;WICKET-5911&lt;/del&gt;&lt;/a&gt; reset all flags after render&lt;/p&gt;</comment>
                            <comment id="14552909" author="svenmeier" created="Wed, 20 May 2015 19:16:16 +0000"  >&lt;p&gt;Flag FLAG_PREPARED_FOR_RENDER is now reset too via markRendering(false) - the page is now ready to be rerendered even after a previous exception.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 26 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2eyyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>