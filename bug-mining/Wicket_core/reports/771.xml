<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:21:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-4955] SessionData violates comparison contract</title>
                <link>https://issues.apache.org/jira/browse/WICKET-4955</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;AbstractRequestLogger.getLiveSessions sorts the SessionData objects, this sort &apos;sometimes&apos; (most likely load/concurrency) results in a contract violation:&lt;/p&gt;

&lt;p&gt;Caused by: org.apache.wicket.WicketRuntimeException: Error calling method: public final java.lang.Integer org.apache.wicket.proxy.$Proxy200.getLiveSessions() on object: org.apache.wicket.proxy.LazyInitProxyFactory$JdkHandler@438532d0&lt;br/&gt;
        at org.apache.wicket.core.util.lang.PropertyResolver$MethodGetAndSet.getValue(PropertyResolver.java:1148)&lt;br/&gt;
        at org.apache.wicket.core.util.lang.PropertyResolver$ObjectAndGetSetter.getValue(PropertyResolver.java:649)&lt;br/&gt;
        at org.apache.wicket.core.util.lang.PropertyResolver.getValue(PropertyResolver.java:103)&lt;br/&gt;
        at org.apache.wicket.model.AbstractPropertyModel.getObject(AbstractPropertyModel.java:86)&lt;br/&gt;
        at org.apache.wicket.Component.getDefaultModelObject(Component.java:1615)&lt;br/&gt;
        ... 75 more&lt;br/&gt;
Caused by: java.lang.IllegalArgumentException: Comparison method violates its general contract!&lt;br/&gt;
        at java.util.ComparableTimSort.mergeHi(ComparableTimSort.java:835)&lt;br/&gt;
        at java.util.ComparableTimSort.mergeAt(ComparableTimSort.java:453)&lt;br/&gt;
        at java.util.ComparableTimSort.mergeForceCollapse(ComparableTimSort.java:392)&lt;br/&gt;
        at java.util.ComparableTimSort.sort(ComparableTimSort.java:191)&lt;br/&gt;
        at java.util.ComparableTimSort.sort(ComparableTimSort.java:146)&lt;br/&gt;
        at java.util.Arrays.sort(Arrays.java:472)&lt;br/&gt;
        at org.apache.wicket.protocol.http.AbstractRequestLogger.getLiveSessions(AbstractRequestLogger.java:135)&lt;br/&gt;
        at nl.topicus.cobra.monitoring.BaseApplicationInfo.getLiveSessions(BaseApplicationInfo.java:103)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor256.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:601)&lt;br/&gt;
        at org.apache.wicket.proxy.LazyInitProxyFactory$JdkHandler.invoke(LazyInitProxyFactory.java:434)&lt;br/&gt;
        at org.apache.wicket.proxy.$Proxy200.getLiveSessions(Unknown Source)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor255.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:601)&lt;br/&gt;
        at org.apache.wicket.core.util.lang.PropertyResolver$MethodGetAndSet.getValue(PropertyResolver.java:1144)&lt;br/&gt;
        ... 79 more&lt;/p&gt;</description>
                <environment>java 7</environment>
        <key id="12626510">WICKET-4955</key>
            <summary>SessionData violates comparison contract</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="papegaaij">Emond Papegaaij</assignee>
                                    <reporter username="boschman">Sverre Boschman</reporter>
                        <labels>
                            <label>requestlogger</label>
                    </labels>
                <created>Tue, 8 Jan 2013 08:11:03 +0000</created>
                <updated>Thu, 10 Jan 2013 09:49:29 +0000</updated>
                            <resolved>Tue, 8 Jan 2013 19:06:29 +0000</resolved>
                                    <version>6.4.0</version>
                                    <fixVersion>6.5.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13546716" author="papegaaij" created="Tue, 8 Jan 2013 09:02:31 +0000"  >&lt;p&gt;I don&apos;t think your fix is correct. this error is about the requestlogger, not about the actions in BufferedWebResponse. Also, your fix on these actions is not a fix: Comparable&apos;s contract states you should return a negative number, 0 or a positive number. It does not matter if you return Integer.MIN_VALUE or -1. This problem is about violating other parts of the contract, such as sgn(x.compareTo&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;) == -sgn(y.compareTo&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/error.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;).&lt;/p&gt;

&lt;p&gt;What probably happens is that during the sorting a request changes the lastActive value, changing the sort order during the sorting process.&lt;/p&gt;

&lt;p&gt;The compareTo methods you changed in Action are also wrong:&lt;br/&gt;
 Given 2 MetaDataActions a and b, a.compareTo(b) == -1 and b.compareTo(a) == -1, this is not allowed and will trigger this exception.&lt;/p&gt;</comment>
                            <comment id="13546720" author="papegaaij" created="Tue, 8 Jan 2013 09:09:15 +0000"  >&lt;p&gt;I&apos;ve created a new ticket for the compareTo methods of the Action classes: &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-4956&quot; title=&quot;compareTo methods of Actions in BufferedWebResponse violate Comparable contract&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-4956&quot;&gt;&lt;del&gt;WICKET-4956&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13547125" author="papegaaij" created="Tue, 8 Jan 2013 19:06:29 +0000"  >&lt;p&gt;The sort-order is changed to the startDate of the session, a small change in behavior, but this timestamp is stable, preventing the exception and the sorting was never documented anyway.&lt;/p&gt;</comment>
                            <comment id="13547217" author="mgrigorov" created="Tue, 8 Jan 2013 20:23:45 +0000"  >&lt;p&gt;Thanks for improving the code!&lt;br/&gt;
What is the reason not to fix this in 1.5.x ?&lt;br/&gt;
I see you intentionally removed 1.5.10 from &quot;Fix Version&quot;. Is the fix too risky ?&lt;/p&gt;</comment>
                            <comment id="13547810" author="papegaaij" created="Wed, 9 Jan 2013 09:54:25 +0000"  >&lt;p&gt;The fix is not very risky. The reason I did not backport it to 1.5.x is that this is only an issue on Java 7, which I do not think we need to support for Wicket 1.5.x. Also, this is a minor issue, which is only triggered a few times a day under very high load. Finally, we do not have any application still on Wicket 1.5.x, so I have no way of verifying the fix is correct for that version.&lt;/p&gt;

&lt;p&gt;If you want this to be fixed on 1.5.x, I think it is safe to backport.&lt;/p&gt;</comment>
                            <comment id="13547812" author="mgrigorov" created="Wed, 9 Jan 2013 09:55:15 +0000"  >&lt;p&gt;Can you explain more about the problem and the fix in AbstractRequestLogger ?&lt;br/&gt;
How &apos;startDate&apos; is better than &apos;lastActive&apos; for this particular problem ? Both of them are long. &apos;startDate&apos; is stable (final) but &lt;br/&gt;
public SessionData[] getLiveSessions()&lt;/p&gt;
	{
		final SessionData[] sessions = liveSessions.values().toArray(
			new SessionData[liveSessions.values().size()]);
		Arrays.sort(sessions);
		return sessions;
	}
&lt;p&gt;i.e. a copy is made of the SessionData objects and I think &apos;lastActive&apos; should not change during the sorting for any SessionData object, so it seems to be stable as well.&lt;/p&gt;</comment>
                            <comment id="13549466" author="mgrigorov" created="Thu, 10 Jan 2013 09:18:22 +0000"  >&lt;p&gt;Ping&lt;/p&gt;</comment>
                            <comment id="13549489" author="papegaaij" created="Thu, 10 Jan 2013 09:49:29 +0000"  >&lt;p&gt;The problem is that only the array is copied, not the SessionData objects. If a new requests is served during the sorting, lastActive is updated and the sort-order can change. This can cause A to be before B at one moment and B to be before A at a later moment. This is not the case with startDate.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>303116</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 45 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1782v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250277</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>