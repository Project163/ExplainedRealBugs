<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:26:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-6847] async page storing fails with flush before detach without session</title>
                <link>https://issues.apache.org/jira/browse/WICKET-6847</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;Since &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6831&quot; title=&quot;Flush the response before detach&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6831&quot;&gt;&lt;del&gt;WICKET-6831&lt;/del&gt;&lt;/a&gt; the response is flushed before detach.&lt;/p&gt;

&lt;p&gt;RequestPageStore delays storing all of stateful pages until detach; at that moment&#160; AsynchronousPageStore can no longer acquire the required session id.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13336769">WICKET-6847</key>
            <summary>async page storing fails with flush before detach without session</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="svenmeier">Sven Meier</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Oct 2020 16:17:09 +0000</created>
                <updated>Sat, 28 Nov 2020 20:39:46 +0000</updated>
                            <resolved>Thu, 22 Oct 2020 16:18:38 +0000</resolved>
                                    <version>9.1.0</version>
                                    <fixVersion>9.2.0</fixVersion>
                    <fixVersion>8.11.0</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="17219139" author="svenmeier" created="Thu, 22 Oct 2020 16:18:38 +0000"  >&lt;p&gt;RequestPageStore binds the session now before flush/detach&lt;/p&gt;</comment>
                            <comment id="17222807" author="reiern70" created="Thu, 29 Oct 2020 10:07:42 +0000"  >&lt;p&gt;Thanks Sven. I will test with our application to see if the stack traces we have on or logs, after executing tests, disappear with this fix&lt;/p&gt;</comment>
                            <comment id="17224632" author="papegaaij" created="Mon, 2 Nov 2020 12:32:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reiern70&quot; class=&quot;user-hover&quot; rel=&quot;reiern70&quot;&gt;reiern70&lt;/a&gt; in &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6848&quot; title=&quot;Session invalidation fails because response is already committed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6848&quot;&gt;&lt;del&gt;WICKET-6848&lt;/del&gt;&lt;/a&gt; you said you are still facing this issue on current master. However, &lt;tt&gt;RequestPageStore&lt;/tt&gt; does contain a fix for this, are you sure you tested against the latest version? Do you have a quickstart?&lt;/p&gt;</comment>
                            <comment id="17227276" author="bitstorm" created="Fri, 6 Nov 2020 09:49:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reiern70&quot; class=&quot;user-hover&quot; rel=&quot;reiern70&quot;&gt;reiern70&lt;/a&gt; Ping&#160; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17227283" author="reiern70" created="Fri, 6 Nov 2020 10:03:15 +0000"  >&lt;p&gt;java.lang.IllegalStateException: Cannot create a session after the response has been committed&lt;br/&gt;
	at org.apache.catalina.connector.Request.doGetSession(Request.java:3038)&lt;br/&gt;
	at org.apache.catalina.connector.Request.getSession(Request.java:2456)&lt;br/&gt;
	at org.apache.catalina.connector.RequestFacade.getSession(RequestFacade.java:896)&lt;br/&gt;
	at javax.servlet.http.HttpServletRequestWrapper.getSession(HttpServletRequestWrapper.java:231)&lt;br/&gt;
	at org.apache.shiro.web.servlet.ShiroHttpServletRequest.getSession(ShiroHttpServletRequest.java:148)&lt;br/&gt;
	at org.apache.wicket.session.HttpSessionStore.getHttpSession(HttpSessionStore.java:85)&lt;br/&gt;
	at org.apache.wicket.session.HttpSessionStore.getSessionId(HttpSessionStore.java:146)&lt;br/&gt;
	at org.apache.wicket.Session.bind(Session.java:276)&lt;br/&gt;
	at org.apache.wicket.pageStore.DefaultPageContext.getSessionId(DefaultPageContext.java:44)&lt;br/&gt;
	at org.apache.wicket.pageStore.AsynchronousPageStore$PendingAdd.&amp;lt;init&amp;gt;(AsynchronousPageStore.java:150)&lt;br/&gt;
	at org.apache.wicket.pageStore.AsynchronousPageStore.addPage(AsynchronousPageStore.java:368)&lt;br/&gt;
	at org.apache.wicket.pageStore.SerializingPageStore.addPage(SerializingPageStore.java:82)&lt;br/&gt;
	at org.apache.wicket.pageStore.CachingPageStore.addPage(CachingPageStore.java:73)&lt;br/&gt;
	at org.apache.wicket.pageStore.RequestPageStore.detach(RequestPageStore.java:108)&lt;br/&gt;
	at org.apache.wicket.page.PageManager.detach(PageManager.java:85)&lt;br/&gt;
	at org.apache.wicket.Application$2.onDetach(Application.java:1572)&lt;br/&gt;
	at org.apache.wicket.request.cycle.RequestCycleListenerCollection$3.notify(RequestCycleListenerCollection.java:105)&lt;br/&gt;
	at org.apache.wicket.request.cycle.RequestCycleListenerCollection$3.notify(RequestCycleListenerCollection.java:101)&lt;br/&gt;
	at org.apache.wicket.util.listener.ListenerCollection$1.notify(ListenerCollection.java:120)&lt;br/&gt;
	at org.apache.wicket.util.listener.ListenerCollection.reversedNotify(ListenerCollection.java:144)&lt;br/&gt;
	at org.apache.wicket.util.listener.ListenerCollection.reversedNotifyIgnoringExceptions(ListenerCollection.java:113)&lt;br/&gt;
	at org.apache.wicket.request.cycle.RequestCycleListenerCollection.onDetach(RequestCycleListenerCollection.java:100)&lt;br/&gt;
	at org.apache.wicket.request.cycle.RequestCycle.onDetach(RequestCycle.java:669)&lt;br/&gt;
	at org.apache.wicket.request.cycle.RequestCycle.detach(RequestCycle.java:614)&lt;br/&gt;
	at org.apache.wicket.protocol.http.WicketFilter.processRequestCycle(WicketFilter.java:284)&lt;br/&gt;
	at org.apache.wicket.protocol.http.WicketFilter.processRequest(WicketFilter.java:207)&lt;br/&gt;
	at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:306)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)&lt;br/&gt;
	at org.partners.ckms.server.TransactionFilter$1.run(TransactionFilter.java:95)&lt;br/&gt;
	at org.partners.ckms.CkmsManager$32.call(CkmsManager.java:3361)&lt;br/&gt;
	at org.partners.ckms.CkmsManager$32.call(CkmsManager.java:3358)&lt;br/&gt;
	at org.partners.ckms.CkmsManager.executeInTransaction(CkmsManager.java:3381)&lt;br/&gt;
	at org.partners.ckms.CkmsManager.executeInTransaction(CkmsManager.java:3356)&lt;br/&gt;
	at org.partners.ckms.server.TransactionFilter.doFilter(TransactionFilter.java:91)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)&lt;br/&gt;
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:61)&lt;br/&gt;
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)&lt;br/&gt;
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)&lt;br/&gt;
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)&lt;br/&gt;
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)&lt;br/&gt;
	at org.apache.shiro.web.servlet.AdviceFilter.executeChain(AdviceFilter.java:108)&lt;br/&gt;
	at org.apache.shiro.web.servlet.AdviceFilter.doFilterInternal(AdviceFilter.java:137)&lt;br/&gt;
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)&lt;br/&gt;
	at org.apache.shiro.web.servlet.ProxiedFilterChain.doFilter(ProxiedFilterChain.java:66)&lt;br/&gt;
	at org.apache.shiro.web.servlet.AbstractShiroFilter.executeChain(AbstractShiroFilter.java:449)&lt;br/&gt;
	at org.apache.shiro.web.servlet.AbstractShiroFilter$1.call(AbstractShiroFilter.java:365)&lt;br/&gt;
	at org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90)&lt;br/&gt;
	at org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83)&lt;br/&gt;
	at org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387)&lt;br/&gt;
	at org.apache.shiro.web.servlet.AbstractShiroFilter.doFilterInternal(AbstractShiroFilter.java:362)&lt;br/&gt;
	at org.apache.shiro.web.servlet.CkmsShiroFilter.doFilterInternal(CkmsShiroFilter.java:58)&lt;br/&gt;
	at org.apache.shiro.web.servlet.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:125)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)&lt;br/&gt;
	at org.partners.ckms.server.CkmsManagerProxyFilter.doFilter(CkmsManagerProxyFilter.java:61)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)&lt;br/&gt;
	at org.partners.ckms.server.ShutdownOnErrorFilter.doFilter(ShutdownOnErrorFilter.java:39)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)&lt;br/&gt;
	at org.apache.catalina.filters.HttpHeaderSecurityFilter.doFilter(HttpHeaderSecurityFilter.java:126)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)&lt;br/&gt;
	at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)&lt;br/&gt;
	at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:199)&lt;br/&gt;
	at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:97)&lt;br/&gt;
	at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:543)&lt;br/&gt;
	at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:143)&lt;br/&gt;
	at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:81)&lt;br/&gt;
	at org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:690)&lt;br/&gt;
	at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:78)&lt;br/&gt;
	at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)&lt;br/&gt;
	at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:616)&lt;br/&gt;
	at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)&lt;br/&gt;
	at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:818)&lt;br/&gt;
	at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1626)&lt;br/&gt;
	at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)&lt;br/&gt;
	at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)&lt;br/&gt;
	at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)&lt;br/&gt;
	at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)&lt;br/&gt;
	at java.base/java.lang.Thread.run(Thread.java:834)&lt;/p&gt;</comment>
                            <comment id="17227284" author="reiern70" created="Fri, 6 Nov 2020 10:04:15 +0000"  >&lt;p&gt;Sorry. We had other top priorities at work &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I still get this error on our logs with latest master.&lt;/p&gt;</comment>
                            <comment id="17227324" author="papegaaij" created="Fri, 6 Nov 2020 10:53:27 +0000"  >&lt;p&gt;I think I know the cause of the problem. The check &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgrigorov&quot; class=&quot;user-hover&quot; rel=&quot;mgrigorov&quot;&gt;mgrigorov&lt;/a&gt; added in &lt;a href=&quot;https://github.com/apache/wicket/commit/8664176abcc6393c54b29d058c655d440500bc8d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/commit/8664176abcc6393c54b29d058c655d440500bc8d&lt;/a&gt; is done at a moment when we cannot always know if the page is stateless or not. One of the locations it is called from is &lt;tt&gt;onInitialize&lt;/tt&gt;, at which point the page very likely does not hold any components yet. On thing I do find strange though, is that I consistently get a second call from &lt;tt&gt;onAfterRender&lt;/tt&gt;, at which point the session is also created. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reiern70&quot; class=&quot;user-hover&quot; rel=&quot;reiern70&quot;&gt;reiern70&lt;/a&gt; could it be that you are instantiating pages without actually rendering them?&lt;/p&gt;</comment>
                            <comment id="17227331" author="reiern70" created="Fri, 6 Nov 2020 11:02:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=papegaaij&quot; class=&quot;user-hover&quot; rel=&quot;papegaaij&quot;&gt;papegaaij&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Trying to check.&lt;/p&gt;</comment>
                            <comment id="17227336" author="papegaaij" created="Fri, 6 Nov 2020 11:06:06 +0000"  >&lt;p&gt;I&apos;m looking at the change by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgrigorov&quot; class=&quot;user-hover&quot; rel=&quot;mgrigorov&quot;&gt;mgrigorov&lt;/a&gt; once more and I think it is incorrect. &lt;tt&gt;RequestPageStore.addPage&lt;/tt&gt; is called from &lt;tt&gt;Page.onInitialize&lt;/tt&gt;, which can be called from &lt;tt&gt;Page.isPageStateless&lt;/tt&gt; and now &lt;tt&gt;RequestPageStore.addPage&lt;/tt&gt; calls &lt;tt&gt;Page.isPageStateless&lt;/tt&gt; again. IMHO this is bound to give problems. Here&apos;s a stack dump from our application (on 9.1.0):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
RequestPageStore.addPage(IPageContext, IManageablePage) line: 62	
DecoratablePageManager(PageManager).touchPage(IManageablePage) line: 67	
DecoratablePageManager.touchPage(IManageablePage) line: 22	
PageAccessSynchronizer$1.touchPage(IManageablePage) line: 150	
ConfigApplicationPage(Page).onInitialize() line: 301	
ConfigApplicationPage(AbstractKeyHubPage).onInitialize() line: 64	
ConfigApplicationPage(AbstractSecureKeyHubPage).onInitialize() line: 84	
ConfigApplicationPage(AbstractKeyHubAdminPage).onInitialize() line: 57	
ConfigApplicationPage.onInitialize() line: 25	
ConfigApplicationPage(Component).fireInitialize() line: 874	
ConfigApplicationPage(MarkupContainer).internalInitialize() line: 1050	
ConfigApplicationPage(Page).isPageStateless() line: 461	
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17227380" author="reiern70" created="Fri, 6 Nov 2020 12:44:09 +0000"  >&lt;p&gt;DecoratablePageManager is your own class? I can&apos;t find it in wicket codebase&lt;/p&gt;</comment>
                            <comment id="17227385" author="papegaaij" created="Fri, 6 Nov 2020 12:50:42 +0000"  >&lt;p&gt;Yes, but in this case it simply calls &lt;tt&gt;super.touchPage&lt;/tt&gt;, so it does not make a difference for the flow.&lt;/p&gt;</comment>
                            <comment id="17227394" author="mgrigorov" created="Fri, 6 Nov 2020 13:08:50 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
isPageStateless and now RequestPageStore.addPage calls Page.isPageStateless again. IMHO &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is bound to give problems.  &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Why ?&lt;/p&gt;

&lt;p&gt;The new code just binds an HttpSession if the page is already known to be stateful.&lt;/p&gt;

&lt;p&gt;If it becomes stateful at a later point in time then the new code does nothing harmful.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I guess we need to add a new step before committing the request:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;check whether there are stateful pages to be stored and bind HttpSession if needed&lt;/li&gt;
	&lt;li&gt;commit request&lt;/li&gt;
	&lt;li&gt;detach the page&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If this works then my previous change could be removed as obsolete.&lt;/p&gt;

&lt;p&gt;In any case it would be nice to have a test case demonstrating the current issue to protect us from further regressions.&lt;/p&gt;</comment>
                            <comment id="17227396" author="reiern70" created="Fri, 6 Nov 2020 13:15:09 +0000"  >&lt;p&gt;Ok. Situation arises in our case because we have a stateFul page unit test logs out and there is no longer a session... Still debugging&lt;/p&gt;</comment>
                            <comment id="17227539" author="jira-bot" created="Fri, 6 Nov 2020 17:38:55 +0000"  >&lt;p&gt;Commit 15a6cedfb8b855c004b2ece201d9eac063ef770e in wicket&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt;-onEndRequest-before-flush from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=15a6ced&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=15a6ced&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt; onEndRequest before flush&lt;/p&gt;

&lt;p&gt;allows RequestPageStore to check for stateful pages&lt;/p&gt;</comment>
                            <comment id="17227543" author="svenmeier" created="Fri, 6 Nov 2020 17:42:45 +0000"  >&lt;p&gt;With &lt;a href=&quot;https://github.com/apache/wicket/commit/15a6cedfb8b855c004b2ece201d9eac063ef770e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/commit/15a6cedfb8b855c004b2ece201d9eac063ef770e&lt;/a&gt; RequestCycle calls #onEndRequest() from processRequest() instead onDetach().&lt;/p&gt;

&lt;p&gt;This allows listeners to do things before flush, which itself is an improvement.&lt;/p&gt;

&lt;p&gt;Furthermore IPageManager/IPageStore/RequestPageStore can add a sessions cookie as late as possible but &lt;b&gt;before&lt;/b&gt; flush.&lt;/p&gt;</comment>
                            <comment id="17227744" author="reiern70" created="Sat, 7 Nov 2020 06:36:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt;thanks for your work. This seems to fix problem. Running our full battery  of tests now to double check.&lt;/p&gt;</comment>
                            <comment id="17227765" author="svenmeier" created="Sat, 7 Nov 2020 09:03:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reiern70&quot; class=&quot;user-hover&quot; rel=&quot;reiern70&quot;&gt;reiern70&lt;/a&gt;Thanks for testing this.&lt;/p&gt;

&lt;p&gt;Note that I&apos;ve added another commit for &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6848&quot; title=&quot;Session invalidation fails because response is already committed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6848&quot;&gt;&lt;del&gt;WICKET-6848&lt;/del&gt;&lt;/a&gt;. It seems we could handle session invalidation the same way.&lt;/p&gt;</comment>
                            <comment id="17230026" author="jira-bot" created="Wed, 11 Nov 2020 15:23:41 +0000"  >&lt;p&gt;Commit 2f49bc2826e855a0882efb1409b0ad2188c08661 in wicket&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt;-onEndRequest-before-flush from Emond Papegaaij&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=2f49bc2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=2f49bc2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt;: swap listeners and RequestCycle onEndRequest&lt;/p&gt;

&lt;p&gt;This makes sure the session is destroyed (when needed) after the page&lt;br/&gt;
store handles the touched pages. This latter action can create a new&lt;br/&gt;
session if it was destroyed before, causing logout to fail.&lt;/p&gt;</comment>
                            <comment id="17230076" author="reiern70" created="Wed, 11 Nov 2020 16:37:49 +0000"  >&lt;p&gt;Shall I re-test our app?&lt;/p&gt;</comment>
                            <comment id="17230135" author="jira-bot" created="Wed, 11 Nov 2020 17:59:00 +0000"  >&lt;p&gt;Commit e87ef60abfc0f31942a940cef93a3e68b62d4f0c in wicket&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt;-onEndRequest-before-flush from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=e87ef60&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=e87ef60&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt; clear pages in invalidateNow()&lt;/p&gt;

&lt;p&gt;otherwise they will be stored on detach when no session is available and response already committed&lt;/p&gt;</comment>
                            <comment id="17230139" author="svenmeier" created="Wed, 11 Nov 2020 18:01:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=papegaaij&quot; class=&quot;user-hover&quot; rel=&quot;papegaaij&quot;&gt;papegaaij&lt;/a&gt; Thanks, had to add another commit, see &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6848&quot; title=&quot;Session invalidation fails because response is already committed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6848&quot;&gt;&lt;del&gt;WICKET-6848&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reiern70&quot; class=&quot;user-hover&quot; rel=&quot;reiern70&quot;&gt;reiern70&lt;/a&gt; Please re-test.&lt;/p&gt;</comment>
                            <comment id="17230140" author="papegaaij" created="Wed, 11 Nov 2020 18:01:52 +0000"  >&lt;p&gt;Yes, please retest, this piece of code is quite difficult to get right.&lt;/p&gt;</comment>
                            <comment id="17230148" author="jira-bot" created="Wed, 11 Nov 2020 18:10:43 +0000"  >&lt;p&gt;Commit eac4e97c88ca9bdf2483894de2b93a19b19aa168 in wicket&apos;s branch refs/heads/&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt;-onEndRequest-before-flush from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=eac4e97&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=eac4e97&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt; small optimization&lt;/p&gt;</comment>
                            <comment id="17230400" author="reiern70" created="Thu, 12 Nov 2020 07:36:09 +0000"  >&lt;p&gt;Same branch?&lt;/p&gt;</comment>
                            <comment id="17230453" author="svenmeier" created="Thu, 12 Nov 2020 08:55:11 +0000"  >&lt;p&gt;Yes, still the same branch&lt;/p&gt;</comment>
                            <comment id="17230521" author="reiern70" created="Thu, 12 Nov 2020 10:52:47 +0000"  >&lt;p&gt;100% of our selenium tests have passed and no server side related errors. Thus, at least from our sides issue seem to be fixed. IMHO it would be good to release 9.2.0 ASAP (though we have no real hurry for this as only our master depends on 9.x and we have no release based on master soon). Thanks again for support.&lt;/p&gt;</comment>
                            <comment id="17232051" author="bitstorm" created="Sat, 14 Nov 2020 15:35:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;IMHO it would be good to release 9.2.0 ASAP (though we have no real hurry for this as only our master depends on 9.x and we have no release based on master soon). Thanks again for support.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I will start the release as soon as the issue branch will be merged into master. BTW, does this issue also affect 8.x?&lt;/p&gt;</comment>
                            <comment id="17232163" author="papegaaij" created="Sat, 14 Nov 2020 21:51:59 +0000"  >&lt;p&gt;Yes, this also affects 8.x.&lt;/p&gt;</comment>
                            <comment id="17232174" author="jira-bot" created="Sat, 14 Nov 2020 23:36:27 +0000"  >&lt;p&gt;Commit a1c94760fdaf5769211c47edfd1a4ac6077e998f in wicket&apos;s branch refs/heads/wicket-8.x from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=a1c9476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=a1c9476&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6848&quot; title=&quot;Session invalidation fails because response is already committed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6848&quot;&gt;&lt;del&gt;WICKET-6848&lt;/del&gt;&lt;/a&gt; flush before detach fixes&lt;/p&gt;</comment>
                            <comment id="17232176" author="jira-bot" created="Sat, 14 Nov 2020 23:37:48 +0000"  >&lt;p&gt;Commit b4e4658efa10ff08019158fa0f24de6cbebacbcc in wicket&apos;s branch refs/heads/master from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=b4e4658&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=b4e4658&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt; onEndRequest before flush&lt;/p&gt;

&lt;p&gt;allows RequestPageStore to check for stateful pages&lt;/p&gt;</comment>
                            <comment id="17232178" author="jira-bot" created="Sat, 14 Nov 2020 23:37:51 +0000"  >&lt;p&gt;Commit 0cb3d6798f4056352c8214ade49fe5fd5947e5c9 in wicket&apos;s branch refs/heads/master from Emond Papegaaij&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=0cb3d67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=0cb3d67&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt;: swap listeners and RequestCycle onEndRequest&lt;/p&gt;

&lt;p&gt;This makes sure the session is destroyed (when needed) after the page&lt;br/&gt;
store handles the touched pages. This latter action can create a new&lt;br/&gt;
session if it was destroyed before, causing logout to fail.&lt;/p&gt;</comment>
                            <comment id="17232179" author="jira-bot" created="Sat, 14 Nov 2020 23:37:53 +0000"  >&lt;p&gt;Commit 2feed893069031f5d6e2a9353e73dae06f61864c in wicket&apos;s branch refs/heads/master from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=2feed89&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=2feed89&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt; clear pages in invalidateNow()&lt;/p&gt;

&lt;p&gt;otherwise they will be stored on detach when no session is available and response already committed&lt;/p&gt;</comment>
                            <comment id="17232180" author="jira-bot" created="Sat, 14 Nov 2020 23:37:56 +0000"  >&lt;p&gt;Commit 65e5ceab7498d9dec73e50d3d4cfd01302dd64de in wicket&apos;s branch refs/heads/master from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=65e5cea&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=65e5cea&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt; small optimization&lt;/p&gt;</comment>
                            <comment id="17232181" author="svenmeier" created="Sat, 14 Nov 2020 23:40:29 +0000"  >&lt;p&gt;Changes are pushed to master and 8.x now, please take another look and run your tests.&lt;/p&gt;</comment>
                            <comment id="17232236" author="jira-bot" created="Sun, 15 Nov 2020 11:33:11 +0000"  >&lt;p&gt;Commit 1409d269e2c93bff83f8a5b57bbac5ecf238487f in wicket&apos;s branch refs/heads/master from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=1409d26&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=1409d26&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt; comment for clirr configuration&lt;/p&gt;

&lt;p&gt;clirr does not support adding default methods to interfaces&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                                                <inwardlinks description="is fixed by">
                                        <issuelink>
            <issuekey id="13336251">WICKET-6845</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13343060">WICKET-6856</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13327872">WICKET-6831</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13338028">WICKET-6848</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jxhs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>