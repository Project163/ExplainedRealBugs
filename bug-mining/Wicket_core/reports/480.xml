<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:19:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-4251] Multipart Form and AjaxSubmitLink will result in invalid redirect after user session expires</title>
                <link>https://issues.apache.org/jira/browse/WICKET-4251</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I have hit an issue similar to this one:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-3141&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/WICKET-3141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I do not receive any errors from Wicket itself to help clarify, so I will try to explain using an example.&lt;/p&gt;

&lt;p&gt;The example below with which I could recreate the issue uses the default SignInPanel (in my LoginPage.clas) and AuthenticatedWebSession to authenticate the user and store the session:&lt;/p&gt;

&lt;p&gt;	protected Class&amp;lt;? extends WebPage&amp;gt; getSignInPageClass()&lt;/p&gt;
	{
		return LoginPage.class;
	}

&lt;p&gt;If the authentiation is succesfull then the user is redirect back to the test page:&lt;/p&gt;

&lt;p&gt;			protected void onSignInSucceeded() &lt;/p&gt;
{
				setResponsePage(Test.class);
			}

&lt;p&gt;So far so good. However if I use a form with setMultiPart(true) in combination with an AjaxSubmitLink as shown in the following piece of code:&lt;/p&gt;

&lt;p&gt;import org.apache.wicket.ajax.AjaxRequestTarget;&lt;br/&gt;
import org.apache.wicket.ajax.markup.html.form.AjaxSubmitLink;&lt;br/&gt;
import org.apache.wicket.authroles.authorization.strategies.role.annotations.AuthorizeInstantiation;&lt;br/&gt;
import org.apache.wicket.markup.html.WebPage;&lt;br/&gt;
import org.apache.wicket.markup.html.form.Form;&lt;/p&gt;

&lt;p&gt;@AuthorizeInstantiation(&quot;USER&quot;)&lt;br/&gt;
public class Test extends WebPage {&lt;/p&gt;

&lt;p&gt;	public Test()&lt;br/&gt;
	{&lt;br/&gt;
		super();&lt;/p&gt;

&lt;p&gt;		final Form testForm = &lt;br/&gt;
				new Form(&quot;testForm&quot;);&lt;/p&gt;

&lt;p&gt;		testForm.setMultiPart(true);&lt;/p&gt;

&lt;p&gt;		testForm.add(new AjaxSubmitLink(&quot;testButton&quot;, testForm) {&lt;/p&gt;

&lt;p&gt;			@Override&lt;br/&gt;
			protected void onSubmit(AjaxRequestTarget target, Form form) &lt;/p&gt;
{
				super.onSubmit();
			}
&lt;p&gt;;&lt;/p&gt;

&lt;p&gt;			@Override&lt;br/&gt;
			protected void onError(AjaxRequestTarget target, Form form) {&lt;/p&gt;

&lt;p&gt;			};&lt;br/&gt;
		});&lt;/p&gt;

&lt;p&gt;		add(testForm);&lt;br/&gt;
	}&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;And have selected the option &quot;Remember credentials&quot; in the SignInPanel, clicking on the testButton AFTER the session has expired will result in:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://localhost:8080/PaladinWicket/?3-1.IBehaviorListener.0-testForm-testButton&amp;amp;wicket-ajax=true&amp;amp;wicket-ajax-baseurl=&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/PaladinWicket/?3-1.IBehaviorListener.0-testForm-testButton&amp;amp;wicket-ajax=true&amp;amp;wicket-ajax-baseurl=&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;which displays this in the browser:&lt;/p&gt;

&lt;p&gt;This XML file does not appear to have any style information associated with it. The document tree is shown below.&lt;br/&gt;
&amp;lt;ajax-response&amp;gt;&lt;br/&gt;
&amp;lt;redirect&amp;gt;&lt;br/&gt;
&amp;lt;![CDATA[ .?1 ]]&amp;gt;&lt;br/&gt;
&amp;lt;/redirect&amp;gt;&lt;br/&gt;
&amp;lt;/ajax-response&amp;gt;&lt;/p&gt;</description>
                <environment>JDK_1.6_027/Windows/Linux/Explorer/Chrome/Firefox</environment>
        <key id="12532149">WICKET-4251</key>
            <summary>Multipart Form and AjaxSubmitLink will result in invalid redirect after user session expires</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="trixom">Tom Rixom</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Nov 2011 13:10:42 +0000</created>
                <updated>Fri, 16 Dec 2011 14:08:35 +0000</updated>
                            <resolved>Fri, 16 Dec 2011 14:08:35 +0000</resolved>
                                    <version>1.5.3</version>
                                    <fixVersion>1.5.4</fixVersion>
                    <fixVersion>6.0.0-beta1</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13154171" author="mgrigorov" created="Mon, 21 Nov 2011 13:29:09 +0000"  >&lt;p&gt;Please package these code snippets in an executable quickstart application. This will save us some time to reproduce and debug it.&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="13154189" author="trixom" created="Mon, 21 Nov 2011 13:59:32 +0000"  >&lt;p&gt;Login as test/test and set the &quot;Remember credentials&quot;&lt;/p&gt;

&lt;p&gt;Wait for 1 minute and click on the &quot;Test&quot; button.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13155891" author="trixom" created="Wed, 23 Nov 2011 14:15:25 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Is it possible to get an assessment on the issue I am having? Is it maybe something I can workaround for the time being (except disabling &quot;Remember credentials&quot;...)?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Tom&lt;/p&gt;</comment>
                            <comment id="13156716" author="mgrigorov" created="Thu, 24 Nov 2011 13:57:14 +0000"  >&lt;p&gt;Here is a patch that solves the problem.&lt;/p&gt;

&lt;p&gt;Details:&lt;br/&gt;
the form is submitted with Ajax via iframe, then Wicket detects that the session has expired and redirects to the login page and stores the &quot;original destination&quot; (url and post parameters). &lt;br/&gt;
After this redirect the requests are no more Ajax!&lt;br/&gt;
Since there is a &quot;remember me&quot; cookie the login page automatically re-authenticates and redirects to the original destination (again in non-Ajax request). Here we use the stored url and post parameters and try to redirect but &quot;wicket-ajax=true&quot; parameter confuses the logic in ServletWebResponse#sendRedirect() and XML response (&amp;lt;redirect&amp;gt;...&amp;lt;/redirect&amp;gt;) is generated instead of normal redirect.&lt;/p&gt;

&lt;p&gt;@Igor: I&apos;m assigning the ticket to you to check whether the logic to filter these special parameters is OK to be there. We already have similar logic in UrlInfo class. Maybe this should be extracted in one common place and reused ? Where is this place ?!&lt;/p&gt;

&lt;p&gt;Another observation: WebRequest.isAjax() is called many times in request&apos;s lifetime. Is it safe to lazy evaluate this boolean and cache it ? &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12505011" name="WICKET-4251.patch" size="2406" author="mgrigorov" created="Thu, 24 Nov 2011 13:57:14 +0000"/>
                            <attachment id="12504502" name="myproject.rar" size="24116" author="trixom" created="Mon, 21 Nov 2011 13:59:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>217885</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0k8xz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116266</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>