<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:24:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-6102] StackoverflowError related to enclosures</title>
                <link>https://issues.apache.org/jira/browse/WICKET-6102</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;I see the following exception when try to start Wicket-Bootstrap&apos;s samples with 7.3.0-SNAPSHOT.&lt;br/&gt;
There is no such problem with 7.2.0&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.StackOverflowError
	at java.util.ArrayList.iterator(ArrayList.java:834)
	at org.apache.wicket.MarkupContainer$1MarkupChildIterator.refreshInternalIteratorIfNeeded(MarkupContainer.java:608)
	at org.apache.wicket.MarkupContainer$1MarkupChildIterator.hasNext(MarkupContainer.java:574)
	at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:134)
	at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:162)
	at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:162)
	at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:162)
	at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:162)
	at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:162)
	at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:162)
	at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:162)
	at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:162)
	at org.apache.wicket.util.visit.Visits.visitChildren(Visits.java:123)
	at org.apache.wicket.MarkupContainer.visitChildren(MarkupContainer.java:968)
	at org.apache.wicket.markup.html.panel.AbstractMarkupSourcingStrategy.searchMarkupInTransparentResolvers(AbstractMarkupSourcingStrategy.java:77)
	at org.apache.wicket.markup.html.panel.AssociatedMarkupSourcingStrategy.getMarkup(AssociatedMarkupSourcingStrategy.java:123)
	at org.apache.wicket.MarkupContainer.getMarkup(MarkupContainer.java:504)
	at org.apache.wicket.Component.getMarkup(Component.java:755)
	at org.apache.wicket.markup.html.internal.Enclosure.getChild(Enclosure.java:136)
	at org.apache.wicket.markup.html.internal.Enclosure.isVisible(Enclosure.java:171)
	at org.apache.wicket.markup.html.panel.AbstractMarkupSourcingStrategy.searchMarkupInTransparentResolvers(AbstractMarkupSourcingStrategy.java:90)
	at org.apache.wicket.markup.html.panel.AssociatedMarkupSourcingStrategy.getMarkup(AssociatedMarkupSourcingStrategy.java:123)
	at org.apache.wicket.MarkupContainer.getMarkup(MarkupContainer.java:504)
	at org.apache.wicket.Component.getMarkup(Component.java:755)
	at org.apache.wicket.markup.html.internal.Enclosure.getChild(Enclosure.java:136)
	at org.apache.wicket.markup.html.internal.Enclosure.isVisible(Enclosure.java:171)
	at org.apache.wicket.markup.html.panel.AbstractMarkupSourcingStrategy.searchMarkupInTransparentResolvers(AbstractMarkupSourcingStrategy.java:90)
	at org.apache.wicket.markup.html.panel.AssociatedMarkupSourcingStrategy.getMarkup(AssociatedMarkupSourcingStrategy.java:123)
	at org.apache.wicket.MarkupContainer.getMarkup(MarkupContainer.java:504)
	at org.apache.wicket.Component.getMarkup(Component.java:755)
	at org.apache.wicket.markup.html.internal.Enclosure.getChild(Enclosure.java:136)
	at org.apache.wicket.markup.html.internal.Enclosure.isVisible(Enclosure.java:171)
	at org.apache.wicket.markup.html.panel.AbstractMarkupSourcingStrategy.searchMarkupInTransparentResolvers(AbstractMarkupSourcingStrategy.java:90)
	at org.apache.wicket.markup.html.panel.AssociatedMarkupSourcingStrategy.getMarkup(AssociatedMarkupSourcingStrategy.java:123)
	at org.apache.wicket.MarkupContainer.getMarkup(MarkupContainer.java:504)
	at org.apache.wicket.Component.getMarkup(Component.java:755)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To reproduce:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;git clone &lt;a href=&quot;https://github.com/l0rdn1kk0n/wicket-bootstrap/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/l0rdn1kk0n/wicket-bootstrap/&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;edit pom.xml and set Wicket version to 7.3.0-SNAPSHOT&lt;/li&gt;
	&lt;li&gt;git checkout db35564a0c0972da13448545078184ae0e9a009b&lt;/li&gt;
	&lt;li&gt;mvn clean install&lt;/li&gt;
	&lt;li&gt;cd bootstrap-samples&lt;/li&gt;
	&lt;li&gt;mvn jetty:run&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12942980">WICKET-6102</key>
            <summary>StackoverflowError related to enclosures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mgrigorov">Martin Tzvetanov Grigorov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Feb 2016 15:26:52 +0000</created>
                <updated>Wed, 20 Apr 2016 17:48:04 +0000</updated>
                            <resolved>Sat, 27 Feb 2016 18:46:43 +0000</resolved>
                                    <version>7.2.0</version>
                    <version>8.0.0-M1</version>
                                    <fixVersion>7.3.0</fixVersion>
                    <fixVersion>8.0.0-M1</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15168005" author="mgrigorov" created="Thu, 25 Feb 2016 22:37:30 +0000"  >&lt;p&gt;I&apos;ve modified Wicket-Bootstrap to not use InlineEnclosure but to use EnclosureContainer, so now I can run against Wicket 7.3.0-SNAPSHOT again.&lt;br/&gt;
&lt;a href=&quot;https://github.com/l0rdn1kk0n/wicket-bootstrap/commit/c0e91b2cecc74fbd9b2d52492599081c86f83472&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/l0rdn1kk0n/wicket-bootstrap/commit/c0e91b2cecc74fbd9b2d52492599081c86f83472&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15168007" author="mgrigorov" created="Thu, 25 Feb 2016 22:38:18 +0000"  >&lt;p&gt;I&apos;ve updated the steps to reproduce to use the commit before the fix.&lt;/p&gt;</comment>
                            <comment id="15168843" author="jira-bot" created="Fri, 26 Feb 2016 11:25:39 +0000"  >&lt;p&gt;Commit 294c12452098e0ddb4075f943d56faad8b203a07 in wicket&apos;s branch refs/heads/wicket-7.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bitstorm&quot; class=&quot;user-hover&quot; rel=&quot;bitstorm&quot;&gt;bitstorm&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=294c124&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=294c124&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6102&quot; title=&quot;StackoverflowError related to enclosures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6102&quot;&gt;&lt;del&gt;WICKET-6102&lt;/del&gt;&lt;/a&gt; StackoverflowError related to enclosures&lt;/p&gt;

&lt;p&gt;Removed a wrong assumption aboutTransparentWebMarkupContainer&lt;/p&gt;</comment>
                            <comment id="15168933" author="bitstorm" created="Fri, 26 Feb 2016 12:51:41 +0000"  >&lt;p&gt;It turned out that was a problem with a custom version of TransparentWebMarkupContainer#addDequeuedComponent I wrote. I removed it.&lt;/p&gt;</comment>
                            <comment id="15169044" author="mgrigorov" created="Fri, 26 Feb 2016 13:52:50 +0000"  >&lt;p&gt;I confirm that this fixes the problem!&lt;br/&gt;
Thanks, Andrea!&lt;/p&gt;</comment>
                            <comment id="15169340" author="jira-bot" created="Fri, 26 Feb 2016 17:11:26 +0000"  >&lt;p&gt;Commit b9860519cc004c97d1f3c17807e439a2262e7bf8 in wicket&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bitstorm&quot; class=&quot;user-hover&quot; rel=&quot;bitstorm&quot;&gt;bitstorm&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=b986051&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=b986051&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6102&quot; title=&quot;StackoverflowError related to enclosures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6102&quot;&gt;&lt;del&gt;WICKET-6102&lt;/del&gt;&lt;/a&gt; StackoverflowError related to enclosures&lt;/p&gt;

&lt;p&gt;Removed a wrong assumption aboutTransparentWebMarkupContainer&lt;br/&gt;
Conflicts:&lt;br/&gt;
	wicket-core/src/main/java/org/apache/wicket/markup/html/TransparentWebMarkupContainer.java&lt;/p&gt;</comment>
                            <comment id="15244152" author="cquarters" created="Sat, 16 Apr 2016 11:18:14 +0000"  >&lt;p&gt;My apologies if this is not the correct place to post this but I think it adds context (and maybe another perspective) to this bug.&lt;/p&gt;

&lt;p&gt;I have been experiencing this StackOverflowError with &amp;lt;wicket:enclosure&amp;gt; since 7.0.0 (also in 7.1.0 and 7.2.0). I had no problems with M1 - M6. My call stack has the same recursion as in this bug although my line numbers below are different because it&apos;s 7.2.0 code.&lt;/p&gt;

&lt;p&gt;java.lang.StackOverflowError&lt;br/&gt;
	at java.lang.StringBuilder.append(StringBuilder.java:136)&lt;br/&gt;
	at org.apache.wicket.markup.DefaultMarkupCacheKeyProvider.getCacheKey(DefaultMarkupCacheKeyProvider.java:55)&lt;br/&gt;
	at org.apache.wicket.markup.MarkupCache.getMarkup(MarkupCache.java:276)&lt;br/&gt;
	at org.apache.wicket.markup.MarkupFactory.getMarkup(MarkupFactory.java:236)&lt;br/&gt;
	at org.apache.wicket.markup.MarkupFactory.getMarkup(MarkupFactory.java:194)&lt;br/&gt;
	at org.apache.wicket.MarkupContainer.getAssociatedMarkup(MarkupContainer.java:456)&lt;br/&gt;
	at org.apache.wicket.markup.html.panel.AssociatedMarkupSourcingStrategy.getMarkup(AssociatedMarkupSourcingStrategy.java:95)&lt;br/&gt;
 	at org.apache.wicket.MarkupContainer.getMarkup(MarkupContainer.java:502)&lt;br/&gt;
	at org.apache.wicket.Component.getMarkup(Component.java:755)&lt;br/&gt;
	at org.apache.wicket.markup.html.internal.Enclosure.getChild(Enclosure.java:138)&lt;br/&gt;
	at org.apache.wicket.markup.html.internal.Enclosure.isVisible(Enclosure.java:173)&lt;br/&gt;
	at org.apache.wicket.markup.html.panel.AbstractMarkupSourcingStrategy.searchMarkupInTransparentResolvers(AbstractMarkupSourcingStrategy.java:90)&lt;br/&gt;
	at org.apache.wicket.markup.html.panel.AssociatedMarkupSourcingStrategy.getMarkup(AssociatedMarkupSourcingStrategy.java:123)&lt;br/&gt;
 	at org.apache.wicket.MarkupContainer.getMarkup(MarkupContainer.java:502)&lt;br/&gt;
	at org.apache.wicket.Component.getMarkup(Component.java:755)&lt;br/&gt;
	at org.apache.wicket.markup.html.internal.Enclosure.getChild(Enclosure.java:138)&lt;br/&gt;
	at org.apache.wicket.markup.html.internal.Enclosure.isVisible(Enclosure.java:173)&lt;br/&gt;
	at org.apache.wicket.markup.html.panel.AbstractMarkupSourcingStrategy.searchMarkupInTransparentResolvers(AbstractMarkupSourcingStrategy.java:90)&lt;br/&gt;
	at org.apache.wicket.markup.html.panel.AssociatedMarkupSourcingStrategy.getMarkup(AssociatedMarkupSourcingStrategy.java:123)&lt;br/&gt;
 	at org.apache.wicket.MarkupContainer.getMarkup(MarkupContainer.java:502)&lt;br/&gt;
	at org.apache.wicket.Component.getMarkup(Component.java:755)&lt;br/&gt;
etc&lt;/p&gt;

&lt;p&gt;I&apos;ve tried creating a simple example illustrating the problem but have not been able to. It only happens in two large applications I work on.&lt;/p&gt;

&lt;p&gt;I&apos;ve worked around the problem since 7.0.0 by patching&lt;br/&gt;
org.apache.wicket.markup.html.internal.Enclosure&lt;/p&gt;

&lt;p&gt;In the call stack loop you see Enclosure.isVisible(). In my own code I follow this practice&lt;br/&gt;
&lt;a href=&quot;http://wicketinaction.com/2011/11/implement-wicket-component-visibility-changes-properly/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wicketinaction.com/2011/11/implement-wicket-component-visibility-changes-properly/&lt;/a&gt;&lt;br/&gt;
so I deleted Enclosure.isVisible() (!!!) because setVisible() is called in Enclosure.onConfigure(). However, this led to NPEs so I added null checking in Enclosure.onConfigure() and Enclosure.getChild(). For me these changes work well but I&apos;m probably being naive. Is there a reason why it&apos;s important to have code in Enclosure.isVisible() ? Is there any merit in my changes that might be incorporated into Wicket?&lt;/p&gt;

&lt;p&gt;Here&apos;s a diff showing how I modify Enclosure.java &lt;/p&gt;

&lt;p&gt;diff --git a/wicket-core/src/main/java/org/apache/wicket/markup/html/internal/Enclosure.java b/wicket-core/src/main/java/org/apache/wicket/markup/html/internal/Enclosure.java&lt;br/&gt;
index e68f4e0..7616e55 100644&lt;br/&gt;
&amp;#8212; a/wicket-core/src/main/java/org/apache/wicket/markup/html/internal/Enclosure.java&lt;br/&gt;
+++ b/wicket-core/src/main/java/org/apache/wicket/markup/html/internal/Enclosure.java&lt;br/&gt;
@@ -135,7 +135,9 @@&lt;br/&gt;
 		if (childComponent == null)&lt;/p&gt;
 		{
 			// try to find child when resolved
-			childComponent = getChildComponent(new MarkupStream(getMarkup()), getEnclosureParent());
+		  IMarkupFragment markup = getMarkup();
+		  if( markup != null )
+		    childComponent = getChildComponent(new MarkupStream(markup), getEnclosureParent());
 		}
&lt;p&gt; 		return childComponent;&lt;br/&gt;
 	}&lt;br/&gt;
@@ -166,23 +168,22 @@&lt;/p&gt;

&lt;p&gt; 		return childController;&lt;br/&gt;
 	}&lt;br/&gt;
-&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;@Override&lt;/li&gt;
	&lt;li&gt;public boolean isVisible()&lt;/li&gt;
	&lt;li&gt;{
-		return getChild().determineVisibility();
-	}&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Override&lt;br/&gt;
 	protected void onConfigure()&lt;br/&gt;
 	{&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;super.onConfigure();&lt;/li&gt;
	&lt;li&gt;final Component child = getChild();&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;child.configure();&lt;/li&gt;
	&lt;li&gt;boolean childVisible = child.determineVisibility();&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;setVisible(childVisible);&lt;br/&gt;
+	  super.onConfigure();&lt;br/&gt;
+	  boolean childVisible = false;&lt;br/&gt;
+&lt;br/&gt;
+	  final Component child = getChild();&lt;br/&gt;
+&lt;br/&gt;
+	  if( child != null )&lt;br/&gt;
+	  
{
+	    child.configure();
+	    childVisible = child.determineVisibility();
+	  }
&lt;p&gt;+    &lt;br/&gt;
+    setVisible(childVisible);&lt;br/&gt;
 	}&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt; 	@Override&lt;/p&gt;
</comment>
                            <comment id="15244261" author="cquarters" created="Sat, 16 Apr 2016 14:52:09 +0000"  >&lt;p&gt;Apologies. A readable version of my suggested change is here&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/cquarters/wicket/commit/467a543da6d1338eeaa096fb6bcb83dcffa90eaf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/cquarters/wicket/commit/467a543da6d1338eeaa096fb6bcb83dcffa90eaf&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15244642" author="bitstorm" created="Sun, 17 Apr 2016 12:53:10 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;could you try with 7.3.0-SNAPSHOT? Lot of improvements have been done for Enclosure in the 7.3.0 and I think should fix your case as well. The 7.3.0 is in the making and should be out in few days.&lt;/p&gt;</comment>
                            <comment id="15250359" author="cquarters" created="Wed, 20 Apr 2016 17:48:04 +0000"  >&lt;p&gt;Thank you for your reply. I tested with 7.3.0-SNAPSHOT and the stack overflow still happens but now my call stack looks like the one in the description for this JIRA issue (several calls to org.apache.wicket.util.visit.Visits.visitChildren at the top). I will try again with 7.3.0 when it&apos;s released. If I can still recreate the bug, I&apos;ll again try to create a simple test to illustrate.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 30 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2thjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>