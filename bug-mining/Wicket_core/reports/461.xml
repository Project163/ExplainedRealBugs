<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:19:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-4196] Accessing Wicket through AJP makes Wicket vulnerable to HTTP Response Splitting Attack</title>
                <link>https://issues.apache.org/jira/browse/WICKET-4196</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;Hello all,&lt;/p&gt;

&lt;p&gt;When having a Wicket application installed on Tomcat and you call that application through HTTP, Wicket is protected against HTTP Response Splitting. However, when you call Tomcat through AJP (for example through an apache httpd proxy), HTTP Response Splitting becomes possible.&lt;/p&gt;

&lt;p&gt;To demonstrate, I created a simple application and called it through an AJP proxy with the curl command:&lt;/p&gt;

&lt;p&gt;curl -&lt;del&gt;max-redirs 0 -Dfoo &apos;http:///myapp/home?wicket:bookmarkablePage=:org.apache.wicket.markup.html.pages.BrowserInfoPage&amp;amp;cto=Foobar%3f%0d%0aEvilHeader:%20SPLIT%2f&lt;/del&gt;%0d%0aAnotherEvilHeader:%20HEADER&apos;&lt;/p&gt;

&lt;p&gt;Note the &apos;%0d%0a&apos;, a CRLF in the request. When calling Wicket through Tomcat, these are replaced by spaces, but when calling Wicket through AJP, these are left intact, getting us the following response:&lt;/p&gt;

&lt;p&gt;HTTP/1.1 302 Moved Temporarily&lt;br/&gt;
Date: Wed, 02 Nov 2011 14:34:32 GMT&lt;br/&gt;
Server: Apache&lt;br/&gt;
Set-Cookie: JSESSIONID=4F403B53D091B40F6C3FBC2321A2E348.pub-app04; Path=/myapp; HttpOnly Location: http://&amp;lt;ip-address&amp;gt;/myapp/Foobar;jsessionid=4F403B53D091B40F6C3FBC2321A2E348.pub-app04?&lt;br/&gt;
EvilHeader: SPLIT/-&lt;br/&gt;
AnotherEvilHeader: HEADER&lt;br/&gt;
Content-Length: 0&lt;br/&gt;
Connection: close&lt;br/&gt;
Content-Type: text/plain; charset=UTF-8&lt;/p&gt;

&lt;p&gt;Here we have 2 Evil Headers, that could be inserted by hackers by adding %0d%0a to the get-request.&lt;/p&gt;

&lt;p&gt;The problem is that a hacker can now post URL&apos;s that look like they&apos;re going to your site on some forum or in an email. But when the user actually clicks on the link, a custom header could redirect the user to a malicious site. In the example, I used &quot;EvilHeader&quot;, but it could be any header, like an HTTP 301 redirect. Basically, the hacker can include any header he wants in the response that the user is going to get when he clicks on the link.&lt;/p&gt;

&lt;p&gt;Note we are not vulnerable if you connect directly to tomcat with HTTP - it appears that the Coyote HTTP Connector is sanitising the HTTP headers and replacing the CRLF with two spaces. You have to connect via Apache and AJP to reproduce.&lt;/p&gt;

&lt;p&gt;For a more detailed description of HTTP Response Splitting (which is on the OWASP list of security vulnerabilities), you can check:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://www.owasp.org/index.php/HTTP_Response_Splitting&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.owasp.org/index.php/HTTP_Response_Splitting&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://www.acunetix.com/vulnerabilities/CRLF-injectionHTTP-respon.htm&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.acunetix.com/vulnerabilities/CRLF-injectionHTTP-respon.htm&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://packetstormsecurity.org/papers/general/whitepaper_httpresponse.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://packetstormsecurity.org/papers/general/whitepaper_httpresponse.pdf&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://www.infosecwriters.com/text_resources/pdf/HTTP_Response.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.infosecwriters.com/text_resources/pdf/HTTP_Response.pdf&lt;/a&gt; &lt;/p&gt;</description>
                <environment>CentOS 5.6, Apache HTTPD 2.2.3 with mod_jk 1.2.31 and Apache Tomcat 6</environment>
        <key id="12530242">WICKET-4196</key>
            <summary>Accessing Wicket through AJP makes Wicket vulnerable to HTTP Response Splitting Attack</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="gertjan_schouten">Gert-Jan Schouten</reporter>
                        <labels>
                            <label>http</label>
                            <label>security</label>
                    </labels>
                <created>Fri, 4 Nov 2011 09:17:54 +0000</created>
                <updated>Fri, 13 Jan 2012 09:09:36 +0000</updated>
                            <resolved>Fri, 13 Jan 2012 09:09:36 +0000</resolved>
                                    <version>1.4.19</version>
                                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13143859" author="mgrigorov" created="Fri, 4 Nov 2011 09:23:40 +0000"  >&lt;p&gt;Can you provide minimal configuration of HTTPD to be able to make such setup locally to test ? &lt;/p&gt;</comment>
                            <comment id="13143861" author="mgrigorov" created="Fri, 4 Nov 2011 09:25:10 +0000"  >&lt;p&gt;Cite: &quot;When having a Wicket application installed on Tomcat and you call that application through HTTP, Wicket is protected against HTTP Response Splitting&quot;&lt;br/&gt;
This makes me think that this problem is more Tomcat/AJP/HTTPD configuration than problem in Wicket.&lt;/p&gt;</comment>
                            <comment id="13143921" author="gertjan_schouten" created="Fri, 4 Nov 2011 11:14:36 +0000"  >&lt;p&gt;Well, even if Tomcat sanitizes the requests when called through HTTP and not when it&apos;s called through AJP, this still does not make it a Tomcat problem. Wicket should be able to handle unsanitized requests and not be dependent on the container.&lt;/p&gt;

&lt;p&gt;Our apache config is as follows:&lt;/p&gt;

&lt;p&gt;We don&apos;t modify the main apache conf file.&lt;/p&gt;

&lt;p&gt;Find below a sanitised copy of our configuration.&lt;/p&gt;


&lt;p&gt;virtual.conf&lt;br/&gt;
------------&lt;/p&gt;

&lt;p&gt;ServerTokens ProductOnly&lt;br/&gt;
ServerSignature Off&lt;/p&gt;

&lt;p&gt;NameVirtualhost *:80&lt;/p&gt;

&lt;p&gt;&amp;lt;VirtualHost *:80&amp;gt;&lt;br/&gt;
    DocumentRoot /var/www/html&lt;br/&gt;
    ServerName our.server.name&lt;br/&gt;
    ServerAlias server.name&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Modified logging format to include X-Forwarded-For IP addresses&lt;br/&gt;
    LogFormat &quot;%h %l %u %t \&quot;%r\&quot; %&amp;gt;s %b \&quot;%
{Referer}
&lt;p&gt;i\&quot; \&quot;%&lt;/p&gt;
{User-Agent}
&lt;p&gt;i\&quot; \&quot;%&lt;/p&gt;
{X-Forwarded-For}
&lt;p&gt;i\&quot;&quot; combxfwd&lt;br/&gt;
    CustomLog &quot;logs/access_log&quot; combxfwd&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    ServerSignature Off&lt;/p&gt;

&lt;p&gt;    RewriteEngine On&lt;/p&gt;


&lt;p&gt;    RewriteRule ^$ /app-context/ &lt;span class=&quot;error&quot;&gt;&amp;#91;R&amp;#93;&lt;/span&gt;&lt;br/&gt;
    RewriteRule ^/$ /app-context/ &lt;span class=&quot;error&quot;&gt;&amp;#91;R&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;   JkMount /app-context/* app-lb&lt;br/&gt;
   JkMount /app-context app-lb&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Only enable these for debugging&lt;br/&gt;
    #RewriteLog /tmp/rewrite&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Enable compression of text content&lt;br/&gt;
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/json&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&amp;lt;/VirtualHost&amp;gt;&lt;/p&gt;


&lt;p&gt;workers.properties&lt;br/&gt;
------------------&lt;br/&gt;
ps=/&lt;/p&gt;

&lt;p&gt;worker.list=app01, app02, app-lb&lt;br/&gt;
worker.jkstatus.type=status&lt;/p&gt;


&lt;p&gt;worker.app01.type=ajp13&lt;br/&gt;
worker.app01.host=app01&lt;br/&gt;
worker.app01.port=8009&lt;br/&gt;
worker.app01.socket_keepalive=1&lt;/p&gt;

&lt;p&gt;worker.app02.type=ajp13&lt;br/&gt;
worker.app02.host=app02&lt;br/&gt;
worker.app02.port=8009&lt;br/&gt;
worker.app02.socket_keepalive=1&lt;/p&gt;

&lt;p&gt;worker.ajp13.lbfactor=1&lt;/p&gt;

&lt;p&gt;worker.app-lb.type=lb&lt;br/&gt;
worker.app-lb.balance_workers=app01,app02&lt;br/&gt;
worker.app-lb.sticky_session=1&lt;/p&gt;

&lt;p&gt;mod_jk.conf&lt;br/&gt;
-----------&lt;br/&gt;
LoadModule jk_module modules/mod_jk.so&lt;/p&gt;

&lt;p&gt;JkWorkersFile /etc/httpd/conf.d/workers.properties&lt;br/&gt;
JkLogFile     /var/log/httpd/mod_jk.log&lt;br/&gt;
JkShmFile     /var/log/httpd/mod_jk.status&lt;br/&gt;
JkLogLevel    error&lt;br/&gt;
JkLogStampFormat &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;%a %b %d %H:%M:%S %Y&amp;#93;&lt;/span&gt; &quot; &lt;/p&gt;</comment>
                            <comment id="13145569" author="mgrigorov" created="Mon, 7 Nov 2011 15:48:08 +0000"  >&lt;p&gt;I don&apos;t see how Wicket will transform the request (GET) parameters to response headers.&lt;br/&gt;
To me it looks like Tomcat is confused while parsing the request data.&lt;/p&gt;

&lt;p&gt;Please specify the exact version of your Tomcat.&lt;/p&gt;

&lt;p&gt;Can you try your HTTPD/JK setup with Wicket 1.5 quickstart app ?&lt;br/&gt;
The url to BrowserInfoPage should be: /wicket/bookmarkable/org.apache.wicket.markup.html.pages.BrowserInfoPage&lt;/p&gt;</comment>
                            <comment id="13145884" author="ivaynberg" created="Mon, 7 Nov 2011 22:25:41 +0000"  >&lt;p&gt;wicket is not the one transforming the headers, it is tomcat as youve stated. wicket can simply detect this kind of url attack and abort request processing.&lt;/p&gt;</comment>
                            <comment id="13146238" author="mgrigorov" created="Tue, 8 Nov 2011 12:08:11 +0000"  >&lt;p&gt;OK.&lt;br/&gt;
Let&apos;s imagine that Tomcat sanitizes the request when using HTTP connector (e.g. port 8080) and doesn&apos;t do this thru AJP connector (port 8009). In this case the data after %0d%0a will be parsed as HTTP &lt;em&gt;request&lt;/em&gt; headers. So far so good. I can send any headers in the request even without using %0d%0a. &lt;br/&gt;
Now, what bothers me is how these request headers are automatically transferred to the &lt;em&gt;response&lt;/em&gt; headers ?&lt;/p&gt;</comment>
                            <comment id="13146290" author="mgrigorov" created="Tue, 8 Nov 2011 13:17:23 +0000"  >&lt;p&gt;Here are my results with Wicket 1.5:&lt;/p&gt;


&lt;p&gt;curl -&lt;del&gt;max-redirs 0 -D/dev/stdout &apos;http://martin-laptop/4196/helloworld/?wicket/bookmarkable/org.apache.wicket.markup.html.pages.BrowserInfoPage&amp;amp;cto=Foobar%3f%0d%0aEvilHeader:%20SPLIT%2f&lt;/del&gt;%0d%0aAnotherEvilHeader:%20HEADER&apos;&lt;br/&gt;
HTTP/1.1 200 OK&lt;br/&gt;
Date: Tue, 08 Nov 2011 13:14:59 GMT&lt;br/&gt;
Server: Apache/2.2.16 (Ubuntu)&lt;br/&gt;
Expires: Thu, 01 Jan 1970 00:00:00 GMT&lt;br/&gt;
Pragma: no-cache&lt;br/&gt;
Cache-Control: no-cache, no-store&lt;br/&gt;
Vary: Accept-Encoding&lt;br/&gt;
Transfer-Encoding: chunked&lt;br/&gt;
Content-Type: text/html;charset=UTF-8&lt;/p&gt;</comment>
                            <comment id="13146292" author="mgrigorov" created="Tue, 8 Nov 2011 13:21:35 +0000"  >&lt;p&gt;Wicket 1.4:&lt;/p&gt;

&lt;p&gt;curl -&lt;del&gt;max-redirs 0 -D/dev/stdout &apos;http://martin-laptop/4196-14/helloworld/?wicket:bookmarkablePage=:org.apache.wicket.markup.html.pages.BrowserInfoPage&amp;amp;cto=Foobar%3f%0d%0aEvilHeader:%20SPLIT%2f&lt;/del&gt;%0d%0aAnotherEvilHeader:%20HEADER&apos;&lt;br/&gt;
HTTP/1.1 302 Moved Temporarily&lt;br/&gt;
Date: Tue, 08 Nov 2011 13:19:55 GMT&lt;br/&gt;
Server: Apache/2.2.16 (Ubuntu)&lt;br/&gt;
Location: &lt;a href=&quot;http://martin-laptop/4196-14/helloworld/Foobar?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://martin-laptop/4196-14/helloworld/Foobar?&lt;/a&gt;  EvilHeader: SPLIT/-  AnotherEvilHeader: HEADER&lt;br/&gt;
Transfer-Encoding: chunked&lt;br/&gt;
Content-Type: text/plain&lt;/p&gt;

&lt;p&gt;&amp;lt;html&amp;gt;&amp;lt;body&amp;gt;&amp;lt;p&amp;gt;Redirecting to &amp;lt;a href=&quot;http://martin-laptop/4196-14/helloworld/Foobar?&lt;br/&gt;
EvilHeader: SPLIT/-&lt;br/&gt;
AnotherEvilHeader: HEADER&quot;&amp;gt;&lt;a href=&quot;http://martin-laptop/4196-14/helloworld/Foobar?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://martin-laptop/4196-14/helloworld/Foobar?&lt;/a&gt;&lt;br/&gt;
EvilHeader: SPLIT/-&lt;br/&gt;
AnotherEvilHeader: HEADER&amp;lt;/a&amp;gt;&amp;lt;/p&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&lt;/p&gt;


&lt;p&gt;Voila!&lt;/p&gt;</comment>
                            <comment id="13146319" author="mgrigorov" created="Tue, 8 Nov 2011 14:08:14 +0000"  >&lt;p&gt;The problem is related to BrowserInfoPage&apos;s cto (continueTo) parameter.&lt;br/&gt;
To avoid such problems use org.apache.wicket.settings.ISecuritySettings.setEnforceMounts(true). This will disable wicket:bookmarkablePage functionality and no one will be able to reach that page.&lt;br/&gt;
Prio: Critical -&amp;gt; Major.&lt;/p&gt;</comment>
                            <comment id="13146320" author="mgrigorov" created="Tue, 8 Nov 2011 14:12:04 +0000"  >&lt;p&gt;Wicket 1.5 is no affected because it doesn&apos;t use request parameters (&apos;cto&apos;) but uses org.apache.wicket.RestartResponseAtInterceptPageException.InterceptData to keep the original url.&lt;/p&gt;</comment>
                            <comment id="13146327" author="mgrigorov" created="Tue, 8 Nov 2011 14:36:17 +0000"  >&lt;p&gt;The problem in BrowserInfoPage is fixed with r1199263 in 1.4.x.&lt;/p&gt;</comment>
                            <comment id="13146337" author="mgrigorov" created="Tue, 8 Nov 2011 14:52:30 +0000"  >&lt;p&gt;I think neither Wicket nor Tomcat/anyWebContainer should blindly disallow %0D%0A in the request parameters. If those characters are not allowed then a FORM with method GET and a textarea inside wont be able to work.&lt;/p&gt;</comment>
                            <comment id="13146960" author="olivier.jaquemet" created="Wed, 9 Nov 2011 11:52:46 +0000"  >&lt;p&gt;As far as i known, HTTP response splitting attack are usually fixed at response time. By filtering each header for \n &amp;amp; \r&lt;/p&gt;

&lt;p&gt;You might be interested in having a look at the following vulnerability of Tomcat :&lt;br/&gt;
&lt;a href=&quot;http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-1232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-1232&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It is stated that it&apos;s a XSS vulnerability, but I would also qualify this vulnerability as an HTTP response splitting vulnerability.&lt;br/&gt;
Indeed the fix clearly adds the removal of \n and \r when sending headers : &lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc/tomcat/tc6.0.x/trunk/java/org/apache/coyote/http11/InternalOutputBuffer.java?r1=505604&amp;amp;r2=673834&amp;amp;pathrev=673834&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/tomcat/tc6.0.x/trunk/java/org/apache/coyote/http11/InternalOutputBuffer.java?r1=505604&amp;amp;r2=673834&amp;amp;pathrev=673834&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It has been fix in Tomcat 6.0.18. And because the bug reporter of this current issue only specified Tomcat 6. Might be worth a look&lt;/p&gt;

&lt;p&gt;PS : I do not use wicket, nor know the context of your bug report, but your issue came as a google result when searching for http splitting attack, and I add found the tomcat bug prior to reading your issue. So if it can help in any way... &lt;/p&gt;</comment>
                            <comment id="13147073" author="olivier.jaquemet" created="Wed, 9 Nov 2011 14:51:53 +0000"  >&lt;p&gt;I needed to diagnose exactly the same problem with another application, totally unrelated to WICKET, here is my first returns on this subjects.&lt;/p&gt;

&lt;p&gt;I could reproduce the HTTP Splitting vulnerability with the latest version of HTTPD, mod_jk, and Tomcat :&lt;br/&gt;
Apache/2.2.21 (Win32) mod_jk/1.2.32, Tomcat 6.0.33&lt;br/&gt;
The vulnerability does not appears when using only Tomcat 6.0.33.&lt;/p&gt;

&lt;p&gt;To reproduce : &lt;br/&gt;
1. Drop this JSP in the default ROOT webapp of tomcat&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;%

// Test me by invoking this JSP like this : 
// http://www.example.com/header.jsp?foo=bar%0D%0AContent-Length:%20100%0D%0A%0D%0Apoisoned

String foo = request.getParameter(&quot;foo&quot;);
if (foo != null) {
  response.addHeader(&quot;Foo&quot;, foo);
}

%&amp;gt;
This is the expected content of the file, nothing should appear above this line.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2. Configure Apache Tomcat with both an HTTP/1.1 connector and AJP/1.3 connector &lt;br/&gt;
This is the default when downloading Tomcat 6.0.33, you should have nothing to do.&lt;/p&gt;

&lt;p&gt;3. Configure Apache HTTPD with mod_jk &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Download mod_jk 1.2.32 binaries and drop mod_jk.so in modules directory&lt;/li&gt;
	&lt;li&gt;Add the following worker.properties in conf directory :
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;worker.list=tomcat1
worker.tomcat1.port=8009 
worker.tomcat1.host=127.0.0.1
worker.tomcat1.type=ajp13 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Update httpd.conf with the following line at the end :
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; LoadModule jk_module modules/mod_jk.so
 JkWorkersFile conf/workers.properties
 JkLogFile logs/mod_jk.log
 JkLogLevel info
 JkShmFile logs/shm
 JkMount /* tomcat1 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;3. Access header.jsp through the HTTP/1.1 connector of tomcat with this URL : &lt;br/&gt;
&lt;a href=&quot;http://127.0.0.1:8080/header.jsp?foo=bar%0D%0AContent-Length:%2010%0D%0A%0D%0Apoisoned&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://127.0.0.1:8080/header.jsp?foo=bar%0D%0AContent-Length:%2010%0D%0A%0D%0Apoisoned&lt;/a&gt;&lt;br/&gt;
The response content is as expected : &quot;This is the expected content of the file, nothing should appear above this line.&quot; &lt;/p&gt;

&lt;p&gt;4. Access header.sjp through Apache, with this URL : &lt;br/&gt;
&lt;a href=&quot;http://127.0.0.1:80/header.jsp?foo=bar%0D%0AContent-Length:%2010%0D%0A%0D%0Apoisoned&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://127.0.0.1:80/header.jsp?foo=bar%0D%0AContent-Length:%2010%0D%0A%0D%0Apoisoned&lt;/a&gt;&lt;br/&gt;
The response content has been modified and contains new header and the content has been truncated.&lt;/p&gt;

&lt;p&gt;I will now report this security issue to Apache/mod_jk&lt;/p&gt;</comment>
                            <comment id="13147078" author="mgrigorov" created="Wed, 9 Nov 2011 15:00:58 +0000"  >&lt;p&gt;Yes, I also reproduced it locally.&lt;br/&gt;
I just improved Wicket 1.5 to sanitize web response&apos;s headers.&lt;br/&gt;
The improvement will be soon ported to 1.4 as well.&lt;br/&gt;
Thank you for your comments here!&lt;/p&gt;</comment>
                            <comment id="13147085" author="gertjan_schouten" created="Wed, 9 Nov 2011 15:06:54 +0000"  >&lt;p&gt;We were using Tomcat 6.0.33 when we found this issue. Thanks for all comments!&lt;/p&gt;</comment>
                            <comment id="13147088" author="olivier.jaquemet" created="Wed, 9 Nov 2011 15:15:20 +0000"  >&lt;p&gt;I am in the process of submitting a security bug report to the tomcat team, but could you change the visibility of this issue so nobody sees it until a fix is available ?&lt;/p&gt;

&lt;p&gt;This is in order to comply with the following Apache recommendation : &lt;br/&gt;
&amp;gt; We strongly encourage folks to report such problems to our private security mailing list first, before disclosing them in a public forum. &lt;/p&gt;</comment>
                            <comment id="13147188" author="kkolinko" created="Wed, 9 Nov 2011 17:52:46 +0000"  >&lt;p&gt;&amp;gt; String foo = request.getParameter(&quot;foo&quot;);&lt;br/&gt;
&amp;gt; if (foo != null) &lt;/p&gt;
{
&amp;gt;   response.addHeader(&quot;Foo&quot;, foo);
&amp;gt; }

&lt;p&gt;In general it is wrong to call addHeader() with arbitrary data provided by client. Applications should sanitize their headers, like they have to sanitize (xml-encode) the same parameter values when printing them in HTML response. &lt;/p&gt;

&lt;p&gt;As Javadoc for addHeader()/setHeader() says in the Servlet specification, the header values &quot;should be encoded according to RFC 2047&quot;.&lt;/p&gt;

&lt;p&gt;It was discussed in public several times. There is no sane way to reject a header.&lt;/p&gt;</comment>
                            <comment id="13147252" author="mgrigorov" created="Wed, 9 Nov 2011 20:09:20 +0000"  >&lt;p&gt;Hi Konstantin,&lt;/p&gt;

&lt;p&gt;Thanks for your comment!&lt;/p&gt;

&lt;p&gt;The question is whether every application/framework should do that or the web container should sanitize the headers ?&lt;/p&gt;

&lt;p&gt;Wicket now also replaces \n and \r with &apos; &apos; as Tomcat does but not only for the value but also for the header names. &lt;br/&gt;
Also Tomcat when used thru AJP connector doesn&apos;t behave as thru HTTP connector. I guess Olivier already created a ticket in Tomcat&apos;s issue tracker ?&lt;/p&gt;</comment>
                            <comment id="13147272" author="kkolinko" created="Wed, 9 Nov 2011 20:42:26 +0000"  >&lt;p&gt;&amp;gt; The question is whether every application/framework should do that&lt;br/&gt;
&amp;gt; or the web container should sanitize the headers ? &lt;/p&gt;

&lt;p&gt;Only those that allow user-provided data in headers. In general headers with user-provided data are rare.&lt;/p&gt;


&lt;p&gt;&amp;gt; Wicket now also replaces \n and \r with &apos; &apos;&lt;/p&gt;

&lt;p&gt;That is not enough. If you allow any Unicode String as a parameter, there might be other chars that should not be allowed in the header.&lt;/p&gt;

&lt;p&gt;There was similar issue with Reason phrase in HTTP response - see CVE-2008-1232, but while it is clear how to sanitize a reason phrase - it is replaced with default one, it is not clear what to do with headers.&lt;/p&gt;

&lt;p&gt;My personal though is that it is better to check and reject invalid header names and values with IllegalArgumentException in setHeader()/addHeader() call, but Servlet API is more in favor of silently dropping them.&lt;/p&gt;

&lt;p&gt;&amp;gt; Tomcat when used thru AJP connector doesn&apos;t behave as thru HTTP connector&lt;/p&gt;

&lt;p&gt;There are several versions of HTTP and of AJP connectors. Some behave different than others.&lt;/p&gt;</comment>
                            <comment id="13147295" author="ivaynberg" created="Wed, 9 Nov 2011 21:13:47 +0000"  >&lt;p&gt;hrm. i think im changing my mind on whether or not we, as a web framework, should be attempting to fix this.&lt;/p&gt;

&lt;p&gt;a wicket application is not always composed of just the wicket filter, a great number of them use other filters and servlets - thus we cant truly say that your wicket application is safe from this kind of attack because other filters and servlets in the application are not safe.&lt;/p&gt;

&lt;p&gt;i think we should drop this and let container folks fix it, which is the only place where something like this can be fixed.&lt;/p&gt;

&lt;p&gt;alternatively someone can release a servlet filter that can sit infront of everything else and look for this kind of thing...&lt;/p&gt;</comment>
                            <comment id="13147338" author="olivier.jaquemet" created="Wed, 9 Nov 2011 22:31:09 +0000"  >&lt;p&gt;As far as I am concerned, I would expect a fix on both side : &lt;br/&gt;
1. On the container side, specially when observing the invalid behavior of the AJP/1.3 connector as opposed to the HTTP/1.1 connector which is correct, &lt;br/&gt;
2. On the webapp side, whether it is Wicket or any other webapp, but moreover for Wicket as it is a web framework&lt;/p&gt;

&lt;p&gt;As I said earlier, I do not use Wicket at all, but I encountered exactly the same problem at the same time with my webapp. I will provide a fix in my webapp. But I also expect a fix by the Tomcat team.&lt;/p&gt;

&lt;p&gt;@Konstantin : I completely agree with your approach on security :  the webapp is responsible for validation of parameter and for the data being sent to the user HTTP/HTML or any other channel. And as you said the Doc/RFC clearly states how headers should be encoded. But when it comes to security, RFC are secondary to the common usage scenario. And specially with regards to Tomcat, there is a non homegenous behavior of ajp vs http. Also I am pretty sure I could investigate the issue and reproduce the bug with other native headers...&lt;/p&gt;</comment>
                            <comment id="13147346" author="kkolinko" created="Wed, 9 Nov 2011 22:54:48 +0000"  >&lt;p&gt;@Olivier:&lt;br/&gt;
&amp;gt; specially with regards to Tomcat, there is a non homegenous behavior of ajp vs http&lt;/p&gt;

&lt;p&gt;The &apos;\n&apos; handling in HTTP connector is mostly legacy code. It is not enough to protect from all known scenarios. When the header is being sent out it is nearly too late to fix anything.&lt;/p&gt;</comment>
                            <comment id="13147571" author="olivier.jaquemet" created="Thu, 10 Nov 2011 09:13:50 +0000"  >&lt;p&gt;@Konstantin : As I already said, I do agree that validation must be performed by the webapp on untrusted data prior to using/sending it. BUT if Tomcat AJP was behaving as his HTTP/1.1 counterpart, this would be a best effort to improve security of webapps which may not have though of all security aspects. Because unfortunately we don&apos;t live in a child&apos;s fantasy world and all webapp are not properly coded. My two cents. &lt;/p&gt;</comment>
                            <comment id="13147589" author="mgrigorov" created="Thu, 10 Nov 2011 09:36:02 +0000"  >&lt;p&gt;I think Igor&apos;s idea of a custom Servlet Filter to do this is the best approach.&lt;br/&gt;
Duplicating this logic in the web container, the web framework and the application is error prone. &lt;/p&gt;</comment>
                            <comment id="13147593" author="olivier.jaquemet" created="Thu, 10 Nov 2011 09:53:05 +0000"  >&lt;p&gt;Duplicating this behavior is not on your control, your either developp the webapp or the container, rarely both. Therefore you must ensure security of your own development, and this will probably be done on both side whether or no you know it. And I would expect the app server to provide such basic security feature, like I expect application to follow security best practice.&lt;/p&gt;

&lt;p&gt;Regarding the servletfilter to filter response content, this is an approach available in the OWASP ESAPI library with its SecurityWrapperReponse :&lt;br/&gt;
&lt;a href=&quot;https://www.owasp.org/index.php/Category:OWASP_Enterprise_Security_API&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.owasp.org/index.php/Category:OWASP_Enterprise_Security_API&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Though output filtering is not enough, and I would strongly recommend proper filtering of input, not using a filter, but with a real semantic validation of parameter for each use case (eg \n\r are authorized for an article submitted thourhg textearea, not for a price submitted in a textfield)&lt;/p&gt;</comment>
                            <comment id="13184055" author="mgrigorov" created="Wed, 11 Jan 2012 13:17:17 +0000"  >&lt;p&gt;This ticket contains commits which are in to-be-released 1.5.4 version.&lt;/p&gt;

&lt;p&gt;I have information that the reporter uses a custom servlet filter to solve the problem in his application (we think this is the best option - a shared/OSS filter that can protect against this attack for all web servers and frameworks).&lt;br/&gt;
Also I have information that AJP is improved in its latest version. It is too late to revert my changes for 1.5.4 but after confirmation from Tomcat developers I&apos;ll revert it for 1.5.5/6.0.&lt;/p&gt;</comment>
                            <comment id="13185497" author="mgrigorov" created="Fri, 13 Jan 2012 08:51:25 +0000"  >&lt;p&gt;Here are the fixes in Tomcat:&lt;/p&gt;


&lt;p&gt;Tomcat trunk:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?rev=1201069&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1201069&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?rev=1201087&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1201087&amp;amp;view=rev&lt;/a&gt; (only whitespace)&lt;/p&gt;

&lt;p&gt;TC 7 backport:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?rev=1201076&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1201076&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?rev=1201088&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1201088&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;TC 6 backport plus fix for old impl that&apos;s no longer present in TC 7+:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?rev=1201452&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1201452&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;TC 5.5 backport&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?rev=1221050&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1221050&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;First &quot;fixed&quot; releases:&lt;/p&gt;

&lt;p&gt;Tomcat 7.0.23&lt;br/&gt;
Tomcat 6.0.35&lt;br/&gt;
Tomcat 5.5.35 (not yet released but currently under release vote)&lt;/p&gt;


&lt;p&gt;I&apos;ll revert the improvements in Wicket code (1.5/6.0).&lt;/p&gt;</comment>
                            <comment id="13185508" author="mgrigorov" created="Fri, 13 Jan 2012 09:09:36 +0000"  >&lt;p&gt;The changes are reverted.&lt;/p&gt;

&lt;p&gt;Summary:&lt;br/&gt;
the recommended way is to use Servlet Filter or HttpServletResponseWrapper that disallows any bad header values.&lt;br/&gt;
Tomcat is improved in its latest versions.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>216024</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 45 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17flz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>251498</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>