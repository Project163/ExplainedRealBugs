<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:25:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-6387] PageStore loses all stored pages</title>
                <link>https://issues.apache.org/jira/browse/WICKET-6387</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;When using ModalWindow in combination with PageReference does not work since version 8.0.0-M6.&lt;/p&gt;

&lt;p&gt;I tried 8.0.0-M5 as well without getting this issue.&lt;/p&gt;

&lt;p&gt;Using the example code of wicket-examples, the call &lt;tt&gt;(ModalWindowPage)modalWindowPage.getPage()&lt;/tt&gt; will always return null instead of the page.&lt;/p&gt;

&lt;p&gt;The PageReference object contains a valid pageId, but the PageManager cannot find the object referenced by this ID.&lt;/p&gt;

&lt;p&gt;I attached an example project to show this issue&lt;br/&gt;
(use &lt;tt&gt;mvn clean compile jetty:run&lt;/tt&gt; to start local webserver on 8080).&lt;/p&gt;

&lt;p&gt;I&apos;m also pretty sure that this problem will also occur with the wicket-example code. &lt;br/&gt;
My example is just a stripped version of the wicket-examples modal window sample which will throw an IllegalArgumentException when getPage() is null.&lt;/p&gt;</description>
                <environment>Jetty 9.4.5.v20170502</environment>
        <key id="13076191">WICKET-6387</key>
            <summary>PageStore loses all stored pages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="hypfvieh">David M.</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 May 2017 13:30:25 +0000</created>
                <updated>Tue, 10 Oct 2017 18:18:14 +0000</updated>
                            <resolved>Sun, 4 Jun 2017 20:52:20 +0000</resolved>
                                    <version>8.0.0-M6</version>
                                    <fixVersion>6.27.0</fixVersion>
                    <fixVersion>7.8.0</fixVersion>
                    <fixVersion>8.0.0-M7</fixVersion>
                                    <component>wicket</component>
                    <component>wicket-extensions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16031820" author="mgrigorov" created="Wed, 31 May 2017 19:39:55 +0000"  >&lt;p&gt;Your application and Wicket-Examples work fine here with both 8.0.0-M6 and 8.0.0-SNAPSHOT.&lt;br/&gt;
&lt;a href=&quot;http://examples8x.wicket.apache.org/ajax/modal-window&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://examples8x.wicket.apache.org/ajax/modal-window&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16032486" author="hypfvieh" created="Thu, 1 Jun 2017 05:46:49 +0000"  >&lt;p&gt;hmmm... That&apos;s really strange.&lt;/p&gt;

&lt;p&gt;I get the null-reference every time on my main working machine as well as on my laptop.&lt;br/&gt;
I also tried to use different java versions (openjdk 1.8.0_131, oracle jdk 1.8.0_121 as well as old oracle jdk 1.8.0_74), but that does not change anything.&lt;/p&gt;

&lt;p&gt;Any idea on how I could help to track down this issue?&lt;/p&gt;</comment>
                            <comment id="16032574" author="hypfvieh" created="Thu, 1 Jun 2017 07:21:36 +0000"  >&lt;p&gt;After some further debugging, I can see the following:&lt;/p&gt;

&lt;p&gt;&apos;PageReference.getPage()&apos; calls &apos;Session.get().getPageManager().getPage()&apos; which then will use &apos;getRequestAdapter().getPage()&apos;.&lt;br/&gt;
This will use &apos;PersistentRequestAdapter.getPage()&apos; to retrieve the page.&lt;/p&gt;

&lt;p&gt;In my sample, PersistentRequestAdapter tries to find the page with &apos;findPage()&apos; method which will iterate the&lt;br/&gt;
&apos;touchedPages&apos; member. The member only contains one entry in my sample, and that is the modal window, not the parent page (referenced page) of the modal window.&lt;br/&gt;
So this &apos;findPage()&apos; call will return null.&lt;/p&gt;

&lt;p&gt;As second pass, if returned page was null, getSessionEntry(false) is called and returns a SessionEntry (org.apache.wicket.page.PageStoreManager$SessionEntry) object.&lt;br/&gt;
Then &apos;getPage(id)&apos; on this SessionEntry object is called.&lt;/p&gt;

&lt;p&gt;After some checks, the &apos;sessionCache&apos; member is checked and if that is not null (which is the case), &apos;findPage(id)&apos; is used to find the page in sessionCache member.&lt;br/&gt;
The &apos;sessionCache&apos; member also only contains the ModalWindow, not the requested page, so again null is returned.&lt;/p&gt;

&lt;p&gt;As last option getPageStore() is called and returning an AsynchronousPageStore object. &lt;br/&gt;
&apos;getPage()&apos; call is issued on the AsynchronousPageStore object. &lt;/p&gt;

&lt;p&gt;The first thing inside this &apos;getPage()&apos; call is a &apos;getEntry&apos; call which returns null, so the &apos;delegate&apos; member (instance of DefaultPageStore) will be used.&lt;br/&gt;
&apos;getPage()&apos; is called on &apos;delegate&apos; member.&lt;/p&gt;

&lt;p&gt;In that method, DefaultPageStore member &apos;pagesCache&apos; (instance of AbstractPageStore) is queryied and will again return null which will result in calling &apos;getPageData(sessionId, pageId)&apos;.&lt;br/&gt;
Now the method &apos;getData(sessionId, pageId) on &apos;dataStore&apos; (instance of AsynchronousDataStore) member of AbstractPageStore will be called.&lt;/p&gt;

&lt;p&gt;&apos;getEntry(sessionId, id)&apos; will again return null, so &apos;dataStore.getData(sessionId, id)&apos; is used.&lt;/p&gt;

&lt;p&gt;In the DiskDataStore class, &apos;getData&apos; will use &apos;getSessionEntry&apos; (returns an object, not null) and then try to load the page with &apos;sessionEntry.loadPage(id)&apos;.&lt;br/&gt;
In &apos;loadPage&apos; &apos;getManager().getPageWindow(id)&apos; will return null.&lt;/p&gt;

&lt;p&gt;The manger behind &apos;getManager()&apos; is org.apache.wicket.pageStore.PageWindowManager. &lt;br/&gt;
In PageWindowManager object the member &apos;idToWindowIndex&apos; only contains one entry, and that is the pageId of the ModalWindow, not the parent.&lt;br/&gt;
That means, &apos;getWindowIndex(pageId)&apos; will return -1 because the lookup in idToWindowIndex-Map will return null.&lt;/p&gt;

&lt;p&gt;After all of that stuff above, this &apos;null&apos; value is returned through all the stacks until it reaches my sample code.&lt;/p&gt;

&lt;p&gt;The question for me is, why is the initial &quot;parent&quot; page not inside any of those &quot;stores&quot;?&lt;/p&gt;</comment>
                            <comment id="16033540" author="mgrigorov" created="Thu, 1 Jun 2017 19:32:55 +0000"  >&lt;p&gt;Can anyone else reproduce the problem with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hypfvieh&quot; class=&quot;user-hover&quot; rel=&quot;hypfvieh&quot;&gt;hypfvieh&lt;/a&gt;&apos;s quickstart or with wicket-examples ?&lt;/p&gt;</comment>
                            <comment id="16034849" author="svenmeier" created="Fri, 2 Jun 2017 15:15:11 +0000"  >&lt;p&gt;I&apos;m getting a NullPointerException in wicket-examples and the IllegalArgumentException in the quickstart.&lt;/p&gt;</comment>
                            <comment id="16035144" author="svenmeier" created="Fri, 2 Jun 2017 18:01:44 +0000"  >&lt;p&gt;It works with M5 :/&lt;/p&gt;</comment>
                            <comment id="16035454" author="svenmeier" created="Fri, 2 Jun 2017 21:27:52 +0000"  >&lt;p&gt;This doesn&apos;t have anything to do with ModalWindow - every retrieval of previous pages from the page store fails:&lt;/p&gt;

&lt;p&gt;Just open wicket-example&apos;s FormInput several times, then switch back to a previous page id and Wicket will recreate an expired page.&lt;/p&gt;</comment>
                            <comment id="16035456" author="svenmeier" created="Fri, 2 Jun 2017 21:32:25 +0000"  >&lt;p&gt;Breaking commit is 290398a3e4f950f6c6cd93ad0c557c12c867ce0e&lt;/p&gt;</comment>
                            <comment id="16036368" author="mgrigorov" created="Sun, 4 Jun 2017 19:11:22 +0000"  >&lt;p&gt;I&apos;ll take a look now!&lt;/p&gt;</comment>
                            <comment id="16036381" author="mgrigorov" created="Sun, 4 Jun 2017 20:25:46 +0000"  >&lt;p&gt;This is the problem:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;at org.apache.wicket.pageStore.DiskDataStore.removeData(DiskDataStore.java:169)
	  - locked &amp;lt;0x176a&amp;gt; (a org.apache.wicket.pageStore.DiskDataStore$SessionEntry)
	  at org.apache.wicket.pageStore.AsynchronousDataStore.removeData(AsynchronousDataStore.java:204)
	  at org.apache.wicket.pageStore.AbstractPageStore.removePageData(AbstractPageStore.java:105)
	  at org.apache.wicket.pageStore.AbstractCachingPageStore.unbind(AbstractCachingPageStore.java:95)
	  at org.apache.wicket.page.PageStoreManager$SessionEntry.valueUnbound(PageStoreManager.java:319)
	  at org.eclipse.jetty.server.session.AbstractSession.unbindValue(AbstractSession.java:527)
	  at org.eclipse.jetty.server.session.AbstractSession.setAttribute(AbstractSession.java:453)
	  at org.apache.wicket.session.HttpSessionStore.setAttribute(HttpSessionStore.java:366)
	  at org.apache.wicket.Session.setAttribute(Session.java:855)
	  at org.apache.wicket.page.DefaultPageManagerContext.setSessionAttribute(DefaultPageManagerContext.java:99)
	  at org.apache.wicket.page.RequestAdapter.setSessionAttribute(RequestAdapter.java:90)
	  at org.apache.wicket.page.PageStoreManager$PersistentRequestAdapter.storeTouchedPages(PageStoreManager.java:413)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Updating the session attribute leads to unbinding the old one and thus removing the data stored in the disk.&lt;/p&gt;</comment>
                            <comment id="16036385" author="jira-bot" created="Sun, 4 Jun 2017 20:49:23 +0000"  >&lt;p&gt;Commit 95fcc140dc64b8226f54664b70249ec3067e0768 in wicket&apos;s branch refs/heads/wicket-7.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgrigorov&quot; class=&quot;user-hover&quot; rel=&quot;mgrigorov&quot;&gt;mgrigorov&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=95fcc14&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=95fcc14&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6387&quot; title=&quot;PageStore loses all stored pages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6387&quot;&gt;&lt;del&gt;WICKET-6387&lt;/del&gt;&lt;/a&gt; ModalWindow PageReference broken&lt;/p&gt;

&lt;p&gt;Do not remove the session data when the SessionEntry is updated in the Session&lt;/p&gt;</comment>
                            <comment id="16036386" author="jira-bot" created="Sun, 4 Jun 2017 20:49:48 +0000"  >&lt;p&gt;Commit 0f8e0199944b0eb920c278814b629504ca62dbf0 in wicket&apos;s branch refs/heads/wicket-6.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgrigorov&quot; class=&quot;user-hover&quot; rel=&quot;mgrigorov&quot;&gt;mgrigorov&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=0f8e019&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=0f8e019&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6387&quot; title=&quot;PageStore loses all stored pages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6387&quot;&gt;&lt;del&gt;WICKET-6387&lt;/del&gt;&lt;/a&gt; ModalWindow PageReference broken&lt;/p&gt;

&lt;p&gt;Do not remove the session data when the SessionEntry is updated in the Session&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 95fcc140dc64b8226f54664b70249ec3067e0768)&lt;/p&gt;</comment>
                            <comment id="16036387" author="jira-bot" created="Sun, 4 Jun 2017 20:51:35 +0000"  >&lt;p&gt;Commit 9e50533f2d9546d46686a88146936b25e1f355dd in wicket&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgrigorov&quot; class=&quot;user-hover&quot; rel=&quot;mgrigorov&quot;&gt;mgrigorov&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=9e50533&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=9e50533&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6387&quot; title=&quot;PageStore loses all stored pages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6387&quot;&gt;&lt;del&gt;WICKET-6387&lt;/del&gt;&lt;/a&gt; ModalWindow PageReference broken&lt;/p&gt;

&lt;p&gt;Do not remove the session data when the SessionEntry is updated in the Session&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 95fcc140dc64b8226f54664b70249ec3067e0768)&lt;/p&gt;</comment>
                            <comment id="16036905" author="svenmeier" created="Mon, 5 Jun 2017 13:04:06 +0000"  >&lt;p&gt;+1 that was tricky &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16145243" author="papegaaij" created="Tue, 29 Aug 2017 13:02:28 +0000"  >&lt;p&gt;This change breaks page store management on Wildfly. It seems Undertow does not unbind the attribute. It does re-bind. In Undertow the code that calls the listeners is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HttpSessionImpl httpSession = SecurityActions.forSession(session, servletContext, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (old != value) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (old &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; HttpSessionBindingListener) {
                ((HttpSessionBindingListener) old).valueUnbound(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HttpSessionBindingEvent(httpSession, name, old));
            }
            applicationListeners.httpSessionAttributeReplaced(httpSession, name, old);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; HttpSessionBindingListener) {
            ((HttpSessionBindingListener) value).valueBound(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HttpSessionBindingEvent(httpSession, name, value));
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Perhaps the updating should be reset to false at valueBound?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13085113">WICKET-6417</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="13063647">WICKET-6356</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12870573" name="modal_sample.tgz" size="3437" author="hypfvieh" created="Wed, 31 May 2017 13:30:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fp27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>