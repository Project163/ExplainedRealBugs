<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:18:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-4009] Page Lock on Browser Back Button after Page Expiry</title>
                <link>https://issues.apache.org/jira/browse/WICKET-4009</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;In the attached quickstart, after page expiry and browser back navigation, a server error occurs such as:&lt;/p&gt;

&lt;p&gt;&quot;failed to acquire lock to page 0, attempted for 1 minutes out of allowed 1 minute&quot;&lt;br/&gt;
This appears to be related to request logging, but I have seen other strange errors without request logging such as&lt;/p&gt;

&lt;p&gt;org.apache.wicket.request.handler.ComponentNotFoundException: Could not find component &apos;form&apos; on page &apos;class web.page.ExpiredPage&lt;/p&gt;

&lt;p&gt;also with browser history back navigation.&lt;/p&gt;

&lt;p&gt;I have seen none of these errors in Wicket 1.4. I guess the reason for not having seen this before it that http cache headers are different in 1.5.&lt;/p&gt;</description>
                <environment>Wicket version: 1.5-RC7&lt;br/&gt;
java version &amp;quot;1.6.0_25&amp;quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_25-b06)&lt;br/&gt;
Java HotSpot(TM) Client VM (build 20.0-b11, mixed mode, sharing)&lt;br/&gt;
&lt;br/&gt;
Server: GlassFish 3.1.1</environment>
        <key id="12520871">WICKET-4009</key>
            <summary>Page Lock on Browser Back Button after Page Expiry</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="bht@actrix.gen.nz">bernard</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 Aug 2011 05:16:36 +0000</created>
                <updated>Tue, 6 Sep 2011 09:18:08 +0000</updated>
                            <resolved>Tue, 6 Sep 2011 07:26:38 +0000</resolved>
                                    <version>1.5-RC7</version>
                                    <fixVersion>1.5.1</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                                                            <comments>
                            <comment id="13094310" author="bht@actrix.gen.nz" created="Wed, 31 Aug 2011 05:18:37 +0000"  >&lt;p&gt;Testcase&lt;/p&gt;</comment>
                            <comment id="13094481" author="mgrigorov" created="Wed, 31 Aug 2011 12:38:37 +0000"  >&lt;p&gt;I can&apos;t reproduce the problem with this quickstart.&lt;br/&gt;
What&apos;s are the steps ?&lt;br/&gt;
I wait for more than a minute but then pressing back/forward just works.&lt;/p&gt;</comment>
                            <comment id="13094504" author="bitstorm" created="Wed, 31 Aug 2011 13:05:32 +0000"  >&lt;p&gt;Running quickstart with &apos;mvn jetty:run&apos; I was able to reproduce the problem. But importing the project inside Eclipse and running it with Tomcat 6 and the last Wicket source everything went fine.&lt;/p&gt;
</comment>
                            <comment id="13094508" author="bitstorm" created="Wed, 31 Aug 2011 13:11:00 +0000"  >&lt;p&gt;Even running project with RC7 but with Tomcat I wasn&apos;t able to reproduce the problem.&lt;/p&gt;</comment>
                            <comment id="13094800" author="bht@actrix.gen.nz" created="Wed, 31 Aug 2011 19:05:46 +0000"  >&lt;p&gt;Martin,&lt;/p&gt;

&lt;p&gt;wait for one minute then press the button on the page, then after receiving the expired page, press the browser back button.&lt;/p&gt;

&lt;p&gt;Andera,&lt;/p&gt;

&lt;p&gt;I get this on GlassFish. To get started with it quickly, you may want to download NetBeans with Java EE support which includes GlassFish. Just open the quickstart directly in NetBeans and run it from the context menu. It will prompt you with a dialog on what server to run. At the first time, you must register the installed GlassFish.&lt;/p&gt;</comment>
                            <comment id="13094941" author="bitstorm" created="Wed, 31 Aug 2011 21:55:34 +0000"  >&lt;p&gt;I&apos;ve not tried GlassFish yet, but I&apos;ve reproduced the problem under Eclipse with this plugin &lt;a href=&quot;http://code.google.com/p/run-jetty-run/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://code.google.com/p/run-jetty-run/&lt;/a&gt;.&lt;br/&gt;
Jetty version is 7.4.2 &lt;/p&gt;</comment>
                            <comment id="13095203" author="bitstorm" created="Thu, 1 Sep 2011 09:37:26 +0000"  >&lt;p&gt;PageAccessSynchronizer  associates page locks to a single thread. Tomcat, after session expiration,  continues to serve user requests with the same thread so PageAccessSynchronizer can assign previously  owned locks.&lt;br/&gt;
The problem arise with web server like Jetty which seems to assign to users a new thread after session expiration. In this scenario page locks previously owned by expired session are no more unlocked.&lt;/p&gt;

&lt;p&gt;Possible solution:&lt;br/&gt;
-Associate locks to session id and not to thread. When session expires unlock all its locks.&lt;/p&gt;

&lt;p&gt;What&apos;s your opinion about this Martin?&lt;/p&gt;</comment>
                            <comment id="13095230" author="mgrigorov" created="Thu, 1 Sep 2011 11:07:31 +0000"  >&lt;p&gt;Isn&apos;t it much easier to modify &lt;br/&gt;
org.apache.wicket.page.PageAccessSynchronizer.adapt(...).new PageManagerDecorator() &lt;/p&gt;
{...}
&lt;p&gt;.getPage(int) to:&lt;/p&gt;

&lt;p&gt;@Override&lt;br/&gt;
public IManageablePage getPage(int id)&lt;br/&gt;
{&lt;br/&gt;
   lockPage(id);&lt;br/&gt;
   IManageablePage page = super.getPage(id);&lt;br/&gt;
   if (page == null) &lt;/p&gt;
{
      // this has to be in finally block
      unlockPage(id);
   }
&lt;p&gt;   return page;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;There is no unlockPage(int) but we can add it. No need to keep lock if there is no such page anymore.&lt;/p&gt;</comment>
                            <comment id="13095259" author="bitstorm" created="Thu, 1 Sep 2011 12:22:10 +0000"  >&lt;p&gt;Yes it&apos; much easier &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. I&apos;m making some tests. If all goes well I will attach a first patch.&lt;/p&gt;</comment>
                            <comment id="13095354" author="bitstorm" created="Thu, 1 Sep 2011 15:36:27 +0000"  >&lt;p&gt;I&apos;ve created a patch following Martin&apos;s idea and seems to work. I attached it so you can test it.&lt;/p&gt;</comment>
                            <comment id="13095357" author="mgrigorov" created="Thu, 1 Sep 2011 15:41:52 +0000"  >&lt;p&gt;In unloadPage(int) you should also check the thread like in unlockAllPages() because page id is session relative.&lt;/p&gt;</comment>
                            <comment id="13096000" author="bitstorm" created="Fri, 2 Sep 2011 14:12:53 +0000"  >&lt;p&gt;ok, done. Tested with success on jetty 7.4.2 and GlassFish 3.1&lt;/p&gt;</comment>
                            <comment id="13096021" author="bitstorm" created="Fri, 2 Sep 2011 14:54:03 +0000"  >&lt;p&gt;Martin, I&apos;ve got just a question. When I click &quot;back&quot; button and session is expired, method PageManagerDecorator.commitRequest() is not called right?  &lt;/p&gt;</comment>
                            <comment id="13097130" author="mgrigorov" created="Mon, 5 Sep 2011 12:08:57 +0000"  >&lt;p&gt;Hm. Why not ?&lt;br/&gt;
Pressing back button makes a http request with older page id. If there is no such page in the page stores then null is returned by getPage(int) and PageExpiredException is thrown by PageProvider#getPageInstance(). This exception is catched by DefaultExceptionMapper and the configured IApplicationSettings#getPageExpiredErrorPage() is rendered. At the end of the request #commitRequest() should be called by RequestCycle#onDetach() (listeners.onDetach()) and PageExpiredErrorPage#onDetach() should be called (even twice - see &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-4012&quot; title=&quot;Component&amp;#39;s onAfterRender() is called so many times as it is depth in the component tree + 1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-4012&quot;&gt;&lt;del&gt;WICKET-4012&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13097771" author="mgrigorov" created="Tue, 6 Sep 2011 07:26:38 +0000"  >&lt;p&gt;Thanks, Andrea!&lt;/p&gt;</comment>
                            <comment id="13097823" author="bitstorm" created="Tue, 6 Sep 2011 09:08:11 +0000"  >&lt;p&gt;Thank to you Martin. I made my question about expired session because I wanted to understand how we ended up with a lock left assigned. &lt;br/&gt;
FOR INFORMATION: With a little more debugging I&apos;ve found that when session is expired but after commitRequest(), request logger asks for page class and getPage(id) is called. So the logger should be the one who left a lock occupied and caused the bug.&lt;/p&gt;




</comment>
                            <comment id="13097829" author="mgrigorov" created="Tue, 6 Sep 2011 09:18:08 +0000"  >&lt;p&gt;Thanks Andrea!&lt;br/&gt;
I just created &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-4029&quot; title=&quot;Improve RequestLogger to not do anything after IPageManager#commitRequest()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-4029&quot;&gt;&lt;del&gt;WICKET-4029&lt;/del&gt;&lt;/a&gt; to track that.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12492750" name="pageManagerPatch.txt" size="2872" author="bitstorm" created="Fri, 2 Sep 2011 14:14:39 +0000"/>
                            <attachment id="12492615" name="pageManagerPatch.txt" size="3245" author="bitstorm" created="Thu, 1 Sep 2011 15:37:00 +0000"/>
                            <attachment id="12492419" name="quickStart.zip" size="12288" author="bht@actrix.gen.nz" created="Wed, 31 Aug 2011 05:18:37 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12521429">WICKET-4029</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>62308</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0k9in:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116359</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>