<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:26:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-6840] Busy indicator persists after request</title>
                <link>https://issues.apache.org/jira/browse/WICKET-6840</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;The busy indicator (implementations of `IAjaxIndicatorAware`) appears to persist after the AJAX request finishes. To be precise, It looks like it&apos;s not being properly cleaned up, as subsequent requests continue to add new indicators to the page. This looks to be new in Wicket 9/9.1, as I didn&apos;t observe the behavior in the past (Wicket 7/8) out of the box.&lt;/p&gt;

&lt;p&gt;I&apos;ve seen this occur with uses of `IndicatingAjaxLink.java` along with ModalWindow/ModalDialog, but also for use cases of the vanilla `AjaxIndicatorAppender` behavior attached to a component.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a small quickstart project which should hopefully make this easy to reproduce. It should suffice to start the project and click any of the two links present.&lt;/p&gt;</description>
                <environment>Linux - Ubuntu 19.10 and centOS. Using OpenJDK 14.</environment>
        <key id="13335299">WICKET-6840</key>
            <summary>Busy indicator persists after request</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="roncruz">Ronald Cruz</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Oct 2020 23:29:10 +0000</created>
                <updated>Thu, 15 Oct 2020 20:48:46 +0000</updated>
                            <resolved>Thu, 15 Oct 2020 20:37:44 +0000</resolved>
                                    <version>9.0.0</version>
                    <version>9.1.0</version>
                                    <fixVersion>9.2.0</fixVersion>
                                    <component>wicket-core</component>
                    <component>wicket-extensions</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17213632" author="mgrigorov" created="Wed, 14 Oct 2020 05:58:05 +0000"  >&lt;p&gt;The attached project is empty.&lt;/p&gt;</comment>
                            <comment id="17213688" author="roncruz" created="Wed, 14 Oct 2020 07:28:51 +0000"  >&lt;p&gt;Sorry about that, I uploaded a new attachment which should contain the project.&lt;/p&gt;</comment>
                            <comment id="17213736" author="mgrigorov" created="Wed, 14 Oct 2020 08:40:12 +0000"  >&lt;p&gt;The problem starts with: &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6703?focusedCommentId=16962037&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16962037&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/WICKET-6703?focusedCommentId=16962037&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-16962037&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Now org.apache.wicket.page.PartialPageUpdate#writeTo() writes the prepend evaluations and then the components. But Component/Behavior #beforeRender and #renderHead() are part of PartialPageUpdate#writeComponents() and if they use something like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
component.getRequestCycle().find(IPartialPageRequestHandler.class).ifPresent(target -&amp;gt; {
   &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; javascript = &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; e = Wicket.$(&apos;&quot;&lt;/span&gt; + getMarkupId() +
      &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-quote&quot;&gt;&apos;); &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; typeof(e.parentNode) != &apos;&lt;/span&gt;undefined&apos;) e.parentNode.removeChild(e);&quot;&lt;/span&gt;;

   target.prependJavaScript(javascript);
}); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;as AjaxIndicatorAppender does then it is just ignored.&lt;/p&gt;</comment>
                            <comment id="17213754" author="mgrigorov" created="Wed, 14 Oct 2020 09:01:18 +0000"  >&lt;p&gt;The following change fixes the issue&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git wicket-core/src/main/java/org/apache/wicket/page/PartialPageUpdate.java wicket-core/src/main/java/org/apache/wicket/page/PartialPageUpdate.java
index ef81182074..7c7498b0ba 100644
--- wicket-core/src/main/java/org/apache/wicket/page/PartialPageUpdate.java
+++ wicket-core/src/main/java/org/apache/wicket/page/PartialPageUpdate.java
@@ -158,13 +158,16 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PartialPageUpdate
 
                        onBeforeRespond(response);
 
-                       &lt;span class=&quot;code-comment&quot;&gt;// queue up prepend javascripts. unlike other steps these are executed out of order so that
&lt;/span&gt;-                       &lt;span class=&quot;code-comment&quot;&gt;// components can contribute them from inside their onbeforerender methods.
&lt;/span&gt;+                       &lt;span class=&quot;code-comment&quot;&gt;// queue up prepend JavaScripts contributed in action/callback methods, like onClick(AjaxRequestTarget).
&lt;/span&gt;                        writeEvaluations(response, prependJavaScripts);
 
                        &lt;span class=&quot;code-comment&quot;&gt;// process added components
&lt;/span&gt;                        writeComponents(response, encoding);
 
+                       &lt;span class=&quot;code-comment&quot;&gt;// write any prepend JavaScripts which has been contributed in
&lt;/span&gt;+                       &lt;span class=&quot;code-comment&quot;&gt;// Behavior/Component beforeRender/renderHead()
&lt;/span&gt;+                       writeEvaluations(response, prependJavaScripts);
+
                        onAfterRespond(response);
 
                        &lt;span class=&quot;code-comment&quot;&gt;// execute the dom ready javascripts as first javascripts
&lt;/span&gt;@@ -239,6 +242,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PartialPageUpdate
                        decoratedHeaderResponse.close();
                        
                        writeHeaderContribution(response, stringResponse.getBuffer());
+                       scripts.clear();
                }
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but I think &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6703&quot; title=&quot;Eliminate window.eval from wicket-ajax-jquery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6703&quot;&gt;&lt;del&gt;WICKET-6703&lt;/del&gt;&lt;/a&gt; broke the idea.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Before &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6703&quot; title=&quot;Eliminate window.eval from wicket-ajax-jquery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6703&quot;&gt;&lt;del&gt;WICKET-6703&lt;/del&gt;&lt;/a&gt; Wicket was using &amp;lt;prepend-evaluation&amp;gt; elements in the Ajax XML response, which were processed before any component replacement. After &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6703&quot; title=&quot;Eliminate window.eval from wicket-ajax-jquery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6703&quot;&gt;&lt;del&gt;WICKET-6703&lt;/del&gt;&lt;/a&gt; we use &amp;lt;header-contribution&amp;gt; for both prepend and append JS. With the change above the issue is worked around but the prepend JS contributed by AjaxIndicatorAppender is executed &lt;b&gt;after&lt;/b&gt; the component replacements.&lt;/p&gt;

&lt;p&gt;A proper fix could be to add an attribute to &amp;lt;header-contribution&amp;gt; saying what kind it is, e.g. &amp;lt;header-contribution kind=&quot;prepend&quot;&amp;gt;, or &quot;append&quot;, &quot;dom-ready&quot;, ... This way wicket-ajax.js could again iterate over all prepend contributions before replacing the DOM elements.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt; WDYT ?&lt;/p&gt;</comment>
                            <comment id="17214193" author="roncruz" created="Wed, 14 Oct 2020 18:41:51 +0000"  >&lt;p&gt;If it makes any difference (and to further +1 your proposed fix), we integrated some JS charting library on our Wicket app as an additional component. This component pulled in the library through the &amp;lt;wicket:head&amp;gt; tags and referenced it using inline JS.&lt;/p&gt;

&lt;p&gt;After the switch to Wicket 9, the initialization for this component failed when done through Ajax requests (popping up chart through ModalWindow/ModalDialog). Looking at the browser console confirmed that the component&apos;s JS was being evaluated prior to the JS library being pulled from &amp;lt;wicket:head&amp;gt; causing initialization errors and references not found. This was with the CSP disabled. The workaround without rewriting the component was to preload the library before the component was initialized, but your suggestion solves the root issue.&lt;/p&gt;

&lt;p&gt;Anyways, thank you for investigating this Martin.&lt;/p&gt;</comment>
                            <comment id="17214263" author="jira-bot" created="Wed, 14 Oct 2020 20:32:09 +0000"  >&lt;p&gt;Commit b748e9caae4ceebb742ddbdce903e9f90fd6cc63 in wicket&apos;s branch refs/heads/master from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=b748e9c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=b748e9c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6840&quot; title=&quot;Busy indicator persists after request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6840&quot;&gt;&lt;del&gt;WICKET-6840&lt;/del&gt;&lt;/a&gt; prepare components before writing prepend JavaScripts&lt;/p&gt;

&lt;p&gt;move AjaxIndicatorAppender JS node removal from renderHead() to onConfigure()&lt;/p&gt;</comment>
                            <comment id="17214270" author="svenmeier" created="Wed, 14 Oct 2020 20:37:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgrigorov&quot; class=&quot;user-hover&quot; rel=&quot;mgrigorov&quot;&gt;mgrigorov&lt;/a&gt; I&apos;d rather not go back to the previous solution, since I&apos;m quite happy how the restructuring in &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6703&quot; title=&quot;Eliminate window.eval from wicket-ajax-jquery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6703&quot;&gt;&lt;del&gt;WICKET-6703&lt;/del&gt;&lt;/a&gt; worked out.&lt;/p&gt;

&lt;p&gt;I&apos;ve pushed a change that allows components and behaviors to prepend JS again in the before-render-phase.&lt;br/&gt;
I had to change AjaxIndicatorAppender though - since Behavior#beforeRender() is actually called too late (during rendering) and overriding #onConfigure() instead.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=roncruz&quot; class=&quot;user-hover&quot; rel=&quot;roncruz&quot;&gt;roncruz&lt;/a&gt; Please attach another test-case for your problem with the charting library IF it has something to do with #prependJavaScript(). Otherwise open a new issue. Thanks!&lt;/p&gt;</comment>
                            <comment id="17214336" author="roncruz" created="Wed, 14 Oct 2020 23:24:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt; I&apos;m not familiar with Wicket internals, so I&apos;m not sure where the charting issue I described belongs in the context of this issue. I opened a new issue &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6841&quot; title=&quot;Evaluation order of dependent JS in Ajax request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6841&quot;&gt;&lt;del&gt;WICKET-6841&lt;/del&gt;&lt;/a&gt; with another quickstart that captures the basic scenario.&lt;/p&gt;</comment>
                            <comment id="17214467" author="mgrigorov" created="Thu, 15 Oct 2020 06:42:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m quite happy how the restructuring in &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6703&quot; title=&quot;Eliminate window.eval from wicket-ajax-jquery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6703&quot;&gt;&lt;del&gt;WICKET-6703&lt;/del&gt;&lt;/a&gt; worked out&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Wicket is less capable now. Before &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6703&quot; title=&quot;Eliminate window.eval from wicket-ajax-jquery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6703&quot;&gt;&lt;del&gt;WICKET-6703&lt;/del&gt;&lt;/a&gt; it was possible to prepend JS at any point in the rendering phase, now only in the action methods and in onConfigure(). Oh, well!&lt;/p&gt;</comment>
                            <comment id="17214784" author="svenmeier" created="Thu, 15 Oct 2020 15:32:25 +0000"  >&lt;p&gt;This is caused by broader issue that will be fixed with &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6841&quot; title=&quot;Evaluation order of dependent JS in Ajax request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6841&quot;&gt;&lt;del&gt;WICKET-6841&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17214993" author="svenmeier" created="Thu, 15 Oct 2020 20:37:44 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6841&quot; title=&quot;Evaluation order of dependent JS in Ajax request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6841&quot;&gt;&lt;del&gt;WICKET-6841&lt;/del&gt;&lt;/a&gt; for the fix&lt;/p&gt;</comment>
                            <comment id="17214999" author="jira-bot" created="Thu, 15 Oct 2020 20:48:46 +0000"  >&lt;p&gt;Commit 140fdd7fceff49f18b5e85b696002b6cbca6e7f3 in wicket&apos;s branch refs/heads/master from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=140fdd7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=140fdd7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6840&quot; title=&quot;Busy indicator persists after request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6840&quot;&gt;&lt;del&gt;WICKET-6840&lt;/del&gt;&lt;/a&gt; prepare components before writing prepend JavaScripts&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit b748e9caae4ceebb742ddbdce903e9f90fd6cc63.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310660">
                    <name>Completes</name>
                                                                <inwardlinks description="is fixed by">
                                        <issuelink>
            <issuekey id="13335507">WICKET-6841</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13013553" name="test_proj.zip" size="7384594" author="roncruz" created="Wed, 14 Oct 2020 07:26:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 4 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jofs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>