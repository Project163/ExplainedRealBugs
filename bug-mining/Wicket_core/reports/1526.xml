<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:26:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-6702] AsynchronousPageStore with NotDetachedModelChecker - &quot;Not detached model found&quot; exception on several fast sequential Ajax calls</title>
                <link>https://issues.apache.org/jira/browse/WICKET-6702</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;Preconditions: Application uses AsynchronousPageStore (as it is by default).&lt;/p&gt;

&lt;p&gt;When there are several fast sequential Ajax calls to a component, then a component&apos;s LoadableDetachableModel gets attached and detached several times before real async serialization takes place. And at times the serialization is initiated when the model has been already attached once again by a subsequent Ajax call, and not detached yet as the request is still in progress. This causes NotDetachedModelChecker() to throw &quot;Not detached model found!&quot; exception&lt;/p&gt;

&lt;p&gt;Disabling async serialization fixes the problem.&lt;/p&gt;

&lt;p&gt;A test-case and a log attached.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13258249">WICKET-6702</key>
            <summary>AsynchronousPageStore with NotDetachedModelChecker - &quot;Not detached model found&quot; exception on several fast sequential Ajax calls</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sergio_tkachuk">Sergei Tkachuk</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Sep 2019 09:09:41 +0000</created>
                <updated>Sun, 15 Nov 2020 19:20:18 +0000</updated>
                            <resolved>Fri, 2 Oct 2020 11:50:25 +0000</resolved>
                                    <version>8.5.0</version>
                    <version>9.0.0</version>
                                    <fixVersion>9.1.0</fixVersion>
                    <fixVersion>8.10.0</fixVersion>
                                    <component>wicket-core</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="16935871" author="mgrigorov" created="Mon, 23 Sep 2019 13:49:51 +0000"  >&lt;p&gt;Please attach a complete application. Maven based is preferred.&lt;/p&gt;

&lt;p&gt;See&#160;&lt;a href=&quot;http://wicket.apache.org/start/quickstart.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wicket.apache.org/start/quickstart.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16936508" author="sergio_tkachuk" created="Tue, 24 Sep 2019 07:22:29 +0000"  >&lt;p&gt;Attached, see TestHomePage.java.&lt;/p&gt;</comment>
                            <comment id="16937446" author="svenmeier" created="Wed, 25 Sep 2019 06:31:59 +0000"  >&lt;p&gt;You&apos;re right, consecutive Ajax requests to a page hit the identical instance, so an asynchronous serialization might start or still be ongoing while a request is already/still working on that page.&lt;/p&gt;

&lt;p&gt;To make this fully bullet-proof we would have to lock the page while it is being serialized.&lt;/p&gt;</comment>
                            <comment id="17017984" author="tobiashaupt" created="Fri, 17 Jan 2020 12:55:42 +0000"  >&lt;p&gt;I&apos;m also facing a related Problem while accessing a page that is currently serialized. It only appears when I trigger a big number of Ajax requests to the same page instance. I use the current version of wicket 8.7.0.&lt;/p&gt;

&lt;p&gt;I put a debugger breakpoint into java.util.ArrayList.writeObject(ArrayList.java:766) and found out that the list, that is concurrently modified, is the children list of MarkupContainer. In my case the exception is triggered by a list (Repeater) that clears and rebuilds the contained elements.&lt;/p&gt;

&lt;p&gt;Its hard to build a quickstart because it is a timing problem. In my case the serialized page is relatively big in terms of contained Components. It takes some time to serialize it.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
org.apache.wicket.WicketRuntimeException: java.util.ConcurrentModificationException
 at org.apache.wicket.serialize.java.JavaSerializer$SerializationCheckerObjectOutputStream.writeObjectOverride(JavaSerializer.java:402) ~[wicket-core.j
ar:8.7.0]
 at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:344) ~[?:1.8.0_144]
 at org.apache.wicket.serialize.java.JavaSerializer.serialize(JavaSerializer.java:82) [wicket-core.jar:8.7.0]
 at org.apache.wicket.pageStore.AbstractPageStore.serializePage(AbstractPageStore.java:133) [wicket-core.jar:8.7.0]
 at org.apache.wicket.pageStore.DefaultPageStore.createSerializedPage(DefaultPageStore.java:281) [wicket-core.jar:8.7.0]
 at org.apache.wicket.pageStore.DefaultPageStore.storePage(DefaultPageStore.java:61) [wicket-core.jar:8.7.0]
 at org.apache.wicket.pageStore.AsynchronousPageStore$PageSavingRunnable.run(AsynchronousPageStore.java:208) [wicket-core.jar:8.7.0]
 at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748) [?:1.8.0_144]
Caused by: java.util.ConcurrentModificationException
 at java.util.ArrayList.writeObject(ArrayList.java:766) ~[?:1.8.0_144]
 at sun.reflect.GeneratedMethodAccessor183.invoke(Unknown Source) ~[?:?]
 at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_144]
 at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_144]
 at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1028) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_144]
 at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) ~[?:1.8.0_144]
 at java.util.ArrayList.writeObject(ArrayList.java:762) ~[?:1.8.0_144]
 at sun.reflect.GeneratedMethodAccessor183.invoke(Unknown Source) ~[?:?]

[... ommited]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17075776" author="thorben.schmidt" created="Sun, 5 Apr 2020 09:59:54 +0000"  >&lt;p&gt;I can confirm the statement of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tobiashaupt&quot; class=&quot;user-hover&quot; rel=&quot;tobiashaupt&quot;&gt;tobiashaupt&lt;/a&gt;. I get the same exception, but from the class org.apache.commons.collections4.map.LinkedMap, because of the constant MAPIFY_THRESHOLD from the MarkupContainer.&lt;br/&gt;
I think because a web application is always multithreaded and this is especially true for ajax requests, the list or map should be threadsafe (concurrent / synchronized).&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2020-04-05 09:44:02,442 - INFO  [main] org.eclipse.jetty.server.Server []: Started @25664ms
2020-04-05 11:33:01,939 - ERROR [Wicket-AsyncPageStore-PageSavingThread] org.apache.wicket.serialize.java.JavaSerializer []: error writing object [Page class = some.package.application.pages.SomePage, id = 21, render count = 1]: null
java.util.ConcurrentModificationException: null
	at org.apache.commons.collections4.map.AbstractLinkedMap$LinkIterator.nextEntry(AbstractLinkedMap.java:574) ~[commons-collections4-4.4.jar:4.4]
	at org.apache.commons.collections4.map.AbstractLinkedMap$LinkMapIterator.next(AbstractLinkedMap.java:369) ~[commons-collections4-4.4.jar:4.4]
	at org.apache.commons.collections4.map.AbstractHashedMap.doWriteObject(AbstractHashedMap.java:1245) ~[commons-collections4-4.4.jar:4.4]
	at org.apache.commons.collections4.map.LinkedMap.writeObject(LinkedMap.java:134) ~[commons-collections4-4.4.jar:4.4]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_242]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_242]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_242]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_242]
	at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1140) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) ~[?:1.8.0_242]
	at java.util.ArrayList.writeObject(ArrayList.java:766) ~[?:1.8.0_242]
	at sun.reflect.GeneratedMethodAccessor58.invoke(Unknown Source) ~[?:?]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_242]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_242]
	at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1140) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) ~[?:1.8.0_242]
	at java.util.ArrayList.writeObject(ArrayList.java:766) ~[?:1.8.0_242]
	at sun.reflect.GeneratedMethodAccessor58.invoke(Unknown Source) ~[?:?]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_242]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_242]
	at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1140) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeArray(ObjectOutputStream.java:1378) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1174) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) ~[?:1.8.0_242]
	at java.util.ArrayList.writeObject(ArrayList.java:766) ~[?:1.8.0_242]
	at sun.reflect.GeneratedMethodAccessor58.invoke(Unknown Source) ~[?:?]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_242]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_242]
	at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1140) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) ~[?:1.8.0_242]
	at java.util.ArrayList.writeObject(ArrayList.java:766) ~[?:1.8.0_242]
	at sun.reflect.GeneratedMethodAccessor58.invoke(Unknown Source) ~[?:?]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_242]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_242]
	at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1140) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) ~[?:1.8.0_242]
	at java.util.ArrayList.writeObject(ArrayList.java:766) ~[?:1.8.0_242]
	at sun.reflect.GeneratedMethodAccessor58.invoke(Unknown Source) ~[?:?]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_242]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_242]
	at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1140) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) ~[?:1.8.0_242]
	at org.apache.wicket.serialize.java.JavaSerializer$SerializationCheckerObjectOutputStream.writeObjectOverride(JavaSerializer.java:368) ~[wicket-core-8.7.0.jar:8.7.0]
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:344) ~[?:1.8.0_242]
	at org.apache.wicket.serialize.java.JavaSerializer.serialize(JavaSerializer.java:82) ~[wicket-core-8.7.0.jar:8.7.0]
	at org.apache.wicket.pageStore.AbstractPageStore.serializePage(AbstractPageStore.java:133) ~[wicket-core-8.7.0.jar:8.7.0]
	at org.apache.wicket.pageStore.DefaultPageStore.createSerializedPage(DefaultPageStore.java:281) ~[wicket-core-8.7.0.jar:8.7.0]
	at org.apache.wicket.pageStore.DefaultPageStore.storePage(DefaultPageStore.java:61) ~[wicket-core-8.7.0.jar:8.7.0]
	at org.apache.wicket.pageStore.AsynchronousPageStore$PageSavingRunnable.run(AsynchronousPageStore.java:208) ~[wicket-core-8.7.0.jar:8.7.0]
	at java.lang.Thread.run(Thread.java:748) [?:1.8.0_242]
2020-04-05 11:33:01,939 - ERROR [Wicket-AsyncPageStore-PageSavingThread] org.apache.wicket.serialize.java.JavaSerializer []: Error serializing object class some.package.application.pages.SomePage [object=[Page class = some.package.application.pages.SomePage, id = 21, render count = 1]]
org.apache.wicket.WicketRuntimeException: java.util.ConcurrentModificationException
	at org.apache.wicket.serialize.java.JavaSerializer$SerializationCheckerObjectOutputStream.writeObjectOverride(JavaSerializer.java:402) ~[wicket-core-8.7.0.jar:8.7.0]
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:344) ~[?:1.8.0_242]
	at org.apache.wicket.serialize.java.JavaSerializer.serialize(JavaSerializer.java:82) ~[wicket-core-8.7.0.jar:8.7.0]
	at org.apache.wicket.pageStore.AbstractPageStore.serializePage(AbstractPageStore.java:133) ~[wicket-core-8.7.0.jar:8.7.0]
	at org.apache.wicket.pageStore.DefaultPageStore.createSerializedPage(DefaultPageStore.java:281) ~[wicket-core-8.7.0.jar:8.7.0]
	at org.apache.wicket.pageStore.DefaultPageStore.storePage(DefaultPageStore.java:61) ~[wicket-core-8.7.0.jar:8.7.0]
	at org.apache.wicket.pageStore.AsynchronousPageStore$PageSavingRunnable.run(AsynchronousPageStore.java:208) ~[wicket-core-8.7.0.jar:8.7.0]
	at java.lang.Thread.run(Thread.java:748) [?:1.8.0_242]
Caused by: java.util.ConcurrentModificationException
	at org.apache.commons.collections4.map.AbstractLinkedMap$LinkIterator.nextEntry(AbstractLinkedMap.java:574) ~[commons-collections4-4.4.jar:4.4]
	at org.apache.commons.collections4.map.AbstractLinkedMap$LinkMapIterator.next(AbstractLinkedMap.java:369) ~[commons-collections4-4.4.jar:4.4]
	at org.apache.commons.collections4.map.AbstractHashedMap.doWriteObject(AbstractHashedMap.java:1245) ~[commons-collections4-4.4.jar:4.4]
	at org.apache.commons.collections4.map.LinkedMap.writeObject(LinkedMap.java:134) ~[commons-collections4-4.4.jar:4.4]
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_242]
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_242]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_242]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_242]
	at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1140) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) ~[?:1.8.0_242]
	at java.util.ArrayList.writeObject(ArrayList.java:766) ~[?:1.8.0_242]
	at sun.reflect.GeneratedMethodAccessor58.invoke(Unknown Source) ~[?:?]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_242]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_242]
	at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1140) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) ~[?:1.8.0_242]
	at java.util.ArrayList.writeObject(ArrayList.java:766) ~[?:1.8.0_242]
	at sun.reflect.GeneratedMethodAccessor58.invoke(Unknown Source) ~[?:?]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_242]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_242]
	at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1140) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeArray(ObjectOutputStream.java:1378) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1174) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) ~[?:1.8.0_242]
	at java.util.ArrayList.writeObject(ArrayList.java:766) ~[?:1.8.0_242]
	at sun.reflect.GeneratedMethodAccessor58.invoke(Unknown Source) ~[?:?]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_242]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_242]
	at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1140) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) ~[?:1.8.0_242]
	at java.util.ArrayList.writeObject(ArrayList.java:766) ~[?:1.8.0_242]
	at sun.reflect.GeneratedMethodAccessor58.invoke(Unknown Source) ~[?:?]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_242]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_242]
	at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1140) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) ~[?:1.8.0_242]
	at java.util.ArrayList.writeObject(ArrayList.java:766) ~[?:1.8.0_242]
	at sun.reflect.GeneratedMethodAccessor58.invoke(Unknown Source) ~[?:?]
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_242]
	at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_242]
	at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:1140) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1496) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1548) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1509) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1432) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1178) ~[?:1.8.0_242]
	at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348) ~[?:1.8.0_242]
	at org.apache.wicket.serialize.java.JavaSerializer$SerializationCheckerObjectOutputStream.writeObjectOverride(JavaSerializer.java:368) ~[wicket-core-8.7.0.jar:8.7.0]
	... 7 more
2020-04-05 11:33:01,939 - WARN  [Wicket-AsyncPageStore-PageSavingThread] org.apache.wicket.pageStore.AbstractPageStore []: Page [Page class = some.package.application.pages.SomePage, id = 21, render count = 1] cannot be serialized. See previous logs for possible reasons.
2020-04-05 11:33:01,939 - WARN  [Wicket-AsyncPageStore-PageSavingThread] org.apache.wicket.pageStore.DefaultPageStore []: Page [Page class = some.package.application.pages.SomePage, id = 21, render count = 1] cannot be serialized. See previous logs for possible reasons.
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17075879" author="svenmeier" created="Sun, 5 Apr 2020 17:04:05 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=thorben.schmidt&quot; class=&quot;user-hover&quot; rel=&quot;thorben.schmidt&quot;&gt;thorben.schmidt&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;all pages are single-threaded by design, Wicket uses PageAccessSynchronizer to enforced this.&lt;br/&gt;
This includes Ajax requests, which are processed sequentially on each page.&lt;/p&gt;

&lt;p&gt;We will have to lock the page while it is serialized asynchronously. otherwise ConcurrentModificationException can happen on all sort of places.&lt;/p&gt;

&lt;p&gt;Obviously this would delay any further requests on the same page.&lt;/p&gt;</comment>
                            <comment id="17075904" author="thorben.schmidt" created="Sun, 5 Apr 2020 18:47:01 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;thanks for the information, I&apos;m not that deep into wicket architecture yet. Maybe it&apos;s an option to implement locking the page as an optional configuration.&lt;/p&gt;</comment>
                            <comment id="17195353" author="papegaaij" created="Mon, 14 Sep 2020 10:09:30 +0000"  >&lt;p&gt;This issue is still valid in 9.1.0-SNAPSHOT. I&apos;m hitting this bug as well. I think there&apos;re 2 possible solutions to this:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Acquire a lock on the page in &lt;tt&gt;AsynchronousPageStore&lt;/tt&gt; to prevent concurrent modifications in a request.&lt;/li&gt;
	&lt;li&gt;Serialize synchronously and then delegate to &lt;tt&gt;AsynchronousPageStore&lt;/tt&gt;, so switch the order of the 2 stores.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I can reproduce the problem quite reliably on one of the pages in our application (like once every 3 hits). In our case the ArrayList is the children list of a component.&lt;/p&gt;</comment>
                            <comment id="17195357" author="papegaaij" created="Mon, 14 Sep 2020 10:22:19 +0000"  >&lt;p&gt;I&apos;ve just tested the second solution, and for me it solves the problem. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt; what do you think? The downside is that serialization will occur in the request thread, the upside is that we don&apos;t need locking for the serialization. Implementing locking in the &lt;tt&gt;AsynchronousPageStore&lt;/tt&gt; will be very difficult, because the &lt;tt&gt;PageAccessSynchronizer&lt;/tt&gt; lives in the user&apos;s HTTP session. We can get it via the cachedAttributes, but I think that will open a whole new can of worms.&lt;/p&gt;</comment>
                            <comment id="17195603" author="svenmeier" created="Mon, 14 Sep 2020 16:59:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=papegaaij&quot; class=&quot;user-hover&quot; rel=&quot;papegaaij&quot;&gt;papegaaij&lt;/a&gt; I agree completely. Reversing the storage order will fix this problem. In hindsight is has been a bad idea to try asynchronous serialization.&lt;/p&gt;</comment>
                            <comment id="17195927" author="tobiashaupt" created="Tue, 15 Sep 2020 07:16:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt; I don&apos;t agree that it has been a completely bad idea. In our application asynchronous serialization brings a huge performance improvement in terms of page load times. The serialization of a page takes up to 60ms per Request. This includes every single ajax-request. We are building a backoffice application with rather heavy model state and deep/large component tree that has to be serialized properly.&lt;br/&gt;
What i don&apos;t fully understand so far is that the &lt;b&gt;synchronous&lt;/b&gt; serialization strategy blocks the response from beeing written, flushed and sent to the client. Wouldn&apos;t it be possible to change that, so that the page gets serialized in the same thread but only after the whole reponse has been sent to the client?&lt;/p&gt;</comment>
                            <comment id="17196141" author="papegaaij" created="Tue, 15 Sep 2020 13:23:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tobiashaupt&quot; class=&quot;user-hover&quot; rel=&quot;tobiashaupt&quot;&gt;tobiashaupt&lt;/a&gt; I agree with you that it might be a good idea to find a way to flush the request earlier, finishing the response while still holding the lock to cleanup of the request. I think we should file a new ticket for that (if it does not yet exist). The current behavior is broken. You cannot serialize a page without holding a lock. You might get the correct result, you might get an exception (either during serialization or in the concurrent request) or one of the two might produce incorrect results (like serializing non-detached models including their state). In fact, I don&apos;t believe this feature has ever worked the way it was supposed to.&lt;/p&gt;</comment>
                            <comment id="17196142" author="jira-bot" created="Tue, 15 Sep 2020 13:23:42 +0000"  >&lt;p&gt;Commit d86a288a774e980771cdf0512479b22dad1a3328 in wicket&apos;s branch refs/heads/master from Emond Papegaaij&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=d86a288&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=d86a288&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6702&quot; title=&quot;AsynchronousPageStore with NotDetachedModelChecker - &amp;quot;Not detached model found&amp;quot; exception on several fast sequential Ajax calls&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6702&quot;&gt;&lt;del&gt;WICKET-6702&lt;/del&gt;&lt;/a&gt;: swap serialization and async to prevent unlocked access to pages&lt;/p&gt;</comment>
                            <comment id="17196993" author="papegaaij" created="Wed, 16 Sep 2020 14:03:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt; as you can see, I&apos;ve pushed a change to swap the order of serialization and async to make the serialization happen synchronously. I&apos;ve only made this change on Wicket 9, as the codebase in Wicket 8 is completely different in this area. Unfortunately, I do not have a working testcase on Wicket 8 to reproduce the issue and I lack the time to dive into this. What do you think we should do with Wicket 8?&lt;/p&gt;

&lt;p&gt;About the comment from Tobias, I can file a new ticket, but unfortunately, the same applies: I don&apos;t have the time at the moment to pursue this. What do you think? Is it even feasible to close the request while prior to serialization (maybe even prior to detach)?&lt;/p&gt;</comment>
                            <comment id="17197018" author="papegaaij" created="Wed, 16 Sep 2020 14:35:55 +0000"  >&lt;p&gt;I couldn&apos;t resist the temptation and tried flushing early and it seems to work, see &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6831&quot; title=&quot;Flush the response before detach&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6831&quot;&gt;&lt;del&gt;WICKET-6831&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="17197131" author="svenmeier" created="Wed, 16 Sep 2020 17:14:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=papegaaij&quot; class=&quot;user-hover&quot; rel=&quot;papegaaij&quot;&gt;papegaaij&lt;/a&gt; we can achieve the same in Wicket 8.x:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/wicket-core/src/main/java/org/apache/wicket/DefaultPageManagerProvider.java b/wicket-core/src/main/java/org/apache/wicket/DefaultPageManagerProvider.java
index f109472..206d554 100644
--- a/wicket-core/src/main/java/org/apache/wicket/DefaultPageManagerProvider.java
+++ b/wicket-core/src/main/java/org/apache/wicket/DefaultPageManagerProvider.java
@@ -66,11 +66,6 @@
 dataStore = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AsynchronousDataStore(dataStore, capacity);
 
 pageStore = newPageStore(dataStore);
-
- &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (pageStore.canBeAsynchronous())
- {
- pageStore = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AsynchronousPageStore(pageStore, capacity);
- }
 }
 &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
 {&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;AsynchronousPageStore should be deprecate then.&lt;/p&gt;</comment>
                            <comment id="17197208" author="papegaaij" created="Wed, 16 Sep 2020 19:50:52 +0000"  >&lt;p&gt;But that will remove the functionality of the async page store completely, including async disk IO, or is that still provided by AsynchronousDataStore?&lt;/p&gt;</comment>
                            <comment id="17197233" author="svenmeier" created="Wed, 16 Sep 2020 20:52:21 +0000"  >&lt;p&gt;Yes, AsynchronousDataStore will still supply the asynchronous IO.&lt;/p&gt;</comment>
                            <comment id="17197514" author="papegaaij" created="Thu, 17 Sep 2020 08:42:03 +0000"  >&lt;p&gt;In that case, we should do what you suggested. I&apos;m confident that Wicket 8 can have the same changes from &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6831&quot; title=&quot;Flush the response before detach&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6831&quot;&gt;&lt;del&gt;WICKET-6831&lt;/del&gt;&lt;/a&gt; to reduce client time.&lt;/p&gt;</comment>
                            <comment id="17197567" author="reiern70" created="Thu, 17 Sep 2020 09:43:03 +0000"  >&lt;p&gt;After checking our private issues I think we might have found the same problems in a page with a very aggressive timer.&lt;/p&gt;</comment>
                            <comment id="17199080" author="jira-bot" created="Sun, 20 Sep 2020 19:07:23 +0000"  >&lt;p&gt;Commit f105719c9b15c1f11502cfea7c5bd71d2ced6901 in wicket&apos;s branch refs/heads/wicket-8.x from Sven Meier&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=f105719&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=f105719&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6702&quot; title=&quot;AsynchronousPageStore with NotDetachedModelChecker - &amp;quot;Not detached model found&amp;quot; exception on several fast sequential Ajax calls&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6702&quot;&gt;&lt;del&gt;WICKET-6702&lt;/del&gt;&lt;/a&gt; do not serialize asynchronously&lt;/p&gt;</comment>
                            <comment id="17214672" author="reiern70" created="Thu, 15 Oct 2020 12:36:40 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;java.lang.IllegalStateException: Cannot create a session after the response has been committed	at org.apache.catalina.connector.Request.doGetSession(Request.java:3038)&lt;br/&gt;
	at org.apache.catalina.connector.Request.getSession(Request.java:2456)&lt;br/&gt;
	at org.apache.catalina.connector.RequestFacade.getSession(RequestFacade.java:896)&lt;br/&gt;
	at javax.servlet.http.HttpServletRequestWrapper.getSession(HttpServletRequestWrapper.java:231)&lt;br/&gt;
	at org.apache.shiro.web.servlet.ShiroHttpServletRequest.getSession(ShiroHttpServletRequest.java:148)&lt;br/&gt;
	at org.apache.wicket.session.HttpSessionStore.getHttpSession(HttpSessionStore.java:85)&lt;br/&gt;
	at org.apache.wicket.session.HttpSessionStore.getSessionId(HttpSessionStore.java:146)&lt;br/&gt;
	at org.apache.wicket.Session.bind(Session.java:276)&lt;br/&gt;
	at org.apache.wicket.pageStore.DefaultPageContext.getSessionId(DefaultPageContext.java:44)&lt;br/&gt;
	at org.apache.wicket.pageStore.AsynchronousPageStore$PendingAdd.&amp;lt;init&amp;gt;(AsynchronousPageStore.java:150)&lt;br/&gt;
	at org.apache.wicket.pageStore.AsynchronousPageStore.addPage(AsynchronousPageStore.java:368)&lt;br/&gt;
	at org.apache.wicket.pageStore.SerializingPageStore.addPage(SerializingPageStore.java:82)&lt;br/&gt;
	at org.apache.wicket.pageStore.CachingPageStore.addPage(CachingPageStore.java:73)&lt;br/&gt;
	at org.apache.wicket.pageStore.RequestPageStore.detach(RequestPageStore.java:108)&lt;br/&gt;
	at org.apache.wicket.page.PageManager.detach(PageManager.java:85)&lt;/p&gt;

&lt;p&gt;Maybe is this related to early flush?&lt;/p&gt;</comment>
                            <comment id="17214803" author="svenmeier" created="Thu, 15 Oct 2020 16:05:58 +0000"  >&lt;p&gt;That would be the case if a stateful page gets stored and no session id was acquired before that.&lt;/p&gt;

&lt;p&gt;Can you reproduce that?&lt;/p&gt;</comment>
                            <comment id="17216529" author="reiern70" created="Mon, 19 Oct 2020 08:19:42 +0000"  >&lt;p&gt;It appears consistently in our app logs while running tests... I might need some time to spot what situation is producing this case.&lt;/p&gt;</comment>
                            <comment id="17219140" author="svenmeier" created="Thu, 22 Oct 2020 16:19:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=reiern70&quot; class=&quot;user-hover&quot; rel=&quot;reiern70&quot;&gt;reiern70&lt;/a&gt; see &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6847&quot; title=&quot;async page storing fails with flush before detach without session&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6847&quot;&gt;&lt;del&gt;WICKET-6847&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13327872">WICKET-6831</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12981139" name="QuickStart.zip" size="50433" author="sergio_tkachuk" created="Tue, 24 Sep 2019 07:22:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 3 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z06wt4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>