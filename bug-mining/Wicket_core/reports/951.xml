<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:22:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-5417] this.replaceWith is broken when called from onInitialize</title>
                <link>https://issues.apache.org/jira/browse/WICKET-5417</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;When calling this.replaceWith within the onInitialize method, wicket throws an exception:&lt;/p&gt;

&lt;p&gt;&quot;Last cause: org.apache.wicket.Component has not been properly initialized. Something in the hierarchy of com.mycompany.PanelA has not called super.onInitialize() in the override of onInitialize() method&quot;&lt;/p&gt;


&lt;p&gt;This happens because detach is called on the panel being replaced which clears Component.request flags (sets to 0) which causes the exception on line 864 of Component.java:&lt;br/&gt;
if (!getRequestFlag(RFLAG_INITIALIZE_SUPER_CALL_VERIFIED)) {&lt;br/&gt;
            // throws here&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment></environment>
        <key id="12679111">WICKET-5417</key>
            <summary>this.replaceWith is broken when called from onInitialize</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="rdearing">Ryan Dearing</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 Nov 2013 21:25:10 +0000</created>
                <updated>Mon, 25 Nov 2013 12:33:34 +0000</updated>
                            <resolved>Mon, 25 Nov 2013 12:33:34 +0000</resolved>
                                    <version>6.12.0</version>
                                    <fixVersion>7.0.0-M1</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13821857" author="rdearing" created="Wed, 13 Nov 2013 21:25:43 +0000"  >&lt;p&gt;Quickstart to repro bug&lt;/p&gt;</comment>
                            <comment id="13823687" author="mgrigorov" created="Fri, 15 Nov 2013 14:27:08 +0000"  >&lt;p&gt;Attaching a possible solution.&lt;/p&gt;

&lt;p&gt;I&apos;m not 100% certain we want to do this though.&lt;br/&gt;
If you know you want to replace the current component with another you can call super.onInitialize() after the replacement.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenmeier&quot; class=&quot;user-hover&quot; rel=&quot;svenmeier&quot;&gt;svenmeier&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ivaynberg&quot; class=&quot;user-hover&quot; rel=&quot;ivaynberg&quot;&gt;ivaynberg&lt;/a&gt; What do you think ?&lt;/p&gt;</comment>
                            <comment id="13823752" author="ivaynberg" created="Fri, 15 Nov 2013 15:51:51 +0000"  >&lt;p&gt;whats the usecase for component replacing itself during oninitialize()? it doesnt seem valid to me...&lt;/p&gt;</comment>
                            <comment id="13823825" author="svenmeier" created="Fri, 15 Nov 2013 17:18:05 +0000"  >&lt;p&gt;The patch looks fine, but I don&apos;t think we have to cover every corner case.&lt;/p&gt;</comment>
                            <comment id="13825223" author="mgrigorov" created="Mon, 18 Nov 2013 09:41:02 +0000"  >&lt;p&gt;The same exception is thrown when replaceWith() is used in #onBeforeRender() &lt;b&gt;after&lt;/b&gt; calling super.onBeforeRender().&lt;br/&gt;
At render time it is not allowed to change the hierarchy but the error message you get is: org.apache.wicket.Component has not been properly rendered. Something in the hierarchy of com.mycompany.PanelA has not called super.onBeforeRender() in the override of onBeforeRender() method.&lt;/p&gt;

&lt;p&gt;So yes, the use cases are odd but the error message is not the best either.&lt;/p&gt;</comment>
                            <comment id="13825485" author="rdearing" created="Mon, 18 Nov 2013 17:12:20 +0000"  >&lt;p&gt;Calling super.onInitialize() after the replaceWith() call does prevent the error. This usecase only arose because I&apos;m extending a panel that has overridden onInitialize() which in turn calls an abstract method implemented by subclasses. In that method there is some business logic that determines the current panel is not appropriate and calls replaceWith().&lt;/p&gt;

&lt;p&gt;I was able to fix this by moving the logic into the constructor and calling replaceWith() there. It wasn&apos;t immediately clear what was causing the issue or that calling replaceWith() is not permitted within onInitialize(), so it would be nice to update the exception or the javadoc so it is more clear.&lt;/p&gt;</comment>
                            <comment id="13831355" author="mgrigorov" created="Mon, 25 Nov 2013 10:57:38 +0000"  >&lt;p&gt;I think my suggested patch should be applied.&lt;br/&gt;
It is allowed to use #replaceWith in #onBeforeRender() - the rendering is not yet started.&lt;/p&gt;

&lt;p&gt;It is a strange use case but the fix is simple and will make #onInitialize() and #onBeforeRender() behave the same way as &amp;lt;init&amp;gt; (the constructor) and #onConfigure().&lt;/p&gt;</comment>
                            <comment id="13831388" author="svenmeier" created="Mon, 25 Nov 2013 11:51:41 +0000"  >&lt;p&gt;Can we apply the change to Wicket 7 only? I&apos;m afraid of breaking someone&apos;s project with this.&lt;/p&gt;</comment>
                            <comment id="13831392" author="mgrigorov" created="Mon, 25 Nov 2013 12:02:04 +0000"  >&lt;p&gt;OK.&lt;/p&gt;</comment>
                            <comment id="13831417" author="mgrigorov" created="Mon, 25 Nov 2013 12:33:34 +0000"  >&lt;p&gt;Correction: #replaceWith() cannot be called inside the constructor because at this time the parent is still unknown.&lt;/p&gt;

&lt;p&gt;Since 7.0.0 it will be allowed to call #replaceWith inside #onInitialize and #onBeforeRender as well.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12614063" name="WICKET-5417.patch" size="656" author="mgrigorov" created="Fri, 15 Nov 2013 14:27:08 +0000"/>
                            <attachment id="12613694" name="replacewithbug.tgz" size="20855" author="rdearing" created="Wed, 13 Nov 2013 21:25:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>358476</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pson:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>358766</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>