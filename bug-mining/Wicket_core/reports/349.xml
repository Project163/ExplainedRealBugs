<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:18:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-3972] wicket:message attribute results in &quot;The component was rendered already&quot; error</title>
                <link>https://issues.apache.org/jira/browse/WICKET-3972</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;Seems like there is a problem with generation of tag and component IDs when using wicket:message as an attribute for tags inside ListView.&lt;br/&gt;
The quickstart webapp is attached to this ticket. There are two pages in this webapp: HomePage with a ListView containing tags with wicket:message attribute and two tags with wicket:message attribute outside the ListView. If a user goes to the next page (SecondPage) using the link on HomePage and then goes back to HomePage using the link on SecondPage, the exception mentioned in the subject occurs.&lt;br/&gt;
Seems that the ID generation for tags and components is wrong: the ComponentTag-s are cached together with the corresponding Markup and then reused for later renderings. But the problem is, that those ComponentTag-s are mutable (at least in case of tags with wicket:message attribute) and their IDs are changed on every rendering and this produces ID conflicts when MarkupContainer.renderNext tries to find or create components corresponding to the tags.&lt;br/&gt;
Interesting is, that we can reproduce this bug only in DEVELOPMENT mode. In DEPLOYMENT mode everything seems to work. The solution would be to make ComponentTags immutable and do not allow to change them, but to create copies (there is mutable method in ComponentTag, which is used in some cases).&lt;/p&gt;</description>
                <environment>Linux Ubuntu, Tomcat 6, Java 6</environment>
        <key id="12519249">WICKET-3972</key>
            <summary>wicket:message attribute results in &quot;The component was rendered already&quot; error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdonnerstag">Juegen Donnerstag</assignee>
                                    <reporter username="barlabanov">Sergiy Barlabanov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Aug 2011 07:08:50 +0000</created>
                <updated>Sat, 20 Aug 2011 20:21:52 +0000</updated>
                            <resolved>Fri, 19 Aug 2011 07:37:06 +0000</resolved>
                                    <version>1.5-RC5.1</version>
                                    <fixVersion>1.5-RC6</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13086957" author="mgrigorov" created="Thu, 18 Aug 2011 11:31:13 +0000"  >&lt;p&gt;This is a hard one to track the bug...&lt;br/&gt;
There are two stable wicket:message components and the other are dynamically generated depending on the request parameter value.&lt;br/&gt;
If I disable any of them then the app works, but otherwise the &apos;link&apos; component is not rendered, component use check runs, and for some reason  during the rendering of the error page the error message gets replaced by &quot;wicket:message with id &apos;..&apos; was already rendered&quot;.&lt;/p&gt;</comment>
                            <comment id="13087147" author="pete" created="Thu, 18 Aug 2011 17:57:27 +0000"  >&lt;p&gt;Short summary on what I found so far:&lt;/p&gt;

&lt;p&gt;The problem lies within WicketMessageTagHandler, WicketMessageResolver and the behavior of Page.getAutoIndex().&lt;/p&gt;

&lt;p&gt;When rendering HomePage for the 1st time WicketMessageResolver resolves the &apos;wicket:message&apos; attributes and sets the component id of the affected components to &apos;&lt;em&gt;message_attr&lt;/em&gt;&apos;. &lt;/p&gt;

&lt;p&gt;WicketMessageTagHandler will detect all component with &apos;&lt;em&gt;message_attr&lt;/em&gt;&apos; and add an auto index. The auto index starts with zero when rendering begins and returns unique id&apos;s for dynamically creating unique component ids.&lt;/p&gt;

&lt;p&gt;So after the first render we have the first input tag resolved with id = &apos;_message_attr_4&apos; (the one that causes the crash later). Now we redirect to SecondPage and return. Since the list view will create another tag with &apos;wicket:message&apos; it will receive &apos;&apos;_message_attr&apos; as temporary component id. Again WicketMessageTagHandler tries to assign an auto index (which starts with zero every new render). In this example it gets index = 4 by chance (unlucky!) which already exists so we get a duplicate component id.&lt;/p&gt;

&lt;p&gt;The solution is probably to check if a component already exists when creating new component id&apos;s with auto index or to keep auto index incrementing over different page id&apos;s for the same page (however this will make stateless pages stateful).&lt;/p&gt;

&lt;p&gt;I keep on investigating...&lt;/p&gt;</comment>
                            <comment id="13087166" author="pete" created="Thu, 18 Aug 2011 18:14:34 +0000"  >&lt;p&gt;replace above &apos;component id&apos; with &apos;tag id&apos;&lt;/p&gt;</comment>
                            <comment id="13087174" author="pete" created="Thu, 18 Aug 2011 18:27:29 +0000"  >&lt;p&gt;For component tags that not necessarily relate to a wicket component (tag id &amp;lt;&amp;gt; component id) we need to place auto index somewhere else but not in page. I will attach a patch which puts the auto index right inside MarkupResourceStream. I think this is the technically right place. However I don&apos;t know if this is ugly or the way to solve it, so feedback is welcome...&lt;/p&gt;</comment>
                            <comment id="13087197" author="jdonnerstag" created="Thu, 18 Aug 2011 19:01:00 +0000"  >&lt;p&gt;I don&apos;t think your observations are completely right. *Handlers are executed while loading the markup and before the markup gets cached. They get re-used for multiple instances of typically (but necessarily) the same Components. The Page instance is not known. The main purpose of *Handlers are to identify tags which Wicket&apos;s render process must somehow handle.&lt;/p&gt;

&lt;p&gt;*Resolvers are used during the render process to automatically create (or find/resolve) components which know how to handle the tag. Many *Resolvers create auto-components, which are typically transparent, and which are automatically removed again after the render process. They get re-created with the next render cycle. The Page is known during the render process. And because the page auto-index gets incremented, it should never happen that for the same page instance components with the same id are created.  I don&apos;t think we need some other mechanism. A *Resolver should never change the tag id, only the *Handler may.&lt;/p&gt;

&lt;p&gt;The solution is much simpler. WicketMessageTagHandler.resolver() should not call tag.setId()&lt;/p&gt;

</comment>
                            <comment id="13087414" author="pete" created="Thu, 18 Aug 2011 23:54:11 +0000"  >
&lt;p&gt;@J&#252;rgen: Thanks for the feedback &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I think the problem can be solved by not assigning a temporary component tag id (&apos;&lt;em&gt;message_attr&lt;/em&gt;&apos;) but a permanent one including a counter to the component tags with &apos;wicket:message&apos; attribute.&lt;/p&gt;

&lt;p&gt;currently we have the situation that 3 component tags with &apos;wicket:message&apos; are located in the markup but only two of them get resolved on first render of HomePage&lt;/p&gt;

&lt;p&gt;component tag#1 (id = &apos;&lt;em&gt;message_attr&lt;/em&gt;&apos;) &amp;#8211; invisible since list view is empty, so WicketMessageTagHandler#resolve() is not invoked and temporary id stays&lt;br/&gt;
component tag#2 (id = &apos;_message_attr_3&apos;)&lt;br/&gt;
component tag#3 (id = &apos;_message_attr_4&apos;)&lt;/p&gt;

&lt;p&gt;-&amp;gt; go to SecondPage&lt;/p&gt;

&lt;p&gt;-&amp;gt; go to HomePage with now visible ListView caused by page parameter&lt;/p&gt;

&lt;p&gt;resolve now assigns a permanent id to the first component which will cause an identifier collision&lt;/p&gt;

&lt;p&gt;component tag#1 (id = &apos;_message_attr_4&apos;) -&amp;gt; new permanent id assigned, will refer to component that has been attached to component tag #3 recently&lt;br/&gt;
component tag#2 (id = &apos;_message_attr_3&apos;) -&amp;gt; since the component tag has a related component resolve will not be invoked and the old id stays&lt;br/&gt;
component tag#3 (id = &apos;_message_attr_4&apos;) -&amp;gt; since the component tag has a related component resolve will not be invoked and the old id stays; wicket will again render component that has accidentally already been rendered by component tag #1 and causes the &apos;component was already rendered&apos; error&lt;/p&gt;


&lt;p&gt;new patch included...&lt;/p&gt;</comment>
                            <comment id="13087549" author="jdonnerstag" created="Fri, 19 Aug 2011 05:43:13 +0000"  >&lt;p&gt;Unfortunately it doesn&apos;t work. I wish it would, since it&apos;s simple than what we need to do today. There are several issues with this approach:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;which counter do you want to use? A new handler is created with every markup. The Page is not available. May be the Session, but you don&apos;t want to create it for stateless apps. The App / MarkupFactory?&lt;/li&gt;
	&lt;li&gt;You couldn&apos;t even use a counter per Handler if the Handler wouldn&apos;t get re-created, or use the resource stream or whatever, since the number scheme would only work if you can guarantee that the markup/Component is always used with the same Page only. But of course Components can be added to as many different Pages/Containers as you like. And every Page has a different sequence in which it loads its components. You inevitably will have clashes, except you choose an application scoped counter. But that is inpracticable, since it will overrun for large or busy apps, or apps which are in prod for a long time.&lt;/li&gt;
	&lt;li&gt;Because of transparent containers you cannot assume the much smuch smaller scope of a container for possible clashes, but to be safe, the complete page.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Did you try if the quickstart provided by Sergiy works if you remove tag.setId(xx) from WicketMessageTagHandler.resolver()?  The invocation of tag.setId(xxx) should really not be there. &lt;/p&gt;

&lt;p&gt;I think the convention is fine. The issue is that we don&apos;t enforce it in the code.&lt;/p&gt;
</comment>
                            <comment id="13087592" author="mgrigorov" created="Fri, 19 Aug 2011 07:37:06 +0000"  >&lt;p&gt;Applied Juergen&apos;s suggestion. It solves the problem.&lt;/p&gt;</comment>
                            <comment id="13088163" author="pete" created="Sat, 20 Aug 2011 08:39:29 +0000"  >&lt;p&gt;Wow, I was really surprised that just leaving off a single line will do the trick. Impressive!&lt;/p&gt;

&lt;p&gt;At least I learned a lot more about handlers and resolvers, thanks guys!! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13088257" author="barlabanov" created="Sat, 20 Aug 2011 20:02:12 +0000"  >&lt;p&gt;thanks for the fix. Will wait till RC6 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;br/&gt;
Though I think, that making Markups immutable would be a more clean solution (requiring more code &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;). There is no real need to reassign tag ids on every page/component render. The mutability of markup is a potential source of future errors, since component markups and ComponentTag objects contained inside are reused multiple times in different requests resulting in race conditions like the one described in this bug report.&lt;/p&gt;</comment>
                            <comment id="13088261" author="jdonnerstag" created="Sat, 20 Aug 2011 20:21:52 +0000"  >&lt;p&gt;That is only partially true. The ComponentTag exposed to &quot;normal&quot; users via onComponentTag() etc. is a copy and can be modified without doing harm to the core. Handlers are already something for advanced users. But I accept that it&apos;d be nice to throw an exception in cases like setId(). That should actually be easy to implement.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12490764" name="quickstart.zip" size="22047" author="barlabanov" created="Thu, 18 Aug 2011 07:09:28 +0000"/>
                            <attachment id="12490897" name="wicket-message-index.patch" size="1703" author="pete" created="Thu, 18 Aug 2011 23:54:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>64324</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0k9mn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116377</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>