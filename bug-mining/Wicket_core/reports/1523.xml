<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:26:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-6822] AsynchronousPageStore Potential Memory Leak</title>
                <link>https://issues.apache.org/jira/browse/WICKET-6822</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;From the dev@ mailing list:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;------------------------------------------------&lt;/p&gt;

&lt;p&gt;In Wicket 8.3.0, I had to override AsynchronousPageStore to fix a memory&lt;br/&gt;
leak. In looking at older versions of 9.0.0&apos;s version&lt;br/&gt;
of AsynchronousPageStore , I thought the memory leak had been fixed, but&lt;br/&gt;
now that 9.0.0 has been released (and maybe it was always that way and I&lt;br/&gt;
wasn&apos;t seeing it right), it seems like the memory leak is still there.&lt;/p&gt;

&lt;p&gt;Here is 8.3.0&apos;s AsynchronousPageStore.PageSavingRunnable inner class with&lt;br/&gt;
the memory leak:&lt;/p&gt;

&lt;p&gt;&#160;private class PageSavingRunnable implements Runnable&lt;br/&gt;
&#160;{&lt;br/&gt;
&#160; @Override&lt;br/&gt;
&#160; public void run()&lt;br/&gt;
&#160; {&lt;br/&gt;
&#160; &#160;while (pageSavingThread != null)&lt;br/&gt;
&#160; &#160;{&lt;br/&gt;
&#160; &#160; Entry entry = null;&lt;br/&gt;
&#160; &#160; try&lt;br/&gt;
&#160; &#160; &lt;/p&gt;
{
&#160; &#160; &#160;entry = entries.poll(POLL_WAIT, TimeUnit.MILLISECONDS);
&#160; &#160; }
&lt;p&gt;&#160; &#160; catch (InterruptedException e)&lt;br/&gt;
&#160; &#160; &lt;/p&gt;
{
&#160; &#160; &#160;log.debug(&quot;PageSavingRunnable:: Interrupted...&quot;);
&#160; &#160; }
&lt;p&gt;&#160; &#160; if (entry != null &amp;amp;&amp;amp; pageSavingThread != null)&lt;br/&gt;
&#160; &#160; {&lt;br/&gt;
&#160; &#160; &#160;log.debug(&quot;PageSavingRunnable:: Saving asynchronously: {}...&quot;, entry);&lt;br/&gt;
&#160; &#160; &#160;delegate.storePage(entry.sessionId,&#160;&lt;a href=&quot;http://entry.page/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;entry.page&lt;/a&gt;);&lt;br/&gt;
&#160; &#160; &#160;entryMap.remove(getKey(entry));&lt;br/&gt;
&#160; &#160; }&lt;br/&gt;
&#160; &#160;}&lt;br/&gt;
&#160; }&lt;br/&gt;
&#160;}&lt;/p&gt;

&lt;p&gt;Note that in the code above if an exception is thrown during the call:&lt;br/&gt;
delegate.storePage(entry.sessionId,&#160;&lt;a href=&quot;http://entry.page/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;entry.page&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;the call:&lt;br/&gt;
entryMap.remove(getKey(entry))&lt;/p&gt;

&lt;p&gt;never happens, causing the entryMap to continue to gradually increase in&lt;br/&gt;
size, eventually causing the heap to run out of memory.&lt;/p&gt;

&lt;p&gt;I switched those two lines to be:&lt;br/&gt;
&#160; &#160; &#160;entryMap.remove(getKey(entry));&lt;br/&gt;
&#160; &#160; &#160;delegate.storePage(entry.sessionId,&#160;&lt;a href=&quot;http://entry.page/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;entry.page&lt;/a&gt;);&lt;/p&gt;

&lt;p&gt;Now if an exception is thrown in delegate.storePage(), there is no longer a&lt;br/&gt;
problem because the page entry has already been removed.&#160; This has been&lt;br/&gt;
confirmed in our code base where after making the change, we no longer had&lt;br/&gt;
memory leak problems.&lt;/p&gt;

&lt;p&gt;Now in Wicket 9.0.0 very similar code looks like it will have the same&lt;br/&gt;
problem. Note the following in AsynchronousPageStore.PageAddingRunnable:&lt;/p&gt;

&lt;p&gt;&#160;private static class PageAddingRunnable implements Runnable&lt;br/&gt;
&#160;{&lt;br/&gt;
&#160; private static final Logger log =&lt;br/&gt;
LoggerFactory.getLogger(PageAddingRunnable.class);&lt;br/&gt;
&#160; private final BlockingQueue&amp;lt;PendingAdd&amp;gt; queue;&lt;br/&gt;
&#160; private final ConcurrentMap&amp;lt;String, PendingAdd&amp;gt; map;&lt;br/&gt;
&#160; private final IPageStore delegate;&lt;br/&gt;
&#160; private PageAddingRunnable(IPageStore delegate, BlockingQueue&amp;lt;PendingAdd&amp;gt;&lt;br/&gt;
queue,&lt;br/&gt;
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160;ConcurrentMap&amp;lt;String, PendingAdd&amp;gt; map)&lt;br/&gt;
&#160; &lt;/p&gt;
{
&#160; &#160;this.delegate = delegate;
&#160; &#160;this.queue = queue;
&#160; &#160;this.map = map;
&#160; }
&lt;p&gt;&#160; @Override&lt;br/&gt;
&#160; public void run()&lt;br/&gt;
&#160; {&lt;br/&gt;
&#160; &#160;while (!Thread.interrupted())&lt;br/&gt;
&#160; &#160;{&lt;br/&gt;
&#160; &#160; PendingAdd add = null;&lt;br/&gt;
&#160; &#160; try&lt;br/&gt;
&#160; &#160; &lt;/p&gt;
{
&#160; &#160; &#160;add = queue.poll(POLL_WAIT, TimeUnit.MILLISECONDS);
&#160; &#160; }
&lt;p&gt;&#160; &#160; catch (InterruptedException e)&lt;br/&gt;
&#160; &#160; &lt;/p&gt;
{
&#160; &#160; &#160;Thread.currentThread().interrupt();
&#160; &#160; }
&lt;p&gt;&#160; &#160; if (add != null)&lt;br/&gt;
&#160; &#160; {&lt;br/&gt;
&#160; &#160; &#160;log.debug(&quot;Saving asynchronously: {}...&quot;, add);&lt;br/&gt;
&#160; &#160; &#160;add.asynchronous = true;&lt;br/&gt;
&#160; &#160; &#160;delegate.addPage(add,&#160;&lt;a href=&quot;http://add.page/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;add.page&lt;/a&gt;);&lt;br/&gt;
&#160; &#160; &#160;map.remove(add.getKey());&lt;br/&gt;
&#160; &#160; }&lt;br/&gt;
&#160; &#160;}&lt;br/&gt;
&#160; }&lt;br/&gt;
&#160;}&lt;/p&gt;

&lt;p&gt;If an exception is thrown during the call:&lt;br/&gt;
delegate.addPage(add,&#160;&lt;a href=&quot;http://add.page/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;add.page&lt;/a&gt;);&lt;/p&gt;

&lt;p&gt;The call to:&lt;br/&gt;
map.remove(add.getKey());&lt;/p&gt;

&lt;p&gt;never happens, which will presumably still cause a memory leak.&lt;/p&gt;

&lt;p&gt;We&apos;re in the process of migrating from Wicket 8.x to 9.0.0 and will be&lt;br/&gt;
running 9.0.0 in a production environment soon.&#160; If needed, we&apos;ll try to&lt;br/&gt;
implement a similar fix for this in 9.0.0,&lt;/p&gt;

&lt;p&gt;Do you think this is something that would be important enough to be looked&lt;br/&gt;
into soon?&lt;/p&gt;

&lt;p&gt;Thanks for your time, and thanks for Wicket.&#160; It&apos;s a great web framework.&lt;br/&gt;
We&apos;ve been using it for many years now.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;#888888&quot;&gt;--------------------------------&lt;br/&gt;
&lt;br/&gt;
Todd Heaps&lt;/font&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13325021">WICKET-6822</key>
            <summary>AsynchronousPageStore Potential Memory Leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="mgrigorov">Martin Tzvetanov Grigorov</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Aug 2020 11:40:35 +0000</created>
                <updated>Fri, 28 Aug 2020 12:06:10 +0000</updated>
                            <resolved>Fri, 28 Aug 2020 12:06:10 +0000</resolved>
                                    <version>9.0.0</version>
                    <version>8.9.0</version>
                                    <fixVersion>9.1.0</fixVersion>
                    <fixVersion>8.10.0</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17186490" author="jira-bot" created="Fri, 28 Aug 2020 12:03:02 +0000"  >&lt;p&gt;Commit 0d1130b33be77e411200409870e8c238c594aeef in wicket&apos;s branch refs/heads/wicket-8.x from Martin Tzvetanov Grigorov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=0d1130b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=0d1130b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6822&quot; title=&quot;AsynchronousPageStore Potential Memory Leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6822&quot;&gt;&lt;del&gt;WICKET-6822&lt;/del&gt;&lt;/a&gt; AsynchronousPageStore Potential Memory Leak&lt;/p&gt;</comment>
                            <comment id="17186495" author="jira-bot" created="Fri, 28 Aug 2020 12:03:37 +0000"  >&lt;p&gt;Commit e937c6e78bc2261d4b5a6cabc845462ea6821efc in wicket&apos;s branch refs/heads/master from Martin Tzvetanov Grigorov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=wicket.git;h=e937c6e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=wicket.git;h=e937c6e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6822&quot; title=&quot;AsynchronousPageStore Potential Memory Leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6822&quot;&gt;&lt;del&gt;WICKET-6822&lt;/del&gt;&lt;/a&gt; AsynchronousPageStore Potential Memory Leak&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 11 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0i60w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>