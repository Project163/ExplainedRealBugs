<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:18:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-3740] Scalability issue with PageAccessSynchronizer</title>
                <link>https://issues.apache.org/jira/browse/WICKET-3740</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;Class org.apache.wicket.page.PageAccessSynchronizer uses a global lock (org.apache.wicket.page.PageAccessSynchronizer.semaphore) that is needed e.g. when a new instance of a Page is created or when an instance of a page is retrieved, The lock is global and becomes quickly contented. When testing with two parallel threads, about 20% of all statistical stack samples waited for the lock, with four parallel threads about 50%.&lt;/p&gt;

&lt;p&gt;The stack waiting for the lock is&lt;/p&gt;

&lt;p&gt;at org.apache.wicket.page.PageAccessSynchronizer.lockPage(PageAccessSynchronizer.java:119)&lt;br/&gt;
at org.apache.wicket.page.PageAccessSynchronizer$1.getPage(PageAccessSynchronizer.java:187)&lt;/p&gt;

&lt;p&gt;called either by&lt;/p&gt;

&lt;p&gt;at org.apache.wicket.Page.dirty(Page.java:327)&lt;/p&gt;

&lt;p&gt;as part of the Page ctor, or by&lt;/p&gt;

&lt;p&gt;at org.apache.wicket.DefaultMapperContext.getPageInstance(DefaultMapperContext.java:117)&lt;/p&gt;

&lt;p&gt;when retrieving page.&lt;/p&gt;


&lt;p&gt;Some threads&apos; stacks:&lt;/p&gt;

&lt;p&gt;waiting on (a java.lang.Object@0xHEXADDR)&lt;br/&gt;
at org.apache.wicket.page.PageAccessSynchronizer.lockPage(PageAccessSynchronizer.java:119)&lt;br/&gt;
at org.apache.wicket.page.PageAccessSynchronizer$1.getPage(PageAccessSynchronizer.java:187)&lt;br/&gt;
at org.apache.wicket.DefaultMapperContext.getPageInstance(DefaultMapperContext.java:117)&lt;br/&gt;
at org.apache.wicket.request.handler.PageProvider.getPageInstance(PageProvider.java:246)&lt;br/&gt;
at org.apache.wicket.request.handler.PageProvider.getPageInstance(PageProvider.java:159)&lt;br/&gt;
at org.apache.wicket.request.handler.ListenerInterfaceRequestHandler.getPage(ListenerInterfaceRequestHandler.java:89)&lt;br/&gt;
at org.apache.wicket.request.handler.ListenerInterfaceRequestHandler.respond(ListenerInterfaceRequestHandler.java:141)&lt;br/&gt;
at org.apache.wicket.request.cycle.RequestCycle$HandlerExecutor.respond(RequestCycle.java:718)&lt;br/&gt;
at org.apache.wicket.request.RequestHandlerStack.execute(RequestHandlerStack.java:63)&lt;br/&gt;
at org.apache.wicket.request.cycle.RequestCycle.processRequest(RequestCycle.java:212)&lt;br/&gt;
at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:253)&lt;br/&gt;
at org.apache.wicket.protocol.http.WicketFilter.processRequest(WicketFilter.java:138)&lt;br/&gt;
at org.apache.wicket.protocol.http.WicketFilter.doFilter(WicketFilter.java:194)&lt;br/&gt;
....&lt;br/&gt;
at java.lang.Object.wait(Native Method)&lt;/p&gt;

&lt;p&gt;waiting on (a java.lang.Object@0xHEXADDR) at org.apache.wicket.page.PageAccessSynchronizer.lockPage(PageAccessSynchronizer.java:119)&lt;br/&gt;
at org.apache.wicket.page.PageAccessSynchronizer$1.touchPage(PageAccessSynchronizer.java:194)&lt;br/&gt;
at org.apache.wicket.Page.dirty(Page.java:327)&lt;br/&gt;
at org.apache.wicket.Page.init(Page.java:770)&lt;br/&gt;
at org.apache.wicket.Page.&amp;lt;init&amp;gt;(Page.java:223)&lt;br/&gt;
at org.apache.wicket.Page.&amp;lt;init&amp;gt;(Page.java:202)&lt;br/&gt;
at org.apache.wicket.markup.html.WebPage.&amp;lt;init&amp;gt;(WebPage.java:99)&lt;br/&gt;
at x.y.z.page.base.Page.&amp;lt;init&amp;gt;(Page.java:100)&lt;br/&gt;
at x.y.z.page.base.ControllerBasedPage.&amp;lt;init&amp;gt;(ControllerBasedPage.java:41)&lt;br/&gt;
....&lt;br/&gt;
at java.lang.Object.wait(Native Method)&lt;/p&gt;

&lt;p&gt;waiting on (a java.lang.Object@0xHEXADDR) at org.apache.wicket.page.PageAccessSynchronizer.lockPage(PageAccessSynchronizer.java:119)&lt;br/&gt;
at org.apache.wicket.page.PageAccessSynchronizer$1.touchPage(PageAccessSynchronizer.java:194)&lt;br/&gt;
at org.apache.wicket.Page.dirty(Page.java:327)&lt;br/&gt;
at org.apache.wicket.Page.init(Page.java:770)&lt;br/&gt;
at org.apache.wicket.Page.&amp;lt;init&amp;gt;(Page.java:223)&lt;br/&gt;
at org.apache.wicket.Page.&amp;lt;init&amp;gt;(Page.java:202)&lt;br/&gt;
at org.apache.wicket.markup.html.WebPage.&amp;lt;init&amp;gt;(WebPage.java:99)&lt;br/&gt;
at x.y.z.page.base.Page.&amp;lt;init&amp;gt;(Page.java:100)&lt;br/&gt;
at x.y.z.page.base.ControllerBasedPage.&amp;lt;init&amp;gt;(ControllerBasedPage.java:41)&lt;br/&gt;
at x.y.z.page.NavigationAndContent.&amp;lt;init&amp;gt;(NavigationAndContent.java:43)&lt;br/&gt;
at x.y.z.page.MailDetail.&amp;lt;init&amp;gt;(MailDetail.java:84)&lt;br/&gt;
x.y.z.page.login.Login.&amp;lt;init&amp;gt;-wicket.Page.&amp;lt;init&amp;gt;-wicket.page.PageAccessSynchronizer.lockPage-WAIT_FOR_LOCK&lt;/p&gt;

&lt;p&gt;at java.lang.Object.wait(Native Method)&lt;/p&gt;

&lt;p&gt;waiting on (a java.lang.Object@0xHEXADDR) at org.apache.wicket.page.PageAccessSynchronizer.lockPage(PageAccessSynchronizer.java:119)&lt;br/&gt;
at org.apache.wicket.page.PageAccessSynchronizer$1.touchPage(PageAccessSynchronizer.java:194)&lt;br/&gt;
at org.apache.wicket.Page.dirty(Page.java:327)&lt;br/&gt;
at org.apache.wicket.Page.init(Page.java:770)&lt;br/&gt;
at org.apache.wicket.Page.&amp;lt;init&amp;gt;(Page.java:223)&lt;br/&gt;
at org.apache.wicket.Page.&amp;lt;init&amp;gt;(Page.java:202)&lt;br/&gt;
at org.apache.wicket.markup.html.WebPage.&amp;lt;init&amp;gt;(WebPage.java:99)&lt;br/&gt;
at x.y.z.page.base.Page.&amp;lt;init&amp;gt;(Page.java:100)&lt;br/&gt;
at x.y.z.page.login.Login.&amp;lt;init&amp;gt;(Login.java:23)&lt;br/&gt;
.....&lt;br/&gt;
at java.lang.Object.wait(Native Method)&lt;/p&gt;

&lt;p&gt;waiting on (a java.lang.Object@0xHEXADDR) at org.apache.wicket.page.PageAccessSynchronizer.lockPage(PageAccessSynchronizer.java:119)&lt;br/&gt;
at org.apache.wicket.page.PageAccessSynchronizer$1.touchPage(PageAccessSynchronizer.java:194)&lt;br/&gt;
at org.apache.wicket.Page.dirty(Page.java:327)&lt;br/&gt;
at org.apache.wicket.Page.init(Page.java:770)&lt;br/&gt;
at org.apache.wicket.Page.&amp;lt;init&amp;gt;(Page.java:223)&lt;br/&gt;
at org.apache.wicket.Page.&amp;lt;init&amp;gt;(Page.java:202)&lt;br/&gt;
....&lt;br/&gt;
at java.lang.Object.wait(Native Method)&lt;/p&gt;

&lt;p&gt;at org.apache.wicket.page.PageAccessSynchronizer.lockPage(PageAccessSynchronizer.java:119)&lt;br/&gt;
at org.apache.wicket.page.PageAccessSynchronizer$1.touchPage(PageAccessSynchronizer.java:194)&lt;br/&gt;
at org.apache.wicket.Page.dirty(Page.java:327)&lt;br/&gt;
at org.apache.wicket.Page.init(Page.java:770)&lt;br/&gt;
at org.apache.wicket.Page.&amp;lt;init&amp;gt;(Page.java:223)&lt;br/&gt;
at org.apache.wicket.Page.&amp;lt;init&amp;gt;(Page.java:202)&lt;br/&gt;
.....&lt;/p&gt;
</description>
                <environment>JMeter, Tomcat</environment>
        <key id="12508284">WICKET-3740</key>
            <summary>Scalability issue with PageAccessSynchronizer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ivaynberg">Igor Vaynberg</assignee>
                                    <reporter username="mgrigorov">Martin Tzvetanov Grigorov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 May 2011 07:54:30 +0000</created>
                <updated>Sun, 29 May 2011 22:50:10 +0000</updated>
                            <resolved>Thu, 26 May 2011 07:55:26 +0000</resolved>
                                    <version>1.5-RC4</version>
                                    <fixVersion>1.5-RC5</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13039011" author="mgrigorov" created="Wed, 25 May 2011 08:00:26 +0000"  >&lt;p&gt;A suggested patch.&lt;br/&gt;
Instead of using the global lock (semaphore variable) use the respective PageLock instance.&lt;/p&gt;

&lt;p&gt;PageAccessSynchronizerTest passes. I&apos;ll update the ticket when we have the new results from JMeter .&lt;/p&gt;</comment>
                            <comment id="13039083" author="mgrigorov" created="Wed, 25 May 2011 12:00:21 +0000"  >&lt;p&gt;The next problem is that &apos;locks&apos; map uses as a key the page id while it should be sessionId+pageId because the pageId is session relative.&lt;/p&gt;</comment>
                            <comment id="13039117" author="mgrigorov" created="Wed, 25 May 2011 13:31:39 +0000"  >&lt;p&gt;Attach a patch that additionally moves PageAccessSynchronizer from Application to Session so the pages are synchronized per the session which created their id. &lt;/p&gt;</comment>
                            <comment id="13039301" author="mgrigorov" created="Wed, 25 May 2011 19:43:55 +0000"  >&lt;p&gt;Some more work is needed.&lt;br/&gt;
Don&apos;t bother to review for now.&lt;/p&gt;</comment>
                            <comment id="13039307" author="mgrigorov" created="Wed, 25 May 2011 19:59:56 +0000"  >&lt;p&gt;Better impl.&lt;/p&gt;</comment>
                            <comment id="13039556" author="ivaynberg" created="Thu, 26 May 2011 07:29:31 +0000"  >&lt;p&gt;gah, of course its going to have a problem. the fact that it uses a global semaphor is not the problem as it is notified every time a thread releases a lock. the problem is that i wrote this in mind with the idea that page ids were going to be unique across sessions. i guess neither matej nor i got around to actually implementing it. since all sessions start with page id zero there will always be contention because separate sessions are still blocked because they want the same id.&lt;/p&gt;

&lt;p&gt;of course, the problem with your patch is that it wont work in the real world since the page synchronizer is not serializable, and it is tricky to make it serializable.&lt;/p&gt;

&lt;p&gt;however, i do think its easier to make it serializable than making page ids unique across sessions - those numbers will grow quickly, or making sure every call to synchronizer also includes the session id.&lt;/p&gt;

&lt;p&gt;i am using your patch as a base and adding serialization. hopefully it will work :/&lt;/p&gt;</comment>
                            <comment id="13039561" author="mgrigorov" created="Thu, 26 May 2011 07:38:01 +0000"  >&lt;p&gt;Passing sessionId has problems. I tried it but the problem was that in the beginning (lock page) it starts with a temporary session that has no id (== null) and at the end (commitRequest) is may be bound thus the id has meaningful value. But even for temporary session you can&apos;t differentiate one temporary session than another.&lt;/p&gt;</comment>
                            <comment id="13039572" author="ivaynberg" created="Thu, 26 May 2011 07:52:25 +0000"  >&lt;p&gt;working around server&apos;s session id is easy, we can simply have our own uuid we create in our own session. but, passing it around makes the code ugly. anyways, im done with the current way of doing it. code incoming. go ahead and profile it. reopen the issue if something is still broken.&lt;/p&gt;</comment>
                            <comment id="13039575" author="ivaynberg" created="Thu, 26 May 2011 07:57:52 +0000"  >&lt;p&gt;oh, and btw, im going to bed - so you get to fix the bugs &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12480450" name="WICKET-3740.patch" size="9386" author="mgrigorov" created="Wed, 25 May 2011 20:00:18 +0000"/>
                            <attachment id="12480449" name="WICKET-3740.patch" size="9556" author="mgrigorov" created="Wed, 25 May 2011 19:59:56 +0000"/>
                            <attachment id="12480409" name="WICKET-3740.patch" size="9399" author="mgrigorov" created="Wed, 25 May 2011 13:31:39 +0000"/>
                            <attachment id="12480377" name="WICKET-3740.patch" size="1758" author="mgrigorov" created="Wed, 25 May 2011 08:00:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204483</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 26 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ka5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116464</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>