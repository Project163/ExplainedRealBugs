<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:16:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-3302] Endless recursion if LoadableDetachableModel.load throws exception</title>
                <link>https://issues.apache.org/jira/browse/WICKET-3302</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;I don&apos;t know if there&apos;s any easy fix for this, but here&apos;s what happens:&lt;/p&gt;

&lt;p&gt;1. Component subclass overrides isVisible with a new implementation that depends on the current model state.&lt;/p&gt;

&lt;p&gt;2. The model is a LoadableDetachableModel.&lt;/p&gt;

&lt;p&gt;3. On the initial render, the load method of the LoadableDetachableModel throws a RuntimeException for whatever reason.  (In my case I was trying to throw a AbortWithHttpErrorCodeException.)&lt;/p&gt;

&lt;p&gt;4. This gets caught in Component.getDefaultModelObject:&lt;/p&gt;

&lt;p&gt;    log.error(&quot;Error while getting default model object for Component: &quot; + this.toString(true));&lt;/p&gt;

&lt;p&gt;5.  The toString method that&apos;s invoked from the exception handler prints the component&apos;s state, including its visibility.&lt;/p&gt;

&lt;p&gt;6.  In order to resolve the visibility state, toString has to call isVisible--the same method that initially caused the exception.&lt;/p&gt;

&lt;p&gt;7.  The isVisible method again throws an exception, etc.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12494456">WICKET-3302</key>
            <summary>Endless recursion if LoadableDetachableModel.load throws exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ivaynberg">Igor Vaynberg</assignee>
                                    <reporter username="wboyce@panix.com">Willis Blackburn</reporter>
                        <labels>
                    </labels>
                <created>Sun, 2 Jan 2011 21:29:20 +0000</created>
                <updated>Wed, 5 Jan 2011 03:38:53 +0000</updated>
                            <resolved>Tue, 4 Jan 2011 16:41:45 +0000</resolved>
                                    <version>1.5-M3</version>
                                    <fixVersion>1.4.16</fixVersion>
                    <fixVersion>1.5-RC1</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12976564" author="wboyce@panix.com" created="Sun, 2 Jan 2011 21:44:33 +0000"  >&lt;p&gt;Maybe a good solution would be to have Component.toString catch any exceptions that occur during the rendering of the string and fall back on emitting just the component ID plus &quot;caught TheBigException while retrieving component details.&quot;&lt;/p&gt;</comment>
                            <comment id="12977249" author="pedrosans" created="Tue, 4 Jan 2011 11:46:12 +0000"  >&lt;p&gt;Hi Willis, even if you throw an exception at the LDM#load method, it has the &apos;attached&apos; flag that will prevent an second load try, preventing your described issue. Where did you throw the AbortWithHttpErrorCodeException? Can you provide an test case?&lt;/p&gt;</comment>
                            <comment id="12977268" author="wboyce@panix.com" created="Tue, 4 Jan 2011 13:13:47 +0000"  >&lt;p&gt;I know that it&apos;s supposed to work that way because I read about people having this problem before.  I did some more investigation and discovered that the exception from LDM.load is only the instigator.  The cause of the recursion is that after the first invocation of the Component&apos;s isVisible method, which calls LDM.load and generates the exception, subsequent calls generate NPE, because the LDM.getObject now returns null.  The recursion continues until either we blow the stack or run out of heap.  Since this happens in less than a second normally, it sort of looks like the exception has worked and has aborted the page render, but the requested status code never gets sent back to the browser.&lt;/p&gt;

&lt;p&gt;I think that catching exceptions in Component.toString would be a good idea and would resolve this issue and many future issues.  Throwing an exception from the getDefaultModelObject method for any reason (whether it&apos;s due to LDM.load or from some custom model code) leaves the component&apos;s model in an unknown state, which means that any call to any non-final method of Component might generate an exception, which in turn will lead to the stack and/or heap being blown.&lt;/p&gt;

&lt;p&gt;I guess you could say &quot;well it&apos;s the programmer&apos;s responsibility to check for a null model,&quot; but this seems unreasonable in light of the circumstances:&lt;/p&gt;

&lt;p&gt;1.  The programmer is throwing an exception from LDM.load specifically because he doesn&apos;t want to deal with having a null model.  If the code was prepared to deal with a null model, then the programmer could just return null from LDM.load and let the page render and/or handle the condition in some other manner.&lt;/p&gt;

&lt;p&gt;2.  If the programmer has thrown AbortWithHttpErrorCodeException, then he reasonably expects the request to &lt;b&gt;abort&lt;/b&gt;, not to call additional component methods.  There is no compelling reason why Wicket can&apos;t just set the HTTP status and commit the response.&lt;/p&gt;

&lt;p&gt;3.  The method that is leading to the recursion is a &lt;b&gt;diagnostic&lt;/b&gt; method (toString), not one that&apos;s part of Wicket&apos;s core logic.  The programmer should not have to add &quot;if (model != null) ...&quot; throughout his code merely to support a log message.  If Wicket wants to print some diagnostics about a component with a known-bad model, then it should handle the potential exceptions.  The programmer, who has tried to avoid working with a bad model by thrown an exception from LDM.load, should not have to write defensive code anyway to support Component, which is choosing to continue to invoke methods on itself despite the model having failed to initialize.&lt;/p&gt;

&lt;p&gt;W&lt;/p&gt;




</comment>
                            <comment id="12977294" author="akiraly" created="Tue, 4 Jan 2011 14:51:38 +0000"  >&lt;p&gt;As I see there was a change in wicket in 1.4.10 (see &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;) so the new prefered way is to override onConfigure() (which is called only once) and set visibility from there instead of overriding isVisible() (which is called several times). Guess if the visibility controlling logic is in onConfigure() there is no endless recursion.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;: &lt;a href=&quot;http://wicket.apache.org/2010/08/11/wicket-1.4.10-released.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://wicket.apache.org/2010/08/11/wicket-1.4.10-released.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12977337" author="ivaynberg" created="Tue, 4 Jan 2011 16:41:45 +0000"  >&lt;p&gt;Attila is correct, onConfigure() is a better place to do this. However, I added the guard anyways to be on the safe side.&lt;/p&gt;</comment>
                            <comment id="12977355" author="hudson" created="Tue, 4 Jan 2011 17:22:35 +0000"  >&lt;p&gt;Integrated in Apache Wicket 1.4.x #367 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/Apache%20Wicket%201.4.x/367/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://hudson.apache.org/hudson/job/Apache%20Wicket%201.4.x/367/&lt;/a&gt;)&lt;br/&gt;
    Issue: &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-3302&quot; title=&quot;Endless recursion if LoadableDetachableModel.load throws exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-3302&quot;&gt;&lt;del&gt;WICKET-3302&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12977358" author="pedrosans" created="Tue, 4 Jan 2011 17:23:04 +0000"  >&lt;p&gt;@Willis: &quot;subsequent calls generate NPE&quot; where? can you copy past the relevant stack trace?&lt;/p&gt;</comment>
                            <comment id="12977611" author="wboyce@panix.com" created="Wed, 5 Jan 2011 03:36:26 +0000"  >&lt;p&gt;Pedro--the NPE is in my component&apos;s isVisible method.  In a roundabout way the isVisible method eventually invokes a method on the object returned from LDM.getObject.&lt;/p&gt;</comment>
                            <comment id="12977612" author="wboyce@panix.com" created="Wed, 5 Jan 2011 03:38:53 +0000"  >&lt;p&gt;Igor--thanks for addressing this.  onConfigure does sound like a good solution, and I&apos;ll start using it (wasn&apos;t aware of it until now!) but unless isVisible (and any other Component method invoked during exception processing) becomes final, there&apos;s always the chance of someone providing an implementation that uses the uninitialized model.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204109</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 46 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0kbcv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116657</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>