<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:22:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-5256] Allow configuring the resource used by ResourceStreamRequestHandler</title>
                <link>https://issues.apache.org/jira/browse/WICKET-5256</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;During the migration from Wicket 1.4 to 1.5.10 I found out that the ResourceStreamResource.respond() does not set the ContentType charset if the resource is of type StringResourceStream. Even though the stream holds the charset, it is not set, although quite a few other header parameters are (well this is understandable because not all ResourceStreams are StringResourceStreams. Also, it is difficult to call the resource.setTextEncoding, because the current flow in resourceStreamRequestHandler.respond does not allow easy overriding of any smaller piece of respond than the whole method. The practical issue was to download a CSV file by clicking a button. I managed to fix the issue by copy/paste/Overriding the ResourceStreamRequestHandler.respond, but IMHO this is not nice:&lt;/p&gt;

&lt;p&gt;    private void addCsvButton() {&lt;br/&gt;
        Form&amp;lt;?&amp;gt; form = new Form&amp;lt;Void&amp;gt;(&quot;form&quot;) {&lt;br/&gt;
            @Override&lt;br/&gt;
            protected void onSubmit() {&lt;br/&gt;
                final String fileName = getFileName(&quot;csv&quot;);&lt;br/&gt;
                TableCsvResourceFactory factory = new TableCsvResourceFactory();&lt;br/&gt;
                final IResourceStream resourceStream = factory.getResourceStream(tableModel.getObject());&lt;br/&gt;
                ResourceStreamRequestHandler resourceStreamRequestHandler = new ResourceStreamRequestHandler(&lt;br/&gt;
                        resourceStream) {&lt;br/&gt;
                    final ContentDisposition contentDisposition = ContentDisposition.ATTACHMENT;&lt;/p&gt;

&lt;p&gt;                    @Override&lt;br/&gt;
                    public void respond(IRequestCycle requestCycle) {&lt;br/&gt;
                        Attributes attributes = new Attributes(requestCycle.getRequest(), requestCycle.getResponse());&lt;/p&gt;

&lt;p&gt;                        ResourceStreamResource resource = new ResourceStreamResource(resourceStream);&lt;br/&gt;
                        resource.setFileName(fileName);&lt;br/&gt;
                        if (contentDisposition != null) &lt;/p&gt;
{
                            resource.setContentDisposition(contentDisposition);
                        }
&lt;p&gt; else &lt;/p&gt;
{
                            resource.setContentDisposition(Strings.isEmpty(fileName) ? ContentDisposition.INLINE
                                    : ContentDisposition.ATTACHMENT);
                        }

&lt;p&gt;                        final Duration cacheDuration = getCacheDuration();&lt;br/&gt;
                        if (cacheDuration != null) &lt;/p&gt;
{
                            resource.setCacheDuration(cacheDuration);
                        }
&lt;p&gt;+                        resource.setTextEncoding(&quot;UTF-8&quot;);&lt;/p&gt;

&lt;p&gt;                        resource.respond(attributes);&lt;br/&gt;
                    }&lt;br/&gt;
                };&lt;br/&gt;
                RequestCycle.get().scheduleRequestHandlerAfterCurrent(resourceStreamRequestHandler);&lt;br/&gt;
            }&lt;br/&gt;
        };&lt;br/&gt;
        form.setVisible(displayCsv);&lt;br/&gt;
        add(form);&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;There are a couple of problems with the current implementation of ResourceStreamRequestHandler:&lt;br/&gt;
1) I didn&apos;t figure out yet any other way how to call the &lt;br/&gt;
                        resource.setTextEncoding(&quot;UTF-8&quot;);&lt;br/&gt;
except by copy/pasting the whole ResourceStreamRequestHandler.respond() code to the Override. It would be nice, if there would be some cleaner hook to override some smaller part of this method, such as an empty default implementation of setTextEncoding() that would be always called but would not do anything for other types.&lt;/p&gt;

&lt;p&gt;2) A second approach would be to create a StringResourceStreamRequestHandler extends ResourceStreamRequestHandler that would be otherwise the same, but would use IStringResource instead of IResource, and would also set the TextEncoding.&lt;/p&gt;

&lt;p&gt;3) However, third, I didn&apos;t yet find any good way to get the encoding from the StringResourceStream itself, because the AbstractStringResourceStream has a protected getCharset(). This problem could be overcome by adding public version of getCharset() to StringResourceStream, or as I did, create a parallel subclass CharsetStringResourceStream that is a copy/paste from StringResourceStream but is non-final and has public getCharset(). After this you could dynamically set the text encoding in ResourceStreamRequestHandler.respond for example like this:&lt;/p&gt;

&lt;p&gt;                        if (getResourceStream() instanceof CharsetStringResourceStream) &lt;/p&gt;
{
                            resource.setTextEncoding(((CharsetStringResourceStream)getResourceStream()).getCharsetName());
                        }

&lt;p&gt;Anyway, I think the usage of StringResourceStream with ResourceStreamRequestHandler should be improved somehow, at the moment I think it is a bit awkward to use.&lt;/p&gt;</description>
                <environment>Ubuntu 12.04, Sun JDK 1.6.0_38 64bit</environment>
        <key id="12655118">WICKET-5256</key>
            <summary>Allow configuring the resource used by ResourceStreamRequestHandler</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="pharazon">Antti H&#228;tinen</reporter>
                        <labels>
                            <label>ResourceStreamResource</label>
                            <label>StringResourceStream</label>
                            <label>setTextEncoding</label>
                    </labels>
                <created>Thu, 27 Jun 2013 11:01:24 +0000</created>
                <updated>Thu, 27 Jun 2013 11:31:08 +0000</updated>
                            <resolved>Thu, 27 Jun 2013 11:31:08 +0000</resolved>
                                    <version>1.5.10</version>
                                    <fixVersion>1.5.11</fixVersion>
                    <fixVersion>6.10.0</fixVersion>
                    <fixVersion>7.0.0-M1</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13694617" author="pharazon" created="Thu, 27 Jun 2013 11:02:59 +0000"  >&lt;p&gt;One addition: the practical issue is that in the HTTP header content-type you get only for example&lt;/p&gt;

&lt;p&gt; text/x-csv&lt;/p&gt;

&lt;p&gt;and I would like to get&lt;br/&gt;
 text/x-csv; charset=UTF-8&lt;/p&gt;
</comment>
                            <comment id="13694622" author="mgrigorov" created="Thu, 27 Jun 2013 11:14:20 +0000"  >&lt;p&gt;Here is a possible improvement.&lt;br/&gt;
A new method #configure(ResourceStreamResource) is introduced.&lt;br/&gt;
This way you can do something like:&lt;/p&gt;

&lt;p&gt;ResourceStreamRequestHandler rsrh = new ResourceStreamRequestHandler(...) {&lt;br/&gt;
  @Override&lt;br/&gt;
  protected void configure(ResourceStreamResource resource) &lt;/p&gt;
  {
     super.configure(resource);
     resource.setXyz(...);
  }
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;Is this better ?&lt;/p&gt;</comment>
                            <comment id="13694627" author="pharazon" created="Thu, 27 Jun 2013 11:20:03 +0000"  >&lt;p&gt;Exposing public getCharsetName() in StringBufferResourceStream would also do.&lt;/p&gt;</comment>
                            <comment id="13694628" author="pharazon" created="Thu, 27 Jun 2013 11:22:48 +0000"  >&lt;p&gt;Martin: Yes, I think that would be one good solution!&lt;/p&gt;</comment>
                            <comment id="13694635" author="mgrigorov" created="Thu, 27 Jun 2013 11:31:08 +0000"  >&lt;p&gt;The improvement is applied.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12589879" name="WICKET-5256.patch" size="2034" author="mgrigorov" created="Thu, 27 Jun 2013 11:14:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335395</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 21 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lur3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335719</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>