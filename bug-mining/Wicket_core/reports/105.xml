<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:17:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-3512] &lt;wicket:enclosure&gt; results in MarkupException when used with multiple &lt;wicket:child&gt;</title>
                <link>https://issues.apache.org/jira/browse/WICKET-3512</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;Put below simple pages into a Wicket web application:&lt;/p&gt;

&lt;p&gt;TestPage1.html:&lt;/p&gt;

&lt;p&gt;&amp;lt;html&amp;gt;&lt;br/&gt;
	&amp;lt;head&amp;gt;&lt;br/&gt;
		&amp;lt;title&amp;gt;title&amp;lt;/title&amp;gt;&lt;br/&gt;
	&amp;lt;/head&amp;gt;&lt;br/&gt;
	&amp;lt;body&amp;gt;&lt;br/&gt;
		&amp;lt;div wicket:id=&quot;test1&quot;&amp;gt;&amp;lt;/div&amp;gt;&lt;br/&gt;
		&amp;lt;wicket:child&amp;gt;&amp;lt;/wicket:child&amp;gt;&lt;br/&gt;
	&amp;lt;/body&amp;gt;&lt;br/&gt;
&amp;lt;/html&amp;gt;&lt;/p&gt;

&lt;p&gt;TestPage1.java:&lt;/p&gt;

&lt;p&gt;package com.example.test;&lt;br/&gt;
import org.apache.wicket.markup.html.WebPage;&lt;br/&gt;
import org.apache.wicket.markup.html.basic.Label;&lt;/p&gt;

&lt;p&gt;public class TestPage1 extends WebPage {&lt;/p&gt;

&lt;p&gt;	public TestPage1() &lt;/p&gt;
{
		add(new Label(&quot;test1&quot;, &quot;test1&quot;));
	}
&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;TestPage2.html:&lt;/p&gt;

&lt;p&gt;&amp;lt;wicket:extend&amp;gt;&lt;br/&gt;
	&amp;lt;wicket:enclosure child=&quot;test2&quot;&amp;gt;&lt;br/&gt;
		&amp;lt;div wicket:id=&quot;test2&quot;&amp;gt;&amp;lt;/div&amp;gt;&lt;br/&gt;
	&amp;lt;/wicket:enclosure&amp;gt;&lt;br/&gt;
	&amp;lt;wicket:child&amp;gt;&amp;lt;/wicket:child&amp;gt;&lt;br/&gt;
&amp;lt;/wicket:extend&amp;gt;&lt;/p&gt;

&lt;p&gt;TestPage2.java:&lt;/p&gt;

&lt;p&gt;package com.example.test;&lt;/p&gt;

&lt;p&gt;import org.apache.wicket.markup.html.basic.Label;&lt;/p&gt;

&lt;p&gt;public class TestPage2 extends TestPage1 {&lt;/p&gt;

&lt;p&gt;	public TestPage2() &lt;/p&gt;
{
		add(new Label(&quot;test2&quot;, &quot;test2&quot;));
	}

&lt;p&gt;}&lt;/p&gt;

&lt;p&gt;TestPage3.html:&lt;/p&gt;

&lt;p&gt;&amp;lt;wicket:extend&amp;gt;&lt;br/&gt;
	&amp;lt;wicket:enclosure child=&quot;test3&quot;&amp;gt;&lt;br/&gt;
		&amp;lt;div wicket:id=&quot;test3&quot;&amp;gt;&amp;lt;/div&amp;gt;&lt;br/&gt;
	&amp;lt;/wicket:enclosure&amp;gt;&lt;br/&gt;
&amp;lt;/wicket:extend&amp;gt;&lt;/p&gt;

&lt;p&gt;TestPage3.java:&lt;/p&gt;


&lt;p&gt;package com.example.test;&lt;/p&gt;

&lt;p&gt;import org.apache.wicket.markup.html.basic.Label;&lt;/p&gt;

&lt;p&gt;public class TestPage3 extends TestPage2 {&lt;/p&gt;

&lt;p&gt;	public TestPage3() &lt;/p&gt;
{
		add(new Label(&quot;test3&quot;, &quot;test3&quot;));
	}

&lt;p&gt;}&lt;/p&gt;


&lt;p&gt;Here TestPage3 extends TestPage2, and TestPage2 extends TestPage1. Both TestPage2.html and TestPage3.html contains a &amp;lt;wicket:enclosure&amp;gt; tag. Now mount TestPage3 and access it, below errors will be generated:&lt;/p&gt;

&lt;p&gt;Message: The component &lt;span class=&quot;error&quot;&gt;&amp;#91;Component id = test2&amp;#93;&lt;/span&gt; was rendered already. You can render it only once during a render phase. Class relative path: org.apache.wicket.markup.html.basic.Label:test2&lt;/p&gt;

&lt;p&gt;Root cause:&lt;/p&gt;

&lt;p&gt;org.apache.wicket.markup.MarkupException: The component &lt;span class=&quot;error&quot;&gt;&amp;#91;Component id = test2&amp;#93;&lt;/span&gt; was rendered already. You can render it only once during a render phase. Class relative path: org.apache.wicket.markup.html.basic.Label:test2&lt;br/&gt;
	 at org.apache.wicket.Page.componentRendered(Page.java:299)&lt;br/&gt;
	 at org.apache.wicket.Component.rendered(Component.java:2570)&lt;br/&gt;
	 at org.apache.wicket.Component.internalRender(Component.java:2377)&lt;br/&gt;
	 at org.apache.wicket.Component.render(Component.java:2301)&lt;br/&gt;
	 at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1415)&lt;br/&gt;
         ...&lt;/p&gt;

&lt;p&gt;This error won&apos;t occur if &amp;lt;wicket:enclosure&amp;gt; is removed from one of the page. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12500585">WICKET-3512</key>
            <summary>&lt;wicket:enclosure&gt; results in MarkupException when used with multiple &lt;wicket:child&gt;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="pedrosans">Pedro Santos</assignee>
                                    <reporter username="robinshine">Robin Shine</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Mar 2011 00:20:34 +0000</created>
                <updated>Thu, 24 Mar 2011 20:30:18 +0000</updated>
                            <resolved>Thu, 24 Mar 2011 20:08:46 +0000</resolved>
                                    <version>1.5-RC2</version>
                                    <fixVersion>1.5-RC3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13009677" author="pedrosans" created="Tue, 22 Mar 2011 15:23:28 +0000"  >&lt;p&gt;Initial investigation shows that AbstractMarkupFilter has an counter variable giving the same value to both enclosure components.&lt;/p&gt;

&lt;p&gt;the markup loader load TestPage3.html&lt;br/&gt;
the parser create the &quot;enclosure_1&quot;&lt;br/&gt;
the markup loader load TestPanel2.html, create a new set of filters, the counter is created again having its initial value&lt;br/&gt;
the parser create the &quot;enclosure_1&quot; again&lt;/p&gt;

&lt;p&gt;Changing EnclosureHandler or WicketTagIdentifier to assign different wicket ids fix the problem. But I still don&apos;t know why, I see nested components with identical wicket ids working all the time.&lt;/p&gt;</comment>
                            <comment id="13009699" author="pedrosans" created="Tue, 22 Mar 2011 16:25:58 +0000"  >&lt;p&gt;Rendering the TransparentWebMarkupContainer for the wicket:extend tag in TestPage3.html, ComponentResolvers return the parent Enclosure component, since in the hierarchy we have now an instance of IComponentResolver ( the TransparentWebMarkupContainer created to the wicket:child tag in TestPage2.html ). So the same enclosure get rendered twice, generating this bug.&lt;/p&gt;

&lt;p&gt;Relevant stack trace:&lt;/p&gt;

&lt;p&gt;TransparentWebMarkupContainer.resolve(MarkupContainer, MarkupStream, ComponentTag) line: 50&lt;br/&gt;
          --&amp;gt; TransparentWebMarkupContainer created to the wicket:child tag in TestPage2.html is a resolver, he know who is the &quot;_enclosure1&quot; because its parent has an homonym child, and return it to be rendered twice&lt;br/&gt;
ComponentResolvers.resolveByComponentHierarchy(MarkupContainer, MarkupStream, ComponentTag) line: 111	&lt;br/&gt;
ComponentResolvers.resolve(MarkupContainer, MarkupStream, ComponentTag, ComponentResolvers$ResolverFilter) line: 54	&lt;br/&gt;
TransparentWebMarkupContainer(MarkupContainer).renderNext(MarkupStream) line: 1407	&lt;br/&gt;
           --&amp;gt; TransparentWebMarkupContainer for the wicket:extend tag in TestPage3.html trying to render &quot;_enclosure1&quot;. As there are no such child, the resolvers are called.&lt;/p&gt;</comment>
                            <comment id="13009786" author="jdonnerstag" created="Tue, 22 Mar 2011 19:01:27 +0000"  >&lt;p&gt;Pedro is spot on. The root cause is the &quot;counter&quot; in AMF. The counter must be Page unique. Unfortunately the Page is not available. The Session is but I don&apos;t like that the numbers (ID) are growing very fast. Instead of Page we might use RequestCycle instead, but RequestCycle has no counter yet. Adding that counter to RC shouldn&apos;t be a big deal I think.&lt;/p&gt;</comment>
                            <comment id="13009803" author="pedrosans" created="Tue, 22 Mar 2011 19:39:57 +0000"  >&lt;p&gt;The main cause is also that TransparentWebMarkupContainer is resolving its parent&apos;s children components to their grandchildren even when its parent container declared an homonymous component in markup, meaning that he is the one who wants to render the component, and that it should not be resolved to grandchildren. I&apos;m preparing an patch fixing and exposing this bug with another test case.&lt;/p&gt;</comment>
                            <comment id="13009819" author="pedrosans" created="Tue, 22 Mar 2011 20:15:42 +0000"  >&lt;p&gt;Who ultimately set the Enclosure id is the EnclosureHandler, he knows the page and can use its auto index.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;return new Enclosure(tag.getId(), tag.getAttribute(EnclosureHandler.CHILD_ATTRIBUTE));&lt;br/&gt;
+ return new Enclosure(tag.getId() + container.getPage().getAutoIndex(), tag.getAttribute(EnclosureHandler.CHILD_ATTRIBUTE));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;MarkupInheritanceResolver is already assemblying this kind of id, if both changes are OK I think we are done.&lt;br/&gt;
Add RC as a markup parser dependence implies that we could not use it outside wicket lifecyle, test cases do it all the time.&lt;/p&gt;</comment>
                            <comment id="13010486" author="jdonnerstag" created="Wed, 23 Mar 2011 22:15:53 +0000"  >&lt;p&gt;I played a bit with your patches and tests. &lt;/p&gt;

&lt;p&gt;I think using page.getAutoIndex() is the right approach. The id will always be page unique and MarkupContainer.autoAdd() will make sure the markup gets assigned.&lt;/p&gt;

&lt;p&gt;on your additional test case, it actually works fine when java and markup are like they should be. But when users forgot to add one of the labels, like you deliberately did in your test cases, than wicket will throw an exception &quot;has already been rendered&quot; instead of &quot;component not found&quot;. Clearly giving the wrong hint to the user. That&apos;s what the TWMC patch is about. It would not be needed for Wicket to render properly.&lt;/p&gt;

&lt;p&gt;Page.wasRendered should be final and the javadoc should mention that it&apos;s a Wicket internal API which should not be used by users (=&amp;gt; contract or behavior might change in the futur releases)&lt;/p&gt;</comment>
                            <comment id="13010660" author="pedrosans" created="Thu, 24 Mar 2011 13:22:27 +0000"  >&lt;p&gt;In a very unlikely scenario involving user declaring the same wicket id generated by WicketTagIdentifier to its own components just above a TWMC enclosing wicket tags to be resolved, user will be able to break our renderer because the page auto index improvement is not enough. &lt;br/&gt;
I&apos;m sending the patch again with the API improvement, thanks Juergen, plus more test cases exposing this problem fixed in TWMC.&lt;/p&gt;</comment>
                            <comment id="13010858" author="jdonnerstag" created="Thu, 24 Mar 2011 19:19:53 +0000"  >&lt;p&gt;looks good. feel free and commit.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12474498" name="WICKET-3512-2.patch" size="15832" author="pedrosans" created="Thu, 24 Mar 2011 13:22:27 +0000"/>
                            <attachment id="12474331" name="WICKET-3512.patch" size="12784" author="pedrosans" created="Tue, 22 Mar 2011 19:49:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204292</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 35 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0kaqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116556</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>