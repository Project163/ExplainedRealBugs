<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:17:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-3551] Using web.xml &lt;error-page&gt; to render error pages via Wicket yields undesired behavior in Wicket 1.5</title>
                <link>https://issues.apache.org/jira/browse/WICKET-3551</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;In my applications I prefer to use Wicket to render all error pages, including my 404 &quot;not found&quot; page. This allows me to reuse a shared page template afforded by Wicket to create my error pages (i.e. by extending a BasePage), rather than using copy and paste to maintain static error page HTML files.&lt;/p&gt;

&lt;p&gt;I have been doing this as follows:&lt;/p&gt;

&lt;p&gt;web.xml:&lt;/p&gt;

&lt;p&gt; &amp;lt;error-page&amp;gt;&lt;br/&gt;
   &amp;lt;error-code&amp;gt;404&amp;lt;/error-code&amp;gt;&lt;br/&gt;
   &amp;lt;location&amp;gt;/error/404&amp;lt;/location&amp;gt;&lt;br/&gt;
 &amp;lt;/error-page&amp;gt;&lt;/p&gt;

&lt;p&gt;Now, so long as I have an appropriate bookmarkable page mounted on the &quot;/error/404&quot; path, the servlet container will render my page whenever a 404 &quot;not found&quot; scenario is encountered.&lt;/p&gt;

&lt;p&gt;This works great in Wicket 1.4.x.&lt;/p&gt;

&lt;p&gt;However in Wicket 1.5 (RC2 and the latest SNAPSHOT as of this writing), two problems occur:&lt;/p&gt;

&lt;p&gt;1. By default, Wicket 1.5 automatically performs a 302 redirect before rendering the error page. This changes the URL from the invalid one (i.e. the one that generated the 404) to the mounted path (/error/404 in this example). This is not the desired behavior for a 404 error page; the original URL requested by the user should be maintained.&lt;/p&gt;

&lt;p&gt;2. If I attempt to work around the issue by overriding WebPageRenderer.enableRedirectForStatelessPage() to return false, the problem gets worse. Now the URL doesn&apos;t change, which is good. But Wicket gets confused about the depth of the request URL path: it seems to calculate relative URLs based on the mounted path rather than the URL that was requested. This causes all relative resources on the page (e.g. stylesheet references) to be miscalculated and break.&lt;/p&gt;

&lt;p&gt;I will attach two quickstarts: one showing this configuration working in 1.4, and another showing the same setup failing as described above in 1.5-RC2.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12502211">WICKET-3551</key>
            <summary>Using web.xml &lt;error-page&gt; to render error pages via Wicket yields undesired behavior in Wicket 1.5</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ivaynberg">Igor Vaynberg</assignee>
                                    <reporter username="mbrictson">Matt Brictson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Mar 2011 17:52:40 +0000</created>
                <updated>Thu, 23 Jan 2014 15:27:00 +0000</updated>
                            <resolved>Sun, 27 Mar 2011 20:06:36 +0000</resolved>
                                    <version>1.5-RC2</version>
                                    <fixVersion>1.5-RC3</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13010439" author="mgrigorov" created="Wed, 23 Mar 2011 20:50:56 +0000"  >&lt;p&gt;With trunk if I request &lt;a href=&quot;http://localhost:8080/aaaa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/aaaa&lt;/a&gt; I still stay on that url and I see as content:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Note how the URL has changed to &lt;a href=&quot;http://localhost:8080/error/404&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8080/error/404&lt;/a&gt; (via a 302 redirect). This behavior is not desired. A 404 error page should render without changing the URL that was originally requested, as can be seen in this example.&lt;/li&gt;
	&lt;li&gt;If the application is reconfigured by overriding WebPageRenderer.enableRedirectForStatelessPage() to return false, this solves redirect problem. However, it introduces a new, more serious issue: Wicket is now confused about the depth of the URL and miscalculates the relative paths of resources on the page. For example, the stylesheet reference is now incorrect and doesn&apos;t load.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I.e. I can&apos;t reproduce it here.&lt;/p&gt;</comment>
                            <comment id="13010447" author="mgrigorov" created="Wed, 23 Mar 2011 21:07:09 +0000"  >&lt;p&gt;I just tried the following optimization:&lt;/p&gt;


&lt;p&gt;&amp;#8212; wicket-core/src/main/java/org/apache/wicket/request/handler/RenderPageRequestHandler.java	(revision 1084741)&lt;br/&gt;
+++ wicket-core/src/main/java/org/apache/wicket/request/handler/RenderPageRequestHandler.java	(working copy)&lt;br/&gt;
@@ -74,9 +74,22 @@&lt;br/&gt;
 	 */&lt;br/&gt;
 	public RenderPageRequestHandler(IPageProvider pageProvider)&lt;/p&gt;
 	{
-		this(pageProvider, RedirectPolicy.AUTO_REDIRECT);
+		this(pageProvider, computePolicy(pageProvider));
 	}

&lt;p&gt;+	private static RedirectPolicy computePolicy(IPageProvider pageProvider2)&lt;br/&gt;
+	{&lt;br/&gt;
+		if (pageProvider2.isNewPageInstance() == false &amp;amp;&amp;amp;&lt;br/&gt;
+			pageProvider2.getPageInstance().isPageStateless())&lt;br/&gt;
+		&lt;/p&gt;
{
+			return RedirectPolicy.NEVER_REDIRECT;
+		}
&lt;p&gt;+		else&lt;br/&gt;
+		&lt;/p&gt;
{
+			return RedirectPolicy.AUTO_REDIRECT;
+		}
&lt;p&gt;+	}&lt;br/&gt;
+&lt;/p&gt;


&lt;p&gt;but now org.apache.wicket.markup.html.internal.EnclosureTest.testRender10() fails. I have no time to debug what&apos;s wrong with it,&lt;/p&gt;</comment>
                            <comment id="13010449" author="mgrigorov" created="Wed, 23 Mar 2011 21:09:34 +0000"  >&lt;p&gt;I think I just realize - initially the page is stateless but during render it becomes stateful and bevause of NEVER_REDIRECT we render the wrong markup.&lt;/p&gt;</comment>
                            <comment id="13010827" author="mbrictson" created="Thu, 24 Mar 2011 18:38:31 +0000"  >&lt;p&gt;Some further thoughts on this issue:&lt;/p&gt;

&lt;p&gt;1. The automatic redirect policy in Wicket 1.5 in general is a good thing. But it is undesirable in this exceptional case. Is there an easy way to disable it for my error pages only, without writing a custom PageRenderer? Perhaps a flag I could override on the Page itself? (E.g. disable redirect if Page.isErrorPage()==true?)&lt;/p&gt;

&lt;p&gt;2. I think there is a subtle bug in how Wicket calculates relative paths that has been uncovered in this exceptional case. My understanding is that when a request yields a 404 error, the servlet container forwards the original request to the path defined in the &amp;lt;error-page&amp;gt; declaration. This forwarded request is handled by Wicket, and the relative paths are calculated by Wicket based on the forwarded path. But the user&apos;s browser URL still shows the original path. Wicket needs to be aware that the request was forwarded and unwrap it to get the path of the original request in order to calculate the proper relative paths.&lt;/p&gt;

&lt;p&gt;Perhaps serving &amp;lt;error-page&amp;gt; via Wicket is too problematic and should be discouraged? Do you think I going against the grain of the framework by attempting this?&lt;/p&gt;</comment>
                            <comment id="13011581" author="ivaynberg" created="Sat, 26 Mar 2011 07:06:05 +0000"  >&lt;p&gt;i believe the framework should support this. the redirect policy has to be smart enough to check if the request is an error request or not, and if it is switch over to never_redirect.&lt;/p&gt;

&lt;p&gt;as far as relative paths being calculated correctly, in 1.4 there is a workaround for that that may need to be ported to 1.5. martin, if you have time search the 1.4 codebase for &quot;javax.servlet.error.request_uri&quot;, i remember writing code that fixed relative paths for error urls there. ServletWebRequest i believe.&lt;/p&gt;</comment>
                            <comment id="13011773" author="mgrigorov" created="Sun, 27 Mar 2011 10:45:10 +0000"  >&lt;p&gt;The only problem here is that I cannot reproduce the problem with current trunk ...&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12528672">WICKET-4168</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12690775">WICKET-5486</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12474421" name="WICKET-3551-wicket-1.4.tgz" size="5203" author="mbrictson" created="Wed, 23 Mar 2011 17:54:34 +0000"/>
                            <attachment id="12474422" name="WICKET-3551-wicket-1.5-RC2.tgz" size="18857" author="mbrictson" created="Wed, 23 Mar 2011 17:54:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204323</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0kanz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116545</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>