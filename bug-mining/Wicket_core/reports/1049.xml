<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:23:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-5241] RequestLogger&apos;s server duration does not include &apos;detach duration&apos;</title>
                <link>https://issues.apache.org/jira/browse/WICKET-5241</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;When a certain IModel impl takes a lot of time to detach, this will not be included in the &apos;duration&apos; section. This is very easy to reproduce: use a model that sleeps for 10 seconds in the detach(); make sure to write a page which will not much time to render, say 100ms. One will see that the RequestLogger will output 100ms as duration, instead of 10100ms.&lt;/p&gt;

&lt;p&gt;In our production environment, these this server duration is the primary metric to show server performance; so right now we&apos;re dealing with misleading figures.&lt;/p&gt;

&lt;p&gt;I hope this is an easy one to fix &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12653712">WICKET-5241</key>
            <summary>RequestLogger&apos;s server duration does not include &apos;detach duration&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="chrisgunnink">Chris Gunnink</reporter>
                        <labels>
                            <label>performance</label>
                    </labels>
                <created>Wed, 19 Jun 2013 14:07:18 +0000</created>
                <updated>Tue, 24 Jun 2014 13:25:19 +0000</updated>
                            <resolved>Tue, 24 Jun 2014 13:25:19 +0000</resolved>
                                    <version>6.6.0</version>
                                    <fixVersion>7.0.0-M3</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13692793" author="cedricgatay" created="Tue, 25 Jun 2013 06:50:16 +0000"  >&lt;p&gt;You can find an implementation allowing to trace the time taken for the request including the time taken for detaching entities at the following commit &lt;a href=&quot;https://github.com/CedricGatay/wicket/compare/WICKET-5241?expand=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/CedricGatay/wicket/compare/WICKET-5241?expand=1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Could you please provide a quickstart allowing to test the implementation I made before merging it ?&lt;/p&gt;</comment>
                            <comment id="13692866" author="dashorst" created="Tue, 25 Jun 2013 09:07:26 +0000"  >&lt;p&gt;The issue is not that the requestlogger is reporting wrong figures, but rather that the detach phase is halting the response. When the request is in detach phase, no client side visible stuff should happen, including having a request stall for 10 seconds. To further aggravate the issue, onDetach is called twice in Wicket 6, making each request take twice as long as necessary:&lt;/p&gt;

&lt;p&gt;I&apos;ve crafted 4 quickstarts: 1.3.7, 1.4.22, 1.5.10 and 6.8.0, each running on 8083, 8084, 8085 and 8086 respectively. Each HomePage class has been modified to include the following onDetach handler:&lt;/p&gt;

&lt;p&gt;	@Override&lt;br/&gt;
	protected void onDetach() &lt;/p&gt;
{
		super.onDetach();
		Duration.seconds(10).sleep();
	}


&lt;p&gt;Wicket 1.3:&lt;br/&gt;
time curl &lt;a href=&quot;http://localhost:8083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8083&lt;/a&gt; -o /dev/null -s&lt;/p&gt;

&lt;p&gt;real	0m10.021s&lt;br/&gt;
user	0m0.009s&lt;br/&gt;
sys	0m0.007s&lt;/p&gt;

&lt;p&gt;Wicket 1.4:&lt;/p&gt;

&lt;p&gt;time curl &lt;a href=&quot;http://localhost:8084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8084&lt;/a&gt; -o /dev/null -s&lt;/p&gt;

&lt;p&gt;real	0m10.221s&lt;br/&gt;
user	0m0.008s&lt;br/&gt;
sys	0m0.006s&lt;/p&gt;

&lt;p&gt;Wicket 1.5:&lt;/p&gt;

&lt;p&gt;time curl &lt;a href=&quot;http://localhost:8085&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8085&lt;/a&gt; -o /dev/null -s&lt;/p&gt;

&lt;p&gt;real	0m20.330s&lt;br/&gt;
user	0m0.007s&lt;br/&gt;
sys	0m0.007s&lt;/p&gt;

&lt;p&gt;Wicket 6.8:&lt;/p&gt;

&lt;p&gt;time curl &lt;a href=&quot;http://localhost:8086&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8086&lt;/a&gt; -o /dev/null -s&lt;/p&gt;

&lt;p&gt;real	0m20.282s&lt;br/&gt;
user	0m0.008s&lt;br/&gt;
sys	0m0.007s&lt;/p&gt;

&lt;p&gt;According to me this is completely wrong. There are two issues at hand:&lt;/p&gt;

&lt;p&gt;1. the response is only written to the client after detach&lt;br/&gt;
2. since wicket 1.5 the detach is performed twice&lt;/p&gt;

&lt;p&gt;1. is easily fixable by flushing the response prior to detaching, giving instant performance boosts to all users of Wicket&lt;/p&gt;

&lt;p&gt;this doesn&apos;t fix the reported times by curl, but will enable browsers to start processing the markup (and close the connection on their end).&lt;/p&gt;

&lt;p&gt;2. I don&apos;t know yet (haven&apos;t debugged that part)&lt;/p&gt;</comment>
                            <comment id="13692896" author="mgrigorov" created="Tue, 25 Jun 2013 09:50:09 +0000"  >&lt;p&gt;According 2) see:&lt;br/&gt;
*) &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-4012&quot; title=&quot;Component&amp;#39;s onAfterRender() is called so many times as it is depth in the component tree + 1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-4012&quot;&gt;&lt;del&gt;WICKET-4012&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
*) &lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-84&quot; title=&quot;detach is called twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-84&quot;&gt;&lt;del&gt;WICKET-84&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
*) &lt;a href=&quot;http://markmail.org/thread/x7744zsbi7jsddqw&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/thread/x7744zsbi7jsddqw&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13920962" author="mgrigorov" created="Wed, 5 Mar 2014 15:33:14 +0000"  >&lt;p&gt;When someone starts working on this task (s)he may also take a look at the strange synchronization on a field that is re-assigned in the synchronization block: &lt;a href=&quot;https://github.com/apache/wicket/blob/master/wicket-core/src/main/java/org/apache/wicket/protocol/http/AbstractRequestLogger.java?source=c#L458&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/blob/master/wicket-core/src/main/java/org/apache/wicket/protocol/http/AbstractRequestLogger.java?source=c#L458&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13934827" author="mgrigorov" created="Fri, 14 Mar 2014 09:55:18 +0000"  >&lt;p&gt;branch &apos;5241-request-logger-duration&apos; &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; contains possible fixes for the problems identified above.&lt;br/&gt;
Please review/test it. &lt;/p&gt;

&lt;p&gt;1. &lt;a href=&quot;https://github.com/apache/wicket/compare/wicket-6.x...5241-request-logger-duration&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/wicket/compare/wicket-6.x...5241-request-logger-duration&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14042094" author="mgrigorov" created="Tue, 24 Jun 2014 13:25:19 +0000"  >&lt;p&gt;The suggested changes from branch &apos;5241-request-logger-duration&apos; are applied.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>333989</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 21 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lm4n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334315</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>