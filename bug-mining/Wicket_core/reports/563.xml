<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:20:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-4500] InterceptData never cleared from session after continueToOriginalDestination is called</title>
                <link>https://issues.apache.org/jira/browse/WICKET-4500</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;We have a scenario where single person can log in under different accounts on the same website. Different user types will typically go to different page types.&lt;/p&gt;

&lt;p&gt;A single person using different accounts is not normally required but we are demonstrating to corporate clients how the system will be used by different user types. In the demonstration we need to log in as an &apos;admin&apos; user to demo the admin aspects and then we need to log in as a &apos;standard&apos; user to demonstrate the aspects that will apply to a standard user.&lt;/p&gt;

&lt;p&gt;The admin page uses RedirectToInterceptException to authentication page if no one is logged in.&lt;/p&gt;

&lt;p&gt;The standard page uses the home page to authenticate and throws new RestartResponseException(new AuthenticatePage(parameters)) if no one is authenticated (i.e. no intercept)&lt;/p&gt;

&lt;p&gt;After authentication we either continue or go to the &apos;default&apos; page for a standard user.&lt;/p&gt;



&lt;p&gt;Code looks like this:&lt;/p&gt;



&lt;p&gt;                        If ( authenicationSucceeded )&lt;/p&gt;

&lt;p&gt;                        {&lt;/p&gt;

&lt;p&gt;                                    if ( !continueToOriginalDestination() )&lt;/p&gt;

                                    {

                                                // Was not redirected to this authentication page so go to default destination for the home page

                                                // Find default page for standard users and go to that page

                                    }

&lt;p&gt;                        }&lt;/p&gt;



&lt;p&gt;What we find is that after an admin log on (with intercept/continue sequence) a subsequent standard user log on will not execute the above body because continueToOriginalDestination returns &apos;true&apos; even though this page was not an intercept page. &lt;/p&gt;

&lt;p&gt;It looks like after an intercept/continue has occurred it does not clear the &apos;original destination&apos; attribute and so a subsequent call to continueToOriginalDestination will return true when it should really return false.&lt;/p&gt;

&lt;p&gt;The quickstarts demonstrates the problem:&lt;/p&gt;

&lt;p&gt;Point browser to localhost/app/landing&lt;/p&gt;

&lt;p&gt;Click &apos;logon&apos;&lt;br/&gt;
Click &apos;Click to continue&apos; - each time you click continueToOriginalDestination is called which successfully does a continue as evidenced by the page counter incrementing. &lt;/p&gt;

&lt;p&gt;If running in a debugger set a break point on RestartResponseAtInterceptPageException.InterceptData.clear().&lt;br/&gt;
Restart the app and then click on &apos;logon&apos; and you will never see the clear method executed.&lt;/p&gt;
</description>
                <environment>Tomcat 6.0.29&lt;br/&gt;
Linux or Windows (happens on both)</environment>
        <key id="12551041">WICKET-4500</key>
            <summary>InterceptData never cleared from session after continueToOriginalDestination is called</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="chrisc">Chris Colman</reporter>
                        <labels>
                            <label>wicket</label>
                    </labels>
                <created>Mon, 16 Apr 2012 11:30:18 +0000</created>
                <updated>Tue, 12 Jun 2012 08:05:06 +0000</updated>
                            <resolved>Tue, 17 Apr 2012 13:29:19 +0000</resolved>
                                    <version>1.5.5</version>
                    <version>1.5.6</version>
                                    <fixVersion>1.5.6</fixVersion>
                    <fixVersion>6.0.0-beta2</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13255157" author="chrisc" created="Mon, 16 Apr 2012 22:58:01 +0000"  >&lt;p&gt;I forgot to add this comment:&lt;/p&gt;

&lt;p&gt;The problem occurs even with only a single user logon but it doesn&apos;t usually get noticed in that scenario but I can think of situations in which it could cause a problem. The InterceptData.clear never gets called in the simple process of the Admin user going to admin page getting redirected and then &apos;continued&apos; after authentication.&lt;/p&gt;

&lt;p&gt;What is the mechanism by which the clear method gets called anyway? A static IRequestMapper is created but I can&apos;t see where it&apos;s ever referenced or used anywhere else in the code. Should it be mounted somewhere for it to work properly?&lt;/p&gt;</comment>
                            <comment id="13255190" author="chrisc" created="Mon, 16 Apr 2012 23:50:06 +0000"  >&lt;p&gt;I thought there might be a workaround for this problem while waiting for the fix but the InterceptData.clear method is not accessible as it&apos;s an inner class. I have no way of explicitly clearing the InterceptData so it&apos;s a bit of a show stopper for me at the moment.&lt;/p&gt;</comment>
                            <comment id="13293401" author="chrisc" created="Tue, 12 Jun 2012 07:07:53 +0000"  >&lt;p&gt;The above fix is great but we&apos;ve run into another problem. If an admin user attempts to go to a restricted page and gets redirected via a RedirectToInterceptException but then decides not to log on but then goes to the normal home page authentication and then successfully logs on as a standard user that authentication will redirect to where the admin initially wanted to go to - because they never authenticated as admin continueToOriginalDestination was never called and so Wicket still thinks that when continueToOriginalDestination is called after the standard user&apos;s authentication that it needs to redirect to the original admin page... fun!&lt;/p&gt;

&lt;p&gt;Would it be possible to introduce an explicit &apos;clearRedirect&apos; method so that when the home page does a  RestartResponseException to redirect to the standard user authentication page it can, at the same time, do a &apos;clearRedirect&apos; so that a subsequent call to continueToOriginalDestination does not attempt to go to the admin page.&lt;/p&gt;

&lt;p&gt;I can&apos;t remove the continueToOriginalDestination from the standard user authentication page because it is still required to perform a continue when it was reached by a RedirectToIntercepException from restricted pages other than the home page.&lt;/p&gt;</comment>
                            <comment id="13293404" author="mgrigorov" created="Tue, 12 Jun 2012 07:17:55 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Please copy the comment above to a new ticket so we can track it separately.&lt;/p&gt;

&lt;p&gt;Don&apos;t you use the same approach to redirect for both types of users ? &lt;br/&gt;
I mean if you use RestartResponseAtInterceptPageException in both cases then the second call should override the stored data from the first call and all should be fine.&lt;/p&gt;</comment>
                            <comment id="13293429" author="chrisc" created="Tue, 12 Jun 2012 08:05:06 +0000"  >&lt;p&gt;I want slightly different behavior for both:&lt;/p&gt;

&lt;p&gt;The standard user&apos;s experience is very &apos;guided&apos; and &apos;directed&apos; by the system to avoid them ending up confused.&lt;/p&gt;

&lt;p&gt;When a standard user goes to home page they actually see the authenticate page. After authentication, if there was no previous intercept exception the authenticate page can determine the most appropriate place to send the standard user. If we had used RestartResponseAtInterceptPageException from the home page to the authentication page then the standard user will always end up at the home page after continueToOriginalDestination.&lt;/p&gt;

&lt;p&gt;The admin users are more tech savvy and so can request a particular url, get redirected to authenticate page if necessary, and then return to the page &lt;b&gt;they&lt;/b&gt; desired.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12522763" name="continueDestinationNotCleared.zip" size="26359" author="chrisc" created="Mon, 16 Apr 2012 11:30:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>235905</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0k8pz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>116230</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>