<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 22:25:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[WICKET-6339] Wrong implementation of MarkupFragment.iterator()</title>
                <link>https://issues.apache.org/jira/browse/WICKET-6339</link>
                <project id="12310561" key="WICKET">Wicket</project>
                    <description>&lt;p&gt;The method returns &lt;tt&gt;getRootMarkup().iterator(startIndex, size)&lt;/tt&gt;, but this only works when &lt;tt&gt;getRootMarkup() == getParentMarkup()&lt;/tt&gt; or all intermediate {{MarkupFragment}}s start at index 0.&lt;/p&gt;

&lt;p&gt;The &lt;tt&gt;startIndex&lt;/tt&gt; of all intermediate {{MarkupFragment}}s must be added, otherwise the iterator starts at a wrong index.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13050580">WICKET-6339</key>
            <summary>Wrong implementation of MarkupFragment.iterator()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mgrigorov">Martin Tzvetanov Grigorov</assignee>
                                    <reporter username="svenackermann">Sven Ackermann</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Mar 2017 14:51:20 +0000</created>
                <updated>Fri, 13 Oct 2017 08:31:03 +0000</updated>
                            <resolved>Wed, 3 May 2017 20:47:50 +0000</resolved>
                                    <version>7.2.0</version>
                                    <fixVersion>7.7.0</fixVersion>
                    <fixVersion>8.0.0-M6</fixVersion>
                                    <component>wicket</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15907601" author="mgrigorov" created="Mon, 13 Mar 2017 14:55:24 +0000"  >&lt;p&gt;Could you please provide a quickstart or test case that demonstrates the issue ?&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="15938670" author="mgrigorov" created="Thu, 23 Mar 2017 16:13:06 +0000"  >&lt;p&gt;Ping!&lt;/p&gt;</comment>
                            <comment id="15938690" author="svenackermann" created="Thu, 23 Mar 2017 16:22:06 +0000"  >&lt;p&gt;Sorry, I do not have enough time at the moment to provide a test case. Our setup is quite complex for this and I&apos;m not allowed to provide you with our code.&lt;/p&gt;

&lt;p&gt;The problem is actually very obvious. If I have a situation like this:&lt;br/&gt;
RootMarkup&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;MarkupFragment 1 (startIndex=2, size=10)
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;MarkupFragment 2 (startIndex=3, size=5)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;then for MarkupFragment 2 the iterator will start at root index 2, but should start at 5 (startIndex of its parent MarkupFragment 1 must be added).&lt;/p&gt;</comment>
                            <comment id="15940067" author="mgrigorov" created="Fri, 24 Mar 2017 09:46:38 +0000"  >&lt;p&gt;I&apos;m afraid we will need a test case.&lt;br/&gt;
This code is in use since a very long time. Last time it has been touched was March 20 2011.&lt;br/&gt;
It should have failed for many applications ...&lt;/p&gt;</comment>
                            <comment id="15940238" author="svenackermann" created="Fri, 24 Mar 2017 12:29:52 +0000"  >&lt;p&gt;OK, then I will try to provide a simple test case when I find some time. Can you just keep this open until then?&lt;/p&gt;</comment>
                            <comment id="15940257" author="mgrigorov" created="Fri, 24 Mar 2017 12:49:25 +0000"  >&lt;p&gt;Sure! No problem!&lt;br/&gt;
We will ping you in few weeks!&lt;br/&gt;
Thank you!&lt;/p&gt;</comment>
                            <comment id="15961337" author="mgrigorov" created="Fri, 7 Apr 2017 19:44:46 +0000"  >&lt;p&gt;Friendly ping! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15964055" author="svenackermann" created="Tue, 11 Apr 2017 09:18:05 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I tried to build a test case based on our setup, but this would get too complex. So I created a very simple test to illustrate the problem:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testSimple() {
	&lt;span class=&quot;code-comment&quot;&gt;// application needed
&lt;/span&gt;	&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; WicketTester();

	&lt;span class=&quot;code-comment&quot;&gt;// test markup
&lt;/span&gt;	Markup markup = Markup.of(&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;lt;html&amp;gt;&amp;lt;body&amp;gt;&amp;lt;wicket:panel&amp;gt;&amp;lt;wicket:container wicket:id=&lt;span class=&quot;code-quote&quot;&gt;&apos;content&apos;&lt;/span&gt;&amp;gt;&amp;lt;a wicket:id=&lt;span class=&quot;code-quote&quot;&gt;&apos;link&apos;&lt;/span&gt; href=&lt;span class=&quot;code-quote&quot;&gt;&apos;https:&lt;span class=&quot;code-comment&quot;&gt;//www.google.de&apos;&lt;/span&gt;&amp;gt;Test&amp;lt;/a&amp;gt;&amp;lt;/wicket:container&amp;gt;&amp;lt;/wicket:panel&amp;gt;&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;&quot;&lt;/span&gt;);
&lt;/span&gt;
	IMarkupFragment firstLevelfragment = markup.find(&lt;span class=&quot;code-quote&quot;&gt;&quot;content&quot;&lt;/span&gt;);
	&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(firstLevelfragment + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; + firstLevelfragment.size());

	&lt;span class=&quot;code-comment&quot;&gt;// construct a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; fragment &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the link-Tag as sub-fragment of firstLevelfragment
&lt;/span&gt;	MarkupFragment secondLevelFragment = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MarkupFragment(firstLevelfragment, 1);
	&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(secondLevelFragment + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; + secondLevelFragment.size());

	List&amp;lt;MarkupElement&amp;gt; iteratorElements = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;(secondLevelFragment.size());
	&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (MarkupElement markupElement : secondLevelFragment) {
		iteratorElements.add(markupElement);
	}
	List&amp;lt;MarkupElement&amp;gt; getElements = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;(secondLevelFragment.size());
	&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; secondLevelFragment.size(); i++) {
		getElements.add(secondLevelFragment.get(i));
	}

	&lt;span class=&quot;code-comment&quot;&gt;// elements from iterator should match the ones from the get(i) method
&lt;/span&gt;	assertEquals(getElements, iteratorElements);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As I mentioned, we have a very special usecase where we use some Wicket APIs that are not commonly used. We also have a workaround (using &lt;tt&gt;MarkupFragment.get(int)&lt;/tt&gt; and &lt;tt&gt;MarkupFragment.size()&lt;/tt&gt; instead of &lt;tt&gt;MarkupFragment.iterator()&lt;/tt&gt;). I just wanted to tell you, that there might be sth. wrong in your code. If you think it&apos;s too risky to change sth. here, I can totally understand that.&lt;/p&gt;

&lt;p&gt;To describe our usecase a bit:&lt;br/&gt;
We have a special subclass of &lt;tt&gt;MarkupContainer&lt;/tt&gt; that loads its content from a CMS. Within that static content we look for all links and manipulate the markup in a way that these links are replaced with Wicket AjaxLinks to add some special handling (basically sth. like a confirmation &quot;Do you really want to click this link?&quot;). I know that our solution is maybe not the best way to do that, but there were some requirements to do it like this. In the setup we use the APIs of &lt;tt&gt;Markup&lt;/tt&gt;, &lt;tt&gt;IMarkupFragment&lt;/tt&gt;, &lt;tt&gt;AbstractMarkupParser&lt;/tt&gt;, &lt;tt&gt;AbstractMarkupFilter&lt;/tt&gt; and &lt;tt&gt;ComponentTag&lt;/tt&gt;.&lt;br/&gt;
If we use the &lt;tt&gt;MarkupFragment.iterator()&lt;/tt&gt; method, we get the following error which I debugged down to the described problem:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Tag expected&lt;br/&gt;
 MarkupStream: [markup = org.apache.wicket.util.resource.StringResourceStream@7ce97bef: &amp;lt;a href=&quot;https://www.google.de/&quot; target=&quot;_blank&quot;&amp;gt;Test&amp;lt;/a&amp;gt;&lt;/p&gt;

&lt;p&gt;	&amp;lt;wicket:container wicket:id=&quot;content&quot;&amp;gt;&amp;lt;a href=&quot;https://www.google.de/&quot; target=&quot;_blank&quot;&amp;gt;Test&amp;lt;/a&amp;gt;, index = 0, current = &lt;span class=&quot;error&quot;&gt;&amp;#91;Raw markup&amp;#93;&lt;/span&gt;]&lt;br/&gt;
	at org.apache.wicket.markup.MarkupStream.throwMarkupException(MarkupStream.java:526)&lt;br/&gt;
	at org.apache.wicket.markup.MarkupStream.getTag(MarkupStream.java:258)&lt;br/&gt;
	at org.apache.wicket.Component.internalRenderComponent(Component.java:2517)&lt;br/&gt;
	at org.apache.wicket.MarkupContainer.onRender(MarkupContainer.java:1698)&lt;br/&gt;
	at org.apache.wicket.Component.internalRender(Component.java:2380)&lt;br/&gt;
	at org.apache.wicket.Component.render(Component.java:2308)&lt;br/&gt;
	at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1524)&lt;br/&gt;
	at org.apache.wicket.MarkupContainer.renderAll(MarkupContainer.java:1759)&lt;br/&gt;
	at org.apache.wicket.MarkupContainer.renderComponentTagBody(MarkupContainer.java:1734)&lt;br/&gt;
	at org.apache.wicket.MarkupContainer.renderAssociatedMarkup(MarkupContainer.java:797)&lt;br/&gt;
	at org.apache.wicket.markup.html.panel.AssociatedMarkupSourcingStrategy.renderAssociatedMarkup(AssociatedMarkupSourcingStrategy.java:77)&lt;br/&gt;
	at org.apache.wicket.markup.html.panel.PanelMarkupSourcingStrategy.onComponentTagBody(PanelMarkupSourcingStrategy.java:112)&lt;br/&gt;
	at org.apache.wicket.Component.internalRenderComponent(Component.java:2565)&lt;br/&gt;
	at org.apache.wicket.MarkupContainer.onRender(MarkupContainer.java:1698)&lt;br/&gt;
	at org.apache.wicket.Component.internalRender(Component.java:2380)&lt;br/&gt;
	at org.apache.wicket.Component.render(Component.java:2308)&lt;br/&gt;
	at org.apache.wicket.MarkupContainer.renderNext(MarkupContainer.java:1524)&lt;br/&gt;
	at org.apache.wicket.MarkupContainer.renderAll(MarkupContainer.java:1759)&lt;br/&gt;
	at org.apache.wicket.Page.onRender(Page.java:879)&lt;br/&gt;
	at org.apache.wicket.markup.html.WebPage.onRender(WebPage.java:141)&lt;br/&gt;
	at org.apache.wicket.Component.internalRender(Component.java:2380)&lt;br/&gt;
	at org.apache.wicket.Component.render(Component.java:2308)&lt;br/&gt;
	at org.apache.wicket.Page.renderPage(Page.java:1018)&lt;br/&gt;
	at org.apache.wicket.request.handler.render.WebPageRenderer.renderPage(WebPageRenderer.java:124)&lt;br/&gt;
	at org.apache.wicket.request.handler.render.WebPageRenderer.respond(WebPageRenderer.java:236)&lt;br/&gt;
	at org.apache.wicket.util.tester.BaseWicketTester$LastPageRecordingPageRendererProvider$1.respond(BaseWicketTester.java:2747)&lt;br/&gt;
	at org.apache.wicket.core.request.handler.RenderPageRequestHandler.respond(RenderPageRequestHandler.java:175)&lt;br/&gt;
	at org.apache.wicket.request.cycle.RequestCycle$HandlerExecutor.respond(RequestCycle.java:895)&lt;br/&gt;
	at org.apache.wicket.request.RequestHandlerStack.execute(RequestHandlerStack.java:64)&lt;br/&gt;
	at org.apache.wicket.request.cycle.RequestCycle.execute(RequestCycle.java:265)&lt;br/&gt;
	at org.apache.wicket.request.cycle.RequestCycle.processRequest(RequestCycle.java:222)&lt;br/&gt;
	at org.apache.wicket.request.cycle.RequestCycle.processRequestAndDetach(RequestCycle.java:293)&lt;br/&gt;
	at org.apache.wicket.util.tester.BaseWicketTester.processRequest(BaseWicketTester.java:718)&lt;br/&gt;
	at org.apache.wicket.util.tester.BaseWicketTester.processRequest(BaseWicketTester.java:657)&lt;br/&gt;
	at org.apache.wicket.util.tester.BaseWicketTester.startPage(BaseWicketTester.java:887)&lt;br/&gt;
	at org.apache.wicket.util.tester.BaseWicketTester.startPage(BaseWicketTester.java:904)&lt;br/&gt;
	at org.apache.wicket.util.tester.BaseWicketTester.startComponentInPage(BaseWicketTester.java:1466)&lt;br/&gt;
	at org.apache.wicket.util.tester.BaseWicketTester.startComponentInPage(BaseWicketTester.java:1386)&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="15995637" author="jira-bot" created="Wed, 3 May 2017 20:46:17 +0000"  >&lt;p&gt;Commit fb0460b36bb72fff9f5008dd3d3fe5e8d666877b in wicket&apos;s branch refs/heads/wicket-7.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgrigorov&quot; class=&quot;user-hover&quot; rel=&quot;mgrigorov&quot;&gt;mgrigorov&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=fb0460b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=fb0460b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6339&quot; title=&quot;Wrong implementation of MarkupFragment.iterator()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6339&quot;&gt;&lt;del&gt;WICKET-6339&lt;/del&gt;&lt;/a&gt; Wrong implementation of MarkupFragment.iterator()&lt;/p&gt;</comment>
                            <comment id="15995640" author="jira-bot" created="Wed, 3 May 2017 20:46:37 +0000"  >&lt;p&gt;Commit c0cc33aaff140d4cff28d8e9e25199b4b129c51c in wicket&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mgrigorov&quot; class=&quot;user-hover&quot; rel=&quot;mgrigorov&quot;&gt;mgrigorov&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=c0cc33a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=wicket.git;h=c0cc33a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/WICKET-6339&quot; title=&quot;Wrong implementation of MarkupFragment.iterator()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;WICKET-6339&quot;&gt;&lt;del&gt;WICKET-6339&lt;/del&gt;&lt;/a&gt; Wrong implementation of MarkupFragment.iterator()&lt;/p&gt;</comment>
                            <comment id="15995645" author="mgrigorov" created="Wed, 3 May 2017 20:47:50 +0000"  >&lt;p&gt;Fixing the iterator doesn&apos;t break any Wicket tests!&lt;br/&gt;
My apps also work fine, but we don&apos;t do anything fancy with MarkupFragments ourselves.&lt;/p&gt;</comment>
                            <comment id="15995646" author="mgrigorov" created="Wed, 3 May 2017 20:48:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=svenackermann&quot; class=&quot;user-hover&quot; rel=&quot;svenackermann&quot;&gt;svenackermann&lt;/a&gt; Thank you for the report and the test case!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 28 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3bbp3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>