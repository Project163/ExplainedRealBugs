<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:47:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DBCP-291] setting maxWait does not work as expected</title>
                <link>https://issues.apache.org/jira/browse/DBCP-291</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;My expectation was that if maxWait is set to X seconds and there are N requests waiting to get a connection (in a case where the pool is bounded and &lt;br/&gt;
all the connection are used) if none of the used connection gets free than all N requests will time-out at the same time.&lt;br/&gt;
In reality it seems that 1 request will be timed-out after X seconds the second one after 2 * X and the last one after N * X.&lt;br/&gt;
The problem is that getPooledConnectionAndInfo is synchronized (and therefore will look all N requests) and only one request will be processed at the time.&lt;br/&gt;
This process includes waiting until freed connection or timed-out (done by commons.pool GenericKeyedObjectPool).&lt;br/&gt;
I am not sure why the getPooledConnectionAndInfo has to be synchronized and not only the pool creation part.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12382393">DBCP-291</key>
            <summary>setting maxWait does not work as expected</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="aozarov@hotmail.com">Arie</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Nov 2007 01:17:29 +0000</created>
                <updated>Mon, 15 Feb 2010 02:23:32 +0000</updated>
                            <resolved>Thu, 24 Dec 2009 20:13:51 +0000</resolved>
                                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12543460" author="psteitz" created="Mon, 19 Nov 2007 03:48:06 +0000"  >&lt;p&gt;Improving precision in per-thread timeouts will require more advanced scheduling than is currently available.  Best to wait for JDK source level 1.5.&lt;/p&gt;</comment>
                            <comment id="12543477" author="aozarov@hotmail.com" created="Mon, 19 Nov 2007 07:35:48 +0000"  >&lt;p&gt;Not sure what did you have in your mind but util.concurrent (if needed) is available as concurrent.util for JDK &amp;lt; 1.5&lt;/p&gt;</comment>
                            <comment id="12699932" author="jcbollinger" created="Thu, 16 Apr 2009 23:48:07 +0000"  >&lt;p&gt;I tested this against the dev code for 2.0 and 1.5, and both seem to behave as desired already.  If multiple threads invoke borrowObject() while the pool is exhausted, then each one waits approximately _maxWait milliseconds before failing with a NoSuchElementException.  If they all make their requests at approximately the same time, then the total time for all to finish waiting is also approximately _maxWait milliseconds (not N * _maxWait).&lt;/p&gt;

&lt;p&gt;It looks like this issue may have originally been filed against a different project that uses Pool.  If the problem persists there then it probably belongs to that project, not to Pool.&lt;/p&gt;</comment>
                            <comment id="12710234" author="markt" created="Sun, 17 May 2009 23:05:32 +0000"  >&lt;p&gt;A check of  DBCP confirms that getPooledConnectionAndInfo() is indeed a DBCP method so I have moved this issue to DBCP.&lt;/p&gt;</comment>
                            <comment id="12722379" author="markt" created="Sun, 21 Jun 2009 16:27:55 +0000"  >&lt;p&gt;Test case added and issue fixed. The fix will be in 1.3 onwards.&lt;/p&gt;</comment>
                            <comment id="12794277" author="psteitz" created="Wed, 23 Dec 2009 23:39:46 +0000"  >&lt;p&gt;We need to protect the userkeys map.  The uderlying LRUMap impl is not threadsafe.  I just got this:&lt;/p&gt;

&lt;p&gt; org.apache.commons.dbcp.SQLNestedException: Could not retrieve connection info from pool&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.SharedPoolDataSource.getPooledConnectionAndInfo(SharedPoolDataSource.java:183)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.InstanceKeyDataSource.getConnection(InstanceKeyDataSource.java:680)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.TestSharedPoolDataSource.getConnection(TestSharedPoolDataSource.java:49)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.TestConnectionPool.newConnection(TestConnectionPool.java:84)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.TestConnectionPool$TestThread.run(TestConnectionPool.java:595)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at java.lang.Thread.run(Thread.java:613)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; Caused by: java.lang.NullPointerException&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.SequencedHashMap.removeEntry(SequencedHashMap.java:217)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.SequencedHashMap.removeImpl(SequencedHashMap.java:471)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.SequencedHashMap.remove(SequencedHashMap.java:459)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.LRUMap.get(LRUMap.java:97)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.SharedPoolDataSource.getUserPassKey(SharedPoolDataSource.java:203)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;junit&amp;#93;&lt;/span&gt; 	at org.apache.commons.dbcp.datasources.SharedPoolDataSource.getPooledConnectionAndInfo(SharedPoolDataSource.java:172)&lt;/p&gt;

&lt;p&gt;The problem is (I think) caused by concurrent modification to the LRUMap.  The get method modifies the map.&lt;/p&gt;
</comment>
                            <comment id="12794489" author="psteitz" created="Thu, 24 Dec 2009 20:13:51 +0000"  >&lt;p&gt;Fixed threadsafety issue in r893809&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114568</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 48 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uvs7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178290</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>