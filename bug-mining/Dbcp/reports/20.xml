<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:46:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DBCP-221] How to close the connection pool without shutting down the JVM while there are connections being used?</title>
                <link>https://issues.apache.org/jira/browse/DBCP-221</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Suppose there are several connections being used now by different servlets. calling the basicDataSource,close() does not have any impact on the connection pool. I expect that after these servlet return the connections the pool should be shut down immediately. I also expect that any more requests to borrow connections from the pool should not be fulfilled. However, my experiment does not seem to support my expectations. Calling basicDataSource.close() seems to be ignored while there are connections being used.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12369064">DBCP-221</key>
            <summary>How to close the connection pool without shutting down the JVM while there are connections being used?</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dain">Dain Sundstrom</assignee>
                                    <reporter username="bliu">Bill Liu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 May 2007 00:04:41 +0000</created>
                <updated>Wed, 25 Jan 2012 14:19:24 +0000</updated>
                            <resolved>Mon, 23 Jul 2007 22:29:42 +0000</resolved>
                                    <version>1.2.2</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12494956" author="psteitz" created="Fri, 11 May 2007 04:57:13 +0000"  >&lt;p&gt;Behavior here is determined by the underlying pool.  In the case of commons pool&apos;s GenericObjectPool, which BasicDataSource uses, the close method only closes &lt;b&gt;idle&lt;/b&gt; connections in the pool.  The BasicDataSource Javadoc should be improved to make it clear that only idle connections are closed when close is invoked on the BasicDataSource.&lt;/p&gt;</comment>
                            <comment id="12495092" author="bliu" created="Fri, 11 May 2007 16:39:46 +0000"  >&lt;p&gt;Thanks Phil.&lt;/p&gt;

&lt;p&gt;So what is the appropriate way to shut down (forcefully) a connection pool, assuming we have a serious db issue?&lt;/p&gt;</comment>
                            <comment id="12514804" author="dain" created="Mon, 23 Jul 2007 22:29:42 +0000"  >&lt;p&gt;BasicDataSource.close() now permanently marks the data source as closed.  No new connections can be obtained from a closed data source.  At close all idle connections are destroyed and the method returns.  As existing active connections are closed, they are destroyed.&lt;/p&gt;</comment>
                            <comment id="12768151" author="roshang" created="Wed, 21 Oct 2009 09:41:48 +0000"  >&lt;p&gt;I agree with the change of behaviour of close() so that its permanently closed. &lt;/p&gt;

&lt;p&gt;However we relied on the current behaviour as a way of restarting the Connection Pool after changing its properties without a full JVM restart. (e.g. change the Database URL). I agree this is a hack and there is no guarantee it will continue to work. &lt;/p&gt;

&lt;p&gt;But I think you might agree, is a useful feature to have. Looking at the source code, I spotted a restart() method which is currently private and not used, which just calls close(). &lt;/p&gt;

&lt;p&gt;Will it make sense to expose this method and have an overloaded method close(boolean permanent) which controls if its a permanent close or not. &lt;/p&gt;

&lt;p&gt;If you agree, I am happy to submit a patch. &lt;/p&gt;








</comment>
                            <comment id="12768637" author="psteitz" created="Thu, 22 Oct 2009 10:43:26 +0000"  >&lt;p&gt;The problem with supporting restart is that you either have to force close the connections that are checked out to clients (not generally a happy scenario) or you no longer have a uniform pool of connections.  Deciding how to handle the latter problem from the pool&apos;s perspective is probably what stalled the implementation of &quot;restart&quot;.  If you have ideas about how to implement this without adding too much complexity for the user or dbcp iteslf, we should discuss them on the dev list.&lt;/p&gt;</comment>
                            <comment id="13192968" author="metatech" created="Wed, 25 Jan 2012 10:18:49 +0000"  >&lt;p&gt;If you wish to terminate active connections as well, you can try the following code.  &lt;br/&gt;
Note : the BasicDataSource must be created with the property &quot;removeAbandoned&quot; set to true.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ds.setRemoveAbandonedTimeout(1);
ds.setMaxActive(1);
Connection conn = ds.getConnection();
ds.close();
conn.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, with the Oracle JDBC driver, the code can fail when the active connection waits for a database lock, because of a Java lock in the JDBC driver. &lt;/p&gt;</comment>
                            <comment id="13193053" author="metatech" created="Wed, 25 Jan 2012 14:19:24 +0000"  >&lt;p&gt;The &quot;lock&quot; problem happens because the cancel() must first be called on java.sql.Statement being executed (which is allowed to be called from another thread).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114501</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 43 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uvxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178315</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>