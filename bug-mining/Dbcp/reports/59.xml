<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:47:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DBCP-265] Connection close handling DatabaseMetaData exceed max open cursor oracle</title>
                <link>https://issues.apache.org/jira/browse/DBCP-265</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;i was suprised by following behavior:&lt;br/&gt;
/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Here all is OK, the finally block closes the connection and implicit the statement and the resultset. If called repeatedly, only one cursor is used.&lt;/li&gt;
	&lt;li&gt;@throws SQLException&lt;br/&gt;
*/&lt;br/&gt;
public void test2() throws SQLException{&lt;br/&gt;
Connection con = null;&lt;br/&gt;
try{&lt;br/&gt;
con = dataSource.getConnection();&lt;br/&gt;
Statement statement = con.createStatement();&lt;br/&gt;
ResultSet resultSet = statement.executeQuery(&quot;select * from MyTable&quot;);&lt;br/&gt;
if(resultSet.next())&lt;br/&gt;
resultSet.getString(1);&lt;br/&gt;
}finally {&lt;br/&gt;
if (con != null) {&lt;br/&gt;
con.close();&lt;br/&gt;
}&lt;br/&gt;
}&lt;br/&gt;
}&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;But doing this repeatedly&lt;br/&gt;
/**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Danger: exceeds max open cursors if called repeatedly.&lt;/li&gt;
	&lt;li&gt;@throws SQLException&lt;br/&gt;
*/&lt;br/&gt;
public void test1() throws SQLException{&lt;br/&gt;
Connection con = null;&lt;br/&gt;
try{&lt;br/&gt;
con = dataSource.getConnection();&lt;br/&gt;
DatabaseMetaData metaData = con.getMetaData();&lt;br/&gt;
ResultSet schemas = metaData.getSchemas();&lt;br/&gt;
}finally {&lt;br/&gt;
if (con != null) {&lt;br/&gt;
con.close();&lt;br/&gt;
}&lt;br/&gt;
}&lt;br/&gt;
}&lt;br/&gt;
exceeds max open cursors on the database.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;DataSource created with following block:&lt;br/&gt;
		dataSource = new BasicDataSource();&lt;br/&gt;
		dataSource.setDriverClassName(&quot;oracle.jdbc.OracleDriver&quot;);&lt;br/&gt;
		dataSource.setUsername(&quot;myuser&quot;);&lt;br/&gt;
		dataSource.setPassword(&quot;mypasswd&quot;);&lt;br/&gt;
		dataSource.setUrl(&quot;jdbc:oracle:thin:@192.168.0.1:1521:mydb&quot;);&lt;/p&gt;


&lt;p&gt;Of course, explicit closing the &apos;schemas&apos; ResultSet in the second case solves the problem.&lt;/p&gt;

&lt;p&gt;I am not certainly sure my expected behavior is conform to the jdbc spec. But without using the BasicDatasource this problem doesnt occure.&lt;/p&gt;

&lt;p&gt;I inspected the code and saw, that org.apache.commons.dbcp.BasicDataSource (or more specific, DelegatingConnection) doesnt track Connections and ResultSets created from DatabaseMetadata-Object.Only created Statements form DelegatingConnection are tracked. And in PoolableConnectionFactory.passivateObject() only these statements are closed and warnings are cleared on the underlying connection.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows/Unix, Oracle 10gR2, JDK 1.4, Oracle JDBC Driver 10.2.0.1. &lt;/p&gt;</environment>
        <key id="12393376">DBCP-265</key>
            <summary>Connection close handling DatabaseMetaData exceed max open cursor oracle</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pd">pd</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Apr 2008 08:20:32 +0000</created>
                <updated>Mon, 15 Feb 2010 02:38:12 +0000</updated>
                            <resolved>Sun, 22 Feb 2009 16:39:29 +0000</resolved>
                                    <version>1.2.1</version>
                    <version>1.2.2</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12592616" author="bayard" created="Sun, 27 Apr 2008 01:36:18 +0000"  >&lt;p&gt;Sounds like we need a DelegatingMetaData. &lt;/p&gt;</comment>
                            <comment id="12675670" author="markt" created="Sun, 22 Feb 2009 16:39:29 +0000"  >&lt;p&gt;This has been fixed in svn and will be included in 1.3 onwards&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114543</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 39 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uvu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178299</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>