<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:48:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DBCP-398] DBCP hangs on common pool borrowObject when PoolableConnection is used and the underlying connection closed unexpectedly (connection resets/timouts)</title>
                <link>https://issues.apache.org/jira/browse/DBCP-398</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The bug is in org.apache.commons.dbcp.PoolableConnection as isClosed method on this calls super.isClosed which returns true (as DelegatingConnection::isClosed &lt;/p&gt;
{ _closed || _conn.isClosed() }
&lt;p&gt;). Since PoolableConnection needs to release objects to pool even if the underlying connection is closed the isClosed method should be overridden in this class and should return _closed. This _closed is the delegating connection close which will be set to false even if the underlying connection is closed (_conn.isClosed). The fix should also not throw on PoolableConnection::Close method if underlying connection is closed as this state is a valid state and is expected.&lt;/p&gt;

&lt;p&gt;Also currently the way it stands the clients of PoolableConnection will/may not call Close() as isClosed always returns true in this case.&lt;/p&gt;

&lt;p&gt;Below is the stack that the thread hangs on:&lt;/p&gt;

&lt;p&gt;&#9726;waiting on &amp;lt;0x00000007b5a50e48&amp;gt; (a org.apache.commons.pool.impl.GenericObjectPool$Latch)&lt;br/&gt;
 at java.lang.Object.wait(Object.java:503)&lt;br/&gt;
 at org.apache.commons.pool.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:1104)&lt;br/&gt;
&#9726;locked &amp;lt;0x00000007b5a50e48&amp;gt; (a org.apache.commons.pool.impl.GenericObjectPool$Latch)&lt;br/&gt;
 at org.apache.commons.dbcp.PoolingDataSource.getConnection(PoolingDataSource.java:106)&lt;br/&gt;
 at org.datanucleus.store.rdbms.ConnectionProviderPriorityList.getConnection(ConnectionProviderPriorityList.java:57)&lt;br/&gt;
 at org.datanucleus.store.rdbms.ConnectionFactoryImpl$ManagedConnectionImpl.getConnection(ConnectionFactoryImpl.java:354)&lt;br/&gt;
 at org.datanucleus.store.rdbms.ConnectionFactoryImpl$ManagedConnectionImpl.getXAResource(ConnectionFactoryImpl.java:314)&lt;br/&gt;
 at org.datanucleus.store.connection.ConnectionManagerImpl.enlistResource(ConnectionManagerImpl.java:386)&lt;br/&gt;
 at org.datanucleus.store.connection.ConnectionManagerImpl.allocateConnection(ConnectionManagerImpl.java:252)&lt;br/&gt;
 at org.datanucleus.store.connection.AbstractConnectionFactory.getConnection(AbstractConnectionFactory.java:60)&lt;br/&gt;
 at org.datanucleus.store.AbstractStoreManager.getConnection(AbstractStoreManager.java:449)&lt;br/&gt;
 at org.datanucleus.store.AbstractStoreManager.getConnection(AbstractStoreManager.java:418)&lt;br/&gt;
 at org.datanucleus.store.rdbms.query.JDOQLQuery.performExecute(JDOQLQuery.java:595)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12648699">DBCP-398</key>
            <summary>DBCP hangs on common pool borrowObject when PoolableConnection is used and the underlying connection closed unexpectedly (connection resets/timouts)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sarvesh.sn">Sarvesh Sakalanaga</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 May 2013 19:59:58 +0000</created>
                <updated>Sat, 11 Apr 2015 04:25:50 +0000</updated>
                            <resolved>Mon, 3 Feb 2014 21:27:52 +0000</resolved>
                                    <version>1.2</version>
                    <version>1.3</version>
                    <version>1.4</version>
                    <version>2.0</version>
                                                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="13664140" author="garydgregory" created="Wed, 22 May 2013 14:27:24 +0000"  >&lt;p&gt;Can you provide a unit test that exhibits this behavior?&lt;/p&gt;</comment>
                            <comment id="13664216" author="garydgregory" created="Wed, 22 May 2013 16:08:40 +0000"  >&lt;p&gt;What version are you using?&lt;/p&gt;</comment>
                            <comment id="13664249" author="sarvesh.sn" created="Wed, 22 May 2013 16:52:41 +0000"  >&lt;p&gt;Version 1.4&lt;/p&gt;</comment>
                            <comment id="13664259" author="sarvesh.sn" created="Wed, 22 May 2013 17:05:16 +0000"  >&lt;p&gt;Unfortunately it&#8217;s not that easy to write a unit test that can do this. If you are using sql server and Data nucleus as your ORM (or any client that uses PoolableConnection) then you can do something like this to repro the bug.&lt;/p&gt;

&lt;p&gt;1) Take table exclusive connection lock&lt;/p&gt;

&lt;p&gt;SET TRANSACTION ISOLATION LEVEL SERIALIZABLE&lt;br/&gt;
GO&lt;br/&gt;
BEGIN TRANSACTION&lt;br/&gt;
UPDATE sds&lt;br/&gt;
SET CD_ID = CD_ID&lt;br/&gt;
WAITFOR DELAY &apos;00:06:00&apos;  &amp;#8211; 6 minutes   hh:mm:ss&lt;br/&gt;
ROLLBACK TRANSACTION&lt;br/&gt;
GO&lt;/p&gt;

&lt;p&gt;2) Connect to the server using the client that used PoolableConnection&lt;br/&gt;
3) You should see the connections when you do : SELECT * FROM sys.dm_exec_sessions&lt;br/&gt;
4) Execute some query on the table. EG: Select * from sds;&lt;br/&gt;
5) Execute &quot;Kill XXX&quot; (replace XXX with spid) to kill the connections. This should close the underlyingconnection but the PoolableConnection will not be closed.&lt;br/&gt;
6) Call IsClosed on PoolableConnection. (BUG as it returns true);&lt;br/&gt;
7) Since IsClosed returns true the client will never call Close and the object is not release to pool.&lt;/p&gt;

&lt;p&gt;Hope this helps!&lt;/p&gt;</comment>
                            <comment id="13664292" author="garydgregory" created="Wed, 22 May 2013 17:30:08 +0000"  >&lt;p&gt;A seemingly simple change like replacing &lt;tt&gt;isClosed()&lt;/tt&gt; an implementation like: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isClosed() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; _conn == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; : _conn.isClosed();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;causes a lot of unit tests to fail.&lt;/p&gt;

&lt;p&gt;You can get the code from &lt;a href=&quot;https://svn.apache.org/repos/asf/commons/proper/dbcp/branches/DBCP_1_4_x_BRANCH&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/commons/proper/dbcp/branches/DBCP_1_4_x_BRANCH&lt;/a&gt; and try it yourself.&lt;/p&gt;

&lt;p&gt;You can then provide a patch. You use an local Java database like H2 or HyperSQL for your unit tests.&lt;/p&gt;

&lt;p&gt;The next release would be 1.4.1, which we could push out ASAP since there are other fixes ready.&lt;/p&gt;
</comment>
                            <comment id="13664345" author="sarvesh.sn" created="Wed, 22 May 2013 18:00:45 +0000"  >&lt;p&gt;Here is the patch. Unit tests are passing on my system and I have also verified that the problem does not repro after this fix. &lt;/p&gt;</comment>
                            <comment id="13664658" author="garydgregory" created="Wed, 22 May 2013 23:13:57 +0000"  >&lt;p&gt;I confirm that the patch applies cleanly and does not cause the tests to fail.&lt;/p&gt;

&lt;p&gt;Can someone else review the patch to confirm that we are OK with the changes in behavior?&lt;/p&gt;

&lt;p&gt;Tested with Revision: 1485419&lt;br/&gt;
Apache Maven 3.0.5 (r01de14724cdef164cd33c7c8c2fe155faf9602da; 2013-02-19 08:51:28-0500)&lt;br/&gt;
Maven home: C:\Java\apache-maven-3.0.5\bin\..&lt;br/&gt;
Java version: 1.7.0_21, vendor: Oracle Corporation&lt;br/&gt;
Java home: C:\Program Files\Java\jdk1.7.0_21\jre&lt;br/&gt;
Default locale: en_US, platform encoding: Cp1252&lt;br/&gt;
OS name: &quot;windows 7&quot;, version: &quot;6.1&quot;, arch: &quot;amd64&quot;, family: &quot;windows&quot;&lt;/p&gt;</comment>
                            <comment id="13664719" author="psteitz" created="Thu, 23 May 2013 00:04:16 +0000"  >&lt;p&gt;I will take a careful look in the next couple of days.  We should also develop unit tests illustrating the problem. I will think about it some more, but I am not sure I am OK with swallowing the exception when an underlying connection that has been closed without the knowledge of the pool is passivated.  I also need to do some detailed tracing to make sure the analysis above is correct.  Here again, unit tests are key to understanding.  The mock objects in src/test should be useful for this.&lt;/p&gt;</comment>
                            <comment id="13665381" author="psteitz" created="Thu, 23 May 2013 17:24:56 +0000"  >&lt;p&gt;I have a question for the OP.  Does your problem go away if you omit the exception suppression from the patch?  I am still working on tests / traces, but it looks to me like on the path indicated, the pooled connection should get invalidated, so there should be no premature pool starvation.  Is it possible that the client code is holding additional connection handles that get abandoned due to the exception not being handled?  Have you tried turning on abandoned connection tracking?  If pool counters are getting corrupted, this is a serious issue; if not, it really just impacts direct users of PoolableConnection.&lt;/p&gt;</comment>
                            <comment id="13665396" author="sarvesh.sn" created="Thu, 23 May 2013 17:39:38 +0000"  >&lt;p&gt;No the actual problem is with isClosed method. The client code is very simple. It first checks to see if the PoolableConnection is closed and if its closed it does not call close on it.&lt;br/&gt;
No I have not turned on abandoned connection tracking and AFAIK this impacts only  users of PoolableConnection.&lt;/p&gt;</comment>
                            <comment id="13665399" author="sarvesh.sn" created="Thu, 23 May 2013 17:41:16 +0000"  >&lt;p&gt;Here is the client code : &lt;a href=&quot;http://grepcode.com/file/repo1.maven.org/maven2/org.datanucleus/datanucleus-rdbms/2.0.4/org/datanucleus/store/rdbms/ConnectionFactoryImpl.java#ConnectionFactoryImpl.ManagedConnectionImpl.close%28%29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://grepcode.com/file/repo1.maven.org/maven2/org.datanucleus/datanucleus-rdbms/2.0.4/org/datanucleus/store/rdbms/ConnectionFactoryImpl.java#ConnectionFactoryImpl.ManagedConnectionImpl.close%28%29&lt;/a&gt; &lt;br/&gt;
Look at ManagedConnectionImpl::Close - Line 589&lt;/p&gt;</comment>
                            <comment id="13666376" author="psteitz" created="Fri, 24 May 2013 14:48:16 +0000"  >&lt;p&gt;Thanks, Sarvesh. Looking at the client code, I now understand what is going on. You are using isClosed() to decide whether or not to close (i.e. return to the pool) the PoolableConnection.  Sorry for being a little slow. I agree that the isClosed implementation in PoolableConnection is questionable, but it arguably conforms to the JDBC spec (closed means it can no longer be used to connect to the database) and I wonder what other client apps might break if we change it.  I am on the fence and would appreciate some more community input on whether or not we should make this change, which is a basically a change in the contract for PoolableConnection#isClosed.  It could be that it is best to make this change in 2.0 (which has the same behavior) or via a new method (see below).  Arguably, the client code should not be testing isClosed, but just invoking close directly.  As of 1.3/1.4, close is idempotent, so there is no risk of exception on multiple close.  In any case, once a connection has been returned to the pool, clients should discard references to it.&lt;/p&gt;

&lt;p&gt;What do others think about the proposed changes in behavior:&lt;/p&gt;

&lt;p&gt;(1) drop _con.isClosed() test from PoolableConnection#isClosed() (so &quot;closed&quot; really means &quot;has been returned to the pool&quot;) &lt;br/&gt;
(2) do not throw when a connection that has been closed without knowledge of the pool is closed.&lt;/p&gt;

&lt;p&gt;One more note on this. If we do decide to make change (1), it might be better to implement it in the PoolGuardConnectionWrapper, possibly even implementing a new method, isDiscarded() or somesuch to disambiguate isClosed.&lt;/p&gt;</comment>
                            <comment id="13666409" author="sarvesh.sn" created="Fri, 24 May 2013 16:04:49 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phil%40steitz.com&quot; class=&quot;user-hover&quot; rel=&quot;phil@steitz.com&quot;&gt;phil@steitz.com&lt;/a&gt; for diligence, lets wait for some community feedback. I am +1 for option 1) as I think IsClosed needs to be disambiguated.   &lt;/p&gt;</comment>
                            <comment id="13666463" author="garydgregory" created="Fri, 24 May 2013 17:03:18 +0000"  >&lt;p&gt;WRT (1), looking at the JDBC Javadoc:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Retrieves whether &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &amp;lt;code&amp;gt;Connection&amp;lt;/code&amp;gt; object has been
     * closed.  A connection is closed &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the method &amp;lt;code&amp;gt;close&amp;lt;/code&amp;gt;
     * has been called on it or &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; certain fatal errors have occurred.
     * This method is guaranteed to &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &amp;lt;code&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/code&amp;gt; only when
     * it is called after the method &amp;lt;code&amp;gt;Connection.close&amp;lt;/code&amp;gt; has
     * been called.
     * &amp;lt;P&amp;gt;
     * This method generally cannot be called to determine whether a
     * connection to a database is valid or invalid.  A typical client
     * can determine that a connection is invalid by catching any
     * exceptions that might be thrown when an operation is attempted.
     *
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &amp;lt;code&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/code&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &amp;lt;code&amp;gt;Connection&amp;lt;/code&amp;gt; object
     *         is closed; &amp;lt;code&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;lt;/code&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it is still open
     * @exception SQLException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; a database access error occurs
     */
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isClosed() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since we manage our own &apos;closed&apos; ivar, it seems valid to only look at its value for our implementation of &lt;tt&gt;isClosed&lt;/tt&gt;. This assumes that the ivar state is correct at all times.&lt;/p&gt;</comment>
                            <comment id="13666835" author="psteitz" created="Fri, 24 May 2013 23:41:44 +0000"  >&lt;p&gt;I am inclined to agree that having isClosed return true iff close has been called on the DelegatingConnection would be better. The spec allows what we do now, but especially the 4.0 version makes it clear that isClosed should mean the client has called close (so the &quot;or if certain fatal errors have occurred&quot; should really be dropped from above).  What I worry about is the impact on any apps that may depend on the current behavior.&lt;/p&gt;</comment>
                            <comment id="13709948" author="thomaslee" created="Tue, 16 Jul 2013 17:20:25 +0000"  >&lt;p&gt;We&apos;re getting bitten by this bug fairly frequently on a pre-production system. The proposed patch looks simple enough that I&apos;m thinking I may simply be able to extend PoolingDataSource &amp;amp; override the isClosed() method with the proposed implementation, but are there any other work-arounds we can try first?&lt;/p&gt;</comment>
                            <comment id="13709976" author="psteitz" created="Tue, 16 Jul 2013 17:43:06 +0000"  >&lt;p&gt;Consensus on the dev list &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; is that we should &lt;b&gt;not&lt;/b&gt; change the isClosed contract.  Client code should not test isClosed before returning a connection and should not rely on properties of the connection handle once a connection has been returned.  Javadoc will be updated, but we are not going to change the implementation.  The simple workaround is not to test isClosed before returning the connection to the pool.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://markmail.org/thread/qzevcticenh7cabx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/thread/qzevcticenh7cabx&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13710197" author="thomaslee" created="Tue, 16 Jul 2013 20:39:35 +0000"  >&lt;p&gt;So does that mean the check on line 77 in the current implementation of PoolableConnection is incorrect?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc/commons/proper/dbcp/trunk/src/java/org/apache/commons/dbcp2/PoolableConnection.java?view=markup&amp;amp;pathrev=1431684&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/commons/proper/dbcp/trunk/src/java/org/apache/commons/dbcp2/PoolableConnection.java?view=markup&amp;amp;pathrev=1431684&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Looks like it&apos;s doing the one work of returning the connection to the pool.&lt;/p&gt;

&lt;p&gt;For the record, we&apos;re using PoolingDataSource + QueryRunner from commons-dbutils. QueryRunner doesn&apos;t concern itself with pooling &amp;amp; instead relies on the underlying DataSource + Connection objects to borrow &amp;amp; return objects respectively. Here, I think that means PoolingDataSource + PoolableConnection:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;PoolingDataSource.getConnection() borrows the connection from the pool.&lt;/li&gt;
	&lt;li&gt;PoolableConnection.close() should then return the connection to the pool.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;How would we have PoolableConnection correctly return itself to the pool? Neither our code nor QueryRunner seems to make any attempt to explicitly return connections to the pool &amp;#8211; instead, both rely on the semantics of PoolableConnection.close() to return the connection to the pool.&lt;/p&gt;

&lt;p&gt;Entirely possible I&apos;m getting confused here, just trying to clarify &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13711783" author="psteitz" created="Wed, 17 Jul 2013 23:15:25 +0000"  >&lt;p&gt;Hi Tom,&lt;/p&gt;

&lt;p&gt;Thanks for having a look at the code. The code you reference is correct per the current (in need of better documentation) contract.  When a connection is returned by the client (by calling close on its handle), DBCP checks to make sure that the underlying physical connection has not been closed.  If that is the case, something bad has happened - i.e., the physical connection has been closed without the knowledge of the pool.  In that case, the wrapper object is &lt;b&gt;not&lt;/b&gt; returned to the pool, but rather destroyed and an exception is generated (so as not to silently ignore what could be an important infrastructure problem).&lt;/p&gt;

&lt;p&gt;If I understand your statements above about how you are using PoolingDataSource, it should work correctly just calling close() on connection handles, which really means &quot;return me to the pool.&quot;  In general, there is no need to test isClosed() before returning a connection to the pool and, per comments above, this is in general not a good thing to do.  Also, if connections being managed by the pool are being closed without the pool&apos;s involvement, the root cause of this infrastructure problem should be determined and resolved.&lt;/p&gt;</comment>
                            <comment id="13889938" author="markt" created="Mon, 3 Feb 2014 21:27:52 +0000"  >&lt;p&gt;It is worth noting that the behaviour has been modified slightly in 2.x to address &lt;a href=&quot;https://issues.apache.org/jira/browse/DBCP-391&quot; title=&quot;Close on invalid connections throws unexpected exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;DBCP-391&quot;&gt;&lt;del&gt;DBCP-391&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I have clarified the Javadoc for PoolableConnection#isClosed() in 2.x and 1.5.x.&lt;/p&gt;</comment>
                            <comment id="14487459" author="elyograg" created="Thu, 9 Apr 2015 14:55:03 +0000"  >&lt;p&gt;I seem to be having this problem, or at least one that&apos;s very similar, with DBCP 2.1.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;b&quot; prio=10 tid=0x00007fcc7450c800 nid=0x65e2 waiting on condition [0x00007fcc1bbb4000]
   java.lang.Thread.State: WAITING (parking)
        at sun.misc.Unsafe.park(Native Method)
        - parking to wait for  &amp;lt;0x00000000db121ea8&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2043)
        at org.apache.commons.pool2.impl.LinkedBlockingDeque.takeFirst(LinkedBlockingDeque.java:583)
        at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:442)
        at org.apache.commons.pool2.impl.GenericObjectPool.borrowObject(GenericObjectPool.java:363)
        at org.apache.commons.dbcp2.PoolingDataSource.getConnection(PoolingDataSource.java:134)
        at com.REDACTED.idxbuild.db.Database.getConnection(Database.java:221)
        at com.REDACTED.idxbuild.db.Database.getColumnSet(Database.java:571)
        at com.REDACTED.idxbuild.solr.Chain.doReinsert(Chain.java:1332)
        - locked &amp;lt;0x00000000db0011c8&amp;gt; (a java.lang.Object)
        at com.REDACTED.idxbuild.solr.Chain.updateIndex(Chain.java:1985)
        at com.REDACTED.idxbuild.solr.Chain.run(Chain.java:2145)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This issue says fixed, but doesn&apos;t indicate which version.  Should I file a new issue, or sign up for the mailing list for further discussion?&lt;/p&gt;

&lt;p&gt;I&apos;m using mysql-connector-java-5.1.35-bin.jar for JDBC.  My validation query is &quot;SELECT 1&quot;, and the validation timeout is 5.&lt;/p&gt;</comment>
                            <comment id="14490772" author="psteitz" created="Sat, 11 Apr 2015 04:25:50 +0000"  >&lt;p&gt;Better to post to the user list.  Quick look at the trace above looks like normal behavior waiting for an available connection.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12584347" name="DBCP-398.0.patch" size="840" author="sarvesh.sn" created="Wed, 22 May 2013 18:00:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>329054</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1krtj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>329396</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>