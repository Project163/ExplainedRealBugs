<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:46:49 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DBCP-93] [dbcp] BasicDataSource.createDataSource() memory leak on SQLExceptions</title>
                <link>https://issues.apache.org/jira/browse/DBCP-93</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Using:&lt;br/&gt;
commons-dbcp-1.2.1&lt;br/&gt;
commons-pool-1.2&lt;/p&gt;

&lt;p&gt;When using BasicDataSource, if the datasource is initialized while the database &lt;br/&gt;
is down, or a wrong user/pass is given, each call to getConnection() results in &lt;br/&gt;
a memory leak.&lt;/p&gt;

&lt;p&gt;Here&apos;s what I&apos;ve tracked down:&lt;/p&gt;

&lt;p&gt;In the BasicDataSource.createDataSource method, if the datasource was &lt;br/&gt;
previously un-initialized, a new GenericObjectPool (or AbandonedObjectPool &lt;br/&gt;
depending on configuration) is always instantiated.&lt;/p&gt;

&lt;p&gt;The GenericObjectPool constructor (and also the call to &lt;br/&gt;
setTimeBetweenEvictionRunsMillis()) starts a new thread for the Evictor.  This &lt;br/&gt;
thread runs until it&apos;s cancel() is called.&lt;/p&gt;

&lt;p&gt;The problem is that if a SQLException is thrown when the &lt;br/&gt;
PoolableConnectionFactory is instantiated (like with a bad user/pass), the &lt;br/&gt;
exception is rethrown, but no attempt is made to clean up the Evictor thread &lt;br/&gt;
that was started in the GenericObjectPool, so that thread just keeps running &lt;br/&gt;
forever.  Since this happens before the datasource was created, the next call &lt;br/&gt;
to getConnection() will again attempt to re-initialize the datasource in &lt;br/&gt;
createDataSource(), and if the same error happens again, another Evictor thread &lt;br/&gt;
will be left running, -&amp;gt; repeat a few thousand times and it starts to bring &lt;br/&gt;
down systems.&lt;/p&gt;

&lt;p&gt;Changing BasicDataSource to only initialize the connectionPool when it is null &lt;br/&gt;
seemed resolve the issue.  Alternatively, catching the exception, and calling &lt;br/&gt;
close() on the pool (which then cancel()&apos;s the Evictor) also seemed to work.&lt;/p&gt;

&lt;p&gt;Environment:&lt;br/&gt;
WinXP&lt;br/&gt;
SQL2000&lt;br/&gt;
JSQLConnect driver&lt;/p&gt;</description>
                <environment>&lt;p&gt;Operating System: Windows XP&lt;br/&gt;
Platform: PC&lt;/p&gt;</environment>
        <key id="12342799">DBCP-93</key>
            <summary>[dbcp] BasicDataSource.createDataSource() memory leak on SQLExceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ekaufman@infinitecampus.com">ekaufman</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Dec 2005 08:47:53 +0000</created>
                <updated>Tue, 25 Mar 2008 08:11:31 +0000</updated>
                            <resolved>Thu, 14 Sep 2006 06:02:25 +0000</resolved>
                                                    <fixVersion>1.2.2</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12411081" author="ekaufman@infinitecampus.com" created="Tue, 20 Dec 2005 03:42:51 +0000"  >&lt;p&gt;Created an attachment (id=17241)&lt;br/&gt;
Proposed Patch&lt;/p&gt;


&lt;p&gt;The changes I made here took care of the issue in my testing.&lt;/p&gt;</comment>
                            <comment id="12434596" author="psteitz" created="Thu, 14 Sep 2006 06:02:25 +0000"  >&lt;p&gt;This bug is fixed by the upgrade to commons pool 1.3, which no longer spawns threads for the evictor functionality.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12333954" name="ASF.LICENSE.NOT.GRANTED--BasicDataSource.java" size="31594" author="ekaufman@infinitecampus.com" created="Tue, 20 Dec 2005 03:42:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37926</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114376</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            19 years, 11 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uvkn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178256</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>