<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:47:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DBCP-245] SharedPoolDataSource saves wrong password forever</title>
                <link>https://issues.apache.org/jira/browse/DBCP-245</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;The SharedPoolDataSource saves wrong password forever&lt;/p&gt;


&lt;p&gt;1. Get a connection for user1 (use username of user1 and password of user1) ---&amp;gt; connection ok&lt;br/&gt;
2. Get a connection for user2 (use username of user2 and a wrong password) --&amp;gt; connection failed&lt;br/&gt;
3. Get a connection for user2 (use username of user2 and password of user2) --&amp;gt; connection will be failed too because the wrong password is stored in the usersKey map.&lt;/p&gt;



&lt;p&gt;Bugfix&lt;br/&gt;
===================================================================&lt;/p&gt;

&lt;p&gt;   protected synchronized PooledConnectionAndInfo &lt;br/&gt;
        getPooledConnectionAndInfo(String username, String password)&lt;br/&gt;
        throws SQLException {&lt;br/&gt;
        if (pool == null) {&lt;br/&gt;
            try &lt;/p&gt;
{
                registerPool(username, password);
            }
&lt;p&gt; catch (NamingException e) &lt;/p&gt;
{
                throw new SQLNestedException(&quot;RegisterPool failed&quot;, e);
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;        PooledConnectionAndInfo info = null;&lt;br/&gt;
        UserPassKey userPassKey = null;&lt;br/&gt;
        try &lt;/p&gt;
{
        	userPassKey = getUserPassKey(username, password);
            info = (PooledConnectionAndInfo) pool
                .borrowObject(userPassKey);
        }
&lt;p&gt;        catch (Exception e) {&lt;/p&gt;

&lt;p&gt;        	if (userKeys != null &amp;amp;&amp;amp; userKeys.containsKey(username)) &lt;/p&gt;
{
        		userKeys.remove(username);
        	}

&lt;p&gt;            throw new SQLNestedException(&lt;br/&gt;
                &quot;Could not retrieve connection info from pool&quot;, e);&lt;br/&gt;
        }&lt;br/&gt;
        return info;&lt;br/&gt;
    }&lt;/p&gt;</description>
                <environment>&lt;p&gt;Use of SharedPoolDataSource see sample code&lt;/p&gt;

&lt;p&gt;	if (privSharedDS == null)&lt;br/&gt;
{&lt;br/&gt;
	privConPoolDS = new PGConnectionPoolDataSource();&lt;br/&gt;
	privConPoolDS.setServerName(privServerName);&lt;br/&gt;
	privConPoolDS.setDatabaseName(privServerDB);&lt;br/&gt;
	privConPoolDS.setUser(privUser);&lt;br/&gt;
	privConPoolDS.setPassword(privPassword);&lt;br/&gt;
	// --------------------------------------&lt;br/&gt;
	// dbcp caching via SharedPoolDataSource&lt;br/&gt;
	// --------------------------------------&lt;br/&gt;
	privSharedDS = new SharedPoolDataSource();&lt;br/&gt;
	privSharedDS.setConnectionPoolDataSource(privConPoolDS);&lt;br/&gt;
		privSharedDS.setMaxActive(10); // 0 = no limit&lt;br/&gt;
	privSharedDS.setMaxIdle(10);&lt;br/&gt;
	privSharedDS.setMinEvictableIdleTimeMillis(1000);&lt;br/&gt;
	privSharedDS.setMaxWait(1000); // -1 = no limit&lt;br/&gt;
	privSharedDS.setTimeBetweenEvictionRunsMillis(1000);&lt;br/&gt;
	privSharedDS.setTestWhileIdle(true);&lt;br/&gt;
}&lt;br/&gt;
// --------------------------------------&lt;br/&gt;
// dbcp caching via SharedPoolDataSource&lt;br/&gt;
// --------------------------------------&lt;br/&gt;
tmpCon = privSharedDS.getConnection(privUser, privPassword);&lt;/p&gt;</environment>
        <key id="12380058">DBCP-245</key>
            <summary>SharedPoolDataSource saves wrong password forever</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="md">Michael Drechsel</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Oct 2007 13:18:26 +0000</created>
                <updated>Tue, 25 Mar 2008 08:11:36 +0000</updated>
                            <resolved>Tue, 29 Jan 2008 02:30:32 +0000</resolved>
                                    <version>1.1</version>
                    <version>1.2</version>
                    <version>1.2.1</version>
                    <version>1.2.2</version>
                                    <fixVersion>1.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12534190" author="psteitz" created="Fri, 12 Oct 2007 00:09:05 +0000"  >&lt;p&gt;Thanks for reporting this.  It would be great to have the code above put into a patch, with the steps to reproduce put into a test case that fails before and succeeds after the fix.&lt;/p&gt;</comment>
                            <comment id="12539844" author="md" created="Sat, 3 Nov 2007 05:42:29 +0000"  >&lt;p&gt;Hello Phil Steitz,&lt;/p&gt;

&lt;p&gt;thanks for your eMail. Here a have an test case that reproduces the bug.&lt;/p&gt;

&lt;p&gt;test case&lt;/p&gt;

&lt;p&gt;========&lt;/p&gt;

&lt;p&gt;            String serverName = &quot;localhost&quot;;&lt;br/&gt;
            String serverDB = &quot;localweb&quot;;&lt;/p&gt;

&lt;p&gt;            String user1 = &quot;doris&quot;;&lt;br/&gt;
            String password1 = &quot;doris&quot;;&lt;/p&gt;

&lt;p&gt;            String user2 = &quot;cramer&quot;;&lt;br/&gt;
            String password2 = &quot;cramer&quot;;&lt;/p&gt;


&lt;p&gt;            Connection con = null;&lt;/p&gt;


&lt;p&gt;            PGConnectionPoolDataSource ConPoolDS = new &lt;br/&gt;
PGConnectionPoolDataSource();&lt;br/&gt;
            ConPoolDS.setServerName(serverName);&lt;br/&gt;
            ConPoolDS.setDatabaseName(serverDB);&lt;br/&gt;
            ConPoolDS.setUser(user1);&lt;br/&gt;
            ConPoolDS.setPassword(password1);&lt;br/&gt;
            // --------------------------------------&lt;br/&gt;
            // dbcp caching via SharedPoolDataSource&lt;br/&gt;
            // --------------------------------------&lt;br/&gt;
            SharedPoolDataSource SharedDS = new SharedPoolDataSource();&lt;br/&gt;
            SharedDS.setConnectionPoolDataSource(ConPoolDS);&lt;br/&gt;
            SharedDS.setMaxActive(10); // 0 = no limit&lt;br/&gt;
            SharedDS.setMaxIdle(10);&lt;br/&gt;
            SharedDS.setMinEvictableIdleTimeMillis(1000);&lt;br/&gt;
            SharedDS.setMaxWait(1000); // -1 = no limit&lt;br/&gt;
            SharedDS.setTimeBetweenEvictionRunsMillis(1000);&lt;br/&gt;
            SharedDS.setTestWhileIdle(true);&lt;/p&gt;

&lt;p&gt;            try&lt;/p&gt;
            {
                con = SharedDS.getConnection(user1, password1);
            }
&lt;p&gt;            catch (Exception e)&lt;/p&gt;
            {
                // TODO Auto-generated catch block
                e.printStackTrace();
            }&lt;br/&gt;
           &lt;br/&gt;
            try&lt;br/&gt;
            {
                con = SharedDS.getConnection(user2, &quot;wrongpassword&quot;);
            }&lt;br/&gt;
            catch (Exception e)&lt;br/&gt;
            {                // TODO Auto-generated catch block                e.printStackTrace();            }

&lt;p&gt;            try&lt;/p&gt;
            {
                // connection will fail because the wrong password is 
stored in the usersKey map.
                con = SharedDS.getConnection(user2, password2);
            }
&lt;p&gt;            catch (Exception e)&lt;/p&gt;
            {
                // TODO Auto-generated catch block
                e.printStackTrace();
            }

&lt;p&gt;steps to reproduce&lt;/p&gt;

&lt;p&gt;================&lt;/p&gt;

&lt;p&gt;The SharedPoolDataSource saves wrong password forever&lt;br/&gt;
1. Get a connection for user1 (use username of user1 and password of user1) ---&amp;gt; connection ok&lt;br/&gt;
2. Get a connection for user2 (use username of user2 and a wrong password) --&amp;gt; connection failed&lt;br/&gt;
3. Get a connection for user2 (use username of user2 and password of user2) --&amp;gt; connection will be failed too because the wrong password is stored in the usersKey map.&lt;/p&gt;






&lt;p&gt;_________________________________________________________________________________________ &lt;/p&gt;
</comment>
                            <comment id="12563367" author="psteitz" created="Tue, 29 Jan 2008 02:30:32 +0000"  >&lt;p&gt;Slightly modified version of the suggested fix implemented in r616142.&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114524</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 43 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0uzfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>178881</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>