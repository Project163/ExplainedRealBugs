<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:47:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[DBCP-347] DelegatingStatement class has incomplete isWrapperFor method</title>
                <link>https://issues.apache.org/jira/browse/DBCP-347</link>
                <project id="12310469" key="DBCP">Commons DBCP</project>
                    <description>&lt;p&gt;Currently org.apache.commons.dbcp.DelegatingStatement#isWrapperFor checks only if:&lt;/p&gt;

&lt;p&gt;1. Requested class is assignable from the DelegatingStatement instance:        iface.isAssignableFrom(getClass())&lt;br/&gt;
2. Wrapped object is a wrapper for the requested class:            _stmt.isWrapperFor(iface)&lt;/p&gt;

&lt;p&gt;I think there should be another option checked i.e. requested class is assignable from the wrapped object&apos;s class. For example:   iface.isAssignableFrom(_stmt.getClass())&lt;br/&gt;
This is especially that in fact unwrap method properly assumes this possiblity i.e.:     return iface.cast(_stmt);&lt;/p&gt;

&lt;p&gt;The whole method should be:&lt;/p&gt;

&lt;p&gt;    public boolean isWrapperFor(Class&amp;lt;?&amp;gt; iface) throws SQLException &lt;/p&gt;
{
        return iface.isAssignableFrom(getClass()) || iface.isAssignableFrom(_stmt.getClass()) || _stmt.isWrapperFor(iface);
    }</description>
                <environment>&lt;p&gt;Windows 7. java version &quot;1.6.0_21&quot;. Dell Latitude E6410.&lt;/p&gt;</environment>
        <key id="12478441">DBCP-347</key>
            <summary>DelegatingStatement class has incomplete isWrapperFor method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rposcro">Robert Poskrobek</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Oct 2010 11:33:28 +0000</created>
                <updated>Sat, 31 May 2014 04:15:14 +0000</updated>
                            <resolved>Mon, 9 Dec 2013 21:20:16 +0000</resolved>
                                                    <fixVersion>1.3.1</fixVersion>
                    <fixVersion>1.4.1</fixVersion>
                    <fixVersion>1.5.1</fixVersion>
                    <fixVersion>2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="12925341" author="ggregory@seagullsw.com" created="Wed, 27 Oct 2010 11:58:09 +0000"  >&lt;p&gt;Would you be willing to provide a patch that includes a unit test to prove what is broken?&lt;/p&gt;</comment>
                            <comment id="12925376" author="rposcro" created="Wed, 27 Oct 2010 14:08:10 +0000"  >&lt;p&gt;Ok! Let&apos;s start with &lt;tt&gt;java.sql.Wrapper#isWrapperFor&lt;/tt&gt; specification. It says that class implementing &lt;tt&gt;Wrapper&lt;/tt&gt; should check if directly implements requested interface. Otherwise it should immediately delegate the call to its wrapped object. According to this &lt;tt&gt;org.apache.commons.dbcp.DelegatingStatement#isWrapperFor&lt;/tt&gt; is written correctly. On the other hand Sun&apos;s specificifaction for &lt;tt&gt;java.sql.Wrapper#unwrap&lt;/tt&gt; method assumes wrapper to try to cast wrapped object rather than immediately delegating to its &lt;tt&gt;unwrap&lt;/tt&gt; method. Having this inconsistency I&apos;d vote for adding another level of checking for wrapper. This is because some wrapped classes doesn&apos;t implement &lt;tt&gt;java.sql.Wrapper&lt;/tt&gt; correctly (or at all) but still are valid classes for casting.&lt;/p&gt;

&lt;p&gt;Probably better to show my suggestion as code.&lt;br/&gt;
Currently we&apos;ve got:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.commons.dbcp.DelegatingStatement&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isWrapperFor(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; iface) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; iface.isAssignableFrom(getClass()) || _stmt.isWrapperFor(iface);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I suggest adding additional alternative condition here so:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.commons.dbcp.DelegatingStatement&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isWrapperFor(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; iface) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; iface.isAssignableFrom(getClass()) || iface.isAssignableFrom(_stmt.getClass()) || _stmt.isWrapperFor(iface);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There is no unit test for this method so I suggest adding it:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.commons.dbcp.TestDelegatingStatement&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testIsWrapperFor() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        TesterConnection tstConn = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TesterConnection(&lt;span class=&quot;code-quote&quot;&gt;&quot;rposcro&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;rposcro&quot;&lt;/span&gt;);
        TesterStatement tstStmt = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TesterStatement(tstConn);
        DelegatingConnection conn = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DelegatingConnection(tstConn);
        DelegatingStatement stmt = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DelegatingStatement(conn, tstStmt);

        &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; stmtProxyClass = Proxy.getProxyClass(
                &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getClass().getClassLoader(), 
                Statement.class);
        
        assertTrue(stmt.isWrapperFor(DelegatingStatement.class));
        assertTrue(stmt.isWrapperFor(TesterStatement.class));
        assertFalse(stmt.isWrapperFor(stmtProxyClass));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In order to pass the test there is fix needed for tester helper class which is not following specification currently:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;org.apache.commons.dbcp.TesterStatement&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isWrapperFor(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; iface) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; SQLException {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please let me know your thoughts. Regards, r&lt;/p&gt;</comment>
                            <comment id="13843566" author="markt" created="Mon, 9 Dec 2013 21:20:16 +0000"  >&lt;p&gt;Thanks for the report, patch and test case.&lt;/p&gt;

&lt;p&gt;Similar issues in DelegatingDatabaseMetaData.isWrapperFor() and DelegatingResultSet.isWrapperFor() were also fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114623</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 49 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fty7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90450</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>