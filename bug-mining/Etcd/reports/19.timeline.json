[{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/706575338","html_url":"https://github.com/etcd-io/etcd/issues/12385#issuecomment-706575338","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12385","id":706575338,"node_id":"MDEyOklzc3VlQ29tbWVudDcwNjU3NTMzOA==","user":{"login":"cfc4n","id":709947,"node_id":"MDQ6VXNlcjcwOTk0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/709947?v=4","gravatar_id":"","url":"https://api.github.com/users/cfc4n","html_url":"https://github.com/cfc4n","followers_url":"https://api.github.com/users/cfc4n/followers","following_url":"https://api.github.com/users/cfc4n/following{/other_user}","gists_url":"https://api.github.com/users/cfc4n/gists{/gist_id}","starred_url":"https://api.github.com/users/cfc4n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfc4n/subscriptions","organizations_url":"https://api.github.com/users/cfc4n/orgs","repos_url":"https://api.github.com/users/cfc4n/repos","events_url":"https://api.github.com/users/cfc4n/events{/privacy}","received_events_url":"https://api.github.com/users/cfc4n/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-10T16:30:41Z","updated_at":"2020-10-10T16:30:41Z","body":"> i think the causes are:\r\n> * the grpc stream's authentication token is provided at the time when the stream is initialized\r\n> * the client is trying to reusing the same grpc stream(if avaliable) to setup new watch substream.\r\n> * the token attached to the stream would be expired if no other requests to extend its ttl.\r\n\r\nYes,you are right.  and you can get more information about the token being deleted with command `$ bin/etcd --log-level debug --logger zap --auth-token-ttl 10`\r\n\r\n```\r\n{\"level\":\"debug\",\"ts\":\"2020-10-11T00:22:06.647+0800\",\"caller\":\"auth/store.go:335\",\"msg\":\"authenticated a user\",\"user-name\":\"root\",\"token\":\"xNgkSwPjKojuppwM.11\"}\r\n{\"level\":\"debug\",\"ts\":\"2020-10-11T00:22:06.647+0800\",\"caller\":\"v3rpc/interceptor.go:181\",\"msg\":\"request stats\",\"start time\":\"2020-10-11T00:22:06.569+0800\",\"time spent\":\"77.981547ms\",\"remote\":\"127.0.0.1:63080\",\"response type\":\"/etcdserverpb.Auth/Authenticate\",\"request count\":-1,\"request size\":-1,\"response count\":-1,\"response size\":-1,\"request content\":\"\"}\r\n{\"level\":\"info\",\"ts\":\"2020-10-11T00:22:06.648+0800\",\"caller\":\"grpclog/grpclog.go:45\",\"msg\":\"transport: loopyWriter.run returning. connection error: desc = \\\"transport is closing\\\"\"}\r\n{\"level\":\"info\",\"ts\":\"2020-10-11T00:22:17.950+0800\",\"caller\":\"auth/simple_token.go:169\",\"msg\":\"deleted a simple token\",\"user-name\":\"root\",\"token\":\"xNgkSwPjKojuppwM.11\"}\r\n{\"level\":\"warn\",\"ts\":\"2020-10-11T00:22:18.655+0800\",\"caller\":\"auth/store.go:1301\",\"msg\":\"invalid auth token\",\"token\":\"xNgkSwPjKojuppwM.11\"}\r\n{\"level\":\"warn\",\"ts\":\"2020-10-11T00:22:19.658+0800\",\"caller\":\"auth/store.go:1301\",\"msg\":\"invalid auth token\",\"token\":\"xNgkSwPjKojuppwM.11\"}\r\n```\r\n\r\nSo, I think that is correct. and you?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/706575338/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cfc4n","id":709947,"node_id":"MDQ6VXNlcjcwOTk0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/709947?v=4","gravatar_id":"","url":"https://api.github.com/users/cfc4n","html_url":"https://github.com/cfc4n","followers_url":"https://api.github.com/users/cfc4n/followers","following_url":"https://api.github.com/users/cfc4n/following{/other_user}","gists_url":"https://api.github.com/users/cfc4n/gists{/gist_id}","starred_url":"https://api.github.com/users/cfc4n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfc4n/subscriptions","organizations_url":"https://api.github.com/users/cfc4n/orgs","repos_url":"https://api.github.com/users/cfc4n/repos","events_url":"https://api.github.com/users/cfc4n/events{/privacy}","received_events_url":"https://api.github.com/users/cfc4n/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/706586037","html_url":"https://github.com/etcd-io/etcd/issues/12385#issuecomment-706586037","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12385","id":706586037,"node_id":"MDEyOklzc3VlQ29tbWVudDcwNjU4NjAzNw==","user":{"login":"cfz","id":1214480,"node_id":"MDQ6VXNlcjEyMTQ0ODA=","avatar_url":"https://avatars.githubusercontent.com/u/1214480?v=4","gravatar_id":"","url":"https://api.github.com/users/cfz","html_url":"https://github.com/cfz","followers_url":"https://api.github.com/users/cfz/followers","following_url":"https://api.github.com/users/cfz/following{/other_user}","gists_url":"https://api.github.com/users/cfz/gists{/gist_id}","starred_url":"https://api.github.com/users/cfz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfz/subscriptions","organizations_url":"https://api.github.com/users/cfz/orgs","repos_url":"https://api.github.com/users/cfz/repos","events_url":"https://api.github.com/users/cfz/events{/privacy}","received_events_url":"https://api.github.com/users/cfz/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-10T17:41:59Z","updated_at":"2020-10-10T17:41:59Z","body":"acutally, i enabled debug log during my investigation :). i saw the log at very beginning, but it takes me a while to understand why the stale token is still being referenced.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/706586037/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cfz","id":1214480,"node_id":"MDQ6VXNlcjEyMTQ0ODA=","avatar_url":"https://avatars.githubusercontent.com/u/1214480?v=4","gravatar_id":"","url":"https://api.github.com/users/cfz","html_url":"https://github.com/cfz","followers_url":"https://api.github.com/users/cfz/followers","following_url":"https://api.github.com/users/cfz/following{/other_user}","gists_url":"https://api.github.com/users/cfz/gists{/gist_id}","starred_url":"https://api.github.com/users/cfz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfz/subscriptions","organizations_url":"https://api.github.com/users/cfz/orgs","repos_url":"https://api.github.com/users/cfz/repos","events_url":"https://api.github.com/users/cfz/events{/privacy}","received_events_url":"https://api.github.com/users/cfz/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/716409457","html_url":"https://github.com/etcd-io/etcd/issues/12385#issuecomment-716409457","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12385","id":716409457,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNjQwOTQ1Nw==","user":{"login":"cfz","id":1214480,"node_id":"MDQ6VXNlcjEyMTQ0ODA=","avatar_url":"https://avatars.githubusercontent.com/u/1214480?v=4","gravatar_id":"","url":"https://api.github.com/users/cfz","html_url":"https://github.com/cfz","followers_url":"https://api.github.com/users/cfz/followers","following_url":"https://api.github.com/users/cfz/following{/other_user}","gists_url":"https://api.github.com/users/cfz/gists{/gist_id}","starred_url":"https://api.github.com/users/cfz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfz/subscriptions","organizations_url":"https://api.github.com/users/cfz/orgs","repos_url":"https://api.github.com/users/cfz/repos","events_url":"https://api.github.com/users/cfz/events{/privacy}","received_events_url":"https://api.github.com/users/cfz/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-26T09:00:06Z","updated_at":"2020-10-26T09:00:06Z","body":"i noticed a related PR #12264, but i think this issure still exists on master branch.\r\nwondering if it's possible to detect the \"perssion denied\" message from serveWatchClient() and force the client to re-create a watch stream? \r\n@cfc4n ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/716409457/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cfz","id":1214480,"node_id":"MDQ6VXNlcjEyMTQ0ODA=","avatar_url":"https://avatars.githubusercontent.com/u/1214480?v=4","gravatar_id":"","url":"https://api.github.com/users/cfz","html_url":"https://github.com/cfz","followers_url":"https://api.github.com/users/cfz/followers","following_url":"https://api.github.com/users/cfz/following{/other_user}","gists_url":"https://api.github.com/users/cfz/gists{/gist_id}","starred_url":"https://api.github.com/users/cfz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfz/subscriptions","organizations_url":"https://api.github.com/users/cfz/orgs","repos_url":"https://api.github.com/users/cfz/repos","events_url":"https://api.github.com/users/cfz/events{/privacy}","received_events_url":"https://api.github.com/users/cfz/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3919591881,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzkxOTU5MTg4MQ==","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/3919591881","actor":{"login":"cfc4n","id":709947,"node_id":"MDQ6VXNlcjcwOTk0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/709947?v=4","gravatar_id":"","url":"https://api.github.com/users/cfc4n","html_url":"https://github.com/cfc4n","followers_url":"https://api.github.com/users/cfc4n/followers","following_url":"https://api.github.com/users/cfc4n/following{/other_user}","gists_url":"https://api.github.com/users/cfc4n/gists{/gist_id}","starred_url":"https://api.github.com/users/cfc4n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfc4n/subscriptions","organizations_url":"https://api.github.com/users/cfc4n/orgs","repos_url":"https://api.github.com/users/cfc4n/repos","events_url":"https://api.github.com/users/cfc4n/events{/privacy}","received_events_url":"https://api.github.com/users/cfc4n/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-10-26T09:00:07Z","performed_via_github_app":null},{"id":3919591887,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM5MTk1OTE4ODc=","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/3919591887","actor":{"login":"cfc4n","id":709947,"node_id":"MDQ6VXNlcjcwOTk0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/709947?v=4","gravatar_id":"","url":"https://api.github.com/users/cfc4n","html_url":"https://github.com/cfc4n","followers_url":"https://api.github.com/users/cfc4n/followers","following_url":"https://api.github.com/users/cfc4n/following{/other_user}","gists_url":"https://api.github.com/users/cfc4n/gists{/gist_id}","starred_url":"https://api.github.com/users/cfc4n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfc4n/subscriptions","organizations_url":"https://api.github.com/users/cfc4n/orgs","repos_url":"https://api.github.com/users/cfc4n/repos","events_url":"https://api.github.com/users/cfc4n/events{/privacy}","received_events_url":"https://api.github.com/users/cfc4n/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-10-26T09:00:07Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/716410800","html_url":"https://github.com/etcd-io/etcd/issues/12385#issuecomment-716410800","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12385","id":716410800,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNjQxMDgwMA==","user":{"login":"cfz","id":1214480,"node_id":"MDQ6VXNlcjEyMTQ0ODA=","avatar_url":"https://avatars.githubusercontent.com/u/1214480?v=4","gravatar_id":"","url":"https://api.github.com/users/cfz","html_url":"https://github.com/cfz","followers_url":"https://api.github.com/users/cfz/followers","following_url":"https://api.github.com/users/cfz/following{/other_user}","gists_url":"https://api.github.com/users/cfz/gists{/gist_id}","starred_url":"https://api.github.com/users/cfz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfz/subscriptions","organizations_url":"https://api.github.com/users/cfz/orgs","repos_url":"https://api.github.com/users/cfz/repos","events_url":"https://api.github.com/users/cfz/events{/privacy}","received_events_url":"https://api.github.com/users/cfz/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-26T09:02:31Z","updated_at":"2020-10-26T09:02:31Z","body":"and for anyone has the same problem:\r\nJWT token has the same problem. Using CommonName in certificate as username is a walk around","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/716410800/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"cfz","id":1214480,"node_id":"MDQ6VXNlcjEyMTQ0ODA=","avatar_url":"https://avatars.githubusercontent.com/u/1214480?v=4","gravatar_id":"","url":"https://api.github.com/users/cfz","html_url":"https://github.com/cfz","followers_url":"https://api.github.com/users/cfz/followers","following_url":"https://api.github.com/users/cfz/following{/other_user}","gists_url":"https://api.github.com/users/cfz/gists{/gist_id}","starred_url":"https://api.github.com/users/cfz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfz/subscriptions","organizations_url":"https://api.github.com/users/cfz/orgs","repos_url":"https://api.github.com/users/cfz/repos","events_url":"https://api.github.com/users/cfz/events{/privacy}","received_events_url":"https://api.github.com/users/cfz/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/716529058","html_url":"https://github.com/etcd-io/etcd/issues/12385#issuecomment-716529058","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12385","id":716529058,"node_id":"MDEyOklzc3VlQ29tbWVudDcxNjUyOTA1OA==","user":{"login":"mitake","id":1173955,"node_id":"MDQ6VXNlcjExNzM5NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mitake","html_url":"https://github.com/mitake","followers_url":"https://api.github.com/users/mitake/followers","following_url":"https://api.github.com/users/mitake/following{/other_user}","gists_url":"https://api.github.com/users/mitake/gists{/gist_id}","starred_url":"https://api.github.com/users/mitake/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitake/subscriptions","organizations_url":"https://api.github.com/users/mitake/orgs","repos_url":"https://api.github.com/users/mitake/repos","events_url":"https://api.github.com/users/mitake/events{/privacy}","received_events_url":"https://api.github.com/users/mitake/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-26T12:58:51Z","updated_at":"2020-10-26T12:58:51Z","body":"> i noticed a related PR #12264, but i think this issure still exists on master branch.\r\n@cfz thanks for checking with the master branch, let me check again.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/716529058/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mitake","id":1173955,"node_id":"MDQ6VXNlcjExNzM5NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mitake","html_url":"https://github.com/mitake","followers_url":"https://api.github.com/users/mitake/followers","following_url":"https://api.github.com/users/mitake/following{/other_user}","gists_url":"https://api.github.com/users/mitake/gists{/gist_id}","starred_url":"https://api.github.com/users/mitake/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitake/subscriptions","organizations_url":"https://api.github.com/users/mitake/orgs","repos_url":"https://api.github.com/users/mitake/repos","events_url":"https://api.github.com/users/mitake/events{/privacy}","received_events_url":"https://api.github.com/users/mitake/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3920563995,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MzkyMDU2Mzk5NQ==","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/3920563995","actor":{"login":"cfz","id":1214480,"node_id":"MDQ6VXNlcjEyMTQ0ODA=","avatar_url":"https://avatars.githubusercontent.com/u/1214480?v=4","gravatar_id":"","url":"https://api.github.com/users/cfz","html_url":"https://github.com/cfz","followers_url":"https://api.github.com/users/cfz/followers","following_url":"https://api.github.com/users/cfz/following{/other_user}","gists_url":"https://api.github.com/users/cfz/gists{/gist_id}","starred_url":"https://api.github.com/users/cfz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfz/subscriptions","organizations_url":"https://api.github.com/users/cfz/orgs","repos_url":"https://api.github.com/users/cfz/repos","events_url":"https://api.github.com/users/cfz/events{/privacy}","received_events_url":"https://api.github.com/users/cfz/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2020-10-26T12:58:51Z","performed_via_github_app":null},{"id":3920564000,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDM5MjA1NjQwMDA=","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/3920564000","actor":{"login":"cfz","id":1214480,"node_id":"MDQ6VXNlcjEyMTQ0ODA=","avatar_url":"https://avatars.githubusercontent.com/u/1214480?v=4","gravatar_id":"","url":"https://api.github.com/users/cfz","html_url":"https://github.com/cfz","followers_url":"https://api.github.com/users/cfz/followers","following_url":"https://api.github.com/users/cfz/following{/other_user}","gists_url":"https://api.github.com/users/cfz/gists{/gist_id}","starred_url":"https://api.github.com/users/cfz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfz/subscriptions","organizations_url":"https://api.github.com/users/cfz/orgs","repos_url":"https://api.github.com/users/cfz/repos","events_url":"https://api.github.com/users/cfz/events{/privacy}","received_events_url":"https://api.github.com/users/cfz/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2020-10-26T12:58:51Z","performed_via_github_app":null},{"id":4108531159,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQxMDg1MzExNTk=","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4108531159","actor":{"login":"bbiao","id":41536,"node_id":"MDQ6VXNlcjQxNTM2","avatar_url":"https://avatars.githubusercontent.com/u/41536?v=4","gravatar_id":"","url":"https://api.github.com/users/bbiao","html_url":"https://github.com/bbiao","followers_url":"https://api.github.com/users/bbiao/followers","following_url":"https://api.github.com/users/bbiao/following{/other_user}","gists_url":"https://api.github.com/users/bbiao/gists{/gist_id}","starred_url":"https://api.github.com/users/bbiao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bbiao/subscriptions","organizations_url":"https://api.github.com/users/bbiao/orgs","repos_url":"https://api.github.com/users/bbiao/repos","events_url":"https://api.github.com/users/bbiao/events{/privacy}","received_events_url":"https://api.github.com/users/bbiao/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"6a8e66a9d6a5aef4cabd5197241953224c78151d","commit_url":"https://api.github.com/repos/bbiao/etcd/commits/6a8e66a9d6a5aef4cabd5197241953224c78151d","created_at":"2020-12-14T10:46:05Z","performed_via_github_app":null},{"id":4108542728,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQxMDg1NDI3Mjg=","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4108542728","actor":{"login":"bbiao","id":41536,"node_id":"MDQ6VXNlcjQxNTM2","avatar_url":"https://avatars.githubusercontent.com/u/41536?v=4","gravatar_id":"","url":"https://api.github.com/users/bbiao","html_url":"https://github.com/bbiao","followers_url":"https://api.github.com/users/bbiao/followers","following_url":"https://api.github.com/users/bbiao/following{/other_user}","gists_url":"https://api.github.com/users/bbiao/gists{/gist_id}","starred_url":"https://api.github.com/users/bbiao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bbiao/subscriptions","organizations_url":"https://api.github.com/users/bbiao/orgs","repos_url":"https://api.github.com/users/bbiao/repos","events_url":"https://api.github.com/users/bbiao/events{/privacy}","received_events_url":"https://api.github.com/users/bbiao/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"79e13c8982cd2526d8ae42b24838a95596fc02cd","commit_url":"https://api.github.com/repos/bbiao/etcd/commits/79e13c8982cd2526d8ae42b24838a95596fc02cd","created_at":"2020-12-14T10:48:36Z","performed_via_github_app":null},{"id":4108544636,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQxMDg1NDQ2MzY=","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4108544636","actor":{"login":"bbiao","id":41536,"node_id":"MDQ6VXNlcjQxNTM2","avatar_url":"https://avatars.githubusercontent.com/u/41536?v=4","gravatar_id":"","url":"https://api.github.com/users/bbiao","html_url":"https://github.com/bbiao","followers_url":"https://api.github.com/users/bbiao/followers","following_url":"https://api.github.com/users/bbiao/following{/other_user}","gists_url":"https://api.github.com/users/bbiao/gists{/gist_id}","starred_url":"https://api.github.com/users/bbiao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bbiao/subscriptions","organizations_url":"https://api.github.com/users/bbiao/orgs","repos_url":"https://api.github.com/users/bbiao/repos","events_url":"https://api.github.com/users/bbiao/events{/privacy}","received_events_url":"https://api.github.com/users/bbiao/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"748715dfcd7c82d6d12e0a46b38ac8e97913fb41","commit_url":"https://api.github.com/repos/bbiao/etcd/commits/748715dfcd7c82d6d12e0a46b38ac8e97913fb41","created_at":"2020-12-14T10:48:57Z","performed_via_github_app":null},{"actor":{"login":"bbiao","id":41536,"node_id":"MDQ6VXNlcjQxNTM2","avatar_url":"https://avatars.githubusercontent.com/u/41536?v=4","gravatar_id":"","url":"https://api.github.com/users/bbiao","html_url":"https://github.com/bbiao","followers_url":"https://api.github.com/users/bbiao/followers","following_url":"https://api.github.com/users/bbiao/following{/other_user}","gists_url":"https://api.github.com/users/bbiao/gists{/gist_id}","starred_url":"https://api.github.com/users/bbiao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bbiao/subscriptions","organizations_url":"https://api.github.com/users/bbiao/orgs","repos_url":"https://api.github.com/users/bbiao/repos","events_url":"https://api.github.com/users/bbiao/events{/privacy}","received_events_url":"https://api.github.com/users/bbiao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-14T10:49:25Z","updated_at":"2020-12-14T10:49:25Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/12549","repository_url":"https://api.github.com/repos/etcd-io/etcd","labels_url":"https://api.github.com/repos/etcd-io/etcd/issues/12549/labels{/name}","comments_url":"https://api.github.com/repos/etcd-io/etcd/issues/12549/comments","events_url":"https://api.github.com/repos/etcd-io/etcd/issues/12549/events","html_url":"https://github.com/etcd-io/etcd/pull/12549","id":766281827,"node_id":"MDExOlB1bGxSZXF1ZXN0NTM5MzUzMTM1","number":12549,"title":"client/v3: clear auth token when encounter ErrInvalidAuthToken","user":{"login":"bbiao","id":41536,"node_id":"MDQ6VXNlcjQxNTM2","avatar_url":"https://avatars.githubusercontent.com/u/41536?v=4","gravatar_id":"","url":"https://api.github.com/users/bbiao","html_url":"https://github.com/bbiao","followers_url":"https://api.github.com/users/bbiao/followers","following_url":"https://api.github.com/users/bbiao/following{/other_user}","gists_url":"https://api.github.com/users/bbiao/gists{/gist_id}","starred_url":"https://api.github.com/users/bbiao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bbiao/subscriptions","organizations_url":"https://api.github.com/users/bbiao/orgs","repos_url":"https://api.github.com/users/bbiao/repos","events_url":"https://api.github.com/users/bbiao/events{/privacy}","received_events_url":"https://api.github.com/users/bbiao/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2020-12-14T10:49:25Z","updated_at":"2021-01-02T11:37:28Z","closed_at":"2020-12-30T03:08:15Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":11225014,"node_id":"MDEwOlJlcG9zaXRvcnkxMTIyNTAxNA==","name":"etcd","full_name":"etcd-io/etcd","private":false,"owner":{"login":"etcd-io","id":41972792,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQxOTcyNzky","avatar_url":"https://avatars.githubusercontent.com/u/41972792?v=4","gravatar_id":"","url":"https://api.github.com/users/etcd-io","html_url":"https://github.com/etcd-io","followers_url":"https://api.github.com/users/etcd-io/followers","following_url":"https://api.github.com/users/etcd-io/following{/other_user}","gists_url":"https://api.github.com/users/etcd-io/gists{/gist_id}","starred_url":"https://api.github.com/users/etcd-io/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/etcd-io/subscriptions","organizations_url":"https://api.github.com/users/etcd-io/orgs","repos_url":"https://api.github.com/users/etcd-io/repos","events_url":"https://api.github.com/users/etcd-io/events{/privacy}","received_events_url":"https://api.github.com/users/etcd-io/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/etcd-io/etcd","description":"Distributed reliable key-value store for the most critical data of a distributed system","fork":false,"url":"https://api.github.com/repos/etcd-io/etcd","forks_url":"https://api.github.com/repos/etcd-io/etcd/forks","keys_url":"https://api.github.com/repos/etcd-io/etcd/keys{/key_id}","collaborators_url":"https://api.github.com/repos/etcd-io/etcd/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/etcd-io/etcd/teams","hooks_url":"https://api.github.com/repos/etcd-io/etcd/hooks","issue_events_url":"https://api.github.com/repos/etcd-io/etcd/issues/events{/number}","events_url":"https://api.github.com/repos/etcd-io/etcd/events","assignees_url":"https://api.github.com/repos/etcd-io/etcd/assignees{/user}","branches_url":"https://api.github.com/repos/etcd-io/etcd/branches{/branch}","tags_url":"https://api.github.com/repos/etcd-io/etcd/tags","blobs_url":"https://api.github.com/repos/etcd-io/etcd/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/etcd-io/etcd/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/etcd-io/etcd/git/refs{/sha}","trees_url":"https://api.github.com/repos/etcd-io/etcd/git/trees{/sha}","statuses_url":"https://api.github.com/repos/etcd-io/etcd/statuses/{sha}","languages_url":"https://api.github.com/repos/etcd-io/etcd/languages","stargazers_url":"https://api.github.com/repos/etcd-io/etcd/stargazers","contributors_url":"https://api.github.com/repos/etcd-io/etcd/contributors","subscribers_url":"https://api.github.com/repos/etcd-io/etcd/subscribers","subscription_url":"https://api.github.com/repos/etcd-io/etcd/subscription","commits_url":"https://api.github.com/repos/etcd-io/etcd/commits{/sha}","git_commits_url":"https://api.github.com/repos/etcd-io/etcd/git/commits{/sha}","comments_url":"https://api.github.com/repos/etcd-io/etcd/comments{/number}","issue_comment_url":"https://api.github.com/repos/etcd-io/etcd/issues/comments{/number}","contents_url":"https://api.github.com/repos/etcd-io/etcd/contents/{+path}","compare_url":"https://api.github.com/repos/etcd-io/etcd/compare/{base}...{head}","merges_url":"https://api.github.com/repos/etcd-io/etcd/merges","archive_url":"https://api.github.com/repos/etcd-io/etcd/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/etcd-io/etcd/downloads","issues_url":"https://api.github.com/repos/etcd-io/etcd/issues{/number}","pulls_url":"https://api.github.com/repos/etcd-io/etcd/pulls{/number}","milestones_url":"https://api.github.com/repos/etcd-io/etcd/milestones{/number}","notifications_url":"https://api.github.com/repos/etcd-io/etcd/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/etcd-io/etcd/labels{/name}","releases_url":"https://api.github.com/repos/etcd-io/etcd/releases{/id}","deployments_url":"https://api.github.com/repos/etcd-io/etcd/deployments","created_at":"2013-07-06T21:57:21Z","updated_at":"2025-11-09T18:54:09Z","pushed_at":"2025-11-09T18:54:04Z","git_url":"git://github.com/etcd-io/etcd.git","ssh_url":"git@github.com:etcd-io/etcd.git","clone_url":"https://github.com/etcd-io/etcd.git","svn_url":"https://github.com/etcd-io/etcd","homepage":"https://etcd.io","size":93104,"stargazers_count":50733,"watchers_count":50733,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":10207,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":225,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cncf","consensus","database","distributed-database","distributed-systems","etcd","go","key-value","kubernetes","raft"],"visibility":"public","forks":10207,"open_issues":225,"watchers":50733,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/etcd-io/etcd/pulls/12549","html_url":"https://github.com/etcd-io/etcd/pull/12549","diff_url":"https://github.com/etcd-io/etcd/pull/12549.diff","patch_url":"https://github.com/etcd-io/etcd/pull/12549.patch","merged_at":"2020-12-30T03:08:15Z"},"body":"Old etcdserver which have not apply pr of #12165 will check auth token\r\neven if the request is an Authenticate request.\r\n\r\nIf the client has a invalid auth token, it will not able to update it's\r\ntoken, since the Authenticate has a invalid auth token.\r\nThis fix clear the auth token when encounter an ErrInvalidAuthToken to\r\ntalk with old version etcd servers.\r\nWith pr #12165 and #12264 this will fix the problem in #12385 \r\n\r\nFix #12385 \r\n","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/12549/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/etcd-io/etcd/issues/12549/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":4149989318,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQxNDk5ODkzMTg=","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4149989318","actor":{"login":"bbiao","id":41536,"node_id":"MDQ6VXNlcjQxNTM2","avatar_url":"https://avatars.githubusercontent.com/u/41536?v=4","gravatar_id":"","url":"https://api.github.com/users/bbiao","html_url":"https://github.com/bbiao","followers_url":"https://api.github.com/users/bbiao/followers","following_url":"https://api.github.com/users/bbiao/following{/other_user}","gists_url":"https://api.github.com/users/bbiao/gists{/gist_id}","starred_url":"https://api.github.com/users/bbiao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bbiao/subscriptions","organizations_url":"https://api.github.com/users/bbiao/orgs","repos_url":"https://api.github.com/users/bbiao/repos","events_url":"https://api.github.com/users/bbiao/events{/privacy}","received_events_url":"https://api.github.com/users/bbiao/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"af4ef4ec04551229f59fbc4daec211a20bb0189c","commit_url":"https://api.github.com/repos/bbiao/etcd/commits/af4ef4ec04551229f59fbc4daec211a20bb0189c","created_at":"2020-12-27T03:08:55Z","performed_via_github_app":null},{"id":4156166811,"node_id":"MDExOkNsb3NlZEV2ZW50NDE1NjE2NjgxMQ==","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4156166811","actor":{"login":"spzala","id":6462877,"node_id":"MDQ6VXNlcjY0NjI4Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/6462877?v=4","gravatar_id":"","url":"https://api.github.com/users/spzala","html_url":"https://github.com/spzala","followers_url":"https://api.github.com/users/spzala/followers","following_url":"https://api.github.com/users/spzala/following{/other_user}","gists_url":"https://api.github.com/users/spzala/gists{/gist_id}","starred_url":"https://api.github.com/users/spzala/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spzala/subscriptions","organizations_url":"https://api.github.com/users/spzala/orgs","repos_url":"https://api.github.com/users/spzala/repos","events_url":"https://api.github.com/users/spzala/events{/privacy}","received_events_url":"https://api.github.com/users/spzala/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-12-30T03:08:15Z","state_reason":null,"performed_via_github_app":null},{"id":4241677772,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQyNDE2Nzc3NzI=","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4241677772","actor":{"login":"agargi","id":11611178,"node_id":"MDQ6VXNlcjExNjExMTc4","avatar_url":"https://avatars.githubusercontent.com/u/11611178?v=4","gravatar_id":"","url":"https://api.github.com/users/agargi","html_url":"https://github.com/agargi","followers_url":"https://api.github.com/users/agargi/followers","following_url":"https://api.github.com/users/agargi/following{/other_user}","gists_url":"https://api.github.com/users/agargi/gists{/gist_id}","starred_url":"https://api.github.com/users/agargi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agargi/subscriptions","organizations_url":"https://api.github.com/users/agargi/orgs","repos_url":"https://api.github.com/users/agargi/repos","events_url":"https://api.github.com/users/agargi/events{/privacy}","received_events_url":"https://api.github.com/users/agargi/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"85f687a72ef46e42197c04819501322b419d4bb4","commit_url":"https://api.github.com/repos/agargi/etcd/commits/85f687a72ef46e42197c04819501322b419d4bb4","created_at":"2021-01-23T16:12:35Z","performed_via_github_app":null},{"actor":{"login":"cfz","id":1214480,"node_id":"MDQ6VXNlcjEyMTQ0ODA=","avatar_url":"https://avatars.githubusercontent.com/u/1214480?v=4","gravatar_id":"","url":"https://api.github.com/users/cfz","html_url":"https://github.com/cfz","followers_url":"https://api.github.com/users/cfz/followers","following_url":"https://api.github.com/users/cfz/following{/other_user}","gists_url":"https://api.github.com/users/cfz/gists{/gist_id}","starred_url":"https://api.github.com/users/cfz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cfz/subscriptions","organizations_url":"https://api.github.com/users/cfz/orgs","repos_url":"https://api.github.com/users/cfz/repos","events_url":"https://api.github.com/users/cfz/events{/privacy}","received_events_url":"https://api.github.com/users/cfz/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-23T08:37:15Z","updated_at":"2021-10-23T08:37:15Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/13413","repository_url":"https://api.github.com/repos/etcd-io/etcd","labels_url":"https://api.github.com/repos/etcd-io/etcd/issues/13413/labels{/name}","comments_url":"https://api.github.com/repos/etcd-io/etcd/issues/13413/comments","events_url":"https://api.github.com/repos/etcd-io/etcd/issues/13413/events","html_url":"https://github.com/etcd-io/etcd/issues/13413","id":1022486024,"node_id":"I_kwDOAKtHts488eYI","number":13413,"title":"clientv3 doesn't renew the auth token","user":{"login":"ljupchokotev","id":3619238,"node_id":"MDQ6VXNlcjM2MTkyMzg=","avatar_url":"https://avatars.githubusercontent.com/u/3619238?v=4","gravatar_id":"","url":"https://api.github.com/users/ljupchokotev","html_url":"https://github.com/ljupchokotev","followers_url":"https://api.github.com/users/ljupchokotev/followers","following_url":"https://api.github.com/users/ljupchokotev/following{/other_user}","gists_url":"https://api.github.com/users/ljupchokotev/gists{/gist_id}","starred_url":"https://api.github.com/users/ljupchokotev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ljupchokotev/subscriptions","organizations_url":"https://api.github.com/users/ljupchokotev/orgs","repos_url":"https://api.github.com/users/ljupchokotev/repos","events_url":"https://api.github.com/users/ljupchokotev/events{/privacy}","received_events_url":"https://api.github.com/users/ljupchokotev/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":16,"created_at":"2021-10-11T09:41:42Z","updated_at":"2024-05-16T10:10:39Z","closed_at":"2022-02-18T21:44:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":11225014,"node_id":"MDEwOlJlcG9zaXRvcnkxMTIyNTAxNA==","name":"etcd","full_name":"etcd-io/etcd","private":false,"owner":{"login":"etcd-io","id":41972792,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQxOTcyNzky","avatar_url":"https://avatars.githubusercontent.com/u/41972792?v=4","gravatar_id":"","url":"https://api.github.com/users/etcd-io","html_url":"https://github.com/etcd-io","followers_url":"https://api.github.com/users/etcd-io/followers","following_url":"https://api.github.com/users/etcd-io/following{/other_user}","gists_url":"https://api.github.com/users/etcd-io/gists{/gist_id}","starred_url":"https://api.github.com/users/etcd-io/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/etcd-io/subscriptions","organizations_url":"https://api.github.com/users/etcd-io/orgs","repos_url":"https://api.github.com/users/etcd-io/repos","events_url":"https://api.github.com/users/etcd-io/events{/privacy}","received_events_url":"https://api.github.com/users/etcd-io/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/etcd-io/etcd","description":"Distributed reliable key-value store for the most critical data of a distributed system","fork":false,"url":"https://api.github.com/repos/etcd-io/etcd","forks_url":"https://api.github.com/repos/etcd-io/etcd/forks","keys_url":"https://api.github.com/repos/etcd-io/etcd/keys{/key_id}","collaborators_url":"https://api.github.com/repos/etcd-io/etcd/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/etcd-io/etcd/teams","hooks_url":"https://api.github.com/repos/etcd-io/etcd/hooks","issue_events_url":"https://api.github.com/repos/etcd-io/etcd/issues/events{/number}","events_url":"https://api.github.com/repos/etcd-io/etcd/events","assignees_url":"https://api.github.com/repos/etcd-io/etcd/assignees{/user}","branches_url":"https://api.github.com/repos/etcd-io/etcd/branches{/branch}","tags_url":"https://api.github.com/repos/etcd-io/etcd/tags","blobs_url":"https://api.github.com/repos/etcd-io/etcd/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/etcd-io/etcd/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/etcd-io/etcd/git/refs{/sha}","trees_url":"https://api.github.com/repos/etcd-io/etcd/git/trees{/sha}","statuses_url":"https://api.github.com/repos/etcd-io/etcd/statuses/{sha}","languages_url":"https://api.github.com/repos/etcd-io/etcd/languages","stargazers_url":"https://api.github.com/repos/etcd-io/etcd/stargazers","contributors_url":"https://api.github.com/repos/etcd-io/etcd/contributors","subscribers_url":"https://api.github.com/repos/etcd-io/etcd/subscribers","subscription_url":"https://api.github.com/repos/etcd-io/etcd/subscription","commits_url":"https://api.github.com/repos/etcd-io/etcd/commits{/sha}","git_commits_url":"https://api.github.com/repos/etcd-io/etcd/git/commits{/sha}","comments_url":"https://api.github.com/repos/etcd-io/etcd/comments{/number}","issue_comment_url":"https://api.github.com/repos/etcd-io/etcd/issues/comments{/number}","contents_url":"https://api.github.com/repos/etcd-io/etcd/contents/{+path}","compare_url":"https://api.github.com/repos/etcd-io/etcd/compare/{base}...{head}","merges_url":"https://api.github.com/repos/etcd-io/etcd/merges","archive_url":"https://api.github.com/repos/etcd-io/etcd/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/etcd-io/etcd/downloads","issues_url":"https://api.github.com/repos/etcd-io/etcd/issues{/number}","pulls_url":"https://api.github.com/repos/etcd-io/etcd/pulls{/number}","milestones_url":"https://api.github.com/repos/etcd-io/etcd/milestones{/number}","notifications_url":"https://api.github.com/repos/etcd-io/etcd/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/etcd-io/etcd/labels{/name}","releases_url":"https://api.github.com/repos/etcd-io/etcd/releases{/id}","deployments_url":"https://api.github.com/repos/etcd-io/etcd/deployments","created_at":"2013-07-06T21:57:21Z","updated_at":"2025-11-09T18:54:09Z","pushed_at":"2025-11-09T18:54:04Z","git_url":"git://github.com/etcd-io/etcd.git","ssh_url":"git@github.com:etcd-io/etcd.git","clone_url":"https://github.com/etcd-io/etcd.git","svn_url":"https://github.com/etcd-io/etcd","homepage":"https://etcd.io","size":93104,"stargazers_count":50733,"watchers_count":50733,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":10207,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":225,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cncf","consensus","database","distributed-database","distributed-systems","etcd","go","key-value","kubernetes","raft"],"visibility":"public","forks":10207,"open_issues":225,"watchers":50733,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"The etcd clientv3 doesn't renew the auth token when it expires, it just fails with `invalid auth token`. It happens with both simple and jwt token types.\r\n\r\nSteps to reproduce:\r\n1. Start etcd with `etcd --auth-token simple --auth-token-ttl 5`\r\n2. Enable authentication\r\n```shell\r\netcdctl user add root\r\netcdctl user  grant-role  root root\r\netcdctl auth enable\r\n# Verify that it works\r\netcdctl --user root:root put test test\r\netcdctl --user root:root get test\r\n```\r\n3. Run the following Go program\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"context\"\r\n\t\"fmt\"\r\n\t\"log\"\r\n\t\"time\"\r\n\r\n\tclientv3 \"go.etcd.io/etcd/client/v3\"\r\n\t\"google.golang.org/grpc\"\r\n)\r\n\r\nfunc main() {\r\n\tclient, err := clientv3.New(clientv3.Config{\r\n\t\tContext:   context.Background(),\r\n\t\tEndpoints: []string{\"127.0.0.1:2379\"},\r\n\t\tUsername:  \"root\",\r\n\t\tPassword:  \"root\",\r\n\t\tDialOptions: []grpc.DialOption{\r\n\t\t\tgrpc.WithBlock(),\r\n\t\t},\r\n\t})\r\n\tif err != nil {\r\n\t\tlog.Fatal(err)\r\n\t}\r\n\r\n\tresp, err := client.Get(context.Background(), \"test\")\r\n\tif err != nil {\r\n\t\tlog.Fatal(err)\r\n\t}\r\n\r\n\tfmt.Println(resp.Kvs)\r\n\r\n\ttime.Sleep(6 * time.Second)\r\n\r\n\t_, err = client.Get(context.Background(), \"test\")\r\n\tif err != nil {\r\n\t\tlog.Fatal(err)\r\n\t}\r\n}\r\n```\r\n\r\nOutput:\r\n```\r\n[key:\"test\" create_revision:2 mod_revision:2 version:1 value:\"test\" ]\r\n{\"level\":\"warn\",\"ts\":\"2021-10-11T11:38:59.474+0200\",\"logger\":\"etcd-client\",\"caller\":\"v3@v3.5.0/retry_interceptor.go:62\",\"msg\":\"retrying of unary invoker failed\",\"target\":\"etcd-endpoints://0xc0001ef180/#initially=[127.0.0.1:2379]\",\"attempt\":0,\"error\":\"rpc error: code = Unauthenticated desc = etcdserver: invalid auth token\"}\r\n```\r\nAs you can see, the first `client.Get` succeeded in fetching the `test` key, but the second one fails with `invalid auth token`.\r\n\r\nAm I missing something simple here?\r\n\r\nEDIT: If you make 10 requests while sleeping for 1 second in-between, the error does not show up.\r\n\r\n```go\r\n\tfor i := 1; i <= 10; i++ {\r\n\t\ttime.Sleep(1 * time.Second)\r\n                // no error\r\n\t\tresp, err := client.Get(context.Background(), \"test\")\r\n\t\tif err != nil {\r\n\t\t\tlog.Fatal(err)\r\n\t\t}\r\n\r\n\t\tfmt.Println(resp.Kvs)\r\n\t}\r\n\r\n\ttime.Sleep(6 * time.Second)\r\n        // return invalid auth token error\r\n\t_, err = client.Get(context.Background(), \"test\")\r\n\tif err != nil {\r\n\t\tlog.Fatal(err)\r\n\t}\r\n```","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/13413/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/etcd-io/etcd/issues/13413/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":5829881732,"node_id":"REFE_lADOAKtHts4q1UJczwAAAAFbfO-E","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/5829881732","actor":{"login":"sayap","id":837049,"node_id":"MDQ6VXNlcjgzNzA0OQ==","avatar_url":"https://avatars.githubusercontent.com/u/837049?v=4","gravatar_id":"","url":"https://api.github.com/users/sayap","html_url":"https://github.com/sayap","followers_url":"https://api.github.com/users/sayap/followers","following_url":"https://api.github.com/users/sayap/following{/other_user}","gists_url":"https://api.github.com/users/sayap/gists{/gist_id}","starred_url":"https://api.github.com/users/sayap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sayap/subscriptions","organizations_url":"https://api.github.com/users/sayap/orgs","repos_url":"https://api.github.com/users/sayap/repos","events_url":"https://api.github.com/users/sayap/events{/privacy}","received_events_url":"https://api.github.com/users/sayap/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"905d3f48c63a71e18a85827db757d3970832e94b","commit_url":"https://api.github.com/repos/sayap/etcd/commits/905d3f48c63a71e18a85827db757d3970832e94b","created_at":"2021-12-31T07:12:07Z","performed_via_github_app":null},{"id":5829921936,"node_id":"REFE_lADOAKtHts4q1UJczwAAAAFbfYyQ","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/5829921936","actor":{"login":"sayap","id":837049,"node_id":"MDQ6VXNlcjgzNzA0OQ==","avatar_url":"https://avatars.githubusercontent.com/u/837049?v=4","gravatar_id":"","url":"https://api.github.com/users/sayap","html_url":"https://github.com/sayap","followers_url":"https://api.github.com/users/sayap/followers","following_url":"https://api.github.com/users/sayap/following{/other_user}","gists_url":"https://api.github.com/users/sayap/gists{/gist_id}","starred_url":"https://api.github.com/users/sayap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sayap/subscriptions","organizations_url":"https://api.github.com/users/sayap/orgs","repos_url":"https://api.github.com/users/sayap/repos","events_url":"https://api.github.com/users/sayap/events{/privacy}","received_events_url":"https://api.github.com/users/sayap/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"17fd2e72822146e9a486bb4c08ae620af0946052","commit_url":"https://api.github.com/repos/sayap/etcd/commits/17fd2e72822146e9a486bb4c08ae620af0946052","created_at":"2021-12-31T07:40:22Z","performed_via_github_app":null},{"actor":{"login":"sayap","id":837049,"node_id":"MDQ6VXNlcjgzNzA0OQ==","avatar_url":"https://avatars.githubusercontent.com/u/837049?v=4","gravatar_id":"","url":"https://api.github.com/users/sayap","html_url":"https://github.com/sayap","followers_url":"https://api.github.com/users/sayap/followers","following_url":"https://api.github.com/users/sayap/following{/other_user}","gists_url":"https://api.github.com/users/sayap/gists{/gist_id}","starred_url":"https://api.github.com/users/sayap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sayap/subscriptions","organizations_url":"https://api.github.com/users/sayap/orgs","repos_url":"https://api.github.com/users/sayap/repos","events_url":"https://api.github.com/users/sayap/events{/privacy}","received_events_url":"https://api.github.com/users/sayap/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-31T07:42:59Z","updated_at":"2021-12-31T07:42:59Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/13577","repository_url":"https://api.github.com/repos/etcd-io/etcd","labels_url":"https://api.github.com/repos/etcd-io/etcd/issues/13577/labels{/name}","comments_url":"https://api.github.com/repos/etcd-io/etcd/issues/13577/comments","events_url":"https://api.github.com/repos/etcd-io/etcd/issues/13577/events","html_url":"https://github.com/etcd-io/etcd/pull/13577","id":1091460203,"node_id":"PR_kwDOAKtHts4wal3r","number":13577,"title":"Disable auth gracefully without impacting existing watchers","user":{"login":"sayap","id":837049,"node_id":"MDQ6VXNlcjgzNzA0OQ==","avatar_url":"https://avatars.githubusercontent.com/u/837049?v=4","gravatar_id":"","url":"https://api.github.com/users/sayap","html_url":"https://github.com/sayap","followers_url":"https://api.github.com/users/sayap/followers","following_url":"https://api.github.com/users/sayap/following{/other_user}","gists_url":"https://api.github.com/users/sayap/gists{/gist_id}","starred_url":"https://api.github.com/users/sayap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sayap/subscriptions","organizations_url":"https://api.github.com/users/sayap/orgs","repos_url":"https://api.github.com/users/sayap/repos","events_url":"https://api.github.com/users/sayap/events{/privacy}","received_events_url":"https://api.github.com/users/sayap/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1534662666,"node_id":"MDU6TGFiZWwxNTM0NjYyNjY2","url":"https://api.github.com/repos/etcd-io/etcd/labels/backport/v3.4","name":"backport/v3.4","color":"b0d2fc","default":false,"description":""},{"id":3008306347,"node_id":"MDU6TGFiZWwzMDA4MzA2MzQ3","url":"https://api.github.com/repos/etcd-io/etcd/labels/backport/v3.5","name":"backport/v3.5","color":"CC33AB","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2021-12-31T07:42:59Z","updated_at":"2023-07-13T17:15:13Z","closed_at":"2022-01-04T01:02:21Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":11225014,"node_id":"MDEwOlJlcG9zaXRvcnkxMTIyNTAxNA==","name":"etcd","full_name":"etcd-io/etcd","private":false,"owner":{"login":"etcd-io","id":41972792,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQxOTcyNzky","avatar_url":"https://avatars.githubusercontent.com/u/41972792?v=4","gravatar_id":"","url":"https://api.github.com/users/etcd-io","html_url":"https://github.com/etcd-io","followers_url":"https://api.github.com/users/etcd-io/followers","following_url":"https://api.github.com/users/etcd-io/following{/other_user}","gists_url":"https://api.github.com/users/etcd-io/gists{/gist_id}","starred_url":"https://api.github.com/users/etcd-io/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/etcd-io/subscriptions","organizations_url":"https://api.github.com/users/etcd-io/orgs","repos_url":"https://api.github.com/users/etcd-io/repos","events_url":"https://api.github.com/users/etcd-io/events{/privacy}","received_events_url":"https://api.github.com/users/etcd-io/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/etcd-io/etcd","description":"Distributed reliable key-value store for the most critical data of a distributed system","fork":false,"url":"https://api.github.com/repos/etcd-io/etcd","forks_url":"https://api.github.com/repos/etcd-io/etcd/forks","keys_url":"https://api.github.com/repos/etcd-io/etcd/keys{/key_id}","collaborators_url":"https://api.github.com/repos/etcd-io/etcd/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/etcd-io/etcd/teams","hooks_url":"https://api.github.com/repos/etcd-io/etcd/hooks","issue_events_url":"https://api.github.com/repos/etcd-io/etcd/issues/events{/number}","events_url":"https://api.github.com/repos/etcd-io/etcd/events","assignees_url":"https://api.github.com/repos/etcd-io/etcd/assignees{/user}","branches_url":"https://api.github.com/repos/etcd-io/etcd/branches{/branch}","tags_url":"https://api.github.com/repos/etcd-io/etcd/tags","blobs_url":"https://api.github.com/repos/etcd-io/etcd/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/etcd-io/etcd/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/etcd-io/etcd/git/refs{/sha}","trees_url":"https://api.github.com/repos/etcd-io/etcd/git/trees{/sha}","statuses_url":"https://api.github.com/repos/etcd-io/etcd/statuses/{sha}","languages_url":"https://api.github.com/repos/etcd-io/etcd/languages","stargazers_url":"https://api.github.com/repos/etcd-io/etcd/stargazers","contributors_url":"https://api.github.com/repos/etcd-io/etcd/contributors","subscribers_url":"https://api.github.com/repos/etcd-io/etcd/subscribers","subscription_url":"https://api.github.com/repos/etcd-io/etcd/subscription","commits_url":"https://api.github.com/repos/etcd-io/etcd/commits{/sha}","git_commits_url":"https://api.github.com/repos/etcd-io/etcd/git/commits{/sha}","comments_url":"https://api.github.com/repos/etcd-io/etcd/comments{/number}","issue_comment_url":"https://api.github.com/repos/etcd-io/etcd/issues/comments{/number}","contents_url":"https://api.github.com/repos/etcd-io/etcd/contents/{+path}","compare_url":"https://api.github.com/repos/etcd-io/etcd/compare/{base}...{head}","merges_url":"https://api.github.com/repos/etcd-io/etcd/merges","archive_url":"https://api.github.com/repos/etcd-io/etcd/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/etcd-io/etcd/downloads","issues_url":"https://api.github.com/repos/etcd-io/etcd/issues{/number}","pulls_url":"https://api.github.com/repos/etcd-io/etcd/pulls{/number}","milestones_url":"https://api.github.com/repos/etcd-io/etcd/milestones{/number}","notifications_url":"https://api.github.com/repos/etcd-io/etcd/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/etcd-io/etcd/labels{/name}","releases_url":"https://api.github.com/repos/etcd-io/etcd/releases{/id}","deployments_url":"https://api.github.com/repos/etcd-io/etcd/deployments","created_at":"2013-07-06T21:57:21Z","updated_at":"2025-11-09T18:54:09Z","pushed_at":"2025-11-09T18:54:04Z","git_url":"git://github.com/etcd-io/etcd.git","ssh_url":"git@github.com:etcd-io/etcd.git","clone_url":"https://github.com/etcd-io/etcd.git","svn_url":"https://github.com/etcd-io/etcd","homepage":"https://etcd.io","size":93104,"stargazers_count":50733,"watchers_count":50733,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":10207,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":225,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cncf","consensus","database","distributed-database","distributed-systems","etcd","go","key-value","kubernetes","raft"],"visibility":"public","forks":10207,"open_issues":225,"watchers":50733,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/etcd-io/etcd/pulls/13577","html_url":"https://github.com/etcd-io/etcd/pull/13577","diff_url":"https://github.com/etcd-io/etcd/pull/13577.diff","patch_url":"https://github.com/etcd-io/etcd/pull/13577.patch","merged_at":"2022-01-04T01:02:21Z"},"body":"This attempts to fix a special case of the problem described in #12385,\r\nwhere trying to do `clientv3.Watch` with an expired token would result\r\nin `ErrGRPCPermissionDenied`, due to the failing authorization check in\r\n`isWatchPermitted`. Furthermore, the client can't auto recover, since\r\n`shouldRefreshToken` rightly returns false for the permission denied\r\nerror.\r\n\r\nIn this case, we would like to have a runbook to dynamically disable\r\nauth, without causing any disruption. Doing so would immediately expire\r\nall existing tokens, which would then cause the behavior described\r\nabove. This means existing watchers would still work for a period of\r\ntime after disabling auth, until they have to reconnect, e.g. due to a\r\nrolling restart of server nodes.\r\n\r\nThis commit adds a client-side fix and a server-side fix, either of\r\nwhich is sufficient to get the added test case to pass. Note that it is\r\nan e2e test case instead of an integration one, as the reconnect only\r\nhappens if the server node is stopped via SIGINT or SIGTERM.\r\n\r\nA generic fix for the problem described in #12385 would be better, as\r\nthat shall also fix this special case. However, the fix would likely be\r\na lot more involved, as some untangling of authn/authz is required.","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/13577/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/etcd-io/etcd/issues/13577/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1155279250","html_url":"https://github.com/etcd-io/etcd/issues/12385#issuecomment-1155279250","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12385","id":1155279250,"node_id":"IC_kwDOAKtHts5E3CmS","user":{"login":"jwebb","id":452827,"node_id":"MDQ6VXNlcjQ1MjgyNw==","avatar_url":"https://avatars.githubusercontent.com/u/452827?v=4","gravatar_id":"","url":"https://api.github.com/users/jwebb","html_url":"https://github.com/jwebb","followers_url":"https://api.github.com/users/jwebb/followers","following_url":"https://api.github.com/users/jwebb/following{/other_user}","gists_url":"https://api.github.com/users/jwebb/gists{/gist_id}","starred_url":"https://api.github.com/users/jwebb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jwebb/subscriptions","organizations_url":"https://api.github.com/users/jwebb/orgs","repos_url":"https://api.github.com/users/jwebb/repos","events_url":"https://api.github.com/users/jwebb/events{/privacy}","received_events_url":"https://api.github.com/users/jwebb/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-06-14T14:34:52Z","updated_at":"2022-06-14T14:34:52Z","body":"This ticket is closed, but I can still reproduce this exactly as described by OP (except import path is `/v3` now) using both client and server at v3.5.4. Are the assumptions in the original report not valid?\r\n\r\nI just want to watch a key indefinitely, but this seems currently not to work in conjuction with authentication tokens.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1155279250/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jwebb","id":452827,"node_id":"MDQ6VXNlcjQ1MjgyNw==","avatar_url":"https://avatars.githubusercontent.com/u/452827?v=4","gravatar_id":"","url":"https://api.github.com/users/jwebb","html_url":"https://github.com/jwebb","followers_url":"https://api.github.com/users/jwebb/followers","following_url":"https://api.github.com/users/jwebb/following{/other_user}","gists_url":"https://api.github.com/users/jwebb/gists{/gist_id}","starred_url":"https://api.github.com/users/jwebb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jwebb/subscriptions","organizations_url":"https://api.github.com/users/jwebb/orgs","repos_url":"https://api.github.com/users/jwebb/repos","events_url":"https://api.github.com/users/jwebb/events{/privacy}","received_events_url":"https://api.github.com/users/jwebb/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1155986348","html_url":"https://github.com/etcd-io/etcd/issues/12385#issuecomment-1155986348","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12385","id":1155986348,"node_id":"IC_kwDOAKtHts5E5vOs","user":{"login":"sayap","id":837049,"node_id":"MDQ6VXNlcjgzNzA0OQ==","avatar_url":"https://avatars.githubusercontent.com/u/837049?v=4","gravatar_id":"","url":"https://api.github.com/users/sayap","html_url":"https://github.com/sayap","followers_url":"https://api.github.com/users/sayap/followers","following_url":"https://api.github.com/users/sayap/following{/other_user}","gists_url":"https://api.github.com/users/sayap/gists{/gist_id}","starred_url":"https://api.github.com/users/sayap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sayap/subscriptions","organizations_url":"https://api.github.com/users/sayap/orgs","repos_url":"https://api.github.com/users/sayap/repos","events_url":"https://api.github.com/users/sayap/events{/privacy}","received_events_url":"https://api.github.com/users/sayap/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-06-15T04:55:26Z","updated_at":"2022-06-15T04:55:26Z","body":"This bug should still be reproducible, due to the problem I described in #13577:\r\n\r\n>  ... trying to do clientv3.Watch with an expired token would result\r\nin ErrGRPCPermissionDenied, due to the failing authorization check in\r\nisWatchPermitted. Furthermore, the client can't auto recover, since\r\nshouldRefreshToken rightly returns false for the permission denied\r\nerror.\r\n\r\nThe commit from that PR only fixed a special case of the problem, where all the tokens expired after disabling authentication. It doesn't fix the problem where a token expired naturally.\r\n\r\nLast I checked, the root cause is that `isWatchPermitted` is wearing both authorization and authentication hats. The code has to be modified such that `isWatchPermitted` is only called with a legitimate token and thus only has to worry about authorization.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1155986348/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sayap","id":837049,"node_id":"MDQ6VXNlcjgzNzA0OQ==","avatar_url":"https://avatars.githubusercontent.com/u/837049?v=4","gravatar_id":"","url":"https://api.github.com/users/sayap","html_url":"https://github.com/sayap","followers_url":"https://api.github.com/users/sayap/followers","following_url":"https://api.github.com/users/sayap/following{/other_user}","gists_url":"https://api.github.com/users/sayap/gists{/gist_id}","starred_url":"https://api.github.com/users/sayap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sayap/subscriptions","organizations_url":"https://api.github.com/users/sayap/orgs","repos_url":"https://api.github.com/users/sayap/repos","events_url":"https://api.github.com/users/sayap/events{/privacy}","received_events_url":"https://api.github.com/users/sayap/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1156526837","html_url":"https://github.com/etcd-io/etcd/issues/12385#issuecomment-1156526837","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12385","id":1156526837,"node_id":"IC_kwDOAKtHts5E7zL1","user":{"login":"mitake","id":1173955,"node_id":"MDQ6VXNlcjExNzM5NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mitake","html_url":"https://github.com/mitake","followers_url":"https://api.github.com/users/mitake/followers","following_url":"https://api.github.com/users/mitake/following{/other_user}","gists_url":"https://api.github.com/users/mitake/gists{/gist_id}","starred_url":"https://api.github.com/users/mitake/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitake/subscriptions","organizations_url":"https://api.github.com/users/mitake/orgs","repos_url":"https://api.github.com/users/mitake/repos","events_url":"https://api.github.com/users/mitake/events{/privacy}","received_events_url":"https://api.github.com/users/mitake/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-06-15T14:11:59Z","updated_at":"2022-06-15T14:11:59Z","body":"Hmm I see... let me reproduce the issue on my side.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1156526837/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mitake","id":1173955,"node_id":"MDQ6VXNlcjExNzM5NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mitake","html_url":"https://github.com/mitake","followers_url":"https://api.github.com/users/mitake/followers","following_url":"https://api.github.com/users/mitake/following{/other_user}","gists_url":"https://api.github.com/users/mitake/gists{/gist_id}","starred_url":"https://api.github.com/users/mitake/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitake/subscriptions","organizations_url":"https://api.github.com/users/mitake/orgs","repos_url":"https://api.github.com/users/mitake/repos","events_url":"https://api.github.com/users/mitake/events{/privacy}","received_events_url":"https://api.github.com/users/mitake/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1173103821","html_url":"https://github.com/etcd-io/etcd/issues/12385#issuecomment-1173103821","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12385","id":1173103821,"node_id":"IC_kwDOAKtHts5F7CTN","user":{"login":"mitake","id":1173955,"node_id":"MDQ6VXNlcjExNzM5NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mitake","html_url":"https://github.com/mitake","followers_url":"https://api.github.com/users/mitake/followers","following_url":"https://api.github.com/users/mitake/following{/other_user}","gists_url":"https://api.github.com/users/mitake/gists{/gist_id}","starred_url":"https://api.github.com/users/mitake/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitake/subscriptions","organizations_url":"https://api.github.com/users/mitake/orgs","repos_url":"https://api.github.com/users/mitake/repos","events_url":"https://api.github.com/users/mitake/events{/privacy}","received_events_url":"https://api.github.com/users/mitake/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-03T14:42:03Z","updated_at":"2022-07-03T14:42:03Z","body":"Sorry for delayed update, I'll be able to check the issue sometime this week.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1173103821/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mitake","id":1173955,"node_id":"MDQ6VXNlcjExNzM5NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mitake","html_url":"https://github.com/mitake","followers_url":"https://api.github.com/users/mitake/followers","following_url":"https://api.github.com/users/mitake/following{/other_user}","gists_url":"https://api.github.com/users/mitake/gists{/gist_id}","starred_url":"https://api.github.com/users/mitake/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitake/subscriptions","organizations_url":"https://api.github.com/users/mitake/orgs","repos_url":"https://api.github.com/users/mitake/repos","events_url":"https://api.github.com/users/mitake/events{/privacy}","received_events_url":"https://api.github.com/users/mitake/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1179557733","html_url":"https://github.com/etcd-io/etcd/issues/12385#issuecomment-1179557733","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12385","id":1179557733,"node_id":"IC_kwDOAKtHts5GTp9l","user":{"login":"mitake","id":1173955,"node_id":"MDQ6VXNlcjExNzM5NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mitake","html_url":"https://github.com/mitake","followers_url":"https://api.github.com/users/mitake/followers","following_url":"https://api.github.com/users/mitake/following{/other_user}","gists_url":"https://api.github.com/users/mitake/gists{/gist_id}","starred_url":"https://api.github.com/users/mitake/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitake/subscriptions","organizations_url":"https://api.github.com/users/mitake/orgs","repos_url":"https://api.github.com/users/mitake/repos","events_url":"https://api.github.com/users/mitake/events{/privacy}","received_events_url":"https://api.github.com/users/mitake/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-09T14:57:20Z","updated_at":"2022-07-09T14:57:20Z","body":"I could reproduce the bug on the latest main branch... Let me reopen the issue and handle it.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1179557733/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mitake","id":1173955,"node_id":"MDQ6VXNlcjExNzM5NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mitake","html_url":"https://github.com/mitake","followers_url":"https://api.github.com/users/mitake/followers","following_url":"https://api.github.com/users/mitake/following{/other_user}","gists_url":"https://api.github.com/users/mitake/gists{/gist_id}","starred_url":"https://api.github.com/users/mitake/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitake/subscriptions","organizations_url":"https://api.github.com/users/mitake/orgs","repos_url":"https://api.github.com/users/mitake/repos","events_url":"https://api.github.com/users/mitake/events{/privacy}","received_events_url":"https://api.github.com/users/mitake/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6964041578,"node_id":"REE_lADOAKtHts4q1UJczwAAAAGfFtdq","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/6964041578","actor":{"login":"mitake","id":1173955,"node_id":"MDQ6VXNlcjExNzM5NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mitake","html_url":"https://github.com/mitake","followers_url":"https://api.github.com/users/mitake/followers","following_url":"https://api.github.com/users/mitake/following{/other_user}","gists_url":"https://api.github.com/users/mitake/gists{/gist_id}","starred_url":"https://api.github.com/users/mitake/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitake/subscriptions","organizations_url":"https://api.github.com/users/mitake/orgs","repos_url":"https://api.github.com/users/mitake/repos","events_url":"https://api.github.com/users/mitake/events{/privacy}","received_events_url":"https://api.github.com/users/mitake/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2022-07-09T14:57:20Z","state_reason":"reopened","performed_via_github_app":null},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1200439111","html_url":"https://github.com/etcd-io/etcd/issues/12385#issuecomment-1200439111","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12385","id":1200439111,"node_id":"IC_kwDOAKtHts5HjT9H","user":{"login":"mitake","id":1173955,"node_id":"MDQ6VXNlcjExNzM5NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mitake","html_url":"https://github.com/mitake","followers_url":"https://api.github.com/users/mitake/followers","following_url":"https://api.github.com/users/mitake/following{/other_user}","gists_url":"https://api.github.com/users/mitake/gists{/gist_id}","starred_url":"https://api.github.com/users/mitake/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitake/subscriptions","organizations_url":"https://api.github.com/users/mitake/orgs","repos_url":"https://api.github.com/users/mitake/repos","events_url":"https://api.github.com/users/mitake/events{/privacy}","received_events_url":"https://api.github.com/users/mitake/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-31T14:44:19Z","updated_at":"2022-07-31T14:44:19Z","body":"This is the branch for the fix: https://github.com/mitake/etcd/tree/watch-auth-err I'll open a PR after finalizing it.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1200439111/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mitake","id":1173955,"node_id":"MDQ6VXNlcjExNzM5NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mitake","html_url":"https://github.com/mitake","followers_url":"https://api.github.com/users/mitake/followers","following_url":"https://api.github.com/users/mitake/following{/other_user}","gists_url":"https://api.github.com/users/mitake/gists{/gist_id}","starred_url":"https://api.github.com/users/mitake/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitake/subscriptions","organizations_url":"https://api.github.com/users/mitake/orgs","repos_url":"https://api.github.com/users/mitake/repos","events_url":"https://api.github.com/users/mitake/events{/privacy}","received_events_url":"https://api.github.com/users/mitake/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"kafuu-chino","id":12246138,"node_id":"MDQ6VXNlcjEyMjQ2MTM4","avatar_url":"https://avatars.githubusercontent.com/u/12246138?v=4","gravatar_id":"","url":"https://api.github.com/users/kafuu-chino","html_url":"https://github.com/kafuu-chino","followers_url":"https://api.github.com/users/kafuu-chino/followers","following_url":"https://api.github.com/users/kafuu-chino/following{/other_user}","gists_url":"https://api.github.com/users/kafuu-chino/gists{/gist_id}","starred_url":"https://api.github.com/users/kafuu-chino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kafuu-chino/subscriptions","organizations_url":"https://api.github.com/users/kafuu-chino/orgs","repos_url":"https://api.github.com/users/kafuu-chino/repos","events_url":"https://api.github.com/users/kafuu-chino/events{/privacy}","received_events_url":"https://api.github.com/users/kafuu-chino/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-02T11:47:03Z","updated_at":"2022-08-02T11:47:03Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/14296","repository_url":"https://api.github.com/repos/etcd-io/etcd","labels_url":"https://api.github.com/repos/etcd-io/etcd/issues/14296/labels{/name}","comments_url":"https://api.github.com/repos/etcd-io/etcd/issues/14296/comments","events_url":"https://api.github.com/repos/etcd-io/etcd/issues/14296/events","html_url":"https://github.com/etcd-io/etcd/pull/14296","id":1325733586,"node_id":"PR_kwDOAKtHts48f8pk","number":14296,"title":"Fixed unexpected cancelled watch with WatchID=0.","user":{"login":"kafuu-chino","id":12246138,"node_id":"MDQ6VXNlcjEyMjQ2MTM4","avatar_url":"https://avatars.githubusercontent.com/u/12246138?v=4","gravatar_id":"","url":"https://api.github.com/users/kafuu-chino","html_url":"https://github.com/kafuu-chino","followers_url":"https://api.github.com/users/kafuu-chino/followers","following_url":"https://api.github.com/users/kafuu-chino/following{/other_user}","gists_url":"https://api.github.com/users/kafuu-chino/gists{/gist_id}","starred_url":"https://api.github.com/users/kafuu-chino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kafuu-chino/subscriptions","organizations_url":"https://api.github.com/users/kafuu-chino/orgs","repos_url":"https://api.github.com/users/kafuu-chino/repos","events_url":"https://api.github.com/users/kafuu-chino/events{/privacy}","received_events_url":"https://api.github.com/users/kafuu-chino/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":23,"created_at":"2022-08-02T11:47:03Z","updated_at":"2022-10-08T03:50:24Z","closed_at":"2022-09-26T18:08:24Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":11225014,"node_id":"MDEwOlJlcG9zaXRvcnkxMTIyNTAxNA==","name":"etcd","full_name":"etcd-io/etcd","private":false,"owner":{"login":"etcd-io","id":41972792,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQxOTcyNzky","avatar_url":"https://avatars.githubusercontent.com/u/41972792?v=4","gravatar_id":"","url":"https://api.github.com/users/etcd-io","html_url":"https://github.com/etcd-io","followers_url":"https://api.github.com/users/etcd-io/followers","following_url":"https://api.github.com/users/etcd-io/following{/other_user}","gists_url":"https://api.github.com/users/etcd-io/gists{/gist_id}","starred_url":"https://api.github.com/users/etcd-io/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/etcd-io/subscriptions","organizations_url":"https://api.github.com/users/etcd-io/orgs","repos_url":"https://api.github.com/users/etcd-io/repos","events_url":"https://api.github.com/users/etcd-io/events{/privacy}","received_events_url":"https://api.github.com/users/etcd-io/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/etcd-io/etcd","description":"Distributed reliable key-value store for the most critical data of a distributed system","fork":false,"url":"https://api.github.com/repos/etcd-io/etcd","forks_url":"https://api.github.com/repos/etcd-io/etcd/forks","keys_url":"https://api.github.com/repos/etcd-io/etcd/keys{/key_id}","collaborators_url":"https://api.github.com/repos/etcd-io/etcd/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/etcd-io/etcd/teams","hooks_url":"https://api.github.com/repos/etcd-io/etcd/hooks","issue_events_url":"https://api.github.com/repos/etcd-io/etcd/issues/events{/number}","events_url":"https://api.github.com/repos/etcd-io/etcd/events","assignees_url":"https://api.github.com/repos/etcd-io/etcd/assignees{/user}","branches_url":"https://api.github.com/repos/etcd-io/etcd/branches{/branch}","tags_url":"https://api.github.com/repos/etcd-io/etcd/tags","blobs_url":"https://api.github.com/repos/etcd-io/etcd/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/etcd-io/etcd/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/etcd-io/etcd/git/refs{/sha}","trees_url":"https://api.github.com/repos/etcd-io/etcd/git/trees{/sha}","statuses_url":"https://api.github.com/repos/etcd-io/etcd/statuses/{sha}","languages_url":"https://api.github.com/repos/etcd-io/etcd/languages","stargazers_url":"https://api.github.com/repos/etcd-io/etcd/stargazers","contributors_url":"https://api.github.com/repos/etcd-io/etcd/contributors","subscribers_url":"https://api.github.com/repos/etcd-io/etcd/subscribers","subscription_url":"https://api.github.com/repos/etcd-io/etcd/subscription","commits_url":"https://api.github.com/repos/etcd-io/etcd/commits{/sha}","git_commits_url":"https://api.github.com/repos/etcd-io/etcd/git/commits{/sha}","comments_url":"https://api.github.com/repos/etcd-io/etcd/comments{/number}","issue_comment_url":"https://api.github.com/repos/etcd-io/etcd/issues/comments{/number}","contents_url":"https://api.github.com/repos/etcd-io/etcd/contents/{+path}","compare_url":"https://api.github.com/repos/etcd-io/etcd/compare/{base}...{head}","merges_url":"https://api.github.com/repos/etcd-io/etcd/merges","archive_url":"https://api.github.com/repos/etcd-io/etcd/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/etcd-io/etcd/downloads","issues_url":"https://api.github.com/repos/etcd-io/etcd/issues{/number}","pulls_url":"https://api.github.com/repos/etcd-io/etcd/pulls{/number}","milestones_url":"https://api.github.com/repos/etcd-io/etcd/milestones{/number}","notifications_url":"https://api.github.com/repos/etcd-io/etcd/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/etcd-io/etcd/labels{/name}","releases_url":"https://api.github.com/repos/etcd-io/etcd/releases{/id}","deployments_url":"https://api.github.com/repos/etcd-io/etcd/deployments","created_at":"2013-07-06T21:57:21Z","updated_at":"2025-11-09T18:54:09Z","pushed_at":"2025-11-09T18:54:04Z","git_url":"git://github.com/etcd-io/etcd.git","ssh_url":"git@github.com:etcd-io/etcd.git","clone_url":"https://github.com/etcd-io/etcd.git","svn_url":"https://github.com/etcd-io/etcd","homepage":"https://etcd.io","size":93104,"stargazers_count":50733,"watchers_count":50733,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":10207,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":225,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cncf","consensus","database","distributed-database","distributed-systems","etcd","go","key-value","kubernetes","raft"],"visibility":"public","forks":10207,"open_issues":225,"watchers":50733,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/etcd-io/etcd/pulls/14296","html_url":"https://github.com/etcd-io/etcd/pull/14296","diff_url":"https://github.com/etcd-io/etcd/pull/14296.diff","patch_url":"https://github.com/etcd-io/etcd/pull/14296.patch","merged_at":"2022-09-26T18:08:24Z"},"body":"etcdserver: Fixed unexpected cancelled watch with WatchID=0.\r\n\r\nI ran into the same problem from https://github.com/etcd-io/etcd/issues/12385, I found that the error will cause the watch with `WatchID=0` to be invalidso I set WatchID to start at 1 to fix it.\r\n\r\nFirst of all `WatchID=0` is semantic, it's `AutoWatchID`.\r\n\r\nSecondly when token expired, make a new watch request to server side, `serverWatchStream.isWatchPermitted` returns false, then send `WatchResponse` to `serverWatchStream.ctrlStream` with `Canceled=true`, however `WatchResponse.WatchID=creq.WatchId`, default `creq.WatchId=0`, so a watch with `WatchID=0` will be unexpectedly cancelled on the server side and client can never receive messages with `WatchID=0`.\r\n\r\n```go\r\nif !sws.isWatchPermitted(creq) {\r\n    wr := &pb.WatchResponse{\r\n        Header:       sws.newResponseHeader(sws.watchStream.Rev()),\r\n        WatchId:      creq.WatchId, // default to 0\r\n        Canceled:     true, // will delete 0 from ids\r\n        Created:      true,\r\n        CancelReason: rpctypes.ErrGRPCPermissionDenied.Error(),\r\n    }\r\n\r\n    select {\r\n        case sws.ctrlStream <- wr: // send to ctrlStream\r\n            continue\r\n        case <-sws.closec:\r\n            return nil\r\n    }\r\n}\r\n\r\n...\r\n\r\ncase c, ok := <-sws.ctrlStream: // receive from ctrlStream\r\n    if !ok {\r\n        return\r\n    }\r\n\r\n    ...\r\n\r\n    // track id creation\r\n    wid := mvcc.WatchID(c.WatchId)\r\n    if c.Canceled {\r\n        delete(ids, wid) // delete from ids and client can never receive messages\r\n        continue\r\n    }\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/14296/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/etcd-io/etcd/issues/14296/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1203583417","html_url":"https://github.com/etcd-io/etcd/issues/12385#issuecomment-1203583417","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12385","id":1203583417,"node_id":"IC_kwDOAKtHts5HvTm5","user":{"login":"kafuu-chino","id":12246138,"node_id":"MDQ6VXNlcjEyMjQ2MTM4","avatar_url":"https://avatars.githubusercontent.com/u/12246138?v=4","gravatar_id":"","url":"https://api.github.com/users/kafuu-chino","html_url":"https://github.com/kafuu-chino","followers_url":"https://api.github.com/users/kafuu-chino/followers","following_url":"https://api.github.com/users/kafuu-chino/following{/other_user}","gists_url":"https://api.github.com/users/kafuu-chino/gists{/gist_id}","starred_url":"https://api.github.com/users/kafuu-chino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kafuu-chino/subscriptions","organizations_url":"https://api.github.com/users/kafuu-chino/orgs","repos_url":"https://api.github.com/users/kafuu-chino/repos","events_url":"https://api.github.com/users/kafuu-chino/events{/privacy}","received_events_url":"https://api.github.com/users/kafuu-chino/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-03T07:24:11Z","updated_at":"2022-08-03T07:24:11Z","body":"The context on server side never change after stream created, so the token won't refresh, subsequent watches will fail after the token expires.\r\n\r\nPerRPCCredentials only called once when the stream is created:\r\nhttps://stackoverflow.com/questions/69551307/go-grpc-refresh-token-for-a-bidirectional-stream\r\n\r\n1. We only get the token once when we create the stream.\r\n2. Client is trying to reusing the same grpc stream(if avaliable) to setup new watch substream.\r\n3. The token cannot be refreshed on the server, then when the token expires, subsequent watches will fail.\r\n\r\nI think the solutions for the future:\r\n1. Create new watch stream when the token expired.\r\n2. Do refresh token in user logic, not rely on grpc.\r\n\r\nTemporary solutions:\r\n1. Create a new stream with a new ctxKey, like this:\r\n`ctx = metadata.AppendToOutgoingContext(context.Background(), \"key\", time.Now().String())`\r\n\r\n2. Set a very long TTL.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1203583417/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"kafuu-chino","id":12246138,"node_id":"MDQ6VXNlcjEyMjQ2MTM4","avatar_url":"https://avatars.githubusercontent.com/u/12246138?v=4","gravatar_id":"","url":"https://api.github.com/users/kafuu-chino","html_url":"https://github.com/kafuu-chino","followers_url":"https://api.github.com/users/kafuu-chino/followers","following_url":"https://api.github.com/users/kafuu-chino/following{/other_user}","gists_url":"https://api.github.com/users/kafuu-chino/gists{/gist_id}","starred_url":"https://api.github.com/users/kafuu-chino/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kafuu-chino/subscriptions","organizations_url":"https://api.github.com/users/kafuu-chino/orgs","repos_url":"https://api.github.com/users/kafuu-chino/repos","events_url":"https://api.github.com/users/kafuu-chino/events{/privacy}","received_events_url":"https://api.github.com/users/kafuu-chino/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1207416664","html_url":"https://github.com/etcd-io/etcd/issues/12385#issuecomment-1207416664","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12385","id":1207416664,"node_id":"IC_kwDOAKtHts5H97dY","user":{"login":"mitake","id":1173955,"node_id":"MDQ6VXNlcjExNzM5NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mitake","html_url":"https://github.com/mitake","followers_url":"https://api.github.com/users/mitake/followers","following_url":"https://api.github.com/users/mitake/following{/other_user}","gists_url":"https://api.github.com/users/mitake/gists{/gist_id}","starred_url":"https://api.github.com/users/mitake/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitake/subscriptions","organizations_url":"https://api.github.com/users/mitake/orgs","repos_url":"https://api.github.com/users/mitake/repos","events_url":"https://api.github.com/users/mitake/events{/privacy}","received_events_url":"https://api.github.com/users/mitake/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-07T14:08:38Z","updated_at":"2022-08-07T14:08:38Z","body":"Thanks for commenting @kafuu-chino , actually I think `Create new watch stream when the token expired.` is a better way.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1207416664/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mitake","id":1173955,"node_id":"MDQ6VXNlcjExNzM5NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1173955?v=4","gravatar_id":"","url":"https://api.github.com/users/mitake","html_url":"https://github.com/mitake","followers_url":"https://api.github.com/users/mitake/followers","following_url":"https://api.github.com/users/mitake/following{/other_user}","gists_url":"https://api.github.com/users/mitake/gists{/gist_id}","starred_url":"https://api.github.com/users/mitake/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mitake/subscriptions","organizations_url":"https://api.github.com/users/mitake/orgs","repos_url":"https://api.github.com/users/mitake/repos","events_url":"https://api.github.com/users/mitake/events{/privacy}","received_events_url":"https://api.github.com/users/mitake/received_events","type":"User","user_view_type":"public","site_admin":false}}]