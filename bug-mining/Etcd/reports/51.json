{"url":"https://api.github.com/repos/etcd-io/etcd/issues/18244","repository_url":"https://api.github.com/repos/etcd-io/etcd","labels_url":"https://api.github.com/repos/etcd-io/etcd/issues/18244/labels{/name}","comments_url":"https://api.github.com/repos/etcd-io/etcd/issues/18244/comments","events_url":"https://api.github.com/repos/etcd-io/etcd/issues/18244/events","html_url":"https://github.com/etcd-io/etcd/issues/18244","id":2381012608,"node_id":"I_kwDOAKtHts6N616A","number":18244,"title":"Enabling authentication causes noisy logs for every /readyz call","user":{"login":"ahmetb","id":159209,"node_id":"MDQ6VXNlcjE1OTIwOQ==","avatar_url":"https://avatars.githubusercontent.com/u/159209?v=4","gravatar_id":"","url":"https://api.github.com/users/ahmetb","html_url":"https://github.com/ahmetb","followers_url":"https://api.github.com/users/ahmetb/followers","following_url":"https://api.github.com/users/ahmetb/following{/other_user}","gists_url":"https://api.github.com/users/ahmetb/gists{/gist_id}","starred_url":"https://api.github.com/users/ahmetb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ahmetb/subscriptions","organizations_url":"https://api.github.com/users/ahmetb/orgs","repos_url":"https://api.github.com/users/ahmetb/repos","events_url":"https://api.github.com/users/ahmetb/events{/privacy}","received_events_url":"https://api.github.com/users/ahmetb/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":46697272,"node_id":"MDU6TGFiZWw0NjY5NzI3Mg==","url":"https://api.github.com/repos/etcd-io/etcd/labels/type/bug","name":"type/bug","color":"d61552","default":false,"description":""},{"id":3008306347,"node_id":"MDU6TGFiZWwzMDA4MzA2MzQ3","url":"https://api.github.com/repos/etcd-io/etcd/labels/backport/v3.5","name":"backport/v3.5","color":"CC33AB","default":false,"description":""},{"id":6434168586,"node_id":"LA_kwDOAKtHts8AAAABf4GfCg","url":"https://api.github.com/repos/etcd-io/etcd/labels/priority/important-longterm","name":"priority/important-longterm","color":"D93F0B","default":false,"description":"Important over the long term, but may not be staffed and/or may need multiple releases to complete."},{"id":6911929198,"node_id":"LA_kwDOAKtHts8AAAABm_urbg","url":"https://api.github.com/repos/etcd-io/etcd/labels/area/observability","name":"area/observability","color":"5319e7","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"ahmetb","id":159209,"node_id":"MDQ6VXNlcjE1OTIwOQ==","avatar_url":"https://avatars.githubusercontent.com/u/159209?v=4","gravatar_id":"","url":"https://api.github.com/users/ahmetb","html_url":"https://github.com/ahmetb","followers_url":"https://api.github.com/users/ahmetb/followers","following_url":"https://api.github.com/users/ahmetb/following{/other_user}","gists_url":"https://api.github.com/users/ahmetb/gists{/gist_id}","starred_url":"https://api.github.com/users/ahmetb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ahmetb/subscriptions","organizations_url":"https://api.github.com/users/ahmetb/orgs","repos_url":"https://api.github.com/users/ahmetb/repos","events_url":"https://api.github.com/users/ahmetb/events{/privacy}","received_events_url":"https://api.github.com/users/ahmetb/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"ahmetb","id":159209,"node_id":"MDQ6VXNlcjE1OTIwOQ==","avatar_url":"https://avatars.githubusercontent.com/u/159209?v=4","gravatar_id":"","url":"https://api.github.com/users/ahmetb","html_url":"https://github.com/ahmetb","followers_url":"https://api.github.com/users/ahmetb/followers","following_url":"https://api.github.com/users/ahmetb/following{/other_user}","gists_url":"https://api.github.com/users/ahmetb/gists{/gist_id}","starred_url":"https://api.github.com/users/ahmetb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ahmetb/subscriptions","organizations_url":"https://api.github.com/users/ahmetb/orgs","repos_url":"https://api.github.com/users/ahmetb/repos","events_url":"https://api.github.com/users/ahmetb/events{/privacy}","received_events_url":"https://api.github.com/users/ahmetb/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":9,"created_at":"2024-06-28T19:05:49Z","updated_at":"2024-07-04T18:39:14Z","closed_at":"2024-07-04T18:39:13Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Bug report criteria\n\n- [X] This bug report is not security related, security issues should be disclosed privately via [etcd maintainers](mailto:etcd-maintainers@googlegroups.com).\n- [X] This is not a support request or question, support requests or questions should be raised in the etcd [discussion forums](https://github.com/etcd-io/etcd/discussions).\n- [X] You have read the etcd [bug reporting guidelines](https://github.com/etcd-io/etcd/blob/main/Documentation/contributor-guide/reporting_bugs.md).\n- [X] Existing open issues along with etcd [frequently asked questions](https://etcd.io/docs/latest/faq) have been checked and this is not a duplicate.\n\n### What happened?\n\nWe run etcd with authentication enabled, we have a service discovery system that frequently polls the `/readyz` HTTP endpoint on etcd server. For every `/readyz` request, etcd prints two log statements  saying `\"deleted a simple token\"`. Example output:\r\n\r\n```\r\n{\"level\":\"info\",\"ts\":\"2024-06-28T11:55:48.638643-0700\",\r\n  \"caller\":\"auth/simple_token.go:170\",\r\n  \"msg\":\"deleted a simple token\",\r\n  \"user-name\":\"root\",\"token\":\"swUCgfCSXzbNbVvM.0\"}\r\n...\r\n```\r\n\r\nCombined with the fact that our service discovery system polls this endpoint every 5 seconds, practically this statement single handedly emits most of the logs we get out of etcd.\n\n### What did you expect to happen?\n\nNo logs at the default level for something inconsequential like this.\n\n### How can we reproduce it (as minimally and precisely as possible)?\n\n1. Run etcd server on a macOS terminal\r\n\r\n       etcd --auth-token-ttl=5\r\n\r\n2. In another terminal window, add a user, then enable authentication\r\n\r\n       etcdctl user add root:root\r\n       etcdctl auth enable\r\n\r\n3. Make a few successive /readyz queries back to back\r\n\r\n       curl 127.0.0.1:2379/readyz \r\n\r\n4. Wait 5 seconds, and observe logs are flooded with this:\r\n\r\n\t\t{\"level\":\"info\",\"ts\":\"2024-06-28T11:55:48.638643-0700\",\"caller\":\"auth/simple_token.go:170\",\"msg\":\"deleted a simple token\",\"user-name\":\"root\",\"token\":\"swUCgfCSXzbNbVvM.0\"}\r\n\t\t{\"level\":\"info\",\"ts\":\"2024-06-28T11:55:48.638762-0700\",\"caller\":\"auth/simple_token.go:170\",\"msg\":\"deleted a simple token\",\"user-name\":\"root\",\"token\":\"HbaByRCspoGGJDSQ.0\"}\r\n\t\t{\"level\":\"info\",\"ts\":\"2024-06-28T11:55:50.638493-0700\",\"caller\":\"auth/simple_token.go:170\",\"msg\":\"deleted a simple token\",\"user-name\":\"root\",\"token\":\"JHPWIPccneJuHHVo.0\"}\r\n\t\t{\"level\":\"info\",\"ts\":\"2024-06-28T11:55:50.638675-0700\",\"caller\":\"auth/simple_token.go:170\",\"msg\":\"deleted a simple token\",\"user-name\":\"root\",\"token\":\"bPwzKSxHgcHAqDWY.0\"}\r\n\t\t{\"level\":\"info\",\"ts\":\"2024-06-28T11:55:50.638696-0700\",\"caller\":\"auth/simple_token.go:170\",\"msg\":\"deleted a simple token\",\"user-name\":\"root\",\"token\":\"vHLnwqtzzYivgdjW.0\"}\r\n\t\t{\"level\":\"info\",\"ts\":\"2024-06-28T11:55:50.638828-0700\",\"caller\":\"auth/simple_token.go:170\",\"msg\":\"deleted a simple token\",\"user-name\":\"root\",\"token\":\"JorAHnUcTharTcGT.0\"}\r\n\t\t{\"level\":\"info\",\"ts\":\"2024-06-28T11:55:50.638845-0700\",\"caller\":\"auth/simple_token.go:170\",\"msg\":\"deleted a simple token\",\"user-name\":\"root\",\"token\":\"fEcjpFDKzbpmdymM.0\"}\r\n\t\t{\"level\":\"info\",\"ts\":\"2024-06-28T11:55:50.638861-0700\",\"caller\":\"auth/simple_token.go:170\",\"msg\":\"deleted a simple token\",\"user-name\":\"root\",\"token\":\"nqjiEIoiBHwIMEIz.0\"}\r\n\t\t{\"level\":\"info\",\"ts\":\"2024-06-28T11:55:50.638875-0700\",\"caller\":\"auth/simple_token.go:170\",\"msg\":\"deleted a simple token\",\"user-name\":\"root\",\"token\":\"AdmAVtAzjwEdYnmV.0\"}\r\n\t\t{\"level\":\"info\",\"ts\":\"2024-06-28T11:55:50.638888-0700\",\"caller\":\"auth/simple_token.go:170\",\"msg\":\"deleted a simple token\",\"user-name\":\"root\",\"token\":\"lzlBlKmLtPrTxzrh.0\"}\r\n\n\n### Anything else we need to know?\n\n_No response_\n\n### Etcd version (please run commands below)\n\n<details>\r\n\r\n```console\r\n$ etcd --version\r\netcd Version: 3.5.13\r\nGit SHA: c9063a0dc\r\nGo Version: go1.22.1\r\nGo OS/Arch: darwin/arm64\r\n\r\n$ etcdctl version\r\netcdctl version: 3.5.13\r\nAPI version: 3.5\r\n```\r\n\r\n</details>\r\n\n\n### Etcd configuration (command line flags or environment variables)\n\n```\r\netcd --auth-token-ttl=5\r\n```\r\n(shortened the TTL to illustrate the problem).\n\n### Etcd debug information (please run commands below, feel free to obfuscate the IP address or FQDN in the output)\n\nNot applicable.\n\n### Relevant log output\n\n_No response_","closed_by":{"login":"jmhbnz","id":39425256,"node_id":"MDQ6VXNlcjM5NDI1MjU2","avatar_url":"https://avatars.githubusercontent.com/u/39425256?v=4","gravatar_id":"","url":"https://api.github.com/users/jmhbnz","html_url":"https://github.com/jmhbnz","followers_url":"https://api.github.com/users/jmhbnz/followers","following_url":"https://api.github.com/users/jmhbnz/following{/other_user}","gists_url":"https://api.github.com/users/jmhbnz/gists{/gist_id}","starred_url":"https://api.github.com/users/jmhbnz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jmhbnz/subscriptions","organizations_url":"https://api.github.com/users/jmhbnz/orgs","repos_url":"https://api.github.com/users/jmhbnz/repos","events_url":"https://api.github.com/users/jmhbnz/events{/privacy}","received_events_url":"https://api.github.com/users/jmhbnz/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/18244/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/etcd-io/etcd/issues/18244/timeline","performed_via_github_app":null,"state_reason":"completed"}