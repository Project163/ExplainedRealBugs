{"url":"https://api.github.com/repos/etcd-io/etcd/issues/13905","repository_url":"https://api.github.com/repos/etcd-io/etcd","labels_url":"https://api.github.com/repos/etcd-io/etcd/issues/13905/labels{/name}","comments_url":"https://api.github.com/repos/etcd-io/etcd/issues/13905/comments","events_url":"https://api.github.com/repos/etcd-io/etcd/issues/13905/events","html_url":"https://github.com/etcd-io/etcd/issues/13905","id":1196626169,"node_id":"I_kwDOAKtHts5HUxD5","number":13905,"title":"server/etcdserver/api/v3rpc/maintenance.go: use of humanize.Time() results in loss of precision","user":{"login":"donalhunt","id":5854402,"node_id":"MDQ6VXNlcjU4NTQ0MDI=","avatar_url":"https://avatars.githubusercontent.com/u/5854402?v=4","gravatar_id":"","url":"https://api.github.com/users/donalhunt","html_url":"https://github.com/donalhunt","followers_url":"https://api.github.com/users/donalhunt/followers","following_url":"https://api.github.com/users/donalhunt/following{/other_user}","gists_url":"https://api.github.com/users/donalhunt/gists{/gist_id}","starred_url":"https://api.github.com/users/donalhunt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/donalhunt/subscriptions","organizations_url":"https://api.github.com/users/donalhunt/orgs","repos_url":"https://api.github.com/users/donalhunt/repos","events_url":"https://api.github.com/users/donalhunt/events{/privacy}","received_events_url":"https://api.github.com/users/donalhunt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":46697272,"node_id":"MDU6TGFiZWw0NjY5NzI3Mg==","url":"https://api.github.com/repos/etcd-io/etcd/labels/type/bug","name":"type/bug","color":"d61552","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-04-07T22:21:36Z","updated_at":"2022-04-08T21:41:51Z","closed_at":"2022-04-08T21:41:51Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What happened?\n\nThe logs for the snapshot process indicate that the time take is \"now\". now is not a valid duration in my world.\r\n\r\n```\r\n{\"level\":\"info\",\"ts\":\"2022-04-07T22:58:55.586+0100\",\"caller\":\"v3rpc/maintenance.go:133\",\"msg\":\"sending database snapshot to client\",\"total-bytes\":20480,\"size\":\"20 kB\",\"storage-version\":\"3.6.0\"}\r\n{\"level\":\"info\",\"ts\":\"2022-04-07T22:58:55.587+0100\",\"caller\":\"v3rpc/maintenance.go:175\",\"msg\":\"sending database sha256 checksum to client\",\"total-bytes\":20480,\"checksum-size\":32}\r\n{\"level\":\"info\",\"ts\":\"2022-04-07T22:58:55.587+0100\",\"caller\":\"v3rpc/maintenance.go:184\",\"msg\":\"successfully sent database snapshot to client\",\"total-bytes\":20480,\"size\":\"20 kB\",\"took\":\"now\",\"storage-version\":\"3.6.0\"}\r\n```\n\n### What did you expect to happen?\n\nI expected some level of precision (time measured in Âµs, ns, ms, s, etc).\n\n### How can we reproduce it (as minimally and precisely as possible)?\n\n\r\ndeploy single node server:\r\n```\r\nmkdir /tmp/etcd-test\r\nbin/etcd --data-dir /tmp/etcd-test\r\n```\r\n\r\ninitiate a snapshot with the client:\r\n`bin/etcdctl snapshot save /tmp/etcd-snapshot`\r\n\r\ncheck the logs on the server.\n\n### Anything else we need to know?\n\nhave a PR ready to go. Will submit shortly.\n\n### Etcd version (please run commands below)\n\n<details>\r\n\r\n```console\r\n$ etcd --version\r\netcd Version: 3.6.0-alpha.0\r\nGit SHA: 3dce38085\r\nGo Version: go1.18\r\nGo OS/Arch: linux/amd64\r\n\r\n$ etcdctl version\r\netcdctl version: 3.6.0-alpha.0\r\nAPI version: 3.6\r\n```\r\n\r\n</details>\r\n\r\nalso effects 3.5.1 (where I initially discovered it).\n\n### Etcd configuration (command line flags or environment variables)\n\n<details>\r\n\r\n--data-dir /tmp/etcd-test\r\n\r\n</details>\r\n\n\n### Etcd debug information (please run commands blow, feel free to obfuscate the IP address or FQDN in the output)\n\n<details>\r\n\r\n```console\r\n$ etcdctl member list -w table\r\n+------------------+---------+---------+-----------------------+-----------------------+------------+\r\n|        ID        | STATUS  |  NAME   |      PEER ADDRS       |     CLIENT ADDRS      | IS LEARNER |\r\n+------------------+---------+---------+-----------------------+-----------------------+------------+\r\n| 8e9e05c52164694d | started | default | http://localhost:2380 | http://localhost:2379 |      false |\r\n+------------------+---------+---------+-----------------------+-----------------------+------------+\r\n\r\n$ etcdctl --endpoints=<member list> endpoint status -w table\r\n+-----------------------+------------------+---------------+-----------------+---------+----------------+-----------+------------+-----------+------------+--------------------+--------+\r\n|       ENDPOINT        |        ID        |    VERSION    | STORAGE VERSION | DB SIZE | DB SIZE IN USE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |\r\n+-----------------------+------------------+---------------+-----------------+---------+----------------+-----------+------------+-----------+------------+--------------------+--------+\r\n| http://localhost:2379 | 8e9e05c52164694d | 3.6.0-alpha.0 |           3.6.0 |   20 kB |          16 kB |      true |      false |         4 |          9 |                  9 |        |\r\n+-----------------------+------------------+---------------+-----------------+---------+----------------+-----------+------------+-----------+------------+--------------------+--------+\r\n\r\n```\r\n\r\n</details>\r\n\n\n### Relevant log output\n\n```shell\n{\"level\":\"info\",\"ts\":\"2022-04-07T22:58:55.586+0100\",\"caller\":\"v3rpc/maintenance.go:133\",\"msg\":\"sending database snapshot to client\",\"total-bytes\":20480,\"size\":\"20 kB\",\"storage-version\":\"3.6.0\"}\r\n{\"level\":\"info\",\"ts\":\"2022-04-07T22:58:55.587+0100\",\"caller\":\"v3rpc/maintenance.go:175\",\"msg\":\"sending database sha256 checksum to client\",\"total-bytes\":20480,\"checksum-size\":32}\r\n{\"level\":\"info\",\"ts\":\"2022-04-07T22:58:55.587+0100\",\"caller\":\"v3rpc/maintenance.go:184\",\"msg\":\"successfully sent database snapshot to client\",\"total-bytes\":20480,\"size\":\"20 kB\",\"took\":\"now\",\"storage-version\":\"3.6.0\"}\n```\n","closed_by":{"login":"serathius","id":5873433,"node_id":"MDQ6VXNlcjU4NzM0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/5873433?v=4","gravatar_id":"","url":"https://api.github.com/users/serathius","html_url":"https://github.com/serathius","followers_url":"https://api.github.com/users/serathius/followers","following_url":"https://api.github.com/users/serathius/following{/other_user}","gists_url":"https://api.github.com/users/serathius/gists{/gist_id}","starred_url":"https://api.github.com/users/serathius/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serathius/subscriptions","organizations_url":"https://api.github.com/users/serathius/orgs","repos_url":"https://api.github.com/users/serathius/repos","events_url":"https://api.github.com/users/serathius/events{/privacy}","received_events_url":"https://api.github.com/users/serathius/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/13905/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/etcd-io/etcd/issues/13905/timeline","performed_via_github_app":null,"state_reason":"completed"}