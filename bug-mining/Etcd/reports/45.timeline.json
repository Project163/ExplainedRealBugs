[{"id":7156010876,"node_id":"LE_lADOAKtHts5PeRzozwAAAAGqiA98","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/7156010876","actor":{"login":"justinhellreich-stripe","id":92693517,"node_id":"U_kgDOBYZkDQ","avatar_url":"https://avatars.githubusercontent.com/u/92693517?v=4","gravatar_id":"","url":"https://api.github.com/users/justinhellreich-stripe","html_url":"https://github.com/justinhellreich-stripe","followers_url":"https://api.github.com/users/justinhellreich-stripe/followers","following_url":"https://api.github.com/users/justinhellreich-stripe/following{/other_user}","gists_url":"https://api.github.com/users/justinhellreich-stripe/gists{/gist_id}","starred_url":"https://api.github.com/users/justinhellreich-stripe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinhellreich-stripe/subscriptions","organizations_url":"https://api.github.com/users/justinhellreich-stripe/orgs","repos_url":"https://api.github.com/users/justinhellreich-stripe/repos","events_url":"https://api.github.com/users/justinhellreich-stripe/events{/privacy}","received_events_url":"https://api.github.com/users/justinhellreich-stripe/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-08-09T14:23:39Z","label":{"name":"area/bug","color":"d61552"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1210211170","html_url":"https://github.com/etcd-io/etcd/issues/14325#issuecomment-1210211170","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/14325","id":1210211170,"node_id":"IC_kwDOAKtHts5IIlti","user":{"login":"jbml","id":44558776,"node_id":"MDQ6VXNlcjQ0NTU4Nzc2","avatar_url":"https://avatars.githubusercontent.com/u/44558776?v=4","gravatar_id":"","url":"https://api.github.com/users/jbml","html_url":"https://github.com/jbml","followers_url":"https://api.github.com/users/jbml/followers","following_url":"https://api.github.com/users/jbml/following{/other_user}","gists_url":"https://api.github.com/users/jbml/gists{/gist_id}","starred_url":"https://api.github.com/users/jbml/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbml/subscriptions","organizations_url":"https://api.github.com/users/jbml/orgs","repos_url":"https://api.github.com/users/jbml/repos","events_url":"https://api.github.com/users/jbml/events{/privacy}","received_events_url":"https://api.github.com/users/jbml/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-10T06:18:28Z","updated_at":"2022-08-10T06:18:28Z","body":"Are you looking into it @justinhellreich-stripe ?\r\nOtherwise I will try and investigate the issue.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1210211170/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jbml","id":44558776,"node_id":"MDQ6VXNlcjQ0NTU4Nzc2","avatar_url":"https://avatars.githubusercontent.com/u/44558776?v=4","gravatar_id":"","url":"https://api.github.com/users/jbml","html_url":"https://github.com/jbml","followers_url":"https://api.github.com/users/jbml/followers","following_url":"https://api.github.com/users/jbml/following{/other_user}","gists_url":"https://api.github.com/users/jbml/gists{/gist_id}","starred_url":"https://api.github.com/users/jbml/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbml/subscriptions","organizations_url":"https://api.github.com/users/jbml/orgs","repos_url":"https://api.github.com/users/jbml/repos","events_url":"https://api.github.com/users/jbml/events{/privacy}","received_events_url":"https://api.github.com/users/jbml/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7160842444,"node_id":"MEE_lADOAKtHts5PeRzozwAAAAGq0cjM","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/7160842444","actor":{"login":"justinhellreich-stripe","id":92693517,"node_id":"U_kgDOBYZkDQ","avatar_url":"https://avatars.githubusercontent.com/u/92693517?v=4","gravatar_id":"","url":"https://api.github.com/users/justinhellreich-stripe","html_url":"https://github.com/justinhellreich-stripe","followers_url":"https://api.github.com/users/justinhellreich-stripe/followers","following_url":"https://api.github.com/users/justinhellreich-stripe/following{/other_user}","gists_url":"https://api.github.com/users/justinhellreich-stripe/gists{/gist_id}","starred_url":"https://api.github.com/users/justinhellreich-stripe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinhellreich-stripe/subscriptions","organizations_url":"https://api.github.com/users/justinhellreich-stripe/orgs","repos_url":"https://api.github.com/users/justinhellreich-stripe/repos","events_url":"https://api.github.com/users/justinhellreich-stripe/events{/privacy}","received_events_url":"https://api.github.com/users/justinhellreich-stripe/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-08-10T06:18:28Z","performed_via_github_app":null},{"id":7160842449,"node_id":"SE_lADOAKtHts5PeRzozwAAAAGq0cjR","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/7160842449","actor":{"login":"justinhellreich-stripe","id":92693517,"node_id":"U_kgDOBYZkDQ","avatar_url":"https://avatars.githubusercontent.com/u/92693517?v=4","gravatar_id":"","url":"https://api.github.com/users/justinhellreich-stripe","html_url":"https://github.com/justinhellreich-stripe","followers_url":"https://api.github.com/users/justinhellreich-stripe/followers","following_url":"https://api.github.com/users/justinhellreich-stripe/following{/other_user}","gists_url":"https://api.github.com/users/justinhellreich-stripe/gists{/gist_id}","starred_url":"https://api.github.com/users/justinhellreich-stripe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinhellreich-stripe/subscriptions","organizations_url":"https://api.github.com/users/justinhellreich-stripe/orgs","repos_url":"https://api.github.com/users/justinhellreich-stripe/repos","events_url":"https://api.github.com/users/justinhellreich-stripe/events{/privacy}","received_events_url":"https://api.github.com/users/justinhellreich-stripe/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-08-10T06:18:28Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1210717339","html_url":"https://github.com/etcd-io/etcd/issues/14325#issuecomment-1210717339","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/14325","id":1210717339,"node_id":"IC_kwDOAKtHts5IKhSb","user":{"login":"justinhellreich-stripe","id":92693517,"node_id":"U_kgDOBYZkDQ","avatar_url":"https://avatars.githubusercontent.com/u/92693517?v=4","gravatar_id":"","url":"https://api.github.com/users/justinhellreich-stripe","html_url":"https://github.com/justinhellreich-stripe","followers_url":"https://api.github.com/users/justinhellreich-stripe/followers","following_url":"https://api.github.com/users/justinhellreich-stripe/following{/other_user}","gists_url":"https://api.github.com/users/justinhellreich-stripe/gists{/gist_id}","starred_url":"https://api.github.com/users/justinhellreich-stripe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinhellreich-stripe/subscriptions","organizations_url":"https://api.github.com/users/justinhellreich-stripe/orgs","repos_url":"https://api.github.com/users/justinhellreich-stripe/repos","events_url":"https://api.github.com/users/justinhellreich-stripe/events{/privacy}","received_events_url":"https://api.github.com/users/justinhellreich-stripe/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-10T14:01:01Z","updated_at":"2022-08-10T14:01:26Z","body":"Hey @jbml -- i've done some digging and found that the leader is essentially just getting the latest revision, and then getting the hash key at that revision for each peer https://git.corp.stripe.com/stripe-internal/gocode/blob/fb2be906edbbfcf0f732b0d69431059d129a5ea1/vendor/go.etcd.io/etcd/server/v3/etcdserver/corrupt.go#L154\r\n\r\nIt's a surprise to me that after compaction, the latest revision is not available to be queried at. Does that seem like the expected behavior? Based on testing with just `etcdctl` that doesn't seem to be the case.\r\n\r\nI might be a bit out of my depth, so if you are able to look into it or suggest a possible fix, that would be great!","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1210717339/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"justinhellreich-stripe","id":92693517,"node_id":"U_kgDOBYZkDQ","avatar_url":"https://avatars.githubusercontent.com/u/92693517?v=4","gravatar_id":"","url":"https://api.github.com/users/justinhellreich-stripe","html_url":"https://github.com/justinhellreich-stripe","followers_url":"https://api.github.com/users/justinhellreich-stripe/followers","following_url":"https://api.github.com/users/justinhellreich-stripe/following{/other_user}","gists_url":"https://api.github.com/users/justinhellreich-stripe/gists{/gist_id}","starred_url":"https://api.github.com/users/justinhellreich-stripe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinhellreich-stripe/subscriptions","organizations_url":"https://api.github.com/users/justinhellreich-stripe/orgs","repos_url":"https://api.github.com/users/justinhellreich-stripe/repos","events_url":"https://api.github.com/users/justinhellreich-stripe/events{/privacy}","received_events_url":"https://api.github.com/users/justinhellreich-stripe/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7164146575,"node_id":"MEE_lADOAKtHts5PeRzozwAAAAGrBDOP","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/7164146575","actor":{"login":"jbml","id":44558776,"node_id":"MDQ6VXNlcjQ0NTU4Nzc2","avatar_url":"https://avatars.githubusercontent.com/u/44558776?v=4","gravatar_id":"","url":"https://api.github.com/users/jbml","html_url":"https://github.com/jbml","followers_url":"https://api.github.com/users/jbml/followers","following_url":"https://api.github.com/users/jbml/following{/other_user}","gists_url":"https://api.github.com/users/jbml/gists{/gist_id}","starred_url":"https://api.github.com/users/jbml/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbml/subscriptions","organizations_url":"https://api.github.com/users/jbml/orgs","repos_url":"https://api.github.com/users/jbml/repos","events_url":"https://api.github.com/users/jbml/events{/privacy}","received_events_url":"https://api.github.com/users/jbml/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-08-10T14:01:01Z","performed_via_github_app":null},{"id":7164146585,"node_id":"SE_lADOAKtHts5PeRzozwAAAAGrBDOZ","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/7164146585","actor":{"login":"jbml","id":44558776,"node_id":"MDQ6VXNlcjQ0NTU4Nzc2","avatar_url":"https://avatars.githubusercontent.com/u/44558776?v=4","gravatar_id":"","url":"https://api.github.com/users/jbml","html_url":"https://github.com/jbml","followers_url":"https://api.github.com/users/jbml/followers","following_url":"https://api.github.com/users/jbml/following{/other_user}","gists_url":"https://api.github.com/users/jbml/gists{/gist_id}","starred_url":"https://api.github.com/users/jbml/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbml/subscriptions","organizations_url":"https://api.github.com/users/jbml/orgs","repos_url":"https://api.github.com/users/jbml/repos","events_url":"https://api.github.com/users/jbml/events{/privacy}","received_events_url":"https://api.github.com/users/jbml/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-08-10T14:01:02Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1212811043","html_url":"https://github.com/etcd-io/etcd/issues/14325#issuecomment-1212811043","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/14325","id":1212811043,"node_id":"IC_kwDOAKtHts5ISgcj","user":{"login":"jbml","id":44558776,"node_id":"MDQ6VXNlcjQ0NTU4Nzc2","avatar_url":"https://avatars.githubusercontent.com/u/44558776?v=4","gravatar_id":"","url":"https://api.github.com/users/jbml","html_url":"https://github.com/jbml","followers_url":"https://api.github.com/users/jbml/followers","following_url":"https://api.github.com/users/jbml/following{/other_user}","gists_url":"https://api.github.com/users/jbml/gists{/gist_id}","starred_url":"https://api.github.com/users/jbml/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbml/subscriptions","organizations_url":"https://api.github.com/users/jbml/orgs","repos_url":"https://api.github.com/users/jbml/repos","events_url":"https://api.github.com/users/jbml/events{/privacy}","received_events_url":"https://api.github.com/users/jbml/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-12T07:26:15Z","updated_at":"2022-08-12T07:26:15Z","body":"Thanks, I will take a look @justinhellreich-stripe ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1212811043/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jbml","id":44558776,"node_id":"MDQ6VXNlcjQ0NTU4Nzc2","avatar_url":"https://avatars.githubusercontent.com/u/44558776?v=4","gravatar_id":"","url":"https://api.github.com/users/jbml","html_url":"https://github.com/jbml","followers_url":"https://api.github.com/users/jbml/followers","following_url":"https://api.github.com/users/jbml/following{/other_user}","gists_url":"https://api.github.com/users/jbml/gists{/gist_id}","starred_url":"https://api.github.com/users/jbml/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbml/subscriptions","organizations_url":"https://api.github.com/users/jbml/orgs","repos_url":"https://api.github.com/users/jbml/repos","events_url":"https://api.github.com/users/jbml/events{/privacy}","received_events_url":"https://api.github.com/users/jbml/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7177041940,"node_id":"MEE_lADOAKtHts5PeRzozwAAAAGryPgU","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/7177041940","actor":{"login":"justinhellreich-stripe","id":92693517,"node_id":"U_kgDOBYZkDQ","avatar_url":"https://avatars.githubusercontent.com/u/92693517?v=4","gravatar_id":"","url":"https://api.github.com/users/justinhellreich-stripe","html_url":"https://github.com/justinhellreich-stripe","followers_url":"https://api.github.com/users/justinhellreich-stripe/followers","following_url":"https://api.github.com/users/justinhellreich-stripe/following{/other_user}","gists_url":"https://api.github.com/users/justinhellreich-stripe/gists{/gist_id}","starred_url":"https://api.github.com/users/justinhellreich-stripe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinhellreich-stripe/subscriptions","organizations_url":"https://api.github.com/users/justinhellreich-stripe/orgs","repos_url":"https://api.github.com/users/justinhellreich-stripe/repos","events_url":"https://api.github.com/users/justinhellreich-stripe/events{/privacy}","received_events_url":"https://api.github.com/users/justinhellreich-stripe/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-08-12T07:26:15Z","performed_via_github_app":null},{"id":7177041950,"node_id":"SE_lADOAKtHts5PeRzozwAAAAGryPge","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/7177041950","actor":{"login":"justinhellreich-stripe","id":92693517,"node_id":"U_kgDOBYZkDQ","avatar_url":"https://avatars.githubusercontent.com/u/92693517?v=4","gravatar_id":"","url":"https://api.github.com/users/justinhellreich-stripe","html_url":"https://github.com/justinhellreich-stripe","followers_url":"https://api.github.com/users/justinhellreich-stripe/followers","following_url":"https://api.github.com/users/justinhellreich-stripe/following{/other_user}","gists_url":"https://api.github.com/users/justinhellreich-stripe/gists{/gist_id}","starred_url":"https://api.github.com/users/justinhellreich-stripe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/justinhellreich-stripe/subscriptions","organizations_url":"https://api.github.com/users/justinhellreich-stripe/orgs","repos_url":"https://api.github.com/users/justinhellreich-stripe/repos","events_url":"https://api.github.com/users/justinhellreich-stripe/events{/privacy}","received_events_url":"https://api.github.com/users/justinhellreich-stripe/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-08-12T07:26:15Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1234279755","html_url":"https://github.com/etcd-io/etcd/issues/14325#issuecomment-1234279755","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/14325","id":1234279755,"node_id":"IC_kwDOAKtHts5JkZ1L","user":{"login":"jbml","id":44558776,"node_id":"MDQ6VXNlcjQ0NTU4Nzc2","avatar_url":"https://avatars.githubusercontent.com/u/44558776?v=4","gravatar_id":"","url":"https://api.github.com/users/jbml","html_url":"https://github.com/jbml","followers_url":"https://api.github.com/users/jbml/followers","following_url":"https://api.github.com/users/jbml/following{/other_user}","gists_url":"https://api.github.com/users/jbml/gists{/gist_id}","starred_url":"https://api.github.com/users/jbml/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbml/subscriptions","organizations_url":"https://api.github.com/users/jbml/orgs","repos_url":"https://api.github.com/users/jbml/repos","events_url":"https://api.github.com/users/jbml/events{/privacy}","received_events_url":"https://api.github.com/users/jbml/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-01T13:25:47Z","updated_at":"2022-09-01T13:25:47Z","body":"When the leader requests the hash for a particular revision from its peers (as part of the corruption check), it will verify if the revision in question is not already compacted:\r\n\r\nhttps://github.com/etcd-io/etcd/blob/e61d43179291562c44225bf49a6d97c52a65fdca/server/storage/mvcc/kvstore.go#L180-L182\r\n\r\nI think the problem is that the check to verify if the revision is already compacted (the first \"if\" above), will return an error when the revision is the same as the compacted one (\"<=\" comparator).\r\n\r\nI think it should instead be a \"<\" comparator, which would be consistent with what a normal range request (ie. etcdctl get) would test, to verify if a key being requested has already been compacted, as below:\r\n\r\nhttps://github.com/etcd-io/etcd/blob/fff5d00ccfddaf5f06fa11cad65c1ecaa8c09f87/server/storage/mvcc/kvstore_txn.go#L74-L76\r\n\r\nI will do some tests to verify this.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/1234279755/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":2,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jbml","id":44558776,"node_id":"MDQ6VXNlcjQ0NTU4Nzc2","avatar_url":"https://avatars.githubusercontent.com/u/44558776?v=4","gravatar_id":"","url":"https://api.github.com/users/jbml","html_url":"https://github.com/jbml","followers_url":"https://api.github.com/users/jbml/followers","following_url":"https://api.github.com/users/jbml/following{/other_user}","gists_url":"https://api.github.com/users/jbml/gists{/gist_id}","starred_url":"https://api.github.com/users/jbml/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbml/subscriptions","organizations_url":"https://api.github.com/users/jbml/orgs","repos_url":"https://api.github.com/users/jbml/repos","events_url":"https://api.github.com/users/jbml/events{/privacy}","received_events_url":"https://api.github.com/users/jbml/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7375881336,"node_id":"REFE_lADOAKtHts5PeRzozwAAAAG3owR4","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/7375881336","actor":{"login":"jbml","id":44558776,"node_id":"MDQ6VXNlcjQ0NTU4Nzc2","avatar_url":"https://avatars.githubusercontent.com/u/44558776?v=4","gravatar_id":"","url":"https://api.github.com/users/jbml","html_url":"https://github.com/jbml","followers_url":"https://api.github.com/users/jbml/followers","following_url":"https://api.github.com/users/jbml/following{/other_user}","gists_url":"https://api.github.com/users/jbml/gists{/gist_id}","starred_url":"https://api.github.com/users/jbml/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbml/subscriptions","organizations_url":"https://api.github.com/users/jbml/orgs","repos_url":"https://api.github.com/users/jbml/repos","events_url":"https://api.github.com/users/jbml/events{/privacy}","received_events_url":"https://api.github.com/users/jbml/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"682fd4abe7e52bc9a5ea91311dac6c8bb560179f","commit_url":"https://api.github.com/repos/jbml/etcd/commits/682fd4abe7e52bc9a5ea91311dac6c8bb560179f","created_at":"2022-09-13T11:52:08Z","performed_via_github_app":null},{"actor":{"login":"jbml","id":44558776,"node_id":"MDQ6VXNlcjQ0NTU4Nzc2","avatar_url":"https://avatars.githubusercontent.com/u/44558776?v=4","gravatar_id":"","url":"https://api.github.com/users/jbml","html_url":"https://github.com/jbml","followers_url":"https://api.github.com/users/jbml/followers","following_url":"https://api.github.com/users/jbml/following{/other_user}","gists_url":"https://api.github.com/users/jbml/gists{/gist_id}","starred_url":"https://api.github.com/users/jbml/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbml/subscriptions","organizations_url":"https://api.github.com/users/jbml/orgs","repos_url":"https://api.github.com/users/jbml/repos","events_url":"https://api.github.com/users/jbml/events{/privacy}","received_events_url":"https://api.github.com/users/jbml/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-13T12:32:23Z","updated_at":"2022-09-13T12:32:23Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/14457","repository_url":"https://api.github.com/repos/etcd-io/etcd","labels_url":"https://api.github.com/repos/etcd-io/etcd/issues/14457/labels{/name}","comments_url":"https://api.github.com/repos/etcd-io/etcd/issues/14457/comments","events_url":"https://api.github.com/repos/etcd-io/etcd/issues/14457/events","html_url":"https://github.com/etcd-io/etcd/pull/14457","id":1371381468,"node_id":"PR_kwDOAKtHts4-3H-M","number":14457,"title":"etcdserver: fix corruption check when server has just been compacted","user":{"login":"jbml","id":44558776,"node_id":"MDQ6VXNlcjQ0NTU4Nzc2","avatar_url":"https://avatars.githubusercontent.com/u/44558776?v=4","gravatar_id":"","url":"https://api.github.com/users/jbml","html_url":"https://github.com/jbml","followers_url":"https://api.github.com/users/jbml/followers","following_url":"https://api.github.com/users/jbml/following{/other_user}","gists_url":"https://api.github.com/users/jbml/gists{/gist_id}","starred_url":"https://api.github.com/users/jbml/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbml/subscriptions","organizations_url":"https://api.github.com/users/jbml/orgs","repos_url":"https://api.github.com/users/jbml/repos","events_url":"https://api.github.com/users/jbml/events{/privacy}","received_events_url":"https://api.github.com/users/jbml/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1534662666,"node_id":"MDU6TGFiZWwxNTM0NjYyNjY2","url":"https://api.github.com/repos/etcd-io/etcd/labels/backport/v3.4","name":"backport/v3.4","color":"b0d2fc","default":false,"description":""},{"id":3008306347,"node_id":"MDU6TGFiZWwzMDA4MzA2MzQ3","url":"https://api.github.com/repos/etcd-io/etcd/labels/backport/v3.5","name":"backport/v3.5","color":"CC33AB","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":12,"created_at":"2022-09-13T12:32:23Z","updated_at":"2023-06-11T13:02:40Z","closed_at":"2022-10-13T07:17:38Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":11225014,"node_id":"MDEwOlJlcG9zaXRvcnkxMTIyNTAxNA==","name":"etcd","full_name":"etcd-io/etcd","private":false,"owner":{"login":"etcd-io","id":41972792,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQxOTcyNzky","avatar_url":"https://avatars.githubusercontent.com/u/41972792?v=4","gravatar_id":"","url":"https://api.github.com/users/etcd-io","html_url":"https://github.com/etcd-io","followers_url":"https://api.github.com/users/etcd-io/followers","following_url":"https://api.github.com/users/etcd-io/following{/other_user}","gists_url":"https://api.github.com/users/etcd-io/gists{/gist_id}","starred_url":"https://api.github.com/users/etcd-io/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/etcd-io/subscriptions","organizations_url":"https://api.github.com/users/etcd-io/orgs","repos_url":"https://api.github.com/users/etcd-io/repos","events_url":"https://api.github.com/users/etcd-io/events{/privacy}","received_events_url":"https://api.github.com/users/etcd-io/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/etcd-io/etcd","description":"Distributed reliable key-value store for the most critical data of a distributed system","fork":false,"url":"https://api.github.com/repos/etcd-io/etcd","forks_url":"https://api.github.com/repos/etcd-io/etcd/forks","keys_url":"https://api.github.com/repos/etcd-io/etcd/keys{/key_id}","collaborators_url":"https://api.github.com/repos/etcd-io/etcd/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/etcd-io/etcd/teams","hooks_url":"https://api.github.com/repos/etcd-io/etcd/hooks","issue_events_url":"https://api.github.com/repos/etcd-io/etcd/issues/events{/number}","events_url":"https://api.github.com/repos/etcd-io/etcd/events","assignees_url":"https://api.github.com/repos/etcd-io/etcd/assignees{/user}","branches_url":"https://api.github.com/repos/etcd-io/etcd/branches{/branch}","tags_url":"https://api.github.com/repos/etcd-io/etcd/tags","blobs_url":"https://api.github.com/repos/etcd-io/etcd/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/etcd-io/etcd/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/etcd-io/etcd/git/refs{/sha}","trees_url":"https://api.github.com/repos/etcd-io/etcd/git/trees{/sha}","statuses_url":"https://api.github.com/repos/etcd-io/etcd/statuses/{sha}","languages_url":"https://api.github.com/repos/etcd-io/etcd/languages","stargazers_url":"https://api.github.com/repos/etcd-io/etcd/stargazers","contributors_url":"https://api.github.com/repos/etcd-io/etcd/contributors","subscribers_url":"https://api.github.com/repos/etcd-io/etcd/subscribers","subscription_url":"https://api.github.com/repos/etcd-io/etcd/subscription","commits_url":"https://api.github.com/repos/etcd-io/etcd/commits{/sha}","git_commits_url":"https://api.github.com/repos/etcd-io/etcd/git/commits{/sha}","comments_url":"https://api.github.com/repos/etcd-io/etcd/comments{/number}","issue_comment_url":"https://api.github.com/repos/etcd-io/etcd/issues/comments{/number}","contents_url":"https://api.github.com/repos/etcd-io/etcd/contents/{+path}","compare_url":"https://api.github.com/repos/etcd-io/etcd/compare/{base}...{head}","merges_url":"https://api.github.com/repos/etcd-io/etcd/merges","archive_url":"https://api.github.com/repos/etcd-io/etcd/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/etcd-io/etcd/downloads","issues_url":"https://api.github.com/repos/etcd-io/etcd/issues{/number}","pulls_url":"https://api.github.com/repos/etcd-io/etcd/pulls{/number}","milestones_url":"https://api.github.com/repos/etcd-io/etcd/milestones{/number}","notifications_url":"https://api.github.com/repos/etcd-io/etcd/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/etcd-io/etcd/labels{/name}","releases_url":"https://api.github.com/repos/etcd-io/etcd/releases{/id}","deployments_url":"https://api.github.com/repos/etcd-io/etcd/deployments","created_at":"2013-07-06T21:57:21Z","updated_at":"2025-11-09T18:54:09Z","pushed_at":"2025-11-09T18:54:04Z","git_url":"git://github.com/etcd-io/etcd.git","ssh_url":"git@github.com:etcd-io/etcd.git","clone_url":"https://github.com/etcd-io/etcd.git","svn_url":"https://github.com/etcd-io/etcd","homepage":"https://etcd.io","size":93104,"stargazers_count":50733,"watchers_count":50733,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":10207,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":225,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cncf","consensus","database","distributed-database","distributed-systems","etcd","go","key-value","kubernetes","raft"],"visibility":"public","forks":10207,"open_issues":225,"watchers":50733,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/etcd-io/etcd/pulls/14457","html_url":"https://github.com/etcd-io/etcd/pull/14457","diff_url":"https://github.com/etcd-io/etcd/pull/14457.diff","patch_url":"https://github.com/etcd-io/etcd/pull/14457.patch","merged_at":"2022-10-13T07:17:38Z"},"body":"When a key-value store corruption check happens immediately after a compaction, the revision at which the key-value store hash is computed, is the compacted revision itself.\r\nIn that case, the hash computation logic was incorrect because it returned an ErrCompacted error; this error should instead be returned when the revision at which the key-value store is hashed, is strictly lower than the compacted revision.\r\n\r\nFixes #14325\r\n\r\nSigned-off-by: Jeremy Leach <44558776+jbml@users.noreply.github.com>","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/14457/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/etcd-io/etcd/issues/14457/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":7451946832,"node_id":"REFE_lADOAKtHts5PeRzozwAAAAG8K69Q","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/7451946832","actor":{"login":"jbml","id":44558776,"node_id":"MDQ6VXNlcjQ0NTU4Nzc2","avatar_url":"https://avatars.githubusercontent.com/u/44558776?v=4","gravatar_id":"","url":"https://api.github.com/users/jbml","html_url":"https://github.com/jbml","followers_url":"https://api.github.com/users/jbml/followers","following_url":"https://api.github.com/users/jbml/following{/other_user}","gists_url":"https://api.github.com/users/jbml/gists{/gist_id}","starred_url":"https://api.github.com/users/jbml/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbml/subscriptions","organizations_url":"https://api.github.com/users/jbml/orgs","repos_url":"https://api.github.com/users/jbml/repos","events_url":"https://api.github.com/users/jbml/events{/privacy}","received_events_url":"https://api.github.com/users/jbml/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"cc1e245368bdeb2a8cf451246393e26367e285f5","commit_url":"https://api.github.com/repos/jbml/etcd/commits/cc1e245368bdeb2a8cf451246393e26367e285f5","created_at":"2022-09-24T12:21:02Z","performed_via_github_app":null},{"id":7578173257,"node_id":"CE_lADOAKtHts5PeRzozwAAAAHDsb9J","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/7578173257","actor":{"login":"ahrtr","id":30739825,"node_id":"MDQ6VXNlcjMwNzM5ODI1","avatar_url":"https://avatars.githubusercontent.com/u/30739825?v=4","gravatar_id":"","url":"https://api.github.com/users/ahrtr","html_url":"https://github.com/ahrtr","followers_url":"https://api.github.com/users/ahrtr/followers","following_url":"https://api.github.com/users/ahrtr/following{/other_user}","gists_url":"https://api.github.com/users/ahrtr/gists{/gist_id}","starred_url":"https://api.github.com/users/ahrtr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ahrtr/subscriptions","organizations_url":"https://api.github.com/users/ahrtr/orgs","repos_url":"https://api.github.com/users/ahrtr/repos","events_url":"https://api.github.com/users/ahrtr/events{/privacy}","received_events_url":"https://api.github.com/users/ahrtr/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-10-13T07:17:39Z","state_reason":null,"performed_via_github_app":null},{"id":7580431327,"node_id":"REFE_lADOAKtHts5PeRzozwAAAAHD1DPf","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/7580431327","actor":{"login":"jbml","id":44558776,"node_id":"MDQ6VXNlcjQ0NTU4Nzc2","avatar_url":"https://avatars.githubusercontent.com/u/44558776?v=4","gravatar_id":"","url":"https://api.github.com/users/jbml","html_url":"https://github.com/jbml","followers_url":"https://api.github.com/users/jbml/followers","following_url":"https://api.github.com/users/jbml/following{/other_user}","gists_url":"https://api.github.com/users/jbml/gists{/gist_id}","starred_url":"https://api.github.com/users/jbml/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbml/subscriptions","organizations_url":"https://api.github.com/users/jbml/orgs","repos_url":"https://api.github.com/users/jbml/repos","events_url":"https://api.github.com/users/jbml/events{/privacy}","received_events_url":"https://api.github.com/users/jbml/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"35ce97a7bab81088144c90068727beebd2a6c888","commit_url":"https://api.github.com/repos/jbml/etcd/commits/35ce97a7bab81088144c90068727beebd2a6c888","created_at":"2022-10-13T11:41:32Z","performed_via_github_app":null},{"id":9493195890,"node_id":"REFE_lADOAKtHts5PeRzozwAAAAI11qxy","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/9493195890","actor":{"login":"kkkkun","id":11632432,"node_id":"MDQ6VXNlcjExNjMyNDMy","avatar_url":"https://avatars.githubusercontent.com/u/11632432?v=4","gravatar_id":"","url":"https://api.github.com/users/kkkkun","html_url":"https://github.com/kkkkun","followers_url":"https://api.github.com/users/kkkkun/followers","following_url":"https://api.github.com/users/kkkkun/following{/other_user}","gists_url":"https://api.github.com/users/kkkkun/gists{/gist_id}","starred_url":"https://api.github.com/users/kkkkun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kkkkun/subscriptions","organizations_url":"https://api.github.com/users/kkkkun/orgs","repos_url":"https://api.github.com/users/kkkkun/repos","events_url":"https://api.github.com/users/kkkkun/events{/privacy}","received_events_url":"https://api.github.com/users/kkkkun/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"8048328559f30b343df8816fd17b10157b814844","commit_url":"https://api.github.com/repos/kkkkun/etcd/commits/8048328559f30b343df8816fd17b10157b814844","created_at":"2023-06-11T08:18:58Z","performed_via_github_app":null}]