{"url":"https://api.github.com/repos/etcd-io/etcd/issues/13167","repository_url":"https://api.github.com/repos/etcd-io/etcd","labels_url":"https://api.github.com/repos/etcd-io/etcd/issues/13167/labels{/name}","comments_url":"https://api.github.com/repos/etcd-io/etcd/issues/13167/comments","events_url":"https://api.github.com/repos/etcd-io/etcd/issues/13167/events","html_url":"https://github.com/etcd-io/etcd/issues/13167","id":933665346,"node_id":"MDU6SXNzdWU5MzM2NjUzNDY=","number":13167,"title":"Deflake etcd tests","user":{"login":"serathius","id":5873433,"node_id":"MDQ6VXNlcjU4NzM0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/5873433?v=4","gravatar_id":"","url":"https://api.github.com/users/serathius","html_url":"https://github.com/serathius","followers_url":"https://api.github.com/users/serathius/followers","following_url":"https://api.github.com/users/serathius/following{/other_user}","gists_url":"https://api.github.com/users/serathius/gists{/gist_id}","starred_url":"https://api.github.com/users/serathius/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serathius/subscriptions","organizations_url":"https://api.github.com/users/serathius/orgs","repos_url":"https://api.github.com/users/serathius/repos","events_url":"https://api.github.com/users/serathius/events{/privacy}","received_events_url":"https://api.github.com/users/serathius/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":125104947,"node_id":"MDU6TGFiZWwxMjUxMDQ5NDc=","url":"https://api.github.com/repos/etcd-io/etcd/labels/area/testing","name":"area/testing","color":"f9ea9a","default":false,"description":""},{"id":159103993,"node_id":"MDU6TGFiZWwxNTkxMDM5OTM=","url":"https://api.github.com/repos/etcd-io/etcd/labels/help%20wanted","name":"help wanted","color":"d3f49c","default":true,"description":""},{"id":1966361840,"node_id":"MDU6TGFiZWwxOTY2MzYxODQw","url":"https://api.github.com/repos/etcd-io/etcd/labels/stale","name":"stale","color":"f9b3e6","default":false,"description":""},{"id":3035364791,"node_id":"MDU6TGFiZWwzMDM1MzY0Nzkx","url":"https://api.github.com/repos/etcd-io/etcd/labels/type/flake","name":"type/flake","color":"829493","default":false,"description":""},{"id":3915018379,"node_id":"LA_kwDOAKtHts7pWnCL","url":"https://api.github.com/repos/etcd-io/etcd/labels/stage/tracked","name":"stage/tracked","color":"0e8a16","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":22,"created_at":"2021-06-30T12:41:22Z","updated_at":"2025-10-22T00:12:29Z","closed_at":"2025-10-22T00:12:29Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"If we look into tests results since we migrated Github Actions [commits on main branch](https://github.com/etcd-io/etcd/commits/main?branch=main) we get:\r\n* 7 out of 32 failures on [1st page](https://github.com/etcd-io/etcd/commits/main?before=2fb919bef908f4cdf9a841a7d9494614566335e0+35&branch=main)\r\n* 14 out of 31 failures on [2nd page](https://github.com/etcd-io/etcd/commits/main?before=2fb919bef908f4cdf9a841a7d9494614566335e0+70&branch=main)\r\n* 14 out of 33 failures on [3rd page](https://github.com/etcd-io/etcd/commits/main?before=2fb919bef908f4cdf9a841a7d9494614566335e0+105&branch=main)\r\n* 15 out of 29 failures on [4th page](https://github.com/etcd-io/etcd/commits/main?before=2fb919bef908f4cdf9a841a7d9494614566335e0+140&branch=main)\r\n* 13 out of 25 failures on [5th page](https://github.com/etcd-io/etcd/commits/main?before=2fb919bef908f4cdf9a841a7d9494614566335e0+175&branch=main)\r\n* 13 out of 22 failures on [6th page](https://github.com/etcd-io/etcd/commits/main?before=2fb919bef908f4cdf9a841a7d9494614566335e0+210&branch=main)\r\n* 19 out of 33 failures on [7th page](https://github.com/etcd-io/etcd/commits/main?after=2fb919bef908f4cdf9a841a7d9494614566335e0+209&branch=main)\r\n\r\nWhere failure/success is based on green check vs red cross under commit message (commits without them means that they were not tested as they were multiple commits in one PR).\r\n\r\nThose are all test failures on main branch, so after a PR passed tests and was approved. We can use those failures to calculate chance of any PR failing to pass tests just due to test flaking. \r\n```\r\n(7 + 14 + 14+ 14 + 15 + 13 + 13 + 19) / (32 + 31 + 33 + 29 + 25 + 22 + 33) = 53%\r\n```\r\n\r\nHaving flakyness ratio of over 50% means that average PR needs to be run 2 times, but number of failures in sequences may be much much longer, 3-5 failures in row is not something uncommon. This can be frustrating especially to new contributors,  as there is no easy way to retrigger tests (need to do an empty commit amend and push). \r\n\r\n## Proposal \r\n\r\nEtcd community should set on a test flakyness target, measure it and establish a process to fix flaky tests. \r\n\r\nFor start I would propose to target a 10% failure rate for whole test suite. It should be reachable by fixing only couple of tests as from last runs we got 22% (7 out of last 32). Measuring flakyness could start from something simple, like for example running a script once a week that checks last 100 test results. If the measured flakyness is over our target, we should identify most flaky tests, create issues for them and encourage community to fix them.\r\n\r\nFor couple of first runs we could depend on executing the scripts manualy, but we should plan to automate them.\r\n\r\nTODO:\r\n* Create a script to measure flakyness (@karuppiah7890)\r\n* Create a script to identify flaky tests\r\n  * Export JUnit report from tests ( https://github.com/etcd-io/etcd/pull/13112)\r\n  * Upload the reports to Github artifacts (https://github.com/etcd-io/etcd/pull/13152) \r\n  * Implement script that analyses the reports\r\n* Automate the process\r\n\r\ncc @hexfusion @Rajalakshmi-Girish\r\n\r\n","closed_by":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/13167/reactions","total_count":8,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":2,"rocket":1,"eyes":0},"timeline_url":"https://api.github.com/repos/etcd-io/etcd/issues/13167/timeline","performed_via_github_app":null,"state_reason":"not_planned"}