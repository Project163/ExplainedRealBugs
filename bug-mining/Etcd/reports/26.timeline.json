[{"id":4558187963,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDU1ODE4Nzk2Mw==","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4558187963","actor":{"login":"gyuho","id":6799218,"node_id":"MDQ6VXNlcjY3OTkyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/6799218?v=4","gravatar_id":"","url":"https://api.github.com/users/gyuho","html_url":"https://github.com/gyuho","followers_url":"https://api.github.com/users/gyuho/followers","following_url":"https://api.github.com/users/gyuho/following{/other_user}","gists_url":"https://api.github.com/users/gyuho/gists{/gist_id}","starred_url":"https://api.github.com/users/gyuho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gyuho/subscriptions","organizations_url":"https://api.github.com/users/gyuho/orgs","repos_url":"https://api.github.com/users/gyuho/repos","events_url":"https://api.github.com/users/gyuho/events{/privacy}","received_events_url":"https://api.github.com/users/gyuho/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2021-04-06T17:41:03Z","performed_via_github_app":null},{"id":4558187968,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQ1NTgxODc5Njg=","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4558187968","actor":{"login":"gyuho","id":6799218,"node_id":"MDQ6VXNlcjY3OTkyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/6799218?v=4","gravatar_id":"","url":"https://api.github.com/users/gyuho","html_url":"https://github.com/gyuho","followers_url":"https://api.github.com/users/gyuho/followers","following_url":"https://api.github.com/users/gyuho/following{/other_user}","gists_url":"https://api.github.com/users/gyuho/gists{/gist_id}","starred_url":"https://api.github.com/users/gyuho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gyuho/subscriptions","organizations_url":"https://api.github.com/users/gyuho/orgs","repos_url":"https://api.github.com/users/gyuho/repos","events_url":"https://api.github.com/users/gyuho/events{/privacy}","received_events_url":"https://api.github.com/users/gyuho/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2021-04-06T17:41:03Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/814692832","html_url":"https://github.com/etcd-io/etcd/issues/12835#issuecomment-814692832","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12835","id":814692832,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNDY5MjgzMg==","user":{"login":"ptabor","id":11505763,"node_id":"MDQ6VXNlcjExNTA1NzYz","avatar_url":"https://avatars.githubusercontent.com/u/11505763?v=4","gravatar_id":"","url":"https://api.github.com/users/ptabor","html_url":"https://github.com/ptabor","followers_url":"https://api.github.com/users/ptabor/followers","following_url":"https://api.github.com/users/ptabor/following{/other_user}","gists_url":"https://api.github.com/users/ptabor/gists{/gist_id}","starred_url":"https://api.github.com/users/ptabor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptabor/subscriptions","organizations_url":"https://api.github.com/users/ptabor/orgs","repos_url":"https://api.github.com/users/ptabor/repos","events_url":"https://api.github.com/users/ptabor/events{/privacy}","received_events_url":"https://api.github.com/users/ptabor/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-07T07:56:13Z","updated_at":"2021-04-07T07:56:13Z","body":"1. It's interesting that proto.Size() is performing full marshalling process to compute the size. Somehow similar to discussion we had in https://github.com/etcd-io/etcd/pull/12790 about XXX_sizecache in RAFT. \r\n\r\n2. In general the data should get paginated or streamed (see https://github.com/etcd-io/etcd/pull/12343) to reduce memory footprint on etcd. \r\n\r\n3. heap_alloc is tracking where the memory is allocated. If the memory is deallocated quickly, its not contributing to the overall heap usage. So turning off   response.Size() reduced some temporary 'buffer' memory but not the overall Range request payload that is dominating here.  I'm rather wonder what's the impact of 'Size()' call for the overall server throughput. ","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/814692832/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ptabor","id":11505763,"node_id":"MDQ6VXNlcjExNTA1NzYz","avatar_url":"https://avatars.githubusercontent.com/u/11505763?v=4","gravatar_id":"","url":"https://api.github.com/users/ptabor","html_url":"https://github.com/ptabor","followers_url":"https://api.github.com/users/ptabor/followers","following_url":"https://api.github.com/users/ptabor/following{/other_user}","gists_url":"https://api.github.com/users/ptabor/gists{/gist_id}","starred_url":"https://api.github.com/users/ptabor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptabor/subscriptions","organizations_url":"https://api.github.com/users/ptabor/orgs","repos_url":"https://api.github.com/users/ptabor/repos","events_url":"https://api.github.com/users/ptabor/events{/privacy}","received_events_url":"https://api.github.com/users/ptabor/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/814697573","html_url":"https://github.com/etcd-io/etcd/issues/12835#issuecomment-814697573","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12835","id":814697573,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNDY5NzU3Mw==","user":{"login":"ptabor","id":11505763,"node_id":"MDQ6VXNlcjExNTA1NzYz","avatar_url":"https://avatars.githubusercontent.com/u/11505763?v=4","gravatar_id":"","url":"https://api.github.com/users/ptabor","html_url":"https://github.com/ptabor","followers_url":"https://api.github.com/users/ptabor/followers","following_url":"https://api.github.com/users/ptabor/following{/other_user}","gists_url":"https://api.github.com/users/ptabor/gists{/gist_id}","starred_url":"https://api.github.com/users/ptabor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptabor/subscriptions","organizations_url":"https://api.github.com/users/ptabor/orgs","repos_url":"https://api.github.com/users/ptabor/repos","events_url":"https://api.github.com/users/ptabor/events{/privacy}","received_events_url":"https://api.github.com/users/ptabor/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-07T08:03:04Z","updated_at":"2021-04-07T08:03:04Z","body":"BTW: Please verify what happens if you call `rangeResponse.Size()` instead.\r\n\r\nThe implementation seems to not require 'marshalling' to compute the size:\r\nhttps://github.com/etcd-io/etcd/blob/7168409e6b89e26932f681956150ed7075f88ae8/api/etcdserverpb/etcdserver.pb.go#L337","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/814697573/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ptabor","id":11505763,"node_id":"MDQ6VXNlcjExNTA1NzYz","avatar_url":"https://avatars.githubusercontent.com/u/11505763?v=4","gravatar_id":"","url":"https://api.github.com/users/ptabor","html_url":"https://github.com/ptabor","followers_url":"https://api.github.com/users/ptabor/followers","following_url":"https://api.github.com/users/ptabor/following{/other_user}","gists_url":"https://api.github.com/users/ptabor/gists{/gist_id}","starred_url":"https://api.github.com/users/ptabor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptabor/subscriptions","organizations_url":"https://api.github.com/users/ptabor/orgs","repos_url":"https://api.github.com/users/ptabor/repos","events_url":"https://api.github.com/users/ptabor/events{/privacy}","received_events_url":"https://api.github.com/users/ptabor/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/815114284","html_url":"https://github.com/etcd-io/etcd/issues/12835#issuecomment-815114284","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12835","id":815114284,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNTExNDI4NA==","user":{"login":"chaochn47","id":54131596,"node_id":"MDQ6VXNlcjU0MTMxNTk2","avatar_url":"https://avatars.githubusercontent.com/u/54131596?v=4","gravatar_id":"","url":"https://api.github.com/users/chaochn47","html_url":"https://github.com/chaochn47","followers_url":"https://api.github.com/users/chaochn47/followers","following_url":"https://api.github.com/users/chaochn47/following{/other_user}","gists_url":"https://api.github.com/users/chaochn47/gists{/gist_id}","starred_url":"https://api.github.com/users/chaochn47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chaochn47/subscriptions","organizations_url":"https://api.github.com/users/chaochn47/orgs","repos_url":"https://api.github.com/users/chaochn47/repos","events_url":"https://api.github.com/users/chaochn47/events{/privacy}","received_events_url":"https://api.github.com/users/chaochn47/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-07T18:03:16Z","updated_at":"2021-04-07T18:03:16Z","body":"Will come back to the thread after getting the results. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/815114284/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"chaochn47","id":54131596,"node_id":"MDQ6VXNlcjU0MTMxNTk2","avatar_url":"https://avatars.githubusercontent.com/u/54131596?v=4","gravatar_id":"","url":"https://api.github.com/users/chaochn47","html_url":"https://github.com/chaochn47","followers_url":"https://api.github.com/users/chaochn47/followers","following_url":"https://api.github.com/users/chaochn47/following{/other_user}","gists_url":"https://api.github.com/users/chaochn47/gists{/gist_id}","starred_url":"https://api.github.com/users/chaochn47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chaochn47/subscriptions","organizations_url":"https://api.github.com/users/chaochn47/orgs","repos_url":"https://api.github.com/users/chaochn47/repos","events_url":"https://api.github.com/users/chaochn47/events{/privacy}","received_events_url":"https://api.github.com/users/chaochn47/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/816031991","html_url":"https://github.com/etcd-io/etcd/issues/12835#issuecomment-816031991","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12835","id":816031991,"node_id":"MDEyOklzc3VlQ29tbWVudDgxNjAzMTk5MQ==","user":{"login":"gyuho","id":6799218,"node_id":"MDQ6VXNlcjY3OTkyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/6799218?v=4","gravatar_id":"","url":"https://api.github.com/users/gyuho","html_url":"https://github.com/gyuho","followers_url":"https://api.github.com/users/gyuho/followers","following_url":"https://api.github.com/users/gyuho/following{/other_user}","gists_url":"https://api.github.com/users/gyuho/gists{/gist_id}","starred_url":"https://api.github.com/users/gyuho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gyuho/subscriptions","organizations_url":"https://api.github.com/users/gyuho/orgs","repos_url":"https://api.github.com/users/gyuho/repos","events_url":"https://api.github.com/users/gyuho/events{/privacy}","received_events_url":"https://api.github.com/users/gyuho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-08T18:10:42Z","updated_at":"2021-04-08T18:10:57Z","body":"Could be related https://github.com/etcd-io/etcd/issues/12842, in general for etcd memory usage.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/816031991/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"gyuho","id":6799218,"node_id":"MDQ6VXNlcjY3OTkyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/6799218?v=4","gravatar_id":"","url":"https://api.github.com/users/gyuho","html_url":"https://github.com/gyuho","followers_url":"https://api.github.com/users/gyuho/followers","following_url":"https://api.github.com/users/gyuho/following{/other_user}","gists_url":"https://api.github.com/users/gyuho/gists{/gist_id}","starred_url":"https://api.github.com/users/gyuho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gyuho/subscriptions","organizations_url":"https://api.github.com/users/gyuho/orgs","repos_url":"https://api.github.com/users/gyuho/repos","events_url":"https://api.github.com/users/gyuho/events{/privacy}","received_events_url":"https://api.github.com/users/gyuho/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":4585319794,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQ0NTg1MzE5Nzk0","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4585319794","actor":{"login":"gyuho","id":6799218,"node_id":"MDQ6VXNlcjY3OTkyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/6799218?v=4","gravatar_id":"","url":"https://api.github.com/users/gyuho","html_url":"https://github.com/gyuho","followers_url":"https://api.github.com/users/gyuho/followers","following_url":"https://api.github.com/users/gyuho/following{/other_user}","gists_url":"https://api.github.com/users/gyuho/gists{/gist_id}","starred_url":"https://api.github.com/users/gyuho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gyuho/subscriptions","organizations_url":"https://api.github.com/users/gyuho/orgs","repos_url":"https://api.github.com/users/gyuho/repos","events_url":"https://api.github.com/users/gyuho/events{/privacy}","received_events_url":"https://api.github.com/users/gyuho/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2021-04-13T01:36:18Z","assignee":{"login":"chaochn47","id":54131596,"node_id":"MDQ6VXNlcjU0MTMxNTk2","avatar_url":"https://avatars.githubusercontent.com/u/54131596?v=4","gravatar_id":"","url":"https://api.github.com/users/chaochn47","html_url":"https://github.com/chaochn47","followers_url":"https://api.github.com/users/chaochn47/followers","following_url":"https://api.github.com/users/chaochn47/following{/other_user}","gists_url":"https://api.github.com/users/chaochn47/gists{/gist_id}","starred_url":"https://api.github.com/users/chaochn47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chaochn47/subscriptions","organizations_url":"https://api.github.com/users/chaochn47/orgs","repos_url":"https://api.github.com/users/chaochn47/repos","events_url":"https://api.github.com/users/chaochn47/events{/privacy}","received_events_url":"https://api.github.com/users/chaochn47/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":4585319919,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQ0NTg1MzE5OTE5","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4585319919","actor":{"login":"gyuho","id":6799218,"node_id":"MDQ6VXNlcjY3OTkyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/6799218?v=4","gravatar_id":"","url":"https://api.github.com/users/gyuho","html_url":"https://github.com/gyuho","followers_url":"https://api.github.com/users/gyuho/followers","following_url":"https://api.github.com/users/gyuho/following{/other_user}","gists_url":"https://api.github.com/users/gyuho/gists{/gist_id}","starred_url":"https://api.github.com/users/gyuho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gyuho/subscriptions","organizations_url":"https://api.github.com/users/gyuho/orgs","repos_url":"https://api.github.com/users/gyuho/repos","events_url":"https://api.github.com/users/gyuho/events{/privacy}","received_events_url":"https://api.github.com/users/gyuho/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2021-04-13T01:36:22Z","assignee":{"login":"gyuho","id":6799218,"node_id":"MDQ6VXNlcjY3OTkyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/6799218?v=4","gravatar_id":"","url":"https://api.github.com/users/gyuho","html_url":"https://github.com/gyuho","followers_url":"https://api.github.com/users/gyuho/followers","following_url":"https://api.github.com/users/gyuho/following{/other_user}","gists_url":"https://api.github.com/users/gyuho/gists{/gist_id}","starred_url":"https://api.github.com/users/gyuho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gyuho/subscriptions","organizations_url":"https://api.github.com/users/gyuho/orgs","repos_url":"https://api.github.com/users/gyuho/repos","events_url":"https://api.github.com/users/gyuho/events{/privacy}","received_events_url":"https://api.github.com/users/gyuho/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":4585332316,"node_id":"MDE1Ok1pbGVzdG9uZWRFdmVudDQ1ODUzMzIzMTY=","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4585332316","actor":{"login":"gyuho","id":6799218,"node_id":"MDQ6VXNlcjY3OTkyMTg=","avatar_url":"https://avatars.githubusercontent.com/u/6799218?v=4","gravatar_id":"","url":"https://api.github.com/users/gyuho","html_url":"https://github.com/gyuho","followers_url":"https://api.github.com/users/gyuho/followers","following_url":"https://api.github.com/users/gyuho/following{/other_user}","gists_url":"https://api.github.com/users/gyuho/gists{/gist_id}","starred_url":"https://api.github.com/users/gyuho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gyuho/subscriptions","organizations_url":"https://api.github.com/users/gyuho/orgs","repos_url":"https://api.github.com/users/gyuho/repos","events_url":"https://api.github.com/users/gyuho/events{/privacy}","received_events_url":"https://api.github.com/users/gyuho/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2021-04-13T01:41:52Z","milestone":{"title":"etcd-v3.5"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/821031171","html_url":"https://github.com/etcd-io/etcd/issues/12835#issuecomment-821031171","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12835","id":821031171,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMTAzMTE3MQ==","user":{"login":"chaochn47","id":54131596,"node_id":"MDQ6VXNlcjU0MTMxNTk2","avatar_url":"https://avatars.githubusercontent.com/u/54131596?v=4","gravatar_id":"","url":"https://api.github.com/users/chaochn47","html_url":"https://github.com/chaochn47","followers_url":"https://api.github.com/users/chaochn47/followers","following_url":"https://api.github.com/users/chaochn47/following{/other_user}","gists_url":"https://api.github.com/users/chaochn47/gists{/gist_id}","starred_url":"https://api.github.com/users/chaochn47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chaochn47/subscriptions","organizations_url":"https://api.github.com/users/chaochn47/orgs","repos_url":"https://api.github.com/users/chaochn47/repos","events_url":"https://api.github.com/users/chaochn47/events{/privacy}","received_events_url":"https://api.github.com/users/chaochn47/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-16T08:59:44Z","updated_at":"2021-04-16T09:09:11Z","body":"Here is the before and after comparision regarding `proto.Size()` to `rangeResponse.Size()`\r\n\r\nWe only set up a single etcd node cluster with 8 RAM, 2vCPU with 2 `kube-apiserver`. This helps us be 100% sure all the client requests landing on the same etcd instance.\r\n\r\n1. mem_used_percent reduced to half while CPU is roughly the same\r\n\r\n<img width=\"1197\" alt=\"Screen Shot 2021-04-16 at 1 55 52 AM\" src=\"https://user-images.githubusercontent.com/54131596/115000136-52987a80-9e57-11eb-8ed4-32888be06120.png\">\r\n\r\n2. kube-apiserver list pods call pattern is similar, it's unpaginated and across all kubernetes namespaces\r\n\r\n<img width=\"1286\" alt=\"Screen Shot 2021-04-16 at 1 38 31 AM\" src=\"https://user-images.githubusercontent.com/54131596/115000179-5f1cd300-9e57-11eb-8e44-d3d20e11c335.png\">\r\n\r\n","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/821031171/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"chaochn47","id":54131596,"node_id":"MDQ6VXNlcjU0MTMxNTk2","avatar_url":"https://avatars.githubusercontent.com/u/54131596?v=4","gravatar_id":"","url":"https://api.github.com/users/chaochn47","html_url":"https://github.com/chaochn47","followers_url":"https://api.github.com/users/chaochn47/followers","following_url":"https://api.github.com/users/chaochn47/following{/other_user}","gists_url":"https://api.github.com/users/chaochn47/gists{/gist_id}","starred_url":"https://api.github.com/users/chaochn47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chaochn47/subscriptions","organizations_url":"https://api.github.com/users/chaochn47/orgs","repos_url":"https://api.github.com/users/chaochn47/repos","events_url":"https://api.github.com/users/chaochn47/events{/privacy}","received_events_url":"https://api.github.com/users/chaochn47/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/821032428","html_url":"https://github.com/etcd-io/etcd/issues/12835#issuecomment-821032428","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12835","id":821032428,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMTAzMjQyOA==","user":{"login":"chaochn47","id":54131596,"node_id":"MDQ6VXNlcjU0MTMxNTk2","avatar_url":"https://avatars.githubusercontent.com/u/54131596?v=4","gravatar_id":"","url":"https://api.github.com/users/chaochn47","html_url":"https://github.com/chaochn47","followers_url":"https://api.github.com/users/chaochn47/followers","following_url":"https://api.github.com/users/chaochn47/following{/other_user}","gists_url":"https://api.github.com/users/chaochn47/gists{/gist_id}","starred_url":"https://api.github.com/users/chaochn47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chaochn47/subscriptions","organizations_url":"https://api.github.com/users/chaochn47/orgs","repos_url":"https://api.github.com/users/chaochn47/repos","events_url":"https://api.github.com/users/chaochn47/events{/privacy}","received_events_url":"https://api.github.com/users/chaochn47/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-16T09:01:52Z","updated_at":"2021-04-16T09:02:24Z","body":"However, I was not turning off the `madvise` on linux, so the RSS mem_percent_used may not be accurate, will return back when get the result after `GODEBUG=madvdontneed=1`\r\n\r\nref: \r\n[1] https://github.com/golang/go/issues/42330\r\n[2] https://github.com/golang/go/issues/33376","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/821032428/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"chaochn47","id":54131596,"node_id":"MDQ6VXNlcjU0MTMxNTk2","avatar_url":"https://avatars.githubusercontent.com/u/54131596?v=4","gravatar_id":"","url":"https://api.github.com/users/chaochn47","html_url":"https://github.com/chaochn47","followers_url":"https://api.github.com/users/chaochn47/followers","following_url":"https://api.github.com/users/chaochn47/following{/other_user}","gists_url":"https://api.github.com/users/chaochn47/gists{/gist_id}","starred_url":"https://api.github.com/users/chaochn47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chaochn47/subscriptions","organizations_url":"https://api.github.com/users/chaochn47/orgs","repos_url":"https://api.github.com/users/chaochn47/repos","events_url":"https://api.github.com/users/chaochn47/events{/privacy}","received_events_url":"https://api.github.com/users/chaochn47/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/821064913","html_url":"https://github.com/etcd-io/etcd/issues/12835#issuecomment-821064913","issue_url":"https://api.github.com/repos/etcd-io/etcd/issues/12835","id":821064913,"node_id":"MDEyOklzc3VlQ29tbWVudDgyMTA2NDkxMw==","user":{"login":"ptabor","id":11505763,"node_id":"MDQ6VXNlcjExNTA1NzYz","avatar_url":"https://avatars.githubusercontent.com/u/11505763?v=4","gravatar_id":"","url":"https://api.github.com/users/ptabor","html_url":"https://github.com/ptabor","followers_url":"https://api.github.com/users/ptabor/followers","following_url":"https://api.github.com/users/ptabor/following{/other_user}","gists_url":"https://api.github.com/users/ptabor/gists{/gist_id}","starred_url":"https://api.github.com/users/ptabor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptabor/subscriptions","organizations_url":"https://api.github.com/users/ptabor/orgs","repos_url":"https://api.github.com/users/ptabor/repos","events_url":"https://api.github.com/users/ptabor/events{/privacy}","received_events_url":"https://api.github.com/users/ptabor/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-16T09:59:06Z","updated_at":"2021-04-16T09:59:06Z","body":"But I think we are sufficiently confident that proto.Size() -> rangeResponse.Size() [and similar] is a good move to justify a PR. \r\nThank you for making this experiments and proposing this improvement.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/comments/821064913/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ptabor","id":11505763,"node_id":"MDQ6VXNlcjExNTA1NzYz","avatar_url":"https://avatars.githubusercontent.com/u/11505763?v=4","gravatar_id":"","url":"https://api.github.com/users/ptabor","html_url":"https://github.com/ptabor","followers_url":"https://api.github.com/users/ptabor/followers","following_url":"https://api.github.com/users/ptabor/following{/other_user}","gists_url":"https://api.github.com/users/ptabor/gists{/gist_id}","starred_url":"https://api.github.com/users/ptabor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ptabor/subscriptions","organizations_url":"https://api.github.com/users/ptabor/orgs","repos_url":"https://api.github.com/users/ptabor/repos","events_url":"https://api.github.com/users/ptabor/events{/privacy}","received_events_url":"https://api.github.com/users/ptabor/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"chaochn47","id":54131596,"node_id":"MDQ6VXNlcjU0MTMxNTk2","avatar_url":"https://avatars.githubusercontent.com/u/54131596?v=4","gravatar_id":"","url":"https://api.github.com/users/chaochn47","html_url":"https://github.com/chaochn47","followers_url":"https://api.github.com/users/chaochn47/followers","following_url":"https://api.github.com/users/chaochn47/following{/other_user}","gists_url":"https://api.github.com/users/chaochn47/gists{/gist_id}","starred_url":"https://api.github.com/users/chaochn47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chaochn47/subscriptions","organizations_url":"https://api.github.com/users/chaochn47/orgs","repos_url":"https://api.github.com/users/chaochn47/repos","events_url":"https://api.github.com/users/chaochn47/events{/privacy}","received_events_url":"https://api.github.com/users/chaochn47/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-16T17:43:06Z","updated_at":"2021-04-16T17:43:06Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/12871","repository_url":"https://api.github.com/repos/etcd-io/etcd","labels_url":"https://api.github.com/repos/etcd-io/etcd/issues/12871/labels{/name}","comments_url":"https://api.github.com/repos/etcd-io/etcd/issues/12871/comments","events_url":"https://api.github.com/repos/etcd-io/etcd/issues/12871/events","html_url":"https://github.com/etcd-io/etcd/pull/12871","id":860041033,"node_id":"MDExOlB1bGxSZXF1ZXN0NjE3MDEzNjgx","number":12871,"title":"etcdserver/util.go: reduce memory when logging range requests","user":{"login":"chaochn47","id":54131596,"node_id":"MDQ6VXNlcjU0MTMxNTk2","avatar_url":"https://avatars.githubusercontent.com/u/54131596?v=4","gravatar_id":"","url":"https://api.github.com/users/chaochn47","html_url":"https://github.com/chaochn47","followers_url":"https://api.github.com/users/chaochn47/followers","following_url":"https://api.github.com/users/chaochn47/following{/other_user}","gists_url":"https://api.github.com/users/chaochn47/gists{/gist_id}","starred_url":"https://api.github.com/users/chaochn47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chaochn47/subscriptions","organizations_url":"https://api.github.com/users/chaochn47/orgs","repos_url":"https://api.github.com/users/chaochn47/repos","events_url":"https://api.github.com/users/chaochn47/events{/privacy}","received_events_url":"https://api.github.com/users/chaochn47/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2021-04-16T17:43:06Z","updated_at":"2021-04-17T00:38:47Z","closed_at":"2021-04-16T23:39:34Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":11225014,"node_id":"MDEwOlJlcG9zaXRvcnkxMTIyNTAxNA==","name":"etcd","full_name":"etcd-io/etcd","private":false,"owner":{"login":"etcd-io","id":41972792,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQxOTcyNzky","avatar_url":"https://avatars.githubusercontent.com/u/41972792?v=4","gravatar_id":"","url":"https://api.github.com/users/etcd-io","html_url":"https://github.com/etcd-io","followers_url":"https://api.github.com/users/etcd-io/followers","following_url":"https://api.github.com/users/etcd-io/following{/other_user}","gists_url":"https://api.github.com/users/etcd-io/gists{/gist_id}","starred_url":"https://api.github.com/users/etcd-io/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/etcd-io/subscriptions","organizations_url":"https://api.github.com/users/etcd-io/orgs","repos_url":"https://api.github.com/users/etcd-io/repos","events_url":"https://api.github.com/users/etcd-io/events{/privacy}","received_events_url":"https://api.github.com/users/etcd-io/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/etcd-io/etcd","description":"Distributed reliable key-value store for the most critical data of a distributed system","fork":false,"url":"https://api.github.com/repos/etcd-io/etcd","forks_url":"https://api.github.com/repos/etcd-io/etcd/forks","keys_url":"https://api.github.com/repos/etcd-io/etcd/keys{/key_id}","collaborators_url":"https://api.github.com/repos/etcd-io/etcd/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/etcd-io/etcd/teams","hooks_url":"https://api.github.com/repos/etcd-io/etcd/hooks","issue_events_url":"https://api.github.com/repos/etcd-io/etcd/issues/events{/number}","events_url":"https://api.github.com/repos/etcd-io/etcd/events","assignees_url":"https://api.github.com/repos/etcd-io/etcd/assignees{/user}","branches_url":"https://api.github.com/repos/etcd-io/etcd/branches{/branch}","tags_url":"https://api.github.com/repos/etcd-io/etcd/tags","blobs_url":"https://api.github.com/repos/etcd-io/etcd/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/etcd-io/etcd/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/etcd-io/etcd/git/refs{/sha}","trees_url":"https://api.github.com/repos/etcd-io/etcd/git/trees{/sha}","statuses_url":"https://api.github.com/repos/etcd-io/etcd/statuses/{sha}","languages_url":"https://api.github.com/repos/etcd-io/etcd/languages","stargazers_url":"https://api.github.com/repos/etcd-io/etcd/stargazers","contributors_url":"https://api.github.com/repos/etcd-io/etcd/contributors","subscribers_url":"https://api.github.com/repos/etcd-io/etcd/subscribers","subscription_url":"https://api.github.com/repos/etcd-io/etcd/subscription","commits_url":"https://api.github.com/repos/etcd-io/etcd/commits{/sha}","git_commits_url":"https://api.github.com/repos/etcd-io/etcd/git/commits{/sha}","comments_url":"https://api.github.com/repos/etcd-io/etcd/comments{/number}","issue_comment_url":"https://api.github.com/repos/etcd-io/etcd/issues/comments{/number}","contents_url":"https://api.github.com/repos/etcd-io/etcd/contents/{+path}","compare_url":"https://api.github.com/repos/etcd-io/etcd/compare/{base}...{head}","merges_url":"https://api.github.com/repos/etcd-io/etcd/merges","archive_url":"https://api.github.com/repos/etcd-io/etcd/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/etcd-io/etcd/downloads","issues_url":"https://api.github.com/repos/etcd-io/etcd/issues{/number}","pulls_url":"https://api.github.com/repos/etcd-io/etcd/pulls{/number}","milestones_url":"https://api.github.com/repos/etcd-io/etcd/milestones{/number}","notifications_url":"https://api.github.com/repos/etcd-io/etcd/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/etcd-io/etcd/labels{/name}","releases_url":"https://api.github.com/repos/etcd-io/etcd/releases{/id}","deployments_url":"https://api.github.com/repos/etcd-io/etcd/deployments","created_at":"2013-07-06T21:57:21Z","updated_at":"2025-11-09T18:54:09Z","pushed_at":"2025-11-09T18:54:04Z","git_url":"git://github.com/etcd-io/etcd.git","ssh_url":"git@github.com:etcd-io/etcd.git","clone_url":"https://github.com/etcd-io/etcd.git","svn_url":"https://github.com/etcd-io/etcd","homepage":"https://etcd.io","size":93104,"stargazers_count":50733,"watchers_count":50733,"language":"Go","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":10207,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":225,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cncf","consensus","database","distributed-database","distributed-systems","etcd","go","key-value","kubernetes","raft"],"visibility":"public","forks":10207,"open_issues":225,"watchers":50733,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/etcd-io/etcd/pulls/12871","html_url":"https://github.com/etcd-io/etcd/pull/12871","diff_url":"https://github.com/etcd-io/etcd/pull/12871.diff","patch_url":"https://github.com/etcd-io/etcd/pull/12871.patch","merged_at":"2021-04-16T23:39:34Z"},"body":"When we have multiple excessive large range requests landing on etcd server, the response size warn loggging calling `proto.Size()` takes 30% of memory allocation, it can be avoided by non-marshal implementation `rangeResponse.Size()` and give etcd server more headroom to request memory allocation. \r\n\r\nFixes #12835\r\n","reactions":{"url":"https://api.github.com/repos/etcd-io/etcd/issues/12871/reactions","total_count":6,"+1":0,"-1":0,"laugh":0,"hooray":6,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/etcd-io/etcd/issues/12871/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":4606639098,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQ2MDY2MzkwOTg=","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4606639098","actor":{"login":"chaochn47","id":54131596,"node_id":"MDQ6VXNlcjU0MTMxNTk2","avatar_url":"https://avatars.githubusercontent.com/u/54131596?v=4","gravatar_id":"","url":"https://api.github.com/users/chaochn47","html_url":"https://github.com/chaochn47","followers_url":"https://api.github.com/users/chaochn47/followers","following_url":"https://api.github.com/users/chaochn47/following{/other_user}","gists_url":"https://api.github.com/users/chaochn47/gists{/gist_id}","starred_url":"https://api.github.com/users/chaochn47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chaochn47/subscriptions","organizations_url":"https://api.github.com/users/chaochn47/orgs","repos_url":"https://api.github.com/users/chaochn47/repos","events_url":"https://api.github.com/users/chaochn47/events{/privacy}","received_events_url":"https://api.github.com/users/chaochn47/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"7e70ef8125d90e5884f23bb46b9b43c8d855b6ca","commit_url":"https://api.github.com/repos/chaochn47/etcd/commits/7e70ef8125d90e5884f23bb46b9b43c8d855b6ca","created_at":"2021-04-16T20:06:18Z","performed_via_github_app":null},{"id":4606658497,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQ2MDY2NTg0OTc=","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4606658497","actor":{"login":"chaochn47","id":54131596,"node_id":"MDQ6VXNlcjU0MTMxNTk2","avatar_url":"https://avatars.githubusercontent.com/u/54131596?v=4","gravatar_id":"","url":"https://api.github.com/users/chaochn47","html_url":"https://github.com/chaochn47","followers_url":"https://api.github.com/users/chaochn47/followers","following_url":"https://api.github.com/users/chaochn47/following{/other_user}","gists_url":"https://api.github.com/users/chaochn47/gists{/gist_id}","starred_url":"https://api.github.com/users/chaochn47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chaochn47/subscriptions","organizations_url":"https://api.github.com/users/chaochn47/orgs","repos_url":"https://api.github.com/users/chaochn47/repos","events_url":"https://api.github.com/users/chaochn47/events{/privacy}","received_events_url":"https://api.github.com/users/chaochn47/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"9ea6dd27d3d2efd215dbdb408e3ed23574b2edd7","commit_url":"https://api.github.com/repos/chaochn47/etcd/commits/9ea6dd27d3d2efd215dbdb408e3ed23574b2edd7","created_at":"2021-04-16T20:11:45Z","performed_via_github_app":null},{"id":4607246675,"node_id":"MDExOkNsb3NlZEV2ZW50NDYwNzI0NjY3NQ==","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4607246675","actor":{"login":"xiang90","id":4479947,"node_id":"MDQ6VXNlcjQ0Nzk5NDc=","avatar_url":"https://avatars.githubusercontent.com/u/4479947?v=4","gravatar_id":"","url":"https://api.github.com/users/xiang90","html_url":"https://github.com/xiang90","followers_url":"https://api.github.com/users/xiang90/followers","following_url":"https://api.github.com/users/xiang90/following{/other_user}","gists_url":"https://api.github.com/users/xiang90/gists{/gist_id}","starred_url":"https://api.github.com/users/xiang90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiang90/subscriptions","organizations_url":"https://api.github.com/users/xiang90/orgs","repos_url":"https://api.github.com/users/xiang90/repos","events_url":"https://api.github.com/users/xiang90/events{/privacy}","received_events_url":"https://api.github.com/users/xiang90/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2021-04-16T23:39:34Z","state_reason":null,"performed_via_github_app":null},{"id":4607246795,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQ2MDcyNDY3OTU=","url":"https://api.github.com/repos/etcd-io/etcd/issues/events/4607246795","actor":{"login":"xiang90","id":4479947,"node_id":"MDQ6VXNlcjQ0Nzk5NDc=","avatar_url":"https://avatars.githubusercontent.com/u/4479947?v=4","gravatar_id":"","url":"https://api.github.com/users/xiang90","html_url":"https://github.com/xiang90","followers_url":"https://api.github.com/users/xiang90/followers","following_url":"https://api.github.com/users/xiang90/following{/other_user}","gists_url":"https://api.github.com/users/xiang90/gists{/gist_id}","starred_url":"https://api.github.com/users/xiang90/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiang90/subscriptions","organizations_url":"https://api.github.com/users/xiang90/orgs","repos_url":"https://api.github.com/users/xiang90/repos","events_url":"https://api.github.com/users/xiang90/events{/privacy}","received_events_url":"https://api.github.com/users/xiang90/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"80586c5b4718556c19ba4b239d1bf0411d9e70fc","commit_url":"https://api.github.com/repos/etcd-io/etcd/commits/80586c5b4718556c19ba4b239d1bf0411d9e70fc","created_at":"2021-04-16T23:39:39Z","performed_via_github_app":null}]