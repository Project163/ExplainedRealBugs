diff --git a/.gitignore b/.gitignore
index d11868025..f2f6bbaba 100644
--- a/.gitignore
+++ b/.gitignore
@@ -7,6 +7,7 @@
 /bin
 *.etcd
 *.log
+*.swp
 /etcd
 /hack/insta-discovery/.env
 *.coverprofile
diff --git a/embed/serve_test.go b/embed/serve_test.go
index d2a909d79..5164fcdfe 100644
--- a/embed/serve_test.go
+++ b/embed/serve_test.go
@@ -15,7 +15,9 @@
 package embed
 
 import (
+	"fmt"
 	"io/ioutil"
+	"net/url"
 	"os"
 	"testing"
 
@@ -25,14 +27,38 @@ import (
 // TestStartEtcdWrongToken ensures that StartEtcd with wrong configs returns with error.
 func TestStartEtcdWrongToken(t *testing.T) {
 	tdir, err := ioutil.TempDir(os.TempDir(), "token-test")
+
 	if err != nil {
 		t.Fatal(err)
 	}
 	defer os.RemoveAll(tdir)
+
 	cfg := NewConfig()
+
+	// Similar to function in integration/embed/embed_test.go for setting up Config.
+	urls := newEmbedURLs(2)
+	curls := []url.URL{urls[0]}
+	purls := []url.URL{urls[1]}
+	cfg.LCUrls, cfg.ACUrls = curls, curls
+	cfg.LPUrls, cfg.APUrls = purls, purls
+	cfg.InitialCluster = ""
+	for i := range purls {
+		cfg.InitialCluster += ",default=" + purls[i].String()
+	}
+	cfg.InitialCluster = cfg.InitialCluster[1:]
 	cfg.Dir = tdir
 	cfg.AuthToken = "wrong-token"
+
 	if _, err = StartEtcd(cfg); err != auth.ErrInvalidAuthOpts {
 		t.Fatalf("expected %v, got %v", auth.ErrInvalidAuthOpts, err)
 	}
 }
+
+func newEmbedURLs(n int) (urls []url.URL) {
+	scheme := "unix"
+	for i := 0; i < n; i++ {
+		u, _ := url.Parse(fmt.Sprintf("%s://localhost:%d%06d", scheme, os.Getpid(), i))
+		urls = append(urls, *u)
+	}
+	return urls
+}
diff --git a/go.sum b/go.sum
index f520a0bd2..adb7f8334 100644
--- a/go.sum
+++ b/go.sum
@@ -208,6 +208,7 @@ golang.org/x/text v0.3.3/go.mod h1:5Zoc/QRtKVWzQhOtBMvqHzDpF6irO9z98xDceosuGiQ=
 golang.org/x/time v0.0.0-20180412165947-fbb02b2291d2 h1:+DCIGbF/swA92ohVg0//6X2IVY3KZs6p9mix0ziNYJM=
 golang.org/x/time v0.0.0-20180412165947-fbb02b2291d2/go.mod h1:tRJNPiyCQ0inRvYxbN9jk5I+vvW/OXSQhTDSoE431IQ=
 golang.org/x/tools v0.0.0-20180221164845-07fd8470d635/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=
+golang.org/x/tools v0.0.0-20180917221912-90fa682c2a6e/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=
 golang.org/x/tools v0.0.0-20190114222345-bf090417da8b/go.mod h1:n7NCudcB/nEzxVGmLbDWY5pfWTLqBcC2KZ6jyYvM4mQ=
 golang.org/x/tools v0.0.0-20190226205152-f727befe758c/go.mod h1:9Yl7xja0Znq3iFh3HoIrodX9oNMXvdceNzlUR8zjMvY=
 golang.org/x/tools v0.0.0-20190311212946-11955173bddd/go.mod h1:LCzVGOaR6xXOjkQ3onu1FJEFr0SW1gC7cKk1uF8kGRs=
