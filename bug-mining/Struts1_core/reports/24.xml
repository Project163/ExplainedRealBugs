<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:53:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[STR-2700] Hanging Fileupload in Large Input JSP</title>
                <link>https://issues.apache.org/jira/browse/STR-2700</link>
                <project id="12311043" key="STR">Struts 1</project>
                    <description>&lt;p&gt;Steps: &lt;br/&gt;
1. Select the WAR struts-example.war in the binary distribution of struts 1.2.8&lt;br/&gt;
2. Modify the page Upload.jsp in the following way: Add a 20 kB of static HTML&lt;br/&gt;
after the form.&lt;br/&gt;
3. Deploy&lt;/p&gt;

&lt;p&gt;Observation: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;A file upload with a filesize &amp;lt; Max Filesize completes correctly.&lt;/li&gt;
	&lt;li&gt;A file upload with a filesize &amp;gt; Max Filesize does not complete. The&lt;br/&gt;
application hangs and the error message will not be displayed. &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This behavior has been tested on Tomcat / PC, Weblogic 8.1 / Sun, Weblogic 8.1 / PC&lt;/p&gt;</description>
                <environment>Operating System: All&lt;br/&gt;
Platform: PC</environment>
        <key id="12447637">STR-2700</key>
            <summary>Hanging Fileupload in Large Input JSP</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="urs.hassler@id.ethz.ch">Urs Hassler</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Dec 2005 01:12:53 +0000</created>
                <updated>Wed, 4 Jul 2007 15:30:24 +0000</updated>
                            <resolved>Wed, 4 Jul 2007 15:28:18 +0000</resolved>
                                    <version>1.2.8</version>
                                    <fixVersion>1.4.0</fixVersion>
                                    <component>Core</component>
                    <component>Example Applications</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12814348" author="urs.hassler@id.ethz.ch" created="Thu, 22 Dec 2005 01:19:13 +0000"  >&lt;p&gt;Created an attachment (id=17253)&lt;br/&gt;
Modified JSP Upload.jsp from struts-examples.war&lt;/p&gt;

&lt;p&gt;The modification described in the bug report has been made in the JSP&lt;br/&gt;
Upload.jsp taken from struts-examples.war&lt;/p&gt;</comment>
                            <comment id="12816866" author="niallp" created="Thu, 9 Mar 2006 12:42:45 +0000"  >&lt;p&gt;I can reproduce this with the file you supply, but I have no clue as to what is &lt;br/&gt;
causing this.&lt;/p&gt;

&lt;p&gt;I added additional debug statements to the RequestProcessor and it hangs in the &lt;br/&gt;
doForward() method on the following statement.&lt;/p&gt;

&lt;p&gt;   rd.forward(request, response);&lt;/p&gt;</comment>
                            <comment id="12814294" author="paul4christ79@yahoo.com" created="Thu, 9 Mar 2006 13:57:42 +0000"  >&lt;p&gt;I tried myself but I did not hang. I am using Tomcat 5.0.28 on Struts 1.2.8. I&lt;br/&gt;
replaced the upload.jsp with the attachment and then uploaded itself. Did I do&lt;br/&gt;
it wrong? What is the &quot;maxsize&quot; set to - isn&apos;t it 250MB default?&lt;/p&gt;</comment>
                            <comment id="12814371" author="paul4christ79@yahoo.com" created="Thu, 9 Mar 2006 14:26:23 +0000"  >&lt;p&gt;Finally, I got it to hang. In Eclipse, simply right-click the hanging thread and&lt;br/&gt;
do suspend. You will then be able to see the stack trace and you can&lt;br/&gt;
additionally right-click on it and copy it out. Here is where it is hanging. I&lt;br/&gt;
hope this helps diagnose the problem:&lt;/p&gt;

&lt;p&gt;  SocketOutputStream.socketWrite0(FileDescriptor, byte[], int, int) line: not&lt;br/&gt;
available &lt;span class=&quot;error&quot;&gt;&amp;#91;native method&amp;#93;&lt;/span&gt;&lt;br/&gt;
  SocketOutputStream.socketWrite(byte[], int, int) line: 92&lt;br/&gt;
  SocketOutputStream.write(byte[], int, int) line: 136&lt;br/&gt;
  InternalOutputBuffer.realWriteBytes(byte[], int, int) line: 714&lt;br/&gt;
  ByteChunk.flushBuffer() line: 398&lt;br/&gt;
  ByteChunk.append(byte[], int, int) line: 318&lt;br/&gt;
  InternalOutputBuffer$OutputStreamOutputBuffer.doWrite(ByteChunk, Response)&lt;br/&gt;
line: 737&lt;br/&gt;
  ChunkedOutputFilter.doWrite(ByteChunk, Response) line: 125&lt;br/&gt;
  InternalOutputBuffer.doWrite(ByteChunk, Response) line: 569&lt;br/&gt;
  Response.doWrite(ByteChunk) line: 542&lt;br/&gt;
  OutputBuffer.realWriteBytes(byte[], int, int) line: 368&lt;br/&gt;
  ByteChunk.append(byte[], int, int) line: 294&lt;br/&gt;
  IntermediateOutputStream.write(byte[], int, int) line: 230&lt;br/&gt;
  StreamEncoder$CharsetSE.writeBytes() line: 336&lt;br/&gt;
  StreamEncoder$CharsetSE.implFlushBuffer() line: 404&lt;br/&gt;
  StreamEncoder$CharsetSE.implFlush() line: 408&lt;br/&gt;
  StreamEncoder$CharsetSE(StreamEncoder).flush() line: 152&lt;br/&gt;
  WriteConvertor(OutputStreamWriter).flush() line: 213&lt;br/&gt;
  WriteConvertor.flush() line: 179&lt;br/&gt;
  C2BConverter.flushBuffer() line: 122&lt;br/&gt;
  OutputBuffer.realWriteChars(char[], int, int) line: 570&lt;br/&gt;
  CharChunk.append(char[], int, int) line: 261&lt;br/&gt;
  OutputBuffer.write(char[], int, int) line: 475&lt;br/&gt;
  CoyoteWriter.write(char[], int, int) line: 130&lt;br/&gt;
  JspWriterImpl.flushBuffer() line: 116&lt;br/&gt;
  JspWriterImpl.write(String, int, int) line: 324&lt;br/&gt;
  JspWriterImpl.write(String) line: 335&lt;br/&gt;
  upload.jsp line: 108&lt;br/&gt;
  upload_jsp(HttpJspBase).service(HttpServletRequest, HttpServletResponse) line: 94&lt;br/&gt;
  upload_jsp(HttpServlet).service(ServletRequest, ServletResponse) line: 802&lt;br/&gt;
  JspServletWrapper.service(HttpServletRequest, HttpServletResponse, boolean)&lt;br/&gt;
line: 324&lt;br/&gt;
  JspServlet.serviceJspFile(HttpServletRequest, HttpServletResponse, String,&lt;br/&gt;
Throwable, boolean) line: 292&lt;br/&gt;
  JspServlet.service(HttpServletRequest, HttpServletResponse) line: 236&lt;br/&gt;
  JspServlet(HttpServlet).service(ServletRequest, ServletResponse) line: 802&lt;br/&gt;
  ApplicationFilterChain.internalDoFilter(ServletRequest, ServletResponse) line: 237&lt;br/&gt;
  ApplicationFilterChain.doFilter(ServletRequest, ServletResponse) line: 157&lt;br/&gt;
  ApplicationDispatcher.invoke(ServletRequest, ServletResponse) line: 704&lt;br/&gt;
  ApplicationDispatcher.processRequest(ServletRequest, ServletResponse) line: 474&lt;br/&gt;
  ApplicationDispatcher.doForward(ServletRequest, ServletResponse) line: 409&lt;br/&gt;
  ApplicationDispatcher.forward(ServletRequest, ServletResponse) line: 312&lt;br/&gt;
  RequestProcessor.doForward(String, HttpServletRequest, HttpServletResponse)&lt;br/&gt;
line: 1072&lt;/p&gt;</comment>
                            <comment id="12814352" author="paul4christ79@yahoo.com" created="Wed, 15 Mar 2006 14:17:56 +0000"  >&lt;p&gt;I am still investigating, and tenatively think this may be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/STR-2585&quot; title=&quot;Struts not populating form values when maxFileSize exceeded during file upload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;STR-2585&quot;&gt;STR-2585&lt;/a&gt;.&lt;br/&gt;
When I turned off validation, the form properties were null and app blew up&lt;br/&gt;
(NPE). Is it possible that the page is hanging because the form values are&lt;br/&gt;
unavailable in the page refresh?&lt;/p&gt;</comment>
                            <comment id="12808455" author="pbenedict" created="Tue, 3 Jul 2007 02:57:14 +0000"  >&lt;p&gt;If you do a google search on &quot;hang socketWrite0&quot; you will find a slew of other applications that have the same problem. It somehow deals with the socket is blocking because of a full buffer or a network error.&lt;/p&gt;

&lt;p&gt;Some references:&lt;br/&gt;
&lt;a href=&quot;http://forum.java.sun.com/thread.jspa?threadID=655814&amp;amp;messageID=3855170&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://forum.java.sun.com/thread.jspa?threadID=655814&amp;amp;messageID=3855170&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://www-1.ibm.com/support/docview.wss?rs=180&amp;amp;uid=swg1PK37506&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www-1.ibm.com/support/docview.wss?rs=180&amp;amp;uid=swg1PK37506&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So it looks possible that we can fix this. I just don&apos;t know how yet.&lt;/p&gt;</comment>
                            <comment id="12815405" author="jirareport" created="Tue, 3 Jul 2007 22:19:31 +0000"  >&lt;p&gt;Not able to replicate on a Mac. Will try with Win XP and Win 2K tonight.&lt;/p&gt;</comment>
                            <comment id="12815384" author="jirareport" created="Wed, 4 Jul 2007 06:49:56 +0000"  >&lt;p&gt;Replicated on Windows XP, JDK 1.5.0_01.  Not replicated on OS X, JDK 1.5. &lt;/p&gt;

&lt;p&gt;Original reporter was on Windows, as is Paul (on XP he said). I&apos;m pretty sure Niall was using Windows too.&lt;/p&gt;</comment>
                            <comment id="12815406" author="jirareport" created="Wed, 4 Jul 2007 06:51:01 +0000"  >&lt;p&gt;Also with 1.6.0-beta2 on Windows XP. Both times with Tomcat 5.5.23. OS X was with 5.5.20. &lt;/p&gt;</comment>
                            <comment id="12808451" author="pbenedict" created="Wed, 4 Jul 2007 14:23:55 +0000"  >&lt;p&gt;Alright. So the last question is why rejecting the upload causes the hang? I can deal with a WONTFIX because it appears to a platform specific issue, but I believe we need to find out why Struts is a catalyst.&lt;/p&gt;</comment>
                            <comment id="12808456" author="pbenedict" created="Wed, 4 Jul 2007 15:20:26 +0000"  >&lt;p&gt;Here&apos;s my testing:&lt;/p&gt;

&lt;p&gt;1) Removed all delegation to DiskFileUpload in CommonsMultipartRequestHandler, but the problem remained. This ruled out a problem with file parsing.&lt;/p&gt;

&lt;p&gt;2) Threw a NullPointerException in CommonsMultipartRequestHandler, but the problem remained. This ruled out a problem with handling specific exceptions from Commons FileUpload.&lt;/p&gt;

&lt;p&gt;3) Did nothing but set MultipartRequestHandler.ATTRIBUTE_MAX_LENGTH_EXCEEDED, but the problem remained. This ruled out any special Struts handling of aborting uploads.&lt;/p&gt;

&lt;p&gt;After some ruminations, the web was indicating that the problem is caused by the socket blocking because no one is reading from it. So what I did was finish reading the input stream and threw away the buffer. This prevented any blocking when the forwarded page was rendered.&lt;/p&gt;</comment>
                            <comment id="12808299" author="pbenedict" created="Wed, 4 Jul 2007 15:28:18 +0000"  >&lt;p&gt;Patching Struts. Should this fix officially go to Commons FileUpload too?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12433116" name="ASF.LICENSE.NOT.GRANTED--upload.jsp" size="99137" author="urs.hassler@id.ethz.ch" created="Thu, 22 Dec 2005 01:19:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_10010" key="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        <customfieldname>Bugzilla Id</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>37995</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34884</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 21 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0aaxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58044</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>