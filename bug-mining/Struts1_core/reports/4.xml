<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:52:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[STR-2854] mask validator error</title>
                <link>https://issues.apache.org/jira/browse/STR-2854</link>
                <project id="12311043" key="STR">Struts 1</project>
                    <description>&lt;p&gt;I have a problem with the mask validator when it is used without  others validators such as &quot;required&quot;  in struts 1.2.7. &lt;br/&gt;
For example,  I have a field which  depends of a radio button selecction (requiredif in previous versions). In this case I&apos;m using the &quot;validwhen&quot; and the &quot;mask&quot; validators because that field is  an string with a date format (dd/mm/yyyy), so, i need to check it (optional fields with a special format. For that reason, I can&apos;t use the &quot;required&quot; rule).  The problem is when it is filled in with only blank spaces. In this case, the &quot;mask&quot; validator doesn&apos;t work. &lt;/p&gt;

&lt;p&gt;&amp;lt;field property=&quot;txtDate&quot; depends=&quot;mask,validwhen&quot;&amp;gt;&lt;br/&gt;
   &amp;lt;msg name=&quot;mask&quot; key=&quot;errors.invalid&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;arg position=&quot;0&quot; key=&quot;A&#241;o&quot; resource=&quot;false&quot;/&amp;gt;&lt;br/&gt;
             &amp;lt;var&amp;gt;&lt;br/&gt;
                 &amp;lt;var-name&amp;gt;mask&amp;lt;/var-name&amp;gt;&lt;br/&gt;
                 &amp;lt;var-value&amp;gt;${formatDate}&amp;lt;/var-value&amp;gt;&lt;br/&gt;
             &amp;lt;/var&amp;gt;&lt;br/&gt;
        &amp;lt;var&amp;gt;&lt;br/&gt;
           &amp;lt;var-name&amp;gt;test&amp;lt;/var-name&amp;gt;&lt;br/&gt;
           &amp;lt;var-value&amp;gt;(((rdSelector==0) and (&lt;b&gt;this&lt;/b&gt; !=null )) or (rdSelector==1))&amp;lt;/var-value&amp;gt;&lt;br/&gt;
        &amp;lt;/var&amp;gt;&lt;br/&gt;
  &amp;lt;/field&amp;gt;&lt;/p&gt;

&lt;p&gt;where:&lt;br/&gt;
${formatDate} = ^&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;/&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;/&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;$&lt;br/&gt;
rdSelector is my radio  button  field&lt;br/&gt;
txtDate  is a date textfield.&lt;/p&gt;

&lt;p&gt;I think, the problem is in the validateMask method of the FieldChecks class (org.apache.struts.validator):&lt;/p&gt;

&lt;p&gt;public static boolean validateMask(Object bean,ValidatorAction va, Field field,ActionMessages errors, Validator validator, HttpServletRequest request) {&lt;/p&gt;

&lt;p&gt;        String mask = field.getVarValue(&quot;mask&quot;);&lt;br/&gt;
        String value = null;&lt;br/&gt;
        if (isString(bean)) &lt;/p&gt;
{
            value = (String) bean;
        }
&lt;p&gt; else &lt;/p&gt;
{
            value = ValidatorUtils.getValueAsString(bean, field.getProperty());
        }
&lt;p&gt;        try {&lt;br/&gt;
            if (!GenericValidator.isBlankOrNull(value) // &amp;lt;b&amp;gt;THIS IS THE PROBLEM&amp;lt;/b&amp;gt;&lt;br/&gt;
                &amp;amp;&amp;amp; !GenericValidator.matchRegexp(value, mask)) &lt;/p&gt;
{
                errors.add(field.getKey(),
                    Resources.getActionMessage(validator, request, va, field));
                return false;
            }
&lt;p&gt; else &lt;/p&gt;
{
                return true;
            }
&lt;p&gt;        } catch (Exception e) &lt;/p&gt;
{
            log.error(e.getMessage(), e);
        }
&lt;p&gt;        return true;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;The problem I found is in the second if:   &lt;br/&gt;
 if (!GenericValidator.isBlankOrNull(value)  &amp;amp;&amp;amp; ......&lt;/p&gt;

&lt;p&gt;this means that if the field is empty, null or with only blank spaces as the isBlankOrNull method  does,  the  field is not considered as invalid (the if block  doesn&apos;t execute, so no errors are generated), and the second condition never executes because of the &amp;amp;&amp;amp; operator, so, the Regular expression  is never checked..  &lt;/p&gt;

&lt;p&gt;I think , the if statement should be something like this ...&lt;/p&gt;

&lt;p&gt;  if (value != null &amp;amp;&amp;amp; value.length()&amp;gt;0&lt;br/&gt;
                &amp;amp;&amp;amp; !GenericValidator.matchRegexp(value, mask)) {&lt;/p&gt;

&lt;p&gt;it is almost the same as the original if, but the difference is that it  also includes strings with only&lt;br/&gt;
blank spaces,  and in this case  the validator returns false just as it should be .. &lt;/p&gt;


&lt;p&gt;have you seen any problem like this?,   can be fixed this problem in new releases? or there are some other solutions to solve it ?&lt;/p&gt;

&lt;p&gt;Thanks for your help.&lt;/p&gt;
</description>
                <environment>Windows XP, Weblogic 8.1 SP5</environment>
        <key id="12448072">STR-2854</key>
            <summary>mask validator error</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mrdon">Donald J. Brown</assignee>
                                    <reporter username="jorgerdc">Jorge Rodr&#237;guez</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 May 2006 05:31:17 +0000</created>
                <updated>Tue, 9 May 2006 22:13:14 +0000</updated>
                            <resolved>Sun, 7 May 2006 12:34:17 +0000</resolved>
                                    <version>1.2.7</version>
                                    <fixVersion>1.3.3</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12814566" author="mrdon" created="Sun, 7 May 2006 12:34:16 +0000"  >&lt;p&gt;I think it is a valid change to allow strings with just spaces, as your regex might allow for that.  I made the change, so please close the ticket if you can verify.&lt;/p&gt;</comment>
                            <comment id="12814534" author="jorgerdc" created="Tue, 9 May 2006 22:13:14 +0000"  >&lt;p&gt;Thanks for your help, I Hope see this change included in  the next release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34809</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            19 years, 29 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0aagv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57969</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>