<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:53:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[STR-2997] [validator] validwhen strings don&apos;t work right</title>
                <link>https://issues.apache.org/jira/browse/STR-2997</link>
                <project id="12311043" key="STR">Struts 1</project>
                    <description>&lt;p&gt;I originally noticed this problem with struts 1.2.4, but upgrading to 1.2.9 didn&apos;t fix it.  I can&apos;t upgrade to 1.3.5 right now so I don&apos;t know if it still exists there or not.&lt;/p&gt;

&lt;p&gt;It seems that the content of string that is usable by the validwhen validator is oddly limited.  It only appears to allow letters and a few other random characters.  This makes the validator mostly useless.&lt;/p&gt;

&lt;p&gt;I tried to define a field validation using the validwhen validator:&lt;/p&gt;

&lt;p&gt;&amp;lt;field property=&quot;myfield&quot; depends=&quot;validwhen&quot;&amp;gt;&lt;br/&gt;
     &amp;lt;arg0 key=&quot;prop.myfield&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;var&amp;gt;&lt;br/&gt;
            &amp;lt;var-name&amp;gt;test&amp;lt;/var-name&amp;gt;&lt;br/&gt;
            &amp;lt;var-value&amp;gt;(otherfield != &quot;foo:bar&quot;)&amp;lt;/var-value&amp;gt;&lt;br/&gt;
      &amp;lt;/var&amp;gt;&lt;br/&gt;
&amp;lt;/field&amp;gt;&lt;/p&gt;

&lt;p&gt;I got an error that looked like this:&lt;/p&gt;

&lt;p&gt;ValidWhen Error for field &apos; myfield&apos; - line 1:20: expecting &apos;&apos;&apos;, found &apos;:&apos;&lt;/p&gt;

&lt;p&gt;I tried it with a few other characters, but there didn&apos;t seem to be any pattern to what is allowed and what isn&apos;t.&lt;/p&gt;

&lt;p&gt;not ok:&lt;br/&gt;
    :@#$%^&amp;amp;;,/+&lt;/p&gt;

&lt;p&gt;ok:&lt;br/&gt;
    *().&amp;lt;&amp;gt;-_=&lt;/p&gt;

&lt;p&gt;(not a comprehensive list, I didn&apos;t try everything)&lt;br/&gt;
I tried using both single and double quotes, but it didn&apos;t seem to make a difference.&lt;br/&gt;
This problem seems to have been mentioned on the mailing lists a few times, but I wasn&apos;t able to find any answers.&lt;/p&gt;

&lt;p&gt;Looking at the definition of STRING_LITERAL in ValidWhenParser.g, it seems like any non-quote character should be allowed:&lt;/p&gt;

&lt;p&gt;STRING_LITERAL : (&apos;\&apos;&apos; (&lt;sub&gt;&apos;\&apos;&apos;)+ &apos;\&apos;&apos;) | (&apos;\&quot;&apos; (&lt;/sub&gt;&apos;\&quot;&apos;)+ &apos;\&quot;&apos;) ;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12448117">STR-2997</key>
            <summary>[validator] validwhen strings don&apos;t work right</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="erh">Eric Haszlakiewicz</reporter>
                        <labels>
                    </labels>
                <created>Sun, 14 Jan 2007 02:55:59 +0000</created>
                <updated>Wed, 7 Feb 2007 22:10:37 +0000</updated>
                            <resolved>Wed, 7 Feb 2007 22:10:37 +0000</resolved>
                                    <version>1.2.4</version>
                    <version>1.2.9</version>
                                    <fixVersion>1.3.7</fixVersion>
                                    <component>Core</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12816699" author="jirareport" created="Thu, 1 Feb 2007 23:25:20 +0000"  >&lt;p&gt;Looking at the valid chars, the pattern seems to be characters that are legal outside of a string literal. I&apos;d bet that &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39; and &amp;#39;&amp;#93;&lt;/span&gt;&apos; are okay too. Also &apos;!&apos; is probably okay. &apos;-&apos; would be okay because negative numbers are supported.&lt;/p&gt;

&lt;p&gt;So I&apos;m guessing the problem is that the STRING_LITERAL is not being applied to the part inside the quotes; instead it is treating it as source. Looking at ValidWhenParser.g, I can&apos;t see any obvious reasons why that&apos;d be so.&lt;/p&gt;</comment>
                            <comment id="12815318" author="jirareport" created="Thu, 1 Feb 2007 23:32:41 +0000"  >&lt;p&gt;If I add it to the ValidWhen unit test, I get an error:&lt;/p&gt;

&lt;p&gt;Feb 1, 2007 3:31:18 PM org.apache.struts.validator.TestValidWhen doParse&lt;br/&gt;
SEVERE: Parsing (&lt;b&gt;this&lt;/b&gt; == &quot;foo:bar&quot;) for property &apos;stringValue1&apos;&lt;br/&gt;
line 1:16: expecting &apos;&quot;&apos;, found &apos;:&apos;&lt;br/&gt;
        at org.apache.struts.validator.validwhen.ValidWhenLexer.nextToken(ValidWhenLexer.java:245)&lt;/p&gt;</comment>
                            <comment id="12816768" author="jirareport" created="Fri, 2 Feb 2007 00:36:53 +0000"  >&lt;p&gt;Digging into this more, it appears to be because the charVocabulary is not being set. Every char referenced in the antlr grammer is implicitly added to the charVocabulary, and when you say &quot;~f&quot;, it means every char other than f _&lt;em&gt;in the charVocabulary&lt;/em&gt;_. So the reason you don&apos;t see the other characters is that they&apos;ve not been added to the charVocabulary yet.&lt;/p&gt;

&lt;p&gt;I&apos;ll post in a bit with a recommended fix, once I figure out the correct way to generate the .g file into the .java file. I don&apos;t think the Struts trunk build is doing it automatically yet.&lt;/p&gt;</comment>
                            <comment id="12814044" author="jirareport" created="Fri, 2 Feb 2007 00:54:45 +0000"  >&lt;p&gt;Unit test for this issue.&lt;/p&gt;</comment>
                            <comment id="12816795" author="jirareport" created="Fri, 2 Feb 2007 00:59:10 +0000"  >&lt;p&gt;Fix for this issue. I&apos;ve chosen to make all chars from the space char up to the ~ legal. The rest of the grammar then adds the necessary ctrl characters (9,10,13). It&apos;s a bit wasteful as the uppercase chars are never checked as things are caseSensitive = false, but I don&apos;t think that&apos;s a big deal.&lt;/p&gt;

&lt;p&gt;It does mean that Extended ISO and Unicode are not permitted. The Antlr site points out that a ~ on a Unicode charVocabulary takes up 8k, so that seems like something to think carefully about getting into.&lt;/p&gt;</comment>
                            <comment id="12815914" author="jirareport" created="Wed, 7 Feb 2007 22:10:37 +0000"  >&lt;p&gt; svn ci -m &quot;Applying unit test and fix from &lt;a href=&quot;https://issues.apache.org/jira/browse/STR-2997&quot; title=&quot;[validator] validwhen strings don&amp;#39;t work right&quot; class=&quot;issue-link&quot; data-issue-key=&quot;STR-2997&quot;&gt;&lt;del&gt;STR-2997&lt;/del&gt;&lt;/a&gt;. Antlr 2.7.2 used to regenerate the parser/lexer. &quot;&lt;/p&gt;

&lt;p&gt;Sending        core/src/main/java/org/apache/struts/validator/validwhen/ValidWhenLexer.java&lt;br/&gt;
Sending        core/src/main/java/org/apache/struts/validator/validwhen/ValidWhenParser.g&lt;br/&gt;
Sending        core/src/main/java/org/apache/struts/validator/validwhen/ValidWhenParser.java&lt;br/&gt;
Sending        core/src/main/java/org/apache/struts/validator/validwhen/ValidWhenParserTokenTypes.java&lt;br/&gt;
Sending        core/src/main/java/org/apache/struts/validator/validwhen/ValidWhenParserTokenTypes.txt&lt;br/&gt;
Sending        core/src/test/java/org/apache/struts/validator/TestValidWhen.java&lt;br/&gt;
Transmitting file data ......&lt;br/&gt;
Committed revision 504715.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12433296" name="STR-2997-fix.patch" size="463" author="jirareport" created="Fri, 2 Feb 2007 00:59:09 +0000"/>
                            <attachment id="12433266" name="STR-2997-test.patch" size="676" author="jirareport" created="Fri, 2 Feb 2007 00:54:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34669</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 42 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0a9lr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>57829</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>