diff --git a/lib/sidekiq/middleware/current_attributes.rb b/lib/sidekiq/middleware/current_attributes.rb
index 80cbe959..3b52536c 100644
--- a/lib/sidekiq/middleware/current_attributes.rb
+++ b/lib/sidekiq/middleware/current_attributes.rb
@@ -46,22 +46,26 @@ module Sidekiq
       end
 
       def call(_, job, _, &block)
-        cattrs_to_reset = []
+        klass_attrs = {}
 
         @cattrs.each do |(key, strklass)|
-          if job.has_key?(key)
-            constklass = strklass.constantize
-            cattrs_to_reset << constklass
+          next unless job.has_key?(key)
 
-            job[key].each do |(attribute, value)|
-              constklass.public_send(:"#{attribute}=", value)
-            end
-          end
+          klass_attrs[strklass.constantize] = job[key]
         end
 
-        yield
-      ensure
-        cattrs_to_reset.each(&:reset)
+        wrap(klass_attrs.to_a, &block)
+      end
+
+      private
+
+      def wrap(klass_attrs, &block)
+        klass, attrs = klass_attrs.shift
+        return block.call unless klass
+
+        klass.set(attrs) do
+          wrap(klass_attrs, &block)
+        end
       end
     end
 
diff --git a/test/current_attributes_test.rb b/test/current_attributes_test.rb
index dab008cb..15aa8bb0 100644
--- a/test/current_attributes_test.rb
+++ b/test/current_attributes_test.rb
@@ -14,6 +14,13 @@ module Myapp
   end
 end
 
+class CurrentAttributesJob
+  include Sidekiq::Job
+
+  def perform
+  end
+end
+
 describe "Current attributes" do
   before do
     @config = reset!
@@ -94,6 +101,15 @@ describe "Current attributes" do
     end
   end
 
+  it "persists after perform_inline" do
+    Sidekiq::CurrentAttributes.persist("Myapp::Current", @config)
+    with_context("Myapp::Current", :user_id, 16) do
+      assert_equal 16, Myapp::Current.user_id
+      CurrentAttributesJob.perform_inline
+      assert_equal 16, Myapp::Current.user_id
+    end
+  end
+
   private
 
   def with_context(strklass, attr, value)
