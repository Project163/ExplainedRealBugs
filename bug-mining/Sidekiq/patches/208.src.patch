diff --git a/Changes.md b/Changes.md
index 55036645..2a10312c 100644
--- a/Changes.md
+++ b/Changes.md
@@ -8,6 +8,7 @@ HEAD
 - Fix crash on Ctrl-C in Windows [#3775, Bernica]
 - Remove `freeze` calls on String constants. This is superfluous with Ruby
   2.3+ and `frozen_string_literal: true`. [#3759]
+- Fix use of AR middleware outside of Rails [#3787]
 
 5.1.1
 -----------
diff --git a/lib/sidekiq/middleware/server/active_record.rb b/lib/sidekiq/middleware/server/active_record.rb
index c47ed71d..0ef2aab7 100644
--- a/lib/sidekiq/middleware/server/active_record.rb
+++ b/lib/sidekiq/middleware/server/active_record.rb
@@ -6,7 +6,7 @@ module Sidekiq
         def initialize
           # With Rails 5+ we must use the Reloader **always**.
           # The reloader handles code loading and db connection management.
-          if ::Rails::VERSION::MAJOR >= 5
+          if defined?(::Rails) && ::Rails::VERSION::MAJOR >= 5
             raise ArgumentError, "Rails 5 no longer needs or uses the ActiveRecord middleware."
           end
         end
