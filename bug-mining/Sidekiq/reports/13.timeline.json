[{"id":12633099,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDEyNjMzMDk5","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/12633099","actor":{"login":"Burgestrand","id":99166,"node_id":"MDQ6VXNlcjk5MTY2","avatar_url":"https://avatars.githubusercontent.com/u/99166?v=4","gravatar_id":"","url":"https://api.github.com/users/Burgestrand","html_url":"https://github.com/Burgestrand","followers_url":"https://api.github.com/users/Burgestrand/followers","following_url":"https://api.github.com/users/Burgestrand/following{/other_user}","gists_url":"https://api.github.com/users/Burgestrand/gists{/gist_id}","starred_url":"https://api.github.com/users/Burgestrand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Burgestrand/subscriptions","organizations_url":"https://api.github.com/users/Burgestrand/orgs","repos_url":"https://api.github.com/users/Burgestrand/repos","events_url":"https://api.github.com/users/Burgestrand/events{/privacy}","received_events_url":"https://api.github.com/users/Burgestrand/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2012-04-03T09:28:32Z","performed_via_github_app":null},{"id":12633680,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDEyNjMzNjgw","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/12633680","actor":{"login":"ryanlecompte","id":637158,"node_id":"MDQ6VXNlcjYzNzE1OA==","avatar_url":"https://avatars.githubusercontent.com/u/637158?v=4","gravatar_id":"","url":"https://api.github.com/users/ryanlecompte","html_url":"https://github.com/ryanlecompte","followers_url":"https://api.github.com/users/ryanlecompte/followers","following_url":"https://api.github.com/users/ryanlecompte/following{/other_user}","gists_url":"https://api.github.com/users/ryanlecompte/gists{/gist_id}","starred_url":"https://api.github.com/users/ryanlecompte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryanlecompte/subscriptions","organizations_url":"https://api.github.com/users/ryanlecompte/orgs","repos_url":"https://api.github.com/users/ryanlecompte/repos","events_url":"https://api.github.com/users/ryanlecompte/events{/privacy}","received_events_url":"https://api.github.com/users/ryanlecompte/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2012-04-03T09:40:16Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/4906329","html_url":"https://github.com/sidekiq/sidekiq/issues/110#issuecomment-4906329","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/110","id":4906329,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5MDYzMjk=","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-04-03T16:01:34Z","updated_at":"2012-04-03T16:01:34Z","body":"There's nothing we can do about SIGKILL without using blpoprpush, since processes cannot trap that signal.  A TerminateMiddleware is not a bad solution.  Any other opinions?\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/4906329/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12661323,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDEyNjYxMzIz","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/12661323","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2012-04-03T16:01:34Z","performed_via_github_app":null},{"id":12725754,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDEyNzI1NzU0","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/12725754","actor":{"login":"masterkain","id":12844,"node_id":"MDQ6VXNlcjEyODQ0","avatar_url":"https://avatars.githubusercontent.com/u/12844?v=4","gravatar_id":"","url":"https://api.github.com/users/masterkain","html_url":"https://github.com/masterkain","followers_url":"https://api.github.com/users/masterkain/followers","following_url":"https://api.github.com/users/masterkain/following{/other_user}","gists_url":"https://api.github.com/users/masterkain/gists{/gist_id}","starred_url":"https://api.github.com/users/masterkain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/masterkain/subscriptions","organizations_url":"https://api.github.com/users/masterkain/orgs","repos_url":"https://api.github.com/users/masterkain/repos","events_url":"https://api.github.com/users/masterkain/events{/privacy}","received_events_url":"https://api.github.com/users/masterkain/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2012-04-04T06:56:59Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/4970276","html_url":"https://github.com/sidekiq/sidekiq/issues/110#issuecomment-4970276","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/110","id":4970276,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzAyNzY=","user":{"login":"Burgestrand","id":99166,"node_id":"MDQ6VXNlcjk5MTY2","avatar_url":"https://avatars.githubusercontent.com/u/99166?v=4","gravatar_id":"","url":"https://api.github.com/users/Burgestrand","html_url":"https://github.com/Burgestrand","followers_url":"https://api.github.com/users/Burgestrand/followers","following_url":"https://api.github.com/users/Burgestrand/following{/other_user}","gists_url":"https://api.github.com/users/Burgestrand/gists{/gist_id}","starred_url":"https://api.github.com/users/Burgestrand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Burgestrand/subscriptions","organizations_url":"https://api.github.com/users/Burgestrand/orgs","repos_url":"https://api.github.com/users/Burgestrand/repos","events_url":"https://api.github.com/users/Burgestrand/events{/privacy}","received_events_url":"https://api.github.com/users/Burgestrand/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-04-05T08:11:19Z","updated_at":"2012-04-05T08:56:30Z","body":"If we reverse the queue, could we use [rpoplpush](http://redis.io/commands/rpoplpush) or, well, its blocking variant [brpoplpush](http://redis.io/commands/brpoplpush)?\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/4970276/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Burgestrand","id":99166,"node_id":"MDQ6VXNlcjk5MTY2","avatar_url":"https://avatars.githubusercontent.com/u/99166?v=4","gravatar_id":"","url":"https://api.github.com/users/Burgestrand","html_url":"https://github.com/Burgestrand","followers_url":"https://api.github.com/users/Burgestrand/followers","following_url":"https://api.github.com/users/Burgestrand/following{/other_user}","gists_url":"https://api.github.com/users/Burgestrand/gists{/gist_id}","starred_url":"https://api.github.com/users/Burgestrand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Burgestrand/subscriptions","organizations_url":"https://api.github.com/users/Burgestrand/orgs","repos_url":"https://api.github.com/users/Burgestrand/repos","events_url":"https://api.github.com/users/Burgestrand/events{/privacy}","received_events_url":"https://api.github.com/users/Burgestrand/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/4977217","html_url":"https://github.com/sidekiq/sidekiq/issues/110#issuecomment-4977217","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/110","id":4977217,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzcyMTc=","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-04-05T14:14:13Z","updated_at":"2012-04-05T14:14:13Z","body":"Unfortunately that would require me to completely redesign how Sidekiq fetches work from Redis.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/4977217/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/4989877","html_url":"https://github.com/sidekiq/sidekiq/issues/110#issuecomment-4989877","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/110","id":4989877,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODk4Nzc=","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-04-06T02:54:56Z","updated_at":"2012-04-06T02:54:56Z","body":"I agree that 10 seconds is not enough time to handle many async jobs.  Unfortunately it seems that Heroku doesn't allow sending arbitrary signals (like USR1) to processes which would help a bit.\n\nIt sounds like you want a 100% reliable solution, which would require brpoplpush.  I think the best I can suggest at this point is more of a design philosophy: Sidekiq makes having lots of workers cheap, so refactoring your jobs into smaller pieces means that each will finish faster and if you do lose one, you lose \"less\" overall.  For instance, instead of processing a batch of items as one long-running job, process each item as a separate job.  Sorry I can't offer an immediate solution at this point.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/4989877/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12886766,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDEyODg2NzY2","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/12886766","actor":{"login":"fbjork","id":4585,"node_id":"MDQ6VXNlcjQ1ODU=","avatar_url":"https://avatars.githubusercontent.com/u/4585?v=4","gravatar_id":"","url":"https://api.github.com/users/fbjork","html_url":"https://github.com/fbjork","followers_url":"https://api.github.com/users/fbjork/followers","following_url":"https://api.github.com/users/fbjork/following{/other_user}","gists_url":"https://api.github.com/users/fbjork/gists{/gist_id}","starred_url":"https://api.github.com/users/fbjork/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fbjork/subscriptions","organizations_url":"https://api.github.com/users/fbjork/orgs","repos_url":"https://api.github.com/users/fbjork/repos","events_url":"https://api.github.com/users/fbjork/events{/privacy}","received_events_url":"https://api.github.com/users/fbjork/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2012-04-06T05:01:14Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/4990819","html_url":"https://github.com/sidekiq/sidekiq/issues/110#issuecomment-4990819","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/110","id":4990819,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTA4MTk=","user":{"login":"fbjork","id":4585,"node_id":"MDQ6VXNlcjQ1ODU=","avatar_url":"https://avatars.githubusercontent.com/u/4585?v=4","gravatar_id":"","url":"https://api.github.com/users/fbjork","html_url":"https://github.com/fbjork","followers_url":"https://api.github.com/users/fbjork/followers","following_url":"https://api.github.com/users/fbjork/following{/other_user}","gists_url":"https://api.github.com/users/fbjork/gists{/gist_id}","starred_url":"https://api.github.com/users/fbjork/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fbjork/subscriptions","organizations_url":"https://api.github.com/users/fbjork/orgs","repos_url":"https://api.github.com/users/fbjork/repos","events_url":"https://api.github.com/users/fbjork/events{/privacy}","received_events_url":"https://api.github.com/users/fbjork/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-04-06T05:05:16Z","updated_at":"2012-04-06T05:05:16Z","body":"Many of our long running jobs poll external APIs that some time take more than 10 seconds to return, so there's not much I can do in terms of refactoring jobs into separate jobs. Would be super useful to see a solution to this in Sidekiq.\n\nWould this Heroku Labs addon help at all? https://devcenter.heroku.com/articles/labs-sigterm-all\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/4990819/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"fbjork","id":4585,"node_id":"MDQ6VXNlcjQ1ODU=","avatar_url":"https://avatars.githubusercontent.com/u/4585?v=4","gravatar_id":"","url":"https://api.github.com/users/fbjork","html_url":"https://github.com/fbjork","followers_url":"https://api.github.com/users/fbjork/followers","following_url":"https://api.github.com/users/fbjork/following{/other_user}","gists_url":"https://api.github.com/users/fbjork/gists{/gist_id}","starred_url":"https://api.github.com/users/fbjork/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fbjork/subscriptions","organizations_url":"https://api.github.com/users/fbjork/orgs","repos_url":"https://api.github.com/users/fbjork/repos","events_url":"https://api.github.com/users/fbjork/events{/privacy}","received_events_url":"https://api.github.com/users/fbjork/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/4991020","html_url":"https://github.com/sidekiq/sidekiq/issues/110#issuecomment-4991020","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/110","id":4991020,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTEwMjA=","user":{"login":"ryanlecompte","id":637158,"node_id":"MDQ6VXNlcjYzNzE1OA==","avatar_url":"https://avatars.githubusercontent.com/u/637158?v=4","gravatar_id":"","url":"https://api.github.com/users/ryanlecompte","html_url":"https://github.com/ryanlecompte","followers_url":"https://api.github.com/users/ryanlecompte/followers","following_url":"https://api.github.com/users/ryanlecompte/following{/other_user}","gists_url":"https://api.github.com/users/ryanlecompte/gists{/gist_id}","starred_url":"https://api.github.com/users/ryanlecompte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryanlecompte/subscriptions","organizations_url":"https://api.github.com/users/ryanlecompte/orgs","repos_url":"https://api.github.com/users/ryanlecompte/repos","events_url":"https://api.github.com/users/ryanlecompte/events{/privacy}","received_events_url":"https://api.github.com/users/ryanlecompte/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-04-06T05:39:32Z","updated_at":"2012-04-06T05:39:32Z","body":"@Burgestrand I took a look at your TerminateJobs middleware at https://gist.github.com/2290629. I think there may be a race condition with the signals:\n\nHere's a scenario:\n\n1) Thread A is executing its middleware chain for a job. When it gets to yield in the TerminateJobs middleware, it hangs for a while waiting on I/O or some other long operation.\n\n2) Meanwhile, Thread B comes along and happily executes its middleware chain. It gets to the TerminateJobs middleware, and upon executing yield it blocks for a while too since it's another long-running operation. However, before it gets to yield it also traps the new signals for itself, meanwhile preserving the signals set from #1 above since the currently installed signal handlers were from Thread A.\n\n3) Meanwhile, Thread A from #1 finishes executing, and restores its \"old_signals\" in the ensure clause that it originally set before it got to yield. Note that while it was executing it never saw the new signal handler that Thread B set for itself to ensure that its job gets rescheduled if Terminate is raised (i.e., \"old_signals\" never gets updated if other threads install new signal handlers).\n\nThe final outcome is that Thread A ends up overriding the custom signal handler that Thread B (or any other threads potentially) scheduled for itself, and if Sidekiq terminates via TERM/INT then Thread B's long-running job won't get rescheduled since Terminate will never get raised.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/4991020/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ryanlecompte","id":637158,"node_id":"MDQ6VXNlcjYzNzE1OA==","avatar_url":"https://avatars.githubusercontent.com/u/637158?v=4","gravatar_id":"","url":"https://api.github.com/users/ryanlecompte","html_url":"https://github.com/ryanlecompte","followers_url":"https://api.github.com/users/ryanlecompte/followers","following_url":"https://api.github.com/users/ryanlecompte/following{/other_user}","gists_url":"https://api.github.com/users/ryanlecompte/gists{/gist_id}","starred_url":"https://api.github.com/users/ryanlecompte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryanlecompte/subscriptions","organizations_url":"https://api.github.com/users/ryanlecompte/orgs","repos_url":"https://api.github.com/users/ryanlecompte/repos","events_url":"https://api.github.com/users/ryanlecompte/events{/privacy}","received_events_url":"https://api.github.com/users/ryanlecompte/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12887460,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTI4ODc0NjA=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/12887460","actor":{"login":"Burgestrand","id":99166,"node_id":"MDQ6VXNlcjk5MTY2","avatar_url":"https://avatars.githubusercontent.com/u/99166?v=4","gravatar_id":"","url":"https://api.github.com/users/Burgestrand","html_url":"https://github.com/Burgestrand","followers_url":"https://api.github.com/users/Burgestrand/followers","following_url":"https://api.github.com/users/Burgestrand/following{/other_user}","gists_url":"https://api.github.com/users/Burgestrand/gists{/gist_id}","starred_url":"https://api.github.com/users/Burgestrand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Burgestrand/subscriptions","organizations_url":"https://api.github.com/users/Burgestrand/orgs","repos_url":"https://api.github.com/users/Burgestrand/repos","events_url":"https://api.github.com/users/Burgestrand/events{/privacy}","received_events_url":"https://api.github.com/users/Burgestrand/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2012-04-06T05:39:32Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/5003585","html_url":"https://github.com/sidekiq/sidekiq/issues/110#issuecomment-5003585","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/110","id":5003585,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDM1ODU=","user":{"login":"Burgestrand","id":99166,"node_id":"MDQ6VXNlcjk5MTY2","avatar_url":"https://avatars.githubusercontent.com/u/99166?v=4","gravatar_id":"","url":"https://api.github.com/users/Burgestrand","html_url":"https://github.com/Burgestrand","followers_url":"https://api.github.com/users/Burgestrand/followers","following_url":"https://api.github.com/users/Burgestrand/following{/other_user}","gists_url":"https://api.github.com/users/Burgestrand/gists{/gist_id}","starred_url":"https://api.github.com/users/Burgestrand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Burgestrand/subscriptions","organizations_url":"https://api.github.com/users/Burgestrand/orgs","repos_url":"https://api.github.com/users/Burgestrand/repos","events_url":"https://api.github.com/users/Burgestrand/events{/privacy}","received_events_url":"https://api.github.com/users/Burgestrand/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-04-06T22:20:19Z","updated_at":"2012-04-06T23:36:08Z","body":"@ryanlecompte ah, that is true! After thinking about it though, even if the process of solving this with a middleware is an attractive approach I’m not sure it’s a good idea.\n\nThere are two issues currently being discussed:\n1. the one I’ve created this issue for, where Sidekiq does not forcefully shutdown/abort workers after five seconds, even though [it looks like it would attempt to](https://github.com/mperham/sidekiq/blob/2e58b1d9d8f3f06ec8d2499238121fc2ec6b1ed6/lib/sidekiq/manager.rb#L61). My hope for a resolution to this issue is to actually **forcefully** shut down all workers after the five seconds has passed and re-queue the job they were working on, instead of _asking_ them to terminate (and risk getting SIGKILLED by Heroku if the busy workers don’t finish their work).  \n   My _main_ concern is that Sidekiq [makes the appearance of allowing workers to finish for another five seconds before killing them](https://github.com/mperham/sidekiq/blob/2e58b1d9d8f3f06ec8d2499238121fc2ec6b1ed6/lib/sidekiq/manager.rb#L57), while it is in reality waiting _forever_ until the workers finish. This is because [ActorProxy#terminate](https://github.com/celluloid/celluloid/blob/7e02f248a673075e32ce8e3b0d20f48d3a03d879/lib/celluloid/actor_proxy.rb#L60) does not terminate the worker directly, but instead sends it a message (using [Mailbox#system_event](https://github.com/celluloid/celluloid/blob/8b926200892989404512006b421dacd9dde5fde8/lib/celluloid/mailbox.rb#L36)) that won’t be received until the worker finishes what it is currently working on.  \n   I don’t know if Celluloid has any way of forcefully and violently killing an actor currently working on a task, other than raising an exception in the actor thread. Perhaps raising an error in the actor thread _is_ the recommended approach of really interrupting an actor. This is a key part if one wishes to re-queue jobs that did not finish in time on shutdown.  \n   Now, I’ve noticed an earlier attempt at re-queuing jobs on the five-second-forceful shutdown, that was removed with no replacement in dec7472f33a609760b259abe62c12fce2c9ef3be. @mperham @ryanlecompte is there any way both of the above things (killing the busy actors, and re-queuing their unfinished work) can be solved in an elegant manner using middleware?\n2. the one of losing jobs on an immediate shutdown (SIGKILL et al), which would require brpoplpush/blpoprpush and probably a very large change to Sidekiq’s internals. This is a separate (and very complex) issue, and probably best served from a separate issue ticket.\n\nRe-reading my initial post about the issue I explained myself very badly and mixed these two issues into one. Sorry about that.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/5003585/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Burgestrand","id":99166,"node_id":"MDQ6VXNlcjk5MTY2","avatar_url":"https://avatars.githubusercontent.com/u/99166?v=4","gravatar_id":"","url":"https://api.github.com/users/Burgestrand","html_url":"https://github.com/Burgestrand","followers_url":"https://api.github.com/users/Burgestrand/followers","following_url":"https://api.github.com/users/Burgestrand/following{/other_user}","gists_url":"https://api.github.com/users/Burgestrand/gists{/gist_id}","starred_url":"https://api.github.com/users/Burgestrand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Burgestrand/subscriptions","organizations_url":"https://api.github.com/users/Burgestrand/orgs","repos_url":"https://api.github.com/users/Burgestrand/repos","events_url":"https://api.github.com/users/Burgestrand/events{/privacy}","received_events_url":"https://api.github.com/users/Burgestrand/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12934025,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTI5MzQwMjU=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/12934025","actor":{"login":"ryanlecompte","id":637158,"node_id":"MDQ6VXNlcjYzNzE1OA==","avatar_url":"https://avatars.githubusercontent.com/u/637158?v=4","gravatar_id":"","url":"https://api.github.com/users/ryanlecompte","html_url":"https://github.com/ryanlecompte","followers_url":"https://api.github.com/users/ryanlecompte/followers","following_url":"https://api.github.com/users/ryanlecompte/following{/other_user}","gists_url":"https://api.github.com/users/ryanlecompte/gists{/gist_id}","starred_url":"https://api.github.com/users/ryanlecompte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryanlecompte/subscriptions","organizations_url":"https://api.github.com/users/ryanlecompte/orgs","repos_url":"https://api.github.com/users/ryanlecompte/repos","events_url":"https://api.github.com/users/ryanlecompte/events{/privacy}","received_events_url":"https://api.github.com/users/ryanlecompte/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2012-04-06T22:20:19Z","performed_via_github_app":null},{"id":12934026,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50MTI5MzQwMjY=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/12934026","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2012-04-06T22:20:19Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/5005567","html_url":"https://github.com/sidekiq/sidekiq/issues/110#issuecomment-5005567","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/110","id":5005567,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDU1Njc=","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-04-07T02:51:05Z","updated_at":"2012-04-07T02:51:05Z","body":"I think I have an idea to fix (1) with a variant of the earlier attempt that I removed.  I don't expect (2) to be fixed any time soon.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/5005567/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":12943706,"node_id":"MDExOkNsb3NlZEV2ZW50MTI5NDM3MDY=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/12943706","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"1a00b88f8a2ba03c9dfcd40df2ba8d8e77a794fd","commit_url":"https://api.github.com/repos/sidekiq/sidekiq/commits/1a00b88f8a2ba03c9dfcd40df2ba8d8e77a794fd","created_at":"2012-04-07T03:53:18Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/5005824","html_url":"https://github.com/sidekiq/sidekiq/issues/110#issuecomment-5005824","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/110","id":5005824,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDU4MjQ=","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-04-07T03:55:22Z","updated_at":"2012-04-07T03:55:22Z","body":"Pretty straightforward.  I love how easy actors make complex concurrency!  The fix is on the safe_shutdown branch if you want to try it out.  I'll merge it into master tomorrow if I don't hear anything.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/5005824/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/5007281","html_url":"https://github.com/sidekiq/sidekiq/issues/110#issuecomment-5007281","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/110","id":5007281,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDcyODE=","user":{"login":"Burgestrand","id":99166,"node_id":"MDQ6VXNlcjk5MTY2","avatar_url":"https://avatars.githubusercontent.com/u/99166?v=4","gravatar_id":"","url":"https://api.github.com/users/Burgestrand","html_url":"https://github.com/Burgestrand","followers_url":"https://api.github.com/users/Burgestrand/followers","following_url":"https://api.github.com/users/Burgestrand/following{/other_user}","gists_url":"https://api.github.com/users/Burgestrand/gists{/gist_id}","starred_url":"https://api.github.com/users/Burgestrand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Burgestrand/subscriptions","organizations_url":"https://api.github.com/users/Burgestrand/orgs","repos_url":"https://api.github.com/users/Burgestrand/repos","events_url":"https://api.github.com/users/Burgestrand/events{/privacy}","received_events_url":"https://api.github.com/users/Burgestrand/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-04-07T10:27:44Z","updated_at":"2012-04-07T10:27:44Z","body":"Clean solution, I like it. Thank you!\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/5007281/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Burgestrand","id":99166,"node_id":"MDQ6VXNlcjk5MTY2","avatar_url":"https://avatars.githubusercontent.com/u/99166?v=4","gravatar_id":"","url":"https://api.github.com/users/Burgestrand","html_url":"https://github.com/Burgestrand","followers_url":"https://api.github.com/users/Burgestrand/followers","following_url":"https://api.github.com/users/Burgestrand/following{/other_user}","gists_url":"https://api.github.com/users/Burgestrand/gists{/gist_id}","starred_url":"https://api.github.com/users/Burgestrand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Burgestrand/subscriptions","organizations_url":"https://api.github.com/users/Burgestrand/orgs","repos_url":"https://api.github.com/users/Burgestrand/repos","events_url":"https://api.github.com/users/Burgestrand/events{/privacy}","received_events_url":"https://api.github.com/users/Burgestrand/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/5008414","html_url":"https://github.com/sidekiq/sidekiq/issues/110#issuecomment-5008414","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/110","id":5008414,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDg0MTQ=","user":{"login":"ryanlecompte","id":637158,"node_id":"MDQ6VXNlcjYzNzE1OA==","avatar_url":"https://avatars.githubusercontent.com/u/637158?v=4","gravatar_id":"","url":"https://api.github.com/users/ryanlecompte","html_url":"https://github.com/ryanlecompte","followers_url":"https://api.github.com/users/ryanlecompte/followers","following_url":"https://api.github.com/users/ryanlecompte/following{/other_user}","gists_url":"https://api.github.com/users/ryanlecompte/gists{/gist_id}","starred_url":"https://api.github.com/users/ryanlecompte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryanlecompte/subscriptions","organizations_url":"https://api.github.com/users/ryanlecompte/orgs","repos_url":"https://api.github.com/users/ryanlecompte/repos","events_url":"https://api.github.com/users/ryanlecompte/events{/privacy}","received_events_url":"https://api.github.com/users/ryanlecompte/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-04-07T14:11:37Z","updated_at":"2012-04-07T14:11:37Z","body":"Very nice indeed Mike! It's a good thing object_id doesn't get sent to the mailbox in Celluloid::ActorProxy. :-)\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/5008414/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"ryanlecompte","id":637158,"node_id":"MDQ6VXNlcjYzNzE1OA==","avatar_url":"https://avatars.githubusercontent.com/u/637158?v=4","gravatar_id":"","url":"https://api.github.com/users/ryanlecompte","html_url":"https://github.com/ryanlecompte","followers_url":"https://api.github.com/users/ryanlecompte/followers","following_url":"https://api.github.com/users/ryanlecompte/following{/other_user}","gists_url":"https://api.github.com/users/ryanlecompte/gists{/gist_id}","starred_url":"https://api.github.com/users/ryanlecompte/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ryanlecompte/subscriptions","organizations_url":"https://api.github.com/users/ryanlecompte/orgs","repos_url":"https://api.github.com/users/ryanlecompte/repos","events_url":"https://api.github.com/users/ryanlecompte/events{/privacy}","received_events_url":"https://api.github.com/users/ryanlecompte/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"johnreilly","id":4545,"node_id":"MDQ6VXNlcjQ1NDU=","avatar_url":"https://avatars.githubusercontent.com/u/4545?v=4","gravatar_id":"","url":"https://api.github.com/users/johnreilly","html_url":"https://github.com/johnreilly","followers_url":"https://api.github.com/users/johnreilly/followers","following_url":"https://api.github.com/users/johnreilly/following{/other_user}","gists_url":"https://api.github.com/users/johnreilly/gists{/gist_id}","starred_url":"https://api.github.com/users/johnreilly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johnreilly/subscriptions","organizations_url":"https://api.github.com/users/johnreilly/orgs","repos_url":"https://api.github.com/users/johnreilly/repos","events_url":"https://api.github.com/users/johnreilly/events{/privacy}","received_events_url":"https://api.github.com/users/johnreilly/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-06-13T20:48:09Z","updated_at":"2012-06-13T20:48:09Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/243","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/243/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/243/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/243/events","html_url":"https://github.com/sidekiq/sidekiq/issues/243","id":5056910,"node_id":"MDU6SXNzdWU1MDU2OTEw","number":243,"title":"Can long-running workers be notified of forceful shutdown?","user":{"login":"johnreilly","id":4545,"node_id":"MDQ6VXNlcjQ1NDU=","avatar_url":"https://avatars.githubusercontent.com/u/4545?v=4","gravatar_id":"","url":"https://api.github.com/users/johnreilly","html_url":"https://github.com/johnreilly","followers_url":"https://api.github.com/users/johnreilly/followers","following_url":"https://api.github.com/users/johnreilly/following{/other_user}","gists_url":"https://api.github.com/users/johnreilly/gists{/gist_id}","starred_url":"https://api.github.com/users/johnreilly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johnreilly/subscriptions","organizations_url":"https://api.github.com/users/johnreilly/orgs","repos_url":"https://api.github.com/users/johnreilly/repos","events_url":"https://api.github.com/users/johnreilly/events{/privacy}","received_events_url":"https://api.github.com/users/johnreilly/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2012-06-13T20:48:09Z","updated_at":"2013-01-08T04:13:05Z","closed_at":"2013-01-08T04:13:05Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Hello,\n\nI've got a couple workers that may take a fair amount of time to complete, and as such, might get killed off before the job completes. I'm absolutely loving the requeueing behavior introduced by #110. It's working great for me.\n\nI'm wondering if it's possible for the workers to be somehow informed of when this is about to happen, so they can attempt to do any last minute cleanup before being killed off. \n\nHere's my context: One of my workers is in charge of moving large files around, and it's just one part of a job in a larger workflow. So I have a job object with a little state machine to track its progress, and the worker updates the state along the way. Sorta like this:\n\n``` ruby\nclass FetchWorker\n  include Sidekiq::Worker\n\n  def perform(job_id)\n    @job = MyJob.find(job_id) #@job.state => 'pending'\n    @job.begin!               #@job.state => 'fetching'\n\n    # this part takes a while...\n    fetch_large_file(@job.file_url)  \n\n    @job.complete!            #@job.state => 'completed'\n  rescue => error\n    @job.fail!                #@job.state => 'failed'\n    raise error\n  end\n\nend\n```\n\nThanks to #110, if this worker gets killed while it is fetching a file, it is automatically requeued, which is awesome. The issue I'm having is that the job's state will likely still be 'fetching' when the job is retried. \n\n(Let's say the only valid transitions into 'fetching' are from 'pending' and 'failed.' Attempting to enter 'fetching' from 'fetching' is not valid.)\n\nWhat I'd like is to set the job's state to 'failed' when the worker is about to be killed off so I can deal with it later. Something like:\n\n``` ruby\n  def before_forced_shutdown\n    @job.fail! if @job.fetching?\n  end\n```\n\nIs anything like that possible? Or is this the wrong way to go about things? I wouldn't be too surprised if I'm being dense about this. :)\n\nThanks for any advice!\n\n-John\n","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/243/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/243/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":408159377,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDQwODE1OTM3Nw==","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/408159377","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"0f7ba94fe1d846bd39637ea4b6c0b16c031e3d42","commit_url":"https://api.github.com/repos/mperham/inspeqtor-pro/commits/0f7ba94fe1d846bd39637ea4b6c0b16c031e3d42","created_at":"2015-09-13T21:50:14Z","performed_via_github_app":null},{"actor":{"login":"smidwap","id":794163,"node_id":"MDQ6VXNlcjc5NDE2Mw==","avatar_url":"https://avatars.githubusercontent.com/u/794163?v=4","gravatar_id":"","url":"https://api.github.com/users/smidwap","html_url":"https://github.com/smidwap","followers_url":"https://api.github.com/users/smidwap/followers","following_url":"https://api.github.com/users/smidwap/following{/other_user}","gists_url":"https://api.github.com/users/smidwap/gists{/gist_id}","starred_url":"https://api.github.com/users/smidwap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smidwap/subscriptions","organizations_url":"https://api.github.com/users/smidwap/orgs","repos_url":"https://api.github.com/users/smidwap/repos","events_url":"https://api.github.com/users/smidwap/events{/privacy}","received_events_url":"https://api.github.com/users/smidwap/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-10-06T16:38:36Z","updated_at":"2015-10-06T16:38:36Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2591","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2591/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2591/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2591/events","html_url":"https://github.com/sidekiq/sidekiq/issues/2591","id":110049824,"node_id":"MDU6SXNzdWUxMTAwNDk4MjQ=","number":2591,"title":"Sidekiq::Manager doesn't reliably terminate on shutdown (Heroku)","user":{"login":"smidwap","id":794163,"node_id":"MDQ6VXNlcjc5NDE2Mw==","avatar_url":"https://avatars.githubusercontent.com/u/794163?v=4","gravatar_id":"","url":"https://api.github.com/users/smidwap","html_url":"https://github.com/smidwap","followers_url":"https://api.github.com/users/smidwap/followers","following_url":"https://api.github.com/users/smidwap/following{/other_user}","gists_url":"https://api.github.com/users/smidwap/gists{/gist_id}","starred_url":"https://api.github.com/users/smidwap/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/smidwap/subscriptions","organizations_url":"https://api.github.com/users/smidwap/orgs","repos_url":"https://api.github.com/users/smidwap/repos","events_url":"https://api.github.com/users/smidwap/events{/privacy}","received_events_url":"https://api.github.com/users/smidwap/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2015-10-06T16:38:36Z","updated_at":"2017-04-06T04:41:46Z","closed_at":"2015-11-07T17:07:06Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"When Heroku asks Sidekiq to shutdown via SIGTERM, Sidekiq gives running workers 8 seconds to finish before placing the unfinished jobs back in the queue. I believe this behavior was added as a result of https://github.com/mperham/sidekiq/issues/110.\n\nRecently, I had an instance where this expected behavior didn't occur. Heroku killed the Sidekiq process via SIGKILL before Sidekiq had a chance to place the jobs back in the queue.\n\nFrom my logs, here's the series of events:\n\n```\n15:16:22 - Heroku cycles all dynos\n15:16:25 - Heroku sends SIGTERM to Sidekiq\n15:16:26 - Sidekiq says it's shutting down\n15:16:27 - Sidekiq says it'll pause up to 8 seconds to allow processes to finish\n15:16:35 - Heroku kills Sidekiq, saying Sidekiq failed to exit within 10 seconds of SIGTERM\n15:16:37 - Sidekiq process exists with status 137 (failed to exit within 10 seconds)\n```\n\nThe result was an unfinished job got lost in cyberspace and, well, bad things happened :)\n\nIt looks like there's a delay between when Heroku sends the SIGTERM and when Sidekiq starts to shutdown. And looks like that delay is variable, and if it's too long, Sidekiq may not shutdown before Heroku sends SIGKILL.\n\nI ran tests on this behavior on a Heroku app using this test job:\n\n``` ruby\nclass TestJob < ApplicationJob\n  def perform\n    sleep\n  end\nend\n```\n\nI wasn't able to reproduce Heroku killing Sidekiq before Sidekiq pushed its unfinished jobs back in the queue, but I did get a few close calls. For example, in one test case, Heroku sent SIGKILL _before_ Sidekiq shutdown, but Sidekiq somehow still managed to wrap up its work and push the unfinished job back in the queue. Here's the order of log messages:\n\n```\n12:00:32 heroku/sidekiq.1:  Error R12 (Exit timeout) -> At least one process failed to exit within 10 seconds of SIGTERM \n12:00:32 heroku/sidekiq.1:  Stopping remaining processes with SIGKILL \n12:00:32 app/sidekiq.1:  WARN: Terminating 1 busy worker threads \n12:00:32 app/sidekiq.1:  WARN: Work still in progress [#<struct Sidekiq::BasicFetch::UnitOfWork queue=\"queue:default\", message=\"{\\\"retry\\\":true,\\\"queue\\\":\\\"default\\\",\\\"class\\\":\\\"ActiveJob::QueueAdapters::SidekiqAdapter::JobWrapper\\\",\\\"wrapped\\\":\\\"TestJob\\\",\\\"args\\\":[{\\\"job_class\\\":\\\"TestJob\\\",\\\"job_id\\\":\\\"4d4560e0-8aac-4e35-91b5-7aaee312bde2\\\",\\\"queue_name\\\":\\\"default\\\",\\\"arguments\\\":[]}],\\\"jid\\\":\\\"2099a16a97f5430eec1bf566\\\",\\\"enqueued_at\\\":1444146380.568534}\">] \n12:00:32 app/sidekiq.1:  INFO: Pushed 1 messages back to Redis \n\n```\n\nI'm not yet familiar with the Sidekiq internals, but the root problem could be that there's a delay between when Heroku sends SIGTERM and Sidekiq acting on it.\n\nOne solution might be for me to set the timeout to 7 seconds, or maybe even less. Would it make sense to make 7 seconds the default?\n","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2591/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2591/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"onetwopunch","id":1054518,"node_id":"MDQ6VXNlcjEwNTQ1MTg=","avatar_url":"https://avatars.githubusercontent.com/u/1054518?v=4","gravatar_id":"","url":"https://api.github.com/users/onetwopunch","html_url":"https://github.com/onetwopunch","followers_url":"https://api.github.com/users/onetwopunch/followers","following_url":"https://api.github.com/users/onetwopunch/following{/other_user}","gists_url":"https://api.github.com/users/onetwopunch/gists{/gist_id}","starred_url":"https://api.github.com/users/onetwopunch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/onetwopunch/subscriptions","organizations_url":"https://api.github.com/users/onetwopunch/orgs","repos_url":"https://api.github.com/users/onetwopunch/repos","events_url":"https://api.github.com/users/onetwopunch/events{/privacy}","received_events_url":"https://api.github.com/users/onetwopunch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-11-10T20:33:48Z","updated_at":"2015-11-10T20:33:48Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2653","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2653/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2653/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2653/events","html_url":"https://github.com/sidekiq/sidekiq/issues/2653","id":116195759,"node_id":"MDU6SXNzdWUxMTYxOTU3NTk=","number":2653,"title":"Sidekiq not putting Job back into queue after SIGTERM","user":{"login":"onetwopunch","id":1054518,"node_id":"MDQ6VXNlcjEwNTQ1MTg=","avatar_url":"https://avatars.githubusercontent.com/u/1054518?v=4","gravatar_id":"","url":"https://api.github.com/users/onetwopunch","html_url":"https://github.com/onetwopunch","followers_url":"https://api.github.com/users/onetwopunch/followers","following_url":"https://api.github.com/users/onetwopunch/following{/other_user}","gists_url":"https://api.github.com/users/onetwopunch/gists{/gist_id}","starred_url":"https://api.github.com/users/onetwopunch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/onetwopunch/subscriptions","organizations_url":"https://api.github.com/users/onetwopunch/orgs","repos_url":"https://api.github.com/users/onetwopunch/repos","events_url":"https://api.github.com/users/onetwopunch/events{/privacy}","received_events_url":"https://api.github.com/users/onetwopunch/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2015-11-10T20:33:48Z","updated_at":"2015-11-12T00:52:24Z","closed_at":"2015-11-12T00:52:24Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"I have several workers that use `Open3` to run `ffmpeg` and other long running commands and save progress to a database. The problem is that when a deploy or log roll happens (every morning), unicorn restarts and the jobs get lost. I would like to see these jobs get re-enqueued and restarted after sidekiq restarts but they don't. \n\nI'm assuming this has to do with this issue https://github.com/mperham/sidekiq/issues/110 but I've tried many things to try to get it to work and it doesn't seem to. I currently have the following signal handler code run before the `Open3.popen3` call:\n\n```\n#Signal handler for when Sidekiq restarts\nsig = \"TERM\"\nSignal.trap(sig) do\n  if pid\n    Logplexer.info( \"Caught SIGTERM from unicorn. Killing child process #{pid}\")\n    Process.kill(sig, pid)\n  end\n  #Forward TERM signal back to self\n  Process.kill(sig, 0)\nend\n```\n\nThen `@pid` is set inside the popen3 block. When I run this, it's successfully sending SIGTERM to the child process as well as the parent, but the job never gets re-enqueued. \n\nAccording to this wiki https://github.com/mperham/sidekiq/wiki/Signals#term, it should re-enqueue before exiting, but it never does.\n\nAny help is appreciated.\n\nBTW we are using Pro. Would [reliable_fetch](https://github.com/mperham/sidekiq/wiki/Reliability) help out here?\n","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2653/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2653/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"}]