{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4531","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4531/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4531/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4531/events","html_url":"https://github.com/sidekiq/sidekiq/issues/4531","id":602218861,"node_id":"MDU6SXNzdWU2MDIyMTg4NjE=","number":4531,"title":"Possible regression in Sidekiq 6.0.7 with Redis and SSL certs","user":{"login":"geoffharcourt","id":319471,"node_id":"MDQ6VXNlcjMxOTQ3MQ==","avatar_url":"https://avatars.githubusercontent.com/u/319471?v=4","gravatar_id":"","url":"https://api.github.com/users/geoffharcourt","html_url":"https://github.com/geoffharcourt","followers_url":"https://api.github.com/users/geoffharcourt/followers","following_url":"https://api.github.com/users/geoffharcourt/following{/other_user}","gists_url":"https://api.github.com/users/geoffharcourt/gists{/gist_id}","starred_url":"https://api.github.com/users/geoffharcourt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/geoffharcourt/subscriptions","organizations_url":"https://api.github.com/users/geoffharcourt/orgs","repos_url":"https://api.github.com/users/geoffharcourt/repos","events_url":"https://api.github.com/users/geoffharcourt/events{/privacy}","received_events_url":"https://api.github.com/users/geoffharcourt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2020-04-17T20:35:11Z","updated_at":"2020-04-18T20:09:49Z","closed_at":"2020-04-18T20:00:29Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Ruby version:\r\nSidekiq 6.0.7 / Pro 5.0.1 / Enterprise 2.0.1\r\n\r\nWe tested this with OSS Sidekiq as well and got the same result.\r\n\r\nPlease include your initializer and any error message with the full backtrace.\r\n```\r\nssl_params = {}\r\nshared_redis_config = {\r\n  url: ENV[\"REDIS_SSL_URL\"] || ENV[\"REDIS_URL\"],\r\n  ssl_params: ssl_params,\r\n}\r\n\r\nif ENV[\"REDIS_SSL_URL\"]\r\n  shared_redis_config[:password] = ENV[\"REDIS_PASSWORD\"]\r\n\r\n  ssl_params[:cert] = OpenSSL::X509::Certificate.new(ENV[\"REDIS_CERT\"])\r\n  ssl_params[:key] = OpenSSL::PKey::RSA.new(ENV[\"REDIS_KEY\"])\r\n  ssl_params[:cert_store] = OpenSSL::X509::Store.new\r\n  ssl_params[:cert_store].add_cert(\r\n    OpenSSL::X509::Certificate.new(\r\n      File.read(Rails.root.join(\"config\", \"redislabs_ca.pem\")),\r\n    ),\r\n  )\r\nend\r\n\r\nSidekiq.configure_client do |config|\r\n  config.redis = shared_redis_config.merge(size: 1)\r\nend\r\n\r\nSidekiq.configure_server do |config|\r\n  config.redis = shared_redis_config\r\nend\r\n```\r\n\r\nThe crash looks like this and happens on dyno boot:\r\n\r\n```\r\n2020-04-17T20:29:39.633803+00:00 app[worker_ual.1]: no _dump_data is defined for class OpenSSL::X509::Certificate\r\n2020-04-17T20:29:39.633810+00:00 app[worker_ual.1]: /app/vendor/bundle/ruby/2.6.0/gems/sidekiq-6.0.7/lib/sidekiq/redis_connection.rb:100:in `dump'\r\n2020-04-17T20:29:39.633811+00:00 app[worker_ual.1]: /app/vendor/bundle/ruby/2.6.0/gems/sidekiq-6.0.7/lib/sidekiq/redis_connection.rb:100:in `log_info'\r\n2020-04-17T20:29:39.633811+00:00 app[worker_ual.1]: /app/vendor/bundle/ruby/2.6.0/gems/sidekiq-6.0.7/lib/sidekiq/redis_connection.rb:34:in `create'\r\n2020-04-17T20:29:39.633812+00:00 app[worker_ual.1]: /app/vendor/bundle/ruby/2.6.0/gems/sidekiq-6.0.7/lib/sidekiq.rb:135:in `redis='\r\n2020-04-17T20:29:39.633812+00:00 app[worker_ual.1]: /app/config/initializers/sidekiq.rb:25:in `block in <main>'\r\n2020-04-17T20:29:39.633813+00:00 app[worker_ual.1]: /app/vendor/bundle/ruby/2.6.0/gems/sidekiq-6.0.7/lib/sidekiq.rb:75:in `configure_server'\r\n2020-04-17T20:29:39.633821+00:00 app[worker_ual.1]: /app/config/initializers/sidekiq.rb:24:in `<main>'\r\n2020-04-17T20:29:39.633822+00:00 app[worker_ual.1]: /app/vendor/bundle/ruby/2.6.0/gems/bootsnap-1.4.6/lib/bootsnap/load_path_cache/core_ext/kernel_require.rb:55:in `load'\r\n```\r\n\r\nIt looks like the failure is something with our cert (we use Redis over SSL through RedisLabs), but we've never seen this happen before. Any ideas? Line 25 is the interior of the `Sidekiq.configure_server` block.","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4531/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4531/timeline","performed_via_github_app":null,"state_reason":"completed"}