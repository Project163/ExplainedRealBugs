{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1653","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1653/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1653/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1653/events","html_url":"https://github.com/sidekiq/sidekiq/issues/1653","id":31484707,"node_id":"MDU6SXNzdWUzMTQ4NDcwNw==","number":1653,"title":"Sidekiq::Logging.reopen_logs blows up on JRuby with ObjectSpace disabled","user":{"login":"substars","id":81067,"node_id":"MDQ6VXNlcjgxMDY3","avatar_url":"https://avatars.githubusercontent.com/u/81067?v=4","gravatar_id":"","url":"https://api.github.com/users/substars","html_url":"https://github.com/substars","followers_url":"https://api.github.com/users/substars/followers","following_url":"https://api.github.com/users/substars/following{/other_user}","gists_url":"https://api.github.com/users/substars/gists{/gist_id}","starred_url":"https://api.github.com/users/substars/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/substars/subscriptions","organizations_url":"https://api.github.com/users/substars/orgs","repos_url":"https://api.github.com/users/substars/repos","events_url":"https://api.github.com/users/substars/events{/privacy}","received_events_url":"https://api.github.com/users/substars/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2014-04-14T17:52:34Z","updated_at":"2014-04-22T04:26:23Z","closed_at":"2014-04-22T04:26:23Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Not super surprising given how the method is implemented, and doing it without using ObjectSpace sure is trickier, but it'd be nice if it failed gracefully and didn't just stop Sidekiq since a stock JRuby runtime will have ObjectSpace disabled.\n\nUsing 2.17.7 on JRuby 1.7.10:\n\n```\n==> sidekiq.log <==\n2014-04-14T17:26:58Z 18773 TID-2e6 DEBUG: Got USR2 signal\n2014-04-14T17:26:58Z 18773 TID-2e6 INFO: Received USR2, reopening log file\n2014-04-14T17:26:58Z 18773 TID-2ne WARN: Sidekiq died due to the following error, cannot recover, process exiting\n2014-04-14T17:26:58Z 18773 TID-2ne WARN:\n\n==> stdout.log <==\nObjectSpace is disabled; each_object will only work with Class, pass -X+O to enable\norg/jruby/RubyObjectSpace.java:173:in `each_object'\n/opt/blacklist/releases/23/vendor/bundle/jruby/1.9/gems/sidekiq-2.17.7/lib/sidekiq/logging.rb:56:in `reopen_logs'\n/opt/blacklist/releases/23/vendor/bundle/jruby/1.9/gems/sidekiq-2.17.7/lib/sidekiq/cli.rb:115:in `handle_signal'\n/opt/blacklist/releases/23/vendor/bundle/jruby/1.9/gems/sidekiq-2.17.7/lib/sidekiq/cli.rb:79:in `run'\n/opt/blacklist/releases/23/vendor/bundle/jruby/1.9/gems/sidekiq-2.17.7/bin/sidekiq:8:in `(root)'\norg/jruby/RubyKernel.java:1099:in `load'\nclasspath:bin/sidekiq:16:in `(root)'\n```\n","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1653/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1653/timeline","performed_via_github_app":null,"state_reason":"completed"}