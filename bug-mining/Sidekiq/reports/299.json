{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5702","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5702/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5702/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5702/events","html_url":"https://github.com/sidekiq/sidekiq/issues/5702","id":1506154516,"node_id":"I_kwDOADDA9M5ZxhgU","number":5702,"title":"Client hitting ConnectionPool::TimeoutError in Sidekiq 7","user":{"login":"andreccosta","id":1365853,"node_id":"MDQ6VXNlcjEzNjU4NTM=","avatar_url":"https://avatars.githubusercontent.com/u/1365853?v=4","gravatar_id":"","url":"https://api.github.com/users/andreccosta","html_url":"https://github.com/andreccosta","followers_url":"https://api.github.com/users/andreccosta/followers","following_url":"https://api.github.com/users/andreccosta/following{/other_user}","gists_url":"https://api.github.com/users/andreccosta/gists{/gist_id}","starred_url":"https://api.github.com/users/andreccosta/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andreccosta/subscriptions","organizations_url":"https://api.github.com/users/andreccosta/orgs","repos_url":"https://api.github.com/users/andreccosta/repos","events_url":"https://api.github.com/users/andreccosta/events{/privacy}","received_events_url":"https://api.github.com/users/andreccosta/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2022-12-21T11:29:01Z","updated_at":"2022-12-21T22:45:53Z","closed_at":"2022-12-21T22:45:53Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Ruby version: 3.1.3\r\nRails version: 7.0.4\r\nSidekiq / Pro / Enterprise version(s): Sidekiq 7.0.2 / Pro 7.0.5\r\n\r\nWe are seeing very sporadic `ConnectionPool:TimeoutError` happening in our client web/puma process.\r\nSince the default concurrency changed from 10 to 5 in Sidekiq 7 (and we didn't face this issue before the upgrade) our first instinct was to up the size of the client connection pool to 10.\r\n\r\nRelevant parts of our initializer:\r\n\r\n```ruby\r\nSidekiq.configure_client do |config|\r\n  config.redis = {\r\n    host: ENV.fetch(\"REDIS_HOST\"),\r\n    password: ENV.fetch(\"REDIS_PASSWORD\"),\r\n    size: 10\r\n  }\r\nend\r\n```\r\n\r\nHowever adding `size: 10` in the initializer had no effect. From what I can gather the client is using the \"internal\" connection pool which seems to be hard-coded to always have the size of 5 regardless of configuration. And since in Sidekiq 7 these pools are managed internally creating a different connection pool is not an option.\r\n\r\nI should add that we are very far from hitting either CPU or connections limit in our Redis instance.\r\n\r\nIs the client connection pool size not meant to be configurable in this way?","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5702/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5702/timeline","performed_via_github_app":null,"state_reason":"completed"}