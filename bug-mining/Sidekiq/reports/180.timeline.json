[{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/270008310","html_url":"https://github.com/sidekiq/sidekiq/issues/3303#issuecomment-270008310","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3303","id":270008310,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDAwODMxMA==","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-01-02T18:55:38Z","updated_at":"2017-01-02T18:55:38Z","body":"This is some great detective work, thanks for investigating.  What you write makes perfect sense.  It's quite possible this is a cause of some of the mysterious problems that other people have seen throughout the years.\r\n\r\nMy takeaway is that I should have investigated each option provided by Redis-rb.  The default values are not necessarily appropriate for Sidekiq; I had assumed that network issues would bubble up immediately.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/270008310/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/270009452","html_url":"https://github.com/sidekiq/sidekiq/issues/3303#issuecomment-270009452","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3303","id":270009452,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MDAwOTQ1Mg==","user":{"login":"krallin","id":1737686,"node_id":"MDQ6VXNlcjE3Mzc2ODY=","avatar_url":"https://avatars.githubusercontent.com/u/1737686?v=4","gravatar_id":"","url":"https://api.github.com/users/krallin","html_url":"https://github.com/krallin","followers_url":"https://api.github.com/users/krallin/followers","following_url":"https://api.github.com/users/krallin/following{/other_user}","gists_url":"https://api.github.com/users/krallin/gists{/gist_id}","starred_url":"https://api.github.com/users/krallin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krallin/subscriptions","organizations_url":"https://api.github.com/users/krallin/orgs","repos_url":"https://api.github.com/users/krallin/repos","events_url":"https://api.github.com/users/krallin/events{/privacy}","received_events_url":"https://api.github.com/users/krallin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-01-02T19:07:22Z","updated_at":"2017-01-02T19:07:22Z","body":"Thanks for the quick response @mperham!\r\n\r\nWe've rolled out the workaround I mentioned earlier today — I'll monitor and report here whether we see this problem again (we were seeing this quite infrequently, so it might take a little while before I can confirm whether the issue is indeed resolved).","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/270009452/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"krallin","id":1737686,"node_id":"MDQ6VXNlcjE3Mzc2ODY=","avatar_url":"https://avatars.githubusercontent.com/u/1737686?v=4","gravatar_id":"","url":"https://api.github.com/users/krallin","html_url":"https://github.com/krallin","followers_url":"https://api.github.com/users/krallin/followers","following_url":"https://api.github.com/users/krallin/following{/other_user}","gists_url":"https://api.github.com/users/krallin/gists{/gist_id}","starred_url":"https://api.github.com/users/krallin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krallin/subscriptions","organizations_url":"https://api.github.com/users/krallin/orgs","repos_url":"https://api.github.com/users/krallin/repos","events_url":"https://api.github.com/users/krallin/events{/privacy}","received_events_url":"https://api.github.com/users/krallin/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":909204619,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50OTA5MjA0NjE5","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/909204619","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-01-02T19:07:22Z","performed_via_github_app":null},{"id":909204620,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDkwOTIwNDYyMA==","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/909204620","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-01-02T19:07:22Z","performed_via_github_app":null},{"actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-01-03T23:26:21Z","updated_at":"2017-01-03T23:26:21Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3298","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3298/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3298/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3298/events","html_url":"https://github.com/sidekiq/sidekiq/issues/3298","id":198105053,"node_id":"MDU6SXNzdWUxOTgxMDUwNTM=","number":3298,"title":"super_fetch is not discarding some jobs after successful processing","user":{"login":"YesThatAllen","id":2879972,"node_id":"MDQ6VXNlcjI4Nzk5NzI=","avatar_url":"https://avatars.githubusercontent.com/u/2879972?v=4","gravatar_id":"","url":"https://api.github.com/users/YesThatAllen","html_url":"https://github.com/YesThatAllen","followers_url":"https://api.github.com/users/YesThatAllen/followers","following_url":"https://api.github.com/users/YesThatAllen/following{/other_user}","gists_url":"https://api.github.com/users/YesThatAllen/gists{/gist_id}","starred_url":"https://api.github.com/users/YesThatAllen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/YesThatAllen/subscriptions","organizations_url":"https://api.github.com/users/YesThatAllen/orgs","repos_url":"https://api.github.com/users/YesThatAllen/repos","events_url":"https://api.github.com/users/YesThatAllen/events{/privacy}","received_events_url":"https://api.github.com/users/YesThatAllen/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2016-12-30T05:04:43Z","updated_at":"2017-02-07T18:18:42Z","closed_at":"2017-02-07T18:18:42Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Ruby version: 2.3.1  / (rails 4.2.7.1 ) \r\nSidekiq / Pro / Enterprise version(s):\r\n( Sidekiq v4.2.7 / Sidekiq Pro v3.4.1 )\r\n\r\n[our initializer ](https://gist.github.com/YesThatAllen/b5f81dfe7a32e21c255a2f1416958f27)\r\n\r\nRelevant gems in use:\r\n\r\n```\r\n# From Gemfile.lock\r\n\r\n    # redis (3.3.2)\r\n    # sidekiq (4.2.7)\r\n    #   concurrent-ruby (~> 1.0)\r\n    #   connection_pool (~> 2.2, >= 2.2.0)\r\n    #   rack-protection (>= 1.5.0)\r\n    #   redis (~> 3.2, >= 3.2.1)\r\n    # sidekiq-datadog (0.3.4)\r\n    #   dogstatsd-ruby (~> 2.0.0)\r\n    #   sidekiq\r\n    # sidekiq-pro (3.4.1)\r\n    #   sidekiq (>= 4.1.5)\r\n    # sidekiq-status (0.6.0)\r\n    #   sidekiq (>= 2.7)\r\n    # sidekiq-unique-jobs (4.0.18)\r\n    #   sidekiq (>= 2.6)\r\n    #   thor\r\n```\r\n\r\nThe redis instance we are using is Elasticache in the same region (US-West) as the EC2 instances which are running our app. I can reproduce the issue locally on my Mac running its local `redis-server`.\r\n\r\nWe use `whenever` to generate emails which are sent to sidekiq for processing. The jobs are passed to postmarkapp for delivery. When the same emails are triggered manually, they have the same issue I'm about to describe.\r\n\r\nOnce we implemented Sidekiq pro, we saw a drastic improvement in our jobs performing small transactions to services like Zendesk/RepairShopr/Autotask/ConnectWise. However, larger jobs which are sent to Postmark are completed (an email is successfully sent) but end up getting re-run after the worker is terminated.\r\n\r\nThe jobs in question range from 350k to 4.7mb (maybe more?). Disabling super_fetch results in worse performance in our integrations, but jobs are no longer re-attempted.\r\n\r\nBecause the job is \"hidden\" in the web UI, only to return later, I wondered if it was related to #3294. The jobs aren't malformed or corruption in any way we can see, so this may be new.\r\n\r\nWe can't see the job in the queue until we stop the worker which picked it up for processing, but we can see that the job is placed back in the queue.\r\n\r\n```\r\nDec 27 09:46:27 sidekiq.log:  2016-12-27T15:46:27.809Z 8734 TID-ou1wd3sp4 INFO: Shutting down\r\nDec 27 09:46:27 sidekiq.log:  2016-12-27T15:46:27.809Z 8734 TID-ou1wd3sp4 INFO: Terminating quiet workers\r\nDec 27 09:46:27 sidekiq.log:  2016-12-27T15:46:27.809Z 8734 TID-ou1x2qbsk INFO: Scheduler exiting...\r\nDec 27 09:46:27 sidekiq.log:  2016-12-27T15:46:27.910Z 8734 TID-ou1wd3sp4 INFO: Pausing to allow workers to finish...\r\nDec 27 09:46:29 sidekiq.log:  2016-12-27T15:46:29.712Z 8734 TID-ou1wd3sp4 INFO: Moving job from queue:sq_ip-10-92-5-144:8734:4f110c8ea59c_default back to queue:default\r\nDec 27 09:46:29 sidekiq.log:  2016-12-27T15:46:29.716Z 8734 TID-ou1wd3sp4 INFO: Moving job from queue:sq_ip-10-92-5-144:8734:4f110c8ea59c_mailers back to queue:mailers\r\nDec 27 09:46:29 sidekiq.log:  2016-12-27T15:46:29.722Z 8734 TID-ou1wd3sp4 INFO: Moving job from queue:sq_ip-10-92-5-144:8734:4f110c8ea59c_mailers back to queue:mailers\r\nDec 27 09:46:29 sidekiq.log:  2016-12-27T15:46:29.725Z 8734 TID-ou1wd3sp4 INFO: Moving job from queue:sq_ip-10-92-5-144:8734:4f110c8ea59c_mailers back to queue:mailers\r\nDec 27 09:46:29 sidekiq.log:  2016-12-27T15:46:29.727Z 8734 TID-ou1wd3sp4 INFO: Bye!\r\n```\r\n\r\nThere is no error logged during the processing of the job. We aren't hearing reports of duplicates for other emails we send, it's just these larger summary emails.\r\n\r\nAttempting to delete these jobs via the web-ui often results in a redis timeout error. In a test, I was able to delete 2171 smaller jobs in single request with no timeout. \r\n\r\nNo timeout errors are logged (that I can see) when `super_fetch` is trying to run the job, and we don't have duplicate job issues with `super_fetch` disabled.\r\n\r\n\r\nWe're looking to see how else to troubleshoot the reason super_fetch isn't discarding the job at the end of its run.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3298/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3298/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/271232074","html_url":"https://github.com/sidekiq/sidekiq/issues/3303#issuecomment-271232074","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3303","id":271232074,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTIzMjA3NA==","user":{"login":"krallin","id":1737686,"node_id":"MDQ6VXNlcjE3Mzc2ODY=","avatar_url":"https://avatars.githubusercontent.com/u/1737686?v=4","gravatar_id":"","url":"https://api.github.com/users/krallin","html_url":"https://github.com/krallin","followers_url":"https://api.github.com/users/krallin/followers","following_url":"https://api.github.com/users/krallin/following{/other_user}","gists_url":"https://api.github.com/users/krallin/gists{/gist_id}","starred_url":"https://api.github.com/users/krallin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krallin/subscriptions","organizations_url":"https://api.github.com/users/krallin/orgs","repos_url":"https://api.github.com/users/krallin/repos","events_url":"https://api.github.com/users/krallin/events{/privacy}","received_events_url":"https://api.github.com/users/krallin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-01-09T08:37:14Z","updated_at":"2017-01-09T08:37:14Z","body":"Just a quick heads up that we've confirmed that setting `reconnect_attempts: 0` ensures jobs aren't run multiple times (we get an exception on the client-side, and the job executes — but only once — on the server-side, which is what we expected).","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/271232074/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"krallin","id":1737686,"node_id":"MDQ6VXNlcjE3Mzc2ODY=","avatar_url":"https://avatars.githubusercontent.com/u/1737686?v=4","gravatar_id":"","url":"https://api.github.com/users/krallin","html_url":"https://github.com/krallin","followers_url":"https://api.github.com/users/krallin/followers","following_url":"https://api.github.com/users/krallin/following{/other_user}","gists_url":"https://api.github.com/users/krallin/gists{/gist_id}","starred_url":"https://api.github.com/users/krallin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krallin/subscriptions","organizations_url":"https://api.github.com/users/krallin/orgs","repos_url":"https://api.github.com/users/krallin/repos","events_url":"https://api.github.com/users/krallin/events{/privacy}","received_events_url":"https://api.github.com/users/krallin/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"badboy","id":2129,"node_id":"MDQ6VXNlcjIxMjk=","avatar_url":"https://avatars.githubusercontent.com/u/2129?v=4","gravatar_id":"","url":"https://api.github.com/users/badboy","html_url":"https://github.com/badboy","followers_url":"https://api.github.com/users/badboy/followers","following_url":"https://api.github.com/users/badboy/following{/other_user}","gists_url":"https://api.github.com/users/badboy/gists{/gist_id}","starred_url":"https://api.github.com/users/badboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/badboy/subscriptions","organizations_url":"https://api.github.com/users/badboy/orgs","repos_url":"https://api.github.com/users/badboy/repos","events_url":"https://api.github.com/users/badboy/events{/privacy}","received_events_url":"https://api.github.com/users/badboy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-01-09T17:26:29Z","updated_at":"2017-01-09T17:26:29Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/redis/redis-rb/issues/668","repository_url":"https://api.github.com/repos/redis/redis-rb","labels_url":"https://api.github.com/repos/redis/redis-rb/issues/668/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis-rb/issues/668/comments","events_url":"https://api.github.com/repos/redis/redis-rb/issues/668/events","html_url":"https://github.com/redis/redis-rb/issues/668","id":199598081,"node_id":"MDU6SXNzdWUxOTk1OTgwODE=","number":668,"title":"Issue in redis timeout, commands get executed twice.","user":{"login":"alexnavis","id":362998,"node_id":"MDQ6VXNlcjM2Mjk5OA==","avatar_url":"https://avatars.githubusercontent.com/u/362998?v=4","gravatar_id":"","url":"https://api.github.com/users/alexnavis","html_url":"https://github.com/alexnavis","followers_url":"https://api.github.com/users/alexnavis/followers","following_url":"https://api.github.com/users/alexnavis/following{/other_user}","gists_url":"https://api.github.com/users/alexnavis/gists{/gist_id}","starred_url":"https://api.github.com/users/alexnavis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexnavis/subscriptions","organizations_url":"https://api.github.com/users/alexnavis/orgs","repos_url":"https://api.github.com/users/alexnavis/repos","events_url":"https://api.github.com/users/alexnavis/events{/privacy}","received_events_url":"https://api.github.com/users/alexnavis/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2017-01-09T16:32:31Z","updated_at":"2022-08-17T19:28:29Z","closed_at":"2022-08-17T19:28:29Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":137805,"node_id":"MDEwOlJlcG9zaXRvcnkxMzc4MDU=","name":"redis-rb","full_name":"redis/redis-rb","private":false,"owner":{"login":"redis","id":1529926,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1Mjk5MjY=","avatar_url":"https://avatars.githubusercontent.com/u/1529926?v=4","gravatar_id":"","url":"https://api.github.com/users/redis","html_url":"https://github.com/redis","followers_url":"https://api.github.com/users/redis/followers","following_url":"https://api.github.com/users/redis/following{/other_user}","gists_url":"https://api.github.com/users/redis/gists{/gist_id}","starred_url":"https://api.github.com/users/redis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redis/subscriptions","organizations_url":"https://api.github.com/users/redis/orgs","repos_url":"https://api.github.com/users/redis/repos","events_url":"https://api.github.com/users/redis/events{/privacy}","received_events_url":"https://api.github.com/users/redis/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/redis/redis-rb","description":"A Ruby client library for Redis","fork":false,"url":"https://api.github.com/repos/redis/redis-rb","forks_url":"https://api.github.com/repos/redis/redis-rb/forks","keys_url":"https://api.github.com/repos/redis/redis-rb/keys{/key_id}","collaborators_url":"https://api.github.com/repos/redis/redis-rb/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/redis/redis-rb/teams","hooks_url":"https://api.github.com/repos/redis/redis-rb/hooks","issue_events_url":"https://api.github.com/repos/redis/redis-rb/issues/events{/number}","events_url":"https://api.github.com/repos/redis/redis-rb/events","assignees_url":"https://api.github.com/repos/redis/redis-rb/assignees{/user}","branches_url":"https://api.github.com/repos/redis/redis-rb/branches{/branch}","tags_url":"https://api.github.com/repos/redis/redis-rb/tags","blobs_url":"https://api.github.com/repos/redis/redis-rb/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/redis/redis-rb/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/redis/redis-rb/git/refs{/sha}","trees_url":"https://api.github.com/repos/redis/redis-rb/git/trees{/sha}","statuses_url":"https://api.github.com/repos/redis/redis-rb/statuses/{sha}","languages_url":"https://api.github.com/repos/redis/redis-rb/languages","stargazers_url":"https://api.github.com/repos/redis/redis-rb/stargazers","contributors_url":"https://api.github.com/repos/redis/redis-rb/contributors","subscribers_url":"https://api.github.com/repos/redis/redis-rb/subscribers","subscription_url":"https://api.github.com/repos/redis/redis-rb/subscription","commits_url":"https://api.github.com/repos/redis/redis-rb/commits{/sha}","git_commits_url":"https://api.github.com/repos/redis/redis-rb/git/commits{/sha}","comments_url":"https://api.github.com/repos/redis/redis-rb/comments{/number}","issue_comment_url":"https://api.github.com/repos/redis/redis-rb/issues/comments{/number}","contents_url":"https://api.github.com/repos/redis/redis-rb/contents/{+path}","compare_url":"https://api.github.com/repos/redis/redis-rb/compare/{base}...{head}","merges_url":"https://api.github.com/repos/redis/redis-rb/merges","archive_url":"https://api.github.com/repos/redis/redis-rb/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/redis/redis-rb/downloads","issues_url":"https://api.github.com/repos/redis/redis-rb/issues{/number}","pulls_url":"https://api.github.com/repos/redis/redis-rb/pulls{/number}","milestones_url":"https://api.github.com/repos/redis/redis-rb/milestones{/number}","notifications_url":"https://api.github.com/repos/redis/redis-rb/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/redis/redis-rb/labels{/name}","releases_url":"https://api.github.com/repos/redis/redis-rb/releases{/id}","deployments_url":"https://api.github.com/repos/redis/redis-rb/deployments","created_at":"2009-02-26T00:53:51Z","updated_at":"2025-11-08T15:03:01Z","pushed_at":"2025-10-30T09:09:30Z","git_url":"git://github.com/redis/redis-rb.git","ssh_url":"git@github.com:redis/redis-rb.git","clone_url":"https://github.com/redis/redis-rb.git","svn_url":"https://github.com/redis/redis-rb","homepage":"","size":2654,"stargazers_count":3992,"watchers_count":3992,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":1036,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":22,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":1036,"open_issues":22,"watchers":3992,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"- Reproducible with redis (3.3.1), on Centos 6/7.\r\n- TCP connection.\r\n\r\n**Issue overview**\r\nI found a redis command 'zremrangebyscore' return a wrong count (0) of removed items even thought it had purged items. The deleted zset is of huge range which tooks more than the default timeout (5sec). Slow query log pointed out as around 9sec. Redis client didn't give a TimeOut error, but rather it gave a wrong count as '0' because there is a execution of another duplicate query. \r\n\r\nI can understand there might be a boundary line on identifying if it has timed-out or not. Would be helpful to understand this more on this.\r\n\r\n**Observations**\r\n1) Please find the script [gist](https://gist.github.com/alexnavis/045e5020e750f18f7f87d6e8499406da), to reproduce the issue. This will show the duplicate queries in the monitored commands. Might have to adjust the timeout based on the machine it is run.\r\n     - Run 'ruby redis_pump.rb pump' to create dataset\r\n     - Run 'ruby redis_pump.rb test' to simulate the issue.\r\n\r\n2) TimeOut errors - Could see the duplicate query even when timeout errors happens. Could pass the 'TEST_TIMEOUT=' to a lower value for the above script to see the behaviour.\r\n\r\n3) I spend some time to understand on what is causing the issue from the code. I couldn't simulate the issue with the tcp write_non_block. Is the duplicate query caused by the timeout from the read on IO.select ?.  Any details would be helpful.","reactions":{"url":"https://api.github.com/repos/redis/redis-rb/issues/668/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis-rb/issues/668/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":916298880,"node_id":"MDExOkNsb3NlZEV2ZW50OTE2Mjk4ODgw","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/916298880","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"2749c12b887815800b0a5c93bcf077c3dcd2796d","commit_url":"https://api.github.com/repos/sidekiq/sidekiq/commits/2749c12b887815800b0a5c93bcf077c3dcd2796d","created_at":"2017-01-09T17:46:46Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"trautwein","id":6479522,"node_id":"MDQ6VXNlcjY0Nzk1MjI=","avatar_url":"https://avatars.githubusercontent.com/u/6479522?v=4","gravatar_id":"","url":"https://api.github.com/users/trautwein","html_url":"https://github.com/trautwein","followers_url":"https://api.github.com/users/trautwein/followers","following_url":"https://api.github.com/users/trautwein/following{/other_user}","gists_url":"https://api.github.com/users/trautwein/gists{/gist_id}","starred_url":"https://api.github.com/users/trautwein/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trautwein/subscriptions","organizations_url":"https://api.github.com/users/trautwein/orgs","repos_url":"https://api.github.com/users/trautwein/repos","events_url":"https://api.github.com/users/trautwein/events{/privacy}","received_events_url":"https://api.github.com/users/trautwein/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-01-10T11:03:19Z","updated_at":"2017-01-10T11:03:19Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3311","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3311/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3311/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3311/events","html_url":"https://github.com/sidekiq/sidekiq/issues/3311","id":199791928,"node_id":"MDU6SXNzdWUxOTk3OTE5Mjg=","number":3311,"title":"Connection problems with v4.2.8","user":{"login":"trautwein","id":6479522,"node_id":"MDQ6VXNlcjY0Nzk1MjI=","avatar_url":"https://avatars.githubusercontent.com/u/6479522?v=4","gravatar_id":"","url":"https://api.github.com/users/trautwein","html_url":"https://github.com/trautwein","followers_url":"https://api.github.com/users/trautwein/followers","following_url":"https://api.github.com/users/trautwein/following{/other_user}","gists_url":"https://api.github.com/users/trautwein/gists{/gist_id}","starred_url":"https://api.github.com/users/trautwein/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trautwein/subscriptions","organizations_url":"https://api.github.com/users/trautwein/orgs","repos_url":"https://api.github.com/users/trautwein/repos","events_url":"https://api.github.com/users/trautwein/events{/privacy}","received_events_url":"https://api.github.com/users/trautwein/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2017-01-10T11:03:19Z","updated_at":"2017-01-20T17:57:19Z","closed_at":"2017-01-13T16:40:45Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Ruby version: 2.4.0\r\nSidekiq / Pro / Enterprise version(s): v4.2.8\r\n\r\nWe experience seemlingly random `Redis::ConnectionError: Connection lost (ECONNRESET)` problems since upgrading Sidekiq from `4.2.7` to `4.2.8`.\r\n\r\nWe're hosted on heroku using heroku-redis. Apart from Sidekiq, we don't haven't had any connection problems. I suspect it could have something to do with commit https://github.com/mperham/sidekiq/commit/2749c12b887815800b0a5c93bcf077c3dcd2796d which fixed https://github.com/mperham/sidekiq/issues/3303.\r\n\r\nBacktrace: https://gist.github.com/trautwein/a390e1b4f7bff7d979bccad408fb3aca\r\n\r\nSince downgrading Sidekiq to `4.2.7` the problem didn't occur, anymore.\r\n\r\nWould be great to know if anyone else has the same issue.","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3311/reactions","total_count":6,"+1":6,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3311/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/271981611","html_url":"https://github.com/sidekiq/sidekiq/issues/3303#issuecomment-271981611","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3303","id":271981611,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MTk4MTYxMQ==","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-01-11T20:16:54Z","updated_at":"2017-01-11T20:16:54Z","body":"@krallin Many people have been having issues with this fix in #3311 and it's possible I will need to revert it.  Can you describe your Redis and networking setup in more detail?  Perhaps this behavior is also a function of your deployment architecture.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/271981611/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":919715896,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50OTE5NzE1ODk2","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/919715896","actor":{"login":"krallin","id":1737686,"node_id":"MDQ6VXNlcjE3Mzc2ODY=","avatar_url":"https://avatars.githubusercontent.com/u/1737686?v=4","gravatar_id":"","url":"https://api.github.com/users/krallin","html_url":"https://github.com/krallin","followers_url":"https://api.github.com/users/krallin/followers","following_url":"https://api.github.com/users/krallin/following{/other_user}","gists_url":"https://api.github.com/users/krallin/gists{/gist_id}","starred_url":"https://api.github.com/users/krallin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krallin/subscriptions","organizations_url":"https://api.github.com/users/krallin/orgs","repos_url":"https://api.github.com/users/krallin/repos","events_url":"https://api.github.com/users/krallin/events{/privacy}","received_events_url":"https://api.github.com/users/krallin/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-01-11T20:16:54Z","performed_via_github_app":null},{"id":919715897,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDkxOTcxNTg5Nw==","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/919715897","actor":{"login":"krallin","id":1737686,"node_id":"MDQ6VXNlcjE3Mzc2ODY=","avatar_url":"https://avatars.githubusercontent.com/u/1737686?v=4","gravatar_id":"","url":"https://api.github.com/users/krallin","html_url":"https://github.com/krallin","followers_url":"https://api.github.com/users/krallin/followers","following_url":"https://api.github.com/users/krallin/following{/other_user}","gists_url":"https://api.github.com/users/krallin/gists{/gist_id}","starred_url":"https://api.github.com/users/krallin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krallin/subscriptions","organizations_url":"https://api.github.com/users/krallin/orgs","repos_url":"https://api.github.com/users/krallin/repos","events_url":"https://api.github.com/users/krallin/events{/privacy}","received_events_url":"https://api.github.com/users/krallin/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-01-11T20:16:54Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/272121835","html_url":"https://github.com/sidekiq/sidekiq/issues/3303#issuecomment-272121835","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3303","id":272121835,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjEyMTgzNQ==","user":{"login":"krallin","id":1737686,"node_id":"MDQ6VXNlcjE3Mzc2ODY=","avatar_url":"https://avatars.githubusercontent.com/u/1737686?v=4","gravatar_id":"","url":"https://api.github.com/users/krallin","html_url":"https://github.com/krallin","followers_url":"https://api.github.com/users/krallin/followers","following_url":"https://api.github.com/users/krallin/following{/other_user}","gists_url":"https://api.github.com/users/krallin/gists{/gist_id}","starred_url":"https://api.github.com/users/krallin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krallin/subscriptions","organizations_url":"https://api.github.com/users/krallin/orgs","repos_url":"https://api.github.com/users/krallin/repos","events_url":"https://api.github.com/users/krallin/events{/privacy}","received_events_url":"https://api.github.com/users/krallin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-01-12T09:58:36Z","updated_at":"2017-01-12T10:52:38Z","body":"Hey @mperham,\r\n\r\nSure.\r\n\r\nI suspect the issue here (and we're investigating this on our end as well — more on that below)  is that — as you observed in #3311 —, Redis connections aren't as robust as we'd want them to be (they may break over time due to timeouts, or due to the process forking and holding on to old connections).\r\n\r\nHere is where my understanding of the problem is so far:\r\n\r\nWhen Sidekiq tries to reuse an existing connection from the pool, that connection may or may not be still be alive. If it is, then the request goes through and everything is fine. If it's not, then you get an error, whereas before this fix, you'd have had a transparent reconnect, and everything would have been fine.\r\n\r\nNow, if the connection is alive, you can still get a timeout when writing the push to Redis (that's the problem I brought up in this issue). What happens then is pretty much undetermined (as the push may or may not have gone through to Redis, and we can't know that), but it's related to `reconnect_attempts`: with transparent reconnects (`reconnect_attempts: 1`), we may push the job once or twice, and without them (`reconnect_attempts: 0`), we may zero times or once.\r\n\r\nNote that in either case, [redis-rb will \"fix\" the connection before it attempts to use it again](https://github.com/redis/redis-rb/blob/37ab9045e0fed202e42e49ccc11d41cc64de1759/lib/redis/client.rb#L348-L380) (admittedly that would be a pretty major problem here): it'll disconnect if it gets an error, or if we attempt reusing a connection that was waiting on some data.\r\n\r\n---\r\n\r\nNow; as I mentioned, we're investigating this as well...\r\n\r\nIt does appear making this change replaced some cases where we had jobs running twice concurrently (these cause major problems for us right now, so given a choice we'll always err on the side of caution) with cases where jobs are not being enqueued at all (which isn't as problematic for our use case, but still something we'd like to minimize). I haven't looked closely at whether the rate is similar (I suspect it might be), largely because it's not as big a problem anymore\r\n\r\nAt least for our use case, I think a clear improvement would be to retry when we know for sure that it's safe to do so (and not in other cases), which would be a good middle ground between the two options we have right now (which are respectively retry never with `reconnect_attempts: 0` and retry always with `reconnect_attempts: 1`).\r\n\r\nFor now, I'm planning to try and `PING` Redis before trying to use the connection (for our use case, hitting the roundtrip latency there does not matter at all). That doesn't guarantee that the connection is going to stay healthy, but it might ensure we don't use a connection that died hours ago. In other words, it gives us one reconnect attempt (since redis-rb will auto-reconnect if that `PING` fails) before we attempt to send the real traffic through.\r\n\r\nHere's the implementation I have for now. I have confirmed that this recovers from killing all clients in Redis (`CLIENT KILL TYPE normal`) then attempting to push from Sidekiq, whereas the standard `ConnectionPool` does not (it'll attempt to reuse the dead connection, fail with `Redis::ConnectionError: Connection lost (ECONNRESET)`, and then not retry).\r\n\r\n```\r\nmodule Operations\r\n  class PingPool < ConnectionPool\r\n    # This is a Redis connection pool that pings connections before using them.\r\n    # For us, this works because we'd rather accept a small delay connecting to\r\n    # Redis if that means we're more confident that we're not reusing a\r\n    # connection that was already dead.\r\n    # See: https://github.com/mperham/sidekiq/issues/3303\r\n    class << self\r\n      def create(redis_url, redis_timeout, pool_size, pool_timeout)\r\n        # We disable auto-reconnect because that can result in a job\r\n        # being pushed multiple times. See the aforementioned Sidekiq issue.\r\n        new(size: pool_size, timeout: pool_timeout) do\r\n          Redis.new(\r\n            url: redis_url,\r\n            timeout: redis_timeout,\r\n            reconnect_attempts: 0,\r\n            driver: 'ruby'\r\n          )\r\n        end\r\n      end\r\n    end\r\n\r\n    def checkout(*)\r\n      conn = super\r\n\r\n      begin\r\n        Rails.logger.info(\"#{prefix}: PING\")\r\n        r = conn.ping\r\n      rescue StandardError => e\r\n        # If the connection was dead when we PING'd, then redis-rb will\r\n        # auto-reconnect when we try to actually use this connection.\r\n        Rails.logger.info(\"#{prefix}: PING: Error: #{e.class}: #{e}\")\r\n      else\r\n        Rails.logger.info(\"#{prefix}: PING: #{r}\")\r\n      end\r\n\r\n      conn\r\n    end\r\n\r\n    def prefix\r\n      # We can't reference a Sidekiq logger from the pool, since it will be\r\n      # shared across several jobs (and even by the cron pushers), but we can\r\n      # log the current thread (in the format Sidekiq does), so that it's\r\n      # easier to tie things together.\r\n      tid = Thread.current.object_id.to_s(36)\r\n      \"#{Time.now.utc.iso8601(3)} #{::Process.pid} TID-#{tid}\"\r\n    end\r\n  end\r\nend\r\n```\r\n\r\nLooking at #3311, there's also at least `Redis::InheritedError` that is most definitely an exception that could be retried: at that point, redis-rb hasn't even tried to talk to Redis yet. \r\n\r\nThat being said, I suspect a more generally applicable (pinging before using the connection most likely isn't the right option for everyone) and robust solution here might be for Sidekiq's job push to be idempotent as far as Redis is concerned (in which case it's always safe to retry)... but I imagine this might represent quite a bit of work!\r\n\r\n---\r\n\r\nFinally, to answer your questions about our setup: we basically have a lot of Redis servers (several hundreds as of right now) that Sidekiq pushes jobs to. Most of these aren't particularly busy, and right now we don't enforce any connection timeouts on them (except for one exception..!).\r\n\r\nFinally, currently, we use version 3.3.1 of the redis-rb gem.\r\n\r\nI'm happy to continue trying out some things here (with the caveat that we're still on Sidekiq 3.x); just let me know if I can help provide more information 😄.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/272121835/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"krallin","id":1737686,"node_id":"MDQ6VXNlcjE3Mzc2ODY=","avatar_url":"https://avatars.githubusercontent.com/u/1737686?v=4","gravatar_id":"","url":"https://api.github.com/users/krallin","html_url":"https://github.com/krallin","followers_url":"https://api.github.com/users/krallin/followers","following_url":"https://api.github.com/users/krallin/following{/other_user}","gists_url":"https://api.github.com/users/krallin/gists{/gist_id}","starred_url":"https://api.github.com/users/krallin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krallin/subscriptions","organizations_url":"https://api.github.com/users/krallin/orgs","repos_url":"https://api.github.com/users/krallin/repos","events_url":"https://api.github.com/users/krallin/events{/privacy}","received_events_url":"https://api.github.com/users/krallin/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":920452802,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50OTIwNDUyODAy","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/920452802","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-01-12T09:58:36Z","performed_via_github_app":null},{"id":920452803,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDkyMDQ1MjgwMw==","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/920452803","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-01-12T09:58:36Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/272369557","html_url":"https://github.com/sidekiq/sidekiq/issues/3303#issuecomment-272369557","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3303","id":272369557,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjM2OTU1Nw==","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-01-13T06:13:56Z","updated_at":"2017-01-13T06:13:56Z","body":"For now, I believe the easiest thing to do is rollback the Sidekiq default for `reconnect_attempts` to 1.  You and others with the same problem can elect to go with 0 and deal with the issues that entails.  I wish there was a safer solution but most people aren't commonly pushing jobs to Redis which take 5+ seconds and triggering timeouts.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/272369557/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/272385807","html_url":"https://github.com/sidekiq/sidekiq/issues/3303#issuecomment-272385807","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3303","id":272385807,"node_id":"MDEyOklzc3VlQ29tbWVudDI3MjM4NTgwNw==","user":{"login":"krallin","id":1737686,"node_id":"MDQ6VXNlcjE3Mzc2ODY=","avatar_url":"https://avatars.githubusercontent.com/u/1737686?v=4","gravatar_id":"","url":"https://api.github.com/users/krallin","html_url":"https://github.com/krallin","followers_url":"https://api.github.com/users/krallin/followers","following_url":"https://api.github.com/users/krallin/following{/other_user}","gists_url":"https://api.github.com/users/krallin/gists{/gist_id}","starred_url":"https://api.github.com/users/krallin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krallin/subscriptions","organizations_url":"https://api.github.com/users/krallin/orgs","repos_url":"https://api.github.com/users/krallin/repos","events_url":"https://api.github.com/users/krallin/events{/privacy}","received_events_url":"https://api.github.com/users/krallin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-01-13T08:16:00Z","updated_at":"2017-01-13T08:16:00Z","body":"That's fair; thanks for the heads up @mperham!","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/272385807/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"krallin","id":1737686,"node_id":"MDQ6VXNlcjE3Mzc2ODY=","avatar_url":"https://avatars.githubusercontent.com/u/1737686?v=4","gravatar_id":"","url":"https://api.github.com/users/krallin","html_url":"https://github.com/krallin","followers_url":"https://api.github.com/users/krallin/followers","following_url":"https://api.github.com/users/krallin/following{/other_user}","gists_url":"https://api.github.com/users/krallin/gists{/gist_id}","starred_url":"https://api.github.com/users/krallin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/krallin/subscriptions","organizations_url":"https://api.github.com/users/krallin/orgs","repos_url":"https://api.github.com/users/krallin/repos","events_url":"https://api.github.com/users/krallin/events{/privacy}","received_events_url":"https://api.github.com/users/krallin/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":921905472,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50OTIxOTA1NDcy","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/921905472","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2017-01-13T08:16:00Z","performed_via_github_app":null},{"id":921905474,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDkyMTkwNTQ3NA==","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/921905474","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2017-01-13T08:16:00Z","performed_via_github_app":null},{"actor":{"login":"d11wtq","id":37948,"node_id":"MDQ6VXNlcjM3OTQ4","avatar_url":"https://avatars.githubusercontent.com/u/37948?v=4","gravatar_id":"","url":"https://api.github.com/users/d11wtq","html_url":"https://github.com/d11wtq","followers_url":"https://api.github.com/users/d11wtq/followers","following_url":"https://api.github.com/users/d11wtq/following{/other_user}","gists_url":"https://api.github.com/users/d11wtq/gists{/gist_id}","starred_url":"https://api.github.com/users/d11wtq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/d11wtq/subscriptions","organizations_url":"https://api.github.com/users/d11wtq/orgs","repos_url":"https://api.github.com/users/d11wtq/repos","events_url":"https://api.github.com/users/d11wtq/events{/privacy}","received_events_url":"https://api.github.com/users/d11wtq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-10T06:22:00Z","updated_at":"2017-05-10T06:22:00Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3470","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3470/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3470/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3470/events","html_url":"https://github.com/sidekiq/sidekiq/issues/3470","id":227577981,"node_id":"MDU6SXNzdWUyMjc1Nzc5ODE=","number":3470,"title":"Solution for Duplicate JIDs processed by different Threads","user":{"login":"d11wtq","id":37948,"node_id":"MDQ6VXNlcjM3OTQ4","avatar_url":"https://avatars.githubusercontent.com/u/37948?v=4","gravatar_id":"","url":"https://api.github.com/users/d11wtq","html_url":"https://github.com/d11wtq","followers_url":"https://api.github.com/users/d11wtq/followers","following_url":"https://api.github.com/users/d11wtq/following{/other_user}","gists_url":"https://api.github.com/users/d11wtq/gists{/gist_id}","starred_url":"https://api.github.com/users/d11wtq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/d11wtq/subscriptions","organizations_url":"https://api.github.com/users/d11wtq/orgs","repos_url":"https://api.github.com/users/d11wtq/repos","events_url":"https://api.github.com/users/d11wtq/events{/privacy}","received_events_url":"https://api.github.com/users/d11wtq/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2017-05-10T06:22:00Z","updated_at":"2017-05-10T23:02:49Z","closed_at":"2017-05-10T14:15:50Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Ruby version: 2.4.1 and 2.2.2\r\nSidekiq / Pro / Enterprise version(s): 4.2.10\r\n\r\nIn relation to #3303, we have written the following middleware to compare JIDs with Thread IDs using Redis and avoid processing the job if there is a mismatch. Does this look like it could cause bigger issues for us, or does what we're doing here seem sensible? The duplicates we saw in our logs (hundreds of thousands of them over a few days) were all across different TIDs (in fact, possibly coincidentally, different PIDs).\r\n\r\nThe actual issue was in relation to sending push notifications, so the issue was considered quite serious for us. Many customers got 3 duplicate notifications due to duplication of Sidekiq JIDs via a series of Sidekiq jobs that enqueue other Sidekiq jobs.\r\n\r\nFWIW, the code application had worked beautifully for 3 months until 3 days ago when this issue started and continued until today.\r\n\r\nThe duplication of JIDs doesn't appear to have been linked to timeouts in our case. Something else was going on, possibly with our Redis sentinels.\r\n\r\n``` ruby\r\nmodule Core\r\n  # Protect against processing the same JID twice in Sidekiq.\r\n  #\r\n  # We observed a serious defect in production, in which Sidekiq jobs were\r\n  # being enqueued once in the code, but processed twice in the worker. We were\r\n  # able to definitively see the same JIDs repeated across different TIDs\r\n  # within the log files. Not once or twice, but 75% of the time. JIDs should\r\n  # be unique, however it appears that in the case of Redis issues, the Redis\r\n  # client will retry operations, leading to these potential duplicate jobs.\r\n  #\r\n  # This middleware compares the ID of the current thread with the ID stored in\r\n  # a Redis-based lock (using SETNX) and refuses to process the job if the IDs\r\n  # do not match.\r\n  class SidekiqDuplicateJobMiddleware\r\n    def initialize(ttl:)\r\n      @ttl = ttl\r\n    end\r\n\r\n    # This is a Sidekiq Middleware method.\r\n    #\r\n    # Invokes job only if its JID is not yet processed by another worker.\r\n    #\r\n    # @param [Sidekiq::Worker] worker\r\n    #   the sidekiq worker that will process the job\r\n    # @param [Hash] job\r\n    #   the job payload\r\n    # @param [String] queue\r\n    #   the name of the queue the job is processed on\r\n    def call(worker, job, queue)\r\n      yield unless processed?(job['jid'])\r\n    end\r\n\r\n    private\r\n\r\n    def tid\r\n      # https://github.com/mperham/sidekiq/blob/d8f11c26518dbe967880f76fd23bb99e9d2411d5/lib/sidekiq/logging.rb#L14\r\n      Thread.current.object_id.to_s(36)\r\n    end\r\n\r\n    def acquired_job_key(jid)\r\n      format('acquired_job:%s', jid)\r\n    end\r\n\r\n    def acquired_by_tid(jid)\r\n      Sidekiq.redis do |redis|\r\n        redis.setnx(acquired_job_key(jid), tid)\r\n        redis.expire(acquired_job_key(jid), @ttl)\r\n        redis.get(acquired_job_key(jid))\r\n      end\r\n    end\r\n\r\n    def processed?(jid)\r\n      acquired_by_tid(jid) != tid\r\n    end\r\n  end\r\nend\r\n```","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3470/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3470/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-31T18:10:10Z","updated_at":"2018-01-31T18:10:10Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3742","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3742/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3742/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3742/events","html_url":"https://github.com/sidekiq/sidekiq/issues/3742","id":293244907,"node_id":"MDU6SXNzdWUyOTMyNDQ5MDc=","number":3742,"title":"Sidekiq jobs getting duplicated after restart","user":{"login":"maxwell","id":69663,"node_id":"MDQ6VXNlcjY5NjYz","avatar_url":"https://avatars.githubusercontent.com/u/69663?v=4","gravatar_id":"","url":"https://api.github.com/users/maxwell","html_url":"https://github.com/maxwell","followers_url":"https://api.github.com/users/maxwell/followers","following_url":"https://api.github.com/users/maxwell/following{/other_user}","gists_url":"https://api.github.com/users/maxwell/gists{/gist_id}","starred_url":"https://api.github.com/users/maxwell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/maxwell/subscriptions","organizations_url":"https://api.github.com/users/maxwell/orgs","repos_url":"https://api.github.com/users/maxwell/repos","events_url":"https://api.github.com/users/maxwell/events{/privacy}","received_events_url":"https://api.github.com/users/maxwell/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-01-31T17:26:33Z","updated_at":"2018-02-16T17:45:50Z","closed_at":"2018-02-16T17:45:50Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Ruby version: 2.4.2\r\nSidekiq Open Source Version\r\n\r\nPlease include your initializer and any error message with the full backtrace.\r\n\r\nAre you using an old version? sidekiq (4.2.10)\r\nHave you checked the changelogs to see if your issue has been fixed in a later version?\r\nyes\r\n\r\nFor some time, we've had some jobs that seemingly only have gotten queued once, but seem to have evidence that they ran twice for unknown reasons.  Today I caught a job that I know was only queued once (it was manually added by me), and yet showed up today as running multiple times.\r\n\r\n<img width=\"1250\" alt=\"sidekiq\" src=\"https://user-images.githubusercontent.com/69663/35637099-0bb60c34-0668-11e8-9259-6a14e970aa56.png\">\r\n\r\n\r\nThis job is a long-running data backfill.  Some jobs take 1 minute, some take many hours. The way I implemented this job was to pass a current shard to backfill, and a list of all shards which need to backfill in the future.  At the end of the backfill, I pop a shard ID off the list and start a queue a new job with the adjusted parameters.\r\n\r\nSometimes, our queues restart, which pops the job back to be queued, then Sidekiq reboots, and the job restarts.  It seems after my last restart, somehow either two jobs got re-queued, (my guess) or the job got pulled off multiple times.\r\n\r\n\r\nI realize this is minimal info. Is there some logging or something I could hook into that might expose where/what is happening?  I feel like I just got finally lucky enough to have some sort of proof here, but it seems to have been happening to us for a bit.\r\n\r\nThank you very much.\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3742/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3742/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-10-29T18:29:40Z","updated_at":"2019-10-29T18:29:40Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4353","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4353/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4353/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4353/events","html_url":"https://github.com/sidekiq/sidekiq/issues/4353","id":514120206,"node_id":"MDU6SXNzdWU1MTQxMjAyMDY=","number":4353,"title":"How does Sidekiq handle - Redis::CommandError?","user":{"login":"kapso","id":344198,"node_id":"MDQ6VXNlcjM0NDE5OA==","avatar_url":"https://avatars.githubusercontent.com/u/344198?v=4","gravatar_id":"","url":"https://api.github.com/users/kapso","html_url":"https://github.com/kapso","followers_url":"https://api.github.com/users/kapso/followers","following_url":"https://api.github.com/users/kapso/following{/other_user}","gists_url":"https://api.github.com/users/kapso/gists{/gist_id}","starred_url":"https://api.github.com/users/kapso/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kapso/subscriptions","organizations_url":"https://api.github.com/users/kapso/orgs","repos_url":"https://api.github.com/users/kapso/repos","events_url":"https://api.github.com/users/kapso/events{/privacy}","received_events_url":"https://api.github.com/users/kapso/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-10-29T18:09:00Z","updated_at":"2019-10-29T18:54:23Z","closed_at":"2019-10-29T18:54:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Curious how does Sidekiq treat the following error if it encounters it during `perform` method. In our case this happens during `perform_async` which is called from within another worker. Will the failing perform_async get retried?\r\n\r\n`Redis::CommandError - OOM command not allowed when used memory > 'maxmemory'.`\r\n\r\nRuby version: 2.6.5\r\nSidekiq / Pro / Enterprise version(s): 6.0.3 (open source)\r\nRails: 6.0.0","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4353/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4353/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"isaacbowen","id":302012,"node_id":"MDQ6VXNlcjMwMjAxMg==","avatar_url":"https://avatars.githubusercontent.com/u/302012?v=4","gravatar_id":"","url":"https://api.github.com/users/isaacbowen","html_url":"https://github.com/isaacbowen","followers_url":"https://api.github.com/users/isaacbowen/followers","following_url":"https://api.github.com/users/isaacbowen/following{/other_user}","gists_url":"https://api.github.com/users/isaacbowen/gists{/gist_id}","starred_url":"https://api.github.com/users/isaacbowen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/isaacbowen/subscriptions","organizations_url":"https://api.github.com/users/isaacbowen/orgs","repos_url":"https://api.github.com/users/isaacbowen/repos","events_url":"https://api.github.com/users/isaacbowen/events{/privacy}","received_events_url":"https://api.github.com/users/isaacbowen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T17:15:58Z","updated_at":"2021-07-26T17:15:58Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4950","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4950/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4950/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4950/events","html_url":"https://github.com/sidekiq/sidekiq/issues/4950","id":953116858,"node_id":"MDU6SXNzdWU5NTMxMTY4NTg=","number":4950,"title":"Redis::ConnectionError with { reconnect_attempts: 0 } caused (?) the leader to miss cron jobs","user":{"login":"isaacbowen","id":302012,"node_id":"MDQ6VXNlcjMwMjAxMg==","avatar_url":"https://avatars.githubusercontent.com/u/302012?v=4","gravatar_id":"","url":"https://api.github.com/users/isaacbowen","html_url":"https://github.com/isaacbowen","followers_url":"https://api.github.com/users/isaacbowen/followers","following_url":"https://api.github.com/users/isaacbowen/following{/other_user}","gists_url":"https://api.github.com/users/isaacbowen/gists{/gist_id}","starred_url":"https://api.github.com/users/isaacbowen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/isaacbowen/subscriptions","organizations_url":"https://api.github.com/users/isaacbowen/orgs","repos_url":"https://api.github.com/users/isaacbowen/repos","events_url":"https://api.github.com/users/isaacbowen/events{/privacy}","received_events_url":"https://api.github.com/users/isaacbowen/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2021-07-26T17:15:57Z","updated_at":"2021-10-31T20:53:17Z","closed_at":"2021-07-26T20:22:21Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Our leader missed a couple of cron jobs in a row (solved by restarting that Heroku process to reassign the leader). Rollbar caught a \"Redis::ConnectionError: Connection lost (ECONNRESET)\" error for the leader, and my guess is that this ended up being a permanent error condition due to our use of { reconnect_attempts: 0 } for Redis. For context, we're using that option to avoid duplicate jobs being enqueued (#3303).\r\n\r\n---\r\n\r\nRuby version: 2.7.3\r\n\r\nRails version: 6.1.4\r\n\r\nSidekiq / Pro / Enterprise version(s):\r\n* sidekiq (6.2.1)\r\n* sidekiq-pro (5.2.2)\r\n* sidekiq-ent (2.2.2)","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4950/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4950/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"actor":{"login":"bf4","id":142914,"node_id":"MDQ6VXNlcjE0MjkxNA==","avatar_url":"https://avatars.githubusercontent.com/u/142914?v=4","gravatar_id":"","url":"https://api.github.com/users/bf4","html_url":"https://github.com/bf4","followers_url":"https://api.github.com/users/bf4/followers","following_url":"https://api.github.com/users/bf4/following{/other_user}","gists_url":"https://api.github.com/users/bf4/gists{/gist_id}","starred_url":"https://api.github.com/users/bf4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bf4/subscriptions","organizations_url":"https://api.github.com/users/bf4/orgs","repos_url":"https://api.github.com/users/bf4/repos","events_url":"https://api.github.com/users/bf4/events{/privacy}","received_events_url":"https://api.github.com/users/bf4/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-17T16:51:16Z","updated_at":"2023-02-17T16:51:16Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/redis-rb/redis-client/issues/92","repository_url":"https://api.github.com/repos/redis-rb/redis-client","labels_url":"https://api.github.com/repos/redis-rb/redis-client/issues/92/labels{/name}","comments_url":"https://api.github.com/repos/redis-rb/redis-client/issues/92/comments","events_url":"https://api.github.com/repos/redis-rb/redis-client/issues/92/events","html_url":"https://github.com/redis-rb/redis-client/issues/92","id":1588289127,"node_id":"I_kwDOG-L0Q85eq15n","number":92,"title":"Unhandled EOFError","user":{"login":"bf4","id":142914,"node_id":"MDQ6VXNlcjE0MjkxNA==","avatar_url":"https://avatars.githubusercontent.com/u/142914?v=4","gravatar_id":"","url":"https://api.github.com/users/bf4","html_url":"https://github.com/bf4","followers_url":"https://api.github.com/users/bf4/followers","following_url":"https://api.github.com/users/bf4/following{/other_user}","gists_url":"https://api.github.com/users/bf4/gists{/gist_id}","starred_url":"https://api.github.com/users/bf4/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bf4/subscriptions","organizations_url":"https://api.github.com/users/bf4/orgs","repos_url":"https://api.github.com/users/bf4/repos","events_url":"https://api.github.com/users/bf4/events{/privacy}","received_events_url":"https://api.github.com/users/bf4/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2023-02-16T20:02:09Z","updated_at":"2023-02-17T16:56:00Z","closed_at":"2023-02-16T20:55:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":467858499,"node_id":"R_kgDOG-L0Qw","name":"redis-client","full_name":"redis-rb/redis-client","private":false,"owner":{"login":"redis-rb","id":100795518,"node_id":"O_kgDOBgIEfg","avatar_url":"https://avatars.githubusercontent.com/u/100795518?v=4","gravatar_id":"","url":"https://api.github.com/users/redis-rb","html_url":"https://github.com/redis-rb","followers_url":"https://api.github.com/users/redis-rb/followers","following_url":"https://api.github.com/users/redis-rb/following{/other_user}","gists_url":"https://api.github.com/users/redis-rb/gists{/gist_id}","starred_url":"https://api.github.com/users/redis-rb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redis-rb/subscriptions","organizations_url":"https://api.github.com/users/redis-rb/orgs","repos_url":"https://api.github.com/users/redis-rb/repos","events_url":"https://api.github.com/users/redis-rb/events{/privacy}","received_events_url":"https://api.github.com/users/redis-rb/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/redis-rb/redis-client","description":"Simple low level client for Redis 6+","fork":false,"url":"https://api.github.com/repos/redis-rb/redis-client","forks_url":"https://api.github.com/repos/redis-rb/redis-client/forks","keys_url":"https://api.github.com/repos/redis-rb/redis-client/keys{/key_id}","collaborators_url":"https://api.github.com/repos/redis-rb/redis-client/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/redis-rb/redis-client/teams","hooks_url":"https://api.github.com/repos/redis-rb/redis-client/hooks","issue_events_url":"https://api.github.com/repos/redis-rb/redis-client/issues/events{/number}","events_url":"https://api.github.com/repos/redis-rb/redis-client/events","assignees_url":"https://api.github.com/repos/redis-rb/redis-client/assignees{/user}","branches_url":"https://api.github.com/repos/redis-rb/redis-client/branches{/branch}","tags_url":"https://api.github.com/repos/redis-rb/redis-client/tags","blobs_url":"https://api.github.com/repos/redis-rb/redis-client/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/redis-rb/redis-client/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/redis-rb/redis-client/git/refs{/sha}","trees_url":"https://api.github.com/repos/redis-rb/redis-client/git/trees{/sha}","statuses_url":"https://api.github.com/repos/redis-rb/redis-client/statuses/{sha}","languages_url":"https://api.github.com/repos/redis-rb/redis-client/languages","stargazers_url":"https://api.github.com/repos/redis-rb/redis-client/stargazers","contributors_url":"https://api.github.com/repos/redis-rb/redis-client/contributors","subscribers_url":"https://api.github.com/repos/redis-rb/redis-client/subscribers","subscription_url":"https://api.github.com/repos/redis-rb/redis-client/subscription","commits_url":"https://api.github.com/repos/redis-rb/redis-client/commits{/sha}","git_commits_url":"https://api.github.com/repos/redis-rb/redis-client/git/commits{/sha}","comments_url":"https://api.github.com/repos/redis-rb/redis-client/comments{/number}","issue_comment_url":"https://api.github.com/repos/redis-rb/redis-client/issues/comments{/number}","contents_url":"https://api.github.com/repos/redis-rb/redis-client/contents/{+path}","compare_url":"https://api.github.com/repos/redis-rb/redis-client/compare/{base}...{head}","merges_url":"https://api.github.com/repos/redis-rb/redis-client/merges","archive_url":"https://api.github.com/repos/redis-rb/redis-client/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/redis-rb/redis-client/downloads","issues_url":"https://api.github.com/repos/redis-rb/redis-client/issues{/number}","pulls_url":"https://api.github.com/repos/redis-rb/redis-client/pulls{/number}","milestones_url":"https://api.github.com/repos/redis-rb/redis-client/milestones{/number}","notifications_url":"https://api.github.com/repos/redis-rb/redis-client/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/redis-rb/redis-client/labels{/name}","releases_url":"https://api.github.com/repos/redis-rb/redis-client/releases{/id}","deployments_url":"https://api.github.com/repos/redis-rb/redis-client/deployments","created_at":"2022-03-09T09:23:58Z","updated_at":"2025-11-07T14:28:48Z","pushed_at":"2025-11-03T22:10:43Z","git_url":"git://github.com/redis-rb/redis-client.git","ssh_url":"git@github.com:redis-rb/redis-client.git","clone_url":"https://github.com/redis-rb/redis-client.git","svn_url":"https://github.com/redis-rb/redis-client","homepage":null,"size":860,"stargazers_count":138,"watchers_count":138,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":false,"forks_count":68,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":10,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":[],"visibility":"public","forks":68,"open_issues":10,"watchers":138,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"This error may be raised by [fill_buffer](https://github.com/redis-rb/redis-client/blob/d00e69821a8a1fd5dcba2e48cc010f4d97846b3d/lib/redis_client/ruby_connection/buffered_io.rb#L144-L146)\r\n\r\nSince the Redis gem relies on RedisClient, I'd expect to have the same error raised when using Redis, but it appears that the Redis gem handles this.  I was wondering if this is a bug in the RedisClient or something undocumented which libraries using RedisClient need to handled\r\n\r\n```ruby\r\nredis-client-0.12.1/lib/redis_client/ruby_connection/buffered_io.rb:145 in block in fill_buffer\r\nredis-client-0.12.1/lib/redis_client/ruby_connection/buffered_io.rb:122 in loop\r\nredis-client-0.12.1/lib/redis_client/ruby_connection/buffered_io.rb:122 in fill_buffer\r\nredis-client-0.12.1/lib/redis_client/ruby_connection/buffered_io.rb:114 in ensure_remaining\r\nredis-client-0.12.1/lib/redis_client/ruby_connection/buffered_io.rb:85 in getbyte\r\nredis-client-0.12.1/lib/redis_client/ruby_connection/resp3.rb:113 in parse\r\nredis-client-0.12.1/lib/redis_client/ruby_connection/resp3.rb:50 in load\r\nredis-client-0.12.1/lib/redis_client/ruby_connection.rb:123 in read\r\nredis-client-0.12.1/lib/redis_client/connection_mixin.rb:18 in call\r\nredis-client-0.12.1/lib/redis_client.rb:210 in block (2 levels) in call\r\nredis-client-0.12.1/lib/redis_client/middlewares.rb:16 in call\r\nredis-client-0.12.1/lib/redis_client.rb:209 in block in call\r\nredis-client-0.12.1/lib/redis_client.rb:626 in ensure_connected\r\nredis-client-0.12.1/lib/redis_client.rb:208 in call\r\nredlock-2.0.1/lib/redlock/client.rb:172 in block (2 levels) in lock\r\nconnection_pool-2.3.0/lib/connection_pool.rb:65 in block (2 levels) in with\r\nconnection_pool-2.3.0/lib/connection_pool.rb:64 in handle_interrupt\r\nconnection_pool-2.3.0/lib/connection_pool.rb:64 in block in with\r\nconnection_pool-2.3.0/lib/connection_pool.rb:61 in handle_interrupt\r\nconnection_pool-2.3.0/lib/connection_pool.rb:61 in with\r\nconnection_pool-2.3.0/lib/connection_pool/wrapper.rb:14 in with\r\nredlock-2.0.1/lib/redlock/client.rb:171 in block in lock\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/redis-rb/redis-client/issues/92/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis-rb/redis-client/issues/92/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":13766717209,"node_id":"REFE_lADOADDA9M4L0sYBzwAAAAM0j28Z","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/13766717209","actor":{"login":"AlexSc","id":98665,"node_id":"MDQ6VXNlcjk4NjY1","avatar_url":"https://avatars.githubusercontent.com/u/98665?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexSc","html_url":"https://github.com/AlexSc","followers_url":"https://api.github.com/users/AlexSc/followers","following_url":"https://api.github.com/users/AlexSc/following{/other_user}","gists_url":"https://api.github.com/users/AlexSc/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexSc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexSc/subscriptions","organizations_url":"https://api.github.com/users/AlexSc/orgs","repos_url":"https://api.github.com/users/AlexSc/repos","events_url":"https://api.github.com/users/AlexSc/events{/privacy}","received_events_url":"https://api.github.com/users/AlexSc/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"2749c12b887815800b0a5c93bcf077c3dcd2796d","commit_url":"https://api.github.com/repos/GoCarrot/sidekiq/commits/2749c12b887815800b0a5c93bcf077c3dcd2796d","created_at":"2024-08-05T16:13:30Z","performed_via_github_app":null}]