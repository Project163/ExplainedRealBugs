{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1630","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1630/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1630/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1630/events","html_url":"https://github.com/sidekiq/sidekiq/issues/1630","id":30700404,"node_id":"MDU6SXNzdWUzMDcwMDQwNA==","number":1630,"title":"Scheduled Poller scalability issue","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2014-04-02T15:55:33Z","updated_at":"2014-06-10T03:45:39Z","closed_at":"2014-06-10T03:45:39Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Currently each Sidekiq process polls Redis every 15 seconds for new scheduled jobs.  This is fine when you have 1 process.  When you have 150 processes, Sidekiq is checking every 100ms.  Not good at all, especially if you have 100,000s of jobs in the scheduled set.\n\nOne workaround today is to manually set poll_interval to a much larger value.  I believe a better formula is:\n\n``` ruby\nprocess_count = 150\nSidekiq.configure_server do |config|\n  config.poll_interval = 5 * process_count\nend\n```\n\nThis should result in processes checking every 5 seconds or so.  But ultimately I'd like Sidekiq to self-tune so user configuration is not necessary at all.  With 3.0's new heartbeat, we have a better idea of the current process count at work and should be able to self-tune.\n","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1630/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1630/timeline","performed_via_github_app":null,"state_reason":"completed"}