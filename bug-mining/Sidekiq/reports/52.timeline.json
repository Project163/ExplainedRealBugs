[{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8129535","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-8129535","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":8129535,"node_id":"MDEyOklzc3VlQ29tbWVudDgxMjk1MzU=","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-08-29T15:41:30Z","updated_at":"2012-08-29T15:41:39Z","body":"\"When I quit sidekiq the currently processing job gets killed and\npushed back to redis, so far so good. But why/how does ActiveRecord\nCOMMIT the half finished work?\"\n\n```\n2012-08-29T11:46:12Z 24606 TID-ov2kqsjbo INFO: Shutting down\n2012-08-29T11:46:12Z 24606 TID-ov2kuaw88 INFO: Shutting down 24 quiet workers\n2012-08-29T11:46:12Z 24606 TID-ov2kuaw88 INFO: Pausing up to 8 seconds\nto allow workers to finish...\nD, [2012-08-29T13:46:12.894024 #24606] DEBUG -- :    (1.7ms)  SELECT ...\n2012-08-29T11:46:20Z 24606 TID-ov2kuaw88 INFO: Still waiting for 1 busy workers\n2012-08-29T11:46:20Z 24606 TID-ov2kuaw88 INFO: Pushed 1 messages back to Redis\nD, [2012-08-29T13:46:20.869455 #24606] DEBUG -- :    (1.9ms)  COMMIT\n<-- Why isn't this a ROLLBACK\n```\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8129535/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8129806","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-8129806","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":8129806,"node_id":"MDEyOklzc3VlQ29tbWVudDgxMjk4MDY=","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-08-29T15:48:47Z","updated_at":"2012-08-29T15:48:47Z","body":"There is a race condition between a job finishing on a Processor and the Manager pushing the job back onto the queue.  sidekiq/manage.rb line 128.  A processor can be done but hasn't yet informed us so we can remove it from the `@busy` array.\n\nSidekiq does not guarantee single delivery.  Idempotence is the property of certain operations in mathematics and computer science, that they can be applied multiple times without changing the result beyond the initial application.  In other words, Sidekiq can call your job multiple times and idempotence means it will process successfully each time, even if committed.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8129806/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8130001","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-8130001","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":8130001,"node_id":"MDEyOklzc3VlQ29tbWVudDgxMzAwMDE=","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-08-29T15:54:09Z","updated_at":"2012-08-29T15:54:09Z","body":"I can't think of any way to fix this race condition at the moment.  I'll ponder it for a bit.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8130001/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8130027","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-8130027","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":8130027,"node_id":"MDEyOklzc3VlQ29tbWVudDgxMzAwMjc=","user":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-08-29T15:54:59Z","updated_at":"2012-08-29T15:54:59Z","body":"I need to clarify, the job is clearly not done when COMMIT gets called. The job takes on average 1h and when I'm running it locally and press Ctrl-C after 10 seconds it just exists and commits what it already has.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8130027/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8130096","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-8130096","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":8130096,"node_id":"MDEyOklzc3VlQ29tbWVudDgxMzAwOTY=","user":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-08-29T15:56:22Z","updated_at":"2012-08-29T15:56:22Z","body":"I expected sidekiq to do something like `the_thread.raise YouAreDeadException` but in my worker I don't rescue any exceptions when sidekiq quits. So I'm wondering how sidekiq actually kills the worker. (I think if sidekiq does simply Kernel.exit then some ActiveRecord at_exit callback might do a COMMIT?)\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8130096/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8130319","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-8130319","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":8130319,"node_id":"MDEyOklzc3VlQ29tbWVudDgxMzAzMTk=","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-08-29T16:02:38Z","updated_at":"2012-08-29T16:02:38Z","body":"Yeah, that's terrible.  It shouldn't do that.  I don't kill the Processor, I just exit the process.  Would you be willing to test a fix on master for me?\n\nAs a side note, IMO it's not a good idea to hold a database transaction open for a long time (e.g. > 5-10 sec).  You know your system best so that's just a general rule of course.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8130319/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8130399","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-8130399","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":8130399,"node_id":"MDEyOklzc3VlQ29tbWVudDgxMzAzOTk=","user":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-08-29T16:04:11Z","updated_at":"2012-08-29T16:04:11Z","body":"Yep I'd certainly test that.\n\nYeah, this DB transaction is a special case and keeps to itself (doesn't UPDATE any non-batch tables) so it's ok.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8130399/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":23606775,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIzNjA2Nzc1","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/23606775","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"bf97296fbf7abceff0088af58671f87893154768","commit_url":"https://api.github.com/repos/sidekiq/sidekiq/commits/bf97296fbf7abceff0088af58671f87893154768","created_at":"2012-08-29T16:05:13Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8130535","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-8130535","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":8130535,"node_id":"MDEyOklzc3VlQ29tbWVudDgxMzA1MzU=","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-08-29T16:07:33Z","updated_at":"2012-08-29T16:07:33Z","body":"Give that a shot.  Maybe explicitly terminating will cause a rollback.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8130535/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8130748","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-8130748","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":8130748,"node_id":"MDEyOklzc3VlQ29tbWVudDgxMzA3NDg=","user":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-08-29T16:12:52Z","updated_at":"2012-08-29T16:12:52Z","body":"Nope, still same behavior. I actually tried that modification myself earlier after reading the source. (But I tested again with the sidekiq master of course)\n\nMy current workaround is to do `Kernel.at_exit { Kernel.exit! }`.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8130748/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8131300","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-8131300","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":8131300,"node_id":"MDEyOklzc3VlQ29tbWVudDgxMzEzMDA=","user":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-08-29T16:28:00Z","updated_at":"2012-08-29T16:28:00Z","body":"Ok, here's a simple repro of the bug with sqlite so I'm thinking it's clearly somewhere in ActiveRecord: https://github.com/MSch/sidekiq-activerecord\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8131300/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8132023","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-8132023","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":8132023,"node_id":"MDEyOklzc3VlQ29tbWVudDgxMzIwMjM=","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-08-29T16:47:47Z","updated_at":"2012-08-29T16:47:47Z","body":"If you think it's in Rails, I'd remove the sidekiq dependency.  Turn on threadsafe! and create two controller actions: one of which performs the long running XA and other which just does Kernel.exit.  See if that commits.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8132023/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8132361","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-8132361","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":8132361,"node_id":"MDEyOklzc3VlQ29tbWVudDgxMzIzNjE=","user":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-08-29T16:56:45Z","updated_at":"2012-08-29T16:56:45Z","body":"https://github.com/MSch/sidekiq-activerecord/tree/railsonly\nhttps://github.com/MSch/sidekiq-activerecord/commit/73797ad6d91fcb997867cd8eece7b63b53c50945\n\n`Kernel.exit` doesn't exit at all, it throws a `SystemExit` exception in the thread processing it and the AR thread happily continues and Rails doesn't exit.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8132361/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8136666","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-8136666","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":8136666,"node_id":"MDEyOklzc3VlQ29tbWVudDgxMzY2NjY=","user":{"login":"betelgeuse","id":34627,"node_id":"MDQ6VXNlcjM0NjI3","avatar_url":"https://avatars.githubusercontent.com/u/34627?v=4","gravatar_id":"","url":"https://api.github.com/users/betelgeuse","html_url":"https://github.com/betelgeuse","followers_url":"https://api.github.com/users/betelgeuse/followers","following_url":"https://api.github.com/users/betelgeuse/following{/other_user}","gists_url":"https://api.github.com/users/betelgeuse/gists{/gist_id}","starred_url":"https://api.github.com/users/betelgeuse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/betelgeuse/subscriptions","organizations_url":"https://api.github.com/users/betelgeuse/orgs","repos_url":"https://api.github.com/users/betelgeuse/repos","events_url":"https://api.github.com/users/betelgeuse/events{/privacy}","received_events_url":"https://api.github.com/users/betelgeuse/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-08-29T18:49:55Z","updated_at":"2012-08-29T18:49:55Z","body":"Something is definitely weird with transaction handling. I am currently seeing jobs being added from after_commit that then when run in sidekiq don't see the record. Not really sure if it's related but as I don't have any details I don't think I can open a useful new report either.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8136666/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"betelgeuse","id":34627,"node_id":"MDQ6VXNlcjM0NjI3","avatar_url":"https://avatars.githubusercontent.com/u/34627?v=4","gravatar_id":"","url":"https://api.github.com/users/betelgeuse","html_url":"https://github.com/betelgeuse","followers_url":"https://api.github.com/users/betelgeuse/followers","following_url":"https://api.github.com/users/betelgeuse/following{/other_user}","gists_url":"https://api.github.com/users/betelgeuse/gists{/gist_id}","starred_url":"https://api.github.com/users/betelgeuse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/betelgeuse/subscriptions","organizations_url":"https://api.github.com/users/betelgeuse/orgs","repos_url":"https://api.github.com/users/betelgeuse/repos","events_url":"https://api.github.com/users/betelgeuse/events{/privacy}","received_events_url":"https://api.github.com/users/betelgeuse/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8754061","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-8754061","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":8754061,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NTQwNjE=","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-09-21T03:18:53Z","updated_at":"2012-09-21T03:18:53Z","body":"Closing, this issue appears to be external to Sidekiq.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/8754061/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":25104557,"node_id":"MDExOkNsb3NlZEV2ZW50MjUxMDQ1NTc=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/25104557","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2012-09-21T03:18:53Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15141253","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-15141253","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":15141253,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MTQxMjUz","user":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-03-19T20:33:39Z","updated_at":"2013-03-19T20:33:39Z","body":"Please reopen this. This is a serious bug and it's still happening.\n\nI've created an example repo: https://github.com/MSch/sidekiq-bug\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15141253/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15141933","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-15141933","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":15141933,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MTQxOTMz","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-03-19T20:45:02Z","updated_at":"2013-03-19T20:45:02Z","body":"@MSch Use ensure to log something when exiting the perform method to see if the commit is done before exiting.\n\n``` ruby\n  def perform(name, count)\n    # do something\n    ActiveRecord::Base.transaction do\n      sleep 50\n    end\n  ensure\n    Sidekiq.logger.warn \"Exiting\"\n  end\n```\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15141933/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":42170187,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDIxNzAxODc=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/42170187","actor":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2013-03-19T20:45:02Z","performed_via_github_app":null},{"id":42170188,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQyMTcwMTg4","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/42170188","actor":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2013-03-19T20:45:02Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15142431","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-15142431","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":15142431,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MTQyNDMx","user":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-03-19T20:53:29Z","updated_at":"2013-03-19T20:58:19Z","body":"@mperham :/\n\n``` ruby\n  def perform(name, count)\n    ActiveRecord::Base.transaction do\n      DBLog.create!(value: \"Before sleep\")\n      sleep 50\n      DBLog.create!(value: \"After sleep\")\n    end\n  ensure\n    DBLog.create!(value: \"Exiting\")\n    Rails.logger.warn \"Exiting\"\n    Sidekiq.logger.warn \"Exiting\"\n  end\n```\n\n``` log\n   (0.8ms)  begin transaction\n  SQL (4.1ms)  INSERT INTO \"db_logs\" (\"created_at\", \"updated_at\", \"value\") VALUES (?, ?, ?)  [[\"created_at\", Tue, 19 Mar 2013 20:57:15 UTC +00:00], [\"updated_at\", Tue, 19 Mar 2013 20:57:15 UTC +00:00], [\"value\", \"Before sleep\"]]\n   (2.6ms)  commit transaction\n   (0.1ms)  begin transaction\n  SQL (0.6ms)  INSERT INTO \"db_logs\" (\"created_at\", \"updated_at\", \"value\") VALUES (?, ?, ?)  [[\"created_at\", Tue, 19 Mar 2013 20:57:29 UTC +00:00], [\"updated_at\", Tue, 19 Mar 2013 20:57:29 UTC +00:00], [\"value\", \"Exiting\"]]\n   (0.8ms)  commit transaction\nExiting\n```\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15142431/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":42171595,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NDIxNzE1OTU=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/42171595","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2013-03-19T20:53:29Z","performed_via_github_app":null},{"id":42171596,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDQyMTcxNTk2","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/42171596","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2013-03-19T20:53:29Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15143949","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-15143949","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":15143949,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MTQzOTQ5","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-03-19T21:21:09Z","updated_at":"2013-03-19T21:21:09Z","body":"Correct me if I'm reading that wrong but it looks like AR or your database is auto-committing after every statement.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15143949/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15144133","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-15144133","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":15144133,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MTQ0MTMz","user":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-03-19T21:24:27Z","updated_at":"2013-03-19T21:24:27Z","body":"ActiveRecord autocommits after every statement except if it's in a\ntransaction block. If you let it sleep the 50 secs it'll look like BEGIN;\nINSERT; INSERT; COMMIT for the transaction block\n\nOn Tuesday, March 19, 2013, Mike Perham wrote:\n\n> Correct me if I'm reading that wrong but it looks like AR or your database\n> is auto-committing after every statement.\n> \n> \n> Reply to this email directly or view it on GitHubhttps://github.com/mperham/sidekiq/issues/377#issuecomment-15143949\n> .\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15144133/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15144996","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-15144996","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":15144996,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MTQ0OTk2","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-03-19T21:40:39Z","updated_at":"2013-03-19T21:40:39Z","body":"I'm still unclear how Sidekiq can influence 'Before sleep' to commit when an exception is raised.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15144996/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15145021","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-15145021","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":15145021,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MTQ1MDIx","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-03-19T21:41:05Z","updated_at":"2013-03-19T21:41:05Z","body":"That behavior is entirely within the worker code.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15145021/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15160398","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-15160398","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":15160398,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MTYwMzk4","user":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-03-20T06:30:52Z","updated_at":"2013-03-20T06:30:52Z","body":"I also have no idea what's going on.\n\nHow does sidekiq kill the worker? For some reason the way it kills the worker makes ActiveRecord think that it should COMMIT and not ROLLBACK the transaction.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15160398/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15161131","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-15161131","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":15161131,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MTYxMTMx","user":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-03-20T07:05:59Z","updated_at":"2013-03-20T07:05:59Z","body":"If sidekiq just raises an exception the transaction should ROLLBACK.\n\nBut it doesn't? https://github.com/MSch/sidekiq-bug/commit/881074b290dcab61f89346944006de151ba31837\n\nHow does sidekiq/celluloid even kill the worker?\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15161131/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"MSch","id":7475,"node_id":"MDQ6VXNlcjc0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/7475?v=4","gravatar_id":"","url":"https://api.github.com/users/MSch","html_url":"https://github.com/MSch","followers_url":"https://api.github.com/users/MSch/followers","following_url":"https://api.github.com/users/MSch/following{/other_user}","gists_url":"https://api.github.com/users/MSch/gists{/gist_id}","starred_url":"https://api.github.com/users/MSch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MSch/subscriptions","organizations_url":"https://api.github.com/users/MSch/orgs","repos_url":"https://api.github.com/users/MSch/repos","events_url":"https://api.github.com/users/MSch/events{/privacy}","received_events_url":"https://api.github.com/users/MSch/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15182890","html_url":"https://github.com/sidekiq/sidekiq/issues/377#issuecomment-15182890","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/377","id":15182890,"node_id":"MDEyOklzc3VlQ29tbWVudDE1MTgyODkw","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-03-20T15:33:09Z","updated_at":"2013-03-20T15:33:09Z","body":"I believe this is how it works.  Sidekiq doesn't kill the worker, Ruby (MRI) kills it by raising a SignalException in all threads when Ctrl-C is pressed.  AR should catch that exception, rollback the transaction here (https://github.com/rails/rails/blob/3-2-stable/activerecord/lib/active_record/connection_adapters/abstract/database_statements.rb#L194) and then re-raise the error so the worker exits.  I would add some logging to verify this.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15182890/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}}]