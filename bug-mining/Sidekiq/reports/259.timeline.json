[{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/672263662","html_url":"https://github.com/sidekiq/sidekiq/issues/4667#issuecomment-672263662","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4667","id":672263662,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MjI2MzY2Mg==","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-11T20:30:46Z","updated_at":"2020-08-11T20:30:46Z","body":"Yes, that's one of the commercial features that doesn't work with ActiveJob today. If you have suggestions for how to fix, I'd love feedback. Maybe it should warn that it doesn't work?\n\n\nhttps://github.com/mperham/sidekiq/wiki/Active-Job#commercial-features","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/672263662/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/672269928","html_url":"https://github.com/sidekiq/sidekiq/issues/4667#issuecomment-672269928","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4667","id":672269928,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MjI2OTkyOA==","user":{"login":"nertzy","id":2488,"node_id":"MDQ6VXNlcjI0ODg=","avatar_url":"https://avatars.githubusercontent.com/u/2488?v=4","gravatar_id":"","url":"https://api.github.com/users/nertzy","html_url":"https://github.com/nertzy","followers_url":"https://api.github.com/users/nertzy/followers","following_url":"https://api.github.com/users/nertzy/following{/other_user}","gists_url":"https://api.github.com/users/nertzy/gists{/gist_id}","starred_url":"https://api.github.com/users/nertzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nertzy/subscriptions","organizations_url":"https://api.github.com/users/nertzy/orgs","repos_url":"https://api.github.com/users/nertzy/repos","events_url":"https://api.github.com/users/nertzy/events{/privacy}","received_events_url":"https://api.github.com/users/nertzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-11T20:45:25Z","updated_at":"2020-08-11T20:45:25Z","body":"I'm going to experiment with some ideas and report back.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/672269928/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nertzy","id":2488,"node_id":"MDQ6VXNlcjI0ODg=","avatar_url":"https://avatars.githubusercontent.com/u/2488?v=4","gravatar_id":"","url":"https://api.github.com/users/nertzy","html_url":"https://github.com/nertzy","followers_url":"https://api.github.com/users/nertzy/followers","following_url":"https://api.github.com/users/nertzy/following{/other_user}","gists_url":"https://api.github.com/users/nertzy/gists{/gist_id}","starred_url":"https://api.github.com/users/nertzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nertzy/subscriptions","organizations_url":"https://api.github.com/users/nertzy/orgs","repos_url":"https://api.github.com/users/nertzy/repos","events_url":"https://api.github.com/users/nertzy/events{/privacy}","received_events_url":"https://api.github.com/users/nertzy/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/672277337","html_url":"https://github.com/sidekiq/sidekiq/issues/4667#issuecomment-672277337","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4667","id":672277337,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MjI3NzMzNw==","user":{"login":"nertzy","id":2488,"node_id":"MDQ6VXNlcjI0ODg=","avatar_url":"https://avatars.githubusercontent.com/u/2488?v=4","gravatar_id":"","url":"https://api.github.com/users/nertzy","html_url":"https://github.com/nertzy","followers_url":"https://api.github.com/users/nertzy/followers","following_url":"https://api.github.com/users/nertzy/following{/other_user}","gists_url":"https://api.github.com/users/nertzy/gists{/gist_id}","starred_url":"https://api.github.com/users/nertzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nertzy/subscriptions","organizations_url":"https://api.github.com/users/nertzy/orgs","repos_url":"https://api.github.com/users/nertzy/repos","events_url":"https://api.github.com/users/nertzy/events{/privacy}","received_events_url":"https://api.github.com/users/nertzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-11T21:01:36Z","updated_at":"2020-08-11T21:01:36Z","body":"Perhaps `sidekiq_options` could allow for a way to pass in a Proc to override the logic that takes the arguments and returns a unique object.\r\n\r\nIt's not incredibly elegant, but it would look something like:\r\n```ruby\r\nclass MyJob < ApplicationJob\r\n  sidekiq_options(\r\n    unique_for: 10.minutes, \r\n    unique_by: -> (job) { job[\"args\"][0].reject { |key, value| %w[job_id enqueud_at].include?(key) } }\r\n  )\r\nend\r\n```\r\nIt would be even better if the uniqueness algorithm checked for a method on the Worker instance to get the arguments to consider, and that this method could be defined on ActiveJob::QueueAdapters::SidekiqAdapter::JobWrapper to return the appropriate subset of arguments.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/672277337/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nertzy","id":2488,"node_id":"MDQ6VXNlcjI0ODg=","avatar_url":"https://avatars.githubusercontent.com/u/2488?v=4","gravatar_id":"","url":"https://api.github.com/users/nertzy","html_url":"https://github.com/nertzy","followers_url":"https://api.github.com/users/nertzy/followers","following_url":"https://api.github.com/users/nertzy/following{/other_user}","gists_url":"https://api.github.com/users/nertzy/gists{/gist_id}","starred_url":"https://api.github.com/users/nertzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nertzy/subscriptions","organizations_url":"https://api.github.com/users/nertzy/orgs","repos_url":"https://api.github.com/users/nertzy/repos","events_url":"https://api.github.com/users/nertzy/events{/privacy}","received_events_url":"https://api.github.com/users/nertzy/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/673048960","html_url":"https://github.com/sidekiq/sidekiq/issues/4667#issuecomment-673048960","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4667","id":673048960,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzA0ODk2MA==","user":{"login":"nertzy","id":2488,"node_id":"MDQ6VXNlcjI0ODg=","avatar_url":"https://avatars.githubusercontent.com/u/2488?v=4","gravatar_id":"","url":"https://api.github.com/users/nertzy","html_url":"https://github.com/nertzy","followers_url":"https://api.github.com/users/nertzy/followers","following_url":"https://api.github.com/users/nertzy/following{/other_user}","gists_url":"https://api.github.com/users/nertzy/gists{/gist_id}","starred_url":"https://api.github.com/users/nertzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nertzy/subscriptions","organizations_url":"https://api.github.com/users/nertzy/orgs","repos_url":"https://api.github.com/users/nertzy/repos","events_url":"https://api.github.com/users/nertzy/events{/privacy}","received_events_url":"https://api.github.com/users/nertzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-12T18:51:57Z","updated_at":"2020-08-12T18:51:57Z","body":"Here's the workaround we came up with, for now: https://gist.github.com/nertzy/74d4fbab3440d56b8bda2241b4eb0c4e","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/673048960/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nertzy","id":2488,"node_id":"MDQ6VXNlcjI0ODg=","avatar_url":"https://avatars.githubusercontent.com/u/2488?v=4","gravatar_id":"","url":"https://api.github.com/users/nertzy","html_url":"https://github.com/nertzy","followers_url":"https://api.github.com/users/nertzy/followers","following_url":"https://api.github.com/users/nertzy/following{/other_user}","gists_url":"https://api.github.com/users/nertzy/gists{/gist_id}","starred_url":"https://api.github.com/users/nertzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nertzy/subscriptions","organizations_url":"https://api.github.com/users/nertzy/orgs","repos_url":"https://api.github.com/users/nertzy/repos","events_url":"https://api.github.com/users/nertzy/events{/privacy}","received_events_url":"https://api.github.com/users/nertzy/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/673058494","html_url":"https://github.com/sidekiq/sidekiq/issues/4667#issuecomment-673058494","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4667","id":673058494,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzA1ODQ5NA==","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-12T19:12:09Z","updated_at":"2020-08-12T19:12:09Z","body":"I'm working on official support in the next release and will update this issue with progress.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/673058494/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/673080702","html_url":"https://github.com/sidekiq/sidekiq/issues/4667#issuecomment-673080702","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4667","id":673080702,"node_id":"MDEyOklzc3VlQ29tbWVudDY3MzA4MDcwMg==","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-12T19:59:56Z","updated_at":"2020-08-12T19:59:56Z","body":"I've got things working but there are some caveats:\r\n\r\n```ruby\r\nSomeJob.perform_later(:foo)\r\nSomeJob.perform_later(\"foo\")\r\n```\r\n\r\nShould these result in the same or different locks? Sidekiq enforces JSON data types for arguments but Rails allows more flexible arguments which can result in the same underlying lock because they devolve to the same JSON data when serialized. Right now I'm doing the simplest thing possible.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/673080702/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":3649271139,"node_id":"MDExOkNsb3NlZEV2ZW50MzY0OTI3MTEzOQ==","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/3649271139","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2020-08-12T20:09:37Z","state_reason":null,"performed_via_github_app":null},{"id":3649279747,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM2NDkyNzk3NDc=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/3649279747","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"431e86463582e9f382f8a240372fa6c9083f9227","commit_url":"https://api.github.com/repos/sidekiq/sidekiq/commits/431e86463582e9f382f8a240372fa6c9083f9227","created_at":"2020-08-12T20:12:27Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/673778442","html_url":"https://github.com/sidekiq/sidekiq/issues/4667#issuecomment-673778442","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4667","id":673778442,"node_id":"MDEyOklzc3VlQ29tbWVudDY3Mzc3ODQ0Mg==","user":{"login":"nertzy","id":2488,"node_id":"MDQ6VXNlcjI0ODg=","avatar_url":"https://avatars.githubusercontent.com/u/2488?v=4","gravatar_id":"","url":"https://api.github.com/users/nertzy","html_url":"https://github.com/nertzy","followers_url":"https://api.github.com/users/nertzy/followers","following_url":"https://api.github.com/users/nertzy/following{/other_user}","gists_url":"https://api.github.com/users/nertzy/gists{/gist_id}","starred_url":"https://api.github.com/users/nertzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nertzy/subscriptions","organizations_url":"https://api.github.com/users/nertzy/orgs","repos_url":"https://api.github.com/users/nertzy/repos","events_url":"https://api.github.com/users/nertzy/events{/privacy}","received_events_url":"https://api.github.com/users/nertzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-08-14T00:45:10Z","updated_at":"2020-08-14T00:45:10Z","body":"I think that the simplest thing would be to treat symbols and strings the same, and perhaps warn about that on the wiki page. \n\nI can't imagine anyone using a string and symbol in the same position in a job's arguments and actually performing different work.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/673778442/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nertzy","id":2488,"node_id":"MDQ6VXNlcjI0ODg=","avatar_url":"https://avatars.githubusercontent.com/u/2488?v=4","gravatar_id":"","url":"https://api.github.com/users/nertzy","html_url":"https://github.com/nertzy","followers_url":"https://api.github.com/users/nertzy/followers","following_url":"https://api.github.com/users/nertzy/following{/other_user}","gists_url":"https://api.github.com/users/nertzy/gists{/gist_id}","starred_url":"https://api.github.com/users/nertzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nertzy/subscriptions","organizations_url":"https://api.github.com/users/nertzy/orgs","repos_url":"https://api.github.com/users/nertzy/repos","events_url":"https://api.github.com/users/nertzy/events{/privacy}","received_events_url":"https://api.github.com/users/nertzy/received_events","type":"User","user_view_type":"public","site_admin":false}}]