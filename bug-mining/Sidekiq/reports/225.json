{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4016","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4016/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4016/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4016/events","html_url":"https://github.com/sidekiq/sidekiq/issues/4016","id":378165261,"node_id":"MDU6SXNzdWUzNzgxNjUyNjE=","number":4016,"title":"examples/leak.rb always fails on Job raised exception under Ruby 2.5.3","user":{"login":"deepj","id":33736,"node_id":"MDQ6VXNlcjMzNzM2","avatar_url":"https://avatars.githubusercontent.com/u/33736?v=4","gravatar_id":"","url":"https://api.github.com/users/deepj","html_url":"https://github.com/deepj","followers_url":"https://api.github.com/users/deepj/followers","following_url":"https://api.github.com/users/deepj/following{/other_user}","gists_url":"https://api.github.com/users/deepj/gists{/gist_id}","starred_url":"https://api.github.com/users/deepj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deepj/subscriptions","organizations_url":"https://api.github.com/users/deepj/orgs","repos_url":"https://api.github.com/users/deepj/repos","events_url":"https://api.github.com/users/deepj/events{/privacy}","received_events_url":"https://api.github.com/users/deepj/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2018-11-07T07:01:41Z","updated_at":"2018-11-13T18:02:46Z","closed_at":"2018-11-13T18:02:46Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Ruby version: Ruby 2.5.3\r\nRedis: 5.0.0\r\nSidekiq / Pro / Enterprise version(s): 5.2.3\r\n\r\n```\r\n$ sidekiq -r ./examples/leak.rb\r\n....\r\n2018-11-07T06:54:35.349Z 43821 TID-ousdl8iu9 MyWorker JID-a6b54978d4d2743f1292822c INFO: start\r\n2018-11-07T06:54:35.349Z 43821 TID-ousdl8iu9 MyWorker JID-a6b54978d4d2743f1292822c INFO: fail: 0.0 sec\r\n2018-11-07T06:54:35.349Z 43821 TID-ousdl8iu9 WARN: {\"context\":\"Job raised exception\",\"job\":{\"class\":\"MyWorker\",\"args\":[],\"retry\":true,\"queue\":\"default\",\"jid\":\"a6b54978d4d2743f1292822c\",\"created_at\":1541573584.210038,\"enqueued_at\":1541573675.348573,\"error_message\":\"exit\",\"error_class\":\"SystemExit\",\"failed_at\":1541573591.3404748,\"retry_count\":1,\"retried_at\":1541573614.9676511},\"jobstr\":\"{\\\"class\\\":\\\"MyWorker\\\",\\\"args\\\":[],\\\"retry\\\":true,\\\"queue\\\":\\\"default\\\",\\\"jid\\\":\\\"a6b54978d4d2743f1292822c\\\",\\\"created_at\\\":1541573584.210038,\\\"enqueued_at\\\":1541573675.348573,\\\"error_message\\\":\\\"exit\\\",\\\"error_class\\\":\\\"SystemExit\\\",\\\"failed_at\\\":1541573591.3404748,\\\"retry_count\\\":1,\\\"retried_at\\\":1541573614.9676511}\"}\r\n2018-11-07T06:54:35.349Z 43821 TID-ousdl8iu9 WARN: SystemExit: exit\r\n2018-11-07T06:54:35.349Z 43821 TID-ousdl8iu9 WARN: ~/dev/bugs/sidekiq/examples/leak.rb/leak.rb:21:in `exit'\r\n~/dev/bugs/sidekiq/examples/leak.rb:21:in `perform'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/processor.rb:185:in `execute_job'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/processor.rb:167:in `block (2 levels) in process'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/middleware/chain.rb:128:in `block in invoke'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/middleware/chain.rb:133:in `invoke'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/processor.rb:166:in `block in process'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/processor.rb:137:in `block (6 levels) in dispatch'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/job_retry.rb:108:in `local'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/processor.rb:136:in `block (5 levels) in dispatch'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq.rb:36:in `block in <module:Sidekiq>'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/processor.rb:132:in `block (4 levels) in dispatch'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/processor.rb:243:in `stats'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/processor.rb:127:in `block (3 levels) in dispatch'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/job_logger.rb:8:in `call'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/processor.rb:126:in `block (2 levels) in dispatch'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/job_retry.rb:73:in `global'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/processor.rb:125:in `block in dispatch'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/logging.rb:48:in `with_context'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/logging.rb:42:in `with_job_hash_context'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/processor.rb:124:in `dispatch'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/processor.rb:165:in `process'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/processor.rb:83:in `process_one'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/processor.rb:71:in `run'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/util.rb:16:in `watchdog'\r\n~/.gem/ruby/2.5.3/gems/sidekiq-5.2.3/lib/sidekiq/util.rb:25:in `block in safe_thread'\r\n```\r\n\r\nWhile testing Truffleruby and Sidekiq, I tried this example and I met with this issue. Truffleruby passed this ok. No issue wasn't occurred.","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4016/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4016/timeline","performed_via_github_app":null,"state_reason":"completed"}