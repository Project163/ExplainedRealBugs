[{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1712118867","html_url":"https://github.com/sidekiq/sidekiq/issues/6029#issuecomment-1712118867","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6029","id":1712118867,"node_id":"IC_kwDOADDA9M5mDNxT","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-08T19:16:34Z","updated_at":"2023-09-08T19:16:34Z","body":"Great idea. ðŸ‘‘\r\n\r\nWhat do you think about using the pattern `retry_for: 24.hours` and the Sidekiq::Client will convert that element into `retry_until: <timestamp>` when it pushes the job to Redis? The Retry subsystem will just return early if retry_until is in the past.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1712118867/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1712172674","html_url":"https://github.com/sidekiq/sidekiq/issues/6029#issuecomment-1712172674","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6029","id":1712172674,"node_id":"IC_kwDOADDA9M5mDa6C","user":{"login":"jjb","id":6097,"node_id":"MDQ6VXNlcjYwOTc=","avatar_url":"https://avatars.githubusercontent.com/u/6097?v=4","gravatar_id":"","url":"https://api.github.com/users/jjb","html_url":"https://github.com/jjb","followers_url":"https://api.github.com/users/jjb/followers","following_url":"https://api.github.com/users/jjb/following{/other_user}","gists_url":"https://api.github.com/users/jjb/gists{/gist_id}","starred_url":"https://api.github.com/users/jjb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjb/subscriptions","organizations_url":"https://api.github.com/users/jjb/orgs","repos_url":"https://api.github.com/users/jjb/repos","events_url":"https://api.github.com/users/jjb/events{/privacy}","received_events_url":"https://api.github.com/users/jjb/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-08T20:12:25Z","updated_at":"2023-09-08T20:12:40Z","body":"> What do you think about using the pattern\r\n\r\nthat sounds fine to me - is the implication that it also creates another feature, `retry_until`, which can be specified when queueing a job? `MyJob.perform_async(foo, bar, retry_until: 10.hours.from_now)`\r\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1712172674/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jjb","id":6097,"node_id":"MDQ6VXNlcjYwOTc=","avatar_url":"https://avatars.githubusercontent.com/u/6097?v=4","gravatar_id":"","url":"https://api.github.com/users/jjb","html_url":"https://github.com/jjb","followers_url":"https://api.github.com/users/jjb/followers","following_url":"https://api.github.com/users/jjb/following{/other_user}","gists_url":"https://api.github.com/users/jjb/gists{/gist_id}","starred_url":"https://api.github.com/users/jjb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjb/subscriptions","organizations_url":"https://api.github.com/users/jjb/orgs","repos_url":"https://api.github.com/users/jjb/repos","events_url":"https://api.github.com/users/jjb/events{/privacy}","received_events_url":"https://api.github.com/users/jjb/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1712182807","html_url":"https://github.com/sidekiq/sidekiq/issues/6029#issuecomment-1712182807","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6029","id":1712182807,"node_id":"IC_kwDOADDA9M5mDdYX","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-08T20:23:38Z","updated_at":"2023-09-08T20:23:38Z","body":"Well, I think that would be considered an implementation detail and not documented as an element you can rely on or pre-calculate yourself.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1712182807/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1712223843","html_url":"https://github.com/sidekiq/sidekiq/issues/6029#issuecomment-1712223843","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6029","id":1712223843,"node_id":"IC_kwDOADDA9M5mDnZj","user":{"login":"jjb","id":6097,"node_id":"MDQ6VXNlcjYwOTc=","avatar_url":"https://avatars.githubusercontent.com/u/6097?v=4","gravatar_id":"","url":"https://api.github.com/users/jjb","html_url":"https://github.com/jjb","followers_url":"https://api.github.com/users/jjb/followers","following_url":"https://api.github.com/users/jjb/following{/other_user}","gists_url":"https://api.github.com/users/jjb/gists{/gist_id}","starred_url":"https://api.github.com/users/jjb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjb/subscriptions","organizations_url":"https://api.github.com/users/jjb/orgs","repos_url":"https://api.github.com/users/jjb/repos","events_url":"https://api.github.com/users/jjb/events{/privacy}","received_events_url":"https://api.github.com/users/jjb/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-08T21:08:17Z","updated_at":"2023-09-08T21:08:17Z","body":"gotcha - in which case I don't have much opinion!","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1712223843/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jjb","id":6097,"node_id":"MDQ6VXNlcjYwOTc=","avatar_url":"https://avatars.githubusercontent.com/u/6097?v=4","gravatar_id":"","url":"https://api.github.com/users/jjb","html_url":"https://github.com/jjb","followers_url":"https://api.github.com/users/jjb/followers","following_url":"https://api.github.com/users/jjb/following{/other_user}","gists_url":"https://api.github.com/users/jjb/gists{/gist_id}","starred_url":"https://api.github.com/users/jjb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjb/subscriptions","organizations_url":"https://api.github.com/users/jjb/orgs","repos_url":"https://api.github.com/users/jjb/repos","events_url":"https://api.github.com/users/jjb/events{/privacy}","received_events_url":"https://api.github.com/users/jjb/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":10322816893,"node_id":"REFE_lADOADDA9M5wiwndzwAAAAJnSa99","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/10322816893","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"484c3cf51640aaf259591f32ef6301cb26f75196","commit_url":"https://api.github.com/repos/sidekiq/sidekiq/commits/484c3cf51640aaf259591f32ef6301cb26f75196","created_at":"2023-09-08T22:59:31Z","performed_via_github_app":null},{"id":10337053726,"node_id":"CE_lADOADDA9M5wiwndzwAAAAJoIuwe","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/10337053726","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"cb2c974f3db3a7c546ac86d6e187a00ae81cd665","commit_url":"https://api.github.com/repos/sidekiq/sidekiq/commits/cb2c974f3db3a7c546ac86d6e187a00ae81cd665","created_at":"2023-09-11T17:28:59Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"gpacuilla-st","id":146100581,"node_id":"U_kgDOCLVRZQ","avatar_url":"https://avatars.githubusercontent.com/u/146100581?v=4","gravatar_id":"","url":"https://api.github.com/users/gpacuilla-st","html_url":"https://github.com/gpacuilla-st","followers_url":"https://api.github.com/users/gpacuilla-st/followers","following_url":"https://api.github.com/users/gpacuilla-st/following{/other_user}","gists_url":"https://api.github.com/users/gpacuilla-st/gists{/gist_id}","starred_url":"https://api.github.com/users/gpacuilla-st/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gpacuilla-st/subscriptions","organizations_url":"https://api.github.com/users/gpacuilla-st/orgs","repos_url":"https://api.github.com/users/gpacuilla-st/repos","events_url":"https://api.github.com/users/gpacuilla-st/events{/privacy}","received_events_url":"https://api.github.com/users/gpacuilla-st/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-07T17:44:12Z","updated_at":"2023-12-07T17:44:12Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6130","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6130/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6130/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6130/events","html_url":"https://github.com/sidekiq/sidekiq/issues/6130","id":2031239880,"node_id":"I_kwDOADDA9M55EkLI","number":6130,"title":"ActionMailer::MailDeliveryJob does not play nice out of the box with the `retry_for` logic","user":{"login":"gpacuilla-st","id":146100581,"node_id":"U_kgDOCLVRZQ","avatar_url":"https://avatars.githubusercontent.com/u/146100581?v=4","gravatar_id":"","url":"https://api.github.com/users/gpacuilla-st","html_url":"https://github.com/gpacuilla-st","followers_url":"https://api.github.com/users/gpacuilla-st/followers","following_url":"https://api.github.com/users/gpacuilla-st/following{/other_user}","gists_url":"https://api.github.com/users/gpacuilla-st/gists{/gist_id}","starred_url":"https://api.github.com/users/gpacuilla-st/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gpacuilla-st/subscriptions","organizations_url":"https://api.github.com/users/gpacuilla-st/orgs","repos_url":"https://api.github.com/users/gpacuilla-st/repos","events_url":"https://api.github.com/users/gpacuilla-st/events{/privacy}","received_events_url":"https://api.github.com/users/gpacuilla-st/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-12-07T17:44:11Z","updated_at":"2023-12-07T18:07:18Z","closed_at":"2023-12-07T18:01:41Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Ruby version: 3.0.3\r\nRails version: 7.0.7\r\nSidekiq (basic gem): 7.1.3\r\n\r\nThis is related to:\r\nhttps://github.com/sidekiq/sidekiq/issues/6029\r\nhttps://github.com/sidekiq/sidekiq/issues/6030\r\n\r\nThe current implementation for `retry_for` appears to be breaking retry logic for at least `ActionMailer::MailDeliveryJob` by default.\r\n\r\nOur sidekiq config is minimal:\r\n\r\n```\r\n# server/config/initializers/sidekiq.rb\r\nSidekiq.configure_server do |config|\r\n  config.redis = { url: ENV.fetch('REDIS_URL', nil) }\r\nend\r\n\r\nSidekiq.configure_client do |config|\r\n  config.redis = { url: ENV.fetch('REDIS_URL', nil) }\r\nend\r\n```\r\n\r\nCurrently, these `ActionMailer::MailDeliveryJob` jobs are submitted as such by default:\r\n\r\n```\r\n# server/app/mailers/application_mailer.rb\r\nclass ApplicationMailer < ActionMailer::Base\r\n  default from: \"no-reply@#{URI(ENV.fetch('CLIENT_URL')).hostname}\"\r\n  layout 'mailer'\r\nend\r\n\r\n# server/app/mailers/test_mailer.rb\r\nclass TestMailer < ApplicationMailer\r\n  def email(to:)\r\n    mail(\r\n      to: to,\r\n      subject: 'Test Email',\r\n      body: 'This is a test email.',\r\n      content_type: 'text/html'\r\n    )\r\n  end\r\nend\r\n\r\n# Submitted job definition\r\n{\r\n  \"retry\": true,\r\n  \"queue\": \"default\",\r\n  \"class\": \"ActiveJob::QueueAdapters::SidekiqAdapter::JobWrapper\",\r\n  \"wrapped\": \"ActionMailer::MailDeliveryJob\",\r\n  \"args\": [\r\n    {\r\n      \"job_class\": \"ActionMailer::MailDeliveryJob\",\r\n      \"job_id\": \"e390da42-b48f-4b0b-81c0-cf31526fc180\",\r\n      \"provider_job_id\": null,\r\n      \"queue_name\": \"default\",\r\n      \"priority\": null,\r\n      \"arguments\": [\r\n        \"TestMailer\",\r\n        \"email\",\r\n        \"deliver_now\",\r\n        {\r\n          \"args\": [\r\n            {\r\n              \"to\": \"some@email.com\",\r\n              \"_aj_ruby2_keywords\": [\r\n                \"to\"\r\n              ]\r\n            }\r\n          ],\r\n          \"_aj_ruby2_keywords\": [\r\n            \"args\"\r\n          ]\r\n        }\r\n      ],\r\n      \"executions\": 0,\r\n      \"exception_executions\": {},\r\n      \"locale\": \"en\",\r\n      \"timezone\": \"Eastern Time (US & Canada)\",\r\n      \"enqueued_at\": \"2023-12-07T14:52:24Z\"\r\n    }\r\n  ],\r\n  \"jid\": \"fd32f63399bc781474b9eee2\",\r\n  \"retry_for\": 0,\r\n  \"created_at\": 1701960744.040795,\r\n  \"enqueued_at\": 1701960744.040907\r\n}\r\n```\r\n\r\nNote that `retry: true` - the problem here is with `retry_for: 0` - the current logic at https://github.com/sidekiq/sidekiq/blob/cb2c974f3db3a7c546ac86d6e187a00ae81cd665/lib/sidekiq/job_retry.rb#L175-L176 isn't properly accounting for `retry_for: 0` it seems:\r\n\r\n```\r\nirb(main):011> rf = 0\r\n=> 0\r\nirb(main):012* if rf then\r\nirb(main):013*   puts \"test\"\r\nirb(main):014> end\r\ntest\r\n```\r\n\r\nAnd of course `failed_at + 0` _should_ always be less than the current time - so what's happening is that failed jobs here are immediately sent to `retries_exhausted` -> `send_to_morgue` and therefor no retries ever occur until you manually retry jobs from the `Sidekiq::DeadSet` (`dead` queue)\r\n\r\nLogs after first and only attempt:\r\n\r\n```2023-12-06T15:13:05.109Z pid=1 tid=dwl class=ActionMailer::MailDeliveryJob jid=aeb6bba6f9e74b7d7599a35a INFO: Adding dead ActiveJob::QueueAdapters::SidekiqAdapter::JobWrapper job aeb6bba6f9e74b7d7599a35a```\r\n\r\n```2023-12-06T15:13:05.111Z pid=1 tid=dwl class=ActionMailer::MailDeliveryJob jid=aeb6bba6f9e74b7d7599a35a elapsed=0.688 INFO: fail```\r\n\r\n```2023-12-06T15:13:05.111Z pid=1 tid=dwl WARN: {\"context\":\"Job raised exception\",\"job\":{\"retry\":true,\"queue\":\"default\",\"class\":\"ActiveJob::QueueAdapters::SidekiqAdapter::JobWrapper\",\"wrapped\":\"ActionMailer::MailDeliveryJob\",...,\"executions\":0,\"exception_executions\":{},...,\"retry_for\":0,...}```\r\n\r\nThe fix I've come up with right now is to override the `delivery_job` to provide a real value for `retry_for`...\r\n\r\n```\r\n# server/app/jobs/mail_job.rb\r\nclass MailJob < ActionMailer::MailDeliveryJob\r\n  sidekiq_options retry_for: 48.hours\r\nend\r\n\r\n# server/app/mailers/test_mailer.rb\r\nclass TestMailer < ApplicationMailer\r\n  self.delivery_job = MailJob\r\n  def email(to:)\r\n    mail(\r\n      to: to,\r\n      subject: 'Test Email', \r\n      body: 'This is a test email.',\r\n      content_type: 'text/html'\r\n    )\r\n  end\r\nend\r\n```\r\n\r\nUsing that, the job does _not_ get shunted to `dead` queue immediately, and it properly retries with the default backoff logic.\r\n\r\nSomewhere the `retry_for` is being populated with `0` for `ActionMailer::MailDeliveryJob` by default which breaks retry logic.\r\n\r\nThis seems unintentional.","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6130/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6130/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":11730285824,"node_id":"REFE_lADOADDA9M5wiwndzwAAAAK7LfUA","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/11730285824","actor":{"login":"motchang","id":1159316,"node_id":"MDQ6VXNlcjExNTkzMTY=","avatar_url":"https://avatars.githubusercontent.com/u/1159316?v=4","gravatar_id":"","url":"https://api.github.com/users/motchang","html_url":"https://github.com/motchang","followers_url":"https://api.github.com/users/motchang/followers","following_url":"https://api.github.com/users/motchang/following{/other_user}","gists_url":"https://api.github.com/users/motchang/gists{/gist_id}","starred_url":"https://api.github.com/users/motchang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/motchang/subscriptions","organizations_url":"https://api.github.com/users/motchang/orgs","repos_url":"https://api.github.com/users/motchang/repos","events_url":"https://api.github.com/users/motchang/events{/privacy}","received_events_url":"https://api.github.com/users/motchang/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"cb2c974f3db3a7c546ac86d6e187a00ae81cd665","commit_url":"https://api.github.com/repos/motchang/sidekiq/commits/cb2c974f3db3a7c546ac86d6e187a00ae81cd665","created_at":"2024-02-07T10:21:27Z","performed_via_github_app":null}]