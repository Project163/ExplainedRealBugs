{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3207","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3207/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3207/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3207/events","html_url":"https://github.com/sidekiq/sidekiq/issues/3207","id":185585568,"node_id":"MDU6SXNzdWUxODU1ODU1Njg=","number":3207,"title":"Web UI broken since 4.2.0 (\"no route\" on 4.2.0, infinite loop on 4.2.3)","user":{"login":"davidstosik","id":816901,"node_id":"MDQ6VXNlcjgxNjkwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/816901?v=4","gravatar_id":"","url":"https://api.github.com/users/davidstosik","html_url":"https://github.com/davidstosik","followers_url":"https://api.github.com/users/davidstosik/followers","following_url":"https://api.github.com/users/davidstosik/following{/other_user}","gists_url":"https://api.github.com/users/davidstosik/gists{/gist_id}","starred_url":"https://api.github.com/users/davidstosik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidstosik/subscriptions","organizations_url":"https://api.github.com/users/davidstosik/orgs","repos_url":"https://api.github.com/users/davidstosik/repos","events_url":"https://api.github.com/users/davidstosik/events{/privacy}","received_events_url":"https://api.github.com/users/davidstosik/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2016-10-27T06:42:32Z","updated_at":"2016-11-04T03:42:57Z","closed_at":"2016-11-03T18:11:12Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Ruby version: 2.1.7p400\nSidekiq / Pro / Enterprise version(s): In the process of updating from 3.2.6 to 4.2.3, also tried 4.1.4 and 4.2.0 to confirm problem.\nRails version: 4.0.13\n\nHello,\n\nWe are in the process of updating Sidekiq on our app, from 3.2.6, where things seem to work correctly (at least Web UI works, Sidekiq consumes and runs jobs, etc).\n\nHere is the configuration we've been using so far:\n\n``` rb\n#config/routes.rb\nrequire 'sidekiq/web'\nMyApp::Application.routes.draw do\n  authenticate :user, lambda {|u| u.admin? } do\n    mount Sidekiq::Web => '/sidekiq'\n  end\n  #(...)\nend\n```\n\nWe're using Devise, and `User#admin?` is a custom method that checks a user's roles. (I just noticed that a logged out user will get redirected from `/sidekiq` to `/sidekiq/account/login`, but that was not a big deal for us).\n1. As recommended in the documentation, I first updated to the latest 3.x, checked for deprecation warnings, checked if Sidekiq was still working, then moved on to the next step.\n2. I updated Sidekiq to 4.2.3, then started to experience infinite redirect loops on `/sidekiq` and `/sidekiq/` (while I'm already logged in).\n3. I then tried to go back to Sidekiq 4.1.4 (and not other change in our previously working configuration). This time Web UI works properly.\n4. Just to confirm, I finally tried with Sidekiq 4.2.0, to experience a \"No route matches /sidekiq\" error message.\n5. I also tried, while on 4.2.3, to experiment with a few config options I grabbed here and there while looking for people having a similar redirect loop issue, but nothing worked.\n\nAs the changelog says to open an issue if the app stops working at 4.2.0, here I am!\n\nThanks for reading, and thank you in advance for your help.\n\nEdit: even on 4.1.4, if I'm logged out and try to access `/sidekiq`, I get into an infinite redirect loop.\n","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3207/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3207/timeline","performed_via_github_app":null,"state_reason":"completed"}