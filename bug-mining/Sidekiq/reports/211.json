{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3889","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3889/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3889/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3889/events","html_url":"https://github.com/sidekiq/sidekiq/issues/3889","id":341742511,"node_id":"MDU6SXNzdWUzNDE3NDI1MTE=","number":3889,"title":"Scheduled set not enqueueing due to large retry set","user":{"login":"sb8244","id":1231659,"node_id":"MDQ6VXNlcjEyMzE2NTk=","avatar_url":"https://avatars.githubusercontent.com/u/1231659?v=4","gravatar_id":"","url":"https://api.github.com/users/sb8244","html_url":"https://github.com/sb8244","followers_url":"https://api.github.com/users/sb8244/followers","following_url":"https://api.github.com/users/sb8244/following{/other_user}","gists_url":"https://api.github.com/users/sb8244/gists{/gist_id}","starred_url":"https://api.github.com/users/sb8244/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sb8244/subscriptions","organizations_url":"https://api.github.com/users/sb8244/orgs","repos_url":"https://api.github.com/users/sb8244/repos","events_url":"https://api.github.com/users/sb8244/events{/privacy}","received_events_url":"https://api.github.com/users/sb8244/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":23,"created_at":"2018-07-17T02:26:59Z","updated_at":"2018-07-20T17:48:48Z","closed_at":"2018-07-20T17:48:48Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Sidekiq / Pro / Enterprise version(s):\r\n\r\nSidekiq 4.2.10\r\nPro 3.5.0\r\n\r\nI have noticed a problem where my schedule set doesn't enqueue for 10-20 minutes, usually once per hour. I have whittled it down to the fact that retry/schedule happens in the same poller, and my retry set is quite large (>100k entries). My theory currently is that the retry enqueueing is taking quite a long time to operate, which is causing the scheduled enqueueing to be delayed by that much time.\r\n\r\nIs it possible for users of Sidekiq to separate the retry / schedule enqueueing into different actors? In this way, they could execute simultaneously rather than one after the other. I have checked 5.x vs 4.x but I do not see a difference.\r\n\r\nI looked at the option of putting the set order to `scheduled, retry` in the Enq class, but I think that this would not help because the retry enqueueing would still take the same amount of time and execute in the same thread as scheduled.\r\n\r\nI could also be wrong and this isn't related to the size of the retry set at all. The redis cluster isn't reacting negatively during it.","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3889/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3889/timeline","performed_via_github_app":null,"state_reason":"completed"}