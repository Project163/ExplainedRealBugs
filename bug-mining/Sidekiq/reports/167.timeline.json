[{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221366576","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-221366576","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":221366576,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTM2NjU3Ng==","user":{"login":"nateberkopec","id":845662,"node_id":"MDQ6VXNlcjg0NTY2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/845662?v=4","gravatar_id":"","url":"https://api.github.com/users/nateberkopec","html_url":"https://github.com/nateberkopec","followers_url":"https://api.github.com/users/nateberkopec/followers","following_url":"https://api.github.com/users/nateberkopec/following{/other_user}","gists_url":"https://api.github.com/users/nateberkopec/gists{/gist_id}","starred_url":"https://api.github.com/users/nateberkopec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nateberkopec/subscriptions","organizations_url":"https://api.github.com/users/nateberkopec/orgs","repos_url":"https://api.github.com/users/nateberkopec/repos","events_url":"https://api.github.com/users/nateberkopec/events{/privacy}","received_events_url":"https://api.github.com/users/nateberkopec/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-24T18:47:39Z","updated_at":"2016-05-24T21:35:04Z","body":"This strikes me as easier to solve with documentation than with code.\n\n``` yaml\n# config/sidekiq.yml\n---\n:concurrency: <%=  ENV['SIDEKIQ_THREADS']  %>\n```\n\nor\n\n```\nsidekiq -c $SIDEKIQ_THREADS\n```\n\nthen \n\n``` yaml\n# config/database.yml\n  pool: <%= ENV['SIDEKIQ_THREADS'] || ENV.fetch(\"RAILS_MAX_THREADS\") { 5 } %>\n```\n\nAll that would be required would be a change wiki docs, and maybe a nice announcement in that fancy Sidekiq Newsletter ;)\n\nedit: or just set `:concurrency` equal to `RAILS_MAX_THREADS`. either way.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221366576/reactions","total_count":12,"+1":12,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nateberkopec","id":845662,"node_id":"MDQ6VXNlcjg0NTY2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/845662?v=4","gravatar_id":"","url":"https://api.github.com/users/nateberkopec","html_url":"https://github.com/nateberkopec","followers_url":"https://api.github.com/users/nateberkopec/followers","following_url":"https://api.github.com/users/nateberkopec/following{/other_user}","gists_url":"https://api.github.com/users/nateberkopec/gists{/gist_id}","starred_url":"https://api.github.com/users/nateberkopec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nateberkopec/subscriptions","organizations_url":"https://api.github.com/users/nateberkopec/orgs","repos_url":"https://api.github.com/users/nateberkopec/repos","events_url":"https://api.github.com/users/nateberkopec/events{/privacy}","received_events_url":"https://api.github.com/users/nateberkopec/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221397983","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-221397983","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":221397983,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTM5Nzk4Mw==","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-24T20:54:02Z","updated_at":"2016-05-24T20:54:02Z","body":"Thanks for the video conference this morning, @schneems.\n\nI think having Sidekiq use this variable over the config settings is reasonable if it means the db pool will auto-size itself.  The logic would be something like:\n\n```\nENV['RAILS_MAX_THREADS'] = concurrency = ENV['RAILS_MAX_THREADS'] || -c || yml['concurrency']\n```\n\nProcfile would just need to be (some pretty nice symmetry here):\n\n```\nweb: RAILS_MAX_THREADS=5 bundle exec puma -e production\nworker: RAILS_MAX_THREADS=10 bundle exec sidekiq -e production\n```\n\nWDYT?\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221397983/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":670924424,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NjcwOTI0NDI0","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/670924424","actor":{"login":"schneems","id":59744,"node_id":"MDQ6VXNlcjU5NzQ0","avatar_url":"https://avatars.githubusercontent.com/u/59744?v=4","gravatar_id":"","url":"https://api.github.com/users/schneems","html_url":"https://github.com/schneems","followers_url":"https://api.github.com/users/schneems/followers","following_url":"https://api.github.com/users/schneems/following{/other_user}","gists_url":"https://api.github.com/users/schneems/gists{/gist_id}","starred_url":"https://api.github.com/users/schneems/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schneems/subscriptions","organizations_url":"https://api.github.com/users/schneems/orgs","repos_url":"https://api.github.com/users/schneems/repos","events_url":"https://api.github.com/users/schneems/events{/privacy}","received_events_url":"https://api.github.com/users/schneems/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2016-05-24T20:54:02Z","performed_via_github_app":null},{"id":670924425,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDY3MDkyNDQyNQ==","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/670924425","actor":{"login":"schneems","id":59744,"node_id":"MDQ6VXNlcjU5NzQ0","avatar_url":"https://avatars.githubusercontent.com/u/59744?v=4","gravatar_id":"","url":"https://api.github.com/users/schneems","html_url":"https://github.com/schneems","followers_url":"https://api.github.com/users/schneems/followers","following_url":"https://api.github.com/users/schneems/following{/other_user}","gists_url":"https://api.github.com/users/schneems/gists{/gist_id}","starred_url":"https://api.github.com/users/schneems/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schneems/subscriptions","organizations_url":"https://api.github.com/users/schneems/orgs","repos_url":"https://api.github.com/users/schneems/repos","events_url":"https://api.github.com/users/schneems/events{/privacy}","received_events_url":"https://api.github.com/users/schneems/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2016-05-24T20:54:02Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221408433","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-221408433","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":221408433,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTQwODQzMw==","user":{"login":"nateberkopec","id":845662,"node_id":"MDQ6VXNlcjg0NTY2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/845662?v=4","gravatar_id":"","url":"https://api.github.com/users/nateberkopec","html_url":"https://github.com/nateberkopec","followers_url":"https://api.github.com/users/nateberkopec/followers","following_url":"https://api.github.com/users/nateberkopec/following{/other_user}","gists_url":"https://api.github.com/users/nateberkopec/gists{/gist_id}","starred_url":"https://api.github.com/users/nateberkopec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nateberkopec/subscriptions","organizations_url":"https://api.github.com/users/nateberkopec/orgs","repos_url":"https://api.github.com/users/nateberkopec/repos","events_url":"https://api.github.com/users/nateberkopec/events{/privacy}","received_events_url":"https://api.github.com/users/nateberkopec/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-24T21:34:19Z","updated_at":"2016-05-24T21:34:19Z","body":"That Procfile does look very nice! \n\nIn production, I'll bet a lot of people are running with db pools that are too small for their Sidekiq concurrency anyway. If modifying `RAILS_MAX_THREADS` inside Sidekiq will fix that, then this change makes sense.\n\nWhat about non-AR ORMs? I've never really used them, though, so I don't know how they configure their connection pools. \n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221408433/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nateberkopec","id":845662,"node_id":"MDQ6VXNlcjg0NTY2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/845662?v=4","gravatar_id":"","url":"https://api.github.com/users/nateberkopec","html_url":"https://github.com/nateberkopec","followers_url":"https://api.github.com/users/nateberkopec/followers","following_url":"https://api.github.com/users/nateberkopec/following{/other_user}","gists_url":"https://api.github.com/users/nateberkopec/gists{/gist_id}","starred_url":"https://api.github.com/users/nateberkopec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nateberkopec/subscriptions","organizations_url":"https://api.github.com/users/nateberkopec/orgs","repos_url":"https://api.github.com/users/nateberkopec/repos","events_url":"https://api.github.com/users/nateberkopec/events{/privacy}","received_events_url":"https://api.github.com/users/nateberkopec/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221416561","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-221416561","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":221416561,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTQxNjU2MQ==","user":{"login":"schneems","id":59744,"node_id":"MDQ6VXNlcjU5NzQ0","avatar_url":"https://avatars.githubusercontent.com/u/59744?v=4","gravatar_id":"","url":"https://api.github.com/users/schneems","html_url":"https://github.com/schneems","followers_url":"https://api.github.com/users/schneems/followers","following_url":"https://api.github.com/users/schneems/following{/other_user}","gists_url":"https://api.github.com/users/schneems/gists{/gist_id}","starred_url":"https://api.github.com/users/schneems/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schneems/subscriptions","organizations_url":"https://api.github.com/users/schneems/orgs","repos_url":"https://api.github.com/users/schneems/repos","events_url":"https://api.github.com/users/schneems/events{/privacy}","received_events_url":"https://api.github.com/users/schneems/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-24T22:07:56Z","updated_at":"2016-05-24T22:07:56Z","body":"I'm not sure about the procfile solution, it would require you re-deploy after every change, which is a bad experience.\n\nMaybe something like this in `Procfile`:\n\n```\nworker: RAILS_MAX_THREADS=$SIDEKIQ_CONCURRENCY bundle exec sidekiq -e production\n```\n\nThen you could change `SIDEKIQ_CONCURRENCY` at will. \n\nIdeally I would like this to work out of the box without a custom procfile.\n\n@jeremyevans any thoughts on @nateberkopec's comment? Would be cool if Sequel could Just work (TM) with Rails 5 + Puma like Active Record. Happy to take that conversation to another thread if you want.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221416561/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"schneems","id":59744,"node_id":"MDQ6VXNlcjU5NzQ0","avatar_url":"https://avatars.githubusercontent.com/u/59744?v=4","gravatar_id":"","url":"https://api.github.com/users/schneems","html_url":"https://github.com/schneems","followers_url":"https://api.github.com/users/schneems/followers","following_url":"https://api.github.com/users/schneems/following{/other_user}","gists_url":"https://api.github.com/users/schneems/gists{/gist_id}","starred_url":"https://api.github.com/users/schneems/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schneems/subscriptions","organizations_url":"https://api.github.com/users/schneems/orgs","repos_url":"https://api.github.com/users/schneems/repos","events_url":"https://api.github.com/users/schneems/events{/privacy}","received_events_url":"https://api.github.com/users/schneems/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":671011894,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NjcxMDExODk0","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/671011894","actor":{"login":"jeremyevans","id":3846,"node_id":"MDQ6VXNlcjM4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/3846?v=4","gravatar_id":"","url":"https://api.github.com/users/jeremyevans","html_url":"https://github.com/jeremyevans","followers_url":"https://api.github.com/users/jeremyevans/followers","following_url":"https://api.github.com/users/jeremyevans/following{/other_user}","gists_url":"https://api.github.com/users/jeremyevans/gists{/gist_id}","starred_url":"https://api.github.com/users/jeremyevans/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeremyevans/subscriptions","organizations_url":"https://api.github.com/users/jeremyevans/orgs","repos_url":"https://api.github.com/users/jeremyevans/repos","events_url":"https://api.github.com/users/jeremyevans/events{/privacy}","received_events_url":"https://api.github.com/users/jeremyevans/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2016-05-24T22:07:56Z","performed_via_github_app":null},{"id":671011895,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDY3MTAxMTg5NQ==","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/671011895","actor":{"login":"jeremyevans","id":3846,"node_id":"MDQ6VXNlcjM4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/3846?v=4","gravatar_id":"","url":"https://api.github.com/users/jeremyevans","html_url":"https://github.com/jeremyevans","followers_url":"https://api.github.com/users/jeremyevans/followers","following_url":"https://api.github.com/users/jeremyevans/following{/other_user}","gists_url":"https://api.github.com/users/jeremyevans/gists{/gist_id}","starred_url":"https://api.github.com/users/jeremyevans/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeremyevans/subscriptions","organizations_url":"https://api.github.com/users/jeremyevans/orgs","repos_url":"https://api.github.com/users/jeremyevans/repos","events_url":"https://api.github.com/users/jeremyevans/events{/privacy}","received_events_url":"https://api.github.com/users/jeremyevans/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2016-05-24T22:07:56Z","performed_via_github_app":null},{"id":671011896,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50NjcxMDExODk2","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/671011896","actor":{"login":"nateberkopec","id":845662,"node_id":"MDQ6VXNlcjg0NTY2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/845662?v=4","gravatar_id":"","url":"https://api.github.com/users/nateberkopec","html_url":"https://github.com/nateberkopec","followers_url":"https://api.github.com/users/nateberkopec/followers","following_url":"https://api.github.com/users/nateberkopec/following{/other_user}","gists_url":"https://api.github.com/users/nateberkopec/gists{/gist_id}","starred_url":"https://api.github.com/users/nateberkopec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nateberkopec/subscriptions","organizations_url":"https://api.github.com/users/nateberkopec/orgs","repos_url":"https://api.github.com/users/nateberkopec/repos","events_url":"https://api.github.com/users/nateberkopec/events{/privacy}","received_events_url":"https://api.github.com/users/nateberkopec/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2016-05-24T22:07:56Z","performed_via_github_app":null},{"id":671011897,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDY3MTAxMTg5Nw==","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/671011897","actor":{"login":"nateberkopec","id":845662,"node_id":"MDQ6VXNlcjg0NTY2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/845662?v=4","gravatar_id":"","url":"https://api.github.com/users/nateberkopec","html_url":"https://github.com/nateberkopec","followers_url":"https://api.github.com/users/nateberkopec/followers","following_url":"https://api.github.com/users/nateberkopec/following{/other_user}","gists_url":"https://api.github.com/users/nateberkopec/gists{/gist_id}","starred_url":"https://api.github.com/users/nateberkopec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nateberkopec/subscriptions","organizations_url":"https://api.github.com/users/nateberkopec/orgs","repos_url":"https://api.github.com/users/nateberkopec/repos","events_url":"https://api.github.com/users/nateberkopec/events{/privacy}","received_events_url":"https://api.github.com/users/nateberkopec/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2016-05-24T22:07:56Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221428499","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-221428499","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":221428499,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTQyODQ5OQ==","user":{"login":"jeremyevans","id":3846,"node_id":"MDQ6VXNlcjM4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/3846?v=4","gravatar_id":"","url":"https://api.github.com/users/jeremyevans","html_url":"https://github.com/jeremyevans","followers_url":"https://api.github.com/users/jeremyevans/followers","following_url":"https://api.github.com/users/jeremyevans/following{/other_user}","gists_url":"https://api.github.com/users/jeremyevans/gists{/gist_id}","starred_url":"https://api.github.com/users/jeremyevans/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeremyevans/subscriptions","organizations_url":"https://api.github.com/users/jeremyevans/orgs","repos_url":"https://api.github.com/users/jeremyevans/repos","events_url":"https://api.github.com/users/jeremyevans/events{/privacy}","received_events_url":"https://api.github.com/users/jeremyevans/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-24T23:06:20Z","updated_at":"2016-05-24T23:06:20Z","body":"Sequel can usually work fine with a significantly smaller connection pool than ActiveRecord due to the fact that it doesn't leak connections.  That said, if someone wants to use the number of Sidekiq threads as the maximum number of Sequel database connections, they would just need to set use the `:max_connections=>Sidekiq.number_of_threads` Sequel::Database option.\n\nI'm against adding Rails-specific code to non-Rails-specific libraries as a matter of principle, just as I'm against adding Sequel-specific code to non-Sequel-specific libraries.  Giving special treatment to Rails gives Rails an unjust advantage and makes it more difficult for alternatives to Rails to compete on merit.  On the flipside, adding support for Rails, Sequel, ROM, Mongoid, etc. leads to a slippery slope.  \n\nIn generic terms, unless library A depends on library B (either directly or via an adapter for library B that ships with library A), I don't think library A should have library B-specific code.\n\nAs a matter of good engineering practices, I think libraries should never set environment variables.  I think reading library-specific environment variables is fine, but library A should not care about library B-specific environment variables.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221428499/reactions","total_count":14,"+1":13,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jeremyevans","id":3846,"node_id":"MDQ6VXNlcjM4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/3846?v=4","gravatar_id":"","url":"https://api.github.com/users/jeremyevans","html_url":"https://github.com/jeremyevans","followers_url":"https://api.github.com/users/jeremyevans/followers","following_url":"https://api.github.com/users/jeremyevans/following{/other_user}","gists_url":"https://api.github.com/users/jeremyevans/gists{/gist_id}","starred_url":"https://api.github.com/users/jeremyevans/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeremyevans/subscriptions","organizations_url":"https://api.github.com/users/jeremyevans/orgs","repos_url":"https://api.github.com/users/jeremyevans/repos","events_url":"https://api.github.com/users/jeremyevans/events{/privacy}","received_events_url":"https://api.github.com/users/jeremyevans/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221450360","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-221450360","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":221450360,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTQ1MDM2MA==","user":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-25T01:34:07Z","updated_at":"2016-05-25T01:34:07Z","body":">  due to the fact that it doesn't leak connections\n\nThat tends to help, yes. XD\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221450360/reactions","total_count":3,"+1":0,"-1":0,"laugh":3,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sgrif","id":1529387,"node_id":"MDQ6VXNlcjE1MjkzODc=","avatar_url":"https://avatars.githubusercontent.com/u/1529387?v=4","gravatar_id":"","url":"https://api.github.com/users/sgrif","html_url":"https://github.com/sgrif","followers_url":"https://api.github.com/users/sgrif/followers","following_url":"https://api.github.com/users/sgrif/following{/other_user}","gists_url":"https://api.github.com/users/sgrif/gists{/gist_id}","starred_url":"https://api.github.com/users/sgrif/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgrif/subscriptions","organizations_url":"https://api.github.com/users/sgrif/orgs","repos_url":"https://api.github.com/users/sgrif/repos","events_url":"https://api.github.com/users/sgrif/events{/privacy}","received_events_url":"https://api.github.com/users/sgrif/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221596447","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-221596447","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":221596447,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTU5NjQ0Nw==","user":{"login":"schneems","id":59744,"node_id":"MDQ6VXNlcjU5NzQ0","avatar_url":"https://avatars.githubusercontent.com/u/59744?v=4","gravatar_id":"","url":"https://api.github.com/users/schneems","html_url":"https://github.com/schneems","followers_url":"https://api.github.com/users/schneems/followers","following_url":"https://api.github.com/users/schneems/following{/other_user}","gists_url":"https://api.github.com/users/schneems/gists{/gist_id}","starred_url":"https://api.github.com/users/schneems/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schneems/subscriptions","organizations_url":"https://api.github.com/users/schneems/orgs","repos_url":"https://api.github.com/users/schneems/repos","events_url":"https://api.github.com/users/schneems/events{/privacy}","received_events_url":"https://api.github.com/users/schneems/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-25T14:37:17Z","updated_at":"2016-05-25T14:37:17Z","body":"Ideally I agree, pragmatically I disagree. There's lots of libraries that only serve to integrate with another library. For example devise. There are also the in-between libraries that bridge an ideologically pure library and something else, for example sprockets-rails adds the bridges needed to integrate the two libraries. In this case I actually wish that sprockets shipped with a railtie instead, yes it would add coupling but also decrease overall complexity in an end user's app. Right now sprockets-rails has to support Sprockets 2-4 which cause problems and lots of potentially unneeded flow control. \n\nMy gold standard is the end user's experience. If giving them the best possible experience doesn't introduce a huge maintenance burdeon on a library, I would consider doing it. I have some libaries that don't do authorization but need it, for that end I integrate with devise if it's available, however I also provide custom configuration endpoints. One example is oPRO https://github.com/opro/opro#custom-auth. This gives anyone using the currently number one auth library for Rails a drop in solution, but doesn't prevent anyone else from using it. \n\nIn the future if other libraries wanted to add support directly into oPRO, there is already a pattern to follow. If the maintenance burdeon got too large or there were too many people adding in support for their random library, then I would probably start pushing back and asking people to make bridge libraries like `opro-devise` etc. sort of like omniauth's strategies.\n\nKeep in mind that I make a living working for Heroku maintaining software whose core value proposition is that it is highly knowledgable and coupled to external software. Doing this isn't always the easiest or cleanest proposition, but sometimes it's needed to provide the absolutely best experience. Over time as standards develop hopefully others see that value and start using standard interfaces for example https://blog.heroku.com/archives/2016/5/2/container_ready_rails_5.\n\nOn the note of the unfair advantage, it wouldn't be an advantge if it wasn't beneficial for users. I feel it's fine to have each library maintainer make a call on a case by case basis. I agree that docs can do a lot for integrations, but there's a huge difference between \"1 step and it works\" to working out of the box. Ideally we would have standard interfaces across libraries, a good example of this is `DATABASE_URL` environment variable. It is supported by many ORMs and across multiple languages.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221596447/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"schneems","id":59744,"node_id":"MDQ6VXNlcjU5NzQ0","avatar_url":"https://avatars.githubusercontent.com/u/59744?v=4","gravatar_id":"","url":"https://api.github.com/users/schneems","html_url":"https://github.com/schneems","followers_url":"https://api.github.com/users/schneems/followers","following_url":"https://api.github.com/users/schneems/following{/other_user}","gists_url":"https://api.github.com/users/schneems/gists{/gist_id}","starred_url":"https://api.github.com/users/schneems/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schneems/subscriptions","organizations_url":"https://api.github.com/users/schneems/orgs","repos_url":"https://api.github.com/users/schneems/repos","events_url":"https://api.github.com/users/schneems/events{/privacy}","received_events_url":"https://api.github.com/users/schneems/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221607984","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-221607984","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":221607984,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTYwNzk4NA==","user":{"login":"jeremyevans","id":3846,"node_id":"MDQ6VXNlcjM4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/3846?v=4","gravatar_id":"","url":"https://api.github.com/users/jeremyevans","html_url":"https://github.com/jeremyevans","followers_url":"https://api.github.com/users/jeremyevans/followers","following_url":"https://api.github.com/users/jeremyevans/following{/other_user}","gists_url":"https://api.github.com/users/jeremyevans/gists{/gist_id}","starred_url":"https://api.github.com/users/jeremyevans/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeremyevans/subscriptions","organizations_url":"https://api.github.com/users/jeremyevans/orgs","repos_url":"https://api.github.com/users/jeremyevans/repos","events_url":"https://api.github.com/users/jeremyevans/events{/privacy}","received_events_url":"https://api.github.com/users/jeremyevans/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-25T15:12:38Z","updated_at":"2016-05-25T15:12:38Z","body":"If the point of the library is to integrate with one or more other libraries, then as I mentioned earlier, I think it's fine if the library has code specific to the other libraries.  That's not the case here, though.  If you want to integrate sidekiq with rails, that sounds like a good idea for a sidekiq-rails gem. If you want to ship such support with sidekiq, have it in a separate file that is not required by default (an adapter file).\n\nWhile the end-user experience is important, I don't believe it trumps good library design principles. I think it is fairly easy to understand that the philosophy of \"whatever is good for the majority is what we should do\", is harmful to the diversity of any ecosystem.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221607984/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jeremyevans","id":3846,"node_id":"MDQ6VXNlcjM4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/3846?v=4","gravatar_id":"","url":"https://api.github.com/users/jeremyevans","html_url":"https://github.com/jeremyevans","followers_url":"https://api.github.com/users/jeremyevans/followers","following_url":"https://api.github.com/users/jeremyevans/following{/other_user}","gists_url":"https://api.github.com/users/jeremyevans/gists{/gist_id}","starred_url":"https://api.github.com/users/jeremyevans/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeremyevans/subscriptions","organizations_url":"https://api.github.com/users/jeremyevans/orgs","repos_url":"https://api.github.com/users/jeremyevans/repos","events_url":"https://api.github.com/users/jeremyevans/events{/privacy}","received_events_url":"https://api.github.com/users/jeremyevans/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221628715","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-221628715","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":221628715,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTYyODcxNQ==","user":{"login":"nateberkopec","id":845662,"node_id":"MDQ6VXNlcjg0NTY2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/845662?v=4","gravatar_id":"","url":"https://api.github.com/users/nateberkopec","html_url":"https://github.com/nateberkopec","followers_url":"https://api.github.com/users/nateberkopec/followers","following_url":"https://api.github.com/users/nateberkopec/following{/other_user}","gists_url":"https://api.github.com/users/nateberkopec/gists{/gist_id}","starred_url":"https://api.github.com/users/nateberkopec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nateberkopec/subscriptions","organizations_url":"https://api.github.com/users/nateberkopec/orgs","repos_url":"https://api.github.com/users/nateberkopec/repos","events_url":"https://api.github.com/users/nateberkopec/events{/privacy}","received_events_url":"https://api.github.com/users/nateberkopec/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-25T16:20:39Z","updated_at":"2016-05-25T16:20:39Z","body":"> If you want to ship such support with sidekiq, have it in a separate file that is not required by default (an adapter file).\n\nThat's what a Railtie is? \n\n> As a matter of good engineering practices, I think libraries should never set environment variables. I think reading library-specific environment variables is fine, but library A should not care about library B-specific environment variables.\n\nThis point is far stronger, IMO. Setting an environment variable at runtime is kinda weird to begin with, then _overriding_ Rails' env variables from Sidekiq doubles that weirdness. My original proposed approach fixes that issue, with the downside of making it _not_ zero-config/plug-n-play for Rails users.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221628715/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"nateberkopec","id":845662,"node_id":"MDQ6VXNlcjg0NTY2Mg==","avatar_url":"https://avatars.githubusercontent.com/u/845662?v=4","gravatar_id":"","url":"https://api.github.com/users/nateberkopec","html_url":"https://github.com/nateberkopec","followers_url":"https://api.github.com/users/nateberkopec/followers","following_url":"https://api.github.com/users/nateberkopec/following{/other_user}","gists_url":"https://api.github.com/users/nateberkopec/gists{/gist_id}","starred_url":"https://api.github.com/users/nateberkopec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nateberkopec/subscriptions","organizations_url":"https://api.github.com/users/nateberkopec/orgs","repos_url":"https://api.github.com/users/nateberkopec/repos","events_url":"https://api.github.com/users/nateberkopec/events{/privacy}","received_events_url":"https://api.github.com/users/nateberkopec/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221638659","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-221638659","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":221638659,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMTYzODY1OQ==","user":{"login":"jeremyevans","id":3846,"node_id":"MDQ6VXNlcjM4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/3846?v=4","gravatar_id":"","url":"https://api.github.com/users/jeremyevans","html_url":"https://github.com/jeremyevans","followers_url":"https://api.github.com/users/jeremyevans/followers","following_url":"https://api.github.com/users/jeremyevans/following{/other_user}","gists_url":"https://api.github.com/users/jeremyevans/gists{/gist_id}","starred_url":"https://api.github.com/users/jeremyevans/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeremyevans/subscriptions","organizations_url":"https://api.github.com/users/jeremyevans/orgs","repos_url":"https://api.github.com/users/jeremyevans/repos","events_url":"https://api.github.com/users/jeremyevans/events{/privacy}","received_events_url":"https://api.github.com/users/jeremyevans/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-25T16:56:44Z","updated_at":"2016-05-25T16:56:44Z","body":"I don't think there is any problem if sidekiq ships a railtie, or has Rails-specific code in a Rails-specific file that sidekiq doesn't load by default (if Rails loads sidekiq's railtie by default, that's fine).  I think you only run into issues if you start doing things by default for the most popular library and not other competing alternatives.  For example, I would consider code like this to be a problem: https://github.com/phusion/passenger/blob/085504c2e00b6e6322bb0ec97aa5ff43d037c729/src/ruby_supportlib/phusion_passenger/loader_shared_helpers.rb#L381\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/221638659/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jeremyevans","id":3846,"node_id":"MDQ6VXNlcjM4NDY=","avatar_url":"https://avatars.githubusercontent.com/u/3846?v=4","gravatar_id":"","url":"https://api.github.com/users/jeremyevans","html_url":"https://github.com/jeremyevans","followers_url":"https://api.github.com/users/jeremyevans/followers","following_url":"https://api.github.com/users/jeremyevans/following{/other_user}","gists_url":"https://api.github.com/users/jeremyevans/gists{/gist_id}","starred_url":"https://api.github.com/users/jeremyevans/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeremyevans/subscriptions","organizations_url":"https://api.github.com/users/jeremyevans/orgs","repos_url":"https://api.github.com/users/jeremyevans/repos","events_url":"https://api.github.com/users/jeremyevans/events{/privacy}","received_events_url":"https://api.github.com/users/jeremyevans/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/222741529","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-222741529","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":222741529,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMjc0MTUyOQ==","user":{"login":"schneems","id":59744,"node_id":"MDQ6VXNlcjU5NzQ0","avatar_url":"https://avatars.githubusercontent.com/u/59744?v=4","gravatar_id":"","url":"https://api.github.com/users/schneems","html_url":"https://github.com/schneems","followers_url":"https://api.github.com/users/schneems/followers","following_url":"https://api.github.com/users/schneems/following{/other_user}","gists_url":"https://api.github.com/users/schneems/gists{/gist_id}","starred_url":"https://api.github.com/users/schneems/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schneems/subscriptions","organizations_url":"https://api.github.com/users/schneems/orgs","repos_url":"https://api.github.com/users/schneems/repos","events_url":"https://api.github.com/users/schneems/events{/privacy}","received_events_url":"https://api.github.com/users/schneems/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-05-31T16:21:48Z","updated_at":"2016-05-31T16:21:48Z","body":"First of all, thanks for all the discussion. The original issue was me throwing things to the wall to see what stuck. I appreciate your input.\n\nI never loved setting another library's env var.\n\nRight now we have two proposed solutions. Auto setting env var and through explicit procfile writing. In thinking about the two proposed solutions I think I have a middle of the road, hybrid solution.\n\nFirst a recap of the other solutions:\n\n### Auto Env Var\n\nHave sidekiq set the `RAILS_MAX_THREADS` env var on worker boot.\n- Pros:\n  - Works out of the box\n- Cons:\n  - Pretty close to [magic](https://blog.codeship.com/programming-magic/) of the darkest sorts, hard to debug or know what's going on.\n\n### Procfile\n\nDocument how to set the RAILS_MAX_THREADS in the procfile like\n\n```\nworker: RAILS_MAX_THREADS=$SIDEKIQ_CONCURRENCY bundle exec sidekiq -e production\n```\n- Pros:\n  - Explicit behavior: Not black magic\n- Cons:\n  - By default won't work out of the box, requires users to proactively search for docs or wait till a failure and investigate. That would be a bad experience.\n\n### Hybrid solution - Env var default and Procfile docs\n\nI think we should have docs on how to set the procfile:\n\n```\nworker: RAILS_MAX_THREADS=$SIDEKIQ_CONCURRENCY bundle exec sidekiq -e production\n```\n\nHowever we could also default Sidekiq's default number of threads to match Active Record's by default (do this in a Railtie perhaps). For example if a `RAILS_MAX_THREADS` is set and an explicit sidekiq concurrency level isn't specified use the RAILS_MAX_THREADS number instead of the sidekiq default.\n\nThis still buys us explicitness through documentation. It also buys us that \"just works\" out of the box experience. In that code run by Sidekiq won't try to check out more connections than AR has.\n\nThe downside is that this drastically reduces the number of default threads from 25 to 5. However if they're using the database while running sidekiq they're already artificially limited as only 5 jobs would be able to run at a time since the others will be blocked waiting on a connection. Basically you're limited by [amdahl's law](https://en.wikipedia.org/wiki/Amdahl%27s_law) anyway so it's not really a downside.\n\nIf you REALLY need all possible speed, you can't expect it from defaults, it's reasonable to expect people to look at docs (my opinion)\n\nWhat do you think?\n- Pros:\n  - Works out of the box\n  - No magic\n- Cons:\n  - Change in default behavior\n  - Fewer Sidekiq threads by default when used with Rails (could argue this is a pro).\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/222741529/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"schneems","id":59744,"node_id":"MDQ6VXNlcjU5NzQ0","avatar_url":"https://avatars.githubusercontent.com/u/59744?v=4","gravatar_id":"","url":"https://api.github.com/users/schneems","html_url":"https://github.com/schneems","followers_url":"https://api.github.com/users/schneems/followers","following_url":"https://api.github.com/users/schneems/following{/other_user}","gists_url":"https://api.github.com/users/schneems/gists{/gist_id}","starred_url":"https://api.github.com/users/schneems/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schneems/subscriptions","organizations_url":"https://api.github.com/users/schneems/orgs","repos_url":"https://api.github.com/users/schneems/repos","events_url":"https://api.github.com/users/schneems/events{/privacy}","received_events_url":"https://api.github.com/users/schneems/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/223619796","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-223619796","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":223619796,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMzYxOTc5Ng==","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-06-03T16:01:22Z","updated_at":"2016-06-03T16:01:22Z","body":"Thanks for all the input, folks.  I really have been reading and considering all of the things.  I like Jeremy's point that ENV vars should be considered read-only for libraries but Sidekiq is not a library, it's the top-level framework and the binary being run.  The user is configuring the Sidekiq process via command line parameters and so tuning various libraries within the Sidekiq process by auto-setting ENV vars **if not already set** is fair game.\n\nFor example, Sidekiq sets the RAILS_ENV and RACK_ENV variables based on the -e parameter.  I'm leaning toward -c mapping to RAILS_MAX_THREADS if not set.\n\nWith that logic, the 90% use case is the user sets `sidekiq -c 15` and Rails will configure a DB connection pool with 15 connections.  Exactly what we want.  They can run `RAILS_MAX_THREADS=10 sidekiq -c 15` if they want a smaller pool.\n\nThat naming seems silly though; IMO the `config/database.yml` entry should change to something like:\n\n```\npool: <%= ENV[\"DB_POOL_SIZE\"] || ENV[\"RAILS_MAX_THREADS\"] || 5 %>\n```\n\nto make the env vars more descriptive: `DB_POOL_SIZE=10 sidekiq -c 15`.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/223619796/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/223634263","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-223634263","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":223634263,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMzYzNDI2Mw==","user":{"login":"HoneyryderChuck","id":215707,"node_id":"MDQ6VXNlcjIxNTcwNw==","avatar_url":"https://avatars.githubusercontent.com/u/215707?v=4","gravatar_id":"","url":"https://api.github.com/users/HoneyryderChuck","html_url":"https://github.com/HoneyryderChuck","followers_url":"https://api.github.com/users/HoneyryderChuck/followers","following_url":"https://api.github.com/users/HoneyryderChuck/following{/other_user}","gists_url":"https://api.github.com/users/HoneyryderChuck/gists{/gist_id}","starred_url":"https://api.github.com/users/HoneyryderChuck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HoneyryderChuck/subscriptions","organizations_url":"https://api.github.com/users/HoneyryderChuck/orgs","repos_url":"https://api.github.com/users/HoneyryderChuck/repos","events_url":"https://api.github.com/users/HoneyryderChuck/events{/privacy}","received_events_url":"https://api.github.com/users/HoneyryderChuck/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-06-03T16:59:10Z","updated_at":"2016-06-03T16:59:22Z","body":"Why not just make the db connection pool size an active record configuration setter?\n\n``` ruby\n# config.application.rb, somewhere:\n\n  config.active_record.database_pool_size = ENV[\"CONCURRENCY\"]\n# another alternative for the foreman case\n  config.active_record.database_pool_size = ENV[\"RAILS_MAX_THREADS\"] || ENV[\"SIDEKIQ_POOL_SIZE\"] || 42\n```\n\nFrom what I understand, rails doesn't care about threads, is thread-safe, these are an application server / bj framework details. Why call it \"max threads\" when it's just the \"db pool size\" I want?\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/223634263/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HoneyryderChuck","id":215707,"node_id":"MDQ6VXNlcjIxNTcwNw==","avatar_url":"https://avatars.githubusercontent.com/u/215707?v=4","gravatar_id":"","url":"https://api.github.com/users/HoneyryderChuck","html_url":"https://github.com/HoneyryderChuck","followers_url":"https://api.github.com/users/HoneyryderChuck/followers","following_url":"https://api.github.com/users/HoneyryderChuck/following{/other_user}","gists_url":"https://api.github.com/users/HoneyryderChuck/gists{/gist_id}","starred_url":"https://api.github.com/users/HoneyryderChuck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HoneyryderChuck/subscriptions","organizations_url":"https://api.github.com/users/HoneyryderChuck/orgs","repos_url":"https://api.github.com/users/HoneyryderChuck/repos","events_url":"https://api.github.com/users/HoneyryderChuck/events{/privacy}","received_events_url":"https://api.github.com/users/HoneyryderChuck/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/223641868","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-223641868","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":223641868,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMzY0MTg2OA==","user":{"login":"schneems","id":59744,"node_id":"MDQ6VXNlcjU5NzQ0","avatar_url":"https://avatars.githubusercontent.com/u/59744?v=4","gravatar_id":"","url":"https://api.github.com/users/schneems","html_url":"https://github.com/schneems","followers_url":"https://api.github.com/users/schneems/followers","following_url":"https://api.github.com/users/schneems/following{/other_user}","gists_url":"https://api.github.com/users/schneems/gists{/gist_id}","starred_url":"https://api.github.com/users/schneems/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schneems/subscriptions","organizations_url":"https://api.github.com/users/schneems/orgs","repos_url":"https://api.github.com/users/schneems/repos","events_url":"https://api.github.com/users/schneems/events{/privacy}","received_events_url":"https://api.github.com/users/schneems/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-06-03T17:29:53Z","updated_at":"2016-06-03T17:29:53Z","body":"That's a tangential discussion. The problem we have with that approach would be now there are two canonical ways to set the pool size. What happens when you set via the config AND the database.yml? Who provides the canonical value? What if the ordering of your code loading changes? We ran into this problem by suggesting people set that value in Rails pre 4.1 see https://devcenter.heroku.com/articles/rails-database-connection-behavior#prior-to-rails-4-1. It was bad, causes confusion and would likely make things more confusing instead of less confusing.\n\nI would be all for getting rid of database.yml in favor of non-yml configuration entry points like you've suggested, however that's a discussion that's not really on the table.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/223641868/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"schneems","id":59744,"node_id":"MDQ6VXNlcjU5NzQ0","avatar_url":"https://avatars.githubusercontent.com/u/59744?v=4","gravatar_id":"","url":"https://api.github.com/users/schneems","html_url":"https://github.com/schneems","followers_url":"https://api.github.com/users/schneems/followers","following_url":"https://api.github.com/users/schneems/following{/other_user}","gists_url":"https://api.github.com/users/schneems/gists{/gist_id}","starred_url":"https://api.github.com/users/schneems/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schneems/subscriptions","organizations_url":"https://api.github.com/users/schneems/orgs","repos_url":"https://api.github.com/users/schneems/repos","events_url":"https://api.github.com/users/schneems/events{/privacy}","received_events_url":"https://api.github.com/users/schneems/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/223716734","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-223716734","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":223716734,"node_id":"MDEyOklzc3VlQ29tbWVudDIyMzcxNjczNA==","user":{"login":"HoneyryderChuck","id":215707,"node_id":"MDQ6VXNlcjIxNTcwNw==","avatar_url":"https://avatars.githubusercontent.com/u/215707?v=4","gravatar_id":"","url":"https://api.github.com/users/HoneyryderChuck","html_url":"https://github.com/HoneyryderChuck","followers_url":"https://api.github.com/users/HoneyryderChuck/followers","following_url":"https://api.github.com/users/HoneyryderChuck/following{/other_user}","gists_url":"https://api.github.com/users/HoneyryderChuck/gists{/gist_id}","starred_url":"https://api.github.com/users/HoneyryderChuck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HoneyryderChuck/subscriptions","organizations_url":"https://api.github.com/users/HoneyryderChuck/orgs","repos_url":"https://api.github.com/users/HoneyryderChuck/repos","events_url":"https://api.github.com/users/HoneyryderChuck/events{/privacy}","received_events_url":"https://api.github.com/users/HoneyryderChuck/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-06-03T23:17:37Z","updated_at":"2016-06-03T23:17:37Z","body":"I'd say that, if you take RAILS_MAX_THREADS as the highest priority (as rails does with DATABASE_URL(?)), you at least won't break backwards compatibility. and config would be the evangelized way (and in heroku you could just ignore the database.yml if pool is already set, which is yours and mine desired solution). But that's just me. I have a hard time seeing these suggested to stuff like sidekiq, which is a layer above rails, as the author suggested. Same as puma/passenger/unicorn/etc. If you make it configurable, as most of the libs are (I don't think devise relies on envvars, for example), you give freedom to the user, and it's not sidekiq's business anymore. It is indeed a breaking change from the link in heroku you sent, but suggesting that the framework should mitigate the lack of configuration in active record is unfair. \n\nAs for the author of sidekiq, I have a question: why is sidekiq handling RAILS_ENV and RACK_ENV? Why not SINATRA_ENV or UNICORN_ENV? There was a discussion before on the different meanings of these variables, and that not all of them correlate to one another. Why is sidekiq handling them then? From what I can get from a quick github search, it's used to require some expected rails project files, and all inside the cli.rb file, which is also loaded for non-rails. Isn't this an example of \"giving special treatment to rails\"? If you want to target rails, just `Rails.env if defined?(Rails)`, and you get 2 envvars less. In the same file, a quick search for `Rails` suggests me more tailor-made rails code. One suggestion: did you consider going the rack direction and load a config.sk by default? This way you could load environment.rb in rails, configure sidekiq server separately and other server-only configuration. Rails also ships its own custom config.ru for rack. \n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/223716734/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"HoneyryderChuck","id":215707,"node_id":"MDQ6VXNlcjIxNTcwNw==","avatar_url":"https://avatars.githubusercontent.com/u/215707?v=4","gravatar_id":"","url":"https://api.github.com/users/HoneyryderChuck","html_url":"https://github.com/HoneyryderChuck","followers_url":"https://api.github.com/users/HoneyryderChuck/followers","following_url":"https://api.github.com/users/HoneyryderChuck/following{/other_user}","gists_url":"https://api.github.com/users/HoneyryderChuck/gists{/gist_id}","starred_url":"https://api.github.com/users/HoneyryderChuck/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/HoneyryderChuck/subscriptions","organizations_url":"https://api.github.com/users/HoneyryderChuck/orgs","repos_url":"https://api.github.com/users/HoneyryderChuck/repos","events_url":"https://api.github.com/users/HoneyryderChuck/events{/privacy}","received_events_url":"https://api.github.com/users/HoneyryderChuck/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":741231460,"node_id":"MDExOkNsb3NlZEV2ZW50NzQxMjMxNDYw","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/741231460","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"52828e42123cc1c54b2a326bda5d00965ec05acb","commit_url":"https://api.github.com/repos/sidekiq/sidekiq/commits/52828e42123cc1c54b2a326bda5d00965ec05acb","created_at":"2016-08-01T16:33:18Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/236633798","html_url":"https://github.com/sidekiq/sidekiq/issues/2985#issuecomment-236633798","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/2985","id":236633798,"node_id":"MDEyOklzc3VlQ29tbWVudDIzNjYzMzc5OA==","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-08-01T16:33:27Z","updated_at":"2016-08-01T16:33:27Z","body":"How does that look?\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/236633798/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1385032926,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDEzODUwMzI5MjY=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/1385032926","actor":{"login":"jhjguxin","id":648566,"node_id":"MDQ6VXNlcjY0ODU2Ng==","avatar_url":"https://avatars.githubusercontent.com/u/648566?v=4","gravatar_id":"","url":"https://api.github.com/users/jhjguxin","html_url":"https://github.com/jhjguxin","followers_url":"https://api.github.com/users/jhjguxin/followers","following_url":"https://api.github.com/users/jhjguxin/following{/other_user}","gists_url":"https://api.github.com/users/jhjguxin/gists{/gist_id}","starred_url":"https://api.github.com/users/jhjguxin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhjguxin/subscriptions","organizations_url":"https://api.github.com/users/jhjguxin/orgs","repos_url":"https://api.github.com/users/jhjguxin/repos","events_url":"https://api.github.com/users/jhjguxin/events{/privacy}","received_events_url":"https://api.github.com/users/jhjguxin/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"84aa134667375d0040806859dff1305d701b70cb","commit_url":"https://api.github.com/repos/old-guys/nazgrel/commits/84aa134667375d0040806859dff1305d701b70cb","created_at":"2017-12-13T07:01:25Z","performed_via_github_app":null},{"id":1400719741,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDE0MDA3MTk3NDE=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/1400719741","actor":{"login":"sergiopantoja","id":2530982,"node_id":"MDQ6VXNlcjI1MzA5ODI=","avatar_url":"https://avatars.githubusercontent.com/u/2530982?v=4","gravatar_id":"","url":"https://api.github.com/users/sergiopantoja","html_url":"https://github.com/sergiopantoja","followers_url":"https://api.github.com/users/sergiopantoja/followers","following_url":"https://api.github.com/users/sergiopantoja/following{/other_user}","gists_url":"https://api.github.com/users/sergiopantoja/gists{/gist_id}","starred_url":"https://api.github.com/users/sergiopantoja/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sergiopantoja/subscriptions","organizations_url":"https://api.github.com/users/sergiopantoja/orgs","repos_url":"https://api.github.com/users/sergiopantoja/repos","events_url":"https://api.github.com/users/sergiopantoja/events{/privacy}","received_events_url":"https://api.github.com/users/sergiopantoja/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"f612ddc5e18a1babd2d67e39aefee43e6595ef5d","commit_url":"https://api.github.com/repos/builtbykaiser/vorsprung/commits/f612ddc5e18a1babd2d67e39aefee43e6595ef5d","created_at":"2017-12-24T20:51:11Z","performed_via_github_app":null},{"actor":{"login":"cupakromer","id":1524496,"node_id":"MDQ6VXNlcjE1MjQ0OTY=","avatar_url":"https://avatars.githubusercontent.com/u/1524496?v=4","gravatar_id":"","url":"https://api.github.com/users/cupakromer","html_url":"https://github.com/cupakromer","followers_url":"https://api.github.com/users/cupakromer/followers","following_url":"https://api.github.com/users/cupakromer/following{/other_user}","gists_url":"https://api.github.com/users/cupakromer/gists{/gist_id}","starred_url":"https://api.github.com/users/cupakromer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cupakromer/subscriptions","organizations_url":"https://api.github.com/users/cupakromer/orgs","repos_url":"https://api.github.com/users/cupakromer/repos","events_url":"https://api.github.com/users/cupakromer/events{/privacy}","received_events_url":"https://api.github.com/users/cupakromer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-03-27T19:15:25Z","updated_at":"2018-03-27T19:15:25Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3806","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3806/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3806/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3806/events","html_url":"https://github.com/sidekiq/sidekiq/issues/3806","id":309098346,"node_id":"MDU6SXNzdWUzMDkwOTgzNDY=","number":3806,"title":"`RAILS_MAX_THREADS` parity with Redis pool for client (i.e. Rails server)","user":{"login":"cupakromer","id":1524496,"node_id":"MDQ6VXNlcjE1MjQ0OTY=","avatar_url":"https://avatars.githubusercontent.com/u/1524496?v=4","gravatar_id":"","url":"https://api.github.com/users/cupakromer","html_url":"https://github.com/cupakromer","followers_url":"https://api.github.com/users/cupakromer/followers","following_url":"https://api.github.com/users/cupakromer/following{/other_user}","gists_url":"https://api.github.com/users/cupakromer/gists{/gist_id}","starred_url":"https://api.github.com/users/cupakromer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cupakromer/subscriptions","organizations_url":"https://api.github.com/users/cupakromer/orgs","repos_url":"https://api.github.com/users/cupakromer/repos","events_url":"https://api.github.com/users/cupakromer/events{/privacy}","received_events_url":"https://api.github.com/users/cupakromer/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2018-03-27T19:15:25Z","updated_at":"2018-03-27T22:46:58Z","closed_at":"2018-03-27T22:46:58Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Ruby version: 2.5.0\r\nRails: 5.1.5\r\nSidekiq / Pro / Enterprise version(s): Sidekiq 5.1.1\r\n\r\n## Issue\r\n\r\nIn Sidekiq 4.2.0 (issue #2985 implemented https://github.com/mperham/sidekiq/commit/52828e42123cc1c54b2a326bda5d00965ec05acb) the ability to use `RAILS_MAX_THREADS` was introduced to allow tuning of concurrency with the `RAILS_MAX_THREADS`. The problem is this only applies for the [Sidekiq server run via CLI](https://github.com/mperham/sidekiq/blob/60a41d3f36db25ff2bebade5bb516d38d4240b7b/lib/sidekiq/cli.rb#L243) (e.g. `worker: RAILS_MAX_THREADS=10 bundle exec sidekiq`), not the Rails server process (e.g. `web: bundle exec puma -C config/puma.rb`).\r\n\r\nWhen the Rails server is running the connection is often made to `Sidekiq::Client` (such as with [`ActiveJob::QueueAdapters::SidekiqAdapter`](https://github.com/rails/rails/blob/v5.1.5/activejob/lib/active_job/queue_adapters/sidekiq_adapter.rb#L20) which does not have a `redis_pool` yet. It then attempts to create one [defaulting to a pool size of 5](https://github.com/mperham/sidekiq/blob/60a41d3f36db25ff2bebade5bb516d38d4240b7b/lib/sidekiq/redis_connection.rb#L18).\r\n\r\n<details>\r\n<summary>Sample Rails `ActiveJob` Stack</summary>\r\n\r\n```\r\n.gem/ruby/2.5.0/gems/sidekiq-5.1.1/lib/sidekiq.rb:125:in `redis_pool'\r\n.gem/ruby/2.5.0/gems/sidekiq-5.1.1/lib/sidekiq/client.rb:42:in `initialize'\r\n.gem/ruby/2.5.0/gems/sidekiq-5.1.1/lib/sidekiq/client.rb:131:in `new'\r\n.gem/ruby/2.5.0/gems/sidekiq-5.1.1/lib/sidekiq/client.rb:131:in `push'\r\n.gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/queue_adapters/sidekiq_adapter.rb:20:in `enqueue'\r\n.gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/enqueuing.rb:51:in `block in enqueue'\r\n.gem/ruby/2.5.0/gems/activesupport-5.1.5/lib/active_support/callbacks.rb:108:in `block in run_callbacks'\r\n.gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/logging.rb:15:in `block (3 levels) in <module:Logging>'\r\n.gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/logging.rb:44:in `block in tag_logger'\r\n.gem/ruby/2.5.0/gems/activesupport-5.1.5/lib/active_support/tagged_logging.rb:69:in `block in tagged'\r\n.gem/ruby/2.5.0/gems/activesupport-5.1.5/lib/active_support/tagged_logging.rb:26:in `tagged'\r\n.gem/ruby/2.5.0/gems/activesupport-5.1.5/lib/active_support/tagged_logging.rb:69:in `tagged'\r\n.gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/logging.rb:44:in `tag_logger'\r\n.gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/logging.rb:14:in `block (2 levels) in <module:Logging>'\r\n.gem/ruby/2.5.0/gems/activesupport-5.1.5/lib/active_support/callbacks.rb:117:in `instance_exec'\r\n.gem/ruby/2.5.0/gems/activesupport-5.1.5/lib/active_support/callbacks.rb:117:in `block in run_callbacks'\r\n.gem/ruby/2.5.0/gems/activesupport-5.1.5/lib/active_support/callbacks.rb:135:in `run_callbacks'\r\n.gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/enqueuing.rb:47:in `enqueue'\r\n.gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/enqueuing.rb:18:in `perform_later'\r\n```\r\n\r\n</details>\r\n\r\n<br/>\r\n\r\nDepending on network speed, server load, job data size, and the `RAILS_MAX_THREADS` setting it's possible all of the Redis connections are in use resulting in a `Timeout::Error`.\r\n\r\n## Workaround\r\n\r\nUse an initializer to explicitly set the pool size:\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\n# See https://github.com/mperham/sidekiq/wiki/Using-Redis\r\nSidekiq.configure_client do |config|\r\n  # Without an explicit `size` here the pool will be set to 5\r\n  #\r\n  # See:\r\n  #   - https://github.com/mperham/sidekiq/blob/v5.1.1/lib/sidekiq/redis_connection.rb#L18\r\n  #   - https://github.com/mperham/sidekiq/blob/v5.1.1/lib/sidekiq/cli.rb#L244\r\n  config.redis = {\r\n    size: Integer(ENV.fetch(\"RAILS_MAX_THREADS\", 5)),\r\n  }\r\nend\r\n```\r\n\r\n## Proposed Solution\r\n\r\nI believe to resolve this the Redis pool creation needs similar logic to the CLI. I recognize this is complicated by the fact there is both a server and a client. I think the solution is something like the following, but I don't have enough knowledge of the Sidekiq internals to say for certain:\r\n\r\n```ruby\r\n# Sidekiq::RedisConnection.create (lib/sidekiq/redis_connection.rb#L18)\r\n# ...\r\n\r\nsize = if options[:size]\r\n         options[:size]\r\n       elsif Sidekiq.server?\r\n         Sidekiq.options[:concurrency] + 5\r\n       elsif ENV[\"RAILS_MAX_THREADS\"]\r\n         Integer(ENV[\"RAILS_MAX_THREADS\"])\r\n       else\r\n         5\r\n       end\r\n\r\nverify_sizing(size, Sidekiq.options[:concurrency]) if Sidekiq.server?\r\n\r\n# ...\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3806/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3806/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":1544375587,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDE1NDQzNzU1ODc=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/1544375587","actor":{"login":"cupakromer","id":1524496,"node_id":"MDQ6VXNlcjE1MjQ0OTY=","avatar_url":"https://avatars.githubusercontent.com/u/1524496?v=4","gravatar_id":"","url":"https://api.github.com/users/cupakromer","html_url":"https://github.com/cupakromer","followers_url":"https://api.github.com/users/cupakromer/followers","following_url":"https://api.github.com/users/cupakromer/following{/other_user}","gists_url":"https://api.github.com/users/cupakromer/gists{/gist_id}","starred_url":"https://api.github.com/users/cupakromer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cupakromer/subscriptions","organizations_url":"https://api.github.com/users/cupakromer/orgs","repos_url":"https://api.github.com/users/cupakromer/repos","events_url":"https://api.github.com/users/cupakromer/events{/privacy}","received_events_url":"https://api.github.com/users/cupakromer/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"e02484f61c8777eae35b4d6100afd63b3893e601","commit_url":"https://api.github.com/repos/cupakromer/sidekiq/commits/e02484f61c8777eae35b4d6100afd63b3893e601","created_at":"2018-03-27T22:32:53Z","performed_via_github_app":null},{"id":1544382571,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDE1NDQzODI1NzE=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/1544382571","actor":{"login":"cupakromer","id":1524496,"node_id":"MDQ6VXNlcjE1MjQ0OTY=","avatar_url":"https://avatars.githubusercontent.com/u/1524496?v=4","gravatar_id":"","url":"https://api.github.com/users/cupakromer","html_url":"https://github.com/cupakromer","followers_url":"https://api.github.com/users/cupakromer/followers","following_url":"https://api.github.com/users/cupakromer/following{/other_user}","gists_url":"https://api.github.com/users/cupakromer/gists{/gist_id}","starred_url":"https://api.github.com/users/cupakromer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cupakromer/subscriptions","organizations_url":"https://api.github.com/users/cupakromer/orgs","repos_url":"https://api.github.com/users/cupakromer/repos","events_url":"https://api.github.com/users/cupakromer/events{/privacy}","received_events_url":"https://api.github.com/users/cupakromer/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"d08766961690ca70409c0346bed0005f05a40ae7","commit_url":"https://api.github.com/repos/cupakromer/sidekiq/commits/d08766961690ca70409c0346bed0005f05a40ae7","created_at":"2018-03-27T22:38:21Z","performed_via_github_app":null},{"actor":{"login":"cupakromer","id":1524496,"node_id":"MDQ6VXNlcjE1MjQ0OTY=","avatar_url":"https://avatars.githubusercontent.com/u/1524496?v=4","gravatar_id":"","url":"https://api.github.com/users/cupakromer","html_url":"https://github.com/cupakromer","followers_url":"https://api.github.com/users/cupakromer/followers","following_url":"https://api.github.com/users/cupakromer/following{/other_user}","gists_url":"https://api.github.com/users/cupakromer/gists{/gist_id}","starred_url":"https://api.github.com/users/cupakromer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cupakromer/subscriptions","organizations_url":"https://api.github.com/users/cupakromer/orgs","repos_url":"https://api.github.com/users/cupakromer/repos","events_url":"https://api.github.com/users/cupakromer/events{/privacy}","received_events_url":"https://api.github.com/users/cupakromer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-03-27T22:39:49Z","updated_at":"2018-03-27T22:39:49Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3807","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3807/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3807/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3807/events","html_url":"https://github.com/sidekiq/sidekiq/pull/3807","id":309158998,"node_id":"MDExOlB1bGxSZXF1ZXN0MTc3ODg0NjQ2","number":3807,"title":"Use `RAILS_MAX_THREADS` for client pool size","user":{"login":"cupakromer","id":1524496,"node_id":"MDQ6VXNlcjE1MjQ0OTY=","avatar_url":"https://avatars.githubusercontent.com/u/1524496?v=4","gravatar_id":"","url":"https://api.github.com/users/cupakromer","html_url":"https://github.com/cupakromer","followers_url":"https://api.github.com/users/cupakromer/followers","following_url":"https://api.github.com/users/cupakromer/following{/other_user}","gists_url":"https://api.github.com/users/cupakromer/gists{/gist_id}","starred_url":"https://api.github.com/users/cupakromer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cupakromer/subscriptions","organizations_url":"https://api.github.com/users/cupakromer/orgs","repos_url":"https://api.github.com/users/cupakromer/repos","events_url":"https://api.github.com/users/cupakromer/events{/privacy}","received_events_url":"https://api.github.com/users/cupakromer/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2018-03-27T22:39:49Z","updated_at":"2018-03-27T23:01:32Z","closed_at":"2018-03-27T22:46:58Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/sidekiq/sidekiq/pulls/3807","html_url":"https://github.com/sidekiq/sidekiq/pull/3807","diff_url":"https://github.com/sidekiq/sidekiq/pull/3807.diff","patch_url":"https://github.com/sidekiq/sidekiq/pull/3807.patch","merged_at":"2018-03-27T22:46:58Z"},"body":"This is a follow up to #2985 (52828e4) adding similar support for the client connection pool. For Rails servers, Sidekiq is not loaded from the CLI so the prior change to support setting the concurrency via `RAILS_MAX_THREADS` is not applied to the web server process. This means for Rails servers which do not configure a custom size through an initializer they will run with the default connection pool size of 5.\r\n\r\nWhen the Rails server runs the initial Redis connection may be made through `Sidekiq::Client` (e.g. from [`ActiveJob::QueueAdapters::SidekiqAdapter`](https://github.com/rails/rails/blob/v5.1.5/activejob/lib/active_job/queue_adapters/sidekiq_adapter.rb#L20)). This causes the `redis_pool` to be initialized without any options, setting the pool size to the default of 5.\r\n\r\n    .gem/ruby/2.5.0/gems/sidekiq-5.1.1/lib/sidekiq.rb:125:in `redis_pool'\r\n    .gem/ruby/2.5.0/gems/sidekiq-5.1.1/lib/sidekiq/client.rb:42:in `initialize'\r\n    .gem/ruby/2.5.0/gems/sidekiq-5.1.1/lib/sidekiq/client.rb:131:in `new'\r\n    .gem/ruby/2.5.0/gems/sidekiq-5.1.1/lib/sidekiq/client.rb:131:in `push'\r\n    .gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/queue_adapters/sidekiq_adapter.rb:20:in `enqueue'\r\n    .gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/enqueuing.rb:51:in `block in enqueue'\r\n    .gem/ruby/2.5.0/gems/activesupport-5.1.5/lib/active_support/callbacks.rb:108:in `block in run_callbacks'\r\n    .gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/logging.rb:15:in `block (3 levels) in <module:Logging>'\r\n    .gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/logging.rb:44:in `block in tag_logger'\r\n    .gem/ruby/2.5.0/gems/activesupport-5.1.5/lib/active_support/tagged_logging.rb:69:in `block in tagged'\r\n    .gem/ruby/2.5.0/gems/activesupport-5.1.5/lib/active_support/tagged_logging.rb:26:in `tagged'\r\n    .gem/ruby/2.5.0/gems/activesupport-5.1.5/lib/active_support/tagged_logging.rb:69:in `tagged'\r\n    .gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/logging.rb:44:in `tag_logger'\r\n    .gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/logging.rb:14:in `block (2 levels) in <module:Logging>'\r\n    .gem/ruby/2.5.0/gems/activesupport-5.1.5/lib/active_support/callbacks.rb:117:in `instance_exec'\r\n    .gem/ruby/2.5.0/gems/activesupport-5.1.5/lib/active_support/callbacks.rb:117:in `block in run_callbacks'\r\n    .gem/ruby/2.5.0/gems/activesupport-5.1.5/lib/active_support/callbacks.rb:135:in `run_callbacks'\r\n    .gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/enqueuing.rb:47:in `enqueue'\r\n    .gem/ruby/2.5.0/gems/activejob-5.1.5/lib/active_job/enqueuing.rb:18:in `perform_later'\r\n\r\nFor the majority of cases, a client pool size of 5 is sufficient. However, servers which utilize a high number of threads, with large job payloads, and which may experience some network latency issues can see `Timeout::Error` crashes. This may be further exacerbated by the ~2-20x performance decrease through `ActiveJob` (#3782). Rails addresses this general type of connection issue for the main database by suggesting that the DB pool size match the number of threads running. This change applies that logic to the default client pool size by leveraging the same environment setting; this way there's a connection available per thread.\r\n\r\nThis may also have the side effect of a slight performance boost, as there is less of a chance that threads will be blocked waiting on connections. The trade-off is that there may be a memory profile increase to handle the additional Redis connections in the pool; note the pool only creates new connections as necessary to handle the requests.\r\n\r\nResolves #3806","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3807/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3807/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":1544394271,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDE1NDQzOTQyNzE=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/1544394271","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"b23c0ecf8ea18a6547d40fb9fe3b92eceed8107f","commit_url":"https://api.github.com/repos/sidekiq/sidekiq/commits/b23c0ecf8ea18a6547d40fb9fe3b92eceed8107f","created_at":"2018-03-27T22:46:59Z","performed_via_github_app":null}]