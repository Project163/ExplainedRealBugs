{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5184","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5184/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5184/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5184/events","html_url":"https://github.com/sidekiq/sidekiq/issues/5184","id":1124982084,"node_id":"I_kwDOADDA9M5DDd1E","number":5184,"title":"Web UI event listeners disappear after page update when live polling is enabled","user":{"login":"gillisd","id":7614771,"node_id":"MDQ6VXNlcjc2MTQ3NzE=","avatar_url":"https://avatars.githubusercontent.com/u/7614771?v=4","gravatar_id":"","url":"https://api.github.com/users/gillisd","html_url":"https://github.com/gillisd","followers_url":"https://api.github.com/users/gillisd/followers","following_url":"https://api.github.com/users/gillisd/following{/other_user}","gists_url":"https://api.github.com/users/gillisd/gists{/gist_id}","starred_url":"https://api.github.com/users/gillisd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gillisd/subscriptions","organizations_url":"https://api.github.com/users/gillisd/orgs","repos_url":"https://api.github.com/users/gillisd/repos","events_url":"https://api.github.com/users/gillisd/events{/privacy}","received_events_url":"https://api.github.com/users/gillisd/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2022-02-05T17:09:06Z","updated_at":"2022-03-04T23:25:36Z","closed_at":"2022-03-04T17:35:02Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Ruby version: 2.7.5\r\nRails version: 5.2.5\r\nSidekiq / Pro / Enterprise version(s): 6.3.1 / 5.2.0\r\n\r\n## Problem\r\n\r\nWhen live poll is enabled in the web UI with an interval of `n` seconds, the following occur after `n` seconds have passed:\r\n\r\n1. Confirmation to delete a queue is non-existent\r\n2. Select all functionality is broken\r\n3. Search functionality in retry queue is broken\r\n\r\nUnfortunately, due to (1), a large job queue was deleted after someone accidentally clicked the delete button next to the queue. The confirmation message never appeared, as the web UI was in \"live poll\" mode, and the polling interval had passed.\r\n\r\nI don't really care about (2) or (3), as they work fine when not in \"live poll\" mode, but I think (1) is a pretty serious issue, especially because the delete and pause buttons are so close together.\r\n\r\n## Cause\r\n\r\nWhen live polling is enabled, the following callback is triggered:\r\n\r\n```javascript\r\nfunction livePollCallback() {\r\n  clearTimeout(livePollTimer);\r\n\r\n  fetch(window.location.href).then(resp => resp.text()).then(replacePage).finally(scheduleLivePoll)\r\n}\r\n```\r\n\r\n`replacePage` is called, causing all event listeners created in `ready(() => {` to be wiped out, and I don't see them being reinitialized.\r\n\r\n---\r\n\r\nP.S. thank you for making this software, it has enabled a very small team able to process billions of jobs each year!\r\n","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5184/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5184/timeline","performed_via_github_app":null,"state_reason":"completed"}