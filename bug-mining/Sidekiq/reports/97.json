{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1636","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1636/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1636/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1636/events","html_url":"https://github.com/sidekiq/sidekiq/issues/1636","id":30924464,"node_id":"MDU6SXNzdWUzMDkyNDQ2NA==","number":1636,"title":"Sidekiq 3.0 crashes on startup with Rubinius 2.2.6","user":{"login":"umito","id":4717531,"node_id":"MDQ6VXNlcjQ3MTc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/4717531?v=4","gravatar_id":"","url":"https://api.github.com/users/umito","html_url":"https://github.com/umito","followers_url":"https://api.github.com/users/umito/followers","following_url":"https://api.github.com/users/umito/following{/other_user}","gists_url":"https://api.github.com/users/umito/gists{/gist_id}","starred_url":"https://api.github.com/users/umito/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/umito/subscriptions","organizations_url":"https://api.github.com/users/umito/orgs","repos_url":"https://api.github.com/users/umito/repos","events_url":"https://api.github.com/users/umito/events{/privacy}","received_events_url":"https://api.github.com/users/umito/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2014-04-05T21:28:58Z","updated_at":"2014-05-15T23:36:43Z","closed_at":"2014-04-05T21:42:13Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We are using Sidekiq to process items. Currently running on MRI 2.1. We use a single worker process, because the jobs are extremely oriented at database modifications in large batches and we haven't really looked at doing that properly with multiple workers.\n\nI have been researching if Sidekiq can perform faster for our setup and tried JRuby 1.7, but it was actually 50% slower then MRI 2.1. Now I wanted to see how Rubinius fares, but it turns out that sidekiq 3.0 just crashes on Rubinius 2.2.6. I tried running the latest Sidekiq 2.x version, and that one works without problems.\n\nI think it's probably a Rubinius issue, so will open one up there, but I thought it's good to know.\n\n```\nrbx -S bundle exec sidekiq -e production \nError trying to compile /opt/rubinius/gems/gems/sidekiq-3.0.0/lib/sidekiq/manager.rb\n/opt/rubinius/runtime/gems/rubinius-compiler-2.1.0/lib/rubinius/compiler/compiler.rbc:13:in `compiler_error'\n/opt/rubinius/runtime/gems/rubinius-compiler-2.1.0/lib/rubinius/compiler/compiler.rbc:95:in `compile'\nkernel/delta/code_loader.rb:217:in `compile_file'\nkernel/delta/code_loader.rb:190:in `load_file'\nkernel/common/code_loader.rb:128:in `require'\nkernel/common/code_loader.rb:237:in `require'\nkernel/common/kernel.rb:705:in `require'\n/opt/rubinius/gems/gems/sidekiq-3.0.0/lib/sidekiq/cli.rb:146:in `load_celluloid'\n/opt/rubinius/gems/gems/sidekiq-3.0.0/lib/sidekiq/cli.rb:41:in `parse'\n/opt/rubinius/gems/gems/sidekiq-3.0.0/bin/sidekiq:7:in `__script__'\nkernel/common/kernel.rb:447:in `load'\n/opt/rubinius/gems/bin/sidekiq:23:in `__script__'\nkernel/delta/code_loader.rb:66:in `load_script'\nkernel/delta/code_loader.rb:152:in `load_script'\nkernel/loader.rb:649:in `script'\nkernel/loader.rb:831:in `main' \n```\n\nAnother output with some more detail, but I am not sure if this is caused by improper setup/gem loading. This one is only on server, not on dev machine. The other one both on server and dev machine with RVM.\n\n```\nsidekiq\nError trying to compile /opt/rubinius/gems/gems/sidekiq-3.0.0/lib/sidekiq/manager.rb\n/opt/rubinius/runtime/gems/rubinius-compiler-2.1.0/lib/rubinius/compiler/compiler.rbc:13:in `compiler_error'\n/opt/rubinius/runtime/gems/rubinius-compiler-2.1.0/lib/rubinius/compiler/compiler.rbc:95:in `compile'\nkernel/delta/code_loader.rb:217:in `compile_file'\nkernel/delta/code_loader.rb:190:in `load_file'\nkernel/common/code_loader.rb:128:in `require'\nkernel/common/code_loader.rb:237:in `require'\nkernel/common/kernel.rb:705:in `gem_original_require (require)'\n/opt/rubinius/library/rubygems/core_ext/kernel_require.rb:55:in `require'\n/opt/rubinius/gems/gems/sidekiq-3.0.0/lib/sidekiq/cli.rb:146:in `load_celluloid'\n/opt/rubinius/gems/gems/sidekiq-3.0.0/lib/sidekiq/cli.rb:41:in `parse'\n/opt/rubinius/gems/gems/sidekiq-3.0.0/bin/sidekiq:7:in `__script__'\nkernel/common/kernel.rb:447:in `load'\n/usr/local/bin/sidekiq:23:in `__script__'\nkernel/delta/code_loader.rb:66:in `load_script'\nkernel/delta/code_loader.rb:152:in `load_script'\nkernel/loader.rb:649:in `script'\nkernel/loader.rb:831:in `main'\nAn exception occurred running at_exit handlers\n\n    Missing or uninitialized constant: Sidekiq::CLI::FileUtils (NameError)\n\nBacktrace:\n\n    Module(Class)#const_missing at kernel/common/module.rb:667\n  { } in Sidekiq::CLI#write_pid at /opt/rubinius/gems/gems/sidekiq-3.0.0/lib/sidekiq/cli.rb:326\n                      Proc#call at kernel/bootstrap/proc.rb:20\n  Rubinius::Loader#run_at_exits at kernel/loader.rb:710\n      Rubinius::Loader#epilogue at kernel/loader.rb:730\n          Rubinius::Loader#main at kernel/loader.rb:837 \n```\n\nIs `Sidekiq::CLI::FileUtils` maybe used in such a way that Rubinius can't handle it? \n","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1636/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1636/timeline","performed_via_github_app":null,"state_reason":"completed"}