{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4440","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4440/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4440/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4440/events","html_url":"https://github.com/sidekiq/sidekiq/issues/4440","id":557036506,"node_id":"MDU6SXNzdWU1NTcwMzY1MDY=","number":4440,"title":"Truncated response body using Sidekiq dashboard w/New Relic","user":{"login":"pelargir","id":3756,"node_id":"MDQ6VXNlcjM3NTY=","avatar_url":"https://avatars.githubusercontent.com/u/3756?v=4","gravatar_id":"","url":"https://api.github.com/users/pelargir","html_url":"https://github.com/pelargir","followers_url":"https://api.github.com/users/pelargir/followers","following_url":"https://api.github.com/users/pelargir/following{/other_user}","gists_url":"https://api.github.com/users/pelargir/gists{/gist_id}","starred_url":"https://api.github.com/users/pelargir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pelargir/subscriptions","organizations_url":"https://api.github.com/users/pelargir/orgs","repos_url":"https://api.github.com/users/pelargir/repos","events_url":"https://api.github.com/users/pelargir/events{/privacy}","received_events_url":"https://api.github.com/users/pelargir/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":21,"created_at":"2020-01-29T18:23:42Z","updated_at":"2020-10-23T19:06:49Z","closed_at":"2020-01-30T16:53:11Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Ruby version: 2.6.5p114\r\nSidekiq / Pro / Enterprise version(s): 6.0.4\r\n\r\nWe're using newrelic_rpm 6.8.0.360 to add JavaScript instrumentation to our Rails 5.2.4.1 app. After upgrading to Rack 2.1.2 the dashboard went blank. Viewing the page source, the HTML stops in the middle of the New Relic JS code near the top of the page (see screenshot).\r\n\r\nApparently, Rack::Response no longer overwrites the Content-Length header, which means an incorrectly configured Content-Length header is now exposed. See https://github.com/rack/rack/issues/1520#issuecomment-579838704\r\n\r\nIs it possible Sidekiq is setting Content-Length prior to New Relic adding its instrumentation, resulting in an incomplete page load since the New Relic code takes up the entire Content-Length before the remaining body can be sent?\r\n\r\nAs soon as I remove New Relic from our app the dashboard starts working again.\r\n\r\n![view-source_https___www_candlescience_com_admin_sidekiq](https://user-images.githubusercontent.com/3756/73385068-772c2500-429a-11ea-8406-8bfa85596b5e.png)","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4440/reactions","total_count":13,"+1":13,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/4440/timeline","performed_via_github_app":null,"state_reason":"completed"}