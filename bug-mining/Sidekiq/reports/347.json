{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6699","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6699/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6699/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6699/events","html_url":"https://github.com/sidekiq/sidekiq/issues/6699","id":3052832167,"node_id":"I_kwDOADDA9M619oWn","number":6699,"title":"Document change to `Sidekiq::Web.authorize` in v8","user":{"login":"johnnymo87","id":3466499,"node_id":"MDQ6VXNlcjM0NjY0OTk=","avatar_url":"https://avatars.githubusercontent.com/u/3466499?v=4","gravatar_id":"","url":"https://api.github.com/users/johnnymo87","html_url":"https://github.com/johnnymo87","followers_url":"https://api.github.com/users/johnnymo87/followers","following_url":"https://api.github.com/users/johnnymo87/following{/other_user}","gists_url":"https://api.github.com/users/johnnymo87/gists{/gist_id}","starred_url":"https://api.github.com/users/johnnymo87/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/johnnymo87/subscriptions","organizations_url":"https://api.github.com/users/johnnymo87/orgs","repos_url":"https://api.github.com/users/johnnymo87/repos","events_url":"https://api.github.com/users/johnnymo87/events{/privacy}","received_events_url":"https://api.github.com/users/johnnymo87/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2025-05-09T17:51:30Z","updated_at":"2025-05-12T15:41:49Z","closed_at":"2025-05-12T15:41:49Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Ruby version: 3.2.2\nRails version: 7.2.0\nSidekiq / Pro / Enterprise version(s): 8.0.1\n\n[The docs](https://github.com/sidekiq/sidekiq/wiki/Ent-Web-UI) for how to do authorizations on Sidekiq Ent UI say that we should do this in `config/routes.rb`\n\n```rb\nSidekiq::Web.authorize do |env,method,path|\n  # Elided\nend\n```\n\nBut with v8, I believe this has been changed to something along these lines:\n\n```rb\nSidekiq::Web.configure do |config|\n  config.authorize do |env, _method, _path|\n    # Elided\n  end\nend\n```\n\nCould we update the documentation to reflect this API change?\n\n---\n\nconfig/initializers/sidekiq.rb\n```rb\n# frozen_string_literal: true\n\nRails.application.reloader.to_prepare do # rubocop:disable Metrics/BlockLength\n  # Disable uniqueness in testing, this has the potential to cause much head scratching...\n  Sidekiq::Enterprise.unique! unless Rails.env.test?\n\n  # Only enqueue jobs once the transaction has been committed.\n  Sidekiq.transactional_push!\n\n  # We define the jobs outside of the .configure_server to catch missing class issues.\n  perodic_jobs = [\n    # ELIDED\n  ].freeze\n\n  staging_only_jobs = [\n    # ELIDED\n  ]\n\n  production_only_jobs = [\n    # ELIDED\n  ].freeze\n\n  Sidekiq.configure_server do |config|\n    config.logger.level = Logger::INFO\n    config.periodic do |cron|\n      perodic_jobs.each do |job|\n        cron.register(*job)\n      end\n\n      if Rails.env.production?\n        production_only_jobs.each do |job|\n          cron.register(*job)\n        end\n      elsif Rails.env.staging?\n        staging_only_jobs.each do |job|\n          cron.register(*job)\n        end\n      end\n    end\n\n    config.server_middleware do |chain|\n      chain.add Broth::Instrumentation::Sidekiq\n    end\n  end\nend\n```\n\nError\n```\nNoMethodError: undefined method `authorize' for class Sidekiq::Web (NoMethodError)\n\n  Sidekiq::Web.authorize do |env, _method, _path|\n              ^^^^^^^^^^\n\n/opt/culinary-operations-server/config/routes.rb:252:in `block in <top (required)>'\n/usr/local/bundle/gems/actionpack-7.2.2.1/lib/action_dispatch/routing/route_set.rb:467:in `instance_exec'\n/usr/local/bundle/gems/actionpack-7.2.2.1/lib/action_dispatch/routing/route_set.rb:467:in `eval_block'\n/usr/local/bundle/gems/actionpack-7.2.2.1/lib/action_dispatch/routing/route_set.rb:449:in `draw'\n/opt/culinary-operations-server/config/routes.rb:3:in `<top (required)>'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/application/routes_reloader.rb:50:in `load'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/application/routes_reloader.rb:50:in `block in load_paths'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/application/routes_reloader.rb:50:in `each'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/application/routes_reloader.rb:50:in `load_paths'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/application/routes_reloader.rb:24:in `reload!'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/application/routes_reloader.rb:38:in `block in updater'\n/usr/local/bundle/gems/activesupport-7.2.2.1/lib/active_support/file_update_checker.rb:85:in `execute'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/application/routes_reloader.rb:13:in `execute'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/application/finisher.rb:162:in `block in <module:Finisher>'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/initializable.rb:32:in `instance_exec'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/initializable.rb:32:in `run'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/initializable.rb:61:in `block in run_initializers'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/initializable.rb:60:in `run_initializers'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/application.rb:435:in `initialize!'\n/opt/culinary-operations-server/config/environment.rb:5:in `<top (required)>'\n/usr/local/bundle/gems/zeitwerk-2.7.2/lib/zeitwerk/core_ext/kernel.rb:34:in `require'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/application.rb:411:in `require_environment!'\n/usr/local/bundle/gems/railties-7.2.2.1/lib/rails/application.rb:559:in `block in run_tasks_blocks'\n/usr/local/bundle/gems/sprockets-rails-3.5.2/lib/sprockets/rails/task.rb:61:in `block (2 levels) in define'\n/usr/local/bundle/gems/rake-13.2.1/exe/rake:27:in `<top (required)>'\n/usr/local/bundle/gems/bundler-2.5.6/lib/bundler/cli/exec.rb:58:in `load'\n/usr/local/bundle/gems/bundler-2.5.6/lib/bundler/cli/exec.rb:58:in `kernel_load'\n/usr/local/bundle/gems/bundler-2.5.6/lib/bundler/cli/exec.rb:23:in `run'\n/usr/local/bundle/gems/bundler-2.5.6/lib/bundler/cli.rb:451:in `exec'\n/usr/local/bundle/gems/bundler-2.5.6/lib/bundler/vendor/thor/lib/thor/command.rb:28:in `run'\n/usr/local/bundle/gems/bundler-2.5.6/lib/bundler/vendor/thor/lib/thor/invocation.rb:127:in `invoke_command'\n/usr/local/bundle/gems/bundler-2.5.6/lib/bundler/vendor/thor/lib/thor.rb:527:in `dispatch'\n/usr/local/bundle/gems/bundler-2.5.6/lib/bundler/cli.rb:34:in `dispatch'\n/usr/local/bundle/gems/bundler-2.5.6/lib/bundler/vendor/thor/lib/thor/base.rb:584:in `start'\n/usr/local/bundle/gems/bundler-2.5.6/lib/bundler/cli.rb:28:in `start'\n/usr/local/bundle/gems/bundler-2.5.6/exe/bundle:28:in `block in <top (required)>'\n/usr/local/bundle/gems/bundler-2.5.6/lib/bundler/friendly_errors.rb:117:in `with_friendly_errors'\n/usr/local/bundle/gems/bundler-2.5.6/exe/bundle:20:in `<top (required)>'\n/usr/local/bundle/bin/bundle:25:in `load'\n/usr/local/bundle/bin/bundle:25:in `<main>'\n```","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6699/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6699/timeline","performed_via_github_app":null,"state_reason":"completed"}