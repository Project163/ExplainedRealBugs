{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3892","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3892/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3892/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3892/events","html_url":"https://github.com/sidekiq/sidekiq/issues/3892","id":342004257,"node_id":"MDU6SXNzdWUzNDIwMDQyNTc=","number":3892,"title":"Reduce default concurrency","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":17,"created_at":"2018-07-17T16:59:28Z","updated_at":"2018-07-20T17:54:51Z","closed_at":"2018-07-20T17:54:51Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Today Sidekiq uses a default concurrency of 25.  These means Sidekiq will spawn 25 worker threads and execute up to 25 jobs concurrently in a process.\r\n\r\nglibc has a major memory fragmentation issue which gets worse with more threads, causing many people to move to jemalloc.\r\n\r\nI also happen to think that, with time and experience but no hard data, that 25 is pretty aggressive and most apps can peg a CPU with a lower number of cores.  Developers testing locally on macOS rarely need such large concurrency.\r\n\r\nI'd suggest we reduce the default concurrency from 25 to 15 in Sidekiq 5.2.0.  This will save memory and reduce fragmentation and bloat on Linux.  Anyone who wants to retain the old value can add `-c 25` to their command line.\r\n\r\nWDYT?","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3892/reactions","total_count":34,"+1":33,"-1":0,"laugh":0,"hooray":0,"confused":1,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3892/timeline","performed_via_github_app":null,"state_reason":"completed"}