[{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/412034524","html_url":"https://github.com/sidekiq/sidekiq/issues/3921#issuecomment-412034524","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3921","id":412034524,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjAzNDUyNA==","user":{"login":"greysteil","id":1144873,"node_id":"MDQ6VXNlcjExNDQ4NzM=","avatar_url":"https://avatars.githubusercontent.com/u/1144873?v=4","gravatar_id":"","url":"https://api.github.com/users/greysteil","html_url":"https://github.com/greysteil","followers_url":"https://api.github.com/users/greysteil/followers","following_url":"https://api.github.com/users/greysteil/following{/other_user}","gists_url":"https://api.github.com/users/greysteil/gists{/gist_id}","starred_url":"https://api.github.com/users/greysteil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greysteil/subscriptions","organizations_url":"https://api.github.com/users/greysteil/orgs","repos_url":"https://api.github.com/users/greysteil/repos","events_url":"https://api.github.com/users/greysteil/events{/privacy}","received_events_url":"https://api.github.com/users/greysteil/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-10T09:47:12Z","updated_at":"2018-08-10T09:47:12Z","body":"FYI, just seen this again. I'm going to downgrade to 5.1.3 for now, but let me know if I can help debug at all.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/412034524/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"greysteil","id":1144873,"node_id":"MDQ6VXNlcjExNDQ4NzM=","avatar_url":"https://avatars.githubusercontent.com/u/1144873?v=4","gravatar_id":"","url":"https://api.github.com/users/greysteil","html_url":"https://github.com/greysteil","followers_url":"https://api.github.com/users/greysteil/followers","following_url":"https://api.github.com/users/greysteil/following{/other_user}","gists_url":"https://api.github.com/users/greysteil/gists{/gist_id}","starred_url":"https://api.github.com/users/greysteil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greysteil/subscriptions","organizations_url":"https://api.github.com/users/greysteil/orgs","repos_url":"https://api.github.com/users/greysteil/repos","events_url":"https://api.github.com/users/greysteil/events{/privacy}","received_events_url":"https://api.github.com/users/greysteil/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/412038883","html_url":"https://github.com/sidekiq/sidekiq/issues/3921#issuecomment-412038883","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3921","id":412038883,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjAzODg4Mw==","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-10T10:05:42Z","updated_at":"2018-08-10T10:05:42Z","body":"Yep, I’ll need to fix that tomorrow. It iterates in the launcher.rb heartbeat code. \n\n> On Aug 10, 2018, at 02:47, Grey Baker <notifications@github.com> wrote:\n> \n> FYI, just seen this again. I'm going to downgrade to 5.1.3 for now, but let me know if I can help debug at all.\n> \n> —\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub, or mute the thread.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/412038883/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1782440591,"node_id":"MDExOkNsb3NlZEV2ZW50MTc4MjQ0MDU5MQ==","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/1782440591","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"99922ca4ad3ba8be279c82d6def986575e0f4214","commit_url":"https://api.github.com/repos/sidekiq/sidekiq/commits/99922ca4ad3ba8be279c82d6def986575e0f4214","created_at":"2018-08-10T12:58:08Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/412162094","html_url":"https://github.com/sidekiq/sidekiq/issues/3921#issuecomment-412162094","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3921","id":412162094,"node_id":"MDEyOklzc3VlQ29tbWVudDQxMjE2MjA5NA==","user":{"login":"greysteil","id":1144873,"node_id":"MDQ6VXNlcjExNDQ4NzM=","avatar_url":"https://avatars.githubusercontent.com/u/1144873?v=4","gravatar_id":"","url":"https://api.github.com/users/greysteil","html_url":"https://github.com/greysteil","followers_url":"https://api.github.com/users/greysteil/followers","following_url":"https://api.github.com/users/greysteil/following{/other_user}","gists_url":"https://api.github.com/users/greysteil/gists{/gist_id}","starred_url":"https://api.github.com/users/greysteil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greysteil/subscriptions","organizations_url":"https://api.github.com/users/greysteil/orgs","repos_url":"https://api.github.com/users/greysteil/repos","events_url":"https://api.github.com/users/greysteil/events{/privacy}","received_events_url":"https://api.github.com/users/greysteil/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-10T18:08:53Z","updated_at":"2018-08-10T18:08:53Z","body":"Thanks for the quick fix!","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/412162094/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"greysteil","id":1144873,"node_id":"MDQ6VXNlcjExNDQ4NzM=","avatar_url":"https://avatars.githubusercontent.com/u/1144873?v=4","gravatar_id":"","url":"https://api.github.com/users/greysteil","html_url":"https://github.com/greysteil","followers_url":"https://api.github.com/users/greysteil/followers","following_url":"https://api.github.com/users/greysteil/following{/other_user}","gists_url":"https://api.github.com/users/greysteil/gists{/gist_id}","starred_url":"https://api.github.com/users/greysteil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greysteil/subscriptions","organizations_url":"https://api.github.com/users/greysteil/orgs","repos_url":"https://api.github.com/users/greysteil/repos","events_url":"https://api.github.com/users/greysteil/events{/privacy}","received_events_url":"https://api.github.com/users/greysteil/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"mattbooks","id":784761,"node_id":"MDQ6VXNlcjc4NDc2MQ==","avatar_url":"https://avatars.githubusercontent.com/u/784761?v=4","gravatar_id":"","url":"https://api.github.com/users/mattbooks","html_url":"https://github.com/mattbooks","followers_url":"https://api.github.com/users/mattbooks/followers","following_url":"https://api.github.com/users/mattbooks/following{/other_user}","gists_url":"https://api.github.com/users/mattbooks/gists{/gist_id}","starred_url":"https://api.github.com/users/mattbooks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattbooks/subscriptions","organizations_url":"https://api.github.com/users/mattbooks/orgs","repos_url":"https://api.github.com/users/mattbooks/repos","events_url":"https://api.github.com/users/mattbooks/events{/privacy}","received_events_url":"https://api.github.com/users/mattbooks/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-11T15:15:51Z","updated_at":"2018-09-11T15:15:51Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3958","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3958/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3958/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3958/events","html_url":"https://github.com/sidekiq/sidekiq/issues/3958","id":359094686,"node_id":"MDU6SXNzdWUzNTkwOTQ2ODY=","number":3958,"title":"Jobs lingering in busy despite having completed (on jruby)","user":{"login":"mattbooks","id":784761,"node_id":"MDQ6VXNlcjc4NDc2MQ==","avatar_url":"https://avatars.githubusercontent.com/u/784761?v=4","gravatar_id":"","url":"https://api.github.com/users/mattbooks","html_url":"https://github.com/mattbooks","followers_url":"https://api.github.com/users/mattbooks/followers","following_url":"https://api.github.com/users/mattbooks/following{/other_user}","gists_url":"https://api.github.com/users/mattbooks/gists{/gist_id}","starred_url":"https://api.github.com/users/mattbooks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mattbooks/subscriptions","organizations_url":"https://api.github.com/users/mattbooks/orgs","repos_url":"https://api.github.com/users/mattbooks/repos","events_url":"https://api.github.com/users/mattbooks/events{/privacy}","received_events_url":"https://api.github.com/users/mattbooks/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2018-09-11T15:15:51Z","updated_at":"2018-09-14T15:52:52Z","closed_at":"2018-09-14T15:52:52Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Ruby version: jruby 9.1.16.0\r\nSidekiq / Pro / Enterprise version(s): 5.2.1 / pro 3.4.5\r\n\r\nPlease include your initializer and any error message with the full backtrace.\r\n- It's hard for me to get that, and there are no exceptions.\r\n\r\nAre you using an old version? no\r\nHave you checked the changelogs to see if your issue has been fixed in a later version? Yes. A different concurrency issue with `WORKER_STATE` was fixed recently, however: #3921\r\n\r\n**TL;DR: I believe this is a thread safety issue with `WORKER_STATE` on jruby**\r\n\r\nHere's why I think that: \r\n\r\nI can see jobs linger in the busy tab in the web UI. I believe they are finished executing because I can see the logs from them completing.\r\n\r\nI checked if the data powering the admin page was stale, but it appears as though the heartbeat in `sidekiq/launcher` is refreshing it, as I can see the expiry being refreshed for `hget(\"<proc>:workers\")`.\r\n\r\nSince that reads from the global `WORKER_STATE` variable, which is annotated with \r\n\r\n```\r\n# This is mutable global state but because each thread is storing\r\n# its own unique key/value, there's no thread-safety issue AFAIK.\r\n```\r\n\r\nI suspected this might be a thread safety issue. I also know that MRI apps at my company are not reporting this issue, so perhaps it is an issue with the jruby implementation, which is not threadsafe AFAIK (I think you need to use `Concurrent::Hash`)\r\n\r\nTo test this theory, I wrote this script:\r\n\r\n```\r\nrequire 'concurrent/hash'\r\n\r\nGLOBAL_HASH = Concurrent::Hash.new\r\n# GLOBAL_HASH = {}\r\n\r\ndo_modifications = Proc.new do |name|\r\n  Thread.new do\r\n    loop do\r\n      begin\r\n        k = \"#{name}:#{rand.to_s}\"\r\n        GLOBAL_HASH[k] = name\r\n        GLOBAL_HASH.delete(k)\r\n      rescue => e\r\n        puts \"caught error in #{name}\"\r\n        puts e\r\n        raise\r\n      end\r\n    end\r\n  end\r\nend\r\n\r\ndo_modifications.call('foo')\r\ndo_modifications.call('bar')\r\n\r\nputs \"Running!\"\r\n1000000.times do\r\n  # puts GLOBAL_HASH\r\n  bad_hash = GLOBAL_HASH.dup\r\n  raise \"Too many keys: #{bad_hash}\" if bad_hash.size > 2\r\nend\r\n```\r\n\r\n(run with `while true; do; jruby test.rb; done` since it doesn't fail every time)\r\n\r\nwith `{}` it raises, with `Concurrent::Hash`, it does not. I have not seen this fail on MRI either.\r\n\r\nIndeed, testing this in our staging environment using `Concurrent::Hash` for `WORKER_STATE` seems to resolve the issue.","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3958/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3958/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/575090697","html_url":"https://github.com/sidekiq/sidekiq/issues/3921#issuecomment-575090697","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3921","id":575090697,"node_id":"MDEyOklzc3VlQ29tbWVudDU3NTA5MDY5Nw==","user":{"login":"jimgrimmett","id":15203044,"node_id":"MDQ6VXNlcjE1MjAzMDQ0","avatar_url":"https://avatars.githubusercontent.com/u/15203044?v=4","gravatar_id":"","url":"https://api.github.com/users/jimgrimmett","html_url":"https://github.com/jimgrimmett","followers_url":"https://api.github.com/users/jimgrimmett/followers","following_url":"https://api.github.com/users/jimgrimmett/following{/other_user}","gists_url":"https://api.github.com/users/jimgrimmett/gists{/gist_id}","starred_url":"https://api.github.com/users/jimgrimmett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimgrimmett/subscriptions","organizations_url":"https://api.github.com/users/jimgrimmett/orgs","repos_url":"https://api.github.com/users/jimgrimmett/repos","events_url":"https://api.github.com/users/jimgrimmett/events{/privacy}","received_events_url":"https://api.github.com/users/jimgrimmett/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-01-16T10:38:04Z","updated_at":"2020-01-16T10:38:04Z","body":"Heya. Long time user of free sidekiq here. \r\n\r\nRecently upgraded from 5.0.5 to 5.1.3 and saw the \"can't add a new key into hash during iteration\" error. Reading your comment above, I moved up to sidekiq 5.2.7.\r\n\r\nWe're on ruby 2.5.1 and rails 5.1.5\r\n\r\nI'm still seeing this in my logs\r\n\r\n`.454959+00:00 app worker.1 - - /app/vendor/ruby-2.5.1/lib/ruby/2.5.0/set.rb:349:in `add': can't add a new key into hash during iteration (RuntimeError)\r\n\tfrom /app/vendor/bundle/ruby/2.5.0/gems/sidekiq-5.2.7/lib/sidekiq/manager.rb:95:in `block in processor_died'\r\n\tfrom /app/vendor/bundle/ruby/2.5.0/gems/sidekiq-5.2.7/lib/sidekiq/manager.rb:91:in `synchronize'\r\n\tfrom /app/vendor/bundle/ruby/2.5.0/gems/sidekiq-5.2.7/lib/sidekiq/manager.rb:91:in `processor_died'\r\n\tfrom /app/vendor/bundle/ruby/2.5.0/gems/sidekiq-5.2.7/lib/sidekiq/processor.rb:77:in `rescue in run'\r\n\tfrom /app/vendor/bundle/ruby/2.5.0/gems/sidekiq-5.2.7/lib/sidekiq/processor.rb:68:in `run'\r\n\tfrom /app/vendor/bundle/ruby/2.5.0/gems/sidekiq-5.2.7/lib/sidekiq/util.rb:16:in `watchdog'\r\n\tfrom /app/vendor/bundle/ruby/2.5.0/gems/sidekiq-5.2.7/lib/sidekiq/util.rb:25:in `block in safe_thread'Exception`\r\n\r\nI'm running sidekiq in Heroku with \r\n`worker: bundle exec sidekiq`\r\n\r\nour sidekiq.rb is pretty empty\r\n`require 'sidekiq'`\r\n\r\n`Sidekiq.configure_client do |config|`\r\n`  config.redis = { :size => 10 }`\r\n`end`\r\n\r\n`# Sidekiq.configure_server do |config|`\r\n`#   # The config.redis is calculated by the`\r\n`#   # concurrency value so you do not need to`\r\n`#   # specify this. For this demo I do`\r\n`#   # show it to understand the numbers`\r\n`#   config.redis = { :size => 10 }`\r\n`# end`\r\n\r\nredis gets its data from ENV and I'm using the sidekiq.yml to specify a number of queues (with sidekiq-limit-fetch and sidekiq-scheduler to help out).\r\n\r\nWe were running around 350k jobs a day, but I've been optimising the jobs and are up to over 1M jobs a day now. I'm stuill seeing lots of jobs running, but the busy queue reported in the UI goes down and down. It seems like the jobs are still being processed at a rate of knots... but I can't see them running - does that sound right or insane?\r\n\r\nRestarting the heroku worker brings everything back.\r\n\r\nI looked into concurrent ruby. We're still have version 1.1.5 required by active-support 5.1.5 and sprockets 3.7.1\r\n\r\nAnyway, anything you can add would be most welcome.\r\n\r\nJ.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/575090697/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jimgrimmett","id":15203044,"node_id":"MDQ6VXNlcjE1MjAzMDQ0","avatar_url":"https://avatars.githubusercontent.com/u/15203044?v=4","gravatar_id":"","url":"https://api.github.com/users/jimgrimmett","html_url":"https://github.com/jimgrimmett","followers_url":"https://api.github.com/users/jimgrimmett/followers","following_url":"https://api.github.com/users/jimgrimmett/following{/other_user}","gists_url":"https://api.github.com/users/jimgrimmett/gists{/gist_id}","starred_url":"https://api.github.com/users/jimgrimmett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jimgrimmett/subscriptions","organizations_url":"https://api.github.com/users/jimgrimmett/orgs","repos_url":"https://api.github.com/users/jimgrimmett/repos","events_url":"https://api.github.com/users/jimgrimmett/events{/privacy}","received_events_url":"https://api.github.com/users/jimgrimmett/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":13766718240,"node_id":"REFE_lADOADDA9M4U1A-6zwAAAAM0j3Mg","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/13766718240","actor":{"login":"AlexSc","id":98665,"node_id":"MDQ6VXNlcjk4NjY1","avatar_url":"https://avatars.githubusercontent.com/u/98665?v=4","gravatar_id":"","url":"https://api.github.com/users/AlexSc","html_url":"https://github.com/AlexSc","followers_url":"https://api.github.com/users/AlexSc/followers","following_url":"https://api.github.com/users/AlexSc/following{/other_user}","gists_url":"https://api.github.com/users/AlexSc/gists{/gist_id}","starred_url":"https://api.github.com/users/AlexSc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlexSc/subscriptions","organizations_url":"https://api.github.com/users/AlexSc/orgs","repos_url":"https://api.github.com/users/AlexSc/repos","events_url":"https://api.github.com/users/AlexSc/events{/privacy}","received_events_url":"https://api.github.com/users/AlexSc/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"99922ca4ad3ba8be279c82d6def986575e0f4214","commit_url":"https://api.github.com/repos/GoCarrot/sidekiq/commits/99922ca4ad3ba8be279c82d6def986575e0f4214","created_at":"2024-08-05T16:13:34Z","performed_via_github_app":null}]