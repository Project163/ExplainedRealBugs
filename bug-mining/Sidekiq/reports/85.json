{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1452","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1452/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1452/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1452/events","html_url":"https://github.com/sidekiq/sidekiq/issues/1452","id":26292330,"node_id":"MDU6SXNzdWUyNjI5MjMzMA==","number":1452,"title":"Changes to nested data structure arguments are persisted for retry ","user":{"login":"betelgeuse","id":34627,"node_id":"MDQ6VXNlcjM0NjI3","avatar_url":"https://avatars.githubusercontent.com/u/34627?v=4","gravatar_id":"","url":"https://api.github.com/users/betelgeuse","html_url":"https://github.com/betelgeuse","followers_url":"https://api.github.com/users/betelgeuse/followers","following_url":"https://api.github.com/users/betelgeuse/following{/other_user}","gists_url":"https://api.github.com/users/betelgeuse/gists{/gist_id}","starred_url":"https://api.github.com/users/betelgeuse/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/betelgeuse/subscriptions","organizations_url":"https://api.github.com/users/betelgeuse/orgs","repos_url":"https://api.github.com/users/betelgeuse/repos","events_url":"https://api.github.com/users/betelgeuse/events{/privacy}","received_events_url":"https://api.github.com/users/betelgeuse/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":7,"created_at":"2014-01-25T12:47:10Z","updated_at":"2014-01-28T04:29:25Z","closed_at":"2014-01-28T04:29:25Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Given the following job class:\n\n``` ruby\nclass SidekiqFailure\n  include Sidekiq::Worker\n\n  def perform(params)\n    p params\n    if params.is_a?(Array)\n      p params.first.delete('foo')\n    else\n      p params.delete('foo')\n    end\n    p params\n    raise \"failure\"\n  end\nend\n```\n\nWhen I schedule the jobs:\n\n```\n2.0.0-p247 :008 > SidekiqFailure.perform_async [{'foo' => 1, 'bar' => 2}]\n => \"791b5ce0890f469a1e971ff2\" \n2.0.0-p247 :010 > SidekiqFailure.perform_async({'foo' => 1, 'bar' => 2})\n => \"fc858c79bfc02cb5839fe2e3\"\n```\n\nThen I see the following sidekiq output:\n\n```\n[{\"foo\"=>1, \"bar\"=>2}]\n1\n[{\"bar\"=>2}]\n{\"foo\"=>1, \"bar\"=>2}\n1\n{\"bar\"=>2}\n[{\"bar\"=>2}]\nnil\n[{\"bar\"=>2}]\n{\"foo\"=>1, \"bar\"=>2}\n1\n{\"bar\"=>2}\n[{\"bar\"=>2}]\nnil\n[{\"bar\"=>2}]\n{\"foo\"=>1, \"bar\"=>2}\n1\n{\"bar\"=>2}\n{\"foo\"=>1, \"bar\"=>2}\n1\n{\"bar\"=>2}\n```\n\nHere we can see that deleting from the array will provide the modified array also for the retry. Deleting from that hash provides the original hash for the retry. Which one is the wanted behavior? I argue it's the one for the hash. This is on 2.17.2 but 2.17.3 changes don't seem related.\n","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1452/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/1452/timeline","performed_via_github_app":null,"state_reason":"completed"}