{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/398","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/398/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/398/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/398/events","html_url":"https://github.com/sidekiq/sidekiq/issues/398","id":6846708,"node_id":"MDU6SXNzdWU2ODQ2NzA4","number":398,"title":"SystemStackError: stack level too deep","user":{"login":"nickflux","id":94393,"node_id":"MDQ6VXNlcjk0Mzkz","avatar_url":"https://avatars.githubusercontent.com/u/94393?v=4","gravatar_id":"","url":"https://api.github.com/users/nickflux","html_url":"https://github.com/nickflux","followers_url":"https://api.github.com/users/nickflux/followers","following_url":"https://api.github.com/users/nickflux/following{/other_user}","gists_url":"https://api.github.com/users/nickflux/gists{/gist_id}","starred_url":"https://api.github.com/users/nickflux/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickflux/subscriptions","organizations_url":"https://api.github.com/users/nickflux/orgs","repos_url":"https://api.github.com/users/nickflux/repos","events_url":"https://api.github.com/users/nickflux/events{/privacy}","received_events_url":"https://api.github.com/users/nickflux/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2012-09-13T13:09:31Z","updated_at":"2012-09-17T08:51:47Z","closed_at":"2012-09-13T16:16:30Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Hi\n\nIn know this is mentioned in https://github.com/mperham/sidekiq/issues/233 but I am getting some information out from Airbrake and this seems like a different problem.\n\nMy worker looks like this:\n\n``` ruby\n\nclass CreateFromTextWorker\n  include Sidekiq::Worker\n\n  def perform(source, user_identifier, raw_text, source_id = nil)\n\n    sidekiq_log = SkLog.new({\n      source: source,\n      user_identifier: user_identifier,\n      raw_text: raw_text,\n      source_id: source_id\n    })\n\n    # fails validation if source_id not unique (e.g., record added before)\n    # for some reason, when this save fails with worker raises an exception\n    # SystemStackError: stack level too deep\n\n    if sidekiq_log.save\n      # ... do some stuff ...\n      # this generally succeeds\n    end\n\n  end\n\nend\n\n```\n\nThe worker tries to create a SkLog record with the supplied arguments, and the only validation is for the source_id to be unique (or nil). When the validation passes, which is when the worker actually does something, the worker processes successfully. However, then the validation fails, and the worker isn't doing anything, the worker fails and raises an exception: SystemStackError: stack level too deep.\n\nThe backtrace for this error can be one of these four, seemingly at random:\n\n[GEM_ROOT]/gems/sidekiq-2.3.0/lib/sidekiq/processor.rb:82\n\n[GEM_ROOT]/gems/hashr-0.0.21/lib/hashr/core_ext/ruby/hash.rb:0\n\n[GEM_ROOT]/gems/sidekiq-2.3.0/lib/sidekiq/middleware/server/logging.rb:15\n\n[GEM_ROOT]/gems/celluloid-0.12.0/lib/celluloid/actor.rb:209\n\nDoes anyone have a suggestion for how I might investigate further?\n\nThanks,\n\nNick\n","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/398/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/398/timeline","performed_via_github_app":null,"state_reason":"completed"}