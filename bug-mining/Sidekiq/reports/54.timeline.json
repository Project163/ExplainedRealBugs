[{"id":20935884,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIwOTM1ODg0","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/20935884","actor":{"login":"jfirebaugh","id":98601,"node_id":"MDQ6VXNlcjk4NjAx","avatar_url":"https://avatars.githubusercontent.com/u/98601?v=4","gravatar_id":"","url":"https://api.github.com/users/jfirebaugh","html_url":"https://github.com/jfirebaugh","followers_url":"https://api.github.com/users/jfirebaugh/followers","following_url":"https://api.github.com/users/jfirebaugh/following{/other_user}","gists_url":"https://api.github.com/users/jfirebaugh/gists{/gist_id}","starred_url":"https://api.github.com/users/jfirebaugh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jfirebaugh/subscriptions","organizations_url":"https://api.github.com/users/jfirebaugh/orgs","repos_url":"https://api.github.com/users/jfirebaugh/repos","events_url":"https://api.github.com/users/jfirebaugh/events{/privacy}","received_events_url":"https://api.github.com/users/jfirebaugh/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2012-07-23T18:19:23Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/7186870","html_url":"https://github.com/sidekiq/sidekiq/issues/309#issuecomment-7186870","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/309","id":7186870,"node_id":"MDEyOklzc3VlQ29tbWVudDcxODY4NzA=","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-07-23T18:37:03Z","updated_at":"2012-07-23T18:37:03Z","body":"Yep, good catch.  Will fix this week.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/7186870/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":20937786,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDIwOTM3Nzg2","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/20937786","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2012-07-23T18:37:03Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/7374414","html_url":"https://github.com/sidekiq/sidekiq/issues/309#issuecomment-7374414","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/309","id":7374414,"node_id":"MDEyOklzc3VlQ29tbWVudDczNzQ0MTQ=","user":{"login":"jfirebaugh","id":98601,"node_id":"MDQ6VXNlcjk4NjAx","avatar_url":"https://avatars.githubusercontent.com/u/98601?v=4","gravatar_id":"","url":"https://api.github.com/users/jfirebaugh","html_url":"https://github.com/jfirebaugh","followers_url":"https://api.github.com/users/jfirebaugh/followers","following_url":"https://api.github.com/users/jfirebaugh/following{/other_user}","gists_url":"https://api.github.com/users/jfirebaugh/gists{/gist_id}","starred_url":"https://api.github.com/users/jfirebaugh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jfirebaugh/subscriptions","organizations_url":"https://api.github.com/users/jfirebaugh/orgs","repos_url":"https://api.github.com/users/jfirebaugh/repos","events_url":"https://api.github.com/users/jfirebaugh/events{/privacy}","received_events_url":"https://api.github.com/users/jfirebaugh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-07-30T17:03:22Z","updated_at":"2012-07-30T17:03:22Z","body":"Any progress on this?\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/7374414/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jfirebaugh","id":98601,"node_id":"MDQ6VXNlcjk4NjAx","avatar_url":"https://avatars.githubusercontent.com/u/98601?v=4","gravatar_id":"","url":"https://api.github.com/users/jfirebaugh","html_url":"https://github.com/jfirebaugh","followers_url":"https://api.github.com/users/jfirebaugh/followers","following_url":"https://api.github.com/users/jfirebaugh/following{/other_user}","gists_url":"https://api.github.com/users/jfirebaugh/gists{/gist_id}","starred_url":"https://api.github.com/users/jfirebaugh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jfirebaugh/subscriptions","organizations_url":"https://api.github.com/users/jfirebaugh/orgs","repos_url":"https://api.github.com/users/jfirebaugh/repos","events_url":"https://api.github.com/users/jfirebaugh/events{/privacy}","received_events_url":"https://api.github.com/users/jfirebaugh/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":21571003,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDIxNTcxMDAz","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/21571003","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"1ee0d5e9b0307ee27294a388872109c449dd2dcb","commit_url":"https://api.github.com/repos/sidekiq/sidekiq/commits/1ee0d5e9b0307ee27294a388872109c449dd2dcb","created_at":"2012-07-30T17:23:40Z","performed_via_github_app":null},{"id":21571043,"node_id":"MDExOkNsb3NlZEV2ZW50MjE1NzEwNDM=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/21571043","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2012-07-30T17:24:04Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/7375035","html_url":"https://github.com/sidekiq/sidekiq/issues/309#issuecomment-7375035","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/309","id":7375035,"node_id":"MDEyOklzc3VlQ29tbWVudDczNzUwMzU=","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2012-07-30T17:24:21Z","updated_at":"2012-07-30T17:24:28Z","body":"Yes. :-)\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/7375035/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15906165","html_url":"https://github.com/sidekiq/sidekiq/issues/309#issuecomment-15906165","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/309","id":15906165,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTA2MTY1","user":{"login":"Ragmaanir","id":113789,"node_id":"MDQ6VXNlcjExMzc4OQ==","avatar_url":"https://avatars.githubusercontent.com/u/113789?v=4","gravatar_id":"","url":"https://api.github.com/users/Ragmaanir","html_url":"https://github.com/Ragmaanir","followers_url":"https://api.github.com/users/Ragmaanir/followers","following_url":"https://api.github.com/users/Ragmaanir/following{/other_user}","gists_url":"https://api.github.com/users/Ragmaanir/gists{/gist_id}","starred_url":"https://api.github.com/users/Ragmaanir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ragmaanir/subscriptions","organizations_url":"https://api.github.com/users/Ragmaanir/orgs","repos_url":"https://api.github.com/users/Ragmaanir/repos","events_url":"https://api.github.com/users/Ragmaanir/events{/privacy}","received_events_url":"https://api.github.com/users/Ragmaanir/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-04-04T15:58:13Z","updated_at":"2013-04-04T15:58:13Z","body":"This seems not to work for us in the current version (2.9.0). We see a \"WARN: {:context=>\"scheduling poller thread died!\"}\" after our redis server was down for a short period. \n\nThe Stacktrace is:\n\n```\n2013-04-04T07:58:23Z 27573 TID-ooe3k WARN: {:context=>\"scheduling poller thread died!\"}\n2013-04-04T07:58:23Z 27573 TID-ooe3k WARN: Error connecting to Redis on localhost:6379 (ECONNREFUSED)\n2013-04-04T07:58:23Z 27573 TID-ooe3k WARN: .../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis/client.rb:276:in `rescue in establish_connection'\n.../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis/client.rb:271:in `establish_connection'\n.../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis/client.rb:69:in `connect'\n.../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis/client.rb:290:in `ensure_connected'\n.../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis/client.rb:177:in `block in process'\n.../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis/client.rb:256:in `logging'\n.../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis/client.rb:176:in `process'\n.../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis/client.rb:147:in `call_pipelined'\n.../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis/client.rb:121:in `block in call_pipeline'\n.../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis/client.rb:243:in `with_reconnect'\n.../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis/client.rb:119:in `call_pipeline'\n.../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis.rb:2075:in `block in multi'\n.../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis.rb:36:in `block in synchronize'\n/usr/local/lib/ruby/1.9.1/monitor.rb:211:in `mon_synchronize'\n.../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis.rb:36:in `synchronize'\n.../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis.rb:2067:in `multi'\n.../shared/bundle/ruby/1.9.1/gems/redis-namespace-1.2.1/lib/redis/namespace.rb:220:in `method_missing'\n.../shared/bundle/ruby/1.9.1/gems/sidekiq-2.9.0/lib/sidekiq/scheduled.rb:31:in `block (3 levels) in poll'\n.../shared/bundle/ruby/1.9.1/gems/sidekiq-2.9.0/lib/sidekiq/scheduled.rb:30:in `each'\n.../shared/bundle/ruby/1.9.1/gems/sidekiq-2.9.0/lib/sidekiq/scheduled.rb:30:in `block (2 levels) in poll'\n.../shared/bundle/ruby/1.9.1/gems/connection_pool-1.0.0/lib/connection_pool.rb:48:in `with'\n.../shared/bundle/ruby/1.9.1/gems/sidekiq-2.9.0/lib/sidekiq.rb:72:in `redis'\n.../shared/bundle/ruby/1.9.1/gems/sidekiq-2.9.0/lib/sidekiq/scheduled.rb:29:in `block in poll'\n.../shared/bundle/ruby/1.9.1/gems/sidekiq-2.9.0/lib/sidekiq/util.rb:15:in `watchdog'\n.../shared/bundle/ruby/1.9.1/gems/sidekiq-2.9.0/lib/sidekiq/scheduled.rb:22:in `poll'\n.../shared/bundle/ruby/1.9.1/gems/sidekiq-2.9.0/lib/sidekiq/scheduled.rb:52:in `block (2 levels) in poll'\n.../shared/bundle/ruby/1.9.1/gems/celluloid-0.12.4/lib/celluloid/tasks/task_fiber.rb:24:in `block in initialize'\n```\n\nThe log shows several error messages around the poller-message:\n\n```\n2013-04-04T07:58:24Z 27573 TID-onrx8 ERROR: Error fetching message: Error connecting to Redis on localhost:6379 (ECONNREFUSED)\n2013-04-04T07:58:24Z 27573 TID-onrx8 ERROR: .../shared/bundle/ruby/1.9.1/gems/redis-3.0.3/lib/redis/client.rb:276:in `rescue in establish_connection'\n```\n\nThe effect being that some of our workers are executed while others are not. The ones that are executed immediately (not delayed) are processed while the ones that are scheduled (delayed) just pile up (because the scheduling poller thread is dead and does not collect them). I guess that the exception types caught in Poller#poll are not the same as (or not all of) the ones thrown in the redis gem (redis-3.0.3 as visible in the stacktrace).\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15906165/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"Ragmaanir","id":113789,"node_id":"MDQ6VXNlcjExMzc4OQ==","avatar_url":"https://avatars.githubusercontent.com/u/113789?v=4","gravatar_id":"","url":"https://api.github.com/users/Ragmaanir","html_url":"https://github.com/Ragmaanir","followers_url":"https://api.github.com/users/Ragmaanir/followers","following_url":"https://api.github.com/users/Ragmaanir/following{/other_user}","gists_url":"https://api.github.com/users/Ragmaanir/gists{/gist_id}","starred_url":"https://api.github.com/users/Ragmaanir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ragmaanir/subscriptions","organizations_url":"https://api.github.com/users/Ragmaanir/orgs","repos_url":"https://api.github.com/users/Ragmaanir/repos","events_url":"https://api.github.com/users/Ragmaanir/events{/privacy}","received_events_url":"https://api.github.com/users/Ragmaanir/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15913661","html_url":"https://github.com/sidekiq/sidekiq/issues/309#issuecomment-15913661","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/309","id":15913661,"node_id":"MDEyOklzc3VlQ29tbWVudDE1OTEzNjYx","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-04-04T18:07:41Z","updated_at":"2013-04-04T18:07:41Z","body":"Yep, I see the problem.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/15913661/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":44059959,"node_id":"MDEzOlJlb3BlbmVkRXZlbnQ0NDA1OTk1OQ==","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/44059959","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"reopened","commit_id":null,"commit_url":null,"created_at":"2013-04-04T18:07:41Z","state_reason":null,"performed_via_github_app":null},{"id":44066498,"node_id":"MDExOkNsb3NlZEV2ZW50NDQwNjY0OTg=","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/44066498","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"86591fe9e3775068cfe838ea0708c99fca1aaa70","commit_url":"https://api.github.com/repos/sidekiq/sidekiq/commits/86591fe9e3775068cfe838ea0708c99fca1aaa70","created_at":"2013-04-04T18:52:40Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"bdurand","id":41791,"node_id":"MDQ6VXNlcjQxNzkx","avatar_url":"https://avatars.githubusercontent.com/u/41791?v=4","gravatar_id":"","url":"https://api.github.com/users/bdurand","html_url":"https://github.com/bdurand","followers_url":"https://api.github.com/users/bdurand/followers","following_url":"https://api.github.com/users/bdurand/following{/other_user}","gists_url":"https://api.github.com/users/bdurand/gists{/gist_id}","starred_url":"https://api.github.com/users/bdurand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bdurand/subscriptions","organizations_url":"https://api.github.com/users/bdurand/orgs","repos_url":"https://api.github.com/users/bdurand/repos","events_url":"https://api.github.com/users/bdurand/events{/privacy}","received_events_url":"https://api.github.com/users/bdurand/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2013-04-11T00:49:25Z","updated_at":"2013-04-11T00:49:25Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/843","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/843/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/843/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/843/events","html_url":"https://github.com/sidekiq/sidekiq/pull/843","id":13047893,"node_id":"MDExOlB1bGxSZXF1ZXN0NTA5NzUwNQ==","number":843,"title":"More atomic poller operations","user":{"login":"bdurand","id":41791,"node_id":"MDQ6VXNlcjQxNzkx","avatar_url":"https://avatars.githubusercontent.com/u/41791?v=4","gravatar_id":"","url":"https://api.github.com/users/bdurand","html_url":"https://github.com/bdurand","followers_url":"https://api.github.com/users/bdurand/followers","following_url":"https://api.github.com/users/bdurand/following{/other_user}","gists_url":"https://api.github.com/users/bdurand/gists{/gist_id}","starred_url":"https://api.github.com/users/bdurand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bdurand/subscriptions","organizations_url":"https://api.github.com/users/bdurand/orgs","repos_url":"https://api.github.com/users/bdurand/repos","events_url":"https://api.github.com/users/bdurand/events{/privacy}","received_events_url":"https://api.github.com/users/bdurand/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2013-04-11T00:49:25Z","updated_at":"2014-07-10T05:11:25Z","closed_at":"2013-04-12T15:47:18Z","author_association":"NONE","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/sidekiq/sidekiq/pulls/843","html_url":"https://github.com/sidekiq/sidekiq/pull/843","diff_url":"https://github.com/sidekiq/sidekiq/pull/843.diff","patch_url":"https://github.com/sidekiq/sidekiq/pull/843.patch","merged_at":"2013-04-12T15:47:18Z"},"body":"I recently had an issue where my application lost a very large number of jobs. The problem was with future scheduled jobs being popped from the scheduled queue but never pushed onto one of the worker queues. Here are the steps that happened:\n1. We performed some redis maintenance which took the server down for a few minutes.\n2. Due to a bug in scheduled.rb (since fixed see issue #309) the poller stopped querying the scheduled queue.\n3. When redis came back online, sidekiq started processing all workers executed with perform_async. Any workers called with perform_in were put on the scheduled queue but never popped off due to the stopped poller.\n4. Because sidekiq was processing some jobs just fine, monitoring did not pick up that there was a problem.\n5. After almost 20 hours sidekiq got restarted. This started the poller again.\n6. At this point there were over 2 million jobs in the scheduled queue.\n7. The poller on one of the sidekiq processes would have tried to pop all 2 million jobs at once off the scheduled queue. It than would have tried to insert them one at a time on to the appropriate worker queues. Something happened in the middle of this that aborted the process some where between the pop and finishing the pushes. It could have been an out of memory error or it could have been monitoring thinking there was a run away process due to the ballooning memory.\n\nThe end result was that most of the jobs were irretrievably lost. This had also happened two weeks earlier during some other redis maintenance.\n\nThis pull request changes the logic in Poller to pop messages one at a time from the retry and schedule queues and immediately push them to the appropriate worker queue. The new logic is:\n1. Get the next item in the queue if it's score (time to execute) is <= now\n2. If an item exists, then try to remove the item from the queue\n3. If item successfully removed, then add it to the appropriate worker queue\n4. If item not successfully removed, then try again (it was likely removed by another process)\n5. Repeat until no items have a score that matches <= now\n","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/843/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/843/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"}]