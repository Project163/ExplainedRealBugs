{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3787","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3787/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3787/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3787/events","html_url":"https://github.com/sidekiq/sidekiq/issues/3787","id":304812627,"node_id":"MDU6SXNzdWUzMDQ4MTI2Mjc=","number":3787,"title":"Sidekiq without Rails â€“ NameError: uninitialized constant Rails","user":{"login":"Tensho","id":892721,"node_id":"MDQ6VXNlcjg5MjcyMQ==","avatar_url":"https://avatars.githubusercontent.com/u/892721?v=4","gravatar_id":"","url":"https://api.github.com/users/Tensho","html_url":"https://github.com/Tensho","followers_url":"https://api.github.com/users/Tensho/followers","following_url":"https://api.github.com/users/Tensho/following{/other_user}","gists_url":"https://api.github.com/users/Tensho/gists{/gist_id}","starred_url":"https://api.github.com/users/Tensho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tensho/subscriptions","organizations_url":"https://api.github.com/users/Tensho/orgs","repos_url":"https://api.github.com/users/Tensho/repos","events_url":"https://api.github.com/users/Tensho/events{/privacy}","received_events_url":"https://api.github.com/users/Tensho/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2018-03-13T15:26:06Z","updated_at":"2018-03-13T16:01:02Z","closed_at":"2018-03-13T16:01:02Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Ruby version: **2.2.2**\r\nSidekiq: **5.1.1**\r\n\r\n```\r\n# config/initializers/sidekiq.rb\r\nrequire 'sidekiq/middleware/server/active_record'\r\n\r\nSidekiq.configure_server do |config|\r\n  config.server_middleware do |chain|\r\n    chain.add Sidekiq::Middleware::Server::ActiveRecord\r\n  end\r\nend\r\n```\r\nI use sidekiq workers standalone exclusively with ActiveRecord, without Rails. When I updated `sidekiq` from **4.2.10** to **5.1.1** I received the next error:\r\n```\r\n2018-03-13T15:16:14.352Z 20348 TID-ow8iel6tg ProbeWorker JID-ca575f4c0020e169d4c453f0 INFO: start\r\n2018-03-13T15:16:14.353Z 20348 TID-ow8iel6tg ProbeWorker JID-ca575f4c0020e169d4c453f0 INFO: fail: 0.001 sec\r\n2018-03-13T15:16:14.354Z 20348 TID-ow8iel6tg WARN: {\"context\":\"Job raised exception\",\"job\":{\"class\":\"ProbeWorker\",\"args\":[1],\"retry\":true,\"queue\":\"default\",\"jid\":\"ca575f4c0020e169d4c453f0\",\"created_at\":1520953579.5867,\"enqueued_at\":1520954174.350776,\"error_message\":\"uninitialized constant Rails\",\"error_class\":\"NameError\",\"failed_at\":1520954009.262341,\"retry_count\":2,\"retried_at\":1520954101.247756},\"jobstr\":\"{\\\"class\\\":\\\"ProbeWorker\\\",\\\"args\\\":[1],\\\"retry\\\":true,\\\"queue\\\":\\\"default\\\",\\\"jid\\\":\\\"ca575f4c0020e169d4c453f0\\\",\\\"created_at\\\":1520953579.5867,\\\"enqueued_at\\\":1520954174.350776,\\\"error_message\\\":\\\"uninitialized constant Rails\\\",\\\"error_class\\\":\\\"NameError\\\",\\\"failed_at\\\":1520954009.262341,\\\"retry_count\\\":2,\\\"retried_at\\\":1520954101.247756}\"}\r\n2018-03-13T15:16:14.354Z 20348 TID-ow8iel6tg WARN: NameError: uninitialized constant Rails\r\n2018-03-13T15:16:14.354Z 20348 TID-ow8iel6tg WARN: /Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/middleware/server/active_record.rb:9:in `initialize'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/middleware/chain.rb:146:in `new'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/middleware/chain.rb:146:in `make_new'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/middleware/chain.rb:76:in `each'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/middleware/chain.rb:76:in `each'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/middleware/chain.rb:117:in `map'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/middleware/chain.rb:117:in `retrieve'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/middleware/chain.rb:125:in `invoke'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/processor.rb:168:in `block in process'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/processor.rb:139:in `block (6 levels) in dispatch'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/job_retry.rb:97:in `local'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/processor.rb:138:in `block (5 levels) in dispatch'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq.rb:37:in `call'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq.rb:37:in `block in <module:Sidekiq>'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/processor.rb:134:in `call'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/processor.rb:134:in `block (4 levels) in dispatch'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/processor.rb:199:in `stats'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/processor.rb:129:in `block (3 levels) in dispatch'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/job_logger.rb:7:in `call'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/processor.rb:128:in `block (2 levels) in dispatch'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/job_retry.rb:72:in `global'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/processor.rb:127:in `block in dispatch'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/logging.rb:48:in `with_context'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/logging.rb:42:in `with_job_hash_context'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/processor.rb:126:in `dispatch'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/processor.rb:167:in `process'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/processor.rb:85:in `process_one'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/processor.rb:73:in `run'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/util.rb:16:in `watchdog'\r\n/Users/tensho/.rbenv/versions/2.2.2/lib/ruby/gems/2.2.0/gems/sidekiq-5.1.1/lib/sidekiq/util.rb:25:in `block in safe_thread'\r\n```\r\nIs it possible to switch off Rails constant checks if there is no `rails` gem in `Gemfile`?\r\n\r\n#### References\r\nhttps://github.com/mperham/sidekiq/blob/master/lib/sidekiq/middleware/server/active_record.rb#L9","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3787/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/3787/timeline","performed_via_github_app":null,"state_reason":"completed"}