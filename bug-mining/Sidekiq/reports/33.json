{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/480","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/480/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/480/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/480/events","html_url":"https://github.com/sidekiq/sidekiq/issues/480","id":7980184,"node_id":"MDU6SXNzdWU3OTgwMTg0","number":480,"title":"Similar retry times for multiple failed jobs causes jobs to fail again","user":{"login":"bbhoss","id":7044,"node_id":"MDQ6VXNlcjcwNDQ=","avatar_url":"https://avatars.githubusercontent.com/u/7044?v=4","gravatar_id":"","url":"https://api.github.com/users/bbhoss","html_url":"https://github.com/bbhoss","followers_url":"https://api.github.com/users/bbhoss/followers","following_url":"https://api.github.com/users/bbhoss/following{/other_user}","gists_url":"https://api.github.com/users/bbhoss/gists{/gist_id}","starred_url":"https://api.github.com/users/bbhoss/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bbhoss/subscriptions","organizations_url":"https://api.github.com/users/bbhoss/orgs","repos_url":"https://api.github.com/users/bbhoss/repos","events_url":"https://api.github.com/users/bbhoss/events{/privacy}","received_events_url":"https://api.github.com/users/bbhoss/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2012-10-30T20:13:11Z","updated_at":"2012-10-30T22:01:39Z","closed_at":"2012-10-30T22:01:39Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"So I'm running into a problem where I have a full queue of jobs that are super-db intensive. This situation is very rare with my app, but if there were a specific failure it would cause me to hit it. The issue is that when these jobs execute, some of them time out because the combined load on the db causes the queries to either lock on one another or just take much longer in general. When this happens, the jobs' execution time expires (as specified by the `timeout` option) and they go into the retries \"queue.\"\n\nThe actual issue is when the jobs are retried. Since they are all retried around the same time, the exact same issue happens, and the cycle continues. To me, a possible solution is to have a \"splay\" added to the retry time that causes there to be an increasing difference in actual retry times. It seems like this would be a simple enough thing to add, as it should just be a simple multiplication of a random number in the algorithm that determines the retry time. Would you be interested in this feature?\n","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/480/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/480/timeline","performed_via_github_app":null,"state_reason":"completed"}