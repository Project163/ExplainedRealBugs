[{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1070994896","html_url":"https://github.com/sidekiq/sidekiq/issues/5246#issuecomment-1070994896","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5246","id":1070994896,"node_id":"IC_kwDOADDA9M4_1hXQ","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-17T15:43:18Z","updated_at":"2022-03-17T15:43:18Z","body":"Can you give me more detail about your middleware? What deprecation warning?","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1070994896/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1071036097","html_url":"https://github.com/sidekiq/sidekiq/issues/5246#issuecomment-1071036097","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5246","id":1071036097,"node_id":"IC_kwDOADDA9M4_1rbB","user":{"login":"benedikt","id":9696,"node_id":"MDQ6VXNlcjk2OTY=","avatar_url":"https://avatars.githubusercontent.com/u/9696?v=4","gravatar_id":"","url":"https://api.github.com/users/benedikt","html_url":"https://github.com/benedikt","followers_url":"https://api.github.com/users/benedikt/followers","following_url":"https://api.github.com/users/benedikt/following{/other_user}","gists_url":"https://api.github.com/users/benedikt/gists{/gist_id}","starred_url":"https://api.github.com/users/benedikt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benedikt/subscriptions","organizations_url":"https://api.github.com/users/benedikt/orgs","repos_url":"https://api.github.com/users/benedikt/repos","events_url":"https://api.github.com/users/benedikt/events{/privacy}","received_events_url":"https://api.github.com/users/benedikt/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-17T16:16:52Z","updated_at":"2022-03-17T16:16:52Z","body":"The middleware is converting objects that implement `GlobalID::Identification` into a known JSON object and vice-versa. \r\n\r\nThe deprecation warning I'm getting is this: \r\n\r\n```\r\nWARN: Job arguments to DemoWorker do not serialize to JSON safely. This will raise an error in\r\nSidekiq 7.0. See https://github.com/mperham/sidekiq/wiki/Best-Practices or raise an error today\r\nby calling `Sidekiq.strict_args!` during Sidekiq initialization.\r\n```","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1071036097/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"benedikt","id":9696,"node_id":"MDQ6VXNlcjk2OTY=","avatar_url":"https://avatars.githubusercontent.com/u/9696?v=4","gravatar_id":"","url":"https://api.github.com/users/benedikt","html_url":"https://github.com/benedikt","followers_url":"https://api.github.com/users/benedikt/followers","following_url":"https://api.github.com/users/benedikt/following{/other_user}","gists_url":"https://api.github.com/users/benedikt/gists{/gist_id}","starred_url":"https://api.github.com/users/benedikt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benedikt/subscriptions","organizations_url":"https://api.github.com/users/benedikt/orgs","repos_url":"https://api.github.com/users/benedikt/repos","events_url":"https://api.github.com/users/benedikt/events{/privacy}","received_events_url":"https://api.github.com/users/benedikt/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1071046758","html_url":"https://github.com/sidekiq/sidekiq/issues/5246#issuecomment-1071046758","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5246","id":1071046758,"node_id":"IC_kwDOADDA9M4_1uBm","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-17T16:24:22Z","updated_at":"2022-03-17T16:24:22Z","body":"Ah, I see. You are using a middleware to convert unsupported arguments into something which will safely serialize. So you need the validation to occur after the middleware runs. Got it and I agree ðŸ’¯, will fix.","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1071046758/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1071048402","html_url":"https://github.com/sidekiq/sidekiq/issues/5246#issuecomment-1071048402","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5246","id":1071048402,"node_id":"IC_kwDOADDA9M4_1ubS","user":{"login":"benedikt","id":9696,"node_id":"MDQ6VXNlcjk2OTY=","avatar_url":"https://avatars.githubusercontent.com/u/9696?v=4","gravatar_id":"","url":"https://api.github.com/users/benedikt","html_url":"https://github.com/benedikt","followers_url":"https://api.github.com/users/benedikt/followers","following_url":"https://api.github.com/users/benedikt/following{/other_user}","gists_url":"https://api.github.com/users/benedikt/gists{/gist_id}","starred_url":"https://api.github.com/users/benedikt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benedikt/subscriptions","organizations_url":"https://api.github.com/users/benedikt/orgs","repos_url":"https://api.github.com/users/benedikt/repos","events_url":"https://api.github.com/users/benedikt/events{/privacy}","received_events_url":"https://api.github.com/users/benedikt/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-17T16:25:47Z","updated_at":"2022-03-17T16:25:47Z","body":"Exactly! Sorry for not explaining it better in my first try.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1071048402/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"benedikt","id":9696,"node_id":"MDQ6VXNlcjk2OTY=","avatar_url":"https://avatars.githubusercontent.com/u/9696?v=4","gravatar_id":"","url":"https://api.github.com/users/benedikt","html_url":"https://github.com/benedikt","followers_url":"https://api.github.com/users/benedikt/followers","following_url":"https://api.github.com/users/benedikt/following{/other_user}","gists_url":"https://api.github.com/users/benedikt/gists{/gist_id}","starred_url":"https://api.github.com/users/benedikt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/benedikt/subscriptions","organizations_url":"https://api.github.com/users/benedikt/orgs","repos_url":"https://api.github.com/users/benedikt/repos","events_url":"https://api.github.com/users/benedikt/events{/privacy}","received_events_url":"https://api.github.com/users/benedikt/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":6260951254,"node_id":"CE_lADOADDA9M5F3LRCzwAAAAF1LojW","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/6260951254","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"a8c4966cdcc4a95879434eaa10ee26a232f3035f","commit_url":"https://api.github.com/repos/sidekiq/sidekiq/commits/a8c4966cdcc4a95879434eaa10ee26a232f3035f","created_at":"2022-03-17T17:42:41Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"adamniedzielski","id":2426386,"node_id":"MDQ6VXNlcjI0MjYzODY=","avatar_url":"https://avatars.githubusercontent.com/u/2426386?v=4","gravatar_id":"","url":"https://api.github.com/users/adamniedzielski","html_url":"https://github.com/adamniedzielski","followers_url":"https://api.github.com/users/adamniedzielski/followers","following_url":"https://api.github.com/users/adamniedzielski/following{/other_user}","gists_url":"https://api.github.com/users/adamniedzielski/gists{/gist_id}","starred_url":"https://api.github.com/users/adamniedzielski/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adamniedzielski/subscriptions","organizations_url":"https://api.github.com/users/adamniedzielski/orgs","repos_url":"https://api.github.com/users/adamniedzielski/repos","events_url":"https://api.github.com/users/adamniedzielski/events{/privacy}","received_events_url":"https://api.github.com/users/adamniedzielski/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-22T07:17:31Z","updated_at":"2022-03-22T07:17:31Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5252","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5252/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5252/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5252/events","html_url":"https://github.com/sidekiq/sidekiq/issues/5252","id":1176088965,"node_id":"I_kwDOADDA9M5GGbGF","number":5252,"title":"I think that the `json_safe?` method should return true for symbols, to avoid the \"Job arguments to **** must be native JSON types\" error","user":{"login":"ndbroadbent","id":139536,"node_id":"MDQ6VXNlcjEzOTUzNg==","avatar_url":"https://avatars.githubusercontent.com/u/139536?v=4","gravatar_id":"","url":"https://api.github.com/users/ndbroadbent","html_url":"https://github.com/ndbroadbent","followers_url":"https://api.github.com/users/ndbroadbent/followers","following_url":"https://api.github.com/users/ndbroadbent/following{/other_user}","gists_url":"https://api.github.com/users/ndbroadbent/gists{/gist_id}","starred_url":"https://api.github.com/users/ndbroadbent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ndbroadbent/subscriptions","organizations_url":"https://api.github.com/users/ndbroadbent/orgs","repos_url":"https://api.github.com/users/ndbroadbent/repos","events_url":"https://api.github.com/users/ndbroadbent/events{/privacy}","received_events_url":"https://api.github.com/users/ndbroadbent/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2022-03-21T23:46:55Z","updated_at":"2022-03-22T07:17:31Z","closed_at":"2022-03-22T00:39:58Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":3195124,"node_id":"MDEwOlJlcG9zaXRvcnkzMTk1MTI0","name":"sidekiq","full_name":"sidekiq/sidekiq","private":false,"owner":{"login":"sidekiq","id":124714131,"node_id":"O_kgDOB278kw","avatar_url":"https://avatars.githubusercontent.com/u/124714131?v=4","gravatar_id":"","url":"https://api.github.com/users/sidekiq","html_url":"https://github.com/sidekiq","followers_url":"https://api.github.com/users/sidekiq/followers","following_url":"https://api.github.com/users/sidekiq/following{/other_user}","gists_url":"https://api.github.com/users/sidekiq/gists{/gist_id}","starred_url":"https://api.github.com/users/sidekiq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sidekiq/subscriptions","organizations_url":"https://api.github.com/users/sidekiq/orgs","repos_url":"https://api.github.com/users/sidekiq/repos","events_url":"https://api.github.com/users/sidekiq/events{/privacy}","received_events_url":"https://api.github.com/users/sidekiq/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/sidekiq/sidekiq","description":"Simple, efficient background processing for Ruby","fork":false,"url":"https://api.github.com/repos/sidekiq/sidekiq","forks_url":"https://api.github.com/repos/sidekiq/sidekiq/forks","keys_url":"https://api.github.com/repos/sidekiq/sidekiq/keys{/key_id}","collaborators_url":"https://api.github.com/repos/sidekiq/sidekiq/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/sidekiq/sidekiq/teams","hooks_url":"https://api.github.com/repos/sidekiq/sidekiq/hooks","issue_events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events{/number}","events_url":"https://api.github.com/repos/sidekiq/sidekiq/events","assignees_url":"https://api.github.com/repos/sidekiq/sidekiq/assignees{/user}","branches_url":"https://api.github.com/repos/sidekiq/sidekiq/branches{/branch}","tags_url":"https://api.github.com/repos/sidekiq/sidekiq/tags","blobs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/sidekiq/sidekiq/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/sidekiq/sidekiq/git/refs{/sha}","trees_url":"https://api.github.com/repos/sidekiq/sidekiq/git/trees{/sha}","statuses_url":"https://api.github.com/repos/sidekiq/sidekiq/statuses/{sha}","languages_url":"https://api.github.com/repos/sidekiq/sidekiq/languages","stargazers_url":"https://api.github.com/repos/sidekiq/sidekiq/stargazers","contributors_url":"https://api.github.com/repos/sidekiq/sidekiq/contributors","subscribers_url":"https://api.github.com/repos/sidekiq/sidekiq/subscribers","subscription_url":"https://api.github.com/repos/sidekiq/sidekiq/subscription","commits_url":"https://api.github.com/repos/sidekiq/sidekiq/commits{/sha}","git_commits_url":"https://api.github.com/repos/sidekiq/sidekiq/git/commits{/sha}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/comments{/number}","issue_comment_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments{/number}","contents_url":"https://api.github.com/repos/sidekiq/sidekiq/contents/{+path}","compare_url":"https://api.github.com/repos/sidekiq/sidekiq/compare/{base}...{head}","merges_url":"https://api.github.com/repos/sidekiq/sidekiq/merges","archive_url":"https://api.github.com/repos/sidekiq/sidekiq/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/sidekiq/sidekiq/downloads","issues_url":"https://api.github.com/repos/sidekiq/sidekiq/issues{/number}","pulls_url":"https://api.github.com/repos/sidekiq/sidekiq/pulls{/number}","milestones_url":"https://api.github.com/repos/sidekiq/sidekiq/milestones{/number}","notifications_url":"https://api.github.com/repos/sidekiq/sidekiq/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/labels{/name}","releases_url":"https://api.github.com/repos/sidekiq/sidekiq/releases{/id}","deployments_url":"https://api.github.com/repos/sidekiq/sidekiq/deployments","created_at":"2012-01-16T23:17:27Z","updated_at":"2025-11-09T20:20:41Z","pushed_at":"2025-11-07T17:29:44Z","git_url":"git://github.com/sidekiq/sidekiq.git","ssh_url":"git@github.com:sidekiq/sidekiq.git","clone_url":"https://github.com/sidekiq/sidekiq.git","svn_url":"https://github.com/sidekiq/sidekiq","homepage":"https://sidekiq.org","size":14680,"stargazers_count":13447,"watchers_count":13447,"language":"Ruby","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":true,"has_pages":true,"has_discussions":true,"forks_count":2471,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":40,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["background-jobs","jobs","ruby","sidekiq"],"visibility":"public","forks":2471,"open_issues":40,"watchers":13447,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Ruby version: 2.7.1\r\nRails version: 6.0.4.6\r\nSidekiq / Pro / Enterprise version(s): Sidekiq 6.4.0\r\n\r\nI had to hunt down why the `Job arguments to #{item[\"class\"]} must be native JSON types` error was happening in `lib/sidekiq/job_util.rb`. It turned out that `json_safe?(item)` was returning false because I passing in a symbol as the first job argument. I have some [Shrine](https://github.com/shrinerb/shrine) uploader jobs that use symbols for the action arg (`:promote`, `:delete`):\r\n\r\n```\r\nclass TemplateUploader < Shrine\r\n  Attacher.promote do |data|\r\n    ShrineJob.perform_async(:promote, data)\r\n  end\r\n  Attacher.delete do |data|\r\n    ShrineJob.perform_async(:delete, data)\r\n  end\r\n\r\n  # ...\r\n```\r\n\r\nI believe it's generally safe to convert symbols to strings, so I was wondering if `json_safe?` could be a bit more lenient. Here's [the original method](https://github.com/mperham/sidekiq/blob/b473cfa40018febe9abcd4fc771bbfa8f8c46a9a/lib/sidekiq/job_util.rb#L63-L65):\r\n\r\n```\r\n    def json_safe?(item)\r\n      JSON.parse(JSON.dump(item[\"args\"])) == item[\"args\"]\r\n    end\r\n```\r\n\r\nWhat do you think about this change?\r\n\r\n```\r\n    def json_safe?(item)\r\n      stringified_args = item[\"args\"].map { |arg| arg.is_a?(Symbol) ? arg.to_s : arg }\r\n      JSON.parse(JSON.dump(item[\"args\"])) == stringified_args\r\n    end\r\n```\r\n\r\n*(Could even go a little further to ignore symbols in hash keys: `arg.is_a?(Hash) ? arg.with_indifferent_access : arg`)*\r\n\r\nI don't feel too strongly about it, but it would have just saved me a little bit of time. Would you accept a PR with this change? (No worries if not, I'm happy to switch them to strings.)","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5252/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5252/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1077937169","html_url":"https://github.com/sidekiq/sidekiq/issues/5246#issuecomment-1077937169","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5246","id":1077937169,"node_id":"IC_kwDOADDA9M5AQAQR","user":{"login":"keiko713","id":911433,"node_id":"MDQ6VXNlcjkxMTQzMw==","avatar_url":"https://avatars.githubusercontent.com/u/911433?v=4","gravatar_id":"","url":"https://api.github.com/users/keiko713","html_url":"https://github.com/keiko713","followers_url":"https://api.github.com/users/keiko713/followers","following_url":"https://api.github.com/users/keiko713/following{/other_user}","gists_url":"https://api.github.com/users/keiko713/gists{/gist_id}","starred_url":"https://api.github.com/users/keiko713/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keiko713/subscriptions","organizations_url":"https://api.github.com/users/keiko713/orgs","repos_url":"https://api.github.com/users/keiko713/repos","events_url":"https://api.github.com/users/keiko713/events{/privacy}","received_events_url":"https://api.github.com/users/keiko713/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-24T18:46:55Z","updated_at":"2022-03-24T18:46:55Z","body":"Thanks for the quick fix on this! We're hitting the same issue and glad that it's fixed now. I wonder if you have a plan to cut a new version release with this change, so that we can use this fix.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1077937169/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"keiko713","id":911433,"node_id":"MDQ6VXNlcjkxMTQzMw==","avatar_url":"https://avatars.githubusercontent.com/u/911433?v=4","gravatar_id":"","url":"https://api.github.com/users/keiko713","html_url":"https://github.com/keiko713","followers_url":"https://api.github.com/users/keiko713/followers","following_url":"https://api.github.com/users/keiko713/following{/other_user}","gists_url":"https://api.github.com/users/keiko713/gists{/gist_id}","starred_url":"https://api.github.com/users/keiko713/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keiko713/subscriptions","organizations_url":"https://api.github.com/users/keiko713/orgs","repos_url":"https://api.github.com/users/keiko713/repos","events_url":"https://api.github.com/users/keiko713/events{/privacy}","received_events_url":"https://api.github.com/users/keiko713/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1077943990","html_url":"https://github.com/sidekiq/sidekiq/issues/5246#issuecomment-1077943990","issue_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/5246","id":1077943990,"node_id":"IC_kwDOADDA9M5AQB62","user":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-24T18:53:32Z","updated_at":"2022-03-24T18:53:32Z","body":"You can run main for now. I donâ€™t plan a release in the next week.\n\nOn Thu, Mar 24, 2022 at 12:47 Keiko Oda ***@***.***> wrote:\n\n> Thanks for the quick fix on this! We're hitting the same issue and glad\n> that it's fixed now. I wonder if you have a plan to cut a new version\n> release with this change, so that we can use this fix.\n>\n> â€”\n> Reply to this email directly, view it on GitHub\n> <https://github.com/mperham/sidekiq/issues/5246#issuecomment-1077937169>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AAAAWX7ND2V7KEQ44R6R6WDVBS2CVANCNFSM5Q6IKQ4A>\n> .\n> You are receiving this because you modified the open/close state.Message\n> ID: ***@***.***>\n>\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/comments/1077943990/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"viralpraxis","id":39729785,"node_id":"MDQ6VXNlcjM5NzI5Nzg1","avatar_url":"https://avatars.githubusercontent.com/u/39729785?v=4","gravatar_id":"","url":"https://api.github.com/users/viralpraxis","html_url":"https://github.com/viralpraxis","followers_url":"https://api.github.com/users/viralpraxis/followers","following_url":"https://api.github.com/users/viralpraxis/following{/other_user}","gists_url":"https://api.github.com/users/viralpraxis/gists{/gist_id}","starred_url":"https://api.github.com/users/viralpraxis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/viralpraxis/subscriptions","organizations_url":"https://api.github.com/users/viralpraxis/orgs","repos_url":"https://api.github.com/users/viralpraxis/repos","events_url":"https://api.github.com/users/viralpraxis/events{/privacy}","received_events_url":"https://api.github.com/users/viralpraxis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-11-16T20:11:04Z","updated_at":"2023-11-16T20:11:04Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/rails/rails/issues/50076","repository_url":"https://api.github.com/repos/rails/rails","labels_url":"https://api.github.com/repos/rails/rails/issues/50076/labels{/name}","comments_url":"https://api.github.com/repos/rails/rails/issues/50076/comments","events_url":"https://api.github.com/repos/rails/rails/issues/50076/events","html_url":"https://github.com/rails/rails/issues/50076","id":1997687108,"node_id":"I_kwDNIULOdxJJRA","number":50076,"title":"Incorrect serialization of `ActiveSupport::StringInquirer` instances ","user":{"login":"viralpraxis","id":39729785,"node_id":"MDQ6VXNlcjM5NzI5Nzg1","avatar_url":"https://avatars.githubusercontent.com/u/39729785?v=4","gravatar_id":"","url":"https://api.github.com/users/viralpraxis","html_url":"https://github.com/viralpraxis","followers_url":"https://api.github.com/users/viralpraxis/followers","following_url":"https://api.github.com/users/viralpraxis/following{/other_user}","gists_url":"https://api.github.com/users/viralpraxis/gists{/gist_id}","starred_url":"https://api.github.com/users/viralpraxis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/viralpraxis/subscriptions","organizations_url":"https://api.github.com/users/viralpraxis/orgs","repos_url":"https://api.github.com/users/viralpraxis/repos","events_url":"https://api.github.com/users/viralpraxis/events{/privacy}","received_events_url":"https://api.github.com/users/viralpraxis/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":123812746,"node_id":"MDU6TGFiZWwxMjM4MTI3NDY=","url":"https://api.github.com/repos/rails/rails/labels/activejob","name":"activejob","color":"5319e7","default":false,"description":null},{"id":126910270,"node_id":"MDU6TGFiZWwxMjY5MTAyNzA=","url":"https://api.github.com/repos/rails/rails/labels/With%20reproduction%20steps","name":"With reproduction steps","color":"009800","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":14,"created_at":"2023-11-16T20:11:03Z","updated_at":"2023-11-18T00:09:29Z","closed_at":"2023-11-18T00:09:29Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":8514,"node_id":"MDEwOlJlcG9zaXRvcnk4NTE0","name":"rails","full_name":"rails/rails","private":false,"owner":{"login":"rails","id":4223,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQyMjM=","avatar_url":"https://avatars.githubusercontent.com/u/4223?v=4","gravatar_id":"","url":"https://api.github.com/users/rails","html_url":"https://github.com/rails","followers_url":"https://api.github.com/users/rails/followers","following_url":"https://api.github.com/users/rails/following{/other_user}","gists_url":"https://api.github.com/users/rails/gists{/gist_id}","starred_url":"https://api.github.com/users/rails/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rails/subscriptions","organizations_url":"https://api.github.com/users/rails/orgs","repos_url":"https://api.github.com/users/rails/repos","events_url":"https://api.github.com/users/rails/events{/privacy}","received_events_url":"https://api.github.com/users/rails/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/rails/rails","description":"Ruby on Rails","fork":false,"url":"https://api.github.com/repos/rails/rails","forks_url":"https://api.github.com/repos/rails/rails/forks","keys_url":"https://api.github.com/repos/rails/rails/keys{/key_id}","collaborators_url":"https://api.github.com/repos/rails/rails/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/rails/rails/teams","hooks_url":"https://api.github.com/repos/rails/rails/hooks","issue_events_url":"https://api.github.com/repos/rails/rails/issues/events{/number}","events_url":"https://api.github.com/repos/rails/rails/events","assignees_url":"https://api.github.com/repos/rails/rails/assignees{/user}","branches_url":"https://api.github.com/repos/rails/rails/branches{/branch}","tags_url":"https://api.github.com/repos/rails/rails/tags","blobs_url":"https://api.github.com/repos/rails/rails/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/rails/rails/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/rails/rails/git/refs{/sha}","trees_url":"https://api.github.com/repos/rails/rails/git/trees{/sha}","statuses_url":"https://api.github.com/repos/rails/rails/statuses/{sha}","languages_url":"https://api.github.com/repos/rails/rails/languages","stargazers_url":"https://api.github.com/repos/rails/rails/stargazers","contributors_url":"https://api.github.com/repos/rails/rails/contributors","subscribers_url":"https://api.github.com/repos/rails/rails/subscribers","subscription_url":"https://api.github.com/repos/rails/rails/subscription","commits_url":"https://api.github.com/repos/rails/rails/commits{/sha}","git_commits_url":"https://api.github.com/repos/rails/rails/git/commits{/sha}","comments_url":"https://api.github.com/repos/rails/rails/comments{/number}","issue_comment_url":"https://api.github.com/repos/rails/rails/issues/comments{/number}","contents_url":"https://api.github.com/repos/rails/rails/contents/{+path}","compare_url":"https://api.github.com/repos/rails/rails/compare/{base}...{head}","merges_url":"https://api.github.com/repos/rails/rails/merges","archive_url":"https://api.github.com/repos/rails/rails/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/rails/rails/downloads","issues_url":"https://api.github.com/repos/rails/rails/issues{/number}","pulls_url":"https://api.github.com/repos/rails/rails/pulls{/number}","milestones_url":"https://api.github.com/repos/rails/rails/milestones{/number}","notifications_url":"https://api.github.com/repos/rails/rails/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/rails/rails/labels{/name}","releases_url":"https://api.github.com/repos/rails/rails/releases{/id}","deployments_url":"https://api.github.com/repos/rails/rails/deployments","created_at":"2008-04-11T02:19:47Z","updated_at":"2025-11-10T02:03:47Z","pushed_at":"2025-11-10T00:33:52Z","git_url":"git://github.com/rails/rails.git","ssh_url":"git@github.com:rails/rails.git","clone_url":"https://github.com/rails/rails.git","svn_url":"https://github.com/rails/rails","homepage":"https://rubyonrails.org","size":271619,"stargazers_count":57840,"watchers_count":57840,"language":"Ruby","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":22025,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1341,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["activejob","activerecord","framework","html","mvc","rails","ruby"],"visibility":"public","forks":22025,"open_issues":1341,"watchers":57840,"default_branch":"main","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"### Steps to reproduce\r\n\r\nConsider the following MRE:\r\n\r\n```ruby\r\n# frozen_string_literal: true\r\n\r\nrequire \"bundler/inline\"\r\n\r\ngemfile(true) do\r\n  source \"https://rubygems.org\"\r\n\r\n  git_source(:github) { |repo| \"https://github.com/#{repo}.git\" }\r\n\r\n  # Activate the gem you are reporting the issue against.\r\n  gem \"activejob\", \"~> 7.1.0\"\r\n  gem \"sidekiq\", \"~> 7.2.0\"\r\nend\r\n\r\nrequire \"minitest/autorun\"\r\nrequire \"active_job\"\r\nrequire \"active_support/core_ext/string/inquiry\"\r\n\r\nclass BuggyJob < ActiveJob::Base\r\n  self.queue_adapter = :sidekiq\r\n\r\n  def perform(argument)\r\n    p argument\r\n  end\r\nend\r\n\r\nclass BuggyJobTest < ActiveJob::TestCase\r\n  def test_stuff\r\n    BuggyJob.perform_later(\"paid\".inquiry)\r\n    perform_enqueued_jobs\r\n  end\r\n\r\n  def queue_adapter_for_test\r\n    ActiveJob::QueueAdapters::SidekiqAdapter.new\r\n  end\r\nend\r\n```\r\n\r\nBasically we pass an instance of `ActiveSupport::StringInquirer` to `.perform_later` (note that queue adapter is set to `sidekiq`), and I expect it to be serialized correctly. In fact, an exception occurs (I believe that's because of [this](https://github.com/sidekiq/sidekiq/issues/5246) sidekiq change.)\r\n\r\nIt happenes because here\r\n\r\nhttps://github.com/rails/rails/blob/6b93fff8af32ef5e91f4ec3cfffb081d0553faf0/activejob/lib/active_job/arguments.rb#L74-L76\r\n\r\nfirst comparsion (with `PERMITTED_TYPES`) passes because that's equivalent with\r\n\r\n```ruby\r\n[String].any? { \"foo\".inquiry.is_a? _1 }\r\ntrue\r\n```\r\n\r\nUnfortunately, it cannot be bypassed \"in place\" (without monkeypatching) with custom AJ serializer (via `Rails.application.config.active_job.custom_serializers << ` API) because checking against String subclass passes, so fallback for custom serializer doesn't happen.\r\n\r\n\r\n### Expected behavior\r\nI expect an instance of `ActiveSupport::StringInquirer` to be serialized and serialized correctly.\r\n\r\nSerialization should be as easy as\r\n\r\n```ruby\r\nclass StringInquirerSerializer < ObjectSerializer # :nodoc:\r\n  def serialize(argument)\r\n    super(\"value\" => argument.to_s)\r\n  end\r\n\r\n  def deserialize(argument)\r\n    argument[\"value\"].inquiry\r\n  end\r\n\r\n  private\r\n    def klass\r\n      ActiveSupport::StringInquirer\r\n    end\r\nend\r\n```\r\n\r\nso I don't see why this custom serializer (with taking into account the issue I mentioned above) wouldn't work. \r\n\r\n### Actual behavior\r\n```\r\n  1) Error:\r\nBuggyJobTest#test_stuff:\r\nArgumentError: Job arguments to BuggyJob must be native JSON types, but \"paid\" is a ActiveSupport::StringInquirer.\r\nSee https://github.com/sidekiq/sidekiq/wiki/Best-Practices\r\nTo disable this error, add `Sidekiq.strict_args!(false)` to your initializer.\r\n\r\n\r\n.../sidekiq-7.2.0/lib/sidekiq/job_util.rb:33:in `verify_json'\r\n.../sidekiq-7.2.0/lib/sidekiq/client.rb:92:in `push'\r\n.../sidekiq-7.2.0/lib/sidekiq/job.rb:361:in `client_push'\r\n...\r\n```\r\n\r\n\r\n### System configuration\r\n**Rails version**: 7.0.8, 7.1.2\r\n**Ruby version**: 3.2.2\r\n**Sidekiq version**: 7.2.0\r\n","reactions":{"url":"https://api.github.com/repos/rails/rails/issues/50076/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/rails/rails/issues/50076/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"id":11730283870,"node_id":"REFE_lADOADDA9M5F3LRCzwAAAAK7Le1e","url":"https://api.github.com/repos/sidekiq/sidekiq/issues/events/11730283870","actor":{"login":"motchang","id":1159316,"node_id":"MDQ6VXNlcjExNTkzMTY=","avatar_url":"https://avatars.githubusercontent.com/u/1159316?v=4","gravatar_id":"","url":"https://api.github.com/users/motchang","html_url":"https://github.com/motchang","followers_url":"https://api.github.com/users/motchang/followers","following_url":"https://api.github.com/users/motchang/following{/other_user}","gists_url":"https://api.github.com/users/motchang/gists{/gist_id}","starred_url":"https://api.github.com/users/motchang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/motchang/subscriptions","organizations_url":"https://api.github.com/users/motchang/orgs","repos_url":"https://api.github.com/users/motchang/repos","events_url":"https://api.github.com/users/motchang/events{/privacy}","received_events_url":"https://api.github.com/users/motchang/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"a8c4966cdcc4a95879434eaa10ee26a232f3035f","commit_url":"https://api.github.com/repos/motchang/sidekiq/commits/a8c4966cdcc4a95879434eaa10ee26a232f3035f","created_at":"2024-02-07T10:21:17Z","performed_via_github_app":null}]