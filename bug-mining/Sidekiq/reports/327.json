{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6376","repository_url":"https://api.github.com/repos/sidekiq/sidekiq","labels_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6376/labels{/name}","comments_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6376/comments","events_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6376/events","html_url":"https://github.com/sidekiq/sidekiq/issues/6376","id":2429949955,"node_id":"I_kwDOADDA9M6Q1hgD","number":6376,"title":"Sidekiq 7.x on Ruby 2.7 crashes on `hash.except(\"at\")`","user":{"login":"mhenrixon","id":106795,"node_id":"MDQ6VXNlcjEwNjc5NQ==","avatar_url":"https://avatars.githubusercontent.com/u/106795?v=4","gravatar_id":"","url":"https://api.github.com/users/mhenrixon","html_url":"https://github.com/mhenrixon","followers_url":"https://api.github.com/users/mhenrixon/followers","following_url":"https://api.github.com/users/mhenrixon/following{/other_user}","gists_url":"https://api.github.com/users/mhenrixon/gists{/gist_id}","starred_url":"https://api.github.com/users/mhenrixon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mhenrixon/subscriptions","organizations_url":"https://api.github.com/users/mhenrixon/orgs","repos_url":"https://api.github.com/users/mhenrixon/repos","events_url":"https://api.github.com/users/mhenrixon/events{/privacy}","received_events_url":"https://api.github.com/users/mhenrixon/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2024-07-25T13:18:53Z","updated_at":"2024-07-27T08:14:18Z","closed_at":"2024-07-27T08:14:18Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Ruby version: 2.7\r\nRails version: None\r\nSidekiq / Pro / Enterprise version(s):\r\n\r\nhttps://github.com/mhenrixon/sidekiq-unique-jobs/actions/runs/10094768753/job/27913351109?pr=853 \r\n\r\nIt looks like ruby 2.7 is failing all Sidekiq 7.x versions due to the method `.except` not being available on a hash. \r\n\r\n```\r\n32) UntilExpiredJob client middleware when job is delayed sets keys to expire as per configuration\r\n      Failure/Error: before { described_class.perform_in(60, 1, 2) }\r\n\r\n      NoMethodError:\r\n        undefined method `except' for #<Hash:0x000055974be61490>\r\n      # ./vendor/bundle/ruby/2.7.0/gems/sidekiq-7.3.0/lib/sidekiq/client.rb:254:in `block in atomic_push'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/sidekiq-7.3.0/lib/sidekiq/client.rb:250:in `each'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/sidekiq-7.3.0/lib/sidekiq/client.rb:250:in `flat_map'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/sidekiq-7.3.0/lib/sidekiq/client.rb:250:in `atomic_push'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/sidekiq-7.3.0/lib/sidekiq/testing.rb:103:in `atomic_push'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/sidekiq-7.3.0/lib/sidekiq/client.rb:229:in `block (2 levels) in raw_push'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/redis-client-0.22.2/lib/redis_client/decorator.rb:51:in `block in pipelined'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/redis-client-0.22.2/lib/redis_client.rb:426:in `pipelined'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/redis-client-0.22.2/lib/redis_client/decorator.rb:51:in `pipelined'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/sidekiq-7.3.0/lib/sidekiq/client.rb:228:in `block in raw_push'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/connection_pool-2.4.1/lib/connection_pool.rb:110:in `block (2 levels) in with'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/connection_pool-2.4.1/lib/connection_pool.rb:109:in `handle_interrupt'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/connection_pool-2.4.1/lib/connection_pool.rb:109:in `block in with'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/connection_pool-2.4.1/lib/connection_pool.rb:106:in `handle_interrupt'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/connection_pool-2.4.1/lib/connection_pool.rb:106:in `with'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/sidekiq-7.3.0/lib/sidekiq/client.rb:225:in `raw_push'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/sidekiq-7.3.0/lib/sidekiq/client.rb:93:in `push'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/sidekiq-7.3.0/lib/sidekiq/job.rb:372:in `client_push'\r\n      # ./vendor/bundle/ruby/2.7.0/gems/sidekiq-7.3.0/lib/sidekiq/job.rb:342:in `perform_in'\r\n      # ./spec/workers/until_expired_job_spec.rb:21:in `block (4 levels) in <top (required)>'\r\n```\r\n","closed_by":{"login":"mperham","id":2911,"node_id":"MDQ6VXNlcjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/2911?v=4","gravatar_id":"","url":"https://api.github.com/users/mperham","html_url":"https://github.com/mperham","followers_url":"https://api.github.com/users/mperham/followers","following_url":"https://api.github.com/users/mperham/following{/other_user}","gists_url":"https://api.github.com/users/mperham/gists{/gist_id}","starred_url":"https://api.github.com/users/mperham/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mperham/subscriptions","organizations_url":"https://api.github.com/users/mperham/orgs","repos_url":"https://api.github.com/users/mperham/repos","events_url":"https://api.github.com/users/mperham/events{/privacy}","received_events_url":"https://api.github.com/users/mperham/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6376/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sidekiq/sidekiq/issues/6376/timeline","performed_via_github_app":null,"state_reason":"completed"}