diff --git a/CHANGES b/CHANGES
index c8af531..19d5d48 100644
--- a/CHANGES
+++ b/CHANGES
@@ -10,6 +10,8 @@ Version 4.1
 
 - Fix a bug where error messages would include a trailing `None` string.
 - Fix a bug where Click would crash on docstrings with trailing newlines.
+- Support streams with encoding set to `None` on Python 3 by barfing with
+  a better error.
 
 Version 4.0
 -----------
diff --git a/click/_compat.py b/click/_compat.py
index c93868b..60c8162 100644
--- a/click/_compat.py
+++ b/click/_compat.py
@@ -255,7 +255,11 @@ else:
 
     def _stream_is_misconfigured(stream):
         """A stream is misconfigured if its encoding is ASCII."""
-        return is_ascii_encoding(getattr(stream, 'encoding', None))
+        # If the stream does not have an encoding set, we assume it's set
+        # to ASCII.  This appears to happen in certain unittest
+        # environments.  It's not quite clear what the correct behavior is
+        # but this at least will force Click to recover somehow.
+        return is_ascii_encoding(getattr(stream, 'encoding', None) or 'ascii')
 
     def _is_compatible_text_stream(stream, encoding, errors):
         stream_encoding = getattr(stream, 'encoding', None)
