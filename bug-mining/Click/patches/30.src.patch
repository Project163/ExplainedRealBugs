diff --git a/CHANGES b/CHANGES
index fefe033..49a270b 100644
--- a/CHANGES
+++ b/CHANGES
@@ -14,6 +14,7 @@ Version 6.0
   cannot be supported with the current setup of how the invocation for
   subcommands works.
 - Explicitly disallow nargs=-1 with a set default.
+- The context is now closed before it's popped from the stack.
 
 Version 5.1
 -----------
diff --git a/click/core.py b/click/core.py
index 500cd85..94f81e6 100644
--- a/click/core.py
+++ b/click/core.py
@@ -318,10 +318,10 @@ class Context(object):
         return self
 
     def __exit__(self, exc_type, exc_value, tb):
-        pop_context()
         self._depth -= 1
         if self._depth == 0:
             self.close()
+        pop_context()
 
     @contextmanager
     def scope(self, cleanup=True):
diff --git a/tests/test_context.py b/tests/test_context.py
index c5ac9c1..cbf9b98 100644
--- a/tests/test_context.py
+++ b/tests/test_context.py
@@ -184,3 +184,22 @@ def test_pass_obj(runner):
     result = runner.invoke(cli, ['test'])
     assert not result.exception
     assert result.output == 'test\n'
+
+
+def test_close_before_pop(runner):
+    called = []
+
+    @click.command()
+    @click.pass_context
+    def cli(ctx):
+        ctx.obj = 'test'
+        @ctx.call_on_close
+        def foo():
+            assert click.get_current_context().obj == 'test'
+            called.append(True)
+        click.echo('aha!')
+
+    result = runner.invoke(cli, [])
+    assert not result.exception
+    assert result.output == 'aha!\n'
+    assert called == [True]
