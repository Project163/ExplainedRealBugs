{"url":"https://api.github.com/repos/pallets/click/issues/1065","repository_url":"https://api.github.com/repos/pallets/click","labels_url":"https://api.github.com/repos/pallets/click/issues/1065/labels{/name}","comments_url":"https://api.github.com/repos/pallets/click/issues/1065/comments","events_url":"https://api.github.com/repos/pallets/click/issues/1065/events","html_url":"https://github.com/pallets/click/issues/1065","id":339877804,"node_id":"MDU6SXNzdWUzMzk4Nzc4MDQ=","number":1065,"title":"Incorrect OSError raised when redirecting to NUL on Windows","user":{"login":"uranusjr","id":605277,"node_id":"MDQ6VXNlcjYwNTI3Nw==","avatar_url":"https://avatars.githubusercontent.com/u/605277?v=4","gravatar_id":"","url":"https://api.github.com/users/uranusjr","html_url":"https://github.com/uranusjr","followers_url":"https://api.github.com/users/uranusjr/followers","following_url":"https://api.github.com/users/uranusjr/following{/other_user}","gists_url":"https://api.github.com/users/uranusjr/gists{/gist_id}","starred_url":"https://api.github.com/users/uranusjr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uranusjr/subscriptions","organizations_url":"https://api.github.com/users/uranusjr/orgs","repos_url":"https://api.github.com/users/uranusjr/repos","events_url":"https://api.github.com/users/uranusjr/events{/privacy}","received_events_url":"https://api.github.com/users/uranusjr/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":932642518,"node_id":"MDU6TGFiZWw5MzI2NDI1MTg=","url":"https://api.github.com/repos/pallets/click/labels/windows","name":"windows","color":"30e8c9","default":false,"description":"Issues pertaining to the Windows environment"}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/pallets/click/milestones/4","html_url":"https://github.com/pallets/click/milestone/4","labels_url":"https://api.github.com/repos/pallets/click/milestones/4/labels","id":3655023,"node_id":"MDk6TWlsZXN0b25lMzY1NTAyMw==","number":4,"title":"7.1","description":"","creator":{"login":"davidism","id":1242887,"node_id":"MDQ6VXNlcjEyNDI4ODc=","avatar_url":"https://avatars.githubusercontent.com/u/1242887?v=4","gravatar_id":"","url":"https://api.github.com/users/davidism","html_url":"https://github.com/davidism","followers_url":"https://api.github.com/users/davidism/followers","following_url":"https://api.github.com/users/davidism/following{/other_user}","gists_url":"https://api.github.com/users/davidism/gists{/gist_id}","starred_url":"https://api.github.com/users/davidism/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidism/subscriptions","organizations_url":"https://api.github.com/users/davidism/orgs","repos_url":"https://api.github.com/users/davidism/repos","events_url":"https://api.github.com/users/davidism/events{/privacy}","received_events_url":"https://api.github.com/users/davidism/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":85,"state":"closed","created_at":"2018-09-14T14:59:39Z","updated_at":"2020-03-09T15:22:28Z","due_on":null,"closed_at":"2020-03-09T15:22:28Z"},"comments":2,"created_at":"2018-07-10T14:50:00Z","updated_at":"2020-11-13T08:02:06Z","closed_at":"2020-02-16T23:12:52Z","author_association":"NONE","type":null,"active_lock_reason":"resolved","sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Reproducible for both Python 3.6 and 3.7. I did not test against older versions.\r\n\r\nTested on the Click 6.x series. Windows 10, Build 17134.\r\n\r\nSteps to reproduce:\r\n\r\n```python\r\n# t.py\r\nimport click\r\n\r\n@click.command()\r\ndef main():\r\n    click.echo('run')\r\n\r\nif __name__ == '__main__':\r\n    main()\r\n```\r\n\r\n```\r\n> python t.py\r\nrun\r\n\r\n> python t.py >NUL\r\nTraceback (most recent call last):\r\n  File \"t.py\", line 10, in <module>\r\n    main()\r\n  File \".venv\\lib\\site-packages\\click\\core.py\", line 722, in __call__\r\n    return self.main(*args, **kwargs)\r\n  File \".venv\\lib\\site-packages\\click\\core.py\", line 697, in main\r\n    rv = self.invoke(ctx)\r\n  File \".venv\\lib\\site-packages\\click\\core.py\", line 895, in invoke\r\n    return ctx.invoke(self.callback, **ctx.params)\r\n  File \".venv\\lib\\site-packages\\click\\core.py\", line 535, in invoke\r\n    return callback(*args, **kwargs)\r\n  File \"t.py\", line 6, in main\r\n    click.echo('run')\r\n  File \".venv\\lib\\site-packages\\click\\utils.py\", line 259, in echo\r\n    file.write(message)\r\n  File \".venv\\lib\\site-packages\\click\\_winconsole.py\", line 180, in write\r\n    return self._text_stream.write(x)\r\n  File \".venv\\lib\\site-packages\\click\\_winconsole.py\", line 164, in write\r\n    raise OSError(self._get_error_message(GetLastError()))\r\nOSError: Windows error 1\r\n```\r\n\r\nI believe the problem is that Click tries to be helpful, and raises an error when there are not bytes written when there should be. This is, however, exactly what is expected to happen when you redirect things to `NUL` on Windows.\r\n\r\nCuriously, however, Windows seems to act a little differently for stderr. `2>NUL` works as expected.","closed_by":{"login":"davidism","id":1242887,"node_id":"MDQ6VXNlcjEyNDI4ODc=","avatar_url":"https://avatars.githubusercontent.com/u/1242887?v=4","gravatar_id":"","url":"https://api.github.com/users/davidism","html_url":"https://github.com/davidism","followers_url":"https://api.github.com/users/davidism/followers","following_url":"https://api.github.com/users/davidism/following{/other_user}","gists_url":"https://api.github.com/users/davidism/gists{/gist_id}","starred_url":"https://api.github.com/users/davidism/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidism/subscriptions","organizations_url":"https://api.github.com/users/davidism/orgs","repos_url":"https://api.github.com/users/davidism/repos","events_url":"https://api.github.com/users/davidism/events{/privacy}","received_events_url":"https://api.github.com/users/davidism/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/pallets/click/issues/1065/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/pallets/click/issues/1065/timeline","performed_via_github_app":null,"state_reason":"completed"}