{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3611","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3611/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3611/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3611/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3611","id":384635657,"node_id":"MDU6SXNzdWUzODQ2MzU2NTc=","number":3611,"title":"Regression joinedload on polymorphic entity","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141273966,"node_id":"MDU6TGFiZWwxMTQxMjczOTY2","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/orm","name":"orm","color":"20C0B0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/57","html_url":"https://github.com/sqlalchemy/sqlalchemy/milestone/57","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/57/labels","id":3850634,"node_id":"MDk6TWlsZXN0b25lMzg1MDYzNA==","number":57,"title":"1.0.xx","description":null,"creator":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":127,"state":"closed","created_at":"2018-11-27T04:15:49Z","updated_at":"2018-11-28T16:49:57Z","due_on":null,"closed_at":"2018-11-28T16:49:57Z"},"comments":9,"created_at":"2015-12-15T08:40:33Z","updated_at":"2015-12-22T02:43:23Z","closed_at":"2015-12-15T19:01:42Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Bastien Chatelard ([@bchatelard](https://github.com/bchatelard))**\n\nI am facing a regression on joinedload on polymorphic entity in 1.0.10.\n\nI have reproduced a minimal test case that works fine in 1.0.9 and does not in 1.0.10:\n \n```\nimport sqlalchemy as sa\nimport sqlalchemy.orm\nfrom sqlalchemy.orm import joinedload\nimport sqlalchemy.ext.declarative\nimport sqlalchemy.ext.orderinglist\n\nBase = sqlalchemy.ext.declarative.declarative_base()\n\n\nclass Person(Base):\n    __tablename__ = 'person'\n\n    id = sa.Column(sa.Integer, nullable=False, primary_key=True)\n    person_type = sa.Column(sa.String(20), nullable=False)\n\n    __mapper_args__ = {\n        'polymorphic_on': person_type,\n        'with_polymorphic': '*',\n    }\n\n\nclass User(Person):\n    __mapper_args__ = {'polymorphic_identity': 'user'}\n\n\nclass Admin(Person):\n    __mapper_args__ = {'polymorphic_identity': 'admin'}\n\n\nclass Action(Base):\n    __tablename__ = 'action'\n    id = sa.Column(sa.Integer, nullable=False, primary_key=True)\n\n    author_id = sa.Column(sa.Integer, sa.ForeignKey(User.id))\n    author = sa.orm.relationship('User')\n\n    post_type = sa.Column(sa.String(20), nullable=False)\n\n    __mapper_args__ = {\n        'polymorphic_on': post_type,\n        'polymorphic_identity': 'post',\n        'with_polymorphic': '*',\n    }\n\n\nclass Like(Action):\n    __tablename__ = 'like'\n    __mapper_args__ = {'polymorphic_identity': 'like'}\n    id = sa.Column(sa.Integer, sa.ForeignKey('action.id'), primary_key=True)\n\n\nclass Comment(Action):\n    __tablename__ = 'comment'\n    __mapper_args__ = {'polymorphic_identity': 'comment'}\n    id = sa.Column(sa.Integer, sa.ForeignKey('action.id'), primary_key=True)\n\n    article_id = sa.Column(sa.Integer, sa.ForeignKey('article.id'))\n    article = sa.orm.relationship('Article', primaryjoin='Article.id==Comment.article_id', backref='comments')\n\n\nclass Article(Base):\n    __tablename__ = 'article'\n    id = sa.Column(sa.Integer, nullable=False, primary_key=True)\n\n\nengine = sa.create_engine('sqlite:///:memory:', echo=True)\n\nBase.metadata.drop_all(engine)\nBase.metadata.create_all(engine)\n\nSession = sa.orm.sessionmaker(bind=engine)\nsession = Session()\n\nuser1 = User(id=1)\nadmin1 = Admin(id=2)\nuser2 = User(id=3)\narticle1 = Article(id=1)\ncomment1 = Comment(id=2, author=user1, article_id=1)\ncomment2 = Comment(id=3, author=user2, article_id=1)\n\nsession.add_all([user1, user2, admin1, article1, comment1, comment2])\nsession.commit()\nsession.expunge_all()\n\n\n# Works with 1.0.9\n# Not working with 1.0.10: raise AssertionError\ntry:\n    new_n1 = session.query(Article).options(\n        joinedload(Article.comments).joinedload(Action.author),\n    ).all()\n\n    print new_n1\n    print new_n1[0].comments\n    print new_n1[0].comments[0].author\nexcept AssertionError as e:\n    print e\n\n\n# Works with 1.0.9\n# Not working with 1.0.10: 2 queries\ntry:\n    new_n1 = session.query(Article).options(\n        joinedload('comments'),\n        joinedload('comments.author')\n    ).all()\n\n    print new_n1\n    print new_n1[0].comments\n    print new_n1[0].comments[0].author\nexcept AssertionError as e:\n    print e\n\n# Works with 1.0.9\n# Not working with 1.0.10: raise AssertionError\ntry:\n    new_n1 = session.query(Article).options(\n        joinedload('comments').joinedload('author')\n    ).all()\n\n    print new_n1\n    print new_n1[0].comments\n    print new_n1[0].comments[0].author\nexcept AssertionError as e:\n    print e\n\n# Works with 1.0.9\n# Not working with 1.0.10: raise AssertionError\ntry:\n    new_n1 = session.query(Article).options(\n        joinedload('comments').load_only('id', 'author_id').joinedload('author').load_only('id')\n    ).all()\n\n    print new_n1\n    print new_n1[0].comments\n    print new_n1[0].comments[0].author\nexcept AssertionError as e:\n    print e\n```\n\nIt might be related to #2714 or #3593\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3611/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3611/timeline","performed_via_github_app":null,"state_reason":"completed"}