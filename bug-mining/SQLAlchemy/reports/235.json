{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3035","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3035/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3035/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3035/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3035","id":384630340,"node_id":"MDU6SXNzdWUzODQ2MzAzNDA=","number":3035,"title":"overhaul session.binds to support classes fully; fix up tests","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141273925,"node_id":"MDU6TGFiZWwxMTQxMjczOTI1","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/feature","name":"feature","color":"306080","default":false,"description":null},{"id":1141273966,"node_id":"MDU6TGFiZWwxMTQxMjczOTY2","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/orm","name":"orm","color":"20C0B0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/42","html_url":"https://github.com/sqlalchemy/sqlalchemy/milestone/42","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/42/labels","id":3850611,"node_id":"MDk6TWlsZXN0b25lMzg1MDYxMQ==","number":42,"title":"1.0","description":null,"creator":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":101,"state":"closed","created_at":"2018-11-27T04:04:03Z","updated_at":"2018-11-28T16:49:52Z","due_on":null,"closed_at":"2018-11-28T16:49:52Z"},"comments":5,"created_at":"2014-04-26T22:43:10Z","updated_at":"2014-10-14T18:04:43Z","closed_at":"2014-10-14T18:04:43Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Michael Bayer ([@zzzeek](https://github.com/zzzeek))**\n\nright now session.__binds uses mappers completely.  This makes it impossible to feed in abstract classes and also because it links to base_mapper it's not possible to change the bind along a class hierarchy either (like a concrete hierarchy).\n\npropose that __binds stores classes directly, and this can likely be a fallback in addition to what we have now.  this is kind of a proof of concept\n\n\n```\ndiff --git a/lib/sqlalchemy/orm/session.py b/lib/sqlalchemy/orm/session.py\nindex 89d9946..f63adfb 100644\n--- a/lib/sqlalchemy/orm/session.py\n+++ b/lib/sqlalchemy/orm/session.py\n@@ -636,13 +636,20 @@ class Session(_SessionClassMethods):\n\n         if binds is not None:\n             for mapperortable, bind in binds.items():\n-                insp = inspect(mapperortable)\n-                if insp.is_selectable:\n-                    self.bind_table(mapperortable, bind)\n-                elif insp.is_mapper:\n-                    self.bind_mapper(mapperortable, bind)\n+                try:\n+                    insp = inspect(mapperortable)\n+                except exc.NoInspectionAvailable:\n+                    if isinstance(mapperortable, type):\n+                        self.bind_cls(mapperortable, bind)\n+                    else:\n+                        raise exc.ArgumentError(\"Not acceptable bind target: %s\" % mapperortable)\n                 else:\n-                    assert False\n+                    if insp.is_selectable:\n+                        self.bind_table(mapperortable, bind)\n+                    elif insp.is_mapper:\n+                        self.bind_mapper(mapperortable, bind)\n+                    else:\n+                        assert False\n\n\n         if not self.autocommit:\n@@ -1039,6 +1046,17 @@ class Session(_SessionClassMethods):\n         for t in mapper._all_tables:\n             self.__binds[t] = bind\n\n+    def bind_class(self, cls, bind):\n+        \"\"\"Bind operations for an unmapped class to a Connectable.\n+\n+        The behavior here is that a subclass of cls which is mapped\n+        will be linked to this bind.\n+\n+        .. versionadded:: 1.0\n+\n+        \"\"\"\n+        self.__binds[cls] = bind\n+\n     def bind_table(self, table, bind):\n         \"\"\"Bind operations on a Table to a Connectable.\n\n@@ -1124,6 +1142,12 @@ class Session(_SessionClassMethods):\n                     return self.__binds[c_mapper.base_mapper]\n                 elif c_mapper.mapped_table in self.__binds:\n                     return self.__binds[c_mapper.mapped_table]\n+                else:\n+                    for cls in c_mapper.class_.__mro__:\n+                        if cls in self.__binds:\n+                            bind = self.__binds[cls]\n+                            self.bind_mapper(c_mapper, bind)\n+                            return bind\n             if clause is not None:\n                 for t in sql_util.find_tables(clause, include_crud=True):\n                     if t in self.__binds:\n\n```\n\nthe tests here also need a rework, with an emphasis on straight unit testing of get_bind().  test_session -> BindTest is really just integration tests.\n\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3035/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3035/timeline","performed_via_github_app":null,"state_reason":"completed"}