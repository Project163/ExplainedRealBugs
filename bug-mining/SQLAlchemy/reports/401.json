{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3517","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3517/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3517/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3517/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3517","id":384634803,"node_id":"MDU6SXNzdWUzODQ2MzQ4MDM=","number":3517,"title":"Inconsistencies in documentation and code regarding strong referencing guidance","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141273862,"node_id":"MDU6TGFiZWwxMTQxMjczODYy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/documentation","name":"documentation","color":"ffe7a8","default":true,"description":""},{"id":1141273863,"node_id":"MDU6TGFiZWwxMTQxMjczODYz","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/low%20priority","name":"low priority","color":"90C0D0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2015-08-28T02:13:56Z","updated_at":"2015-09-02T22:25:35Z","closed_at":"2015-08-28T03:40:33Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Allan Crooks**\n\nMy use case: I recently upgraded a project, which was built using SQLAlchemy 0.3, to SQLAlchemy 1.0. I went from version to version making changes where required. One of the features that the project made use of from SQLA 0.3 was the \"objectstore\" extension, that provided (amongst other things) object caching.\n\nAs part of the update process, I moved to using sessions, and explicitly disabled the weak reference identity map to keep my code compatible. When I started to get warnings because  *weak_identity_map=False*, I stopped passing that parameter. I then realised that it was causing performance issues, as now multiple calls were being made to the database to retrieve the same object, whereas only one call was made previously.\n\nSo, I want to be able to have sessions which will persist objects until they are explicitly cleared. The problem is, I see inconsistent advice offered when it comes to object caching.\n\n---\n\n* The documentation [here](http://docs.sqlalchemy.org/rel_1_0/latest/orm/session_state_management.html#session-attributes) explicitly suggests how you should disable weak references if that's your preferred option:\n *\"To disable the weak referencing behavior and force all objects within the session to remain until explicitly expunged, configure sessionmaker with the weak_identity_map=False setting.*\"\n \nThe use of it is not discouraged at all.\n\n* The documentation [here](http://docs.sqlalchemy.org/rel_1_0/latest/orm/session_basics.html#is-the-session-a-cache) indicates that, although the Session object is capable of being used as a cache, it's not designed for it.\n \nThis gives the impression that, while SQLAlchemy does provide an implementation of a cache, alternative options may work better. However, it does not discourage the use of it.\n\n* [This](http://docs.sqlalchemy.org/en/rel_1_0/orm/session_api.html#sqlalchemy.orm.session.Session.params.weak_identity_map) indicates that the option is obsolete.\n \n\"Obsolete\" would indicate that, regardless of the value passed to the flag, it would result in the same behaviour. This isn't true in my case.\n\n* The [generated warning](https://github.com/zzzeek/sqlalchemy/blob/a43b106aa717587f85d0d88c88b7c442104fac24/lib/sqlalchemy/orm/session.py#L492) indicates that the feature isn't needed.\n \nAs a message, that's unclear what that's saying. Is it saying that SQLAlchemy doesn't need that feature? Perhaps. Is it implying that I don't need that feature? That would be incorrect.\n\n* [This](http://comments.gmane.org/gmane.comp.python.sqlalchemy.user/22960) discussion thread contains more enthusiastic advice that people should avoid using strong identity maps, and maintain a local cache of objects themselves.\n\nThis is a strong indication that we should strongly move away from using strong identity maps.\n\n* There is issue #1473, which specifies the deprecation of StrongInstanceDict.\n \nHowever, there aren't any deprecation warnings in the direct usage of StrongInstanceDict itself - so I might infer from that the use of the classes in sqlalchemy.orm.identity are intended for internal use only, and that the *weak_identity_map* flag is meant to be the only way to make use of them.\n\n---\n\nThese inconsistencies make it unclear on how to proceed (especially in terms of expectations on how future versions will change the API):\n\n* Is the caching feature of SQLAlchemy going to be removed altogether?\n\n* Am I allowed to use StrongInstanceDict, or write my own IdentityMap class?\n\n* Is SQLAlchemy correct in asserting that the flag is obsolete?\n\n* Is SQLAlchemy indicating that the feature is unnecessary for its own internal use, or for my intended use?\n\n* Shouldn't SQLAlchemy generate a warning which suggests to clients how they should make changes to achieve the same effect for future versions?\n\nMy ideal solution would be that I could continue using StrongInstanceDict - even if future versions of SQLAlchemy only supported this by allowing a class or factory function to return an instance of an object to use as an identity map (so allow any identity map implementation to be used, rather than only talking in terms of weak vs strong references).\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3517/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3517/timeline","performed_via_github_app":null,"state_reason":"completed"}