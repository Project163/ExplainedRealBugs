{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3080","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3080/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3080/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3080/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3080","id":384630773,"node_id":"MDU6SXNzdWUzODQ2MzA3NzM=","number":3080,"title":"load_only omits primary keys when not specified","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141273966,"node_id":"MDU6TGFiZWwxMTQxMjczOTY2","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/orm","name":"orm","color":"20C0B0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/68","html_url":"https://github.com/sqlalchemy/sqlalchemy/milestone/68","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/68/labels","id":3850651,"node_id":"MDk6TWlsZXN0b25lMzg1MDY1MQ==","number":68,"title":"0.9.5","description":null,"creator":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":42,"state":"closed","created_at":"2018-11-27T04:28:42Z","updated_at":"2018-11-28T16:50:00Z","due_on":null,"closed_at":"2018-11-28T16:50:00Z"},"comments":13,"created_at":"2014-06-11T23:25:15Z","updated_at":"2016-03-13T23:54:35Z","closed_at":"2014-06-12T15:48:32Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by jvanasco ([@jvanasco](https://github.com/jvanasco))**\n\nexample attached below; this happens in 0.9.4\n\nif trying to load_only a column of the child relationship and not passing in the primary_key, sqlalchemy isn't happy\n\nthe sql generated is fine and runs -- it pulls the specified column and uses query string as an anonymous column ( sidenote: is that really necessary ?)\n\nbut the ORM is unhappy and raises an error.  \n\nadding the primary key works.  \n\nusing a joinedload instead of subqueryload works as well.\n\nand hey, i made a proper test case!\n\n\n    CATCH_KNOWN_EXCEPTION = False\n\n    from sqlalchemy import *\n    from sqlalchemy.orm import *\n    from sqlalchemy.ext.declarative import declarative_base\n    import sqlalchemy.exc\n\n    Base = declarative_base()    \n\n    class TableA(Base):\n        __tablename__ = 'table_a'\n        id = Column(Integer, primary_key=True)\n        name = Column(String(50))\n\n        bs = relationship(\"TableB\", primaryjoin=\"TableB.table_a_id==TableA.id\")\n        cs = relationship(\"TableC\", primaryjoin=\"TableC.table_a_id==TableA.id\")\n\n    class TableB(Base):\n        __tablename__ = 'table_b'\n        id = Column(Integer, primary_key=True)\n        name = Column(String(30))\n        table_a_id = Column(Integer, ForeignKey('table_a.id'), nullable=False)\n\n    class TableC(Base):\n        __tablename__ = 'table_c'\n        id = Column(Integer, primary_key=True)\n        id_alt = Column(Integer, primary_key=True)\n        name = Column(String(30))\n        table_a_id = Column(Integer, ForeignKey('table_a.id'), nullable=False)\n\n\n    e = create_engine(\"sqlite://\", echo=True)\n    Base.metadata.create_all(e)\n\n    s = Session(e)\n\n    s.add_all([\n        TableA(id=1, name='a',),\n        TableA(id=2, name='aa',),\n        TableA(id=3, name='aaa',),\n        TableA(id=4, name='aaaa',),\n        TableB(id=1, name='b', table_a_id=1),\n        TableB(id=2, name='bb', table_a_id=2),\n        TableB(id=3, name='bbb', table_a_id=3),\n        TableB(id=4, name='bbbbb', table_a_id=4),\n        TableC(id=1, id_alt=10, name='c', table_a_id=1),\n        TableC(id=2, id_alt=11, name='cc', table_a_id=2),\n        TableC(id=3, id_alt=12, name='ccc', table_a_id=3),\n        TableC(id=4, id_alt=13, name='cccc', table_a_id=4),\n    ])\n\n    s.commit()\n\n\n    q = s.query( TableA ).filter( TableA.id == 2 )\n\n    ## this passes\n    try:\n        q_good = q.options( subqueryload('bs').load_only('id', 'name') )\n        result = q_good.first()\n        print \"expected - can load `bs` with primary_key + desired column\"\n    except:\n        raise\n\n    try: \n        q_bad = q.options( subqueryload('bs').load_only('name') )\n        result = q_bad.first()\n    except sqlalchemy.exc.NoSuchColumnError, e:\n        print \"expected - CAN NOT LOAD `bs` with only desired column\"\n        if not CATCH_KNOWN_EXCEPTION:\n            raise\n\n    try:\n        joinedload_works = q.options( joinedload('bs').load_only('name') )\n        result = joinedload_works.first()\n        print \"expected - can load `bs` with joinedload only using the target column\"\n    except:\n        raise\n\n    try: \n        q_bad = q.options( subqueryload('cs').load_only('name') )\n        result = q_bad.first()\n    except sqlalchemy.exc.NoSuchColumnError, e:\n        print \"expected - CAN NOT LOAD `cs` with only desired column\"\n        if not CATCH_KNOWN_EXCEPTION:\n            raise\n\n    ## this also fails, only one key\n    try: \n        q_bad = q.options( subqueryload('cs').load_only('id', 'name') )\n        result = q_bad.first()\n    except sqlalchemy.exc.NoSuchColumnError, e:\n        print \"expected - CAN NOT LOAD `cs` with only 1/2 primary keys + desired column\"\n        if not CATCH_KNOWN_EXCEPTION:\n            raise\n\n    try:\n        q_good = q.options( subqueryload('cs').load_only('id', 'id_alt', 'name'))\n        result = q_good.first()\n        print \"expected - can load `cs` with subqueryload using the target column + BOTH primary keys\"\n    except:\n        raise\n\n\n\n    s.close()\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3080/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3080/timeline","performed_via_github_app":null,"state_reason":"completed"}