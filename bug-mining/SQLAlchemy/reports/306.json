{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3340","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3340/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3340/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3340/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3340","id":384633216,"node_id":"MDU6SXNzdWUzODQ2MzMyMTY=","number":3340,"title":"label ordering rules intended for eager loading get in the way of valid use cases","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141273873,"node_id":"MDU6TGFiZWwxMTQxMjczODcz","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/high%20priority","name":"high priority","color":"C0B0E0","default":false,"description":null},{"id":1141274001,"node_id":"MDU6TGFiZWwxMTQxMjc0MDAx","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/sql","name":"sql","color":"5060F0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2015-03-23T16:21:20Z","updated_at":"2015-03-23T16:34:24Z","closed_at":"2015-03-23T16:34:24Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Michael Bayer ([@zzzeek](https://github.com/zzzeek))**\n\n\n```\ndiff --git a/test/sql/test_text.py b/test/sql/test_text.py\nindex 4483597..1c3cb0c 100644\n--- a/test/sql/test_text.py\n+++ b/test/sql/test_text.py\n@@ -574,6 +574,15 @@ class OrderByLabelResolutionTest(fixtures.TestBase, AssertsCompiledSQL):\n             \"FROM mytable AS mytable_1 ORDER BY mytable_1.name\"\n         )\n \n+    def test_order_by_named_label_from_anon_label(self):\n+        s1 = select([table1.c.myid.label(None).label(\"foo\"), table1.c.name])\n+        stmt = s1.order_by(\"foo\")\n+        self.assert_compile(\n+            stmt,\n+            \"SELECT mytable.myid AS foo, mytable.name \"\n+            \"FROM mytable ORDER BY foo\"\n+        )\n+\n     def test_order_by_outermost_label(self):\n         # test [ticket:3335], assure that order_by(\"foo\")\n         # catches the label named \"foo\" in the columns clause only,\n\n```\n\nfails:\n\n```\n#!\n\n\n File \"/Users/classic/dev/sqlalchemy/lib/sqlalchemy/util/langhelpers.py\", line 1307, in warn_limited\n    warnings.warn(msg, exc.SAWarning, stacklevel=2)\nSAWarning: Can't resolve label reference 'foo'; converting to text() (this warning may be suppressed after 10 occurrences)\n```\n\nbecause of this:\n\n```\ndiff --git a/lib/sqlalchemy/sql/elements.py b/lib/sqlalchemy/sql/elements.py\nindex 7d64c2c..db759eb 100644\n--- a/lib/sqlalchemy/sql/elements.py\n+++ b/lib/sqlalchemy/sql/elements.py\n@@ -3040,6 +3040,8 @@ class Label(ColumnElement):\n \n         if name:\n             self.name = name\n+            # shouldn't we do this??\n+            # self._resolve_label = name\n         else:\n             self.name = _anonymous_label(\n                 '%%(%d %s)s' % (id(self), getattr(element, 'name', 'anon'))\n```\n\nbut doing \"that\" fails because test_columnadapter_anonymized is testing exactly that this label is no longer targetable.\n\nBut we have this situation for a column_property() and this should not fail:\n\n```\nfrom sqlalchemy import *\nfrom sqlalchemy.orm import *\nfrom sqlalchemy.ext.declarative import declarative_base\n\nBase = declarative_base()\n\nclass EMap(Base):\n    __tablename__ = 'a'\n    id = Column(Integer, primary_key=True)\n\n    FName = Column(String(length=45))\n    LName = Column(String(length=45))\n    AssociateName = column_property(FName + \" \" + LName)\n\ns = Session()\n\n\nprint s.query(EMap.AssociateName.label('foo')).group_by(\"foo\")\n```\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3340/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3340/timeline","performed_via_github_app":null,"state_reason":"completed"}