{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3337","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3337/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3337/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3337/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3337","id":384633174,"node_id":"MDU6SXNzdWUzODQ2MzMxNzQ=","number":3337,"title":"pymysql unicode expects unicode or non-unicode for statement/binds at the same time","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141273954,"node_id":"MDU6TGFiZWwxMTQxMjczOTU0","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/mysql","name":"mysql","color":"30A040","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/76","html_url":"https://github.com/sqlalchemy/sqlalchemy/milestone/76","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/76/labels","id":3850662,"node_id":"MDk6TWlsZXN0b25lMzg1MDY2Mg==","number":76,"title":"0.9.10","description":null,"creator":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":14,"state":"closed","created_at":"2018-11-27T04:34:43Z","updated_at":"2018-11-28T16:50:03Z","due_on":null,"closed_at":"2018-11-28T16:50:03Z"},"comments":3,"created_at":"2015-03-22T22:50:41Z","updated_at":"2015-03-22T23:27:47Z","closed_at":"2015-03-22T23:27:47Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Michael Bayer ([@zzzeek](https://github.com/zzzeek))**\n\nwe can set supports_unicode_statements and supports_unicode_binds to True or False and PyMySQL tests pass from 0.4 to 0.6.6.  However, if statements is True and binds is False as it is right now, then the \"executemany\" tests fail, b.c. pymysql is generally using string interpolation to produce the string.  Stack is as follows:\n\n\n```\n#!\n\n$ python -m pytest test/dialect/test_suite.py --dburi \"mysql+pymysql://scott:tiger@localhost/test?charset=utf8\" -k UnicodeVarcharTest \n===================================================================== test session starts ======================================================================\nplatform darwin -- Python 2.7.5 -- py-1.4.26 -- pytest-2.6.4 -- /Library/Frameworks/Python.framework/Versions/2.7/Resources/Python.app/Contents/MacOS/Python\nplugins: cov, xdist\ncollected 143 items \n\ntest/dialect/test_suite.py <- lib/sqlalchemy/testing/suite/test_types.py::UnicodeVarcharTest_mysql_pymysql::test_empty_strings_varchar PASSED\ntest/dialect/test_suite.py <- lib/sqlalchemy/testing/suite/test_types.py::UnicodeVarcharTest_mysql_pymysql::test_literal PASSED\ntest/dialect/test_suite.py <- lib/sqlalchemy/testing/suite/test_types.py::UnicodeVarcharTest_mysql_pymysql::test_round_trip PASSED\ntest/dialect/test_suite.py <- lib/sqlalchemy/testing/suite/test_types.py::UnicodeVarcharTest_mysql_pymysql::test_round_trip_executemany FAILED\n\n=========================================================================== FAILURES ===========================================================================\n_________________________________________________ UnicodeVarcharTest_mysql_pymysql.test_round_trip_executemany _________________________________________________\nTraceback (most recent call last):\n  File \"/Users/classic/dev/sqlalchemy/lib/sqlalchemy/testing/suite/test_types.py\", line 89, in test_round_trip_executemany\n    for i in range(3)\n  File \"/Users/classic/dev/sqlalchemy/lib/sqlalchemy/engine/base.py\", line 1978, in execute\n    return connection.execute(statement, *multiparams, **params)\n  File \"/Users/classic/dev/sqlalchemy/lib/sqlalchemy/engine/base.py\", line 914, in execute\n    return meth(self, multiparams, params)\n  File \"/Users/classic/dev/sqlalchemy/lib/sqlalchemy/sql/elements.py\", line 323, in _execute_on_connection\n    return connection._execute_clauseelement(self, multiparams, params)\n  File \"/Users/classic/dev/sqlalchemy/lib/sqlalchemy/engine/base.py\", line 1010, in _execute_clauseelement\n    compiled_sql, distilled_params\n  File \"/Users/classic/dev/sqlalchemy/lib/sqlalchemy/engine/base.py\", line 1146, in _execute_context\n    context)\n  File \"/Users/classic/dev/sqlalchemy/lib/sqlalchemy/engine/base.py\", line 1335, in _handle_dbapi_exception\n    util.reraise(*exc_info)\n  File \"/Users/classic/dev/sqlalchemy/lib/sqlalchemy/engine/base.py\", line 1116, in _execute_context\n    context)\n  File \"/Users/classic/dev/sqlalchemy/lib/sqlalchemy/dialects/mysql/mysqldb.py\", line 95, in do_executemany\n    rowcount = cursor.executemany(statement, parameters)\n  File \"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pymysql/cursors.py\", line 148, in executemany\n    self._get_db().encoding)\n  File \"/Library/Frameworks/Python.framework/Versions/2.7/lib/python2.7/site-packages/pymysql/cursors.py\", line 162, in _do_execute_many\n    v = values % escape(next(args), conn)\nUnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 64: ordinal not in range(128)\n=================================================================== short test summary info ====================================================================\nFAIL test/dialect/test_suite.py::UnicodeVarcharTest_mysql_pymysql::()::test_round_trip_executemany\n======================================================== 139 tests deselected by '-kUnicodeVarcharTest' ========================================================\n====================================================== 1 failed, 3 passed, 139 deselected in 0.27 seconds ======================================================\nclassics-MacBook-Pro:sqlalchemy classic$ \n\n```\n\nthe fix works all the way back for pymysql 0.4 which was five years ago so this is good for 0.9.\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3337/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3337/timeline","performed_via_github_app":null,"state_reason":"completed"}