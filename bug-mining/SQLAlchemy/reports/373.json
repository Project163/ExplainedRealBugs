{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3466","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3466/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3466/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3466/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3466","id":384634322,"node_id":"MDU6SXNzdWUzODQ2MzQzMjI=","number":3466,"title":"1.0.x regression involving aliases and synonyms","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2015-06-27T00:57:51Z","updated_at":"2015-06-27T10:51:27Z","closed_at":"2015-06-27T04:42:08Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by inklesspen ([@inklesspen](https://github.com/inklesspen))**\n\nThis issue seems remarkably similar to #3445 but I've verified it still exists in 1.0.6 (and does not exist in 0.9.9).\n\nIn the below test case, generating the query without an explicit `select_from` causes the query to be generated without the label for the first table. (The problem goes away if you explicitly specify `select_from` or if you stop using the `public_id` synonym column and use the username column directly.)\n\n```python\nfrom sqlalchemy import (\n    Column, Integer, String, Boolean, DateTime,\n    ForeignKey)\nfrom sqlalchemy.orm import Session, aliased, Bundle, relationship, synonym\nfrom sqlalchemy.ext.declarative import declarative_base\n\nBase = declarative_base()\n\n\nclass AuthUser(Base):\n    __tablename__ = 'auth_user'\n    id = Column('user_ptr_id', Integer, primary_key=True, nullable=False)\n    username = Column(String(32), nullable=False)\n    public_id = synonym('username')  # Please use this field in preference to username\n\n    first_name = Column(String(length=30), nullable=False)\n    last_name = Column(String(length=30), nullable=False)\n\n    email = Column(String(length=75), nullable=False)\n\n    company_id = Column(Integer, ForeignKey('company.id'), nullable=False)\n\n    company = relationship('Company', backref=\"axial_user\", uselist=False)\n\n\nclass Company(Base):\n    __tablename__ = 'company'\n    id = Column(Integer, primary_key=True, nullable=False)\n    public_id = Column(String(32), unique=True, nullable=False)\n    name = Column(String(length=255), nullable=False)\n    company_type = Column(String(length=5))\n    last_activity_date = Column(DateTime, nullable=False)\n\n\nclass License(Base):\n    __tablename__ = 'license'\n    public_id = Column(String(32), primary_key=True)\n    is_active = Column(Boolean, nullable=False, server_default=\"FALSE\")\n    company_public_id = Column(String(32), nullable=False, index=True)\n\n\ndef query(db_session, explicit):\n    AU = aliased(AuthUser)\n    CMP = aliased(Company)\n    LIC = aliased(License)\n\n    USER = Bundle('user',\n                  AU.public_id,\n                  AU.first_name,\n                  AU.last_name,\n                  AU.email,\n                  )\n    COMP = Bundle('comp',\n                  CMP.public_id,\n                  CMP.name,\n                  CMP.company_type,\n                  CMP.last_activity_date,\n                  LIC.is_active,\n                  )\n\n    sql = db_session.query(USER, COMP)\n    if explicit:\n        sql = sql.select_from(AU)\n    sql = sql.join(CMP, CMP.id == AU.company_id)\n    sql = sql.join(LIC, LIC.company_public_id == CMP.public_id)\n\n    return sql\n\n\ns = Session()\n\nprint query(s, False)\nprint \"-----\"\nprint query(s, True)\n```\n\nThe relevant bits are in the FROM clause:\n\n```sql\nFROM auth_user JOIN company AS company_1 ON ...\n```\n\nvs\n\n```sql\nFROM auth_user AS auth_user_1 JOIN company AS company_1 ON ...\n```\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3466/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3466/timeline","performed_via_github_app":null,"state_reason":"completed"}