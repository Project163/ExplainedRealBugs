{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/1185","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/1185/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/1185/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/1185/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/1185","id":384615504,"node_id":"MDU6SXNzdWUzODQ2MTU1MDQ=","number":1185,"title":"Check self.dbapi.initialized for firebird.py","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141273925,"node_id":"MDU6TGFiZWwxMTQxMjczOTI1","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/feature","name":"feature","color":"306080","default":false,"description":null},{"id":1141277605,"node_id":"MDU6TGFiZWwxMTQxMjc3NjA1","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/firebird","name":"firebird","color":"00E090","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/12","html_url":"https://github.com/sqlalchemy/sqlalchemy/milestone/12","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/12/labels","id":3850565,"node_id":"MDk6TWlsZXN0b25lMzg1MDU2NQ==","number":12,"title":"0.5.xx","description":null,"creator":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":94,"state":"closed","created_at":"2018-11-27T03:45:43Z","updated_at":"2018-11-28T16:49:43Z","due_on":null,"closed_at":"2018-11-28T16:49:43Z"},"comments":5,"created_at":"2008-10-02T15:12:47Z","updated_at":"2014-02-23T18:14:32Z","closed_at":"2009-09-15T05:35:07Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Anonymous**\n\nI have a use case where one web application is using kinterbasdb directly and another is using sqlalchemy, both under mod_wsgi.  Numerous attempts at different configuration scenarios led me to run both applications with the WSGIApplicationGroup = ${GLOBAL} setting in the conf file for httpd.  It appears that firebird.py does not check if kinterbasdb has alread been initialized before making its call to init.  It only checks if it has attempted to initialize.\n\nThis is the stack trace I would inevitably see:\n\n    cherrypy.server.start(init_only=True, server_class=None)\n    File \"/usr/lib/python2.4/site-packages/cherrypy/_cpserver.py\", line 72, in start\n    Engine.start(self)\n    File \"/usr/lib/python2.4/site-packages/cherrypy/_cpengine.py\", line 106, in start\n    self._start()\n    File \"/usr/lib/python2.4/site-packages/cherrypy/_cpserver.py\", line 78, in _start\n    Engine._start(self)\n    File \"/usr/lib/python2.4/site-packages/cherrypy/_cpengine.py\", line 110, in _start\n    func()\n    File \"/usr/lib/python2.4/site-packages/turbogears/startup.py\", line 227, in startTurboGears\n    database.get_engine()\n    File \"/usr/lib/python2.4/site-packages/turbogears/database.py\", line 45, in get_engine\n    _engine = sqlalchemy.create_engine(dburi, **alch_args)\n    File \"/usr/lib/python2.4/site-packages/sqlalchemy/engine/__init__.py\", line 173, in create_engine\n    return strategy.create(*args, **kwargs)\n    File \"/usr/lib/python2.4/site-packages/sqlalchemy/engine/strategies.py\", line 70, in create\n    (cargs, cparams) = dialect.create_connect_args(u)\n    File \"/usr/lib/python2.4/site-packages/sqlalchemy/databases/firebird.py\", line 294, in create_connect_args\n    self.dbapi.init(type_conv=type_conv, concurrency_level=concurrency_level)\n    File \"/usr/lib/python2.4/site-packages/kinterbasdb/__init__.py\", line 272, in init\n    _k.concurrency_level_set(concurrency_level)\n    ProgrammingError: (0, 'The concurrency level cannot be changed once it has been set.  Use kinterbasdb.init(concurrency_level=?) to set the concurrency level legally.')\n    \n\n\nI needed to add this:  \n\n    diff -Naur SQLAlchemy-0.4.7/lib/sqlalchemy/databases/firebird.py SQLAlchemy-0.4.7.new/lib/sqlalchemy/databases/firebird.py\n    --- SQLAlchemy-0.4.7/lib/sqlalchemy/databases/firebird.py       2008-07-26 12:43:52.000000000 -0400\n    +++ SQLAlchemy-0.4.7.new/lib/sqlalchemy/databases/firebird.py   2008-10-01 10:51:22.000000000 -0400\n    @@ -291,7 +291,8 @@\n             global _initialized_kb\n             if not _initialized_kb and self.dbapi is not None:\n                 _initialized_kb = True\n    -            self.dbapi.init(type_conv=type_conv, concurrency_level=concurrency_level)\n    +            if not self.dbapi.initialized:\n    +                self.dbapi.init(type_conv=type_conv, concurrency_level=concurrency_level)\n             return ([], opts)\n     \n         def create_execution_context(self, *args, **kwargs):\n    \n\n\nThis configuration and patch allowed me to run both apps, one with kinterbasdb being used directly, and another with sqlalchemy.  I could find no other way to do this.  If there is a better method, I could not find it.\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/1185/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/1185/timeline","performed_via_github_app":null,"state_reason":"completed"}