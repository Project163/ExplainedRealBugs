{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3491","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3491/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3491/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3491/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3491","id":384634517,"node_id":"MDU6SXNzdWUzODQ2MzQ1MTc=","number":3491,"title":"Query.first() sometimes returns None","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141274156,"node_id":"MDU6TGFiZWwxMTQxMjc0MTU2","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/oracle","name":"oracle","color":"A020C0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":24,"created_at":"2015-07-20T18:59:46Z","updated_at":"2015-07-29T21:41:31Z","closed_at":"2015-07-29T21:41:31Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by vijchti**\n\nOracle database via cx_Oracle on SQLAlchemy 1.0.6 (also tested on some older versions, got same result).\n\nAbout 50% of the time, using Query.first() on a query will return None. The rest of the time the query returns results as expected. The same behavior is not seen when using the expression language by itself or when using any other client on this or any other computer to retrieve the data. This issue can be duplicated on other machines.\n\nHere is the code I used to generate this error:\n\n```\nfrom sqlalchemy import create_engine, Column, Integer, String\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy.orm import sessionmaker\n\n# Fix environment variables\nimport os\ntry:\n\tdel os.environ['ORACLE_HOME']\nexcept KeyError:\n\tpass\nos.environ['TNS_ADMIN'] = r'C:\\product\\11.1.0\\client_1\\network\\admin'\nos.environ['PATH'] = r'C:\\product\\11.1.0\\client_1\\BIN;' + os.environ['PATH']\n\nengine = create_engine(r'oracle+cx_oracle://{username}:{password}@{service_name}'.format(username='USER', password='PASSWORD', service_name='SERVICE'))\nsession_maker = sessionmaker(bind=engine)\nbase_class = declarative_base()\n\nclass Lot(base_class):\n\t__tablename__ = 'lot'\n\t__table_args__ = {'schema': 'SCHEMA_NAME'}\n\tlot_key = Column(Integer, primary_key=True)\n\tlot_id = Column(String)\n\nsession = session_maker()\ncursor = session.query(Lot)\nresult = cursor.first()\nif result is None:\n\traise Exception\n```\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3491/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3491/timeline","performed_via_github_app":null,"state_reason":"completed"}