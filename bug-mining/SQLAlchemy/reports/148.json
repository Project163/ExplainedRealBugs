{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3042","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3042/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3042/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3042/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3042","id":384630402,"node_id":"MDU6SXNzdWUzODQ2MzA0MDI=","number":3042,"title":"ensure warning for implicitly combined columns occurs for inherited classes as well","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141273873,"node_id":"MDU6TGFiZWwxMTQxMjczODcz","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/high%20priority","name":"high priority","color":"C0B0E0","default":false,"description":null},{"id":1141273966,"node_id":"MDU6TGFiZWwxMTQxMjczOTY2","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/orm","name":"orm","color":"20C0B0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/68","html_url":"https://github.com/sqlalchemy/sqlalchemy/milestone/68","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/68/labels","id":3850651,"node_id":"MDk6TWlsZXN0b25lMzg1MDY1MQ==","number":68,"title":"0.9.5","description":null,"creator":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":42,"state":"closed","created_at":"2018-11-27T04:28:42Z","updated_at":"2018-11-28T16:50:00Z","due_on":null,"closed_at":"2018-11-28T16:50:00Z"},"comments":6,"created_at":"2014-05-06T00:03:18Z","updated_at":"2014-06-20T22:48:17Z","closed_at":"2014-06-20T22:48:17Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Michael Bayer ([@zzzeek](https://github.com/zzzeek))**\n\ntest:\n\n\n```\nfrom sqlalchemy import *\nfrom sqlalchemy.orm import *\nfrom sqlalchemy.ext.declarative import declarative_base\n\nBase = declarative_base()\n\nclass A(Base):\n    __tablename__ = 'a'\n\n    id = Column(Integer, primary_key=True)\n\nclass B(A):\n    __tablename__ = 'b'\n\n    id = Column(Integer, primary_key=True)\n    a_id = Column(Integer, ForeignKey('a.id'))\n\n\n```\n\nnote that we don't get the \"same named columns\" warning for A.id and B.id because our test for this is too simplistic, assuming that in an inheritance scenario, a subtable with the same column should implicitly combine with that of a supertable.   I'm not sure if I intended this to be this way for all implicitly combined columns that were in an inheritance situation or somehow thought these would always be tables in the sync condition, but these are separate columns and the \"same named\" error should still apply.  We will make it a warning in 0.9 and an error in 1.0 as follows:\n\n\n```\ndiff --git a/lib/sqlalchemy/orm/mapper.py b/lib/sqlalchemy/orm/mapper.py\nindex 3e93840..1377945 100644\n--- a/lib/sqlalchemy/orm/mapper.py\n+++ b/lib/sqlalchemy/orm/mapper.py\n@@ -1604,13 +1604,17 @@ class Mapper(_InspectionAttr):\n         prop = self._props.get(key, None)\n \n         if isinstance(prop, properties.ColumnProperty):\n-            if prop.parent is self:\n-                raise sa_exc.InvalidRequestError(\n-                        \"Implicitly combining column %s with column \"\n-                        \"%s under attribute '%s'.  Please configure one \"\n-                        \"or more attributes for these same-named columns \"\n-                        \"explicitly.\"\n-                         % (prop.columns[-1], column, key))\n+            if (prop.columns[0], column) not in self._inherits_equated_pairs and \\\n+                    not prop.columns[0].shares_lineage(column):\n+                warn_only = prop.parent is not self\n+                msg = (\"Implicitly combining column %s with column \"\n+                      \"%s under attribute '%s'.  Please configure one \"\n+                      \"or more attributes for these same-named columns \"\n+                      \"explicitly.\" % (prop.columns[-1], column, key))\n+                if warn_only:\n+                    util.warn(msg)\n+                else:\n+                    raise sa_exc.InvalidRequestError(msg)\n \n             # existing properties.ColumnProperty from an inheriting\n             # mapper. make a copy and append our column to it\n\n```\n\nthis is extracted from #3041.\n\nneeds tests for this specific case. \n\npatch is attached which modifies quite a *lot* of tests which suffer from this warning.\n\n----------------------------------------\nAttachments: [3042.patch](../wiki/imported_issue_attachments/3042/3042.patch)\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3042/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3042/timeline","performed_via_github_app":null,"state_reason":"completed"}