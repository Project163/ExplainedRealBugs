{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3356","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3356/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3356/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3356/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3356","id":384633363,"node_id":"MDU6SXNzdWUzODQ2MzMzNjM=","number":3356,"title":"tox doesn't run the correct code and setting up lib is not reliable","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141273864,"node_id":"MDU6TGFiZWwxMTQxMjczODY0","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/tests","name":"tests","color":"20A050","default":false,"description":null},{"id":1141273873,"node_id":"MDU6TGFiZWwxMTQxMjczODcz","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/high%20priority","name":"high priority","color":"C0B0E0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/42","html_url":"https://github.com/sqlalchemy/sqlalchemy/milestone/42","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/42/labels","id":3850611,"node_id":"MDk6TWlsZXN0b25lMzg1MDYxMQ==","number":42,"title":"1.0","description":null,"creator":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":101,"state":"closed","created_at":"2018-11-27T04:04:03Z","updated_at":"2018-11-28T16:49:52Z","due_on":null,"closed_at":"2018-11-28T16:49:52Z"},"comments":2,"created_at":"2015-04-04T22:38:46Z","updated_at":"2015-04-04T23:08:35Z","closed_at":"2015-04-04T23:08:35Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Michael Bayer ([@zzzeek](https://github.com/zzzeek))**\n\npatch, needs further testing:\n\n\n```\ndiff --git a/regen_callcounts.tox.ini b/regen_callcounts.tox.ini\nindex 056208c..e74ceef 100644\n--- a/regen_callcounts.tox.ini\n+++ b/regen_callcounts.tox.ini\n@@ -12,8 +12,6 @@ deps=pytest\n \t py{27}-sqla_{cext,nocext}-db_{mysql}: mysql-python\n \t py{33,34}-sqla_{cext,nocext}-db_{mysql}: pymysql\n \n-usedevelop=False\n-sitepackages=True\n \n \n commands=\n@@ -22,7 +20,11 @@ commands=\n \tdb_{postgresql}: {[base]basecommand} --db postgresql {posargs}\n \tdb_{sqlite}: {[base]basecommand} --db sqlite {posargs}\n \n+# -E     : ignore PYTHON* environment variables (such as PYTHONPATH)\n+# -s     : don't add user site directory to sys.path; also PYTHONNOUSERSITE\n setenv=\n-\tsqla_nocext: DISABLE_SQLALCHEMY_CEXT=1\n+    PYTHONPATH=\n+    PYTHONNOUSERSITE=1\n+    sqla_nocext: DISABLE_SQLALCHEMY_CEXT=1\n \n \ndiff --git a/sqla_nose.py b/sqla_nose.py\nindex fc55f34..3925fb7 100755\n--- a/sqla_nose.py\n+++ b/sqla_nose.py\n@@ -10,10 +10,9 @@ import sys\n import nose\n import os\n \n-\n-for pth in ['./lib']:\n-    sys.path.append(\n-        os.path.join(os.path.dirname(os.path.abspath(__file__)), pth))\n+if not sys.flags.no_user_site:\n+    sys.path.insert(0,\n+        os.path.join(os.path.dirname(os.path.abspath(__file__)), './lib'))\n \n # use bootstrapping so that test plugins are loaded\n # without touching the main library before coverage starts\ndiff --git a/test/conftest.py b/test/conftest.py\nindex 590b357..7572ecc 100755\n--- a/test/conftest.py\n+++ b/test/conftest.py\n@@ -9,10 +9,9 @@ installs SQLAlchemy's testing plugin into the local environment.\n import sys\n import os\n \n-for pth in ['../lib']:\n-    sys.path.append(\n-        os.path.join(os.path.dirname(os.path.abspath(__file__)), pth))\n-\n+if not sys.flags.no_user_site:\n+    sys.path.insert(0,\n+        os.path.join(os.path.dirname(os.path.abspath(__file__)), './lib'))\n \n # use bootstrapping so that test plugins are loaded\n # without touching the main library before coverage starts\ndiff --git a/test/sql/test_query.py b/test/sql/test_query.py\nindex 08afc32..aaba249 100644\n--- a/test/sql/test_query.py\n+++ b/test/sql/test_query.py\n@@ -79,6 +79,8 @@ class QueryTest(fixtures.TestBase):\n         \"\"\"test that executemany parameters are asserted to match the\n         parameter set of the first.\"\"\"\n \n+        import pdb\n+        pdb.set_trace()\n         assert_raises_message(\n             exc.StatementError,\n             r\"\\(sqlalchemy.exc.InvalidRequestError\\) A value is required for \"\ndiff --git a/tox.ini b/tox.ini\nindex 3b1d2ea..34f40e2 100644\n--- a/tox.ini\n+++ b/tox.ini\n@@ -5,8 +5,15 @@ envlist = full,py26,py27,py33,py34\n deps=pytest\n      mock\n \n-sitepackages=True\n-usedevelop=True\n+# -E     : ignore PYTHON* environment variables (such as PYTHONPATH)\n+# -s     : don't add user site directory to sys.path; also PYTHONNOUSERSITE\n+setenv=\n+    PYTHONPATH=\n+    PYTHONNOUSERSITE=1\n+\n+sitepackages=False\n+usedevelop=False\n+\n \n commands=\n   python -m pytest {posargs}\n\n```\n\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3356/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3356/timeline","performed_via_github_app":null,"state_reason":"completed"}