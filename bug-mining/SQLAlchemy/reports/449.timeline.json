[{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932038","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932038","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932038,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjAzOA==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-22T15:12:09Z","updated_at":"2018-11-27T05:54:33Z","body":"**Michael Bayer ([@zzzeek](https://github.com/zzzeek)) wrote:**\n\nLet's work with only complete, self contained examples (see http://stackoverflow.com/help/mcve) so that the work of reproducing the error is done ahead of time, and let's take out the Flask dependencies so that it can be eliminated as a factor.\n\nExtracting segments of your blog post into something produces a script that does not reproduce this error (though I've no doubt there's a bug because that assertion, as it says, should be impossible to reach ;) ):\n\n\n\n```\n# materialized_view_factory.py\nfrom sqlalchemy.ext import compiler\nfrom sqlalchemy.schema import DDLElement\n\nimport sqlalchemy as db\n\n\nclass CreateMaterializedView(DDLElement):\n    def __init__(self, name, selectable):\n        self.name = name\n        self.selectable = selectable\n\n\n@compiler.compiles(CreateMaterializedView)\ndef compile(element, compiler, **kw):\n    # Could use \"CREATE OR REPLACE MATERIALIZED VIEW...\"\n    # but I'd rather have noisy errors\n    return \"CREATE MATERIALIZED VIEW %s AS %s\" % (element.name,\n                            compiler.sql_compiler.process(element.selectable))\n\n\ndef create_mat_view(metadata, name, selectable):\n    t = db.table(name)\n    for c in selectable.c:\n        c._make_proxy(t)\n    CreateMaterializedView(name, selectable).execute_at('after-create', metadata)\n    db.DDL('DROP MATERIALIZED VIEW IF EXISTS ' + name\n                                            ).execute_at('before_drop', metadata)\n    return t\n\nfrom sqlalchemy.ext.declarative import declarative_base\nBase = declarative_base()\n\n\nclass Gear(Base):\n    __tablename__ = 'gear'\n    id = db.Column(db.Integer, primary_key=True)\n    rating = db.Column(db.Integer)\n\nview = create_mat_view(\n    Base.metadata,\n    \"gear_item_mv\",\n    db.select(\n        [Gear.id.label('id'),\n         db.func.count(Gear.id).label('review_count'),\n         db.func.avg(Gear.rating).label('review_rating'),]\n    ).select_from(Gear)\n    .group_by(Gear.id))\n\n\ne = db.create_engine(\"postgresql://scott:tiger@localhost/test\", echo=True)\nBase.metadata.drop_all(e)\nBase.metadata.create_all(e)\nBase.metadata.drop_all(e)\n\n\n\n\n```\n\n\noutput:\n\n\n```\n#!\n\n$ python test.py\n2015-12-22 10:11:20,310 INFO sqlalchemy.engine.base.Engine select version()\n2015-12-22 10:11:20,310 INFO sqlalchemy.engine.base.Engine {}\n2015-12-22 10:11:20,311 INFO sqlalchemy.engine.base.Engine select current_schema()\n2015-12-22 10:11:20,311 INFO sqlalchemy.engine.base.Engine {}\n2015-12-22 10:11:20,312 INFO sqlalchemy.engine.base.Engine SELECT CAST('test plain returns' AS VARCHAR(60)) AS anon_1\n2015-12-22 10:11:20,312 INFO sqlalchemy.engine.base.Engine {}\n2015-12-22 10:11:20,313 INFO sqlalchemy.engine.base.Engine SELECT CAST('test unicode returns' AS VARCHAR(60)) AS anon_1\n2015-12-22 10:11:20,313 INFO sqlalchemy.engine.base.Engine {}\n2015-12-22 10:11:20,314 INFO sqlalchemy.engine.base.Engine show standard_conforming_strings\n2015-12-22 10:11:20,314 INFO sqlalchemy.engine.base.Engine {}\n2015-12-22 10:11:20,315 INFO sqlalchemy.engine.base.Engine select relname from pg_class c join pg_namespace n on n.oid=c.relnamespace where pg_catalog.pg_table_is_visible(c.oid) and relname=%(name)s\n2015-12-22 10:11:20,315 INFO sqlalchemy.engine.base.Engine {'name': u'gear'}\n2015-12-22 10:11:20,316 INFO sqlalchemy.engine.base.Engine DROP MATERIALIZED VIEW IF EXISTS gear_item_mv\n2015-12-22 10:11:20,316 INFO sqlalchemy.engine.base.Engine {}\n2015-12-22 10:11:20,317 INFO sqlalchemy.engine.base.Engine COMMIT\n2015-12-22 10:11:20,319 INFO sqlalchemy.engine.base.Engine \nDROP TABLE gear\n2015-12-22 10:11:20,319 INFO sqlalchemy.engine.base.Engine {}\n2015-12-22 10:11:20,320 INFO sqlalchemy.engine.base.Engine COMMIT\n2015-12-22 10:11:20,323 INFO sqlalchemy.engine.base.Engine select relname from pg_class c join pg_namespace n on n.oid=c.relnamespace where pg_catalog.pg_table_is_visible(c.oid) and relname=%(name)s\n2015-12-22 10:11:20,323 INFO sqlalchemy.engine.base.Engine {'name': u'gear'}\n2015-12-22 10:11:20,325 INFO sqlalchemy.engine.base.Engine \nCREATE TABLE gear (\n\tid SERIAL NOT NULL, \n\trating INTEGER, \n\tPRIMARY KEY (id)\n)\n\n\n2015-12-22 10:11:20,326 INFO sqlalchemy.engine.base.Engine {}\n2015-12-22 10:11:20,331 INFO sqlalchemy.engine.base.Engine COMMIT\n2015-12-22 10:11:20,333 INFO sqlalchemy.engine.base.Engine CREATE MATERIALIZED VIEW gear_item_mv AS SELECT gear.id AS id, count(gear.id) AS review_count, avg(gear.rating) AS review_rating \nFROM gear GROUP BY gear.id\n2015-12-22 10:11:20,333 INFO sqlalchemy.engine.base.Engine {}\n2015-12-22 10:11:20,341 INFO sqlalchemy.engine.base.Engine COMMIT\n2015-12-22 10:11:20,343 INFO sqlalchemy.engine.base.Engine select relname from pg_class c join pg_namespace n on n.oid=c.relnamespace where pg_catalog.pg_table_is_visible(c.oid) and relname=%(name)s\n2015-12-22 10:11:20,343 INFO sqlalchemy.engine.base.Engine {'name': u'gear'}\n2015-12-22 10:11:20,344 INFO sqlalchemy.engine.base.Engine DROP MATERIALIZED VIEW IF EXISTS gear_item_mv\n2015-12-22 10:11:20,344 INFO sqlalchemy.engine.base.Engine {}\n2015-12-22 10:11:20,346 INFO sqlalchemy.engine.base.Engine COMMIT\n2015-12-22 10:11:20,348 INFO sqlalchemy.engine.base.Engine \nDROP TABLE gear\n2015-12-22 10:11:20,348 INFO sqlalchemy.engine.base.Engine {}\n2015-12-22 10:11:20,349 INFO sqlalchemy.engine.base.Engine COMMIT\n\n\n```\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932038/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932039","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932039","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932039,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjAzOQ==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-22T15:12:39Z","updated_at":"2018-11-27T05:54:33Z","body":"**Michael Bayer ([@zzzeek](https://github.com/zzzeek)) wrote:**\n\nplease work with the above self-contained script to show me how to get your error, thanks!\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932039/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932041","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932041","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932041,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjA0MQ==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-24T02:25:34Z","updated_at":"2018-11-27T05:54:33Z","body":"**Jeff Widman ([@jeffwidman](https://github.com/jeffwidman)) wrote:**\n\nSorry about that, I was in a rush when I filed this and forgot to do a decent replication script. Thanks for taking the time to extract it. \n\nHere's a modified version of the above script where I've included a number of ways that I called `db.Index()` with each command followed by comments on what happened. It appears the 'Should not reach here on event call' error only triggers when I include a name for the index.\n\nI also included a number of ways where I included a call to `db.Index()` where I expected that when I called `db.create_all()` these would either throw an exception or succeed. They didn't throw an exception, and when I manually inspected the PostgreSQL database the index wasn't actually created. \n\nAgain, happy to do whatever is needed to help out here.\n\n--------------\n\n    # materialized_view_factory.py\n    from sqlalchemy.ext import compiler\n    from sqlalchemy.schema import DDLElement\n\n    import sqlalchemy as db\n\n\n    class CreateMaterializedView(DDLElement):\n        def __init__(self, name, selectable):\n            self.name = name\n            self.selectable = selectable\n\n\n    @compiler.compiles(CreateMaterializedView)\n    def compile(element, compiler, **kw):\n        # Could use \"CREATE OR REPLACE MATERIALIZED VIEW...\"\n        # but I'd rather have noisy errors\n        return \"CREATE MATERIALIZED VIEW %s AS %s\" % (element.name,\n                                compiler.sql_compiler.process(element.selectable))\n\n\n    def create_mat_view(metadata, name, selectable):\n        t = db.table(name)\n        for c in selectable.c:\n            c._make_proxy(t)\n        CreateMaterializedView(name, selectable).execute_at('after-create', metadata)\n        db.DDL('DROP MATERIALIZED VIEW IF EXISTS ' + name\n                                                ).execute_at('before_drop', metadata)\n        return t\n\n    from sqlalchemy.ext.declarative import declarative_base\n    Base = declarative_base()\n\n\n    class Gear(Base):\n        __tablename__ = 'gear'\n        id = db.Column(db.Integer, primary_key=True)\n        rating = db.Column(db.Integer)\n\n\n    class GearMV(Base):\n        __table__ = create_mat_view(\n                        Base.metadata,\n                        \"gear_mv\",\n                        db.select(\n                            [Gear.id.label('id'),\n                             db.func.count(Gear.id).label('review_count'),\n                             db.func.avg(Gear.rating).label('review_rating'),]\n                        ).select_from(Gear)\n                        .group_by(Gear.id))\n\n        # db.Index('id', unique=True)\n        # doesn't complain, but also doesn't actually create an index\n\n        # db.Index('test_index', 'id', unique=True)\n        # doesn't complain, but also doesn't actually create an index\n\n        # db.Index('test_index', GearMV.id, unique=True)\n        # throws: AssertionError: Should not reach here on event call\n\n\n    # db.Index(GearMV.id, unique=True)\n    # doesn't complain, but also doesn't actually create an index\n\n\n    e = db.create_engine(\"postgresql://scott:tiger@localhost/test\", echo=True) # Mike's DB\n    # e = db.create_engine(\"postgresql://rc_com@localhost/rc_test\", echo=True) # Jeff's DB\n    Base.metadata.drop_all(e)\n    Base.metadata.create_all(e)\n\n\n    # db.Index('test', GearMV.id, unique=True).create(e)\n    # throws: AssertionError: Should not reach here on event call\n\n    # db.Index(GearMV.id, unique=True).create(e)\n    # throws: sqlalchemy.exc.CompileError: Index 'GearMV.id' is not associated with\n    # any table. Not sure why, because the materialized view is created at this\n    # point.\n\n\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932041/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932042","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932042","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932042,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjA0Mg==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-24T03:09:51Z","updated_at":"2018-11-27T05:54:33Z","body":"**Michael Bayer ([@zzzeek](https://github.com/zzzeek)) wrote:**\n\nOK first two:\n\n\n```\n    # db.Index('id', unique=True)\n    # doesn't complain, but also doesn't actually create an index\n\n    # db.Index('test_index', 'id', unique=True)\n    # doesn't complain, but also doesn't actually create an index\n\n```\n\nthese Index objects aren't associated with any MetaData or Table object - they are loaded up with string values and that's it.   If you want an all-string-defined Index to be part of a Table you should call my_table.append_constraint(my_index).\n\nlooking at the rest...\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932042/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932044","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932044","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932044,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjA0NA==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-24T03:11:44Z","updated_at":"2018-11-27T05:54:33Z","body":"**Michael Bayer ([@zzzeek](https://github.com/zzzeek)) wrote:**\n\nthird one, not possible:\n\n\n```\nclass GearMV(Base):\n    # ...\n\n    db.Index('test_index', GearMV.id, unique=True)\n    # throws: AssertionError: Should not reach here on event call\n\n```\n\nGearMV is an undefined name inside the block.  Python throws NameError as expected.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932044/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932046","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932046","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932046,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjA0Ng==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-24T03:16:46Z","updated_at":"2018-11-27T05:54:33Z","body":"**Michael Bayer ([@zzzeek](https://github.com/zzzeek)) wrote:**\n\nfourth one, I begin to notice where this is wrong:\n\n\n```\ndb.Index(GearMV.id, unique=True)\n# doesn't complain, but also doesn't actually create an index\n\n```\n\nThere's no Index because GearMV is not mapped to a Table.   Only the Table construct supports piggy-backing indexes such that the CreateIndex/DropIndex DDL is associated with them.    The best we have is a lower-case table() object in create_mat_view().  We can't use Table as-is there because the semi-private _make_proxy() API doesn't support a Table as a target.  None of these patterns have ever been supported before.  \n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932046/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932047","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932047","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932047,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjA0Nw==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-24T03:22:05Z","updated_at":"2018-11-27T05:54:34Z","body":"**Michael Bayer ([@zzzeek](https://github.com/zzzeek)) wrote:**\n\noh nevermind, fourth one, wrong because the first argument to Index is *always* the index name.  This index has no columns.  Same with the first one.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932047/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932048","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932048","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932048,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjA0OA==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-24T03:22:24Z","updated_at":"2018-11-27T05:54:34Z","body":"**Michael Bayer ([@zzzeek](https://github.com/zzzeek)) wrote:**\n\nFifth one, now we see the assertion raised is *not* where I thought it was, e.g. inside the event system where there are some very deep assertions going on (no stack trace was added on this issue), it's a fairly boring one inside the schema package and is not very interesting, it's because again Index has no support for being associated with a lower-case-t table() object in this way.  \n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932048/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932049","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932049","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932049,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjA0OQ==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-24T03:24:16Z","updated_at":"2018-11-27T05:54:34Z","body":"**Michael Bayer ([@zzzeek](https://github.com/zzzeek)) wrote:**\n\nSixth one again the Index has no columns, the first argument is the name always.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932049/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932050","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932050","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932050,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjA1MA==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-24T03:43:24Z","updated_at":"2018-11-27T05:54:34Z","body":"**Michael Bayer ([@zzzeek](https://github.com/zzzeek)) wrote:**\n\nthe assertion here could use some cleanup and in fact we'd be better off trying to more explicitly check that the index is not associated with the expected kind of object, but for the case here, here is use of modern events as well as foregoing the use of _make_proxy(), just create a new Column and append:\n\n\n```\n# materialized_view_factory.py\nfrom sqlalchemy.ext import compiler\nfrom sqlalchemy.schema import DDLElement\nfrom sqlalchemy import event\nimport sqlalchemy as db\n\n\nclass CreateMaterializedView(DDLElement):\n    def __init__(self, name, selectable):\n        self.name = name\n        self.selectable = selectable\n\n\n@compiler.compiles(CreateMaterializedView)\ndef compile(element, compiler, **kw):\n    # Could use \"CREATE OR REPLACE MATERIALIZED VIEW...\"\n    # but I'd rather have noisy errors\n    return \"CREATE MATERIALIZED VIEW %s AS %s\" % (\n        element.name,\n        compiler.sql_compiler.process(element.selectable))\n\n\ndef create_mat_view(metadata, name, selectable):\n    mt = db.MetaData()\n    t = db.Table(name, mt)\n    for c in selectable.c:\n        t.append_column(db.Column(c.name, c.type, primary_key=c.primary_key))\n\n    event.listen(\n        metadata, \"after_create\",\n        CreateMaterializedView(name, selectable)\n    )\n\n    @event.listens_for(metadata, \"after_create\")\n    def create_indexes(target, connection, **kw):\n        for idx in t.indexes:\n            idx.create(connection)\n\n    event.listen(\n        metadata, \"before_drop\",\n        db.DDL('DROP MATERIALIZED VIEW IF EXISTS ' + name)\n    )\n    return t\n\nfrom sqlalchemy.ext.declarative import declarative_base\nBase = declarative_base()\n\n\nclass Gear(Base):\n    __tablename__ = 'gear'\n    id = db.Column(db.Integer, primary_key=True)\n    rating = db.Column(db.Integer)\n\n\nclass GearMV(Base):\n    __table__ = create_mat_view(\n        Base.metadata,\n        \"gear_mv\",\n        db.select(\n            [Gear.id.label('id'),\n             db.func.count(Gear.id).label('review_count'),\n             db.func.avg(Gear.rating).label('review_rating'),]\n        ).select_from(Gear)\n        .group_by(Gear.id))\n\ndb.Index('test_index', GearMV.id, unique=True)\n\n\ne = db.create_engine(\"postgresql://scott:tiger@localhost/test\", echo=True) # Mike's DB\n# e = db.create_engine(\"postgresql://rc_com@localhost/rc_test\", echo=True) # Jeff's DB\nBase.metadata.drop_all(e)\nBase.metadata.create_all(e)\n\nBase.metadata.drop_all(e)\n\n\n\n```\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932050/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932058","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932058","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932058,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjA1OA==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-24T03:43:24Z","updated_at":"2018-11-27T05:54:35Z","body":"**Changes by Michael Bayer ([@zzzeek](https://github.com/zzzeek)):**\n\n* changed **status** to closed\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932058/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1988633560,"node_id":"MDExOkNsb3NlZEV2ZW50MTk4ODYzMzU2MA==","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/events/1988633560","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2015-12-24T03:43:24Z","state_reason":null,"performed_via_github_app":null},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932051","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932051","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932051,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjA1MQ==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-24T04:00:21Z","updated_at":"2018-11-27T05:54:34Z","body":"**Michael Bayer ([@zzzeek](https://github.com/zzzeek)) wrote:**\n\n- Fixed an assertion that would raise somewhat inappropriately\nif a :class:`.Index` were associated with a :class:`.Column` that\nis associated with a lower-case-t :class:`.TableClause`; the\nassociation should be ignored for the purposes of associating\nthe index with a :class:`.Table`.\nfixes #3616\n\n\nâ†’ c7d6c667b53d\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932051/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932053","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932053","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932053,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjA1Mw==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-24T04:01:26Z","updated_at":"2018-11-27T05:54:34Z","body":"**Michael Bayer ([@zzzeek](https://github.com/zzzeek)) wrote:**\n\nwith the above fix, your script will produce \"this Index is not associated with any Table\" instead of the assertion failure.   For the time being, the Index really needs to be associated with a Table object and that's it.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932053/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932055","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932055","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932055,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjA1NQ==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-12-24T08:18:29Z","updated_at":"2018-11-27T05:54:34Z","body":"**Jeff Widman ([@jeffwidman](https://github.com/jeffwidman)) wrote:**\n\nThanks Mike for the detailed reply.\n\nI (obviously) didn't realize `db.Index` required a name--I just assumed if it wasn't passed a name that it would create an anonymous index. It's my fault, as it states this right in the docs. Be convenient if `index` realized it wasn't getting a name and threw an exception. Although since `index` takes a variable numbers of args, I suppose this is only possible if you change `name` arg to a keyword arg which is probably more hassle than its worth.\n\nIt makes complete sense to me that `Index` should be associated with a `Table` object. I just didn't know how to do that, so I very much appreciate you demonstrating it. I'd spent about half-a-day originally trying to get a `Table` object to work couldn't... I kept running into issues with db.metadata--I see you bypassed that by creating a separate metadata to use for the materialized view creation, although I don't quite understand how it gets swapped back to using the same db.metadata as the normal tables.\n\nLet me play around with this a little and then I'll update my blog post with this fixed recipe for creating a materialized view as a Table object.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932055/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932056","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616#issuecomment-441932056","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","id":441932056,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMjA1Ng==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2016-01-05T09:13:34Z","updated_at":"2018-11-27T05:54:35Z","body":"**Jeff Widman ([@jeffwidman](https://github.com/jeffwidman)) wrote:**\n\nThanks again for the help on this Mike--I updated my blog post on [sqlalchemy + postgresql materialized views](http://www.jeffwidman.com/blog/847/using-sqlalchemy-to-create-and-manage-postgresql-materialized-views/) using the new code posted above. \n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441932056/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1988633555,"node_id":"MDEyOkxhYmVsZWRFdmVudDE5ODg2MzM1NTU=","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/events/1988633555","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-11-27T05:54:32Z","label":{"name":"postgres","color":"60A070"},"performed_via_github_app":null},{"id":1988633556,"node_id":"MDEyOkxhYmVsZWRFdmVudDE5ODg2MzM1NTY=","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/events/1988633556","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-11-27T05:54:33Z","label":{"name":"bug","color":"d73a4a"},"performed_via_github_app":null},{"id":1988633557,"node_id":"MDEyOkxhYmVsZWRFdmVudDE5ODg2MzM1NTc=","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/events/1988633557","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-11-27T05:54:33Z","label":{"name":"low priority","color":"90C0D0"},"performed_via_github_app":null}]