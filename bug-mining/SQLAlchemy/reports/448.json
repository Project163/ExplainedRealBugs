{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3613","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3613/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3613/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3613/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3613","id":384635672,"node_id":"MDU6SXNzdWUzODQ2MzU2NzI=","number":3613,"title":"MySQL views reflected without all keywords","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141273954,"node_id":"MDU6TGFiZWwxMTQxMjczOTU0","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/mysql","name":"mysql","color":"30A040","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/57","html_url":"https://github.com/sqlalchemy/sqlalchemy/milestone/57","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/57/labels","id":3850634,"node_id":"MDk6TWlsZXN0b25lMzg1MDYzNA==","number":57,"title":"1.0.xx","description":null,"creator":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":127,"state":"closed","created_at":"2018-11-27T04:15:49Z","updated_at":"2018-11-28T16:49:57Z","due_on":null,"closed_at":"2018-11-28T16:49:57Z"},"comments":3,"created_at":"2015-12-16T22:12:03Z","updated_at":"2015-12-22T17:05:27Z","closed_at":"2015-12-22T17:05:27Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Michael Bayer ([@zzzeek](https://github.com/zzzeek))**\n\nlocally, a MySQL view reflected works from data reported like this:\n\n    CREATE ALGORITHM=UNDEFINED DEFINER=`scott`@`localhost` SQL SECURITY DEFINER VIEW `v1` AS select `x`.`a` AS `a`,`x`.`b` AS `b` from `x`\n\nthat is, it's injecting every term we see at http://dev.mysql.com/doc/refman/5.7/en/create-view.html into the output.\n\nHowever we have an amazon RDS user reporting that this is failing for one environment, and it is likely that this env. has some MySQL version that isn't putting all those keywords in there.\n\nThe patch below includes a fix for this as well as a test, though my local MySQL version doesn't reproduce the reported failing case:\n\n\n```\ndiff --git a/lib/sqlalchemy/dialects/mysql/base.py b/lib/sqlalchemy/dialects/mysql/base.py\nindex 9887464..12405db 100644\n--- a/lib/sqlalchemy/dialects/mysql/base.py\n+++ b/lib/sqlalchemy/dialects/mysql/base.py\n@@ -2804,7 +2804,7 @@ class MySQLDialect(default.DefaultDialect):\n             schema, table_name))\n         sql = self._show_create_table(connection, None, charset,\n                                       full_name=full_name)\n-        if sql.startswith('CREATE ALGORITHM'):\n+        if re.match(r'CREATE (?:ALGORITHM)?.* VIEW', sql):\n             # Adapt views to something table-like.\n             columns = self._describe_table(connection, None, charset,\n                                            full_name=full_name)\ndiff --git a/test/dialect/mysql/test_reflection.py b/test/dialect/mysql/test_reflection.py\nindex a288762..b8cbea8 100644\n--- a/test/dialect/mysql/test_reflection.py\n+++ b/test/dialect/mysql/test_reflection.py\n@@ -397,6 +397,37 @@ class ReflectionTest(fixtures.TestBase, AssertsExecutionResults):\n         finally:\n             meta.drop_all()\n \n+    @testing.provide_metadata\n+    def test_view_reflection(self):\n+        Table('x', self.metadata, Column('a', Integer), Column('b', String(50)))\n+        self.metadata.create_all()\n+\n+        with testing.db.connect() as conn:\n+            conn.execute(\"CREATE VIEW v1 AS SELECT * FROM x\")\n+            conn.execute(\n+                \"CREATE ALGORITHM=MERGE VIEW v2 AS SELECT * FROM x\")\n+            conn.execute(\n+                \"CREATE ALGORITHM=UNDEFINED VIEW v3 AS SELECT * FROM x\")\n+            conn.execute(\n+                \"CREATE DEFINER=CURRENT_USER VIEW v4 AS SELECT * FROM x\")\n+\n+        @event.listens_for(self.metadata, \"before_drop\")\n+        def cleanup(*arg, **kw):\n+            with testing.db.connect() as conn:\n+                for v in ['v1', 'v2', 'v3', 'v4']:\n+                    conn.execute(\"DROP VIEW %s\" % v)\n+\n+        insp = inspect(testing.db)\n+        for v in ['v1', 'v2', 'v3', 'v4']:\n+            eq_(\n+                [\n+                    (col['name'], col['type'].__class__)\n+                    for col in insp.get_columns(v)\n+                ],\n+                [('a', mysql.INTEGER), ('b', mysql.VARCHAR)]\n+            )\n+\n+\n     @testing.exclude('mysql', '<', (5, 0, 0), 'no information_schema support')\n     def test_system_views(self):\n         dialect = testing.db.dialect\n\n```\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3613/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3613/timeline","performed_via_github_app":null,"state_reason":"completed"}