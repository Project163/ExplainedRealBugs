[{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441930027","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3483#issuecomment-441930027","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3483","id":441930027,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMDAyNw==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-07-11T06:02:41Z","updated_at":"2018-11-27T05:48:49Z","body":"**Michael Bayer ([@zzzeek](https://github.com/zzzeek)) wrote:**\n\npotential patch, need to see if we are handling the non-lowered keyname correctly in resultproxy, I have a feeling that because we aren't calling lower() on it in ResultMetaData._create_result_map it might have an issue there.\n\n```\ndiff --git a/lib/sqlalchemy/engine/result.py b/lib/sqlalchemy/engine/result.py\nindex b2b78de..682cbd1 100644\n--- a/lib/sqlalchemy/engine/result.py\n+++ b/lib/sqlalchemy/engine/result.py\n@@ -221,7 +221,7 @@ class ResultMetaData(object):\n                 in enumerate(result_columns)\n             ]\n             self.keys = [\n-                elem[1] for elem in result_columns\n+                elem[0] for elem in result_columns\n             ]\n         else:\n             # case 2 - raw string, or number of columns in result does\ndiff --git a/lib/sqlalchemy/sql/compiler.py b/lib/sqlalchemy/sql/compiler.py\nindex e9c3d0e..0c1a827 100644\n--- a/lib/sqlalchemy/sql/compiler.py\n+++ b/lib/sqlalchemy/sql/compiler.py\n@@ -1270,9 +1270,6 @@ class SQLCompiler(Compiled):\n         return \" AS \" + alias_name_text\n \n     def _add_to_result_map(self, keyname, name, objects, type_):\n-        if not self.dialect.case_sensitive:\n-            keyname = keyname.lower()\n-\n         self._result_columns.append((keyname, name, objects, type_))\n \n     def _label_select_column(self, select, column,\n\n```\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441930027/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441930028","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3483#issuecomment-441930028","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3483","id":441930028,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMDAyOA==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-07-11T06:07:39Z","updated_at":"2018-11-27T05:48:49Z","body":"**Michael Bayer ([@zzzeek](https://github.com/zzzeek)) wrote:**\n\nso that diff would be:\n\n\n```\ndiff --git a/lib/sqlalchemy/engine/result.py b/lib/sqlalchemy/engine/result.py\nindex b2b78de..f230b90 100644\n--- a/lib/sqlalchemy/engine/result.py\n+++ b/lib/sqlalchemy/engine/result.py\n@@ -221,7 +221,7 @@ class ResultMetaData(object):\n                 in enumerate(result_columns)\n             ]\n             self.keys = [\n-                elem[1] for elem in result_columns\n+                elem[0] for elem in result_columns\n             ]\n         else:\n             # case 2 - raw string, or number of columns in result does\n@@ -236,7 +236,8 @@ class ResultMetaData(object):\n             # that SQLAlchemy has used up through 0.9.\n \n             if num_ctx_cols:\n-                result_map = self._create_result_map(result_columns)\n+                result_map = self._create_result_map(\n+                    result_columns, case_sensitive)\n \n             raw = []\n             self.keys = []\n@@ -256,10 +257,13 @@ class ResultMetaData(object):\n \n                 self.keys.append(colname)\n                 if not case_sensitive:\n+                    # we lower case the colname from cursor.description here...\n                     colname = colname.lower()\n \n                 if num_ctx_cols:\n                     try:\n+                        # then we look it up, so we'd need the keys\n+                        # in result map to be lowered also\n                         ctx_rec = result_map[colname]\n                     except KeyError:\n                         mapped_type = typemap.get(coltype, sqltypes.NULLTYPE)\n@@ -329,10 +333,12 @@ class ResultMetaData(object):\n                 ])\n \n     @classmethod\n-    def _create_result_map(cls, result_columns):\n+    def _create_result_map(cls, result_columns, case_sensitive):\n         d = {}\n         for elem in result_columns:\n             key, rec = elem[0], elem[1:]\n+            if not case_sensitive:\n+                key = key.lower()\n             if key in d:\n                 # conflicting keyname, just double up the list\n                 # of objects.  this will cause an \"ambiguous name\"\ndiff --git a/lib/sqlalchemy/sql/compiler.py b/lib/sqlalchemy/sql/compiler.py\nindex e9c3d0e..0c1a827 100644\n--- a/lib/sqlalchemy/sql/compiler.py\n+++ b/lib/sqlalchemy/sql/compiler.py\n@@ -1270,9 +1270,6 @@ class SQLCompiler(Compiled):\n         return \" AS \" + alias_name_text\n \n     def _add_to_result_map(self, keyname, name, objects, type_):\n-        if not self.dialect.case_sensitive:\n-            keyname = keyname.lower()\n-\n         self._result_columns.append((keyname, name, objects, type_))\n \n     def _label_select_column(self, select, column,\n\n```\n\neven forcing on the _create_result_map() approach for all result sets, no tests fail, so we need some more case sensitivity tests here.\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441930028/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441930029","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3483#issuecomment-441930029","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3483","id":441930029,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMDAyOQ==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-07-19T16:20:47Z","updated_at":"2018-11-27T05:48:50Z","body":"**Michael Bayer ([@zzzeek](https://github.com/zzzeek)) wrote:**\n\n- Fixed regression where :meth:`.ResultProxy.keys` would return\nun-adjusted internal symbol names for \"anonymous\" labels, which\nare the \"foo_1\" types of labels we see generated for SQL functions\nwithout labels and similar.  This was a side effect of the\nperformance enhancements implemented as part of references #918.\nfixes #3483\n\n\nâ†’ d7ceb63c94e4\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441930029/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441930030","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3483#issuecomment-441930030","issue_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3483","id":441930030,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0MTkzMDAzMA==","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-07-19T16:20:47Z","updated_at":"2018-11-27T05:48:50Z","body":"**Changes by Michael Bayer ([@zzzeek](https://github.com/zzzeek)):**\n\n* changed **status** to closed\n","author_association":"COLLABORATOR","reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/comments/441930030/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1988626729,"node_id":"MDExOkNsb3NlZEV2ZW50MTk4ODYyNjcyOQ==","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/events/1988626729","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2015-07-19T16:20:47Z","state_reason":null,"performed_via_github_app":null},{"id":1988626720,"node_id":"MDEyOkxhYmVsZWRFdmVudDE5ODg2MjY3MjA=","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/events/1988626720","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-11-27T05:48:49Z","label":{"name":"bug","color":"d73a4a"},"performed_via_github_app":null},{"id":1988626723,"node_id":"MDEyOkxhYmVsZWRFdmVudDE5ODg2MjY3MjM=","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/events/1988626723","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2018-11-27T05:48:49Z","label":{"name":"engine","color":"B04040"},"performed_via_github_app":null},{"id":1988626724,"node_id":"MDE1Ok1pbGVzdG9uZWRFdmVudDE5ODg2MjY3MjQ=","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/events/1988626724","actor":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"milestoned","commit_id":null,"commit_url":null,"created_at":"2018-11-27T05:48:49Z","milestone":{"title":"1.0.7"},"performed_via_github_app":null}]