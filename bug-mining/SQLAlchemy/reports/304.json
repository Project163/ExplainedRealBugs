{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3335","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3335/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3335/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3335/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3335","id":384633148,"node_id":"MDU6SXNzdWUzODQ2MzMxNDg=","number":3335,"title":"ordering by a label present in an `alias` will create an invalid query","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2015-03-20T23:18:14Z","updated_at":"2015-03-21T18:40:54Z","closed_at":"2015-03-21T17:12:45Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by jvanasco ([@jvanasco](https://github.com/jvanasco))**\n\nthis is a new issue with 1.0.0b2 and Postgres.  i am not sure if other databases will fail.  \n\nthis is a bit of an confusing to describe, so bear with me.  \n\ni made an example, but it is confusing too!  \n\nhttps://gist.github.com/jvanasco/986c30d91095cef5526f\n\nthe issue is in the interplay of aliased columns and an \"ORDER BY\"\n\nIf the ordering column's name is the same as a column name in the aliased \"select\", then an ordering will be applied to the column in the aliased select -- which breaks a GROUP BY.  if the column name is not in the aliased select, then the ordering will be generated as a bareword -- which is the valid query.\n\n* query_form_a \n\tthis worked in 0.9.9, it does not work in 1.0.0b2\n\t\n\tline 100 applies a 'event_timestamp' label over the 'event_timestamp' column.\n\tline 110 sorts on 'event_timestamp'\n\t\n\tThis will output \n\t\t0.9.9\t`ORDER BY event_timestamp DESC`\n\t\t1.0.0b2\t`ORDER BY q_stream.event_timestamp DESC`\n\n* query form b\n\tthis did not work in 0.9.9 and does not work in 1.0.0b2\n\tjust shown for comparison\n\t\n\tline 137 we select an 'event_timestamp' column\n\tline 147 sorts on 'event_timestamp'\n\n\n* query form c\n\tthis works on 0.9.9 and 1.0.0b2 however it requires a column renaming\n\n\tline 174 we select the 'event_timestamp' column and rename it 'timestamp_renamed'\n\tline 184 sorts on 'timestamp_renamed'\n\n\tThis will output \n\t\t0.9.9 \t`ORDER BY timestamp_renamed DESC`\n\t\t1.0.0b2 `ORDER BY timestamp_renamed DESC`\n\nnote: i used the following sqlalchemy connection string so it would hit the DB and raise the query exceptions for postgres.  i found that easier than inspecting the sql in a memory engine.\n    user - sqlalchemy_test\n    password - sqla\n    database - sqlalchemy_test\n\n\n\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3335/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3335/timeline","performed_via_github_app":null,"state_reason":"completed"}