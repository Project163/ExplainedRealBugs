{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3616","id":384635693,"node_id":"MDU6SXNzdWUzODQ2MzU2OTM=","number":3616,"title":"Calling Index() on a materialized view throws unexpected exception","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141273863,"node_id":"MDU6TGFiZWwxMTQxMjczODYz","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/low%20priority","name":"low priority","color":"90C0D0","default":false,"description":null},{"id":1141273914,"node_id":"MDU6TGFiZWwxMTQxMjczOTE0","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/postgresql","name":"postgresql","color":"60A070","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2015-12-22T04:21:12Z","updated_at":"2016-01-05T09:13:34Z","closed_at":"2015-12-24T03:43:24Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Jeff Widman ([@jeffwidman](https://github.com/jeffwidman))**\n\nFollowup on this discussion on the mailing list: https://groups.google.com/forum/m/#!topic/sqlalchemy/2AoHW95Iqyw\n\nMy recipe for creating/managing materialized views using SQLAlchemy is at the bottom of this blog post: \nhttp://www.jeffwidman.com/blog/847/using-sqlalchemy-to-create-and-manage-postgresql-materialized-views/\n\nThere's also an example materialized view there, where I created an index using a custom DDL command. \n\nTrying to use the normal Index(materialized_view.column, unique=True) syntax throws the following exception:\n\n/db.Index(GearCategoryMV.id, unique=False)/ \n/ \n/ \n/# fails with the following traceback/ \n/ \n/ \n/Traceback (most recent call last):/ \n/  File \"manage.py\", line 11, in <module>/ \n/    from app.models.gear_models import (GearCategory, GearCategoryMV, \nGearItem,/ \n/  File \n\"/Users/jeffwidman/Code/rc/api_rc_flask/app/models/gear_models.py\", line \n428, in <module>/ \n/    db.Index('myindex', GearCategoryMV.id, unique=True)/ \n/  File \n\"/Users/jeffwidman/.virtualenvs/api_rc_flask/lib/python3.5/site-packages/sqlalchemy/sql/schema.py\", \nline 3172, in __init__/ \n/    ColumnCollectionMixin.__init__(self, *columns)/ \n/  File \n\"/Users/jeffwidman/.virtualenvs/api_rc_flask/lib/python3.5/site-packages/sqlalchemy/sql/schema.py\", \nline 2446, in __init__/ \n/    self._check_attach()/ \n/  File \n\"/Users/jeffwidman/.virtualenvs/api_rc_flask/lib/python3.5/site-packages/sqlalchemy/sql/schema.py\", \nline 2491, in _check_attach/ \n/    col._on_table_attach(_col_attached)/ \n/  File \n\"/Users/jeffwidman/.virtualenvs/api_rc_flask/lib/python3.5/site-packages/sqlalchemy/sql/schema.py\", \nline 1306, in _on_table_attach/ \n/    fn(self, self.table)/ \n/  File \n\"/Users/jeffwidman/.virtualenvs/api_rc_flask/lib/python3.5/site-packages/sqlalchemy/sql/schema.py\", \nline 2488, in _col_attached/ \n/    self._check_attach(evt=True)/ \n/  File \n\"/Users/jeffwidman/.virtualenvs/api_rc_flask/lib/python3.5/site-packages/sqlalchemy/sql/schema.py\", \nline 2479, in _check_attach/ \n/    assert not evt, \"Should not reach here on event call\"/ \n/AssertionError: Should not reach here on event call/ \n\n\nLet me know if I can do anything else to help here.\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3616/timeline","performed_via_github_app":null,"state_reason":"completed"}