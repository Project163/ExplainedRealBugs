{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/8478","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/8478/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/8478/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/8478/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/8478","id":1359105247,"node_id":"I_kwDOCX5JB85RAkzf","number":8478,"title":"Pep 604 unions as Mapped type arguments","user":{"login":"peterschutt","id":20659309,"node_id":"MDQ6VXNlcjIwNjU5MzA5","avatar_url":"https://avatars.githubusercontent.com/u/20659309?v=4","gravatar_id":"","url":"https://api.github.com/users/peterschutt","html_url":"https://github.com/peterschutt","followers_url":"https://api.github.com/users/peterschutt/followers","following_url":"https://api.github.com/users/peterschutt/following{/other_user}","gists_url":"https://api.github.com/users/peterschutt/gists{/gist_id}","starred_url":"https://api.github.com/users/peterschutt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peterschutt/subscriptions","organizations_url":"https://api.github.com/users/peterschutt/orgs","repos_url":"https://api.github.com/users/peterschutt/repos","events_url":"https://api.github.com/users/peterschutt/events{/privacy}","received_events_url":"https://api.github.com/users/peterschutt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141273966,"node_id":"MDU6TGFiZWwxMTQxMjczOTY2","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/orm","name":"orm","color":"20C0B0","default":false,"description":null},{"id":1141297829,"node_id":"MDU6TGFiZWwxMTQxMjk3ODI5","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/declarative","name":"declarative","color":"602050","default":false,"description":"has to do with the declarative API, scanning classes and mixins for attributes to be mapped"},{"id":1313059238,"node_id":"MDU6TGFiZWwxMzEzMDU5MjM4","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/use%20case","name":"use case","color":"b54650","default":false,"description":"not really a feature or a bug; can be support for new DB features or user use cases not anticipated"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2022-09-01T16:21:59Z","updated_at":"2022-09-08T23:01:46Z","closed_at":"2022-09-08T19:00:45Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Describe the bug\n\nPython 3.10 introduced [types.UnionType](https://docs.python.org/3/library/types.html#types.UnionType) allowing use of the binary-or operator `|` to signify a union.\r\n\r\nUse of this syntax as a type argument to `Mapped`, e.g, `Mapped[str | None]` currently raises an exception:\r\n\r\n> sqlalchemy.exc.ArgumentError: Could not locate SQLAlchemy Core type for Python type: str | None\n\n### To Reproduce\n\n```python\nfrom sqlalchemy.orm import DeclarativeBase\r\nfrom sqlalchemy.orm import Mapped\r\nfrom sqlalchemy.orm import mapped_column\r\n\r\n\r\nclass Base(DeclarativeBase):\r\n    pass\r\n\r\n\r\nclass User(Base):\r\n    __tablename__ = \"user_account\"\r\n    id: Mapped[int] = mapped_column(primary_key=True)\r\n    fullname: Mapped[str | None]\n```\n\n\n### Error\n\n```\r\n  File \"/home/peter/PycharmProjects/sqlalchemy-union-type/main.py\", line 10, in <module>\r\n    class User(Base):\r\n  File \"/home/peter/.cache/pypoetry/virtualenvs/pythonproject5-vrVFCPGN-py3.10/lib/python3.10/site-packages/sqlalchemy/orm/decl_api.py\", line 698, in __init_subclass__\r\n    _as_declarative(cls._sa_registry, cls, cls.__dict__)\r\n  File \"/home/peter/.cache/pypoetry/virtualenvs/pythonproject5-vrVFCPGN-py3.10/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py\", line 207, in _as_declarative\r\n    return _MapperConfig.setup_mapping(registry, cls, dict_, None, {})\r\n  File \"/home/peter/.cache/pypoetry/virtualenvs/pythonproject5-vrVFCPGN-py3.10/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py\", line 288, in setup_mapping\r\n    return _ClassScanMapperConfig(\r\n  File \"/home/peter/.cache/pypoetry/virtualenvs/pythonproject5-vrVFCPGN-py3.10/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py\", line 523, in __init__\r\n    self._extract_mappable_attributes()\r\n  File \"/home/peter/.cache/pypoetry/virtualenvs/pythonproject5-vrVFCPGN-py3.10/lib/python3.10/site-packages/sqlalchemy/orm/decl_base.py\", line 1258, in _extract_mappable_attributes\r\n    value.declarative_scan(\r\n  File \"/home/peter/.cache/pypoetry/virtualenvs/pythonproject5-vrVFCPGN-py3.10/lib/python3.10/site-packages/sqlalchemy/orm/properties.py\", line 630, in declarative_scan\r\n    self._init_column_for_annotation(\r\n  File \"/home/peter/.cache/pypoetry/virtualenvs/pythonproject5-vrVFCPGN-py3.10/lib/python3.10/site-packages/sqlalchemy/orm/properties.py\", line 702, in _init_column_for_annotation\r\n    raise sa_exc.ArgumentError(\r\nsqlalchemy.exc.ArgumentError: Could not locate SQLAlchemy Core type for Python type: str | None\r\n``` \n\n### Versions\n\n- OS: Ubuntu 20.04\r\n- Python: 3.10.6\r\n- SQLAlchemy: 2.0.0b1.dev0\r\n- Database: n/a\r\n- DBAPI (eg: psycopg, cx_oracle, mysqlclient): n/a\r\n\n\n### Additional context\n\n_No response_","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/8478/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/8478/timeline","performed_via_github_app":null,"state_reason":"completed"}