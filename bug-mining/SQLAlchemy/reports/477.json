{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3640","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3640/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3640/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3640/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3640","id":384635929,"node_id":"MDU6SXNzdWUzODQ2MzU5Mjk=","number":3640,"title":"make_transient causes field values to disappear","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141273862,"node_id":"MDU6TGFiZWwxMTQxMjczODYy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/documentation","name":"documentation","color":"ffe7a8","default":true,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/57","html_url":"https://github.com/sqlalchemy/sqlalchemy/milestone/57","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/57/labels","id":3850634,"node_id":"MDk6TWlsZXN0b25lMzg1MDYzNA==","number":57,"title":"1.0.xx","description":null,"creator":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":127,"state":"closed","created_at":"2018-11-27T04:15:49Z","updated_at":"2018-11-28T16:49:57Z","due_on":null,"closed_at":"2018-11-28T16:49:57Z"},"comments":27,"created_at":"2016-01-29T08:18:31Z","updated_at":"2016-02-10T14:53:17Z","closed_at":"2016-02-08T23:08:26Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by zestyping ([@zestyping](https://github.com/zestyping))**\n\nMy intended use case is to retrieve a row from a table and add a modified copy of the row. Using SQLAlchemy, I'm expressing this as a query, followed by make_transient() on the retrieved instance, modifying some fields on the instance, and then committing the new instance.\n\nAfter this point the instance is in a mysterious state, in which calling make_transient() on it makes the values of its fields disappear.  There are at least 3 invariants violated here:\n\n1. After make_transient(), fields that should have values become None.  I would expect make_transient() to never change any fields of the instance.\n\n2. The persistent instance after add() and commit() does not have behaviour identical to that of an instance loaded by a query() that retrieves the same row.  I would expect such instances to be indistinguishable in all respects.\n\n3. Merely accessing a field after commit() causes it to no longer become None after make_transient().  I would expect that merely reading a field never has detectable side effects.\n\nThe following script demonstrates the bug.\n\n```\nimport sys\nimport sqlalchemy\nimport sqlalchemy.orm\nimport sqlalchemy.ext.declarative\nfrom sqlalchemy import Table, Column, Integer, Sequence, MetaData\n\nprint('sys.version = %s' % sys.version)\nprint('sqlalchemy.__version__ = %s' % sqlalchemy.__version__)\nprint('')\n\nBase = sqlalchemy.ext.declarative.declarative_base()\n\nclass Foo(Base):\n    __tablename__ = 'foo'\n    id = Column(Integer, primary_key=True)\n    value = Column(Integer)\n\nengine = sqlalchemy.create_engine('sqlite:///:memory:')\nBase.metadata.create_all(engine)\n\ns = sqlalchemy.orm.sessionmaker()\ns.configure(bind=engine)\ndb = s()\n\n# Insert one row.\nx = Foo(id=1, value=1)\ndb.add(x)\ndb.commit()\nprint('x.value = %r' % x.value)  # prints 1\n\n# Fetch the row and use it as a template for a second row to insert.\ny = db.query(Foo).first()\nsqlalchemy.orm.make_transient(y)\n\ny.id = 2\nprint('y.value = %r' % y.value)  # prints 1\ndb.add(y)\ndb.commit()\n\n# Merely accessing y.value here will change the output printed below!\n# y.value\n\nsqlalchemy.orm.make_transient(y)\nprint('y.value = %r' % y.value)  # prints None (should print 1)\n```\n\nExpected output is:\n```\nx.value = 1\ny.value = 1\ny.value = 1\n```\n\nActual output in Python3:\n```\nsys.version = 3.5.0 (default, Sep 23 2015, 04:42:00) \n[GCC 4.2.1 Compatible Apple LLVM 7.0.0 (clang-700.0.72)]\nsqlalchemy.__version__ = 1.0.11\n\nx.value = 1\ny.value = 1\ny.value = None\n```\n\nActual output in Python 2.7:\n```\nsys.version = 2.7.10 (default, Jul 14 2015, 19:46:27) \n[GCC 4.2.1 Compatible Apple LLVM 6.0 (clang-600.0.39)]\nsqlalchemy.__version__ = 1.0.11\n\nx.value = 1\ny.value = 1\ny.value = None\n```\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3640/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3640/timeline","performed_via_github_app":null,"state_reason":"completed"}