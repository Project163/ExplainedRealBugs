{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3621","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3621/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3621/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3621/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3621","id":384635739,"node_id":"MDU6SXNzdWUzODQ2MzU3Mzk=","number":3621,"title":"Oracle zxJDBC fails with AttributeError in object OracleCompiler_zxjdbc","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141273863,"node_id":"MDU6TGFiZWwxMTQxMjczODYz","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/low%20priority","name":"low priority","color":"90C0D0","default":false,"description":null},{"id":1141274156,"node_id":"MDU6TGFiZWwxMTQxMjc0MTU2","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/oracle","name":"oracle","color":"A020C0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/57","html_url":"https://github.com/sqlalchemy/sqlalchemy/milestone/57","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/57/labels","id":3850634,"node_id":"MDk6TWlsZXN0b25lMzg1MDYzNA==","number":57,"title":"1.0.xx","description":null,"creator":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":127,"state":"closed","created_at":"2018-11-27T04:15:49Z","updated_at":"2018-11-28T16:49:57Z","due_on":null,"closed_at":"2018-11-28T16:49:57Z"},"comments":17,"created_at":"2016-01-02T01:20:40Z","updated_at":"2016-02-02T22:32:11Z","closed_at":"2016-02-02T22:31:26Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Carlos Rivas**\n\nI understand that Oracle zxJDBC is not currently supported but, in my case, it seems that a simple fix has brought it back to life.\n\nCurrently, working with Oracle zxJDBC with Jython 2.7.1b2 fails:\n\n```\nTraceback (most recent call last):\n  File \"/Users/carlos/projects/pydev/smaf-flask/main.py\", line 70, in <module>\n    db.session.commit()\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/orm/scoping.py\", line 150, in do\n    return getattr(self.registry(), name)(*args, **kwargs)\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/orm/session.py\", line 813, in commit\n    self.transaction.commit()\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/orm/session.py\", line 392, in commit\n    self._prepare_impl()\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/orm/session.py\", line 372, in _prepare_impl\n    self.session.flush()\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/orm/session.py\", line 2027, in flush\n    self._flush(objects)\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/orm/session.py\", line 2145, in _flush\n    transaction.rollback(_capture_exception=True)\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/util/langhelpers.py\", line 60, in __exit__\n    compat.reraise(exc_type, exc_value, exc_tb)\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/orm/session.py\", line 2109, in _flush\n    flush_context.execute()\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/orm/unitofwork.py\", line 373, in execute\n    rec.execute(self)\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/orm/unitofwork.py\", line 529, in execute\n    persistence.save_obj(self.mapper,\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/orm/persistence.py\", line 172, in save_obj\n    _emit_insert_statements(base_mapper, uowtransaction,\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/orm/persistence.py\", line 799, in _emit_insert_statements\n    result = cached_connections[connection].\\\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/engine/base.py\", line 914, in execute\n    return meth(self, multiparams, params)\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/sql/elements.py\", line 323, in _execute_on_connection\n    return connection._execute_clauseelement(self, multiparams, params)\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/engine/base.py\", line 996, in _execute_clauseelement\n    compiled_sql = elem.compile(\n  File \"<string>\", line 1, in <lambda>\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/sql/elements.py\", line 494, in compile\n    return self._compiler(dialect, bind=bind, **kw)\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/sql/elements.py\", line 500, in _compiler\n    return dialect.statement_compiler(dialect, self, **kw)\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/dialects/oracle/base.py\", line 581, in __init__\n    super(OracleCompiler, self).__init__(*args, **kwargs)\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/sql/compiler.py\", line 392, in __init__\n    Compiled.__init__(self, dialect, statement, **kwargs)\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/sql/compiler.py\", line 190, in __init__\n    self.string = self.process(self.statement, **compile_kwargs)\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/sql/compiler.py\", line 213, in process\n    return obj._compiler_dispatch(self, **kwargs)\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/sql/visitors.py\", line 81, in _compiler_dispatch\n    return meth(self, **kw)\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/sql/compiler.py\", line 1875, in visit_insert\n    returning_clause = self.returning_clause(\n  File \"/opt/python/jyflask/Lib/site-packages/sqlalchemy/dialects/oracle/zxjdbc.py\", line 74, in returning_clause\n    columns = [self.process(c, within_columns_clause=False,\nAttributeError: 'OracleCompiler_zxjdbc' object has no attribute 'result_map'\n```\nIt seems that the problem stems from within the `zxjdbc.py` file in `oracle/dialects` folder.  \n\nChanging line:\n```\n        # within_columns_clause=False so that labels (foo AS bar) don't render\n        columns = [self.process(c, within_columns_clause=False,\n                                result_map=self.result_map)\n                   for c in self.returning_cols]\n```\n\nto:\n\n```\n        # within_columns_clause=False so that labels (foo AS bar) don't render\n        columns = [self.process(c, within_columns_clause=False,\n                                result_map=self._create_result_map())\n                   for c in self.returning_cols]\n```\n\nseems to fix the issue.  I've searched BitBucket for an existing ticket but to no avail.  Please, can you let me know that this is the correct approach to fix this file?  Thanks!\n\nI should also note that I used Oracle 11.2.0.4.0 ojdbc6.jar\n\n----------------------------------------\nAttachments: [oracle_poc.txt](../wiki/imported_issue_attachments/3621/oracle_poc.txt)\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3621/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3621/timeline","performed_via_github_app":null,"state_reason":"completed"}