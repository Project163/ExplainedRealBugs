{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/4915","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/4915/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/4915/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/4915/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/4915","id":507507429,"node_id":"MDU6SXNzdWU1MDc1MDc0Mjk=","number":4915,"title":"Passing None to query(...).get(__) results in TypeError","user":{"login":"lizraeli","id":12574319,"node_id":"MDQ6VXNlcjEyNTc0MzE5","avatar_url":"https://avatars.githubusercontent.com/u/12574319?v=4","gravatar_id":"","url":"https://api.github.com/users/lizraeli","html_url":"https://github.com/lizraeli","followers_url":"https://api.github.com/users/lizraeli/followers","following_url":"https://api.github.com/users/lizraeli/following{/other_user}","gists_url":"https://api.github.com/users/lizraeli/gists{/gist_id}","starred_url":"https://api.github.com/users/lizraeli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lizraeli/subscriptions","organizations_url":"https://api.github.com/users/lizraeli/orgs","repos_url":"https://api.github.com/users/lizraeli/repos","events_url":"https://api.github.com/users/lizraeli/events{/privacy}","received_events_url":"https://api.github.com/users/lizraeli/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"},{"id":1141273966,"node_id":"MDU6TGFiZWwxMTQxMjczOTY2","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/orm","name":"orm","color":"20C0B0","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/90","html_url":"https://github.com/sqlalchemy/sqlalchemy/milestone/90","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/milestones/90/labels","id":4888003,"node_id":"MDk6TWlsZXN0b25lNDg4ODAwMw==","number":90,"title":"1.3.x","description":null,"creator":{"login":"zzzeek","id":128223,"node_id":"MDQ6VXNlcjEyODIyMw==","avatar_url":"https://avatars.githubusercontent.com/u/128223?v=4","gravatar_id":"","url":"https://api.github.com/users/zzzeek","html_url":"https://github.com/zzzeek","followers_url":"https://api.github.com/users/zzzeek/followers","following_url":"https://api.github.com/users/zzzeek/following{/other_user}","gists_url":"https://api.github.com/users/zzzeek/gists{/gist_id}","starred_url":"https://api.github.com/users/zzzeek/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zzzeek/subscriptions","organizations_url":"https://api.github.com/users/zzzeek/orgs","repos_url":"https://api.github.com/users/zzzeek/repos","events_url":"https://api.github.com/users/zzzeek/events{/privacy}","received_events_url":"https://api.github.com/users/zzzeek/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":279,"state":"closed","created_at":"2019-11-28T15:49:07Z","updated_at":"2024-07-03T20:28:12Z","due_on":null,"closed_at":"2023-01-27T18:28:50Z"},"comments":6,"created_at":"2019-10-15T22:07:00Z","updated_at":"2019-12-18T15:49:05Z","closed_at":"2019-10-30T18:20:24Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Passing `None` to `query.get()`, i.e.:\r\n```python\r\nself.db.session.query(...).get(None)\r\n```\r\nresults in a TypeError in [query.py#L955](https://github.com/sqlalchemy/sqlalchemy/blob/master/lib/sqlalchemy/orm/query.py#L955):\r\n```python\r\nif len(primary_key_identity) != len(mapper.primary_key):\r\n```\r\nPrior to this check, the `primary_key_identity` is reassigned based on the return value of passing it to `to_list`:\r\n ```python\r\n        if not is_dict:\r\n            primary_key_identity = util.to_list(primary_key_identity)\r\n```\r\nHowever, `to_list` returns the default value of `None` if `None` is passed as the argument. In [_collections.py#L802](https://github.com/sqlalchemy/sqlalchemy/blob/885f15a306efc4c907ca82fa13871992ee556466/lib/sqlalchemy/util/_collections.py#L802)\r\n```python\r\ndef to_list(x, default=None):\r\n    if x is None:\r\n        return default\r\n    ...\r\n```\r\nI believe it may be worth either explictly checking if `primary_key_identity ` is `None`, or passing an empty list as the `default` value when calling `util.to_list`","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/4915/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/4915/timeline","performed_via_github_app":null,"state_reason":"completed"}