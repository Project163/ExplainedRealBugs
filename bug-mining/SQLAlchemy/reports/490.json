{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3663","repository_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy","labels_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3663/labels{/name}","comments_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3663/comments","events_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3663/events","html_url":"https://github.com/sqlalchemy/sqlalchemy/issues/3663","id":384636156,"node_id":"MDU6SXNzdWUzODQ2MzYxNTY=","number":3663,"title":"column_property with func has static column alias","user":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1141269142,"node_id":"MDU6TGFiZWwxMTQxMjY5MTQy","url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/labels/bug","name":"bug","color":"d73a4a","default":true,"description":"Something isn't working"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2016-02-26T02:13:51Z","updated_at":"2016-02-26T19:35:38Z","closed_at":"2016-02-26T05:21:54Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"**Migrated issue, originally created by Lukas Siemon ([@lukas-gitl](https://github.com/lukas-gitl))**\n\nI have an issue with column_property and using database specific functions. It seems like the alias is not created correctly in the query.\n\nI'm obtaining data from a model and an alias of the model. When I use \"func.hex\" (or any \"func\" function), the column alias is named \"hex\" (or what the function is called) for both models and this causes a collision:\n*InvalidRequestError: Ambiguous column name 'hex(CAST(label.id AS VARCHAR) || :param_1)' in result set! try 'use_labels' option on select statement.*\n\nHowever, when I cast the column_property as a string (see commented section in test case) this works as expected. Is this a bug or a limitation? What would be the best way to work around this?\n\nThe test case and generated query below. I would have expected the returned columns to be named \"hex_1\" and \"hex_2\".\n\n\n```\nSELECT\n   hex(CAST(label.id AS VARCHAR) || :param_1) AS hex,\n   hex(CAST(label_1.id AS VARCHAR) || :param_2) AS hex   \nFROM\n   label \nJOIN\n   link \n      ON link.id = label.link_id \nJOIN\n   label AS label_1 \n      ON label_1.id = link.label_id\n```\n\n\nTest case:\n```\nimport unittest\nfrom sqlalchemy import (Column, Integer, String, func, ForeignKey, cast)\nfrom sqlalchemy.orm import (column_property, relationship, aliased)\nfrom flask import Flask\nfrom flask.ext.sqlalchemy import SQLAlchemy\n\n\nclass TestColumnPropertyStaticName(unittest.TestCase):\n\n    def setUp(self):\n        app = Flask(__name__)\n        app.config['SQLALCHEMY_DATABASE_URI'] = (\"sqlite://\")\n        db = SQLAlchemy(app)\n\n        class Label(db.Model):\n            __tablename__ = 'label'\n            id = Column(Integer, primary_key=True)\n            hex = column_property(func.hex(func.cast(id, String) + 'data'))\n            # =============================\n            # ====== this would work ======\n            # hex = column_property(\n            #     cast(func.hex(func.cast(id, String) + 'data'), String))\n            # =============================\n            link_id = Column(Integer, ForeignKey('link.id'))\n            link = relationship(\"Link\", foreign_keys=link_id)\n\n        class Link(db.Model):\n            __tablename__ = 'link'\n            id = Column(Integer, primary_key=True)\n            label_id = Column(Integer, ForeignKey('label.id'))\n            label = relationship(\"Label\", foreign_keys=label_id)\n\n        db.drop_all()\n        db.create_all()\n\n        self.Label = Label\n        self.Link = Link\n        self.db = db\n\n    def test_dynamic_bindparam(self):\n        # saving the mirrored linkage\n        label = self.Label()\n        link = self.Link()\n        label.link = link\n        self.db.session.add(label)\n        self.db.session.commit()\n        link.label_id = label.id\n        self.db.session.commit()\n\n        # generate the query\n        query = self.Label.query\n        query = query.join(self.Link, self.Link.id == self.Label.link_id)\n        alias = aliased(self.Label)\n        query = query.join(alias, alias.id == self.Link.label_id)\n        query = query.with_entities(self.Label.hex, alias.hex)\n        print query\n\n        data = query.one()\n        print data\n\n```\n\n","closed_by":{"login":"sqlalchemy-bot","id":36047385,"node_id":"MDQ6VXNlcjM2MDQ3Mzg1","avatar_url":"https://avatars.githubusercontent.com/u/36047385?v=4","gravatar_id":"","url":"https://api.github.com/users/sqlalchemy-bot","html_url":"https://github.com/sqlalchemy-bot","followers_url":"https://api.github.com/users/sqlalchemy-bot/followers","following_url":"https://api.github.com/users/sqlalchemy-bot/following{/other_user}","gists_url":"https://api.github.com/users/sqlalchemy-bot/gists{/gist_id}","starred_url":"https://api.github.com/users/sqlalchemy-bot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sqlalchemy-bot/subscriptions","organizations_url":"https://api.github.com/users/sqlalchemy-bot/orgs","repos_url":"https://api.github.com/users/sqlalchemy-bot/repos","events_url":"https://api.github.com/users/sqlalchemy-bot/events{/privacy}","received_events_url":"https://api.github.com/users/sqlalchemy-bot/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3663/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/sqlalchemy/sqlalchemy/issues/3663/timeline","performed_via_github_app":null,"state_reason":"completed"}