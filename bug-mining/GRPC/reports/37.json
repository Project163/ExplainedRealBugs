{"url":"https://api.github.com/repos/grpc/grpc/issues/38898","repository_url":"https://api.github.com/repos/grpc/grpc","labels_url":"https://api.github.com/repos/grpc/grpc/issues/38898/labels{/name}","comments_url":"https://api.github.com/repos/grpc/grpc/issues/38898/comments","events_url":"https://api.github.com/repos/grpc/grpc/issues/38898/events","html_url":"https://github.com/grpc/grpc/issues/38898","id":2891797470,"node_id":"I_kwDOAacf2M6sXVPe","number":38898,"title":"XdsClient / LrsClient API cleanup","user":{"login":"markdroth","id":18664614,"node_id":"MDQ6VXNlcjE4NjY0NjE0","avatar_url":"https://avatars.githubusercontent.com/u/18664614?v=4","gravatar_id":"","url":"https://api.github.com/users/markdroth","html_url":"https://github.com/markdroth","followers_url":"https://api.github.com/users/markdroth/followers","following_url":"https://api.github.com/users/markdroth/following{/other_user}","gists_url":"https://api.github.com/users/markdroth/gists{/gist_id}","starred_url":"https://api.github.com/users/markdroth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markdroth/subscriptions","organizations_url":"https://api.github.com/users/markdroth/orgs","repos_url":"https://api.github.com/users/markdroth/repos","events_url":"https://api.github.com/users/markdroth/events{/privacy}","received_events_url":"https://api.github.com/users/markdroth/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":172881189,"node_id":"MDU6TGFiZWwxNzI4ODExODk=","url":"https://api.github.com/repos/grpc/grpc/labels/kind/internal%20cleanup","name":"kind/internal cleanup","color":"93732c","default":false,"description":null},{"id":218696181,"node_id":"MDU6TGFiZWwyMTg2OTYxODE=","url":"https://api.github.com/repos/grpc/grpc/labels/lang/core","name":"lang/core","color":"fad8c7","default":false,"description":""},{"id":360790193,"node_id":"MDU6TGFiZWwzNjA3OTAxOTM=","url":"https://api.github.com/repos/grpc/grpc/labels/priority/P2","name":"priority/P2","color":"dd7172","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"pawbhard","id":13415978,"node_id":"MDQ6VXNlcjEzNDE1OTc4","avatar_url":"https://avatars.githubusercontent.com/u/13415978?v=4","gravatar_id":"","url":"https://api.github.com/users/pawbhard","html_url":"https://github.com/pawbhard","followers_url":"https://api.github.com/users/pawbhard/followers","following_url":"https://api.github.com/users/pawbhard/following{/other_user}","gists_url":"https://api.github.com/users/pawbhard/gists{/gist_id}","starred_url":"https://api.github.com/users/pawbhard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pawbhard/subscriptions","organizations_url":"https://api.github.com/users/pawbhard/orgs","repos_url":"https://api.github.com/users/pawbhard/repos","events_url":"https://api.github.com/users/pawbhard/events{/privacy}","received_events_url":"https://api.github.com/users/pawbhard/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"pawbhard","id":13415978,"node_id":"MDQ6VXNlcjEzNDE1OTc4","avatar_url":"https://avatars.githubusercontent.com/u/13415978?v=4","gravatar_id":"","url":"https://api.github.com/users/pawbhard","html_url":"https://github.com/pawbhard","followers_url":"https://api.github.com/users/pawbhard/followers","following_url":"https://api.github.com/users/pawbhard/following{/other_user}","gists_url":"https://api.github.com/users/pawbhard/gists{/gist_id}","starred_url":"https://api.github.com/users/pawbhard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pawbhard/subscriptions","organizations_url":"https://api.github.com/users/pawbhard/orgs","repos_url":"https://api.github.com/users/pawbhard/repos","events_url":"https://api.github.com/users/pawbhard/events{/privacy}","received_events_url":"https://api.github.com/users/pawbhard/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2025-03-03T16:59:17Z","updated_at":"2025-03-27T22:14:47Z","closed_at":"2025-03-27T22:14:47Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"The impetus for this cleanup came from a discussion with @dfawley, @purnesh42H, and @easwars about the go XdsClient API.\n\nCurrently, the [`XdsBootstrap::XdsServer` interface](https://github.com/grpc/grpc/blob/ff9cc060907e88640a6fcfe78d0dfeb2f3d89ca1/src/core/xds/xds_client/xds_bootstrap.h#L45) contains two categories of information:\n1. Info on how to contact the xDS server (e.g., the `server_uri()` method).\n2. Properties of the server used by the XdsClient (e.g., the `FailOnDataErrors()` method).\n\nWe use this interface in a few places:\n- The `XdsClient` uses it as a [key for its XdsChannels](https://github.com/grpc/grpc/blob/e86bca425aa155a3f27b6f7f5e47c33676f383ae/src/core/xds/xds_client/xds_client.cc#L1630).  Note that this requires both (1) and (2) above.\n- The `XdsTransport` interface uses it as a [key for the channel it creates to the server](https://github.com/grpc/grpc/blob/e86bca425aa155a3f27b6f7f5e47c33676f383ae/src/core/xds/xds_client/xds_transport.h#L98).  Note that this requires only (1) above.\n- The `LrsClient` uses it to [indicate which LRS server to send data to](https://github.com/grpc/grpc/blob/e86bca425aa155a3f27b6f7f5e47c33676f383ae/src/core/xds/xds_client/lrs_client.h#L245).  Note that this requires only (1) above.\n\nThe fact that we're using a common interface for all three of these use-cases means that we're unnecessarily exposing options that are specific to the `XdsClient` to both the `XdsTransport` and the `LrsClient`.  To clean this up, we should do the following:\n\n- Create a new interface for (1) called `XdsServerTarget`.  Move the `service_uri()` method out of `XdsBootstrap::XdsServer` to `XdsServerTarget`, and add a method to `XdsBootstrap::XdsServer` to return an instance of `XdsServerTarget`.\n- Change the `GrpcXdsServerInterface` class that I added in #38701 to inherit from `XdsServerTarget` instead of from `XdsBootstrap::XdsServer`.\n- Change `XdsTransport` to take `XdsServerTarget` instead of `XdsBootstrap::XdsServer`.\n- Change the methods on `LrsClient` to take `XdsServerTarget` instead of `XdsBootstrap::XdsServer`.","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grpc/grpc/issues/38898/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grpc/grpc/issues/38898/timeline","performed_via_github_app":null,"state_reason":"completed"}