{"url":"https://api.github.com/repos/grpc/grpc/issues/35381","repository_url":"https://api.github.com/repos/grpc/grpc","labels_url":"https://api.github.com/repos/grpc/grpc/issues/35381/labels{/name}","comments_url":"https://api.github.com/repos/grpc/grpc/issues/35381/comments","events_url":"https://api.github.com/repos/grpc/grpc/issues/35381/events","html_url":"https://github.com/grpc/grpc/issues/35381","id":2053789797,"node_id":"I_kwDOAacf2M56alhl","number":35381,"title":"UBSan reports error when moving uninitialized bool","user":{"login":"daniel-eiband-snkeos","id":106555436,"node_id":"U_kgDOBlnoLA","avatar_url":"https://avatars.githubusercontent.com/u/106555436?v=4","gravatar_id":"","url":"https://api.github.com/users/daniel-eiband-snkeos","html_url":"https://github.com/daniel-eiband-snkeos","followers_url":"https://api.github.com/users/daniel-eiband-snkeos/followers","following_url":"https://api.github.com/users/daniel-eiband-snkeos/following{/other_user}","gists_url":"https://api.github.com/users/daniel-eiband-snkeos/gists{/gist_id}","starred_url":"https://api.github.com/users/daniel-eiband-snkeos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/daniel-eiband-snkeos/subscriptions","organizations_url":"https://api.github.com/users/daniel-eiband-snkeos/orgs","repos_url":"https://api.github.com/users/daniel-eiband-snkeos/repos","events_url":"https://api.github.com/users/daniel-eiband-snkeos/events{/privacy}","received_events_url":"https://api.github.com/users/daniel-eiband-snkeos/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":155504842,"node_id":"MDU6TGFiZWwxNTU1MDQ4NDI=","url":"https://api.github.com/repos/grpc/grpc/labels/kind/bug","name":"kind/bug","color":"93732c","default":false,"description":null},{"id":218696181,"node_id":"MDU6TGFiZWwyMTg2OTYxODE=","url":"https://api.github.com/repos/grpc/grpc/labels/lang/core","name":"lang/core","color":"fad8c7","default":false,"description":""},{"id":360790193,"node_id":"MDU6TGFiZWwzNjA3OTAxOTM=","url":"https://api.github.com/repos/grpc/grpc/labels/priority/P2","name":"priority/P2","color":"dd7172","default":false,"description":""},{"id":3940839694,"node_id":"LA_kwDOAacf2M7q5HEO","url":"https://api.github.com/repos/grpc/grpc/labels/untriaged","name":"untriaged","color":"c2e0c6","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"ctiller","id":10120821,"node_id":"MDQ6VXNlcjEwMTIwODIx","avatar_url":"https://avatars.githubusercontent.com/u/10120821?v=4","gravatar_id":"","url":"https://api.github.com/users/ctiller","html_url":"https://github.com/ctiller","followers_url":"https://api.github.com/users/ctiller/followers","following_url":"https://api.github.com/users/ctiller/following{/other_user}","gists_url":"https://api.github.com/users/ctiller/gists{/gist_id}","starred_url":"https://api.github.com/users/ctiller/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctiller/subscriptions","organizations_url":"https://api.github.com/users/ctiller/orgs","repos_url":"https://api.github.com/users/ctiller/repos","events_url":"https://api.github.com/users/ctiller/events{/privacy}","received_events_url":"https://api.github.com/users/ctiller/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"ctiller","id":10120821,"node_id":"MDQ6VXNlcjEwMTIwODIx","avatar_url":"https://avatars.githubusercontent.com/u/10120821?v=4","gravatar_id":"","url":"https://api.github.com/users/ctiller","html_url":"https://github.com/ctiller","followers_url":"https://api.github.com/users/ctiller/followers","following_url":"https://api.github.com/users/ctiller/following{/other_user}","gists_url":"https://api.github.com/users/ctiller/gists{/gist_id}","starred_url":"https://api.github.com/users/ctiller/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctiller/subscriptions","organizations_url":"https://api.github.com/users/ctiller/orgs","repos_url":"https://api.github.com/users/ctiller/repos","events_url":"https://api.github.com/users/ctiller/events{/privacy}","received_events_url":"https://api.github.com/users/ctiller/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":7,"created_at":"2023-12-22T11:28:47Z","updated_at":"2025-08-28T22:50:48Z","closed_at":"2025-08-28T22:50:48Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I tried Undefined Behavior Sanitizer (UBSan) on my project that uses the gRPC C++ library. The following runtime error was reported:\r\n\r\n```\r\nsrc/core/lib/promise/pipe.h:76:3: runtime error: load of value 103, which is not a valid value for type 'bool'\r\n```\r\n\r\nNote that instead of 103 there could be any 8-bit number which indicates an uninitialized value. Looking at the code the error originates from the compiler generated move constructor `NextResult(NextResult&& other) noexcept = default;`. The issue is, that the `cancelled_` member is not initialized by two of the constructors. Initializing the member to `cancelled_(false)` in all constructor initializer lists that are not initializing the member resolved the issue.\r\n\r\nThe `cancelled()` member function has the comment `// Only valid if !has_value()` which might be true for handwritten code. The issue is created by the compiler generated code.\r\n\r\nSide notes:\r\n- `cancelled()` could be `const`\r\n- `NextResult& operator=(NextResult&& other) noexcept` should probably be deleted, because it would skip the custom logic of the destructor. Deleting it compiles fine which confirms, that it is not being used. Therefore the faulty move assignment operator currently does not create an issue.\r\n\r\n### What version of gRPC and what language are you using?\r\ngRPC C++ v1.54.3\r\n\r\n### What operating system (Linux, Windows,...) and version?\r\nUbuntu 22.04.2 LTS running in WSL2\r\n`uname -a` outputs: 5.4.72-microsoft-standard-WSL2 # 1 SMP Wed Oct 28 23:40:43 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n### What runtime / compiler are you using (e.g. python version or version of gcc)\r\ngcc version 11.3.0 (Ubuntu 11.3.0-1ubuntu1~22.04)\r\n\r\n### What did you do?\r\n- Compile and link with `-fsanitize=undefined`\r\n- Start up an asynchronous server and make a call using an asynchronous client using `GenericStub`.\r\n\r\n### What did you expect to see?\r\nNo UBSan errors.\r\n\r\n### What did you see instead?\r\nMultiple runtime errors of the form `src/core/lib/promise/pipe.h:76:3: runtime error: load of value XXX, which is not a valid value for type 'bool'` with XXX being different non-zero numbers.\r\n\r\n### Anything else we should know about your project / environment?\r\n","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grpc/grpc/issues/35381/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grpc/grpc/issues/35381/timeline","performed_via_github_app":null,"state_reason":"completed"}