{"url":"https://api.github.com/repos/grpc/grpc/issues/33935","repository_url":"https://api.github.com/repos/grpc/grpc","labels_url":"https://api.github.com/repos/grpc/grpc/issues/33935/labels{/name}","comments_url":"https://api.github.com/repos/grpc/grpc/issues/33935/comments","events_url":"https://api.github.com/repos/grpc/grpc/issues/33935/events","html_url":"https://github.com/grpc/grpc/issues/33935","id":1830453111,"node_id":"I_kwDOAacf2M5tGn93","number":33935,"title":"Python/Core: Error parsing http status code - `401` converted to `UNKNOWN: Stream removed`","user":{"login":"jeevb","id":10869815,"node_id":"MDQ6VXNlcjEwODY5ODE1","avatar_url":"https://avatars.githubusercontent.com/u/10869815?v=4","gravatar_id":"","url":"https://api.github.com/users/jeevb","html_url":"https://github.com/jeevb","followers_url":"https://api.github.com/users/jeevb/followers","following_url":"https://api.github.com/users/jeevb/following{/other_user}","gists_url":"https://api.github.com/users/jeevb/gists{/gist_id}","starred_url":"https://api.github.com/users/jeevb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeevb/subscriptions","organizations_url":"https://api.github.com/users/jeevb/orgs","repos_url":"https://api.github.com/users/jeevb/repos","events_url":"https://api.github.com/users/jeevb/events{/privacy}","received_events_url":"https://api.github.com/users/jeevb/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":155504842,"node_id":"MDU6TGFiZWwxNTU1MDQ4NDI=","url":"https://api.github.com/repos/grpc/grpc/labels/kind/bug","name":"kind/bug","color":"93732c","default":false,"description":null},{"id":168238186,"node_id":"MDU6TGFiZWwxNjgyMzgxODY=","url":"https://api.github.com/repos/grpc/grpc/labels/lang/Python","name":"lang/Python","color":"fad8c7","default":false,"description":null},{"id":218696181,"node_id":"MDU6TGFiZWwyMTg2OTYxODE=","url":"https://api.github.com/repos/grpc/grpc/labels/lang/core","name":"lang/core","color":"fad8c7","default":false,"description":""},{"id":360790193,"node_id":"MDU6TGFiZWwzNjA3OTAxOTM=","url":"https://api.github.com/repos/grpc/grpc/labels/priority/P2","name":"priority/P2","color":"dd7172","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"gnossen","id":1644595,"node_id":"MDQ6VXNlcjE2NDQ1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/1644595?v=4","gravatar_id":"","url":"https://api.github.com/users/gnossen","html_url":"https://github.com/gnossen","followers_url":"https://api.github.com/users/gnossen/followers","following_url":"https://api.github.com/users/gnossen/following{/other_user}","gists_url":"https://api.github.com/users/gnossen/gists{/gist_id}","starred_url":"https://api.github.com/users/gnossen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gnossen/subscriptions","organizations_url":"https://api.github.com/users/gnossen/orgs","repos_url":"https://api.github.com/users/gnossen/repos","events_url":"https://api.github.com/users/gnossen/events{/privacy}","received_events_url":"https://api.github.com/users/gnossen/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"gnossen","id":1644595,"node_id":"MDQ6VXNlcjE2NDQ1OTU=","avatar_url":"https://avatars.githubusercontent.com/u/1644595?v=4","gravatar_id":"","url":"https://api.github.com/users/gnossen","html_url":"https://github.com/gnossen","followers_url":"https://api.github.com/users/gnossen/followers","following_url":"https://api.github.com/users/gnossen/following{/other_user}","gists_url":"https://api.github.com/users/gnossen/gists{/gist_id}","starred_url":"https://api.github.com/users/gnossen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gnossen/subscriptions","organizations_url":"https://api.github.com/users/gnossen/orgs","repos_url":"https://api.github.com/users/gnossen/repos","events_url":"https://api.github.com/users/gnossen/events{/privacy}","received_events_url":"https://api.github.com/users/gnossen/received_events","type":"User","user_view_type":"public","site_admin":false},{"login":"yashykt","id":4181124,"node_id":"MDQ6VXNlcjQxODExMjQ=","avatar_url":"https://avatars.githubusercontent.com/u/4181124?v=4","gravatar_id":"","url":"https://api.github.com/users/yashykt","html_url":"https://github.com/yashykt","followers_url":"https://api.github.com/users/yashykt/followers","following_url":"https://api.github.com/users/yashykt/following{/other_user}","gists_url":"https://api.github.com/users/yashykt/gists{/gist_id}","starred_url":"https://api.github.com/users/yashykt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yashykt/subscriptions","organizations_url":"https://api.github.com/users/yashykt/orgs","repos_url":"https://api.github.com/users/yashykt/repos","events_url":"https://api.github.com/users/yashykt/events{/privacy}","received_events_url":"https://api.github.com/users/yashykt/received_events","type":"User","user_view_type":"public","site_admin":false},{"login":"XuanWang-Amos","id":24593237,"node_id":"MDQ6VXNlcjI0NTkzMjM3","avatar_url":"https://avatars.githubusercontent.com/u/24593237?v=4","gravatar_id":"","url":"https://api.github.com/users/XuanWang-Amos","html_url":"https://github.com/XuanWang-Amos","followers_url":"https://api.github.com/users/XuanWang-Amos/followers","following_url":"https://api.github.com/users/XuanWang-Amos/following{/other_user}","gists_url":"https://api.github.com/users/XuanWang-Amos/gists{/gist_id}","starred_url":"https://api.github.com/users/XuanWang-Amos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/XuanWang-Amos/subscriptions","organizations_url":"https://api.github.com/users/XuanWang-Amos/orgs","repos_url":"https://api.github.com/users/XuanWang-Amos/repos","events_url":"https://api.github.com/users/XuanWang-Amos/events{/privacy}","received_events_url":"https://api.github.com/users/XuanWang-Amos/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":29,"created_at":"2023-08-01T04:43:30Z","updated_at":"2024-08-13T08:50:44Z","closed_at":"2024-02-06T21:15:54Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nPLEASE DO NOT POST A QUESTION HERE.\r\nThis form is for bug reports and feature requests ONLY!\r\n\r\nFor general questions and troubleshooting, please ask/look for answers at StackOverflow, with \"grpc\" tag: https://stackoverflow.com/questions/tagged/grpc\r\n\r\nFor questions that specifically need to be answered by gRPC team members, please ask/look for answers at grpc.io mailing list: https://groups.google.com/forum/#!forum/grpc-io\r\n\r\nIssues specific to *grpc-java*, *grpc-go*, *grpc-node*, *grpc-dart*, *grpc-web* should be created in the repository they belong to (e.g. https://github.com/grpc/grpc-LANGUAGE/issues/new)\r\n-->\r\n\r\n### What version of gRPC and what language are you using?\r\ngRPC v1.56.2\r\nPython\r\n\r\n### What operating system (Linux, Windows,...) and version?\r\nMac (client)\r\nLinux (server)\r\n\r\n\r\n### What runtime / compiler are you using (e.g. python version or version of gcc)\r\nPython 3.10\r\n\r\n\r\n### What did you do?\r\nPlease provide either 1) A unit test for reproducing the bug or 2) Specific steps for us to follow to reproduce the bug. If there’s not enough information to debug the problem, gRPC team may close the issue at their discretion. You’re welcome to re-open the issue once you have a reproduction.\r\n\r\n#31657 (closed as fixed in `v1.51.3`) appears to have resurfaced for versions `==v1.53.1` and `>=v1.54.2`. We first noticed it while running `v1.56.2`.\r\n\r\nOur particular issue is reproducible by running a gRPC service behind an NGINX reverse proxy with [subrequest authentication](https://docs.nginx.com/nginx/admin-guide/security-controls/configuring-subrequest-authentication/) enabled. When the auth endpoint returns a 401, the client errors with `UNKNOWN: Stream removed` instead of translating the http error to the gRPC code: `UNAUTHENTICATED (16)`. A complete, minimal reproducible example is available here: https://github.com/jeevb/grpc-regression-mre\r\n\r\n### What did you expect to see?\r\n\r\nFrom gRPC `v1.51.3`:\r\n```\r\nE0728 20:36:16.829609000 8093441536 hpack_parser.cc:1218]              Error parsing metadata: error=invalid value key=content-type value=text/html\r\nTraceback (most recent call last):\r\n  File \"/Users/jeev/Workspace/repos/personal/grpc-regression-mre/echo/client.py\", line 27, in <module>\r\n    main()\r\n  File \"/Users/jeev/Workspace/repos/personal/grpc-regression-mre/echo/client.py\", line 22, in main\r\n    response = stub.Echo(request)\r\n  File \"/Users/jeev/Workspace/repos/personal/grpc-regression-mre/echo/.venv/lib/python3.10/site-packages/grpc/_channel.py\", line 946, in __call__\r\n    return _end_unary_response_blocking(state, call, False, None)\r\n  File \"/Users/jeev/Workspace/repos/personal/grpc-regression-mre/echo/.venv/lib/python3.10/site-packages/grpc/_channel.py\", line 849, in _end_unary_response_blocking\r\n    raise _InactiveRpcError(state)\r\ngrpc._channel._InactiveRpcError: <_InactiveRpcError of RPC that terminated with:\r\n  status = StatusCode.UNAUTHENTICATED\r\n  details = \"Received http2 header with status: 401\"\r\n  debug_error_string = \"UNKNOWN:Error received from peer ipv6:%5B::1%5D:8443 {created_time:\"2023-07-28T20:36:16.829747-07:00\", grpc_status:16, grpc_message:\"Received http2 header with status: 401\"}\"\r\n```\r\n\r\n### What did you see instead?\r\n\r\nFrom gRPC `v1.56.2`:\r\n```\r\nE0728 19:54:05.103107000 8093441536 hpack_parser.cc:991]               Error parsing 'content-type' metadata: invalid value\r\nTraceback (most recent call last):\r\n  File \"/Users/jeev/Workspace/repos/personal/grpc-regression-mre/echo/client.py\", line 27, in <module>\r\n    main()\r\n  File \"/Users/jeev/Workspace/repos/personal/grpc-regression-mre/echo/client.py\", line 22, in main\r\n    response = stub.Echo(request)\r\n  File \"/Users/jeev/Workspace/repos/personal/grpc-regression-mre/echo/.venv/lib/python3.10/site-packages/grpc/_channel.py\", line 1030, in __call__\r\n    return _end_unary_response_blocking(state, call, False, None)\r\n  File \"/Users/jeev/Workspace/repos/personal/grpc-regression-mre/echo/.venv/lib/python3.10/site-packages/grpc/_channel.py\", line 910, in _end_unary_response_blocking\r\n    raise _InactiveRpcError(state)  # pytype: disable=not-instantiable\r\ngrpc._channel._InactiveRpcError: <_InactiveRpcError of RPC that terminated with:\r\n    status = StatusCode.UNKNOWN\r\n    details = \"Stream removed\"\r\n    debug_error_string = \"UNKNOWN:Error received from peer  {grpc_message:\"Stream removed\", grpc_status:2, created_time:\"2023-07-28T19:54:05.10316-07:00\"}\"\r\n```\r\n\r\n[Complete log](https://gist.github.com/jeevb/ca65382f652f55cf8e69b51c868864a1)\r\n\r\nMake sure you include information that can help us debug (full error message, exception listing, stack trace, logs).\r\n\r\nSee [TROUBLESHOOTING.md](https://github.com/grpc/grpc/blob/master/TROUBLESHOOTING.md) for how to diagnose problems better.\r\n\r\n### Anything else we should know about your project / environment?\r\nA complete, minimal reproducible example is available here: https://github.com/jeevb/grpc-regression-mre","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grpc/grpc/issues/33935/reactions","total_count":11,"+1":10,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"timeline_url":"https://api.github.com/repos/grpc/grpc/issues/33935/timeline","performed_via_github_app":null,"state_reason":"completed"}