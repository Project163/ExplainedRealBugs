{"url":"https://api.github.com/repos/grpc/grpc/issues/38728","repository_url":"https://api.github.com/repos/grpc/grpc","labels_url":"https://api.github.com/repos/grpc/grpc/issues/38728/labels{/name}","comments_url":"https://api.github.com/repos/grpc/grpc/issues/38728/comments","events_url":"https://api.github.com/repos/grpc/grpc/issues/38728/events","html_url":"https://github.com/grpc/grpc/issues/38728","id":2849341824,"node_id":"I_kwDOAacf2M6p1YGA","number":38728,"title":"[CallAttemptTracer] heap-use-after-free when testing transparent retries","user":{"login":"yashykt","id":4181124,"node_id":"MDQ6VXNlcjQxODExMjQ=","avatar_url":"https://avatars.githubusercontent.com/u/4181124?v=4","gravatar_id":"","url":"https://api.github.com/users/yashykt","html_url":"https://github.com/yashykt","followers_url":"https://api.github.com/users/yashykt/followers","following_url":"https://api.github.com/users/yashykt/following{/other_user}","gists_url":"https://api.github.com/users/yashykt/gists{/gist_id}","starred_url":"https://api.github.com/users/yashykt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yashykt/subscriptions","organizations_url":"https://api.github.com/users/yashykt/orgs","repos_url":"https://api.github.com/users/yashykt/repos","events_url":"https://api.github.com/users/yashykt/events{/privacy}","received_events_url":"https://api.github.com/users/yashykt/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":155504842,"node_id":"MDU6TGFiZWwxNTU1MDQ4NDI=","url":"https://api.github.com/repos/grpc/grpc/labels/kind/bug","name":"kind/bug","color":"93732c","default":false,"description":null},{"id":218696181,"node_id":"MDU6TGFiZWwyMTg2OTYxODE=","url":"https://api.github.com/repos/grpc/grpc/labels/lang/core","name":"lang/core","color":"fad8c7","default":false,"description":""},{"id":360790193,"node_id":"MDU6TGFiZWwzNjA3OTAxOTM=","url":"https://api.github.com/repos/grpc/grpc/labels/priority/P2","name":"priority/P2","color":"dd7172","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"yashykt","id":4181124,"node_id":"MDQ6VXNlcjQxODExMjQ=","avatar_url":"https://avatars.githubusercontent.com/u/4181124?v=4","gravatar_id":"","url":"https://api.github.com/users/yashykt","html_url":"https://github.com/yashykt","followers_url":"https://api.github.com/users/yashykt/followers","following_url":"https://api.github.com/users/yashykt/following{/other_user}","gists_url":"https://api.github.com/users/yashykt/gists{/gist_id}","starred_url":"https://api.github.com/users/yashykt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yashykt/subscriptions","organizations_url":"https://api.github.com/users/yashykt/orgs","repos_url":"https://api.github.com/users/yashykt/repos","events_url":"https://api.github.com/users/yashykt/events{/privacy}","received_events_url":"https://api.github.com/users/yashykt/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"yashykt","id":4181124,"node_id":"MDQ6VXNlcjQxODExMjQ=","avatar_url":"https://avatars.githubusercontent.com/u/4181124?v=4","gravatar_id":"","url":"https://api.github.com/users/yashykt","html_url":"https://github.com/yashykt","followers_url":"https://api.github.com/users/yashykt/followers","following_url":"https://api.github.com/users/yashykt/following{/other_user}","gists_url":"https://api.github.com/users/yashykt/gists{/gist_id}","starred_url":"https://api.github.com/users/yashykt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yashykt/subscriptions","organizations_url":"https://api.github.com/users/yashykt/orgs","repos_url":"https://api.github.com/users/yashykt/repos","events_url":"https://api.github.com/users/yashykt/events{/privacy}","received_events_url":"https://api.github.com/users/yashykt/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2025-02-12T20:59:47Z","updated_at":"2025-02-21T01:16:24Z","closed_at":"2025-02-21T01:16:24Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Noticed this on https://github.com/grpc/grpc/pull/38437 when adding a test for transparent retries.\n\nThe following heap-use-after-free is reported - \n```\n=================================================================\n==3013632==ERROR: AddressSanitizer: heap-use-after-free on address 0x50d000006df0 at pc 0x7f5ce94ee68f bp 0x7f5cc9ffe8e0 sp 0x7f5cc9ffe8d8\nREAD of size 8 at 0x50d000006df0 thread T281\n    #0 0x7f5ce94ee68e in (anonymous namespace)::TcpTracerIfSampled(grpc_chttp2_stream*) /proc/self/cwd/src/core/ext/transport/chttp2/transport/chttp2_transport.cc:250:63\n    #1 0x7f5ce94da85d in perform_stream_op_locked(void*, absl::lts_20240722::Status) /proc/self/cwd/src/core/ext/transport/chttp2/transport/chttp2_transport.cc:1670:19\n    #2 0x7f5ce2c51cd0 in grpc_combiner_continue_exec_ctx() /proc/self/cwd/src/core/lib/iomgr/combiner.cc:216:5\n    #3 0x7f5ce2c5ca76 in grpc_core::ExecCtx::Flush() /proc/self/cwd/src/core/lib/iomgr/exec_ctx.cc:77:17\n    #4 0x7f5cef337b25 in grpc_core::ExecCtx::~ExecCtx() /proc/self/cwd/./src/core/lib/iomgr/exec_ctx.h:137:5\n    #5 0x7f5ce2c8cb3c in grpc_core::WorkSerializer::WorkSerializerImpl::Run() /proc/self/cwd/src/core/util/work_serializer.cc:221:1\n    #6 0x7f5ce3e45da0 in grpc_event_engine::experimental::WorkStealingThreadPool::ThreadState::Step() /proc/self/cwd/src/core/lib/event_engine/thread_pool/work_stealing_thread_pool.cc:524:14\n    #7 0x7f5ce3e44b59 in grpc_event_engine::experimental::WorkStealingThreadPool::ThreadState::ThreadBody() /proc/self/cwd/src/core/lib/event_engine/thread_pool/work_stealing_thread_pool.cc:487:10\n    #8 0x7f5ce3e475e0 in grpc_event_engine::experimental::WorkStealingThreadPool::WorkStealingThreadPoolImpl::StartThread()::$_0::operator()(void*) const /proc/self/cwd/src/core/lib/event_engine/thread_pool/work_stealing_thread_pool.cc:257:17\n    #9 0x7f5ce3e47558 in grpc_event_engine::experimental::WorkStealingThreadPool::WorkStealingThreadPoolImpl::StartThread()::$_0::__invoke(void*) /proc/self/cwd/src/core/lib/event_engine/thread_pool/work_stealing_thread_pool.cc:255:7\n    #10 0x7f5ce21122be in grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*, grpc_core::Thread::Options const&)::'lambda'(void*)::operator()(void*) const /proc/self/cwd/src/core/util/posix/thd.cc:145:11\n    #11 0x7f5ce2111c27 in grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*, grpc_core::Thread::Options const&)::'lambda'(void*)::__invoke(void*) /proc/self/cwd/src/core/util/posix/thd.cc:115:9\n    #12 0x7f5ce0d646c1 in start_thread nptl/pthread_create.c:447:8\n    #13 0x7f5ce0ddf127 in clone3 misc/../sysdeps/unix/sysv/linux/x86_64/clone3.S:78\n\n0x50d000006df0 is located 0 bytes inside of 144-byte region [0x50d000006df0,0x50d000006e80)\nfreed by thread T281 here:\n    #0 0x56484f6c7aca in __interceptor_free (/usr/local/google/home/yashkt/.cache/bazel/_bazel_yashkt/3933dcff60587ac8c34d87542411a8b2/execroot/com_github_grpc_grpc/bazel-out/k8-dbg/bin/test/cpp/ext/otel/otel_tracing_test+0xc7aca) (BuildId: 5b1372e32b37211dd5de56fa1466f4c9e5c2df8f)\n    #1 0x7f5cef8a5811 in grpc::internal::OpenTelemetryPluginImpl::ClientCallTracer::CallAttemptTracer::~CallAttemptTracer() /proc/self/cwd/./src/cpp/ext/otel/otel_client_call_tracer.h:58:35\n    #2 0x7f5cef89cc95 in grpc::internal::OpenTelemetryPluginImpl::ClientCallTracer::CallAttemptTracer::RecordEnd(gpr_timespec const&) /proc/self/cwd/src/cpp/ext/otel/otel_client_call_tracer.cc:278:5\n    #3 0x7f5ce815237a in grpc_core::ClientChannelFilter::LoadBalancedCall::RecordLatency() /proc/self/cwd/src/core/client_channel/client_channel_filter.cc:2438:28\n    #4 0x7f5ce81571d9 in grpc_core::ClientChannelFilter::FilterBasedLoadBalancedCall::Orphan() /proc/self/cwd/src/core/client_channel/client_channel_filter.cc:2652:3\n    #5 0x7f5ce8179158 in void grpc_core::OrphanableDelete::operator()<grpc_core::ClientChannelFilter::FilterBasedLoadBalancedCall>(grpc_core::ClientChannelFilter::FilterBasedLoadBalancedCall*) /proc/self/cwd/./src/core/util/orphanable.h:60:8\n    #6 0x7f5ce8178d2b in std::unique_ptr<grpc_core::ClientChannelFilter::FilterBasedLoadBalancedCall, grpc_core::OrphanableDelete>::~unique_ptr() /usr/lib/gcc/x86_64-linux-gnu/14/../../../../include/c++/14/bits/unique_ptr.h:398:4\n    #7 0x7f5ce82084e7 in grpc_core::RetryFilter::LegacyCallData::CallAttempt::~CallAttempt() /proc/self/cwd/src/core/client_channel/retry_filter_legacy_call_data.cc:167:1\n    #8 0x7f5ce8242e1a in void grpc_core::UnrefDelete::operator()<grpc_core::RetryFilter::LegacyCallData::CallAttempt const>(grpc_core::RetryFilter::LegacyCallData::CallAttempt const*) const /proc/self/cwd/./src/core/util/ref_counted.h:223:5\n    #9 0x7f5ce8231655 in grpc_core::RefCounted<grpc_core::RetryFilter::LegacyCallData::CallAttempt, grpc_core::PolymorphicRefCount, grpc_core::UnrefDelete>::Unref(grpc_core::DebugLocation const&, char const*) const /proc/self/cwd/./src/core/util/ref_counted.h:371:7\n    #10 0x7f5ce82197de in grpc_core::RetryFilter::LegacyCallData::CallAttempt::BatchData::~BatchData() /proc/self/cwd/src/core/client_channel/retry_filter_legacy_call_data.cc:727:17\n    #11 0x7f5ce8242e88 in void grpc_core::UnrefCallDtor::operator()<grpc_core::RetryFilter::LegacyCallData::CallAttempt::BatchData const>(grpc_core::RetryFilter::LegacyCallData::CallAttempt::BatchData const*) const /proc/self/cwd/./src/core/util/ref_counted.h:243:9\n    #12 0x7f5ce8242e65 in grpc_core::RefCounted<grpc_core::RetryFilter::LegacyCallData::CallAttempt::BatchData, grpc_core::PolymorphicRefCount, grpc_core::UnrefCallDtor>::Unref() const /proc/self/cwd/./src/core/util/ref_counted.h:366:7\n    #13 0x7f5ce822f9e5 in grpc_core::RefCountedPtr<grpc_core::RetryFilter::LegacyCallData::CallAttempt::BatchData>::~RefCountedPtr() /proc/self/cwd/./src/core/util/ref_counted_ptr.h:111:36\n    #14 0x7f5ce8225c59 in grpc_core::RetryFilter::LegacyCallData::CallAttempt::BatchData::OnCompleteForCancelOp(void*, absl::lts_20240722::Status) /proc/self/cwd/src/core/client_channel/retry_filter_legacy_call_data.cc:1312:1\n    #15 0x7f5ce2c5d91d in exec_ctx_run(grpc_closure*) /proc/self/cwd/src/core/lib/iomgr/exec_ctx.cc:43:3\n    #16 0x7f5ce2c5ca59 in grpc_core::ExecCtx::Flush() /proc/self/cwd/src/core/lib/iomgr/exec_ctx.cc:74:9\n    #17 0x7f5cef337b25 in grpc_core::ExecCtx::~ExecCtx() /proc/self/cwd/./src/core/lib/iomgr/exec_ctx.h:137:5\n    #18 0x7f5ce2c8cb3c in grpc_core::WorkSerializer::WorkSerializerImpl::Run() /proc/self/cwd/src/core/util/work_serializer.cc:221:1\n    #19 0x7f5ce3e45da0 in grpc_event_engine::experimental::WorkStealingThreadPool::ThreadState::Step() /proc/self/cwd/src/core/lib/event_engine/thread_pool/work_stealing_thread_pool.cc:524:14\n    #20 0x7f5ce3e44b59 in grpc_event_engine::experimental::WorkStealingThreadPool::ThreadState::ThreadBody() /proc/self/cwd/src/core/lib/event_engine/thread_pool/work_stealing_thread_pool.cc:487:10\n    #21 0x7f5ce3e475e0 in grpc_event_engine::experimental::WorkStealingThreadPool::WorkStealingThreadPoolImpl::StartThread()::$_0::operator()(void*) const /proc/self/cwd/src/core/lib/event_engine/thread_pool/work_stealing_thread_pool.cc:257:17\n    #22 0x7f5ce3e47558 in grpc_event_engine::experimental::WorkStealingThreadPool::WorkStealingThreadPoolImpl::StartThread()::$_0::__invoke(void*) /proc/self/cwd/src/core/lib/event_engine/thread_pool/work_stealing_thread_pool.cc:255:7\n    #23 0x7f5ce21122be in grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*, grpc_core::Thread::Options const&)::'lambda'(void*)::operator()(void*) const /proc/self/cwd/src/core/util/posix/thd.cc:145:11\n    #24 0x7f5ce2111c27 in grpc_core::(anonymous namespace)::ThreadInternalsPosix::ThreadInternalsPosix(char const*, void (*)(void*), void*, bool*, grpc_core::Thread::Options const&)::'lambda'(void*)::__invoke(void*) /proc/self/cwd/src/core/util/posix/thd.cc:115:9\n    #25 0x7f5ce0d646c1 in start_thread nptl/pthread_create.c:447:8\n\npreviously allocated by thread T282 here:\n    #0 0x56484f6c7d72 in __interceptor_malloc (/usr/local/google/home/yashkt/.cache/bazel/_bazel_yashkt/3933dcff60587ac8c34d87542411a8b2/execroot/com_github_grpc_grpc/bazel-out/k8-dbg/bin/test/cpp/ext/otel/otel_tracing_test+0xc7d72) (BuildId: 5b1372e32b37211dd5de56fa1466f4c9e5c2df8f)\n    #1 0x7f5ce0ab37eb in operator new(unsigned long) (/lib/x86_64-linux-gnu/libstdc++.so.6+0xb37eb) (BuildId: 69568e25e14544c953a9f79da5e158d0f644ad17)\n    #2 0x7f5ce8151878 in grpc_core::(anonymous namespace)::CreateCallAttemptTracer(grpc_core::Arena*, bool) /proc/self/cwd/src/core/client_channel/client_channel_filter.cc:2386:31\n    #3 0x7f5ce8150f43 in grpc_core::ClientChannelFilter::LoadBalancedCall::LoadBalancedCall(grpc_core::ClientChannelFilter*, grpc_core::Arena*, absl::lts_20240722::AnyInvocable<void ()>, bool) /proc/self/cwd/src/core/client_channel/client_channel_filter.cc:2401:3\n    #4 0x7f5ce81563fa in grpc_core::ClientChannelFilter::FilterBasedLoadBalancedCall::FilterBasedLoadBalancedCall(grpc_core::ClientChannelFilter*, grpc_call_element_args const&, grpc_polling_entity*, grpc_closure*, absl::lts_20240722::AnyInvocable<void ()>, bool) /proc/self/cwd/src/core/client_channel/client_channel_filter.cc:2625:7\n    #5 0x7f5ce816d875 in grpc_core::ClientChannelFilter::FilterBasedLoadBalancedCall* grpc_core::Arena::New<grpc_core::ClientChannelFilter::FilterBasedLoadBalancedCall, grpc_core::ClientChannelFilter*, grpc_call_element_args const&, grpc_polling_entity*&, grpc_closure*&, absl::lts_20240722::AnyInvocable<void ()>, bool&>(grpc_core::ClientChannelFilter*&&, grpc_call_element_args const&, grpc_polling_entity*&, grpc_closure*&, absl::lts_20240722::AnyInvocable<void ()>&&, bool&) /proc/self/cwd/./src/core/lib/resource_quota/arena.h:181:13\n    #6 0x7f5ce8138d02 in grpc_core::ClientChannelFilter::CreateLoadBalancedCall(grpc_call_element_args const&, grpc_polling_entity*, grpc_closure*, absl::lts_20240722::AnyInvocable<void ()>, bool) /proc/self/cwd/src/core/client_channel/client_channel_filter.cc:1142:19\n    #7 0x7f5ce8207e1a in grpc_core::RetryFilter::LegacyCallData::CreateLoadBalancedCall(absl::lts_20240722::AnyInvocable<void ()>, bool) /proc/self/cwd/src/core/client_channel/retry_filter_legacy_call_data.cc:1633:36\n    #8 0x7f5ce8206661 in grpc_core::RetryFilter::LegacyCallData::CallAttempt::CallAttempt(grpc_core::RetryFilter::LegacyCallData*, bool) /proc/self/cwd/src/core/client_channel/retry_filter_legacy_call_data.cc:129:21\n    #9 0x7f5ce82341d9 in grpc_core::RefCountedPtr<grpc_core::RetryFilter::LegacyCallData::CallAttempt> grpc_core::MakeRefCounted<grpc_core::RetryFilter::LegacyCallData::CallAttempt, grpc_core::RetryFilter::LegacyCallData*, bool&>(grpc_core::RetryFilter::LegacyCallData*&&, bool&) /proc/self/cwd/./src/core/util/ref_counted_ptr.h:369:31\n    #10 0x7f5ce822c185 in grpc_core::RetryFilter::LegacyCallData::CreateCallAttempt(bool) /proc/self/cwd/src/core/client_channel/retry_filter_legacy_call_data.cc:1642:19\n    #11 0x7f5ce822ca8e in grpc_core::RetryFilter::LegacyCallData::StartTransparentRetry(void*, absl::lts_20240722::Status) /proc/self/cwd/src/core/client_channel/retry_filter_legacy_call_data.cc:1935:12\n    #12 0x7f5ce2c5d91d in exec_ctx_run(grpc_closure*) /proc/self/cwd/src/core/lib/iomgr/exec_ctx.cc:43:3\n    #13 0x7f5ce2c5ca59 in grpc_core::ExecCtx::Flush() /proc/self/cwd/src/core/lib/iomgr/exec_ctx.cc:74:9\n    #14 0x7f5cef337b25 in grpc_core::ExecCtx::~ExecCtx() /proc/self/cwd/./src/core/lib/iomgr/exec_ctx.h:137:5\n    #15 0x7f5ce4595ee1 in grpc_event_engine::experimental::(anonymous namespace)::EventEngineEndpointWrapper::FinishPendingRead(absl::lts_20240722::Status) /proc/self/cwd/src/core/lib/iomgr/event_engine_shims/endpoint.cc:137:5\n    #16 0x7f5ce4596df4 in grpc_event_engine::experimental::(anonymous namespace)::EventEngineEndpointWrapper::Read(grpc_closure*, grpc_slice_buffer*, grpc_event_engine::experimental::EventEngine::Endpoint::ReadArgs const*)::'lambda'(absl::lts_20240722::Status)::operator()(absl::lts_20240722::Status) const /proc/self/cwd/src/core/lib/iomgr/event_engine_shims/endpoint.cc:110:39\n    #17 0x7f5ce4596bde in void std::__invoke_impl<void, grpc_event_engine::experimental::(anonymous namespace)::EventEngineEndpointWrapper::Read(grpc_closure*, grpc_slice_buffer*, grpc_event_engine::experimental::EventEngine::Endpoint::ReadArgs const*)::'lambda'(absl::lts_20240722::Status)&, absl::lts_20240722::Status>(std::__invoke_other, grpc_event_engine::experimental::(anonymous namespace)::EventEngineEndpointWrapper::Read(grpc_closure*, grpc_slice_buffer*, grpc_event_engine::experimental::EventEngine::Endpoint::ReadArgs const*)::'lambda'(absl::lts_20240722::Status)&, absl::lts_20240722::Status&&) /usr/lib/gcc/x86_64-linux-gnu/14/../../../../include/c++/14/bits/invoke.h:61:14\n    #18 0x7f5ce4596adc in std::__invoke_result<grpc_event_engine::experimental::(anonymous namespace)::EventEngineEndpointWrapper::Read(grpc_closure*, grpc_slice_buffer*, grpc_event_engine::experimental::EventEngine::Endpoint::ReadArgs const*)::'lambda'(absl::lts_20240722::Status)&, absl::lts_20240722::Status>::type std::__invoke<grpc_event_engine::experimental::(anonymous namespace)::EventEngineEndpointWrapper::Read(grpc_closure*, grpc_slice_buffer*, grpc_event_engine::experimental::EventEngine::Endpoint::ReadArgs const*)::'lambda'(absl::lts_20240722::Status)&, absl::lts_20240722::Status>(grpc_event_engine::experimental::(anonymous namespace)::EventEngineEndpointWrapper::Read(grpc_closure*, grpc_slice_buffer*, grpc_event_engine::experimental::EventEngine::Endpoint::ReadArgs const*)::'lambda'(absl::lts_20240722::Status)&, absl::lts_20240722::Status&&) /usr/lib/gcc/x86_64-linux-gnu/14/../../../../include/c++/14/bits/invoke.h:96:14\n    #19 0x7f5ce4596aac in std::invoke_result<grpc_event_engine::experimental::(anonymous namespace)::EventEngineEndpointWrapper::Read(grpc_closure*, grpc_slice_buffer*, grpc_event_engine::experimental::EventEngine::Endpoint::ReadArgs const*)::'lambda'(absl::lts_20240722::Status)&, absl::lts_20240722::Status>::type std::invoke<grpc_event_engine::experimental::(anonymous namespace)::EventEngineEndpointWrapper::Read(grpc_closure*, grpc_slice_buffer*, grpc_event_engine::experimental::EventEngine::Endpoint::ReadArgs const*)::'lambda'(absl::lts_20240722::Status)&, absl::lts_20240722::Status>(grpc_event_engine::experimental::(anonymous namespace)::EventEngineEndpointWrapper::Read(grpc_closure*, grpc_slice_buffer*, grpc_event_engine::experimental::EventEngine::Endpoint::ReadArgs const*)::'lambda'(absl::lts_20240722::Status)&, absl::lts_20240722::Status&&) /usr/lib/gcc/x86_64-linux-gnu/14/../../../../include/c++/14/functional:120:14\n    #20 0x7f5ce4596a6c in void absl::lts_20240722::internal_any_invocable::InvokeR<void, grpc_event_engine::experimental::(anonymous namespace)::EventEngineEndpointWrapper::Read(grpc_closure*, grpc_slice_buffer*, grpc_event_engine::experimental::EventEngine::Endpoint::ReadArgs const*)::'lambda'(absl::lts_20240722::Status)&, absl::lts_20240722::Status, void>(grpc_event_engine::experimental::(anonymous namespace)::EventEngineEndpointWrapper::Read(grpc_closure*, grpc_slice_buffer*, grpc_event_engine::experimental::EventEngine::Endpoint::ReadArgs const*)::'lambda'(absl::lts_20240722::Status)&, absl::lts_20240722::Status&&) /proc/self/cwd/external/com_google_absl/absl/functional/internal/any_invocable.h:132:3\n    #21 0x7f5ce45969d9 in void absl::lts_20240722::internal_any_invocable::LocalInvoker<false, void, grpc_event_engine::experimental::(anonymous namespace)::EventEngineEndpointWrapper::Read(grpc_closure*, grpc_slice_buffer*, grpc_event_engine::experimental::EventEngine::Endpoint::ReadArgs const*)::'lambda'(absl::lts_20240722::Status)&, absl::lts_20240722::Status>(absl::lts_20240722::internal_any_invocable::TypeErasedState*, absl::lts_20240722::internal_any_invocable::ForwardedParameter<absl::lts_20240722::Status>::type) /proc/self/cwd/external/com_google_absl/absl/functional/internal/any_invocable.h:310:10\n    #22 0x7f5cf0b08b53 in absl::lts_20240722::internal_any_invocable::Impl<void (absl::lts_20240722::Status)>::operator()(absl::lts_20240722::Status) /proc/self/cwd/external/com_google_absl/absl/functional/internal/any_invocable.h:868:1\n    #23 0x7f5ce40730de in grpc_event_engine::experimental::PosixEndpointImpl::HandleRead(absl::lts_20240722::Status) /proc/self/cwd/src/core/lib/event_engine/posix_engine/posix_endpoint.cc:592:3\n    #24 0x7f5ce408a104 in grpc_event_engine::experimental::PosixEndpointImpl::PosixEndpointImpl(grpc_event_engine::experimental::EventHandle*, grpc_event_engine::experimental::PosixEngineClosure*, std::shared_ptr<grpc_event_engine::experimental::EventEngine>, grpc_event_engine::experimental::MemoryAllocator&&, grpc_event_engine::experimental::PosixTcpOptions const&)::$_0::operator()(absl::lts_20240722::Status) const /proc/self/cwd/src/core/lib/event_engine/posix_engine/posix_endpoint.cc:1341:37\n    #25 0x7f5ce4089eee in void std::__invoke_impl<void, grpc_event_engine::experimental::PosixEndpointImpl::PosixEndpointImpl(grpc_event_engine::experimental::EventHandle*, grpc_event_engine::experimental::PosixEngineClosure*, std::shared_ptr<grpc_event_engine::experimental::EventEngine>, grpc_event_engine::experimental::MemoryAllocator&&, grpc_event_engine::experimental::PosixTcpOptions const&)::$_0&, absl::lts_20240722::Status>(std::__invoke_other, grpc_event_engine::experimental::PosixEndpointImpl::PosixEndpointImpl(grpc_event_engine::experimental::EventHandle*, grpc_event_engine::experimental::PosixEngineClosure*, std::shared_ptr<grpc_event_engine::experimental::EventEngine>, grpc_event_engine::experimental::MemoryAllocator&&, grpc_event_engine::experimental::PosixTcpOptions const&)::$_0&, absl::lts_20240722::Status&&) /usr/lib/gcc/x86_64-linux-gnu/14/../../../../include/c++/14/bits/invoke.h:61:14\n    #26 0x7f5ce4089dec in std::__invoke_result<grpc_event_engine::experimental::PosixEndpointImpl::PosixEndpointImpl(grpc_event_engine::experimental::EventHandle*, grpc_event_engine::experimental::PosixEngineClosure*, std::shared_ptr<grpc_event_engine::experimental::EventEngine>, grpc_event_engine::experimental::MemoryAllocator&&, grpc_event_engine::experimental::PosixTcpOptions const&)::$_0&, absl::lts_20240722::Status>::type std::__invoke<grpc_event_engine::experimental::PosixEndpointImpl::PosixEndpointImpl(grpc_event_engine::experimental::EventHandle*, grpc_event_engine::experimental::PosixEngineClosure*, std::shared_ptr<grpc_event_engine::experimental::EventEngine>, grpc_event_engine::experimental::MemoryAllocator&&, grpc_event_engine::experimental::PosixTcpOptions const&)::$_0&, absl::lts_20240722::Status>(grpc_event_engine::experimental::PosixEndpointImpl::PosixEndpointImpl(grpc_event_engine::experimental::EventHandle*, grpc_event_engine::experimental::PosixEngineClosure*, std::shared_ptr<grpc_event_engine::experimental::EventEngine>, grpc_event_engine::experimental::MemoryAllocator&&, grpc_event_engine::experimental::PosixTcpOptions const&)::$_0&, absl::lts_20240722::Status&&) /usr/lib/gcc/x86_64-linux-gnu/14/../../../../include/c++/14/bits/invoke.h:96:14\n    #27 0x7f5ce4089dbc in std::invoke_result<grpc_event_engine::experimental::PosixEndpointImpl::PosixEndpointImpl(grpc_event_engine::experimental::EventHandle*, grpc_event_engine::experimental::PosixEngineClosure*, std::shared_ptr<grpc_event_engine::experimental::EventEngine>, grpc_event_engine::experimental::MemoryAllocator&&, grpc_event_engine::experimental::PosixTcpOptions const&)::$_0&, absl::lts_20240722::Status>::type std::invoke<grpc_event_engine::experimental::PosixEndpointImpl::PosixEndpointImpl(grpc_event_engine::experimental::EventHandle*, grpc_event_engine::experimental::PosixEngineClosure*, std::shared_ptr<grpc_event_engine::experimental::EventEngine>, grpc_event_engine::experimental::MemoryAllocator&&, grpc_event_engine::experimental::PosixTcpOptions const&)::$_0&, absl::lts_20240722::Status>(grpc_event_engine::experimental::PosixEndpointImpl::PosixEndpointImpl(grpc_event_engine::experimental::EventHandle*, grpc_event_engine::experimental::PosixEngineClosure*, std::shared_ptr<grpc_event_engine::experimental::EventEngine>, grpc_event_engine::experimental::MemoryAllocator&&, grpc_event_engine::experimental::PosixTcpOptions const&)::$_0&, absl::lts_20240722::Status&&) /usr/lib/gcc/x86_64-linux-gnu/14/../../../../include/c++/14/functional:120:14\n    #28 0x7f5ce4089d7c in void absl::lts_20240722::internal_any_invocable::InvokeR<void, grpc_event_engine::experimental::PosixEndpointImpl::PosixEndpointImpl(grpc_event_engine::experimental::EventHandle*, grpc_event_engine::experimental::PosixEngineClosure*, std::shared_ptr<grpc_event_engine::experimental::EventEngine>, grpc_event_engine::experimental::MemoryAllocator&&, grpc_event_engine::experimental::PosixTcpOptions const&)::$_0&, absl::lts_20240722::Status, void>(grpc_event_engine::experimental::PosixEndpointImpl::PosixEndpointImpl(grpc_event_engine::experimental::EventHandle*, grpc_event_engine::experimental::PosixEngineClosure*, std::shared_ptr<grpc_event_engine::experimental::EventEngine>, grpc_event_engine::experimental::MemoryAllocator&&, grpc_event_engine::experimental::PosixTcpOptions const&)::$_0&, absl::lts_20240722::Status&&) /proc/self/cwd/external/com_google_absl/absl/functional/internal/any_invocable.h:132:3\n    #29 0x7f5ce4089ce9 in void absl::lts_20240722::internal_any_invocable::LocalInvoker<false, void, grpc_event_engine::experimental::PosixEndpointImpl::PosixEndpointImpl(grpc_event_engine::experimental::EventHandle*, grpc_event_engine::experimental::PosixEngineClosure*, std::shared_ptr<grpc_event_engine::experimental::EventEngine>, grpc_event_engine::experimental::MemoryAllocator&&, grpc_event_engine::experimental::PosixTcpOptions const&)::$_0&, absl::lts_20240722::Status>(absl::lts_20240722::internal_any_invocable::TypeErasedState*, absl::lts_20240722::internal_any_invocable::ForwardedParameter<absl::lts_20240722::Status>::type) /proc/self/cwd/external/com_google_absl/absl/functional/internal/any_invocable.h:310:10\n```\n\nThe sequence of events is - \n1) The client application creates a new RPC. \n2) A `ClientChannelFilter::LoadBalancedCall` is created for the first attempt.\n3) A `CallAttemptTracer` is created for this first attempt and a pointer to this is saved on the arena context.\n4) The first attempt fails without any bytes having been sent on the wire, making this RPC eligible for transparent retries.\n5) A new `ClientChannelFilter::LoadBalancedCall` created for this new attempt.\n6) A new `CallAttemptTracer` is created for this second (transparent) attempt and a pointer is saved on the arena context.\n7) The previous call attempt starts cleaning up, and attempts to end the call attempt tracer. Unfortunately, this is done by reading the pointer from the arena context, resulting in the deletion of the call attempt tracer of the second attempt, and eventually resulting in a heap-use-after-free when the new call attempt tracer is accessed.","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grpc/grpc/issues/38728/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grpc/grpc/issues/38728/timeline","performed_via_github_app":null,"state_reason":"completed"}