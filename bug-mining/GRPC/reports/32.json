{"url":"https://api.github.com/repos/grpc/grpc/issues/34297","repository_url":"https://api.github.com/repos/grpc/grpc","labels_url":"https://api.github.com/repos/grpc/grpc/issues/34297/labels{/name}","comments_url":"https://api.github.com/repos/grpc/grpc/issues/34297/comments","events_url":"https://api.github.com/repos/grpc/grpc/issues/34297/events","html_url":"https://github.com/grpc/grpc/issues/34297","id":1888874072,"node_id":"I_kwDOAacf2M5wle5Y","number":34297,"title":"[Ruby] [1.58.0 regression] Segfault in channel constructor on Windows","user":{"login":"dazuma","id":8911,"node_id":"MDQ6VXNlcjg5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/8911?v=4","gravatar_id":"","url":"https://api.github.com/users/dazuma","html_url":"https://github.com/dazuma","followers_url":"https://api.github.com/users/dazuma/followers","following_url":"https://api.github.com/users/dazuma/following{/other_user}","gists_url":"https://api.github.com/users/dazuma/gists{/gist_id}","starred_url":"https://api.github.com/users/dazuma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dazuma/subscriptions","organizations_url":"https://api.github.com/users/dazuma/orgs","repos_url":"https://api.github.com/users/dazuma/repos","events_url":"https://api.github.com/users/dazuma/events{/privacy}","received_events_url":"https://api.github.com/users/dazuma/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":155504842,"node_id":"MDU6TGFiZWwxNTU1MDQ4NDI=","url":"https://api.github.com/repos/grpc/grpc/labels/kind/bug","name":"kind/bug","color":"93732c","default":false,"description":null},{"id":166332946,"node_id":"MDU6TGFiZWwxNjYzMzI5NDY=","url":"https://api.github.com/repos/grpc/grpc/labels/lang/ruby","name":"lang/ruby","color":"fad8c7","default":false,"description":null},{"id":360790193,"node_id":"MDU6TGFiZWwzNjA3OTAxOTM=","url":"https://api.github.com/repos/grpc/grpc/labels/priority/P2","name":"priority/P2","color":"dd7172","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"apolcyn","id":9566254,"node_id":"MDQ6VXNlcjk1NjYyNTQ=","avatar_url":"https://avatars.githubusercontent.com/u/9566254?v=4","gravatar_id":"","url":"https://api.github.com/users/apolcyn","html_url":"https://github.com/apolcyn","followers_url":"https://api.github.com/users/apolcyn/followers","following_url":"https://api.github.com/users/apolcyn/following{/other_user}","gists_url":"https://api.github.com/users/apolcyn/gists{/gist_id}","starred_url":"https://api.github.com/users/apolcyn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apolcyn/subscriptions","organizations_url":"https://api.github.com/users/apolcyn/orgs","repos_url":"https://api.github.com/users/apolcyn/repos","events_url":"https://api.github.com/users/apolcyn/events{/privacy}","received_events_url":"https://api.github.com/users/apolcyn/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"apolcyn","id":9566254,"node_id":"MDQ6VXNlcjk1NjYyNTQ=","avatar_url":"https://avatars.githubusercontent.com/u/9566254?v=4","gravatar_id":"","url":"https://api.github.com/users/apolcyn","html_url":"https://github.com/apolcyn","followers_url":"https://api.github.com/users/apolcyn/followers","following_url":"https://api.github.com/users/apolcyn/following{/other_user}","gists_url":"https://api.github.com/users/apolcyn/gists{/gist_id}","starred_url":"https://api.github.com/users/apolcyn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apolcyn/subscriptions","organizations_url":"https://api.github.com/users/apolcyn/orgs","repos_url":"https://api.github.com/users/apolcyn/repos","events_url":"https://api.github.com/users/apolcyn/events{/privacy}","received_events_url":"https://api.github.com/users/apolcyn/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2023-09-09T21:07:10Z","updated_at":"2024-12-21T20:36:36Z","closed_at":"2024-12-21T20:36:35Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"gRPC for Ruby on Windows (x64-mingw-ucrt) segfaults in the `GRPC::Core::Channel` constructor when the protobuf library is loaded *before* grpc.\r\n\r\nEnvironment:\r\n* OS: Windows Server 2022 version 10.0.20348 (the \"windows-latest\" OS on GitHub Actions as of 2023-09-09)\r\n* Language: Ruby (versions 3.2.2 and 2.7.8 tested)\r\n* GRPC 1.58.0 (Gem version `grpc-1.58.0-x64-mingw-ucrt` along with dependencies `google-protobuf-3.24.3-x64-mingw-ucrt` and `googleapis-common-protos-types-1.8.0`)\r\n\r\nReproduction steps:\r\n\r\n```sh\r\ngem install grpc:1.58.0\r\n```\r\n\r\nThen run the following Ruby script:\r\n\r\n```ruby\r\n# This is a test of a grpc 1.58.0 segfault on Windows.\r\n\r\n# This must be required BEFORE grpc to reproduce the segfault\r\nrequire \"google/protobuf\"\r\n\r\nrequire \"grpc\"\r\n\r\n# The segfault happens on the following line.\r\nGRPC::Core::Channel.new \"localhost:8000\", nil, :this_channel_is_insecure\r\n\r\n# Never gets here\r\nputs \"Never gets here\"\r\n```\r\n\r\nResult:\r\n\r\n```\r\nSuccessfully installed google-protobuf-3.24.3-x64-mingw-ucrt\r\nSuccessfully installed googleapis-common-protos-types-1.8.0\r\nSuccessfully installed grpc-1.58.0-x64-mingw-ucrt\r\n3 gems installed\r\nE0909 20:56:38.196000000  4792 src/core/lib/debug/trace.cc:66] Unknown trace var: 'all'\r\ngrpc-test.rb:9: [BUG] Segmentation fault\r\nruby 3.2.2 (2023-03-30 revision e51014f9c0) [x64-mingw-ucrt]\r\n\r\n-- Control frame information -----------------------------------------------\r\nc:0003 p:---- s:0013 e:000012 CFUNC  :new\r\nc:0002 p:0021 s:0006 e:000005 EVAL   grpc-test.rb:9 [FINISH]\r\nc:0001 p:0000 s:0003 E:001200 DUMMY  [FINISH]\r\n\r\n-- Ruby level backtrace information ----------------------------------------\r\ngrpc-test.rb:9:in `<main>'\r\ngrpc-test.rb:9:in `new'\r\n\r\n-- C level backtrace information -------------------------------------------\r\nC:\\Windows\\SYSTEM32\\ntdll.dll(ZwWaitForSingleObject+0x14) [0x00007ffeb84c0114]\r\nC:\\Windows\\System32\\KERNELBASE.dll(WaitForSingleObjectEx+0x8e) [0x00007ffeb5e6d77e]\r\nC:\\hostedtoolcache\\windows\\Ruby\\3.2.2\\x64\\bin\\x64-ucrt-ruby320.dll(rb_vm_bugreport+0x256) [0x00007ffe99222ee6]\r\nC:\\hostedtoolcache\\windows\\Ruby\\3.2.2\\x64\\bin\\x64-ucrt-ruby320.dll(rb_bug_for_fatal_signal+0x80) [0x00007ffe990205b0]\r\nC:\\hostedtoolcache\\windows\\Ruby\\3.2.2\\x64\\bin\\x64-ucrt-ruby320.dll(rb_shape_memsize+0x542) [0x00007ffe9916e502]\r\n [0x00007ff7373d1e22]\r\nC:\\Windows\\System32\\ucrtbase.dll(_C_specific_handler+0xa0) [0x00007ffeb5d655f0]\r\nC:\\Windows\\SYSTEM32\\ntdll.dll(_chkstk+0x12f) [0x00007ffeb84c4fff]\r\nC:\\Windows\\SYSTEM32\\ntdll.dll(RtlVirtualUnwind2+0x35e) [0x00007ffeb84518fe]\r\nC:\\Windows\\SYSTEM32\\ntdll.dll(KiUserExceptionDispatcher+0x2e) [0x00007ffeb84c3fee]\r\n [0xffffffff99ad0000]\r\nC:\\hostedtoolcache\\windows\\Ruby\\3.2.2\\x64\\lib\\ruby\\gems\\3.2.0\\gems\\grpc-1.58.0-x64-mingw-ucrt\\grpc_c.64-ucrt.ruby(Z15grpc_iomgr_initv+0xc0) [0x0000000000d51520]\r\nC:\\hostedtoolcache\\windows\\Ruby\\3.2.2\\x64\\lib\\ruby\\gems\\3.2.0\\gems\\grpc-1.58.0-x64-mingw-ucrt\\grpc_c.64-ucrt.ruby(grpc_init+0x6e) [0x0000000000e0e5be]\r\n [0x0000000071048261]\r\n [0x00000000710452d8]\r\nC:\\hostedtoolcache\\windows\\Ruby\\3.2.2\\x64\\bin\\x64-ucrt-ruby320.dll(rb_class_new_instance_pass_kw+0x1d) [0x00007ffe990c903d]\r\nC:\\hostedtoolcache\\windows\\Ruby\\3.2.2\\x64\\bin\\x64-ucrt-ruby320.dll(rb_error_arity+0x147) [0x00007ffe991f8b[27](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:28)]\r\nC:\\hostedtoolcache\\windows\\Ruby\\3.2.2\\x64\\bin\\x64-ucrt-ruby320.dll(rb_vm_opt_newarray_max+0x3ec) [0x00007ffe992144cc]\r\nC:\\hostedtoolcache\\windows\\Ruby\\3.2.2\\x64\\bin\\x64-ucrt-ruby320.dll(rb_vm_exec+0x65c) [0x00007ffe99205b4c]\r\nC:\\hostedtoolcache\\windows\\Ruby\\3.2.2\\x64\\bin\\x64-ucrt-ruby320.dll(rb_call_end_proc+0x130) [0x00007ffe990251f0]\r\nC:\\hostedtoolcache\\windows\\Ruby\\3.2.2\\x64\\bin\\x64-ucrt-ruby320.dll(ruby_run_node+0xa5) [0x00007ffe9902afd5]\r\n [0x00007ff7373d2a20]\r\n [0x00007ff7373d12ee]\r\n [0x00007ff7373d1406]\r\nC:\\Windows\\System32\\KERNEL32.DLL(BaseThreadInitThunk+0x10) [0x00007ffeb7994de0]\r\n\r\n-- Other runtime information -----------------------------------------------\r\n\r\n* Loaded script: grpc-test.rb\r\n\r\n* Loaded features:\r\n\r\n    0 enumerator.so\r\n    1 thread.rb\r\n    2 fiber.so\r\n    3 rational.so\r\n    4 complex.so\r\n    5 ruby2_keywords.rb\r\n    6 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/x64-mingw-ucrt/enc/encdb.so\r\n    7 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/x64-mingw-ucrt/enc/trans/transdb.so\r\n    8 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/x64-mingw-ucrt/rbconfig.rb\r\n    9 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/compatibility.rb\r\n   10 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/defaults.rb\r\n   11 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/deprecate.rb\r\n   12 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/errors.rb\r\n   13 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/unknown_command_spell_checker.rb\r\n   14 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/exceptions.rb\r\n   15 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/basic_specification.rb\r\n   16 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/stub_specification.rb\r\n   17 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/platform.rb\r\n   18 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/util/list.rb\r\n   19 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/version.rb\r\n   20 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/requirement.rb\r\n   21 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/specification.rb\r\n   22 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/site_ruby/3.2.0/ruby_installer/runtime/singleton.rb\r\n   23 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/site_ruby/3.2.0/ruby_installer/runtime.rb\r\n   24 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/site_ruby/3.2.0/ruby_installer/runtime/msys2_installation.rb\r\n   25 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/x64-mingw-ucrt/win32/dll_directory.so\r\n   26 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/site_ruby/3.2.0/ruby_installer/runtime/dll_directory.rb\r\n   27 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/x64-mingw-ucrt/enc/utf_16le.so\r\n   [28](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:29) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/x64-mingw-ucrt/enc/trans/utf_16_32.so\r\n   [29](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:30) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/text.rb\r\n   [30](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:31) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/user_interaction.rb\r\n   [31](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:32) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/x64-mingw-ucrt/etc.so\r\n   [32](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:33) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/config_file.rb\r\n   [33](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:34) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/defaults/operating_system.rb\r\n   [34](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:35) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/util.rb\r\n   [35](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:36) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/dependency.rb\r\n   [36](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:37) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/core_ext/kernel_gem.rb\r\n   [37](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:38) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/x64-mingw-ucrt/monitor.so\r\n   [38](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:39) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/monitor.rb\r\n   [39](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:40) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems.rb\r\n   [40](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:41) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/rubygems/path_support.rb\r\n   [41](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:42) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/error_highlight/version.rb\r\n   [42](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:43) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/error_highlight/base.rb\r\n   [43](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:44) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/error_highlight/formatter.rb\r\n   [44](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:45) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/error_highlight/core_ext.rb\r\n   [45](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:46) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/error_highlight.rb\r\n   [46](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:47) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/version.rb\r\n   [47](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:48) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/core_ext/name_error.rb\r\n   [48](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:49) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/levenshtein.rb\r\n   [49](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:50) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/jaro_winkler.rb\r\n   [50](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:51) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/spell_checker.rb\r\n   [51](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:52) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/spell_checkers/name_error_checkers/class_name_checker.rb\r\n   [52](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:53) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/spell_checkers/name_error_checkers/variable_name_checker.rb\r\n   [53](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:54) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/spell_checkers/name_error_checkers.rb\r\n   [54](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:55) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/spell_checkers/method_name_checker.rb\r\n   [55](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:56) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/spell_checkers/key_error_checker.rb\r\n   [56](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:57) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/spell_checkers/null_checker.rb\r\n   [57](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:58) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/tree_spell_checker.rb\r\n   [58](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:59) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/spell_checkers/require_path_checker.rb\r\n   [59](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:60) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/spell_checkers/pattern_key_name_checker.rb\r\n   [60](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:61) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean/formatter.rb\r\n   [61](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:62) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/did_you_mean.rb\r\n   [62](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:63) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/syntax_suggest/core_ext.rb\r\n   [63](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:64) C:/hostedtoolcache/windows/Ruby/3.2.2/x[64](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:65)/lib/ruby/gems/3.2.0/gems/google-protobuf-3.24.3-x64-mingw-ucrt/lib/google/protobuf/message_exts.rb\r\n   64 C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/google-protobuf-3.24.3-x64-mingw-ucrt/lib/google/protobuf/object_cache.rb\r\n   [65](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:66) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/google-protobuf-3.24.3-x64-mingw-ucrt/lib/google/3.2/protobuf_c.so\r\n   [66](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:67) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/google-protobuf-3.24.3-x64-mingw-ucrt/lib/google/protobuf/descriptor_pb.rb\r\n   [67](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:68) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/google-protobuf-3.24.3-x64-mingw-ucrt/lib/google/protobuf/descriptor_dsl.rb\r\n   [68](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:69) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/forwardable/impl.rb\r\n   [69](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:70) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/forwardable.rb\r\n   [70](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:71) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/google-protobuf-3.24.3-x64-mingw-ucrt/lib/google/protobuf/repeated_field.rb\r\n   [71](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:72) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/google-protobuf-3.24.3-x64-mingw-ucrt/lib/google/protobuf.rb\r\n   [72](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:73) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/structs.rb\r\n   [73](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:74) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/core/status_codes.rb\r\n   [74](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:75) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/google_rpc_status_utils.rb\r\n   [75](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:76) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/errors.rb\r\n   [76](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:77) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/3.2/grpc_c.so\r\n   [77](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:78) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/grpc.rb\r\n   [78](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:79) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/logconfig.rb\r\n   [79](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:80) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/notifier.rb\r\n   [80](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:81) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/version.rb\r\n   [81](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:82) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/core/time_consts.rb\r\n   [82](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:83) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/delegate.rb\r\n   [83](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:84) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/3.2.0/weakref.rb\r\n   [84](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:85) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/generic/bidi_call.rb\r\n   [85](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:86) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/generic/active_call.rb\r\n   [86](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:87) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/generic/client_stub.rb\r\n   [87](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:88) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/generic/rpc_desc.rb\r\n   [88](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:89) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/generic/service.rb\r\n   [89](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:90) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/generic/rpc_server.rb\r\n   [90](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:91) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/generic/interceptor_registry.rb\r\n   [91](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:92) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc/generic/interceptors.rb\r\n   [92](https://github.com/dazuma/misc-tests/actions/runs/6133083282/job/16644624568?pr=1#step:4:93) C:/hostedtoolcache/windows/Ruby/3.2.2/x64/lib/ruby/gems/3.2.0/gems/grpc-1.58.0-x64-mingw-ucrt/src/ruby/lib/grpc.rb\r\n```\r\n\r\nExample run: https://github.com/dazuma/misc-tests/actions/runs/6133108074/job/16644674963?pr=1\r\n\r\nOther notes:\r\n\r\n* I have not been able to reproduce this on any OS except Windows. (Tried ubuntu and macos.)\r\n\r\n* Does not reproduce in grpc 1.57.0. This seems to be a regression in 1.58.0.\r\n\r\n* Ruby version does not seem to have an impact. I'm seeing a basically identical segfault on both Ruby 3.2 and 2.7.\r\n\r\n* This may have something to do with an interaction with the protobuf library, because the segfault does *not* occur if we omit `require \"google/protobuf\"`, nor if we swap the order of `require \"google/protobuf\"` and `require \"grpc\"`.\r\n\r\n* The above run included the following environment variables:\r\n    ```\r\n    GRPC_VERBOSITY=DEBUG\r\n    GRPC_TRACE=all\r\n    ```\r\n    Unfortunately, the grpc x64-mingw-ucrt build doesn't seem to accept `GRPC_TRACE=all`. (See error in the above output.) Or, in fact, any value of `GRPC_TRACE`. (I also tried `api`, `channel`, and a few others.)\r\n\r\n/attn: @apolcyn \r\n","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grpc/grpc/issues/34297/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grpc/grpc/issues/34297/timeline","performed_via_github_app":null,"state_reason":"completed"}