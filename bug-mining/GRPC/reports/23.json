{"url":"https://api.github.com/repos/grpc/grpc/issues/36409","repository_url":"https://api.github.com/repos/grpc/grpc","labels_url":"https://api.github.com/repos/grpc/grpc/issues/36409/labels{/name}","comments_url":"https://api.github.com/repos/grpc/grpc/issues/36409/comments","events_url":"https://api.github.com/repos/grpc/grpc/issues/36409/events","html_url":"https://github.com/grpc/grpc/issues/36409","id":2253723833,"node_id":"I_kwDOAacf2M6GVRi5","number":36409,"title":"Data racing in core/lib/channel/channel_trace.cc","user":{"login":"find3kan0","id":59979614,"node_id":"MDQ6VXNlcjU5OTc5NjE0","avatar_url":"https://avatars.githubusercontent.com/u/59979614?v=4","gravatar_id":"","url":"https://api.github.com/users/find3kan0","html_url":"https://github.com/find3kan0","followers_url":"https://api.github.com/users/find3kan0/followers","following_url":"https://api.github.com/users/find3kan0/following{/other_user}","gists_url":"https://api.github.com/users/find3kan0/gists{/gist_id}","starred_url":"https://api.github.com/users/find3kan0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/find3kan0/subscriptions","organizations_url":"https://api.github.com/users/find3kan0/orgs","repos_url":"https://api.github.com/users/find3kan0/repos","events_url":"https://api.github.com/users/find3kan0/events{/privacy}","received_events_url":"https://api.github.com/users/find3kan0/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":155504842,"node_id":"MDU6TGFiZWwxNTU1MDQ4NDI=","url":"https://api.github.com/repos/grpc/grpc/labels/kind/bug","name":"kind/bug","color":"93732c","default":false,"description":null},{"id":218696181,"node_id":"MDU6TGFiZWwyMTg2OTYxODE=","url":"https://api.github.com/repos/grpc/grpc/labels/lang/core","name":"lang/core","color":"fad8c7","default":false,"description":""},{"id":360790193,"node_id":"MDU6TGFiZWwzNjA3OTAxOTM=","url":"https://api.github.com/repos/grpc/grpc/labels/priority/P2","name":"priority/P2","color":"dd7172","default":false,"description":""},{"id":3940839694,"node_id":"LA_kwDOAacf2M7q5HEO","url":"https://api.github.com/repos/grpc/grpc/labels/untriaged","name":"untriaged","color":"c2e0c6","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"markdroth","id":18664614,"node_id":"MDQ6VXNlcjE4NjY0NjE0","avatar_url":"https://avatars.githubusercontent.com/u/18664614?v=4","gravatar_id":"","url":"https://api.github.com/users/markdroth","html_url":"https://github.com/markdroth","followers_url":"https://api.github.com/users/markdroth/followers","following_url":"https://api.github.com/users/markdroth/following{/other_user}","gists_url":"https://api.github.com/users/markdroth/gists{/gist_id}","starred_url":"https://api.github.com/users/markdroth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markdroth/subscriptions","organizations_url":"https://api.github.com/users/markdroth/orgs","repos_url":"https://api.github.com/users/markdroth/repos","events_url":"https://api.github.com/users/markdroth/events{/privacy}","received_events_url":"https://api.github.com/users/markdroth/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"markdroth","id":18664614,"node_id":"MDQ6VXNlcjE4NjY0NjE0","avatar_url":"https://avatars.githubusercontent.com/u/18664614?v=4","gravatar_id":"","url":"https://api.github.com/users/markdroth","html_url":"https://github.com/markdroth","followers_url":"https://api.github.com/users/markdroth/followers","following_url":"https://api.github.com/users/markdroth/following{/other_user}","gists_url":"https://api.github.com/users/markdroth/gists{/gist_id}","starred_url":"https://api.github.com/users/markdroth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markdroth/subscriptions","organizations_url":"https://api.github.com/users/markdroth/orgs","repos_url":"https://api.github.com/users/markdroth/repos","events_url":"https://api.github.com/users/markdroth/events{/privacy}","received_events_url":"https://api.github.com/users/markdroth/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":2,"created_at":"2024-04-19T19:03:23Z","updated_at":"2024-04-25T20:17:58Z","closed_at":"2024-04-24T17:25:37Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nPLEASE DO NOT POST A QUESTION HERE.\r\nThis form is for bug reports and feature requests ONLY!\r\n\r\nFor general questions and troubleshooting, please ask/look for answers at StackOverflow, with \"grpc\" tag: https://stackoverflow.com/questions/tagged/grpc\r\n\r\nFor questions that specifically need to be answered by gRPC team members, please ask/look for answers at grpc.io mailing list: https://groups.google.com/forum/#!forum/grpc-io\r\n\r\nIssues specific to *grpc-java*, *grpc-go*, *grpc-node*, *grpc-dart*, *grpc-web* should be created in the repository they belong to (e.g. https://github.com/grpc/grpc-LANGUAGE/issues/new)\r\n-->\r\n\r\n### What version of gRPC and what language are you using?\r\nv1.62.2, C++\r\n\r\n\r\n### What operating system (Linux, Windows,...) and version?\r\nLinux\r\n\r\n\r\n### What runtime / compiler are you using (e.g. python version or version of gcc)\r\nclang 18.1.4\r\n\r\n\r\n### What did you do?\r\nIn a standalone thread, I periodically (at 1Hz) poll data from `grpc_channelz_get_top_channels`, and walk through the result by calling `grpc_channelz_get_subchannel` and `grpc_channelz_get_socket` to get detailed information. \r\n\r\n### What did you expect to see?\r\nDo not crash.\r\n\r\n### What did you see instead?\r\nI experienced SEGSEGV fault with callstack like below (callstack sanitized with removing proprietary infoï¼‰\r\n```\r\ngrpc_core::channelz::ChannelTrace::RenderJson()\r\nFailureSignalHandler()\r\n(unknown)\r\ngrpc_core::channelz::ChannelTrace::RenderJson()\r\ngrpc_core::channelz::SubchannelNode::RenderJson()\r\ngrpc_channelz_get_subchannel\r\nmy_app::CollectGrpcDianosticInfo()\r\n...\r\nstart_thread\r\n```\r\n\r\nThe crash happens at `grpc_core::channelz::ChannelTrace::RenderJson()`, which is called from `grpc_core::channelz::SubchannelNode::RenderJson()`.   Look at https://github.com/grpc/grpc/blob/ba78e4ff475550e1fa3fd09fbcee326c3c6dfd5a/src/core/lib/channel/channel_trace.cc#L161 the member variable of the `ChannelTrace` is accessed without proper synchronization. A mutex object is created at https://github.com/grpc/grpc/blob/ba78e4ff475550e1fa3fd09fbcee326c3c6dfd5a/src/core/lib/channel/channel_trace.cc#L66 but it is never used. \r\n\r\nAs of now, I am setting up the `GRPC_ARG_MAX_CHANNEL_TRACE_EVENT_MEMORY_PER_NODE` to 0 (since channel trace is not something I am interested in anyways). But the data racing problem should be fixed. \r\n\r\nSee [TROUBLESHOOTING.md](https://github.com/grpc/grpc/blob/master/TROUBLESHOOTING.md) for how to diagnose problems better.\r\n\r\n### Anything else we should know about your project / environment?\r\n","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grpc/grpc/issues/36409/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grpc/grpc/issues/36409/timeline","performed_via_github_app":null,"state_reason":"completed"}