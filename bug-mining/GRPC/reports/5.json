{"url":"https://api.github.com/repos/grpc/grpc/issues/33308","repository_url":"https://api.github.com/repos/grpc/grpc","labels_url":"https://api.github.com/repos/grpc/grpc/issues/33308/labels{/name}","comments_url":"https://api.github.com/repos/grpc/grpc/issues/33308/comments","events_url":"https://api.github.com/repos/grpc/grpc/issues/33308/events","html_url":"https://github.com/grpc/grpc/issues/33308","id":1735345035,"node_id":"I_kwDOAacf2M5nb0OL","number":33308,"title":"Unittest is not buildable with c++17","user":{"login":"mudream4869","id":6008539,"node_id":"MDQ6VXNlcjYwMDg1Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/6008539?v=4","gravatar_id":"","url":"https://api.github.com/users/mudream4869","html_url":"https://github.com/mudream4869","followers_url":"https://api.github.com/users/mudream4869/followers","following_url":"https://api.github.com/users/mudream4869/following{/other_user}","gists_url":"https://api.github.com/users/mudream4869/gists{/gist_id}","starred_url":"https://api.github.com/users/mudream4869/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mudream4869/subscriptions","organizations_url":"https://api.github.com/users/mudream4869/orgs","repos_url":"https://api.github.com/users/mudream4869/repos","events_url":"https://api.github.com/users/mudream4869/events{/privacy}","received_events_url":"https://api.github.com/users/mudream4869/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":155504842,"node_id":"MDU6TGFiZWwxNTU1MDQ4NDI=","url":"https://api.github.com/repos/grpc/grpc/labels/kind/bug","name":"kind/bug","color":"93732c","default":false,"description":null},{"id":166332908,"node_id":"MDU6TGFiZWwxNjYzMzI5MDg=","url":"https://api.github.com/repos/grpc/grpc/labels/lang/c++","name":"lang/c++","color":"fad8c7","default":false,"description":null},{"id":360790193,"node_id":"MDU6TGFiZWwzNjA3OTAxOTM=","url":"https://api.github.com/repos/grpc/grpc/labels/priority/P2","name":"priority/P2","color":"dd7172","default":false,"description":""},{"id":3940839694,"node_id":"LA_kwDOAacf2M7q5HEO","url":"https://api.github.com/repos/grpc/grpc/labels/untriaged","name":"untriaged","color":"c2e0c6","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"yashykt","id":4181124,"node_id":"MDQ6VXNlcjQxODExMjQ=","avatar_url":"https://avatars.githubusercontent.com/u/4181124?v=4","gravatar_id":"","url":"https://api.github.com/users/yashykt","html_url":"https://github.com/yashykt","followers_url":"https://api.github.com/users/yashykt/followers","following_url":"https://api.github.com/users/yashykt/following{/other_user}","gists_url":"https://api.github.com/users/yashykt/gists{/gist_id}","starred_url":"https://api.github.com/users/yashykt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yashykt/subscriptions","organizations_url":"https://api.github.com/users/yashykt/orgs","repos_url":"https://api.github.com/users/yashykt/repos","events_url":"https://api.github.com/users/yashykt/events{/privacy}","received_events_url":"https://api.github.com/users/yashykt/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"yashykt","id":4181124,"node_id":"MDQ6VXNlcjQxODExMjQ=","avatar_url":"https://avatars.githubusercontent.com/u/4181124?v=4","gravatar_id":"","url":"https://api.github.com/users/yashykt","html_url":"https://github.com/yashykt","followers_url":"https://api.github.com/users/yashykt/followers","following_url":"https://api.github.com/users/yashykt/following{/other_user}","gists_url":"https://api.github.com/users/yashykt/gists{/gist_id}","starred_url":"https://api.github.com/users/yashykt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yashykt/subscriptions","organizations_url":"https://api.github.com/users/yashykt/orgs","repos_url":"https://api.github.com/users/yashykt/repos","events_url":"https://api.github.com/users/yashykt/events{/privacy}","received_events_url":"https://api.github.com/users/yashykt/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2023-06-01T02:57:16Z","updated_at":"2023-06-09T22:44:28Z","closed_at":"2023-06-09T22:44:28Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What version of gRPC and what language are you using?\r\n\r\n* gRPC version: v1.55.0\r\n* language: not relatived\r\n\r\n### What operating system (Linux, Windows,...) and version?\r\n\r\nUbuntu 20.04\r\n\r\n### What runtime / compiler are you using (e.g. python version or version of gcc)\r\n\r\ngcc version 9.4.0 (Ubuntu 9.4.0-1ubuntu1~20.04.1) \r\n\r\n### What did you do?\r\n\r\nI try to build all unittest with flag `-DCMAKE_CXX_STANDARD=17`\r\n\r\n```bash\r\ncmake -GNinja \\\r\n    -DCMAKE_CXX_STANDARD=17 \\\r\n    -DCMAKE_BUILD_TYPE=Release \\\r\n    -DgRPC_BUILD_TESTS=ON \\\r\n    ../grpc\r\nninja\r\n```\r\n\r\n### What did you expect to see?\r\n\r\nBuild ok at least.\r\n\r\n### What did you see instead?\r\n\r\nCompiler error:\r\n\r\n```\r\nFAILED: CMakeFiles/xds_client_test.dir/test/core/xds/xds_client_test.cc.o \r\n/usr/bin/c++ -DCARES_STATICLIB -I/root/projects/grpc/grpc/third_party/re2 -I/root/projects/grpc/grpc/third_party/zlib -I/root/projects/grpc/grpc -I/root/projects/grpc/grpc/include -I/root/projects/grpc/grpc/third_party/address_sorting/include -I/root/projects/grpc/build_test/third_party/re2 -I/root/projects/grpc/grpc/third_party/boringssl-with-bazel/src/include -I/root/projects/grpc/grpc/src/core/ext/upb-generated -I/root/projects/grpc/grpc/src/core/ext/upbdefs-generated -I/root/projects/grpc/grpc/third_party/upb -I/root/projects/grpc/grpc/third_party/utf8_range -I/root/projects/grpc/grpc/third_party/xxhash -I/root/projects/grpc/build_test/third_party/zlib -I/root/projects/grpc/grpc/third_party/googletest/googletest/include -I/root/projects/grpc/grpc/third_party/googletest/googletest -I/root/projects/grpc/grpc/third_party/googletest/googlemock/include -I/root/projects/grpc/grpc/third_party/googletest/googlemock -I/root/projects/grpc/build_test/gens -I/root/projects/grpc/grpc/third_party/protobuf/src -I/root/projects/grpc/grpc/third_party/abseil-cpp -I/root/projects/grpc/build_test/third_party/cares/cares -I/root/projects/grpc/grpc/third_party/cares/cares -I/root/projects/grpc/grpc/third_party/cares/cares/include -O3 -DNDEBUG -std=gnu++17 -fPIE -pthread -MD -MT CMakeFiles/xds_client_test.dir/test/core/xds/xds_client_test.cc.o -MF CMakeFiles/xds_client_test.dir/test/core/xds/xds_client_test.cc.o.d -o CMakeFiles/xds_client_test.dir/test/core/xds/xds_client_test.cc.o -c /root/projects/grpc/grpc/test/core/xds/xds_client_test.cc\r\n/root/projects/grpc/grpc/test/core/xds/xds_client_test.cc: In constructor ‘grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::Builder::Builder()’:\r\n/root/projects/grpc/grpc/test/core/xds/xds_client_test.cc:161:33: error: no matching function for call to ‘std::optional<grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::FakeNode>::emplace()’\r\n  161 |       Builder() { node_.emplace(); }\r\n      |                                 ^\r\nIn file included from /usr/include/c++/9/bits/node_handle.h:39,\r\n                 from /usr/include/c++/9/bits/stl_tree.h:72,\r\n                 from /usr/include/c++/9/map:60,\r\n                 from /root/projects/grpc/grpc/src/core/ext/xds/xds_client.h:22,\r\n                 from /root/projects/grpc/grpc/test/core/xds/xds_client_test.cc:21:\r\n/usr/include/c++/9/optional:845:2: note: candidate: ‘template<class ... _Args> std::enable_if_t<is_constructible_v<_Tp, _Args&& ...>, _Tp&> std::optional<_Tp>::emplace(_Args&& ...) [with _Args = {_Args ...}; _Tp = grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::FakeNode]’\r\n  845 |  emplace(_Args&&... __args)\r\n      |  ^~~~~~~\r\n/usr/include/c++/9/optional:845:2: note:   template argument deduction/substitution failed:\r\nIn file included from /usr/include/c++/9/bits/move.h:55,\r\n                 from /usr/include/c++/9/bits/stl_pair.h:59,\r\n                 from /usr/include/c++/9/bits/stl_algobase.h:64,\r\n                 from /usr/include/c++/9/bits/stl_tree.h:63,\r\n                 from /usr/include/c++/9/map:60,\r\n                 from /root/projects/grpc/grpc/src/core/ext/xds/xds_client.h:22,\r\n                 from /root/projects/grpc/grpc/test/core/xds/xds_client_test.cc:21:\r\n/usr/include/c++/9/type_traits: In substitution of ‘template<bool _Cond, class _Tp> using enable_if_t = typename std::enable_if::type [with bool _Cond = std::is_constructible_v<grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::FakeNode>; _Tp = grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::FakeNode&]’:\r\n/usr/include/c++/9/optional:845:2:   required by substitution of ‘template<class ... _Args> std::enable_if_t<is_constructible_v<grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::FakeNode, _Args&& ...>, grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::FakeNode&> std::optional<grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::FakeNode>::emplace<_Args ...>(_Args&& ...) [with _Args = {}]’\r\n/root/projects/grpc/grpc/test/core/xds/xds_client_test.cc:161:33:   required from here\r\n/usr/include/c++/9/type_traits:2378:11: error: no type named ‘type’ in ‘struct std::enable_if<false, grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::FakeNode&>’\r\n 2378 |     using enable_if_t = typename enable_if<_Cond, _Tp>::type;\r\n      |           ^~~~~~~~~~~\r\nIn file included from /usr/include/c++/9/bits/node_handle.h:39,\r\n                 from /usr/include/c++/9/bits/stl_tree.h:72,\r\n                 from /usr/include/c++/9/map:60,\r\n                 from /root/projects/grpc/grpc/src/core/ext/xds/xds_client.h:22,\r\n                 from /root/projects/grpc/grpc/test/core/xds/xds_client_test.cc:21:\r\n/usr/include/c++/9/optional:855:2: note: candidate: ‘template<class _Up, class ... _Args> std::enable_if_t<is_constructible_v<_Tp, std::initializer_list<_Up>&, _Args&& ...>, _Tp&> std::optional<_Tp>::emplace(std::initializer_list<_Up>, _Args&& ...) [with _Up = _Up; _Args = {_Args ...}; _Tp = grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::FakeNode]’\r\n  855 |  emplace(initializer_list<_Up> __il, _Args&&... __args)\r\n      |  ^~~~~~~\r\n/usr/include/c++/9/optional:855:2: note:   template argument deduction/substitution failed:\r\n/root/projects/grpc/grpc/test/core/xds/xds_client_test.cc:161:33: note:   candidate expects at least 1 argument, 0 provided\r\n  161 |       Builder() { node_.emplace(); }\r\n      |                                 ^\r\n/root/projects/grpc/grpc/test/core/xds/xds_client_test.cc: In member function ‘grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::Builder& grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::Builder::set_node_id(std::string)’:\r\n/root/projects/grpc/grpc/test/core/xds/xds_client_test.cc:164:47: error: no matching function for call to ‘std::optional<grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::FakeNode>::emplace()’\r\n  164 |         if (!node_.has_value()) node_.emplace();\r\n      |                                               ^\r\nIn file included from /usr/include/c++/9/bits/node_handle.h:39,\r\n                 from /usr/include/c++/9/bits/stl_tree.h:72,\r\n                 from /usr/include/c++/9/map:60,\r\n                 from /root/projects/grpc/grpc/src/core/ext/xds/xds_client.h:22,\r\n                 from /root/projects/grpc/grpc/test/core/xds/xds_client_test.cc:21:\r\n/usr/include/c++/9/optional:845:2: note: candidate: ‘template<class ... _Args> std::enable_if_t<is_constructible_v<_Tp, _Args&& ...>, _Tp&> std::optional<_Tp>::emplace(_Args&& ...) [with _Args = {_Args ...}; _Tp = grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::FakeNode]’\r\n  845 |  emplace(_Args&&... __args)\r\n      |  ^~~~~~~\r\n/usr/include/c++/9/optional:845:2: note:   template argument deduction/substitution failed:\r\n/usr/include/c++/9/optional:855:2: note: candidate: ‘template<class _Up, class ... _Args> std::enable_if_t<is_constructible_v<_Tp, std::initializer_list<_Up>&, _Args&& ...>, _Tp&> std::optional<_Tp>::emplace(std::initializer_list<_Up>, _Args&& ...) [with _Up = _Up; _Args = {_Args ...}; _Tp = grpc_core::testing::{anonymous}::XdsClientTest::FakeXdsBootstrap::FakeNode]’\r\n  855 |  emplace(initializer_list<_Up> __il, _Args&&... __args)\r\n      |  ^~~~~~~\r\n/usr/include/c++/9/optional:855:2: note:   template argument deduction/substitution failed:\r\n/root/projects/grpc/grpc/test/core/xds/xds_client_test.cc:164:47: note:   candidate expects at least 1 argument, 0 provided\r\n  164 |         if (!node_.has_value()) node_.emplace();\r\n      |                                               ^\r\n```\r\n","closed_by":{"login":"veblush","id":2793282,"node_id":"MDQ6VXNlcjI3OTMyODI=","avatar_url":"https://avatars.githubusercontent.com/u/2793282?v=4","gravatar_id":"","url":"https://api.github.com/users/veblush","html_url":"https://github.com/veblush","followers_url":"https://api.github.com/users/veblush/followers","following_url":"https://api.github.com/users/veblush/following{/other_user}","gists_url":"https://api.github.com/users/veblush/gists{/gist_id}","starred_url":"https://api.github.com/users/veblush/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/veblush/subscriptions","organizations_url":"https://api.github.com/users/veblush/orgs","repos_url":"https://api.github.com/users/veblush/repos","events_url":"https://api.github.com/users/veblush/events{/privacy}","received_events_url":"https://api.github.com/users/veblush/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grpc/grpc/issues/33308/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grpc/grpc/issues/33308/timeline","performed_via_github_app":null,"state_reason":"completed"}