{"url":"https://api.github.com/repos/grpc/grpc/issues/38908","repository_url":"https://api.github.com/repos/grpc/grpc","labels_url":"https://api.github.com/repos/grpc/grpc/issues/38908/labels{/name}","comments_url":"https://api.github.com/repos/grpc/grpc/issues/38908/comments","events_url":"https://api.github.com/repos/grpc/grpc/issues/38908/events","html_url":"https://github.com/grpc/grpc/issues/38908","id":2894097985,"node_id":"I_kwDOAacf2M6sgG5B","number":38908,"title":"Client retry perAttemptRecvTimeout crash","user":{"login":"kpavlov00","id":168818728,"node_id":"U_kgDOCg_4KA","avatar_url":"https://avatars.githubusercontent.com/u/168818728?v=4","gravatar_id":"","url":"https://api.github.com/users/kpavlov00","html_url":"https://github.com/kpavlov00","followers_url":"https://api.github.com/users/kpavlov00/followers","following_url":"https://api.github.com/users/kpavlov00/following{/other_user}","gists_url":"https://api.github.com/users/kpavlov00/gists{/gist_id}","starred_url":"https://api.github.com/users/kpavlov00/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kpavlov00/subscriptions","organizations_url":"https://api.github.com/users/kpavlov00/orgs","repos_url":"https://api.github.com/users/kpavlov00/repos","events_url":"https://api.github.com/users/kpavlov00/events{/privacy}","received_events_url":"https://api.github.com/users/kpavlov00/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":155504842,"node_id":"MDU6TGFiZWwxNTU1MDQ4NDI=","url":"https://api.github.com/repos/grpc/grpc/labels/kind/bug","name":"kind/bug","color":"93732c","default":false,"description":null},{"id":218696181,"node_id":"MDU6TGFiZWwyMTg2OTYxODE=","url":"https://api.github.com/repos/grpc/grpc/labels/lang/core","name":"lang/core","color":"fad8c7","default":false,"description":""},{"id":360790193,"node_id":"MDU6TGFiZWwzNjA3OTAxOTM=","url":"https://api.github.com/repos/grpc/grpc/labels/priority/P2","name":"priority/P2","color":"dd7172","default":false,"description":""},{"id":3940839694,"node_id":"LA_kwDOAacf2M7q5HEO","url":"https://api.github.com/repos/grpc/grpc/labels/untriaged","name":"untriaged","color":"c2e0c6","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"markdroth","id":18664614,"node_id":"MDQ6VXNlcjE4NjY0NjE0","avatar_url":"https://avatars.githubusercontent.com/u/18664614?v=4","gravatar_id":"","url":"https://api.github.com/users/markdroth","html_url":"https://github.com/markdroth","followers_url":"https://api.github.com/users/markdroth/followers","following_url":"https://api.github.com/users/markdroth/following{/other_user}","gists_url":"https://api.github.com/users/markdroth/gists{/gist_id}","starred_url":"https://api.github.com/users/markdroth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markdroth/subscriptions","organizations_url":"https://api.github.com/users/markdroth/orgs","repos_url":"https://api.github.com/users/markdroth/repos","events_url":"https://api.github.com/users/markdroth/events{/privacy}","received_events_url":"https://api.github.com/users/markdroth/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"markdroth","id":18664614,"node_id":"MDQ6VXNlcjE4NjY0NjE0","avatar_url":"https://avatars.githubusercontent.com/u/18664614?v=4","gravatar_id":"","url":"https://api.github.com/users/markdroth","html_url":"https://github.com/markdroth","followers_url":"https://api.github.com/users/markdroth/followers","following_url":"https://api.github.com/users/markdroth/following{/other_user}","gists_url":"https://api.github.com/users/markdroth/gists{/gist_id}","starred_url":"https://api.github.com/users/markdroth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/markdroth/subscriptions","organizations_url":"https://api.github.com/users/markdroth/orgs","repos_url":"https://api.github.com/users/markdroth/repos","events_url":"https://api.github.com/users/markdroth/events{/privacy}","received_events_url":"https://api.github.com/users/markdroth/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2025-03-04T12:29:44Z","updated_at":"2025-03-04T18:06:12Z","closed_at":"2025-03-04T18:06:12Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What version of gRPC and what language are you using?\nC++ 1.54.3\n\n### What operating system (Linux, Windows,...) and version?\nUbuntu 22.04\n\n### What runtime / compiler are you using (e.g. python version or version of gcc)\nclang 18\n\n### What did you do?\n\nIn our project we want to use the `MethodConfig['retryPolicy'][‘perAttemptRecvTimeout’]` parameter from `ServiceConfig`.\nIt fits our requirements well.\n\nOur result `retryPolicy` looks like:\n```json\n    \"retryPolicy\": {\n      \"maxAttempts\": 4,\n      \"initialBackoff\": \"0.001s\",\n      \"maxBackoff\": \"0.01s\",\n      \"backoffMultiplier\": 1.0,\n      \"perAttemptRecvTimeout\": \"0.02s\",                               // <<< problem place\n      \"retryableStatusCodes\": [\"UNAVAILABLE\"]\n    }\n```\n\n\n### What did you expect to see?\n\nWe want `perAttemptRecvTimeout` param to work as expected.\nWe want to start new attempt in `perAttemptRecvTimeout` if no successful result has been received.\n\n\n### What did you see instead?\n\nPeriodically we get crashes with backtrace:\n```\ngrpc_core::ClientChannel::LoadBalancedCall::call_attempt_tracer (this=0x0) grpc/src/core/ext/filters/client_channel/client_channel.h +394\ngrpc_core::ClientChannel::FilterBasedLoadBalancedCall::StartTransportStreamOpBatch (this=0x0, batch=0x7f59e4d8b298) grpc/src/core/ext/filters/client_channel/client_channel.cc +2925\nexec_ctx_run (closure=0x7f59e4d8b2b8) grpc/src/core/lib/iomgr/exec_ctx.cc +45\ngrpc_core::ExecCtx::Flush (this=0x7f5a993337d0) grpc/src/core/lib/iomgr/exec_ctx.cc +72\nend_worker (pollset=0x7f5aa9679680, worker=0x7f5a993332d0, worker_hdl=<optimized out>) grpc/src/core/lib/iomgr/ev_epoll1_linux.cc +981\npollset_work (ps=0x7f5aa9679680, worker_hdl=<optimized out>, deadline=...) grpc/src/core/lib/iomgr/ev_epoll1_linux.cc +1049\npollset_work (pollset=0x7f59e4d8b298, worker=0x7f5a99333128, deadline=...) grpc/src/core/lib/iomgr/ev_posix.cc +249\ngrpc_pollset_work (pollset=0x7f59e4d8b298, worker=0x7f5a99333128, deadline=...) grpc/src/core/lib/iomgr/pollset.cc +48\ncq_next (cq=0x7f5aa96795c0, deadline=..., reserved=<optimized out>) grpc/src/core/lib/surface/completion_queue.cc +1036\ngrpc::CompletionQueue::AsyncNextInternal (this=0x7f5aa9601b00, tag=0x7f5a993338e0, ok=0x7f5a993338df, deadline=...) grpc/src/cpp/common/completion_queue_cc.cc +166\ngrpc::CompletionQueue::Next (this=0x7f5aa9601b00, tag=0x7f5a993338e0, ok=0x7f5a993338df) grpc/include/grpcpp/completion_queue.h +182\n```\n\n\nWe wrote small unit test for reproducing the bug on master:\nhttps://github.com/kpavlov00/grpc/pull/1/files\n\n\nAnd our possible fix:\n#38907 \n\n\n### Anything else we should know about your project / environment?\nnone","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/grpc/grpc/issues/38908/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grpc/grpc/issues/38908/timeline","performed_via_github_app":null,"state_reason":"completed"}