{"url":"https://api.github.com/repos/grpc/grpc/issues/40368","repository_url":"https://api.github.com/repos/grpc/grpc","labels_url":"https://api.github.com/repos/grpc/grpc/issues/40368/labels{/name}","comments_url":"https://api.github.com/repos/grpc/grpc/issues/40368/comments","events_url":"https://api.github.com/repos/grpc/grpc/issues/40368/events","html_url":"https://github.com/grpc/grpc/issues/40368","id":3279335145,"node_id":"I_kwDOAacf2M7Ddq7p","number":40368,"title":"Ruby segfault at 1.74.0","user":{"login":"ka2n","id":427686,"node_id":"MDQ6VXNlcjQyNzY4Ng==","avatar_url":"https://avatars.githubusercontent.com/u/427686?v=4","gravatar_id":"","url":"https://api.github.com/users/ka2n","html_url":"https://github.com/ka2n","followers_url":"https://api.github.com/users/ka2n/followers","following_url":"https://api.github.com/users/ka2n/following{/other_user}","gists_url":"https://api.github.com/users/ka2n/gists{/gist_id}","starred_url":"https://api.github.com/users/ka2n/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ka2n/subscriptions","organizations_url":"https://api.github.com/users/ka2n/orgs","repos_url":"https://api.github.com/users/ka2n/repos","events_url":"https://api.github.com/users/ka2n/events{/privacy}","received_events_url":"https://api.github.com/users/ka2n/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":155504842,"node_id":"MDU6TGFiZWwxNTU1MDQ4NDI=","url":"https://api.github.com/repos/grpc/grpc/labels/kind/bug","name":"kind/bug","color":"93732c","default":false,"description":null},{"id":166332946,"node_id":"MDU6TGFiZWwxNjYzMzI5NDY=","url":"https://api.github.com/repos/grpc/grpc/labels/lang/ruby","name":"lang/ruby","color":"fad8c7","default":false,"description":null},{"id":360790193,"node_id":"MDU6TGFiZWwzNjA3OTAxOTM=","url":"https://api.github.com/repos/grpc/grpc/labels/priority/P2","name":"priority/P2","color":"dd7172","default":false,"description":""}],"state":"open","locked":false,"assignee":{"login":"apolcyn","id":9566254,"node_id":"MDQ6VXNlcjk1NjYyNTQ=","avatar_url":"https://avatars.githubusercontent.com/u/9566254?v=4","gravatar_id":"","url":"https://api.github.com/users/apolcyn","html_url":"https://github.com/apolcyn","followers_url":"https://api.github.com/users/apolcyn/followers","following_url":"https://api.github.com/users/apolcyn/following{/other_user}","gists_url":"https://api.github.com/users/apolcyn/gists{/gist_id}","starred_url":"https://api.github.com/users/apolcyn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apolcyn/subscriptions","organizations_url":"https://api.github.com/users/apolcyn/orgs","repos_url":"https://api.github.com/users/apolcyn/repos","events_url":"https://api.github.com/users/apolcyn/events{/privacy}","received_events_url":"https://api.github.com/users/apolcyn/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"apolcyn","id":9566254,"node_id":"MDQ6VXNlcjk1NjYyNTQ=","avatar_url":"https://avatars.githubusercontent.com/u/9566254?v=4","gravatar_id":"","url":"https://api.github.com/users/apolcyn","html_url":"https://github.com/apolcyn","followers_url":"https://api.github.com/users/apolcyn/followers","following_url":"https://api.github.com/users/apolcyn/following{/other_user}","gists_url":"https://api.github.com/users/apolcyn/gists{/gist_id}","starred_url":"https://api.github.com/users/apolcyn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/apolcyn/subscriptions","organizations_url":"https://api.github.com/users/apolcyn/orgs","repos_url":"https://api.github.com/users/apolcyn/repos","events_url":"https://api.github.com/users/apolcyn/events{/privacy}","received_events_url":"https://api.github.com/users/apolcyn/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":6,"created_at":"2025-07-31T06:54:03Z","updated_at":"2025-08-08T01:45:24Z","closed_at":null,"author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### What version of gRPC and what language are you using?\n\ngrpc-ruby 1.74.0\n\n### What operating system (Linux, Windows,...) and version?\n\nLinux (running on Google Cloud Run with ruby:3.4.4-slim-bookworm base image)\n\n### What runtime / compiler are you using (e.g. python version or version of gcc)\n\nRuby 3.4.4\n\n### What did you do?\n\nExecuted Google Cloud Tasks client task creation operation using the `google-cloud-tasks` gem (version 3.0.2) in a Ruby application running on Google Cloud Run.\n\n### What did you expect to see?\n\nNormal communication with Google Cloud API and successful task creation.\n\n### What did you see instead?\n\nApplication crashes with a segmentation fault. The crash occurs almost always but not 100% of the time.\n\n**Stack trace:**\n```\n[BUG] Segmentation fault at 0x0000000000000001\nruby 3.4.4 (2025-05-14 revision a38531fd3f) +YJIT +PRISM [x86_64-linux]\n-- Control frame information -----------------------------------------------\nc:0001 p:---- s:0003 e:000002 DUMMY  [FINISH]\n-- Threading information ---------------------------------------------------\nTotal ractor count: 1\nRuby thread count for this ractor: 22\n-- Machine register context ------------------------------------------------\n RIP: 0x00003e04016cb7b3 RBP: 0x0000000000000000 RSP: 0x00003e03d91fe698\n RAX: 0x0000000000000d21 RBX: 0x00003e03e5b82168 RCX: 0x00003e03d91fe7f0\n RDX: 0x00003e03d91fe6c0 RDI: 0x0000000000000001 RSI: 0x0000000000000d21\n  R8: 0x0000000000000000  R9: 0x00003e03d91fe6c0 R10: 0x0000000000000000\n R11: 0x0000000000000246 R12: 0x00003e03e5b82168 R13: 0x00003e03e5b82168\n R14: 0x0000000000000d21 R15: 0x00003e03d91fe6c0 EFL: 0x0000000000010202\n-- C level backtrace information -------------------------------------------\n/usr/local/lib/libruby.so.3.4(rb_print_backtrace+0x8) [0x3e040174725a] /usr/src/ruby/vm_dump.c:823\n/usr/local/lib/libruby.so.3.4(rb_vm_bugreport) /usr/src/ruby/vm_dump.c:1155\n/usr/local/lib/libruby.so.3.4(rb_bug_for_fatal_signal+0x100) [0x3e040152d680] /usr/src/ruby/error.c:1130\n/usr/local/lib/libruby.so.3.4(sigsegv+0x42) [0x3e040168a4c2] /usr/src/ruby/signal.c:933\n/lib/x86_64-linux-gnu/libc.so.6(0x3e040109f050) [0x3e040109f050]\n/usr/local/lib/libruby.so.3.4(hash_table_index+0x0) [0x3e04016cb7b3] /usr/src/ruby/symbol.h:72\n/usr/local/lib/libruby.so.3.4(rb_id_table_lookup) /usr/src/ruby/id_table.c:230\n/usr/local/lib/libruby.so.3.4(lookup_method_table+0xf) [0x3e040171a7fb] /usr/src/ruby/vm_method.c:910\n/usr/local/lib/libruby.so.3.4(search_method0) /usr/src/ruby/vm_method.c:1324\n/usr/local/lib/libruby.so.3.4(search_method) /usr/src/ruby/vm_method.c:1343\n/usr/local/lib/libruby.so.3.4(callable_method_entry_or_negative) /usr/src/ruby/vm_method.c:1504\n/usr/local/lib/libruby.so.3.4(callable_method_entry+0xd) [0x3e040171b1cf] /usr/src/ruby/vm_method.c:1534\n/usr/local/lib/libruby.so.3.4(rb_callable_method_entry) /usr/src/ruby/vm_method.c:1541\n/usr/local/lib/libruby.so.3.4(vm_search_cc) /usr/src/ruby/vm_insnhelper.c:2140\n/usr/local/lib/libruby.so.3.4(rb_vm_search_method_slowpath) /usr/src/ruby/vm_insnhelper.c:2189\n/usr/local/lib/libruby.so.3.4(vm_search_method_slowpath0+0x5) [0x3e040171b509] /usr/src/ruby/vm_insnhelper.c:2210\n/usr/local/lib/libruby.so.3.4(gccct_method_search_slowpath) /usr/src/ruby/vm_eval.c:418\n/usr/local/lib/libruby.so.3.4(gccct_method_search+0x6f) [0x3e040173915f] /usr/src/ruby/vm_eval.c:483\n/usr/local/lib/libruby.so.3.4(rb_funcallv_scope) /usr/src/ruby/vm_eval.c:1041\n/usr/local/lib/libruby.so.3.4(rb_funcallv) /usr/src/ruby/vm_eval.c:1062\n/app/vendor/bundle/ruby/3.4.0/gems/grpc-1.74.0-x86_64-linux-gnu/src/ruby/lib/grpc/3.4/grpc_c.so(0x3e03e291e513) [0x3e03e291e513]\n/usr/local/lib/libruby.so.3.4(rb_vrescue2+0x10b) [0x3e0401538e7b] /usr/src/ruby/eval.c:990\n/usr/local/lib/libruby.so.3.4(rb_rescue2+0x8a) [0x3e04015390ea] /usr/src/ruby/eval.c:971\n/app/vendor/bundle/ruby/3.4.0/gems/grpc-1.74.0-x86_64-linux-gnu/src/ruby/lib/grpc/3.4/grpc_c.so(0x3e03e291e1b1) [0x3e03e291e1b1]\n/app/vendor/bundle/ruby/3.4.0/gems/grpc-1.74.0-x86_64-linux-gnu/src/ruby/lib/grpc/3.4/grpc_c.so(0x3e03e2920f41) [0x3e03e2920f41]\n/usr/local/lib/libruby.so.3.4(thread_do_start+0x78) [0x3e04016d966f] /usr/src/ruby/thread.c:636\n/usr/local/lib/libruby.so.3.4(thread_start_func_2) /usr/src/ruby/thread.c:682\n/usr/local/lib/libruby.so.3.4(nt_start+0x12b) [0x3e04016da68b] /usr/src/ruby/thread_pthread.c:2176\n/lib/x86_64-linux-gnu/libc.so.6(0x3e04010ec1f5) [0x3e04010ec1f5]\n/lib/x86_64-linux-gnu/libc.so.6(0x3e040116c89c) [0x3e040116c89c]\n```\n\nThe segmentation fault appears to occur within the grpc_c.so native extension, specifically during method lookup operations.\n\n### Anything else we should know about your project / environment?\n\n- Running on Google Cloud Run with ruby:3.4.4-slim-bookworm base image\n- Using google-cloud-tasks gem version 3.0.2\n- The crash occurs almost always but not 100% of the time (intermittent issue)\n- Ruby thread count shows 22 threads at crash time\n- The fault occurs at memory address 0x0000000000000001, suggesting a null pointer dereference\n- Stack trace indicates the crash happens during Ruby method resolution within the gRPC C extension","closed_by":null,"reactions":{"url":"https://api.github.com/repos/grpc/grpc/issues/40368/reactions","total_count":9,"+1":9,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/grpc/grpc/issues/40368/timeline","performed_via_github_app":null,"state_reason":null}