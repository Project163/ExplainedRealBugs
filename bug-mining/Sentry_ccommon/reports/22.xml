<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:34:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SENTRY-2109] Fix the logic of identifying HMS out of Sync and handle gaps and out-of-sequence notifications.</title>
                <link>https://issues.apache.org/jira/browse/SENTRY-2109</link>
                <project id="12314720" key="SENTRY">Sentry (Retired)</project>
                    <description>&lt;p&gt;Currently HMSFollower proactively checks if sentry is out of sync with HMS and initiates full snapshot, if needed.&lt;/p&gt;

&lt;p&gt;There will be false positives with the current logic if there are gaps in the event-id in the notification log sequence.&lt;/p&gt;

&lt;p&gt;This jira is aimed at making that logic robust.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13126846">SENTRY-2109</key>
            <summary>Fix the logic of identifying HMS out of Sync and handle gaps and out-of-sequence notifications.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="10002" iconUrl="https://issues.apache.org/jira/images/icons/statuses/document.png" description="A patch for this issue has been uploaded to JIRA by a contributor.">Patch Available</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="kkalyan">Krishna Kalyan</assignee>
                                    <reporter username="kkalyan">Krishna Kalyan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Dec 2017 16:53:38 +0000</created>
                <updated>Thu, 13 Sep 2018 16:50:35 +0000</updated>
                                            <version>2.1.0</version>
                                                    <component>Sentry</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="16301652" author="kkalyan" created="Fri, 22 Dec 2017 16:58:26 +0000"  >&lt;p&gt;With this below logic HMSFollower excepts that event-id for the first notification that is fetched should be greater than the last notification processed by 1. This may not be the case.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  public boolean areNotificationsOutOfSync(Collection&amp;lt;NotificationEvent&amp;gt; events,
      long latestProcessedId) {
    if (events.isEmpty()) {
      return false;
    }

    /*
     * If the sequence of notifications has a gap, then an out-of-sync might
     * have happened due to the following issue:
     *
     * - HDFS sync was disabled or Sentry was shutdown for a time period longer than
     * the HMS notification clean-up thread causing old notifications to be deleted.
     *
     * HMS notifications may contain both gaps in the sequence and duplicates
     * (the same ID repeated more then once for different events).
     *
     * To accept duplicates (see NotificationFetcher for more info), then a gap is found
     * if the 1st notification received is higher than the current ID processed + 1.
     * i.e.
     *   1st ID = 3, latest ID = 3 (duplicate found but no gap detected)
     *   1st ID = 4, latest ID = 3 (consecutive ID found but no gap detected)
     *   1st ID = 5, latest ID = 3 (a gap is detected)
     */

    List&amp;lt;NotificationEvent&amp;gt; eventList = (List&amp;lt;NotificationEvent&amp;gt;) events;
    long firstNotificationId = eventList.get(0).getEventId();

    if (firstNotificationId &amp;gt; (latestProcessedId + 1)) {
      LOGGER.info(&quot;Current HMS notifications are out-of-sync with latest Sentry processed&quot;
          + &quot;notifications. Need to request a full HMS snapshot.&quot;);
      return true;
    }

    return false;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have attached the snapshot for notification_log table for reference.&lt;/p&gt;</comment>
                            <comment id="16301666" author="kkalyan" created="Fri, 22 Dec 2017 17:05:29 +0000"  >&lt;p&gt;Working on a patch to avoid the assumption mentioned above.&lt;/p&gt;

&lt;p&gt;New logic would make sure that the last notification processed by sentry is still in HMS_NOTIFICATION_LOG table to make sure that sentry is still in sync with HMS.&lt;/p&gt;</comment>
                            <comment id="16301723" author="vspector@gmail.com" created="Fri, 22 Dec 2017 17:43:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkalyan&quot; class=&quot;user-hover&quot; rel=&quot;kkalyan&quot;&gt;kkalyan&lt;/a&gt;, please, also include detection and logging of non-sequential event IDs in the reply, in HMSFollower.processNotification(). It is important to see if there are gaps within a single fetch.&lt;/p&gt;</comment>
                            <comment id="16301807" author="kkalyan" created="Fri, 22 Dec 2017 18:53:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vspector%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;vspector@gmail.com&quot;&gt;vspector@gmail.com&lt;/a&gt; Sure, I will add logging for that as well.&lt;/p&gt;</comment>
                            <comment id="16302476" author="kkalyan" created="Sat, 23 Dec 2017 15:00:22 +0000"  >&lt;p&gt;I have attached a patch to fix the issue and also added e2e tests around snapshot creation but there is still some work pending.&lt;br/&gt;
This new change is causing unit test failures as they are using mocking to test specific class. There is effort involved in fixing those tests. This patch comments them out for now.&lt;/p&gt;
</comment>
                            <comment id="16302609" author="vspector@gmail.com" created="Sat, 23 Dec 2017 23:04:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkalyan&quot; class=&quot;user-hover&quot; rel=&quot;kkalyan&quot;&gt;kkalyan&lt;/a&gt;, could you, please, explain how this patch is going to relate to &lt;a href=&quot;https://issues.apache.org/jira/browse/SENTRY-2106&quot; title=&quot;If Sentry is ahead do not trigger a full snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SENTRY-2106&quot;&gt;&lt;del&gt;SENTRY-2106&lt;/del&gt;&lt;/a&gt;, since they are trying to address the same issue. This way it will be easier to do code review.&lt;/p&gt;

&lt;p&gt;In my opinion, it would be easier - and safer - to commit &lt;a href=&quot;https://issues.apache.org/jira/browse/SENTRY-2106&quot; title=&quot;If Sentry is ahead do not trigger a full snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SENTRY-2106&quot;&gt;&lt;del&gt;SENTRY-2106&lt;/del&gt;&lt;/a&gt; first, so you&apos;d provide your code review on top of it. &lt;a href=&quot;https://issues.apache.org/jira/browse/SENTRY-2106&quot; title=&quot;If Sentry is ahead do not trigger a full snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SENTRY-2106&quot;&gt;&lt;del&gt;SENTRY-2106&lt;/del&gt;&lt;/a&gt; seems to be pretty straightforward (once some concerns have been addressed), focusing on one specific condition and one specific way of avoiding full update. If you provide your patch on top of it, it would be easier to review it. Otherwise, since both patches have overlap in the code (trying to fix exactly the same method for exactly the same purpose), it may be confusing to analyze this patch on its own while thinking how the two patches will interact after the merge.&lt;/p&gt;</comment>
                            <comment id="16305618" author="kkalyan" created="Thu, 28 Dec 2017 17:45:18 +0000"  >&lt;p&gt;&lt;b&gt;Here is the assumption that HMSFollower is currently taking.&lt;/b&gt;&lt;br/&gt;
First event in list of notifications received from HMS greater than latest sentry HMS notification Id.&lt;br/&gt;
&lt;b&gt;This is not true&lt;/b&gt; Event_ID in the NOTIFICATION_LOG table are not always ascending. Order of sequence is not guaranteed.&lt;br/&gt;
There can be gaps in between Event_ID&apos;s in the consecutive entries.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vspector&quot; class=&quot;user-hover&quot; rel=&quot;vspector&quot;&gt;vspector&lt;/a&gt; I agree with you. Thus patch should be looked together with the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/SENTRY-2106&quot; title=&quot;If Sentry is ahead do not trigger a full snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SENTRY-2106&quot;&gt;&lt;del&gt;SENTRY-2106&lt;/del&gt;&lt;/a&gt;. I have created this patch to perform some tests locally using the patches for &lt;a href=&quot;https://issues.apache.org/jira/browse/SENTRY-2106&quot; title=&quot;If Sentry is ahead do not trigger a full snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SENTRY-2106&quot;&gt;&lt;del&gt;SENTRY-2106&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/SENTRY-2109&quot; title=&quot;Fix the logic of identifying HMS out of Sync and handle gaps and out-of-sequence notifications.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SENTRY-2109&quot;&gt;SENTRY-2109&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;What does being Sentry being out of sync with HMS mean?&lt;/b&gt;&lt;br/&gt;
Sentry can not be up-to-date with HMS just by fetching new notifications and processing them. Sentry has to start from scratch and create a full snapshot.&lt;/p&gt;

&lt;p&gt;This patch does the following&lt;br/&gt;
Note: latestSentryNotificationId is the MAX of all the event-id&apos;s that sentry processed.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;While requesting updates HMSFollower would request notification from (latestSentryNotificationId -1)&lt;/li&gt;
	&lt;li&gt;Normally when Sentry and HMS are in Sync, filter provided should also process the notification with latestSentryNotificationId.&lt;/li&gt;
	&lt;li&gt;When Sentry and HMS are out of Sync where HMS will not have the notification event that was processed by sentry which is the notification event with event-id latestSentryNotificationId. This indicates that there are notifications missing.&lt;br/&gt;
&lt;b&gt;Note:&lt;/b&gt; This is an extension to current logic of identifying and processing notifications with same event-id&apos;s.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16305781" author="hadoopqa" created="Thu, 28 Dec 2017 22:20:39 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12903947/SENTRY-2109.003.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12903947/SENTRY-2109.003.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall:&lt;/font&gt; -1 due to an error&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; failed to apply patch (exit code 1):&lt;br/&gt;
The patch does not appear to apply with p0, p1, or p2&lt;/p&gt;



&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3595/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3595/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16305899" author="hadoopqa" created="Fri, 29 Dec 2017 02:02:59 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12903950/SENTRY-2109.003.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12903950/SENTRY-2109.003.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall:&lt;/font&gt; -1 due to 6 errors&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; mvn test exited 1&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.tests.e2e.dbprovider.TestSnapshotWithLongerHMSFollowerLongerInterval&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegrationWithHA&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegrationWithHA&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegrationWithHA&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegrationEnd2End&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3596/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3596/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16308834" author="linaataustin" created="Tue, 2 Jan 2018 22:47:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkalyan&quot; class=&quot;user-hover&quot; rel=&quot;kkalyan&quot;&gt;kkalyan&lt;/a&gt; Sentry service periodically calls purgeNotificationIdTable. Have you take this into account in your update?&lt;/p&gt;

&lt;p&gt;Since there is a gap and the Notification ID could decrease, the logic for getting notification events should be updated to too to make sure sentry gets all notifications. Otherwise, sentry may miss some notifications and will be inconsistent with HMS updates.&lt;/p&gt;</comment>
                            <comment id="16311782" author="kkalyan" created="Thu, 4 Jan 2018 18:14:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lina.li&quot; class=&quot;user-hover&quot; rel=&quot;lina.li&quot;&gt;lina.li&lt;/a&gt; Purging is not an issue as we don&apos;t purge all the notifications. we keep latest ~100 entries while purging the table.&lt;/p&gt;

&lt;p&gt;This patch addresses the scenario where Snapshot is triggered when there are gaps in between. Yes, there could be some notifications that could be missed. This will not be addressed with the patch.&lt;/p&gt;</comment>
                            <comment id="16311884" author="linaataustin" created="Thu, 4 Jan 2018 19:17:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkalyan&quot; class=&quot;user-hover&quot; rel=&quot;kkalyan&quot;&gt;kkalyan&lt;/a&gt; the purging uses ID - 100. It does not guarantee that we have 100 entries in the Notification ID table. If there is a gap as big as 100, we may only have 1 entry in the table.&lt;/p&gt;</comment>
                            <comment id="16311974" author="kkalyan" created="Thu, 4 Jan 2018 20:24:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lina.li&quot; class=&quot;user-hover&quot; rel=&quot;lina.li&quot;&gt;lina.li&lt;/a&gt; we can increase that number now we know that gaps are possible in event-id&apos;s&lt;/p&gt;</comment>
                            <comment id="16312042" author="hadoopqa" created="Thu, 4 Jan 2018 21:16:10 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12904660/SENTRY-2109.004.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12904660/SENTRY-2109.004.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall:&lt;/font&gt; -1 due to 5 errors&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; mvn test exited 1&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegrationWithHA&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegrationWithHA&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegrationAdvanced&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegrationEnd2End&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3606/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3606/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16312048" author="kkalyan" created="Thu, 4 Jan 2018 21:18:40 +0000"  >&lt;p&gt;We need code change done for &lt;a href=&quot;https://issues.apache.org/jira/browse/SENTRY-2113&quot; title=&quot;MSentryHmsNotification should also hold  the notification hash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SENTRY-2113&quot;&gt;SENTRY-2113&lt;/a&gt; to fix these test failures.&lt;/p&gt;</comment>
                            <comment id="16312386" author="hadoopqa" created="Fri, 5 Jan 2018 02:27:38 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12904704/SENTRY-2109.005.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12904704/SENTRY-2109.005.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall:&lt;/font&gt; -1 due to 5 errors&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; mvn test exited 1&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegrationWithHA&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegrationWithHA&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegrationWithHA&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.tests.e2e.hdfs.TestHDFSIntegrationEnd2End&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3608/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3608/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16329739" author="hadoopqa" created="Thu, 18 Jan 2018 00:18:07 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12906493/SENTRY-2109.006.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12906493/SENTRY-2109.006.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall:&lt;/font&gt; +1 all checks pass&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; all tests passed&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3623/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3623/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16329881" author="hadoopqa" created="Thu, 18 Jan 2018 01:58:35 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12906511/SENTRY-2109.007.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12906511/SENTRY-2109.007.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall:&lt;/font&gt; +1 all checks pass&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; all tests passed&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3624/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3624/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16334606" author="hadoopqa" created="Mon, 22 Jan 2018 17:40:39 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12907155/SENTRY-2109.008.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12907155/SENTRY-2109.008.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall:&lt;/font&gt; -1 due to an error&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; failed to apply patch (exit code 1):&lt;br/&gt;
The patch does not appear to apply with p0, p1, or p2&lt;/p&gt;



&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3635/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3635/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16334630" author="hadoopqa" created="Mon, 22 Jan 2018 17:51:59 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12907158/SENTRY-2109.008.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12907158/SENTRY-2109.008.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall:&lt;/font&gt; -1 due to an error&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; failed to build with patch (exit code 1)&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3636/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3636/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16338103" author="akolb" created="Wed, 24 Jan 2018 19:33:51 +0000"  >&lt;p&gt;Can&apos;t build the latest patch.&lt;/p&gt;</comment>
                            <comment id="16338109" author="akolb" created="Wed, 24 Jan 2018 19:36:39 +0000"  >&lt;p&gt;Note that the original problem (HMS notifications duplicates and other weirdness) is fixed in Hive upstream. So this is a work-around for a problem that is already fixed on the HMS side.&lt;/p&gt;</comment>
                            <comment id="16338121" author="kkalyan" created="Wed, 24 Jan 2018 19:42:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt; Could you link the Jira here.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Are you saying that sentry can assume that there will not be any duplicates and out-of-order notifications ?&lt;/p&gt;</comment>
                            <comment id="16338147" author="akolb" created="Wed, 24 Jan 2018 20:00:48 +0000"  >&lt;p&gt;Added a link. I am not quite right though - the fix is in Hive 3.0 but not in Hive 2 branch. It should be backported to Hive 2.&lt;/p&gt;</comment>
                            <comment id="16339232" author="hadoopqa" created="Thu, 25 Jan 2018 13:47:55 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12907686/SENTRY-2109.009.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12907686/SENTRY-2109.009.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall:&lt;/font&gt; -1 due to 2 errors&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; mvn test exited 1&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.service.thrift.TestHiveNotificationFetcher&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3642/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3642/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16339448" author="akolb" created="Thu, 25 Jan 2018 16:20:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-18526&quot; title=&quot;Backport HIVE-16886 to Hive 2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-18526&quot;&gt;&lt;del&gt;HIVE-18526&lt;/del&gt;&lt;/a&gt;&#160;provides a very simple fix on the Hive side. I think it is better to fix the root cause of the problem rather then create a complicated workaround.&lt;/p&gt;</comment>
                            <comment id="16339526" author="kkalyan" created="Thu, 25 Jan 2018 17:27:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt; I did not look closer into changes done for&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-16886&quot; title=&quot;HMS log notifications may have duplicated event IDs if multiple HMS are running concurrently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-16886&quot;&gt;&lt;del&gt;HIVE-16886&lt;/del&gt;&lt;/a&gt;&#160;but from the title it just handles duplicate event-id&apos;s.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;We still have issue with gaps in event-id&apos;s which this addressed.&lt;/p&gt;</comment>
                            <comment id="16339528" author="akolb" created="Thu, 25 Jan 2018 17:31:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkalyan&quot; class=&quot;user-hover&quot; rel=&quot;kkalyan&quot;&gt;kkalyan&lt;/a&gt; ignore the title, it takes care of gaps as well.&lt;/p&gt;

&lt;p&gt;The fix strictly serializes all updates to notifications using row lock on the notification ID row, so it essentially works as a distributed lock. As a result, all artifacts related to concurrent modifications disappear.&lt;/p&gt;</comment>
                            <comment id="16339555" author="hadoopqa" created="Thu, 25 Jan 2018 17:54:13 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12907716/SENTRY-2109.010.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12907716/SENTRY-2109.010.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall:&lt;/font&gt; +1 all checks pass&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; all tests passed&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3643/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3643/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16339656" author="hadoopqa" created="Thu, 25 Jan 2018 19:08:45 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12907736/SENTRY-2109.010.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12907736/SENTRY-2109.010.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall:&lt;/font&gt; +1 all checks pass&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; all tests passed&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3644/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3644/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16343670" author="hadoopqa" created="Mon, 29 Jan 2018 17:24:17 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12908154/SENTRY-2109.011.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12908154/SENTRY-2109.011.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall:&lt;/font&gt; -1 due to an error&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; mvn test exited 1&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3645/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3645/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16344074" author="hadoopqa" created="Mon, 29 Jan 2018 21:53:13 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12908183/SENTRY-2109.011.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12908183/SENTRY-2109.011.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall:&lt;/font&gt; -1 due to an error&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; mvn test exited 1&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3647/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3647/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16346157" author="hadoopqa" created="Wed, 31 Jan 2018 02:34:37 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12908461/SENTRY-2109.012.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12908461/SENTRY-2109.012.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall:&lt;/font&gt; -1 due to an error&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; mvn test exited 1&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3650/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3650/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16347245" author="hadoopqa" created="Wed, 31 Jan 2018 17:37:51 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12908585/SENTRY-2109.012.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12908585/SENTRY-2109.012.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall:&lt;/font&gt; +1 all checks pass&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; all tests passed&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3651/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3651/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16349502" author="akolb" created="Thu, 1 Feb 2018 23:36:25 +0000"  >&lt;p&gt;Why is it resolved so quickly? I was reviewing this as well and had some earlier comments, you didn&apos;t give me a chance to complete review.&lt;/p&gt;</comment>
                            <comment id="16349508" author="spena" created="Thu, 1 Feb 2018 23:40:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkalyan&quot; class=&quot;user-hover&quot; rel=&quot;kkalyan&quot;&gt;kkalyan&lt;/a&gt; Isn&apos;t this logic going to be on hold now that we know it will be fixed on the HMS side?&#160;&lt;/p&gt;</comment>
                            <comment id="16349519" author="kkalyan" created="Thu, 1 Feb 2018 23:47:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt; I did not know that you were reviewing the code change. I will re-open it for review. If you have comments I revert the change and re-submit it addressing your comments.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16349520" author="akolb" created="Thu, 1 Feb 2018 23:47:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkalyan&quot; class=&quot;user-hover&quot; rel=&quot;kkalyan&quot;&gt;kkalyan&lt;/a&gt; This is complicated patch that took 12 iterations to do - most of the patches didn&apos;t compile so it wasn&apos;t clear that there is a final patch available for review. Many previous patches didn&apos;t compile so I wasn&apos;t aware that you are ready for code review - and now it is committed.&lt;/p&gt;</comment>
                            <comment id="16349521" author="vspector@gmail.com" created="Thu, 1 Feb 2018 23:47:51 +0000"  >&lt;p&gt;I think it&apos;s useful&#160;to have as many reviews as possible, so if &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt; wants to review&#160;it may be worth to reopen it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=spena&quot; class=&quot;user-hover&quot; rel=&quot;spena&quot;&gt;spena&lt;/a&gt;, it is correct, for now this logic is going to be on hold, so there is no rush in committing it. Since it&apos;s almost complete (unless the remaining reviewers find something wrong), it can be a legitimate plan B, if HMS fix is found to have any serious&#160;issues.&lt;/p&gt;</comment>
                            <comment id="16349549" author="kkalyan" created="Fri, 2 Feb 2018 00:08:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt;, I have already re-opened the review. If you have comments, I will revert the change.&lt;/p&gt;</comment>
                            <comment id="16349562" author="akolb" created="Fri, 2 Feb 2018 00:17:00 +0000"  >&lt;p&gt;I asked the question multiple times in this JIRA and didn&apos;t get an answer -&lt;br/&gt;
what problem does this fix address once the issue is fixed on HMS side?&lt;br/&gt;
That&apos;s the basic question to answer before we dive into the implementation&lt;br/&gt;
details.&lt;/p&gt;

&lt;p&gt;On Thu, Feb 1, 2018 at 4:09 PM, kalyan kumar kalvagadda (JIRA) &amp;lt;&lt;/p&gt;
</comment>
                            <comment id="16350490" author="spena" created="Fri, 2 Feb 2018 15:11:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vspector%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;vspector@gmail.com&quot;&gt;vspector@gmail.com&lt;/a&gt; Thanks for the confirmation about keeping it on hold, but the patch was committed yesterday and there were still some concerns about it. Should we revert this patch to finish the tests and reviews with the HMS fix and see if that fixes the current problems? &amp;lt;-&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkalyan&quot; class=&quot;user-hover&quot; rel=&quot;kkalyan&quot;&gt;kkalyan&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16350862" author="kkalyan" created="Fri, 2 Feb 2018 19:44:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=akolb&quot; class=&quot;user-hover&quot; rel=&quot;akolb&quot;&gt;akolb&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is what the patch does functionally.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Make sure that additional snapshots are not taken because of GAPS in the event-id&apos;s&lt;/li&gt;
	&lt;li&gt;Make sure that notification are not missed even when there are GAPS and out-of-sequence notifications.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;br/&gt;
we know that issue of gaps and out-of-sequence in the events will be solved with Hive fix done for&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-18526&quot; title=&quot;Backport HIVE-16886 to Hive 2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-18526&quot;&gt;&lt;del&gt;HIVE-18526&lt;/del&gt;&lt;/a&gt;&#160;. Only justification to have this&#160;patch was to safe guard sentry and be able to handle cases where events are not received&#160;in proper order.&#160;It&apos;s reasonable not&#160;assuming that other&#160;components&#160;would behave correctly and have some functionality in place to handle the error scenarios.&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
I&#160;will revert the patch if you say so.&lt;/p&gt;</comment>
                            <comment id="16350906" author="akolb" created="Fri, 2 Feb 2018 20:20:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkalyan&quot; class=&quot;user-hover&quot; rel=&quot;kkalyan&quot;&gt;kkalyan&lt;/a&gt; I would appreciate if you revert the patch and we complete the discussion review and then you commit (or not commit) whatever comes out of it.&lt;/p&gt;

&lt;p&gt;This patch had many iterations. There were several reviewers who had comments about earlier versions of the patch and some reviewers posted unanswered comments in this Jira so it is pretty clear that the review wasn&apos;t complete even though you got one +1 from a committer.&#160;&lt;/p&gt;

&lt;p&gt;I think that the best course of action is to revert the patch and complete the review.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16351014" author="kkalyan" created="Fri, 2 Feb 2018 22:29:42 +0000"  >&lt;p&gt;I have reverted the patch.&lt;/p&gt;</comment>
                            <comment id="16390538" author="linaataustin" created="Thu, 8 Mar 2018 00:58:01 +0000"  >&lt;p&gt;The following scenario may have issue&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;1) sentry gets notification events: 1, 2, 3, 4, 6&lt;/p&gt;

&lt;p&gt;2) with your fix, sentry is getting events equal or after 1, now it gets 1, 2, 3 ,4 , 5, 6&lt;/p&gt;

&lt;p&gt;3) events 1, 2, 3, 4, 6 are processed already, and their hash is saved in table&#160;SENTRY_PATH_CHANGE. NOTIFICATION_HASH has to be unique due to &quot;CREATE UNIQUE INDEX `NOTIFICATION_HASH_INDEX` ON `SENTRY_PATH_CHANGE` (`NOTIFICATION_HASH`);&quot;&lt;/p&gt;

&lt;p&gt;4) When they are processed again and saved into DB, duplicate key exception will happen, and retry will happen. That will cause the thread for syncing HMS in retry instead of getting new notifications.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Can you add unit test case for getting multiple duplicate events, and see if the above issue exists? If so, we need to have code to check events already processed, if so, skip processing and saving them into DB. We have filter for the first duplicated event, but not for the multiple duplicated events.&lt;/p&gt;</comment>
                            <comment id="16391950" author="kkalyan" created="Thu, 8 Mar 2018 21:43:40 +0000"  >&lt;p&gt;Rebased the patch&lt;/p&gt;</comment>
                            <comment id="16391976" author="hadoopqa" created="Thu, 8 Mar 2018 22:06:53 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12913660/SENTRY-2109.013.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12913660/SENTRY-2109.013.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall:&lt;/font&gt; -1 due to 2 errors&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; mvn test exited 1&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.provider.db.service.persistent.TestHMSFollower&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3690/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3690/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16392469" author="hadoopqa" created="Fri, 9 Mar 2018 06:11:41 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12913714/SENTRY-2109.013.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12913714/SENTRY-2109.013.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall:&lt;/font&gt; +1 all checks pass&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; all tests passed&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3691/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3691/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16392789" author="hadoopqa" created="Fri, 9 Mar 2018 12:20:33 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12913741/SENTRY-2109-rebase-SENTRY-2106.014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12913741/SENTRY-2109-rebase-SENTRY-2106.014.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall:&lt;/font&gt; +1 all checks pass&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; all tests passed&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/3692/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/3692/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="16392803" author="kkalyan" created="Fri, 9 Mar 2018 12:27:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=LinaAtAustin&quot; class=&quot;user-hover&quot; rel=&quot;linaataustin&quot;&gt;LinaAtAustin&lt;/a&gt; Scenario you mentioned in your comment is already handled by the patch.&lt;/p&gt;</comment>
                            <comment id="16613765" author="hadoopqa" created="Thu, 13 Sep 2018 16:50:35 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12913741/SENTRY-2109-rebase-SENTRY-2106.014.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12913741/SENTRY-2109-rebase-SENTRY-2106.014.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall:&lt;/font&gt; -1 due to an error&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; failed to apply patch (exit code 1):&lt;br/&gt;
error: a/sentry-provider/sentry-provider-db/src/main/java/org/apache/sentry/provider/db/service/persistent/HMSFollower.java: does not exist in index&lt;br/&gt;
error: a/sentry-provider/sentry-provider-db/src/main/java/org/apache/sentry/provider/db/service/persistent/SentryStore.java: does not exist in index&lt;br/&gt;
error: a/sentry-provider/sentry-provider-db/src/main/java/org/apache/sentry/service/thrift/HiveNotificationFetcher.java: does not exist in index&lt;br/&gt;
error: a/sentry-provider/sentry-provider-db/src/main/java/org/apache/sentry/service/thrift/SentryService.java: does not exist in index&lt;br/&gt;
error: a/sentry-provider/sentry-provider-db/src/main/java/org/apache/sentry/service/thrift/ServiceConstants.java: does not exist in index&lt;br/&gt;
error: a/sentry-provider/sentry-provider-db/src/test/java/org/apache/sentry/provider/db/service/persistent/TestHMSFollower.java: does not exist in index&lt;br/&gt;
error: a/sentry-provider/sentry-provider-db/src/test/java/org/apache/sentry/provider/db/service/persistent/TestHMSFollowerSentryStoreIntegration.java: does not exist in index&lt;br/&gt;
error: a/sentry-provider/sentry-provider-db/src/test/java/org/apache/sentry/service/thrift/TestHiveNotificationFetcher.java: does not exist in index&lt;br/&gt;
error: a/sentry-tests/sentry-tests-hive/src/test/java/org/apache/sentry/tests/e2e/hdfs/TestHDFSIntegrationBase.java: does not exist in index&lt;br/&gt;
error: sentry-provider/sentry-provider-db/src/main/java/org/apache/sentry/provider/db/service/persistent/HMSFollower.java: does not exist in index&lt;br/&gt;
error: sentry-provider/sentry-provider-db/src/main/java/org/apache/sentry/provider/db/service/persistent/SentryStore.java: does not exist in index&lt;br/&gt;
error: sentry-provider/sentry-provider-db/src/main/java/org/apache/sentry/service/thrift/HiveNotificationFetcher.java: does not exist in index&lt;br/&gt;
error: sentry-provider/sentry-provider-db/src/main/java/org/apache/sentry/service/thrift/SentryService.java: does not exist in index&lt;br/&gt;
error: sentry-provider/sentry-provider-db/src/main/java/org/apache/sentry/service/thrift/ServiceConstants.java: does not exist in index&lt;br/&gt;
error: sentry-provider/sentry-provider-db/src/test/java/org/apache/sentry/provider/db/service/persistent/TestHMSFollower.java: does not exist in index&lt;br/&gt;
error: sentry-provider/sentry-provider-db/src/test/java/org/apache/sentry/provider/db/service/persistent/TestHMSFollowerSentryStoreIntegration.java: does not exist in index&lt;br/&gt;
error: sentry-provider/sentry-provider-db/src/test/java/org/apache/sentry/service/thrift/TestHiveNotificationFetcher.java: does not exist in index&lt;br/&gt;
error: patch failed: sentry-tests/sentry-tests-hive/src/test/java/org/apache/sentry/tests/e2e/hdfs/TestHDFSIntegrationBase.java:874&lt;br/&gt;
Falling back to three-way merge...&lt;br/&gt;
Applied patch to &apos;sentry-tests/sentry-tests-hive/src/test/java/org/apache/sentry/tests/e2e/hdfs/TestHDFSIntegrationBase.java&apos; with conflicts.&lt;br/&gt;
error: sentry-provider-db/src/main/java/org/apache/sentry/provider/db/service/persistent/HMSFollower.java: does not exist in index&lt;br/&gt;
error: sentry-provider-db/src/main/java/org/apache/sentry/provider/db/service/persistent/SentryStore.java: does not exist in index&lt;br/&gt;
error: sentry-provider-db/src/main/java/org/apache/sentry/service/thrift/HiveNotificationFetcher.java: does not exist in index&lt;br/&gt;
error: sentry-provider-db/src/main/java/org/apache/sentry/service/thrift/SentryService.java: does not exist in index&lt;br/&gt;
error: sentry-provider-db/src/main/java/org/apache/sentry/service/thrift/ServiceConstants.java: does not exist in index&lt;br/&gt;
error: sentry-provider-db/src/test/java/org/apache/sentry/provider/db/service/persistent/TestHMSFollower.java: does not exist in index&lt;br/&gt;
error: sentry-provider-db/src/test/java/org/apache/sentry/provider/db/service/persistent/TestHMSFollowerSentryStoreIntegration.java: does not exist in index&lt;br/&gt;
error: sentry-provider-db/src/test/java/org/apache/sentry/service/thrift/TestHiveNotificationFetcher.java: does not exist in index&lt;br/&gt;
error: sentry-tests-hive/src/test/java/org/apache/sentry/tests/e2e/hdfs/TestHDFSIntegrationBase.java: does not exist in index&lt;br/&gt;
The patch does not appear to apply with p0, p1, or p2&lt;/p&gt;



&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/4103/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/4103/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13129380">SENTRY-2119</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13133481">HIVE-18526</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13129380">SENTRY-2119</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13079310">HIVE-16886</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                            <outwardlinks description="requires">
                                        <issuelink>
            <issuekey id="13126340">SENTRY-2106</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="13128019">SENTRY-2113</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12913741" name="SENTRY-2109-rebase-SENTRY-2106.014.patch" size="83411" author="arjunmishra13" created="Fri, 9 Mar 2018 09:23:31 +0000"/>
                            <attachment id="12903532" name="SENTRY-2109.001.patch" size="28079" author="kkalyan" created="Sat, 23 Dec 2017 14:57:59 +0000"/>
                            <attachment id="12903946" name="SENTRY-2109.002.patch" size="29061" author="kkalyan" created="Thu, 28 Dec 2017 22:12:27 +0000"/>
                            <attachment id="12903950" name="SENTRY-2109.003.patch" size="29808" author="kkalyan" created="Thu, 28 Dec 2017 22:57:05 +0000"/>
                            <attachment id="12904660" name="SENTRY-2109.004.patch" size="37362" author="kkalyan" created="Thu, 4 Jan 2018 19:18:00 +0000"/>
                            <attachment id="12904704" name="SENTRY-2109.005.patch" size="56759" author="kkalyan" created="Fri, 5 Jan 2018 00:21:40 +0000"/>
                            <attachment id="12906493" name="SENTRY-2109.006.patch" size="80838" author="kkalyan" created="Wed, 17 Jan 2018 22:09:11 +0000"/>
                            <attachment id="12906511" name="SENTRY-2109.007.patch" size="81003" author="kkalyan" created="Wed, 17 Jan 2018 23:51:12 +0000"/>
                            <attachment id="12907158" name="SENTRY-2109.008.patch" size="84970" author="kkalyan" created="Mon, 22 Jan 2018 17:50:19 +0000"/>
                            <attachment id="12907686" name="SENTRY-2109.009.patch" size="86549" author="kkalyan" created="Thu, 25 Jan 2018 13:27:43 +0000"/>
                            <attachment id="12907736" name="SENTRY-2109.010.patch" size="87265" author="kkalyan" created="Thu, 25 Jan 2018 17:00:14 +0000"/>
                            <attachment id="12907716" name="SENTRY-2109.010.patch" size="87265" author="kkalyan" created="Thu, 25 Jan 2018 15:43:56 +0000"/>
                            <attachment id="12908183" name="SENTRY-2109.011.patch" size="97137" author="kkalyan" created="Mon, 29 Jan 2018 18:27:07 +0000"/>
                            <attachment id="12908585" name="SENTRY-2109.012.patch" size="99099" author="kkalyan" created="Wed, 31 Jan 2018 14:43:07 +0000"/>
                            <attachment id="12908461" name="SENTRY-2109.012.patch" size="98656" author="kkalyan" created="Wed, 31 Jan 2018 00:34:23 +0000"/>
                            <attachment id="12908240" name="SENTRY-2109.012.patch" size="98656" author="kkalyan" created="Tue, 30 Jan 2018 01:06:37 +0000"/>
                            <attachment id="12913714" name="SENTRY-2109.013.patch" size="82346" author="kkalyan" created="Fri, 9 Mar 2018 04:12:59 +0000"/>
                            <attachment id="12903433" name="Screenshot_HMS_NOTIFICATION_LOG.png" size="1391902" author="kkalyan" created="Fri, 22 Dec 2017 16:58:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 9 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3o873:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>