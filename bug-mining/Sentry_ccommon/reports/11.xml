<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:34:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[SENTRY-1546] Generic Policy provides bad error messages for Sentry exceptions</title>
                <link>https://issues.apache.org/jira/browse/SENTRY-1546</link>
                <project id="12314720" key="SENTRY">Sentry (Retired)</project>
                    <description>&lt;p&gt;I discovered that when you attempt to create a role that already exists the error message you get back from Thrift i just &apos;Role: foo&apos; which is very confusing.&lt;/p&gt;

&lt;p&gt;The reason is that the SentryStore throws &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SentryAlreadyExistsException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Role: &quot;&lt;/span&gt; + trimmedRoleName);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and the generic policy processor passes the message as is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; TCreateSentryRoleResponse create_sentry_role(
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TCreateSentryRoleRequest request) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; TException {
    Response&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;&amp;gt; respose = requestHandle(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RequestHandler&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;&amp;gt;() {
      @Override
      &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Response&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;&amp;gt; handle() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        validateClientVersion(request.getProtocol_version());
        authorize(request.getRequestorUserName(),
            getRequestorGroups(conf, request.getRequestorUserName()));
        store.createRole(request.getComponent(), request.getRoleName(),
                request.getRequestorUserName());
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Response&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;&amp;gt;(Status.OK());
      }
    });
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The similar thing is happening for other requests and other Sentry-specific exceptions.&lt;/p&gt;

&lt;p&gt;The legacy policy processor does decorate the error a bit:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; TCreateSentryRoleResponse create_sentry_role(
    TCreateSentryRoleRequest request) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; TException {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Timer.Context timerContext = sentryMetrics.createRoleTimer.time();
    TCreateSentryRoleResponse response = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TCreateSentryRoleResponse();
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      validateClientVersion(request.getProtocol_version());
      authorize(request.getRequestorUserName(),
          getRequestorGroups(request.getRequestorUserName()));
      sentryStore.createSentryRole(request.getRoleName());
      response.setStatus(Status.OK());
      notificationHandlerInvoker.create_sentry_role(request, response);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SentryAlreadyExistsException e) {
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg = &lt;span class=&quot;code-quote&quot;&gt;&quot;Role: &quot;&lt;/span&gt; + request + &lt;span class=&quot;code-quote&quot;&gt;&quot; already exists.&quot;&lt;/span&gt;;
      LOGGER.error(msg, e);
      response.setStatus(Status.AlreadyExists(msg, e));
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SentryAccessDeniedException e) {
      LOGGER.error(e.getMessage(), e);
      response.setStatus(Status.AccessDenied(e.getMessage(), e));
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (SentryThriftAPIMismatchException e) {
      LOGGER.error(e.getMessage(), e);
      response.setStatus(Status.THRIFT_VERSION_MISMATCH(e.getMessage(), e));
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg = &lt;span class=&quot;code-quote&quot;&gt;&quot;Unknown error &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; request: &quot;&lt;/span&gt; + request + &lt;span class=&quot;code-quote&quot;&gt;&quot;, message: &quot;&lt;/span&gt; + e.getMessage();
      LOGGER.error(msg, e);
      response.setStatus(Status.RuntimeError(msg, e));
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think that it is better to just put the right message in the exception itself and do not decorate it later.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13023803">SENTRY-1546</key>
            <summary>Generic Policy provides bad error messages for Sentry exceptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kkalyan">Krishna Kalyan</assignee>
                                    <reporter username="akolb">Alex Kolbasov</reporter>
                        <labels>
                            <label>bite-sized</label>
                    </labels>
                <created>Mon, 28 Nov 2016 17:35:13 +0000</created>
                <updated>Mon, 24 Jul 2017 15:37:12 +0000</updated>
                            <resolved>Mon, 6 Mar 2017 21:39:53 +0000</resolved>
                                    <version>1.8.0</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.8.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15749560" author="kkalyan" created="Wed, 14 Dec 2016 21:36:15 +0000"  >&lt;p&gt;I see that exception is decorated with more information. I need to test to see why is not applied.&lt;/p&gt;</comment>
                            <comment id="15749961" author="akolb" created="Thu, 15 Dec 2016 00:47:52 +0000"  >&lt;p&gt;Note that the code and decorations are different dependent on the model.&lt;/p&gt;</comment>
                            <comment id="15752890" author="kkalyan" created="Thu, 15 Dec 2016 23:53:24 +0000"  >&lt;p&gt;Added code changes to SentryStore to have proper message (where the exceptions are originated). If this is done we can avoid decorating them later.&lt;/p&gt;

&lt;p&gt;I saw issue with exceptions created while role create/drop and made required changes. &lt;/p&gt;</comment>
                            <comment id="15752908" author="hadoopqa" created="Thu, 15 Dec 2016 23:58:44 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12843503/SENTRY-1546.001.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12843503/SENTRY-1546.001.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall:&lt;/font&gt; -1 due to an error&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; failed to apply patch (exit code 1):&lt;br/&gt;
The patch does not appear to apply with p0, p1, or p2&lt;/p&gt;



&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/2207/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/2207/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15822522" author="kkalyan" created="Fri, 13 Jan 2017 23:39:09 +0000"  >&lt;p&gt;Review comments incorporated.&lt;/p&gt;</comment>
                            <comment id="15822626" author="hadoopqa" created="Sat, 14 Jan 2017 01:51:52 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12847440/SENTRY-1546.002.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12847440/SENTRY-1546.002.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall:&lt;/font&gt; +1 all checks pass&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; all tests passed&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/2253/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/2253/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15826848" author="akolb" created="Tue, 17 Jan 2017 21:24:09 +0000"  >&lt;p&gt;Since we want a unified message in such cases would it make sense to modify constructors for SentryNoSuchObjectException and SentryAlreadyExistsException to provide such uniform messages for us so that callers don&apos;t have to hunt for proper message format?&lt;/p&gt;</comment>
                            <comment id="15826889" author="kkalyan" created="Tue, 17 Jan 2017 21:41:54 +0000"  >&lt;p&gt;It makes sense. I&apos;m not sure if it is feasible in all the cases.&lt;/p&gt;</comment>
                            <comment id="15829256" author="akolb" created="Thu, 19 Jan 2017 03:42:33 +0000"  >&lt;p&gt;Do you know any specific cases where this doesn&apos;t work?&lt;/p&gt;</comment>
                            <comment id="15883689" author="kkalyan" created="Fri, 24 Feb 2017 22:55:55 +0000"  >&lt;p&gt;Added code changes so that consistent message are observed for SentryNoSuchObjectException and SentryAlreadyExistsException exceptions &lt;/p&gt;</comment>
                            <comment id="15883718" author="hadoopqa" created="Fri, 24 Feb 2017 23:08:30 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12854601/SENTRY-1546.003.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12854601/SENTRY-1546.003.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;Overall:&lt;/font&gt; -1 due to 2 errors&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; mvn test exited 1&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt;ERROR:&lt;/font&gt; Failed: org.apache.sentry.provider.db.generic.service.persistent.TestPrivilegeOperatePersistence&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/2368/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/2368/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15898150" author="hadoopqa" created="Mon, 6 Mar 2017 21:31:38 +0000"  >&lt;p&gt;Here are the results of testing the latest attachment&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12856342/SENTRY-1546.005.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12856342/SENTRY-1546.005.patch&lt;/a&gt; against master.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Overall:&lt;/font&gt; +1 all checks pass&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;SUCCESS:&lt;/font&gt; all tests passed&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-SENTRY-Build/2405/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/PreCommit-SENTRY-Build/2405/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15898171" author="akolb" created="Mon, 6 Mar 2017 21:39:53 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kkalyan&quot; class=&quot;user-hover&quot; rel=&quot;kkalyan&quot;&gt;kkalyan&lt;/a&gt; Thank you for your contribution!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12856357" name="SENTRY-1546.001-sentry-ha-redesign.patch" size="9269" author="kkalyan" created="Mon, 6 Mar 2017 22:35:45 +0000"/>
                            <attachment id="12843503" name="SENTRY-1546.001.patch" size="2972" author="kkalyan" created="Thu, 15 Dec 2016 23:56:41 +0000"/>
                            <attachment id="12847440" name="SENTRY-1546.002.patch" size="2886" author="kkalyan" created="Fri, 13 Jan 2017 23:39:09 +0000"/>
                            <attachment id="12854604" name="SENTRY-1546.003.patch" size="10439" author="kkalyan" created="Fri, 24 Feb 2017 23:02:38 +0000"/>
                            <attachment id="12856342" name="SENTRY-1546.005.patch" size="10450" author="kkalyan" created="Mon, 6 Mar 2017 20:05:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[no_permission]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36utz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>