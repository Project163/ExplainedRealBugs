diff --git a/core/src/main/java/com/google/googlejavaformat/InputOutput.java b/core/src/main/java/com/google/googlejavaformat/InputOutput.java
index 5716439..e56e892 100644
--- a/core/src/main/java/com/google/googlejavaformat/InputOutput.java
+++ b/core/src/main/java/com/google/googlejavaformat/InputOutput.java
@@ -100,7 +100,6 @@ public abstract class InputOutput {
   public static Map<Integer, Range<Integer>> makeKToIJ(InputOutput put, int kN) {
     Map<Integer, Range<Integer>> map = new HashMap<>();
     int ijN = put.getLineCount();
-    LOOP:
     for (int ij = 0; ij <= ijN; ij++) {
       Range<Integer> range = put.getRanges(ij).canonical(INTEGERS);
       for (int k = range.lowerEndpoint(); k < range.upperEndpoint(); k++) {
@@ -109,9 +108,6 @@ public abstract class InputOutput {
         } else {
           map.put(k, Range.closedOpen(ij, ij + 1));
         }
-        if (k == kN) {
-          break LOOP;
-        }
       }
     }
     return map;
diff --git a/core/src/test/java/com/google/googlejavaformat/java/FormatterTest.java b/core/src/test/java/com/google/googlejavaformat/java/FormatterTest.java
index 9cc48cf..9028ce0 100644
--- a/core/src/test/java/com/google/googlejavaformat/java/FormatterTest.java
+++ b/core/src/test/java/com/google/googlejavaformat/java/FormatterTest.java
@@ -274,4 +274,11 @@ public final class FormatterTest {
       return CharStreams.toString(new InputStreamReader(stream, StandardCharsets.UTF_8));
     }
   }
+
+  // regression test for google-java-format#47
+  @Test
+  public void testTrailingCommentWithoutTerminalNewline() throws Exception {
+    assertThat(new Formatter().formatSource("/*\n * my comment */"))
+        .isEqualTo("/*\n * my comment */\n");
+  }
 }
