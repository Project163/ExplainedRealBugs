diff --git a/core/src/main/java/com/google/googlejavaformat/java/JavaOutput.java b/core/src/main/java/com/google/googlejavaformat/java/JavaOutput.java
index 2a6f1ab..f3f2020 100644
--- a/core/src/main/java/com/google/googlejavaformat/java/JavaOutput.java
+++ b/core/src/main/java/com/google/googlejavaformat/java/JavaOutput.java
@@ -182,7 +182,7 @@ public final class JavaOutput extends Output {
   /** Flush any incomplete last line, then add the EOF token into our data structures. */
   void flush() {
     String lastLine = lineBuilder.toString();
-    if (!lastLine.isEmpty()) {
+    if (!CharMatcher.whitespace().matchesAllOf(lastLine)) {
       mutableLines.add(lastLine);
     }
     int jN = mutableLines.size();
@@ -295,13 +295,13 @@ public final class JavaOutput extends Output {
       }
       for (; i < getLineCount(); i++) {
         String after = getLine(i);
-        if (after.isEmpty()) {
-          // Write out trailing blank lines from the formatted output.
+        int idx = CharMatcher.whitespace().negate().indexIn(after);
+        if (idx == -1) {
+          // Write out trailing empty lines from the formatted output.
           replacement.append(lineSeparator);
         } else {
           if (newline == -1) {
             // If there wasn't a trailing newline in the input, indent the next line.
-            int idx = CharMatcher.whitespace().negate().indexIn(after);
             replacement.append(after.substring(0, idx));
           }
           break;
diff --git a/core/src/test/java/com/google/googlejavaformat/java/MainTest.java b/core/src/test/java/com/google/googlejavaformat/java/MainTest.java
index db47bab..db87e63 100644
--- a/core/src/test/java/com/google/googlejavaformat/java/MainTest.java
+++ b/core/src/test/java/com/google/googlejavaformat/java/MainTest.java
@@ -285,4 +285,17 @@ public class MainTest {
     assertThat(main.format("-")).isEqualTo(0);
     assertThat(out.toString()).isEqualTo(joiner.join(input));
   }
+
+  @Test
+  public void newline() throws Exception {
+    StringWriter out = new StringWriter();
+    StringWriter err = new StringWriter();
+    Main main =
+        new Main(
+            new PrintWriter(out, true),
+            new PrintWriter(err, true),
+            new ByteArrayInputStream("class T {}\n\t".getBytes(UTF_8)));
+    assertThat(main.format("-")).isEqualTo(0);
+    assertThat(out.toString()).isEqualTo("class T {}\n");
+  }
 }
