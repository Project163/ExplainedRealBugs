{"url":"https://api.github.com/repos/google/google-java-format/issues/983","repository_url":"https://api.github.com/repos/google/google-java-format","labels_url":"https://api.github.com/repos/google/google-java-format/issues/983/labels{/name}","comments_url":"https://api.github.com/repos/google/google-java-format/issues/983/comments","events_url":"https://api.github.com/repos/google/google-java-format/issues/983/events","html_url":"https://github.com/google/google-java-format/issues/983","id":1968491217,"node_id":"I_kwDOAhznzM51VMrR","number":983,"title":"Google Java Format fails on complex switch expressions with Java 21","user":{"login":"bmeier-pros","id":141971923,"node_id":"U_kgDOCHZR0w","avatar_url":"https://avatars.githubusercontent.com/u/141971923?v=4","gravatar_id":"","url":"https://api.github.com/users/bmeier-pros","html_url":"https://github.com/bmeier-pros","followers_url":"https://api.github.com/users/bmeier-pros/followers","following_url":"https://api.github.com/users/bmeier-pros/following{/other_user}","gists_url":"https://api.github.com/users/bmeier-pros/gists{/gist_id}","starred_url":"https://api.github.com/users/bmeier-pros/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bmeier-pros/subscriptions","organizations_url":"https://api.github.com/users/bmeier-pros/orgs","repos_url":"https://api.github.com/users/bmeier-pros/repos","events_url":"https://api.github.com/users/bmeier-pros/events{/privacy}","received_events_url":"https://api.github.com/users/bmeier-pros/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":6300369279,"node_id":"LA_kwDOAhznzM8AAAABd4gBfw","url":"https://api.github.com/repos/google/google-java-format/labels/Java%2021","name":"Java 21","color":"1FD328","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-10-30T14:20:22Z","updated_at":"2023-12-08T16:42:15Z","closed_at":"2023-12-08T16:42:15Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Version 1.18.1 formatter throws an exception when trying to handle code like this:\r\n```java\r\n      return switch (obj1) {\r\n          case null -> obj2 == null;\r\n          case T1 myT1 when obj2 instanceof T1 otherT1 -> myT1.equalsStrict(otherT1);\r\n          // exception ^ at the when (69:46 in the original source)\r\n          case T2 myT2 when obj2 instanceof T2 otherT2 -> T2.isDeepEquals(myT2, otherT2);\r\n          default -> obj1.equals(obj2);\r\n      };\r\n```\r\n\r\nThe exception is:\r\n```\r\nStep 'google-java-format' found problem in 'src/test/java/com/example/test/acceptance/ExpectedResult.java':\r\n69:46: error: : or -> expected\r\ncom.google.googlejavaformat.java.FormatterException: 69:46: error: : or -> expected\r\n        at com.google.googlejavaformat.java.FormatterException.fromJavacDiagnostics(FormatterException.java:51)\r\n        at com.google.googlejavaformat.java.Formatter.format(Formatter.java:149)\r\n        at com.google.googlejavaformat.java.Formatter.getFormatReplacements(Formatter.java:273)\r\n        at com.google.googlejavaformat.java.Formatter.formatSource(Formatter.java:247)\r\n        at com.google.googlejavaformat.java.Formatter.formatSource(Formatter.java:213)\r\n        at com.diffplug.spotless.glue.java.GoogleJavaFormatFormatterFunc.apply(GoogleJavaFormatFormatterFunc.java:65)\r\n        at com.diffplug.spotless.FormatterFunc.apply(FormatterFunc.java:32)\r\n        at com.diffplug.spotless.FormatterStepImpl$Standard.format(FormatterStepImpl.java:82)\r\n        at com.diffplug.spotless.FormatterStep$Strict.format(FormatterStep.java:103)\r\n        at com.diffplug.spotless.Formatter.compute(Formatter.java:246)\r\n        at com.diffplug.spotless.PaddedCell.calculateDirtyState(PaddedCell.java:203)\r\n        at com.diffplug.spotless.PaddedCell.calculateDirtyState(PaddedCell.java:190)\r\n        at com.diffplug.gradle.spotless.SpotlessTaskImpl.processInputFile(SpotlessTaskImpl.java:105)\r\n        at com.diffplug.gradle.spotless.SpotlessTaskImpl.performAction(SpotlessTaskImpl.java:89)\r\n<gradle stack trace elided>\r\n```","closed_by":{"login":"cushon","id":478458,"node_id":"MDQ6VXNlcjQ3ODQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/478458?v=4","gravatar_id":"","url":"https://api.github.com/users/cushon","html_url":"https://github.com/cushon","followers_url":"https://api.github.com/users/cushon/followers","following_url":"https://api.github.com/users/cushon/following{/other_user}","gists_url":"https://api.github.com/users/cushon/gists{/gist_id}","starred_url":"https://api.github.com/users/cushon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cushon/subscriptions","organizations_url":"https://api.github.com/users/cushon/orgs","repos_url":"https://api.github.com/users/cushon/repos","events_url":"https://api.github.com/users/cushon/events{/privacy}","received_events_url":"https://api.github.com/users/cushon/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/google/google-java-format/issues/983/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/google/google-java-format/issues/983/timeline","performed_via_github_app":null,"state_reason":"completed"}