diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdfparser/COSParser.java b/pdfbox/src/main/java/org/apache/pdfbox/pdfparser/COSParser.java
index 2ba83af59c..63f4a82827 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdfparser/COSParser.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdfparser/COSParser.java
@@ -255,10 +255,9 @@ public class COSParser extends BaseParser
         document.setStartXref(startXrefOffset);
         long prev = startXrefOffset;
         // ---- parse whole chain of xref tables/object streams using PREV reference
-        long lastPrev = -1;
-        while (prev > 0 && prev != lastPrev)
+        Set<Long> prevSet = new HashSet<>();
+        while (prev > 0)
         {
-            lastPrev = prev;
             // seek to xref table
             source.seek(prev);
 
@@ -348,11 +347,11 @@ public class COSParser extends BaseParser
                     }
                 }
             }
-        }
-        if (prev == lastPrev)
-        {
-            //TODO better idea needed? PDFBOX-3446
-            throw new IOException("/Prev loop at offset " + prev);
+            if (prevSet.contains(prev))
+            {
+                throw new IOException("/Prev loop at offset " + prev);
+            }
+            prevSet.add(prev);
         }
         // ---- build valid xrefs out of the xref chain
         xrefTrailerResolver.setStartxref(startXrefOffset);
