diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPageTree.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPageTree.java
index 717baeaa3e..39e10d3586 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPageTree.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDPageTree.java
@@ -107,6 +107,17 @@ public class PDPageTree implements COSObjectable, Iterable<PDPage>
      */
     public static COSBase getInheritableAttribute(COSDictionary node, COSName key)
     {
+        return getInheritableAttribute(node, key, new HashSet<>());
+    }
+
+    private static COSBase getInheritableAttribute(COSDictionary node, COSName key, Set<COSDictionary> visited)
+    {
+        if (visited.contains(node))
+        {
+            return null;
+        }
+        visited.add(node);
+
         COSBase value = node.getDictionaryObject(key);
         if (value != null)
         {
@@ -115,7 +126,7 @@ public class PDPageTree implements COSObjectable, Iterable<PDPage>
         COSDictionary parent = node.getCOSDictionary(COSName.PARENT, COSName.P);
         if (parent != null && COSName.PAGES.equals(parent.getCOSName(COSName.TYPE)))
         {
-            return getInheritableAttribute(parent, key);
+            return getInheritableAttribute(parent, key, visited);
         }
 
         return null;
diff --git a/pdfbox/src/test/java/org/apache/pdfbox/pdmodel/TestPDPageTree.java b/pdfbox/src/test/java/org/apache/pdfbox/pdmodel/TestPDPageTree.java
index 02a36e116e..0dbe00a602 100644
--- a/pdfbox/src/test/java/org/apache/pdfbox/pdmodel/TestPDPageTree.java
+++ b/pdfbox/src/test/java/org/apache/pdfbox/pdmodel/TestPDPageTree.java
@@ -17,6 +17,7 @@
 package org.apache.pdfbox.pdmodel;
 
 import static org.junit.jupiter.api.Assertions.assertEquals;
+import static org.junit.jupiter.api.Assertions.assertNull;
 
 import java.io.IOException;
 
@@ -131,4 +132,17 @@ class TestPDPageTree
                     "Page three should be placed at index 2.");
         }
     }
+
+    /**
+     * PDFBOX-6040: avoid loop in getInheritableAttribute().
+     *
+     * @throws IOException 
+     */
+    @Test
+    void testNodeLoop() throws IOException
+    {
+        doc = Loader.loadPDF(RandomAccessReadBuffer.createBufferFromStream(
+                TestPDPageTree.class.getResourceAsStream("PDFBOX-6040-nodeloop.pdf")));
+        assertNull(doc.getPage(0).getResources());
+    }
 }
diff --git a/pdfbox/src/test/resources/org/apache/pdfbox/pdmodel/PDFBOX-6040-nodeloop.pdf b/pdfbox/src/test/resources/org/apache/pdfbox/pdmodel/PDFBOX-6040-nodeloop.pdf
new file mode 100644
index 0000000000..ddfca4297e
--- /dev/null
+++ b/pdfbox/src/test/resources/org/apache/pdfbox/pdmodel/PDFBOX-6040-nodeloop.pdf
@@ -0,0 +1,38 @@
+%PF-1.4
+1 0 obj
+<<
+/Type /Catalog
+/Pages 2 0 R
+>>
+endobj
+2 0 obj
+<<
+/Type /Pages
+/Kids [3 0 R 4 0 R]
+/Counte /Page
+/Parent 2 0 R
+/MediaBox [0 0 612 792]
+>>
+endobj
+4 0 obj
+<<
+/Type /Page
+/Parent 2 0 R
+/MediaBox [0 0 612 792]
+>>
+endobj
+xref
+0 5
+0000000000 65535 f 
+0000000009 00000 n 
+0000000058 00000 n 
+0000000119 00000 n 
+0000000176 00000 ,n 
+trailer
+<<
+/Size 5
+/Root 1 0 R
+>>
+startxref
+233
+%%EOF
\ No newline at end of file
