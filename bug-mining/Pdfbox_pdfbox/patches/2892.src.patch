diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/COSWriter.java b/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/COSWriter.java
index d7d7031586..d04f38f77f 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/COSWriter.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/COSWriter.java
@@ -1071,39 +1071,41 @@ public class COSWriter implements ICOSVisitor
      */
     private COSObjectKey getObjectKey( COSBase obj )
     {
-        COSBase actual = obj;
-        if( actual instanceof COSObject )
+        COSObjectKey key = obj.getKey();
+        COSBase actual;
+        if (obj instanceof COSObject)
         {
             actual = ((COSObject) obj).getObject();
-            if (reuseObjectNumbers)
+            if (actual == null)
             {
-                COSObjectKey key = obj.getKey();
-                if (key != null)
-                {
-                    COSObjectKey actualKey = actual != null ? actual.getKey() : null;
-                    // check if the key of the referenced object and the indirect object is the same
-                    if (actualKey != null && !key.equals(actualKey))
-                    {
-                        // update the object key of the indirect object
-                        key = actualKey;
-                        obj.setKey(key);
-                    }
-                    objectKeys.put(obj, key);
-                    return key;
-                }
+                objectKeys.put(obj, key);
+                return key;
             }
         }
-        // PDFBOX-4540: because objectKeys is accessible from outside, it is possible
-        // that a COSObject obj is already in the objectKeys map.
-        COSObjectKey newKey = objectKeys.computeIfAbsent(actual,
+        else
+        {
+            actual = obj;
+        }
+        COSObjectKey actualKey = objectKeys.computeIfAbsent(actual,
                 k -> new COSObjectKey(++number, 0));
-        COSObjectKey actualKey = actual.getKey();
-        // if the returned key is new update the existing key of the given object
-        if (actualKey != null && !actualKey.equals(newKey))
+        // check if the returned key and the origin key of the given object are the same
+        if (key == null || (actualKey != null && !key.equals(actualKey)))
         {
-            actual.setKey(newKey);
+            if (key != null)
+                System.out.println("key fixed: " + key + " -> " + actualKey);
+            else
+                System.out.println("key initialized: " + actualKey);
+            // update the object key given object/referenced object
+            key = actualKey;
+            actual.setKey(actualKey);
+            if (obj instanceof COSObject)
+            {
+                // update the object key of the indirect object
+                obj.setKey(key);
+                objectKeys.put(obj, key);
+            }
         }
-        return newKey;
+        return key;
     }
 
     @Override
