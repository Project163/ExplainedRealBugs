diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDDeviceN.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDDeviceN.java
index 610039cbc6..b4e9cb3a2a 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDDeviceN.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDDeviceN.java
@@ -302,10 +302,10 @@ public class PDDeviceN extends PDSpecialColorSpace
                 int[] intSrc = new int[numSrcComponents];
                 raster.getPixel(x, y, intSrc);
 
-                // subtractive -> additive & scale to 0..1
+                // scale to 0..1
                 for (int s = 0; s < numSrcComponents; s++)
                 {
-                    src[s] =  /*1 -*/ (src[s] / 255);
+                    src[s] = src[s] / 255;
                 }
 
                 // convert to alternate color space via tint transform
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDIndexed.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDIndexed.java
index bbfdbb9f10..ee99a01639 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDIndexed.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/color/PDIndexed.java
@@ -172,13 +172,18 @@ public final class PDIndexed extends PDSpecialColorSpace
         BufferedImage rgbImage = new BufferedImage(width, height, BufferedImage.TYPE_INT_RGB);
         WritableRaster rgbRaster = rgbImage.getRaster();
 
-        int[] src = new int[1];
+        float[] src = new float[1];
         for (int y = 0; y < height; y++)
         {
             for (int x = 0; x < width; x++)
             {
                 raster.getPixel(x, y, src);
-                int index = Math.min(src[0], actualMaxIndex);
+
+                // scale to 0..1
+                src[0] = src[0] / 255;
+
+                // scale to 0..hival and lookup
+                int index = Math.min(Math.round(src[0] * actualMaxIndex), actualMaxIndex);
                 rgbRaster.setPixel(x, y, rgbColorTable[index]);
             }
         }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/image/PDImageXObject.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/image/PDImageXObject.java
index 0615b3b5e6..4f2722d371 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/image/PDImageXObject.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/image/PDImageXObject.java
@@ -261,12 +261,22 @@ public final class PDImageXObject extends PDXObject implements PDImage
      */
     public PDImageXObject getMask() throws IOException
     {
-        COSStream cosStream = (COSStream)getCOSStream().getDictionaryObject(COSName.MASK);
-        if (cosStream != null)
+        COSBase mask = getCOSStream().getDictionaryObject(COSName.MASK);
+        if (mask instanceof COSArray)
         {
-            return new PDImageXObject(new PDStream(cosStream), null); // always DeviceGray
+            // ...
+            System.out.println("color key");
+            return null;
+        }
+        else
+        {
+            COSStream cosStream = (COSStream)getCOSStream().getDictionaryObject(COSName.MASK);
+            if (cosStream != null)
+            {
+                return new PDImageXObject(new PDStream(cosStream), null); // always DeviceGray
+            }
+            return null;
         }
-        return null;
     }
 
     /**
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/image/SampledImageReader.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/image/SampledImageReader.java
index 4f6a452dfc..cda8bc3063 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/image/SampledImageReader.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/image/SampledImageReader.java
@@ -108,12 +108,12 @@ final class SampledImageReader
             throw new IOException("Image stream is empty");
         }
 
-        // get parameters
+        // get parameters, they must be valid or have been repaired
         final PDColorSpace colorSpace = pdImage.getColorSpace();
         final int numComponents = colorSpace.getNumberOfComponents();
-        final int width = pdImage.getWidth();                         // todo: what if -1?
-        final int height = pdImage.getHeight();                       // todo: what if -1?
-        final int bitsPerComponent = pdImage.getBitsPerComponent();   // todo: what if -1?
+        final int width = pdImage.getWidth();
+        final int height = pdImage.getHeight();
+        final int bitsPerComponent = pdImage.getBitsPerComponent();
         final float[] decode = getDecodeArray(pdImage);
 
         /*
