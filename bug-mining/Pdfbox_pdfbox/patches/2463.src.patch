diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDFieldTree.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDFieldTree.java
index 88dab258b9..8f30ecca8e 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDFieldTree.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDFieldTree.java
@@ -17,7 +17,8 @@
 package org.apache.pdfbox.pdmodel.interactive.form;
 
 import java.util.ArrayDeque;
-import java.util.HashSet;
+import java.util.Collections;
+import java.util.IdentityHashMap;
 import java.util.Iterator;
 import java.util.Queue;
 
@@ -69,7 +70,8 @@ public class PDFieldTree implements Iterable<PDField>
         
         // PDFBOX-5044: to prevent recursion
         // must be COSDictionary and not PDField, because PDField is newly created each time
-        private final Set<COSDictionary> set = new HashSet<>();
+        private final Set<COSDictionary> set =
+                Collections.newSetFromMap(new IdentityHashMap<COSDictionary, Boolean>());
 
         private FieldIterator(PDAcroForm form)
         {
diff --git a/pdfbox/src/test/java/org/apache/pdfbox/pdmodel/interactive/form/PDFieldTreeTest.java b/pdfbox/src/test/java/org/apache/pdfbox/pdmodel/interactive/form/PDFieldTreeTest.java
new file mode 100644
index 0000000000..9c71ec9062
--- /dev/null
+++ b/pdfbox/src/test/java/org/apache/pdfbox/pdmodel/interactive/form/PDFieldTreeTest.java
@@ -0,0 +1,60 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.pdfbox.pdmodel.interactive.form;
+
+import java.io.IOException;
+import java.io.InputStream;
+import java.net.URL;
+
+import org.apache.pdfbox.Loader;
+import org.apache.pdfbox.pdmodel.PDDocument;
+import org.apache.pdfbox.pdmodel.PDDocumentCatalog;
+
+import org.junit.jupiter.api.Assertions;
+import org.junit.jupiter.api.Test;
+
+/**
+ *
+ * @author Tilman Hausherr
+ */
+public class PDFieldTreeTest
+{
+
+    /**
+     * PDFBOX-5044 stack overflow
+     *
+     * @throws IOException
+     */
+    @Test
+    public void test5044() throws IOException
+    {
+        String sourceUrl = "https://issues.apache.org/jira/secure/attachment/13016994/PDFBOX-4131-0.pdf";
+
+        try (InputStream is = new URL(sourceUrl).openStream();
+             PDDocument doc = Loader.loadPDF(is))
+        {
+            PDDocumentCatalog catalog = doc.getDocumentCatalog();
+            PDAcroForm acroForm = catalog.getAcroForm();
+            int count = 0;
+            for (PDField field : acroForm.getFieldTree())
+            {
+                ++count;
+            }
+            Assertions.assertEquals(4, count);
+        }
+    }
+}
