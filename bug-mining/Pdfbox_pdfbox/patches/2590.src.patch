diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/COSWriter.java b/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/COSWriter.java
index 936c3bd991..d4075bcfb1 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/COSWriter.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/COSWriter.java
@@ -550,30 +550,31 @@ public class COSWriter implements ICOSVisitor
             actual = ((COSObject)actual).getObject();
         }
 
-        if (!writtenObjects.contains(object) //
-                && !objectsToWrite.contains(object) //
-                && !actualsAdded.contains(actual))
+        if (writtenObjects.contains(object) //
+                || actualsAdded.contains(actual) //
+                || objectsToWrite.contains(object))
         {
-            COSBase cosBase = null;
-            COSObjectKey cosObjectKey = null;
-            if (actual != null)
-            {
-                cosObjectKey = objectKeys.get(actual);
-            }
+            return;
+        }
+
+        COSBase cosBase = null;
+        COSObjectKey cosObjectKey = null;
+        if (actual != null)
+        {
+            cosObjectKey = objectKeys.get(actual);
             if (cosObjectKey != null)
             {
                 cosBase = keyObject.get(cosObjectKey);
+                if (!isNeedToBeUpdated(object) && !isNeedToBeUpdated(cosBase))
+                {
+                    return;
+                }
             }
-            if (actual != null && objectKeys.containsKey(actual) && !isNeedToBeUpdated(object)
-                    && !isNeedToBeUpdated(cosBase))
-            {
-                return;
-            }
-            objectsToWrite.add(object);
-            if (actual != null)
-            {
-                actualsAdded.add(actual);
-            }
+        }
+        objectsToWrite.add(object);
+        if (actual != null)
+        {
+            actualsAdded.add(actual);
         }
     }
 
