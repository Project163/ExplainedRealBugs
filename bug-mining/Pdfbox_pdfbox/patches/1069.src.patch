diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/PDEncryption.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/PDEncryption.java
index 7dcc81adb1..67422cd735 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/PDEncryption.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/PDEncryption.java
@@ -591,6 +591,13 @@ public class PDEncryption
         return perms;
     }
 
+    /**
+     * remove CF, StmF, and StrF entries. This is to be called if V is not 4 or 5.
+     */
+    public void removeV45filters()
+    {
+        dictionary.setItem(COSName.CF, null);
+        dictionary.setItem(COSName.STM_F, null);
+        dictionary.setItem(COSName.STR_F, null);
+    }
 }
-
-    
\ No newline at end of file
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/PublicKeySecurityHandler.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/PublicKeySecurityHandler.java
index d8cdaaa69a..e83fa80924 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/PublicKeySecurityHandler.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/PublicKeySecurityHandler.java
@@ -297,6 +297,10 @@ public final class PublicKeySecurityHandler extends SecurityHandler
             dictionary.setFilter(FILTER);
             dictionary.setLength(this.keyLength);
             dictionary.setVersion(2);
+            
+            // remove CF, StmF, and StrF entries that may be left from a previous encryption
+            dictionary.removeV45filters();
+            
             dictionary.setSubFilter(SUBFILTER);
 
             // create the 20 bytes seed
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/StandardSecurityHandler.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/StandardSecurityHandler.java
index 4f0e5f6d4c..f95e6a36fc 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/StandardSecurityHandler.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/StandardSecurityHandler.java
@@ -99,7 +99,7 @@ public final class StandardSecurityHandler extends SecurityHandler
     /**
      * Computes the version number of the StandardSecurityHandler
      * regarding the encryption key length.
-     * See PDF Spec 1.6 p 93
+     * See PDF Spec 1.6 p 93 and PDF 1.7 AEL3
      *
      * @return The computed version number.
      */
@@ -245,17 +245,21 @@ public final class StandardSecurityHandler extends SecurityHandler
             validatePerms(encryption, dicPermissions, encryptMetadata);
         }
 
-        // detect whether AES encryption is used. This assumes that the encryption algo is 
-        // stored in the PDCryptFilterDictionary
-        PDCryptFilterDictionary stdCryptFilterDictionary = encryption.getStdCryptFilterDictionary();
-
-        if (stdCryptFilterDictionary != null)
+        if (encryption.getVersion() == 4 || encryption.getVersion() == 5)
         {
-            COSName cryptFilterMethod = stdCryptFilterDictionary.getCryptFilterMethod();
-            if (cryptFilterMethod != null) 
+            // detect whether AES encryption is used. This assumes that the encryption algo is 
+            // stored in the PDCryptFilterDictionary
+            // However, crypt filters are used only when V is 4 or 5.
+            PDCryptFilterDictionary stdCryptFilterDictionary = encryption.getStdCryptFilterDictionary();
+
+            if (stdCryptFilterDictionary != null)
             {
-                setAES("AESV2".equalsIgnoreCase(cryptFilterMethod.getName()) ||
-                       "AESV3".equalsIgnoreCase(cryptFilterMethod.getName()));
+                COSName cryptFilterMethod = stdCryptFilterDictionary.getCryptFilterMethod();
+                if (cryptFilterMethod != null)
+                {
+                    setAES("AESV2".equalsIgnoreCase(cryptFilterMethod.getName())
+                            || "AESV3".equalsIgnoreCase(cryptFilterMethod.getName()));
+                }
             }
         }
     }
@@ -332,6 +336,11 @@ public final class StandardSecurityHandler extends SecurityHandler
         int revision = computeRevisionNumber();
         encryptionDictionary.setFilter(FILTER);
         encryptionDictionary.setVersion(version);
+        if (version != 4 && version != 5)
+        {
+            // remove CF, StmF, and StrF entries that may be left from a previous encryption
+            encryptionDictionary.removeV45filters();
+        }
         encryptionDictionary.setRevision(revision);
         encryptionDictionary.setLength(keyLength);
 
