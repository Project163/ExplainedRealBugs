diff --git a/pdfbox/src/main/java/org/apache/pdfbox/filter/LZWFilter.java b/pdfbox/src/main/java/org/apache/pdfbox/filter/LZWFilter.java
index 05daa6afa4..92110eeb76 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/filter/LZWFilter.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/filter/LZWFilter.java
@@ -128,6 +128,7 @@ public class LZWFilter extends Filter
                         decoded.write(data);
                         if (prevCommand != -1)
                         {
+                            checkIndexBounds(codeTable, prevCommand, in);
                             data = codeTable.get((int) prevCommand);
                             byte[] newData = Arrays.copyOf(data, data.length + 1);
                             newData[data.length] = firstByte;
@@ -136,6 +137,7 @@ public class LZWFilter extends Filter
                     }
                     else
                     {
+                        checkIndexBounds(codeTable, prevCommand, in);
                         byte[] data = codeTable.get((int) prevCommand);
                         byte[] newData = Arrays.copyOf(data, data.length + 1);
                         newData[data.length] = data[0];
@@ -155,6 +157,22 @@ public class LZWFilter extends Filter
         decoded.flush();
     }
 
+    private void checkIndexBounds(List codeTable, long index, MemoryCacheImageInputStream in)
+            throws IOException
+    {
+        if (index < 0)
+        {
+            throw new IOException("negative array index: " + index + " near offset "
+                    + in.getStreamPosition());
+        }
+        if (index >= codeTable.size())
+        {
+            throw new IOException("array index overflow: " + index +
+                    " >= " + codeTable.size() + " near offset "
+                    + in.getStreamPosition());
+        }
+    }
+
     /**
      * {@inheritDoc}
      */
