diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDResources.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDResources.java
index f4ebf68700..4b224f8592 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDResources.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDResources.java
@@ -269,7 +269,7 @@ public final class PDResources implements COSObjectable
         COSBase base = get(COSName.EXT_G_STATE, name);
         if (base instanceof COSDictionary)
         {
-            extGState = new PDExtendedGraphicsState((COSDictionary) base);
+            extGState = new PDExtendedGraphicsState((COSDictionary) base, getResourceCache());
         }
 
         if (cache != null && indirect != null)
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/state/PDExtendedGraphicsState.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/state/PDExtendedGraphicsState.java
index 88fc52ca00..34a09ce840 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/state/PDExtendedGraphicsState.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/state/PDExtendedGraphicsState.java
@@ -24,6 +24,7 @@ import org.apache.pdfbox.cos.COSDictionary;
 import org.apache.pdfbox.cos.COSFloat;
 import org.apache.pdfbox.cos.COSName;
 import org.apache.pdfbox.cos.COSNumber;
+import org.apache.pdfbox.pdmodel.ResourceCache;
 import org.apache.pdfbox.pdmodel.common.COSObjectable;
 import org.apache.pdfbox.pdmodel.graphics.PDFontSetting;
 import org.apache.pdfbox.pdmodel.graphics.PDLineDashPattern;
@@ -37,6 +38,7 @@ import org.apache.pdfbox.pdmodel.graphics.blend.BlendMode;
 public class PDExtendedGraphicsState implements COSObjectable
 {
     private final COSDictionary dict;
+    private final ResourceCache cache;
 
     /**
      * Default constructor, creates blank graphics state.
@@ -45,6 +47,7 @@ public class PDExtendedGraphicsState implements COSObjectable
     {
         dict = new COSDictionary();
         dict.setItem(COSName.TYPE, COSName.EXT_G_STATE);
+        cache = null;
     }
 
     /**
@@ -53,8 +56,20 @@ public class PDExtendedGraphicsState implements COSObjectable
      * @param dictionary The existing graphics state.
      */
     public PDExtendedGraphicsState(COSDictionary dictionary)
+    {
+        this(dictionary, null);
+    }
+
+    /**
+     * Create a graphics state from an existing dictionary.
+     *
+     * @param dictionary The existing graphics state.
+     * @param resourceCache Resource cache, may be null.
+     */
+    public PDExtendedGraphicsState(COSDictionary dictionary, ResourceCache resourceCache)
     {
         dict = dictionary;
+        cache = resourceCache;
     }
 
     /**
@@ -587,7 +602,7 @@ public class PDExtendedGraphicsState implements COSObjectable
     public PDSoftMask getSoftMask()
     {
         COSBase smask = dict.getDictionaryObject(COSName.SMASK);
-        return smask == null ? null : PDSoftMask.create(smask);
+        return smask == null ? null : PDSoftMask.create(smask, cache);
     }
 
     /**
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/state/PDSoftMask.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/state/PDSoftMask.java
index 9afb7ff2f3..387a950d91 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/state/PDSoftMask.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/state/PDSoftMask.java
@@ -24,6 +24,8 @@ import org.apache.pdfbox.cos.COSArray;
 import org.apache.pdfbox.cos.COSBase;
 import org.apache.pdfbox.cos.COSDictionary;
 import org.apache.pdfbox.cos.COSName;
+import org.apache.pdfbox.pdmodel.PDResources;
+import org.apache.pdfbox.pdmodel.ResourceCache;
 import org.apache.pdfbox.pdmodel.common.COSObjectable;
 import org.apache.pdfbox.pdmodel.common.function.PDFunction;
 import org.apache.pdfbox.pdmodel.graphics.PDXObject;
@@ -45,6 +47,19 @@ public final class PDSoftMask implements COSObjectable
      * @return the newly created instance of PDSoftMask
      */
     public static PDSoftMask create(COSBase dictionary)
+    {
+        return create(dictionary, null);
+    }
+
+    /**
+     * Creates a new soft mask.
+     *
+     * @param dictionary SMask
+     * @param resourceCache Resource cache, may be null.
+     * 
+     * @return the newly created instance of PDSoftMask
+     */
+    public static PDSoftMask create(COSBase dictionary, ResourceCache resourceCache)
     {
         if (dictionary instanceof COSName)
         {
@@ -60,7 +75,7 @@ public final class PDSoftMask implements COSObjectable
         }
         else if (dictionary instanceof COSDictionary)
         {
-            return new PDSoftMask((COSDictionary) dictionary);
+            return new PDSoftMask((COSDictionary) dictionary, resourceCache);
         }
         else
         {
@@ -72,6 +87,7 @@ public final class PDSoftMask implements COSObjectable
     private static final Logger LOG = LogManager.getLogger(PDSoftMask.class);
 
     private final COSDictionary dictionary;
+    private final ResourceCache resourceCache;
     private COSName subType = null;
     private PDTransparencyGroup group = null;
     private COSArray backdropColor = null;
@@ -88,8 +104,20 @@ public final class PDSoftMask implements COSObjectable
      * @param dictionary The soft mask dictionary.
      */
     public PDSoftMask(COSDictionary dictionary)
+    {
+        this(dictionary, null);
+    }
+
+    /**
+     * Creates a new soft mask.
+     *
+     * @param dictionary The soft mask dictionary.
+     * @param resourceCache Resource cache, may be null.
+     */
+    public PDSoftMask(COSDictionary dictionary, ResourceCache resourceCache)
     {
         this.dictionary = dictionary;
+        this.resourceCache = resourceCache;
     }
 
     @Override
@@ -125,7 +153,8 @@ public final class PDSoftMask implements COSObjectable
             COSBase cosGroup = getCOSObject().getDictionaryObject(COSName.G);
             if (cosGroup != null)
             {
-                PDXObject x = PDXObject.createXObject(cosGroup, null);
+                PDResources resources = new PDResources(new COSDictionary(), resourceCache);
+                PDXObject x = PDXObject.createXObject(cosGroup, resources);
                 if (x instanceof PDTransparencyGroup)
                 {
                     group = (PDTransparencyGroup) x;
