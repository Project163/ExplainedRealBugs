diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/AxialShadingContext.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/AxialShadingContext.java
index 564d2e2df1..e961807703 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/AxialShadingContext.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/AxialShadingContext.java
@@ -20,6 +20,7 @@ import java.awt.PaintContext;
 import java.awt.Rectangle;
 import java.awt.geom.AffineTransform;
 import java.awt.geom.NoninvertibleTransformException;
+import java.awt.geom.Point2D;
 import java.awt.image.ColorModel;
 import java.awt.image.Raster;
 import java.awt.image.WritableRaster;
@@ -115,14 +116,23 @@ public class AxialShadingContext extends ShadingContext implements PaintContext
             LOG.error(ex, ex);
         }
 
-        // get the number of steps
-        factor = (int) Math.max(Math.abs(deviceBounds.getWidth()),
-                                Math.abs(deviceBounds.getHeight()));
+        // shading space -> device space
+        AffineTransform shadingToDevice = (AffineTransform)xform.clone();
+        shadingToDevice.concatenate(matrix.createAffineTransform());
+        
+        // convert the start and end coordinates to device space
+        Point2D p0 = new Point2D.Double(coords[0], coords[1]);
+        Point2D p1 = new Point2D.Double(coords[2], coords[3]);
+        shadingToDevice.transform(p0, p0);
+        shadingToDevice.transform(p1, p1);
+        
+        // the distance between them is number of steps
+        factor = (int)Math.round(p0.distance(p1));
         
         // build the color table for the given number of steps
         colorTable = calcColorTable();
     }
-
+    
     /**
      * Calculate the color on the axial line and store them in an array.
      *
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/RadialShadingContext.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/RadialShadingContext.java
index a9df0783d6..7e98bed175 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/RadialShadingContext.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/RadialShadingContext.java
@@ -20,6 +20,7 @@ import java.awt.PaintContext;
 import java.awt.Rectangle;
 import java.awt.geom.AffineTransform;
 import java.awt.geom.NoninvertibleTransformException;
+import java.awt.geom.Point2D;
 import java.awt.image.ColorModel;
 import java.awt.image.Raster;
 import java.awt.image.WritableRaster;
@@ -121,9 +122,18 @@ public class RadialShadingContext extends ShadingContext implements PaintContext
             LOG.error(ex, ex);
         }
 
-        // get the number of steps
-        factor = (int) Math.max(Math.abs(deviceBounds.getWidth()),
-                Math.abs(deviceBounds.getHeight()));
+        // shading space -> device space
+        AffineTransform shadingToDevice = (AffineTransform)xform.clone();
+        shadingToDevice.concatenate(matrix.createAffineTransform());
+
+        // convert connects two circles' centers coordinates to device space
+        Point2D p0 = new Point2D.Double(coords[0], coords[1]);
+        Point2D p1 = new Point2D.Double(coords[3], coords[4]);
+        shadingToDevice.transform(p0, p0);
+        shadingToDevice.transform(p1, p1);
+
+        // the distance between them is number of steps
+        factor = (int)Math.round(p0.distance(p1));
 
         // build the color table for the given number of steps
         colorTable = calcColorTable();
