diff --git a/pdfbox/src/main/java/org/apache/pdfbox/cos/COSStream.java b/pdfbox/src/main/java/org/apache/pdfbox/cos/COSStream.java
index 1952ad0de0..4ab52665f5 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/cos/COSStream.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/cos/COSStream.java
@@ -201,6 +201,34 @@ public class COSStream extends COSDictionary implements Closeable
         return filteredStream.getLength();
     }
     
+    /**
+     * This will set the expected length of the encoded stream. Call this method
+     * if the previously set expected length is wrong, to avoid further trouble.
+     * 
+     * @param length the expected length of the encoded stream.
+     */
+    public void setFilteredLength(long length)
+    {
+        filteredStream.setExpectedLength(COSInteger.get(length));
+    }
+
+    /**
+     * This will get the length of the data written in the encoded stream.
+     *
+     * @return the length of the data written in the encoded stream as long
+     *
+     * @throws IOException
+     */
+    public long getFilteredLengthWritten() throws IOException
+    {
+        if (filteredStream == null)
+        {
+            doEncode();
+        }
+        return filteredStream.getLengthWritten();
+    }
+    
+
     /**
      * This will get the logical content stream with none of the filters.
      *
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFParser.java b/pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFParser.java
index a82023c33a..7bfc68c2dd 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFParser.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdfparser/PDFParser.java
@@ -21,6 +21,7 @@ import java.io.IOException;
 import java.io.InputStream;
 import java.util.ArrayList;
 import java.util.Collection;
+import java.util.HashSet;
 import java.util.Iterator;
 import java.util.List;
 import java.util.regex.Pattern;
@@ -32,6 +33,7 @@ import org.apache.pdfbox.cos.COSDictionary;
 import org.apache.pdfbox.cos.COSDocument;
 import org.apache.pdfbox.cos.COSInteger;
 import org.apache.pdfbox.cos.COSName;
+import org.apache.pdfbox.cos.COSNumber;
 import org.apache.pdfbox.cos.COSObject;
 import org.apache.pdfbox.cos.COSStream;
 import org.apache.pdfbox.pdfparser.XrefTrailerResolver.XRefType;
@@ -65,6 +67,11 @@ public class PDFParser extends BaseParser
      * File.
      */
     private List<ConflictObj> conflictList = new ArrayList<ConflictObj>();
+    
+    /**
+     * COSStream objects to check for length correctness
+     */
+    private final HashSet<COSStream> streamLengthCheckSet = new HashSet<COSStream>();
 
     /** Collects all Xref/trailer objects and resolves them into single
      *  object using startxref reference. 
@@ -237,6 +244,8 @@ public class PDFParser extends BaseParser
             document.setIsXRefStream(XRefType.STREAM == xrefTrailerResolver.getXrefType());
             document.addXRefTable( xrefTrailerResolver.getXrefTable() );
 
+            fixStreamsLength();
+
             if( !document.isEncrypted() )
             {
                 document.dereferenceObjectStreams();
@@ -263,6 +272,35 @@ public class PDFParser extends BaseParser
         }
     }
 
+    /**
+     * Check whether streams with previously unknown length have the correct
+     * length and fix that length if needed.
+     *
+     * @throws IOException
+     */
+    private void fixStreamsLength() throws IOException
+    {
+        for (COSObject obj : document.getObjects())
+        {
+            if (obj.getObject() instanceof COSStream
+                    && streamLengthCheckSet.contains((COSStream) obj.getObject()))
+            {
+                COSStream stream = (COSStream) obj.getObject();
+
+                long filteredLength = stream.getFilteredLength();
+                long filteredLengthWritten = stream.getFilteredLengthWritten();
+                if (Math.abs(filteredLength - filteredLengthWritten) > 2)
+                {
+                    // adjust the length, but only if the difference is > 2,
+                    // i.e. don't bother with CR LF differences
+                    LOG.warn("/Length of " + obj + " corrected from " + filteredLength + " to " + filteredLengthWritten);
+                    stream.setLong(COSName.LENGTH, filteredLengthWritten);
+                    stream.setFilteredLength(filteredLengthWritten);
+                }
+            }
+        }
+    }
+
     /**
      * Skip to the start of the next object.  This is used to recover
      * from a corrupt object. This should handle all cases that parseObject
@@ -600,6 +638,19 @@ public class PDFParser extends BaseParser
 
                     // test for XRef type
                     final COSStream strmObj = (COSStream) pb;
+                    
+                    // remember streams without length to check them later
+                    COSBase streamLength = strmObj.getItem(COSName.LENGTH);
+                    int length = -1;
+                    if (streamLength instanceof COSNumber)
+                    {
+                        length = ((COSNumber) streamLength).intValue();
+                    }
+                    if (length == -1)
+                    {
+                        streamLengthCheckSet.add(strmObj);
+                    }
+                    
                     final COSName objectType = (COSName)strmObj.getItem( COSName.TYPE );
                     if( objectType != null && objectType.equals( COSName.XREF ) )
                     {
