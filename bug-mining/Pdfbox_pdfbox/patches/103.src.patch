diff --git a/pdfbox/src/main/java/org/apache/pdfbox/cos/COSName.java b/pdfbox/src/main/java/org/apache/pdfbox/cos/COSName.java
index 3aa1608b2d..070a1bec01 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/cos/COSName.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/cos/COSName.java
@@ -100,8 +100,12 @@ public final class COSName extends COSBase implements Comparable<COSName>
      */
     public static final COSName ATTACHED = new COSName("Attached");
     /**
-    * A common COSName value.
-    */
+     * A common COSName value.
+     */
+    public static final COSName ASCENT = new COSName( "Ascent" );
+    /**
+     * A common COSName value.
+     */
     public static final COSName ASCII_HEX_DECODE = new COSName( "ASCIIHexDecode" );
     /**
     * A common COSName value.
@@ -116,6 +120,11 @@ public final class COSName extends COSBase implements Comparable<COSName>
      */
     public static final COSName AUTHOR = new COSName( "Author" );
 
+    /**
+     * A common COSName value.
+     */
+    public static final COSName AVG_WIDTH = new COSName( "AvgWidth" );
+
     /**
      * A common COSName value.
      */
@@ -197,6 +206,10 @@ public final class COSName extends COSBase implements Comparable<COSName>
     * A common COSName value.
     */
     public static final COSName CALRGB = new COSName( "CalRGB" );
+    /**
+     * A common COSName value.
+     */
+    public static final COSName CAP_HEIGHT = new COSName( "CapHeight" );
     /**
     * A common COSName value.
     */
@@ -293,6 +306,10 @@ public final class COSName extends COSBase implements Comparable<COSName>
     /** "DecodeParms" */
     public static final COSName DECODE_PARMS = new COSName( "DecodeParms" );
 
+    /**
+     * A common COSName value.
+     */
+    public static final COSName DESCENT = new COSName(  "Descent" );
     /**
      * A common COSName value.
      */
@@ -416,6 +433,10 @@ public final class COSName extends COSBase implements Comparable<COSName>
     * A common COSName value.
     */
     public static final COSName FL = new COSName( "FL" );
+    /**
+     * A common COSName value.
+     */
+    public static final COSName FLAGS = new COSName( "Flags" );
     /**
      * A common COSName value.
      */
@@ -464,6 +485,10 @@ public final class COSName extends COSBase implements Comparable<COSName>
     * A common COSName value.
     */
     public static final COSName FONT_STRETCH = new COSName("FontStretch" );
+    /**
+     * A common COSName value.
+     */
+    public static final COSName FONT_WEIGHT = new COSName("FontWeight" );
     /**
     * A common COSName value.
     */
@@ -531,6 +556,10 @@ public final class COSName extends COSBase implements Comparable<COSName>
      * A common COSName value.
      */
     public static final COSName INFO = new COSName( "Info" );
+    /**
+     * A common COSName value.
+     */
+    public static final COSName ITALIC_ANGLE = new COSName( "ItalicAngle" );
 
     /** "JavaScript" */
     public static final COSName JAVA_SCRIPT = new COSName( "JavaScript" );
@@ -571,6 +600,10 @@ public final class COSName extends COSBase implements Comparable<COSName>
      * A common COSName value.
      */
     public static final COSName LC = new COSName( "LC" );
+    /**
+     * A common COSName value.
+     */
+    public static final COSName LEADING = new COSName( "Leading" );
     /**
     * A common COSName value.
     */
@@ -614,6 +647,10 @@ public final class COSName extends COSBase implements Comparable<COSName>
      * A common COSName value.
      */
     public static final COSName MATRIX = new COSName( "Matrix" );
+    /**
+     * A common COSName value.
+     */
+    public static final COSName MAX_WIDTH = new COSName( "MaxWidth" );
     /**
      * "MCID"
      */
@@ -626,6 +663,10 @@ public final class COSName extends COSBase implements Comparable<COSName>
      * A common COSName value.
      */
     public static final COSName METADATA = new COSName(  "Metadata" );
+    /**
+     * A common COSName value.
+     */
+    public static final COSName MISSING_WIDTH = new COSName( "MissingWidth" );
     /**
      * A common COSName value.
      */
@@ -846,6 +887,14 @@ public final class COSName extends COSBase implements Comparable<COSName>
      * A common COSName value.
      */
     public static final COSName STD_CF = new COSName( "StdCF" );
+    /**
+     * A common COSName value.
+     */
+    public static final COSName STEM_H = new COSName( "StemH" );
+    /**
+     * A common COSName value.
+     */
+    public static final COSName STEM_V = new COSName( "StemV" );
     /**
      * A common COSName value.
      */
@@ -966,9 +1015,13 @@ public final class COSName extends COSBase implements Comparable<COSName>
      */
     public static final COSName WHITE_POINT = new COSName( "WhitePoint" );
 
+    /**
+     * A common COSName value.
+     */
+    public static final COSName XHEIGHT = new COSName( "XHeight" );
+
     /** "XObject" */
     public static final COSName XOBJECT = new COSName( "XObject" );
-
     /**
      * The prefix to a PDF name.
      */
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFont.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFont.java
index b889c8ccf3..678779376c 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFont.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFont.java
@@ -16,9 +16,6 @@
  */
 package org.apache.pdfbox.pdmodel.font;
 
-import java.awt.Graphics;
-import java.awt.geom.AffineTransform;
-
 import java.io.IOException;
 
 import java.util.HashMap;
@@ -37,10 +34,11 @@ import org.apache.pdfbox.pdmodel.common.PDRectangle;
  * @author <a href="mailto:ben@benlitchfield.com">Ben Litchfield</a>
  * @version $Revision: 1.11 $
  */
-public abstract class PDCIDFont extends PDFont
+public abstract class PDCIDFont extends PDSimpleFont
 {
-    private Map<Integer,Float> widthCache = new HashMap<Integer,Float>();
-
+    private Map<Integer,Float> widthCache = null;
+    private long defaultWidth = 0;
+    
     /**
      * Constructor.
      */
@@ -57,40 +55,7 @@ public abstract class PDCIDFont extends PDFont
     public PDCIDFont( COSDictionary fontDictionary )
     {
         super( fontDictionary );
-    }
-
-    /**
-     * Get the font descriptor associated with this CID font.
-     *
-     * @return The font descriptor.
-     */
-    public PDFontDescriptor getFontDescriptor()
-    {
-        PDFontDescriptor desc = null;
-        COSDictionary dict = (COSDictionary)font.getDictionaryObject( "FontDescriptor" );
-        if( dict != null )
-        {
-            desc = new PDFontDescriptorDictionary( dict );
-        }
-        return desc;
-    }
-
-    /**
-     * Set the font descriptor associated with this CID Font.
-     *
-     * @param desc The font descriptor.
-     */
-    public void setFontDescriptor( PDFontDescriptorDictionary desc )
-    {
-        font.setItem( "FontDescriptor", desc );
-    }
-
-    /**
-     * {@inheritDoc}
-     */
-    public void drawString( String string, Graphics g, float fontSize, AffineTransform at, float x, float y )
-    {
-        throw new RuntimeException( "Not yet implemented" );
+        extractWidths();
     }
 
     /**
@@ -102,7 +67,7 @@ public abstract class PDCIDFont extends PDFont
      */
     public PDRectangle getFontBoundingBox() throws IOException
     {
-        throw new RuntimeException( "Not yet implemented" );
+        throw new RuntimeException( "getFontBoundingBox(): Not yet implemented" );
     }
 
     /**
@@ -112,13 +77,19 @@ public abstract class PDCIDFont extends PDFont
      */
     public long getDefaultWidth()
     {
-        long dw = 1000;
-        COSNumber number = (COSNumber)font.getDictionaryObject( COSName.DW);
-        if( number != null )
+        if (defaultWidth == 0) 
         {
-            dw = number.intValue();
+            COSNumber number = (COSNumber)font.getDictionaryObject( COSName.DW);
+            if( number != null )
+            {
+                defaultWidth = number.intValue();
+            }
+            else
+            {
+                defaultWidth = 1000;
+            }
         }
-        return dw;
+        return defaultWidth;
     }
 
     /**
@@ -128,6 +99,7 @@ public abstract class PDCIDFont extends PDFont
      */
     public void setDefaultWidth( long dw )
     {
+        defaultWidth = dw;
         font.setLong( COSName.DW, dw );
     }
 
@@ -149,52 +121,53 @@ public abstract class PDCIDFont extends PDFont
         int code = getCodeFromArray( c, offset, length );
 
         Float widthFloat = widthCache.get( code );
-        if( widthFloat == null )
+        if( widthFloat != null )
         {
-            COSArray widths = (COSArray)font.getDictionaryObject( COSName.W );
+            retval = widthFloat.floatValue();
+        }
+        return retval;
+    }
 
+    private void extractWidths() 
+    {
+        if (widthCache == null) 
+        {
+            widthCache = new HashMap<Integer,Float>();
+            COSArray widths = (COSArray)font.getDictionaryObject( COSName.W );
             if( widths != null )
             {
-                boolean foundWidth = false;
-                for( int i=0; !foundWidth && i<widths.size(); i++ )
+                int size = widths.size();
+                int counter = 0;
+                while (counter < size) 
                 {
-                    COSNumber firstCode = (COSNumber)widths.getObject( i++ );
-                    COSBase next = widths.getObject( i );
+                    COSNumber firstCode = (COSNumber)widths.getObject( counter++ );
+                    COSBase next = widths.getObject( counter++ );
                     if( next instanceof COSArray )
                     {
                         COSArray array = (COSArray)next;
-                        if( code >= firstCode.intValue() &&
-                            code < firstCode.intValue() + array.size() )
+                        int startRange = firstCode.intValue();
+                        int arraySize = array.size();
+                        for (int i=0; i<arraySize; i++) 
                         {
-                            COSNumber rangeWidth =
-                                (COSNumber)array.get( code - firstCode.intValue() );
-                            retval = rangeWidth.floatValue();
-                            foundWidth = true;
+                            COSNumber width = (COSNumber)array.get(i);
+                            widthCache.put(startRange+i, width.floatValue());
                         }
                     }
                     else
                     {
                         COSNumber secondCode = (COSNumber)next;
-                        i++;
-                        COSNumber rangeWidth = (COSNumber)widths.getObject( i );
-                        if( code >= firstCode.intValue() &&
-                            code <= secondCode.intValue() )
-                        {
-                            retval = rangeWidth.floatValue();
-                            foundWidth = true;
+                        COSNumber rangeWidth = (COSNumber)widths.getObject( counter++ );
+                        int startRange = firstCode.intValue();
+                        int endRange = secondCode.intValue();
+                        float width = rangeWidth.floatValue();
+                        for (int i=startRange; i<=endRange; i++) {
+                            widthCache.put(i,width);
                         }
                     }
                 }
-                widthCache.put( code, retval );
             }
         }
-        else
-        {
-            retval = widthFloat.floatValue();
-        }
-        return retval;
     }
-
     /**
      * This will get the font height for a character.
      *
@@ -285,4 +258,18 @@ public abstract class PDCIDFont extends PDFont
         }
         return average;
     }
+    
+    /**
+     * {@inheritDoc}
+     */
+    public float getFontWidth( int charCode ) 
+    {
+        float width = -1;
+        if (widthCache.containsKey(charCode)) 
+        {
+            width = widthCache.get(charCode);
+        }
+        return width;
+    }
+
 }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFontType0Font.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFontType0Font.java
index db57126c40..67076179a5 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFontType0Font.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFontType0Font.java
@@ -16,6 +16,11 @@
  */
 package org.apache.pdfbox.pdmodel.font;
 
+import java.awt.Font;
+import java.io.IOException;
+
+import org.apache.commons.logging.Log;
+import org.apache.commons.logging.LogFactory;
 import org.apache.pdfbox.cos.COSDictionary;
 import org.apache.pdfbox.cos.COSName;
 
@@ -27,6 +32,11 @@ import org.apache.pdfbox.cos.COSName;
  */
 public class PDCIDFontType0Font extends PDCIDFont
 {
+    /**
+     * Log instance.
+     */
+    private static final Log log = LogFactory.getLog(PDCIDFontType0Font.class);
+
     /**
      * Constructor.
      */
@@ -45,4 +55,29 @@ public class PDCIDFontType0Font extends PDCIDFont
     {
         super( fontDictionary );
     }
+    
+    /**
+     * {@inheritDoc}
+     */
+    public Font getawtFont() throws IOException
+    {
+        Font awtFont = null;
+        PDFontDescriptorDictionary fd = (PDFontDescriptorDictionary)getFontDescriptor();
+        if( fd.getFontFile3() != null )
+        {
+            // create a font with the embedded data
+            PDType1CFont type1CFont = new PDType1CFont( super.font );
+            awtFont = type1CFont.getawtFont();
+            if (awtFont == null)
+            {
+                awtFont = FontManager.getAwtFont(fd.getFontName());
+                if (awtFont != null)
+                {
+                    log.info("Using font "+awtFont.getName()+ " instead");
+                }
+            }
+        }
+        return awtFont;
+    }
+
 }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFontType2Font.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFontType2Font.java
index 140e0843bf..595433e3ad 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFontType2Font.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDCIDFontType2Font.java
@@ -16,8 +16,15 @@
  */
 package org.apache.pdfbox.pdmodel.font;
 
+import java.awt.Font;
+import java.awt.FontFormatException;
+import java.io.IOException;
+
+import org.apache.commons.logging.Log;
+import org.apache.commons.logging.LogFactory;
 import org.apache.pdfbox.cos.COSDictionary;
 import org.apache.pdfbox.cos.COSName;
+import org.apache.pdfbox.pdmodel.common.PDStream;
 
 /**
  * This is implementation of the CIDFontType2 Font.
@@ -27,6 +34,12 @@ import org.apache.pdfbox.cos.COSName;
  */
 public class PDCIDFontType2Font extends PDCIDFont
 {
+
+    /**
+     * Log instance.
+     */
+    private static final Log log = LogFactory.getLog(PDCIDFontType2Font.class);
+
     /**
      * Constructor.
      */
@@ -45,4 +58,37 @@ public class PDCIDFontType2Font extends PDCIDFont
     {
         super( fontDictionary );
     }
+    
+    /**
+     * {@inheritDoc}
+     */
+    public Font getawtFont() throws IOException
+    {
+        Font awtFont = null;
+        PDFontDescriptorDictionary fd = (PDFontDescriptorDictionary)getFontDescriptor();
+        PDStream ff2Stream = fd.getFontFile2();
+        if( ff2Stream != null )
+        {
+            try
+            {
+                // create a font with the embedded data
+                awtFont = Font.createFont( Font.TRUETYPE_FONT, ff2Stream.createInputStream() );
+            }
+            catch( FontFormatException f )
+            {
+                log.info("Can't read the embedded font " + fd.getFontName() );
+            }
+            if (awtFont == null)
+            {
+                awtFont = FontManager.getAwtFont(fd.getFontName());
+                if (awtFont != null)
+                {
+                    log.info("Using font "+awtFont.getName()+ " instead");
+                }
+            }
+        }
+        // TODO FontFile3
+        return awtFont;
+    }
+
 }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFont.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFont.java
index 98e17dab40..0959712f5d 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFont.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFont.java
@@ -16,19 +16,12 @@
  */
 package org.apache.pdfbox.pdmodel.font;
 
-import org.apache.commons.logging.Log;
-import org.apache.commons.logging.LogFactory;
 import org.apache.fontbox.afm.AFMParser;
 import org.apache.fontbox.afm.FontMetric;
 import org.apache.fontbox.cmap.CMapParser;
 import org.apache.fontbox.cmap.CMap;
 
-import org.apache.pdfbox.encoding.AFMEncoding;
-import org.apache.pdfbox.encoding.DictionaryEncoding;
 import org.apache.pdfbox.encoding.Encoding;
-import org.apache.pdfbox.encoding.EncodingManager;
-import org.apache.pdfbox.encoding.Type1Encoding;
-import org.apache.pdfbox.encoding.conversion.CMapSubstitution;
 
 import org.apache.pdfbox.cos.COSArray;
 import org.apache.pdfbox.cos.COSBase;
@@ -36,7 +29,6 @@ import org.apache.pdfbox.cos.COSDictionary;
 import org.apache.pdfbox.cos.COSFloat;
 import org.apache.pdfbox.cos.COSInteger;
 import org.apache.pdfbox.cos.COSName;
-import org.apache.pdfbox.cos.COSStream;
 import org.apache.pdfbox.cos.COSString;
 
 import org.apache.pdfbox.pdmodel.common.COSArrayList;
@@ -49,9 +41,7 @@ import org.apache.pdfbox.util.ResourceLoader;
 import java.awt.Graphics;
 import java.awt.geom.AffineTransform;
 
-import java.io.BufferedReader;
 import java.io.InputStream;
-import java.io.InputStreamReader;
 import java.io.IOException;
 import java.io.UnsupportedEncodingException;
 
@@ -59,7 +49,6 @@ import java.util.Collections;
 import java.util.HashMap;
 import java.util.List;
 import java.util.Map;
-import java.util.StringTokenizer;
 
 /**
  * This is the base class for all PDF fonts.
@@ -70,11 +59,6 @@ import java.util.StringTokenizer;
 public abstract class PDFont implements COSObjectable
 {
 
-    /**
-     * Log instance.
-     */
-    private static final Log log = LogFactory.getLog(PDFont.class);
-
     /**
      * The cos dictionary for this font.
      */
@@ -85,14 +69,24 @@ public abstract class PDFont implements COSObjectable
      */
     private Encoding fontEncoding = null;
 
+    /**
+     *  The descriptor of the font
+     */
+    private PDFontDescriptor fontDescriptor = null;
+
     /**
      * This is only used if this is a font object and it has an encoding and it is
      * a type0 font with a cmap.
      */
     protected CMap cmap = null;
 
-    private static Map<String, CMap> cmapObjects =
+    protected static Map<String, CMap> cmapObjects =
         Collections.synchronizedMap( new HashMap<String, CMap>() );
+    
+    /**
+     *  A list a floats representing the widths
+     */
+    private List<Float> widths = null;
 
     /**
      * The static map of the default Adobe font metrics.
@@ -100,6 +94,8 @@ public abstract class PDFont implements COSObjectable
     private static final Map<String, FontMetric> afmObjects =
         Collections.unmodifiableMap( getAdobeFontMetrics() );
 
+    // TODO move the Map to PDType1Font as these are the 14 Standard fonts
+    // which are definitely Type 1 fonts
     private static Map<String, FontMetric> getAdobeFontMetrics() {
         Map<String, FontMetric> metrics = new HashMap<String, FontMetric>();
         addAdobeFontMetric( metrics, "Courier-Bold" );
@@ -119,7 +115,7 @@ public abstract class PDFont implements COSObjectable
         return metrics;
     }
 
-    private final static String resourceRootCMAP = "org/apache/pdfbox/resources/cmap/";
+    protected final static String resourceRootCMAP = "org/apache/pdfbox/resources/cmap/";
     private final static String resourceRootAFM = "org/apache/pdfbox/resources/afm/";
 
     private static void addAdobeFontMetric(
@@ -178,121 +174,56 @@ public abstract class PDFont implements COSObjectable
         determineEncoding();
     }
 
-   	private void determineEncoding()
+    /**
+     * This will get the font descriptor for this font.
+     *
+     * @return The font descriptor for this font.
+     *
+     */
+    public PDFontDescriptor getFontDescriptor()
     {
-        String cmapName = null;
-        COSName encodingName = null;
-        COSBase toUnicode = font.getDictionaryObject( COSName.TO_UNICODE );
-        COSBase encoding = getEncodingObject(); 
-        if( toUnicode != null )
+        if(fontDescriptor == null)
         {
-            if ( toUnicode instanceof COSStream )
+            COSDictionary fd = (COSDictionary)font.getDictionaryObject( COSName.FONT_DESC );
+            if (fd != null) 
             {
-                try {
-                    parseCmap(null, ((COSStream)toUnicode).getUnfilteredStream(), null);
-                }
-                catch(IOException exception) 
-                {
-                    log.error("Error: Could not load embedded CMAP" );
-                }
+                fontDescriptor = new PDFontDescriptorDictionary( fd );
             }
-            else if ( toUnicode instanceof COSName)
+            else
             {
-                encodingName = (COSName)toUnicode;
-                cmap = cmapObjects.get( encodingName.getName() );
-                if (cmap == null) 
+                FontMetric afm = getAFM();
+                if( afm != null )
                 {
-                    cmapName = encodingName.getName();
+                    fontDescriptor = new PDFontDescriptorAFM( afm );
                 }
             }
         }
-        if (encoding != null) 
-        {
-            if (encoding instanceof COSName) 
-            {
-                if (cmap == null)
-                {
-                    encodingName = (COSName)encoding;
-                    cmap = cmapObjects.get( encodingName.getName() );
-                    if (cmap == null) 
-                    {
-                        cmapName = encodingName.getName();
-                    }
-                }
-                if (cmap == null && cmapName != null)
-                {
-                    try 
-                    {
-                        fontEncoding =
-                            EncodingManager.INSTANCE.getEncoding(encodingName);
-                    }
-                    catch(IOException exception) 
-                    {
-                        log.debug("Debug: Could not find encoding for " + encodingName );
-                    }
-                }
-            }
-            else if (encoding instanceof COSDictionary) 
-            {
-                try 
-                {
-                    fontEncoding = new DictionaryEncoding((COSDictionary)encoding);
-                }
-                catch(IOException exception) 
-                {
-                    log.error("Error: Could not create the DictionaryEncoding" );
-                }
-            }
-            else if(encoding instanceof COSStream )
-            {
-                if (cmap == null)
-                {
-                    COSStream encodingStream = (COSStream)encoding;
-                    try 
-                    {
-                        parseCmap( null, encodingStream.getUnfilteredStream(), null );
-                    }
-                    catch(IOException exception) 
-                    {
-                        log.error("Error: Could not parse the embedded CMAP" );
-                    }
-                }
-            }
-        }
-        COSDictionary cidsysteminfo = (COSDictionary)font.getDictionaryObject(COSName.CIDSYSTEMINFO);
-        if (cidsysteminfo != null) 
-        {
-            String ordering = cidsysteminfo.getString(COSName.ORDERING);
-            String registry = cidsysteminfo.getString(COSName.REGISTRY);
-            int supplement = cidsysteminfo.getInt(COSName.SUPPLEMENT);
-            cmapName = registry + "-" + ordering+ "-" + supplement;
-            cmapName = CMapSubstitution.substituteCMap( cmapName );
-            cmap = cmapObjects.get( cmapName );
-        }
-        FontMetric metric = getAFM();
-        if( metric != null && fontEncoding == null)
-        {
-            fontEncoding = new AFMEncoding( metric );
-        }
-        
-        if (cmap == null && cmapName != null) 
+        return fontDescriptor;
+    }
+    
+    /**
+     * This will set the font descriptor.
+     *
+     * @param fontDescriptor The font descriptor.
+     */
+    public void setFontDescriptor( PDFontDescriptorDictionary fontDescriptor )
+    {
+        COSDictionary dic = null;
+        if( fontDescriptor != null )
         {
-            String resourceName = resourceRootCMAP + cmapName;
-            try {
-                parseCmap( resourceRootCMAP, ResourceLoader.loadResource( resourceName ), encodingName );
-                if( cmap == null && encodingName == null)
-                {
-                    log.error("Error: Could not parse predefined CMAP file for '" + cmapName + "'" );
-                }
-            }
-            catch(IOException exception) 
-            {
-                log.error("Error: Could not find predefined CMAP file for '" + cmapName + "'" );
-            }
+            dic = fontDescriptor.getCOSDictionary();
         }
-        getEncodingFromFont();
+        font.setItem( COSName.FONT_DESC, dic );
+        this.fontDescriptor = fontDescriptor;
     }
-
+    
+    /**
+     * Determines the encoding for the font.
+     * This method as to be overwritten, as there are different 
+     * possibilities to define a mapping.
+     */
+   	protected abstract void determineEncoding();
+    
     /**
      * {@inheritDoc}
      */
@@ -477,7 +408,7 @@ public abstract class PDFont implements COSObjectable
      * </pre>
      * @return
      */
-    private COSBase getEncodingObject(){
+    protected COSBase getEncodingObject(){
     	if(encodingObject==null){
     		encodingObject = font.getDictionaryObject( COSName.ENCODING );
     	}
@@ -566,7 +497,7 @@ public abstract class PDFont implements COSObjectable
         return retval;
     }
 
-    private void parseCmap( String cmapRoot, InputStream cmapStream, COSName encodingName )
+    protected void parseCmap( String cmapRoot, InputStream cmapStream, COSName encodingName )
     {
         if( cmapStream != null )
         {
@@ -600,10 +531,8 @@ public abstract class PDFont implements COSObjectable
      * modified by Christophe Huault : DGBS Strasbourg huault@free.fr october 2004
      *
      * @return The encoding to use.
-     *
-     * @throws IOException If there is an error getting the encoding.
      */
-    public Encoding getEncoding() throws IOException
+    public Encoding getEncoding()
     {
         return fontEncoding;
     }
@@ -640,7 +569,11 @@ public abstract class PDFont implements COSObjectable
         return subtype;
     }
 
-    private boolean isType1Font() {
+    /**
+     * Determines if the font is a type 1 font.
+     * @return returns true if the font is a type 1 font
+     */
+    protected boolean isType1Font() {
         getSubType();
         return type1Font;
     }
@@ -722,8 +655,15 @@ public abstract class PDFont implements COSObjectable
      */
     public List getWidths()
     {
-        COSArray array = (COSArray)font.getDictionaryObject( COSName.WIDTHS );
-        return COSArrayList.convertFloatCOSArrayToList( array );
+        if (widths == null)
+        {
+            COSArray array = (COSArray)font.getDictionaryObject( COSName.WIDTHS );
+            if (array != null)
+            {
+                widths = COSArrayList.convertFloatCOSArrayToList( array );
+            }
+        }
+        return widths;
     }
 
     /**
@@ -733,7 +673,8 @@ public abstract class PDFont implements COSObjectable
      */
     public void setWidths( List widths )
     {
-        font.setItem( COSName.WIDTHS, COSArrayList.converterToCOSArray( widths ) );
+        this.widths = widths;
+        font.setItem( COSName.WIDTHS, COSArrayList.converterToCOSArray( this.widths ) );
     }
 
     /**
@@ -765,87 +706,6 @@ public abstract class PDFont implements COSObjectable
         return matrix;
     }
 
-    /**
-     * Tries to get the encoding for the type1 font.
-     *
-     */
-    private void getEncodingFromFont()
-    {
-        // This whole section of code needs to be replaced with an actual type1 font parser!!
-        // Get the font program from the embedded type font.
-        if (isType1Font()) {
-            COSDictionary fontDescriptor = (COSDictionary) font.getDictionaryObject(
-                COSName.FONT_DESC);
-            if( fontDescriptor != null )
-            {
-                COSStream fontFile = (COSStream) fontDescriptor.getDictionaryObject(
-                    COSName.FONT_FILE);
-                if( fontFile != null )
-                {
-                    try 
-                    {
-                        BufferedReader in =
-                                new BufferedReader(new InputStreamReader(fontFile.getUnfilteredStream()));
-                        
-                        // this section parses the font program stream searching for a /Encoding entry
-                        // if it contains an array of values a Type1Encoding will be returned
-                        // if it encoding contains an encoding name the corresponding Encoding will be returned
-                        String line = "";
-                        Type1Encoding encoding = null;
-                        while( (line = in.readLine()) != null)
-                        {
-                            if (line.startsWith("currentdict end")) {
-                                if (encoding != null)
-                                    fontEncoding = encoding;
-                                break;
-                            }
-                            if (line.startsWith("/Encoding")) 
-                            {
-                                if(line.contains("array")) 
-                                {
-                                    StringTokenizer st = new StringTokenizer(line);
-                                    // ignore the first token
-                                    st.nextElement();
-                                    int arraySize = Integer.parseInt(st.nextToken());
-                                    encoding = new Type1Encoding(arraySize);
-                                }
-                                // if there is already an encoding, we don't need to
-                                // assign another one
-                                else if (fontEncoding == null)
-                                {
-                                    StringTokenizer st = new StringTokenizer(line);
-                                    // ignore the first token
-                                    st.nextElement();
-                                    String type1Encoding = st.nextToken();
-                                    fontEncoding =
-                                        EncodingManager.INSTANCE.getEncoding(
-                                                COSName.getPDFName(type1Encoding));
-                                    break;
-                                }
-                            }
-                            else if (line.startsWith("dup")) {
-                                StringTokenizer st = new StringTokenizer(line.replaceAll("/"," /"));
-                                // ignore the first token
-                                st.nextElement();
-                                int index = Integer.parseInt(st.nextToken());
-                                String name = st.nextToken();
-                                if(encoding == null)
-                                    log.warn("Unable to get character encoding.  Encoding defintion found without /Encoding line.");
-                                else
-                                    encoding.addCharacterEncoding(index, name.replace("/", ""));
-                            }
-                        }
-                        in.close();
-                    }
-                    catch(IOException exception) 
-                    {
-                        log.error("Error: Could not extract the encoding from the embedded type1 font.");
-                    }
-                }
-            }
-        }
-    }
-
     /**
      * This will get the fonts bounding box.
      *
@@ -871,4 +731,30 @@ public abstract class PDFont implements COSObjectable
         return this.getCOSObject().hashCode();
     }
 
+    /**
+     * Determines the width of the given character.
+     * @param charCode the code of the given character 
+     * @return the width of the character
+     */
+    public float getFontWidth( int charCode )
+    {
+        float width = -1;
+        int firstChar = getFirstChar();
+        int lastChar = getLastChar();
+        if (charCode >= firstChar && charCode <= lastChar)
+        {
+            List<Float> widths = getWidths();
+            width = widths.get(charCode-firstChar).floatValue();
+        }
+        else 
+        {
+            PDFontDescriptor fd = getFontDescriptor();
+            if (fd instanceof PDFontDescriptorDictionary)
+            {
+                width = fd.getMissingWidth();
+            }
+        }
+        return width;
+    }
+
 }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFontDescriptor.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFontDescriptor.java
index 292033a1af..399832eaa7 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFontDescriptor.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFontDescriptor.java
@@ -40,31 +40,31 @@ public abstract class PDFontDescriptor
     /**
      * A font descriptor flag.  See PDF Reference for description.
      */
-    private static final int FLAG_SYMBOLIC = 3;
+    private static final int FLAG_SYMBOLIC = 4;
     /**
      * A font descriptor flag.  See PDF Reference for description.
      */
-    private static final int FLAG_SCRIPT = 4;
+    private static final int FLAG_SCRIPT = 8;
     /**
      * A font descriptor flag.  See PDF Reference for description.
      */
-    private static final int FLAG_NON_SYMBOLIC = 6;
+    private static final int FLAG_NON_SYMBOLIC = 32;
     /**
      * A font descriptor flag.  See PDF Reference for description.
      */
-    private static final int FLAG_ITALIC = 7;
+    private static final int FLAG_ITALIC = 64;
     /**
      * A font descriptor flag.  See PDF Reference for description.
      */
-    private static final int FLAG_ALL_CAP = 17;
+    private static final int FLAG_ALL_CAP = 65536;
     /**
      * A font descriptor flag.  See PDF Reference for description.
      */
-    private static final int FLAG_SMALL_CAP = 18;
+    private static final int FLAG_SMALL_CAP = 131072;
     /**
      * A font descriptor flag.  See PDF Reference for description.
      */
-    private static final int FLAG_FORCE_BOLD = 19;
+    private static final int FLAG_FORCE_BOLD = 262144;
 
 
     /**
@@ -325,7 +325,7 @@ public abstract class PDFontDescriptor
 
     private boolean isFlagBitOn( int bit )
     {
-        return (getFlags() & (1 << (bit-1))) != 0;
+        return (getFlags() & bit) != 0;
     }
 
     private void setFlagBit( int bit, boolean value )
@@ -333,11 +333,11 @@ public abstract class PDFontDescriptor
         int flags = getFlags();
         if( value )
         {
-            flags = flags| (1 << (bit-1));
+            flags = flags | bit;
         }
         else
         {
-            flags = flags & (0xFFFFFFFF ^ (1 << (bit-1)));
+            flags = flags & (0xFFFFFFFF ^ bit);
         }
         setFlags( flags );
     }
@@ -513,4 +513,19 @@ public abstract class PDFontDescriptor
      * @param charSet The new character set for the font.
      */
     public abstract void setCharacterSet( String charSet );
+
+    /**
+     * This will get the missing width for the font.
+     *
+     * @return The missing width value.
+     */
+    public abstract float getMissingWidth();
+
+    /**
+     * This will set the missing width for the font.
+     *
+     * @param charSet The new missing width for the font.
+     */
+    public abstract void setMissingWidth( float missingWidth );
+
 }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFontDescriptorDictionary.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFontDescriptorDictionary.java
index 44accc87f6..c75ad031a0 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFontDescriptorDictionary.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFontDescriptorDictionary.java
@@ -37,6 +37,9 @@ import org.apache.pdfbox.pdmodel.common.PDStream;
 public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSObjectable
 {
     private COSDictionary dic;
+    private float xHeight = Float.NEGATIVE_INFINITY;
+    private float capHeight = Float.NEGATIVE_INFINITY;
+    private int flags = -1;
 
     /**
      * Constructor.
@@ -44,7 +47,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
     public PDFontDescriptorDictionary()
     {
         dic = new COSDictionary();
-        dic.setName( "Type", "FontDescriptor" );
+        dic.setItem( COSName.TYPE, COSName.FONT_DESC );
     }
 
     /**
@@ -148,7 +151,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public float getFontWeight()
     {
-        return dic.getFloat( "FontWeight",0 );
+        return dic.getFloat( COSName.FONT_WEIGHT,0 );
     }
 
     /**
@@ -158,7 +161,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setFontWeight( float fontWeight )
     {
-        dic.setFloat( "FontWeight", fontWeight );
+        dic.setFloat( COSName.FONT_WEIGHT, fontWeight );
     }
 
     /**
@@ -203,7 +206,11 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public int getFlags()
     {
-        return dic.getInt( "Flags", 0 );
+        if (flags == -1)
+        {
+            flags = dic.getInt( COSName.FLAGS, 0 );
+        }
+        return flags;
     }
 
     /**
@@ -213,13 +220,14 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setFlags( int flags )
     {
-        dic.setInt( "Flags", flags );
+        dic.setInt( COSName.FLAGS, flags );
+        this.flags = flags;
     }
 
     /**
-     * This will get the fonts bouding box.
+     * This will get the fonts bounding box.
      *
-     * @return The fonts bouding box.
+     * @return The fonts bounding box.
      */
     public PDRectangle getFontBoundingBox()
     {
@@ -254,7 +262,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public float getItalicAngle()
     {
-        return dic.getFloat( "ItalicAngle", 0 );
+        return dic.getFloat( COSName.ITALIC_ANGLE, 0 );
     }
 
     /**
@@ -264,7 +272,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setItalicAngle( float angle )
     {
-        dic.setFloat( "ItalicAngle", angle );
+        dic.setFloat( COSName.ITALIC_ANGLE, angle );
     }
 
     /**
@@ -274,7 +282,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public float getAscent()
     {
-        return dic.getFloat( "Ascent", 0 );
+        return dic.getFloat( COSName.ASCENT, 0 );
     }
 
     /**
@@ -284,7 +292,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setAscent( float ascent )
     {
-        dic.setFloat( "Ascent", ascent );
+        dic.setFloat( COSName.ASCENT, ascent );
     }
 
     /**
@@ -294,7 +302,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public float getDescent()
     {
-        return dic.getFloat( "Descent", 0 );
+        return dic.getFloat( COSName.DESCENT, 0 );
     }
 
     /**
@@ -304,7 +312,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setDescent( float descent )
     {
-        dic.setFloat( "Descent", descent );
+        dic.setFloat( COSName.DESCENT, descent );
     }
 
     /**
@@ -314,7 +322,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public float getLeading()
     {
-        return dic.getFloat( "Leading", 0 );
+        return dic.getFloat( COSName.LEADING, 0 );
     }
 
     /**
@@ -324,7 +332,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setLeading( float leading )
     {
-        dic.setFloat( "Leading", leading );
+        dic.setFloat( COSName.LEADING, leading );
     }
 
     /**
@@ -339,12 +347,11 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
              * the Scheherazade font. PDFBOX-429 was logged for this. 
              * We are not sure if returning the absolute value
              * is the correct fix, but it seems to work.  */
-            capHeight = java.lang.Math.abs(dic.getFloat( "CapHeight", 0 ));
+            capHeight = java.lang.Math.abs(dic.getFloat( COSName.CAP_HEIGHT, 0 ));
         }
         return capHeight;
     }
 
-    private float capHeight = Float.NEGATIVE_INFINITY;
     
     /**
      * This will set the cap height for the font.
@@ -353,7 +360,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setCapHeight( float capHeight )
     {
-        dic.setFloat( "CapHeight", capHeight );
+        dic.setFloat( COSName.CAP_HEIGHT, capHeight );
         this.capHeight = capHeight;
     }
 
@@ -369,13 +376,11 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
              * the Scheherazade font. PDFBOX-429 was logged for this. 
              * We are not sure if returning the absolute value
              * is the correct fix, but it seems to work.  */
-            xHeight = java.lang.Math.abs(dic.getFloat( "XHeight", 0 ));
+            xHeight = java.lang.Math.abs(dic.getFloat( COSName.XHEIGHT, 0 ));
         }
         return xHeight;
     }
 
-    private float xHeight = Float.NEGATIVE_INFINITY;
-    
     /**
      * This will set the x height for the font.
      *
@@ -383,7 +388,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setXHeight( float xHeight )
     {
-        dic.setFloat( "XHeight", xHeight );
+        dic.setFloat( COSName.XHEIGHT, xHeight );
         this.xHeight = xHeight;
     }
 
@@ -394,7 +399,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public float getStemV()
     {
-        return dic.getFloat( "StemV", 0 );
+        return dic.getFloat( COSName.STEM_V, 0 );
     }
 
     /**
@@ -404,7 +409,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setStemV( float stemV )
     {
-        dic.setFloat( "StemV", stemV );
+        dic.setFloat( COSName.STEM_V, stemV );
     }
 
     /**
@@ -414,7 +419,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public float getStemH()
     {
-        return dic.getFloat( "StemH", 0 );
+        return dic.getFloat( COSName.STEM_H, 0 );
     }
 
     /**
@@ -424,7 +429,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setStemH( float stemH )
     {
-        dic.setFloat( "StemH", stemH );
+        dic.setFloat( COSName.STEM_H, stemH );
     }
 
     /**
@@ -434,7 +439,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public float getAverageWidth()
     {
-        return dic.getFloat( "AvgWidth", 0 );
+        return dic.getFloat( COSName.AVG_WIDTH, 0 );
     }
 
     /**
@@ -444,7 +449,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setAverageWidth( float averageWidth )
     {
-        dic.setFloat( "AvgWidth", averageWidth );
+        dic.setFloat( COSName.AVG_WIDTH, averageWidth );
     }
 
     /**
@@ -454,7 +459,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public float getMaxWidth()
     {
-        return dic.getFloat( "MaxWidth", 0 );
+        return dic.getFloat( COSName.MAX_WIDTH, 0 );
     }
 
     /**
@@ -464,7 +469,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setMaxWidth( float maxWidth )
     {
-        dic.setFloat( "MaxWidth", maxWidth );
+        dic.setFloat( COSName.MAX_WIDTH, maxWidth );
     }
 
     /**
@@ -474,7 +479,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public float getMissingWidth()
     {
-        return dic.getFloat( "MissingWidth", 0 );
+        return dic.getFloat( COSName.MISSING_WIDTH, 0 );
     }
 
     /**
@@ -484,7 +489,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setMissingWidth( float missingWidth )
     {
-        dic.setFloat( "MissingWidth", missingWidth );
+        dic.setFloat( COSName.MISSING_WIDTH, missingWidth );
     }
 
     /**
@@ -526,7 +531,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
     public PDStream getFontFile()
     {
         PDStream retval = null;
-        COSStream stream = (COSStream)dic.getDictionaryObject( "FontFile" );
+        COSStream stream = (COSStream)dic.getDictionaryObject( COSName.FONT_FILE );
         if( stream != null )
         {
             retval = new PDStream( stream );
@@ -541,7 +546,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setFontFile( PDStream type1Stream )
     {
-        dic.setItem( "FontFile", type1Stream );
+        dic.setItem( COSName.FONT_FILE, type1Stream );
     }
 
     /**
@@ -552,7 +557,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
     public PDStream getFontFile2()
     {
         PDStream retval = null;
-        COSStream stream = (COSStream)dic.getDictionaryObject( "FontFile2" );
+        COSStream stream = (COSStream)dic.getDictionaryObject( COSName.FONT_FILE2 );
         if( stream != null )
         {
             retval = new PDStream( stream );
@@ -567,7 +572,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setFontFile2( PDStream ttfStream )
     {
-        dic.setItem( "FontFile2", ttfStream );
+        dic.setItem( COSName.FONT_FILE2, ttfStream );
     }
 
     /**
@@ -578,7 +583,7 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
     public PDStream getFontFile3()
     {
         PDStream retval = null;
-        COSStream stream = (COSStream)dic.getDictionaryObject( "FontFile3" );
+        COSStream stream = (COSStream)dic.getDictionaryObject( COSName.FONT_FILE3 );
         if( stream != null )
         {
             retval = new PDStream( stream );
@@ -593,6 +598,6 @@ public class PDFontDescriptorDictionary extends PDFontDescriptor implements COSO
      */
     public void setFontFile3( PDStream stream )
     {
-        dic.setItem( "FontFile3", stream );
+        dic.setItem( COSName.FONT_FILE3, stream );
     }
 }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFontFactory.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFontFactory.java
index 0f47c75102..f1c6e5c041 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFontFactory.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDFontFactory.java
@@ -21,7 +21,6 @@ import java.util.Map;
 
 import org.apache.pdfbox.cos.COSDictionary;
 import org.apache.pdfbox.cos.COSName;
-import org.apache.pdfbox.cos.COSStream;
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
 
@@ -107,29 +106,6 @@ public class PDFontFactory
         if( subType.equals( COSName.TYPE1) )
         {
             retval = new PDType1Font( dic );
-
-            COSDictionary fontDic = (COSDictionary)dic.getDictionaryObject(COSName.FONT_DESC);
-            if( fontDic != null )
-            {
-                COSStream ffStream = (COSStream)fontDic.getDictionaryObject("FontFile");
-                COSStream ff3Stream = (COSStream)fontDic.getDictionaryObject("FontFile3");
-
-                if( ffStream == null && ff3Stream != null )
-                {
-                    String ff3SubType = ff3Stream.getNameAsString(COSName.SUBTYPE);
-                    if( ff3SubType.equals("Type1C") )
-                    {
-                        try 
-                        {
-                            retval = new PDType1CFont( dic );
-                        }
-                        catch( Exception e )
-                        {
-                            log.warn("Failed to create Type1C font. Falling back to Type1 font", e);
-                        }
-                    }
-                }
-            }
         }
         else if( subType.equals( COSName.MM_TYPE1 ) )
         {
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDSimpleFont.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDSimpleFont.java
index a4ebfe7bff..da73f56611 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDSimpleFont.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDSimpleFont.java
@@ -33,14 +33,19 @@ import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
 
 import org.apache.pdfbox.cos.COSArray;
+import org.apache.pdfbox.cos.COSBase;
 import org.apache.pdfbox.cos.COSDictionary;
 import org.apache.pdfbox.cos.COSName;
 import org.apache.pdfbox.cos.COSNumber;
-import org.apache.pdfbox.cos.COSInteger;
+import org.apache.pdfbox.cos.COSStream;
+import org.apache.pdfbox.encoding.DictionaryEncoding;
 import org.apache.pdfbox.encoding.Encoding;
+import org.apache.pdfbox.encoding.EncodingManager;
+import org.apache.pdfbox.encoding.conversion.CMapSubstitution;
 
 import org.apache.pdfbox.pdmodel.common.PDRectangle;
 import org.apache.pdfbox.pdmodel.common.PDStream;
+import org.apache.pdfbox.util.ResourceLoader;
 
 /**
  * This class contains implementation details of the simple pdf fonts.
@@ -97,8 +102,9 @@ public abstract class PDSimpleFont extends PDFont
         Font _awtFont = getawtFont();
 
         // mdavis - fix fontmanager.so/dll on sun.font.FileFont.getGlyphImage
-        // for font with bad cmaps? 
-        if (_awtFont.canDisplayUpTo(string) != -1) { 
+        // for font with bad cmaps?
+        // Type1 fonts are not affected as they don't have cmaps
+        if (!isType1Font() && _awtFont.canDisplayUpTo(string) != -1) { 
             log.warn("Changing font on <" + string + "> from <"
                     + _awtFont.getName() + "> to the default font");
             _awtFont = Font.decode(null); 
@@ -183,26 +189,10 @@ public abstract class PDSimpleFont extends PDFont
         Float fontWidth = mFontSizes.get(code);
         if (fontWidth == null)
         {
-            //hmm should this be in a subclass??
-            COSInteger firstChar = (COSInteger)font.getDictionaryObject( COSName.FIRST_CHAR );
-            COSInteger lastChar = (COSInteger)font.getDictionaryObject( COSName.LAST_CHAR );
-            if( firstChar != null && lastChar != null )
-            {
-                long first = firstChar.intValue();
-                long last = lastChar.intValue();
-                if( code >= first && code <= last && font.getDictionaryObject( COSName.WIDTHS ) != null )
-                {
-                    COSArray widthArray = (COSArray)font.getDictionaryObject( COSName.WIDTHS );
-                    COSNumber fontWidthObject = (COSNumber)widthArray.getObject( (int)(code - first) );
-                    fontWidth = fontWidthObject.floatValue();
-                }
-                else
-                {
-                    fontWidth = getFontWidthFromAFMFile( code );
-                }
-            }
-            else
+            fontWidth = getFontWidth(code);
+            if (fontWidth == -1)
             {
+                //hmm should this be in PDType1Font??
                 fontWidth = getFontWidthFromAFMFile( code );
             }
             mFontSizes.put(code, fontWidth);
@@ -257,69 +247,7 @@ public abstract class PDSimpleFont extends PDFont
         return average;
     }
 
-    /**
-     * This will get the font descriptor for this font.
-     *
-     * @return The font descriptor for this font.
-     *
-     * @throws IOException If there is an error parsing an AFM file, or unable to
-     *      create a PDFontDescriptor object.
-     */
-    public PDFontDescriptor getFontDescriptor() throws IOException
-    {
-        if(fontDescriptor ==null){
-            COSDictionary fd = (COSDictionary)font.getDictionaryObject( COSName.FONT_DESC );
-            if( fd == null )
-            {
-                FontMetric afm = getAFM();
-                if( afm != null )
-                {
-                	fontDescriptor = new PDFontDescriptorAFM( afm );
-                }
-                else
-                {
-                    COSArray descendantFontArray =
-                        (COSArray)font.getDictionaryObject( COSName.DESCENDANT_FONTS );
-                    if (descendantFontArray != null) 
-                    {
-                        fd = (COSDictionary)descendantFontArray.getObject( 0 );
-                        if (fd != null)
-                        {
-                            fd = (COSDictionary)fd.getDictionaryObject( COSName.FONT_DESC );
-                            if (fd != null)
-                            {
-                                fontDescriptor = new PDFontDescriptorDictionary( fd );
-                            }
-                        }
-                    }
-                }
-            }
-            else
-            {
-            	fontDescriptor = new PDFontDescriptorDictionary( fd );
-            }
-        }
-        return fontDescriptor;
-    }
-
-    private PDFontDescriptor fontDescriptor = null;
     
-    /**
-     * This will set the font descriptor.
-     *
-     * @param fontDescriptor The font descriptor.
-     */
-    public void setFontDescriptor( PDFontDescriptorDictionary fontDescriptor )
-    {
-        COSDictionary dic = null;
-        if( fontDescriptor != null )
-        {
-            dic = fontDescriptor.getCOSDictionary();
-        }
-        font.setItem( COSName.FONT_DESC, dic );
-        this.fontDescriptor = fontDescriptor;
-    }
-
     /**
      * This will get the ToUnicode stream.
      *
@@ -398,4 +326,136 @@ public abstract class PDSimpleFont extends PDFont
         }
     }
 
+    /**
+     * {@inheritDoc}
+     */
+    protected void determineEncoding()
+    {
+        String cmapName = null;
+        COSName encodingName = null;
+        COSBase encoding = getEncodingObject(); 
+        Encoding fontEncoding = null;
+        if (encoding != null) 
+        {
+            if (encoding instanceof COSName) 
+            {
+                if (cmap == null)
+                {
+                    encodingName = (COSName)encoding;
+                    cmap = cmapObjects.get( encodingName.getName() );
+                    if (cmap == null) 
+                    {
+                        cmapName = encodingName.getName();
+                    }
+                }
+                if (cmap == null && cmapName != null)
+                {
+                    try 
+                    {
+                        fontEncoding =
+                            EncodingManager.INSTANCE.getEncoding(encodingName);
+                    }
+                    catch(IOException exception) 
+                    {
+                        log.debug("Debug: Could not find encoding for " + encodingName );
+                    }
+                }
+            }
+            else if (encoding instanceof COSDictionary) 
+            {
+                try 
+                {
+                    fontEncoding = new DictionaryEncoding((COSDictionary)encoding);
+                }
+                catch(IOException exception) 
+                {
+                    log.error("Error: Could not create the DictionaryEncoding" );
+                }
+            }
+            else if(encoding instanceof COSStream )
+            {
+                if (cmap == null)
+                {
+                    COSStream encodingStream = (COSStream)encoding;
+                    try 
+                    {
+                        parseCmap( null, encodingStream.getUnfilteredStream(), null );
+                    }
+                    catch(IOException exception) 
+                    {
+                        log.error("Error: Could not parse the embedded CMAP" );
+                    }
+                }
+            }
+        }
+        setEncoding(fontEncoding);
+        extractToUnicodeEncoding();
+
+        COSDictionary cidsysteminfo = (COSDictionary)font.getDictionaryObject(COSName.CIDSYSTEMINFO);
+        if (cidsysteminfo != null) 
+        {
+            String ordering = cidsysteminfo.getString(COSName.ORDERING);
+            String registry = cidsysteminfo.getString(COSName.REGISTRY);
+            int supplement = cidsysteminfo.getInt(COSName.SUPPLEMENT);
+            cmapName = registry + "-" + ordering+ "-" + supplement;
+            cmapName = CMapSubstitution.substituteCMap( cmapName );
+            cmap = cmapObjects.get( cmapName );
+        }
+        if (cmap == null && cmapName != null) 
+        {
+            String resourceName = resourceRootCMAP + cmapName;
+            try {
+                parseCmap( resourceRootCMAP, ResourceLoader.loadResource( resourceName ), encodingName );
+                if( cmap == null && encodingName == null)
+                {
+                    log.error("Error: Could not parse predefined CMAP file for '" + cmapName + "'" );
+                }
+            }
+            catch(IOException exception) 
+            {
+                log.error("Error: Could not find predefined CMAP file for '" + cmapName + "'" );
+            }
+        }
+    }
+
+    private void extractToUnicodeEncoding()
+    {
+        COSName encodingName = null;
+        String cmapName = null;
+        COSBase toUnicode = font.getDictionaryObject( COSName.TO_UNICODE );
+        if( toUnicode != null )
+        {
+            if ( toUnicode instanceof COSStream )
+            {
+                try {
+                    parseCmap(null, ((COSStream)toUnicode).getUnfilteredStream(), null);
+                }
+                catch(IOException exception) 
+                {
+                    log.error("Error: Could not load embedded CMAP" );
+                }
+            }
+            else if ( toUnicode instanceof COSName)
+            {
+                encodingName = (COSName)toUnicode;
+                cmap = cmapObjects.get( encodingName.getName() );
+                if (cmap == null) 
+                {
+                    cmapName = encodingName.getName();
+                    String resourceName = resourceRootCMAP + cmapName;
+                    try {
+                        parseCmap( resourceRootCMAP, ResourceLoader.loadResource( resourceName ), encodingName );
+                    }
+                    catch(IOException exception) 
+                    {
+                        log.error("Error: Could not find predefined CMAP file for '" + cmapName + "'" );
+                    }
+                    if( cmap == null)
+                    {
+                        log.error("Error: Could not parse predefined CMAP file for '" + cmapName + "'" );
+                    }
+                }
+            }
+        }
+    }
 }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDTrueTypeFont.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDTrueTypeFont.java
index 66861596dd..dbcea6e2ad 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDTrueTypeFont.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDTrueTypeFont.java
@@ -42,9 +42,6 @@ import org.apache.pdfbox.util.ResourceLoader;
 
 import java.awt.Font;
 import java.awt.FontFormatException;
-import java.awt.Graphics;
-import java.awt.Graphics2D;
-import java.awt.geom.AffineTransform;
 
 import java.util.ArrayList;
 import java.util.HashMap;
@@ -80,7 +77,7 @@ public class PDTrueTypeFont extends PDSimpleFont
     private Font awtFont = null;
 
     private static Properties externalFonts = new Properties();
-    private static Map loadedExternalFonts = new HashMap();
+    private static Map<String,TrueTypeFont> loadedExternalFonts = new HashMap<String,TrueTypeFont>();
 
     static
     {
@@ -164,7 +161,7 @@ public class PDTrueTypeFont extends PDSimpleFont
         stream = fontStream.createInputStream();
         try
         {
-            loadDescriptorDictionary(retval, fd, stream); 
+            retval.loadDescriptorDictionary(fd, stream); 
         }
         finally
         {
@@ -187,7 +184,7 @@ public class PDTrueTypeFont extends PDSimpleFont
             {
                 try
                 {
-                    loadDescriptorDictionary(this, fdd, ttfData);
+                    loadDescriptorDictionary(fdd, ttfData);
                 }
                 finally
                 {
@@ -197,7 +194,7 @@ public class PDTrueTypeFont extends PDSimpleFont
         }
     }
 
-    private static void loadDescriptorDictionary(PDTrueTypeFont retval, PDFontDescriptorDictionary fd, InputStream ttfData) throws IOException
+    private void loadDescriptorDictionary(PDFontDescriptorDictionary fd, InputStream ttfData) throws IOException
     {
         TrueTypeFont ttf = null;
         try
@@ -205,13 +202,13 @@ public class PDTrueTypeFont extends PDSimpleFont
             TTFParser parser = new TTFParser();
             ttf = parser.parseTTF( ttfData );
             NamingTable naming = ttf.getNaming();
-            List records = naming.getNameRecords();
+            List<NameRecord> records = naming.getNameRecords();
             for( int i=0; i<records.size(); i++ )
             {
-                NameRecord nr = (NameRecord)records.get( i );
+                NameRecord nr = records.get( i );
                 if( nr.getNameId() == NameRecord.NAME_POSTSCRIPT_NAME )
                 {
-                    retval.setBaseFont( nr.getString() );
+                    setBaseFont( nr.getString() );
                     fd.setFontName( nr.getString() );
                 }
                 else if( nr.getNameId() == NameRecord.NAME_FONT_FAMILY_NAME )
@@ -355,9 +352,9 @@ public class PDTrueTypeFont extends PDSimpleFont
                         new Integer( (int)(widthValues[i]* 1000f)/header.getUnitsPerEm() ) );
                 }
             }
-            retval.setWidths( widths );
-            retval.setFirstChar( firstChar );
-            retval.setLastChar( firstChar + widths.size()-1 );
+            setWidths( widths );
+            setFirstChar( firstChar );
+            setLastChar( firstChar + widths.size()-1 );
 
         }
         finally
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType0Font.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType0Font.java
index 7c570fe7c1..d50aec6cd5 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType0Font.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType0Font.java
@@ -16,29 +16,36 @@
  */
 package org.apache.pdfbox.pdmodel.font;
 
-import java.awt.Graphics;
-import java.awt.geom.AffineTransform;
+import java.awt.Font;
 import java.io.IOException;
 
+import org.apache.commons.logging.Log;
+import org.apache.commons.logging.LogFactory;
 import org.apache.pdfbox.cos.COSArray;
 import org.apache.pdfbox.cos.COSDictionary;
 import org.apache.pdfbox.cos.COSName;
 import org.apache.pdfbox.pdmodel.common.PDRectangle;
 
 /**
- * This is implementation of the Type0 Font. Note that currently
- * this class simply falls back to the Type1 font implementation
- * when drawing text.
+ * This is implementation of the Type0 Font. 
  * See <a href="https://issues.apache.org/jira/browse/PDFBOX-605">PDFBOX-605</a>
  * for the related improvement issue.
  *
  * @author <a href="mailto:ben@benlitchfield.com">Ben Litchfield</a>
  * @version $Revision: 1.9 $
  */
-public class PDType0Font extends /*PDFont following is a hack ...*/ PDType1Font
+public class PDType0Font extends PDSimpleFont
 {
 
+    /**
+     * Log instance.
+     */
+    private static final Log log = LogFactory.getLog(PDType0Font.class);
+
+    private COSArray descendantFontArray;
     private PDFont descendentFont;
+    private COSDictionary descendantFontDictionary;
+    private Font awtFont;
     /**
      * Constructor.
      */
@@ -56,22 +63,44 @@ public class PDType0Font extends /*PDFont following is a hack ...*/ PDType1Font
     public PDType0Font( COSDictionary fontDictionary )
     {
         super( fontDictionary );
+        descendantFontDictionary = (COSDictionary)getDescendantFonts().getObject( 0 );
+        if (descendantFontDictionary != null)
+        {
+            try 
+            {
+                descendentFont = PDFontFactory.createFont( descendantFontDictionary );
+            }
+            catch (IOException exception)
+            {
+                log.error("Error while creating the descendant font!");
+            }
+        }
     }
 
     /**
      * {@inheritDoc}
      */
-    public void drawString( String string, Graphics g, float fontSize, AffineTransform at, float x, float y ) 
-        throws IOException
+    public Font getawtFont() throws IOException
     {
-        // TODO: PDFBOX-605: Better support for Type0 fonts 
-        super.drawString(string, g, fontSize, at, x, y);
+        if (awtFont == null)
+        {
+            if (descendentFont != null) 
+            {
+                awtFont = ((PDSimpleFont)descendentFont).getawtFont();
+            }
+            if (awtFont == null)
+            {
+                awtFont = FontManager.getStandardFont();
+                log.info("Using font "+awtFont.getName()+ " instead of "+descendentFont.getFontDescriptor().getFontName());
+            }
+        }
+        return awtFont;
     }
-
+    
     /**
-     * This will get the fonts bouding box.
+     * This will get the fonts bounding box.
      *
-     * @return The fonts bouding box.
+     * @return The fonts bounding box.
      *
      * @throws IOException If there is an error getting the bounding box.
      */
@@ -93,14 +122,6 @@ public class PDType0Font extends /*PDFont following is a hack ...*/ PDType1Font
      */
     public float getFontWidth( byte[] c, int offset, int length ) throws IOException
     {
-        if (descendentFont == null) 
-        {
-            COSArray descendantFontArray =
-                (COSArray)font.getDictionaryObject( COSName.DESCENDANT_FONTS );
-            
-            COSDictionary descendantFontDictionary = (COSDictionary)descendantFontArray.getObject( 0 );
-            descendentFont = PDFontFactory.createFont( descendantFontDictionary );
-        }
         return descendentFont.getFontWidth( c, offset, length );
     }
 
@@ -117,14 +138,6 @@ public class PDType0Font extends /*PDFont following is a hack ...*/ PDType1Font
      */
     public float getFontHeight( byte[] c, int offset, int length ) throws IOException
     {
-        if (descendentFont == null) 
-        {
-            COSArray descendantFontArray =
-                (COSArray)font.getDictionaryObject( COSName.DESCENDANT_FONTS );
-            
-            COSDictionary descendantFontDictionary = (COSDictionary)descendantFontArray.getObject( 0 );
-            descendentFont = PDFontFactory.createFont( descendantFontDictionary );
-        }
         return descendentFont.getFontHeight( c, offset, length );
     }
 
@@ -137,14 +150,24 @@ public class PDType0Font extends /*PDFont following is a hack ...*/ PDType1Font
      */
     public float getAverageFontWidth() throws IOException
     {
-        if (descendentFont == null) 
+        return descendentFont.getAverageFontWidth();
+    }
+ 
+    private COSArray getDescendantFonts()
+    {
+        if (descendantFontArray == null)
         {
-            COSArray descendantFontArray =
-                (COSArray)font.getDictionaryObject( COSName.DESCENDANT_FONTS );
-            
-            COSDictionary descendantFontDictionary = (COSDictionary)descendantFontArray.getObject( 0 );
-            descendentFont = PDFontFactory.createFont( descendantFontDictionary );
+            descendantFontArray = (COSArray)font.getDictionaryObject( COSName.DESCENDANT_FONTS );
         }
-        return descendentFont.getAverageFontWidth();
+        return descendantFontArray;
     }
+    
+    /**
+     * {@inheritDoc}
+     */
+    public float getFontWidth( int charCode ) 
+    {
+        return descendentFont.getFontWidth(charCode);
+    }
+
 }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType1AfmPfbFont.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType1AfmPfbFont.java
index b080528b29..cbb776b47f 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType1AfmPfbFont.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType1AfmPfbFont.java
@@ -55,11 +55,6 @@ public class PDType1AfmPfbFont extends PDType1Font
      */
     private static final int BUFFERSIZE = 0xffff;
 
-    /**
-     * The font descriptor.
-     */
-    private PDFontDescriptorDictionary fd;
-
     /**
      * The font metric.
      */
@@ -108,7 +103,7 @@ public class PDType1AfmPfbFont extends PDType1Font
             final InputStream pfb) throws IOException
     {
 
-        fd = new PDFontDescriptorDictionary();
+        PDFontDescriptorDictionary fd = new PDFontDescriptorDictionary();
         setFontDescriptor(fd);
 
         // read the pfb
@@ -248,14 +243,4 @@ public class PDType1AfmPfbFont extends PDType1Font
         return new DictionaryEncoding(dictionary);
     }
 
-
-
-    /**
-     * {@inheritDoc}
-     */
-    public PDFontDescriptor getFontDescriptor() throws IOException
-    {
-        return fd;
-    }
-
 }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType1CFont.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType1CFont.java
index 0c0f644827..748f344cae 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType1CFont.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType1CFont.java
@@ -53,12 +53,12 @@ import org.apache.pdfbox.cos.COSDictionary;
 import org.apache.pdfbox.cos.COSFloat;
 import org.apache.pdfbox.cos.COSName;
 import org.apache.pdfbox.cos.COSNumber;
-import org.apache.pdfbox.cos.COSStream;
 import org.apache.pdfbox.encoding.Encoding;
 import org.apache.pdfbox.encoding.EncodingManager;
 import org.apache.pdfbox.exceptions.WrappedIOException;
 import org.apache.pdfbox.pdmodel.common.PDMatrix;
 import org.apache.pdfbox.pdmodel.common.PDRectangle;
+import org.apache.pdfbox.pdmodel.common.PDStream;
 
 /**
  * This class represents a CFF/Type2 Font (aka Type1C Font).
@@ -93,8 +93,6 @@ public class PDType1CFont extends PDSimpleFont
 
     private static final byte[] SPACE_BYTES = {(byte)32};
 
-    private COSDictionary descendantDescriptor = null;
-    private COSDictionary fontDescriptor = null;
     private COSDictionary fontDict = null;
     
     /**
@@ -105,21 +103,6 @@ public class PDType1CFont extends PDSimpleFont
     {
         super( fontDictionary );
         fontDict = fontDictionary;
-        fontDescriptor = (COSDictionary)fontDict.getDictionaryObject(COSName.FONT_DESC);
-        if (fontDescriptor == null)
-        {
-            fontDescriptor = fontDict;
-        }
-        COSArray descendantFontArray =
-            (COSArray)fontDescriptor.getDictionaryObject( COSName.DESCENDANT_FONTS );
-        if (descendantFontArray != null) 
-        {
-            descendantDescriptor = (COSDictionary)descendantFontArray.getObject( 0 );
-            if (descendantDescriptor != null)
-            {
-                descendantDescriptor = (COSDictionary)descendantDescriptor.getDictionaryObject( COSName.FONT_DESC );
-            }
-        }
         load();
     }
 
@@ -244,13 +227,6 @@ public class PDType1CFont extends PDSimpleFont
         return (Integer)this.characterToCode.get(character);
     }
 
-    /**
-     * {@inheritDoc}
-     */
-    public PDFontDescriptor getFontDescriptor() throws IOException
-    {
-        return new PDFontDescriptorAFM(this.fontMetric);
-    }
 
     /**
      * {@inheritDoc}
@@ -409,18 +385,15 @@ public class PDType1CFont extends PDSimpleFont
 
     private byte[] loadBytes() throws IOException
     {
-        if( fontDescriptor != null )
+        PDFontDescriptor fd = getFontDescriptor();
+        if( fd != null && fd instanceof PDFontDescriptorDictionary)
         {
-            COSStream ff3Stream = (COSStream)fontDescriptor.getDictionaryObject(COSName.FONT_FILE3);
-            if( ff3Stream == null )
-            {
-                ff3Stream = (COSStream)descendantDescriptor.getDictionaryObject(COSName.FONT_FILE3);
-            }
+            PDStream ff3Stream = ((PDFontDescriptorDictionary)fd).getFontFile3();
             if( ff3Stream != null )
             {
                 ByteArrayOutputStream os = new ByteArrayOutputStream();
 
-                InputStream is = ff3Stream.getUnfilteredStream();
+                InputStream is = ff3Stream.createInputStream();
                 try
                 {
                     byte[] buf = new byte[512];
@@ -449,7 +422,7 @@ public class PDType1CFont extends PDSimpleFont
     private Map<Integer,String> loadOverride() throws IOException
     {
         Map<Integer,String> result = new LinkedHashMap<Integer,String>();
-        COSBase encoding = descendantDescriptor != null ? descendantDescriptor.getDictionaryObject(COSName.ENCODING) : fontDict.getDictionaryObject(COSName.ENCODING);
+        COSBase encoding = fontDict.getDictionaryObject(COSName.ENCODING);
         if( encoding instanceof COSName )
         {
             COSName name = (COSName)encoding;
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType1Font.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType1Font.java
index ed74554a91..d1f71ffaf0 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType1Font.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/font/PDType1Font.java
@@ -18,15 +18,24 @@ package org.apache.pdfbox.pdmodel.font;
 
 import java.awt.Font;
 import java.awt.FontFormatException;
+import java.io.BufferedReader;
 import java.io.IOException;
+import java.io.InputStreamReader;
 import java.util.HashMap;
 import java.util.Map;
+import java.util.StringTokenizer;
 
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
+import org.apache.fontbox.afm.FontMetric;
 import org.apache.pdfbox.cos.COSDictionary;
 import org.apache.pdfbox.cos.COSName;
+import org.apache.pdfbox.encoding.AFMEncoding;
+import org.apache.pdfbox.encoding.Encoding;
+import org.apache.pdfbox.encoding.EncodingManager;
+import org.apache.pdfbox.encoding.Type1Encoding;
 import org.apache.pdfbox.encoding.WinAnsiEncoding;
+import org.apache.pdfbox.pdmodel.common.PDStream;
 
 /**
  * This is implementation of the Type1 Font.
@@ -42,6 +51,7 @@ public class PDType1Font extends PDSimpleFont
      */
     private static final Log log = LogFactory.getLog(PDType1Font.class);
 
+    private PDType1CFont type1CFont = null;
     /**
      * Standard Base 14 Font.
      */
@@ -137,6 +147,21 @@ public class PDType1Font extends PDSimpleFont
     public PDType1Font( COSDictionary fontDictionary )
     {
         super( fontDictionary );
+        PDFontDescriptor fd = getFontDescriptor();
+        if (fd != null && fd instanceof PDFontDescriptorDictionary)
+        {
+            // a Type1 font may contain a Type1C font
+            PDStream fontFile3 = ((PDFontDescriptorDictionary)fd).getFontFile3();
+            if (fontFile3 != null)
+            {
+                try 
+                {
+                    type1CFont = new PDType1CFont( super.font );
+                    awtFont = type1CFont.getawtFont();
+                }
+                catch (IOException exception) {}
+            }
+        }
     }
 
     /**
@@ -197,21 +222,9 @@ public class PDType1Font extends PDSimpleFont
                         log.info("Can't read the embedded type1 font " + fd.getFontName() );
                     }
                 }
-                else if ( fdDictionary.getFontFile2() != null)
-                {
-                    try 
-                    {
-                        // create a true type font with the embedded data
-                        awtFont = Font.createFont( Font.TRUETYPE_FONT, fdDictionary.getFontFile2().createInputStream() );
-                    } 
-                    catch (FontFormatException e) 
-                    {
-                        log.info("Can't read the embedded true type font " + fd.getFontName() );
-                    }
-                }
                 else if( fdDictionary.getFontFile3() != null)
                 {
-                    PDType1CFont type1CFont = new PDType1CFont( super.font );
+                    type1CFont = new PDType1CFont( super.font );
                     awtFont = type1CFont.getawtFont();
                 }
                 
@@ -243,5 +256,113 @@ public class PDType1Font extends PDSimpleFont
         }
         return awtFont;
     }
+
+    protected void determineEncoding()
+    {
+        super.determineEncoding();
+        Encoding fontEncoding = getEncoding();
+        if(fontEncoding == null)
+        {
+            FontMetric metric = getAFM();
+            if (metric != null)
+            {
+                fontEncoding = new AFMEncoding( metric );
+            }
+        }
+        if (fontEncoding == null)
+        {
+            getEncodingFromFont();
+        }
+        setEncoding(fontEncoding);
+    }
     
+    /**
+     * Tries to get the encoding for the type1 font.
+     *
+     */
+    private void getEncodingFromFont()
+    {
+        // This whole section of code needs to be replaced with an actual type1 font parser!!
+        // Get the font program from the embedded type font.
+        PDFontDescriptor fontDescriptor = getFontDescriptor();
+        if( fontDescriptor != null && fontDescriptor instanceof PDFontDescriptorDictionary)
+        {
+            PDStream fontFile = ((PDFontDescriptorDictionary)fontDescriptor).getFontFile();
+            if( fontFile != null )
+            {
+                try 
+                {
+                    BufferedReader in =
+                            new BufferedReader(new InputStreamReader(fontFile.createInputStream()));
+                    
+                    // this section parses the font program stream searching for a /Encoding entry
+                    // if it contains an array of values a Type1Encoding will be returned
+                    // if it encoding contains an encoding name the corresponding Encoding will be returned
+                    String line = "";
+                    Type1Encoding encoding = null;
+                    while( (line = in.readLine()) != null)
+                    {
+                        if (line.startsWith("currentdict end")) {
+                            if (encoding != null)
+                                setEncoding(encoding);
+                            break;
+                        }
+                        if (line.startsWith("/Encoding")) 
+                        {
+                            if(line.contains("array")) 
+                            {
+                                StringTokenizer st = new StringTokenizer(line);
+                                // ignore the first token
+                                st.nextElement();
+                                int arraySize = Integer.parseInt(st.nextToken());
+                                encoding = new Type1Encoding(arraySize);
+                            }
+                            // if there is already an encoding, we don't need to
+                            // assign another one
+                            else if (getEncoding() == null)
+                            {
+                                StringTokenizer st = new StringTokenizer(line);
+                                // ignore the first token
+                                st.nextElement();
+                                String type1Encoding = st.nextToken();
+                                setEncoding(
+                                    EncodingManager.INSTANCE.getEncoding(
+                                            COSName.getPDFName(type1Encoding)));
+                                break;
+                            }
+                        }
+                        else if (line.startsWith("dup")) {
+                            StringTokenizer st = new StringTokenizer(line.replaceAll("/"," /"));
+                            // ignore the first token
+                            st.nextElement();
+                            int index = Integer.parseInt(st.nextToken());
+                            String name = st.nextToken();
+                            if(encoding == null)
+                                log.warn("Unable to get character encoding.  Encoding defintion found without /Encoding line.");
+                            else
+                                encoding.addCharacterEncoding(index, name.replace("/", ""));
+                        }
+                    }
+                    in.close();
+                }
+                catch(IOException exception) 
+                {
+                    log.error("Error: Could not extract the encoding from the embedded type1 font.");
+                }
+            }
+        }
+    }
+
+    @Override
+    public String encode(byte[] c, int offset, int length) throws IOException
+    {
+        if (type1CFont != null && getEncoding() == null)
+        {
+            return type1CFont.encode(c, offset, length);
+        }
+        else
+        {
+            return super.encode(c, offset, length);
+        }
+    }
 }
