diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/COSWriter.java b/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/COSWriter.java
index a936327b36..d1927c505f 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/COSWriter.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/COSWriter.java
@@ -1222,6 +1222,8 @@ public class COSWriter implements ICOSVisitor, Closeable
      * @param signInterface class to be used for signing 
      *
      * @throws IOException If an error occurs while generating the data.
+     * @throws IllegalStateException If the document has an encryption dictionary but no protection
+     * policy.
      */
     public void write(PDDocument doc, SignatureInterface signInterface) throws IOException
     {
@@ -1251,6 +1253,11 @@ public class COSWriter implements ICOSVisitor, Closeable
             if (pdDocument.getEncryption() != null)
             {
                 SecurityHandler securityHandler = pdDocument.getEncryption().getSecurityHandler();
+                if (!securityHandler.hasProtectionPolicy())
+                {
+                    throw new IllegalStateException("PDF contains an encryption dictionary, please remove it with "
+                            + "setAllSecurityToBeRemoved() or set a protection policy with protect()");
+                }
                 securityHandler.prepareDocumentForEncryption(pdDocument);
                 willEncrypt = true;
             }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/PublicKeySecurityHandler.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/PublicKeySecurityHandler.java
index 90beb47eca..d8cdaaa69a 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/PublicKeySecurityHandler.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/PublicKeySecurityHandler.java
@@ -483,4 +483,13 @@ public final class PublicKeySecurityHandler extends SecurityHandler
         RecipientIdentifier recipientId = new RecipientIdentifier(serial);
         return new KeyTransRecipientInfo(recipientId, algorithmId, octets);
     }
+    
+    /**
+     * {@inheritDoc}
+     */
+    @Override
+    public boolean hasProtectionPolicy()
+    {
+        return policy != null;
+    }
 }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/SecurityHandler.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/SecurityHandler.java
index d1bf937034..64c0ee88d5 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/SecurityHandler.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/SecurityHandler.java
@@ -533,4 +533,11 @@ public abstract class SecurityHandler
     {
         useAES = aesValue;
     }
+
+    /**
+     * Returns whether a protection policy has been set.
+     * 
+     * @return true if a protection policy has been set.
+     */
+    public abstract boolean hasProtectionPolicy();
 }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/StandardSecurityHandler.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/StandardSecurityHandler.java
index f6a245222c..4f0e5f6d4c 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/StandardSecurityHandler.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/StandardSecurityHandler.java
@@ -1152,4 +1152,12 @@ public final class StandardSecurityHandler extends SecurityHandler
         }
     }
 
+    /**
+     * {@inheritDoc}
+     */
+    @Override
+    public boolean hasProtectionPolicy()
+    {
+        return policy != null;
+    }
 }
