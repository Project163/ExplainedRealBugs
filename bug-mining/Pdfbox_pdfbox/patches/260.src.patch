diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/CompositeImage.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/CompositeImage.java
index 4d0ad17eb7..5310a28567 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/CompositeImage.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/CompositeImage.java
@@ -17,6 +17,7 @@
 package org.apache.pdfbox.pdmodel.graphics.xobject;
 
 import java.awt.image.BufferedImage;
+import java.awt.image.WritableRaster;
 import java.io.IOException;
 
 import org.apache.pdfbox.cos.COSArray;
@@ -56,6 +57,11 @@ public class CompositeImage
     /**
      * This method applies the specified transparency mask to a given image and returns a new BufferedImage
      * whose alpha values are computed from the transparency mask (smask) image.
+     * 
+     * @param decodeArray the decode array
+     * @return the masked image
+     * @throws IOException if something went wrong
+     * 
      */
     public BufferedImage createMaskedImage(COSArray decodeArray) throws IOException
     {
@@ -71,7 +77,6 @@ public class CompositeImage
 
         final int baseImageWidth = baseImage.getWidth();
         final int baseImageHeight = baseImage.getHeight();
-
         BufferedImage result = new BufferedImage(baseImageWidth, baseImageHeight, BufferedImage.TYPE_INT_ARGB);
         for (int x = 0; x < baseImageWidth; x++)
         {
@@ -101,4 +106,32 @@ public class CompositeImage
         }
         return result;
     }
+
+    /**
+     * This method applies the specified stencil mask to a given image and returns a new BufferedImage
+     * whose alpha values are computed from the stencil mask (smask) image.
+     * 
+     * @return the stencil masked image 
+     */
+    public BufferedImage createStencilMaskedImage()
+    {
+        final int baseImageWidth = baseImage.getWidth();
+        final int baseImageHeight = baseImage.getHeight();
+        WritableRaster maskRaster = smaskImage.getRaster();
+        BufferedImage result = new BufferedImage(baseImageWidth, baseImageHeight, BufferedImage.TYPE_INT_ARGB);
+        int[] alpha = new int[1];
+        for (int x = 0; x < baseImageWidth; x++)
+        {
+            for (int y = 0; y < baseImageHeight; y++)
+            {
+                maskRaster.getPixel(x, y, alpha);
+                // We need to remove any alpha value in the main image.
+                int rgbOnly = 0x00FFFFFF & baseImage.getRGB(x, y);
+                int alphaOnly = alpha[0] == 0 ? 0xFF000000 : 0;
+                result.setRGB(x, y, rgbOnly | alphaOnly);
+            }
+        }
+        return result;
+    }
+
 }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/PDJpeg.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/PDJpeg.java
index 6935bd34c5..8c98d67878 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/PDJpeg.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/PDJpeg.java
@@ -43,7 +43,7 @@ import javax.imageio.ImageReader;
 import javax.imageio.metadata.IIOMetadata;
 import javax.imageio.stream.ImageInputStream;
 
-import org.apache.pdfbox.cos.COSArray;
+import org.apache.pdfbox.cos.COSBase;
 import org.apache.pdfbox.cos.COSDictionary;
 import org.apache.pdfbox.cos.COSName;
 
@@ -279,19 +279,26 @@ public class PDJpeg extends PDXObjectImage
             bi = ImageIO.read(bai);
         }
 
-        // If there is a 'soft mask' image then we use that as a transparency mask.
-        PDXObjectImage smask = getSMaskImage();
-        if (smask != null)
+        // If there is a 'soft mask' or 'mask' image then we use that as a transparency mask.
+        PDXObjectImage maskImage = getSMaskImage();
+        if (maskImage != null)
         {
-            BufferedImage smaskBI = smask.getRGBImage();
-
-            COSArray decodeArray = smask.getDecode();
-            CompositeImage compositeImage = new CompositeImage(bi, smaskBI);
-            BufferedImage rgbImage = compositeImage.createMaskedImage(decodeArray);
-
+            CompositeImage compositeImage = new CompositeImage(bi, maskImage.getRGBImage());
+            BufferedImage rgbImage = compositeImage.createMaskedImage(maskImage.getDecode());
             image = rgbImage;
         }
         else
+        {
+            COSBase mask = getMask();
+            if (mask != null && mask instanceof COSDictionary)
+            {
+            	maskImage = (PDXObjectImage)PDXObject.createXObject(mask);
+                CompositeImage compositeImage = new CompositeImage(bi, maskImage.getRGBImage());
+                BufferedImage rgbImage = compositeImage.createStencilMaskedImage();
+                image = rgbImage;
+            }	
+        }
+        if (image == null)
         {
             // But if there is no soft mask, use the unaltered image.
             image = bi;
