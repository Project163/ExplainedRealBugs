diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDAcroForm.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDAcroForm.java
index f84c271538..1da2ef3443 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDAcroForm.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/interactive/form/PDAcroForm.java
@@ -798,16 +798,7 @@ public final class PDAcroForm implements COSObjectable
         // If there is a widget with a missing page reference we need to build the map reverse i.e. 
         // from the annotations to the widget.
         LOG.warn("There has been a widget with a missing page reference, will check all page annotations");
-        Set<COSDictionary> widgetDictionarySet = new HashSet<>();
-        for (PDField field : fields)
-        {
-            List<PDAnnotationWidget> widgets = field.getWidgets();
-            for (PDAnnotationWidget widget : widgets)
-            {
-                widgetDictionarySet.add(widget.getCOSObject());
-            }
-        }
-
+        Set<COSDictionary> widgetDictionarySet = createWidgetDictionarySet(fields);
         for (PDPage page : pages)
         {
             for (PDAnnotation annotation : page.getAnnotations())
@@ -822,6 +813,26 @@ public final class PDAcroForm implements COSObjectable
         return pagesAnnotationsMap;
     }
 
+    /**
+     * Return a set of all annotation widget dictionaries related to the fields to be flattened.
+     *
+     * @param fields
+     * @return
+     */
+    private Set<COSDictionary> createWidgetDictionarySet(List<PDField> fields)
+    {
+        Set<COSDictionary> widgetDictionarySet = new HashSet<>();
+        for (PDField field : fields)
+        {
+            List<PDAnnotationWidget> widgets = field.getWidgets();
+            for (PDAnnotationWidget widget : widgets)
+            {
+                widgetDictionarySet.add(widget.getCOSObject());
+            }
+        }
+        return widgetDictionarySet;
+    }
+
     private void fillPagesAnnotationMap(Map<COSDictionary, Set<COSDictionary>> pagesAnnotationsMap,
             PDPage page, PDAnnotationWidget widget)
     {
