diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/compress/COSWriterCompressionPool.java b/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/compress/COSWriterCompressionPool.java
index bf679cc69b..e008661ab0 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/compress/COSWriterCompressionPool.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/compress/COSWriterCompressionPool.java
@@ -190,7 +190,7 @@ public class COSWriterCompressionPool
                 {
                     continue;
                 }
-                if (!traversedObject.getAllTraversedObjects().contains(value))
+                if (cosObject.getObject() != null)
                 {
                     addStructure(traversedObject.appendTraversedElement(value));
                 }
@@ -216,7 +216,7 @@ public class COSWriterCompressionPool
                 {
                     continue;
                 }
-                if (!traversedObject.getAllTraversedObjects().contains(value))
+                if (cosObject.getObject() != null)
                 {
                     addStructure(traversedObject.appendTraversedElement(value));
                 }
