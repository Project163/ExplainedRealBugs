diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDShadingType4.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDShadingType4.java
index 92a6d1fa3f..8978d5ddee 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDShadingType4.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDShadingType4.java
@@ -192,7 +192,8 @@ public class PDShadingType4 extends PDTriangleBasedShadingType
                             }
                             break;
                         default:
-                            LOG.warn("bad flag: {}", flag);
+                            LOG.warn("bad flag {}, aborting", flag);
+                            eof = true;
                             break;
                         }
                     }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java
index cd6248d392..44bff96c2a 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/shading/PDTriangleBasedShadingType.java
@@ -197,6 +197,10 @@ abstract class PDTriangleBasedShadingType extends PDShading
                                 PDRange rangeX, PDRange rangeY, PDRange[] colRangeTab,
                                 Matrix matrix, AffineTransform xform) throws IOException
     {
+        if (bitsPerCoordinate <= 0 || numberOfColorComponents <= 0 || bitsPerColorComponent <= 0)
+        {
+            throw new IOException("nothing to read, check bitsPerCoordinate, numberOfColorComponents and bitsPerColorComponent");
+        }
         float[] colorComponentTab = new float[numberOfColorComponents];
         long x = input.readBits(bitsPerCoordinate);
         long y = input.readBits(bitsPerCoordinate);
