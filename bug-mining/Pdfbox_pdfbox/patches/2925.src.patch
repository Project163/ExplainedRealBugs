diff --git a/pdfbox/src/main/java/org/apache/pdfbox/multipdf/Splitter.java b/pdfbox/src/main/java/org/apache/pdfbox/multipdf/Splitter.java
index d11da8e3aa..1f7935708e 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/multipdf/Splitter.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/multipdf/Splitter.java
@@ -54,6 +54,8 @@ import org.apache.pdfbox.pdmodel.interactive.action.PDActionFactory;
 import org.apache.pdfbox.pdmodel.interactive.action.PDActionGoTo;
 import org.apache.pdfbox.pdmodel.interactive.annotation.PDAnnotation;
 import org.apache.pdfbox.pdmodel.interactive.annotation.PDAnnotationLink;
+import org.apache.pdfbox.pdmodel.interactive.annotation.PDAnnotationMarkup;
+import org.apache.pdfbox.pdmodel.interactive.annotation.PDAnnotationPopup;
 import org.apache.pdfbox.pdmodel.interactive.annotation.PDAppearanceStream;
 import org.apache.pdfbox.pdmodel.interactive.documentnavigation.destination.PDDestination;
 import org.apache.pdfbox.pdmodel.interactive.documentnavigation.destination.PDPageDestination;
@@ -715,6 +717,13 @@ public class Splitter
         pageDictMap.put(page.getCOSObject(), imported.getCOSObject());
     }
 
+    /**
+     * Clone all annotations because of changes possibly made, and because the structure tree is
+     * cloned.
+     *
+     * @param imported
+     * @throws IOException 
+     */
     private void processAnnotations(PDPage imported) throws IOException
     {
         List<PDAnnotation> annotations = imported.getAnnotations();
@@ -783,6 +792,60 @@ public class Splitter
                 annotationClone.setPage(imported);
             }
         }
+        // Second loop for markup and popup annotations, which reference annotations themselves
+        for (PDAnnotation annotation : clonedAnnotations)
+        {
+            if (annotation instanceof PDAnnotationMarkup)
+            {
+                PDAnnotationPopup annotationPopup = ((PDAnnotationMarkup) annotation).getPopup();
+                COSDictionary clonedPopupDict = annotDictMap.get(annotationPopup.getCOSObject());
+                if (clonedPopupDict != null)
+                {
+                    annotation.getCOSObject().setItem(COSName.POPUP, clonedPopupDict);
+                }
+                else
+                {
+                    // orphan popup (not in annotation list); clone it and fix references 
+                    clonedPopupDict = new COSDictionary(annotationPopup.getCOSObject());
+                    annotDictMap.put(annotationPopup.getCOSObject(), clonedPopupDict);
+                    PDAnnotationPopup annotationPopupClone =
+                            (PDAnnotationPopup) PDAnnotation.createAnnotation(clonedPopupDict);
+                    annotationPopupClone.setParent((PDAnnotationMarkup) annotation);
+                    ((PDAnnotationMarkup) annotation).setPopup(annotationPopupClone);
+                    if (annotationPopupClone.getPage() != null)
+                    {
+                        annotationPopupClone.setPage(imported);
+                    }
+                }
+            }
+            if (annotation instanceof PDAnnotationPopup)
+            {
+                PDAnnotationMarkup annotationMarkup = ((PDAnnotationPopup) annotation).getParent();
+                if (annotationMarkup == null)
+                {
+                    continue;
+                }
+                COSDictionary clonedMarkupDict = annotDictMap.get(annotationMarkup.getCOSObject());
+                if (clonedMarkupDict != null)
+                {
+                    annotation.getCOSObject().setItem(COSName.PARENT, clonedMarkupDict);
+                }
+                else
+                {
+                    // orphan markup (not in annotation list); clone it and fix references 
+                    clonedMarkupDict = new COSDictionary(annotationMarkup.getCOSObject());
+                    annotDictMap.put(annotationMarkup.getCOSObject(), clonedMarkupDict);
+                    PDAnnotationMarkup annotationMarkupClone =
+                            (PDAnnotationMarkup) PDAnnotation.createAnnotation(clonedMarkupDict);
+                    annotationMarkupClone.setPopup((PDAnnotationPopup) annotation);
+                    ((PDAnnotationPopup) annotation).setParent(annotationMarkupClone);
+                    if (annotationMarkupClone.getPage() != null)
+                    {
+                        annotationMarkupClone.setPage(imported);
+                    }
+                }
+            }
+        }
         imported.setAnnotations(clonedAnnotations);
     }
 
diff --git a/pdfbox/src/test/java/org/apache/pdfbox/multipdf/PDFMergerUtilityTest.java b/pdfbox/src/test/java/org/apache/pdfbox/multipdf/PDFMergerUtilityTest.java
index 6a1423c291..13cc06ff02 100644
--- a/pdfbox/src/test/java/org/apache/pdfbox/multipdf/PDFMergerUtilityTest.java
+++ b/pdfbox/src/test/java/org/apache/pdfbox/multipdf/PDFMergerUtilityTest.java
@@ -47,6 +47,8 @@ import org.apache.pdfbox.pdmodel.documentinterchange.logicalstructure.PDStructur
 import org.apache.pdfbox.pdmodel.interactive.action.PDActionGoTo;
 import org.apache.pdfbox.pdmodel.interactive.annotation.PDAnnotation;
 import org.apache.pdfbox.pdmodel.interactive.annotation.PDAnnotationLink;
+import org.apache.pdfbox.pdmodel.interactive.annotation.PDAnnotationPopup;
+import org.apache.pdfbox.pdmodel.interactive.annotation.PDAnnotationText;
 import org.apache.pdfbox.pdmodel.interactive.annotation.PDAnnotationWidget;
 import org.apache.pdfbox.pdmodel.interactive.documentnavigation.destination.PDPageDestination;
 import org.apache.pdfbox.pdmodel.interactive.documentnavigation.destination.PDPageFitDestination;
@@ -1135,4 +1137,41 @@ class PDFMergerUtilityTest
             }
         }
     }
+
+    @Test
+    void testSplitWithPopupAnnotations() throws IOException
+    {
+        try (PDDocument doc = Loader.loadPDF(new File(SRCDIR, "PDFBOX-5809-509329.pdf")))
+        {
+            Splitter splitter = new Splitter();
+            splitter.setStartPage(3);
+            splitter.setEndPage(3);
+            splitter.setSplitAtPage(1);
+            List<PDDocument> splitResult = splitter.split(doc);
+            assertEquals(1, splitResult.size());
+            List<PDAnnotation> annotations;
+            PDAnnotationText annotationText3;
+            PDAnnotationPopup annotationPopup4;
+            try (PDDocument dstDoc = splitResult.get(0))
+            {
+                checkForPageOrphans(dstDoc);
+                assertEquals(1, dstDoc.getNumberOfPages());
+                annotations = dstDoc.getPage(0).getAnnotations();
+                assertEquals(5, annotations.size());
+                annotationText3 = (PDAnnotationText) annotations.get(3);
+                annotationPopup4 = (PDAnnotationPopup) annotations.get(4);
+                assertEquals(annotationText3.getPopup(), annotationPopup4);
+                assertEquals(annotationPopup4.getParent(), annotationText3);
+                assertEquals(annotationText3.getPage(), dstDoc.getPage(0));
+            }
+            // Check that source document is ok
+            annotations = doc.getPage(2).getAnnotations();
+            assertEquals(5, annotations.size());
+            annotationText3 = (PDAnnotationText) annotations.get(3);
+            annotationPopup4 = (PDAnnotationPopup) annotations.get(4);
+            assertEquals(annotationText3.getPopup(), annotationPopup4);
+            assertEquals(annotationPopup4.getParent(), annotationText3);
+            assertEquals(annotationText3.getPage(), doc.getPage(2));
+        }
+    }
 }
diff --git a/pdfbox/src/test/resources/input/merge/PDFBOX-5809-509329.pdf b/pdfbox/src/test/resources/input/merge/PDFBOX-5809-509329.pdf
new file mode 100644
index 0000000000..6f24c4270a
Binary files /dev/null and b/pdfbox/src/test/resources/input/merge/PDFBOX-5809-509329.pdf differ
