diff --git a/pdfbox/src/main/java/org/apache/pdfbox/contentstream/PDFGraphicsStreamEngine.java b/pdfbox/src/main/java/org/apache/pdfbox/contentstream/PDFGraphicsStreamEngine.java
index c7dafdf8b7..f51f46ae38 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/contentstream/PDFGraphicsStreamEngine.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/contentstream/PDFGraphicsStreamEngine.java
@@ -1,258 +1,264 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.pdfbox.contentstream;
-
-import org.apache.pdfbox.cos.COSName;
-import org.apache.pdfbox.pdmodel.PDPage;
-import org.apache.pdfbox.pdmodel.graphics.image.PDImage;
-
-import java.awt.geom.Point2D;
-import java.io.IOException;
-import org.apache.pdfbox.contentstream.operator.color.SetNonStrokingColor;
-import org.apache.pdfbox.contentstream.operator.color.SetNonStrokingColorN;
-import org.apache.pdfbox.contentstream.operator.color.SetNonStrokingColorSpace;
-import org.apache.pdfbox.contentstream.operator.color.SetNonStrokingDeviceCMYKColor;
-import org.apache.pdfbox.contentstream.operator.color.SetNonStrokingDeviceGrayColor;
-import org.apache.pdfbox.contentstream.operator.color.SetNonStrokingDeviceRGBColor;
-import org.apache.pdfbox.contentstream.operator.color.SetStrokingColor;
-import org.apache.pdfbox.contentstream.operator.color.SetStrokingColorN;
-import org.apache.pdfbox.contentstream.operator.color.SetStrokingColorSpace;
-import org.apache.pdfbox.contentstream.operator.color.SetStrokingDeviceCMYKColor;
-import org.apache.pdfbox.contentstream.operator.color.SetStrokingDeviceGrayColor;
-import org.apache.pdfbox.contentstream.operator.color.SetStrokingDeviceRGBColor;
-import org.apache.pdfbox.contentstream.operator.graphics.AppendRectangleToPath;
-import org.apache.pdfbox.contentstream.operator.graphics.BeginInlineImage;
-import org.apache.pdfbox.contentstream.operator.graphics.ClipEvenOddRule;
-import org.apache.pdfbox.contentstream.operator.graphics.ClipNonZeroRule;
-import org.apache.pdfbox.contentstream.operator.graphics.CloseAndStrokePath;
-import org.apache.pdfbox.contentstream.operator.graphics.CloseFillEvenOddAndStrokePath;
-import org.apache.pdfbox.contentstream.operator.graphics.CloseFillNonZeroAndStrokePath;
-import org.apache.pdfbox.contentstream.operator.graphics.ClosePath;
-import org.apache.pdfbox.contentstream.operator.graphics.CurveTo;
-import org.apache.pdfbox.contentstream.operator.graphics.CurveToReplicateFinalPoint;
-import org.apache.pdfbox.contentstream.operator.graphics.CurveToReplicateInitialPoint;
-import org.apache.pdfbox.contentstream.operator.graphics.DrawObject;
-import org.apache.pdfbox.contentstream.operator.graphics.EndPath;
-import org.apache.pdfbox.contentstream.operator.graphics.FillEvenOddAndStrokePath;
-import org.apache.pdfbox.contentstream.operator.graphics.FillEvenOddRule;
-import org.apache.pdfbox.contentstream.operator.graphics.FillNonZeroAndStrokePath;
-import org.apache.pdfbox.contentstream.operator.graphics.FillNonZeroRule;
-import org.apache.pdfbox.contentstream.operator.graphics.LegacyFillNonZeroRule;
-import org.apache.pdfbox.contentstream.operator.graphics.LineTo;
-import org.apache.pdfbox.contentstream.operator.graphics.MoveTo;
-import org.apache.pdfbox.contentstream.operator.graphics.ShadingFill;
-import org.apache.pdfbox.contentstream.operator.graphics.StrokePath;
-import org.apache.pdfbox.contentstream.operator.state.Concatenate;
-import org.apache.pdfbox.contentstream.operator.state.Restore;
-import org.apache.pdfbox.contentstream.operator.state.Save;
-import org.apache.pdfbox.contentstream.operator.state.SetFlatness;
-import org.apache.pdfbox.contentstream.operator.state.SetGraphicsStateParameters;
-import org.apache.pdfbox.contentstream.operator.state.SetLineCapStyle;
-import org.apache.pdfbox.contentstream.operator.state.SetLineDashPattern;
-import org.apache.pdfbox.contentstream.operator.state.SetLineJoinStyle;
-import org.apache.pdfbox.contentstream.operator.state.SetLineMiterLimit;
-import org.apache.pdfbox.contentstream.operator.state.SetLineWidth;
-import org.apache.pdfbox.contentstream.operator.state.SetMatrix;
-import org.apache.pdfbox.contentstream.operator.state.SetRenderingIntent;
-import org.apache.pdfbox.contentstream.operator.text.BeginText;
-import org.apache.pdfbox.contentstream.operator.text.EndText;
-import org.apache.pdfbox.contentstream.operator.text.SetFontAndSize;
-import org.apache.pdfbox.contentstream.operator.text.SetTextHorizontalScaling;
-import org.apache.pdfbox.contentstream.operator.text.ShowTextAdjusted;
-import org.apache.pdfbox.contentstream.operator.text.ShowTextLine;
-import org.apache.pdfbox.contentstream.operator.text.ShowTextLineAndSpace;
-import org.apache.pdfbox.contentstream.operator.text.MoveText;
-import org.apache.pdfbox.contentstream.operator.text.MoveTextSetLeading;
-import org.apache.pdfbox.contentstream.operator.text.NextLine;
-import org.apache.pdfbox.contentstream.operator.text.SetCharSpacing;
-import org.apache.pdfbox.contentstream.operator.text.SetTextLeading;
-import org.apache.pdfbox.contentstream.operator.text.SetTextRenderingMode;
-import org.apache.pdfbox.contentstream.operator.text.SetTextRise;
-import org.apache.pdfbox.contentstream.operator.text.SetWordSpacing;
-import org.apache.pdfbox.contentstream.operator.text.ShowText;
-
-/**
- * PDFStreamEngine subclass for advanced processing of graphics.
- * This class should be subclassed by end users looking to hook into graphics operations.
- *
- * @author John Hewson
- */
-public abstract class PDFGraphicsStreamEngine extends PDFStreamEngine
-{
-    // may be null, for example if the stream is a tiling pattern
-    private final PDPage page;
-
-    /**
-     * Constructor.
-     */
-    protected PDFGraphicsStreamEngine(PDPage page)
-    {
-        this.page = page;
-
-        addOperator(new CloseFillNonZeroAndStrokePath());
-        addOperator(new FillNonZeroAndStrokePath());
-        addOperator(new CloseFillEvenOddAndStrokePath());
-        addOperator(new FillEvenOddAndStrokePath());
-        addOperator(new BeginInlineImage());
-        addOperator(new BeginText());
-        addOperator(new CurveTo());
-        addOperator(new Concatenate());
-        addOperator(new SetStrokingColorSpace());
-        addOperator(new SetNonStrokingColorSpace());
-        addOperator(new SetLineDashPattern());
-        addOperator(new DrawObject()); // special graphics version
-        addOperator(new EndText());
-        addOperator(new FillNonZeroRule());
-        addOperator(new LegacyFillNonZeroRule());
-        addOperator(new FillEvenOddRule());
-        addOperator(new SetStrokingDeviceGrayColor());
-        addOperator(new SetNonStrokingDeviceGrayColor());
-        addOperator(new SetGraphicsStateParameters());
-        addOperator(new ClosePath());
-        addOperator(new SetFlatness());
-        addOperator(new SetLineJoinStyle());
-        addOperator(new SetLineCapStyle());
-        addOperator(new SetStrokingDeviceCMYKColor());
-        addOperator(new SetNonStrokingDeviceCMYKColor());
-        addOperator(new LineTo());
-        addOperator(new MoveTo());
-        addOperator(new SetLineMiterLimit());
-        addOperator(new EndPath());
-        addOperator(new Save());
-        addOperator(new Restore());
-        addOperator(new AppendRectangleToPath());
-        addOperator(new SetStrokingDeviceRGBColor());
-        addOperator(new SetNonStrokingDeviceRGBColor());
-        addOperator(new SetRenderingIntent());
-        addOperator(new CloseAndStrokePath());
-        addOperator(new StrokePath());
-        addOperator(new SetStrokingColor());
-        addOperator(new SetNonStrokingColor());
-        addOperator(new SetStrokingColorN());
-        addOperator(new SetNonStrokingColorN());
-        addOperator(new ShadingFill());
-        addOperator(new NextLine());
-        addOperator(new SetCharSpacing());
-        addOperator(new MoveText());
-        addOperator(new MoveTextSetLeading());
-        addOperator(new SetFontAndSize());
-        addOperator(new ShowText());
-        addOperator(new ShowTextAdjusted());
-        addOperator(new SetTextLeading());
-        addOperator(new SetMatrix());
-        addOperator(new SetTextRenderingMode());
-        addOperator(new SetTextRise());
-        addOperator(new SetWordSpacing());
-        addOperator(new SetTextHorizontalScaling());
-        addOperator(new CurveToReplicateInitialPoint());
-        addOperator(new SetLineWidth());
-        addOperator(new ClipNonZeroRule());
-        addOperator(new ClipEvenOddRule());
-        addOperator(new CurveToReplicateFinalPoint());
-        addOperator(new ShowTextLine());
-        addOperator(new ShowTextLineAndSpace());
-    }
-
-    /**
-     * Returns the page.
-     */
-    protected final PDPage getPage()
-    {
-        return page;
-    }
-
-    /**
-     * Append a rectangle to the current path.
-     */
-    public abstract void appendRectangle(Point2D p0, Point2D p1,
-                                         Point2D p2, Point2D p3) throws IOException;
-
-    /**
-     * Draw the image.
-     *
-     * @param pdImage The image to draw.
-     */
-    public abstract void drawImage(PDImage pdImage) throws IOException;
-
-    /**
-     * Modify the current clipping path by intersecting it with the current path.
-     * The clipping path will not be updated until the succeeding painting operator is called.
-     *
-     * @param windingRule The winding rule which will be used for clipping.
-     */
-    public abstract void clip(int windingRule) throws IOException;
-
-    /**
-     * Starts a new path at (x,y).
-     */
-    public abstract void moveTo(float x, float y) throws IOException;
-
-    /**
-     * Draws a line from the current point to (x,y).
-     */
-    public abstract void lineTo(float x, float y) throws IOException;
-
-    /**
-     * Draws a curve from the current point to (x3,y3) using (x1,y1) and (x2,y2) as control points.
-     */
-    public abstract void curveTo(float x1, float y1,
-                                 float x2, float y2,
-                                 float x3, float y3) throws IOException;
-
-    /**
-     * Returns the current point of the current path.
-     */
-    public abstract Point2D getCurrentPoint() throws IOException;
-
-    /**
-     * Closes the current path.
-     */
-    public abstract void closePath() throws IOException;
-
-    /**
-     * Ends the current path without filling or stroking it. The clipping path is updated here.
-     */
-    public abstract void endPath() throws IOException;
-
-    /**
-     * Stroke the path.
-     *
-     * @throws IOException If there is an IO error while stroking the path.
-     */
-    public abstract void strokePath() throws IOException;
-
-    /**
-     * Fill the path.
-     *
-     * @param windingRule The winding rule this path will use.
-     */
-    public abstract void fillPath(int windingRule) throws IOException;
-
-    /**
-     * Fills and then strokes the path.
-     *
-     * @param windingRule The winding rule this path will use.
-     */
-    public abstract void fillAndStrokePath(int windingRule) throws IOException;
-
-    /**
-     * Fill with Shading.
-     *
-     * @param shadingName The name of the Shading Dictionary to use for this fill instruction.
-     */
-    public abstract void shadingFill(COSName shadingName) throws IOException;
-}
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.pdfbox.contentstream;
+
+import org.apache.pdfbox.cos.COSName;
+import org.apache.pdfbox.pdmodel.PDPage;
+import org.apache.pdfbox.pdmodel.graphics.image.PDImage;
+
+import java.awt.geom.Point2D;
+import java.io.IOException;
+import org.apache.pdfbox.contentstream.operator.color.SetNonStrokingColor;
+import org.apache.pdfbox.contentstream.operator.color.SetNonStrokingColorN;
+import org.apache.pdfbox.contentstream.operator.color.SetNonStrokingColorSpace;
+import org.apache.pdfbox.contentstream.operator.color.SetNonStrokingDeviceCMYKColor;
+import org.apache.pdfbox.contentstream.operator.color.SetNonStrokingDeviceGrayColor;
+import org.apache.pdfbox.contentstream.operator.color.SetNonStrokingDeviceRGBColor;
+import org.apache.pdfbox.contentstream.operator.color.SetStrokingColor;
+import org.apache.pdfbox.contentstream.operator.color.SetStrokingColorN;
+import org.apache.pdfbox.contentstream.operator.color.SetStrokingColorSpace;
+import org.apache.pdfbox.contentstream.operator.color.SetStrokingDeviceCMYKColor;
+import org.apache.pdfbox.contentstream.operator.color.SetStrokingDeviceGrayColor;
+import org.apache.pdfbox.contentstream.operator.color.SetStrokingDeviceRGBColor;
+import org.apache.pdfbox.contentstream.operator.graphics.AppendRectangleToPath;
+import org.apache.pdfbox.contentstream.operator.graphics.BeginInlineImage;
+import org.apache.pdfbox.contentstream.operator.graphics.ClipEvenOddRule;
+import org.apache.pdfbox.contentstream.operator.graphics.ClipNonZeroRule;
+import org.apache.pdfbox.contentstream.operator.graphics.CloseAndStrokePath;
+import org.apache.pdfbox.contentstream.operator.graphics.CloseFillEvenOddAndStrokePath;
+import org.apache.pdfbox.contentstream.operator.graphics.CloseFillNonZeroAndStrokePath;
+import org.apache.pdfbox.contentstream.operator.graphics.ClosePath;
+import org.apache.pdfbox.contentstream.operator.graphics.CurveTo;
+import org.apache.pdfbox.contentstream.operator.graphics.CurveToReplicateFinalPoint;
+import org.apache.pdfbox.contentstream.operator.graphics.CurveToReplicateInitialPoint;
+import org.apache.pdfbox.contentstream.operator.graphics.DrawObject;
+import org.apache.pdfbox.contentstream.operator.graphics.EndPath;
+import org.apache.pdfbox.contentstream.operator.graphics.FillEvenOddAndStrokePath;
+import org.apache.pdfbox.contentstream.operator.graphics.FillEvenOddRule;
+import org.apache.pdfbox.contentstream.operator.graphics.FillNonZeroAndStrokePath;
+import org.apache.pdfbox.contentstream.operator.graphics.FillNonZeroRule;
+import org.apache.pdfbox.contentstream.operator.graphics.LegacyFillNonZeroRule;
+import org.apache.pdfbox.contentstream.operator.graphics.LineTo;
+import org.apache.pdfbox.contentstream.operator.graphics.MoveTo;
+import org.apache.pdfbox.contentstream.operator.graphics.ShadingFill;
+import org.apache.pdfbox.contentstream.operator.graphics.StrokePath;
+import org.apache.pdfbox.contentstream.operator.markedcontent.BeginMarkedContentSequence;
+import org.apache.pdfbox.contentstream.operator.markedcontent.BeginMarkedContentSequenceWithProperties;
+import org.apache.pdfbox.contentstream.operator.markedcontent.EndMarkedContentSequence;
+import org.apache.pdfbox.contentstream.operator.state.Concatenate;
+import org.apache.pdfbox.contentstream.operator.state.Restore;
+import org.apache.pdfbox.contentstream.operator.state.Save;
+import org.apache.pdfbox.contentstream.operator.state.SetFlatness;
+import org.apache.pdfbox.contentstream.operator.state.SetGraphicsStateParameters;
+import org.apache.pdfbox.contentstream.operator.state.SetLineCapStyle;
+import org.apache.pdfbox.contentstream.operator.state.SetLineDashPattern;
+import org.apache.pdfbox.contentstream.operator.state.SetLineJoinStyle;
+import org.apache.pdfbox.contentstream.operator.state.SetLineMiterLimit;
+import org.apache.pdfbox.contentstream.operator.state.SetLineWidth;
+import org.apache.pdfbox.contentstream.operator.state.SetMatrix;
+import org.apache.pdfbox.contentstream.operator.state.SetRenderingIntent;
+import org.apache.pdfbox.contentstream.operator.text.BeginText;
+import org.apache.pdfbox.contentstream.operator.text.EndText;
+import org.apache.pdfbox.contentstream.operator.text.SetFontAndSize;
+import org.apache.pdfbox.contentstream.operator.text.SetTextHorizontalScaling;
+import org.apache.pdfbox.contentstream.operator.text.ShowTextAdjusted;
+import org.apache.pdfbox.contentstream.operator.text.ShowTextLine;
+import org.apache.pdfbox.contentstream.operator.text.ShowTextLineAndSpace;
+import org.apache.pdfbox.contentstream.operator.text.MoveText;
+import org.apache.pdfbox.contentstream.operator.text.MoveTextSetLeading;
+import org.apache.pdfbox.contentstream.operator.text.NextLine;
+import org.apache.pdfbox.contentstream.operator.text.SetCharSpacing;
+import org.apache.pdfbox.contentstream.operator.text.SetTextLeading;
+import org.apache.pdfbox.contentstream.operator.text.SetTextRenderingMode;
+import org.apache.pdfbox.contentstream.operator.text.SetTextRise;
+import org.apache.pdfbox.contentstream.operator.text.SetWordSpacing;
+import org.apache.pdfbox.contentstream.operator.text.ShowText;
+
+/**
+ * PDFStreamEngine subclass for advanced processing of graphics.
+ * This class should be subclassed by end users looking to hook into graphics operations.
+ *
+ * @author John Hewson
+ */
+public abstract class PDFGraphicsStreamEngine extends PDFStreamEngine
+{
+    // may be null, for example if the stream is a tiling pattern
+    private final PDPage page;
+
+    /**
+     * Constructor.
+     */
+    protected PDFGraphicsStreamEngine(PDPage page)
+    {
+        this.page = page;
+
+        addOperator(new CloseFillNonZeroAndStrokePath());
+        addOperator(new FillNonZeroAndStrokePath());
+        addOperator(new CloseFillEvenOddAndStrokePath());
+        addOperator(new FillEvenOddAndStrokePath());
+        addOperator(new BeginInlineImage());
+        addOperator(new BeginText());
+        addOperator(new CurveTo());
+        addOperator(new Concatenate());
+        addOperator(new SetStrokingColorSpace());
+        addOperator(new SetNonStrokingColorSpace());
+        addOperator(new SetLineDashPattern());
+        addOperator(new DrawObject()); // special graphics version
+        addOperator(new EndText());
+        addOperator(new FillNonZeroRule());
+        addOperator(new LegacyFillNonZeroRule());
+        addOperator(new FillEvenOddRule());
+        addOperator(new SetStrokingDeviceGrayColor());
+        addOperator(new SetNonStrokingDeviceGrayColor());
+        addOperator(new SetGraphicsStateParameters());
+        addOperator(new ClosePath());
+        addOperator(new SetFlatness());
+        addOperator(new SetLineJoinStyle());
+        addOperator(new SetLineCapStyle());
+        addOperator(new SetStrokingDeviceCMYKColor());
+        addOperator(new SetNonStrokingDeviceCMYKColor());
+        addOperator(new LineTo());
+        addOperator(new MoveTo());
+        addOperator(new SetLineMiterLimit());
+        addOperator(new EndPath());
+        addOperator(new Save());
+        addOperator(new Restore());
+        addOperator(new AppendRectangleToPath());
+        addOperator(new SetStrokingDeviceRGBColor());
+        addOperator(new SetNonStrokingDeviceRGBColor());
+        addOperator(new SetRenderingIntent());
+        addOperator(new CloseAndStrokePath());
+        addOperator(new StrokePath());
+        addOperator(new SetStrokingColor());
+        addOperator(new SetNonStrokingColor());
+        addOperator(new SetStrokingColorN());
+        addOperator(new SetNonStrokingColorN());
+        addOperator(new ShadingFill());
+        addOperator(new NextLine());
+        addOperator(new SetCharSpacing());
+        addOperator(new MoveText());
+        addOperator(new MoveTextSetLeading());
+        addOperator(new SetFontAndSize());
+        addOperator(new ShowText());
+        addOperator(new ShowTextAdjusted());
+        addOperator(new SetTextLeading());
+        addOperator(new SetMatrix());
+        addOperator(new SetTextRenderingMode());
+        addOperator(new SetTextRise());
+        addOperator(new SetWordSpacing());
+        addOperator(new SetTextHorizontalScaling());
+        addOperator(new CurveToReplicateInitialPoint());
+        addOperator(new SetLineWidth());
+        addOperator(new ClipNonZeroRule());
+        addOperator(new ClipEvenOddRule());
+        addOperator(new CurveToReplicateFinalPoint());
+        addOperator(new ShowTextLine());
+        addOperator(new ShowTextLineAndSpace());
+        addOperator(new BeginMarkedContentSequence());
+        addOperator(new BeginMarkedContentSequenceWithProperties());
+        addOperator(new EndMarkedContentSequence());
+    }
+
+    /**
+     * Returns the page.
+     */
+    protected final PDPage getPage()
+    {
+        return page;
+    }
+
+    /**
+     * Append a rectangle to the current path.
+     */
+    public abstract void appendRectangle(Point2D p0, Point2D p1,
+                                         Point2D p2, Point2D p3) throws IOException;
+
+    /**
+     * Draw the image.
+     *
+     * @param pdImage The image to draw.
+     */
+    public abstract void drawImage(PDImage pdImage) throws IOException;
+
+    /**
+     * Modify the current clipping path by intersecting it with the current path.
+     * The clipping path will not be updated until the succeeding painting operator is called.
+     *
+     * @param windingRule The winding rule which will be used for clipping.
+     */
+    public abstract void clip(int windingRule) throws IOException;
+
+    /**
+     * Starts a new path at (x,y).
+     */
+    public abstract void moveTo(float x, float y) throws IOException;
+
+    /**
+     * Draws a line from the current point to (x,y).
+     */
+    public abstract void lineTo(float x, float y) throws IOException;
+
+    /**
+     * Draws a curve from the current point to (x3,y3) using (x1,y1) and (x2,y2) as control points.
+     */
+    public abstract void curveTo(float x1, float y1,
+                                 float x2, float y2,
+                                 float x3, float y3) throws IOException;
+
+    /**
+     * Returns the current point of the current path.
+     */
+    public abstract Point2D getCurrentPoint() throws IOException;
+
+    /**
+     * Closes the current path.
+     */
+    public abstract void closePath() throws IOException;
+
+    /**
+     * Ends the current path without filling or stroking it. The clipping path is updated here.
+     */
+    public abstract void endPath() throws IOException;
+
+    /**
+     * Stroke the path.
+     *
+     * @throws IOException If there is an IO error while stroking the path.
+     */
+    public abstract void strokePath() throws IOException;
+
+    /**
+     * Fill the path.
+     *
+     * @param windingRule The winding rule this path will use.
+     */
+    public abstract void fillPath(int windingRule) throws IOException;
+
+    /**
+     * Fills and then strokes the path.
+     *
+     * @param windingRule The winding rule this path will use.
+     */
+    public abstract void fillAndStrokePath(int windingRule) throws IOException;
+
+    /**
+     * Fill with Shading.
+     *
+     * @param shadingName The name of the Shading Dictionary to use for this fill instruction.
+     */
+    public abstract void shadingFill(COSName shadingName) throws IOException;
+}
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/contentstream/PDFStreamEngine.java b/pdfbox/src/main/java/org/apache/pdfbox/contentstream/PDFStreamEngine.java
index 4c409cd8d2..f0b3830cd5 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/contentstream/PDFStreamEngine.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/contentstream/PDFStreamEngine.java
@@ -34,6 +34,8 @@ import org.apache.pdfbox.contentstream.operator.MissingOperandException;
 import org.apache.pdfbox.contentstream.operator.state.EmptyGraphicsStackException;
 import org.apache.pdfbox.cos.COSArray;
 import org.apache.pdfbox.cos.COSBase;
+import org.apache.pdfbox.cos.COSDictionary;
+import org.apache.pdfbox.cos.COSName;
 import org.apache.pdfbox.cos.COSNumber;
 import org.apache.pdfbox.cos.COSObject;
 import org.apache.pdfbox.cos.COSString;
@@ -43,6 +45,7 @@ import org.apache.pdfbox.pdmodel.MissingResourceException;
 import org.apache.pdfbox.pdmodel.PDPage;
 import org.apache.pdfbox.pdmodel.PDResources;
 import org.apache.pdfbox.pdmodel.common.PDRectangle;
+import org.apache.pdfbox.pdmodel.documentinterchange.markedcontent.PDMarkedContent;
 import org.apache.pdfbox.pdmodel.font.PDFont;
 import org.apache.pdfbox.pdmodel.font.PDFontFactory;
 import org.apache.pdfbox.pdmodel.font.PDType3CharProc;
@@ -809,6 +812,25 @@ public abstract class PDFStreamEngine
         }
     }
 
+    /**
+     * Called when a a marked content group begins
+     *
+     * @param tag content tag
+     * @param properties optional properties
+     */
+    public void beginMarkedContentSequence(COSName tag, COSDictionary properties)
+    {
+        // overridden in subclasses
+    }
+
+    /**
+     * Called when a a marked content group ends
+     */
+    public void endMarkedContentSequence()
+    {
+        // overridden in subclasses
+    }
+
     /**
      * This is used to handle an operation.
      * 
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/BeginMarkedContentSequence.java b/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/BeginMarkedContentSequence.java
index 678dc99895..5c31f7ea3e 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/BeginMarkedContentSequence.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/BeginMarkedContentSequence.java
@@ -1,57 +1,54 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.pdfbox.contentstream.operator.markedcontent;
-
-import java.io.IOException;
-import java.util.List;
-
-import org.apache.pdfbox.cos.COSBase;
-import org.apache.pdfbox.cos.COSName;
-import org.apache.pdfbox.text.PDFMarkedContentExtractor;
-import org.apache.pdfbox.contentstream.operator.Operator;
-import org.apache.pdfbox.contentstream.operator.OperatorProcessor;
-
-/**
- * BMC : Begins a marked-content sequence.
- *
- * @author Johannes Koch
- */
-public class BeginMarkedContentSequence extends OperatorProcessor
-{
-    @Override
-    public void process(Operator operator, List<COSBase> arguments) throws IOException
-    {
-        COSName tag = null;
-        for (COSBase argument : arguments)
-        {
-            if (argument instanceof COSName)
-            {
-                tag = (COSName) argument;
-            }
-        }
-        if (this.context instanceof PDFMarkedContentExtractor)
-        {
-            ((PDFMarkedContentExtractor) this.context).beginMarkedContentSequence(tag, null);
-        }
-    }
-
-    @Override
-    public String getName()
-    {
-        return "BMC";
-    }
-}
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.pdfbox.contentstream.operator.markedcontent;
+
+import java.io.IOException;
+import java.util.List;
+
+import org.apache.pdfbox.cos.COSBase;
+import org.apache.pdfbox.cos.COSName;
+import org.apache.pdfbox.text.PDFMarkedContentExtractor;
+import org.apache.pdfbox.contentstream.operator.Operator;
+import org.apache.pdfbox.contentstream.operator.OperatorProcessor;
+
+/**
+ * BMC : Begins a marked-content sequence.
+ *
+ * @author Johannes Koch
+ */
+public class BeginMarkedContentSequence extends OperatorProcessor
+{
+    @Override
+    public void process(Operator operator, List<COSBase> arguments) throws IOException
+    {
+        COSName tag = null;
+        for (COSBase argument : arguments)
+        {
+            if (argument instanceof COSName)
+            {
+                tag = (COSName) argument;
+            }
+        }
+       this.context.beginMarkedContentSequence(tag, null);
+    }
+
+    @Override
+    public String getName()
+    {
+        return "BMC";
+    }
+}
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/BeginMarkedContentSequenceWithProperties.java b/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/BeginMarkedContentSequenceWithProperties.java
index d85d9bf66b..d7e37be33c 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/BeginMarkedContentSequenceWithProperties.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/BeginMarkedContentSequenceWithProperties.java
@@ -1,63 +1,60 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.pdfbox.contentstream.operator.markedcontent;
-
-import java.io.IOException;
-import java.util.List;
-
-import org.apache.pdfbox.cos.COSBase;
-import org.apache.pdfbox.cos.COSDictionary;
-import org.apache.pdfbox.cos.COSName;
-import org.apache.pdfbox.text.PDFMarkedContentExtractor;
-import org.apache.pdfbox.contentstream.operator.Operator;
-import org.apache.pdfbox.contentstream.operator.OperatorProcessor;
-
-/**
- * BDC : Begins a marked-content sequence with property list.
- *
- * @author Johannes Koch
- */
-public class BeginMarkedContentSequenceWithProperties extends OperatorProcessor
-{
-    @Override
-    public void process(Operator operator, List<COSBase> arguments) throws IOException
-    {
-        COSName tag = null;
-        COSDictionary properties = null;
-        for (COSBase argument : arguments)
-        {
-            if (argument instanceof COSName)
-            {
-                tag = (COSName) argument;
-            }
-            else if (argument instanceof COSDictionary)
-            {
-                properties = (COSDictionary) argument;
-            }
-        }
-        if (this.context instanceof PDFMarkedContentExtractor)
-        {
-            ((PDFMarkedContentExtractor) this.context).beginMarkedContentSequence(tag, properties);
-        }
-    }
-
-    @Override
-    public String getName()
-    {
-        return "BDC";
-    }
-}
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.pdfbox.contentstream.operator.markedcontent;
+
+import java.io.IOException;
+import java.util.List;
+
+import org.apache.pdfbox.cos.COSBase;
+import org.apache.pdfbox.cos.COSDictionary;
+import org.apache.pdfbox.cos.COSName;
+import org.apache.pdfbox.text.PDFMarkedContentExtractor;
+import org.apache.pdfbox.contentstream.operator.Operator;
+import org.apache.pdfbox.contentstream.operator.OperatorProcessor;
+
+/**
+ * BDC : Begins a marked-content sequence with property list.
+ *
+ * @author Johannes Koch
+ */
+public class BeginMarkedContentSequenceWithProperties extends OperatorProcessor
+{
+    @Override
+    public void process(Operator operator, List<COSBase> arguments) throws IOException
+    {
+        COSName tag = null;
+        COSDictionary properties = null;
+        for (COSBase argument : arguments)
+        {
+            if (argument instanceof COSName)
+            {
+                tag = (COSName) argument;
+            }
+            else if (argument instanceof COSDictionary)
+            {
+                properties = (COSDictionary) argument;
+            }
+        }
+        this.context.beginMarkedContentSequence(tag, properties);
+    }
+
+    @Override
+    public String getName()
+    {
+        return "BDC";
+    }
+}
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/EndMarkedContentSequence.java b/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/EndMarkedContentSequence.java
index fb983db212..5aca84d50f 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/EndMarkedContentSequence.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/EndMarkedContentSequence.java
@@ -1,48 +1,44 @@
-/*
- * Licensed to the Apache Software Foundation (ASF) under one or more
- * contributor license agreements.  See the NOTICE file distributed with
- * this work for additional information regarding copyright ownership.
- * The ASF licenses this file to You under the Apache License, Version 2.0
- * (the "License"); you may not use this file except in compliance with
- * the License.  You may obtain a copy of the License at
- *
- *      http://www.apache.org/licenses/LICENSE-2.0
- *
- * Unless required by applicable law or agreed to in writing, software
- * distributed under the License is distributed on an "AS IS" BASIS,
- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
- * See the License for the specific language governing permissions and
- * limitations under the License.
- */
-package org.apache.pdfbox.contentstream.operator.markedcontent;
-
-import java.io.IOException;
-import java.util.List;
-
-import org.apache.pdfbox.cos.COSBase;
-import org.apache.pdfbox.text.PDFMarkedContentExtractor;
-import org.apache.pdfbox.contentstream.operator.Operator;
-import org.apache.pdfbox.contentstream.operator.OperatorProcessor;
-
-/**
- * EMC : Ends a marked-content sequence begun by BMC or BDC.
- *
- * @author Johannes Koch
- */
-public class EndMarkedContentSequence extends OperatorProcessor
-{
-    @Override
-    public void process(Operator operator, List<COSBase> arguments) throws IOException
-    {
-        if (this.context instanceof PDFMarkedContentExtractor)
-        {
-            ((PDFMarkedContentExtractor) this.context).endMarkedContentSequence();
-        }
-    }
-
-    @Override
-    public String getName()
-    {
-        return "EMC";
-    }
-}
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.pdfbox.contentstream.operator.markedcontent;
+
+import java.io.IOException;
+import java.util.List;
+
+import org.apache.pdfbox.cos.COSBase;
+import org.apache.pdfbox.contentstream.operator.Operator;
+import org.apache.pdfbox.contentstream.operator.OperatorProcessor;
+
+/**
+ * EMC : Ends a marked-content sequence begun by BMC or BDC.
+ *
+ * @author Johannes Koch
+ */
+public class EndMarkedContentSequence extends OperatorProcessor
+{
+    @Override
+    public void process(Operator operator, List<COSBase> arguments) throws IOException
+    {
+        this.context.endMarkedContentSequence();
+    }
+
+    @Override
+    public String getName()
+    {
+        return "EMC";
+    }
+}
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/optionalcontent/PDOptionalContentGroup.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/optionalcontent/PDOptionalContentGroup.java
index 19ffd2ee6f..dc9e634223 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/optionalcontent/PDOptionalContentGroup.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/optionalcontent/PDOptionalContentGroup.java
@@ -19,6 +19,7 @@ package org.apache.pdfbox.pdmodel.graphics.optionalcontent;
 import org.apache.pdfbox.cos.COSDictionary;
 import org.apache.pdfbox.cos.COSName;
 import org.apache.pdfbox.pdmodel.documentinterchange.markedcontent.PDPropertyList;
+import org.apache.pdfbox.rendering.RenderDestination;
 
 /**
  * An optional content group (OCG).
@@ -48,6 +49,51 @@ public class PDOptionalContentGroup extends PDPropertyList
                     "Provided dictionary is not of type '" + COSName.OCG + "'");
         }
     }
+    
+    /**
+     * Enumeration for the renderState dictionary entry on the "Export", "View"
+     * and "Print" dictionary.
+     */
+    public enum RenderState 
+    {
+        /** The "ON" value. */
+        ON(COSName.ON),
+        /** The "OFF" value. */
+        OFF(COSName.OFF);
+
+        private final COSName name;
+
+        private RenderState(COSName value)
+        {
+            this.name = value;
+        }
+
+        /**
+         * Returns the base state represented by the given {@link COSName}.
+         *
+         * @param state the state name
+         * @return the state enum value
+         */
+        public static RenderState valueOf(COSName state)
+        {
+            if (state == null)
+            {
+                return null;
+            }
+
+            return RenderState.valueOf(state.getName().toUpperCase());
+        }
+
+        /**
+         * Returns the PDF name for the state.
+         *
+         * @return the name of the state
+         */
+        public COSName getName()
+        {
+            return this.name;
+        }
+    }
 
     /**
      * Returns the name of the optional content group.
@@ -67,7 +113,36 @@ public class PDOptionalContentGroup extends PDPropertyList
         dict.setString(COSName.NAME, name);
     }
 
-    //TODO Add support for "Intent" and "Usage"
+    //TODO Add support for "Intent"
+    /**
+     * @param destination to be rendered
+     * @return state or null if undefined
+     */
+    public RenderState getRenderState(RenderDestination destination)
+    {
+        COSName state = null;
+        COSDictionary usage = (COSDictionary) dict.getDictionaryObject("Usage");
+        if (usage != null)
+        {
+            if (RenderDestination.PRINT.equals(destination))
+            {
+                COSDictionary print = (COSDictionary) usage.getDictionaryObject("Print");
+                state = print == null ? null : (COSName) print.getDictionaryObject("PrintState");
+            }
+            else if (RenderDestination.VIEW.equals(destination))
+            {
+                COSDictionary view = (COSDictionary) usage.getDictionaryObject("View");
+                state = view == null ? null : (COSName) view.getDictionaryObject("ViewState");
+            }
+            // Fallback to export
+            if (state == null)
+            {
+                COSDictionary export = (COSDictionary) usage.getDictionaryObject("Export");
+                state = export == null ? null : (COSName) export.getDictionaryObject("ExportState");
+            }
+        }
+        return state == null ? null : RenderState.valueOf(state);
+    }
 
     @Override
     public String toString()
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/printing/PDFPrintable.java b/pdfbox/src/main/java/org/apache/pdfbox/printing/PDFPrintable.java
index 2907d3d851..90c19e2aa7 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/printing/PDFPrintable.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/printing/PDFPrintable.java
@@ -32,6 +32,7 @@ import org.apache.pdfbox.pdmodel.PDDocument;
 import org.apache.pdfbox.pdmodel.PDPage;
 import org.apache.pdfbox.pdmodel.common.PDRectangle;
 import org.apache.pdfbox.rendering.PDFRenderer;
+import org.apache.pdfbox.rendering.RenderDestination;
 
 /**
  * Prints pages from a PDF document using any page size or scaling mode.
@@ -217,7 +218,7 @@ public final class PDFPrintable implements Printable
             AffineTransform transform = (AffineTransform)graphics2D.getTransform().clone();
             graphics2D.setBackground(Color.WHITE);
             renderer.setSubsamplingAllowed(subsamplingAllowed);
-            renderer.renderPageToGraphics(pageIndex, graphics2D, (float)scale);
+            renderer.renderPageToGraphics(pageIndex, graphics2D, (float) scale, (float) scale, RenderDestination.PRINT);
 
             // draw crop box
             if (showPageBorder)
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/rendering/PDFRenderer.java b/pdfbox/src/main/java/org/apache/pdfbox/rendering/PDFRenderer.java
index 34b3311fcd..b3d3f4b0da 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/rendering/PDFRenderer.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/rendering/PDFRenderer.java
@@ -31,6 +31,8 @@ import org.apache.pdfbox.pdmodel.PDPage;
 import org.apache.pdfbox.pdmodel.PDResources;
 import org.apache.pdfbox.pdmodel.common.PDRectangle;
 import org.apache.pdfbox.pdmodel.graphics.blend.BlendMode;
+import org.apache.pdfbox.pdmodel.graphics.optionalcontent.PDOptionalContentGroup;
+import org.apache.pdfbox.pdmodel.graphics.optionalcontent.PDOptionalContentProperties;
 import org.apache.pdfbox.pdmodel.graphics.state.PDExtendedGraphicsState;
 import org.apache.pdfbox.pdmodel.interactive.annotation.AnnotationFilter;
 import org.apache.pdfbox.pdmodel.interactive.annotation.PDAnnotation;
@@ -62,6 +64,8 @@ public class PDFRenderer
 
     private boolean subsamplingAllowed = false;
 
+    private RenderDestination defaultDestination;
+
     private BufferedImage pageImage;
 
     private static boolean kcmsLogged = false;
@@ -80,7 +84,7 @@ public class PDFRenderer
             kcmsLogged = true;
         }
     }
-    
+
     /**
      * Return the AnnotationFilter.
      * 
@@ -131,6 +135,22 @@ public class PDFRenderer
         this.subsamplingAllowed = subsamplingAllowed;
     }
 
+    /**
+     * @return the defaultDestination
+     */
+    public RenderDestination getDefaultDestination()
+    {
+        return defaultDestination;
+    }
+
+    /**
+     * @param defaultDestination the defaultDestination to set
+     */
+    public void setDefaultDestination(RenderDestination defaultDestination)
+    {
+        this.defaultDestination = defaultDestination;
+    }
+
     /**
      * Returns the given page as an RGB image at 72 DPI
      * @param pageIndex the zero-based index of the page to be converted.
@@ -191,6 +211,22 @@ public class PDFRenderer
      */
     public BufferedImage renderImage(int pageIndex, float scale, ImageType imageType)
             throws IOException
+    {
+        return renderImage(pageIndex, scale, imageType, 
+                           defaultDestination == null ? RenderDestination.EXPORT : defaultDestination);
+    }
+
+    /**
+     * Returns the given page as an RGB or ARGB image at the given scale.
+     * @param pageIndex the zero-based index of the page to be converted
+     * @param scale the scaling factor, where 1 = 72 DPI
+     * @param imageType the type of image to return
+     * @param destination controlling visibility of optional content groups
+     * @return the rendered page image
+     * @throws IOException if the PDF cannot be read
+     */
+    public BufferedImage renderImage(int pageIndex, float scale, ImageType imageType, RenderDestination destination)
+            throws IOException
     {
         PDPage page = document.getPage(pageIndex);
 
@@ -242,7 +278,7 @@ public class PDFRenderer
         transform(g, page, scale, scale);
 
         // the end-user may provide a custom PageDrawer
-        PageDrawerParameters parameters = new PageDrawerParameters(this, page, subsamplingAllowed);
+        PageDrawerParameters parameters = new PageDrawerParameters(this, page, subsamplingAllowed, destination);
         PageDrawer drawer = createPageDrawer(parameters);
         drawer.drawPage(g, page.getCropBox());       
         
@@ -299,6 +335,23 @@ public class PDFRenderer
      */
     public void renderPageToGraphics(int pageIndex, Graphics2D graphics, float scaleX, float scaleY)
             throws IOException
+    {
+        renderPageToGraphics(pageIndex, graphics, scaleX, scaleY, 
+                             defaultDestination == null ? RenderDestination.VIEW : defaultDestination);
+    }
+
+    /**
+     * Renders a given page to an AWT Graphics2D instance.
+     * 
+     * @param pageIndex the zero-based index of the page to be converted
+     * @param graphics the Graphics2D on which to draw the page
+     * @param scaleX the scale to draw the page at for the x-axis
+     * @param scaleY the scale to draw the page at for the y-axis
+     * @param destination controlling visibility of optional content groups
+     * @throws IOException if the PDF cannot be read
+     */
+    public void renderPageToGraphics(int pageIndex, Graphics2D graphics, float scaleX, float scaleY, RenderDestination destination)
+            throws IOException
     {
         PDPage page = document.getPage(pageIndex);
         // TODO need width/wight calculations? should these be in PageDrawer?
@@ -309,11 +362,22 @@ public class PDFRenderer
         graphics.clearRect(0, 0, (int) cropBox.getWidth(), (int) cropBox.getHeight());
 
         // the end-user may provide a custom PageDrawer
-        PageDrawerParameters parameters = new PageDrawerParameters(this, page, subsamplingAllowed);
+        PageDrawerParameters parameters = new PageDrawerParameters(this, page, subsamplingAllowed, destination);
         PageDrawer drawer = createPageDrawer(parameters);
         drawer.drawPage(graphics, cropBox);
     }
 
+    /**
+     * Indicates whether an optional content group is enabled.
+     * @param group the group
+     * @return true if the group is enabled
+     */
+    public boolean isGroupEnabled(PDOptionalContentGroup group)
+    {
+        PDOptionalContentProperties ocProperties = document.getDocumentCatalog().getOCProperties();
+        return ocProperties == null || ocProperties.isGroupEnabled(group);
+    }
+
     // scale rotate translate
     private void transform(Graphics2D graphics, PDPage page, float scaleX, float scaleY)
     {
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java b/pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java
index b191a5e2fc..90553baebb 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java
@@ -56,6 +56,7 @@ import java.util.Stack;
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
 import org.apache.pdfbox.contentstream.PDFGraphicsStreamEngine;
+import org.apache.pdfbox.contentstream.operator.Operator;
 import org.apache.pdfbox.cos.COSArray;
 import org.apache.pdfbox.cos.COSBase;
 import org.apache.pdfbox.cos.COSDictionary;
@@ -63,6 +64,7 @@ import org.apache.pdfbox.cos.COSName;
 import org.apache.pdfbox.pdmodel.PDResources;
 import org.apache.pdfbox.pdmodel.common.PDRectangle;
 import org.apache.pdfbox.pdmodel.common.function.PDFunction;
+import org.apache.pdfbox.pdmodel.documentinterchange.markedcontent.PDPropertyList;
 import org.apache.pdfbox.pdmodel.font.PDFont;
 import org.apache.pdfbox.pdmodel.font.PDVectorFont;
 import org.apache.pdfbox.pdmodel.graphics.PDLineDashPattern;
@@ -75,6 +77,8 @@ import org.apache.pdfbox.pdmodel.graphics.color.PDICCBased;
 import org.apache.pdfbox.pdmodel.graphics.color.PDPattern;
 import org.apache.pdfbox.pdmodel.graphics.form.PDTransparencyGroup;
 import org.apache.pdfbox.pdmodel.graphics.image.PDImage;
+import org.apache.pdfbox.pdmodel.graphics.optionalcontent.PDOptionalContentGroup;
+import org.apache.pdfbox.pdmodel.graphics.optionalcontent.PDOptionalContentGroup.RenderState;
 import org.apache.pdfbox.pdmodel.graphics.pattern.PDAbstractPattern;
 import org.apache.pdfbox.pdmodel.graphics.pattern.PDShadingPattern;
 import org.apache.pdfbox.pdmodel.graphics.pattern.PDTilingPattern;
@@ -138,6 +142,11 @@ public class PageDrawer extends PDFGraphicsStreamEngine
     
     private final Stack<TransparencyGroup> transparencyGroupStack = new Stack<>();
 
+    // if greater zero the content is hidden and wil not be rendered
+    private int nestedHiddenOCGCount;
+
+    private final RenderDestination destination; 
+
     /**
     * Default annotations filter, returns all annotations
     */
@@ -161,6 +170,7 @@ public class PageDrawer extends PDFGraphicsStreamEngine
         super(parameters.getPage());
         this.renderer = parameters.getRenderer();
         this.subsamplingAllowed = parameters.isSubsamplingAllowed();
+        this.destination = parameters.getDestination();
     }
 
     /**
@@ -1581,4 +1591,79 @@ public class PageDrawer extends PDFGraphicsStreamEngine
 
         return false;
     }
+
+    /**
+     * Marked content begins
+     *
+     * @param tag name of the content mark
+     * @see
+     * org.apache.pdfbox.contentstream.PDFStreamEngine#beginMarkedContentSequence(org.apache.pdfbox.cos.COSName,
+     * org.apache.pdfbox.cos.COSDictionary)
+     */
+    @Override
+    public void beginMarkedContentSequence(COSName tag, COSDictionary properties)
+    {
+        if (nestedHiddenOCGCount > 0)
+        {
+            nestedHiddenOCGCount++;
+        }
+        else if (tag != null && getPage().getResources() != null)
+        {
+            PDPropertyList propertyList = getPage().getResources().getProperties(tag);
+            if (propertyList instanceof PDOptionalContentGroup)
+            {
+                PDOptionalContentGroup group = (PDOptionalContentGroup) propertyList;
+                RenderState printState = group.getRenderState(destination);
+                if (printState == null)
+                {
+                    if (!getRenderer().isGroupEnabled(group))
+                    {
+                        nestedHiddenOCGCount = 1;
+                    }
+                }
+                else if (RenderState.OFF.equals(printState))
+                {
+                    nestedHiddenOCGCount = 1;
+                }
+            }
+        }
+    }
+
+    /**
+     *
+     * @see org.apache.pdfbox.contentstream.PDFStreamEngine#endMarkedContentSequence()
+     */
+    @Override
+    public void endMarkedContentSequence()
+    {
+        if (nestedHiddenOCGCount > 0)
+        {
+            nestedHiddenOCGCount--;
+        }
+    }
+
+    private boolean isContentMarkOperator(Operator operator)
+    {
+        String name = operator.getName();
+        return "BMC".equals(name) || "BDC".equals(name) || "EMC".equals(name);
+    }
+
+    private boolean isContentRendered()
+    {
+        return nestedHiddenOCGCount <= 0;
+    }
+
+    /**
+     * Handle hidden optional content groups
+     *
+     * @see org.apache.pdfbox.contentstream.PDFStreamEngine#processOperator(Operator, List)
+     */
+    @Override
+    protected void processOperator(Operator operator, List<COSBase> operands) throws IOException
+    {
+        if (isContentRendered() || isContentMarkOperator(operator))
+        {
+            super.processOperator(operator, operands);
+        }
+    }
 }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawerParameters.java b/pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawerParameters.java
index 48d4428b9f..bc5fdd833e 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawerParameters.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawerParameters.java
@@ -31,15 +31,17 @@ public final class PageDrawerParameters
     private final PDFRenderer renderer;
     private final PDPage page;
     private final boolean subsamplingAllowed;
+    private final RenderDestination destination; 
 
     /**
      * Package-private constructor.
      */
-    PageDrawerParameters(PDFRenderer renderer, PDPage page, boolean subsamplingAllowed)
+    PageDrawerParameters(PDFRenderer renderer, PDPage page, boolean subsamplingAllowed, RenderDestination destination)
     {
         this.renderer = renderer;
         this.page = page;
         this.subsamplingAllowed = subsamplingAllowed;
+        this.destination = destination;
     }
 
     /**
@@ -65,4 +67,13 @@ public final class PageDrawerParameters
     {
         return subsamplingAllowed;
     }
+
+    /**
+     * @return the destination
+     */
+    public RenderDestination getDestination()
+    {
+        return this.destination;
+    }
+
 }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/rendering/RenderDestination.java b/pdfbox/src/main/java/org/apache/pdfbox/rendering/RenderDestination.java
new file mode 100644
index 0000000000..455d393cf5
--- /dev/null
+++ b/pdfbox/src/main/java/org/apache/pdfbox/rendering/RenderDestination.java
@@ -0,0 +1,31 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.pdfbox.rendering;
+
+/**
+ * Optional content groups are visible depending on the render purpose.
+ */
+public enum RenderDestination 
+{
+    /** graphics export  */
+    EXPORT,
+    /** viewing */
+    VIEW,
+    /** printing */
+    PRINT
+}
\ No newline at end of file
