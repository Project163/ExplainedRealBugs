diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/StandardSecurityHandler.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/StandardSecurityHandler.java
index 3aea99d3bb..910bf87637 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/StandardSecurityHandler.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/encryption/StandardSecurityHandler.java
@@ -177,15 +177,26 @@ public final class StandardSecurityHandler extends SecurityHandler<StandardProte
                 {
                     dicLength = 128 / 8;
                     setAES(true);
+                    if (encryption.getCOSObject().containsKey(COSName.LENGTH))
+                    {
+                        // PDFBOX-5345
+                        int newLength = encryption.getLength() / 8;
+                        if (newLength < dicLength)
+                        {
+                            LOG.warn("Using " + newLength + " bytes key length instead of " +
+                                    dicLength + " in AESV2 encryption?!");
+                            dicLength = newLength;
+                        }
+                    }
                 }
                 if (COSName.AESV3.equals(cryptFilterMethod))
                 {
                     dicLength = 256 / 8;
                     setAES(true);
-                    if (stdCryptFilterDictionary.getCOSObject().containsKey(COSName.LENGTH))
+                    if (encryption.getCOSObject().containsKey(COSName.LENGTH))
                     {
                         // PDFBOX-5345
-                        int newLength = stdCryptFilterDictionary.getLength();
+                        int newLength = encryption.getLength() / 8;
                         if (newLength < dicLength)
                         {
                             LOG.warn("Using " + newLength + " bytes key length instead of " +
