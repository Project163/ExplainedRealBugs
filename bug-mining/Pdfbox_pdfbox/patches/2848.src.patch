diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/compress/COSWriterObjectStream.java b/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/compress/COSWriterObjectStream.java
index 9c2de9d03d..c0599940fc 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/compress/COSWriterObjectStream.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdfwriter/compress/COSWriterObjectStream.java
@@ -175,18 +175,16 @@ public class COSWriterObjectStream
         COSBase base;
         if (object instanceof COSObject)
         {
-            base = ((COSObject) object).getObject();
             if (!topLevel)
             {
                 COSObjectKey actualKey = object.getKey();
-                // the object reference can't be dereferenced be lenient and write the reference nevertheless
-                // or the object is part of a compressed object stream and shouldn't be written directly
-                if (base == null || (actualKey != null && preparedKeys.contains(actualKey)))
+                if (actualKey != null)
                 {
                     writeObjectReference(output, actualKey);
                     return;
                 }
             }
+            base = ((COSObject) object).getObject();
         }
         else
         {
