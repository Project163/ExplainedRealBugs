diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/CompositeImage.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/CompositeImage.java
index 5310a28567..2f138f4d05 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/CompositeImage.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/CompositeImage.java
@@ -111,11 +111,20 @@ public class CompositeImage
      * This method applies the specified stencil mask to a given image and returns a new BufferedImage
      * whose alpha values are computed from the stencil mask (smask) image.
      * 
+     * @param decodeArray the decode array
      * @return the stencil masked image 
      */
-    public BufferedImage createStencilMaskedImage()
+    public BufferedImage createStencilMaskedImage(COSArray decodeArray)
     {
-        final int baseImageWidth = baseImage.getWidth();
+    	// default: 0 (black) == opaque
+        int alphaValue = 0;
+        if (decodeArray != null)
+        {
+        	// invert the stencil mask: 1 (white) == opaque
+            alphaValue = decodeArray.getInt(0) > decodeArray.getInt(1) ? 1 : 0;
+        }
+
+    	final int baseImageWidth = baseImage.getWidth();
         final int baseImageHeight = baseImage.getHeight();
         WritableRaster maskRaster = smaskImage.getRaster();
         BufferedImage result = new BufferedImage(baseImageWidth, baseImageHeight, BufferedImage.TYPE_INT_ARGB);
@@ -127,7 +136,7 @@ public class CompositeImage
                 maskRaster.getPixel(x, y, alpha);
                 // We need to remove any alpha value in the main image.
                 int rgbOnly = 0x00FFFFFF & baseImage.getRGB(x, y);
-                int alphaOnly = alpha[0] == 0 ? 0xFF000000 : 0;
+                int alphaOnly = alpha[0] == alphaValue ? 0xFF000000 : 0;
                 result.setRGB(x, y, rgbOnly | alphaOnly);
             }
         }
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/PDJpeg.java b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/PDJpeg.java
index 8c98d67878..193f2142ca 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/PDJpeg.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/graphics/xobject/PDJpeg.java
@@ -294,7 +294,7 @@ public class PDJpeg extends PDXObjectImage
             {
             	maskImage = (PDXObjectImage)PDXObject.createXObject(mask);
                 CompositeImage compositeImage = new CompositeImage(bi, maskImage.getRGBImage());
-                BufferedImage rgbImage = compositeImage.createStencilMaskedImage();
+                BufferedImage rgbImage = compositeImage.createStencilMaskedImage(maskImage.getDecode());
                 image = rgbImage;
             }	
         }
