diff --git a/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/BeginMarkedContentSequenceWithProperties.java b/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/BeginMarkedContentSequenceWithProperties.java
index 7cf36f574c..86455b7150 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/BeginMarkedContentSequenceWithProperties.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/contentstream/operator/markedcontent/BeginMarkedContentSequenceWithProperties.java
@@ -19,13 +19,15 @@ package org.apache.pdfbox.contentstream.operator.markedcontent;
 import java.io.IOException;
 import java.util.List;
 
-import org.apache.pdfbox.cos.COSBase;
-import org.apache.pdfbox.cos.COSDictionary;
-import org.apache.pdfbox.cos.COSName;
 import org.apache.pdfbox.contentstream.PDFStreamEngine;
+import org.apache.pdfbox.contentstream.operator.MissingOperandException;
 import org.apache.pdfbox.contentstream.operator.Operator;
 import org.apache.pdfbox.contentstream.operator.OperatorName;
 import org.apache.pdfbox.contentstream.operator.OperatorProcessor;
+import org.apache.pdfbox.cos.COSBase;
+import org.apache.pdfbox.cos.COSDictionary;
+import org.apache.pdfbox.cos.COSName;
+import org.apache.pdfbox.pdmodel.documentinterchange.markedcontent.PDPropertyList;
 
 /**
  * BDC : Begins a marked-content sequence with property list.
@@ -40,22 +42,39 @@ public class BeginMarkedContentSequenceWithProperties extends OperatorProcessor
     }
 
     @Override
-    public void process(Operator operator, List<COSBase> arguments) throws IOException
+    public void process(Operator operator, List<COSBase> operands) throws IOException
     {
-        COSName tag = null;
-        COSDictionary properties = null;
-        for (COSBase argument : arguments)
+        if (operands.size() < 2)
         {
-            if (argument instanceof COSName)
-            {
-                tag = (COSName) argument;
-            }
-            else if (argument instanceof COSDictionary)
+            throw new MissingOperandException(operator, operands);
+        }
+        if (!(operands.get(0) instanceof COSName))
+        {
+            return;
+        }
+        PDFStreamEngine context = getContext();
+        COSName tag = (COSName) operands.get(0);
+        COSBase op1 = operands.get(1);
+        COSDictionary propDict = null;
+        if (op1 instanceof COSName)
+        {
+            // PDFBOX-5980 and SO79549651
+            PDPropertyList prop = context.getResources().getProperties((COSName) op1);
+            if (prop != null)
             {
-                properties = (COSDictionary) argument;
+                propDict = prop.getCOSObject();
             }
         }
-        getContext().beginMarkedContentSequence(tag, properties);
+        else if (op1 instanceof COSDictionary)
+        {
+            propDict = (COSDictionary) op1;
+        }
+        if (propDict == null)
+        {
+            // wrong type or property not found
+            return;
+        }
+        context.beginMarkedContentSequence(tag, propDict);
     }
 
     @Override
diff --git a/pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java b/pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java
index 3239b38852..20a5f2a21b 100644
--- a/pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/rendering/PageDrawer.java
@@ -2093,11 +2093,11 @@ public class PageDrawer extends PDFGraphicsStreamEngine
             nestedHiddenOCGCount++;
             return;
         }
-        if (tag == null || getResources() == null)
+        if (properties == null)
         {
             return;
         }
-        if (isHiddenOCG(getResources().getProperties(tag)))
+        if (isHiddenOCG(PDPropertyList.create(properties)))
         {
             nestedHiddenOCGCount = 1;
         }
diff --git a/pdfbox/src/test/java/org/apache/pdfbox/pdmodel/graphics/optionalcontent/TestOptionalContentGroups.java b/pdfbox/src/test/java/org/apache/pdfbox/pdmodel/graphics/optionalcontent/TestOptionalContentGroups.java
index 357edc44ec..855fafe782 100644
--- a/pdfbox/src/test/java/org/apache/pdfbox/pdmodel/graphics/optionalcontent/TestOptionalContentGroups.java
+++ b/pdfbox/src/test/java/org/apache/pdfbox/pdmodel/graphics/optionalcontent/TestOptionalContentGroups.java
@@ -18,7 +18,6 @@ package org.apache.pdfbox.pdmodel.graphics.optionalcontent;
 
 
 import static org.junit.jupiter.api.Assertions.assertArrayEquals;
-import static org.junit.jupiter.api.Assertions.assertEquals;
 import static org.junit.jupiter.api.Assertions.assertFalse;
 import static org.junit.jupiter.api.Assertions.assertNotNull;
 import static org.junit.jupiter.api.Assertions.assertNull;
@@ -47,6 +46,7 @@ import org.apache.pdfbox.pdmodel.PDPageContentStream;
 import org.apache.pdfbox.pdmodel.PDPageContentStream.AppendMode;
 import org.apache.pdfbox.pdmodel.PageMode;
 import org.apache.pdfbox.pdmodel.documentinterchange.markedcontent.PDMarkedContent;
+import org.apache.pdfbox.pdmodel.documentinterchange.markedcontent.PDPropertyList;
 import org.apache.pdfbox.pdmodel.font.PDFont;
 import org.apache.pdfbox.pdmodel.font.PDType1Font;
 import org.apache.pdfbox.pdmodel.font.Standard14Fonts.FontName;
@@ -54,6 +54,7 @@ import org.apache.pdfbox.pdmodel.graphics.optionalcontent.PDOptionalContentPrope
 import org.apache.pdfbox.rendering.PDFRenderer;
 import org.apache.pdfbox.text.PDFMarkedContentExtractor;
 import org.apache.pdfbox.text.TextPosition;
+import static org.junit.jupiter.api.Assertions.assertEquals;
 import org.junit.jupiter.api.BeforeAll;
 import org.junit.jupiter.api.Test;
 
@@ -215,14 +216,23 @@ class TestOptionalContentGroups
             PDFMarkedContentExtractor extractor = new PDFMarkedContentExtractor();
             extractor.processPage(page);
             List<PDMarkedContent> markedContents = extractor.getMarkedContents();
-            assertEquals("oc1", markedContents.get(0).getTag());
+            assertEquals("OC", markedContents.get(0).getTag());
+            PDOptionalContentGroup ocg1 =
+                    (PDOptionalContentGroup) PDPropertyList.create(markedContents.get(0).getProperties());
+            assertEquals("background", ocg1.getName());
             assertEquals("PDF 1.5: Optional Content Groups"
                     + "You should see a green textline, but no red text line.",
                     textPositionListToString(markedContents.get(0).getContents()));
-            assertEquals("oc2", markedContents.get(1).getTag());
+            assertEquals("OC", markedContents.get(1).getTag());
+            PDOptionalContentGroup ocg2 =
+                    (PDOptionalContentGroup) PDPropertyList.create(markedContents.get(1).getProperties());
+            assertEquals("enabled", ocg2.getName());
             assertEquals("This is from an enabled layer. If you see this, that's good.",
                     textPositionListToString(markedContents.get(1).getContents()));
-            assertEquals("oc3", markedContents.get(2).getTag());
+            assertEquals("OC", markedContents.get(2).getTag());
+            PDOptionalContentGroup ocg3 =
+                    (PDOptionalContentGroup) PDPropertyList.create(markedContents.get(2).getProperties());
+            assertEquals("disabled", ocg3.getName());
             assertEquals("This is from a disabled layer. If you see this, that's NOT good!",
                     textPositionListToString(markedContents.get(2).getContents()));
         }
