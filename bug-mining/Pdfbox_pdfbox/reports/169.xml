<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:53:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1075] Can&apos;t get images from a PDF</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1075</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;This is a regression. In 1.4.0 I was able to extract images from a PDF file. In 1.6 and the current trunk I get exceptions:&lt;/p&gt;

&lt;p&gt;SEVERE: java.lang.IllegalArgumentException: Raster BytePackedRaster: width = 1000 height = 32 #channels 1 xOff = 0 yOff = 0 is incompatible with ColorModel IndexColorModel: #pixelBits = 1 numComponents = 3 color space = java.awt.color.ICC_ColorSpace@1050169 transparency = 1 transIndex   = -1 has alpha = false isAlphaPre = false&lt;br/&gt;
java.lang.IllegalArgumentException: Raster BytePackedRaster: width = 1000 height = 32 #channels 1 xOff = 0 yOff = 0 is incompatible with ColorModel IndexColorModel: #pixelBits = 1 numComponents = 3 color space = java.awt.color.ICC_ColorSpace@1050169 transparency = 1 transIndex   = -1 has alpha = false isAlphaPre = false&lt;br/&gt;
	at java.awt.image.BufferedImage.&amp;lt;init&amp;gt;(BufferedImage.java:611)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.graphics.xobject.PDPixelMap.getRGBImage(PDPixelMap.java:252)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.graphics.xobject.PDPixelMap.write2OutputStream(PDPixelMap.java:289)&lt;br/&gt;
	at org.apache.pdfbox.TestGovdocs148902.test148902(TestGovdocs148902.java:58)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at junit.framework.TestCase.runTest(TestCase.java:168)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:134)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:110)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:128)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:113)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:124)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:232)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:227)&lt;br/&gt;
	at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:49)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://domex.nps.edu/corp/files/govdocs1/148/148902.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://domex.nps.edu/corp/files/govdocs1/148/148902.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I pasted it into the src/test/resources/pdfparser folder and run a test case like this:&lt;/p&gt;

&lt;p&gt;public class TestGovdocs148902 extends TestCase&lt;br/&gt;
{&lt;/p&gt;

&lt;p&gt;    public void test148902() throws IOException {&lt;br/&gt;
        PDDocument doc = PDDocument.load( &quot;src/test/resources/pdfparser/148902.pdf&quot;);&lt;br/&gt;
        int imageCounter = 0;&lt;br/&gt;
        COSDocument cosDoc = doc.getDocument();&lt;br/&gt;
        List&amp;lt;COSObject&amp;gt; list = cosDoc.getObjectsByType(COSName.XOBJECT);&lt;/p&gt;

&lt;p&gt;        for (COSObject cosOb : list) {&lt;br/&gt;
            COSBase baseObject = cosOb.getObject();&lt;br/&gt;
            if (baseObject != null &amp;amp;&amp;amp; baseObject instanceof COSStream) {&lt;br/&gt;
                COSStream st = (COSStream)baseObject;&lt;br/&gt;
                String subtype = st.getNameAsString(COSName.SUBTYPE);&lt;br/&gt;
                if (subtype != null &amp;amp;&amp;amp; subtype.equalsIgnoreCase(&quot;image&quot;)) {&lt;br/&gt;
                    PDXObjectImage ximage = (PDXObjectImage)PDXObject.createXObject( st );&lt;br/&gt;
                    if (ximage != null &amp;amp;&amp;amp; ximage.getWidth() &amp;gt;= 5 &amp;amp;&amp;amp; ximage.getHeight() &amp;gt;= 5) {&lt;br/&gt;
                        ByteArrayOutputStream baos = new ByteArrayOutputStream();&lt;br/&gt;
                        ximage.write2OutputStream(baos);&lt;br/&gt;
                        byte [] bytes = baos.toByteArray();&lt;br/&gt;
                        if (bytes.length &amp;gt; 0) &lt;/p&gt;
{
                            imageCounter++;
                        }
&lt;p&gt;                    }&lt;br/&gt;
                }&lt;br/&gt;
            }&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;        assertEquals(32, imageCounter);&lt;br/&gt;
    }&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;The test cases passes in 1.4.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12515257">PDFBOX-1075</key>
            <summary>Can&apos;t get images from a PDF</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="antoni.mylka">Antoni Mylka</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Jul 2011 13:21:25 +0000</created>
                <updated>Wed, 28 May 2014 13:16:10 +0000</updated>
                            <resolved>Sun, 23 Oct 2011 14:55:55 +0000</resolved>
                                    <version>1.6.0</version>
                    <version>1.7.0</version>
                                    <fixVersion>1.7.0</fixVersion>
                                    <component>Parsing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13083160" author="antoni.mylka" created="Thu, 11 Aug 2011 15:22:20 +0000"  >&lt;p&gt;FWIW. &lt;/p&gt;

&lt;p&gt;I narrowed the problem down to revision 1133281. The test used to pass before that revision, and stopped passing afterwards. That revision has been committed by Andreas Lehmk&#252;hler within the scope of &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1010&quot; title=&quot;Image printed with colors inverted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1010&quot;&gt;&lt;del&gt;PDFBOX-1010&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;I have no idea what this commit was about and why it caused a regression. &lt;/p&gt;</comment>
                            <comment id="13084046" author="antoni.mylka" created="Fri, 12 Aug 2011 11:06:52 +0000"  >&lt;p&gt;Narrowed the problem further.&lt;/p&gt;

&lt;p&gt;AFAIU:&lt;/p&gt;

&lt;p&gt;In PDPixelMap.getImage the basic algorithm is:&lt;br/&gt;
1. get the color model&lt;br/&gt;
2. create a compatible WritableRaster&lt;br/&gt;
3. copy the bytes from the PDF to the buffer of the raster&lt;br/&gt;
4. initialize a buffered image with the color model and the raster&lt;/p&gt;

&lt;p&gt;Only part 1. changed in r1133281. Parts 2,3,4 are the same.&lt;/p&gt;

&lt;p&gt;In the old version, the color model returned would be: (taken from toString())&lt;br/&gt;
IndexColorModel: #pixelBits = 1 numComponents = 4 color space = java.awt.color.ICC_ColorSpace@7736bd transparency = 2 transIndex   = 1 has alpha = true isAlphaPre = false&lt;/p&gt;

&lt;p&gt;In the new version:&lt;br/&gt;
IndexColorModel: #pixelBits = 1 numComponents = 3 color space = java.awt.color.ICC_ColorSpace@1bac748 transparency = 1 transIndex   = -1 has alpha = false isAlphaPre = false&lt;/p&gt;

&lt;p&gt;The new version has only 3 components(no alpha channel, no transparency). The old version included the alpha channel and the transparency.&lt;/p&gt;

&lt;p&gt;Now the real problem seems to have surfaced when I did something like this:&lt;/p&gt;

&lt;p&gt;WritableRaster raster = cm.createCompatibleWritableRaster( width, height );            &lt;br/&gt;
if (!cm.isCompatibleRaster(raster)) {&lt;br/&gt;
        System.out.println(&quot;Color model created an incompatible raster&quot;);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;So it seems that in the new version, for this pdf, the createCompatibleWritableRaster method returns rasters which are NOT compatible. &lt;/p&gt;</comment>
                            <comment id="13084171" author="antoni.mylka" created="Fri, 12 Aug 2011 14:59:27 +0000"  >&lt;p&gt;The way I understand it, in an indexed color model, the palette cannot contain more colors than 2^bitsPerPixel. In my case in this PDF there was a picture with 1 bpp, but the arrays csIndexed.getHighValue() would return 255. This is clearly wrong. The high value is taken from the COSArray - i.e. the file itself contains a wrong value. &lt;/p&gt;

&lt;p&gt;As a workaround I replaced the line &lt;/p&gt;

&lt;p&gt;int size = csIndexed.getHighValue()&lt;/p&gt;

&lt;p&gt;with&lt;/p&gt;

&lt;p&gt;int size = Math.min(csIndexed.getHighValue(), 1 &amp;lt;&amp;lt; (bpc-1));&lt;/p&gt;

&lt;p&gt;As I said, an indexed color model can have at most 2^bpc colors in the palette. More make no sense, and in this case break the processing of the image.&lt;/p&gt;

&lt;p&gt;Does it all make sense?&lt;/p&gt;</comment>
                            <comment id="13084305" author="danielwilson" created="Fri, 12 Aug 2011 18:51:07 +0000"  >&lt;p&gt;Antoni,&lt;/p&gt;

&lt;p&gt;Your correction makes sense to me (though I&apos;m not the strongest on the Java graphics model) and it does no harm to the test document provided for &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1010&quot; title=&quot;Image printed with colors inverted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1010&quot;&gt;&lt;del&gt;PDFBOX-1010&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I believe your change should be included.&lt;/p&gt;</comment>
                            <comment id="13133659" author="lehmi" created="Sun, 23 Oct 2011 14:55:00 +0000"  >&lt;p&gt;The size should be calculated as follows:&lt;/p&gt;

&lt;p&gt;int size = Math.min(csIndexed.getHighValue(), (1 &amp;lt;&amp;lt; bpc) - 1); &lt;/p&gt;

&lt;p&gt;Antonis fix accidentically worked for &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1010&quot; title=&quot;Image printed with colors inverted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1010&quot;&gt;&lt;del&gt;PDFBOX-1010&lt;/del&gt;&lt;/a&gt; and this one but introduced a regression with &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-706&quot; title=&quot;CFFParser.readCharset  java.lang.IllegalArgumentException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-706&quot;&gt;&lt;del&gt;PDFBOX-706&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I fixed that in revision 1187899&lt;/p&gt;</comment>
                            <comment id="13133660" author="lehmi" created="Sun, 23 Oct 2011 14:55:55 +0000"  >&lt;p&gt;Set to resolved.&lt;/p&gt;

&lt;p&gt;Thanks for the contribution!&lt;/p&gt;</comment>
                            <comment id="14009797" author="tilman" created="Tue, 27 May 2014 15:29:14 +0000"  >&lt;p&gt;Did anybody keep the mentioned file? The original link is broken; there are several files with that name on the web, including one in Thai.&lt;/p&gt;</comment>
                            <comment id="14009833" author="antoni.mylka" created="Tue, 27 May 2014 15:59:11 +0000"  >&lt;p&gt;FWIW: &lt;/p&gt;

&lt;p&gt;The govdocs dataset is here: &lt;a href=&quot;http://digitalcorpora.org/corp/nps/files/govdocs1/zipfiles&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://digitalcorpora.org/corp/nps/files/govdocs1/zipfiles&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;That particular file should in this zip: &lt;a href=&quot;http://digitalcorpora.org/corp/nps/files/govdocs1/zipfiles/148.zip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://digitalcorpora.org/corp/nps/files/govdocs1/zipfiles/148.zip&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="14011074" author="tallison@mitre.org" created="Wed, 28 May 2014 13:16:10 +0000"  >&lt;p&gt;&lt;a href=&quot;http://digitalcorpora.org/corp/nps/files/govdocs1/148/148902.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://digitalcorpora.org/corp/nps/files/govdocs1/148/148902.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;No problems with 1.8.5.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2828</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 25 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zi7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>205251</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>