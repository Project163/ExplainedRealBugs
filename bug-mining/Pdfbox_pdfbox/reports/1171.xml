<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:01:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2862] GlyphList doesn&apos;t appear to be thread safe in trunk...or user error?</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2862</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;This could be user error, but I&apos;m getting the following when running trunk in a multithreaded environment.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.util.ConcurrentModificationException
        at java.util.HashMap$HashIterator.nextEntry(HashMap.java:922)
        at java.util.HashMap$EntryIterator.next(HashMap.java:962)
        at java.util.HashMap$EntryIterator.next(HashMap.java:960)
        at java.util.HashMap.putAllForCreate(HashMap.java:554)
        at java.util.HashMap.&amp;amp;lt;init&amp;amp;gt;(HashMap.java:298)
        at org.apache.pdfbox.pdmodel.font.encoding.GlyphList.&amp;amp;lt;init&amp;amp;gt;(GlyphList.java:114)
        at org.apache.pdfbox.text.PDFTextStreamEngine.&amp;amp;lt;init&amp;amp;gt;(PDFTextStreamEngine.java:103)
        at org.apache.pdfbox.text.PDFTextStripper.&amp;amp;lt;init&amp;amp;gt;(PDFTextStripper.java:196)
        at org.apache.tika.parser.pdf.PDF2XHTML.&amp;amp;lt;init&amp;amp;gt;(PDF2XHTML.java:106)
        at org.apache.tika.parser.pdf.PDF2XHTML.process(PDF2XHTML.java:133)
        at org.apache.tika.parser.pdf.PDFParser.parse(PDFParser.java:132)
        at org.apache.tika.parser.CompositeParser.parse(CompositeParser.java:281)
        ... 16 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12843551">PDFBOX-2862</key>
            <summary>GlyphList doesn&apos;t appear to be thread safe in trunk...or user error?</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jahewson">John Hewson</assignee>
                                    <reporter username="tallison">Tim Allison</reporter>
                        <labels>
                            <label>multithreading</label>
                    </labels>
                <created>Wed, 8 Jul 2015 15:54:15 +0000</created>
                <updated>Thu, 17 Mar 2016 19:08:25 +0000</updated>
                            <resolved>Fri, 17 Jul 2015 00:21:56 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14619907" author="tilman" created="Thu, 9 Jul 2015 05:12:34 +0000"  >&lt;p&gt;From the trace, it looks like there are several users who access GlyphList.DEFAULT, and thus, the two private HashMap in GlyphList, at the same time. Please try replacing &lt;tt&gt;new HashMap&lt;/tt&gt; with &lt;tt&gt;new HashTable&lt;/tt&gt; or &lt;tt&gt;new ConcurrentHashMap&lt;/tt&gt; everywhere in GlyphList.java.&lt;/p&gt;</comment>
                            <comment id="14620161" author="jahewson" created="Thu, 9 Jul 2015 09:09:28 +0000"  >&lt;p&gt;GlyphList is read-only so it shouldn&apos;t need any synchronization. ConcurrentModificationException means that its being modified at the same time as being read... but DEFAULT is created statically, so how can that be?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison%40mitre.org&quot; class=&quot;user-hover&quot; rel=&quot;tallison@mitre.org&quot;&gt;tallison@mitre.org&lt;/a&gt;, can you post the stack traces for the other threads?&lt;/p&gt;</comment>
                            <comment id="14620409" author="tallison@mitre.org" created="Thu, 9 Jul 2015 12:22:40 +0000"  >&lt;p&gt;First 10k lines from the caught exceptions log file.  This run was against the full govdocs1 corpus so you will see non-pdf exceptions.&lt;/p&gt;

&lt;p&gt;I stopped the batch run after ~200k files. Roughly a quarter of the files are pdfs, so I&apos;d estimate ~50k pdfs.&lt;/p&gt;

&lt;p&gt;There were 22 of these exceptions during that run.&lt;/p&gt;</comment>
                            <comment id="14620460" author="tboehme" created="Thu, 9 Jul 2015 12:59:21 +0000"  >&lt;p&gt;As I understand it the problem is that in the static constructor the instance constructor is called. Thus the class will be in the state &apos;initialized&apos; before the static constructor has finished. Therefore parallel access via static methods are possible, getting the DEFAULT Glyphlist which is currently filled by static constructor.&lt;br/&gt;
It might be enough to place the static methods &lt;em&gt;after&lt;/em&gt; the static constructor since initialization is done in the order it appears within the class (&lt;a href=&quot;http://docs.oracle.com/javase/specs/jls/se7/html/jls-12.html#jls-12.4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javase/specs/jls/se7/html/jls-12.html#jls-12.4&lt;/a&gt;). However I would recommend a static init method and a static AtomicBoolean IS_INITIALIZED variable. The init-method will be called first by all static methods and the instance constructor. The method itself checks state of IS_INITIALIZED and if false, synchronizes on this variable, checks again and does all the things currently in the static constructor. The static Glyphlist variables may also be set to &apos;volatile&apos; in order for other threads to see the correct value in this case. &lt;/p&gt;</comment>
                            <comment id="14621750" author="jahewson" created="Fri, 10 Jul 2015 05:19:27 +0000"  >&lt;p&gt;Yes, I think that explains it. I agree that simply re-ordering the static code is probably going to be brittle. However, the IS_INITIALIZED approach you mention would pay the cost of synchronisation on every static method call, so I&apos;ve created a static load function instead and made the DEFAULT glyph list final. Thanks!&lt;/p&gt;</comment>
                            <comment id="14621751" author="jira-bot" created="Fri, 10 Jul 2015 05:19:30 +0000"  >&lt;p&gt;Commit 1690206 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1690206&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1690206&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2862&quot; title=&quot;GlyphList doesn&amp;#39;t appear to be thread safe in trunk...or user error?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2862&quot;&gt;&lt;del&gt;PDFBOX-2862&lt;/del&gt;&lt;/a&gt;: Avoid static constructor race condition&lt;/p&gt;</comment>
                            <comment id="14630213" author="tallison@mitre.org" created="Thu, 16 Jul 2015 19:29:36 +0000"  >&lt;p&gt;Still getting this with pdfbox-2.0.0-20150716.100016-1548.jar&lt;/p&gt;

&lt;p&gt;Line number in GlyphList has changed, which suggests that I didn&apos;t botch the included jar version, although, frankly, that is not beyond me...&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.util.ConcurrentModificationException
	at java.util.HashMap$HashIterator.nextEntry(HashMap.java
	at java.util.HashMap$EntryIterator.next(HashMap.java:962)
	at java.util.HashMap$EntryIterator.next(HashMap.java:960)
	at java.util.HashMap.putAllForCreate(HashMap.java:554)
	at java.util.HashMap.&amp;lt;init&amp;gt;(HashMap.java:298)
	at org.apache.pdfbox.pdmodel.font.encoding.GlyphList.&amp;lt;init&amp;gt;(GlyphList.java:119)
	at org.apache.pdfbox.text.PDFTextStreamEngine.&amp;lt;init&amp;gt;(PDFTextStreamEngine.java:103)
	at org.apache.pdfbox.text.PDFTextStripper.&amp;lt;init&amp;gt;(PDFTextStripper.java:196)
	at o.a.t.parser.pdf.PDF2XHTML.&amp;lt;init&amp;gt;(PDF2XHTML.java:108)
	at o.a.t.parser.pdf.PDF2XHTML.process(PDF2XHTML.java:135)
	at o.a.t.parser.pdf.PDFParser.parse(PDFParser.java:135)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14630583" author="jahewson" created="Fri, 17 Jul 2015 00:20:01 +0000"  >&lt;p&gt;Ok, I might have figured it out. I don&apos;t think it was actually a static initialization issue at all. While it&apos;s true that a GlyphList is conceptually read-only, nameToUnicode was actually being written to as a cache by toUnicode(code). So if one thread is copying a GlyphList via the copy constructor and another is writing to the cache during a toUnicode(code) call, then there is a concurrent access.&lt;/p&gt;

&lt;p&gt;This problem can be solved without synchronization by introducing a separate, non-shared map for per-instance caching.&lt;/p&gt;</comment>
                            <comment id="14630586" author="jira-bot" created="Fri, 17 Jul 2015 00:21:36 +0000"  >&lt;p&gt;Commit 1691465 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1691465&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1691465&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2862&quot; title=&quot;GlyphList doesn&amp;#39;t appear to be thread safe in trunk...or user error?&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2862&quot;&gt;&lt;del&gt;PDFBOX-2862&lt;/del&gt;&lt;/a&gt;: Avoid concurrent access of nameToUnicode map&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12711349">TIKA-1285</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12744477" name="batch-process-warn-first10klines.log.bz2" size="13249" author="tallison" created="Thu, 9 Jul 2015 12:22:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 18 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gzzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>