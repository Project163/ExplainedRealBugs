<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:54:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1804] PDFTextStripper Issue related to word positions not correctly being parsed</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1804</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I found in a PDF I was pulling text from by using a custom PDFTextStripper subclass that overrides writeString(String text, List&amp;lt;TextPosition&amp;gt; textPositions) that i was getting the wrong textPositions that were not lined up with the text.   I found that the test position of all &#8220;words&#8221; in a line always come over as the &#8220;last&#8221; text positions of the last word in the line.   I found the issue in the PDFTextStripper class&lt;/p&gt;

&lt;p&gt;So here is the Code Issue:&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Used within 
{@link #normalize(List, boolean, boolean)} to handle a {@link TextPosition}.&lt;br/&gt;
     * @return The StringBuilder that must be used when calling this method.&lt;br/&gt;
     */&lt;br/&gt;
    private StringBuilder normalizeAdd(LinkedList&amp;lt;WordWithTextPositions&amp;gt; normalized,&lt;br/&gt;
            StringBuilder lineBuilder, List&amp;lt;TextPosition&amp;gt; wordPositions, TextPosition text)&lt;br/&gt;
    {&lt;br/&gt;
        if (text instanceof WordSeparator) &lt;br/&gt;
        {
            normalized.add(createWord(lineBuilder.toString(), wordPositions));
            lineBuilder = new StringBuilder();
            wordPositions.clear();
        }&lt;br/&gt;
        else &lt;br/&gt;
        {
            lineBuilder.append(text.getCharacter());
            wordPositions.add(text);
        }&lt;br/&gt;
        return lineBuilder;&lt;br/&gt;
    }&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
When the normalizeAdd method, you create a new word passing the wordPositions.   A reference to the wordPositions is stored in the new WordWithTextPositions in the normalized linked list, but in the next line, you clear().   Since the last wordPositions was passed as a reference, the wordPositions is cleared in the WordWithTextPositions you just created.&lt;br/&gt;
&lt;br/&gt;
Soo, i would suggest you do the following:&lt;br/&gt;
/**&lt;br/&gt;
     * Used within {@link #normalize(List, boolean, boolean)}
&lt;p&gt; to handle a &lt;/p&gt;
{@link TextPosition}
&lt;p&gt;.&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;@return The StringBuilder that must be used when calling this method.&lt;br/&gt;
     */&lt;br/&gt;
    private StringBuilder normalizeAdd(LinkedList&amp;lt;WordWithTextPositions&amp;gt; normalized,&lt;br/&gt;
            StringBuilder lineBuilder, List&amp;lt;TextPosition&amp;gt; wordPositions, TextPosition text)
    &lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {        if (text instanceof WordSeparator)         {
            normalized.add(createWord(lineBuilder.toString(), new ArrayList&amp;lt;TextPosition&amp;gt;(wordPositions)));
            lineBuilder = new StringBuilder();
            wordPositions.clear();
        }        else         {
            lineBuilder.append(text.getCharacter());
            wordPositions.add(text);
        }        return lineBuilder;    }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12683607">PDFBOX-1804</key>
            <summary>PDFTextStripper Issue related to word positions not correctly being parsed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="andyphillips404">Andy Phillips</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Dec 2013 14:44:51 +0000</created>
                <updated>Fri, 31 Jan 2014 06:46:17 +0000</updated>
                            <resolved>Thu, 2 Jan 2014 09:24:33 +0000</resolved>
                                    <version>1.8.3</version>
                                    <fixVersion>1.8.4</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Text extraction</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13846747" author="jhosteny" created="Thu, 12 Dec 2013 21:15:48 +0000"  >&lt;p&gt;I can confirm seeing this issue as well, and that the proposed fix works. I&apos;ve attached a patch for the issue.&lt;/p&gt;</comment>
                            <comment id="13846796" author="andyphillips404" created="Thu, 12 Dec 2013 22:01:08 +0000"  >&lt;p&gt;Thanks.&lt;br/&gt;
I am new to open source, how do I get access to propose my own patches?   Any guidance to help here, I&apos;d be interested in helping&lt;/p&gt;
</comment>
                            <comment id="13846814" author="jhosteny" created="Thu, 12 Dec 2013 22:11:53 +0000"  >&lt;p&gt;Andy,&lt;/p&gt;

&lt;p&gt;Once you are logged in, there is a dropdown option near the top left with the title &quot;More.&quot; Click on that, and you&apos;ll see you can attach a file. I attached the output from running a &quot;git diff&quot; on the change in a clone of the repository from github.&lt;/p&gt;

&lt;p&gt;Thanks for finding the issue! I was just starting to look at the same thing.&lt;/p&gt;

&lt;p&gt;Joe&lt;/p&gt;</comment>
                            <comment id="13847168" author="tilman" created="Fri, 13 Dec 2013 05:03:39 +0000"  >&lt;p&gt;@Andy: you don&apos;t. Just attach your diff patches here, and a committer will decide whether to pick them up. Even if not, some developers might take them up for their local source copy of pdfbox.&lt;/p&gt;

&lt;p&gt;See also here&lt;br/&gt;
&lt;a href=&quot;https://www.apache.org/foundation/how-it-works.html#roles&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.apache.org/foundation/how-it-works.html#roles&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13860094" author="lehmi" created="Thu, 2 Jan 2014 09:24:33 +0000"  >&lt;p&gt;I added the proposed fix in revisions 1554774 (trunk) and 1554775 (1.8 branch.&lt;/p&gt;

&lt;p&gt;Thanks for the contribution!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12618475" name="PDFBOX-1804.patch" size="739" author="jhosteny" created="Thu, 12 Dec 2013 21:15:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>362679</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 46 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qilr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>362973</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>