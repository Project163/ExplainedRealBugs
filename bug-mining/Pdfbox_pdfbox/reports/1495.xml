<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:03:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3404] Threads using PDFBox getting stuck when using standard 14 fonts</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3404</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;user &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prstahle&quot; class=&quot;user-hover&quot; rel=&quot;prstahle&quot;&gt;prstahle&lt;/a&gt; reports:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;We have a relatively heavily threaded application which is calling pdfbox to stamp certain&lt;br/&gt;
pdf files. We have been in production for a little over a week and have run into a few threads&lt;br/&gt;
getting stuck. The stack trace is the following:&lt;/p&gt;&lt;/blockquote&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;### &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; id=34, name=&lt;span class=&quot;code-quote&quot;&gt;&quot;dispatch_2_20160626211454_1064&quot;&lt;/span&gt;
# ThreadInfo: &lt;span class=&quot;code-quote&quot;&gt;&quot;dispatch_2_20160626211454_1064&quot;&lt;/span&gt; Id=34 RUNNABLE
# CPU: threadCpuTime=49,541,548.824 ms, threadUserTime=49,538,533.066 ms
# Contention: blockedCount=33 , blockedTime=123 ms
# Contention: lockName=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; , lockOwnerId=-1, lockOwnerName=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
java.util.HashMap.put(HashMap.java:473)
java.util.HashSet.add(HashSet.java:217)
java.util.AbstractCollection.addAll(AbstractCollection.java:334)
org.apache.pdfbox.pdmodel.font.encoding.Encoding.contains(Encoding.java:109)
org.apache.pdfbox.pdmodel.font.PDType1Font.encode(PDType1Font.java:343)
org.apache.pdfbox.pdmodel.font.PDFont.encode(PDFont.java:286)
org.apache.pdfbox.pdmodel.font.PDFont.getStringWidth(PDFont.java:315)
com.tycoelectronics.emcs.stamppdf.StampEnginePDFBox.getLongestTextWidth(StampEnginePDFBox.java:1369)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;We seem to be getting stuck in PDFont classes HashMap which is unsynchronized class.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;We are using  &quot;PDType1Font.HELVETICA&quot;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The problem is that for the standard 14 fonts, each font is a singleton, but its code is being used multithreaded, so we have to secure that.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12984409">PDFBOX-3404</key>
            <summary>Threads using PDFBox getting stuck when using standard 14 fonts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                            <label>multithreading</label>
                    </labels>
                <created>Tue, 28 Jun 2016 15:36:18 +0000</created>
                <updated>Sat, 25 Mar 2017 18:12:30 +0000</updated>
                            <resolved>Fri, 8 Jul 2016 15:48:16 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>2.0.2</version>
                    <version>2.0.3</version>
                    <version>3.0.0 PDFBox</version>
                                    <fixVersion>2.0.3</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15353332" author="jira-bot" created="Tue, 28 Jun 2016 16:33:43 +0000"  >&lt;p&gt;Commit 1750546 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1750546&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1750546&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3404&quot; title=&quot;Threads using PDFBox getting stuck when using standard 14 fonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3404&quot;&gt;&lt;del&gt;PDFBOX-3404&lt;/del&gt;&lt;/a&gt;: use concurrent HashSet&lt;/p&gt;</comment>
                            <comment id="15353336" author="jira-bot" created="Tue, 28 Jun 2016 16:34:38 +0000"  >&lt;p&gt;Commit 1750547 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1750547&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1750547&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3404&quot; title=&quot;Threads using PDFBox getting stuck when using standard 14 fonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3404&quot;&gt;&lt;del&gt;PDFBOX-3404&lt;/del&gt;&lt;/a&gt;: use concurrent HashSet&lt;/p&gt;</comment>
                            <comment id="15353554" author="prstahle" created="Tue, 28 Jun 2016 19:12:55 +0000"  >&lt;p&gt;ConcurrentHashMap, correct?&lt;/p&gt;</comment>
                            <comment id="15353560" author="tilman" created="Tue, 28 Jun 2016 19:17:06 +0000"  >&lt;p&gt;No, it&apos;s a concurrent HashSet but based on a ConcurrentHashMap. And there&apos;s more to come.&lt;/p&gt;</comment>
                            <comment id="15353618" author="jira-bot" created="Tue, 28 Jun 2016 20:02:01 +0000"  >&lt;p&gt;Commit 1750576 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1750576&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1750576&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3382&quot; title=&quot;pdf creation very slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3382&quot;&gt;&lt;del&gt;PDFBOX-3382&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3404&quot; title=&quot;Threads using PDFBox getting stuck when using standard 14 fonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3404&quot;&gt;&lt;del&gt;PDFBOX-3404&lt;/del&gt;&lt;/a&gt;: use concurrentHashMap for standard 14 fonts; remove double WinAnsiEncoding assignment and use it as a singleton; remove unused field&lt;/p&gt;</comment>
                            <comment id="15353624" author="jira-bot" created="Tue, 28 Jun 2016 20:04:03 +0000"  >&lt;p&gt;Commit 1750577 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1750577&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1750577&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3382&quot; title=&quot;pdf creation very slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3382&quot;&gt;&lt;del&gt;PDFBOX-3382&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3404&quot; title=&quot;Threads using PDFBox getting stuck when using standard 14 fonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3404&quot;&gt;&lt;del&gt;PDFBOX-3404&lt;/del&gt;&lt;/a&gt;: use concurrentHashMap for standard 14 fonts; remove double WinAnsiEncoding assignment and use it as a singleton; remove unused field&lt;/p&gt;</comment>
                            <comment id="15357523" author="tilman" created="Thu, 30 Jun 2016 17:38:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prstahle&quot; class=&quot;user-hover&quot; rel=&quot;prstahle&quot;&gt;prstahle&lt;/a&gt; please test your application again with the current snapshot, or create a test that fails with the released version and test that one.&lt;/p&gt;</comment>
                            <comment id="15358880" author="prstahle" created="Fri, 1 Jul 2016 12:20:13 +0000"  >&lt;p&gt;Hi Tilman, It might take some time until we get actually test this. The only place we currently have a way to test this, is in production. We simply do not have anywhere close to the load on any other tier. I will talk to some other developers here to see if we can build some form a test case that can exercise this use case. Unfortunately one of the guys I need to talk to is on vacation until next week. I will keep you posted if we can come up with something.For putting 2.0.3 into production is probably at least a month away from that happening.&lt;/p&gt;</comment>
                            <comment id="15366060" author="prstahle" created="Thu, 7 Jul 2016 13:03:50 +0000"  >&lt;p&gt;As far as we can tell this issue is fixed. We have created a small test java program to test this. I was able to recreate the problem with an older version of pdfbox, while the newer version with this fix did not produce the problem. Also I have only tested this on 2 environments (Oracle Sparc/Solaris &amp;amp; Intel VBox Linux) and so far I am only able to reproduce it on Sparc/Solaris.&lt;/p&gt;

&lt;p&gt;We did run into a few exceptions, however, with both versions. I do not know if this is another issue or simply is to be expected based on the running environment. Here are those exception messages:&lt;/p&gt;

&lt;p&gt;Jul 07, 2016 8:17:00 AM org.apache.pdfbox.pdmodel.font.PDType1Font &amp;lt;init&amp;gt;&lt;br/&gt;
WARNING: Using fallback font ArialMT for base font ZapfDingbats&lt;br/&gt;
Exception occured over textwidth! error=U+0048 (&apos;H&apos;) is not available in this font&apos;s encoding: WinAnsiEncoding&lt;br/&gt;
Exception occured over textwidth! error=U+0048 (&apos;H&apos;) is not available in this font&apos;s encoding: WinAnsiEncoding&lt;/p&gt;

&lt;p&gt;Here was the test procedure:&lt;/p&gt;

&lt;p&gt;Java Source:&lt;br/&gt;
import org.apache.pdfbox.pdmodel.font.PDFont;&lt;br/&gt;
import org.apache.pdfbox.pdmodel.font.PDType1Font;&lt;/p&gt;

&lt;p&gt;public class DOCMGMT_2253 extends Thread {&lt;br/&gt;
        public static void main(String[] args) {&lt;br/&gt;
                int numThreads = 10;                                      // number of threads to use in this test.&lt;br/&gt;
                long considerThreadHungAfterMillis= 1000; // max milliseconds to wait before considering the thread hung&lt;br/&gt;
                int errorsDetected = 0;&lt;/p&gt;

&lt;p&gt;                // Try the init &quot;fix&quot; here once we reproduce the bug&lt;br/&gt;
                // Create the threads&lt;/p&gt;

&lt;p&gt;                DOCMGMT_2253 [] threads = new DOCMGMT_2253&lt;span class=&quot;error&quot;&gt;&amp;#91;numThreads&amp;#93;&lt;/span&gt;;&lt;br/&gt;
                for(int i=0; i&amp;lt; numThreads; i++) &lt;/p&gt;
{
                        threads[i] = new DOCMGMT_2253(&quot;DOCMGMT_2253_&quot;+i);
                }

&lt;p&gt;                // Start the threads&lt;br/&gt;
                for(int i=0; i&amp;lt; numThreads; i++) {&lt;br/&gt;
                        threads&lt;span class=&quot;error&quot;&gt;&amp;#91;i&amp;#93;&lt;/span&gt;.start();&lt;br/&gt;
                        /*&lt;br/&gt;
                        if (i == 0) {&lt;br/&gt;
                                try &lt;/p&gt;
{
                                        Thread.sleep(1000);
                                }
&lt;p&gt;                                catch(Exception e) {}&lt;br/&gt;
                        }&lt;br/&gt;
                        */&lt;br/&gt;
                }&lt;/p&gt;

&lt;p&gt;                // Wait for the threads to finish&lt;br/&gt;
                for(int i=0; i&amp;lt; numThreads; i++) {&lt;br/&gt;
                        try &lt;/p&gt;
{
                                threads[i].join(considerThreadHungAfterMillis);
                                System.out.println(&quot;Thread &quot; + threads[i].getName() + &quot; completed.&quot;);
                        }
&lt;p&gt;                        catch(InterruptedException e) &lt;/p&gt;
{
                                //System.err.println(&quot;ERR20160706125242: Thread &quot; + threads[i].getName() + &quot; did not exit after &quot; + considerThreadHungAfterMillis + &quot; ms&quot;);
                                e.printStackTrace();
                                errorsDetected++;
                        }
&lt;p&gt;                }&lt;/p&gt;

&lt;p&gt;                System.out.println(&quot;Summary: &quot; + errorsDetected + &quot; error(s) detected.&quot;);&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;        public DOCMGMT_2253(String name) &lt;/p&gt;
{
                super(name);
        }

&lt;p&gt;        public void run() {&lt;br/&gt;
                //System.out.println(&quot;Thread &quot; + getName() + &quot; says &apos;Put your code here&apos;&quot;);&lt;br/&gt;
                PDFont font = PDType1Font.HELVETICA;&lt;br/&gt;
                String line = &quot;Hello World line to calculate.&quot;;&lt;br/&gt;
                try &lt;/p&gt;
{
                        float newTextWidth = (font.getStringWidth(line) / 1000.0f) * 34;
                }
&lt;p&gt;                catch(Exception e) &lt;/p&gt;
{
                        System.out.println(&quot;Exception occured over textwidth! error=&quot; + e.getMessage());
                }

&lt;p&gt;                return;&lt;br/&gt;
        }&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;RUN WITH OLD JARS (using small perl script to loop over java program):&lt;br/&gt;
perl -we &apos;for($i = 0; $i &amp;lt; 50; $i++) &lt;/p&gt;
{ system(&quot;java -cp ./:./jars_old/commons-logging-1.1.1.jar:./jars_old/commons-logging-api-1.1.jar:./jars_old/fontbox-2.0.0-20160314.163507-2077.jar:./jars_old/pdfbox-2.0.0-20160314.163655-2022.jar DOCMGMT_2253&quot;);}
&lt;p&gt;&apos;&lt;/p&gt;

&lt;p&gt;With the olds jars so far I have not gotten passed 50 before the problem occurs. At some point it hangs like the following:&lt;br/&gt;
 WARNING: Using fallback font ArialMT for base font ZapfDingbats&lt;br/&gt;
Exception occured over textwidth! error=U+0048 (&apos;H&apos;) is not available in this font&apos;s encoding: WinAnsiEncoding&lt;br/&gt;
Exception occured over textwidth! error=U+0048 (&apos;H&apos;) is not available in this font&apos;s encoding: WinAnsiEncoding&lt;br/&gt;
Thread DOCMGMT_2253_2 completed.&lt;br/&gt;
Exception occured over textwidth! error=U+0048 (&apos;H&apos;) is not available in this font&apos;s encoding: WinAnsiEncoding&lt;br/&gt;
Exception occured over textwidth! error=U+0048 (&apos;H&apos;) is not available in this font&apos;s encoding: WinAnsiEncoding&lt;br/&gt;
Thread DOCMGMT_2253_3 completed.&lt;br/&gt;
Exception occured over textwidth! error=U+006F (&apos;o&apos;) is not available in this font&apos;s encoding: WinAnsiEncoding&lt;br/&gt;
Exception occured over textwidth! error=U+006F (&apos;o&apos;) is not available in this font&apos;s encoding: WinAnsiEncoding&lt;br/&gt;
Exception occured over textwidth! error=U+006F (&apos;o&apos;) is not available in this font&apos;s encoding: WinAnsiEncoding&lt;br/&gt;
Exception occured over textwidth! error=U+006F (&apos;o&apos;) is not available in this font&apos;s encoding: WinAnsiEncoding&lt;br/&gt;
Thread DOCMGMT_2253_4 completed.&lt;br/&gt;
Thread DOCMGMT_2253_5 completed.&lt;br/&gt;
Thread DOCMGMT_2253_6 completed.&lt;br/&gt;
Thread DOCMGMT_2253_7 completed.&lt;br/&gt;
Thread DOCMGMT_2253_8 completed.&lt;br/&gt;
Thread DOCMGMT_2253_9 completed.&lt;br/&gt;
Summary: 0 error(s) detected.&lt;/p&gt;

&lt;p&gt;So now to check to state of things I do the following:&lt;br/&gt;
ps -ef |grep perl                                                                                                                                                                            &lt;br/&gt;
xxxxxxx 13380  5395   0 08:29:34 pts/58      0:00 perl -we for($i = 0; $i &amp;lt; 50; $i++) { system(&quot;java -cp ./:./jars_old/commons-lo&lt;br/&gt;
ptree 13380&lt;br/&gt;
31956 zsched&lt;br/&gt;
  29947 tmux&lt;br/&gt;
    5252  -bash&lt;br/&gt;
      5395  -bash&lt;br/&gt;
        13380 perl -we for($i = 0; $i &amp;lt; 50; $i++) { system(&quot;java -cp ./:./jars_old/commons-lo&lt;br/&gt;
          53792 java -cp ./:./jars_old/commons-logging-1.1.1.jar:./jars_old/commons-logging-api&lt;/p&gt;

&lt;p&gt;jstack 53792&lt;br/&gt;
2016-07-07 08:39:03&lt;br/&gt;
Full thread dump Java HotSpot(TM) Server VM (24.79-b02 mixed mode):&lt;/p&gt;

&lt;p&gt;&quot;Attach Listener&quot; daemon prio=3 tid=0x00ee4000 nid=0xb3 waiting on condition &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00000000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;/p&gt;

&lt;p&gt;&quot;DestroyJavaVM&quot; prio=3 tid=0x00028400 nid=0x2 waiting on condition &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00000000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;/p&gt;

&lt;p&gt;&quot;DOCMGMT_2253_1&quot; prio=3 tid=0x008bbc00 nid=0xaa runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0xab05f000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;br/&gt;
        at java.util.HashMap.put(HashMap.java:494)&lt;br/&gt;
        at java.util.HashSet.add(HashSet.java:217)&lt;br/&gt;
        at java.util.AbstractCollection.addAll(AbstractCollection.java:342)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.font.encoding.Encoding.contains(Encoding.java:109)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.font.PDType1Font.encode(PDType1Font.java:343)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.font.PDFont.encode(PDFont.java:286)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.font.PDFont.getStringWidth(PDFont.java:315)&lt;br/&gt;
        at DOCMGMT_2253.run(DOCMGMT_2253.java:67)&lt;/p&gt;

&lt;p&gt;&quot;DOCMGMT_2253_0&quot; prio=3 tid=0x008bac00 nid=0xa9 runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0xab0ef000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;br/&gt;
        at java.util.HashMap.put(HashMap.java:494)&lt;br/&gt;
        at java.util.HashSet.add(HashSet.java:217)&lt;br/&gt;
        at java.util.AbstractCollection.addAll(AbstractCollection.java:342)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.font.encoding.Encoding.contains(Encoding.java:109)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.font.PDType1Font.encode(PDType1Font.java:343)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.font.PDFont.encode(PDFont.java:286)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.font.PDFont.getStringWidth(PDFont.java:315)&lt;br/&gt;
        at DOCMGMT_2253.run(DOCMGMT_2253.java:67)&lt;/p&gt;

&lt;p&gt;&quot;Service Thread&quot; daemon prio=3 tid=0x00722000 nid=0xa7 runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00000000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: RUNNABLE&lt;br/&gt;
:&lt;br/&gt;
:&lt;/p&gt;

&lt;p&gt;Note: I have run this 3 times and all 3 times have locked up.&lt;/p&gt;

&lt;p&gt;RUN WITH NEW JARS (using small perl script to loop over java program. Bumped up to loop 150 times.):&lt;br/&gt;
perl -we &apos;for($i = 0; $i &amp;lt; 150; $i++) &lt;/p&gt;
{ system(&quot;java -cp ./:./jars_new/commons-logging-1.1.1.jar:./jars_new/commons-logging-api-1.1.jar:./jars_new/fontbox-2.0.3-20160706.181207-87.jar:./jars_new/pdfbox-2.0.3-20160706.181453-84.jar DOCMGMT_2253&quot;);}
&lt;p&gt;&apos;&lt;/p&gt;

&lt;p&gt;COMPLETES as expected. &lt;/p&gt;

&lt;p&gt;Note: I have against new jars 1 time at 50 loops, and 2 times at 150 loops.&lt;/p&gt;
</comment>
                            <comment id="15366421" author="tilman" created="Thu, 7 Jul 2016 17:12:18 +0000"  >&lt;p&gt;Ooooh, this is bad. It doesn&apos;t happen with 1 thread, sometimes with 9, and always with 10. Thanks for finding that one.&lt;/p&gt;</comment>
                            <comment id="15366553" author="jira-bot" created="Thu, 7 Jul 2016 18:27:00 +0000"  >&lt;p&gt;Commit 1751823 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1751823&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1751823&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3404&quot; title=&quot;Threads using PDFBox getting stuck when using standard 14 fonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3404&quot;&gt;&lt;del&gt;PDFBOX-3404&lt;/del&gt;&lt;/a&gt;: drop concurrent HashSet, synchronize initialization instead&lt;/p&gt;</comment>
                            <comment id="15366555" author="jira-bot" created="Thu, 7 Jul 2016 18:29:21 +0000"  >&lt;p&gt;Commit 1751824 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1751824&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1751824&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3404&quot; title=&quot;Threads using PDFBox getting stuck when using standard 14 fonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3404&quot;&gt;&lt;del&gt;PDFBOX-3404&lt;/del&gt;&lt;/a&gt;: drop concurrent HashSet, synchronize initialization instead&lt;/p&gt;</comment>
                            <comment id="15366559" author="tilman" created="Thu, 7 Jul 2016 18:32:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=prstahle&quot; class=&quot;user-hover&quot; rel=&quot;prstahle&quot;&gt;prstahle&lt;/a&gt; please try again. One of the previous code changes may have resulted in an already initialized map getting empty while being initialized by another thread. Anyway, your code works for me now.&lt;/p&gt;</comment>
                            <comment id="15367815" author="prstahle" created="Fri, 8 Jul 2016 15:35:56 +0000"  >&lt;p&gt;Hi Tilman,&lt;/p&gt;

&lt;p&gt;I ran my test against trunk (2.1.0) source build with no errors. Thanks....&lt;/p&gt;</comment>
                            <comment id="15367841" author="tilman" created="Fri, 8 Jul 2016 15:48:16 +0000"  >&lt;p&gt;Thanks for the feedback and the very helpful error reports and the test case!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 19 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i309i7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>