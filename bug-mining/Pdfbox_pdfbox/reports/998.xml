<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:59:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1871] Content appears a few px higher when rasterizing PDF</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1871</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;PDFBox seems to be off by a little bit vertically when you rasterize a PDF. This is in comparison to both Adobe&apos;s PDF library and many other PDF viewers such as Chrome&apos;s and the one in OS X.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached an example PDF where there&apos;s some text with a green rectangle around it. The rectangle is has about 2x as much space above it compared to below it, but in PDFBox&apos;s raster, the rectangle is closer to the top than is is to the bottom.&lt;/p&gt;

&lt;p&gt;This is obvious at 300 dpi but at 96 dpi it&apos;s hard to tell for sure. Anecdotally, I&apos;ve noticed that when rendering text at about 74 dpi, PDFBox seems to be off by about 1px.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached both a PDFBox raster and one made with Adobe&apos;s PDF library for comparison.&lt;br/&gt;
java -jar pdfbox-app-1.8.3.jar PDFToImage -imageType PNG -resolution 300 -color rgba test-text-alignment-textbox.pdf&lt;/p&gt;</description>
                <environment></environment>
        <key id="12692169">PDFBOX-1871</key>
            <summary>Content appears a few px higher when rasterizing PDF</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="jon_wu">Jon Wu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Jan 2014 22:54:10 +0000</created>
                <updated>Thu, 17 Mar 2016 19:07:58 +0000</updated>
                            <resolved>Tue, 17 Feb 2015 19:40:46 +0000</resolved>
                                    <version>1.8.3</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13885961" author="jon_wu" created="Wed, 29 Jan 2014 22:59:15 +0000"  >&lt;p&gt;I&apos;m actually most concerned about the text as the box is really just for debugging and the text appears to be 3-4 px too high in the 300 dpi raster and about 1px too high at around 70-90 dpi.&lt;/p&gt;</comment>
                            <comment id="14307371" author="tilman" created="Thu, 5 Feb 2015 15:16:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1871&quot; title=&quot;Content appears a few px higher when rasterizing PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1871&quot;&gt;&lt;del&gt;PDFBOX-1871&lt;/del&gt;&lt;/a&gt;_unc.pdf is a reduced version of the file, it has only the rectangle.&lt;/p&gt;</comment>
                            <comment id="14316720" author="jahewson" created="Wed, 11 Feb 2015 18:28:38 +0000"  >&lt;p&gt;Here&apos;s a patch which alters the rendering of many PDF files by 1px by performing a more accurate rounding. The insight is realising that rounding the image buffer up causes it to have a white border:&lt;/p&gt;

&lt;p&gt;In PDFRenderer#renderImage(), replace:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; widthPx = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.round(widthPt * scale);
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; heightPx = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.round(heightPt * scale);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; widthPx = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.floor(widthPt * scale);
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; heightPx = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.floor(heightPt * scale);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Try this with EnviroNewsSummer2009.pdf from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1058&quot; title=&quot;Converting PDF to Image gives error and the image generated is of poor quality&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1058&quot;&gt;&lt;del&gt;PDFBOX-1058&lt;/del&gt;&lt;/a&gt; to see the effect clearly.&lt;/p&gt;</comment>
                            <comment id="14316993" author="tilman" created="Wed, 11 Feb 2015 21:14:38 +0000"  >&lt;p&gt;I don&apos;t see any difference?! Also not for the file mentioned by Jon. Not really surprising, because the effect that Jon describes gets more with high resolutions, while your fix is about 1px only.&lt;/p&gt;</comment>
                            <comment id="14317216" author="jahewson" created="Wed, 11 Feb 2015 23:39:18 +0000"  >&lt;p&gt;I pulled those lines out another patch without too much thought, try making this change too:&lt;/p&gt;

&lt;p&gt;Replace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;graphics.translate(0, (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) pageSize.getHeight());&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;graphics.translate(0, pageSize.getHeight());&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in PageDrawer#drawPage&lt;/p&gt;</comment>
                            <comment id="14323376" author="tilman" created="Mon, 16 Feb 2015 22:06:35 +0000"  >&lt;p&gt;Yeah this time it&apos;s clearly better, but I&apos;ve tested only Jon&apos;s file. Will test more tomorrow.&lt;/p&gt;</comment>
                            <comment id="14323777" author="tilman" created="Tue, 17 Feb 2015 07:30:26 +0000"  >&lt;p&gt;I ran my tests after going to sleep and here are a few files that have content that is close to the border:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;all GWG* files&lt;/li&gt;
	&lt;li&gt;gs-bugzilla694413.pdf&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1931&quot; title=&quot;Radial shading is missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1931&quot;&gt;&lt;del&gt;PDFBOX-1931&lt;/del&gt;&lt;/a&gt;.pdf&lt;br/&gt;
All look better.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;m running another test that has the change from PageDrawer only.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jon_wu&quot; class=&quot;user-hover&quot; rel=&quot;jon_wu&quot;&gt;jon_wu&lt;/a&gt; please try the modifications on your production files. The one from PageDrawer is a good one for sure.&lt;/p&gt;</comment>
                            <comment id="14323910" author="jon_wu" created="Tue, 17 Feb 2015 08:17:46 +0000"  >&lt;p&gt;I tried PageDrawer modifications only and it looks pretty spot on with just that change in the few tests I tried. There&apos;s no problem translating by a double right? I noticed that this change made some of my tested files appear blurrier but I&apos;m assuming that&apos;s a coincidence and stuff like hinting happens at the very end so there&apos;s no reason translation has to be an int right?&lt;/p&gt;

&lt;p&gt;This fix also removes a white line I was getting at the bottom of renders - now I know that&apos;s just because everything was a few px too high. After the fix, there is no difference in position compared with Photoshop&apos;s rendering.&lt;/p&gt;</comment>
                            <comment id="14324739" author="jira-bot" created="Tue, 17 Feb 2015 19:30:23 +0000"  >&lt;p&gt;Commit 1660471 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1660471&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1660471&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1871&quot; title=&quot;Content appears a few px higher when rasterizing PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1871&quot;&gt;&lt;del&gt;PDFBOX-1871&lt;/del&gt;&lt;/a&gt;: use more accurate y translation, thanks John Hewson&lt;/p&gt;</comment>
                            <comment id="14324752" author="tilman" created="Tue, 17 Feb 2015 19:40:09 +0000"  >&lt;p&gt;&lt;blockquote&gt;&lt;p&gt;There&apos;s no problem translating by a double right?&lt;/p&gt;&lt;/blockquote&gt; Sorry, don&apos;t know what you mean. I doubt there&apos;s a difference in calculations whether we use float or double.&lt;/p&gt;

&lt;p&gt;re: blurry - we&apos;re at the mercy of Java graphics here. &lt;/p&gt;

&lt;p&gt;I tested the differences re: the PDFRender change. Better without that change (but with the other one):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1931&quot; title=&quot;Radial shading is missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1931&quot;&gt;&lt;del&gt;PDFBOX-1931&lt;/del&gt;&lt;/a&gt;.pdf&lt;/li&gt;
	&lt;li&gt;_gs-bugzilla694413.pdf&lt;/li&gt;
	&lt;li&gt;all GWG files&lt;br/&gt;
With the change, these are cut off one pixel. Your own fine is identical.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14324840" author="jon_wu" created="Tue, 17 Feb 2015 20:35:00 +0000"  >&lt;p&gt;With the previous code the translation was by int value. I wasn&apos;t sure if some code before this could be optimized to make sure stuff was spot on for a given pixel (in which case an int translation would maintain that), but that seems like a longshot - stuff will always be in between pixels when going from pt to px in most cases.&lt;/p&gt;</comment>
                            <comment id="14324841" author="jon_wu" created="Tue, 17 Feb 2015 20:35:02 +0000"  >&lt;p&gt;With the previous code the translation was by int value. I wasn&apos;t sure if some code before this could be optimized to make sure stuff was spot on for a given pixel (in which case an int translation would maintain that), but that seems like a longshot - stuff will always be in between pixels when going from pt to px in most cases.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12696774" name="PDFBOX-1871_unc.pdf" size="70159" author="tilman" created="Thu, 5 Feb 2015 15:16:35 +0000"/>
                            <attachment id="12626000" name="test-text-alignment-textbox-PDF2IMG-300dpi.png" size="8380" author="jon_wu" created="Wed, 29 Jan 2014 22:54:31 +0000"/>
                            <attachment id="12626001" name="test-text-alignment-textbox-PDFBox-1.8.3-300dpi.png" size="7039" author="jon_wu" created="Wed, 29 Jan 2014 22:54:31 +0000"/>
                            <attachment id="12626002" name="test-text-alignment-textbox.pdf" size="38477" author="jon_wu" created="Wed, 29 Jan 2014 22:54:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>370760</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rwef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>371068</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>