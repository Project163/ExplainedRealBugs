<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:10:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4956] COSName.hashCode initialized after put to cache, instead before</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4956</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;In the constructor org.apache.pdfbox.cos.COSName.COSName(String, boolean), the field COSNam.hashCode becomes initialized after the COSName instance has been added to the cache.&lt;/p&gt;

&lt;p&gt;Thus, concurrent threads using the cached instance may see different values in COSName.hashCode().&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Just to mention, that&apos;s another problem:&lt;br/&gt;
 The whole caching is quite dirty, because it leaks memory if the application is not aware of calling COSName.clearResources().&lt;br/&gt;
 Ideally, the class COSName would not exist at all, since it has no benefit over using strings directly. Of course, it would be quite a hard work to get rid of it.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13327096">PDFBOX-4956</key>
            <summary>COSName.hashCode initialized after put to cache, instead before</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="joerg.wassmer">J&#246;rg Wa&#223;mer</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Sep 2020 14:05:19 +0000</created>
                <updated>Sun, 20 Dec 2020 18:48:01 +0000</updated>
                            <resolved>Mon, 2 Nov 2020 21:39:58 +0000</resolved>
                                    <version>2.0.21</version>
                                    <fixVersion>2.0.22</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Parsing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17194285" author="joerg.wassmer" created="Fri, 11 Sep 2020 14:14:18 +0000"  >&lt;p&gt;Furthermore, the static fields for the caches should be final, And COSName.clearResources() has no need to be synchronized, since using ConcurrentHashMap.&lt;/p&gt;</comment>
                            <comment id="17202625" author="jira-bot" created="Sat, 26 Sep 2020 16:24:06 +0000"  >&lt;p&gt;Commit 1882046 from lehmi@apache.org in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1882046&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1882046&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4956&quot; title=&quot;COSName.hashCode initialized after put to cache, instead before&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4956&quot;&gt;&lt;del&gt;PDFBOX-4956&lt;/del&gt;&lt;/a&gt;: make maps final, fix hashcode initialization as proposed by J&#246;rg Wa&#223;mer&lt;/p&gt;</comment>
                            <comment id="17202626" author="jira-bot" created="Sat, 26 Sep 2020 16:25:07 +0000"  >&lt;p&gt;Commit 1882047 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1882047&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1882047&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4956&quot; title=&quot;COSName.hashCode initialized after put to cache, instead before&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4956&quot;&gt;&lt;del&gt;PDFBOX-4956&lt;/del&gt;&lt;/a&gt;: make maps final, fix hashcode initialization as proposed by J&#246;rg Wa&#223;mer&lt;/p&gt;</comment>
                            <comment id="17202627" author="lehmi" created="Sat, 26 Sep 2020 16:47:24 +0000"  >&lt;p&gt;I&apos;ve fixed the hashcode calculation and made the static fields final as proposed.&lt;/p&gt;

&lt;p&gt;I didn&apos;t removed the synchronized from COSName.clearResources() as ConcurrentHashMap is thread safe but the access to the elements isn&apos;t synchronized. A remove operation doesn&apos;t look the map so that a concurrent get operation may access an element which is deleted right after that.&lt;br/&gt;
Excerpt from the class documentation&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 * that key reporting the updated value.)  For aggregate operations
 * such as {@code putAll} and {@code clear}, concurrent retrievals may
 * reflect insertion or removal of only some entries.  Similarly,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can&apos;t simply replace all COSName occurrencies with String as we need to distinguish names (some sort of constant strings) from strings otherwise we won&apos;t be able to write correct pdfs. Maybe it would make sense to think about using strings as key for a COSDictionary instead of COSName. But I&apos;m not sure if this give us any real benefit.&lt;/p&gt;



</comment>
                            <comment id="17224974" author="lehmi" created="Mon, 2 Nov 2020 21:39:58 +0000"  >&lt;p&gt;I&apos;ll keep the idea of at least partly removing/replacing COSName instances with strings in my mind, but for now we are done here. Set to resolved&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joerg.wassmer&quot; class=&quot;user-hover&quot; rel=&quot;joerg.wassmer&quot;&gt;joerg.wassmer&lt;/a&gt; Thanks for the report&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 1 week, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0iitc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>