<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:52:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-813] ClassCastException: COSInteger cannot be cast to COSDictionary</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-813</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I get the below exceptions when calling pdfDoc.getDocumentCatalog().getAllPages(). The code continues after the first exception because I&apos;ve called PDDocument.load(&quot;C:/CancerSummReport_34914.pdf&quot;, true)  setting the load &quot;force&quot; param to true. The second exception causes the code to abort.&lt;/p&gt;

&lt;p&gt;(I will try uploading the PDF that causes this problem)&lt;/p&gt;

&lt;p&gt;2010-09-02 16:47:47,521 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; WARN  (PDFParser.java:189) - Parsing Error, Skipping Object&lt;br/&gt;
java.io.IOException: Error: Expected an integer type, actual=&apos;bj&apos;&lt;br/&gt;
	at org.apache.pdfbox.pdfparser.BaseParser.readInt(BaseParser.java:1310)&lt;br/&gt;
	at org.apache.pdfbox.pdfparser.PDFParser.parseObject(PDFParser.java:497)&lt;br/&gt;
	at org.apache.pdfbox.pdfparser.PDFParser.parse(PDFParser.java:179)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.PDDocument.load(PDDocument.java:878)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.PDDocument.load(PDDocument.java:843)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.PDDocument.load(PDDocument.java:768)&lt;br/&gt;
	at com.xyz.framework.functionalTests.PDFBoxBug.main(PDFBoxBug.java:16)&lt;/p&gt;

&lt;p&gt;2010-09-02 16:47:47,552 &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; WARN  (BaseParser.java:215) - Invalid dictionary, found:? but expected:&apos;&apos;&lt;br/&gt;
Exception in thread &quot;main&quot; java.lang.ClassCastException: org.apache.pdfbox.cos.COSInteger cannot be cast to org.apache.pdfbox.cos.COSDictionary&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.PDDocument.getDocumentCatalog(PDDocument.java:414)&lt;br/&gt;
	at com.xyz.framework.functionalTests.PDFBoxBug.main(PDFBoxBug.java:18)&lt;/p&gt;</description>
                <environment>Windows XP&lt;br/&gt;
&lt;br/&gt;
java version &amp;quot;1.6.0_12&amp;quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_12-b04)&lt;br/&gt;
Java HotSpot(TM) Client VM (build 11.2-b01, mixed mode, sharing)&lt;br/&gt;
</environment>
        <key id="12473183">PDFBOX-813</key>
            <summary>ClassCastException: COSInteger cannot be cast to COSDictionary</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="umk">CP</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Sep 2010 20:58:23 +0000</created>
                <updated>Tue, 26 Oct 2010 09:34:30 +0000</updated>
                            <resolved>Thu, 14 Oct 2010 10:01:12 +0000</resolved>
                                    <version>1.2.1</version>
                    <version>1.3.1</version>
                                    <fixVersion>1.3.1</fixVersion>
                                    <component>Parsing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12905670" author="umk" created="Thu, 2 Sep 2010 21:02:41 +0000"  >&lt;p&gt;The PDF was created with Apache FOP v0.95&lt;/p&gt;</comment>
                            <comment id="12905681" author="adamnichols" created="Thu, 2 Sep 2010 21:40:31 +0000"  >&lt;p&gt;This PDF does not conform to the Adobe PDF specification.  If you open the PDF in a text editor and scroll down to the bottom, you&apos;ll see a random &quot;bj&quot; after the %%EOF marker.  That&apos;s invalid, but PDFBox is cool about it and it just warns you of this problem, it doesn&apos;t cause any serious problem.  The second message also is merely a warning.&lt;/p&gt;

&lt;p&gt;Having said that, I tested using latest code from SVN and this PDF loaded properly.  I tested both with PDDocument.load( inputpath); and PDDocument.load(inputpath, true);&lt;/p&gt;

&lt;p&gt;What version of PDFBox are you using?  I&apos;d suggest trying the latest from SVN if you can.  The logs you posted so not contain any stacktraces which caused the code to abort.  There should be some other stacktrace which has more information.&lt;/p&gt;</comment>
                            <comment id="12905881" author="umk" created="Fri, 3 Sep 2010 13:15:13 +0000"  >&lt;p&gt;Adam, thank you much for your reply but I think there still is a problem here.&lt;/p&gt;

&lt;p&gt;After calling PDDocument.load(...) did you then call getDocumentCatalog().getAllPages() ? When I call getAllPages() the code throws a ClassCastException which stops the code from running - not just a warning.&lt;/p&gt;

&lt;p&gt;I&apos;m running PDFBox v1.2.1&lt;/p&gt;</comment>
                            <comment id="12905970" author="adamnichols" created="Fri, 3 Sep 2010 17:26:40 +0000"  >&lt;p&gt;Ah, I missed the doc.getDocumentCatalog().getAllPages(); part.  However, when I added that in just now, I found that it still worked okay with the latest code from SVN.  I made a few different changes to the parser recently so I&apos;m not sure which of the changes fix the problem.  If you can try the latest code and confirm that it works, I&apos;ll go ahead and close this issue.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure when PDFBox 1.3.0 will be released, but the changes will be in that version.  I&apos;ll bring it up to the other developers and see if we can come up with either an ETA or a list of tasks which should be completed for the 1.3.0 release.&lt;/p&gt;</comment>
                            <comment id="12914224" author="umk" created="Thu, 23 Sep 2010 21:07:34 +0000"  >&lt;p&gt;I downloaded the latest code today from SVN, built new libraries, added them to the project and ran the same test. &lt;/p&gt;

&lt;p&gt;I still see the problem.&lt;/p&gt;</comment>
                            <comment id="12914444" author="umk" created="Fri, 24 Sep 2010 12:42:06 +0000"  >&lt;p&gt;Just to be sure I&apos;m clear: a WARN message is logged but the ClassCastException is severe and causes pdDoc.getDocumentCatalog().getAllPages(); method to abort so my code cannot continue. &lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="12915503" author="adamnichols" created="Mon, 27 Sep 2010 22:00:10 +0000"  >&lt;p&gt;Well, I can tell you the reason it can&apos;t be parsed is because it&apos;s not a valid PDF.  If you open it and look at the bottom, you&apos;ll find that the trailer looks like this:&lt;br/&gt;
trailer&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/Size 41&lt;br/&gt;
/Root 2&lt;/p&gt;

&lt;p&gt;There&apos;s not even a newline nor carriage return after that last &quot;2&quot;.  Since this does not conform to Adobe&apos;s PDF specification, the way this should be handled is undefined, so throwing an exception is not unreasonable.&lt;/p&gt;

&lt;p&gt;However, what is interesting is that if you replace PDDocument.load(inputpath, true); with PDDocument.load(inputpath); or PDDocument.load(inputpath, false); the exception is not thrown!  I find this most interesting because force is only passed into the parser object it&apos;s only used once in that class and it seems to be used to prevent an exception from being thrown.&lt;/p&gt;

&lt;p&gt;I looked into this a little further and found that if forceParsing is false, the exception your PDF throws is an IOException and it&apos;s caught and basically ignored by code which handles invalid PDFs which have random data after the EOF marker.  If you are blindly loading a document (aka forcing the loading), and that document is corrupt, you can&apos;t expect that there was enough information read to properly.&lt;/p&gt;

&lt;p&gt;My suggestion would be to load documents without the force option and understand that there are some non-conforming PDFs which may not be able to be parsed and have your code handle that accordingly.  This message will hit the developers mailing list and we will discuss the possibility of deprecating the force option on the load() method.  While it may have been accurate when it was first introduced, I feel that it&apos;s misleading now that we handle so many different things which are out-of-spec.&lt;/p&gt;</comment>
                            <comment id="12916640" author="umk" created="Thu, 30 Sep 2010 20:26:38 +0000"  >&lt;p&gt;Thanks for your feedback and suggestions.&lt;/p&gt;

&lt;p&gt;I have stopped using the force option and the code now behaves better. So yes, the force parameter is probably unnecessary now.&lt;/p&gt;</comment>
                            <comment id="12920908" author="jukkaz" created="Thu, 14 Oct 2010 10:01:12 +0000"  >&lt;p&gt;Fixed in revision 1022444 by explicitly checking the type of the Root object.&lt;/p&gt;

&lt;p&gt;I think this is a better solution than dropping (or deprecating) the forceParsing option, as there are quite a few malformed PDFs out there that can still be processed reasonably well even with relaxed parsing rules. Sometimes this results in PDDocuments with unexpected internal structures, but it&apos;s IMHO better to try degrading gracefully in such cases.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12453725" name="CancerSummReport_34914.pdf" size="33792" author="umk" created="Thu, 2 Sep 2010 21:01:25 +0000"/>
                            <attachment id="12453724" name="PDFBoxBug.java" size="517" author="umk" created="Thu, 2 Sep 2010 21:01:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163509</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 6 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zfpz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>204849</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>