<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:52:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-574] PDFBox image extraction fails with an ArrayOutOfBoundsException in PDPixelMap.getRGBImage()</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-574</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>
&lt;p&gt;The project that I&apos;m working on has been using PDFBox for both text extraction and image extraction from PDF documents.  We wrote a class, PDFImageStripper, which extends PDFStreamEngine:&lt;/p&gt;

&lt;p&gt;public class PDFImageStripper extends PDFStreamEngine &lt;/p&gt;


&lt;p&gt;	public List&amp;lt;ExtractedImage&amp;gt; getImages(PDDocument document, String documentFilename, File targetDirectory) throws IOException &lt;/p&gt;
{
		resetEngine();
		
		this.document = document;
		this.documentFilename = documentFilename;
		this.targetDirectory = targetDirectory;
        
        currentImageNumber = 1;
        
        images.clear();
        writeImages();        
        return images;
    }


&lt;p&gt;	private void writeImages() throws IOException {&lt;br/&gt;
		List&amp;lt;PDPage&amp;gt; pages = (List&amp;lt;PDPage&amp;gt;) document.getDocumentCatalog().getAllPages();&lt;br/&gt;
		for (PDPage page : pages) {&lt;br/&gt;
		    if (page != null) &lt;/p&gt;
{
		        processStream(page, page.findResources(), page.getContents().getStream());
		    }
&lt;p&gt;	    }&lt;br/&gt;
	}&lt;/p&gt;


&lt;p&gt;The call chain is shown below:&lt;/p&gt;


&lt;p&gt;None.decode(byte[], byte[]) line: 57	&lt;br/&gt;
PDPixelMap.getRGBImage() line: 182	&lt;br/&gt;
PDPixelMap.write2OutputStream(OutputStream) line: 209	&lt;br/&gt;
PDPixelMap(PDXObjectImage).write2file(File) line: 142	&lt;br/&gt;
PDFImageStripper.saveImage(PDXObjectImage, String, File) line: 208	&lt;br/&gt;
PDFImageStripper.processOperator(PDFOperator, List) line: 155	&lt;br/&gt;
PDFImageStripper(PDFStreamEngine).processSubStream(PDPage, PDResources, COSStream) line: 229	&lt;br/&gt;
PDFImageStripper(PDFStreamEngine).processStream(PDPage, PDResources, COSStream) line: 188	&lt;br/&gt;
PDFImageStripper.writeImages() line: 113	&lt;/p&gt;


&lt;p&gt;There is an ArrayOutOfBoundsException in the decode method.  The decode method is nothing more than a wrapper for a call to System.arraycopy():&lt;/p&gt;


&lt;p&gt;    public void decode(byte[] src, byte[] dest)&lt;/p&gt;
    {
        System.arraycopy(src,0,dest,0,src.length);
    }


&lt;p&gt;The problem is, the source array is larger than the destination array.  This is show (from the Eclipse debugger) below:&lt;/p&gt;


&lt;p&gt;src	byte&lt;span class=&quot;error&quot;&gt;&amp;#91;455112&amp;#93;&lt;/span&gt;  (id=171)	&lt;br/&gt;
dest	byte&lt;span class=&quot;error&quot;&gt;&amp;#91;435456&amp;#93;&lt;/span&gt;  (id=175)	&lt;/p&gt;


&lt;p&gt;The code that seems to be causing the problem is shown below.  The branch that this bug shows up on is the LZW_DECODE branch.  Note that in the other code branch, the code makes sure that there is no size problem.&lt;/p&gt;


&lt;p&gt;            if( predictor &amp;lt; 10 ||&lt;br/&gt;
                filters == null || !(filters.contains( COSName.LZW_DECODE.getName()) ||&lt;br/&gt;
                         filters.contains( COSName.FLATE_DECODE.getName()) ) )&lt;/p&gt;
            {
                PredictorAlgorithm filter = PredictorAlgorithm.getFilter(predictor);
                filter.setWidth(width);
                filter.setHeight(height);
                filter.setBpp((bpc * 3) / 8);
                filter.decode(array, bufferData);
            }
&lt;p&gt;            else&lt;/p&gt;
            {
                System.arraycopy( array, 0,bufferData, 0, 
                        (array.length&amp;lt;bufferData.length?array.length: bufferData.length) );
            }


&lt;p&gt;One fix may be to simply change the code as follows (again, recall that the &quot;decode&quot; method is nothing but a wrapper for System.arraycopy()):&lt;/p&gt;


&lt;p&gt;          if( predictor &amp;lt; 10 ||&lt;br/&gt;
                filters == null || !(filters.contains( COSName.LZW_DECODE.getName()) ||&lt;br/&gt;
                         filters.contains( COSName.FLATE_DECODE.getName()) ) )&lt;/p&gt;
            {
                PredictorAlgorithm filter = PredictorAlgorithm.getFilter(predictor);
                filter.setWidth(width);
                filter.setHeight(height);
                filter.setBpp((bpc * 3) / 8);
            }
&lt;p&gt;                System.arraycopy( array, 0,bufferData, 0, &lt;br/&gt;
                        (array.length&amp;lt;bufferData.length?array.length: bufferData.length) );&lt;/p&gt;


&lt;p&gt;If Jira allows me to attach a file that causes this problem I will do so.&lt;/p&gt;</description>
                <environment>Java</environment>
        <key id="12442281">PDFBOX-574</key>
            <summary>PDFBox image extraction fails with an ArrayOutOfBoundsException in PDPixelMap.getRGBImage()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="kaplan4">Ian Kaplan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Dec 2009 23:22:04 +0000</created>
                <updated>Thu, 1 Jul 2010 07:26:40 +0000</updated>
                            <resolved>Sun, 28 Mar 2010 14:19:47 +0000</resolved>
                                    <version>0.8.0-incubator</version>
                                    <fixVersion>1.2.0</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12785057" author="kaplan4" created="Wed, 2 Dec 2009 23:33:30 +0000"  >
&lt;p&gt;The attached file resulted in an image extraction error.  The file was originally obtained from the Institute for Science and International Security (www.isis-online.org).  The path at the time of this writing was:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.isis-online.org/publications/iraq/omv_overview.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.isis-online.org/publications/iraq/omv_overview.pdf&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12850677" author="lehmi" created="Sun, 28 Mar 2010 14:19:47 +0000"  >&lt;p&gt;I&apos;ve applied Ian&apos;s patch with version 928402.&lt;/p&gt;

&lt;p&gt;Thanks for the contribution&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12426713" name="omv_overview.pdf" size="871973" author="kaplan4" created="Wed, 2 Dec 2009 23:33:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163340</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zj8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>205419</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>