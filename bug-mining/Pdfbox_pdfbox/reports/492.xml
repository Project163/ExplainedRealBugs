<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:55:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2042] ColorSpace with empty Range array</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2042</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I have PDF document where I am modifying PDPage content stream.&lt;br/&gt;
Saved document is invalid (Adobe reader complains about it).&lt;/p&gt;

&lt;p&gt;I have narrowed it down to ColorSpace. &lt;/p&gt;

&lt;p&gt;Original document has colorspace:&lt;br/&gt;
/ColorSpace &amp;lt;&amp;lt;&lt;br/&gt;
/Cs6 [/ICCBased &amp;lt;&amp;lt;&lt;br/&gt;
/Alternate /DeviceRGB&lt;br/&gt;
/Filter /FlateDecode&lt;br/&gt;
/Length 2597&lt;br/&gt;
/N 3&lt;br/&gt;
&amp;gt;&amp;gt;]&amp;gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;Modified document has colorspace:&lt;br/&gt;
/ColorSpace &amp;lt;&amp;lt;&lt;br/&gt;
/Cs6 [/ICCBased &amp;lt;&amp;lt;&lt;br/&gt;
/Alternate /DeviceRGB&lt;br/&gt;
/Filter /FlateDecode&lt;br/&gt;
/Length 2597&lt;br/&gt;
/N 3&lt;br/&gt;
/Range []&lt;br/&gt;
&amp;gt;&amp;gt;]&amp;gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;When I manually remove &quot;/Range []&quot; from PDF then Adobe reader opens it without an error.&lt;/p&gt;

&lt;p&gt;Obviously that range is added by calling PDICCBased.getRangeArray(0) somewhere.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12710029">PDFBOX-2042</key>
            <summary>ColorSpace with empty Range array</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="chupacabras">Juraj Lonc</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Apr 2014 12:50:14 +0000</created>
                <updated>Fri, 2 May 2014 06:12:03 +0000</updated>
                            <resolved>Thu, 24 Apr 2014 22:27:54 +0000</resolved>
                                    <version>1.8.4</version>
                    <version>1.8.5</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.8.5</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13978157" author="chupacabras" created="Wed, 23 Apr 2014 12:51:16 +0000"  >&lt;p&gt;Original (working) file.&lt;/p&gt;</comment>
                            <comment id="13978159" author="chupacabras" created="Wed, 23 Apr 2014 12:52:34 +0000"  >&lt;p&gt;Modified file in pdfbox 2.0.0 (error in Adobe Reader)&lt;/p&gt;</comment>
                            <comment id="13979011" author="tilman" created="Wed, 23 Apr 2014 22:23:59 +0000"  >&lt;p&gt;It would be helpful if you provide the code that modifies the content stream. I couldn&apos;t reproduce the problem by just opening the document and saving it. But your theory about PDICCBased.getRangeArray(0) makes sense, that one would return an empty range array for the 0 parameter.&lt;/p&gt;</comment>
                            <comment id="13979451" author="chupacabras" created="Thu, 24 Apr 2014 08:33:02 +0000"  >&lt;p&gt;Here is the sample code.&lt;br/&gt;
Actually I do not need to modify content of page. Problem is caused just by calling pdResources.getColorSpaces(); and then saving document.&lt;/p&gt;</comment>
                            <comment id="13979838" author="tilman" created="Thu, 24 Apr 2014 15:31:51 +0000"  >&lt;p&gt;Thanks for the test.&lt;/p&gt;

&lt;p&gt;Ouch!!! &quot;private COSArray getRangeArray(int n)&quot; does something sometimes &lt;em&gt;and&lt;/em&gt; returns something, and has two bugs. What I think was intended was to extend the range array with default values when needed. However the default values are the wrong ones (should be 0 1 according to the spec, not -100 100, this is for LAB), and the array extension isn&apos;t done because of an off-by-one mistake. I have committed a fix in rev 1589767 for the trunk and rev 1589769 for the 1.8 branch.&lt;/p&gt;

&lt;p&gt;Before:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; COSArray getRangeArray(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; n)
    {
        COSArray rangeArray = (COSArray)stream.getStream().getDictionaryObject(COSName.RANGE);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(rangeArray == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        {
            rangeArray = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; COSArray();
            stream.getStream().setItem(COSName.RANGE, rangeArray);
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(rangeArray.size() &amp;lt; n*2)
            {
                rangeArray.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; COSFloat(-100));
                rangeArray.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; COSFloat(100));
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; rangeArray;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Get the range array, create and fill it with &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; values (0, 1) &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;
     * needed so that it has enough value pairs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the position.
     *
     * @param pos The zero-based position that should exist after &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; call is
     * completed.
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; A valid range array.
     */
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; COSArray getRangeArray(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; pos)
    {
        &lt;span class=&quot;code-comment&quot;&gt;//TODO per &lt;span class=&quot;code-quote&quot;&gt;&quot;clean code&quot;&lt;/span&gt;, a method should either 
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; something or modify something, but not both.
&lt;/span&gt;        COSArray rangeArray = (COSArray)stream.getStream().getDictionaryObject(COSName.RANGE);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(rangeArray == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        {
            rangeArray = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; COSArray();
            stream.getStream().setItem(COSName.RANGE, rangeArray);
        }
        &lt;span class=&quot;code-comment&quot;&gt;// extend range array with &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; values &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; needed
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (rangeArray.size() &amp;lt; (pos + 1) * 2)
        {
            rangeArray.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; COSFloat(0));
            rangeArray.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; COSFloat(1));
        }        
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; rangeArray;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I will try to create a better fix later this week that returns default values if the array doesn&apos;t exist or is too small, and creates a correctly sized array for writing operations. This will have the advantage that PDF files don&apos;t get longer, i.e. don&apos;t have unneeded default range arrays. (This fix creates a default range array)&lt;/p&gt;

&lt;p&gt;Btw this bug also resulted in an exception in TestExtractText.&lt;/p&gt;

&lt;p&gt;The fixed libs will appear within a few hours here:&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox/1.8.5-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox/1.8.5-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13979853" author="lehmi" created="Thu, 24 Apr 2014 15:42:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; There is another more important bug to be fixed. A read operation must not alter the pdf, saying that, please remove the setItem() call.&lt;/p&gt;</comment>
                            <comment id="13980070" author="tilman" created="Thu, 24 Apr 2014 18:33:51 +0000"  >&lt;p&gt;Done in rev 1589827 for the trunk and rev 1589828 for the 1.8 branch. I dropped the idea of creating a correct size array (getNumberOfComponents() * 2) for a write, because the (deprecated) call setNumberOfComponents() allows dynamic change of the component count.&lt;/p&gt;

&lt;p&gt;And &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chupacabras&quot; class=&quot;user-hover&quot; rel=&quot;chupacabras&quot;&gt;chupacabras&lt;/a&gt; gets a saved PDF that does not have an unneeded default range as in the previous fix.&lt;/p&gt;</comment>
                            <comment id="13980141" author="lehmi" created="Thu, 24 Apr 2014 19:34:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; Thanks for the prompt action&lt;/p&gt;</comment>
                            <comment id="13980165" author="chupacabras" created="Thu, 24 Apr 2014 19:52:30 +0000"  >&lt;p&gt;Thanks for fix &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13980403" author="tilman" created="Thu, 24 Apr 2014 22:27:54 +0000"  >&lt;p&gt;Thanks for the feedback. Btw, PDLab has the same problem, see &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2047&quot; title=&quot;read operations alter PDLab object&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2047&quot;&gt;&lt;del&gt;PDFBOX-2047&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13987381" author="lehmi" created="Fri, 2 May 2014 06:12:03 +0000"  >&lt;p&gt;Closed after releasing PDFBox 1.8.5&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12641682" name="ModifyTest.java" size="12574" author="chupacabras" created="Thu, 24 Apr 2014 08:33:02 +0000"/>
                            <attachment id="12641466" name="pdfbox18.pdf" size="156898" author="chupacabras" created="Wed, 23 Apr 2014 12:51:16 +0000"/>
                            <attachment id="12641468" name="pdfbox20.pdf" size="156884" author="chupacabras" created="Wed, 23 Apr 2014 12:52:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>388351</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1uwbj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>388606</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>