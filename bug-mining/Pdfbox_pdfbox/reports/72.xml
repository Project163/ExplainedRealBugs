<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:52:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-99] Indexed color images have wrong colors after encryption</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-99</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;imported from SourceForge&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;a href=&quot;http://sourceforge.net/tracker/index.php?group_id=78314&amp;amp;atid=552832&amp;amp;aid=1323753&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://sourceforge.net/tracker/index.php?group_id=78314&amp;amp;atid=552832&amp;amp;aid=1323753&lt;/a&gt;&lt;br/&gt;
Originally submitted by loppermann on 2005-10-11 04:27.&lt;/p&gt;

&lt;p&gt;When a PDF including an index-color image is encrypted,&lt;br/&gt;
the colors get mixed up. The pallette seems to remain&lt;br/&gt;
intact, but the colors of the pixels are wrong.&lt;/p&gt;

&lt;p&gt;Test code: (bitmaptest.pdf is attached)&lt;/p&gt;

&lt;p&gt;package pdfboxtest;&lt;br/&gt;
import org.pdfbox.pdmodel.PDDocument;&lt;br/&gt;
import org.pdfbox.pdmodel.encryption.*;&lt;br/&gt;
import java.io.*;&lt;/p&gt;

&lt;p&gt;public class Main {&lt;br/&gt;
        public static void main(String[] args) {&lt;br/&gt;
        try &lt;/p&gt;
{
            PDStandardEncryption enc = new
PDStandardEncryption();
           
enc.setVersion(PDEncryptionDictionary.VERSION2_VARIABLE_LENGTH_ALGORITHM);
           
enc.setRevision(PDStandardEncryption.REVISION3);
            enc.setLength(128);
            PDDocument doc =
PDDocument.load(&quot;bitmaptest.pdf&quot;);
            doc.setEncryptionDictionary(enc);
            doc.encrypt(&quot;owner&quot;, &quot;&quot;);
            doc.save(&quot;result.pdf&quot;);
            doc.close();
        }
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
            e.printStackTrace();
        }
&lt;p&gt;    }    &lt;br/&gt;
}&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;attachment on SourceForge&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;a href=&quot;http://sourceforge.net/tracker/download.php?group_id=78314&amp;amp;atid=552832&amp;amp;aid=1323753&amp;amp;file_id=152105&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://sourceforge.net/tracker/download.php?group_id=78314&amp;amp;atid=552832&amp;amp;aid=1323753&amp;amp;file_id=152105&lt;/a&gt;&lt;br/&gt;
bitmaptest.pdf (application/pdf), 14049 bytes&lt;br/&gt;
pdf containg an indexed color image&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;attachment on SourceForge&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;a href=&quot;http://sourceforge.net/tracker/download.php?group_id=78314&amp;amp;atid=552832&amp;amp;aid=1323753&amp;amp;file_id=152106&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://sourceforge.net/tracker/download.php?group_id=78314&amp;amp;atid=552832&amp;amp;aid=1323753&amp;amp;file_id=152106&lt;/a&gt;&lt;br/&gt;
result.pdf (application/pdf), 13927 bytes&lt;br/&gt;
result.pdf file with messed up colors&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;attachment on SourceForge&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;a href=&quot;http://sourceforge.net/tracker/download.php?group_id=78314&amp;amp;atid=552832&amp;amp;aid=1323753&amp;amp;file_id=152108&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://sourceforge.net/tracker/download.php?group_id=78314&amp;amp;atid=552832&amp;amp;aid=1323753&amp;amp;file_id=152108&lt;/a&gt;&lt;br/&gt;
Main.java (application/octet-stream), 743 bytes&lt;br/&gt;
test case source&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;comment on SourceForge&amp;#93;&lt;/span&gt;&lt;br/&gt;
Originally sent by loppermann.&lt;br/&gt;
Logged In: YES &lt;br/&gt;
user_id=1359988&lt;/p&gt;

&lt;p&gt;I haven&apos;t found anything about exceptions for strings in the&lt;br/&gt;
spec. On the otherhand, acrobar reader as well as pdfbox&lt;br/&gt;
clearly seem not to decrypt the palette string.&lt;br/&gt;
I am not an expert at cryptography, but I imagine, that this&lt;br/&gt;
could have the following reason:&lt;br/&gt;
Since palettes are often known (windows standard palette,&lt;br/&gt;
web-palette etc.) encrypting them, might give an attacker a&lt;br/&gt;
reasonable guess at what the cleartext of the encrypted&lt;br/&gt;
string should look like. Hence, if he was able to use a&lt;br/&gt;
clear-text attack against the palette string he could use&lt;br/&gt;
the extracted key for all other streams in the file.&lt;br/&gt;
Since the a palette does not include very sensitive&lt;br/&gt;
information by itself, it might be a more secure choice to&lt;br/&gt;
not encrypt it at all, in order to protect from such&lt;br/&gt;
clear-text attacks.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;comment on SourceForge&amp;#93;&lt;/span&gt;&lt;br/&gt;
Originally sent by benlitchfield.&lt;br/&gt;
Logged In: YES &lt;br/&gt;
user_id=601708&lt;/p&gt;

&lt;p&gt;strings should be encrypted, but there are some exceptions.  &lt;br/&gt;
thanks for looking further into this for me.  I will check with &lt;br/&gt;
the PDF reference to see if it says anything.  the exceptions &lt;br/&gt;
are usually security related so I would be surprised if it was &lt;br/&gt;
not suppose to encrypted, there it might be something related.&lt;/p&gt;

&lt;p&gt;Ben&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;comment on SourceForge&amp;#93;&lt;/span&gt;&lt;br/&gt;
Originally sent by loppermann.&lt;br/&gt;
Logged In: YES &lt;br/&gt;
user_id=1359988&lt;/p&gt;

&lt;p&gt;ok, if all strings are not encrypted, Docuemnt information&lt;br/&gt;
will get messed up, i.e. it will be encrypted during&lt;br/&gt;
decryption &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;comment on SourceForge&amp;#93;&lt;/span&gt;&lt;br/&gt;
Originally sent by loppermann.&lt;br/&gt;
Logged In: YES &lt;br/&gt;
user_id=1359988&lt;/p&gt;

&lt;p&gt;my observation of the palatte staying intact seems to be&lt;br/&gt;
wrong. after some more testing and debugging, I see, that&lt;br/&gt;
the palette seems to get encrypted, which I think it should&lt;br/&gt;
not be. Due to the symmetric nature of RC4, encrypting,&lt;br/&gt;
decrypting and encrypting again will yield the right&lt;br/&gt;
palette. So even PDFBox does not try to decypt the palette&lt;br/&gt;
string it has encrypted when opening and decrypting the PDF.&lt;br/&gt;
When I disable the encryption of Strings in the PDFWriter,&lt;br/&gt;
everything seems to work fine. I haven&apos;t found this in the&lt;br/&gt;
spec yet, with which I&apos;m not so familiar. I will keep&lt;br/&gt;
looking though.&lt;/p&gt;

&lt;p&gt;So if in fact strings should not be encrypted (and the fact&lt;br/&gt;
that they are not decrypted seems to imply this), the fix is&lt;br/&gt;
simply to take out the encryption of strings in PDFWriter.&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;comment on SourceForge&amp;#93;&lt;/span&gt;&lt;br/&gt;
Originally sent by loppermann.&lt;br/&gt;
Logged In: YES &lt;br/&gt;
user_id=1359988&lt;/p&gt;

&lt;p&gt;attached test case&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;comment on SourceForge&amp;#93;&lt;/span&gt;&lt;br/&gt;
Originally sent by loppermann.&lt;br/&gt;
Logged In: YES &lt;br/&gt;
user_id=1359988&lt;/p&gt;

&lt;p&gt;attached result.pdf file with messed up colors&lt;/p&gt;</description>
                <environment></environment>
        <key id="12391133">PDFBOX-99</key>
            <summary>Indexed color images have wrong colors after encryption</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="adamnichols">Adam Nichols</assignee>
                                    <reporter username="-1">None</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Oct 2005 11:27:00 +0000</created>
                <updated>Tue, 26 Oct 2010 09:33:38 +0000</updated>
                            <resolved>Tue, 12 Oct 2010 00:26:50 +0000</resolved>
                                                    <fixVersion>1.3.1</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12919989" author="adamnichols" created="Mon, 11 Oct 2010 21:06:29 +0000"  >&lt;p&gt;Downloaded files from sourceforge and uploaded them here to ensure they will not be lost.  I&apos;ll be working on this issue and this is a great example document to work with.&lt;/p&gt;</comment>
                            <comment id="12920027" author="adamnichols" created="Mon, 11 Oct 2010 23:37:14 +0000"  >&lt;p&gt;I found that the streamdata of the Image is encrypted correctly.  The problem is that the colorspace array is not encrypted, but it is decrypted when trying to decrypt/read (both by PDFBox and by Adobe Reader).  To duplicate this problem/solution, encrypt the PDF attached.  Open the encrypted PDF and decrypt it and save that as a file.  You&apos;ll see that the indexing matches in the original and encrypted, but it&apos;ll be different in the decrypted file.  Swap the array for the index in the encrypted and decrypted files and you&apos;ll see that everything works fine.&lt;/p&gt;

&lt;p&gt;I&apos;m still working on a patch to make sure the dictionary data is written out in its encrypted state.&lt;/p&gt;</comment>
                            <comment id="12920037" author="adamnichols" created="Tue, 12 Oct 2010 00:26:29 +0000"  >&lt;p&gt;Committed patch in revision 1021552&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12456915" name="PDFBOX-99.patch" size="2106" author="adamnichols" created="Tue, 12 Oct 2010 00:26:29 +0000"/>
                            <attachment id="12456890" name="bitmaptest.pdf" size="14049" author="adamnichols" created="Mon, 11 Oct 2010 21:06:29 +0000"/>
                            <attachment id="12456889" name="result.pdf" size="13927" author="adamnichols" created="Mon, 11 Oct 2010 21:06:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163050</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zk1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>205551</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>