<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:56:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2158] ExtractText missing most of text in this PDF file, due to font bounding box with minus infinity</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2158</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Attached PDF file is missing most of the text when processed by the ExtractText example program&lt;/p&gt;

&lt;p&gt;I traced it down to PDFontDescriptorDictionary.getFontBoundingBox() getting a rectange for COSName.FONT_BBOX  that contained a ymin value of minus infinity. That method then creates a PDRectangle which calculates a bounding box with a ymin value of -65,329, and results in an enormous text size, and things go downhill from there.  The text cannot be matched up, and most of it ends up being discarded.&lt;/p&gt;

&lt;p&gt;I was able to hack a fix by doing a check in the constructor PDRectangle.PDRectangle( COSArray array ) for big negative numbers and setting them to 0.  With that change, all the text came through as expected. However, I don&apos;t have enough familiarity with the code to understand what a real fix ought to look like.&lt;/p&gt;

&lt;p&gt;The PDF file looks to be fine by other programs such as Acrobat and NitroPDF&lt;/p&gt;</description>
                <environment>Windows x64</environment>
        <key id="12723039">PDFBOX-2158</key>
            <summary>ExtractText missing most of text in this PDF file, due to font bounding box with minus infinity</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="jhirsh">Joel Hirsh</reporter>
                        <labels>
                    </labels>
                <created>Sun, 22 Jun 2014 20:39:58 +0000</created>
                <updated>Thu, 17 Mar 2016 19:07:31 +0000</updated>
                            <resolved>Tue, 24 Nov 2015 20:22:10 +0000</resolved>
                                    <version>1.8.5</version>
                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Parsing</component>
                    <component>Text extraction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14040240" author="jhirsh" created="Sun, 22 Jun 2014 20:41:19 +0000"  >&lt;p&gt;File that exhibits this problem&lt;/p&gt;</comment>
                            <comment id="14043019" author="tilman" created="Wed, 25 Jun 2014 04:08:51 +0000"  >&lt;p&gt;It isn&apos;t the only problem in that PDF. I get an NPE when trying to render it, which is due to this decode array:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;&amp;lt;/BitsPerComponent 1/Decode[1.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;]/Filter/FlateDecode/Height 140/ImageMask &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;That decode array should have only 2 elements (because of BitsPerComponent 1) or because it is a mask.&lt;/p&gt;</comment>
                            <comment id="14043911" author="tilman" created="Wed, 25 Jun 2014 18:52:14 +0000"  >&lt;p&gt;Sorry I can&apos;t do anything about the font problem, I don&apos;t know enough about text extraction. Maybe somebody else will. The second value in the FontBBox array is really -65329.&lt;/p&gt;

&lt;p&gt;About the rendering:&lt;/p&gt;

&lt;p&gt;I have modified SampledImageReader.getDecodeArray() to avoid the NPE and to use the correct part of the decode array if it is a stencil.&lt;/p&gt;

&lt;p&gt;There&apos;s another exception in Type1CharString related to a lineTo command without preceding moveTo command. I have inserted a fix for this case and for a similar one, i.e. just do a moveTo instead and log a warning.&lt;/p&gt;

&lt;p&gt;This was done in rev 1605545 for the trunk. Branch 1.8 doesn&apos;t have the exceptions.&lt;/p&gt;

&lt;p&gt;Your file is seriously broken. There are at least 3 errors in it. If the file was created by your own employer or by a business partner, please direct them to this issue. It was created by &quot;clib pdf library&quot; and &quot;modified by itext&quot;. I&apos;d doubt that itext is to blame, Bruno Lowagie has been in the PDF business for a long long time. I assume that itext was used only to modify an existing PDF, maybe insert the barcode or the company logo.&lt;/p&gt;</comment>
                            <comment id="14044539" author="lehmi" created="Thu, 26 Jun 2014 10:11:14 +0000"  >&lt;p&gt;The font bounding box is used to calculate the height of a glyph as there isn&apos;t any font metric information read from an AFM-file. Either we add some mapping to get an appropriate AFM-file base on the &quot;BaseFont&quot; or we try to extract the font metrics from the embedded font.&lt;/p&gt;</comment>
                            <comment id="14045582" author="jahewson" created="Fri, 27 Jun 2014 06:05:52 +0000"  >&lt;p&gt;Tilman, shouldn&apos;t r1605545 have been a one-line fix?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (pdImage.isStencil() &amp;amp;&amp;amp; (decode.length != 2 ||
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Could be changed to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (pdImage.isStencil() &amp;amp;&amp;amp; (decode.length &amp;lt; 2 ||
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14045590" author="tilman" created="Fri, 27 Jun 2014 06:13:47 +0000"  >&lt;p&gt;The problem of that file wasn&apos;t just that the decode had the wrong size, there were null objects in it. These null objects did a NPE in toFloat(), the part that you quote wasn&apos;t even reached &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; . My solution is to hope that there are two entries at least, and that the first two entries are numbers and to get them.&lt;/p&gt;</comment>
                            <comment id="14045591" author="tilman" created="Fri, 27 Jun 2014 06:15:05 +0000"  >&lt;p&gt;This is the current log output for that file:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;27.06.2014 08:15:07.476 WARN  [main] org.apache.pdfbox.pdmodel.graphics.image.SampledImageReader:436 - decode array COSArray{[COSFloat{1.0}, COSFloat{0.0}, COSFloat{0.0}, COSFloat{0.0}, COSFloat{0.0}, COSFloat{0.0}, COSFloat{0.0}, COSFloat{0.0}, COSNull{}, COSNull{}, COSNull{}, COSNull{}, COSNull{}, COSNull{}, COSNull{}, COSNull{}]} not compatible with color space, using the first two entries
27.06.2014 08:15:07.477 WARN  [main] org.apache.pdfbox.pdmodel.graphics.image.SampledImageReader:436 - decode array COSArray{[COSFloat{1.0}, COSFloat{0.0}, COSFloat{0.0}, COSFloat{0.0}, COSFloat{0.0}, COSFloat{0.0}, COSFloat{0.0}, COSFloat{0.0}, COSNull{}, COSNull{}, COSNull{}, COSNull{}, COSNull{}, COSNull{}, COSNull{}, COSNull{}]} not compatible with color space, using the first two entries
27.06.2014 08:15:08.909 WARN  [main] org.apache.fontbox.cff.Type1CharString:338 - rlineTo without initial moveTo in font ArialMT, glyph AE
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14045608" author="jahewson" created="Fri, 27 Jun 2014 06:28:26 +0000"  >&lt;blockquote&gt;
&lt;p&gt;The problem of that file wasn&apos;t just that the decode had the wrong size, there were null objects in it. These null objects did a NPE in toFloat(), the part that you quote wasn&apos;t even reached  . My solution is to hope that there are two entries at least, and that the first two entries are numbers and to get them.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ah ok, I had wondered if I&apos;d missed something.&lt;/p&gt;</comment>
                            <comment id="14045610" author="jahewson" created="Fri, 27 Jun 2014 06:34:06 +0000"  >&lt;p&gt;Looking at the font problem, as noted the FontBBox contains -65329 but I see that the Descent is also far too large: 65324. It seems to me that these two numbers are two&apos;s complements of what were originally signed numbers, if so the original values would have been plausible:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Descent = -(65324 - 65536) = 212
FontBBox = -(-64329 + 65536) = -1207
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We could detect this by looking for values with Math.abs(value) &amp;gt; 32767 and apply the equations above, alternatively we could just use the values from the font whenever they are available and only fall back to the FontDescriptor if the font file is missing.&lt;/p&gt;</comment>
                            <comment id="14083972" author="tilman" created="Sun, 3 Aug 2014 13:27:34 +0000"  >&lt;p&gt;The attached file &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2158&quot; title=&quot;ExtractText missing most of text in this PDF file, due to font bounding box with minus infinity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2158&quot;&gt;&lt;del&gt;PDFBOX-2158&lt;/del&gt;&lt;/a&gt;-077702.pdf has &quot;/Decode [ 1 0 ]&quot; instead of &quot;/Decode [ 1.0 0.0 ]&quot; which resulted in a classcast exception, my next commit will fix that too.&lt;/p&gt;</comment>
                            <comment id="14083975" author="jira-bot" created="Sun, 3 Aug 2014 13:41:45 +0000"  >&lt;p&gt;Commit 1615404 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1615404&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1615404&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2158&quot; title=&quot;ExtractText missing most of text in this PDF file, due to font bounding box with minus infinity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2158&quot;&gt;&lt;del&gt;PDFBOX-2158&lt;/del&gt;&lt;/a&gt;: avoid classcastexception if decode array has COSInt members instead of COSFloat&lt;/p&gt;</comment>
                            <comment id="15025270" author="jira-bot" created="Tue, 24 Nov 2015 20:17:30 +0000"  >&lt;p&gt;Commit 1716241 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1716241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1716241&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2158&quot; title=&quot;ExtractText missing most of text in this PDF file, due to font bounding box with minus infinity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2158&quot;&gt;&lt;del&gt;PDFBOX-2158&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3130&quot; title=&quot;Recent regression in PDFTextStripper, text getting garbled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3130&quot;&gt;&lt;del&gt;PDFBOX-3130&lt;/del&gt;&lt;/a&gt;: fix out-of-bounds value in font BBox for text extraction&lt;/p&gt;</comment>
                            <comment id="15025278" author="jira-bot" created="Tue, 24 Nov 2015 20:20:39 +0000"  >&lt;p&gt;Commit 1716242 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1716242&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1716242&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2158&quot; title=&quot;ExtractText missing most of text in this PDF file, due to font bounding box with minus infinity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2158&quot;&gt;&lt;del&gt;PDFBOX-2158&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3130&quot; title=&quot;Recent regression in PDFTextStripper, text getting garbled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3130&quot;&gt;&lt;del&gt;PDFBOX-3130&lt;/del&gt;&lt;/a&gt;: oops&lt;/p&gt;</comment>
                            <comment id="15025281" author="tilman" created="Tue, 24 Nov 2015 20:22:10 +0000"  >&lt;p&gt;Fixed for 2.0 only, 1.8 is more complex there.&lt;/p&gt;</comment>
                            <comment id="15026273" author="jira-bot" created="Wed, 25 Nov 2015 06:11:37 +0000"  >&lt;p&gt;Commit 1716308 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1716308&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1716308&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2158&quot; title=&quot;ExtractText missing most of text in this PDF file, due to font bounding box with minus infinity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2158&quot;&gt;&lt;del&gt;PDFBOX-2158&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3130&quot; title=&quot;Recent regression in PDFTextStripper, text getting garbled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3130&quot;&gt;&lt;del&gt;PDFBOX-3130&lt;/del&gt;&lt;/a&gt;: oops2&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12915907">PDFBOX-3130</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12659546" name="PDFBOX-2158-077702.pdf" size="1728674" author="tilman" created="Sun, 3 Aug 2014 13:27:34 +0000"/>
                            <attachment id="12651888" name="negative.text.box.pdf" size="113128" author="jhirsh" created="Sun, 22 Jun 2014 20:41:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401226</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 51 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1x2an:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>401305</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>