<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:07:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4252] PDChoice related bugs and issues</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4252</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;There are several issues related to either PDListBox or PDComboBox that are still not fixed in 2.0.10, I am going to put them in this one case, let me know if they need to be broken into separate tickets. Thanks.&lt;/p&gt;

&lt;p&gt;1. When I attempt to set value to a PDListBox whose &apos;Top Index&apos; is greater than 0 (as in&#160;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12929135/12929135_top+index+3.pdf&quot; title=&quot;top index 3.pdf attached to PDFBOX-4252&quot;&gt;top index 3.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;), I always receive the following exception:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalStateException: Error: You must call beginText() before calling endText.
	at org.apache.pdfbox.pdmodel.PDPageContentStream.endText(PDPageContentStream.java:381) ~[pdfbox-2.0.10.jar:2.0.10]
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I tracked it down to a for loop at the end of the private method insertGeneratedListboxAppearance in the class AppearanceGeneratorHelper:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = topIndex; i &amp;lt; numOptions; i++)
        {
           
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i == topIndex)
            {
                yTextPos = yTextPos - font.getFontDescriptor().getAscent() / FONTSCALE * fontSize;
            }
            &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
            {
                yTextPos = yTextPos - font.getBoundingBox().getHeight() / FONTSCALE * fontSize;
                contents.beginText();
            }

            contents.newLineAtOffset(contentRect.getLowerLeftX(), yTextPos);
            contents.showText(options.get(i));

            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i - topIndex != (numOptions - 1))
            {
                contents.endText();
            }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The last &apos;if&apos; clause, when topIndex == 0, this makes sense, which is to NOT call endText if we are at the last option because the private method insertGeneratedAppearance which calls insertGeneratedListboxAppearance would later call endText once again. If topIndex &amp;gt; 0, the condition in this &apos;if&apos; clause would always be true (since i can never be greater than numOptions - 1), as a result, endText is called every time in this &apos;for&apos; loop, so after the method returns and the next endText is called, we receive the exception. If I change that to&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i != (numOptions - 1))
            {
                contents.endText();
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;things would start to work again.&lt;/p&gt;

&lt;p&gt;2. a related issue, suppose I have a list box with top index equals to&#160;0 and too many options for&#160;the list box to show all of them at once (as in &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12929134/12929134_top+index+0.pdf&quot; title=&quot;top index 0.pdf attached to PDFBOX-4252&quot;&gt;top index 0.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;). When I select an option that is not visible with a top index of 0 (in order to see it, we need to scroll the list box down), unlike Acrobat which would adjust the top index so the selected option would be visible, PDFBox does not recalculate the top index and would stick with the initial value of 0. I suppose, If we fix item #1 above (i.e. top index greater than 0), the opposite would also be true (if top index is say 6 and you select the first item which is not visible unless you scroll the list box up). This would make it useless if I flatten the document since there is no way I can see the selected option (see  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12929133/12929133_top+index+0+flattened.pdf&quot; title=&quot;top index 0 flattened.pdf attached to PDFBOX-4252&quot;&gt;top index 0 flattened.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;). It is also next to impossible to see the selected option even if I do not flatten it (see  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12929132/12929132_top+index+0+with+index+4+set+as+selected.pdf&quot; title=&quot;top index 0 with index 4 set as selected.pdf attached to PDFBOX-4252&quot;&gt;top index 0 with index 4 set as selected.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;). I would expect PDFBox to recalculate the top index so that at least the first selected option is visible (if there are additional selected options, show more options when possible)&lt;/p&gt;

&lt;p&gt;3. When flattening, drop down list or PDComboBox with options that have export values only shows the export values instead of the label. This not a problem for the list box. (e.g. form:  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12929131/12929131_test+listbox+and+droplist+export+values.pdf&quot; title=&quot;test listbox and droplist export values.pdf attached to PDFBOX-4252&quot;&gt;test listbox and droplist export values.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;, after flattening:  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12929130/12929130_test+listbox_and_droplist+export+values+flattened.pdf&quot; title=&quot;test listbox_and_droplist export values flattened.pdf attached to PDFBOX-4252&quot;&gt;test listbox_and_droplist export values flattened.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;). I would expect the drop down list to behave the same as list box (i.e. when flattened, it should also show the label instead of the export value.)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13168241">PDFBOX-4252</key>
            <summary>PDChoice related bugs and issues</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="xin.lin">Xin Lin</reporter>
                        <labels>
                            <label>Appearance</label>
                    </labels>
                <created>Tue, 26 Jun 2018 03:48:01 +0000</created>
                <updated>Mon, 24 Sep 2018 18:32:46 +0000</updated>
                                            <version>2.0.10</version>
                                                    <component>AcroForm</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="16625159" author="jira-bot" created="Sun, 23 Sep 2018 16:08:10 +0000"  >&lt;p&gt;Commit 1841764 from lehmi@apache.org in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1841764&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1841764&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4252&quot; title=&quot;PDChoice related bugs and issues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4252&quot;&gt;PDFBOX-4252&lt;/a&gt;: fix if clause as proposed by Xin Lin&lt;/p&gt;</comment>
                            <comment id="16625160" author="jira-bot" created="Sun, 23 Sep 2018 16:08:53 +0000"  >&lt;p&gt;Commit 1841765 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1841765&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1841765&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4252&quot; title=&quot;PDChoice related bugs and issues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4252&quot;&gt;PDFBOX-4252&lt;/a&gt;: fix if clause as proposed by Xin Lin&lt;/p&gt;</comment>
                            <comment id="16625161" author="lehmi" created="Sun, 23 Sep 2018 16:09:47 +0000"  >&lt;p&gt;I&apos;ve fixed the first issue as it was an easy one &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16625376" author="jira-bot" created="Mon, 24 Sep 2018 04:52:05 +0000"  >&lt;p&gt;Commit 1841794 from tilman@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1841794&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1841794&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4252&quot; title=&quot;PDChoice related bugs and issues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4252&quot;&gt;PDFBOX-4252&lt;/a&gt;: add test, adjust comments and test type&lt;/p&gt;</comment>
                            <comment id="16625377" author="jira-bot" created="Mon, 24 Sep 2018 04:52:10 +0000"  >&lt;p&gt;Commit 1841795 from tilman@apache.org in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1841795&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1841795&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4252&quot; title=&quot;PDChoice related bugs and issues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4252&quot;&gt;PDFBOX-4252&lt;/a&gt;: add test, adjust comments and test type&lt;/p&gt;</comment>
                            <comment id="16626193" author="jira-bot" created="Mon, 24 Sep 2018 18:04:09 +0000"  >&lt;p&gt;Commit 1841882 from tilman@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1841882&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1841882&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4252&quot; title=&quot;PDChoice related bugs and issues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4252&quot;&gt;PDFBOX-4252&lt;/a&gt;: clarify name&lt;/p&gt;</comment>
                            <comment id="16626194" author="jira-bot" created="Mon, 24 Sep 2018 18:04:13 +0000"  >&lt;p&gt;Commit 1841883 from tilman@apache.org in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1841883&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1841883&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4252&quot; title=&quot;PDChoice related bugs and issues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4252&quot;&gt;PDFBOX-4252&lt;/a&gt;: clarify name&lt;/p&gt;</comment>
                            <comment id="16626201" author="tilman" created="Mon, 24 Sep 2018 18:14:24 +0000"  >&lt;p&gt;Re (2), I wonder if it is needed to add logic into that: the user could easily decide to make the first selected the top value by calling &lt;tt&gt;setTopIndex()&lt;/tt&gt;. If we do something ourselves, what should we do? Set the first selected visible? Or a strategy to change something only if no selected item is visible? Include it by default or as an extra method? Or just mention it in the javadoc?&lt;/p&gt;</comment>
                            <comment id="16626220" author="msahyoun" created="Mon, 24 Sep 2018 18:28:20 +0000"  >&lt;p&gt;AFAIK Acrobat advances the position so the first selected item is visible in case it wouldn&apos;t have been without the advancement (would need to verify this). So we should do the same.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; Wouldn&apos;t it make sense to have individual appearance handlers for form elements. This way the code becomes more readable. Currently everything is interwoven and not very clean. We could introduce it step by step for individual widget types.&lt;/p&gt;</comment>
                            <comment id="16626227" author="tilman" created="Mon, 24 Sep 2018 18:32:46 +0000"  >&lt;p&gt;Yes, this would definitively be nice.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12929131" name="test listbox and droplist export values.pdf" size="16795" author="xin.lin" created="Tue, 26 Jun 2018 03:44:04 +0000"/>
                            <attachment id="12929130" name="test listbox_and_droplist export values flattened.pdf" size="13400" author="xin.lin" created="Tue, 26 Jun 2018 03:46:21 +0000"/>
                            <attachment id="12929133" name="top index 0 flattened.pdf" size="12881" author="xin.lin" created="Tue, 26 Jun 2018 03:22:20 +0000"/>
                            <attachment id="12929132" name="top index 0 with index 4 set as selected.pdf" size="12924" author="xin.lin" created="Tue, 26 Jun 2018 03:27:16 +0000"/>
                            <attachment id="12929134" name="top index 0.pdf" size="11069" author="xin.lin" created="Tue, 26 Jun 2018 03:12:23 +0000"/>
                            <attachment id="12929135" name="top index 3.pdf" size="11064" author="xin.lin" created="Tue, 26 Jun 2018 02:46:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3v89j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>