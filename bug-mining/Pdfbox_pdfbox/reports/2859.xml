<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:14:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5738] Wrong colors in PDF since PDFBOX-5488</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5738</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Since the workaround for &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5488&quot; title=&quot;JPEG image rendered with wrong colors when using TwelveMonkeys&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5488&quot;&gt;&lt;del&gt;PDFBOX-5488&lt;/del&gt;&lt;/a&gt;, the attached PDF has wrong colors.&lt;/p&gt;

&lt;p&gt;The base issue from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5488&quot; title=&quot;JPEG image rendered with wrong colors when using TwelveMonkeys&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5488&quot;&gt;&lt;del&gt;PDFBOX-5488&lt;/del&gt;&lt;/a&gt; might be a difference between the reported color space from the metadata-tree for the user and the raw pixel data when readRaster is used, at least if I understand this correctly:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/haraldk/TwelveMonkeys/issues/571&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/haraldk/TwelveMonkeys/issues/571&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For the default JPEG Image Reader this is not a problem, as reader.getImageMetadata throws an Exception &quot;javax.imageio.IIOException: JFIF APP0 must be first marker after SOI&quot; and &quot;getAdobeTransformByBruteForce&quot; is used instead of &quot;getAdobeTransform&quot;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13561738">PDFBOX-5738</key>
            <summary>Wrong colors in PDF since PDFBOX-5488</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="Schmidor">Oliver Schmidtmer</reporter>
                        <labels>
                            <label>DCTFilter</label>
                    </labels>
                <created>Wed, 13 Dec 2023 22:38:47 +0000</created>
                <updated>Thu, 14 Mar 2024 20:57:40 +0000</updated>
                            <resolved>Tue, 19 Dec 2023 10:02:30 +0000</resolved>
                                    <version>2.0.30</version>
                    <version>3.0.1 PDFBox</version>
                                    <fixVersion>2.0.31</fixVersion>
                    <fixVersion>3.0.2 PDFBox</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17796547" author="tilman" created="Thu, 14 Dec 2023 04:49:55 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;javax_imageio_1.0&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Chroma&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ColorSpaceType name=&lt;span class=&quot;code-quote&quot;&gt;&quot;YCbCr&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;NumChannels value=&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Chroma&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Compression&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;CompressionTypeName value=&lt;span class=&quot;code-quote&quot;&gt;&quot;JPEG&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Lossless value=&lt;span class=&quot;code-quote&quot;&gt;&quot;FALSE&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;NumProgressiveScans value=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Compression&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Dimension&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;ImageOrientation value=&lt;span class=&quot;code-quote&quot;&gt;&quot;Normal&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Dimension&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Transparency&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;Alpha value=&lt;span class=&quot;code-quote&quot;&gt;&quot;nonpremultipled&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/Transparency&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/javax_imageio_1.0&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;?xml version=&lt;span class=&quot;code-quote&quot;&gt;&quot;1.0&quot;&lt;/span&gt; encoding=&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;?&amp;gt;&lt;/span&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;javax_imageio_jpeg_image_1.0&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;JPEGvariety/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;markerSequence&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dqt&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dqtable elementPrecision=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; qtableId=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dqt&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;sof process=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; samplePrecision=&lt;span class=&quot;code-quote&quot;&gt;&quot;8&quot;&lt;/span&gt; numLines=&lt;span class=&quot;code-quote&quot;&gt;&quot;3508&quot;&lt;/span&gt; samplesPerLine=&lt;span class=&quot;code-quote&quot;&gt;&quot;2480&quot;&lt;/span&gt; numFrameComponents=&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;componentSpec componentId=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; HsamplingFactor=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; VsamplingFactor=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; QtableSelector=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;componentSpec componentId=&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt; HsamplingFactor=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; VsamplingFactor=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; QtableSelector=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;componentSpec componentId=&lt;span class=&quot;code-quote&quot;&gt;&quot;3&quot;&lt;/span&gt; HsamplingFactor=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; VsamplingFactor=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; QtableSelector=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;componentSpec componentId=&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt; HsamplingFactor=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; VsamplingFactor=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; QtableSelector=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/sof&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dht&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dhtable class=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; htableId=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dht&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dht&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dhtable class=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; htableId=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dht&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;sos numScanComponents=&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt; startSpectralSelection=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; endSpectralSelection=&lt;span class=&quot;code-quote&quot;&gt;&quot;63&quot;&lt;/span&gt; approxHigh=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; approxLow=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;scanComponentSpec componentSelector=&lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt; dcHuffTable=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; acHuffTable=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;scanComponentSpec componentSelector=&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt; dcHuffTable=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; acHuffTable=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;scanComponentSpec componentSelector=&lt;span class=&quot;code-quote&quot;&gt;&quot;3&quot;&lt;/span&gt; dcHuffTable=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; acHuffTable=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;scanComponentSpec componentSelector=&lt;span class=&quot;code-quote&quot;&gt;&quot;4&quot;&lt;/span&gt; dcHuffTable=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt; acHuffTable=&lt;span class=&quot;code-quote&quot;&gt;&quot;0&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/sos&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/markerSequence&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/javax_imageio_jpeg_image_1.0&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17796642" author="tilman" created="Thu, 14 Dec 2023 09:44:59 +0000"  >&lt;p&gt;I don&apos;t know what can be done here. We get YCbCr so we treat it that way. The &quot;brute force&quot; search returns 0 because there is no &quot;Adobe&quot; in the file. Should I report a bug for twelvemonkeys?&lt;/p&gt;</comment>
                            <comment id="17796712" author="schmidor" created="Thu, 14 Dec 2023 12:19:00 +0000"  >&lt;p&gt;Harald should be able to provide valuable input.&lt;/p&gt;

&lt;p&gt;I&apos;ve extracted the JPG from page one for both files.&lt;br/&gt;
I&apos;m not sure if the color space should be provided from the PDF, but at least the image from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5488&quot; title=&quot;JPEG image rendered with wrong colors when using TwelveMonkeys&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5488&quot;&gt;&lt;del&gt;PDFBOX-5488&lt;/del&gt;&lt;/a&gt; / gre_research_validiity_data_page1.jpg has wrong colors with TwelveMonkeys. The other looks good. &lt;br/&gt;
On the windows default viewer, the first looks good and the second wrong.&lt;/p&gt;</comment>
                            <comment id="17796782" author="tilman" created="Thu, 14 Dec 2023 14:48:45 +0000"  >&lt;p&gt;Can you open a ticket there? IIRC you&apos;re a regular there and made some important contributions. I&apos;m just trying to &quot;delegate&quot; something because I don&apos;t see this as a PDFBox bug.&lt;/p&gt;</comment>
                            <comment id="17796798" author="schmidor" created="Thu, 14 Dec 2023 15:35:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/haraldk/TwelveMonkeys/issues/878&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/haraldk/TwelveMonkeys/issues/878&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17797216" author="haraldk76" created="Fri, 15 Dec 2023 14:55:35 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Quick summary from TwelveMonkeys/issues/878 (where the sample file is the &quot;gre_research...&quot; one):&lt;/p&gt;

&lt;p&gt;This sample file has an APP14/Adobe marker specifying YCCK, however the &quot;Adobe&quot; string is followed by a &lt;tt&gt;0x01&lt;/tt&gt; &quot;Start of Header&quot; character instead of the normal NULL-termination &lt;tt&gt;0x00&lt;/tt&gt;... So we don&apos;t really see it as an Adobe marker but an &quot;Adobe\0x01&quot; custom marker that we ignore...&lt;/p&gt;

&lt;p&gt;We could probably change the identifier parsing to stop at the first ASCII control character (&amp;lt;= 0x20) instead of the NULL only. But I&apos;m not sure the sample file is strictly correct...&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;For the other file (&quot;Rechnung...jpg&quot;, only attached here) there&apos;s really only the component ids to work from (no other markers to say anything about the color space)... Unless there&apos;s something in the container PDF stream that says anything, we just have to guess. TwelveMonkeys recognize this (component ids 1, 2, 3, 4) in standalone JPEG files as YCbCrA/RGBA for backwards compatibility, other applications might think it is CMYK. Neither of these seems to match what is rendered in the PDF on MacOS. &#160;&lt;/p&gt;</comment>
                            <comment id="17798172" author="schmidor" created="Mon, 18 Dec 2023 12:16:03 +0000"  >&lt;p&gt;After the change from Harald, I&apos;ve tried with a current Snapshot of TwelveMonkeys:&lt;br/&gt;
With 3.11.0-SNAPSHOT from &lt;a href=&quot;https://oss.sonatype.org/content/repositories/snapshots/com/twelvemonkeys/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://oss.sonatype.org/content/repositories/snapshots/com/twelvemonkeys/&lt;/a&gt; and the workaround from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5488&quot; title=&quot;JPEG image rendered with wrong colors when using TwelveMonkeys&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5488&quot;&gt;&lt;del&gt;PDFBOX-5488&lt;/del&gt;&lt;/a&gt; removed, both files look good. The Adobe Marker is now found and used.&lt;/p&gt;</comment>
                            <comment id="17798217" author="tilman" created="Mon, 18 Dec 2023 14:04:21 +0000"  >&lt;p&gt;With the workaround removed, I get a slightly different rendering of the file from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5488&quot; title=&quot;JPEG image rendered with wrong colors when using TwelveMonkeys&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5488&quot;&gt;&lt;del&gt;PDFBOX-5488&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
 old:&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13065399/13065399_PDFBOX-5488-p1.pdf-1-old.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;  &lt;/p&gt;

&lt;p&gt;new:&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13065400/13065400_PDFBOX-5488-p1.pdf-new.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="17798218" author="tilman" created="Mon, 18 Dec 2023 14:07:27 +0000"  >&lt;p&gt;I tried without the workaround and with an older version of twelvemonkeys (3.9.0) and the image was green, thus I guess we can live with the slight difference.&lt;/p&gt;</comment>
                            <comment id="17798287" author="haraldk76" created="Mon, 18 Dec 2023 17:07:00 +0000"  >&lt;p&gt;Hmmm...&lt;/p&gt;

&lt;p&gt;The code in &lt;tt&gt;org.apache.pdfbox.filter.DCTFilter&lt;/tt&gt; that handles 4 channel &quot;YCbCr&quot; and converts it to CMYK seems very fishy to me... There really isn&apos;t such a thing as &quot;4 channel YCbCr&quot; (unless, perhaps YCbCrA), and looking at the code in &lt;tt&gt;fromYCbCrtoCMYK&lt;/tt&gt; it seems to apply exactly the same algorithm as YCCK to CMYK, just with the ITU Rec.601 YCC-&amp;gt;RGB conversion instead of the correct JPEG-defined YCC-&amp;gt;RGB conversion...&#160;&lt;/p&gt;

&lt;p&gt;I think TM 3.9/3.10 would return &quot;YCbCr&quot; as color space in the standard metadata due to the bug in identifying the App14/Adobe marker, and I believe this is the reason why you get the slightly different colors.&#160;&lt;/p&gt;

&lt;p&gt;So I think a more appropriate action to take would be to just use the &lt;tt&gt;fromYCCKtoCMYK&lt;/tt&gt; in both cases (ie. ignore the obviously incorrect transform value, and just fall back to the most likely case; YCCK), or throw an exception in the case of YCbCr.&#160;&lt;/p&gt;

&lt;p&gt;PS: Feel free to &quot;borrow&quot; &lt;tt&gt;com.twelvemonkeys.imageio.color.YCbCrConverter&lt;/tt&gt;&#160;for faster LUT-based conversion. I got the Java version from Werner Randelshofer, but it&apos;s really based on the C code from libJPEG I think.&#160;&lt;/p&gt;</comment>
                            <comment id="17798421" author="tilman" created="Tue, 19 Dec 2023 04:29:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=haraldk76&quot; class=&quot;user-hover&quot; rel=&quot;haraldk76&quot;&gt;haraldk76&lt;/a&gt; thanks, after googling &quot;YCbCr&quot; it all makes sense. I ran a test on 1000 files and none has &quot;4 channel YCbCr&quot;. This means that the &quot;old&quot; rendering was the wrong one.&lt;/p&gt;</comment>
                            <comment id="17798520" author="jira-bot" created="Tue, 19 Dec 2023 10:00:45 +0000"  >&lt;p&gt;Commit 1914768 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1914768&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1914768&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5738&quot; title=&quot;Wrong colors in PDF since PDFBOX-5488&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5738&quot;&gt;&lt;del&gt;PDFBOX-5738&lt;/del&gt;&lt;/a&gt;: revert workaround from 5488 and ignore 4 channel YCbCr and remove related code, as suggested by Harald Kuhr; see also twelvemonkeys github issue #878&lt;/p&gt;</comment>
                            <comment id="17798521" author="jira-bot" created="Tue, 19 Dec 2023 10:00:50 +0000"  >&lt;p&gt;Commit 1914769 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1914769&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1914769&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5738&quot; title=&quot;Wrong colors in PDF since PDFBOX-5488&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5738&quot;&gt;&lt;del&gt;PDFBOX-5738&lt;/del&gt;&lt;/a&gt;: revert workaround from 5488 and ignore 4 channel YCbCr and remove related code, as suggested by Harald Kuhr; see also twelvemonkeys github issue #878&lt;/p&gt;</comment>
                            <comment id="17798522" author="jira-bot" created="Tue, 19 Dec 2023 10:00:54 +0000"  >&lt;p&gt;Commit 1914770 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1914770&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1914770&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5738&quot; title=&quot;Wrong colors in PDF since PDFBOX-5488&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5738&quot;&gt;&lt;del&gt;PDFBOX-5738&lt;/del&gt;&lt;/a&gt;: revert workaround from 5488 and ignore 4 channel YCbCr and remove related code, as suggested by Harald Kuhr; see also twelvemonkeys github issue #878&lt;/p&gt;</comment>
                            <comment id="17798524" author="tilman" created="Tue, 19 Dec 2023 10:02:30 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Schmidor&quot; class=&quot;user-hover&quot; rel=&quot;Schmidor&quot;&gt;Schmidor&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=haraldk76&quot; class=&quot;user-hover&quot; rel=&quot;haraldk76&quot;&gt;haraldk76&lt;/a&gt;; I&apos;ll test the YCbCrConverter separately.&lt;/p&gt;</comment>
                            <comment id="17798527" author="tilman" created="Tue, 19 Dec 2023 10:09:29 +0000"  >&lt;p&gt;Oops, no, because it is no longer used in our code. Its only use was the incorrect one. I suspect that it&apos;s only used in your code when &lt;tt&gt;reader.read()&lt;/tt&gt; is called.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13065399" name="PDFBOX-5488-p1.pdf-1-old.png" size="105037" author="tilman" created="Mon, 18 Dec 2023 14:03:51 +0000"/>
                            <attachment id="13065400" name="PDFBOX-5488-p1.pdf-new.png" size="132761" author="tilman" created="Mon, 18 Dec 2023 14:03:51 +0000"/>
                            <attachment id="13065315" name="Rechnung 983312924 (Carbafas)_page1.jpg" size="443402" author="Schmidor" created="Thu, 14 Dec 2023 12:13:09 +0000"/>
                            <attachment id="13065299" name="Rechnung 983312924 (Carbagas).pdf" size="224237" author="Schmidor" created="Wed, 13 Dec 2023 22:23:58 +0000"/>
                            <attachment id="13065314" name="gre_research_validiity_data_page1.jpg" size="262622" author="Schmidor" created="Thu, 14 Dec 2023 12:13:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 46 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1m8tc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>