<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:10:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4793] Questionable fallback font for some embedded chinese fonts</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4793</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;&lt;b&gt;Issue:&lt;/b&gt;&lt;br/&gt;
I tried to render PDFs, that contain embedded chinese fonts. Neither the PDF Debugger, nor printouts of the document (PDFPrintable), nor the PDFRenderer can display/render the chinese glyphs correctly and will render placeholders instead.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Assumptions:&lt;/b&gt;&lt;br/&gt;
I assume, that said embedded fonts are incomplete and don&apos;t contain all glyphs, that would be required to render the text properly and therefore PDFbox attempts to use the previously determined fallback font. (!?)&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995585/12995585_image-2020-03-04-09-49-42-323.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995584/12995584_image-2020-03-04-09-58-01-055.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
And fails to find the glyphs in said fallback font.&lt;/p&gt;

&lt;p&gt;Which is not surprising, as the Fallback font &quot;MalgunGothic-Semilight&quot; (Windows standard font) does not contain chinese characters.&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995583/12995583_image-2020-03-04-10-09-25-343.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;&lt;b&gt;Debugging:&lt;/b&gt;&lt;br/&gt;
I tried to understand how the fallback font is determined and what could be done to solve this problem on my end. But I was unable to find a satisfying solution.&lt;br/&gt;
My best guess so far is, that the CIDFontMapping (FontMapperImpl) is to blame for determining an unfit fallback font.&lt;br/&gt;
Although it seems to check, whether required codepages are contained in a fallback font, it still does rank the Malgun font as the topscorer and best substitute font, even though it does clearly not contain all required codepages.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;My opinion:&lt;/b&gt;&lt;br/&gt;
This is troubling, as better fit fonts exist and could have been selected. (ie.: Adobe Stong Std) And are indeed included in the CIDFontMapping, but seemingly are scoring lower for some reason.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Further information:&lt;/b&gt;&lt;br/&gt;
I can not disclose the document in question, however I found a document (pdf_font-zhcn.pdf) in another issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3132&quot; title=&quot;Cannot extract text which font is Type0 with predefined CJK CMap&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3132&quot;&gt;&lt;del&gt;PDFBOX-3132&lt;/del&gt;&lt;/a&gt;), that can be used to reproduce the issue (ie.: by dropping it into the PDF Debugger)&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995581/12995581_image-2020-03-04-10-31-03-065.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;</description>
                <environment></environment>
        <key id="13289477">PDFBOX-4793</key>
            <summary>Questionable fallback font for some embedded chinese fonts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="capSVD">Christian Appl</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Mar 2020 09:37:01 +0000</created>
                <updated>Mon, 15 Jun 2020 04:54:17 +0000</updated>
                            <resolved>Thu, 5 Mar 2020 18:25:49 +0000</resolved>
                                    <version>2.0.18</version>
                    <version>2.0.19</version>
                                    <fixVersion>2.0.20</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17051478" author="lehmi" created="Wed, 4 Mar 2020 18:03:24 +0000"  >&lt;p&gt;IMHO the pdf is broken, such font shall be embedded. However, PDFBox uses the installed fonts as a substitute for the missing fonts. Obviously you don&apos;t have any suitable font on your system. The mentioned pdf renders fine on my linux box by using a different font as fallback:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Using fallback DroidSansFallback for CID-keyed font AdobeSongStd-Light,Bold&lt;/p&gt;&lt;/blockquote&gt;

</comment>
                            <comment id="17051489" author="tilman" created="Wed, 4 Mar 2020 18:11:22 +0000"  >&lt;p&gt;On mine (w10) it uses ArialUni.&lt;/p&gt;

&lt;p&gt;See also&lt;br/&gt;
&lt;a href=&quot;https://en.wikipedia.org/wiki/Fallback_font&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://en.wikipedia.org/wiki/Fallback_font&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17051953" author="capsvd" created="Thu, 5 Mar 2020 09:45:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; Agreed, the embedded subset should contain all required glyphs - but iText (in case of the problematic document) decided to embed a nonsensical subset. However, as other applications (such as PDF.js and Adobe Reader) do display the PDF just fine, I can not simply dismiss the document as erroneous.&lt;/p&gt;

&lt;p&gt;It would be great if the solution was as easy as installing a new font... however, if everything is fine in your tests, then I seem to do something wrong here:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Further information and following your instructions:&lt;/b&gt;&lt;br/&gt;
I am using Windows10 and OpenJDK 11.0.6 - I have reinstalled ArialUnicodeMS (even though my OS told me, it was already installed.)&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995702/12995702_screenshot-2.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;I created a new fresh and empty project (to rule out hickups in our code) and added PDFBox via the following dependency to the project&apos;s pom:&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995703/12995703_screenshot-3.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I used the PDFRenderer to check whether ArialUnicode would be used to render the image now:&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995705/12995705_screenshot-4.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;But still Malgun is used as the fallback font:&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995706/12995706_screenshot-5.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;Still leading to the following output:&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995708/12995708_screenshot-6.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Questions:&lt;/b&gt;&lt;br/&gt;
What on earth am I doing wrong?&lt;br/&gt;
Are the determined fallback fonts cached in some way and is deleting the cache an option?&lt;br/&gt;
In other words: What are you doing different than me?&lt;/p&gt;</comment>
                            <comment id="17051977" author="tilman" created="Thu, 5 Mar 2020 10:11:13 +0000"  >&lt;p&gt;You could try deleting the cache file but I expect this to stay as it is... the weird thing is I have MalgunGothic Semilight too on my machine and it isn&apos;t chosen.&lt;/p&gt;

&lt;p&gt;But wait, it gets weirder...&lt;/p&gt;

&lt;p&gt;I looked into my developing code of &lt;tt&gt;getFontMatches()&lt;/tt&gt; and found this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Idee: ausschluss mapping                
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;fontDescriptor.getFontName(): &quot;&lt;/span&gt; + fontDescriptor.getFontName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;, info.getPostScriptName(): &quot;&lt;/span&gt; + info.getPostScriptName());
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;// https://github.com/mozilla/pdf.js/issues/10699
&lt;/span&gt;                &lt;span class=&quot;code-comment&quot;&gt;//  fontDescriptor.getFontName(): AdobeSongStd-Light, info.getPostScriptName(): MalgunGothic-Semilight
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (info.getPostScriptName().startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;MalgunGothic&quot;&lt;/span&gt;))
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//{
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//    &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;//}&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I also had a look at the score values. For your file all scores are 0. So it&apos;s just bad luck that Malgun was chosen:&lt;/p&gt;

&lt;p&gt;getFontMatches: AdobeSongStd-Light&lt;br/&gt;
ArialUnicodeMS (TTF, mac: 0x0, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\ARIALUNI.TTF 0.0&lt;br/&gt;
MalgunGothic-Semilight (TTF, mac: 0x0, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\malgunsl.ttf 0.0&lt;br/&gt;
MalgunGothic-Semilight (TTF, mac: 0x0, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\malgunsl.ttf 0.0&lt;br/&gt;
MicrosoftYaHei (TTF, mac: 0x0, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyh.ttc 0.0&lt;br/&gt;
MicrosoftYaHeiUI (TTF, mac: 0x0, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyh.ttc 0.0&lt;br/&gt;
MicrosoftYaHei-Bold (TTF, mac: 0x1, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyhbd.ttc 0.0&lt;br/&gt;
MicrosoftYaHei-Bold (TTF, mac: 0x1, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyhbd.ttc 0.0&lt;br/&gt;
MicrosoftYaHeiUI-Bold (TTF, mac: 0x1, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyhbd.ttc 0.0&lt;br/&gt;
MicrosoftYaHeiUI-Bold (TTF, mac: 0x1, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyhbd.ttc 0.0&lt;br/&gt;
MicrosoftYaHeiLight (TTF, mac: 0x0, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyhl.ttc 0.0&lt;br/&gt;
MicrosoftYaHeiUILight (TTF, mac: 0x0, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyhl.ttc 0.0&lt;br/&gt;
SimSun (TTF, mac: 0x0, os/2: 0x0, cid: null) C:\WINDOWS\FONTS\simsun.ttc 0.0&lt;br/&gt;
NSimSun (TTF, mac: 0x0, os/2: 0x0, cid: null) C:\WINDOWS\FONTS\simsun.ttc 0.0&lt;br/&gt;
SimSun-ExtB (TTF, mac: 0x0, os/2: 0x0, cid: null) C:\WINDOWS\FONTS\simsunb.ttf 0.0&lt;br/&gt;
SimSun-ExtB (TTF, mac: 0x0, os/2: 0x0, cid: null) C:\WINDOWS\FONTS\simsunb.ttf 0.0&lt;/p&gt;


&lt;p&gt;Then I did the same for the file from PDF.js mentioned in the comment. There it looks like this:&lt;/p&gt;

&lt;p&gt;getFontMatches: AdobeSongStd-Light&lt;br/&gt;
MalgunGothic-Semilight (TTF, mac: 0x0, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\malgunsl.ttf 1.0&lt;br/&gt;
MicrosoftYaHeiLight (TTF, mac: 0x0, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyhl.ttc 0.9499999992549419&lt;br/&gt;
MalgunGothic-Semilight (TTF, mac: 0x0, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\malgunsl.ttf 1.0&lt;br/&gt;
MicrosoftYaHei (TTF, mac: 0x0, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyh.ttc 0.5&lt;br/&gt;
MicrosoftYaHeiUILight (TTF, mac: 0x0, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyhl.ttc 0.9499999992549419&lt;br/&gt;
SimSun (TTF, mac: 0x0, os/2: 0x0, cid: null) C:\WINDOWS\FONTS\simsun.ttc 0.5&lt;br/&gt;
SimSun-ExtB (TTF, mac: 0x0, os/2: 0x0, cid: null) C:\WINDOWS\FONTS\simsunb.ttf 0.5&lt;br/&gt;
MicrosoftYaHeiUI-Bold (TTF, mac: 0x1, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyhbd.ttc -1.0&lt;br/&gt;
MicrosoftYaHeiUI-Bold (TTF, mac: 0x1, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyhbd.ttc -1.0&lt;br/&gt;
MicrosoftYaHeiUI (TTF, mac: 0x0, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyh.ttc 0.5&lt;br/&gt;
ArialUnicodeMS (TTF, mac: 0x0, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\ARIALUNI.TTF 0.5&lt;br/&gt;
MicrosoftYaHei-Bold (TTF, mac: 0x1, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyhbd.ttc -1.0&lt;br/&gt;
NSimSun (TTF, mac: 0x0, os/2: 0x0, cid: null) C:\WINDOWS\FONTS\simsun.ttc 0.5&lt;br/&gt;
MicrosoftYaHei-Bold (TTF, mac: 0x1, os/2: 0x805, cid: null) C:\WINDOWS\FONTS\msyhbd.ttc -1.0&lt;br/&gt;
SimSun-ExtB (TTF, mac: 0x0, os/2: 0x0, cid: null) C:\WINDOWS\FONTS\simsunb.ttf 0.5&lt;/p&gt;</comment>
                            <comment id="17051988" author="capsvd" created="Thu, 5 Mar 2020 10:33:51 +0000"  >&lt;p&gt;I thought so, as Malgun is a standard windows system font.&lt;br/&gt;
Okay... questioning an initial statement of mine: Is Malgun indeed a valid font to display the glyphs? And does the renderer simply fail to resolve the glyph ids?&lt;br/&gt;
I did not verify my initial statement concerning Malgun - I simply threw the font into &lt;a href=&quot;https://fontdrop.info/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://fontdrop.info/&lt;/a&gt; and did not question the results.&lt;/p&gt;

&lt;p&gt;However and even more though - my current opinion: Either Malgun is a poor choice as a fallback font, or the renderer suggests and selects a fallback font, that it may not be equipped to use.&lt;/p&gt;

&lt;p&gt;Thank you very much for clarification and for having a look into it!&lt;/p&gt;</comment>
                            <comment id="17052003" author="capsvd" created="Thu, 5 Mar 2020 10:55:04 +0000"  >&lt;p&gt;Sorry for double posting, but the expectable follow up questions are: Is there some sort of workarround possible? Is there some way I could replace the suggested fallback fonts &quot;manually&quot; with ie.: Arial Unicode. Can I suggest a fallback font for the rendering statically? Is there some way I could implement a &quot;whitelist&amp;amp;blacklist&quot; for fonts. Can I in some way directly influence this whole solution, without overriding fontbox/pdfbox methods and classes?&lt;/p&gt;</comment>
                            <comment id="17052195" author="tilman" created="Thu, 5 Mar 2020 14:42:55 +0000"  >&lt;p&gt;Of course it is a bad decision... my idea, maybe a year ago (probably my pc crashed so I lost that open window in my IDE and forgot about the problem), was to set &quot;blacklist rules&quot;.&lt;/p&gt;

&lt;p&gt;This font is a Korean font. WTF would this ever be acceptable as a match.&lt;/p&gt;

&lt;p&gt;isCharSetMatch() should avoid this.&lt;/p&gt;

&lt;p&gt;However it returns true because it hits this part&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cidSystemInfo.getOrdering().equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;GB1&quot;&lt;/span&gt;) &amp;amp;&amp;amp;
                    (codePageRange &amp;amp; CHINESE_SIMPLIFIED) == CHINESE_SIMPLIFIED)
            {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;codePageRange is&lt;br/&gt;
-2882585235952893507 which is&lt;br/&gt;
D7FF 0000 203E 01BD&#8236;&lt;/p&gt;

&lt;p&gt;According to DTL OTMaster 3.7 light, ulUnicodeRange1 is 0x900002af and ulUnicodeRange2 is 0x01d77cfb.&lt;/p&gt;

&lt;p&gt;According to the debugger, ours are 0x203e01bd and 0xd7ff0000.&lt;/p&gt;

&lt;p&gt;More to investigate...&lt;/p&gt;</comment>
                            <comment id="17052210" author="capsvd" created="Thu, 5 Mar 2020 14:56:53 +0000"  >&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Thank you very much and &quot;Gutes Gelingen&quot;! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17052218" author="tilman" created="Thu, 5 Mar 2020 15:00:38 +0000"  >&lt;p&gt;Oh, I just see that I confused codePageRange  and ulUnicodeRange, these are different things. I&apos;m sick at home (currently recovering) so I&apos;m somewhat confused.&lt;/p&gt;</comment>
                            <comment id="17052229" author="tilman" created="Thu, 5 Mar 2020 15:08:59 +0000"  >&lt;p&gt;So ulCodePageRange in DTL OTMaster is 0x203e01bd and 0xd7ff0000. So the first one is 100000 0011 1110 0000 0001 1011 1101.&lt;br/&gt;
The china bit is 18.&lt;br/&gt;
&lt;a href=&quot;https://docs.microsoft.com/en-us/typography/opentype/spec/os2#cpr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.microsoft.com/en-us/typography/opentype/spec/os2#cpr&lt;/a&gt;&lt;br/&gt;
Bits 17 - 21 are set. But only bit 19 (Korean Wansung) should be.&lt;/p&gt;</comment>
                            <comment id="17052292" author="capsvd" created="Thu, 5 Mar 2020 16:09:29 +0000"  >&lt;p&gt;Get well soon!!&lt;/p&gt;

&lt;p&gt;I gave one of your first suggestions a shot (Ausschluss mapping), to verify, that it would theoretically work:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; PriorityQueue&amp;lt;FontMatch&amp;gt; getFontMatches(PDFontDescriptor fontDescriptor,
                                                    PDCIDSystemInfo cidSystemInfo) {
        PriorityQueue&amp;lt;FontMatch&amp;gt; queue = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PriorityQueue&amp;lt;FontMatch&amp;gt;(20);

        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (FontInfo info : fontInfoByName.values()) {
            &lt;span class=&quot;code-comment&quot;&gt;// ignore Malgun gothic
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (info.getPostScriptName().startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;MalgunGothic&quot;&lt;/span&gt;)) {
                &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
            }

            &lt;span class=&quot;code-comment&quot;&gt;// filter by CIDSystemInfo, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; given
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cidSystemInfo != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !isCharSetMatch(cidSystemInfo, info)) {
                &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And the issue was resolved - another Font was selected and the PDF rendered just fine.&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995757/12995757_screenshot-7.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;However: Is it really a good idea to flatout deny rendering with a specific font? Concerning the blacklist idea: I would expect, that this could cause issues with other documents (using korean letters).&lt;br/&gt;
I think I like your current idea better to differentiate using the bit flags.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;However:&lt;/b&gt; Just giving the feedback - Yes, if the malgun font wasn&apos;t selected on my system, the PDF would render perfectly fine.&lt;/p&gt;</comment>
                            <comment id="17052304" author="tilman" created="Thu, 5 Mar 2020 16:23:09 +0000"  >&lt;p&gt;I&apos;m going deeper, it&apos;s really a tiny part of the font that is wrong. I&apos;ll fix this in isCharSetMatch() by resetting the 3 bad bits there, and also fix a bug at the end of the method, that went undiscovered for many years.&lt;/p&gt;</comment>
                            <comment id="17052317" author="jira-bot" created="Thu, 5 Mar 2020 16:39:44 +0000"  >&lt;p&gt;Commit 1874844 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1874844&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1874844&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4793&quot; title=&quot;Questionable fallback font for some embedded chinese fonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4793&quot;&gt;&lt;del&gt;PDFBOX-4793&lt;/del&gt;&lt;/a&gt;: deactivate wrongly set bits in MalgunGothic-Semilight; fix missing parentheses bug&lt;/p&gt;</comment>
                            <comment id="17052318" author="jira-bot" created="Thu, 5 Mar 2020 16:39:49 +0000"  >&lt;p&gt;Commit 1874845 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1874845&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1874845&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4793&quot; title=&quot;Questionable fallback font for some embedded chinese fonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4793&quot;&gt;&lt;del&gt;PDFBOX-4793&lt;/del&gt;&lt;/a&gt;: deactivate wrongly set bits in MalgunGothic-Semilight; fix missing parentheses bug&lt;/p&gt;</comment>
                            <comment id="17052319" author="jira-bot" created="Thu, 5 Mar 2020 16:39:53 +0000"  >&lt;p&gt;Commit 1874846 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1874846&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1874846&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4793&quot; title=&quot;Questionable fallback font for some embedded chinese fonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4793&quot;&gt;&lt;del&gt;PDFBOX-4793&lt;/del&gt;&lt;/a&gt;: deactivate wrongly set bits in MalgunGothic-Semilight; fix missing parentheses bug&lt;/p&gt;</comment>
                            <comment id="17052336" author="tilman" created="Thu, 5 Mar 2020 17:02:23 +0000"  >&lt;p&gt;I need some rest... snapshot will be at &lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.20-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.20-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17052410" author="tilman" created="Thu, 5 Mar 2020 18:25:49 +0000"  >&lt;p&gt;Build was successful... setting to resolved. Thanks for your patience and for the report!&lt;/p&gt;</comment>
                            <comment id="17053109" author="capsvd" created="Fri, 6 Mar 2020 07:43:17 +0000"  >&lt;p&gt;Awesome! Thank you very much! This is one of the reasons it really is a pleasure working with this fine library!&lt;/p&gt;</comment>
                            <comment id="17053251" author="capsvd" created="Fri, 6 Mar 2020 10:22:45 +0000"  >&lt;p&gt;Sorry for reopening.&lt;/p&gt;

&lt;p&gt;Hmmm - I&apos;m trying to understand the math here... Maybe I am completly off and simply don&apos;t understand how this works, but something seems odd to me.&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995828/12995828_screenshot-9.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;Those are the values, I am reading from the font Malgun Gothic. According to the link you shared (&lt;a href=&quot;https://docs.microsoft.com/en-us/typography/opentype/spec/os2#cpr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.microsoft.com/en-us/typography/opentype/spec/os2#cpr&lt;/a&gt;) the ulCodePageRange1 Bits 0&#8211;31and ulCodePageRange2 Bits 32&#8211;63 are relevant for determining which languages are supported by a MS font.&lt;/p&gt;

&lt;p&gt;According to fontDrop those values are:&lt;br/&gt;
ulCodePageRange1 : 524289 (&#8237;1000 0000 0000 0000 0001&#8236;)&lt;br/&gt;
ulCodePageRange2 : 0&lt;/p&gt;

&lt;p&gt;Using parts of your code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;... args){
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; ulCodePageRange1 = 524289;

        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; JIS_JAPAN = 1 &amp;lt;&amp;lt; 17;
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; CHINESE_SIMPLIFIED = 1 &amp;lt;&amp;lt; 18;
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; KOREAN_WANSUNG = 1 &amp;lt;&amp;lt; 19;
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; CHINESE_TRADITIONAL = 1 &amp;lt;&amp;lt; 20;
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; KOREAN_JOHAB = 1 &amp;lt;&amp;lt; 21;

        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println((ulCodePageRange1 &amp;amp; KOREAN_WANSUNG) == KOREAN_WANSUNG);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println((ulCodePageRange1 &amp;amp; KOREAN_JOHAB) == KOREAN_JOHAB);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println((ulCodePageRange1 &amp;amp; CHINESE_SIMPLIFIED) == CHINESE_SIMPLIFIED);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Resulting in the output:&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995827/12995827_screenshot-8.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;Which is exactly evaluating to: It is indeed a korean and not a chinese font.&lt;br/&gt;
I currently don&apos;t know how the variable &quot;long codePageRange&quot; is determined exactly and I don&apos;t know, if I am thinking to simple here... but is this statement:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;// &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4793&quot; title=&quot;Questionable fallback font for some embedded chinese fonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4793&quot;&gt;&lt;del&gt;PDFBOX-4793&lt;/del&gt;&lt;/a&gt; and PDF.js 10699: This font has only Korean, but has bits 17-21 set.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;really true?&lt;/p&gt;

&lt;p&gt;As far as I can see this evaluation should work fine. Is the correct value used for &quot;codePageRange&quot;?&lt;/p&gt;

&lt;p&gt;Sorry for being pushy &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17053258" author="tilman" created="Fri, 6 Mar 2020 10:28:24 +0000"  >&lt;p&gt;Malgun Gothic is not the problem font, the problem font is Malgun Gothic Semilight.&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995832/12995832_image-2020-03-06-11-35-53-580.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="17053280" author="capsvd" created="Fri, 6 Mar 2020 10:40:37 +0000"  >&lt;p&gt;I have got doubts about that.&lt;br/&gt;
&quot;Malgun Gothic&quot; is the only Malgun font installed on my system and it did previously cause the issue (for me) and it does no longer (post Commit 1874846)&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995834/12995834_screenshot-10.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;I will check this for for Malgun Gothic Semilight too and edit this comment then. But I am still not convinced, that &quot;codePageRange&quot; is working as expected.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;EDIT:&lt;/b&gt;&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995839/12995839_image-2020-03-06-11-48-56-813.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12995838/12995838_image-2020-03-06-11-49-25-187.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;Ok - now I am totally confused. O.o&lt;/p&gt;</comment>
                            <comment id="17053294" author="tilman" created="Fri, 6 Mar 2020 10:51:53 +0000"  >&lt;p&gt;Your initial report mentioned semilight.&lt;br/&gt;
Anyway, I never used the explorer view until today, I looked at the directory from a MS-DOS box. A habit from being &quot;old&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17053297" author="tilman" created="Fri, 6 Mar 2020 10:53:16 +0000"  >&lt;p&gt;Your last screenshot uses the wrong row (same mistake I made yesterday). You need ulCodePageRange.&lt;/p&gt;</comment>
                            <comment id="17053303" author="capsvd" created="Fri, 6 Mar 2020 11:00:59 +0000"  >&lt;p&gt;Aaaah got it - Sorry!&lt;br/&gt;
But how come the font &quot;collection&quot; does set the correct flags and the individual font doesn&apos;t? Or - better question: Would it not be an option to read said bits from the &quot;collection&quot; instead? (As this information seems to be more reliable?)&lt;/p&gt;

&lt;p&gt;However - thanks for clarification. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17053305" author="tilman" created="Fri, 6 Mar 2020 11:10:18 +0000"  >&lt;p&gt;It is not a collection (ttc), it&apos;s three ttf files, and of them 2 are right and 1 is wrong. In the meantime I found the semilight font in the explorer view - it is &quot;Malgun Gothic Fein&quot;. Windows organizes all this in some sort of view, translates, all that is really confusing. I&apos;ll never use that view again &#129315;&lt;/p&gt;</comment>
                            <comment id="17053316" author="capsvd" created="Fri, 6 Mar 2020 11:35:31 +0000"  >&lt;p&gt;Okay - thank you Windows for leading me to failure. XD&lt;br/&gt;
Dito - I really do hate the modern &quot;simplified&quot; views... Sorry for bothering you and I abandon my claims. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12995710" name="PDFJS-10699.pdf" size="299101" author="tilman" created="Thu, 5 Mar 2020 10:18:43 +0000"/>
                            <attachment id="12995585" name="image-2020-03-04-09-49-42-323.png" size="2272" author="capSVD" created="Wed, 4 Mar 2020 08:49:42 +0000"/>
                            <attachment id="12995584" name="image-2020-03-04-09-58-01-055.png" size="1838" author="capSVD" created="Wed, 4 Mar 2020 08:58:01 +0000"/>
                            <attachment id="12995583" name="image-2020-03-04-10-09-25-343.png" size="7153" author="capSVD" created="Wed, 4 Mar 2020 09:09:25 +0000"/>
                            <attachment id="12995581" name="image-2020-03-04-10-31-03-065.png" size="29507" author="capSVD" created="Wed, 4 Mar 2020 09:31:03 +0000"/>
                            <attachment id="12995832" name="image-2020-03-06-11-35-53-580.png" size="202269" author="tilman" created="Fri, 6 Mar 2020 10:35:53 +0000"/>
                            <attachment id="12995839" name="image-2020-03-06-11-48-56-813.png" size="34471" author="capSVD" created="Fri, 6 Mar 2020 10:48:56 +0000"/>
                            <attachment id="12995838" name="image-2020-03-06-11-49-25-187.png" size="3792" author="capSVD" created="Fri, 6 Mar 2020 10:49:25 +0000"/>
                            <attachment id="12995582" name="pdf_font-zhcn.pdf" size="243586" author="capSVD" created="Wed, 4 Mar 2020 09:29:22 +0000"/>
                            <attachment id="12995834" name="screenshot-10.png" size="29361" author="capSVD" created="Fri, 6 Mar 2020 10:40:33 +0000"/>
                            <attachment id="12995702" name="screenshot-2.png" size="4195" author="capSVD" created="Thu, 5 Mar 2020 09:29:37 +0000"/>
                            <attachment id="12995703" name="screenshot-3.png" size="7783" author="capSVD" created="Thu, 5 Mar 2020 09:37:26 +0000"/>
                            <attachment id="12995705" name="screenshot-4.png" size="42738" author="capSVD" created="Thu, 5 Mar 2020 09:39:19 +0000"/>
                            <attachment id="12995706" name="screenshot-5.png" size="21642" author="capSVD" created="Thu, 5 Mar 2020 09:40:11 +0000"/>
                            <attachment id="12995708" name="screenshot-6.png" size="109360" author="capSVD" created="Thu, 5 Mar 2020 09:41:01 +0000"/>
                            <attachment id="12995757" name="screenshot-7.png" size="51282" author="capSVD" created="Thu, 5 Mar 2020 16:05:52 +0000"/>
                            <attachment id="12995827" name="screenshot-8.png" size="3661" author="capSVD" created="Fri, 6 Mar 2020 10:17:01 +0000"/>
                            <attachment id="12995828" name="screenshot-9.png" size="35308" author="capSVD" created="Fri, 6 Mar 2020 10:17:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0c5aw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>