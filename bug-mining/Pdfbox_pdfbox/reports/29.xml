<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:52:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-513] PDJpeg does not support transparency/alpha</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-513</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The code does not handle this feature. Patch attached.&lt;/p&gt;</description>
                <environment>Any</environment>
        <key id="12434928">PDFBOX-513</key>
            <summary>PDJpeg does not support transparency/alpha</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="yonas.jongkind@gmail.com">Yonas Jongkind</reporter>
                        <labels>
                    </labels>
                <created>Sun, 6 Sep 2009 07:12:38 +0000</created>
                <updated>Thu, 1 Jul 2010 07:26:38 +0000</updated>
                            <resolved>Wed, 9 Jun 2010 18:18:25 +0000</resolved>
                                    <version>0.8.0-incubator</version>
                                    <fixVersion>1.2.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12751835" author="yonas.jongkind@gmail.com" created="Sun, 6 Sep 2009 07:13:47 +0000"  >&lt;p&gt;Version that does support transparency.&lt;/p&gt;</comment>
                            <comment id="12751836" author="yonas.jongkind@gmail.com" created="Sun, 6 Sep 2009 07:16:14 +0000"  >&lt;p&gt;And a partial diff as well... Source refomatting made the full diff useless, but it&apos;s an easy bit of code to copy from the attached source:&lt;/p&gt;

&lt;p&gt;84,85c98&lt;br/&gt;
&amp;lt;         if (image != null) &lt;br/&gt;
&amp;lt;         {&lt;br/&gt;
&amp;#8212;&lt;br/&gt;
&amp;gt;         if (image != null) {&lt;br/&gt;
103a117,139&lt;br/&gt;
&amp;gt;         BufferedImage alpha = null;&lt;br/&gt;
&amp;gt;         if (bi.getColorModel().hasAlpha()){&lt;br/&gt;
&amp;gt;         &lt;br/&gt;
&amp;gt; 	        alpha = new BufferedImage(bi.getWidth(), bi.getHeight(), BufferedImage.TYPE_BYTE_GRAY);&lt;br/&gt;
&amp;gt; 	        Graphics2D g = alpha.createGraphics();&lt;br/&gt;
&amp;gt; 	        g.setColor(Color.BLACK);&lt;br/&gt;
&amp;gt; 	        g.drawRect(0, 0, bi.getWidth(), bi.getHeight());&lt;br/&gt;
&amp;gt; 	        g.setColor(Color.WHITE);&lt;br/&gt;
&amp;gt; 	        g.drawImage(bi, 0, 0, null);&lt;br/&gt;
&amp;gt; 		    for(int y = 0; y &amp;lt; alpha.getHeight(); y++){&lt;br/&gt;
&amp;gt; 		    	for(int x = 0; x &amp;lt; alpha.getWidth(); x++){&lt;br/&gt;
&amp;gt; 		    		Color color = new Color(alpha.getRGB(x, y));&lt;br/&gt;
&amp;gt; 		    		if(color.getRed() != 0 &amp;amp;&amp;amp; color.getGreen() != 0 &amp;amp;&amp;amp; color.getBlue() != 0)&lt;/p&gt;
{
&amp;gt; 		    			alpha.setRGB(x, y, (Color.white).getRGB());
&amp;gt; 		    		}
&lt;p&gt;&amp;gt; 		    	}&lt;br/&gt;
&amp;gt; 		    }&lt;br/&gt;
&amp;gt; 	        &lt;br/&gt;
&amp;gt; 	        BufferedImage image = new BufferedImage(bi.getWidth(), bi.getHeight(), BufferedImage.TYPE_USHORT_565_RGB);&lt;br/&gt;
&amp;gt; 	        g = image.createGraphics();&lt;br/&gt;
&amp;gt; 	        g.drawImage(bi, 0, 0, null);&lt;br/&gt;
&amp;gt; 	        bi = image;&lt;br/&gt;
&amp;gt;         }&lt;/p&gt;


</comment>
                            <comment id="12751921" author="lehmi" created="Sun, 6 Sep 2009 15:40:52 +0000"  >&lt;p&gt;Thanks for the contribution. Do you have a sample jpg you can provide to do some testing?&lt;/p&gt;</comment>
                            <comment id="12753848" author="danielwilson" created="Thu, 10 Sep 2009 22:02:06 +0000"  >&lt;p&gt;Yonas,&lt;/p&gt;

&lt;p&gt;That sample would certainly help.&lt;/p&gt;

&lt;p&gt;Also a bit of clarification ... certainly the format changes have made a full diff difficult.  But I see several areas of difference between the trunk version and yours.&lt;/p&gt;

&lt;p&gt;First is the 2nd constructor ... is that where the code you&apos;ve pasted above belongs?&lt;/p&gt;

&lt;p&gt;Then there&apos;s the  public byte[] getImageIndexThingy() at the end of the file.  Is that needed?&lt;/p&gt;

&lt;p&gt;Finally ... and maybe I&apos;m missing something ... but is support for JPG transparency really needed ... as JPG files do not support transparency?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;Daniel&lt;/p&gt;</comment>
                            <comment id="12755129" author="yonas.jongkind@gmail.com" created="Mon, 14 Sep 2009 18:39:13 +0000"  >&lt;p&gt;Hi Daniel,&lt;/p&gt;

&lt;p&gt;We were building the image pragmatically using a buffered image and then storing it into the PDF. JPEG does not as you point out support transparency, but buffered images do.&lt;/p&gt;

&lt;p&gt;How PDF&apos;s with JPEG&apos;s and transparency work is that the PDF spec stores 2 images. One is the alpha mask, and the other is the image.  We tried to get it to work with TIFF, but that is so poorly supported (in both Java and PDFBox) that we gave up.&lt;/p&gt;

&lt;p&gt;This code is in essence splitting out those two images and storing them in the PDF.&lt;/p&gt;

&lt;p&gt;This code only affects the constructor which checks to see if there is transparency and if there is records the extra image (the mask) in the PDF. I think the constructor code should be:&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Construct from a buffered image.&lt;br/&gt;
     *&lt;/li&gt;
	&lt;li&gt;@param doc The document to create the image as part of.&lt;/li&gt;
	&lt;li&gt;@param bi The image to convert to a jpeg&lt;/li&gt;
	&lt;li&gt;@throws IOException If there is an error processing the jpeg data.&lt;br/&gt;
     */&lt;br/&gt;
    public PDJpeg( PDDocument doc, BufferedImage bi ) throws IOException&lt;br/&gt;
    {&lt;br/&gt;
        super( new PDStream( doc ), &quot;jpg&quot; );&lt;br/&gt;
        BufferedImage alpha = null;&lt;br/&gt;
        if (bi.getColorModel().hasAlpha()){&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;	        alpha = new BufferedImage(bi.getWidth(), bi.getHeight(), BufferedImage.TYPE_BYTE_GRAY);&lt;br/&gt;
	        Graphics2D g = alpha.createGraphics();&lt;br/&gt;
	        g.setColor(Color.BLACK);&lt;br/&gt;
	        g.drawRect(0, 0, bi.getWidth(), bi.getHeight());&lt;br/&gt;
	        g.setColor(Color.WHITE);&lt;br/&gt;
	        g.drawImage(bi, 0, 0, null);&lt;br/&gt;
		    for(int y = 0; y &amp;lt; alpha.getHeight(); y++){&lt;br/&gt;
		    	for(int x = 0; x &amp;lt; alpha.getWidth(); x++){&lt;br/&gt;
		    		Color color = new Color(alpha.getRGB(x, y));&lt;br/&gt;
		    		if(color.getRed() != 0 &amp;amp;&amp;amp; color.getGreen() != 0 &amp;amp;&amp;amp; color.getBlue() != 0)&lt;/p&gt;
{
		    			alpha.setRGB(x, y, (Color.white).getRGB());
		    		}
&lt;p&gt;		    	}&lt;br/&gt;
		    }&lt;/p&gt;

&lt;p&gt;	        BufferedImage image = new BufferedImage(bi.getWidth(), bi.getHeight(), BufferedImage.TYPE_USHORT_565_RGB);&lt;br/&gt;
	        g = image.createGraphics();&lt;br/&gt;
	        g.drawImage(bi, 0, 0, null);&lt;br/&gt;
	        bi = image;&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;        java.io.OutputStream os = getCOSStream().createFilteredStream();&lt;br/&gt;
        try&lt;br/&gt;
        {&lt;br/&gt;
            ImageIO.write(bi,&quot;jpeg&quot;,os);&lt;/p&gt;

&lt;p&gt;            COSDictionary dic = getCOSStream();&lt;br/&gt;
            dic.setItem( COSName.FILTER, COSName.DCT_DECODE );&lt;br/&gt;
            dic.setItem( COSName.SUBTYPE, COSName.IMAGE);&lt;br/&gt;
            dic.setItem( COSName.TYPE, COSName.getPDFName( &quot;XObject&quot; ) );&lt;br/&gt;
        	PDXObjectImage alphaPdImage = null;&lt;br/&gt;
            if(alpha != null)&lt;/p&gt;
{
            	alphaPdImage = new PDJpeg(doc, alpha);
            	dic.setItem(&quot;SMask&quot;, alphaPdImage);
            }
&lt;p&gt;            setBitsPerComponent( 8 );&lt;br/&gt;
            if (bi.getColorModel().getNumComponents() == 3) &lt;/p&gt;
{
            	setColorSpace( PDDeviceRGB.INSTANCE );
            }
&lt;p&gt; else if (bi.getColorModel().getNumComponents() == 1) &lt;/p&gt;
{
            	setColorSpace( new PDDeviceGray() );
            }
&lt;p&gt; else throw new IllegalStateException();&lt;br/&gt;
            setHeight( bi.getHeight() );&lt;br/&gt;
            setWidth( bi.getWidth() );&lt;br/&gt;
        }&lt;br/&gt;
        finally&lt;/p&gt;
        {
            os.close();
        }
&lt;p&gt;    }&lt;/p&gt;




&lt;p&gt;Code we use to create a sample with transparency is:&lt;/p&gt;

&lt;p&gt;BufferedImage bufferedImage = new BufferedImage(100,100, BufferedImage.TYPE_INT_ARGB);			            &lt;br/&gt;
Graphics2D g2 = bufferedImage.createGraphics();&lt;br/&gt;
g2.setBackground(new Color(255,255,255,255));&lt;br/&gt;
g2.setColor(Color.red);&lt;br/&gt;
g2.drawString(&quot;HELLO&quot;, 20,20);&lt;/p&gt;


&lt;p&gt;Sorry about getImageIndexThingy().... That was for debugging/testing and is not used.&lt;/p&gt;
</comment>
                            <comment id="12876219" author="neilm" created="Mon, 7 Jun 2010 12:11:46 +0000"  >&lt;p&gt;Hi all,&lt;/p&gt;

&lt;p&gt;I&apos;ve been trying to get this to work too. In the meantime, here&apos;s a sample pdf that reproduces that issue (About Stacks.pdf).&lt;br/&gt;
The pdf is a single page with 5 embedded images. The images are rendered with black boxes as backgrounds instead of the correct (masked) transparency.&lt;/p&gt;

&lt;p&gt;If you look at the pdf file itself, you&apos;ll see that Indirect Object 6 0 defines 5 Image XObjects. The first one is &quot;Im2&quot; which is Indirect Object 9 0.&lt;br/&gt;
Ind .Obj 9 0 is an image which has a stream of image content (Jpeg, I think).&lt;br/&gt;
It also defines a ColorSpace (I.O. 17 0. ICCBased with 3 colour components) and an SMask field, which points to another image object (25 0) and it is this image which is the soft mask data i.e. the transparency data.&lt;/p&gt;

&lt;p&gt;This pattern is repeated for each image in the document. i.e. each image has an associated mask image.&lt;/p&gt;</comment>
                            <comment id="12877158" author="lehmi" created="Wed, 9 Jun 2010 18:17:17 +0000"  >&lt;p&gt;@Neil&lt;br/&gt;
I guess there is a missunderstanding. Yonas patch improves the creation of images with tranparency within a pdf. It doesn&apos;t fix the rendering issue with transparency. I&apos;ve moved your sample pdf to &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-323&quot; title=&quot;Images with transparency are not rendered correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-323&quot;&gt;&lt;del&gt;PDFBOX-323&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ve added the patch with version 953104.&lt;/p&gt;

&lt;p&gt;Thanks to Yonas for the contribution.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12391357">PDFBOX-323</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12446482" name="About Stacks.pdf" size="638283" author="neilm" created="Mon, 7 Jun 2010 12:11:46 +0000"/>
                            <attachment id="12418739" name="PDJpeg.java" size="13625" author="yonas.jongkind@gmail.com" created="Sun, 6 Sep 2009 07:13:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163299</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 24 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zj53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>205403</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>