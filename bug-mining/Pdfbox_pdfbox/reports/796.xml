<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:58:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2447] &quot;Cannot save a document which has been closed&quot; when encrypting</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2447</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;InputStream content = ...;&lt;br/&gt;
                    int keyLength = 256;&lt;br/&gt;
                    AccessPermission ap = new AccessPermission();&lt;br/&gt;
                    StandardProtectionPolicy spp = new StandardProtectionPolicy(&lt;br/&gt;
                            symmPw, symmPw, ap);&lt;br/&gt;
                    spp.setEncryptionKeyLength(keyLength);&lt;br/&gt;
                    document.protect(spp);&lt;br/&gt;
                    ByteArrayOutputStream baos = new ByteArrayOutputStream();&lt;br/&gt;
                    document.save(baos);&lt;/p&gt;

&lt;p&gt;in the save() the above mentioned exception is thrown (wasn&apos;t with the 2013-11 snapshot)&lt;/p&gt;</description>
                <environment>java7 deb7</environment>
        <key id="12750048">PDFBOX-2447</key>
            <summary>&quot;Cannot save a document which has been closed&quot; when encrypting</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="hauser@acm.org">Ralf Hauser</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Oct 2014 13:03:51 +0000</created>
                <updated>Thu, 17 Mar 2016 19:07:31 +0000</updated>
                            <resolved>Fri, 24 Oct 2014 19:00:49 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14181306" author="hauser@acm.org" created="Thu, 23 Oct 2014 13:05:56 +0000"  >&lt;p&gt;it turns out that if I do an unmotivated&lt;/p&gt;

&lt;p&gt;                    PDDocumentCatalog cat = document.getDocumentCatalog();&lt;/p&gt;

&lt;p&gt;before the save(), it doesn&apos;t happen.&lt;/p&gt;

&lt;p&gt;Apparently, the &lt;br/&gt;
   PDDocument.documentCatalog&lt;br/&gt;
is no longer initialized...&lt;/p&gt;</comment>
                            <comment id="14181486" author="tilman" created="Thu, 23 Oct 2014 15:48:51 +0000"  >&lt;p&gt;I&apos;m afraid that this won&apos;t work, what if the user did really close the document? I didn&apos;t test it, but from looking at the source code, I&apos;d expect an NPE.&lt;/p&gt;</comment>
                            <comment id="14181510" author="hauser@acm.org" created="Thu, 23 Oct 2014 16:08:39 +0000"  >&lt;p&gt;good point, but I guess the patch works with a minor enhancment as per patch2447a.txt&lt;/p&gt;</comment>
                            <comment id="14181763" author="jahewson" created="Thu, 23 Oct 2014 18:49:45 +0000"  >&lt;p&gt;Some feedback: please don&apos;t use backwards conditionals in patches, e.g. in the PDFBox source we don&apos;t write:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;if (null == getDocumentCatalog())&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;but always:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;if (getDocumentCatalog() == null)&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;The same applies to &lt;tt&gt;null != document&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14182424" author="hauser@acm.org" created="Fri, 24 Oct 2014 04:33:53 +0000"  >&lt;p&gt;Fine, order changed in patch2447b.txt&lt;/p&gt;

&lt;p&gt;Please committ&lt;/p&gt;</comment>
                            <comment id="14182491" author="tilman" created="Fri, 24 Oct 2014 06:28:32 +0000"  >&lt;p&gt;With your change, it would no longer do what the javadoc says: &quot;This will get the document CATALOG. This is guaranteed to not return null&quot;&lt;/p&gt;</comment>
                            <comment id="14182512" author="hauser@acm.org" created="Fri, 24 Oct 2014 07:04:58 +0000"  >&lt;p&gt;sure, but shouldn&apos;t the javadoc then also say that if used when the document is already closed, you will get a NullPointer?&lt;/p&gt;</comment>
                            <comment id="14183005" author="tilman" created="Fri, 24 Oct 2014 16:23:00 +0000"  >&lt;p&gt;Well, I could add to the javadoc not to call it if the document has been closed.&lt;/p&gt;

&lt;p&gt;The problem with getDocumentCatalog() isn&apos;t easy. I also thought about adding it to protect(), but that one doesn&apos;t do anything with the document itself at that time. My old thought to call getDocumentCatalog() in load() and loadNonSeq() is probably also wrong, because the PDF could be encrypted and have the objects in an object stream.&lt;/p&gt;

&lt;p&gt;My current thought is to change save() so that it checks document for null and not documentCatalog. But I wonder why this wasn&apos;t done in the first place, maybe there was a reason? (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1926&quot; title=&quot;Document.save() after Document.close() causes Null Pointer Exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1926&quot;&gt;&lt;del&gt;PDFBOX-1926&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="14183280" author="jahewson" created="Fri, 24 Oct 2014 18:56:26 +0000"  >&lt;p&gt;There was no special reason for choosing documentCatalog, it looks like document would have been a far better choice.&lt;/p&gt;</comment>
                            <comment id="14183285" author="jira-bot" created="Fri, 24 Oct 2014 18:59:17 +0000"  >&lt;p&gt;Commit 1634119 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1634119&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1634119&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2447&quot; title=&quot;&amp;quot;Cannot save a document which has been closed&amp;quot; when encrypting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2447&quot;&gt;&lt;del&gt;PDFBOX-2447&lt;/del&gt;&lt;/a&gt;: better check to detect closed document&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12727290">PDFBOX-2206</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12737152">PDFBOX-2292</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12695947">PDFBOX-1926</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12676574" name="patch2447.txt" size="635" author="hauser@acm.org" created="Thu, 23 Oct 2014 13:05:56 +0000"/>
                            <attachment id="12676611" name="patch2447a.txt" size="966" author="hauser@acm.org" created="Thu, 23 Oct 2014 16:08:39 +0000"/>
                            <attachment id="12676834" name="patch2447b.txt" size="966" author="hauser@acm.org" created="Fri, 24 Oct 2014 04:33:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21hsv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>