<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:09:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4636] &quot;There has been a widget with a missing page reference&quot; and non widget annotation gets flattened</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4636</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I get this when attempting to flatten the attached file (which is an &quot;improved&quot; version of the file from the linked issue)&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;26.08.2019 18:41:00.354 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; org.apache.pdfbox.pdmodel.interactive.form.PDAcroForm:853 - There has been a widget with a missing page reference. Please report to the PDFBox project&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;The intention is to &quot;preserve all non widget annotations&quot;. This code reproduces the problem:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
PDDocument doc = PDDocument.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;PDFBOX-4636.pdf&quot;&lt;/span&gt;));
List&amp;lt;PDAnnotation&amp;gt; annotations = doc.getPage(0).getAnnotations();
PDColor red = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDColor(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;[] { 1, 0, 0 }, PDDeviceRGB.INSTANCE);
PDColor blue = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDColor(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;[] { 0, 0, 1 }, PDDeviceRGB.INSTANCE);
PDAnnotationCircle circleAnnotation = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDAnnotationCircle();
circleAnnotation.setContents(&lt;span class=&quot;code-quote&quot;&gt;&quot;Circle Annotation&quot;&lt;/span&gt;);
circleAnnotation.setInteriorColor(red);
circleAnnotation.setColor(blue);
circleAnnotation.setRectangle(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDRectangle(100, 700, 100, 50));
circleAnnotation.setPage(doc.getPage(0));
circleAnnotation.constructAppearances();
annotations.add(circleAnnotation);
doc.save(&lt;span class=&quot;code-quote&quot;&gt;&quot;PDFBOX-4636-annotated.pdf&quot;&lt;/span&gt;);

doc.getDocumentCatalog().getAcroForm().flatten();
doc.save(&lt;span class=&quot;code-quote&quot;&gt;&quot;PDFBOX-4636-flattened-bad.pdf&quot;&lt;/span&gt;);
doc.close();

doc = PDDocument.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;PDFBOX-4636-annotatedAP.pdf&quot;&lt;/span&gt;)); &lt;span class=&quot;code-comment&quot;&gt;// PDFBOX-4636-annotated.pdf opened with Adobe and saved
&lt;/span&gt;doc.getDocumentCatalog().getAcroForm().flatten();
doc.save(&lt;span class=&quot;code-quote&quot;&gt;&quot;PDFBOX-4636-flattened-good.pdf&quot;&lt;/span&gt;);
doc.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;what should have happened: result file &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4636&quot; title=&quot;&amp;quot;There has been a widget with a missing page reference&amp;quot; and non widget annotation gets flattened&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4636&quot;&gt;&lt;del&gt;PDFBOX-4636&lt;/del&gt;&lt;/a&gt;-flattened-good.pdf has 1 annotation.&lt;/p&gt;

&lt;p&gt;what happened instead: result file has &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4636&quot; title=&quot;&amp;quot;There has been a widget with a missing page reference&amp;quot; and non widget annotation gets flattened&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4636&quot;&gt;&lt;del&gt;PDFBOX-4636&lt;/del&gt;&lt;/a&gt;-flattened-bad.pdf no annotation, because the circle annotation has been flattened as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13253082">PDFBOX-4636</key>
            <summary>&quot;There has been a widget with a missing page reference&quot; and non widget annotation gets flattened</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Aug 2019 16:44:49 +0000</created>
                <updated>Tue, 30 Jun 2020 06:13:33 +0000</updated>
                            <resolved>Thu, 29 Aug 2019 16:50:31 +0000</resolved>
                                    <version>2.0.16</version>
                                    <fixVersion>2.0.17</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>AcroForm</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16918760" author="jira-bot" created="Thu, 29 Aug 2019 16:27:07 +0000"  >&lt;p&gt;Commit 1866082 from Tilman Hausherr in branch &apos;pdfbox/branches/issue4569&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1866082&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1866082&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4636&quot; title=&quot;&amp;quot;There has been a widget with a missing page reference&amp;quot; and non widget annotation gets flattened&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4636&quot;&gt;&lt;del&gt;PDFBOX-4636&lt;/del&gt;&lt;/a&gt;: build map of widget annotations from the pages if a widget annotation has no /P entry&lt;/p&gt;</comment>
                            <comment id="16918761" author="jira-bot" created="Thu, 29 Aug 2019 16:27:11 +0000"  >&lt;p&gt;Commit 1866083 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1866083&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1866083&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4636&quot; title=&quot;&amp;quot;There has been a widget with a missing page reference&amp;quot; and non widget annotation gets flattened&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4636&quot;&gt;&lt;del&gt;PDFBOX-4636&lt;/del&gt;&lt;/a&gt;: build map of widget annotations from the pages if a widget annotation has no /P entry&lt;/p&gt;</comment>
                            <comment id="16918762" author="jira-bot" created="Thu, 29 Aug 2019 16:27:17 +0000"  >&lt;p&gt;Commit 1866084 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1866084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1866084&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4636&quot; title=&quot;&amp;quot;There has been a widget with a missing page reference&amp;quot; and non widget annotation gets flattened&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4636&quot;&gt;&lt;del&gt;PDFBOX-4636&lt;/del&gt;&lt;/a&gt;: build map of widget annotations from the pages if a widget annotation has no /P entry&lt;/p&gt;</comment>
                            <comment id="16918763" author="jira-bot" created="Thu, 29 Aug 2019 16:27:22 +0000"  >&lt;p&gt;Commit 1866085 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1866085&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1866085&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4636&quot; title=&quot;&amp;quot;There has been a widget with a missing page reference&amp;quot; and non widget annotation gets flattened&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4636&quot;&gt;&lt;del&gt;PDFBOX-4636&lt;/del&gt;&lt;/a&gt;: build map of widget annotations from the pages if a widget annotation has no /P entry&lt;/p&gt;</comment>
                            <comment id="16918765" author="jira-bot" created="Thu, 29 Aug 2019 16:36:12 +0000"  >&lt;p&gt;Commit 1866086 from Tilman Hausherr in branch &apos;pdfbox/branches/issue4569&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1866086&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1866086&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4636&quot; title=&quot;&amp;quot;There has been a widget with a missing page reference&amp;quot; and non widget annotation gets flattened&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4636&quot;&gt;&lt;del&gt;PDFBOX-4636&lt;/del&gt;&lt;/a&gt;: add &quot;previously failing&quot; test&lt;/p&gt;</comment>
                            <comment id="16918766" author="jira-bot" created="Thu, 29 Aug 2019 16:36:17 +0000"  >&lt;p&gt;Commit 1866087 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1866087&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1866087&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4636&quot; title=&quot;&amp;quot;There has been a widget with a missing page reference&amp;quot; and non widget annotation gets flattened&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4636&quot;&gt;&lt;del&gt;PDFBOX-4636&lt;/del&gt;&lt;/a&gt;: add &quot;previously failing&quot; test&lt;/p&gt;</comment>
                            <comment id="16918767" author="jira-bot" created="Thu, 29 Aug 2019 16:36:22 +0000"  >&lt;p&gt;Commit 1866088 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1866088&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1866088&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4636&quot; title=&quot;&amp;quot;There has been a widget with a missing page reference&amp;quot; and non widget annotation gets flattened&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4636&quot;&gt;&lt;del&gt;PDFBOX-4636&lt;/del&gt;&lt;/a&gt;: add &quot;previously failing&quot; test&lt;/p&gt;</comment>
                            <comment id="16918768" author="jira-bot" created="Thu, 29 Aug 2019 16:36:27 +0000"  >&lt;p&gt;Commit 1866089 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1866089&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1866089&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4636&quot; title=&quot;&amp;quot;There has been a widget with a missing page reference&amp;quot; and non widget annotation gets flattened&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4636&quot;&gt;&lt;del&gt;PDFBOX-4636&lt;/del&gt;&lt;/a&gt;: add &quot;previously failing&quot; test&lt;/p&gt;</comment>
                            <comment id="16918857" author="jira-bot" created="Thu, 29 Aug 2019 18:37:04 +0000"  >&lt;p&gt;Commit 1866094 from Tilman Hausherr in branch &apos;pdfbox/branches/issue4569&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1866094&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1866094&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4636&quot; title=&quot;&amp;quot;There has been a widget with a missing page reference&amp;quot; and non widget annotation gets flattened&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4636&quot;&gt;&lt;del&gt;PDFBOX-4636&lt;/del&gt;&lt;/a&gt;: refactor by replacing Map with Set&lt;/p&gt;</comment>
                            <comment id="16918858" author="jira-bot" created="Thu, 29 Aug 2019 18:37:09 +0000"  >&lt;p&gt;Commit 1866095 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1866095&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1866095&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4636&quot; title=&quot;&amp;quot;There has been a widget with a missing page reference&amp;quot; and non widget annotation gets flattened&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4636&quot;&gt;&lt;del&gt;PDFBOX-4636&lt;/del&gt;&lt;/a&gt;: refactor by replacing Map with Set&lt;/p&gt;</comment>
                            <comment id="16918859" author="jira-bot" created="Thu, 29 Aug 2019 18:37:15 +0000"  >&lt;p&gt;Commit 1866096 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1866096&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1866096&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4636&quot; title=&quot;&amp;quot;There has been a widget with a missing page reference&amp;quot; and non widget annotation gets flattened&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4636&quot;&gt;&lt;del&gt;PDFBOX-4636&lt;/del&gt;&lt;/a&gt;: refactor by replacing Map with Set&lt;/p&gt;</comment>
                            <comment id="16918860" author="jira-bot" created="Thu, 29 Aug 2019 18:37:20 +0000"  >&lt;p&gt;Commit 1866097 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1866097&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1866097&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4636&quot; title=&quot;&amp;quot;There has been a widget with a missing page reference&amp;quot; and non widget annotation gets flattened&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4636&quot;&gt;&lt;del&gt;PDFBOX-4636&lt;/del&gt;&lt;/a&gt;: refactor by replacing Map with Set&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12955213">PDFBOX-3301</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12978604" name="PDFBOX-4636.pdf" size="934441" author="tilman" created="Mon, 26 Aug 2019 16:45:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://github.com/TomRoush/PdfBox-Android/issues/197]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 11 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z061tc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>