<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:11:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5151] Issue with COSObjectKey::fixGeneration</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5151</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I think, I&apos;ve just found a little bug within &lt;br/&gt;
COSParser::validateXrefOffsets, which occures when a xref generation is &lt;br/&gt;
corrected using COSObjectKey::fixGeneration. &lt;/p&gt;

&lt;p&gt;The issue is, that COSObjectKey is used as a hash-key and this instance &lt;br/&gt;
is modified with fixGeneration. &lt;br/&gt;
Because of this modification, the hasCode of the COSObjectKey is changed &lt;br/&gt;
and the associated hashmap entry cannot longer be found in the xrefTable. &lt;br/&gt;
Hashmap key objects should better be immutabel (see &lt;br/&gt;
&lt;a href=&quot;https://howtodoinjava.com/java/collections/hashmap/design-good-key-for-hashmap/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://howtodoinjava.com/java/collections/hashmap/design-good-key-for-hashmap/&lt;/a&gt;) &lt;br/&gt;
According to the change history, this issue was introduced with a commit &lt;br/&gt;
for &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4153&quot; title=&quot;Outlines missing in some versions, not in others&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4153&quot;&gt;&lt;del&gt;PDFBOX-4153&lt;/del&gt;&lt;/a&gt;, but &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4490&quot; title=&quot;.getNumberofPages() returns incorrect value&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4490&quot;&gt;&lt;del&gt;PDFBOX-4490&lt;/del&gt;&lt;/a&gt; seems also be related.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Attached patch-file contains bot, the bugfix and the proposed optimization within COSObjectKey.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13369607">PDFBOX-5151</key>
            <summary>Issue with COSObjectKey::fixGeneration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="rolandmeub">Roland Meub</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Apr 2021 15:46:47 +0000</created>
                <updated>Fri, 11 Jun 2021 06:08:23 +0000</updated>
                            <resolved>Thu, 3 Jun 2021 17:59:17 +0000</resolved>
                                    <version>2.0.23</version>
                    <version>3.0.3 JBIG2</version>
                                    <fixVersion>2.0.24</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Parsing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17338004" author="jira-bot" created="Sun, 2 May 2021 12:39:28 +0000"  >&lt;p&gt;Commit 1889401 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1889401&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1889401&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5151&quot; title=&quot;Issue with COSObjectKey::fixGeneration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5151&quot;&gt;&lt;del&gt;PDFBOX-5151&lt;/del&gt;&lt;/a&gt;: make generation number final to ensure an immutable hashcode as proposed by Roland Meub&lt;/p&gt;</comment>
                            <comment id="17338006" author="jira-bot" created="Sun, 2 May 2021 12:45:43 +0000"  >&lt;p&gt;Commit 1889403 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1889403&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1889403&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5151&quot; title=&quot;Issue with COSObjectKey::fixGeneration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5151&quot;&gt;&lt;del&gt;PDFBOX-5151&lt;/del&gt;&lt;/a&gt;: fix javadoc&lt;/p&gt;</comment>
                            <comment id="17338008" author="jira-bot" created="Sun, 2 May 2021 12:59:33 +0000"  >&lt;p&gt;Commit 1889404 from lehmi@apache.org in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1889404&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1889404&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5151&quot; title=&quot;Issue with COSObjectKey::fixGeneration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5151&quot;&gt;&lt;del&gt;PDFBOX-5151&lt;/del&gt;&lt;/a&gt;: deprecate fixGeneration to ensure an immutable hashcode as proposed by Roland Meub&lt;/p&gt;</comment>
                            <comment id="17350009" author="jira-bot" created="Sun, 23 May 2021 10:54:23 +0000"  >&lt;p&gt;Commit 1890133 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1890133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1890133&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5151&quot; title=&quot;Issue with COSObjectKey::fixGeneration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5151&quot;&gt;&lt;del&gt;PDFBOX-5151&lt;/del&gt;&lt;/a&gt;: optimize internal representation of an object key based on a proposal by Roland Meub&lt;/p&gt;</comment>
                            <comment id="17350016" author="lehmi" created="Sun, 23 May 2021 11:22:21 +0000"  >&lt;p&gt;I&apos;ve overhauled the proposed optimization as it didn&apos;t work in some cases and I&apos;ve committed it to the trunk only.&lt;/p&gt;</comment>
                            <comment id="17353368" author="jira-bot" created="Fri, 28 May 2021 13:53:54 +0000"  >&lt;p&gt;Commit 1890283 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1890283&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1890283&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5151&quot; title=&quot;Issue with COSObjectKey::fixGeneration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5151&quot;&gt;&lt;del&gt;PDFBOX-5151&lt;/del&gt;&lt;/a&gt;: sonar fix&lt;/p&gt;</comment>
                            <comment id="17355925" author="tilman" created="Wed, 2 Jun 2021 18:58:35 +0000"  >&lt;p&gt;r1890133 brings a rendering difference on the file of &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3919&quot; title=&quot;Infinite loop while parsing (2)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3919&quot;&gt;&lt;del&gt;PDFBOX-3919&lt;/del&gt;&lt;/a&gt; ( &lt;a href=&quot;https://launchpadlibrarian.net/77139826/loop_edited.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://launchpadlibrarian.net/77139826/loop_edited.pdf&lt;/a&gt; ), before it was showing &quot;bar&quot;, now it&apos;s showing &quot;foo&quot; (I don&apos;t know why I didn&apos;t notice this earlier). This happens only in the trunk, not in 2.0.&lt;/p&gt;</comment>
                            <comment id="17355954" author="lehmi" created="Wed, 2 Jun 2021 21:11:29 +0000"  >&lt;p&gt;There are several updated objects and obviously those are ignored, I&apos;ll have a look&lt;/p&gt;</comment>
                            <comment id="17356390" author="lehmi" created="Thu, 3 Jun 2021 12:06:47 +0000"  >&lt;p&gt;Added manually, as I mixed up the JIRA tickets&lt;/p&gt;

&lt;p&gt;Commit 1890422 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1890422&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1890422&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5151&quot; title=&quot;Issue with COSObjectKey::fixGeneration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5151&quot;&gt;&lt;del&gt;PDFBOX-5151&lt;/del&gt;&lt;/a&gt;: flip number and generation number within the internal representation to ensure the expected sorting order for object keys (compare object numbers first and take the generation numbers into account if they are equal)&lt;/p&gt;</comment>
                            <comment id="17356392" author="lehmi" created="Thu, 3 Jun 2021 12:11:27 +0000"  >&lt;p&gt;Digging deeper into this reveals an issue with the sorting order of COSObjectKey, but it isn&apos;t the root cause for the described issue, see my last commit&lt;/p&gt;

&lt;p&gt;BTW, the issue doesn&apos;t go away if I simply revert the changes of r1890133. The order of the objects within some of the maps seems relevant and as those maps aren&apos;t ordered at all it is works/fails by accident. I&apos;m working on that&lt;/p&gt;</comment>
                            <comment id="17356440" author="jira-bot" created="Thu, 3 Jun 2021 13:44:42 +0000"  >&lt;p&gt;Commit 1890428 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1890428&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1890428&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5151&quot; title=&quot;Issue with COSObjectKey::fixGeneration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5151&quot;&gt;&lt;del&gt;PDFBOX-5151&lt;/del&gt;&lt;/a&gt;: try to determine the newest version of an object if a search found more than one variation&lt;/p&gt;</comment>
                            <comment id="17356493" author="jira-bot" created="Thu, 3 Jun 2021 14:54:08 +0000"  >&lt;p&gt;Commit 1890429 from lehmi@apache.org in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1890429&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1890429&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5151&quot; title=&quot;Issue with COSObjectKey::fixGeneration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5151&quot;&gt;&lt;del&gt;PDFBOX-5151&lt;/del&gt;&lt;/a&gt;: try to determine the newest version of an object if a search found more than one variation&lt;/p&gt;</comment>
                            <comment id="17356494" author="lehmi" created="Thu, 3 Jun 2021 14:54:39 +0000"  >&lt;p&gt;The changes of this ticket didn&apos;t introduce the issue Tilman found but obviously they somehow reveal an issue with the brute force parser. When rebuilding the trailer information the parser doesn&apos;t take the order of the parsed objects into account. Accidentally it works in some environments, but it it fails in others as an outdated object overwrote a newer one. I&apos;ve overhauled the code so that an older object can&apos;t overwrite a new one any more.&lt;/p&gt;</comment>
                            <comment id="17356593" author="tilman" created="Thu, 3 Jun 2021 17:11:30 +0000"  >&lt;p&gt;Rendering works fine now.&lt;/p&gt;</comment>
                            <comment id="17356629" author="lehmi" created="Thu, 3 Jun 2021 17:59:17 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; set resolved again&lt;/p&gt;</comment>
                            <comment id="17357480" author="mkl" created="Fri, 4 Jun 2021 16:52:24 +0000"  >&lt;p&gt;Strictly speaking, if this is about the behavior of a &lt;em&gt;repaired&lt;/em&gt; PDF, results &lt;b&gt;may differ&lt;/b&gt;, there may be no right or wrong option sometimes.&lt;/p&gt;

&lt;p&gt;E.g. a newer xref table could again address an earlier object after some in-between xref addressed a newer one. Or a newer object might never have been addressed.&lt;/p&gt;</comment>
                            <comment id="17357493" author="lehmi" created="Fri, 4 Jun 2021 17:09:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkl&quot; class=&quot;user-hover&quot; rel=&quot;mkl&quot;&gt;mkl&lt;/a&gt; You are right, if we are in a repair modus every thing be true or false. But if we implement some kind of rule the behaviour should be deterministic. The affected part of code worked as intended by accident and didn&apos;t worked under, to me unknown, circumstances, maybe some 2.0 vs 3.0 thing. However, I&apos;ve fixed that and the code should work now under any circumstances.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13023409" name="pdfbox-fixGeneration-bugfix.patch" size="7470" author="rolandmeub" created="Mon, 5 Apr 2021 15:44:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0pjcw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>