<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:53:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1185] A problem with indexed color spaces: bpc of the base color space seems wrong.</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1185</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I incorporated the &quot;proper&quot; solution to &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1075&quot; title=&quot;Can&amp;#39;t get images from a PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1075&quot;&gt;&lt;del&gt;PDFBOX-1075&lt;/del&gt;&lt;/a&gt; into my regression tests and the file which made me raise that issue got broken again. It has pictures with indexed color spaces, which now are returned as black. The indexed color space is one-bit. The lookup table has two colors: black and white. With the current trunk, the black pixels remain black (0,0,0), but the white pixels are returned as (1,1,1), which in RGB is nearly just as black. The text on the picture is obviously unreadable.&lt;/p&gt;

&lt;p&gt;On a second look it seems to me that the offending line is here (in PDPixelMap.getRGBImage):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ColorModel baseColorModel = csIndexed.getBaseColorSpace().createColorModel(bpc);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think it&apos;s wrong, as in an indexed color space, &quot;bpc&quot; is not &quot;bits per component&quot;, but &quot;bits per index&quot; i.e. bits per the integer which is interpreted as the index to the color lookup array. I think that the base color space&apos;s color model should be initialized with a different number. I came up with a following calculation:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;PDIndexed csIndexed = (PDIndexed)colorspace;
PDColorSpace baseCs = csIndexed.getBaseColorSpace();
int numberOfColorValues = 1 &amp;lt;&amp;lt; bpc;
int highValue = csIndexed.getHighValue();
int size = Math.min(numberOfColorValues-1, highValue);
byte[] index = csIndexed.getLookupData();
int parentComponentsCount = baseCs.getNumberOfComponents();
int baseColorModelBPC = (index.length * 8) / ((size+1) * parentComponentsCount);
ColorModel baseColorModel = csIndexed.getBaseColorSpace().createColorModel(baseColorModelBPC);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The baseColorModelBPC is calculated as the total number of bits in the lookup array divided by the total number of components in all colors. This seems to work for my offending file and causes no regressions with files from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1075&quot; title=&quot;Can&amp;#39;t get images from a PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1075&quot;&gt;&lt;del&gt;PDFBOX-1075&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1010&quot; title=&quot;Image printed with colors inverted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1010&quot;&gt;&lt;del&gt;PDFBOX-1010&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-706&quot; title=&quot;CFFParser.readCharset  java.lang.IllegalArgumentException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-706&quot;&gt;&lt;del&gt;PDFBOX-706&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;What is weird though is a line which is later:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;byte[] inData = new byte[baseColorModel.getNumComponents()];
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Doesn&apos;t this effectively assume that baseColorModelBPC should always be 8? If the base color model bpc were anything else than 8, then this code wouldn&apos;t be able to handle it correctly anyway. Or am I overlooking something? &lt;/p&gt;

&lt;p&gt;I&apos;ll attach a patch which works for me. Note that simply changing &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ColorModel baseColorModel = csIndexed.getBaseColorSpace().createColorModel(bpc);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;into&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ColorModel baseColorModel = csIndexed.getBaseColorSpace().createColorModel(8);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;has exactly the same effect (fixed my problem, no regressions in those three earlier issues). Please decide what makes more sense.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12534061">PDFBOX-1185</key>
            <summary>A problem with indexed color spaces: bpc of the base color space seems wrong.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="antoni.mylka">Antoni Mylka</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Dec 2011 17:34:38 +0000</created>
                <updated>Tue, 29 May 2012 16:21:45 +0000</updated>
                            <resolved>Tue, 10 Apr 2012 16:34:09 +0000</resolved>
                                    <version>1.7.0</version>
                                    <fixVersion>1.7.0</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13163711" author="antoni.mylka" created="Tue, 6 Dec 2011 17:35:31 +0000"  >&lt;p&gt;Attached a patch. Simply putting 8 instead of bpc in that method seems to work just as well. Please decide.&lt;/p&gt;</comment>
                            <comment id="13163798" author="lehmi" created="Tue, 6 Dec 2011 20:20:58 +0000"  >&lt;p&gt;Can you please attach the pdf in question?&lt;/p&gt;</comment>
                            <comment id="13167582" author="antheque" created="Mon, 12 Dec 2011 16:38:34 +0000"  >&lt;p&gt;Sorry I can&apos;t, it&apos;s confidential. I&apos;ll try to find a public one. &lt;/p&gt;</comment>
                            <comment id="13168177" author="lehmi" created="Tue, 13 Dec 2011 06:53:49 +0000"  >&lt;p&gt;Maybe it&apos;s enough to have a look at the contents of the XObject dictionary? Can you attach a screenshot (using PDFDebugger) or code-snippet (using WriteDecodeDoc) of it to this issue, please?&lt;/p&gt;</comment>
                            <comment id="13173232" author="antheque" created="Tue, 20 Dec 2011 14:54:44 +0000"  >&lt;p&gt;The file in question has 25 pages. It contains some images. The images I mean are on page 11. They are all parts of a scanned page with some text. In Adobe Reader they look like a single image of the entire page. &lt;/p&gt;

&lt;p&gt;The image I attach comes from iText RUPS. The object tree starting at page11.&lt;/p&gt;

&lt;p&gt;The output from WriteDecodedDoc looks like this:&lt;/p&gt;

&lt;p&gt;116 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/Type /XObject&lt;br/&gt;
/Subtype /Image&lt;br/&gt;
/Name /im3&lt;br/&gt;
/Width 1910&lt;br/&gt;
/Height 505&lt;br/&gt;
/BitsPerComponent 1&lt;br/&gt;
/ColorSpace &lt;span class=&quot;error&quot;&gt;&amp;#91;/Indexed /DeviceRGB 1 166 0 R&amp;#93;&lt;/span&gt;&lt;br/&gt;
/Length 167 0 R&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
stream&lt;br/&gt;
&#729;&#729;&#729;&lt;br/&gt;
endstream&lt;br/&gt;
endobj&lt;br/&gt;
117 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/Type /XObject&lt;br/&gt;
/Subtype /Image&lt;br/&gt;
/Name /im4&lt;br/&gt;
/Width 1910&lt;br/&gt;
/Height 505&lt;br/&gt;
/BitsPerComponent 1&lt;br/&gt;
/ColorSpace &lt;span class=&quot;error&quot;&gt;&amp;#91;/Indexed /DeviceRGB 1 168 0 R&amp;#93;&lt;/span&gt;&lt;br/&gt;
/Length 169 0 R&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
stream&lt;br/&gt;
&#729;&#729;&#729;&lt;br/&gt;
endstream&lt;br/&gt;
endobj&lt;br/&gt;
118 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/Type /XObject&lt;br/&gt;
/Subtype /Image&lt;br/&gt;
/Name /im5&lt;br/&gt;
/Width 1910&lt;br/&gt;
/Height 505&lt;br/&gt;
/BitsPerComponent 1&lt;br/&gt;
/ColorSpace &lt;span class=&quot;error&quot;&gt;&amp;#91;/Indexed /DeviceRGB 1 170 0 R&amp;#93;&lt;/span&gt;&lt;br/&gt;
/Length 171 0 R&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
stream&lt;br/&gt;
&#729;&#729;&#729;&lt;br/&gt;
endstream&lt;br/&gt;
endobj&lt;br/&gt;
119 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/Type /XObject&lt;br/&gt;
/Subtype /Image&lt;br/&gt;
/Name /im6&lt;br/&gt;
/Width 1910&lt;br/&gt;
/Height 502&lt;br/&gt;
/BitsPerComponent 1&lt;br/&gt;
/ColorSpace &lt;span class=&quot;error&quot;&gt;&amp;#91;/Indexed /DeviceRGB 1 172 0 R&amp;#93;&lt;/span&gt;&lt;br/&gt;
/Length 173 0 R&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
stream&lt;br/&gt;
&#729;&#729;&#729;&lt;br/&gt;
endstream&lt;br/&gt;
endobj&lt;/p&gt;</comment>
                            <comment id="13175942" author="lehmi" created="Mon, 26 Dec 2011 14:45:43 +0000"  >&lt;p&gt;Antoni is correct: the used value was wrong and just accidently worked for the other examples. In that context bpc is meant to be bits per index and as according to the pdf specs the indexed values are in a range from 0 to 255 the bpc has to be 8. I fixed that in revision 1224733.&lt;/p&gt;

&lt;p&gt;@Antoni:&lt;br/&gt;
Please verify if the solution also works with your pdf.&lt;/p&gt;</comment>
                            <comment id="13250792" author="lehmi" created="Tue, 10 Apr 2012 16:34:09 +0000"  >&lt;p&gt;I never got an feedback, but I&apos;m pretty sure that this issue is fixed. Otherwise we&apos;ll simply reopen it.&lt;/p&gt;</comment>
                            <comment id="13251416" author="antoni.mylka" created="Wed, 11 Apr 2012 08:36:50 +0000"  >&lt;p&gt;O, sorry. Yes. It is fixed. It seems I overlooked the @Antoni message. Thanks very much.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12508084" name="page11.png" size="76350" author="antheque" created="Tue, 20 Dec 2011 14:54:44 +0000"/>
                            <attachment id="12506281" name="pdfbox-parentcsbpc.patch" size="5035" author="antoni.mylka" created="Tue, 6 Dec 2011 17:35:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>219787</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 32 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ziw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>205363</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>