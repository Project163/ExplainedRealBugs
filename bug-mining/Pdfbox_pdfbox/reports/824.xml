<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:58:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1036] FDFExport/Import gives strange results</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1036</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;1. Create a new, blank PDF in Acrobat.&lt;br/&gt;
2. Add a text form field and set the contents to &quot;some text&quot;.&lt;br/&gt;
3. Run ExportFDF and then ImportFDF on this file.&lt;/p&gt;

&lt;p&gt;The result is a messed-up text box. See the attached files.&lt;br/&gt;
Also I&apos;ve noticed that the FDF created by PDFBox is very different to the one created by Acrobat.&lt;/p&gt;

&lt;p&gt;Here&apos;s my code:&lt;br/&gt;
        ExportFDF.main(new String[]&lt;/p&gt;
{&quot;c:/gilad/input/test.pdf&quot;, &quot;c:/gilad/input/test.fdf&quot;}
&lt;p&gt;);&lt;br/&gt;
	ImportFDF.main(new String[]&lt;/p&gt;
{&quot;c:/gilad/input/test.pdf&quot;, &quot;c:/gilad/input/test.fdf&quot;, &quot;c:/gilad/input/result.pdf&quot;}
&lt;p&gt;);&lt;/p&gt;</description>
                <environment>Windows 7, Acrobat Pro 9.4.4, Eclipse Helios SR2</environment>
        <key id="12509802">PDFBOX-1036</key>
            <summary>FDFExport/Import gives strange results</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="msahyoun">Maruan Sahyoun</assignee>
                                    <reporter username="giladd">Gilad Denneboom</reporter>
                        <labels>
                            <label>AcroForm</label>
                            <label>Appearance</label>
                            <label>FDF</label>
                    </labels>
                <created>Fri, 10 Jun 2011 08:04:28 +0000</created>
                <updated>Sat, 13 Dec 2014 14:14:55 +0000</updated>
                            <resolved>Mon, 3 Nov 2014 11:47:58 +0000</resolved>
                                    <version>1.8.7</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.8.8</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14193069" author="lehmi" created="Sat, 1 Nov 2014 10:29:54 +0000"  >&lt;p&gt;The trunk shows a similar issue as already described in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1574&quot; title=&quot;ImportFDF fails to do anything&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1574&quot;&gt;&lt;del&gt;PDFBOX-1574&lt;/del&gt;&lt;/a&gt;. The 1.8-branch is able to import the fdf data, but still produces the described messed up text box. I looks like the old value isn&apos;t deleted before setting the new one.&lt;/p&gt;</comment>
                            <comment id="14193130" author="jira-bot" created="Sat, 1 Nov 2014 12:41:22 +0000"  >&lt;p&gt;Commit 1635942 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1635942&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1635942&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1036&quot; title=&quot;FDFExport/Import gives strange results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1036&quot;&gt;&lt;del&gt;PDFBOX-1036&lt;/del&gt;&lt;/a&gt;: avoid an endless recursion&lt;/p&gt;</comment>
                            <comment id="14193132" author="lehmi" created="Sat, 1 Nov 2014 12:42:44 +0000"  >&lt;p&gt;I&apos;ve fixed the trunk-only exception. PDAppearanceString#getStreamTokens ran into an endless recursion.&lt;/p&gt;</comment>
                            <comment id="14193171" author="jira-bot" created="Sat, 1 Nov 2014 13:57:12 +0000"  >&lt;p&gt;Commit 1635948 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1635948&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1635948&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1036&quot; title=&quot;FDFExport/Import gives strange results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1036&quot;&gt;&lt;del&gt;PDFBOX-1036&lt;/del&gt;&lt;/a&gt;: replace the first part of a multipart text only, reuse font size of an existing appearance stream&lt;/p&gt;</comment>
                            <comment id="14193173" author="jira-bot" created="Sat, 1 Nov 2014 13:57:22 +0000"  >&lt;p&gt;Commit 1635949 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/branches/1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1635949&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1635949&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1036&quot; title=&quot;FDFExport/Import gives strange results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1036&quot;&gt;&lt;del&gt;PDFBOX-1036&lt;/del&gt;&lt;/a&gt;: replace the first part of a multipart text only, reuse font size of an existing appearance stream&lt;/p&gt;</comment>
                            <comment id="14193180" author="lehmi" created="Sat, 1 Nov 2014 14:06:39 +0000"  >&lt;p&gt;There were 2 issues to be solved:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the existing text consists of two parts within the appearance stream and the code replaces both with the new value. Now only the first one is replace and the remaining parts are skipped&lt;/li&gt;
	&lt;li&gt;calculateFontSize reuses only the font size of the default appearance stream (which isn&apos;t passed in that case) and it leaves the exisiting stream alone. Now the font size of an existing appearance value is used&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14193949" author="msahyoun" created="Sun, 2 Nov 2014 18:40:27 +0000"  >&lt;p&gt;Unfortunately r1635949 introduced a regression.&lt;/p&gt;</comment>
                            <comment id="14193951" author="msahyoun" created="Sun, 2 Nov 2014 18:44:43 +0000"  >&lt;p&gt;There is a regression in the appearance generation when calculating the font size. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tokens != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        {
            &lt;span class=&quot;code-comment&quot;&gt;// reuse the fontsize of an existing apperance stream
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; fontIndex = tokens.indexOf(PDFOperator.getOperator(&lt;span class=&quot;code-quote&quot;&gt;&quot;Tf&quot;&lt;/span&gt;));
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fontIndex != -1)
            {
                fontSize = ((COSNumber) tokens.get(fontIndex - 1)).floatValue();
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (daTokens != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        {
            &lt;span class=&quot;code-comment&quot;&gt;// daString looks like &quot;BMC /&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If there is an appearance stream tokens != null but the tokens might not contain a font setting. Because of else if (daTokens &#8230;) the default appearance value is only read if there is no appearance stream regardless of a font setting being made in the current appearance stream.&lt;/p&gt;

&lt;p&gt;This might happen e.g. if there is an empty field with a border around it.&lt;/p&gt;

</comment>
                            <comment id="14193968" author="msahyoun" created="Sun, 2 Nov 2014 19:20:51 +0000"  >&lt;p&gt;Reusing the font size of an existing appearance stream is not correct. The font size shall&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;either be taken from the DA entry or&lt;/li&gt;
	&lt;li&gt;calculated if the DA entry has a font size of 0 i.e. scale to fit the text&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14194015" author="lehmi" created="Sun, 2 Nov 2014 20:53:41 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Reusing the font size of an existing appearance stream is not correct.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The font size calculation doesn&apos;t work with the attached files without reusing the existing appearance. It&apos;s way too big, as far as I remember 12 vs. 38&lt;/p&gt;</comment>
                            <comment id="14194022" author="msahyoun" created="Sun, 2 Nov 2014 21:05:25 +0000"  >&lt;p&gt;OK - I&#8217;ll take a look&lt;/p&gt;</comment>
                            <comment id="14194062" author="lehmi" created="Sun, 2 Nov 2014 22:28:18 +0000"  >&lt;p&gt;Maybe it&apos;s a question of the expected result. We are reusing most of an existing appearance stream, only the text and the font size will be replaced. So, do we expect that the resulting text will have the same size than the former text? If so, we need to reuse it. Only if the new text is far more longer than the old one, we might wanna scale the font size down, so that the new text will fit into the textfield. If we reuse the font size, we have to calculate the theorectical font size too and use the smaller one of both. The latter is only true if the textfield isn&apos;t scrollable.&lt;/p&gt;

&lt;p&gt;Acrobat reader reuses the font size if one replaces the text manually.&lt;/p&gt;</comment>
                            <comment id="14194346" author="msahyoun" created="Mon, 3 Nov 2014 08:13:43 +0000"  >&lt;p&gt;The issue is that, if there is already content, PDFBox always tries to fit the text. I left this part of code intact when I was working on it the last time but according to the spec the whole text always needs to be replaced. So searching for a text and replacing that is questionable in the current code.&lt;/p&gt;

&lt;p&gt;The main difference currently is that Acrobat places all word separately where we currently (with the newer code) place the whole string.&lt;/p&gt;
</comment>
                            <comment id="14194358" author="lehmi" created="Mon, 3 Nov 2014 08:32:44 +0000"  >&lt;blockquote&gt;
&lt;p&gt;The main difference currently is that Acrobat places all word separately where we currently (with the newer code) place the whole string.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I &quot;old code&quot;, the one without my changes, replaces every single word (if divided as described) with the new text, which led to multiple occurences of the new text.&lt;/p&gt;</comment>
                            <comment id="14194410" author="jira-bot" created="Mon, 3 Nov 2014 10:23:14 +0000"  >&lt;p&gt;Commit 1636305 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/branches/1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1636305&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1636305&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1036&quot; title=&quot;FDFExport/Import gives strange results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1036&quot;&gt;&lt;del&gt;PDFBOX-1036&lt;/del&gt;&lt;/a&gt; Always regenerate text in appearance stream.&lt;/p&gt;</comment>
                            <comment id="14194422" author="jira-bot" created="Mon, 3 Nov 2014 10:42:19 +0000"  >&lt;p&gt;Commit 1636315 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/branches/1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1636315&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1636315&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1036&quot; title=&quot;FDFExport/Import gives strange results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1036&quot;&gt;&lt;del&gt;PDFBOX-1036&lt;/del&gt;&lt;/a&gt; Remove additional debug output.&lt;/p&gt;</comment>
                            <comment id="14194470" author="jira-bot" created="Mon, 3 Nov 2014 11:46:02 +0000"  >&lt;p&gt;Commit 1636327 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1636327&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1636327&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1036&quot; title=&quot;FDFExport/Import gives strange results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1036&quot;&gt;&lt;del&gt;PDFBOX-1036&lt;/del&gt;&lt;/a&gt; Always regenerate text in appearance stream.&lt;/p&gt;</comment>
                            <comment id="14194474" author="msahyoun" created="Mon, 3 Nov 2014 11:47:59 +0000"  >&lt;p&gt;Changed behavior so the text content representing the value is always regenerated.&lt;/p&gt;</comment>
                            <comment id="14194827" author="jira-bot" created="Mon, 3 Nov 2014 18:21:11 +0000"  >&lt;p&gt;Commit 1636413 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1636413&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1636413&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1036&quot; title=&quot;FDFExport/Import gives strange results&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1036&quot;&gt;&lt;del&gt;PDFBOX-1036&lt;/del&gt;&lt;/a&gt;: cosmetic changes&lt;/p&gt;</comment>
                            <comment id="14194829" author="lehmi" created="Mon, 3 Nov 2014 18:22:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; Thanks for jumping in.&lt;/p&gt;

&lt;p&gt;I&apos;ve added some last cosmetic changes to the trunk version.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12482037" name="result.pdf" size="9432" author="giladd" created="Fri, 10 Jun 2011 08:05:02 +0000"/>
                            <attachment id="12482036" name="test.fdf" size="426" author="giladd" created="Fri, 10 Jun 2011 08:05:02 +0000"/>
                            <attachment id="12482035" name="test.pdf" size="12845" author="giladd" created="Fri, 10 Jun 2011 08:05:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2868</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 2 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14u9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>236368</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>