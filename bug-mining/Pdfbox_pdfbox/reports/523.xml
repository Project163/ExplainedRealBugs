<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:55:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1895] Type0 settings /Registry and /Ordering are not decrypted when writing document</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1895</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;When re-writing a document with font descriptions, Adobe Reader is unable to display the fonts in the document.  Reader can display the fonts in the original document. The difference is that in the original document, the font descriptions are in lower object numbers than the font references; in the output document, the font descriptions are in higher object numbers than the font references.  Is there a quick way to re-order them?&lt;/p&gt;

&lt;p&gt;Update: the PDF file in question is actually corrupt, but somehow modifying it with PDFBox causes it to no longer be readable with Adobe Reader.&lt;/p&gt;

&lt;p&gt;Update: The position of the objects in the document is not important, and is not the issue. Whether the file is corrupt or not according to preflight tools is not the issue. The problem is that the input document is encrypted, including the /Registry and /Ordering settings on the Type0 font, and the output document is not, however the encrypted strings are copied verbatim to the output document, despite having decrypted copies in use for the CMap of the PDType0Font.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12693960">PDFBOX-1895</key>
            <summary>Type0 settings /Registry and /Ordering are not decrypted when writing document</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="brzrkr">Pat Hickey</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Feb 2014 18:27:18 +0000</created>
                <updated>Sun, 22 Jun 2014 14:34:50 +0000</updated>
                            <resolved>Wed, 14 May 2014 17:04:19 +0000</resolved>
                                    <version>1.8.3</version>
                    <version>1.8.4</version>
                                    <fixVersion>1.8.6</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Writing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13894943" author="jahewson" created="Fri, 7 Feb 2014 19:56:06 +0000"  >&lt;p&gt;Can you attach the problem files to this issue?&lt;/p&gt;</comment>
                            <comment id="13895280" author="brzrkr" created="Sat, 8 Feb 2014 00:06:54 +0000"  >&lt;p&gt;I have an example that I was able to generate using only pdfbox tools.&lt;br/&gt;
I&apos;m looking for permission to release it from the corporation that employs me.&lt;br/&gt;
Basically, the algorithm is to open the document, open the security protection,&lt;br/&gt;
enable all the AccessPermission settings, write the document to a new file, and close it.&lt;/p&gt;</comment>
                            <comment id="13896121" author="brzrkr" created="Mon, 10 Feb 2014 00:29:27 +0000"  >&lt;p&gt;Did you make a change that would insure that the font descriptors are written before the fonts?&lt;br/&gt;
Could you point me to the code? I&apos;d like to change our local copy (perhaps by deriving new classes).&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="13896123" author="jahewson" created="Mon, 10 Feb 2014 00:36:33 +0000"  >&lt;p&gt;I don&apos;t know what you mean by &quot;font descriptions&quot; or  &quot;font references&quot;, you need to provide a clear description of the problem using the standard terminology from the &lt;a href=&quot;http://www.adobe.com/content/dam/Adobe/en/devnet/acrobat/pdfs/pdf_reference_1-7.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PDF Reference&lt;/a&gt; or attach a PDF file which demonstrates the problem.&lt;/p&gt;</comment>
                            <comment id="13896171" author="brzrkr" created="Mon, 10 Feb 2014 02:14:56 +0000"  >&lt;p&gt;I am very sorry not to have permission (yet) to share the document. I&apos;m working on that.&lt;br/&gt;
I&apos;ll just illustrate one of the items that don&apos;t seem to be working.&lt;br/&gt;
The input document is looking for font F0 as object number 7.&lt;br/&gt;
It has the FontDescriptor as object number 5, &lt;br/&gt;
which is before it is used in the Font defined in object number 6, &lt;br/&gt;
which is then used as the DescendantFonts in object number 7, where font F0 is expected.&lt;br/&gt;
This is the pattern of the input document: the font descriptors precede the references to them.&lt;br/&gt;
Adobe Reader is able to find and display these fonts.&lt;br/&gt;
The output document is looking for font F0 as object number 145.&lt;br/&gt;
Object number 145 references the DescendantFonts in object number 375.&lt;br/&gt;
Object number 375 references the FontDescriptor in object number 405.&lt;br/&gt;
This is the pattern of the output document: the font descriptors follow the references to them.&lt;br/&gt;
Adobe Reader is &lt;b&gt;not&lt;/b&gt; able to find or display these fonts.&lt;br/&gt;
Again, the operation here is, basically, just load and save.&lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;INPUTDOCUMENT%28justthegoodparts%29%3A&quot;&gt;&lt;/a&gt;INPUT DOCUMENT (just the good parts):&lt;/h4&gt;
&lt;p&gt;3 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/Font &amp;lt;&amp;lt;&lt;br/&gt;
/F0 7 0 R&lt;br/&gt;
/F1 10 0 R&lt;br/&gt;
/G1 277 0 R&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
5 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/Ascent 859&lt;br/&gt;
/CapHeight 669&lt;br/&gt;
/Descent -140&lt;br/&gt;
/Flags 7&lt;br/&gt;
/FontBBox&lt;br/&gt;
[-82 -136 996 859]&lt;/p&gt;

&lt;p&gt;/FontName /MS-Mincho&lt;br/&gt;
/ItalicAngle 0&lt;br/&gt;
/StemV 92&lt;br/&gt;
/Style &amp;lt;&amp;lt;&lt;br/&gt;
/Panose &amp;lt;F0D23A222D4936AB277A3345&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
/Type /FontDescriptor&lt;br/&gt;
/XHeight 439&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
endobj&lt;br/&gt;
6 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/BaseFont /MS-Mincho&lt;br/&gt;
/CIDSystemInfo &amp;lt;&amp;lt;&lt;br/&gt;
/CIDToGIDMap /Identity&lt;br/&gt;
/Ordering &amp;lt;15E1735673F3&amp;gt;&lt;br/&gt;
/Registry &amp;lt;1EE46C5578&amp;gt;&lt;br/&gt;
/Supplement 4&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
/DW 1000&lt;br/&gt;
/FontDescriptor 5 0 R&lt;br/&gt;
/Subtype /CIDFontType2&lt;br/&gt;
/Type /Font&lt;br/&gt;
/W [ WIDTHS REMOVED FOR BREVITY ]&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
endobj&lt;br/&gt;
7 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/BaseFont /MS-Mincho&lt;br/&gt;
/DescendantFonts&lt;br/&gt;
[6 0 R]&lt;/p&gt;

&lt;p&gt;/Encoding /UniJIS-UCS2-H&lt;br/&gt;
/Subtype /Type0&lt;br/&gt;
/Type /Font&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
endobj&lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;OUTPUTDOCUMENT%28justthegoodparts%29%3A&quot;&gt;&lt;/a&gt;OUTPUT DOCUMENT (just the good parts):&lt;/h4&gt;

&lt;p&gt;54 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/Font &amp;lt;&amp;lt;&lt;br/&gt;
/F0 145 0 R&lt;br/&gt;
/F1 146 0 R&lt;br/&gt;
/G1 147 0 R&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
145 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/BaseFont /MS-Mincho&lt;br/&gt;
/DescendantFonts&lt;br/&gt;
[375 0 R]&lt;/p&gt;

&lt;p&gt;/Encoding /UniJIS-UCS2-H&lt;br/&gt;
/Subtype /Type0&lt;br/&gt;
/Type /Font&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
endobj&lt;br/&gt;
375 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/BaseFont /MS-Mincho&lt;br/&gt;
/CIDSystemInfo &amp;lt;&amp;lt;&lt;br/&gt;
/CIDToGIDMap /Identity&lt;br/&gt;
/Ordering &amp;lt;15E1735673F3&amp;gt;&lt;br/&gt;
/Registry &amp;lt;1EE46C5578&amp;gt;&lt;br/&gt;
/Supplement 4&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
/DW 1000&lt;br/&gt;
/FontDescriptor 405 0 R&lt;br/&gt;
/Subtype /CIDFontType2&lt;br/&gt;
/Type /Font&lt;br/&gt;
/W [ WIDTHS DELETED FOR BREVITY ]&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
endobj&lt;/p&gt;</comment>
                            <comment id="13896173" author="brzrkr" created="Mon, 10 Feb 2014 02:22:22 +0000"  >&lt;p&gt;Oops... forgot to add object 405...&lt;/p&gt;

&lt;p&gt;405 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/Ascent 859&lt;br/&gt;
/CapHeight 669&lt;br/&gt;
/Descent -140&lt;br/&gt;
/Flags 7&lt;br/&gt;
/FontBBox &lt;span class=&quot;error&quot;&gt;&amp;#91;-82 -136 996 859&amp;#93;&lt;/span&gt;&lt;br/&gt;
/FontName /MS-Mincho&lt;br/&gt;
/ItalicAngle 0&lt;br/&gt;
/StemV 92&lt;br/&gt;
/Style &amp;lt;&amp;lt;&lt;br/&gt;
/Panose &amp;lt;F0D23A222D4936AB277A3345&amp;gt;&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
/Type /FontDescriptor&lt;br/&gt;
/XHeight 439&lt;br/&gt;
&amp;gt;&amp;gt;&lt;br/&gt;
endobj&lt;/p&gt;</comment>
                            <comment id="13896281" author="jahewson" created="Mon, 10 Feb 2014 07:12:48 +0000"  >&lt;p&gt;In a PDF file the order in which the objects are numbered does not matter, from the PDF spec:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Indirect objects may be numbered sequentially within a PDF file, but this is not required; object numbers may be assigned in any arbitrary order. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So the object numbering is not the cause of your problem. Without the file there&apos;s really no way to know what&apos;s wrong, are you able to generate a non-sensitive file which exhibits these problems, or perhaps use PDFSplit to extract a non-sensitive page?&lt;/p&gt;</comment>
                            <comment id="13896959" author="brzrkr" created="Mon, 10 Feb 2014 20:22:56 +0000"  >&lt;p&gt;I thought you might say that.&lt;br/&gt;
So, I re-arranged the Font and FontDescriptor objects in the output document by hand.&lt;br/&gt;
(Basically, I swapped the FontDescriptor and Font objects, and updated the object numbers in the DescendantFonts and Resources.)&lt;br/&gt;
Now, Adobe Reader X will display the output document, although the font is garbled.&lt;br/&gt;
So, ordering is not unimportant.&lt;/p&gt;</comment>
                            <comment id="13896973" author="msahyoun" created="Mon, 10 Feb 2014 20:34:26 +0000"  >&lt;p&gt;can you share with us how you load and save the document? Are there any modifications you are doing using PDFBox. Can you share these too?&lt;/p&gt;

&lt;p&gt;And to restate what John already wrote - the order is not important. PDFs are random access files with reference tables (Cross Reference Table or Stream) where to find the objects within the file.&lt;/p&gt;

&lt;p&gt;It would be very helpful to get a hands on a sample PDF.&lt;/p&gt;

&lt;p&gt;BR&lt;br/&gt;
Maruan&lt;/p&gt;</comment>
                            <comment id="13897171" author="brzrkr" created="Mon, 10 Feb 2014 23:01:03 +0000"  >&lt;p&gt;OK, I found the document online, so I can point to it there. ( I still can&apos;t download it and copy it here.)&lt;br/&gt;
If this link doesn&apos;t work for you, I can tell you how I found it.&lt;br/&gt;
It&apos;s www.nttdocomo.co.jp&apos;s quarterly report from 10/31/2013, which I found by searching for &apos;E04463&apos; on the edinet site. (Sorry, but Japanese is not a language I understand, and I navigated mostly by clicking around until something happened.) I downloaded this document, and ran the same simple pdfbox-1.8.3-only code on it, with the exact same results. Again, I&apos;m looking for permission to copy the program and the output to this list, but don&apos;t have it yet. As I described, the algorithm is simply to load the document, open the protection using the standard decryption material, remove all security, open all access permissions, and write the file.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://disclosure.edinet-fsa.go.jp/E01EW/download?uji.verb=W0EZA104CXP001003Action&amp;amp;uji.bean=ee.bean.parent.EECommonSearchBean&amp;amp;PID=W1E63011&amp;amp;SESSIONKEY=1392072531483&amp;amp;lgKbn=2&amp;amp;pkbn=0&amp;amp;skbn=1&amp;amp;dskb=&amp;amp;askb=&amp;amp;dflg=0&amp;amp;iflg=0&amp;amp;preId=1&amp;amp;mul=E04463&amp;amp;fls=on&amp;amp;cal=1&amp;amp;era=H&amp;amp;yer=&amp;amp;mon=&amp;amp;pfs=4&amp;amp;row=100&amp;amp;idx=0&amp;amp;str=&amp;amp;kbn=1&amp;amp;flg=&amp;amp;syoruiKanriNo=&amp;amp;s=S1000AB2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://disclosure.edinet-fsa.go.jp/E01EW/download?uji.verb=W0EZA104CXP001003Action&amp;amp;uji.bean=ee.bean.parent.EECommonSearchBean&amp;amp;PID=W1E63011&amp;amp;SESSIONKEY=1392072531483&amp;amp;lgKbn=2&amp;amp;pkbn=0&amp;amp;skbn=1&amp;amp;dskb=&amp;amp;askb=&amp;amp;dflg=0&amp;amp;iflg=0&amp;amp;preId=1&amp;amp;mul=E04463&amp;amp;fls=on&amp;amp;cal=1&amp;amp;era=H&amp;amp;yer=&amp;amp;mon=&amp;amp;pfs=4&amp;amp;row=100&amp;amp;idx=0&amp;amp;str=&amp;amp;kbn=1&amp;amp;flg=&amp;amp;syoruiKanriNo=&amp;amp;s=S1000AB2&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13897636" author="tboehme" created="Tue, 11 Feb 2014 08:32:35 +0000"  >&lt;p&gt;Without having a look at the document in question I would assume the document to be linearized for fast display before fully loaded. In this mode certain conditions must be true (possibly that certain objects which are referenced must be declared before etc.). However this is only a guess.&lt;/p&gt;

&lt;p&gt;Best&lt;br/&gt;
Timo&lt;/p&gt;</comment>
                            <comment id="13897877" author="brzrkr" created="Tue, 11 Feb 2014 14:38:17 +0000"  >&lt;p&gt;The document does not contain the string &apos;/Linearized&apos; and has only a single &apos;xref&apos; table.&lt;br/&gt;
I think this means it is not linearized.&lt;/p&gt;</comment>
                            <comment id="13898080" author="jahewson" created="Tue, 11 Feb 2014 17:57:41 +0000"  >&lt;blockquote&gt;
&lt;p&gt;As I described, the algorithm is simply to load the document, open the protection using the standard decryption material, remove all security, open all access permissions, and write the file.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I can&apos;t say that I understand how to reproduce those steps.&lt;/p&gt;</comment>
                            <comment id="13898125" author="brzrkr" created="Tue, 11 Feb 2014 18:43:15 +0000"  >&lt;p&gt;Well, I was trying to describe the code w/o actually attaching it.&lt;br/&gt;
The pdfbox-1.8.3 calls were to:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;load the document&lt;br/&gt;
  PDDocument.load( filename )&lt;/li&gt;
	&lt;li&gt;open the protection using the standard decryption material&lt;br/&gt;
  PDDocument.openProtection( new StandardDecryptionMaterial() )&lt;/li&gt;
	&lt;li&gt;remove all security&lt;br/&gt;
  PDDocument.setAllSecurityToBeRemoved( true )&lt;/li&gt;
	&lt;li&gt;open all access permissions&lt;br/&gt;
  AccessPermission.setCanXXX(true)&lt;/li&gt;
	&lt;li&gt;write the file&lt;br/&gt;
  PDDocument.save( filename )&lt;/li&gt;
	&lt;li&gt;PDDocument.close&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13898197" author="jahewson" created="Tue, 11 Feb 2014 19:31:49 +0000"  >&lt;p&gt;Thanks, that&apos;s perfect. Incidentally, the PDF file you linked to has some major problems, it does not display at all in OS X Preview. Chrome&apos;s PDF viewer does not correctly display the text. Adobe Acrobat displays the message &quot;The file is damaged, and could not be repaired&quot; but is able to open and view the file. Attempting to use Acrobat&apos;s preflight to verify conformance fails with the message &quot;An error occurred while parsing a contents stream. Unable to analyze the PDF file&quot;. Running PDFBox preflight results in the following relevant error messages:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;3.1.3 : Invalid Font definition, FontFile entry is missing from FontDescriptor &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; MS-Mincho
3.1.3 : Invalid Font definition, FontFile entry is missing from FontDescriptor &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; MS-Gothic
3.1.7 : Invalid Font definition, The CMap is a string but it isn&apos;t an Identity-H/V
3.1.3 : Invalid Font definition, FontFile entry is missing from FontDescriptor &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; HeiseiMin-W3
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13898272" author="brzrkr" created="Tue, 11 Feb 2014 20:34:31 +0000"  >&lt;p&gt;I only raised this issue in the first place because Adobe Reader X under IE and Firefox has no trouble displaying this file.  If the file is busted, it&apos;s asking a bit much that any transform on the file should not also be busted. :-/&lt;br/&gt;
Is there a way to verify a file while it&apos;s being parsed? Or fairly cheaply after it&apos;s been parsed?&lt;/p&gt;</comment>
                            <comment id="13898407" author="jahewson" created="Tue, 11 Feb 2014 22:23:08 +0000"  >&lt;p&gt;I&apos;d expect PDFBox to have written some messages to the log while processing this file, did you set up logging?&lt;/p&gt;</comment>
                            <comment id="13898457" author="brzrkr" created="Tue, 11 Feb 2014 22:59:42 +0000"  >&lt;p&gt;Yup - logging is on... pdfbox makes no complaint about this, either during parsing or during output.&lt;/p&gt;</comment>
                            <comment id="13898505" author="jahewson" created="Tue, 11 Feb 2014 23:37:25 +0000"  >&lt;p&gt;Ok, I think it would be helpful if PDFBox could catch the error when writing out the new PDF. Though I&apos;m still not entirely sure what part of the PDF file specifically is the problem. Further research is needed.&lt;/p&gt;</comment>
                            <comment id="13898711" author="brzrkr" created="Wed, 12 Feb 2014 02:49:17 +0000"  >&lt;p&gt;What method returned the preflight errors you show above?&lt;br/&gt;
I tried this w/o any complaint on the same file. pdfbox-1.8.3&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void preflightCheck( &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; filename ) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
		PreflightParser p = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PreflightParser( filename );
		p.parse();
		PreflightDocument d = p.getPreflightDocument();
		ValidationResult r = d.getResult();
		List&amp;lt; ValidationError &amp;gt; errors = r.getErrorsList();
		&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ( ValidationError error : errors ) {
			&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println( &lt;span class=&quot;code-quote&quot;&gt;&quot;error: &quot;&lt;/span&gt; + error.getErrorCode() + &lt;span class=&quot;code-quote&quot;&gt;&quot; : &quot;&lt;/span&gt; + error.getDetails() );
		}
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13898780" author="jahewson" created="Wed, 12 Feb 2014 04:31:11 +0000"  >&lt;p&gt;I ran the preflight-app jar from 2.0.0 on the command line. Preflight is for checking PDF/A though, so you can expect pretty much any given non-PDF/A file to generate some errors.&lt;/p&gt;</comment>
                            <comment id="13898888" author="msahyoun" created="Wed, 12 Feb 2014 07:25:13 +0000"  >&lt;p&gt;If you use PDDocument.loadNonSeq instead of PDDocument.load and then save the file it can be opened in Adobe Reader. There is a message about the missing MS-Mincho font, which is inline with the errors reported by preflight. So it looks like the font information is wrong.&lt;/p&gt;

&lt;p&gt;Maruan&lt;/p&gt;</comment>
                            <comment id="13899147" author="brzrkr" created="Wed, 12 Feb 2014 14:40:15 +0000"  >&lt;p&gt;It&apos;s been gnawing at me that Adobe Reader X can display the input file (link shown above), but not the output file.  NTT Docomo would not issue their 3rd quarter financial report in a broken format. So, there must be some clue that is in the input file, but not in the output file, that lets Reader grok the fonts.  I think I&apos;ll keep looking at the differences.&lt;/p&gt;</comment>
                            <comment id="13899164" author="msahyoun" created="Wed, 12 Feb 2014 15:04:19 +0000"  >&lt;p&gt;At least for me, both Adobe Reader and Adobe Acrobat, show a quick dialog that the file needs to be repaired. So I&#8217;d think there is something wrong with the file - finding what&#8217;s wrong is a different story. &lt;/p&gt;</comment>
                            <comment id="13899364" author="jahewson" created="Wed, 12 Feb 2014 18:11:18 +0000"  >&lt;blockquote&gt;
&lt;p&gt;NTT Docomo would not issue their 3rd quarter financial report in a broken format&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The PDF file is broken, that&apos;s why Acrobat says &quot;The file is damaged&quot; when opening it. It is missing required embedded fonts which use an Identity CIDToGID mapping, meaning that it is not safe to substitute the font. The CIDSystemInfo it contains specifies the registry �&quot;&#228;lUx&quot; with ordering &quot;�&#225;sVs&#243;&quot; which should be &quot;Adobe&quot; and &quot;Japan1&quot;. There may be other problems too.&lt;/p&gt;

&lt;p&gt;The odd thing is that missing fonts with an Identity CIDToGID mapping cannot be substituted, because a GID is an internal, font-specific detail and can differ between two otherwise identical fonts. Yet Adobe Reader is somehow able to perform this substitution. For example, on my machine File &amp;gt; Properties &amp;gt; Fonts tells me that MS-Mincho has been substituted for HiraMinPro-W6, a Type 1 font! I can only think that Adobe has some sort of non-standard heuristic which is being used to safely substitute the font. Whatever changes PDFBox makes when it removes the signature, one of them is causing the heuristic to fail to identify that the missing fonts can be safely substituted.&lt;/p&gt;</comment>
                            <comment id="13899731" author="brzrkr" created="Wed, 12 Feb 2014 23:06:09 +0000"  >&lt;p&gt;That&apos;s what gets me. Reader displays the file for me (did you load the Japanese Font extension?), despite the /CIDtoGIDMap /Identity and missing /FontFile.&lt;br/&gt;
 File &amp;gt; Properties &amp;gt; Fonts (or equivalently from the Document Properties menu) on the input document shows:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;HeiseiMin-W3
	&lt;ul&gt;
		&lt;li&gt;Type: Type 1 (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: KozMinPr6N-Regular&lt;/li&gt;
		&lt;li&gt;Actual Font Type: Type 1 (CID)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;MS-Gothic
	&lt;ul&gt;
		&lt;li&gt;Type: TrueType (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: MSGothic&lt;/li&gt;
		&lt;li&gt;Actual Font Type: TrueType&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;MS-Mincho
	&lt;ul&gt;
		&lt;li&gt;Type: TrueType (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: MSMincho&lt;/li&gt;
		&lt;li&gt;Actual Font Type: TrueType&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;MS-PGothic
	&lt;ul&gt;
		&lt;li&gt;Type: TrueType (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: MSPGothic&lt;/li&gt;
		&lt;li&gt;Actual Font Type: TrueType&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;MS-PMincho
	&lt;ul&gt;
		&lt;li&gt;Type: TrueType (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: MSPMincho&lt;/li&gt;
		&lt;li&gt;Actual Font Type: TrueType&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;But the same reader, after complaining about that it cannot find or create the font &apos;MS-Mincho&apos;, has this mapping for the output file:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;HeiseiMin-W3
	&lt;ul&gt;
		&lt;li&gt;Type: Type 1 (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: KozMinPr6N-Regular&lt;/li&gt;
		&lt;li&gt;Actual Font Type: Type 1 (CID)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;MS-Gothic
	&lt;ul&gt;
		&lt;li&gt;Type: TrueType (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: MSGothic&lt;/li&gt;
		&lt;li&gt;Actual Font Type: Unknown&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;MS-Mincho
	&lt;ul&gt;
		&lt;li&gt;Type: TrueType (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: MSMincho&lt;/li&gt;
		&lt;li&gt;Actual Font Type: Unknown&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;MS-PGothic
	&lt;ul&gt;
		&lt;li&gt;Type: TrueType (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: MSPGothic&lt;/li&gt;
		&lt;li&gt;Actual Font Type: Unknown&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;MS-PMincho
	&lt;ul&gt;
		&lt;li&gt;Type: TrueType (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: MSPMincho&lt;/li&gt;
		&lt;li&gt;Actual Font Type: Unknown&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This is why I think that some hint to Reader has been lost in the translation, so to speak.&lt;br/&gt;
I&apos;m trying to narrow down the differences between the input/output font details...&lt;/p&gt;</comment>
                            <comment id="13900740" author="jahewson" created="Thu, 13 Feb 2014 21:16:53 +0000"  >&lt;p&gt;I&apos;m using Adobe Acrobat Pro XI and I get different font information for the original document:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;HeiseiMin-W3
	&lt;ul&gt;
		&lt;li&gt;Type: Type 1 (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: HiraMinPro-W3&lt;/li&gt;
		&lt;li&gt;Actual Font Type: Type 1 (CID)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;MS-Gothic
	&lt;ul&gt;
		&lt;li&gt;Type: True Type (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: HiraKakuPro-W6&lt;/li&gt;
		&lt;li&gt;Actual Font Type: Type 1 (CID)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;MS-Mincho
	&lt;ul&gt;
		&lt;li&gt;Type: True Type (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: HiraMinPro-W6&lt;/li&gt;
		&lt;li&gt;Actual Font Type: Type 1 (CID)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;MS-PGothic
	&lt;ul&gt;
		&lt;li&gt;Type: True Type (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: HiraKakuPro-W6&lt;/li&gt;
		&lt;li&gt;Actual Font Type: Type 1 (CID)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;MS-PMincho
	&lt;ul&gt;
		&lt;li&gt;Type: True Type (CID)&lt;/li&gt;
		&lt;li&gt;Encoding: UniJIS-UCS2-H&lt;/li&gt;
		&lt;li&gt;Actual Font: HiraMinPro-W6&lt;/li&gt;
		&lt;li&gt;Actual Font Type: Type 1 (CID)&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ve not installed any special font packs, but I think Acrobat Pro comes with them. What exact version of Acrobat are you using?&lt;/p&gt;</comment>
                            <comment id="13900835" author="brzrkr" created="Thu, 13 Feb 2014 22:53:39 +0000"  >&lt;p&gt;Adobe Reader 10.1.9&lt;/p&gt;</comment>
                            <comment id="13900837" author="brzrkr" created="Thu, 13 Feb 2014 22:55:51 +0000"  >&lt;p&gt;I do see that the input document has 494 objects, while the output document has 493.&lt;br/&gt;
Trying to find the missing object...&lt;/p&gt;</comment>
                            <comment id="13910579" author="jahewson" created="Mon, 24 Feb 2014 17:56:14 +0000"  >&lt;p&gt;Any luck finding the missing object?&lt;/p&gt;</comment>
                            <comment id="13993402" author="brzrkr" created="Fri, 9 May 2014 04:58:12 +0000"  >&lt;p&gt;I finally found the missing object. &lt;br/&gt;
It is the encryption object.&lt;br/&gt;
I have pasted its content below. &lt;br/&gt;
The /U token is only 16 bytes long... &lt;br/&gt;
doesn&apos;t the spec say it should be 32?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;270 0 obj
&amp;lt;&amp;lt;
/CF &amp;lt;&amp;lt;
/StdCF &amp;lt;&amp;lt;
/AuthEvent /DocOpen
/CFM /V2
/Length 16
&amp;gt;&amp;gt;
&amp;gt;&amp;gt;
/EncryptMetadata &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
/Filter /Standard
/Length 128
/O &amp;lt;1C05A048615171E5D46A21726E33D63AB2FFD258E5D9745CC19FAFD8CBC8B086&amp;gt;
/P -3900
/R 4
/StmF /StdCF
/StrF /StdCF
/U &amp;lt;568E89D6FDE15C453FCD04E69160C5BD&amp;gt;
/V 4
&amp;gt;&amp;gt;
endobj
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13993507" author="lehmi" created="Fri, 9 May 2014 10:00:35 +0000"  >&lt;p&gt;As you removed all security (the encryoption) that information isn&apos;t part of the resulting pdf anymore.&lt;/p&gt;</comment>
                            <comment id="13993654" author="brzrkr" created="Fri, 9 May 2014 15:52:37 +0000"  >&lt;p&gt;Yes, I grok that. However, for me, it has widened the problem from strictly a font (or hint about fonts) problem to include decryption as a possible culprit.&lt;/p&gt;</comment>
                            <comment id="13993984" author="brzrkr" created="Fri, 9 May 2014 22:18:04 +0000"  >&lt;p&gt;The input is a file that Adobe Reader will display (reference above).&lt;br/&gt;
This code copies the input to the output &lt;b&gt;without&lt;/b&gt; decrypting.&lt;br/&gt;
Should I expect that Adobe Reader will display the file now?&lt;br/&gt;
It does not. Everything is completely garbled.&lt;br/&gt;
And it &lt;b&gt;still&lt;/b&gt; complains about missing fonts.&lt;br/&gt;
I&apos;m beginning to suspect a conflation of font and decryption issues.&lt;br/&gt;
The trick will be how to debug this w/o writing another parser. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main( &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args ) {
    PDDocument document = PDDocument.load( args[ 0 ] );
    document.save( args[ 1 ] );
    document.close();
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.exit( 0 );
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13994160" author="brzrkr" created="Sat, 10 May 2014 06:29:58 +0000"  >&lt;p&gt;One thing still bugs me about the output file: the font for the bookmarks (outline) works fine, even though it has the same deficient structure as the other fonts in the file...&lt;br/&gt;
It&apos;s clear that the output /Title values have been converted to UTF-16 strings; it&apos;s not so clear what the input values are - they&apos;re encrypted, too? input: /Title &amp;lt;57E3D92AB9D3&amp;gt; output: /Title &amp;lt;FEFF88687D19&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13996591" author="brzrkr" created="Tue, 13 May 2014 16:41:25 +0000"  >&lt;p&gt;The problem is with the /Ordering and /Registry values.&lt;br/&gt;
When I change these in the output file to /Ordering (Japan1) and /Registry (Adobe)&lt;br/&gt;
then the document displays just fine, without any font complaints.&lt;br/&gt;
Is this a decryption problem, perhaps?&lt;br/&gt;
Or is this obfuscation at work?&lt;br/&gt;
The input file has these strings, which are mostly all copied verbatim to the output file, &lt;br/&gt;
except for the very last one in the list below, which is copied as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/Ordering (Japan1) /Registry (Adobe) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/Ordering &amp;lt;E02422411A5C&amp;gt; /Registry &amp;lt;EB213D4211&amp;gt;
/Ordering &amp;lt;78219F48985C&amp;gt; /Registry &amp;lt;7324804B93&amp;gt;
/Ordering &amp;lt;F9A77005FA62&amp;gt; /Registry &amp;lt;F2A26F06F1&amp;gt;
/Ordering &amp;lt;8DA892028FFF&amp;gt; /Registry &amp;lt;86AD8D0184&amp;gt;
/Ordering &amp;lt;D863FEFF46E7&amp;gt; /Registry &amp;lt;D366E1FC4D&amp;gt;
/Ordering &amp;lt;656C078A2CD6&amp;gt; /Registry &amp;lt;6E69188927&amp;gt;
/Ordering &amp;lt;348FF58B8D0D&amp;gt; /Registry &amp;lt;3F8AEA8886&amp;gt;
/Ordering &amp;lt;CF9BFD5BA8CF&amp;gt; /Registry &amp;lt;C49EE258A3&amp;gt;
/Ordering &amp;lt;BACAEEC85639&amp;gt; /Registry &amp;lt;B1CFF1CB5D&amp;gt;
/Ordering &amp;lt;30C284CE2BE7&amp;gt; /Registry &amp;lt;3BC79BCD20&amp;gt;
/Ordering &amp;lt;0B79E46DBB2D&amp;gt; /Registry &amp;lt;007CFB6EB0&amp;gt;
/Ordering &amp;lt;D28641BEE24A&amp;gt; /Registry &amp;lt;D9835EBDE9&amp;gt;
/Ordering &amp;lt;1682A2578315&amp;gt; /Registry &amp;lt;1D87BD5488&amp;gt;
/Ordering &amp;lt;44F4239F1DB2&amp;gt; /Registry &amp;lt;4FF13C9C16&amp;gt;
/Ordering &amp;lt;505E85100279&amp;gt; /Registry &amp;lt;5B5B9A1309&amp;gt;
/Ordering &amp;lt;1065DF60B97F&amp;gt; /Registry &amp;lt;1B60C063B2&amp;gt;
/Ordering &amp;lt;959B4A3FD05D&amp;gt; /Registry &amp;lt;9E9E553CDB&amp;gt;
/Ordering &amp;lt;CDEE41188574&amp;gt; /Registry &amp;lt;C6EB5E1B8E&amp;gt;
/Ordering &amp;lt;1A622D5C99B2&amp;gt; /Registry &amp;lt;1167325F92&amp;gt;
/Ordering &amp;lt;DD2E765FA38C&amp;gt; /Registry &amp;lt;D62B695CA8&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13997707" author="brzrkr" created="Wed, 14 May 2014 16:12:46 +0000"  >&lt;p&gt;The PDType0Font object has the decrypted /Ordering and /Registry values attached to the CMap. It might be easier as a published fix to just decrypt the values in the COSObjects directly, but the workaround I used was to copy the registry and ordering from the PDType0Font object. This was a little tricky, since the CMap is not exposed by PDType0Font.&lt;br/&gt;
&lt;b&gt;USE&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;               &lt;span class=&quot;code-comment&quot;&gt;// after document.openProtection( &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StandardDecryptionMaterial( &quot;&quot; );
&lt;/span&gt;               PDDocumentCatalog catalog = document.getDocumentCatalog();
		List&amp;lt;?&amp;gt; pages = catalog.getAllPages();
		&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ( &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; obj : pages ) {
			PDPage page = (PDPage)obj;
			PDResources resources = page.findResources();
			Map&amp;lt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, PDFont &amp;gt; fonts = resources.getFonts();
			&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ( Map.Entry&amp;lt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, PDFont &amp;gt; entry : fonts.entrySet() ) {
				PDFont font = entry.getValue();
				FixType0FontFromCMap.fixType0FontFromCMap( font );
			}
		}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;WORKAROUND&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; com.bloomberg.glodas.pdf.util;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.fontbox.cmap.CMap;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.cos.COSArray;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.cos.COSBase;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.cos.COSDictionary;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.cos.COSName;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.pdmodel.font.PDFont;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.pdmodel.font.PDType0Font;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;FixType0FontFromCMap &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; PDType0Font {

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; FixType0FontFromCMap() {
		&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;();
	}

	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; FixType0FontFromCMap( COSDictionary fontDictionary ) {
		&lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;( fontDictionary );
	}

	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; cid_font_type0 = COSName.CID_FONT_TYPE0.getName();
	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; cid_font_type2 = COSName.CID_FONT_TYPE2.getName();
	
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void fixType0FontFromCMap( PDFont font ) {
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( font &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; PDType0Font ) {
			COSBase cos = font.getCOSObject();
			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( cos == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || ! ( cos &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; COSDictionary ) ) {
				&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
			}
			COSDictionary dict = (COSDictionary)cos;
			FixType0FontFromCMap vis = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FixType0FontFromCMap( dict );
			CMap cmap = vis.cmap;
			&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; decrypted_ordering = cmap.getOrdering();
			&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; decrypted_registry = cmap.getRegistry();
			cos = dict.getDictionaryObject( COSName.DESCENDANT_FONTS );
			&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( cos == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ) {
				&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
			}
			COSArray array = (COSArray)cos;
			&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ( &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; ix = 0; ix &amp;lt; array.size(); ++ix ) {
				cos = array.getObject( ix );
				&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( cos != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; cos &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; COSDictionary ) {
					COSDictionary descendants = (COSDictionary)cos;
					&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; type = descendants.getNameAsString( COSName.TYPE );
					&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; subtype = descendants.getNameAsString( COSName.SUBTYPE );
					&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( type == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || ! type.equals( COSName.FONT.getName() ) ) {
						&lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
					}
					&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( subtype == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || ! ( subtype.equals( cid_font_type0 ) || subtype.equals( cid_font_type2 ) ) ) {
					   &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
					}
					cos = descendants.getDictionaryObject( COSName.CIDSYSTEMINFO );
					&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( cos == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || ! ( cos &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; COSDictionary ) ) {
						&lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
					}
					COSDictionary info = (COSDictionary)cos;
					info.setString( COSName.REGISTRY, decrypted_registry );
					info.setString( COSName.ORDERING, decrypted_ordering );
				}
			}
		}
	}
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="13997773" author="lehmi" created="Wed, 14 May 2014 17:04:19 +0000"  >&lt;p&gt;I agree with Pat, most of the CIDSystemInfo dictionaries weren&apos;t decrypted.&lt;/p&gt;

&lt;p&gt;I fixed that in revision 1594639 (trunk) and revision 1594642 (1.8 branch).&lt;/p&gt;</comment>
                            <comment id="13998481" author="brzrk1@gmail.com" created="Thu, 15 May 2014 06:14:01 +0000"  >&lt;p&gt;Excellent! Thanks!&lt;/p&gt;


&lt;p&gt;On Wed, May 14, 2014 at 1:05 PM, Andreas Lehmk&#252;hler (JIRA)&lt;/p&gt;
</comment>
                            <comment id="13998512" author="brzrk1@gmail.com" created="Thu, 15 May 2014 07:00:16 +0000"  >&lt;p&gt;Excellent! Thanks!&lt;/p&gt;


&lt;p&gt;On Wed, May 14, 2014 at 1:05 PM, Andreas Lehmk&#252;hler (JIRA)&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12694578">PDFBOX-1910</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>372469</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 27 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1s6v3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>372773</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>