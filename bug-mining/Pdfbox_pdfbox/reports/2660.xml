<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:12:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5381] Catalog object twice in signed file</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5381</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The catalog object is twice in the signed file&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;1 0 obj
&amp;lt;&amp;lt;
/Type /Catalog
/Version /1.4
/Pages 2 0 R
/Metadata 3 0 R
/OutputIntents [4 0 R]
/Perms 18 0 R
/AcroForm &amp;lt;&amp;lt;
/Fields [22 0 R]
/SigFlags 3
&amp;gt;&amp;gt;
&amp;gt;&amp;gt;
endobj
1 0 obj
&amp;lt;&amp;lt;
/Type /Catalog
/Version /1.4
/Pages 2 0 R
/Metadata 3 0 R
/OutputIntents [4 0 R]
/Perms 18 0 R
/AcroForm &amp;lt;&amp;lt;
/Fields [22 0 R]
/SigFlags 3
&amp;gt;&amp;gt;
&amp;gt;&amp;gt;
endobj
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;here&apos;s a failing test, to be added at the end of CreatePDFATest.java (and probably elsewhere)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

&lt;span class=&quot;code-comment&quot;&gt;// Check that no object numbers are &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;
&lt;/span&gt;File signedFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(signedPdfaFilename);
BufferedReader br = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedReader(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InputStreamReader(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(signedFile)));
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; line;
&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isIncrementalArea = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; set = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&amp;gt;();
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; linePos = 0;
&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((line = br.readLine()) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
{
    ++linePos;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (line.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;%%EOF&quot;&lt;/span&gt;))
    {
        isIncrementalArea = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (line.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;%%EOF&quot;&lt;/span&gt;))
    {
        isIncrementalArea = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        set.clear(); &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; cases with several revisions
&lt;/span&gt;    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (line.matches(&lt;span class=&quot;code-quote&quot;&gt;&quot;^\\d+ 0 obj$&quot;&lt;/span&gt;))
    {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; pos = line.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&quot; 0 obj&quot;&lt;/span&gt;);
        line = line.substring(0, pos);
        assertFalse(set.contains(line), &lt;span class=&quot;code-quote&quot;&gt;&quot;object &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt; + line + &lt;span class=&quot;code-quote&quot;&gt;&quot; 0 obj&apos;&lt;/span&gt; twice in incremental part of PDF at line &quot;&lt;/span&gt; +linePos);
        set.add(line);
    }
}
br.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I don&apos;t know why it happens (although I remember I had such a thing years ago when trying different strategies while working on incremental saving in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-45&quot; title=&quot;Support incremental save&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-45&quot;&gt;&lt;del&gt;PDFBOX-45&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13430856">PDFBOX-5381</key>
            <summary>Catalog object twice in signed file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                            <label>regression</label>
                    </labels>
                <created>Sun, 27 Feb 2022 10:27:41 +0000</created>
                <updated>Fri, 18 Aug 2023 05:46:17 +0000</updated>
                            <resolved>Tue, 22 Mar 2022 06:57:13 +0000</resolved>
                                    <version>3.0.0 PDFBox</version>
                                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Signing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17498572" author="lehmi" created="Sun, 27 Feb 2022 11:35:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; Is this specific for the attached file or did you observe the same behaviour for others or maybe all others?&lt;/p&gt;

&lt;p&gt;UPDATE: I suspect the COSWriter and the recently added compression feature&lt;/p&gt;</comment>
                            <comment id="17498574" author="tilman" created="Sun, 27 Feb 2022 12:02:51 +0000"  >&lt;p&gt;It&apos;s also on several other output files in PDFBox reactor/examples/target/test-output , including some that has incrmental saving without signing. The whole thing started when I investigated &lt;a href=&quot;https://stackoverflow.com/questions/71267471/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/71267471/&lt;/a&gt; and ran signing with the trunk on the original file and noticed the double catalog. (It doesn&apos;t happen with 2.0 so that isn&apos;t the cause for the SO issue)&lt;/p&gt;</comment>
                            <comment id="17498602" author="jira-bot" created="Sun, 27 Feb 2022 14:38:19 +0000"  >&lt;p&gt;Commit 1898455 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1898455&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1898455&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5381&quot; title=&quot;Catalog object twice in signed file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5381&quot;&gt;&lt;del&gt;PDFBOX-5381&lt;/del&gt;&lt;/a&gt;: avoid writing the catalog object twice using a part of a patch povided by the blue mountain in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5369&quot; title=&quot;PDDocument.saveIncremental () and stack exhaustion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5369&quot;&gt;PDFBOX-5369&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17498604" author="lehmi" created="Sun, 27 Feb 2022 14:41:10 +0000"  >&lt;p&gt;The object 1 0 is added twice, one time in &lt;tt&gt;org.apache.pdfbox.pdfwriter.COSWriter.doWriteBody(COSDocument)&lt;/tt&gt; as COSObject and one time in &lt;tt&gt;org.apache.pdfbox.pdfwriter.COSWriter.write(PDDocument, SignatureInterface)&lt;/tt&gt; as COSDictionary. As those object aren&apos;t the same the dictionary is written twice.&lt;/p&gt;

&lt;p&gt;I&apos;ve used a part of the from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=the+blue+mountain&quot; class=&quot;user-hover&quot; rel=&quot;the blue mountain&quot;&gt;the blue mountain&lt;/a&gt; provided patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5369&quot; title=&quot;PDDocument.saveIncremental () and stack exhaustion&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5369&quot;&gt;PDFBOX-5369&lt;/a&gt; to solve the issue.  I&apos;ve added &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; test as well&lt;/p&gt;

&lt;p&gt;But in the end this is just a workaround, IMHO the whole stuff has to be overhauled.&lt;/p&gt;</comment>
                            <comment id="17499093" author="tilman" created="Mon, 28 Feb 2022 18:07:30 +0000"  >&lt;p&gt;Thank you!&lt;/p&gt;

&lt;p&gt;I put a bug in my revised code in this issue, I accidentally deleted a section. Please insert&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isIncrementalArea)
            {
                &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;before the &quot;if (line.matches&quot; line, and remove the first &quot;if (line.equals(&quot;%%EOF&quot;))&quot; segment (but keep the second).&lt;/p&gt;</comment>
                            <comment id="17499357" author="jira-bot" created="Tue, 1 Mar 2022 06:51:38 +0000"  >&lt;p&gt;Commit 1898495 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1898495&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1898495&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5381&quot; title=&quot;Catalog object twice in signed file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5381&quot;&gt;&lt;del&gt;PDFBOX-5381&lt;/del&gt;&lt;/a&gt;: fix test as requested by Tilman&lt;/p&gt;</comment>
                            <comment id="17510262" author="lehmi" created="Tue, 22 Mar 2022 06:57:13 +0000"  >&lt;p&gt;We are done here. The mentioned refactoring is something we should handle in another ticket. It ia (again) about COSBase and collections etc.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13040503" name="PDFA_signed.pdf" size="55146" author="tilman" created="Sun, 27 Feb 2022 10:23:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 33 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0zzco:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>