<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:10:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4999] Dangerous COSDictionary.addAll(COSDictionary) method</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4999</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The method &lt;tt&gt;COSDictionary.addAll(COSDictionary)&lt;/tt&gt; creates the impression, by name and by JavaDoc comment,&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
 * This will add all of the dictionaries keys/values to &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; dictionary.
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;that it can be used for exactly that, adding all key/value pairs from the argument dictionary to the current one, replacing old entries for the same keys.&lt;br/&gt;
 If one looks at the implementation, though, one is in for a surprise:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
 * This will add all of the dictionaries keys/values to &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; dictionary.
 * Only called when adding keys to a trailer that already exists.
 *
 * @param dic The dictionaries to get the keys from.
 */
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void addAll(COSDictionary dic)
{
    dic.forEach((key, value) -&amp;gt;
    {
        /*
         * If we&apos;re at a second trailer, we have a linearized pdf file, meaning that the first Size entry represents
         * all of the objects so we don&apos;t need to grab the second.
         */
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!COSName.SIZE.equals(key) || !items.containsKey(COSName.SIZE))
        {
            setItem(key, value);
        }
    });
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here existing &lt;b&gt;Size&lt;/b&gt; entries explicitly are not replaced!&lt;/p&gt;

&lt;p&gt;This appears to be a relic from times when PDFBox parsed PDF documents front to back, ignoring cross reference streams, for improved results with linearized files when merging trailer dictionaries.&lt;/p&gt;

&lt;p&gt;Nowadays this exceptional treatment of &lt;b&gt;Size&lt;/b&gt; does not make any sense anymore, see &lt;a href=&quot;https://stackoverflow.com/a/64502740/1729265&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this stack overflow answer&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Furthermore, this method is used in other contexts than creating trailer unions, even some PDFBox methods use it to create arbitrary dictionary unions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;org.apache.pdfbox.pdmodel.PDDocument.assignAcroFormDefaultResource(PDAcroForm, COSDictionary)&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;org.apache.pdfbox.filter.JPXFilter.decode(InputStream, OutputStream, COSDictionary, int, DecodeOptions)&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;org.apache.pdfbox.examples.interactive.form.FieldTriggers.main(String[])&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;org.apache.pdfbox.pdmodel.graphics.image.PDImageXObject.PDImageXObject(PDStream, PDResources)&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;org.apache.pdfbox.pdmodel.graphics.image.PDInlineImage.PDInlineImage(COSDictionary, byte[], PDResources)&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;org.apache.pdfbox.pdmodel.graphics.image.PDInlineImageTest.testInlineImage()&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;&lt;tt&gt;org.apache.pdfbox.pdfparser.XrefTrailerResolver.setStartxref(long)&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(This list is offered by eclipse as callers of that method. There may be other, hidden calls.)&lt;/p&gt;

&lt;p&gt;Thus, this exception should be removed after all usages of that method in PDFBox have been analyzed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13336945">PDFBOX-4999</key>
            <summary>Dangerous COSDictionary.addAll(COSDictionary) method</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="mkl">Michael Klink</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Oct 2020 15:30:32 +0000</created>
                <updated>Sun, 20 Dec 2020 18:48:23 +0000</updated>
                            <resolved>Fri, 4 Dec 2020 07:23:06 +0000</resolved>
                                    <version>2.0.21</version>
                    <version>3.0.0 PDFBox</version>
                                    <fixVersion>2.0.22</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17220293" author="lehmi" created="Sun, 25 Oct 2020 13:08:52 +0000"  >&lt;p&gt;That&apos;s an interesting observation, never realized that. One call is missing in that list&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;tt&gt;org.apache.pdfbox.pdfparser.XrefTrailerResolver.setStartxref(long)&lt;/tt&gt;&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="17220352" author="mkl" created="Sun, 25 Oct 2020 17:33:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;One call is missing in that list&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Indeed, I&apos;ve just added it to the list.&lt;br/&gt;
Originally I skipped it because I considered it to be the one case referred to in the method comment &lt;em&gt;&quot;Only called when adding keys to a trailer that already exists.&quot;&lt;/em&gt; But that&apos;s wrong, that comment referred to the old, not xref-oriented document loading, not to the current document loading.&lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17243777" author="jira-bot" created="Fri, 4 Dec 2020 07:15:50 +0000"  >&lt;p&gt;Commit 1884086 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1884086&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1884086&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4999&quot; title=&quot;Dangerous COSDictionary.addAll(COSDictionary) method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4999&quot;&gt;&lt;del&gt;PDFBOX-4999&lt;/del&gt;&lt;/a&gt;: don&apos;t skip size values when merging COSDictionaries as proposed by Michael Klink&lt;/p&gt;</comment>
                            <comment id="17243778" author="jira-bot" created="Fri, 4 Dec 2020 07:16:02 +0000"  >&lt;p&gt;Commit 1884087 from lehmi@apache.org in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1884087&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1884087&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4999&quot; title=&quot;Dangerous COSDictionary.addAll(COSDictionary) method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4999&quot;&gt;&lt;del&gt;PDFBOX-4999&lt;/del&gt;&lt;/a&gt;: don&apos;t skip size values when merging COSDictionaries as proposed by Michael Klink&lt;/p&gt;</comment>
                            <comment id="17243782" author="lehmi" created="Fri, 4 Dec 2020 07:23:00 +0000"  >&lt;p&gt;The size value isn&apos;t skipped any more when merging COSDictionaries. Now, the size value is overwritten when merging the trailer dictionaries of a pdf, but that isn&apos;t an issue for two reasons. The size value isn&apos;t use after merging and the merged value is as wrong/right as the other two ones of the non merged dictionaries.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkl&quot; class=&quot;user-hover&quot; rel=&quot;mkl&quot;&gt;mkl&lt;/a&gt; Thanks for the report&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://stackoverflow.com/a/64502740/1729265]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0jyko:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>