<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:58:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2409] got the wrong result from Arabic text extraction</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2409</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;java -jar pdfbox-app-1.8.7.jar ExtractText -sort -encoding UTF-8 THESSALONIANS.pdf&lt;/p&gt;

&lt;p&gt;java -jar pdfbox-app-2.0.0-SNAPSHOT.jar ExtractText -sort -encoding UTF-8 THESSALONIANS.pdf&lt;/p&gt;

&lt;p&gt;Please compare THESSALONIANS.txt.jpg with THESSALONIANS.pdf. There are a lot of differences. I just marked a few differences with red circles.&lt;/p&gt;</description>
                <environment>Ubuntu 14.04 64bit&lt;br/&gt;
java version &amp;quot;1.8.0_20&amp;quot;</environment>
        <key id="12746681">PDFBOX-2409</key>
            <summary>got the wrong result from Arabic text extraction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="EugenePig">EugenePig</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Oct 2014 10:18:35 +0000</created>
                <updated>Thu, 17 Mar 2016 19:06:42 +0000</updated>
                            <resolved>Sat, 25 Oct 2014 22:17:58 +0000</resolved>
                                    <version>1.8.7</version>
                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Text extraction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14166015" author="jahewson" created="Thu, 9 Oct 2014 23:54:57 +0000"  >&lt;p&gt;Please provide a detailed description of the problem, the bad output you got, and what you expected the correct result to be. See the &lt;a href=&quot;https://issues.apache.org/bugwritinghelp.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Apache bug writing guidelines&lt;/a&gt; for further advice.&lt;/p&gt;

&lt;p&gt;You might want to try using the latest 2.0 snapshot, because if this is a bug then it has probably been fixed there already.&lt;/p&gt;</comment>
                            <comment id="14168682" author="eugenepig" created="Sun, 12 Oct 2014 15:43:22 +0000"  >&lt;p&gt;I already updated status for the latest 2.0 snapshot.&lt;/p&gt;</comment>
                            <comment id="14170436" author="jahewson" created="Tue, 14 Oct 2014 03:06:21 +0000"  >&lt;p&gt;I get much better results on my Mac. Try opening the .txt file in WordPad, I&apos;m not sure how good Notepad++ is at rendering Arabic. Also make sure you run ExtractText with &lt;tt&gt;-encoding &quot;UTF-8&quot;&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14179883" author="eugenepig" created="Wed, 22 Oct 2014 13:21:25 +0000"  >&lt;p&gt;I am sure I run ExtractText with &#8220;-sort -encoding UTF-8&quot;. I upload a new picture &#8220;THESSALONIANS.txt.mac.jpg&#8221; captured on the Mac. The result is still wrong. Does it look as same as yours?&lt;/p&gt;</comment>
                            <comment id="14180362" author="jahewson" created="Wed, 22 Oct 2014 19:21:29 +0000"  >&lt;p&gt;Here&apos;s a screenshot from my Mac of the .txt file which you uploaded. It looks much better than your screenshot - perhaps you don&apos;t have good Arabic fonts installed?&lt;/p&gt;</comment>
                            <comment id="14181469" author="eugenepig" created="Thu, 23 Oct 2014 15:30:37 +0000"  >&lt;p&gt;That is not my mac. I can&#8217;t install fonts on it. So I tested it on Windows 7 Arabic version with Firefox. I got the result as same as yours. Please see THESSALONIANS_win7_firefox.jpg. However it is very strange. Only the diacritic marks of the first line are almost wrong. Others are correct. &lt;/p&gt;</comment>
                            <comment id="14181894" author="jahewson" created="Thu, 23 Oct 2014 20:24:33 +0000"  >&lt;p&gt;I&apos;m able to get the same rendering if I use TextEdit on my Mac with Arial as the font, I&apos;ve attached a screenshot. Looking at the text I think that the diacritics are being placed on the wrong character, one character too late? (i.e. to the left). What do you think? This could well be a PDFBox text encoding issue with combining diacritics.&lt;/p&gt;</comment>
                            <comment id="14182525" author="eugenepig" created="Fri, 24 Oct 2014 07:23:35 +0000"  >&lt;p&gt;I uploaded a golden sample &#8221; THESSALONIANS.line - golden.txt&#8221;. It uses UTF-16 encoding for easily debugging. I used Java Normalizer to normalize every character first. For example, U+FC62 can be decomposed into U+0020, U+0650 and U+0651. I also implemented an algorithm to determine what letter has the diacritic by distance and how many diacritics the letter already has. The algorithm is too complex. Therefore I don&#8217;t recommend it. That is why I reported the issue and hope someone can fix it. Except diacritic issue, I found another issue about Arabic PDF. A few letters are different from the original PDF in my sample, such as the rightest letter in the second line. I think it is Adobe&#8217;s issue. So I didn&#8217;t mention it in this issue report. I had asked that issue on Adobe Communities. However I don&#8217;t get any solution. Please refer to &lt;a href=&quot;https://forums.adobe.com/message/6375926#6375926&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://forums.adobe.com/message/6375926#6375926&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14184282" author="jahewson" created="Sat, 25 Oct 2014 21:33:51 +0000"  >&lt;p&gt;Your golden sample isn&apos;t correct, U+0020 is a space character, so you&apos;ve got the diacritics placed over spaces rather than over the character they should combine with. I&apos;ve attached the text of the title which I extracted with Adobe Acrobat as UTF-8.&lt;/p&gt;

&lt;p&gt;Here&apos;s a comparison:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Acrobat:
&lt;h1&gt;&lt;a name=&quot;%D8%A7%D9%84%D8%B1%D9%90%D9%91%D8%B3%D9%8E%D8%A7%D9%84%D9%8E%D8%A9%D9%8F%D8%A7%D9%84%D8%A3%D9%8F%D9%88%D9%84%D9%8E%D9%89%D8%A5%D9%90%D9%84%D9%8E%D9%89%D9%85%D9%8F%D8%A4%D9%92%D9%85%D9%90%D9%86%D9%90%D9%8A%D8%AA%D9%8E%D8%B3%D9%8E%D8%A7%D9%84%D9%8F%D9%88%D9%86%D9%90%D9%8A%D9%83%D9%90%D9%8A&quot;&gt;&lt;/a&gt;&#1575;&#1604;&#1585;&#1616;&#1617;&#1587;&#1614;&#1575;&#1604;&#1614;&#1577;&#1615; &#1575;&#1604;&#1571;&#1615;&#1608;&#1604;&#1614;&#1609; &#1573;&#1616;&#1604;&#1614;&#1609; &#1605;&#1615;&#1572;&#1618;&#1605;&#1616;&#1606;&#1616;&#1610; &#1578;&#1614;&#1587;&#1614;&#1575;&#1604;&#1615;&#1608;&#1606;&#1616;&#1610;&#1603;&#1616;&#1610; &lt;/h1&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;PDFBox:
&lt;h1&gt;&lt;a name=&quot;%D8%A7%D9%84%D8%B1%D9%8E%D9%90%D9%91%D8%B3%D8%A7%D9%8E%D9%84%D9%8F%D8%A9%D8%A7%D9%8F%D9%84%D8%A3%D9%88%D9%8E%D9%84%D9%89%D9%90%D8%A5%D9%8E%D9%84%D9%89%D9%8F%D9%85%D9%92%D8%A4%D9%90%D9%85%D9%90%D9%86%D9%8A%D9%8E%D8%AA%D9%8E%D8%B3%D8%A7%D9%8F%D9%84%D9%88%D9%90%D9%86%D9%8A%D9%90%D9%83%D9%8A&quot;&gt;&lt;/a&gt;&#1575;&#1604;&#1585;&#1614;&#1616;&#1617;&#1587;&#1575;&#1614;&#1604;&#1615;&#1577; &#1575;&#1615;&#1604;&#1571;&#1608;&#1614;&#1604;&#1609; &#1616;&#1573;&#1614;&#1604;&#1609; &#1615;&#1605;&#1618;&#1572;&#1616;&#1605;&#1616;&#1606;&#1610; &#1614;&#1578;&#1614;&#1587;&#1575;&#1615;&#1604;&#1608;&#1616;&#1606;&#1610;&#1616;&#1603;&#1610;&lt;/h1&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It seems that PDFBox has moved many of the diacritics one character to the right. The first misplaced diacritic is on the letter &#1587; and looking at the Unicode we see that PDFBox outputs the diacritic before the letter it applies to (wrong). It looks like this happens when the letter preceding it has diacritics too, and those diacritics appear to have been switched.&lt;/p&gt;

&lt;p&gt;Conclusion: PDFBox is mangling the diacritics somehow. This is probably happening in PDFTextStripper or TextPosition.&lt;/p&gt;</comment>
                            <comment id="14184298" author="jira-bot" created="Sat, 25 Oct 2014 22:17:16 +0000"  >&lt;p&gt;Commit 1634256 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1634256&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1634256&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2409&quot; title=&quot;got the wrong result from Arabic text extraction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2409&quot;&gt;&lt;del&gt;PDFBOX-2409&lt;/del&gt;&lt;/a&gt;: Unicode combining characters must always follow their base character, even in RTL presentation order&lt;/p&gt;</comment>
                            <comment id="14184299" author="jahewson" created="Sat, 25 Oct 2014 22:17:54 +0000"  >&lt;p&gt;I found the problem, it was in TextPosition#insertDiacritic. The original author made the mistake of trying to insert combining diacritics before their base characters, because they assumed that was how presentation order works. Needless to say, it is not, and combining characters always follow their base character, irrespective of whether the string is RTL or in presentation or logical order.&lt;/p&gt;

&lt;p&gt;If you try out the latest version from trunk, my last commit should fix the problem.&lt;/p&gt;</comment>
                            <comment id="14186684" author="eugenepig" created="Tue, 28 Oct 2014 10:47:04 +0000"  >&lt;p&gt;It&#8217;s my fault. I uploaded the wrong golden sample. The wrong golden sample didn&#8217;t be normalize first. The correct sample is THESSALONIANS.Sample.txt what I just uploaded. There are two differences between THESSALONIANS.Sample.jpg and THESSALONIANS-Commit-1634256.jpg. However they have the same root cause. &lt;br/&gt;
I pasted parts of content in the section 8.6 of the book &#8220;Unicode Explained&#8221;.&lt;/p&gt;

&lt;p&gt;===========================================================================================&lt;br/&gt;
8.6.6. Spacing Diacritic Marks&lt;br/&gt;
When a combining diacritic mark is applied to a space character, we get the diacritic itself as a visible character. Alternatively, we might use a character that itself represents a spacing diacritic mark, often called &quot;spacing clones&quot; of diacritic marks. Such characters appear, for historical reasons, in different blocks, such as Latin-1 Supplement and Spacing Modifier Letters.&lt;br/&gt;
Starting from of Unicode 4.1, the recommendation is to apply a combining diacritic mark to a no-break space U+00A0 rather than space U+0020. The reason is &quot;potential conflicts with the handling of sequences of U+0020 space characters in contexts like XML.&quot; However, the formal definitions still to define decompositions using the space. For example, the acute accent &#180; (U+00B4) is by definition compatibility equivalent to a two-character sequence consisting of a space U+0020 and a combining acute accent U+0301.&lt;br/&gt;
Spacing diacritic marks do not have much use. Sometimes we might wish to mention a diacritic in text, such as &quot;the acute &#180; has varying shapes.&quot; More often, the spacing diacritic marks are used mistakenly (or questionably) as replacements for more appropriate characters (e.g., the acute as an apostrophe).&lt;br/&gt;
Some Basic Latin (ASCII) characters are historically derived from diacritic marks but are now treated as characters on their own. For example, the tilde ~ (U+007E) is not treated as a spacing clone of the combining tilde U+0303&apos;that would in fact be odd, since the tilde has a rather different appearance. Instead, there is a separate character, small tilde  (U+02DC), which is by definition compatibility equivalent to U+0020 U+0303.&lt;br/&gt;
==========================================================================================&lt;/p&gt;

&lt;p&gt;In our sample, U+FC62 and U+FEAE have the same position. They are overlapped. Therefore I know U+FC62 is a case of spacing diacritic marks. If it is a PDF file, a render can deal with it well. But I have to remove the space in a plain text file. So if you compare THESSALONIANS.Sample.txt and THESSALONIANS-UTF16-Commit-1634256.txt in binary mode, you will find the difference.&lt;/p&gt;</comment>
                            <comment id="14186704" author="eugenepig" created="Tue, 28 Oct 2014 11:13:06 +0000"  >&lt;p&gt;THESSALONIANS.xml lists a lot of information of all characters before normalizing texts.&lt;/p&gt;</comment>
                            <comment id="14189158" author="jahewson" created="Wed, 29 Oct 2014 22:32:17 +0000"  >&lt;blockquote&gt;
&lt;p&gt;In our sample, U+FC62 and U+FEAE have the same position. They are overlapped. Therefore I know U+FC62 is a case of spacing diacritic marks.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But it&apos;s not a spacing diacritic mark, because the diacritic is not being applied to a space. A spacing diacritic mark occurs, as the text you posted says, &quot;when a combining diacritic mark is applied to a space character&quot;. What you actually have is U+FC62 which is the &quot;isolated form&quot; of &quot;SHADDA WITH KASRA&quot;, which is a non-joining character. This particular Unicode character is not a combining diacritic.&lt;/p&gt;

&lt;p&gt;However, I do see the problem with those characters in the title and I understand that you expected to get U+FEAE and some combining diacritics instead of U+FC62, unfortunately that&apos;s not what&apos;s in the PDF file. It&apos;s very common to encounter files where the embedded Unicode text doesn&apos;t quite match what you see on the screen, and this is due to the software which generated the PDF not doing it correctly. This is where comparing the output of PDFBox with Acrobat can be helpful, to determine if the PDF file itself is the problem. In this case it is, PDFBox outputs the same text for the title as Acrobat does. Sadly, that means that I can&apos;t fix the problem.&lt;/p&gt;</comment>
                            <comment id="14189876" author="eugenepig" created="Thu, 30 Oct 2014 09:52:41 +0000"  >&lt;p&gt;I see. I misunderstood Spacing Diacritic Marks. I know parts of PDF files didn&apos;t be generated correctly. It is an annoying problem. I am waiting for PDFBOX&#8217;s OCR function. It seems to be a better solution to fix the problem. Thanks a lot.&lt;/p&gt;</comment>
                            <comment id="14190545" author="jahewson" created="Thu, 30 Oct 2014 18:25:34 +0000"  >&lt;p&gt;No worries, Unicode is very complex.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12677581" name="THESSALONIANS-Commit-1634256.jpg" size="403355" author="EugenePig" created="Tue, 28 Oct 2014 10:56:51 +0000"/>
                            <attachment id="12677582" name="THESSALONIANS-Commit-1634256.txt" size="26337" author="EugenePig" created="Tue, 28 Oct 2014 10:56:51 +0000"/>
                            <attachment id="12677583" name="THESSALONIANS-UTF16-Commit-1634256.txt" size="28680" author="EugenePig" created="Tue, 28 Oct 2014 10:56:51 +0000"/>
                            <attachment id="12677573" name="THESSALONIANS.Sample.jpg" size="400332" author="EugenePig" created="Tue, 28 Oct 2014 09:45:49 +0000"/>
                            <attachment id="12677572" name="THESSALONIANS.Sample.txt" size="28572" author="EugenePig" created="Tue, 28 Oct 2014 09:45:49 +0000"/>
                            <attachment id="12676854" name="THESSALONIANS.line - golden.txt" size="27452" author="EugenePig" created="Fri, 24 Oct 2014 07:23:35 +0000"/>
                            <attachment id="12674054" name="THESSALONIANS.pdf" size="128903" author="jahewson" created="Thu, 9 Oct 2014 23:46:59 +0000"/>
                            <attachment id="12674420" name="THESSALONIANS.txt" size="26395" author="EugenePig" created="Sun, 12 Oct 2014 15:41:23 +0000"/>
                            <attachment id="12677585" name="THESSALONIANS.xml" size="7059425" author="EugenePig" created="Tue, 28 Oct 2014 11:13:05 +0000"/>
                            <attachment id="12676604" name="THESSALONIANS_win7_firefox.jpg" size="395013" author="EugenePig" created="Thu, 23 Oct 2014 15:30:37 +0000"/>
                            <attachment id="12676705" name="TextEdit-Arial.png" size="198106" author="jahewson" created="Thu, 23 Oct 2014 20:24:33 +0000"/>
                            <attachment id="12677132" name="adobe-utf8.txt" size="101" author="jahewson" created="Sat, 25 Oct 2014 21:33:51 +0000"/>
                            <attachment id="12676402" name="jahewson.mac.png" size="215317" author="jahewson" created="Wed, 22 Oct 2014 19:21:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>13.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 3 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20xhb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>