<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:14:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5580] PDFTextStripperByArea ignores text for overlapping areas (regions) when suppressing duplicate overlapping text</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5580</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;h3&gt;&lt;a name=&quot;Problem&quot;&gt;&lt;/a&gt;Problem&lt;/h3&gt;

&lt;p&gt;Recently we encountered duplicate texts in our clients PDF documents which are typically created by applications to simulate some kind of bold text when no bold variant of a font is available. Fortunately, PDFBox&apos;s PDFTextStripperByArea has some logic to ignore exact duplicates at the same positions for these situations (which is inherited from the normal PDFTextStripper). So we changed from setSuppressDuplicateOverlappingText(false) to true.&lt;/p&gt;

&lt;p&gt;But we encountered that texts for multiple regions are not extracted correctly in this case when some special conditions are met:&lt;/p&gt;

&lt;p&gt;When using multiple regions which overlap each other and would provide exactly the same text, the first region text is extracted correctly but any following region with same text remains empty.&lt;/p&gt;

&lt;p&gt;We believe this is a bug due to duplicate suppression not being respected correctly in PDFTextStripperByArea.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Possiblecause&quot;&gt;&lt;/a&gt;Possible cause&lt;/h3&gt;

&lt;p&gt;While investigating this problem we found that PDFTextStripperByArea swaps charactersByArticle for multiple regions and interprets a single page multiple times (once for each region). In PDFTextStripper a private HashMap characterListMapping keeps track of possible duplicate symbols with their positions. The HashMap is not being reset after each region extraction which leads to characters being ignored for subsequent areas.&lt;/p&gt;

&lt;p&gt;Since the HashMap is private we were not able to subclass and customize PDFTextStripperByArea with some adjusted behavior to test this finding.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Workaround&quot;&gt;&lt;/a&gt;Workaround&lt;/h3&gt;

&lt;p&gt;When extracting regions one at a time for every page everything works fine. We currently don&apos;t see any performance disadvantages.&lt;/p&gt;
&lt;h3&gt;&lt;a name=&quot;Reproduction&quot;&gt;&lt;/a&gt;Reproduction&lt;/h3&gt;

&lt;p&gt;The attached PDF file does not actually include duplicate overlapping text since this is not needed to reproduce the issue.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PDDocument doc = PDDocument.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;C:\\Source\\test.pdf&quot;&lt;/span&gt;))) {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PDFTextStripperByArea stripper = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFTextStripperByArea();
    stripper.setSuppressDuplicateOverlappingText(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    stripper.setPageEnd(&quot;&quot;);

    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Rectangle2D areaA = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Rectangle2D.&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;(45, 319, 124, 19);
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Rectangle2D areaB = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Rectangle2D.&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;(43, 319, 130, 19);

    stripper.addRegion(&lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;, areaA);
    stripper.addRegion(&lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;, areaB);

    stripper.extractRegions(doc.getPage(0));

    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;A: &quot;&lt;/span&gt; + stripper.getTextForRegion(&lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;));
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;B: &quot;&lt;/span&gt; + stripper.getTextForRegion(&lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;));
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13529751">PDFBOX-5580</key>
            <summary>PDFTextStripperByArea ignores text for overlapping areas (regions) when suppressing duplicate overlapping text</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebho">Sebastian Holzki</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Mar 2023 11:04:22 +0000</created>
                <updated>Sat, 18 May 2024 14:03:04 +0000</updated>
                                            <version>2.0.27</version>
                    <version>3.0.0 PDFBox</version>
                                                    <component>Text extraction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17709630" author="tilman" created="Fri, 7 Apr 2023 08:42:56 +0000"  >&lt;p&gt;I had a look at PDFTextStripperByArea. From what I understand, the text isn&apos;t extracted for one region and then for the next, what happens is that each text position is processed by the extended &lt;tt&gt;processTextPosition()&lt;/tt&gt; method. So we can&apos;t just reset that HashMap you mention. We would need separate HashMaps for each region and shuffle them.&lt;/p&gt;</comment>
                            <comment id="17847318" author="tilman" created="Fri, 17 May 2024 13:53:29 +0000"  >&lt;p&gt;Sorry for the noise, wrong issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13056618" name="test.pdf" size="87071" author="sebho" created="Thu, 23 Mar 2023 11:04:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 25 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1gsnk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>