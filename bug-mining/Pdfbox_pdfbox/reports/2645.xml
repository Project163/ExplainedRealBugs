<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:12:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5366] Unhandled IOException thrown from BaseParser creates issue in PDFStreamEngine.processStreamOperators</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5366</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;We had a document where the fonts were listed in PDFDebugger under Page: 1 / Resources / Fonts, but not found during rendering.&lt;/p&gt;

&lt;p&gt;The issue is a malformed Stream in a Form XObject, which is causing an exception that is not intercepted. Then the resources are not restored when the processing of the page continues after that XObject.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13423276">PDFBOX-5366</key>
            <summary>Unhandled IOException thrown from BaseParser creates issue in PDFStreamEngine.processStreamOperators</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="albanf">Alban Fonrouge</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Jan 2022 12:30:53 +0000</created>
                <updated>Thu, 21 Apr 2022 15:38:41 +0000</updated>
                            <resolved>Sat, 22 Jan 2022 11:27:17 +0000</resolved>
                                    <version>2.0.25</version>
                                    <fixVersion>2.0.26</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17477874" author="tilman" created="Tue, 18 Jan 2022 13:55:41 +0000"  >&lt;p&gt;But that is the normal state, that the font is in the page resources. This is set in PDFStreamEngine.pushResources / popResources. If your file doesn&apos;t work, then I&apos;d suspect that the problem is there somehow.&lt;/p&gt;</comment>
                            <comment id="17477951" author="tilman" created="Tue, 18 Jan 2022 14:59:17 +0000"  >&lt;p&gt;Does the problem happen in PDFDebugger too? I&apos;m asking because I wonder whether you&apos;d doing anything &quot;special&quot;.&lt;/p&gt;</comment>
                            <comment id="17478173" author="JIRAUSER283776" created="Tue, 18 Jan 2022 20:16:00 +0000"  >&lt;p&gt;Hi, I looked more at the PDF and there is an incorrect stream in one of the Form, which causes an IOException, which is catched too late and screws up the push/pop mechanism.&lt;/p&gt;

&lt;p&gt;I can suggest a fix:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void processStreamOperators(PDContentStream contentStream) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    List&amp;lt;COSBase&amp;gt; arguments = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;COSBase&amp;gt;();
    PDFStreamParser parser = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFStreamParser(contentStream);
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; token = parser.parseNextToken();
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (token != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (token &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Operator) {
                processOperator((Operator) token, arguments);
                arguments.clear();
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                arguments.add((COSBase) token);
            }
            token = parser.parseNextToken();
        }
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; parsing stream, stopping processing&quot;&lt;/span&gt;, e);
    }
}
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I will open another issue for the root cause of the parsing error.&lt;/p&gt;</comment>
                            <comment id="17478376" author="JIRAUSER283776" created="Wed, 19 Jan 2022 07:46:19 +0000"  >&lt;p&gt;Here is the stream that&apos;s causing an issue, the array preceding the TJ operator is incorrectly formed, it has 2 [[:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
0.400000 &#160;0.400000 &#160;0.400000 RG
0.400000 &#160;0.400000 &#160;0.400000 rg
BT
0.766272 0.642516 -0.642516 0.766272 311.82 767.81 &#160;Tm
0 Tc
/F1 12.00 &#160;Tf
0 Tr
1 w
[[(Z9C:A&amp;amp;&quot;B0)]TJ
1 0 0 1 0 0 Tm
ET
0 0 0 rg
0 0 0 RG&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here are the warnings, including the one logged by the catch I added:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 Warning &#160;[BaseParser] Skipped unexpected dir object = &lt;span class=&quot;code-quote&quot;&gt;&apos;TJ&apos;&lt;/span&gt; at offset 174 (start offset: 172)
&#160;Warning &#160;[BaseParser] Corrupt array element at offset 174, start offset: 158
&#160;Warning &#160;[BaseParser] Skipped unexpected dir object = &lt;span class=&quot;code-quote&quot;&gt;&apos;Tm&apos;&lt;/span&gt; at offset 190 (start offset: 188)
&#160;Warning &#160;[BaseParser] Corrupt array element at offset 190, start offset: 158
&#160;Warning &#160;[BaseParser] Skipped unexpected dir object = &lt;span class=&quot;code-quote&quot;&gt;&apos;ET&apos;&lt;/span&gt; at offset 194 (start offset: 192)
&#160;Warning &#160;[BaseParser] Corrupt array element at offset 194, start offset: 158
&#160;Warning &#160;[BaseParser] Skipped unexpected dir object = &lt;span class=&quot;code-quote&quot;&gt;&apos;rg&apos;&lt;/span&gt; at offset 204 (start offset: 202)
&#160;Warning &#160;[BaseParser] Corrupt array element at offset 204, start offset: 158
&#160;Warning &#160;[PDFStreamEngine] Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; parsing next token, cannot &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt; processing stream
 java.io.IOException: object reference 0 0 R at offset 213 in content stream
&#160; &#160; at org.apache.pdfbox.pdfparser.BaseParser.getObjectFromPool(BaseParser.java:186)
&#160; &#160; at org.apache.pdfbox.pdfparser.BaseParser.parseCOSArray(BaseParser.java:642)
&#160; &#160; at org.apache.pdfbox.pdfparser.PDFStreamParser.parseNextToken(PDFStreamParser.java:167)
&#160; &#160; at org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:486)
&#160; &#160; at org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:461)
&#160; &#160; at org.apache.pdfbox.contentstream.PDFStreamEngine.showForm(PDFStreamEngine.java:174)
&#160; &#160; at org.apache.pdfbox.rendering.PageDrawer.showForm(PageDrawer.java:1558)
&#160; &#160; at org.apache.pdfbox.contentstream.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.graphics.DrawObject.process(DrawObject.java:85)
&#160; &#160; at org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:853)
&#160; &#160; at org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:480)
&#160; &#160; at org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:461)
&#160; &#160; at org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:147)
&#160; &#160; at org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:282)
&#160; &#160; at org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:355)
&#160; &#160; at org.apache.pdfbox.debugger.pagepane.PagePane$RenderWorker.doInBackground(PagePane.java:449)
&#160; &#160; at org.apache.pdfbox.debugger.pagepane.PagePane$RenderWorker.doInBackground(PagePane.java:431)
&#160; &#160; at javax.swing.SwingWorker$1.call(SwingWorker.java:295)
&#160; &#160; at java.util.concurrent.FutureTask.run$$$capture(FutureTask.java:266)
&#160; &#160; at java.util.concurrent.FutureTask.run(FutureTask.java)
&#160; &#160; at javax.swing.SwingWorker.run(SwingWorker.java:334)
&#160; &#160; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
&#160; &#160; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
&#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Before the code change, the exception was intercepted at &lt;tt&gt;PDFStreamEngine.processOperator&lt;/tt&gt; (line 9 of the stack), so the &lt;tt&gt;popResources&lt;/tt&gt; and other state restore operations in &lt;tt&gt;PDFStreamEngine.processStream&lt;/tt&gt; were not done correctly.&lt;/p&gt;

&lt;p&gt;It could be better to add try/finally blocks around every call to &lt;tt&gt;PDFStreamEngine.processStreamOperators,&lt;/tt&gt; at the places where resources are changed.&lt;/p&gt;</comment>
                            <comment id="17478822" author="tilman" created="Wed, 19 Jan 2022 17:08:32 +0000"  >&lt;p&gt;Yes, a finally is what I also have in mind so that it gets cleaned up properly. It might take a few hours / days before I do it.&lt;/p&gt;</comment>
                            <comment id="17478881" author="jira-bot" created="Wed, 19 Jan 2022 18:37:49 +0000"  >&lt;p&gt;Commit 1897214 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1897214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1897214&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5366&quot; title=&quot;Unhandled IOException thrown from BaseParser creates issue in PDFStreamEngine.processStreamOperators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5366&quot;&gt;&lt;del&gt;PDFBOX-5366&lt;/del&gt;&lt;/a&gt;: clean up after processing operators&lt;/p&gt;</comment>
                            <comment id="17478884" author="tilman" created="Wed, 19 Jan 2022 18:39:51 +0000"  >&lt;p&gt;I made a small change for now and only in 2.0, please try it with PDFDebugger, it&apos;s here at the bottom of the page&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-debugger/2.0.26-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-debugger/2.0.26-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="17479205" author="JIRAUSER283776" created="Thu, 20 Jan 2022 09:12:06 +0000"  >&lt;p&gt;The text renders correctly after your change.&lt;/p&gt;</comment>
                            <comment id="17480338" author="jira-bot" created="Sat, 22 Jan 2022 03:58:05 +0000"  >&lt;p&gt;Commit 1897313 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1897313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1897313&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5366&quot; title=&quot;Unhandled IOException thrown from BaseParser creates issue in PDFStreamEngine.processStreamOperators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5366&quot;&gt;&lt;del&gt;PDFBOX-5366&lt;/del&gt;&lt;/a&gt;: clean up after processing operators&lt;/p&gt;</comment>
                            <comment id="17480339" author="jira-bot" created="Sat, 22 Jan 2022 03:58:09 +0000"  >&lt;p&gt;Commit 1897314 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1897314&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1897314&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5366&quot; title=&quot;Unhandled IOException thrown from BaseParser creates issue in PDFStreamEngine.processStreamOperators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5366&quot;&gt;&lt;del&gt;PDFBOX-5366&lt;/del&gt;&lt;/a&gt;: clean up after processing operators&lt;/p&gt;</comment>
                            <comment id="17480401" author="tilman" created="Sat, 22 Jan 2022 11:27:17 +0000"  >&lt;p&gt;Thanks for the feedback!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0youo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>