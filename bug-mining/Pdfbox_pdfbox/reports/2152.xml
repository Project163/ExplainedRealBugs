<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:08:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4399] Disabled optional content groups are rendered</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4399</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Printing  a Documents with hidden optional content groups &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12950833/12950833_original.pdf&quot; title=&quot;original.pdf attached to PDFBOX-4399&quot;&gt;original.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; renders hidden content &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12950839/12950839_printed.png&quot; title=&quot;printed.png attached to PDFBOX-4399&quot;&gt;printed.png&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;. Code used to print&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
InputStream sourceStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(pFile);
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
  PDDocument source = PDDocument.load(sourceStream);
  job.setPageable(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFPageable(source));
  job.print(atts);
} &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
  sourceStream.close();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is not only a problem of PDFBox &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; but can be done right ... ghostscript does it &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12950837/12950837_gs.png&quot; title=&quot;gs.png attached to PDFBOX-4399&quot;&gt;gs.png&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13202806">PDFBOX-4399</key>
            <summary>Disabled optional content groups are rendered</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="jjcool">Stefan Ziel</reporter>
                        <labels>
                            <label>OCGs</label>
                    </labels>
                <created>Thu, 6 Dec 2018 13:43:44 +0000</created>
                <updated>Mon, 10 Oct 2022 15:45:58 +0000</updated>
                            <resolved>Wed, 16 Jan 2019 19:37:53 +0000</resolved>
                                    <version>2.0.6</version>
                    <version>2.0.13</version>
                                    <fixVersion>2.0.14</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16711813" author="tilman" created="Thu, 6 Dec 2018 18:12:08 +0000"  >&lt;p&gt;Your PDF contains Javascript and optional content groups. (I didn&apos;t test it because of Javascript). Chrome can display it, Edge and PDF.js can&apos;t. Neither can we.&lt;/p&gt;</comment>
                            <comment id="16712712" author="tilman" created="Fri, 7 Dec 2018 11:34:19 +0000"  >&lt;p&gt;See also the thread &quot;Suppressing layers on output&quot; in &lt;a href=&quot;https://mail-archives.apache.org/mod_mbox/pdfbox-users/201606.mbox/thread&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://mail-archives.apache.org/mod_mbox/pdfbox-users/201606.mbox/thread&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The guy here even &lt;a href=&quot;https://stackoverflow.com/questions/44310765/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/44310765/&lt;/a&gt; managed to use it.&lt;/p&gt;</comment>
                            <comment id="16715250" author="jjcool" created="Mon, 10 Dec 2018 18:02:40 +0000"  >&lt;p&gt;The javascript&#160;as far as it concerns just states some OCG&apos;s to true and others to false and vice versa depending on the button the user clicked. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
function lang_de()
{
	&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; aOCGs = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getOCGs() ;
	&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; i = 0 ; i &amp;lt; aOCGs.length ; i++)
	{
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (aOCGs[i].name == &lt;span class=&quot;code-quote&quot;&gt;&quot;de&quot;&lt;/span&gt;)
		{
			aOCGs[i].state = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; ;
		}
		
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (aOCGs[i].name == &lt;span class=&quot;code-quote&quot;&gt;&quot;fi&quot;&lt;/span&gt;)
		{
			aOCGs[i].state = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; ;
		}
	}
       ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The issue is identical to what described by the external links posted by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16715546" author="jjcool" created="Mon, 10 Dec 2018 20:56:38 +0000"  >&lt;p&gt;To know if an OCG is on or off (depending on the render destination):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;the local properties &quot;Usage/Export/ExportState&quot;, &quot;Usage/View/ViewState&quot; (falls back to ExportState), &quot;Usage/Print/PrintState&quot;  (falls back to ExportState) of the OCG&lt;/li&gt;
	&lt;li&gt;&quot;/OCProperties/ON&quot; contains enabled OCG&apos;s&lt;/li&gt;
	&lt;li&gt;&quot;/OCProperties/OFF&quot; contains disabled OCG&apos;s&lt;/li&gt;
	&lt;li&gt;&quot;/OCProperties/BaseState&quot;&lt;/li&gt;
	&lt;li&gt;&quot;ON&quot;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;From this starting point and the code from C. Alexander Leigh we get the expected result. &lt;/p&gt;</comment>
                            <comment id="16720013" author="jjcool" created="Thu, 13 Dec 2018 10:20:44 +0000"  >&lt;p&gt;Most of the needed Infrastructure already exists. &lt;br/&gt;
org.apache.pdfbox.pdmodel.graphics.optionalcontent.PDOptionalContentProperties.isGroupEnabled(String)  already executes steps 2. to 5.&lt;br/&gt;
org.apache.pdfbox.text.PDFMarkedContentExtractor already tracks the content groups.&lt;/p&gt;

&lt;p&gt;So the patch contains &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;move some code from org.apache.pdfbox.text.PDFMarkedContentExtractor to org.apache.pdfbox.contentstream.PDFStreamEngine&lt;/li&gt;
	&lt;li&gt;org.apache.pdfbox.pdmodel.graphics.optionalcontent.PDOptionalContentGroup executing step 1.&lt;/li&gt;
	&lt;li&gt;org.apache.pdfbox.rendering.PageDrawer finally controling the visibility.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="16722135" author="tilman" created="Sat, 15 Dec 2018 12:43:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjcool&quot; class=&quot;user-hover&quot; rel=&quot;jjcool&quot;&gt;jjcool&lt;/a&gt; thank you; I noticed that you make the assumption than rendering to graphics = print. This is wrong, see the demo code in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3359&quot; title=&quot;Drawing to Graphics2D / ScratchFileBuffer not closed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3359&quot;&gt;&lt;del&gt;PDFBOX-3359&lt;/del&gt;&lt;/a&gt;. So there should be a different way to pass this. The simplest way that comes into my mind is to set it like &lt;tt&gt;subsamplingAllowed&lt;/tt&gt;. The default should be VIEW. So PDFPrintable should also be changed so that it passes PRINT. Could you please change that and resubmit?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; does the code look like Stefan used your advice from 2016? Which was&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;We need to track the current layer and the stack of all current layers. C. provided some code doing that and we already have some code doing it (I&apos;m talking about the operators in org.apache.pdfbox.contentstream.operator.markedcontent). What is missing is some sort of filter based on that information.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="16722141" author="tilman" created="Sat, 15 Dec 2018 13:05:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjcool&quot; class=&quot;user-hover&quot; rel=&quot;jjcool&quot;&gt;jjcool&lt;/a&gt; why are you removing the 3 lines in PDFMarkedContentExtractor ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-        addOperator(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BeginMarkedContentSequenceWithProperties());
-        addOperator(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BeginMarkedContentSequence());
-        addOperator(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; EndMarkedContentSequence());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You are adding them in PDFGraphicsStreamEngine, but that one isn&apos;t extended by PDFMarkedContentExtractor, so I&apos;m wondering.&lt;/p&gt;

&lt;p&gt;(I&apos;m not saying it is wrong, I&apos;d just like to understand, because now I wonder whether &lt;tt&gt;PDFMarkedContentExtractor.beginMarkedContentSequence&lt;/tt&gt; will ever be called?)&lt;/p&gt;</comment>
                            <comment id="16722167" author="tilman" created="Sat, 15 Dec 2018 13:51:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjcool&quot; class=&quot;user-hover&quot; rel=&quot;jjcool&quot;&gt;jjcool&lt;/a&gt; try rendering the attached file  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12951890/12951890_1822-AGB.pdf&quot; title=&quot;1822-AGB.pdf attached to PDFBOX-4399&quot;&gt;1822-AGB.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;. There is a ClassCastException in PageDrawer when hitting &lt;tt&gt;/Document /MC1 BDC&lt;/tt&gt; in the content stream. That is a PDPropertyList but you&apos;re expecting a PDOptionalContentGroup.&lt;/p&gt;

&lt;p&gt;However I suspect that one is easy to fix:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            PDPropertyList propertyList = getPage().getResources().getProperties(tag);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (propertyList &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; PDOptionalContentGroup)
            {
                PDOptionalContentGroup group = (PDOptionalContentGroup) propertyList;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16722178" author="tilman" created="Sat, 15 Dec 2018 14:35:16 +0000"  >&lt;p&gt;Another one (NPE) e.g. with the file of &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3300&quot; title=&quot;Space rendered as missing glyph&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3300&quot;&gt;&lt;del&gt;PDFBOX-3300&lt;/del&gt;&lt;/a&gt; - change &lt;tt&gt;PDFRenderer.isGroupEnabled&lt;/tt&gt; to this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isGroupEnabled(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; groupName)
    {
        PDOptionalContentProperties ocProperties = document.getDocumentCatalog().getOCProperties();
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ocProperties == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || ocProperties.isGroupEnabled(groupName);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The document level OCG stuff can be missing even if it is present in the page resources.&lt;/p&gt;</comment>
                            <comment id="16722195" author="tilman" created="Sat, 15 Dec 2018 15:27:55 +0000"  >&lt;p&gt;There is a problem with the file from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4103&quot; title=&quot;Optional Content Groups with same names can&amp;#39;t have different visibility&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4103&quot;&gt;&lt;del&gt;PDFBOX-4103&lt;/del&gt;&lt;/a&gt;. Adobe Reader displays &quot;12&quot;, but PDFBox displays &quot;112&quot;.&lt;/p&gt;

&lt;p&gt;Luckily, the cause is the pitfall that was solved in that issue. For this, change this code in PDFRenderer:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isGroupEnabled(PDOptionalContentGroup group)
&#160;&#160;&#160; {
&#160;&#160;&#160;&#160;&#160;&#160;&#160; PDOptionalContentProperties ocProperties = document.getDocumentCatalog().getOCProperties();
&#160;&#160;&#160;&#160;&#160;&#160;&#160; &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ocProperties == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || ocProperties.isGroupEnabled(group);
&#160;&#160;&#160; }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And in PageDrawer, just pass the group and not the group name to &lt;tt&gt;isGroupEnabled&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16723045" author="jjcool" created="Mon, 17 Dec 2018 15:00:23 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I noticed that you make the assumption than rendering to graphics = print. This is wrong&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No problem changing the default of rendering to VIEW and PDFPrintable passing the new extra parameter. This way is preferable as it is preserving the semantics. &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;why are you removing the 3 lines in PDFMarkedContentExtractor ? ...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If, as mentioned, PDFMarkedContentExtractor is not a subclass of PDFGraphicsStreamEngine it is wrong and will be corrected. &lt;/p&gt;

&lt;p&gt;And thanks for the test cases &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="16723122" author="jjcool" created="Mon, 17 Dec 2018 16:20:26 +0000"  >&lt;p&gt;Attached a patch with the corrections. &lt;/p&gt;</comment>
                            <comment id="16724179" author="tilman" created="Tue, 18 Dec 2018 15:46:27 +0000"  >&lt;p&gt;Thanks, I retested it and now it works fine without changes, except that you forgot to change &quot;export&quot; to &quot;view&quot;.&lt;/p&gt;

&lt;p&gt;Now I&apos;ll wait for feedback from Andreas (as explained 3 days ago) and if ok, commit the whole thing. I&apos;ve targeted it to 2.0.14 so it can&apos;t be forgotten because we always check for unresolved issues before a release (which I expect to be in about 3 months, based on past experience).&lt;/p&gt;</comment>
                            <comment id="16724955" author="jjcool" created="Wed, 19 Dec 2018 12:25:53 +0000"  >&lt;p&gt;not a case of forgetfulness ... rendering to bitmap image the ExportState should be considered and not the ViewState as recommended in &lt;a href=&quot;https://www.adobe.com/content/dam/acom/en/devnet/pdf/pdfs/PDF32000_2008.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Adobes PDF32000_2008.pdf&lt;/a&gt; chapter 8.11.4.4:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt; Export dictionary (Optional). A dictionary containing one entry, ExportState, a name whose&lt;br/&gt;
value shall be either ON or OFF. This value shall indicate the&lt;br/&gt;
recommended state for content in this group when the document (or part of&lt;br/&gt;
it) is saved by a conforming reader to a format that does not support&lt;br/&gt;
optional content (for example, a raster image format).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;But this also should have nearly no impact because PDF&apos;s with differing View- and ExportState are very, very rare. Wonder if they exists. &lt;/p&gt;</comment>
                            <comment id="16725739" author="tilman" created="Thu, 20 Dec 2018 10:18:07 +0000"  >&lt;p&gt;Thanks. However they do exist... in your file. With &quot;View&quot; one sees yellow on the fields, with &quot;Export&quot; then it isn&apos;t there.&lt;/p&gt;</comment>
                            <comment id="16725915" author="jjcool" created="Thu, 20 Dec 2018 14:53:09 +0000"  >&lt;p&gt;I agree there is a need to open the render destination even for bitmap generation functions.&lt;br/&gt;
this new patch adds a call to renderImage with an additional destination parameter and a member defaultDestination in the style of subsamplingAllowed to PDFRenderer.&lt;br/&gt;
The initial value of defaultDestination is intentionally null as null represents the default behaviour: EXPORT for renderImage and VIEW for renderPageToGraphics&lt;/p&gt;
</comment>
                            <comment id="16736225" author="lehmi" created="Mon, 7 Jan 2019 19:32:11 +0000"  >&lt;p&gt;Sorry for the delay. I had a look and it looks good to me. I&apos;m not sure if it is always a good idea to omit the content if there aren&apos;t any properties defining the OCG, but maybe that&apos;s simply because I didn&apos;t understood every bit of that part of the spec (the clipping stuff etc.) As long as there aren&apos;t any regressions we are fine with the current approach.&lt;/p&gt;

&lt;p&gt;Maybe one could think about adding that stuff to the text extraction as well to suppress optional text. Does this make sense?&lt;/p&gt;</comment>
                            <comment id="16736259" author="tilman" created="Mon, 7 Jan 2019 19:49:03 +0000"  >&lt;p&gt;Thanks, I&apos;ll commit it later this week unless you do it. Today is too late and my next days may be busy &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;There are no regressions, only improvements.&lt;/p&gt;

&lt;p&gt;Adding it to text extraction too would make sense, OTOH nobody ever asked for it.&lt;/p&gt;</comment>
                            <comment id="16737346" author="tilman" created="Tue, 8 Jan 2019 18:03:04 +0000"  >&lt;p&gt;I&apos;m lucky to have some time today.&lt;/p&gt;

&lt;p&gt;I am getting an NPE in PageDrawer when building at &lt;tt&gt;PDPropertyList propertyList = getPage().getResources().getProperties(tag);&lt;/tt&gt;, for some reason &lt;tt&gt;getPage().getResources()&lt;/tt&gt; is null. I&apos;ll see whether I can fix this myself.&lt;/p&gt;

&lt;p&gt;Update: it&apos;s harmless, a page didn&apos;t have resources (which is OK).&lt;/p&gt;</comment>
                            <comment id="16737388" author="jira-bot" created="Tue, 8 Jan 2019 18:39:24 +0000"  >&lt;p&gt;Commit 1850779 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1850779&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1850779&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: consider OCG status when rendering, by Stefan Ziel&lt;/p&gt;</comment>
                            <comment id="16737427" author="jira-bot" created="Tue, 8 Jan 2019 19:10:55 +0000"  >&lt;p&gt;Commit 1850785 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1850785&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1850785&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: remove unused import&lt;/p&gt;</comment>
                            <comment id="16737432" author="jira-bot" created="Tue, 8 Jan 2019 19:14:44 +0000"  >&lt;p&gt;Commit 1850786 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1850786&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1850786&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: fix typo&lt;/p&gt;</comment>
                            <comment id="16737475" author="jira-bot" created="Tue, 8 Jan 2019 20:09:14 +0000"  >&lt;p&gt;Commit 1850788 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1850788&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1850788&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: remove unused imports&lt;/p&gt;</comment>
                            <comment id="16737477" author="jira-bot" created="Tue, 8 Jan 2019 20:10:40 +0000"  >&lt;p&gt;Commit 1850789 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1850789&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1850789&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: add @override&lt;/p&gt;</comment>
                            <comment id="16737484" author="jira-bot" created="Tue, 8 Jan 2019 20:19:31 +0000"  >&lt;p&gt;Commit 1850791 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1850791&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1850791&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: reduce levels&lt;/p&gt;</comment>
                            <comment id="16737489" author="jira-bot" created="Tue, 8 Jan 2019 20:24:27 +0000"  >&lt;p&gt;Commit 1850792 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1850792&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1850792&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: consider OCG status when rendering, by Stefan Ziel&lt;/p&gt;</comment>
                            <comment id="16737531" author="jira-bot" created="Tue, 8 Jan 2019 21:18:53 +0000"  >&lt;p&gt;Commit 1850795 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1850795&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1850795&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: restore accidental change&lt;/p&gt;</comment>
                            <comment id="16738444" author="tilman" created="Wed, 9 Jan 2019 17:10:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjcool&quot; class=&quot;user-hover&quot; rel=&quot;jjcool&quot;&gt;jjcool&lt;/a&gt; there&apos;s a problem with&#160; &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12954331/12954331_pop-bugzilla42823-OCG.pdf&quot; title=&quot;pop-bugzilla42823-OCG.pdf attached to PDFBOX-4399&quot;&gt;pop-bugzilla42823-OCG.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; that I found this morning and that wasn&apos;t in my test set. Page 2 has almost nothing rendered. It should display the Terms &amp;amp; Conditions in Czech language.&lt;/p&gt;

&lt;p&gt;Possible cause, after reading the PDF specification:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;When a piece of optional content in a PDF file is determined that it shall be hidden, the following occurs:&lt;br/&gt;
 &#8226;The content shall not be drawn.&lt;br/&gt;
 &#8226;Graphics state operations, such as setting the colour, transformation matrix, and clipping, shall still be applied. In addition, graphics state side effects that arise from drawing operators shall be applied; in particular, the current text position shall be updated even for text wrapped in optional content. In other words, graphics state parameters that persist past the end of a marked-content section shall be the same whether the optional content is visible or not.&lt;br/&gt;
 Hiding a section of optional content shall not change the colour of objects that do not belong to the same optional content group.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Now here&apos;s a part of the content stream of page 2:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /OC /MC3 BDC
  Q
  q
    0 0 595.276 841.89 re
    W
    n
    BT
      ...
    ET
  EMC
  /OC /MC4 BDC
    BT
      ...
    ET
  EMC
  /OC /MC5 BDC
    BT
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;MC3 and MC4 are hidden. So with the current code, &quot;Q q&quot; are lost so we&apos;re stuck with whatever has been set before. To test this theory, I added &quot;q&quot; and &quot;Q&quot; to &lt;tt&gt;isContentMarkOperator()&lt;/tt&gt; and now it displays. But the real solution is of course more complex. I suspect one must investigate every method in PageDrawer to disable the actual drawing and keep the rest, e.g. clipping.&lt;/p&gt;

&lt;p&gt;Another problem is on page 1. The two square radioboxes are rendered black, which didn&apos;t happen before.&lt;/p&gt;

&lt;p&gt;I then tried another solution: let everything through and put &lt;tt&gt;if (isContentRendered())&lt;/tt&gt; before every &quot;graphics.fill&quot;, &quot;graphics.draw&quot;, and &quot;graphics.drawImage&quot;, i.e. all graphics calls that &quot;do something visible&quot;, and also skip form XObjects and transparency groups.&lt;/p&gt;

&lt;p&gt;That looks nice, so I intend to do that soon.&lt;/p&gt;

&lt;p&gt;We also need code to skip annotations (/OC entry). I am trying to find a test file.&lt;/p&gt;</comment>
                            <comment id="16738545" author="jjcool" created="Wed, 9 Jan 2019 19:00:50 +0000"  >&lt;p&gt;I did not come over this section of PDF specification and considering it suppressing all operations from the stream is not correct but there should be a more elegant solution other than inserting lots of &quot;if&quot;s. Little nasty problem  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/tongue.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="16739561" author="jira-bot" created="Thu, 10 Jan 2019 16:10:35 +0000"  >&lt;p&gt;Commit 1850956 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1850956&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1850956&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: consider OCG from annotation&lt;/p&gt;</comment>
                            <comment id="16739562" author="jira-bot" created="Thu, 10 Jan 2019 16:10:39 +0000"  >&lt;p&gt;Commit 1850957 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1850957&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1850957&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: consider OCG from annotation&lt;/p&gt;</comment>
                            <comment id="16739569" author="tilman" created="Thu, 10 Jan 2019 16:16:02 +0000"  >&lt;p&gt;The file &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12954445/12954445_PDFBOX-4399-046615_p9_OCG-NoRotate-Annotations.pdf&quot; title=&quot;PDFBOX-4399-046615_p9_OCG-NoRotate-Annotations.pdf attached to PDFBOX-4399&quot;&gt;PDFBOX-4399-046615_p9_OCG-NoRotate-Annotations.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; is an example of an annotation with /OC entry. Prior to the commit the annotation would be shown (although in the wrong rotation), now it isn&apos;t shown.&lt;/p&gt;</comment>
                            <comment id="16739702" author="lehmi" created="Thu, 10 Jan 2019 19:16:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; Would it make sense to extend the Operator class (add a method like suppressMarkedContent:boolean) to mark those operations which have to be suppressed while processing?&lt;/p&gt;</comment>
                            <comment id="16739708" author="tilman" created="Thu, 10 Jan 2019 19:28:50 +0000"  >&lt;p&gt;The problem is most operations are not to be suppressed, only the actual painting. For example, &quot;in particular, the current text position shall be updated even for text wrapped in optional content&quot;.&lt;/p&gt;

&lt;p&gt;Re your earlier remark (text extraction), I wonder whether we should move the two methods from PageDrawer down to the StreamEngine, and only offer &quot;isContentRendered()&quot; to the subclasses? Because I thought that if we do something for the text stripper, we would probably just copy beginMarkedContentSequence() and endMarkedContentSequence() from PageDrawer, so we&apos;d have double code.&lt;/p&gt;</comment>
                            <comment id="16739816" author="lehmi" created="Thu, 10 Jan 2019 21:54:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;The problem is most operations are not to be suppressed, only the actual painting. For example, &quot;in particular, the current text position shall be updated even for text wrapped in optional content&quot;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It was just a quick thought, looks like the issue is more complicated&lt;/p&gt;

&lt;p&gt;wrt textextraction: good idea to move the code to the StreamEngine, so that all derivated classes might use them&lt;/p&gt;</comment>
                            <comment id="16740007" author="tilman" created="Fri, 11 Jan 2019 04:09:35 +0000"  >&lt;p&gt;OK, I&apos;ll just do the thing I mentioned 2 days ago. It&apos;s not difficult and it doesn&apos;t look THAT bad.&lt;/p&gt;

&lt;p&gt;I just tried the current text extraction with page 2 of the file I recently added - it&apos;s useful when not sorted, the English and the Czech ToS are separated from each other. It gets messy only when activating the sort feature.&lt;/p&gt;

&lt;p&gt;I&apos;ll investigate filtered extraction after committing the PageDrawer changes.&lt;/p&gt;</comment>
                            <comment id="16740130" author="jira-bot" created="Fri, 11 Jan 2019 07:56:19 +0000"  >&lt;p&gt;Commit 1851015 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1851015&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1851015&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: do graphics drawing operations and forms / transparency groups only when active OCG, but do all the rest all the time&lt;/p&gt;</comment>
                            <comment id="16740131" author="jira-bot" created="Fri, 11 Jan 2019 07:56:25 +0000"  >&lt;p&gt;Commit 1851016 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1851016&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1851016&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: do graphics drawing operations and forms / transparency groups only when active OCG, but do all the rest all the time&lt;/p&gt;</comment>
                            <comment id="16740140" author="jira-bot" created="Fri, 11 Jan 2019 08:01:55 +0000"  >&lt;p&gt;Commit 1851017 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1851017&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1851017&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: fix import&lt;/p&gt;</comment>
                            <comment id="16740270" author="jira-bot" created="Fri, 11 Jan 2019 10:33:56 +0000"  >&lt;p&gt;Commit 1851026 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1851026&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1851026&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: refactor&lt;/p&gt;</comment>
                            <comment id="16740271" author="jira-bot" created="Fri, 11 Jan 2019 10:34:00 +0000"  >&lt;p&gt;Commit 1851027 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1851027&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1851027&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: refactor&lt;/p&gt;</comment>
                            <comment id="16740500" author="jira-bot" created="Fri, 11 Jan 2019 15:46:36 +0000"  >&lt;p&gt;Commit 1851064 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1851064&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1851064&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: simplify javadoc&lt;/p&gt;</comment>
                            <comment id="16740501" author="jira-bot" created="Fri, 11 Jan 2019 15:46:41 +0000"  >&lt;p&gt;Commit 1851065 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1851065&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1851065&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: simplify javadoc&lt;/p&gt;</comment>
                            <comment id="16744394" author="tilman" created="Wed, 16 Jan 2019 19:31:11 +0000"  >&lt;p&gt;One can filter the active text in the stripper by adding this code:&lt;/p&gt;

&lt;p&gt;in constructor:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        addOperator(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BeginMarkedContentSequence());
        addOperator(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BeginMarkedContentSequenceWithProperties());
        addOperator(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; EndMarkedContentSequence());    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;At the beginning of processTextPosition:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isContentRendered())
        {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and at the end:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void beginMarkedContentSequence(COSName tag, COSDictionary properties)
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nestedHiddenOCGCount &amp;gt; 0)
        {
            nestedHiddenOCGCount++;
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tag == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || getCurrentPage().getResources() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        }
        PDPropertyList propertyList = getCurrentPage().getResources().getProperties(tag);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (propertyList &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; PDOptionalContentGroup)
        {
            PDOptionalContentGroup group = (PDOptionalContentGroup) propertyList;
            PDOptionalContentGroup.RenderState printState = group.getRenderState(RenderDestination.EXPORT &lt;span class=&quot;code-comment&quot;&gt;/**/&lt;/span&gt;);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (printState == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
            {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isGroupEnabled(group))
                {
                    nestedHiddenOCGCount = 1;
                }
            }
            &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (PDOptionalContentGroup.RenderState.OFF.equals(printState))
            {
                nestedHiddenOCGCount = 1;
            }
        }
    }

    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void endMarkedContentSequence()
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nestedHiddenOCGCount &amp;gt; 0)
        {
            nestedHiddenOCGCount--;
        }
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isContentRendered()
    {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nestedHiddenOCGCount &amp;lt;= 0;
    }
    
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; nestedHiddenOCGCount;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isGroupEnabled(PDOptionalContentGroup group) &lt;span class=&quot;code-comment&quot;&gt;/**/&lt;/span&gt;
    {
        PDOptionalContentProperties ocProperties = document.getDocumentCatalog().getOCProperties();
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ocProperties == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || ocProperties.isGroupEnabled(group);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After that worked I tried to move it to the base class and failed - we need PDPage and PDDocument. The base class doesn&apos;t have access to the document.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if we should pass PDDocument to the base class, although I don&apos;t see a reason against it.&lt;/p&gt;

&lt;p&gt;But considering that no user has asked for the feature, I&apos;m resolving this. We can still open a new issue.&lt;/p&gt;</comment>
                            <comment id="16744429" author="tilman" created="Wed, 16 Jan 2019 20:26:01 +0000"  >&lt;p&gt;And thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jjcool&quot; class=&quot;user-hover&quot; rel=&quot;jjcool&quot;&gt;jjcool&lt;/a&gt; for solving this!&lt;/p&gt;</comment>
                            <comment id="16775372" author="jira-bot" created="Fri, 22 Feb 2019 16:51:36 +0000"  >&lt;p&gt;Commit 1854146 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1854146&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1854146&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: DRY refactoring&lt;/p&gt;</comment>
                            <comment id="16775373" author="jira-bot" created="Fri, 22 Feb 2019 16:51:42 +0000"  >&lt;p&gt;Commit 1854147 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1854147&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1854147&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4399&quot; title=&quot;Disabled optional content groups are rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4399&quot;&gt;&lt;del&gt;PDFBOX-4399&lt;/del&gt;&lt;/a&gt;: DRY refactoring&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="13169503">PDFBOX-4257</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13485467">PDFBOX-5524</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12951890" name="1822-AGB.pdf" size="311475" author="tilman" created="Sat, 15 Dec 2018 13:49:53 +0000"/>
                            <attachment id="12954445" name="PDFBOX-4399-046615_p9_OCG-NoRotate-Annotations.pdf" size="57816" author="tilman" created="Thu, 10 Jan 2019 16:11:06 +0000"/>
                            <attachment id="12952549" name="PDFBOX-4399-2.patch" size="22488" author="jjcool" created="Thu, 20 Dec 2018 14:53:20 +0000"/>
                            <attachment id="12950837" name="gs.png" size="358152" author="jjcool" created="Thu, 6 Dec 2018 13:53:02 +0000"/>
                            <attachment id="12950833" name="original.pdf" size="182159" author="jjcool" created="Thu, 6 Dec 2018 13:44:07 +0000"/>
                            <attachment id="12954331" name="pop-bugzilla42823-OCG.pdf" size="1124102" author="tilman" created="Wed, 9 Jan 2019 17:11:04 +0000"/>
                            <attachment id="12950839" name="printed.png" size="374689" author="jjcool" created="Thu, 6 Dec 2018 13:56:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 38 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s018qw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>