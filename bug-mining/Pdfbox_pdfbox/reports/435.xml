<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:55:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1966] Type 1, 4 and 5 shadings for shFill()</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1966</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I found two images that didn&apos;t render properly. The reason is that the appropriate code was missing in shFill() (the code is there for axial and radial shading). I will fix this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12699484">PDFBOX-1966</key>
            <summary>Type 1, 4 and 5 shadings for shFill()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                            <label>shading</label>
                            <label>shadingpattern</label>
                    </labels>
                <created>Fri, 7 Mar 2014 19:24:00 +0000</created>
                <updated>Fri, 2 May 2014 06:12:08 +0000</updated>
                            <resolved>Sun, 9 Mar 2014 10:32:53 +0000</resolved>
                                    <version>1.8.4</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.8.5</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="300">5m</timeoriginalestimate>
                            <timeestimate seconds="300">5m</timeestimate>
                                        <comments>
                            <comment id="13924244" author="tilman" created="Fri, 7 Mar 2014 19:27:01 +0000"  >&lt;p&gt;The hsv file is from &lt;a href=&quot;http://www.texample.net/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.texample.net/&lt;/a&gt; . Tons of test files!!!&lt;/p&gt;</comment>
                            <comment id="13924248" author="jahewson" created="Fri, 7 Mar 2014 19:30:07 +0000"  >&lt;p&gt;You should be able to replace the switch statement in shFill with a call to PDPattern#toPaint to get rid of the code duplication. There&apos;s a TODO which says this.&lt;/p&gt;</comment>
                            <comment id="13924297" author="tilman" created="Fri, 7 Mar 2014 20:27:36 +0000"  >&lt;p&gt;Thanks for the hint, especially because I am a big fan of the DRY principle. This code works for me and creates all the shaded images:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        PDShadingPattern pdShadingPattern = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDShadingPattern();
        pdShadingPattern.setShading(shading);
        pdShadingPattern.setMatrix(ctm.createAffineTransform());
        Paint paint = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPattern(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;).toShadingPaint(pdShadingPattern, pageHeight);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Obviously, the PDPattern object does nothing except calling toShadingPaint(). The method does not use its own class - so I wonder, shouldn&apos;t I put the whole method in PDShading instead, and have ctm and pageHeight as parameter?&lt;/p&gt;</comment>
                            <comment id="13924686" author="jahewson" created="Sat, 8 Mar 2014 03:10:51 +0000"  >&lt;p&gt;No, toShadingPaint() shouldn&apos;t be moved to PDShading, that&apos;s actually where it previously had been before the color space refactoring. It was moved to PDPattern so that all color handling code is encapsulated inside color spaces, i.e. subclasses of PDColorSpace. Only subclasses of PDColorSpace and PageDrawer, and our xxxxPaint classes should know about AWT Paint.&lt;/p&gt;

&lt;p&gt;The only change you need is to reimplement shFill as you described, but you need to pass the current stream&apos;s resources to the PDPattern constructor and pass a PDColor to allow the pattern to be looked up by PDPattern:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Paint paint = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPattern(getResources().getPatterns())
        .toPaint(renderer, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDColor(shadingName.getName()), pageHeight);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13924692" author="jahewson" created="Sat, 8 Mar 2014 03:18:43 +0000"  >&lt;p&gt;I just realised: toTilingPaint and toShadingPaint should be private. I&apos;ve just fixed this in revision 1575475. This actually reinforces my point about encapsulation: toShadingPaint would have to be public if moved to PDShading which would expose internal implementation details to the public API.&lt;/p&gt;</comment>
                            <comment id="13924749" author="tilman" created="Sat, 8 Mar 2014 06:20:35 +0000"  >&lt;p&gt;This doesn&apos;t work, I get a NPE. The reason is that getResources().getPatterns() returns null. And this is because there&apos;s no pattern dictionary, and PDF allows this:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;This operator does not require the creation of a pattern dictionary or a path and works without reference to the current color in the graphics state&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13924752" author="tilman" created="Sat, 8 Mar 2014 06:45:37 +0000"  >&lt;p&gt;I also thought about creating a pattern dictionary and filling it, but at the end it looked like too much code to create just to get rid of the double code. What we need is some single method somewhere that takes a pattern, a matrix and a page height as an input and returns the appropriate paint. Maybe in a ShadingPaintFactory?&lt;/p&gt;

&lt;p&gt;I&apos;m also for thinking about how to get rid of that switch. In a perfect world, a derived class would &quot;do the right thing&quot; just because it is derived.&lt;/p&gt;</comment>
                            <comment id="13924844" author="tilman" created="Sat, 8 Mar 2014 13:21:21 +0000"  >&lt;p&gt;To have some working code first, I committed the changes in rev 1575540 for the trunk and in rev 1575539 for the 1.8 branch. The changes also include using transparency for the unimplemented types 6 and 7. The gwg tests (see &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1877&quot; title=&quot;Radial Shading (type 3) fails Ghent Workgroup tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1877&quot;&gt;&lt;del&gt;PDFBOX-1877&lt;/del&gt;&lt;/a&gt;) now have a nice &quot;X&quot; when rendered which is their &quot;you failed&quot; image.&lt;/p&gt;

&lt;p&gt;I&apos;m not yet setting this to resolve, per the ongoing discussion about how to best apply the DRY principle.&lt;/p&gt;</comment>
                            <comment id="13925101" author="jahewson" created="Sun, 9 Mar 2014 03:32:26 +0000"  >&lt;p&gt;Yeah, I see why you are getting an  NPE, the &lt;b&gt;sh&lt;/b&gt; operator is drawing a Shading directly instead of drawing it via a Pattern. That&apos;s somewhat awkward and doesn&apos;t fit nicely into the color space concept, as you&apos;ve spotted a Shading is not always a Pattern.&lt;/p&gt;

&lt;p&gt;Currently our various Paint subclasses in &lt;em&gt;org.apache.pdfbox.shading&lt;/em&gt; are all public, which I&apos;ve realised they shouldn&apos;t be, as they are internal to PDFBox and not part of the public API. I didn&apos;t include any of the shading classes in my color space / drawing refactoring as they were undergoing active development (and still are).&lt;/p&gt;

&lt;p&gt;Because a Shading is not necessarily a Pattern I agree with your original proposal to move toShadingPaint into PDShading because it is indeed possible to have an instance of Paint which does not come from a PDColorSpace and this is the most logical place for it to belong. This also gives me the opportunity to modify the visibility of the Paint and PaintContext subclasses to be private. I&apos;ve done this in revision 1575655 by giving each of the PDShading subclasses an overloaded toPaint method (which is nice and DRY) and I&apos;ve gone through each of the classes in &lt;em&gt;org.apache.pdfbox.shading&lt;/em&gt; and made them package-private where possible. Along the way I&apos;ve standardised some of the naming and formatting to facilitate future refactoring, but I haven&apos;t made any functional changes, nor do I plan to.&lt;/p&gt;</comment>
                            <comment id="13925171" author="tilman" created="Sun, 9 Mar 2014 10:32:53 +0000"  >&lt;p&gt;Yes, thanks, this is what I had in mind, we&apos;re now DRY-compliant and the switch is gone. I am setting this to resolved, I don&apos;t think it is needed to do the refactorings in the 1.8 branch.&lt;/p&gt;</comment>
                            <comment id="13925375" author="jahewson" created="Mon, 10 Mar 2014 01:01:44 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13987408" author="lehmi" created="Fri, 2 May 2014 06:12:08 +0000"  >&lt;p&gt;Closed after releasing PDFBox 1.8.5&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12633430" name="asy-functionshading.pdf" size="4834" author="tilman" created="Fri, 7 Mar 2014 19:27:01 +0000"/>
                            <attachment id="12633432" name="asy-functionshading.pdf-1.tif" size="8547" author="tilman" created="Fri, 7 Mar 2014 19:27:01 +0000"/>
                            <attachment id="12633431" name="hsv-shading.pdf" size="8914" author="tilman" created="Fri, 7 Mar 2014 19:27:01 +0000"/>
                            <attachment id="12633433" name="hsv-shading.pdf-1.png" size="25710" author="tilman" created="Fri, 7 Mar 2014 19:27:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>377831</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1t3sf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>378123</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>