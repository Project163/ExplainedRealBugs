<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:59:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2750] Rendering in poor quality in 2.0 but not in 1.8.*</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2750</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The attached PDF is rendered in poor quality in 2.0, but not in 1.8.* (submitted by Vanja K. on the user mailing list).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12819006">PDFBOX-2750</key>
            <summary>Rendering in poor quality in 2.0 but not in 1.8.*</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jahewson">John Hewson</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Apr 2015 18:01:53 +0000</created>
                <updated>Thu, 17 Mar 2016 19:07:31 +0000</updated>
                            <resolved>Wed, 8 Apr 2015 22:36:43 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14484626" author="jahewson" created="Wed, 8 Apr 2015 03:04:37 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;There is a background JPEG image of size 638 x 825 which contains coloured blobs&lt;/li&gt;
	&lt;li&gt;The JPEG image uses an CCITT explicit mask of size 2552 x 3300 which contains the text&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14485897" author="tilman" created="Wed, 8 Apr 2015 19:56:34 +0000"  >&lt;p&gt;I did a quick change locally (I resized the image file to the size of the mask file if it is smaller) to get a glimpse of improvements to come:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The file of &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2726&quot; title=&quot;org.apache.pdfbox.cos.COSArray cannot be cast to org.apache.pdfbox.cos.COSDictionary&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2726&quot;&gt;&lt;del&gt;PDFBOX-2726&lt;/del&gt;&lt;/a&gt; has slightly better quality now.&lt;/li&gt;
	&lt;li&gt;Pages 6 and 7 of &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2128&quot; title=&quot;CMYK images are not supported correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2128&quot;&gt;&lt;del&gt;PDFBOX-2128&lt;/del&gt;&lt;/a&gt;-573636.pdf are better, now bullet points appear (this is unrelated to &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1900&quot; title=&quot;ConvertToImage - pdf - checkbox wrongly rendered &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1900&quot;&gt;&lt;del&gt;PDFBOX-1900&lt;/del&gt;&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;A file I don&apos;t want to name had a lot of black bars, now no longer.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14485937" author="jahewson" created="Wed, 8 Apr 2015 20:22:07 +0000"  >&lt;p&gt;Setting rendering hints in PDImageXObject.applyMask also gives some improvement by using high-quality interpolation for the image scaling:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// scale mask to fit image
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (mask.getWidth() != width || mask.getHeight() != height)
{
    BufferedImage mask2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedImage(width, height, mask.getType());
    Graphics2D g = mask2.createGraphics();
    g.setRenderingHint(RenderingHints.KEY_INTERPOLATION,
                       RenderingHints.VALUE_INTERPOLATION_BICUBIC);
    g.setRenderingHint(RenderingHints.KEY_RENDERING,
                       RenderingHints.VALUE_RENDER_QUALITY);
    g.drawImage(mask, 0, 0, width, height, 0, 0, mask.getWidth(), mask.getHeight(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    g.dispose();
    mask = mask2;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14485944" author="jahewson" created="Wed, 8 Apr 2015 20:27:27 +0000"  >&lt;p&gt;Yes, the main problem appears to be that the mask is larger than the image and is being scaled-down. When rendering at a high DPI the combined image+mask is then scaled-up again, resulting in a low-quality image.&lt;/p&gt;

&lt;p&gt;Your solution of scaling the image to the mask, when the mask is larger should solve this. My only concern is that PDImageXObject.getImage() will then be producing the &quot;wrong&quot; sized image with respect to its API. Given that we already have getOpaqueImage() which returns the raw image, I don&apos;t think that it matters - we should just add a note to the getImage() JavaDoc that the size of the image will be the larger of the image itself or its mask. What do you think?&lt;/p&gt;</comment>
                            <comment id="14485969" author="tilman" created="Wed, 8 Apr 2015 20:39:21 +0000"  >&lt;p&gt;Yes, a notice in the javadoc is important. I&apos;ve been also wondering why nothing &quot;terrible&quot; (stuff cut off) happens when the image is drawn in the rendering (&quot;Do&quot; operator). The image size is bigger than the one in the dictionary, but it is still being rendered without cuts.&lt;/p&gt;</comment>
                            <comment id="14485980" author="jahewson" created="Wed, 8 Apr 2015 20:45:08 +0000"  >&lt;p&gt;I&apos;ve attached a patch which applies both techniques mentioned above and gives perfect rendering. I&apos;ll let you test it for regressions before it&apos;s committed.&lt;/p&gt;</comment>
                            <comment id="14485982" author="jahewson" created="Wed, 8 Apr 2015 20:46:48 +0000"  >&lt;p&gt;If you look in PageDrawer.drawBufferedImage you&apos;ll see that the images are scaled to the &quot;unit square&quot; using the dimensions of the resulting BufferedImage, rather than the PDImage dimensions, so everything &quot;just works&quot;.&lt;/p&gt;</comment>
                            <comment id="14486166" author="tilman" created="Wed, 8 Apr 2015 22:05:12 +0000"  >&lt;p&gt;Your patch works fine. There are differences to my own renderings (I didn&apos;t use any rendering hints in my local solution), but these are invisible to my eye.&lt;/p&gt;</comment>
                            <comment id="14486229" author="jira-bot" created="Wed, 8 Apr 2015 22:36:17 +0000"  >&lt;p&gt;Commit 1672207 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1672207&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1672207&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2750&quot; title=&quot;Rendering in poor quality in 2.0 but not in 1.8.*&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2750&quot;&gt;&lt;del&gt;PDFBOX-2750&lt;/del&gt;&lt;/a&gt;: Perform high-quality upscaling of image masks&lt;/p&gt;</comment>
                            <comment id="14486230" author="jahewson" created="Wed, 8 Apr 2015 22:36:36 +0000"  >&lt;p&gt;Patch with some DRY refactoring.&lt;/p&gt;</comment>
                            <comment id="14491701" author="lars t" created="Sun, 12 Apr 2015 20:35:10 +0000"  >&lt;p&gt;HINT: However, be aware that if you try to downscale an image by a factor of more than two (i.e., the scaled instance is less than half the size of the original), and you are using the BILINEAR or BICUBIC hint, the quality of the scaled instance may not be as smooth as you might like. ... you can use a multi-step approach when downscaling by more than two times; this helps prevent the information loss issue and produces a much higher quality result ... The basic idea here is to repeatedly scale the image by half (using BILINEAR filtering), and then, once the target size is near, perform one final scaling step to reach the target dimensions. ...&lt;/p&gt;

&lt;p&gt;FROM: &lt;a href=&quot;https://today.java.net/pub/a/today/2007/04/03/perils-of-image-getscaledinstance.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://today.java.net/pub/a/today/2007/04/03/perils-of-image-getscaledinstance.html&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12723674" name="PDFBOX-2750-1.8.jpg" size="1154364" author="tilman" created="Tue, 7 Apr 2015 18:03:37 +0000"/>
                            <attachment id="12723675" name="PDFBOX-2750-2.0.jpg" size="944174" author="tilman" created="Tue, 7 Apr 2015 18:03:37 +0000"/>
                            <attachment id="12724010" name="PDFBOX-2750.patch" size="3538" author="jahewson" created="Wed, 8 Apr 2015 20:45:08 +0000"/>
                            <attachment id="12723673" name="PDFBOX-2750.pdf" size="37065" author="tilman" created="Tue, 7 Apr 2015 18:03:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 31 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2cx6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>