<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:09:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4690] PDFBOX running out of memory when rendering into image</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4690</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I am running into Out of memory when trying to render attached PDF at page number 4.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&#160;&lt;/tt&gt;&lt;br/&gt;
{{ java.lang.OutOfMemoryError: Java heap spacejava.lang.OutOfMemoryError: Java heap space at java.awt.image.DataBufferInt.&amp;lt;init&amp;gt;(DataBufferInt.java:75) at java.awt.image.Raster.createPackedRaster(Raster.java:467) at java.awt.image.DirectColorModel.createCompatibleWritableRaster(DirectColorModel.java:1032) at java.awt.image.BufferedImage.&amp;lt;init&amp;gt;(BufferedImage.java:333) at org.apache.pdfbox.rendering.PageDrawer.drawImage(PageDrawer.java:979) at org.apache.pdfbox.contentstream.operator.graphics.DrawObject.process(DrawObject.java:62) at org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:848) at org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:503) at org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:477) at org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:150) at org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:246) at org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:225) at org.apache.pdfbox.rendering.PDFRenderer.renderImageWithDPI(PDFRenderer.java:164)}}&lt;/p&gt;</description>
                <environment>Docker Container with linux&lt;br/&gt;
I have allocated 10GB of RAM.&lt;br/&gt;
jdk8</environment>
        <key id="13268749">PDFBOX-4690</key>
            <summary>PDFBOX running out of memory when rendering into image</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hpandey90">Himanshu Pandey</reporter>
                        <labels>
                    </labels>
                <created>Sat, 16 Nov 2019 00:04:15 +0000</created>
                <updated>Fri, 25 Nov 2022 19:00:36 +0000</updated>
                                            <version>2.0.11</version>
                    <version>2.0.16</version>
                    <version>2.0.17</version>
                                                    <component>Rendering</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="16975581" author="tilman" created="Sat, 16 Nov 2019 05:18:01 +0000"  >&lt;p&gt;It uses 11GB. There&apos;s a giant temporary image 29314 x 46261 being created from a stencil image using a pattern &quot;color&quot; to fit the current size.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /R156 scn
  q
    3085.63 5738.89 229.008 627.875 re
    W
    n
    q
      293134 0 0 -462602 3085.63 468339 cm
      /R158 Do
    Q
  Q
  /R157 cs
  /R160 scn
  q
    1454.64 5101.84 221.191 663.57 re
    W
    n
    q
      276849 0 0 -476343 1457.1 481444 cm
      /R158 Do
    Q
  Q
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I created some code to limit that temporary image to the size of the device, using &lt;tt&gt;graphics.getDeviceConfiguration().getBounds()&lt;/tt&gt;. I&apos;ll commit this code after cleaning up what I did and having a second look.&lt;/p&gt;</comment>
                            <comment id="16975771" author="jira-bot" created="Sat, 16 Nov 2019 18:14:03 +0000"  >&lt;p&gt;Commit 1869898 from Tilman Hausherr in branch &apos;pdfbox/branches/issue4569&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1869898&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1869898&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4690&quot; title=&quot;PDFBOX running out of memory when rendering into image&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4690&quot;&gt;PDFBOX-4690&lt;/a&gt;: temp mask image should not be larger than the device&lt;/p&gt;</comment>
                            <comment id="16975772" author="jira-bot" created="Sat, 16 Nov 2019 18:14:07 +0000"  >&lt;p&gt;Commit 1869899 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1869899&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1869899&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4690&quot; title=&quot;PDFBOX running out of memory when rendering into image&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4690&quot;&gt;PDFBOX-4690&lt;/a&gt;: temp mask image should not be larger than the device&lt;/p&gt;</comment>
                            <comment id="16975773" author="jira-bot" created="Sat, 16 Nov 2019 18:14:11 +0000"  >&lt;p&gt;Commit 1869900 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1869900&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1869900&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4690&quot; title=&quot;PDFBOX running out of memory when rendering into image&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4690&quot;&gt;PDFBOX-4690&lt;/a&gt;: temp mask image should not be larger than the device&lt;/p&gt;</comment>
                            <comment id="16975774" author="jira-bot" created="Sat, 16 Nov 2019 18:14:18 +0000"  >&lt;p&gt;Commit 1869901 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1869901&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1869901&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4690&quot; title=&quot;PDFBOX running out of memory when rendering into image&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4690&quot;&gt;PDFBOX-4690&lt;/a&gt;: temp mask image should not be larger than the device&lt;/p&gt;</comment>
                            <comment id="16975918" author="tilman" created="Sun, 17 Nov 2019 05:36:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hpandey90&quot; class=&quot;user-hover&quot; rel=&quot;hpandey90&quot;&gt;hpandey90&lt;/a&gt; what jave version are you using? If jdk8, then my solution will work nicely. If later, then it won&apos;t.&lt;/p&gt;</comment>
                            <comment id="16975921" author="jira-bot" created="Sun, 17 Nov 2019 05:51:25 +0000"  >&lt;p&gt;Commit 1869912 from Tilman Hausherr in branch &apos;pdfbox/branches/issue4569&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1869912&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1869912&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4690&quot; title=&quot;PDFBOX running out of memory when rendering into image&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4690&quot;&gt;PDFBOX-4690&lt;/a&gt;: simplify code&lt;/p&gt;</comment>
                            <comment id="16975922" author="jira-bot" created="Sun, 17 Nov 2019 05:52:04 +0000"  >&lt;p&gt;Commit 1869913 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1869913&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1869913&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4690&quot; title=&quot;PDFBOX running out of memory when rendering into image&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4690&quot;&gt;PDFBOX-4690&lt;/a&gt;: simplify code&lt;/p&gt;</comment>
                            <comment id="16975923" author="jira-bot" created="Sun, 17 Nov 2019 05:52:29 +0000"  >&lt;p&gt;Commit 1869914 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1869914&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1869914&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4690&quot; title=&quot;PDFBOX running out of memory when rendering into image&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4690&quot;&gt;PDFBOX-4690&lt;/a&gt;: simplify code&lt;/p&gt;</comment>
                            <comment id="16975924" author="jira-bot" created="Sun, 17 Nov 2019 05:52:56 +0000"  >&lt;p&gt;Commit 1869915 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1869915&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1869915&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4690&quot; title=&quot;PDFBOX running out of memory when rendering into image&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4690&quot;&gt;PDFBOX-4690&lt;/a&gt;: simplify code&lt;/p&gt;</comment>
                            <comment id="16976763" author="hpandey90" created="Mon, 18 Nov 2019 18:20:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt;&#160;I am using JDK8&lt;/p&gt;</comment>
                            <comment id="16976801" author="hpandey90" created="Mon, 18 Nov 2019 19:10:16 +0000"  >&lt;p&gt;Do we have a public method to somehow disable a stencil image?&lt;/p&gt;</comment>
                            <comment id="16976853" author="tilman" created="Mon, 18 Nov 2019 20:17:13 +0000"  >&lt;p&gt;No, you would have to extend/replace PageDrawer.java which is somewhat tricky and your PDFs won&apos;t look good. Stencil images are usually harmless, this is just a badly made PDF. There are many ways in PDF to exploit its algorithmic complexity vulnerabilities.&lt;/p&gt;

&lt;p&gt;There will have to be a better solution in the future, maybe (tricky) use the clipping region to limit the size, or (easier) put a hard limit like already done in TilingPaint. There the size is limited to 3000 x 3000. (can be set higher if wanted)&lt;/p&gt;</comment>
                            <comment id="17028980" author="hpandey90" created="Mon, 3 Feb 2020 14:15:04 +0000"  >&lt;p&gt;Any update on timeline when we can release the fix in new version? This is breaking my production application.&lt;/p&gt;</comment>
                            <comment id="17030882" author="tilman" created="Wed, 5 Feb 2020 17:59:13 +0000"  >&lt;p&gt;No... you&apos;ll have to add RAM or to decrease your dpi.&lt;/p&gt;</comment>
                            <comment id="17365222" author="lanshiqin" created="Fri, 18 Jun 2021 03:13:43 +0000"  >&lt;p&gt;I found a way to prevent OOM, the maximum memory only needs 200MB&#65292;Please merge my example request&#12290;&lt;/p&gt;

&lt;p&gt;you can set jvm -Xmx200m&lt;/p&gt;

&lt;p&gt;modify you code&#65306;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// 1. Load document with temp file only
&lt;/span&gt;PDDocument.load(in, MemoryUsageSetting.setupTempFileOnly())

&lt;span class=&quot;code-comment&quot;&gt;// 2. Indicates that the renderer is allowed to sub sample the image before drawing.
&lt;/span&gt;renderer.setSubsamplingAllowed(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17365240" author="tilman" created="Fri, 18 Jun 2021 04:50:49 +0000"  >&lt;p&gt;&quot;merge&quot;? merge what?&lt;/p&gt;</comment>
                            <comment id="17365242" author="tilman" created="Fri, 18 Jun 2021 04:59:10 +0000"  >&lt;p&gt;and activating subsampling didn&apos;t help me displaying p4 at 72 dpi&lt;/p&gt;</comment>
                            <comment id="17638742" author="jira-bot" created="Fri, 25 Nov 2022 18:55:28 +0000"  >&lt;p&gt;Commit 1905530 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1905530&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1905530&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4690&quot; title=&quot;PDFBOX running out of memory when rendering into image&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4690&quot;&gt;PDFBOX-4690&lt;/a&gt;: revert 1869900 because of JDK-8072682&lt;/p&gt;</comment>
                            <comment id="17638744" author="jira-bot" created="Fri, 25 Nov 2022 18:56:39 +0000"  >&lt;p&gt;Commit 1905531 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1905531&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1905531&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4690&quot; title=&quot;PDFBOX running out of memory when rendering into image&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4690&quot;&gt;PDFBOX-4690&lt;/a&gt;: revert 1869901 because of JDK-8072682&lt;/p&gt;</comment>
                            <comment id="17638748" author="tilman" created="Fri, 25 Nov 2022 19:00:36 +0000"  >&lt;p&gt;I have reverted my changes from 2019 because of weird effects explained in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5547&quot; title=&quot;Wrong rectangle in image with stencil&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5547&quot;&gt;&lt;del&gt;PDFBOX-5547&lt;/del&gt;&lt;/a&gt;. I should have read the linked JDK issue more deeply - the strategy with &lt;tt&gt;graphics.getDeviceConfiguration().getBounds()&lt;/tt&gt; doesn&apos;t work at all. The jdk8 code has a bug, and the jdk9+ code returns MAXINT. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13505804">PDFBOX-5547</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12985997" name="crash.pdf" size="1232596" author="hpandey90" created="Fri, 15 Nov 2019 23:59:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 50 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z08oqw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>