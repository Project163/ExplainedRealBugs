<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:54:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1625] java.lang.IndexOutOfBoundsException at writing PDF file</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1625</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I got this error:&lt;/p&gt;

&lt;p&gt;i will just recreate a document with pages 1-6.&lt;/p&gt;


&lt;p&gt;Exception in thread &quot;main&quot; java.io.IOException: org.apache.pdfbox.exceptions.COSVisitorException: java.lang.IndexOutOfBoundsException: Index: 115, Size: 0&lt;br/&gt;
	at de.back2heaven.pdf.model.TargetDocumuent.save(TargetDocumuent.java:56)&lt;br/&gt;
	at de.back2heaven.pdf.model.Document.prozess(Document.java:76)&lt;br/&gt;
	at de.back2heaven.pdf.model.Document.main(Document.java:56)&lt;br/&gt;
Caused by: org.apache.pdfbox.exceptions.COSVisitorException: java.lang.IndexOutOfBoundsException: Index: 115, Size: 0&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.visitFromStream(COSWriter.java:1354)&lt;br/&gt;
	at org.apache.pdfbox.cos.COSStream.accept(COSStream.java:217)&lt;br/&gt;
	at org.apache.pdfbox.cos.COSObject.accept(COSObject.java:206)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.doWriteObject(COSWriter.java:525)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.doWriteBody(COSWriter.java:435)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.visitFromDocument(COSWriter.java:1122)&lt;br/&gt;
	at org.apache.pdfbox.cos.COSDocument.accept(COSDocument.java:552)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.write(COSWriter.java:1501)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.PDDocument.save(PDDocument.java:1324)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.PDDocument.save(PDDocument.java:1305)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.PDDocument.save(PDDocument.java:1292)&lt;br/&gt;
	at de.back2heaven.pdf.model.TargetDocumuent.save(TargetDocumuent.java:54)&lt;br/&gt;
	... 2 more&lt;br/&gt;
Caused by: java.lang.IndexOutOfBoundsException: Index: 115, Size: 0&lt;br/&gt;
	at java.util.ArrayList.rangeCheck(ArrayList.java:604)&lt;br/&gt;
	at java.util.ArrayList.get(ArrayList.java:382)&lt;br/&gt;
	at org.apache.pdfbox.io.RandomAccessBuffer.seek(RandomAccessBuffer.java:84)&lt;br/&gt;
	at org.apache.pdfbox.io.RandomAccessFileInputStream.read(RandomAccessFileInputStream.java:96)&lt;br/&gt;
	at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)&lt;br/&gt;
	at java.io.BufferedInputStream.read1(BufferedInputStream.java:275)&lt;br/&gt;
	at java.io.BufferedInputStream.read(BufferedInputStream.java:334)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.visitFromStream(COSWriter.java:1337)&lt;br/&gt;
	... 13 more&lt;/p&gt;</description>
                <environment>Linux, Java 7u21 </environment>
        <key id="12651091">PDFBOX-1625</key>
            <summary>java.lang.IndexOutOfBoundsException at writing PDF file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gbm.bailleul">Guillaume Bailleul</assignee>
                                    <reporter username="jenskapitza">Jens Kapitza</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Jun 2013 11:36:24 +0000</created>
                <updated>Thu, 20 Nov 2014 18:11:41 +0000</updated>
                            <resolved>Wed, 15 Jan 2014 21:35:27 +0000</resolved>
                                    <version>1.8.2</version>
                                    <fixVersion>1.8.4</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Writing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13675820" author="jenskapitza" created="Wed, 5 Jun 2013 11:39:43 +0000"  >&lt;p&gt;code&lt;/p&gt;</comment>
                            <comment id="13675826" author="jenskapitza" created="Wed, 5 Jun 2013 11:45:35 +0000"  >&lt;p&gt;pdf is to large here is the link&lt;br/&gt;
&lt;a href=&quot;https://horde.back2heaven.de/services/download/?app=gollem&amp;amp;dir=%2Fjens&amp;amp;backend=file&amp;amp;fn=%2Fblaba.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://horde.back2heaven.de/services/download/?app=gollem&amp;amp;dir=%2Fjens&amp;amp;backend=file&amp;amp;fn=%2Fblaba.pdf&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13675838" author="jenskapitza" created="Wed, 5 Jun 2013 11:57:26 +0000"  >&lt;p&gt;Fix workaround &lt;/p&gt;

&lt;p&gt;(don&apos;t close the document where i&apos;m importing pages from)&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;why is there a dependency to the imported pages? or how can this fixed?&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13726371" author="gbm.bailleul" created="Thu, 1 Aug 2013 12:04:54 +0000"  >&lt;p&gt;I commited with r1509187 a patch that make calls on closed RandomAccessBuffer throw IOException in place of the runtime. It is now working like RandomAccessFile.&lt;/p&gt;

&lt;p&gt;That does not fix the problem, but the Exception is clearer.&lt;/p&gt;

&lt;p&gt;I am still on the real problem, but the COS layer is a headache for me&lt;/p&gt;</comment>
                            <comment id="13727516" author="gbm.bailleul" created="Fri, 2 Aug 2013 09:51:00 +0000"  >&lt;p&gt;noclose.patch fixes the problem.&lt;/p&gt;

&lt;p&gt;It is only a base for discussion.&lt;/p&gt;

&lt;p&gt;The idea is to count the COS objects that are using a specific RandomAccess object. When a COS object calls the close method on RandomAccess, the counter is decremented.&lt;br/&gt;
The RandomAccess is closed when the counter value is 0.&lt;/p&gt;

&lt;p&gt;Pro : it works, RandomAccessBuffer are not duplicated&lt;br/&gt;
Con : Each COS object using a RandomAccess must call the register method, one forgotten could be hard to localize&lt;/p&gt;

&lt;p&gt;WDYT of that ?&lt;/p&gt;</comment>
                            <comment id="13727543" author="msahyoun" created="Fri, 2 Aug 2013 10:25:24 +0000"  >&lt;p&gt;Hi Guillaume,&lt;/p&gt;

&lt;p&gt;I think this is a very good handling of the current situation. Maybe PDDocument.close or COSDocument.close can be included too such as if one closes PDDocument all open RA are also closed.&lt;/p&gt;

&lt;p&gt;Maybe we can revisit this in a future release as I&apos;d think that e.g. cloning or PDPage imports etc. should no longer have a dependency on the source.&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="13727558" author="gbm.bailleul" created="Fri, 2 Aug 2013 10:48:37 +0000"  >&lt;p&gt;Here is a second patch, it contains the first one plus the modification on COSDocument.&lt;/p&gt;

&lt;p&gt;There is nothing to change in PDDocument (well .. I think)&lt;/p&gt;

&lt;p&gt;I am not sure cloning is the good option. In some use case, the memory usage will be too big. &lt;/p&gt;

&lt;p&gt;I think the good way is to have a RandomAccess manager, that keep state of all RandomAccess and ensure useful caching. This is hard to do with the current version of the COS layer but it could be interesting to discuss that in when we will rearchitect the COS layer (I am volunteer to work on that part but not alone)&lt;/p&gt;</comment>
                            <comment id="13727638" author="msahyoun" created="Fri, 2 Aug 2013 12:44:16 +0000"  >&lt;p&gt;I&apos;m happy to help working on the COS layer (currently working on the parser/lexer). Maybe we share some ideas and get them documented on the ideas page for 2.0.&lt;/p&gt;

&lt;p&gt;As for cloning etc. I&apos;d prefer buffering on disc (if needed) on the new document instead of keeping files open. E.g. for a customer we are merging 50.000 files that&apos;s a lot of resources to keep open. And I think it simply is not inline with ones expectation that cloning or importing means referencing to some extend. &lt;/p&gt;</comment>
                            <comment id="13727914" author="gbm.bailleul" created="Fri, 2 Aug 2013 18:16:20 +0000"  >&lt;p&gt;After some more tests, the patches are not working &quot;well&quot;.&lt;/p&gt;

&lt;p&gt;I have a problem with COSStream that creates many RandomAccessFile&lt;span class=&quot;error&quot;&gt;&amp;#91;Input|Output&amp;#93;&lt;/span&gt;Stream and never close them.&lt;/p&gt;</comment>
                            <comment id="13842583" author="gbm.bailleul" created="Sun, 8 Dec 2013 19:03:32 +0000"  >&lt;p&gt;This patch fixes the issue but clone each RandomAccessBuffer&lt;/p&gt;</comment>
                            <comment id="13871233" author="gbm.bailleul" created="Tue, 14 Jan 2014 21:38:25 +0000"  >&lt;p&gt;Can some COS layer expert have a look at the patch I put the 8 of december. It is still  valid with the trunk version.&lt;/p&gt;

&lt;p&gt;As I am not &quot;COS fluent&quot; and I am quite new on this part of the project, I would prefer to have it reviewed before I commit it.&lt;/p&gt;</comment>
                            <comment id="13871276" author="lehmi" created="Tue, 14 Jan 2014 22:17:24 +0000"  >&lt;p&gt;To separate the input and the output file we have to do something like that. The whole stream management isn&apos;t really elegant and has to be overhauled, but AFAIK nobody is on that topic. So, IMO your change is ok for now and will fix the issue.&lt;/p&gt;</comment>
                            <comment id="13872633" author="gbm.bailleul" created="Wed, 15 Jan 2014 21:35:27 +0000"  >&lt;p&gt;The patch has been applied on r1558570.&lt;/p&gt;</comment>
                            <comment id="13872658" author="lehmi" created="Wed, 15 Jan 2014 22:03:33 +0000"  >&lt;p&gt;Added the changes to the 1.8 branch in revision 1558585&lt;/p&gt;</comment>
                            <comment id="14219691" author="tchojecki" created="Thu, 20 Nov 2014 18:11:41 +0000"  >&lt;p&gt;I have some problems with the clone patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;br/&gt;
Trying to resolve some OOM and performance issues for &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2512&quot; title=&quot;OutOfMemory while signing large documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2512&quot;&gt;&lt;del&gt;PDFBOX-2512&lt;/del&gt;&lt;/a&gt; and I&apos;m stuck with the changes from the clone.patch&lt;/p&gt;

&lt;p&gt;The line &quot;return ((RandomAccessBuffer)file).clone();&quot; cause a OOM for documents with many / large streams. I my case the scratchfile (if I use a RandomAccessFile) grows to about 140MB. So the only fix for the &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2512&quot; title=&quot;OutOfMemory while signing large documents&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2512&quot;&gt;&lt;del&gt;PDFBOX-2512&lt;/del&gt;&lt;/a&gt; issue is to use a RandomAccessFile.&lt;/p&gt;

&lt;p&gt;Undoing the clone patch cause four tests to fail.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12652165">PDFBOX-1635</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12652165">PDFBOX-1635</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12694493">PDFBOX-1907</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12617650" name="clone.patch" size="3159" author="gbm.bailleul" created="Sun, 8 Dec 2013 19:03:32 +0000"/>
                            <attachment id="12586296" name="pdftool.zip" size="8828" author="jenskapitza" created="Wed, 5 Jun 2013 11:39:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>331417</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1l6bj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>331749</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>