<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:10:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4750] java.io.IOException: Error:Unknown type in content stream:COSNull{}</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4750</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;By removing some optional content for specific document, which is bordered with Operator BDC and EMC, we are facing an issue by writing the changed set of tokens into PDStream. &lt;br/&gt;
 The code looks like:&lt;br/&gt;
 PDStream updatedStream = new PDStream(document);&lt;br/&gt;
 OutputStream out = updatedStream.getCOSObject().createRawOutputStream();&lt;br/&gt;
 ContentStreamWriter tokenWriter = new ContentStreamWriter(out);&lt;br/&gt;
 tokenWriter.writeTokens(result);&lt;br/&gt;
 out.flush();&lt;br/&gt;
 out.close();&lt;br/&gt;
 page.setContents(updatedStream);&lt;br/&gt;
 &#160;&lt;br/&gt;
 The following exception occurs at line &apos;tokenWriter.writeTokens(result);&apos; :&lt;br/&gt;
 java.io.IOException: Error:Unknown type in content stream:COSNull{}&lt;br/&gt;
 at org.apache.pdfbox.pdfwriter.ContentStreamWriter.writeObject(ContentStreamWriter.java:199)&lt;br/&gt;
 at org.apache.pdfbox.pdfwriter.ContentStreamWriter.writeObject(ContentStreamWriter.java:146)&lt;br/&gt;
 at org.apache.pdfbox.pdfwriter.ContentStreamWriter.writeObject(ContentStreamWriter.java:181)&lt;br/&gt;
 at org.apache.pdfbox.pdfwriter.ContentStreamWriter.writeTokens(ContentStreamWriter.java:109)&lt;br/&gt;
 at de.justiz.eip.pdf.tools.PdfContext.getOrRemoveOptionalTextContentfromPage(PdfContext.java:429)&lt;br/&gt;
 at de.justiz.eip.pdf.tools.paging.PagingInfoInterpreterPdfContext.removePagingInfo(PagingInfoInterpreterPdfContext.java:325)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;After the analyze we figured out two issues:&lt;br/&gt;
 1. We assume, the Pdf Document it&apos;s self is corrupted, It contains on some place operator BI, which is based on the PDF-Reference-V1.7 a begin of inline image object. This Operator is not followed by &quot;ID&quot; or &quot;EI&quot; operator. &lt;br/&gt;
 Extract from list of Tokens:&lt;br/&gt;
 next PDFOperator{Do}&lt;/p&gt;

&lt;p&gt;next COSFloat{0.016674607}&lt;/p&gt;

&lt;p&gt;next COSInt{0}&lt;br/&gt;
 next COSInt{0}&lt;/p&gt;

&lt;p&gt;next COSFloat{0.061831153}&lt;/p&gt;

&lt;p&gt;next COSFloat{0.070509767}&lt;/p&gt;

&lt;p&gt;next COSFloat{-0.302021403}&lt;br/&gt;
 next PDFOperator{cm}&lt;/p&gt;

&lt;p&gt;next PDFOperator{BI}&lt;/p&gt;

&lt;p&gt;next PDFOperator{Q}&lt;br/&gt;
 next PDFOperator{Q}&lt;/p&gt;

&lt;p&gt;next COSName{OC}&lt;/p&gt;

&lt;p&gt;next COSName{eAkteOptionalContent7}&lt;/p&gt;

&lt;p&gt;next PDFOperator{BDC}&lt;/p&gt;

&lt;p&gt;Moreover one &quot;DP&quot; Entry in the &quot;BI&quot; operator&apos;s COSDictionary contains COSArray with COSNull values. However the assumption is, that the COSNull values are not forbidden in the Pdf content. &lt;br/&gt;
 COSDictionary{COSName&lt;/p&gt;
{Interpolate}
&lt;p&gt;:true;COSName{W}:COSInt{35};COSName{H}:COSInt{26};COSName{CS}:COSName{RGB};COSName{BPC}:COSInt{8};COSName{F}:COSArray{[COSName&lt;/p&gt;
{A85}
&lt;p&gt;,COSName{DCT}]};COSName{DP}:COSArray{&lt;span class=&quot;error&quot;&gt;&amp;#91;COSNull{},COSNull{}&amp;#93;&lt;/span&gt;};}&lt;/p&gt;

&lt;p&gt;2. Despite wrong content in the pdf-document (described above) the PDF-Box api crashed by storing this operators into PDStream by his inability to recognize COSNull in the method org.apache.pdfbox.pdfwriter.ContentStreamWriter.writeObject(Object)&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The assumption on this place is, that the method &quot;writeObject&quot; forgot to cover COSNull&#160; as an valid input. The org.apache.pdfbox.cos.COSNull.NULL is valid Object, which is broadly used by PDF-Api itself.&lt;/p&gt;

&lt;p&gt;The Method org.apache.pdfbox.pdfwriter.ContentStreamWriter.writeObject(Object)&#160; PDF-Api 2.0.8, also in 2.0.18 doesn&apos;t cover the COSNull&#160; case in it&apos;s if/else conditions, instead of it throws the new IOException( &quot;Error:Unknown type in content stream:&quot; + o ). &lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Could you confirm, that the method writeObject contains bug and should be corrected to cover also COSNull Object? If so, in which version could we expect the fix?&lt;/p&gt;


&lt;p&gt;Thank you&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13281143">PDFBOX-4750</key>
            <summary>java.io.IOException: Error:Unknown type in content stream:COSNull{}</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="tomas.kochan@sk.ibm.com">tomas kochan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Jan 2020 09:10:54 +0000</created>
                <updated>Tue, 30 Jun 2020 06:13:09 +0000</updated>
                            <resolved>Sun, 26 Jan 2020 10:48:45 +0000</resolved>
                                    <version>2.0.8</version>
                    <version>2.0.18</version>
                                    <fixVersion>2.0.19</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Writing</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17022405" author="tilman" created="Thu, 23 Jan 2020 19:25:51 +0000"  >&lt;p&gt;Can you share the file? /DP here is an abbreviation for DecodeParms, which can be an array of dictionaries. It almost makes sense, the filter is an array with 2 elements, A85 and DCT, so DecodeParms if it exists, should have two entries. And yes, it seems that we should support null.&lt;/p&gt;

&lt;p&gt;If you can&apos;t share the file, could you share a screenshot of the content stream? Open it with PDFDebugger and then search the content stream for &quot;/DP&quot; or &quot;null&quot;.&lt;/p&gt;</comment>
                            <comment id="17022684" author="tomas.kochan@sk.ibm.com" created="Fri, 24 Jan 2020 04:46:57 +0000"  >&lt;p&gt;I attached the whole content of corrupted page, extracted from PDFDebugger. At the end you can see the operator /DP:&lt;/p&gt;

&lt;p&gt;/Interpolate true &lt;br/&gt;
/W 35 &lt;br/&gt;
/H 26 &lt;br/&gt;
/CS /RGB &lt;br/&gt;
/BPC 8 &lt;br/&gt;
/F [ /A85 /DCT ] &lt;br/&gt;
/DP [ ]&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Unfortunately I can&apos;t share the original pdf file.&lt;/p&gt;</comment>
                            <comment id="17022695" author="tilman" created="Fri, 24 Jan 2020 05:13:15 +0000"  >&lt;p&gt;Uhm, if you can&apos;t share the file, then I hope the actual content here isn&apos;t confidential, the text starts with &quot;in der von uns unter&quot; so check whether the page text is harmless.&lt;/p&gt;

&lt;p&gt;The /DP [   ] segment is just three spaces. Could it be that the &quot;null&quot; thing is in another page? Or check with the hex viewer in PDFDebugger. Or was the &quot;null&quot; inserted by the software that modified the content stream? Or was something lost in copy &amp;amp; paste?&lt;/p&gt;

&lt;p&gt;This code works fine:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
PDFStreamParser parser = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFStreamParser(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;contentAllOperatorsOfCorruptedPage.txt&quot;&lt;/span&gt;));
parser.parse();
List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; tokens = parser.getTokens();
ContentStreamWriter tokenWriter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ContentStreamWriter(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream());
tokenWriter.writeTokens(tokens);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17022743" author="tomas.kochan@sk.ibm.com" created="Fri, 24 Jan 2020 07:58:44 +0000"  >&lt;p&gt;Yes the /DP segment was by PDFDebugger transformed into spaces - Probably he can correctly recognize COSNull Element and write it as a empty string in the result - you can check it in your code. No the null thing is on the page I sent you.&lt;/p&gt;

&lt;p&gt;When I am debugging the content of the Document, I can see the following Java Objects:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;PDFStreamParser parser = new PDFStreamParser(page);
	&lt;ol&gt;
		&lt;li&gt;loop parser.getTokens()&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;One Token is PDFOperator{BI} - saved in local property op&lt;/li&gt;
	&lt;li&gt;COSDictionary dic = op.getImageParameters();&lt;/li&gt;
	&lt;li&gt;dic.toString() returns: COSDictionary{COSName
{Interpolate}
&lt;p&gt;:true;COSName{W}:COSInt{35};COSName{H}:COSInt{26};COSName{CS}:COSName{RGB};COSName{BPC}:COSInt{8};COSName{F}:COSArray{[COSName&lt;/p&gt;
{A85}
&lt;p&gt;, COSName{DCT}]};COSName{DP}:COSArray{&lt;span class=&quot;error&quot;&gt;&amp;#91;COSNull{}, COSNull{}&amp;#93;&lt;/span&gt;};}&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I am checking if I can share the whole file with you, but I think it&apos;s not necessary. The method ContentStreamWriter.writeObject should accept COSNull Object in the same way as the PDFDebugger does.&lt;/p&gt;</comment>
                            <comment id="17022862" author="tomas.kochan@sk.ibm.com" created="Fri, 24 Jan 2020 10:54:42 +0000"  >&lt;p&gt;The document doesn&apos;t contain confidential data. I&apos;ve attached it here. The COSNull Element appears at Page 8.&lt;/p&gt;</comment>
                            <comment id="17023165" author="tilman" created="Fri, 24 Jan 2020 18:29:53 +0000"  >&lt;p&gt;Thank you. I&apos;ll fix this, also the bug in PDFDebugger, and it will be in the next release and until then in a snapshot (after comitting).&lt;/p&gt;</comment>
                            <comment id="17023168" author="tomas.kochan@sk.ibm.com" created="Fri, 24 Jan 2020 18:34:09 +0000"  >&lt;p&gt;Thank you as well. Could you please tell me when the next release is expecting to be available?&lt;/p&gt;</comment>
                            <comment id="17023187" author="tilman" created="Fri, 24 Jan 2020 19:09:18 +0000"  >&lt;p&gt;We usually do releases every 3-4 months, and the last one was around christmas.&lt;/p&gt;</comment>
                            <comment id="17023191" author="jira-bot" created="Fri, 24 Jan 2020 19:19:54 +0000"  >&lt;p&gt;Commit 1873112 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873112&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873112&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: show null object in content stream pane&lt;/p&gt;</comment>
                            <comment id="17023192" author="jira-bot" created="Fri, 24 Jan 2020 19:19:57 +0000"  >&lt;p&gt;Commit 1873113 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873113&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873113&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: show null object in content stream pane&lt;/p&gt;</comment>
                            <comment id="17023193" author="jira-bot" created="Fri, 24 Jan 2020 19:20:00 +0000"  >&lt;p&gt;Commit 1873114 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873114&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873114&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: show null object in content stream pane&lt;/p&gt;</comment>
                            <comment id="17023466" author="jira-bot" created="Sat, 25 Jan 2020 09:11:53 +0000"  >&lt;p&gt;Commit 1873133 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873133&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: allow to rewrite null object, as suggested by Tomas Kochan&lt;/p&gt;</comment>
                            <comment id="17023467" author="jira-bot" created="Sat, 25 Jan 2020 09:11:56 +0000"  >&lt;p&gt;Commit 1873134 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873134&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873134&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: allow to rewrite null object, as suggested by Tomas Kochan&lt;/p&gt;</comment>
                            <comment id="17023468" author="jira-bot" created="Sat, 25 Jan 2020 09:11:59 +0000"  >&lt;p&gt;Commit 1873135 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873135&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873135&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: allow to rewrite null object, as suggested by Tomas Kochan&lt;/p&gt;</comment>
                            <comment id="17023477" author="jira-bot" created="Sat, 25 Jan 2020 09:38:32 +0000"  >&lt;p&gt;Commit 1873136 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873136&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: don&apos;t output space after writeObject() which does this itself; put space after &quot;]&quot;; remove space before &quot;null&quot;; put LF after &quot;BI&quot;.&lt;/p&gt;</comment>
                            <comment id="17023478" author="jira-bot" created="Sat, 25 Jan 2020 09:38:35 +0000"  >&lt;p&gt;Commit 1873137 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873137&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873137&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: don&apos;t output space after writeObject() which does this itself; put space after &quot;]&quot;; remove space before &quot;null&quot;; put LF after &quot;BI&quot;.&lt;/p&gt;</comment>
                            <comment id="17023480" author="jira-bot" created="Sat, 25 Jan 2020 09:38:39 +0000"  >&lt;p&gt;Commit 1873138 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873138&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873138&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: don&apos;t output space after writeObject() which does this itself; put space after &quot;]&quot;; remove space before &quot;null&quot;; put LF after &quot;BI&quot;.&lt;/p&gt;</comment>
                            <comment id="17023527" author="tilman" created="Sat, 25 Jan 2020 11:57:06 +0000"  >&lt;p&gt;Snapshot available at&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.19-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.19-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I also did a test on the attached file, with this code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDDocument doc = PDFParser.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;XXXX/PDFBOX-4750.pdf&quot;&lt;/span&gt;)))
{
    PDFRenderer r = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFRenderer(doc);
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; doc.getNumberOfPages(); ++i)
    {
        BufferedImage bim1 = r.renderImageWithDPI(i, 96);
        ImageIO.write(bim1, &lt;span class=&quot;code-quote&quot;&gt;&quot;png&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;XXXX/in/PDFBOX-4750-saved.pdf-&quot;&lt;/span&gt; + (i+1) + &lt;span class=&quot;code-quote&quot;&gt;&quot;.png&quot;&lt;/span&gt;));
        PDPage page = doc.getPage(i);
        PDStream newContent = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDStream(doc);
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (InputStream is = page.getContents();
             OutputStream os = newContent.createOutputStream(COSName.FLATE_DECODE))
        {
            PDFStreamParser parser = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFStreamParser(is);
            parser.parse();
            ContentStreamWriter tokenWriter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ContentStreamWriter(os);
            tokenWriter.writeTokens(parser.getTokens());
        }
        page.setContents(newContent);
    }
    doc.save(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;XXXX/PDFBOX-4750-saved.pdf&quot;&lt;/span&gt;));

}
TestPDFToImage testPDFToImage = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TestPDFToImage(TestPDFToImage.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getName());
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!testPDFToImage.doTestFile(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;XXXX/PDFBOX-4750-saved.pdf&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;XXXX/in&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;XXXX/out&quot;&lt;/span&gt;))
{
    fail(&lt;span class=&quot;code-quote&quot;&gt;&quot;Rendering failed or is not identical&quot;&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and it succeeded. It also succeeded after the first commit. The following ones are for clarity and to prevent having too many unneeded spaces in the modified content stream.&lt;/p&gt;

&lt;p&gt;You should use the test code above to create your own test. It creates a first rendering set in the &quot;in&quot; directory and then modifies the file, renders again in the &quot;out&quot; directory and then compares the renderings.&lt;/p&gt;</comment>
                            <comment id="17023552" author="jira-bot" created="Sat, 25 Jan 2020 13:27:42 +0000"  >&lt;p&gt;Commit 1873150 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873150&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873150&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: add test&lt;/p&gt;</comment>
                            <comment id="17023560" author="jira-bot" created="Sat, 25 Jan 2020 13:38:01 +0000"  >&lt;p&gt;Commit 1873151 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873151&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873151&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: use new Loader class&lt;/p&gt;</comment>
                            <comment id="17023562" author="jira-bot" created="Sat, 25 Jan 2020 13:39:28 +0000"  >&lt;p&gt;Commit 1873152 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873152&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: use new Loader class&lt;/p&gt;</comment>
                            <comment id="17023589" author="tilman" created="Sat, 25 Jan 2020 15:21:08 +0000"  >&lt;p&gt;Test was also to see whether we increased code coverage. Sadly it dropped from 46% to 45.6% (maybe because of other commits that balanced things differently). The code coverage of the class went up to 79.6% from 43.4%.&lt;/p&gt;

&lt;p&gt;TODOs:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;use only page 8 - done&lt;/li&gt;
	&lt;li&gt;same test for 2.0 - done&lt;/li&gt;
	&lt;li&gt;loading of file through pom - done&lt;/li&gt;
	&lt;li&gt;find a file that has dictionary (isn&apos;t covered) - done&lt;/li&gt;
	&lt;li&gt;correct formatting for dictionary (probably unneeded space) - done&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17023618" author="jira-bot" created="Sat, 25 Jan 2020 18:04:28 +0000"  >&lt;p&gt;Commit 1873158 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873158&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: don&apos;t output space after writeObject() which does this itself&lt;/p&gt;</comment>
                            <comment id="17023619" author="jira-bot" created="Sat, 25 Jan 2020 18:04:31 +0000"  >&lt;p&gt;Commit 1873159 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873159&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873159&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: don&apos;t output space after writeObject() which does this itself&lt;/p&gt;</comment>
                            <comment id="17023620" author="jira-bot" created="Sat, 25 Jan 2020 18:04:34 +0000"  >&lt;p&gt;Commit 1873160 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873160&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873160&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: don&apos;t output space after writeObject() which does this itself&lt;/p&gt;</comment>
                            <comment id="17023631" author="tilman" created="Sat, 25 Jan 2020 19:23:54 +0000"  >&lt;p&gt;Test file of page 8 from the original PDF and the file from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1724&quot; title=&quot;Method createColorModel not implemented for PDCalGray&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1724&quot;&gt;&lt;del&gt;PDFBOX-1724&lt;/del&gt;&lt;/a&gt; which has a dictionary in the content stream, to increase test coverage.&lt;/p&gt;</comment>
                            <comment id="17023632" author="jira-bot" created="Sat, 25 Jan 2020 19:29:21 +0000"  >&lt;p&gt;Commit 1873162 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873162&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873162&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: replace test file with one that also writes a dictionary to increase test coverage&lt;/p&gt;</comment>
                            <comment id="17023738" author="jira-bot" created="Sun, 26 Jan 2020 09:18:49 +0000"  >&lt;p&gt;Commit 1873176 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873176&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873176&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: load test file through maven&lt;/p&gt;</comment>
                            <comment id="17023739" author="jira-bot" created="Sun, 26 Jan 2020 09:19:07 +0000"  >&lt;p&gt;Commit 1873177 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873177&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873177&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: load test file through maven&lt;/p&gt;</comment>
                            <comment id="17023740" author="jira-bot" created="Sun, 26 Jan 2020 09:19:37 +0000"  >&lt;p&gt;Commit 1873178 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873178&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: load test file through maven&lt;/p&gt;</comment>
                            <comment id="17023741" author="jira-bot" created="Sun, 26 Jan 2020 09:21:45 +0000"  >&lt;p&gt;Commit 1873179 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873179&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873179&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: load test file through maven&lt;/p&gt;</comment>
                            <comment id="17023750" author="jira-bot" created="Sun, 26 Jan 2020 09:55:54 +0000"  >&lt;p&gt;Commit 1873180 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873180&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873180&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: add test&lt;/p&gt;</comment>
                            <comment id="17023751" author="jira-bot" created="Sun, 26 Jan 2020 09:56:02 +0000"  >&lt;p&gt;Commit 1873181 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1873181&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1873181&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4750&quot; title=&quot;java.io.IOException: Error:Unknown type in content stream:COSNull{}&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4750&quot;&gt;&lt;del&gt;PDFBOX-4750&lt;/del&gt;&lt;/a&gt;: add test&lt;/p&gt;</comment>
                            <comment id="17023759" author="tilman" created="Sun, 26 Jan 2020 10:48:45 +0000"  >&lt;p&gt;All done now. Thanks for reporting!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12991732" name="01 - K17 - Was dahinter steckt - dsb.pdf" size="1274531" author="tomas.kochan@sk.ibm.com" created="Fri, 24 Jan 2020 10:55:06 +0000"/>
                            <attachment id="12991833" name="PDFBOX-4750-test.pdf" size="333223" author="tilman" created="Sat, 25 Jan 2020 19:23:14 +0000"/>
                            <attachment id="12991709" name="contentAllOperatorsOfCorruptedPage.txt" size="32989" author="tomas.kochan@sk.ibm.com" created="Fri, 24 Jan 2020 04:44:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 41 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ashk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>