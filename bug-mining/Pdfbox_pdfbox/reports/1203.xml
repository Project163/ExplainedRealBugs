<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:01:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2951] quotedbl causes NullPointerException</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2951</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I have a pdf document using (besides others) the font CourierNewPS-BoldMT and text with this font containing a double quote.&lt;/p&gt;

&lt;p&gt;When calling PDFont.encode, this results in a NullPointerException due to the following:&lt;/p&gt;

&lt;p&gt;The font encoding is built using pdf /DIFFERENCES which overwrites the original &quot;quotedbl&quot; at index 34 with an &quot;A&quot;. The entries for quotedblbase/left/right are left unchanged. As a result, the inverted font does not contain &quot;quotedbl&quot; as key.&lt;/p&gt;

&lt;p&gt;Within encode, the character code 34 gets assigned the name &quot;quotedbl&quot;, which is then not found in the inverse encoding (PDTrueTypeFont.encode -&amp;gt; int code = inverted.get(name))&lt;/p&gt;

&lt;p&gt;Right before this code line causing the NullPointerException, there is a check whether ttf.hasGlyph(&quot;quotedbl&quot;) (which in this case is false) and, if not, whether ttf.hasGlyph(&quot;uni0022&quot;) (which in this case is true); however, this has no consequence for the continuation of the code, which then crashes, since inverted.get(&quot;quotedbl&quot;) is null (which is assigned to an int).&lt;/p&gt;

&lt;p&gt;I believe, this is a bug in PDFBox, but have no idea, whether the handling within encode should be changed (maybe using the &quot;else&quot; part in case ttf.hasGlyph(&quot;quotedbl&quot;) is false or whether code 34 should be assigned to quotedblbase in the first place, or even something else.&lt;/p&gt;

&lt;p&gt;I attached the file (Test.pdf) where the error occurs and a jar (main is com.juergisApps.pdfConverter.Test) that reproduces the problem.&lt;/p&gt;

&lt;p&gt;You may also see &lt;a href=&quot;http://stackoverflow.com/questions/7140476/pdf-font-mapping-error&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/7140476/pdf-font-mapping-error&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Juergen&lt;/p&gt;</description>
                <environment>Windows 10 64 bit</environment>
        <key id="12860969">PDFBOX-2951</key>
            <summary>quotedbl causes NullPointerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jahewson">John Hewson</assignee>
                                    <reporter username="juergenuhl">Juergen Uhl</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Sep 2015 10:53:04 +0000</created>
                <updated>Thu, 17 Mar 2016 19:07:26 +0000</updated>
                            <resolved>Wed, 2 Sep 2015 20:35:09 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14727884" author="jahewson" created="Wed, 2 Sep 2015 19:25:30 +0000"  >&lt;p&gt;Unrelated to the bug: Looking at your code, did you realise that you can override the specific operator methods of PDFStreamEngine rather than processOperator? That way you can take advantage of all of PDFBox&apos;s built-in operator handling and still add your own custom handling. PDFGraphicsStreamEngine provides can extended version which has methods which you can override for each graphics operator too.&lt;/p&gt;

&lt;p&gt;Also note that you can&apos;t measure the width of a string in a PDF like this for two reasons:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; Tj:
                &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; text = ((COSString) operands.get(0)).getString();
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                    currentFont.getStringWidth(text);
                } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception ex) {
                    ex.printStackTrace();
                    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.exit(1);
                }
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;1. Each font has its own encoding but .getString() only supports PDFDocEncoding. That&apos;s because getString() only works for a &quot;text string&quot; but you&apos;re dealing with a &quot;content stream string&quot;. Only getBytes() is valid with these, and PDFont&apos;s decode() method is necessary to read those bytes.&lt;/p&gt;

&lt;p&gt;2. Because decoding and encoding are not symmetric in PDF, i.e. &lt;em&gt;encoded text =&amp;gt; Unicode =&amp;gt; encoded text&lt;/em&gt; could result in a different input and output. That&apos;s because the font encoding and Unicode information for characters are entirely separate in PDF, and often broken. So if you want to measure characters in an existing PDF then you have to avoid any decoding and use the encoded character codes directly, via PDFont&apos;s getWidth(code) method.&lt;/p&gt;

&lt;p&gt;I&apos;d recommend overriding the text and glyph methods in PDFStreamEngine, which already does all the hard work for you.&lt;/p&gt;</comment>
                            <comment id="14727909" author="juergenuhl" created="Wed, 2 Sep 2015 19:51:44 +0000"  >&lt;p&gt;Thanks, John,&lt;/p&gt;

&lt;p&gt;no I had not realized this but it&apos;s interesting and I&apos;ll see whether I &lt;br/&gt;
can make use of it; mainly need to check what the &quot;default behavior&quot; &lt;br/&gt;
would be; in my PDF Analyzer I try to keep a current text and graphics &lt;br/&gt;
context, matrix and whatever comprises the PDF document &quot;status&quot; and &lt;br/&gt;
then associated this to the &quot;content&quot; operators like text or image content.&lt;/p&gt;

&lt;p&gt;As far as the actual bug report is concerned, did I get you right that &lt;br/&gt;
the error should go away, if rather than using getString I use getBytes &lt;br/&gt;
plus a current stream encoding (will check where I get this from)?&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Juergen&lt;/p&gt;
</comment>
                            <comment id="14727973" author="jahewson" created="Wed, 2 Sep 2015 20:32:44 +0000"  >&lt;blockquote&gt;
&lt;p&gt;no I had not realized this but it&apos;s interesting and I&apos;ll see whether I &lt;br/&gt;
can make use of it; mainly need to check what the &quot;default behavior&quot; &lt;br/&gt;
would be; in my PDF Analyzer I try to keep a current text and graphics &lt;br/&gt;
context, matrix and whatever comprises the PDF document &quot;status&quot; and &lt;br/&gt;
then associated this to the &quot;content&quot; operators like text or image content.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You&apos;re literally rebuilding PDFStreamEngine from scratch. There&apos;s no default behaviour, we add our own behaviour by subclassing in PageDrawer for rendering and in PDFTextStripper for text extraction. But all that PDFStreamEngine does on its own is parse the operators, keep track of the graphics state, and provide methods which can be overridden to hook into all of that. For example, the current font is already available via getGraphicsState().getTextState().getFont(). I&apos;d urge you to look at our &lt;a href=&quot;https://github.com/apache/pdfbox/blob/trunk/examples/src/main/java/org/apache/pdfbox/examples/rendering/CustomGraphicsStreamEngine.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CustomGraphicsStreamEngine.java &lt;/a&gt; example.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;As far as the actual bug report is concerned, did I get you right that &lt;br/&gt;
the error should go away, if rather than using getString I use getBytes &lt;br/&gt;
plus a current stream encoding (will check where I get this from)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes but don&apos;t do that, override the appropriate methods in PDFStreamEngine instead, e.g. beginText, endText, showTextString, showTextStrings, applyTextAdjustment, showText, showGlyph, etc.&lt;/p&gt;</comment>
                            <comment id="14727974" author="jira-bot" created="Wed, 2 Sep 2015 20:32:59 +0000"  >&lt;p&gt;Commit 1700894 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1700894&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1700894&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2951&quot; title=&quot;quotedbl causes NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2951&quot;&gt;&lt;del&gt;PDFBOX-2951&lt;/del&gt;&lt;/a&gt;: Fix issue with Encoding caching names before Differences have been applied&lt;/p&gt;</comment>
                            <comment id="14727982" author="jahewson" created="Wed, 2 Sep 2015 20:35:03 +0000"  >&lt;p&gt;This fixes the NullPointerException, which was due to Encoding having a stale cache of glyph names which didn&apos;t account for the Differences. Now instead of an NPE you should get an IOException because the given characters aren&apos;t available in the font, because you&apos;re not decoding the text correctly, as discussed above.&lt;/p&gt;</comment>
                            <comment id="14727987" author="juergenuhl" created="Wed, 2 Sep 2015 20:37:40 +0000"  >&lt;p&gt;Thanks John!&lt;/p&gt;

&lt;p&gt;OK, though I don&apos;t want to show anything but just build a model of the &lt;br/&gt;
pdf content which I can the use, for example, for editing purposes. But &lt;br/&gt;
probably &quot;begin/endText&quot; will do that.&lt;/p&gt;

&lt;p&gt;Juergen&lt;/p&gt;
</comment>
                            <comment id="14728014" author="jahewson" created="Wed, 2 Sep 2015 20:53:13 +0000"  >&lt;p&gt;PDFStreamEngine (and it&apos;s cousin, PDFGraphicsStreamEngine) doesn&apos;t &quot;show&quot; anything, it&apos;s just a class which you can subclass to hook into the PDF operators. Most of the methods have empty bodies, it&apos;s only by subclassing that behaviour is added.&lt;/p&gt;</comment>
                            <comment id="14728033" author="juergenuhl" created="Wed, 2 Sep 2015 21:09:40 +0000"  >&lt;p&gt;John,&lt;/p&gt;

&lt;p&gt;ok, I see. Just had a brief look and your remarks really help(ed) a lot &lt;br/&gt;
(even though my mail folder now holds 12 mails from you&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ) - thanks! &lt;br/&gt;
This really simplifies the stuff I wanna do a lot.&lt;/p&gt;

&lt;p&gt;Hope I didn&apos;t bother you too much.&lt;/p&gt;

&lt;p&gt;Have a good night / day (depending on where you are)&lt;br/&gt;
Juergen&lt;/p&gt;


</comment>
                    </comments>
                    <attachments>
                            <attachment id="12753505" name="Test.jar" size="42218" author="juergenuhl" created="Tue, 1 Sep 2015 10:54:02 +0000"/>
                            <attachment id="12753506" name="Test.java" size="9762" author="juergenuhl" created="Tue, 1 Sep 2015 10:55:01 +0000"/>
                            <attachment id="12753504" name="Test.pdf" size="128367" author="juergenuhl" created="Tue, 1 Sep 2015 10:54:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 11 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jn7z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>