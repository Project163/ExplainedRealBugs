<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:13:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5518] &quot;Threads&quot; array in Document Catalog should be an indirect reference</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5518</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;&lt;b&gt;TL;DR:&lt;/b&gt;&lt;br/&gt;
When using either of the methods &quot;getThreads&quot; or &quot;setThreads&quot; in class PDDocumentCatalog and saving the resulting document: Adobe Preflight is reporting an issue with the resulting &quot;Threads&quot; array in the document catalog and claims it should have been an indirect object reference instead of a direct object.&lt;/p&gt;

&lt;p&gt;My claim: The COSWriter should be able to create indirect objects for COSArrays when required.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Checking PDF-32000-1:&lt;/b&gt;&lt;br/&gt;
In table 28 &quot;Entries in the catalog dictionary&quot; we can find the following definition:&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13049677/13049677_image-2022-09-23-09-50-30-766.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;&lt;b&gt;Determining reasons:&lt;/b&gt;&lt;br/&gt;
1. The mentioned get and set methods create a COSArray for the entry &quot;Threads&quot; of the catalog dictionary&lt;br/&gt;
2. The COSWriter is assuming, that COSArrays should always preferably be written as a direct substructure of a dictionary.&lt;/p&gt;

&lt;p&gt;This may be entirely true for other arrays, but in this case is is cause for a syntactical error in resulting documents. (It is plausible and possible - but has not been checked - whether this causes issues for other structures aswell.)&lt;/p&gt;

&lt;p&gt;The COSWriter provides the means to create indirect objects for COSDictionaries, it however does (as far as I can see) not provide the means to flag a COSArray for the same handling.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Possible solutions:&lt;/b&gt;&lt;br/&gt;
As far as I can see the COSWriter would be entirely capable of creating COSObjects for any of the COSBase types, the only thing missing is the ability to mark a COSArray to be written indirectly and the matching handling by the COSWriter.&lt;br/&gt;
Adding something like:&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13049676/13049676_image-2022-09-23-10-03-15-070.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;br/&gt;
at the right places in the COSWriter (similar to the handling of indirect COSDictionaries) seems to do the trick and resolves the issue.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Important issue?:&lt;/b&gt;&lt;br/&gt;
I fixed this on our end and hence it is not a pressing issue, also &quot;Threads&quot; is not as important and common as other structures and hence most documents and users won&#180;t encounter this issue at all.&lt;/p&gt;

&lt;p&gt;However - It would be nice, should this be fixed.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Concerning a possible patch:&lt;/b&gt;&lt;br/&gt;
I could provide a patch making the required changes, but would have to adapt it for the current PDFBox 2.0.27-SNAPSHOT as I developed it rather as a hotfix for our mirror of the library.&lt;/p&gt;

&lt;p&gt;And concerning that patch I should mention:&lt;br/&gt;
As can be assumed - a &quot;isDirectArray&quot; and &quot;setDirectArray&quot; method have been added to the COSArray - which is a quick and dirty solution, as it would be preferable for COSArray to use the already existing &quot;direct&quot; field, that other COSBase types (COSDictionaries) already use.&lt;/p&gt;

&lt;p&gt;As stated - the solution is quick and dirty and for a final solution in the PDFBox library a cleaner approach would be preferable. Hence I did not provide that patch for now.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13482898">PDFBOX-5518</key>
            <summary>&quot;Threads&quot; array in Document Catalog should be an indirect reference</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="capSVD">Christian Appl</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Sep 2022 08:19:54 +0000</created>
                <updated>Fri, 18 Aug 2023 05:46:09 +0000</updated>
                            <resolved>Sun, 23 Jul 2023 17:51:17 +0000</resolved>
                                    <version>2.0.26</version>
                                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17608639" author="capsvd" created="Fri, 23 Sep 2022 08:54:47 +0000"  >&lt;p&gt;I possibly should provide these changes to the PDDocumentCatalog:&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13049682/13049682_image-2022-09-23-10-54-31-618.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Which is enough in our use case, as we are always calling &quot;getThreads&quot; when opening documents - but a mechanism to mark such arrays as indirect (even if not accessed via those methods) would be a better idea (possibly something to add to the Parser?)&lt;/p&gt;</comment>
                            <comment id="17743421" author="lehmi" created="Sat, 15 Jul 2023 17:54:22 +0000"  >&lt;p&gt;Please attach a sample pdf containing threads&lt;/p&gt;</comment>
                            <comment id="17743685" author="capsvd" created="Mon, 17 Jul 2023 09:00:06 +0000"  >&lt;p&gt;The original document is not available anymore, but it is easily&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Reproducable via:&lt;/b&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDDocument document = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDDocument()) {
document.addPage(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPage());
document.getDocumentCatalog().setThreads(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;());
document.save(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&quot;D:
experiments&lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;threads-out.pdf&quot;));
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;b&gt;Resulting in:&lt;/b&gt;&lt;br/&gt;
&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13061367/13061367_threads-out.pdf&quot; title=&quot;threads-out.pdf attached to PDFBOX-5518&quot;&gt;threads-out.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;For which Preflight claims that:&lt;/b&gt;&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13061368/13061368_image-2023-07-17-10-57-12-609.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Which is not that much of a pressing issue - a fix would be very welcome anyway.&lt;/p&gt;


&lt;p&gt;&lt;font color=&quot;#d5b778&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/font&gt;&lt;font color=&quot;#d5b778&quot;&gt; &amp;lt;groupId&amp;gt;&lt;/font&gt;org.apache.pdfbox&lt;font color=&quot;#d5b778&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/font&gt;&lt;font color=&quot;#d5b778&quot;&gt; &amp;lt;artifactId&amp;gt;&lt;/font&gt;pdfbox&lt;font color=&quot;#d5b778&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/font&gt;&lt;font color=&quot;#d5b778&quot;&gt; &amp;lt;version&amp;gt;&lt;/font&gt;2.0.29&lt;font color=&quot;#d5b778&quot;&gt;&amp;lt;/version&amp;gt;&lt;/font&gt;&lt;font color=&quot;#d5b778&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/font&gt;&lt;/p&gt;</comment>
                            <comment id="17746059" author="jira-bot" created="Sun, 23 Jul 2023 12:05:44 +0000"  >&lt;p&gt;Commit 1911210 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1911210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1911210&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5518&quot; title=&quot;&amp;quot;Threads&amp;quot; array in Document Catalog should be an indirect reference&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5518&quot;&gt;&lt;del&gt;PDFBOX-5518&lt;/del&gt;&lt;/a&gt;: set COSArrays to direct by default&lt;/p&gt;</comment>
                            <comment id="17746060" author="jira-bot" created="Sun, 23 Jul 2023 12:06:27 +0000"  >&lt;p&gt;Commit 1911211 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1911211&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1911211&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5518&quot; title=&quot;&amp;quot;Threads&amp;quot; array in Document Catalog should be an indirect reference&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5518&quot;&gt;&lt;del&gt;PDFBOX-5518&lt;/del&gt;&lt;/a&gt;: mark all dereferenced objects as indirect&lt;/p&gt;</comment>
                            <comment id="17746078" author="jira-bot" created="Sun, 23 Jul 2023 14:27:50 +0000"  >&lt;p&gt;Commit 1911214 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1911214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1911214&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5518&quot; title=&quot;&amp;quot;Threads&amp;quot; array in Document Catalog should be an indirect reference&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5518&quot;&gt;&lt;del&gt;PDFBOX-5518&lt;/del&gt;&lt;/a&gt;: add support for indirect COSArrays&lt;/p&gt;</comment>
                            <comment id="17746079" author="jira-bot" created="Sun, 23 Jul 2023 14:30:01 +0000"  >&lt;p&gt;Commit 1911215 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1911215&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1911215&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5518&quot; title=&quot;&amp;quot;Threads&amp;quot; array in Document Catalog should be an indirect reference&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5518&quot;&gt;&lt;del&gt;PDFBOX-5518&lt;/del&gt;&lt;/a&gt;: the COSArray holding the Threads values shall be indirect&lt;/p&gt;</comment>
                            <comment id="17746107" author="jira-bot" created="Sun, 23 Jul 2023 17:31:13 +0000"  >&lt;p&gt;Commit 1911217 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1911217&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1911217&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5518&quot; title=&quot;&amp;quot;Threads&amp;quot; array in Document Catalog should be an indirect reference&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5518&quot;&gt;&lt;del&gt;PDFBOX-5518&lt;/del&gt;&lt;/a&gt;: combine conditions&lt;/p&gt;</comment>
                            <comment id="17746109" author="lehmi" created="Sun, 23 Jul 2023 17:50:36 +0000"  >&lt;p&gt;To mark the threads array as indirect was the easier part. I had to do some adjustments/fixes to add support for indirect COSArrays to the COSWriter. I&apos;m hesitant to backport that to the 2.0.x version as there are to many differences. Some of the changes to the COSParser were essential and some of the old code looks at least suboptimal when it comes to direct/indirect objects. I don&apos;t want to put to much effort in this issue and risk any regressions.&lt;/p&gt;</comment>
                            <comment id="17746110" author="lehmi" created="Sun, 23 Jul 2023 17:51:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=capSVD&quot; class=&quot;user-hover&quot; rel=&quot;capSVD&quot;&gt;capSVD&lt;/a&gt; thanks for the report and the proposed solution. &lt;/p&gt;

&lt;p&gt;Set to resolved&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13049677" name="image-2022-09-23-09-50-30-766.png" size="37391" author="capSVD" created="Fri, 23 Sep 2022 07:50:31 +0000"/>
                            <attachment id="13049676" name="image-2022-09-23-10-03-15-070.png" size="30895" author="capSVD" created="Fri, 23 Sep 2022 08:03:15 +0000"/>
                            <attachment id="13049682" name="image-2022-09-23-10-54-31-618.png" size="181419" author="capSVD" created="Fri, 23 Sep 2022 08:54:31 +0000"/>
                            <attachment id="13061368" name="image-2023-07-17-10-57-12-609.png" size="46356" author="capSVD" created="Mon, 17 Jul 2023 08:57:12 +0000"/>
                            <attachment id="13061367" name="threads-out.pdf" size="445" author="capSVD" created="Mon, 17 Jul 2023 08:56:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z18sh4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>