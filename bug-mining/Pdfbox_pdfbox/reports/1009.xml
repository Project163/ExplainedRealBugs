<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:59:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2350] Type1 Parser hangs indefinitely</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2350</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;When rendering the first page of my pdf document the Type1Parser (org.apache.fontbox.type1.Type1Parser) hangs in a loop in &lt;/p&gt;

&lt;p&gt;&lt;tt&gt;parseBinary(byte[] bytes) throws IOException&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;and &quot;kills&quot; our rendering pipeline. Please find the loop that hangs below:&lt;/p&gt;

&lt;p&gt;        // find /Private dict&lt;br/&gt;
        while (!lexer.peekToken().getText().equals(&quot;Private&quot;))&lt;/p&gt;
        {
            lexer.nextToken();
        }

&lt;p&gt;There is no token named &quot;Private&quot; ever in the list of returned tokens (they&apos;re empty all the time).  &lt;/p&gt;

&lt;p&gt;Furthermore going deeper into the source code it seems the class reading the tokens (Type1Lexer) does never finally advance the buffer position and always returns an empty name token in the readToken(Token prevToken) method.&lt;/p&gt;

&lt;p&gt;Looking at the decrypted buffer i cannot get something useful out of it based on my current understanding.&lt;/p&gt;

&lt;p&gt;Unfortunately i cannot provide the pdf in question as it contains confidental data.&lt;/p&gt;

&lt;p&gt;Acrobat Reader XI Version 11.0.08 renders the document just fine.&lt;/p&gt;

&lt;p&gt;In addition it seems the pdf was encrypted (40-Bit RC4) with an empty password and says it&apos;s pdf version 1.5.&lt;/p&gt;

&lt;p&gt;Does this provide enough information or can i do anything else to help nailing this one down?&lt;/p&gt;

&lt;p&gt;I guess this might be a pdf document structure/feature that is not yet supported completely but at least pdfbox should throw an exception instead of failing &quot;silently&quot;...&lt;/p&gt;

</description>
                <environment>Windows 7, JDK 1.7.0_51-b13</environment>
        <key id="12741465">PDFBOX-2350</key>
            <summary>Type1 Parser hangs indefinitely</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jahewson">John Hewson</assignee>
                                    <reporter username="daniel.scheibe">Daniel Scheibe</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Sep 2014 12:56:34 +0000</created>
                <updated>Wed, 8 Feb 2017 17:59:22 +0000</updated>
                            <resolved>Fri, 26 Sep 2014 17:25:58 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>FontBox</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14134082" author="tilman" created="Mon, 15 Sep 2014 16:31:51 +0000"  >&lt;p&gt;How did you open the pdf?&lt;/p&gt;

&lt;p&gt;Use loadNonSeq(). If you used load(), you need to make additional calls to decrypt.&lt;/p&gt;</comment>
                            <comment id="14135091" author="daniel.scheibe" created="Tue, 16 Sep 2014 07:33:52 +0000"  >&lt;p&gt;Thanks Tilman for your feedback.&lt;/p&gt;

&lt;p&gt;What i currently do is:&lt;/p&gt;

&lt;p&gt;                _pdDocument = PDDocument.load(_inputStream);&lt;/p&gt;

&lt;p&gt;                if (_pdDocument.isEncrypted())&lt;/p&gt;
                {
                    _logger.warn(&quot;Document is encrypted, trying to decrypt without password&quot;);
                    _pdDocument.decrypt(&quot;&quot;);
                }

&lt;p&gt;                // 2.0.0-SNAPSHOT&lt;br/&gt;
                _pdRenderer = new PDFRenderer(_pdDocument, true);&lt;/p&gt;

&lt;p&gt;               // ...&lt;/p&gt;

&lt;p&gt;So i guess what you said about an additional call to decrypt is already in place and should work?&lt;/p&gt;
</comment>
                            <comment id="14135708" author="tilman" created="Tue, 16 Sep 2014 16:56:44 +0000"  >&lt;p&gt;Please try also &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;PDDocument.loadNonSeq(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(pdfFilename), &quot;&quot;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;that does the decryption if needed.&lt;/p&gt;

&lt;p&gt;also, the correct way to decrypt with the old parser is&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;( document.isEncrypted() )
            {
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
                {
                    StandardDecryptionMaterial sdm = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StandardDecryptionMaterial(&quot;&quot;);
                    document.openProtection(sdm);
                }
                &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;( InvalidPasswordException e )
                {
                    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println( &lt;span class=&quot;code-quote&quot;&gt;&quot;Error: The document is encrypted.&quot;&lt;/span&gt; );
                }
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m not saying that this will solve your problems but it is worth a try.&lt;/p&gt;

&lt;p&gt;If it still doesn&apos;t work, please change the code so that parseBinary() saves the &quot;decrypted&quot; byte array into a file (below line 448), and attach that file here.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;FileOutputStream fos  = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;font-&quot;&lt;/span&gt; + &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis() + &lt;span class=&quot;code-quote&quot;&gt;&quot;.txt&quot;&lt;/span&gt;));
fos.write(decrypted);
fos.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Unless that font is also confidential &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Other things to try if you are using windows: download and use qpdf to uncompress the file and see if there are any error messages.&lt;/p&gt;

&lt;p&gt;qpdf --stream-data=uncompress file.pdf fileU.pdf&lt;/p&gt;</comment>
                            <comment id="14137583" author="jahewson" created="Wed, 17 Sep 2014 17:20:55 +0000"  >&lt;p&gt;Can you post a stack trace for the point where the application hangs? (You might have to write one down by hand using your debugger). I&apos;d be interested to see where exactly Type1Parser is being called form in this specific case. I suspect the problem is that bad data is being passed to Type1Parser.&lt;/p&gt;</comment>
                            <comment id="14142449" author="tilman" created="Sun, 21 Sep 2014 14:08:50 +0000"  >&lt;p&gt;The attached file &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2350&quot; title=&quot;Type1 Parser hangs indefinitely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2350&quot;&gt;&lt;del&gt;PDFBOX-2350&lt;/del&gt;&lt;/a&gt;-289451-endless.pdf of the digitalcorpora site has the same problem.&lt;/p&gt;</comment>
                            <comment id="14142461" author="tilman" created="Sun, 21 Sep 2014 14:30:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;Looking at the decrypted buffer i cannot get something useful out of it based on my current understanding.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Same here. The contents before and after Type 1 &quot;Decryption&quot; are just binary stuff.&lt;/p&gt;</comment>
                            <comment id="14142821" author="jahewson" created="Mon, 22 Sep 2014 01:26:02 +0000"  >&lt;p&gt;Yep, the binary portion of the font is corrupt, the data meaningless, even Acrobat cannot read this font. PDFBox is getting stuck in a loop trying to read tokens because it mishandles the case where there are no valid tokens to read.&lt;/p&gt;</comment>
                            <comment id="14142822" author="jira-bot" created="Mon, 22 Sep 2014 01:27:06 +0000"  >&lt;p&gt;Commit 1626656 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1626656&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1626656&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2350&quot; title=&quot;Type1 Parser hangs indefinitely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2350&quot;&gt;&lt;del&gt;PDFBOX-2350&lt;/del&gt;&lt;/a&gt;: Correctly handle and warn about damaged Type 1 font streams&lt;/p&gt;</comment>
                            <comment id="14142825" author="jahewson" created="Mon, 22 Sep 2014 01:29:51 +0000"  >&lt;p&gt;That last commit should fix the problem, we now correctly handle the zero-good-tokens case and print a warning that the font is damaged.&lt;/p&gt;</comment>
                            <comment id="14142945" author="tilman" created="Mon, 22 Sep 2014 06:36:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daniel.scheibe&quot; class=&quot;user-hover&quot; rel=&quot;daniel.scheibe&quot;&gt;daniel.scheibe&lt;/a&gt; please give feedback whether your problem has been solved.&lt;/p&gt;</comment>
                            <comment id="14144601" author="daniel.scheibe" created="Tue, 23 Sep 2014 09:28:42 +0000"  >&lt;p&gt;Tested it this morning and it&apos;s no longer &quot;hanging&quot;. &lt;/p&gt;

&lt;p&gt;It now outputs warnings about not being able to read damaged Type1 fonts.&lt;/p&gt;

&lt;p&gt;The resulting images are missing the correct font which has been replaced by a default (which is as expected i guess).&lt;/p&gt;

&lt;p&gt;I need to check the embedded fonts again and see if i&apos;m able to come up with a test case.&lt;/p&gt;

&lt;p&gt;In my case (PDF) Acrobat Reader is able to read and display the fonts so they&apos;re either not &quot;really&quot; damaged or there is some workaround in place.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14144621" author="daniel.scheibe" created="Tue, 23 Sep 2014 09:46:12 +0000"  >&lt;p&gt;qpdf --stream-data=uncompress file.pdf fileU.pdf on my PDF does not show any error messages or warnings&lt;/p&gt;</comment>
                            <comment id="14144870" author="daniel.scheibe" created="Tue, 23 Sep 2014 15:02:18 +0000"  >&lt;p&gt;I think i nailed it down or at least i might have found out what potentially goes wrong:&lt;/p&gt;

&lt;p&gt;Inside the &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.apache.pdfbox.pdmodel.font.PDType1Font&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; constructor &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; PDType1Font(COSDictionary fontDictionary) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; the try catch block consisting of&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;COSStream stream = fontFile.getStream();
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length1 = stream.getInt(COSName.LENGTH1);
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length2 = stream.getInt(COSName.LENGTH2); 

&lt;span class=&quot;code-comment&quot;&gt;// the PFB embedded as two segments back-to-back
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] bytes = fontFile.getByteArray();
&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] segment1 = Arrays.copyOfRange(bytes, 0, length1);
&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] segment2 = Arrays.copyOfRange(bytes, length1, length1 + length2);

t1 =  Type1Font.createWithSegments(segment1, segment2);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;is either in my case reporting an incorrect value for length1 or more likely length1 is taken into account incorrectly, i guess the following should be correct instead:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] segment1 = Arrays.copyOfRange(bytes, 0, length1 - 1);
&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] segment2 = Arrays.copyOfRange(bytes, length1 - 1, length1 + length2);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I mean isn&apos;t the 0 .. length1 one byte too much?&lt;/p&gt;

&lt;p&gt;While debugging and dumping out the arrays i noticed that the byte array segment2 is always missing the first byte and when i changed it as shown above it works fine, all embedded fonts are rendered correctly and the image looks just fine.&lt;/p&gt;

&lt;p&gt;Anyways, i have no clue if my change makes sense or might have a larger impact and something else goes south by that but it might help you guys to come up with a suitable fix?&lt;/p&gt;</comment>
                            <comment id="14144984" author="jahewson" created="Tue, 23 Sep 2014 16:32:44 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I mean isn&apos;t the 0 .. length1 one byte too much?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;At first glance it looks that way, but the &quot;to&quot; index of Arrays.copyOfRange is actually exclusive, so it&apos;s not included. The length of the array returned is &lt;em&gt;to - from&lt;/em&gt;, for segment1 this is &lt;em&gt;0 - length1 = length1&lt;/em&gt;. For segment2 it is &lt;em&gt;(length1 + length2) - length1 = length2&lt;/em&gt;.&lt;/p&gt;

&lt;p&gt;However, you might still have found the problem with your file: length1 and length2 are off-by-one and it looks like Acrobat is able to recover from that.&lt;/p&gt;</comment>
                            <comment id="14145028" author="jahewson" created="Tue, 23 Sep 2014 16:59:42 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] segment1 = Arrays.copyOfRange(bytes, 0, length1 - 1);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If this works for you then the PDF file must have Length1 being one byte too long, I tried manually editing a PDF to re-create this problem but Acrobat could not read the font. Can you open the file using PDFBox&apos;s PDFDebugger and expand the tree to Root &amp;gt; Pages &amp;gt; Kids &amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;?&amp;#93;&lt;/span&gt; &amp;gt; Resources &amp;gt; F? &amp;gt; FontDescriptor &amp;gt; FontFile, (where ? = number) and attach a screen shot of the tree + stream?&lt;/p&gt;</comment>
                            <comment id="14145080" author="daniel.scheibe" created="Tue, 23 Sep 2014 17:28:50 +0000"  >&lt;p&gt;I&apos;ll give it a try tomorrow and see what i can find out. While debugging i checked a couple of other Type 1 PDF parsers and it seems (from what i understood) the way JPedal goes about it is to seek for the &quot;exec&quot; (yes not &quot;eexec&quot;) token in the font descriptor plus the potentially existing cr+lf and everything beyond that point is considered to be the binary data. While this approach might be &quot;fault tolerant&quot; for my case i agree if the PDF contains an offset that is &quot;off&quot; by one byte then my file is broken.&lt;/p&gt;</comment>
                            <comment id="14145504" author="tilman" created="Tue, 23 Sep 2014 21:46:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daniel.scheibe&quot; class=&quot;user-hover&quot; rel=&quot;daniel.scheibe&quot;&gt;daniel.scheibe&lt;/a&gt; does your trick also work with &quot;my&quot; file? I can&apos;t test it myself today, because I accidentally messed up my system while researching another bug. Thanks for the research you already did about all this.&lt;/p&gt;</comment>
                            <comment id="14147568" author="daniel.scheibe" created="Thu, 25 Sep 2014 09:17:52 +0000"  >&lt;p&gt;In the meantime: &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://feliam.wordpress.com/2010/08/14/pdf-a-broken-spec/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://feliam.wordpress.com/2010/08/14/pdf-a-broken-spec/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14147639" author="daniel.scheibe" created="Thu, 25 Sep 2014 11:33:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; using PDFDebugger i was able to see that my PDF file is incorrect. The stream length indicated by the line:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&amp;lt;&amp;lt; /Length1 5059 /Length2 26711 /Length3 533 /Subtype /Type1 /Length 32303 &amp;gt;&amp;gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;is incorrect and should be&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&amp;lt;&amp;lt; /Length1 5058 /Length2 26711 /Length3 533 /Subtype /Type1 /Length 32303 &amp;gt;&amp;gt;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;When editing this manually with a HEX Editor the file get&apos;s rendered just fine.&lt;/p&gt;
</comment>
                            <comment id="14147655" author="daniel.scheibe" created="Thu, 25 Sep 2014 11:36:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; no my trick does only seem to work for my special case. PDFBox is correct about the parsing but as mentioned above, the PDF file is incorrect.&lt;/p&gt;

&lt;p&gt;During my research i also read that invalid stream sizes are a common problem with various PDF files (lots of parsers simply neglect them and scan for known tokens). Maybe we can come up with a workaround, i&apos;m still investigating if i can come up with something useful.&lt;/p&gt;</comment>
                            <comment id="14147658" author="tilman" created="Thu, 25 Sep 2014 11:39:40 +0000"  >&lt;p&gt;The nonseq parser does use the /length value.&lt;/p&gt;</comment>
                            <comment id="14147663" author="daniel.scheibe" created="Thu, 25 Sep 2014 11:52:12 +0000"  >&lt;p&gt;Ah this might be important i&apos;m doing my loading via &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;_pdDocument = PDDocument.load(_inputStream);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so i guess i&apos;m not using the nonseq-parser?&lt;/p&gt;

&lt;p&gt;Will give it a try with this as well.&lt;/p&gt;</comment>
                            <comment id="14147666" author="daniel.scheibe" created="Thu, 25 Sep 2014 11:54:40 +0000"  >&lt;p&gt;I don&apos;t see a difference in using load vs. loadNonSeq&lt;/p&gt;</comment>
                            <comment id="14147671" author="tilman" created="Thu, 25 Sep 2014 12:03:40 +0000"  >&lt;p&gt;Even the nonSeq parser can&apos;t help if, as in your case, the /Length1 value is wrong.&lt;/p&gt;</comment>
                            <comment id="14147713" author="daniel.scheibe" created="Thu, 25 Sep 2014 13:07:26 +0000"  >&lt;p&gt;Did a bit more of testing and if we want to workaround this issue (i.e.: be fault tolerant like other parsers) i would propose the following fix (which needs to be tested carefully):&lt;/p&gt;

&lt;p&gt;In &lt;tt&gt;PDType1Font.java&lt;/tt&gt; below the lines of:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;COSStream stream = fontFile.getStream();
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length = stream.getInt(COSName.LENGTH);
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length1 = stream.getInt(COSName.LENGTH1);
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length2 = stream.getInt(COSName.LENGTH2);

&lt;span class=&quot;code-comment&quot;&gt;// the PFB embedded as two segments back-to-back
&lt;/span&gt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] bytes = fontFile.getByteArray();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;i would suggest to insert a call to my &quot;workaround&quot; function:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;length1 = adjustInvalidStreamLength1IfNecessary(bytes, length1);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where the function is defined as:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; adjustInvalidStreamLength1IfNecessary(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] bytes, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length1)
{
    &lt;span class=&quot;code-comment&quot;&gt;// grab first segment from bytes indicated by length1
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] segment1 = Arrays.copyOfRange(bytes, 0, length1);
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] marker =
    {
       &lt;span class=&quot;code-quote&quot;&gt;&apos;e&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;x&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;e&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;c&apos;&lt;/span&gt;
    };

    &lt;span class=&quot;code-comment&quot;&gt;// determine earliest possible offset of marker
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; offset = length1 - 4;
    offset = offset &amp;lt; 0 ? 0 : offset;

    &lt;span class=&quot;code-comment&quot;&gt;// no we scan backwards from the end of the first segment to determine
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there is the &lt;span class=&quot;code-quote&quot;&gt;&apos;exec&apos;&lt;/span&gt; marker available
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (offset &amp;gt; 0)
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (segment1[offset] == marker[0] &amp;amp;&amp;amp; segment1[offset + 1] == marker[1] &amp;amp;&amp;amp; segment1[offset + 2] == marker[2] &amp;amp;&amp;amp; segment1[offset + 3] == marker[3])
        {
            &lt;span class=&quot;code-comment&quot;&gt;// we hit the exec marker, there might be additional cr/lf characters which we skip
&lt;/span&gt;            offset += 4;
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (offset &amp;lt; length1 &amp;amp;&amp;amp; (segment1[offset] == 13 || segment1[offset] == 10))
            {
                offset++;
            }

            &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
        }

        offset--;
    }

    &lt;span class=&quot;code-comment&quot;&gt;// let&apos;s check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the originating length1 value is different to our newly determined offset
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; safety we also check that the offset is not zero as it is very unlikely to be the correct value
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; so, we warn and &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the corrected value (which hopefully is 100% correct)
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (length1 - offset != 0 &amp;amp;&amp;amp; offset &amp;gt; 0)
    {
        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;The length1 of &quot;&lt;/span&gt; + length1 + &lt;span class=&quot;code-quote&quot;&gt;&quot; reported by the stream header seems to be incorrect (off by &quot;&lt;/span&gt; + 
                          (length1 - offset) + &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;(s)), adjusted to &quot;&lt;/span&gt; + offset);

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; offset;
    }

    &lt;span class=&quot;code-comment&quot;&gt;// no discrepancy between length1 and offset, so the header seems to be correct already
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; length1;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14148007" author="jahewson" created="Thu, 25 Sep 2014 17:21:52 +0000"  >&lt;p&gt;I&apos;ve attached a PDF file which I altered with my hex editor to have a Length1 which is off-by-one, we can use this as a test file.&lt;/p&gt;</comment>
                            <comment id="14148158" author="jira-bot" created="Thu, 25 Sep 2014 19:08:54 +0000"  >&lt;p&gt;Commit 1627592 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1627592&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1627592&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2350&quot; title=&quot;Type1 Parser hangs indefinitely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2350&quot;&gt;&lt;del&gt;PDFBOX-2350&lt;/del&gt;&lt;/a&gt;: Repair invalid Length1 values for Type1 fonts, thanks to Daniel Scheibe&lt;/p&gt;</comment>
                            <comment id="14148159" author="jahewson" created="Thu, 25 Sep 2014 19:09:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=daniel.scheibe&quot; class=&quot;user-hover&quot; rel=&quot;daniel.scheibe&quot;&gt;daniel.scheibe&lt;/a&gt; I&apos;ve applied a minimal version of your patch, let me know if everything is working, thanks!&lt;/p&gt;</comment>
                            <comment id="14148943" author="daniel.scheibe" created="Fri, 26 Sep 2014 09:02:42 +0000"  >&lt;p&gt;I tested against various PDF files and it works like a charm! Thanks a lot.&lt;/p&gt;
</comment>
                            <comment id="14338832" author="jira-bot" created="Thu, 26 Feb 2015 18:14:26 +0000"  >&lt;p&gt;Commit 1662522 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1662522&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1662522&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2350&quot; title=&quot;Type1 Parser hangs indefinitely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2350&quot;&gt;&lt;del&gt;PDFBOX-2350&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2128&quot; title=&quot;CMYK images are not supported correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2128&quot;&gt;&lt;del&gt;PDFBOX-2128&lt;/del&gt;&lt;/a&gt;: also skip for space after eexec in type1 font&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13040944">PDFBOX-3677</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12670292" name="PDFBOX-2350-289451-endless.pdf" size="572375" author="tilman" created="Sun, 21 Sep 2014 14:08:50 +0000"/>
                            <attachment id="12671260" name="bad_length1.pdf" size="11217" author="jahewson" created="Thu, 25 Sep 2014 17:21:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 38 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i201m7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>