<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:07:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4317] Some feature of the given JPEG leads to erroneous results, when adding (drawing) it to a PDPageContentStream.</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4317</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Some feature of the given JPEG leads to erroneous results, when adding (drawing) it to a PDPageContentStream.&lt;/p&gt;

&lt;p&gt;The document itself is created just fine and the page is displayable in the &quot;PDF Debugger&quot; application, but for example the Adobe Reader is reporting an &quot;internal Error&quot;, when opening the created PDF.&lt;/p&gt;

&lt;p&gt;Reproducable via:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;(PDDocument document = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDDocument()){
 PDPage page = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPage();
 &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;(PDPageContentStream pcs = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPageContentStream(document, page)){
    PDImageXObject pdImage = PDImageXObject.createFromFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;path to jpeg&quot;&lt;/span&gt;, document);
    pcs.drawImage(pdImage, 30, 30);
 }

 document.addPage(page);
 document.save(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;output file&quot;&lt;/span&gt;));
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13184807">PDFBOX-4317</key>
            <summary>Some feature of the given JPEG leads to erroneous results, when adding (drawing) it to a PDPageContentStream.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10004">Not A Bug</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="CAP-Softvision">CAP</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Sep 2018 07:14:54 +0000</created>
                <updated>Thu, 27 Sep 2018 18:28:27 +0000</updated>
                            <resolved>Thu, 27 Sep 2018 18:28:27 +0000</resolved>
                                    <version>2.0.9</version>
                                                    <component>Writing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16613741" author="tilman" created="Thu, 13 Sep 2018 16:36:04 +0000"  >&lt;p&gt;PDF-Tools says that the file is OK&lt;br/&gt;
&lt;a href=&quot;https://www.pdf-online.com/osa/validate.aspx&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.pdf-online.com/osa/validate.aspx&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Where did you get the jpeg file?&lt;/p&gt;</comment>
                            <comment id="16614466" author="cap-softvision" created="Fri, 14 Sep 2018 07:19:41 +0000"  >&lt;p&gt;Hello Mr. Hausherr,&lt;br/&gt;
 that is exactly what is confusing me. The PDF does contain all necessary information in a valid form, to display the image and ie the PDF Debugger never complained about the containing page and displays the image just fine.&lt;br/&gt;
 Also I am not able to find anything, that is &quot;special&quot; about this jpeg and I have already disected it to the best of my ability. We have already added similar jpegs to PDF files (using PDFbox) and never encountered a behaviour like this.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;The problem&lt;/b&gt;&lt;br/&gt;
 When opening the PDF in Adobe applications like Adobe Reader or Adobe Acrobat Pro DC, the application will still claim, that the image&apos;s stream is erroneous (appended screenshots).&lt;br/&gt;
 As the PDF has been created using the given code, this can only be referring to the image stream (as the stream is the only thing contained in the PDF).&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Where did you get it?&lt;/b&gt;&lt;br/&gt;
 The image has been send to us by a customer and &quot;Has been shot using an Android-Handy. Has been send to another user via WhatsApp and has finally been appended to a mail (*.eml) file.&quot;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;EDIT&lt;/b&gt;&lt;br/&gt;
I appended a PDF file, that has been created by Adobe Acrobat Pro DC and does seem to contain the image in a &quot;valid&quot; stream.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Adobe Acrobat Pro DC&lt;/b&gt;&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12939665/12939665_image-2018-09-14-09-14-45-358.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Adobe Reader (an internal Error occurred)&lt;/b&gt;&lt;br/&gt;
 &lt;b&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12939666/12939666_image-2018-09-14-09-15-40-860.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/b&gt;&lt;/p&gt;</comment>
                            <comment id="16614567" author="cap-softvision" created="Fri, 14 Sep 2018 09:24:56 +0000"  >&lt;p&gt;&lt;b&gt;Update:&lt;/b&gt;&lt;br/&gt;
The JPEG is using Huffman progressive encoding. Some of those progressive JPEG images (not all) cause this problem. Following the PDF reference manual, progressive encoding should be supported by PDF files via the DCTDecode filter:&lt;/p&gt;

&lt;p&gt;&lt;b&gt;(DCTDecode filter - chapter 7.4.8 - PDF 32000-1:2008)&lt;/b&gt;&lt;br/&gt;
&lt;em&gt;&quot;In addition to the baseline JPEG format, beginning with PDF 1.3, the DCTDecode filter shall support the progressive JPEG extension. This extension does not add any entries to the DCTDecode parameter dictionary; the distinction between baseline and progressive JPEG shall be represented in the encoded data.&quot;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Either the said &lt;em&gt;&quot;representation in the encoded data&quot;&lt;/em&gt; is missing, or the said Adobe applications are not well prepared to display such JPEGs. Adobe won&apos;t fix it and has already been asked. We are completly unsure if PDFbox is causing a problem at all. However we also can not definately claim, that the stream created by PDFbox does contain everything needed (for PDF viewers) to display such images.&lt;/p&gt;

&lt;p&gt;It is entirely possible, that Adobe is causing the problem, by not being able to handle some minor property or detail of &lt;em&gt;some&lt;/em&gt; progressive JPEG files.&lt;/p&gt;</comment>
                            <comment id="16615226" author="tilman" created="Fri, 14 Sep 2018 18:38:56 +0000"  >&lt;p&gt;To be sure I tried with an old version (2.0.0), also tried not to compress the content stream, but it still happens. I also tried to manually isolate the stream from the PDF an save that, and it was a jpeg.&lt;/p&gt;

&lt;p&gt;You wrote that &quot;Adobe won&apos;t fix it and has already been asked&quot; does this mean they declined to fix this or that they didn&apos;t respond (or responded with a boiler plate text)?&lt;/p&gt;</comment>
                            <comment id="16617163" author="cap-softvision" created="Mon, 17 Sep 2018 07:22:07 +0000"  >&lt;p&gt;The stream itself and the contained data seem to be absolutely valid - regenerating the original Jpeg has been possible in all my experiments. The stream itself must therefore be &quot;complete&quot;. However some additional PDF specific information might be missing from the stream, as the stream itself shall contain some extra information needed to identify the JPEG&apos;s progressive encoding. (assumption based on the reference manual)&lt;br/&gt;
I think that without this information Adobe Reader (and similar programs) might default to treating the JPEG as a baseline JPEG image (which might explain the failure displaying the stream).&lt;/p&gt;

&lt;p&gt;Adobe DC is no big help in generating a &quot;valid&quot; progressive JPEG stream for comparison, as they avoid adding progressive JPEG images to PDFs altogether. They will convert any progressive JPEG images to baseline JPEGs (maybe to evade the whole problem).&lt;br/&gt;
For sure Adobe does not care much about adding progressive JPEG images to PDFs at all. According to &lt;br/&gt;
&lt;b&gt;hint 5 in chapter 7.4.8:&lt;/b&gt;&lt;br/&gt;
&lt;em&gt;&quot;There is no benefit to using progressive JPEG for stream data that is embedded in a PDF file. Decoding progressive JPEG is slower and consumes more memory than baseline JPEG. The purpose of this feature is to enable a stream to refer to an external file whose data happens to be already encoded in progressive JPEG.&quot;&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Adobe&apos;s standard answer:&lt;/b&gt;&lt;br/&gt;
Adobe told the customer to ask the &quot;creator of the PDF file&quot; for help. They don&apos;t see any reason to fix it, as they are claiming, that the stream is incomplete and must be fixed in the producing application. Entirely possible and they might be correct about that - but still... Other applications are indeed capable of displaying the Image (/reading the erroneous stream).&lt;/p&gt;</comment>
                            <comment id="16617964" author="tilman" created="Mon, 17 Sep 2018 18:25:48 +0000"  >&lt;p&gt;I also created a PDF with itext 5 and I got the same problem:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Document document = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Document();
PdfWriter.getInstance(document, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;itext.pdf&quot;&lt;/span&gt;));
document.open();
Image img = Image.getInstance(&lt;span class=&quot;code-quote&quot;&gt;&quot;IMG-20180719-WA0000.jpg&quot;&lt;/span&gt;);
document.add(img);
document.close();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;pom excerpt:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;com.itextpdf&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;itextpdf&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;5.5.13&amp;lt;/version&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If the image is on the second page, then the image appears black.&lt;/p&gt;</comment>
                            <comment id="16623825" author="tilman" created="Fri, 21 Sep 2018 16:08:53 +0000"  >&lt;p&gt;I&apos;ll add a warning for progressive JPEG files. First in the trunk, after release of 2.0.12 also in the 2.0.13 version.&lt;/p&gt;</comment>
                            <comment id="16623880" author="jira-bot" created="Fri, 21 Sep 2018 17:00:30 +0000"  >&lt;p&gt;Commit 1841612 from tilman@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1841612&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1841612&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4317&quot; title=&quot;Some feature of the given JPEG leads to erroneous results, when adding (drawing) it to a PDPageContentStream.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4317&quot;&gt;&lt;del&gt;PDFBOX-4317&lt;/del&gt;&lt;/a&gt;: add warning about progressive JPEGs not being displayed by Adobe Reader&lt;/p&gt;</comment>
                            <comment id="16624038" author="jira-bot" created="Fri, 21 Sep 2018 18:57:04 +0000"  >&lt;p&gt;Commit 1841629 from tilman@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1841629&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1841629&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4317&quot; title=&quot;Some feature of the given JPEG leads to erroneous results, when adding (drawing) it to a PDPageContentStream.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4317&quot;&gt;&lt;del&gt;PDFBOX-4317&lt;/del&gt;&lt;/a&gt;: catch exception that happens with CMYK test with oracle image reader&lt;/p&gt;</comment>
                            <comment id="16630302" author="cap-softvision" created="Thu, 27 Sep 2018 12:26:53 +0000"  >&lt;p&gt;&lt;b&gt;Update concerning the issue (and especially this image):&lt;/b&gt;&lt;br/&gt;
 Adobe had another look into the problem and claim, that the image itself is erroneous (as it is missing required DHT markers), which are ignored in simple applications like paint, but lead to said issues in more complex applications, that indeed try to evaluate the markers. (such as the Adobe Reader)&lt;br/&gt;
 Long story short: The image does not conform to the progressive JPEG standard and the issue is most likely located in the application creating the JPEG.&lt;/p&gt;

&lt;p&gt;Sorry for having bothered you and thanks for your support!&lt;/p&gt;

&lt;p&gt;&lt;b&gt;(In case you are a german speaker - the answer from Adobe: )&lt;/b&gt;&lt;br/&gt;
&lt;em&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;Zum anderen ist das JPEG selber nicht korrekt. Es kann beispielsweise nicht in Photoshop ge&#246;ffnet werden (siehe anh&#228;ngendes Photoshop.png). Meine Kollegen vom Photoshop-Team&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;haben sich dies angesehen und mich wissen lassen, dass dies passiert, weil das JPEG leere DHT-Markers hat. Diese werden in einfachen Apps wie Paint ignoriert (so dass ich das JPEG dort aufmachen und in das PDF konvertieren konnte, das ich Ihnen mit meiner&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;letzten Mail schickte) aber Photoshop und Acrobat versuchen diese auszulesen und wenn dort keine Informationen sind, kann das JPEG nicht ge&#246;ffnet oder angezeigt werden.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;&lt;em&gt;Zusammengefasst heisst das, dass das JPEG nicht den Standards entspricht und die PDF keine korrekte PDF/A-1b ist. Das ist leide rnichts, was wir &#228;ndern k&#246;nnen. Ich&lt;/em&gt;&lt;br/&gt;
 &lt;em&gt;habe dahe rin diesem Fall leider keine L&#246;sung.&lt;/em&gt;&lt;/p&gt;</comment>
                            <comment id="16630855" author="jira-bot" created="Thu, 27 Sep 2018 18:24:20 +0000"  >&lt;p&gt;Commit 1842137 from tilman@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1842137&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1842137&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4317&quot; title=&quot;Some feature of the given JPEG leads to erroneous results, when adding (drawing) it to a PDPageContentStream.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4317&quot;&gt;&lt;del&gt;PDFBOX-4317&lt;/del&gt;&lt;/a&gt;: revert last 2 commits per user &amp;amp; Adobe feedback - problem is not because of progressive files, but because of incorrect file&lt;/p&gt;</comment>
                            <comment id="16630860" author="tilman" created="Thu, 27 Sep 2018 18:28:27 +0000"  >&lt;p&gt;Thank you and Adobe for the detailed feedback, I&apos;ve reverted the change. If you can, please tell Adobe to improve their error message. Sadly we can&apos;t detect such files.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12939517" name="IMG-20180719-WA0000.jpg" size="89057" author="CAP-Softvision" created="Thu, 13 Sep 2018 07:01:29 +0000"/>
                            <attachment id="12939669" name="UsingAdobeDC.pdf" size="99448" author="CAP-Softvision" created="Fri, 14 Sep 2018 07:44:01 +0000"/>
                            <attachment id="12939664" name="image-2018-09-14-09-13-56-216.png" size="8320" author="CAP-Softvision" created="Fri, 14 Sep 2018 07:14:29 +0000"/>
                            <attachment id="12939665" name="image-2018-09-14-09-14-45-358.png" size="8320" author="CAP-Softvision" created="Fri, 14 Sep 2018 07:15:18 +0000"/>
                            <attachment id="12939666" name="image-2018-09-14-09-15-40-860.png" size="9778" author="CAP-Softvision" created="Fri, 14 Sep 2018 07:16:14 +0000"/>
                            <attachment id="12940043" name="itext.pdf" size="90038" author="tilman" created="Mon, 17 Sep 2018 18:23:22 +0000"/>
                            <attachment id="12939516" name="out.pdf" size="89921" author="CAP-Softvision" created="Thu, 13 Sep 2018 07:10:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 7 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y1j3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>