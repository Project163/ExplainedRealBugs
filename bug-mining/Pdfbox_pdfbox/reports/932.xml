<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:59:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2636] Colorspaces of annotations not treated correctly</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2636</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I get this exception with preflight&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.ArrayIndexOutOfBoundsException: -1
	at java.util.ArrayList.elementData(Unknown Source)
	at java.util.ArrayList.get(Unknown Source)
	at org.apache.pdfbox.cos.COSArray.get(COSArray.java:210)
	at org.apache.pdfbox.pdmodel.graphics.color.PDColor.&amp;lt;init&amp;gt;(PDColor.java:48)
	at org.apache.pdfbox.pdmodel.interactive.annotation.PDAnnotation.getColor(PDAnnotation.java:647)
	at org.apache.pdfbox.preflight.annotation.AnnotationValidator.checkColors(AnnotationValidator.java:133)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;at first, it looks like a regression by &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2629&quot; title=&quot;PDAnnotation should not use PDGamma for colors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2629&quot;&gt;&lt;del&gt;PDFBOX-2629&lt;/del&gt;&lt;/a&gt; but the code was never correct even before: the &quot;C&quot; (and IC, BC, BG) property of annotations can have different colorspaces or none:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;An array of numbers in the range 0.0 to 1.0, representing a colour used for the following purposes: (...)&lt;br/&gt;
The number of array elements determines the colour space in which the colour shall be defined:&lt;br/&gt;
0 No colour; transparent&lt;br/&gt;
1 DeviceGray&lt;br/&gt;
3 DeviceRGB&lt;br/&gt;
4 DeviceCMYK&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The same problem exists for the IC and BC items of an annotation.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; - could you please look whether PDF/A-1b has a requirement that only RGB is allowed for annotations? In ordinary PDF, Gray, RGB, CMYK or None  are allowed, but currently PDFBox Preflight forbids CMYK or Gray, instead of checking that the output intent matches the color space. I&apos;ve also read that DeviceGray accepts an RGB or CMYK icc profile.&lt;br/&gt;
&lt;a href=&quot;http://www.pdfa.org/2011/09/pdfa-und-farbe/?lang=de#zugelassene_farbraeume&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.pdfa.org/2011/09/pdfa-und-farbe/?lang=de#zugelassene_farbraeume&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12770733">PDFBOX-2636</key>
            <summary>Colorspaces of annotations not treated correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Jan 2015 17:16:35 +0000</created>
                <updated>Thu, 17 Mar 2016 19:07:27 +0000</updated>
                            <resolved>Sat, 31 Jan 2015 18:24:27 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Parsing</component>
                    <component>Preflight</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14295445" author="jira-bot" created="Wed, 28 Jan 2015 17:33:54 +0000"  >&lt;p&gt;Commit 1655400 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1655400&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1655400&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2636&quot; title=&quot;Colorspaces of annotations not treated correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2636&quot;&gt;&lt;del&gt;PDFBOX-2636&lt;/del&gt;&lt;/a&gt;: add &quot;IC&quot; COSName&lt;/p&gt;</comment>
                            <comment id="14295466" author="jira-bot" created="Wed, 28 Jan 2015 17:40:13 +0000"  >&lt;p&gt;Commit 1655404 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1655404&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1655404&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2636&quot; title=&quot;Colorspaces of annotations not treated correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2636&quot;&gt;&lt;del&gt;PDFBOX-2636&lt;/del&gt;&lt;/a&gt;: &quot;IC&quot; and &quot;BS&quot; as COSName&lt;/p&gt;</comment>
                            <comment id="14295621" author="jira-bot" created="Wed, 28 Jan 2015 18:58:18 +0000"  >&lt;p&gt;Commit 1655432 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1655432&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1655432&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2636&quot; title=&quot;Colorspaces of annotations not treated correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2636&quot;&gt;&lt;del&gt;PDFBOX-2636&lt;/del&gt;&lt;/a&gt;: &quot;BG&quot; and &quot;MK&quot; as COSName&lt;/p&gt;</comment>
                            <comment id="14295778" author="jahewson" created="Wed, 28 Jan 2015 20:17:48 +0000"  >&lt;p&gt;I assumed the existing code which hardcoded PDDeviceRGB was correct, but it clearly wasn&apos;t. Take a look at getBackground() in PDAppearanceCharacteristicsDictionary, which I modified in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2629&quot; title=&quot;PDAnnotation should not use PDGamma for colors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2629&quot;&gt;&lt;del&gt;PDFBOX-2629&lt;/del&gt;&lt;/a&gt;. Because the original code in that method didn&apos;t include any color space, I referred to the PDF spec and implemented the 0,1,3,4 switch which it describes:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;PDColorSpace colorSpace = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; (((COSArray) c).size())
{
    &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; 1: colorSpace = PDDeviceGray.INSTANCE; &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; 3: colorSpace = PDDeviceRGB.INSTANCE; &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; 4: colorSpace = PDDeviceCMYK.INSTANCE; &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
}
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDColor((COSArray) c, colorSpace);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So it looks like we want to use that code everywhere where DeviceRGB is assumed currently.&lt;/p&gt;</comment>
                            <comment id="14295785" author="tilman" created="Wed, 28 Jan 2015 20:23:39 +0000"  >&lt;p&gt;Yes, I had something like that in mind.&lt;/p&gt;</comment>
                            <comment id="14295812" author="jira-bot" created="Wed, 28 Jan 2015 20:36:52 +0000"  >&lt;p&gt;Commit 1655459 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1655459&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1655459&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2636&quot; title=&quot;Colorspaces of annotations not treated correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2636&quot;&gt;&lt;del&gt;PDFBOX-2636&lt;/del&gt;&lt;/a&gt;: return correct colorspace for annotations according to array size&lt;/p&gt;</comment>
                            <comment id="14295816" author="tilman" created="Wed, 28 Jan 2015 20:39:47 +0000"  >&lt;p&gt;My prepared code was different but did the same as yours. I took yours so that it be clear that we&apos;ve double code now that could be refactored somehow to have it only once.&lt;/p&gt;</comment>
                            <comment id="14296508" author="jira-bot" created="Thu, 29 Jan 2015 07:26:34 +0000"  >&lt;p&gt;Commit 1655538 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1655538&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1655538&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2636&quot; title=&quot;Colorspaces of annotations not treated correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2636&quot;&gt;&lt;del&gt;PDFBOX-2636&lt;/del&gt;&lt;/a&gt;: allow empty array in constructor&lt;/p&gt;</comment>
                            <comment id="14299917" author="msahyoun" created="Sat, 31 Jan 2015 18:07:20 +0000"  >&lt;p&gt;with regards to colors for annotations&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;An annotation dictionary shall not contain the C array or the IC array unless the colour space of the DestOutputProfile in the PDF/A-1 OutputIntent dictionary, defined in 6.2.2, is RGB.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="14299923" author="tilman" created="Sat, 31 Jan 2015 18:22:49 +0000"  >&lt;p&gt;Thanks... I didn&apos;t expect that (and I&apos;m glad I didn&apos;t commit the preflight changes I did), but there is some logic in it: annotations are looked at on a screen, not on a printer.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24wpj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>