<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:06:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3833] Characters in wrong order</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3833</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The attached pdf file (which is page 3 of &lt;a href=&quot;https://jp.mathworks.com/tagteam/89688_93050v00_JP_machine_learning_section1_ebook.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://jp.mathworks.com/tagteam/89688_93050v00_JP_machine_learning_section1_ebook.pdf&lt;/a&gt;) shows multiple problems when reading with PDFBox in standard settings. This bug report in particular is about the Katakana &#12540; being misplaced.&lt;/p&gt;

&lt;p&gt;In the text block on the left, the second line starts with &#12479;&#12540;&#12531;. PDFTextStripper.getText returns text starting with &#12479; &#12531;&#12540; (i.e., adding a space after the first character and swapping the second and third one). This effect also happens at other places in the (complete) file.&lt;/p&gt;

&lt;p&gt;The PDF itself at this point has &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;lt;03BB&amp;gt;43.9 &amp;lt;0294&amp;gt;156 &amp;lt;03EF&amp;gt;-24.5 ...&amp;#93;&lt;/span&gt;TJ, listing the characters in the proper order. Copy&amp;amp;paste using Apple&apos;s Preview.App also preserves that order.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13081106">PDFBOX-3833</key>
            <summary>Characters in wrong order</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="ccreutzig">Christopher Creutzig</reporter>
                        <labels>
                            <label>diacritic</label>
                    </labels>
                <created>Tue, 20 Jun 2017 11:55:12 +0000</created>
                <updated>Fri, 21 Jul 2017 04:40:12 +0000</updated>
                            <resolved>Wed, 21 Jun 2017 16:54:13 +0000</resolved>
                                    <version>2.0.5</version>
                    <version>2.0.6</version>
                                    <fixVersion>2.0.7</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Text extraction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16055901" author="tallison@mitre.org" created="Tue, 20 Jun 2017 15:06:09 +0000"  >&lt;p&gt;&lt;em&gt;Might&lt;/em&gt; be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3674&quot; title=&quot;Incorrect ordering of fatha -- potentially indicative of larger issue with RTL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3674&quot;&gt;PDFBOX-3674&lt;/a&gt;.  Haven&apos;t had a chance to look, but we should check if a fix to this fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3674&quot; title=&quot;Incorrect ordering of fatha -- potentially indicative of larger issue with RTL&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3674&quot;&gt;PDFBOX-3674&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16056038" author="tilman" created="Tue, 20 Jun 2017 16:25:02 +0000"  >&lt;p&gt;This is the output of PrintTextLocations:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[45.56,191.7999 fs=1.0 xscale=12.0 height=9.156 space=12.000002 width=12.0]?
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[65.337204,191.7999 fs=1.0 xscale=12.0 height=9.156 space=12.000002 width=12.0]??
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It should be 3 lines... and what&apos;s also suspicious is this URL about&lt;br/&gt;
&lt;a href=&quot;http://www.fileformat.info/info/unicode/char/30fc/index.htm&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.fileformat.info/info/unicode/char/30fc/index.htm&lt;/a&gt;&lt;br/&gt;
it mentions that the &#12540; is a &quot;modifier&quot;. &lt;tt&gt;TextPosition.isDiacritic()&lt;/tt&gt; returns true.&lt;/p&gt;

&lt;p&gt;More on the &quot;&#12540;&quot;:&lt;br/&gt;
&lt;a href=&quot;http://www.japanesewithanime.com/2017/04/prolonged-sound-mark.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.japanesewithanime.com/2017/04/prolonged-sound-mark.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16056369" author="tilman" created="Tue, 20 Jun 2017 19:58:35 +0000"  >&lt;p&gt;The cause of the problem is that the &quot;&#12540;&quot; slightly overlaps with the next glyph. The code from PDFTextStripper then thinks they belong together:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    TextPosition previousTextPosition = textList.get(textList.size() - 1);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (text.isDiacritic() &amp;amp;&amp;amp; previousTextPosition.contains(text))
    {
        previousTextPosition.mergeDiacritic(text);
    }
    &lt;span class=&quot;code-comment&quot;&gt;// If the previous TextPosition was the diacritic, merge it into &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// one and remove it from the list.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (previousTextPosition.isDiacritic() &amp;amp;&amp;amp; text.contains(previousTextPosition))
    {
        text.mergeDiacritic(previousTextPosition);
        textList.remove(textList.size() - 1);
        textList.add(text);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
    {
        textList.add(text);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt&gt;TextPosition.contains()&lt;/tt&gt; allows an overlap of 15%. I had to set it to 25% for the extraction to work properly.&lt;/p&gt;

&lt;p&gt;Another solution would be have &lt;tt&gt;isDiacritic()&lt;/tt&gt; return false for &quot;&#12540;&quot;.&lt;/p&gt;</comment>
                            <comment id="16057046" author="ccreutzig" created="Wed, 21 Jun 2017 06:19:47 +0000"  >&lt;p&gt;Thanks, that makes sense.&lt;/p&gt;

&lt;p&gt;&#12540; is a diacritic in the sense that it changes the pronunciation of the previous mora and does not have a sound of its own.&lt;br/&gt;
But in terms of layout, as far as I know, it behaves just like any other character (except it is the only kana rotated for vertical text). I.e., in terms of layout, it does not behave like a diacritic, the way &#168; or &#710; do.&lt;/p&gt;

&lt;p&gt;Seems to me that in the context of an algorithm concerned with character placement as opposed to transliteration or text-to-speech, &#12540; should indeed not be regarded a diacritic.&lt;/p&gt;</comment>
                            <comment id="16057060" author="jira-bot" created="Wed, 21 Jun 2017 06:33:14 +0000"  >&lt;p&gt;Commit 1799390 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1799390&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1799390&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3833&quot; title=&quot;Characters in wrong order&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3833&quot;&gt;&lt;del&gt;PDFBOX-3833&lt;/del&gt;&lt;/a&gt;: don&apos;t treat prolonged sound mark as a diacritic&lt;/p&gt;</comment>
                            <comment id="16057061" author="jira-bot" created="Wed, 21 Jun 2017 06:33:19 +0000"  >&lt;p&gt;Commit 1799391 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1799391&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1799391&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3833&quot; title=&quot;Characters in wrong order&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3833&quot;&gt;&lt;del&gt;PDFBOX-3833&lt;/del&gt;&lt;/a&gt;: don&apos;t treat prolonged sound mark as a diacritic&lt;/p&gt;</comment>
                            <comment id="16057074" author="tilman" created="Wed, 21 Jun 2017 07:00:40 +0000"  >&lt;p&gt;You can test with a snapshot at&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.7-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.7-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll add the reduced file to the test repository tonight. Thanks also for your investigation in your first text, that made it easier.&lt;/p&gt;</comment>
                            <comment id="16057791" author="jira-bot" created="Wed, 21 Jun 2017 16:27:04 +0000"  >&lt;p&gt;Commit 1799483 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1799483&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1799483&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3833&quot; title=&quot;Characters in wrong order&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3833&quot;&gt;&lt;del&gt;PDFBOX-3833&lt;/del&gt;&lt;/a&gt;: add test case&lt;/p&gt;</comment>
                            <comment id="16057792" author="jira-bot" created="Wed, 21 Jun 2017 16:27:59 +0000"  >&lt;p&gt;Commit 1799484 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1799484&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1799484&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3833&quot; title=&quot;Characters in wrong order&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3833&quot;&gt;&lt;del&gt;PDFBOX-3833&lt;/del&gt;&lt;/a&gt;: add test case&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12873661" name="ML_mathworks_unc2.pdf" size="317732" author="ccreutzig" created="Tue, 20 Jun 2017 11:53:36 +0000"/>
                            <attachment id="12873706" name="PDFBOX-3833-reduced.pdf" size="101823" author="tilman" created="Tue, 20 Jun 2017 16:01:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 21 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ghqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>