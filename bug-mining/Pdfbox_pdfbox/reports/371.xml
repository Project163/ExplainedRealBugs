<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:54:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1810] PDFToImage: Image of pdf is resized and drawn multiple times at top of output image</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1810</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Hi,&lt;br/&gt;
all the pdfs created with simple scan (&lt;a href=&quot;https://launchpad.net/simple-scan&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://launchpad.net/simple-scan&lt;/a&gt;) are not correctly converted into images.&lt;br/&gt;
A single page is resized and drawn multiple times at the top of the output image. &lt;br/&gt;
Using the pdfbox app on windows with the newest orcale java 7 causes a java heap error.&lt;/p&gt;</description>
                <environment>Debian testing, OpenJDK7</environment>
        <key id="12684539">PDFBOX-1810</key>
            <summary>PDFToImage: Image of pdf is resized and drawn multiple times at top of output image</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="Burtan">Frederik Bertling</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Dec 2013 20:37:20 +0000</created>
                <updated>Wed, 7 Jan 2015 19:10:05 +0000</updated>
                            <resolved>Wed, 7 Jan 2015 19:10:05 +0000</resolved>
                                    <version>1.8.2</version>
                    <version>1.8.3</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.8.4</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13847886" author="burtan" created="Fri, 13 Dec 2013 20:40:53 +0000"  >&lt;p&gt;Sample pdf&lt;/p&gt;</comment>
                            <comment id="13847887" author="burtan" created="Fri, 13 Dec 2013 20:41:36 +0000"  >&lt;p&gt;sample converted images with pdfbox app 2.0.0 snapshot&lt;/p&gt;</comment>
                            <comment id="13851622" author="tilman" created="Wed, 18 Dec 2013 11:47:20 +0000"  >&lt;p&gt;@Frederik: Could you attach a PDF that has only black &amp;amp; white, i.e. 2 colors? Yours has 4 gray colors.&lt;/p&gt;

&lt;p&gt;Don&apos;t know whether it is a problem with pdfbox or with the pdf itself, but here&apos;s what I found out:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;&amp;lt;
/Type /XObject
/Subtype /Image
/Width 4960
/Height 6944
/ColorSpace /DeviceGray
/BitsPerComponent 2
/Length 282806
/Filter /FlateDecode
&amp;gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Bytes needed IMO (width * height * bitspercomponent / 8) :&lt;br/&gt;
4960 * 6944 * 2 / 8 = 8610560&lt;br/&gt;
that happens to be exactly the size of the decompressed FlateDecoded first image of the pdf.&lt;/p&gt;

&lt;p&gt;But in PDPixelmap, after the colorspace is chosen, this is copied into an array of size 34442240. That number is 4960 * 6944, i.e. now its one gray color per byte.&lt;/p&gt;

&lt;p&gt;A bit of logging shows:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;PDPixelMap:307 - ColorModel: ColorModel: #pixelBits = 8 numComponents = 1 color space = java.awt.color.ICC_ColorSpace@19c2ffca transparency = 1 has alpha = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; isAlphaPre = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
PDPixelMap:308 - getPixelSize: 8
PDPixelMap:311 - getDataType: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The &quot;#pixelBits = 8&quot; is not what I would expect.&lt;/p&gt;

&lt;p&gt;What we&apos;d need is a colorspace that has four pixels in a byte. In PDDeviceGray, this code results in getting a correctly rendered image:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ColorModel createColorModel(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; bpc) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
    {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ImageTypeSpecifier.createGrayscale(bpc, DataBuffer.TYPE_BYTE, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;).getColorModel();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, a trace is also weird:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;PDPixelMap:307 - ColorModel: IndexColorModel: #pixelBits = 2 numComponents = 3 color space = java.awt.color.ICC_ColorSpace@75247397 transparency = 1 transIndex   = -1 has alpha = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; isAlphaPre = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
PDPixelMap:308 - getPixelSize: 2
PDPixelMap:311 - getDataType: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;numComponents = 3 makes no sense.&lt;/p&gt;</comment>
                            <comment id="13851624" author="tilman" created="Wed, 18 Dec 2013 11:48:16 +0000"  >&lt;p&gt;Image rendered with different colorspace&lt;/p&gt;</comment>
                            <comment id="13851687" author="burtan" created="Wed, 18 Dec 2013 13:15:21 +0000"  >&lt;p&gt;Hi Tilman, thanks for taking care.&lt;br/&gt;
I think that pdf was created by using the &quot;scan text&quot; feature of simple scan which might limit the colours to 4 grey types. I could try to find a scan feature which scans black and white only, if that is what you mean by providing an image with just black and white?&lt;/p&gt;

&lt;p&gt;So far, this seems to be a problem with color space conversion?&lt;/p&gt;

&lt;p&gt;At least, imageMagick does a correct image conversion.&lt;/p&gt;</comment>
                            <comment id="13851748" author="tilman" created="Wed, 18 Dec 2013 14:01:36 +0000"  >&lt;p&gt;Yes &quot;providing an image with just black and white&quot; that is what I mean. So that we have another pdf (this time with 1 bitspercomponent) to see what happens. Maybe the image will appear 8 times &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13851861" author="burtan" created="Wed, 18 Dec 2013 15:57:47 +0000"  >&lt;p&gt;Simple Scan does not offer many options but I think it uses the same converter as xsane. Thus I tried xsane in different color modes. &lt;br/&gt;
24bit -&amp;gt; fine&lt;br/&gt;
truegray -&amp;gt; fine&lt;br/&gt;
gray, b+w both&lt;/p&gt;

&lt;p&gt;frederik@fred-deb-t440p:~$ java -jar pdfbox-app-2.0.0-SNAPSHOT.jar PDFToImage b+w.pdf &lt;br/&gt;
Dez 18, 2013 4:57:04 PM org.apache.pdfbox.util.PDFStreamEngine processOperator&lt;br/&gt;
WARNING: java.lang.ArrayIndexOutOfBoundsException&lt;br/&gt;
java.lang.ArrayIndexOutOfBoundsException&lt;br/&gt;
	at java.lang.System.arraycopy(Native Method)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.graphics.xobject.PDInlinedImage.createImage(PDInlinedImage.java:166)&lt;br/&gt;
	at org.apache.pdfbox.util.operator.pagedrawer.BeginInlineImage.process(BeginInlineImage.java:60)&lt;br/&gt;
	at org.apache.pdfbox.util.PDFStreamEngine.processOperator(PDFStreamEngine.java:529)&lt;br/&gt;
	at org.apache.pdfbox.util.PDFStreamEngine.processSubStream(PDFStreamEngine.java:258)&lt;br/&gt;
	at org.apache.pdfbox.util.PDFStreamEngine.processSubStream(PDFStreamEngine.java:225)&lt;br/&gt;
	at org.apache.pdfbox.util.PDFStreamEngine.processStream(PDFStreamEngine.java:205)&lt;br/&gt;
	at org.apache.pdfbox.pdfviewer.PageDrawer.drawPage(PageDrawer.java:152)&lt;br/&gt;
	at org.apache.pdfbox.util.RenderUtil.renderPage(RenderUtil.java:213)&lt;br/&gt;
	at org.apache.pdfbox.util.RenderUtil.convertToImage(RenderUtil.java:177)&lt;br/&gt;
	at org.apache.pdfbox.util.PDFImageWriter.writeImage(PDFImageWriter.java:114)&lt;br/&gt;
	at org.apache.pdfbox.PDFToImage.main(PDFToImage.java:244)&lt;br/&gt;
	at org.apache.pdfbox.PDFBox.main(PDFBox.java:96)&lt;/p&gt;

&lt;p&gt;Dez 18, 2013 4:57:04 PM org.apache.pdfbox.util.PDFStreamEngine processOperator&lt;br/&gt;
INFO: unsupported/disabled operation: EI&lt;br/&gt;
Dez 18, 2013 4:57:04 PM org.apache.pdfbox.util.PDFImageWriter writeImage&lt;/p&gt;</comment>
                            <comment id="13851866" author="burtan" created="Wed, 18 Dec 2013 16:01:58 +0000"  >&lt;p&gt;Simple Scan does not offer many options but I think it uses the same converter as xsane. Thus I tried xsane in different color modes. &lt;br/&gt;
24bit -&amp;gt; fine&lt;br/&gt;
truegray -&amp;gt; fine&lt;br/&gt;
gray, b+w both&lt;/p&gt;

&lt;p&gt;frederik@fred-deb-t440p:~$ java -jar pdfbox-app-2.0.0-SNAPSHOT.jar PDFToImage b+w.pdf &lt;br/&gt;
Dez 18, 2013 4:57:04 PM org.apache.pdfbox.util.PDFStreamEngine processOperator&lt;br/&gt;
WARNING: java.lang.ArrayIndexOutOfBoundsException&lt;br/&gt;
java.lang.ArrayIndexOutOfBoundsException&lt;br/&gt;
	at java.lang.System.arraycopy(Native Method)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.graphics.xobject.PDInlinedImage.createImage(PDInlinedImage.java:166)&lt;br/&gt;
	at org.apache.pdfbox.util.operator.pagedrawer.BeginInlineImage.process(BeginInlineImage.java:60)&lt;br/&gt;
	at org.apache.pdfbox.util.PDFStreamEngine.processOperator(PDFStreamEngine.java:529)&lt;br/&gt;
	at org.apache.pdfbox.util.PDFStreamEngine.processSubStream(PDFStreamEngine.java:258)&lt;br/&gt;
	at org.apache.pdfbox.util.PDFStreamEngine.processSubStream(PDFStreamEngine.java:225)&lt;br/&gt;
	at org.apache.pdfbox.util.PDFStreamEngine.processStream(PDFStreamEngine.java:205)&lt;br/&gt;
	at org.apache.pdfbox.pdfviewer.PageDrawer.drawPage(PageDrawer.java:152)&lt;br/&gt;
	at org.apache.pdfbox.util.RenderUtil.renderPage(RenderUtil.java:213)&lt;br/&gt;
	at org.apache.pdfbox.util.RenderUtil.convertToImage(RenderUtil.java:177)&lt;br/&gt;
	at org.apache.pdfbox.util.PDFImageWriter.writeImage(PDFImageWriter.java:114)&lt;br/&gt;
	at org.apache.pdfbox.PDFToImage.main(PDFToImage.java:244)&lt;br/&gt;
	at org.apache.pdfbox.PDFBox.main(PDFBox.java:96)&lt;/p&gt;

&lt;p&gt;Dez 18, 2013 4:57:04 PM org.apache.pdfbox.util.PDFStreamEngine processOperator&lt;br/&gt;
INFO: unsupported/disabled operation: EI&lt;br/&gt;
Dez 18, 2013 4:57:04 PM org.apache.pdfbox.util.PDFImageWriter writeImage&lt;/p&gt;

&lt;p&gt;Both b+w and gray report 1bit color depth, while 24bit and truegray report 24bit color depth&lt;/p&gt;</comment>
                            <comment id="13851900" author="tilman" created="Wed, 18 Dec 2013 16:45:50 +0000"  >&lt;p&gt;Thanks, very interesting! My change also handles that one. The cause is similar, although the effect is different, because PDInlinedImage does not choose the min value of the two buffers for System.arraycopy() like PDPixelMap does, thus the crash for the 1bit images.&lt;/p&gt;</comment>
                            <comment id="13851932" author="burtan" created="Wed, 18 Dec 2013 17:22:39 +0000"  >&lt;p&gt;Thanks for the fast service, I am glad that you could fix it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. I guess that fix will go into 2.0.0 soon?&lt;/p&gt;</comment>
                            <comment id="13851949" author="tilman" created="Wed, 18 Dec 2013 17:39:01 +0000"  >&lt;p&gt;A committer will have to decide. And I&apos;m not even sure that it is the correct solution, because of the &quot;numComponents = 3&quot; that makes no sense to me.&lt;/p&gt;</comment>
                            <comment id="13853809" author="lehmi" created="Fri, 20 Dec 2013 09:21:14 +0000"  >&lt;p&gt;I fixed this in revision 1552552 (trunk) and 1552553 (1.8 branch).&lt;/p&gt;

&lt;p&gt;My changes are based on Tilmans proposal. I just adapted the relevant part which is needed to handle different values of bpc when it comes to DeviceGray colorspaces.&lt;/p&gt;

&lt;p&gt;Thanks for the report and the investigation!&lt;/p&gt;</comment>
                            <comment id="13854039" author="tilman" created="Fri, 20 Dec 2013 15:14:53 +0000"  >&lt;p&gt;Thanks it works, plus after tracing through it now &quot;numComponents = 3&quot; makes sense to me. (identical r,g,b values = gray)&lt;/p&gt;</comment>
                            <comment id="13854162" author="burtan" created="Fri, 20 Dec 2013 17:03:53 +0000"  >&lt;p&gt;Very nice, I can confirm the fix in 2.0.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12619348" name="24bit.pdf" size="2042850" author="Burtan" created="Wed, 18 Dec 2013 15:58:24 +0000"/>
                            <attachment id="12618677" name="K3.pdf" size="396401" author="Burtan" created="Fri, 13 Dec 2013 20:40:53 +0000"/>
                            <attachment id="12618678" name="K31.jpg" size="167044" author="Burtan" created="Fri, 13 Dec 2013 20:41:36 +0000"/>
                            <attachment id="12618679" name="K32.jpg" size="78409" author="Burtan" created="Fri, 13 Dec 2013 20:41:36 +0000"/>
                            <attachment id="12619290" name="PDFBOX-1810.pdf-1.png" size="214558" author="tilman" created="Wed, 18 Dec 2013 11:48:16 +0000"/>
                            <attachment id="12619353" name="Settings.jpg" size="58197" author="Burtan" created="Wed, 18 Dec 2013 16:02:09 +0000"/>
                            <attachment id="12619349" name="b+w.pdf" size="36167" author="Burtan" created="Wed, 18 Dec 2013 15:58:24 +0000"/>
                            <attachment id="12619350" name="gray.pdf" size="73055" author="Burtan" created="Wed, 18 Dec 2013 15:58:24 +0000"/>
                            <attachment id="12619351" name="truegray.pdf" size="547707" author="Burtan" created="Wed, 18 Dec 2013 15:58:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363611</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 48 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qod3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>363917</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>