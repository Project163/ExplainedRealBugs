<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:05:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3732] IllegalArgumentException when refreshing an appearance and no font resources are defined</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3732</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;        PDDocument doc = PDDocument.load(new File(&quot;out.pdf&quot;));&lt;br/&gt;
        doc.getDocumentCatalog().getAcroForm().setNeedAppearances(false);&lt;br/&gt;
        doc.getDocumentCatalog().getAcroForm().refreshAppearances();&lt;br/&gt;
        doc.save(&quot;pdfbox.pdf&quot;);&lt;br/&gt;
        doc.close();&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.lang.IllegalArgumentException: /DR is a required entry&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.interactive.form.PDDefaultAppearanceString.&amp;lt;init&amp;gt;(PDDefaultAppearanceString.java:82)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13058559">PDFBOX-3732</key>
            <summary>IllegalArgumentException when refreshing an appearance and no font resources are defined</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="msahyoun">Maruan Sahyoun</assignee>
                                    <reporter username="ssteiner">Simon Steiner</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Mar 2017 11:26:41 +0000</created>
                <updated>Thu, 6 Dec 2018 10:54:11 +0000</updated>
                            <resolved>Fri, 12 May 2017 05:51:39 +0000</resolved>
                                    <version>2.0.5</version>
                                    <fixVersion>2.0.6</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>AcroForm</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15943544" author="tilman" created="Mon, 27 Mar 2017 16:17:17 +0000"  >&lt;p&gt;test case without external file, I also removed the DA entries. The result is a PDF that works fine with Adobe Reader.&lt;/p&gt;

&lt;p&gt;If the patch is used, then it should also include a default DA string, e.g. &quot;/Helv 12 Tf 0 g&quot;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;PDDocument document = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDDocument();
PDPage page = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPage();
document.addPage(page);

PDAcroForm acroForm = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDAcroForm(document);
document.getDocumentCatalog().setAcroForm(acroForm);

PDTextField textBox = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDTextField(acroForm);
textBox.setPartialName(&lt;span class=&quot;code-quote&quot;&gt;&quot;SampleField&quot;&lt;/span&gt;);
acroForm.getFields().add(textBox);

PDAnnotationWidget widget = textBox.getWidgets().get(0);
PDRectangle rect = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDRectangle(50, 750, 200, 20);
widget.setRectangle(rect);
widget.setPage(page);

page.getAnnotations().add(widget);

acroForm.setNeedAppearances(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
acroForm.getField(&lt;span class=&quot;code-quote&quot;&gt;&quot;SampleField&quot;&lt;/span&gt;).getCOSObject().setString(COSName.V, &lt;span class=&quot;code-quote&quot;&gt;&quot;content&quot;&lt;/span&gt;);

ByteArrayOutputStream baos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream();
document.save(baos); &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is a working PDF
&lt;/span&gt;
document = PDDocument.load(baos.toByteArray());
acroForm = document.getDocumentCatalog().getAcroForm();
&lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(acroForm.getField(&lt;span class=&quot;code-quote&quot;&gt;&quot;SampleField&quot;&lt;/span&gt;).getValueAsString()); // works!
&lt;/span&gt;acroForm.refreshAppearances(); &lt;span class=&quot;code-comment&quot;&gt;// boom
&lt;/span&gt;document.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15998726" author="msahyoun" created="Fri, 5 May 2017 18:25:46 +0000"  >&lt;p&gt;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12866651/12866651_PDFBOX3732-minimal.pdf&quot; title=&quot;PDFBOX3732-minimal.pdf attached to PDFBOX-3732&quot;&gt;PDFBOX3732-minimal.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; example form generated by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; code&lt;br/&gt;
&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12866650/12866650_PDFBOX3732-minimal-reader.pdf&quot; title=&quot;PDFBOX3732-minimal-reader.pdf attached to PDFBOX-3732&quot;&gt;PDFBOX3732-minimal-reader.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; opened and save with Adobe Reader&lt;/p&gt;</comment>
                            <comment id="15998728" author="msahyoun" created="Fri, 5 May 2017 18:28:04 +0000"  >&lt;p&gt;out.pdf saved by Adobe Reader&lt;/p&gt;</comment>
                            <comment id="15998734" author="msahyoun" created="Fri, 5 May 2017 18:29:35 +0000"  >&lt;p&gt;For the sample form created by the above code from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; Adobe Reader will add &lt;tt&gt;/Helv&lt;/tt&gt; and &lt;tt&gt;/ZaDb&lt;/tt&gt; resource entries to the PDF see &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12866650/12866650_PDFBOX3732-minimal-reader.pdf&quot; title=&quot;PDFBOX3732-minimal-reader.pdf attached to PDFBOX-3732&quot;&gt;PDFBOX3732-minimal-reader.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;For the file &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12860116/12860116_out.pdf&quot; title=&quot;out.pdf attached to PDFBOX-3732&quot;&gt;out.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; again &lt;tt&gt;/Helv&lt;/tt&gt; and &lt;tt&gt;/ZaDb&lt;/tt&gt; are added. In addition the &lt;tt&gt;/F1&lt;/tt&gt; entry from the appearance stream resources is taken and added to the AcroForm &lt;tt&gt;/DR&lt;/tt&gt; entry.&lt;/p&gt;

&lt;p&gt;So I suggest to not implement the patch as is but replicate Adobe Acrobats behavior.&lt;/p&gt;</comment>
                            <comment id="15998762" author="msahyoun" created="Fri, 5 May 2017 18:44:03 +0000"  >&lt;p&gt;In addition to above comment there is also a &lt;tt&gt;/DA&lt;/tt&gt; entry at the AcroForm level generated by Adobe Reader {{/Helv 0 Tf 0 g }}&lt;/p&gt;</comment>
                            <comment id="16000328" author="msahyoun" created="Mon, 8 May 2017 06:27:53 +0000"  >&lt;p&gt;I did some more investigation. Adobe Reader creates the default entries on the AcroForm level if there are none regardless of the &lt;tt&gt;/NeedAppearances&lt;/tt&gt; flag being set or only when there is a value being entered i.e. opening and saving such a form has the new entries. &lt;/p&gt;

&lt;p&gt;Shall we do the same or do that only when the &lt;tt&gt;AcroForm&lt;/tt&gt; is accessed which is more inline with how we currently handle such situations. I&apos;d go for the latter option. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ssteiner1&quot; class=&quot;user-hover&quot; rel=&quot;ssteiner1&quot;&gt;ssteiner1&lt;/a&gt; WDYT?&lt;/p&gt;</comment>
                            <comment id="16000416" author="tilman" created="Mon, 8 May 2017 08:16:39 +0000"  >&lt;p&gt;Yes&lt;/p&gt;</comment>
                            <comment id="16005921" author="jira-bot" created="Thu, 11 May 2017 05:45:42 +0000"  >&lt;p&gt;Commit 1794784 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1794784&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1794784&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3732&quot; title=&quot;IllegalArgumentException when refreshing an appearance and no font resources are defined&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3732&quot;&gt;&lt;del&gt;PDFBOX-3732&lt;/del&gt;&lt;/a&gt;: ensure default entries for /DA and /DR when accessing an AcroForm and the form doesn&apos;t contain these&lt;/p&gt;</comment>
                            <comment id="16005940" author="jira-bot" created="Thu, 11 May 2017 06:05:08 +0000"  >&lt;p&gt;Commit 1794785 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1794785&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1794785&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3732&quot; title=&quot;IllegalArgumentException when refreshing an appearance and no font resources are defined&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3732&quot;&gt;&lt;del&gt;PDFBOX-3732&lt;/del&gt;&lt;/a&gt;: ensure default entries for /DA and /DR when accessing an AcroForm and the form doesn&apos;t contain these&lt;/p&gt;</comment>
                            <comment id="16006244" author="jira-bot" created="Thu, 11 May 2017 11:08:12 +0000"  >&lt;p&gt;Commit 1794807 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1794807&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1794807&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3732&quot; title=&quot;IllegalArgumentException when refreshing an appearance and no font resources are defined&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3732&quot;&gt;&lt;del&gt;PDFBOX-3732&lt;/del&gt;&lt;/a&gt;: match Adobe Reader behaviour in copying field level resources to AcroForm level&lt;/p&gt;</comment>
                            <comment id="16006312" author="jira-bot" created="Thu, 11 May 2017 12:10:40 +0000"  >&lt;p&gt;Commit 1794813 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1794813&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1794813&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3732&quot; title=&quot;IllegalArgumentException when refreshing an appearance and no font resources are defined&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3732&quot;&gt;&lt;del&gt;PDFBOX-3732&lt;/del&gt;&lt;/a&gt;: match Adobe Reader behaviour in copying field level resources to AcroForm level&lt;/p&gt;</comment>
                            <comment id="16006318" author="msahyoun" created="Thu, 11 May 2017 12:13:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ssteiner1&quot; class=&quot;user-hover&quot; rel=&quot;ssteiner1&quot;&gt;ssteiner1&lt;/a&gt; could you verify if the changes fix your issue?&lt;/p&gt;

&lt;p&gt;I&apos;m not totally happy with the changes as we add workarounds which are specific to another application to our model. I consider moving that into another module for the 3.0 release if there is consensus to do so. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13202745">PDFBOX-4398</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12866650" name="PDFBOX3732-minimal-reader.pdf" size="5740" author="msahyoun" created="Fri, 5 May 2017 18:25:46 +0000"/>
                            <attachment id="12866651" name="PDFBOX3732-minimal.pdf" size="693" author="msahyoun" created="Fri, 5 May 2017 18:25:46 +0000"/>
                            <attachment id="12866652" name="out-reader.pdf" size="9681" author="msahyoun" created="Fri, 5 May 2017 18:28:04 +0000"/>
                            <attachment id="12860116" name="out.pdf" size="6160" author="ssteiner" created="Thu, 23 Mar 2017 11:28:37 +0000"/>
                            <attachment id="12860117" name="refreshAppearances.patch" size="1740" author="ssteiner" created="Thu, 23 Mar 2017 11:28:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 27 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3coy7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>