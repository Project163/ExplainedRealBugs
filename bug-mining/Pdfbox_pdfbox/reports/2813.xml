<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:13:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3712] PDFBox goes into an infinite loop with this PDF</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3712</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The PDF at &lt;a href=&quot;https://pdfs.semanticscholar.org/2095/e3df01fc32e0bff982a1e79600d5bcf10b81.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://pdfs.semanticscholar.org/2095/e3df01fc32e0bff982a1e79600d5bcf10b81.pdf&lt;/a&gt; puts PDFBox into an infinite loop.&lt;/p&gt;

&lt;p&gt;This is roughly my code:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;final PDDocument pdDoc = PDDocument.load(inputStream);&lt;br/&gt;
PDFTextStripper stripper = new PDFTextStripper();&lt;br/&gt;
stripper.getText(pdDoc);&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="13049422">PDFBOX-3712</key>
            <summary>PDFBox goes into an infinite loop with this PDF</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="dirkgr">Dirk Groeneveld</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Mar 2017 22:38:40 +0000</created>
                <updated>Wed, 27 Nov 2024 04:26:26 +0000</updated>
                            <resolved>Sat, 22 Jul 2023 13:37:01 +0000</resolved>
                                    <version>2.0.4</version>
                                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Parsing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15902143" author="tilman" created="Wed, 8 Mar 2017 23:06:21 +0000"  >&lt;p&gt;I get an OutOfMemory on page 6.&lt;/p&gt;</comment>
                            <comment id="15902158" author="dirkgr" created="Wed, 8 Mar 2017 23:21:53 +0000"  >&lt;p&gt;I give it -Xmx10G when I do this, but it never returns, and never throws an exception either. Thread.interrupt() interrupts the thread reliably at least.&lt;/p&gt;</comment>
                            <comment id="15902223" author="dirkgr" created="Thu, 9 Mar 2017 00:27:07 +0000"  >&lt;p&gt;I posted a minimal repro repo at &lt;a href=&quot;https://github.com/dirkgr/PDFBoxInfiniteLoopRepro&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dirkgr/PDFBoxInfiniteLoopRepro&lt;/a&gt;. Even without memory settings, and on a Mac, I get the infinite loop, not the OOM.&lt;/p&gt;</comment>
                            <comment id="15903436" author="tilman" created="Thu, 9 Mar 2017 17:25:13 +0000"  >&lt;p&gt;The file did render after I modified PDFDebugger to using &lt;tt&gt;PDDocument.load(file, password, MemoryUsageSetting.setupMixed(2000000));&lt;/tt&gt; and let it run... took quite a long time.&lt;/p&gt;

&lt;p&gt;I extracted the huge stream from page 6 and then uncompressed it. The result has a size of 3 189 455 757 Bytes.&lt;/p&gt;

&lt;p&gt;Update 21.5.2017:&lt;br/&gt;
I just ran it on a PC with a lot of memory... it took 889secs to render and used 8.8GB for it.&lt;/p&gt;</comment>
                            <comment id="15903693" author="dirkgr" created="Thu, 9 Mar 2017 19:27:58 +0000"  >&lt;p&gt;The file is a zip bomb?&lt;/p&gt;</comment>
                            <comment id="15903707" author="tilman" created="Thu, 9 Mar 2017 19:32:23 +0000"  >&lt;p&gt;Hard to tell... maybe it is just a very inefficient file. I looked only at the beginning of the stream, it has many inline images.&lt;/p&gt;</comment>
                            <comment id="17741401" author="lehmi" created="Sun, 9 Jul 2023 15:51:43 +0000"  >&lt;p&gt;The content stream (object 88 0) of page 6 has a huge length value : 45953744 and according to the exception the flate filter runs into an OOM when decoding the stream&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.RuntimeException: java.util.concurrent.ExecutionException: java.lang.OutOfMemoryError
    org.apache.pdfbox.debugger.pagepane.PagePane$RenderWorker.done(PagePane.java:569)
    sun.swing.AccumulativeRunnable.run(AccumulativeRunnable.java:112)
    java.security.AccessController.doPrivileged(Native Method)
    java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:74)
Caused by: java.util.concurrent.ExecutionException: java.lang.OutOfMemoryError
    org.apache.pdfbox.debugger.pagepane.PagePane$RenderWorker.done(PagePane.java:554)
    sun.swing.AccumulativeRunnable.run(AccumulativeRunnable.java:112)
    java.security.AccessController.doPrivileged(Native Method)
    java.security.ProtectionDomain$JavaSecurityAccessImpl.doIntersectionPrivilege(ProtectionDomain.java:74)
Caused by: java.lang.OutOfMemoryError: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
    java.io.ByteArrayOutputStream.hugeCapacity(ByteArrayOutputStream.java:123)
    java.io.ByteArrayOutputStream.grow(ByteArrayOutputStream.java:117)
    java.io.ByteArrayOutputStream.ensureCapacity(ByteArrayOutputStream.java:93)
    java.io.ByteArrayOutputStream.write(ByteArrayOutputStream.java:153)
    org.apache.pdfbox.filter.FlateFilter.decompress(FlateFilter.java:104)
    org.apache.pdfbox.filter.FlateFilter.decode(FlateFilter.java:50)
    org.apache.pdfbox.filter.Filter.decode(Filter.java:87)
    org.apache.pdfbox.cos.COSStream.createView(COSStream.java:222)
    org.apache.pdfbox.pdmodel.PDPage.getContentsForRandomAccess(PDPage.java:177)
    org.apache.pdfbox.pdfparser.PDFStreamParser.&amp;lt;init&amp;gt;(PDFStreamParser.java:59)
    org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:547)
    org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:528)
    org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:157)
    org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:282)
    org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:344)
    org.apache.pdfbox.debugger.pagepane.PagePane$RenderWorker.doInBackground(PagePane.java:531)
    org.apache.pdfbox.debugger.pagepane.PagePane$RenderWorker.doInBackground(PagePane.java:1)
    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:750)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17743497" author="tilman" created="Sun, 16 Jul 2023 07:23:03 +0000"  >&lt;p&gt;In the 2.* versions, I can render page 6 (of the original file, no longer at the linked URL) with -Xmx20g. With the trunk I can&apos;t, it goes OOM in FlateFilter.decompress() when the output stream is larger than 2GB. However it is also impossible to display the content stream with the 2.* versions.&lt;/p&gt;</comment>
                            <comment id="17743514" author="lehmi" created="Sun, 16 Jul 2023 10:59:54 +0000"  >&lt;p&gt;I had to dig a little bit but I&apos;ve found the reason fore the change of behaviour. The trunk uses a ByteArrayOutputStream/ByteArrayInputStream to decompress streams. Those are backed by a byte array and the maximum size is Integer.MAX_VALUE = 2^31-1 ~ 2GB. The stream in question as a size of 3.1GB so that there will be an overflow even if one provides enough memory using -Xmx&lt;/p&gt;

&lt;p&gt;The 2.* versions are using a ScrachFileBuffer which consists of more or less chunks which is limited only by the available amount of memory/disk space. Even a stream with 3.1GB isn&apos;t a problem at all, it take some time but in the end rendering works. I guess the the debugger uses another path to get the content of a stream and may fail because it doesn&apos;t use a SrcatchFileBuffer&lt;/p&gt;</comment>
                            <comment id="17745888" author="jira-bot" created="Sat, 22 Jul 2023 08:00:06 +0000"  >&lt;p&gt;Commit 1911192 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1911192&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1911192&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3712&quot; title=&quot;PDFBox goes into an infinite loop with this PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3712&quot;&gt;&lt;del&gt;PDFBOX-3712&lt;/del&gt;&lt;/a&gt;: add implementation for a memory backed RandomAccessReadWriteBuffer&lt;/p&gt;</comment>
                            <comment id="17745890" author="jira-bot" created="Sat, 22 Jul 2023 08:40:51 +0000"  >&lt;p&gt;Commit 1911194 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1911194&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1911194&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3712&quot; title=&quot;PDFBox goes into an infinite loop with this PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3712&quot;&gt;&lt;del&gt;PDFBOX-3712&lt;/del&gt;&lt;/a&gt;: use the new RandomAccessReadWriteBuffer when decoding streams to support streams bigger the 2GB and to reduce the memory foot print, DRY refactoring&lt;/p&gt;</comment>
                            <comment id="17745922" author="tilman" created="Sat, 22 Jul 2023 11:09:59 +0000"  >&lt;p&gt;Thanks, rendering works now. I realize that the stream display will never work because it uses a byte array, and these are 2G max by design (integer length).&lt;/p&gt;</comment>
                            <comment id="17745924" author="lehmi" created="Sat, 22 Jul 2023 11:13:30 +0000"  >&lt;p&gt;I&apos;ve replaced the usage of ByteArrayOutputStream/ByteArrayInputStream with the new RandomAccessReadWriteBuffer.&lt;/p&gt;

&lt;p&gt;PDFBox now supports decoded streams with more than 2GB as it uses chunks with a default size of 4kb. The rw-buffer is used as out- and input so that it is no longer necessary to copy the data to an intermediate byte array. In the end the memory foot print is reduced one more time. &lt;/p&gt;

&lt;p&gt;Additionally the chunksize is adjusted according to the estimated stream size so that we don&apos;t waste to much memory if a pdf contains lots of small streams such as the example from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5530&quot; title=&quot;Java heap space&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5530&quot;&gt;&lt;del&gt;PDFBOX-5530&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17745925" author="lehmi" created="Sat, 22 Jul 2023 11:14:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; we have to adjust the debugger as well. I&apos;m going to have a look&lt;/p&gt;

&lt;p&gt;UPDATE:&lt;br/&gt;
Looks like it won&apos;t be that easy to add support for streams bigger than 2GB to the debugger&lt;/p&gt;</comment>
                            <comment id="17745947" author="jira-bot" created="Sat, 22 Jul 2023 14:48:24 +0000"  >&lt;p&gt;Commit 1911202 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1911202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1911202&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3712&quot; title=&quot;PDFBox goes into an infinite loop with this PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3712&quot;&gt;&lt;del&gt;PDFBOX-3712&lt;/del&gt;&lt;/a&gt;: udon&apos;t close the rw-buffer when clearing it&lt;/p&gt;</comment>
                            <comment id="17746082" author="tilman" created="Sun, 23 Jul 2023 14:46:21 +0000"  >&lt;p&gt;I&apos;m now unable to complete my parallel rendering tests. They don&apos;t progress for a long time but CPU usage is there, so there isn&apos;t a deadlock.&lt;br/&gt;
I haven&apos;t found out much and I might be wrong. I&apos;m also getting OOM exceptions in files where I didn&apos;t get them before&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.OutOfMemoryError: Java heap space
	at java.util.Arrays.copyOf(Arrays.java:3181) ~[?:1.8.0_381]
	at java.util.ArrayList.grow(ArrayList.java:267) ~[?:1.8.0_381]
	at java.util.ArrayList.ensureExplicitCapacity(ArrayList.java:241) ~[?:1.8.0_381]
	at java.util.ArrayList.ensureCapacityInternal(ArrayList.java:233) ~[?:1.8.0_381]
	at java.util.ArrayList.add(ArrayList.java:464) ~[?:1.8.0_381]
	at org.apache.pdfbox.io.RandomAccessReadBuffer.expandBuffer(RandomAccessReadBuffer.java:309) ~[pdfbox-io-3.0.0-TILMAN.jar:3.0.0-TILMAN]
	at org.apache.pdfbox.io.RandomAccessReadWriteBuffer.write(RandomAccessReadWriteBuffer.java:99) ~[pdfbox-io-3.0.0-TILMAN.jar:3.0.0-TILMAN]
	at org.apache.pdfbox.io.RandomAccessOutputStream.write(RandomAccessOutputStream.java:46) ~[pdfbox-io-3.0.0-TILMAN.jar:3.0.0-TILMAN]
	at org.apache.pdfbox.filter.FlateFilter.decompress(FlateFilter.java:104) ~[classes/:?]
	at org.apache.pdfbox.filter.FlateFilter.decode(FlateFilter.java:50) ~[classes/:?]
	at org.apache.pdfbox.filter.Filter.decode(Filter.java:96) ~[classes/:?]
	at org.apache.pdfbox.filter.Filter.decode(Filter.java:236) ~[classes/:?]
	at org.apache.pdfbox.cos.COSStream.createView(COSStream.java:196) ~[classes/:?]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Yes I can reproduce it but you&apos;d need to have the 1000 files and their renderings.&lt;/p&gt;</comment>
                            <comment id="17746088" author="tilman" created="Sun, 23 Jul 2023 15:08:29 +0000"  >&lt;p&gt;Is this normal / expected that chunkSize is 0 and list size larger than 0 in expandBuffer() ?&lt;/p&gt;</comment>
                            <comment id="17746103" author="jira-bot" created="Sun, 23 Jul 2023 16:54:15 +0000"  >&lt;p&gt;Commit 1911216 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1911216&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1911216&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3712&quot; title=&quot;PDFBox goes into an infinite loop with this PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3712&quot;&gt;&lt;del&gt;PDFBOX-3712&lt;/del&gt;&lt;/a&gt;: avoid invalid values for the chunksize&lt;/p&gt;</comment>
                            <comment id="17746104" author="lehmi" created="Sun, 23 Jul 2023 16:56:06 +0000"  >&lt;p&gt;A chunksize of 0 doesn&apos;t make sense. I&apos;ve added a check in Filter.decode to avoid invalid values for the chunksize.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; Does this fix your issue?&lt;/p&gt;</comment>
                            <comment id="17746111" author="tilman" created="Sun, 23 Jul 2023 17:59:53 +0000"  >&lt;p&gt;Yes! Thank you!&lt;/p&gt;</comment>
                            <comment id="17746112" author="lehmi" created="Sun, 23 Jul 2023 18:02:09 +0000"  >&lt;p&gt;Puh, I&apos;m somewhat relieved, thanks for the hint about a possible reason for the issue and the prompt retest&lt;/p&gt;</comment>
                            <comment id="17749041" author="jira-bot" created="Mon, 31 Jul 2023 05:58:47 +0000"  >&lt;p&gt;Commit 1911364 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1911364&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1911364&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3712&quot; title=&quot;PDFBox goes into an infinite loop with this PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3712&quot;&gt;&lt;del&gt;PDFBOX-3712&lt;/del&gt;&lt;/a&gt;: sonar fix&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13600117">PDFBOX-5908</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12857052" name="PDFBOX-3712-page6-rendered.png" size="180165" author="tilman" created="Thu, 9 Mar 2017 17:25:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 14 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3b59z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>