<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:07:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4185] Fetching options for PDChoice causes ClassCastException </title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4185</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I am trying to fetch the options available for a PDChoice field in a form but get a ClassCastException from the PDFBox internals.&lt;/p&gt;

&lt;p&gt;The problematic PDF is an Inheritance Tax form from the UK&apos;s Revenue and Customs, specifically I am currently looking at IHT405:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/697346/IHT405_online.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://assets.publishing.service.gov.uk/government/uploads/system/uploads/attachment_data/file/697346/IHT405_online.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I use this code to iterate over the fields:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	PDDocument doc = PDDocument.load(resource.getFile());
	PDDocumentCatalog catalog = doc.getDocumentCatalog();
	PDAcroForm form = catalog.getAcroForm();
	&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (PDField field : form.getFields()) {
		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-quote&quot;&gt;&quot;Ch&quot;&lt;/span&gt;.equals(field.getFieldType())) {
			PDChoice choice = (PDChoice) field;
			&lt;span class=&quot;code-comment&quot;&gt;// All these variants fail with a ClassCastException:
&lt;/span&gt;			choice.getOptions();
			choice.getOptionsDisplayValues();
			choice.getOptionsExportValues(); &lt;span class=&quot;code-comment&quot;&gt;// internally just delegates to getOptions()
&lt;/span&gt;		}
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is a stacktrace for e.g. the getOptionsExportValues() call:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;	java.lang.ClassCastException: org.apache.pdfbox.cos.COSArray cannot be cast to org.apache.pdfbox.cos.COSString
		at org.apache.pdfbox.pdmodel.common.COSArrayList.convertCOSStringCOSArrayToList(COSArrayList.java:367)
		at org.apache.pdfbox.pdmodel.interactive.form.FieldUtils.getPairableItems(FieldUtils.java:182)
		at org.apache.pdfbox.pdmodel.interactive.form.PDChoice.getOptions(PDChoice.java:91)
		at org.apache.pdfbox.pdmodel.interactive.form.PDChoice.getOptionsExportValues(PDChoice.java:210)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The problem is that the expected &quot;stringArray&quot; also contains COSArrays with value and label for the options:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;	COSArray{[COSString{ }, COSArray{[COSString{Mr}, COSString{MR}]}, COSArray{[COSString{Mrs}, COSString{MRS}]}, COSArray{[COSString{Miss}, COSString{MISS}]}, COSArray{[COSString{Ms}, COSString{MS}]}]}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This does not seem to be expected in FieldUtils.getPairableItems, which introspects only the first item of the array and thus treats the array as an array of strings.&lt;/p&gt;

&lt;p&gt;I found the bug with PDFBox 2.0.4 and upgraded to 2.0.9 which didn&apos;t help.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13150768">PDFBOX-4185</key>
            <summary>Fetching options for PDChoice causes ClassCastException </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="msahyoun">Maruan Sahyoun</assignee>
                                    <reporter username="msahyoun">Maruan Sahyoun</reporter>
                        <labels>
                    </labels>
                <created>Sat, 7 Apr 2018 13:23:32 +0000</created>
                <updated>Thu, 21 Jun 2018 20:27:51 +0000</updated>
                            <resolved>Sat, 14 Apr 2018 15:31:40 +0000</resolved>
                                    <version>2.0.4</version>
                    <version>2.0.9</version>
                    <version>3.0.0 PDFBox</version>
                                    <fixVersion>2.0.10</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>AcroForm</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16429408" author="jira-bot" created="Sat, 7 Apr 2018 15:17:32 +0000"  >&lt;p&gt;Commit 1828595 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1828595&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1828595&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4185&quot; title=&quot;Fetching options for PDChoice causes ClassCastException &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4185&quot;&gt;&lt;del&gt;PDFBOX-4185&lt;/del&gt;&lt;/a&gt;: support COSString, COSArray mixed options entries&lt;/p&gt;</comment>
                            <comment id="16429410" author="jira-bot" created="Sat, 7 Apr 2018 15:17:58 +0000"  >&lt;p&gt;Commit 1828596 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1828596&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1828596&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4185&quot; title=&quot;Fetching options for PDChoice causes ClassCastException &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4185&quot;&gt;&lt;del&gt;PDFBOX-4185&lt;/del&gt;&lt;/a&gt;: support COSString, COSArray mixed options entries&lt;/p&gt;</comment>
                            <comment id="16429413" author="msahyoun" created="Sat, 7 Apr 2018 15:21:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matthias.gall&quot; class=&quot;user-hover&quot; rel=&quot;matthias.gall&quot;&gt;matthias.gall&lt;/a&gt; please try with a snapshot which will be available later today or build from source and let me know if it works for you.&lt;/p&gt;</comment>
                            <comment id="16438351" author="matthias.gall" created="Sat, 14 Apr 2018 14:06:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt;&#160;works with&#160;2.0.10-SNAPSHOT, thanks!&lt;/p&gt;</comment>
                            <comment id="16438388" author="msahyoun" created="Sat, 14 Apr 2018 15:31:40 +0000"  >&lt;p&gt;resolved. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=matthias.gall&quot; class=&quot;user-hover&quot; rel=&quot;matthias.gall&quot;&gt;matthias.gall&lt;/a&gt; for the report and your tests.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3s9kv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>