<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:59:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2685] COS &apos;primitive&apos; types are mutable</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2685</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;From &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=torakiki&quot; class=&quot;user-hover&quot; rel=&quot;torakiki&quot;&gt;torakiki&lt;/a&gt;:&lt;br/&gt;
They are cached and they are mutable so this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        COSInteger cosint = COSInteger.get(10);
        cosint.setValue(50);
        &lt;span class=&quot;code-comment&quot;&gt;//lets move to a totally unrelated part of my software
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(COSInteger.get(10));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;prints COSInteger(50) so basically I ask for a 10 and get a 50, isn&apos;t it weird (and error prone)? ... or the way around, I call cosint.setValue(50) at some point in the software and that makes it a 50 everywhere I used COSInteger.get(10).&lt;/p&gt;

&lt;p&gt;That&apos;s of course also true for the other mutable attributes setDirect and setNeedToBeUpdate.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12775128">PDFBOX-2685</key>
            <summary>COS &apos;primitive&apos; types are mutable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="msahyoun">Maruan Sahyoun</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                    </labels>
                <created>Sat, 14 Feb 2015 11:53:49 +0000</created>
                <updated>Fri, 18 Aug 2023 05:46:17 +0000</updated>
                            <resolved>Fri, 30 Oct 2020 08:25:02 +0000</resolved>
                                    <version>1.8.8</version>
                    <version>1.8.9</version>
                    <version>2.0.0</version>
                                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14321574" author="lehmi" created="Sat, 14 Feb 2015 17:27:47 +0000"  >&lt;p&gt;As direct and indirect integer values are needed e.g. as length values COSInteger must not be mutable. IMHO, we have to remove the whole caching.&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="14321716" author="tilman" created="Sat, 14 Feb 2015 21:32:27 +0000"  >&lt;p&gt;I don&apos;t have a better idea than that.&lt;/p&gt;</comment>
                            <comment id="14321905" author="msahyoun" created="Sun, 15 Feb 2015 10:11:20 +0000"  >&lt;p&gt;IMHO there are two issues. Immutability of COSInteger and caching. &lt;br/&gt;
Regarding immutability other COS &apos;primitive&apos; types are also affected. &lt;/p&gt;

&lt;p&gt;Regarding caching from the numbers around the potential benefits wouldn&apos;t it be better to keep the caching and look at resolving the issues arising from that? &lt;/p&gt;</comment>
                            <comment id="14322045" author="msahyoun" created="Sun, 15 Feb 2015 16:21:47 +0000"  >&lt;p&gt;Looking at setDirect this only seems to be needed to set some COSBase objects to be direct objects for streams and dictionaries. Now if we do know that for specific streams and dictionaries that entry has to be direct why don&apos;t we add it there and leave it out of the primitive types. In addition in COSWriter there is already code to ensure that for Xref streams the length is direct. So the flag is redundant. &lt;/p&gt;

&lt;p&gt;A quick scan through the sources for setNeedToBeUpdate indicates the same that it&apos;s only there for dictionaries.&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="14322083" author="lehmi" created="Sun, 15 Feb 2015 17:21:06 +0000"  >&lt;p&gt;Let&apos;s start with the NeedToBeUpdate flag. It seems easier to refactor that one&lt;/p&gt;</comment>
                            <comment id="14322109" author="jira-bot" created="Sun, 15 Feb 2015 17:51:20 +0000"  >&lt;p&gt;Commit 1659956 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1659956&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1659956&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2685&quot; title=&quot;COS &amp;#39;primitive&amp;#39; types are mutable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2685&quot;&gt;&lt;del&gt;PDFBOX-2685&lt;/del&gt;&lt;/a&gt; remove setValue() as COS primitives shall be immutable&lt;/p&gt;</comment>
                            <comment id="14322175" author="jira-bot" created="Sun, 15 Feb 2015 20:24:15 +0000"  >&lt;p&gt;Commit 1659989 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1659989&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1659989&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;PDFBX-2576, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2685&quot; title=&quot;COS &amp;#39;primitive&amp;#39; types are mutable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2685&quot;&gt;&lt;del&gt;PDFBOX-2685&lt;/del&gt;&lt;/a&gt; avoid Checkstyle warnings&lt;/p&gt;</comment>
                            <comment id="14322200" author="jira-bot" created="Sun, 15 Feb 2015 21:27:51 +0000"  >&lt;p&gt;Commit 1659998 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1659998&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1659998&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2685&quot; title=&quot;COS &amp;#39;primitive&amp;#39; types are mutable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2685&quot;&gt;&lt;del&gt;PDFBOX-2685&lt;/del&gt;&lt;/a&gt; move setNeedToBeUpdate to COSDictionary&lt;/p&gt;</comment>
                            <comment id="14322203" author="msahyoun" created="Sun, 15 Feb 2015 21:39:20 +0000"  >&lt;p&gt;moved setNeedToBeUpdate to COSDictionary. Before doing the changes for setDirect I&apos;d propose to wait a day or two to see if that is causing regressions?&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="14323290" author="msahyoun" created="Mon, 16 Feb 2015 21:02:42 +0000"  >&lt;p&gt;OK - I looked at removing setDirect but it much more has the potential to cause regressions. In addition there are some assumptions in the current code about which objects have to be direct and which are not that IMHO are not inline with the spec.&lt;/p&gt;

&lt;p&gt;So the current codes treats or marks objects as direct which are not required to be so (such as length for a cross reference stream) where others are not explicitly marked.&lt;/p&gt;

&lt;p&gt;I&apos;m a little uncertain about doing that in the 2.0 timeframe. OTOH the changes required would be API breaking and the current code of being able to potentially set everything to direct/indirect is not very useful. &lt;/p&gt;

&lt;p&gt;There are only a small number of items which have to be direct as there are some which shall be indirect. We would be better off to handle that specifically. Unfortunately e.g. COSWriter has not been built that way. &lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="14323783" author="lehmi" created="Tue, 17 Feb 2015 07:38:07 +0000"  >&lt;blockquote&gt;&lt;p&gt; I looked at removing setDirect but it much more has the potential to cause regressions. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;IMHO we are still at a point where such changes are allowed inlcuding possible regressions. I have such changes (COSStream) on my list too.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There are only a small number of items which have to be direct as there are some which shall be indirect. We would be better off to handle that specifically. Unfortunately e.g. COSWriter has not been built that way. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The current implementation of the COSWriter is a more generic one and I&apos;m not sure if it would be a good idea to change that. Whatever we are going to do it would require a lot of changes and I&apos;m not sure if that fits into our timeframe.&lt;/p&gt;

&lt;p&gt;With the current changes we are not on the save side but we are already saver. As lons as we limit the caching to values from -100 to 256 it&apos;s most unlikely that a cached COSInteger is used twice, once as direct and once as indirect value. Saying that, IMHO we should postpone the root issue to a later version.&lt;/p&gt;
</comment>
                            <comment id="14323786" author="msahyoun" created="Tue, 17 Feb 2015 07:48:49 +0000"  >&lt;p&gt;So let&apos;s leave it at the current stage and postpone the issue to 2.1. The only drawback with that is - as we will very likely remove setDirect() from COSBase - this will break the API. As I think that this is only used internally anyway it wouldn&apos;t affect the user but API breaking changes would normally require a major release.&lt;/p&gt;

&lt;p&gt;From a COSWriter perspective - yes it&apos;s very generic which is good but in that case part of the issue. There are only a small number of structures in PDF which do require that an object has to be direct or indirect e.g. the cross reference stream dictionary has some.&lt;/p&gt;

&lt;p&gt;What we could do is add some JavaDoc to the methods stating that these are &apos;internal use&apos; only due to be removed without further notice and deprecate the methods so people will get them flagged in their IDE (if they care to check &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;).&lt;/p&gt;</comment>
                            <comment id="14325757" author="msahyoun" created="Wed, 18 Feb 2015 11:38:59 +0000"  >&lt;p&gt;I&apos;ll leave it at the current stage and marked it as Critical. We should have a discussion after 2.0 is out as how to approach that. There are two options as far as I can tell&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;keep COSWriter generic and mark the COSObjects from the PDModel - then we need to remove caching&lt;/li&gt;
	&lt;li&gt;have some knowledge about what needs to be written and it&apos;s rule at COSWriter level or similar - then we can keep the caching&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;We need to take a closer look at which objects shall be direct/indirect according to the spec as from a first glance there might be some which we mark incorrectly - that needs to be done on the PD level. Users using the COS model directly are required to have a good knowledge of the PDF spec and need to set direct/indirect accordingly.&lt;/p&gt;

&lt;p&gt;Although I like the benefits of caching currently I tend towards removing it for the benefit of having a simple COS model.&lt;/p&gt;

&lt;p&gt;If we want to make the decision now we can move the issue back to 2.0.0.&lt;/p&gt;
</comment>
                            <comment id="14341553" author="lehmi" created="Sat, 28 Feb 2015 14:32:37 +0000"  >&lt;p&gt;As already suspected on users@pdfbox &lt;a href=&quot;https://svn.apache.org/r1659998&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;r1659998&lt;/a&gt; introduced the regression with the signing. I&apos;ll have a look&lt;/p&gt;</comment>
                            <comment id="14341600" author="jira-bot" created="Sat, 28 Feb 2015 15:55:05 +0000"  >&lt;p&gt;Commit 1662951 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1662951&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1662951&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2685&quot; title=&quot;COS &amp;#39;primitive&amp;#39; types are mutable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2685&quot;&gt;&lt;del&gt;PDFBOX-2685&lt;/del&gt;&lt;/a&gt;: introduced new interface COSUpdateInfo as COSObject need to have the same functionality the COSDictionary&lt;/p&gt;</comment>
                            <comment id="14341603" author="lehmi" created="Sat, 28 Feb 2015 15:58:02 +0000"  >&lt;p&gt;It looks like COSObject needs the isNeedToBeUpdate-feature as well. I&apos;ve extracted both methods to a new interface. COSObject and COSDictionary are implementing that interface and now everything works as expected.&lt;/p&gt;</comment>
                            <comment id="15247361" author="abyss" created="Tue, 19 Apr 2016 08:14:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3321&quot; title=&quot;ASCII stream data size is increased when written&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3321&quot;&gt;&lt;del&gt;PDFBOX-3321&lt;/del&gt;&lt;/a&gt; is also affected by mutability of cached &lt;em&gt;COSNumber&lt;/em&gt;, when ASCII streams with the length &amp;lt;=256 are written.&lt;/p&gt;</comment>
                            <comment id="17222362" author="msahyoun" created="Wed, 28 Oct 2020 19:07:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; is that still an issue? Think the changes done resolved it and the other discussion we had at that time would be a larger change which I don&apos;t see us doing shortly&lt;/p&gt;</comment>
                            <comment id="17223459" author="lehmi" created="Fri, 30 Oct 2020 06:59:23 +0000"  >&lt;p&gt;As far as I remember the issue is solved&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12959711">PDFBOX-3320</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12456903">PDFBOX-626</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25n0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>