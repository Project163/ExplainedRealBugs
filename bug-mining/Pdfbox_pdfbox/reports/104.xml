<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:52:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-920] PDFStreamEngine.processEncodedText fails on UTF-16 text</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-920</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I have a PDF document which yields gibberish text. When I debug it, I get to the PDFStreamEngine.processEncodedText. The method gets a following byte array:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0, 47, 0, 82, 0, 82, 0, 78, 0, 3, 0, 68, 0, 87, 0, 3, 0, 87, 0, 75, 0, 72, 0, 3, 0, -64, 0, 85, 0, 86, 0, 87, 0, 3, 0, 83, 0, 76, 0, 70, 0, 87, 0, 88, 0, 85, 0, 72, 0, 3, 0, 68, 0, 69, 0, 82, 0, 89, 0, 72, 0, 17, 0, 3&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;This looks to me like some UTF16 text, but the codes seem different than what you&apos;d normally expect. I don&apos;t understand the encoding. In 1.2.1 this yielded the correct output though (&quot;Look at the picture above&quot;). In the 1.3.1 and the current trunk this is converted to garbage. The culprit is here:&lt;/p&gt;

&lt;p&gt;codeLength = 1;&lt;br/&gt;
String c = font.encode( string, i, codeLength );&lt;br/&gt;
if( c == null &amp;amp;&amp;amp; i+1&amp;lt;string.length)&lt;br/&gt;
{&lt;br/&gt;
	//maybe a multibyte encoding&lt;br/&gt;
	codeLength++;&lt;br/&gt;
	c = font.encode( string, i, codeLength );&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;So the code first tries to &apos;encode&apos; a single byte as a character, and then tries two bytes, three bytes etc. First it starts with a 00 byte. In 1.2.1 the PDFont.encode would return null. The program would then try with two bytes getting a correct character on the second attempt.&lt;/p&gt;

&lt;p&gt;In the current trunk the font.encode method returns a space &quot; &quot; when 00 is passed. This is clearly wrong, because afterwards the entire string is parsed incorrectly. I tried to debug further and it seems to me that the problem is in the Encoding class, in the getName method. It looks like this:&lt;/p&gt;

&lt;p&gt;public String getName( int code ) throws IOException&lt;br/&gt;
{&lt;br/&gt;
	String name = codeToName.get( code );&lt;br/&gt;
	if( name == null )&lt;/p&gt;
	{
		//lets be forgiving for now
		name = &quot;space&quot;;
	}
&lt;p&gt;	return name;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;The crucial bit is the &quot;let&apos;s be forgiving for now&quot;. If a code is unknown in the encoding, a space is returned. In my case this completely breaks the parsing of a file. &lt;/p&gt;

&lt;p&gt;What was the rationale behind this behavior? Removing it fixed my problem and didn&apos;t break anything. All unit tests of pdfbox pass. The regression tests of my applications (based on the pdf extraction code from the Aperture Framework) also pass. The &quot;forgiving&quot; part has been added in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-626&quot; title=&quot;Reduce the memory impact of the COS object model&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-626&quot;&gt;&lt;del&gt;PDFBOX-626&lt;/del&gt;&lt;/a&gt;, but the issue description doesn&apos;t name any reasons for that. If the &quot;forgiveness&quot; is there for a good reason, I&apos;d be grateful for advice how to deal with the problem. Otherwise please remove it.&lt;/p&gt;

&lt;p&gt;Unfortunately I can&apos;t share the problem file.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12493103">PDFBOX-920</key>
            <summary>PDFStreamEngine.processEncodedText fails on UTF-16 text</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="antoni.mylka">Antoni Mylka</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Dec 2010 18:47:43 +0000</created>
                <updated>Fri, 4 Mar 2011 10:29:19 +0000</updated>
                            <resolved>Sat, 8 Jan 2011 16:15:57 +0000</resolved>
                                    <version>1.3.1</version>
                                    <fixVersion>1.5.0</fixVersion>
                                    <component>Text extraction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12970952" author="antoni.mylka" created="Mon, 13 Dec 2010 18:48:07 +0000"  >&lt;p&gt;A patch which fixes the problem for me.&lt;/p&gt;</comment>
                            <comment id="12970953" author="antoni.mylka" created="Mon, 13 Dec 2010 18:50:28 +0000"  >&lt;p&gt;This is a text extraction issue. Added an appropriate &quot;component&quot; marking.&lt;/p&gt;</comment>
                            <comment id="12979145" author="lehmi" created="Sat, 8 Jan 2011 16:15:57 +0000"  >&lt;p&gt;I agree with Antoni. I applied the patch as proposed with revision 1056730.&lt;/p&gt;

&lt;p&gt;Thanks for the contribution!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12466160" name="nullcharactername.patch" size="967" author="antoni.mylka" created="Mon, 13 Dec 2010 18:48:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163573</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zl9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>205748</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>