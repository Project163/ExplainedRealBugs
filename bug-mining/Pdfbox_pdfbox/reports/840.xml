<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:58:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2469] javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2469</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gagravarr&quot; class=&quot;user-hover&quot; rel=&quot;gagravarr&quot;&gt;gagravarr&lt;/a&gt; noticed that one of our old test files fails a Tika test now with PDFBox 1.8.7 and Java 1.6.&lt;/p&gt;

&lt;p&gt;I just tested the pure PDFBox app built with PDFBox 1.8.8-SNAPSHOT, and I&apos;m getting the same exception with Java 1.6 and Java 1.7.&lt;/p&gt;

&lt;p&gt;Stacktrace: &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ExtractText failed with the following exception:
java.io.IOException: javax.crypto.BadPaddingException: Given final block not properly padded
        at javax.crypto.CipherInputStream.getMoreData(CipherInputStream.java:118)
        at javax.crypto.CipherInputStream.read(CipherInputStream.java:236)
        at javax.crypto.CipherInputStream.read(CipherInputStream.java:212)
        at org.apache.pdfbox.pdmodel.encryption.SecurityHandler.encryptData(SecurityHandler.java:316)
        at org.apache.pdfbox.pdmodel.encryption.SecurityHandler.decryptStream(SecurityHandler.java:421)
        at org.apache.pdfbox.pdmodel.encryption.SecurityHandler.decrypt(SecurityHandler.java:390)
        at org.apache.pdfbox.pdmodel.encryption.SecurityHandler.decryptObject(SecurityHandler.java:365)
        at org.apache.pdfbox.pdmodel.encryption.SecurityHandler.proceedDecryption(SecurityHandler.java:196)
        at org.apache.pdfbox.pdmodel.encryption.StandardSecurityHandler.decryptDocument(StandardSecurityHandler.java:158)
        at org.apache.pdfbox.pdmodel.PDDocument.openProtection(PDDocument.java:1598)
        at org.apache.pdfbox.ExtractText.startExtraction(ExtractText.java:216)
        at org.apache.pdfbox.ExtractText.main(ExtractText.java:85)
        at org.apache.pdfbox.PDFBox.main(PDFBox.java:58)
Caused by: javax.crypto.BadPaddingException: Given final block not properly padded
        at com.sun.crypto.provider.CipherCore.doFinal(CipherCore.java:811)
        at com.sun.crypto.provider.CipherCore.doFinal(CipherCore.java:676)
        at com.sun.crypto.provider.AESCipher.engineDoFinal(AESCipher.java:423)
        at javax.crypto.Cipher.doFinal(Cipher.java:1708)
        at javax.crypto.CipherInputStream.getMoreData(CipherInputStream.java:112)
        ... 12 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;java version &quot;1.7.0_71&quot;&lt;br/&gt;
OpenJDK Runtime Environment (rhel-2.5.3.1.el6-x86_64 u71-b14)&lt;br/&gt;
OpenJDK 64-Bit Server VM (build 24.65-b04, mixed mode)&lt;/p&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;p&gt;java version &quot;1.6.0_33&quot;&lt;br/&gt;
OpenJDK Runtime Environment (IcedTea6 1.13.5) (rhel-1.13.5.0.el6_6-x86_64)&lt;br/&gt;
OpenJDK 64-Bit Server VM (build 23.25-b01, mixed mode)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12751946">PDFBOX-2469</key>
            <summary>javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="tallison">Tim Allison</reporter>
                        <labels>
                            <label>AES128</label>
                    </labels>
                <created>Fri, 31 Oct 2014 11:34:13 +0000</created>
                <updated>Sat, 13 Dec 2014 14:15:02 +0000</updated>
                            <resolved>Tue, 18 Nov 2014 10:12:39 +0000</resolved>
                                    <version>1.8.7</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.8.8</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="14191722" author="tallison@mitre.org" created="Fri, 31 Oct 2014 11:44:03 +0000"  >&lt;p&gt;I&apos;m actually now getting the same exception back through pdfbox app 1.6. PDFBox used to be able to handle this file...  Must be a change in java updates?&lt;/p&gt;

&lt;p&gt;With:&lt;br/&gt;
java version &quot;1.7.0_40&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.7.0_40-b43)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 24.0-b56, mixed mode)&lt;/p&gt;

&lt;p&gt;The exception is this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;WARNING: PDF file &apos;testPDF_acroForm.pdf&apos; does not allow extracting content.
ExtractText failed with the following exception:
java.io.IOException: You do not have permission to extract text
        at org.apache.pdfbox.ExtractText.startExtraction(ExtractText.java:223)
        at org.apache.pdfbox.ExtractText.main(ExtractText.java:85)
        at org.apache.pdfbox.PDFBox.main(PDFBox.java:58)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14192308" author="tilman" created="Fri, 31 Oct 2014 19:32:59 +0000"  >&lt;p&gt;We&apos;re having the same problem with 256bit encryption in two other issues, just as we started to create tests for encryption &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14198728" author="tilman" created="Wed, 5 Nov 2014 17:46:31 +0000"  >&lt;p&gt;Some observations:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the decrypt that fails is obj 661, which is just after the %%EOF&lt;/li&gt;
	&lt;li&gt;it is /Metadata&lt;/li&gt;
	&lt;li&gt;the stream length is 4336&lt;/li&gt;
	&lt;li&gt;regardless of the buffer size, decrypt always fails after having read 4304 bytes&lt;/li&gt;
	&lt;li&gt;when using a big buffer, blocks are being read, the first has size 496, then 512, then a block of 224 bytes&lt;/li&gt;
	&lt;li&gt;saving the decrypted stuff does not show anything meaningful, despite that the stream is not compressed.&lt;/li&gt;
	&lt;li&gt;there is metadata in obj 61. That one is readable.&lt;/li&gt;
	&lt;li&gt;other objects with exception: 1036 (Xref), 995 (Sig), 998 (Xref), 972 (&quot;/AuthEvent/DocOpen/CFM/AESV2&quot;)&lt;br/&gt;
  &quot;Though this be madness, yet there is method in it&quot; - are we possibly decrypting stuff that shouldn&apos;t be decrypted, or that must be decrypted with another method / password, or that should be ignored?&lt;/li&gt;
	&lt;li&gt;when running with a JRE 1.6.0_45 I get identical content for object 661 than with JRE7 with swallowing the exception.&lt;/li&gt;
	&lt;li&gt;when swallowing the exception, I am able to get the meta data doc.getDocumentCatalog().getMetadata().createInputStream(), i.e. that object 661 isn&apos;t used for that.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14198749" author="jira-bot" created="Wed, 5 Nov 2014 18:03:31 +0000"  >&lt;p&gt;Commit 1636929 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1636929&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1636929&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: the signature dictionary must not be decrypted&lt;/p&gt;</comment>
                            <comment id="14198773" author="jira-bot" created="Wed, 5 Nov 2014 18:19:26 +0000"  >&lt;p&gt;Commit 1636933 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/branches/1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1636933&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1636933&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: the signature dictionary must not be decrypted&lt;/p&gt;</comment>
                            <comment id="14198782" author="lehmi" created="Wed, 5 Nov 2014 18:25:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; Thanks for your input.&lt;/p&gt;

&lt;p&gt;It was quite easy to fix. As already someone mentioned in the code, we simply have to skip the signature dictionary when decrypting the pdf. &lt;br/&gt;
But there is something wrong. In 1.8.8 I get an exception when extracting the text because of a missing permission to do so. The trunk extracts the text without any problem. It looks as if something went wrong when processing the access permissions&lt;/p&gt;</comment>
                            <comment id="14198804" author="lehmi" created="Wed, 5 Nov 2014 18:33:44 +0000"  >&lt;p&gt;Looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2460&quot; title=&quot;fix TestPublicKeyEncryption.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2460&quot;&gt;&lt;del&gt;PDFBOX-2460&lt;/del&gt;&lt;/a&gt; introduced a regression with the acess permissions&lt;/p&gt;</comment>
                            <comment id="14198828" author="lehmi" created="Wed, 5 Nov 2014 18:42:10 +0000"  >&lt;p&gt;My patch works for the non sequential parser only&lt;/p&gt;</comment>
                            <comment id="14198861" author="tilman" created="Wed, 5 Nov 2014 18:57:11 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2460&quot; title=&quot;fix TestPublicKeyEncryption.java&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2460&quot;&gt;&lt;del&gt;PDFBOX-2460&lt;/del&gt;&lt;/a&gt; introduced a regression with the acess permissions&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I made a change there with the permissions, but in the trunk only.&lt;/p&gt;</comment>
                            <comment id="14198874" author="lehmi" created="Wed, 5 Nov 2014 19:04:27 +0000"  >&lt;p&gt;The regression is in the trunk. The 1.8 branch works fine, both the old and the non-sequential parser deny to extract the text bacause of the missing permission to do so.&lt;/p&gt;

&lt;p&gt;Trunk-only:&lt;br/&gt;
Using the old parser the access permission is set in PDDocument#openProtection. The non-sequential parser decrypts the pdf on the fly and doesn&apos;t pass the access permission to the PDDocument instance.&lt;/p&gt;</comment>
                            <comment id="14198882" author="tilman" created="Wed, 5 Nov 2014 19:12:16 +0000"  >&lt;p&gt;Technically this isn&apos;t a regression, rather my change went too short. I have overseen that the nonSequential parser doesn&apos;t use openProtection().&lt;/p&gt;

&lt;p&gt;Do you already have a solution or should I work on one? The change I made introduced accessPermission at the PDDocument level.&lt;/p&gt;</comment>
                            <comment id="14198918" author="lehmi" created="Wed, 5 Nov 2014 19:27:17 +0000"  >&lt;p&gt;I guess I&apos;ve already a solution ....&lt;/p&gt;</comment>
                            <comment id="14198927" author="jira-bot" created="Wed, 5 Nov 2014 19:32:31 +0000"  >&lt;p&gt;Commit 1636944 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1636944&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1636944&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: pass access permissions from the non sequential parser to PDDocument&lt;/p&gt;</comment>
                            <comment id="14198930" author="lehmi" created="Wed, 5 Nov 2014 19:35:34 +0000"  >&lt;p&gt;The access permission issue is solved. I guess there is only one issue left, a BadPaddingException when using the old parser.&lt;/p&gt;</comment>
                            <comment id="14199332" author="tilman" created="Wed, 5 Nov 2014 23:18:57 +0000"  >&lt;p&gt;I tried testing the symmetric test with the nonSeq parser and there&apos;s an NPE here:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!dict.getCOSName(COSName.TYPE).equals(COSName.SIG))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When fixing that NPE locally by changing that line&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;COSName dictType = dict.getCOSName(COSName.TYPE);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dictType == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || !dictType.equals(COSName.SIG))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I still get trouble which I haven&apos;t fully understood yet. Either my fix is wrong, or there&apos;s another problem. &lt;/p&gt;</comment>
                            <comment id="14199921" author="tilman" created="Thu, 6 Nov 2014 07:04:08 +0000"  >&lt;p&gt;I have opened the new issue &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2484&quot; title=&quot;Cannot decrypt AES256 encrypted files with nonSeq parser&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2484&quot;&gt;&lt;del&gt;PDFBOX-2484&lt;/del&gt;&lt;/a&gt; on that one, as it involves AES256 only.&lt;/p&gt;</comment>
                            <comment id="14200087" author="lehmi" created="Thu, 6 Nov 2014 11:22:29 +0000"  >&lt;p&gt;I&apos;ll have look when I&apos;m back home. I assume that the detection for those dictionaries which must not be decrypted isn&apos;t complete/doesn&apos;t work well&lt;/p&gt;</comment>
                            <comment id="14200986" author="jira-bot" created="Thu, 6 Nov 2014 21:42:49 +0000"  >&lt;p&gt;Commit 1637229 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/branches/1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1637229&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1637229&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: avoid NPE as proposed by Tilman Hausherr&lt;/p&gt;</comment>
                            <comment id="14200987" author="jira-bot" created="Thu, 6 Nov 2014 21:43:03 +0000"  >&lt;p&gt;Commit 1637230 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1637230&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1637230&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: avoid NPE as proposed by Tilman Hausherr&lt;/p&gt;</comment>
                            <comment id="14200991" author="lehmi" created="Thu, 6 Nov 2014 21:44:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; I&apos;ve added your NPE check. Thanks for the pointer&lt;/p&gt;</comment>
                            <comment id="14200998" author="jira-bot" created="Thu, 6 Nov 2014 21:48:47 +0000"  >&lt;p&gt;Commit 1637232 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1637232&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1637232&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: simplify NPE check&lt;/p&gt;</comment>
                            <comment id="14200999" author="jira-bot" created="Thu, 6 Nov 2014 21:48:54 +0000"  >&lt;p&gt;Commit 1637233 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/branches/1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1637233&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1637233&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: simplify NPE check&lt;/p&gt;</comment>
                            <comment id="14214138" author="thunderforge" created="Mon, 17 Nov 2014 00:09:59 +0000"  >&lt;p&gt;I ran into this bug with some production code, but strangely it occurs on Windows, but not OS X (using either Apple Java 6 or OpenJDK Java 7). Not sure if that helps any in figuring out how to solve the problem, but that&apos;s my observation.&lt;/p&gt;</comment>
                            <comment id="14214397" author="lehmi" created="Mon, 17 Nov 2014 07:59:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Thunderforge&quot; class=&quot;user-hover&quot; rel=&quot;Thunderforge&quot;&gt;Thunderforge&lt;/a&gt; It seems to be related to the jdk version but not the used OS&lt;/p&gt;</comment>
                            <comment id="14214468" author="jira-bot" created="Mon, 17 Nov 2014 09:54:18 +0000"  >&lt;p&gt;Commit 1640127 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1640127&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1640127&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: avoid BadPaddingException by not using a CipherInputStream&lt;/p&gt;</comment>
                            <comment id="14214488" author="jira-bot" created="Mon, 17 Nov 2014 10:20:15 +0000"  >&lt;p&gt;Commit 1640131 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/branches/1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1640131&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1640131&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: avoid BadPaddingException by not using a CipherInputStream&lt;/p&gt;</comment>
                            <comment id="14214493" author="lehmi" created="Mon, 17 Nov 2014 10:23:40 +0000"  >&lt;p&gt;I read a lot about the BadPaddingException and learned the the usage of the CipherInputStream should be avoided. I&apos;ve replaced at least one piece of code to avoid the particular stream and now the BadPaddingException is gone. There is still one part left which doesn&apos;t seem to be critical but maybe it&apos;s a good idea to change that part as well&lt;/p&gt;</comment>
                            <comment id="14214497" author="jira-bot" created="Mon, 17 Nov 2014 10:33:02 +0000"  >&lt;p&gt;Commit 1640137 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/branches/1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1640137&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1640137&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: improved decryption handling, fixed checkstyle issues&lt;/p&gt;</comment>
                            <comment id="14214499" author="jira-bot" created="Mon, 17 Nov 2014 10:42:18 +0000"  >&lt;p&gt;Commit 1640138 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1640138&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1640138&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: improved decryption handling&lt;/p&gt;</comment>
                            <comment id="14214507" author="lehmi" created="Mon, 17 Nov 2014 10:47:41 +0000"  >&lt;p&gt;I&apos;ve improved my first fix and now it doesn&apos;t work anymore using the old parser &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; So there has to be something different with the stream providing the data. I&apos;ve to investigate further&lt;/p&gt;</comment>
                            <comment id="14214766" author="jira-bot" created="Mon, 17 Nov 2014 16:04:24 +0000"  >&lt;p&gt;Commit 1640178 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1640178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1640178&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: don&apos;t decrypt the Signature dictionary when using the old parser&lt;/p&gt;</comment>
                            <comment id="14214782" author="jira-bot" created="Mon, 17 Nov 2014 16:12:59 +0000"  >&lt;p&gt;Commit 1640182 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/branches/1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1640182&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1640182&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: don&apos;t decrypt the Signature dictionary when using the old parser&lt;/p&gt;</comment>
                            <comment id="14216027" author="lehmi" created="Tue, 18 Nov 2014 10:12:39 +0000"  >&lt;p&gt;The pdf contains 2 objects for metadata and only one of it seems to be valid. The non-sequential parser uses the correct one (61 0) and the &quot;old&quot; parser tries to decrypt both. The second one (661 0) seems to be somehow broken.&lt;br/&gt;
I set this issue to resolved as it works fine with the non-sequential parser, which is the better choice.&lt;/p&gt;</comment>
                            <comment id="14216197" author="ssteiner1" created="Tue, 18 Nov 2014 14:11:59 +0000"  >&lt;p&gt;PDF from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-578&quot; title=&quot;NPE NullPointerException in PDPageNode.getCount&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-578&quot;&gt;&lt;del&gt;PDFBOX-578&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;java -jar ~/pdf-box-svn/app/target/pdfbox-app-2.0.0-SNAPSHOT.jar PDFToImage FormI-9-English.pdf &lt;br/&gt;
Nov 18, 2014 2:11:32 PM org.apache.pdfbox.pdfparser.PDFParser parse&lt;br/&gt;
INFO: Document is encrypted&lt;br/&gt;
Exception in thread &quot;main&quot; java.io.IOException: javax.crypto.BadPaddingException: Given final block not properly padded&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.encryption.SecurityHandler.encryptData(SecurityHandler.java:365)&lt;/p&gt;</comment>
                            <comment id="14216227" author="lehmi" created="Tue, 18 Nov 2014 14:22:06 +0000"  >&lt;p&gt;Maybe my last comment wasn&apos;t clear enough. The fix is limited to the non-sequential parser. The old one may try to decrypt parts of the pdf which must not be decrypted because those are outdated/no longer in use and has to fail. &lt;/p&gt;</comment>
                            <comment id="14220848" author="tchojecki" created="Fri, 21 Nov 2014 12:35:16 +0000"  >&lt;p&gt;I just run into the same problem as simon. The Forml-9-English.pdf cause a parsing problem for the NonSeq- and normal parser.&lt;/p&gt;

&lt;p&gt;The problem comes with the Revision 1640138 (&lt;a href=&quot;https://svn.apache.org/viewvc?view=revision&amp;amp;revision=r1640138&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/viewvc?view=revision&amp;amp;revision=r1640138&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;To get the old behavior, the two new Exception should be ignored or just logged with the object id. Broken or not encrypted dictionaries would not stop the whole decryption process and the parser has a chance to work with the document.&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="14220937" author="tchojecki" created="Fri, 21 Nov 2014 14:05:04 +0000"  >&lt;p&gt;This patch would fix the regression.&lt;/p&gt;

&lt;p&gt;I moved the doFinal outside of the loop. It won&apos;t change the behavior, but it looks more clear and InputStream#available isn&apos;t needed any more, which can cause problems with some streams (see the JavaDoc)&lt;/p&gt;

&lt;p&gt;The two new exceptions does not throw the WrappedIOException anymore.&lt;/p&gt;</comment>
                            <comment id="14221002" author="lehmi" created="Fri, 21 Nov 2014 15:00:31 +0000"  >&lt;p&gt;I&apos;ll have a deeper look when I&apos;m back home. Where can I get that file you&apos;ve mentioned?&lt;/p&gt;</comment>
                            <comment id="14221006" author="tchojecki" created="Fri, 21 Nov 2014 15:05:01 +0000"  >&lt;p&gt;I&apos;ve attached it to the issue &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;-regression.patch&quot;&lt;/p&gt;</comment>
                            <comment id="14222399" author="jira-bot" created="Sun, 23 Nov 2014 16:05:59 +0000"  >&lt;p&gt;Commit 1641208 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1641208&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1641208&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: avoid calling InputStream#available as proposed by Thomas Chojecki&lt;/p&gt;</comment>
                            <comment id="14222401" author="jira-bot" created="Sun, 23 Nov 2014 16:11:40 +0000"  >&lt;p&gt;Commit 1641210 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/branches/1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1641210&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1641210&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2469&quot; title=&quot;javax.crypto.BadPaddingException in PDFBox 1.8.8-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2469&quot;&gt;&lt;del&gt;PDFBOX-2469&lt;/del&gt;&lt;/a&gt;: avoid calling InputStream#available as proposed by Thomas Chojecki&lt;/p&gt;</comment>
                            <comment id="14222402" author="lehmi" created="Sun, 23 Nov 2014 16:12:25 +0000"  >&lt;p&gt;I&apos;ve checked the attached pdf and can&apos;t confirm the described issue. Are you sure to use the latest trunk?&lt;/p&gt;

&lt;p&gt;I had a look at your patch. Calling doFinal without writing the result to the output may lead to the loss of data (we are using padding here). I don&apos;t like the idea of simply swallowing exceptions. But I&apos;ve followed your proposal to avoid calling  InputStream#available. &lt;/p&gt;</comment>
                            <comment id="14222809" author="tchojecki" created="Mon, 24 Nov 2014 09:09:23 +0000"  >&lt;p&gt;Ups, I simply forgot to write it to the OutputStream. My fault.&lt;/p&gt;

&lt;p&gt;I checked it twice now and I don&apos;t know why, but the NonSeq parser log &lt;br/&gt;
the exception that the stream can not be decrypted, but don&apos;t fail to finish parsing. The legacy parser fails hard and stop parsing the rest of the document.&lt;/p&gt;

&lt;p&gt;All I want to say is, that the NonSeq parser run into the same error but handle it better. Failing the whole decryption because one object can&apos;t be handled isn&apos;t good. &lt;/p&gt;

&lt;p&gt;There are also cases where the NonSeq parser isn&apos;t working, So not every user can just switch to it. Maybe you remember the &quot;signature&quot; discussion &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; This is one TODO I try to fix, but at the moment I haven&apos;t time to do it. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12756603">PDFBOX-2510</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12750773">PDFBOX-2460</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12750524">PDFBOX-2456</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12752055">PDFBOX-2471</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12754436">PDFBOX-2492</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12682897" name="FormI-9-English.pdf" size="387855" author="tchojecki" created="Fri, 21 Nov 2014 15:10:37 +0000"/>
                            <attachment id="12682885" name="PDFBOX-2469-regression.patch" size="1492" author="tchojecki" created="Fri, 21 Nov 2014 14:05:04 +0000"/>
                            <attachment id="12678455" name="testPDF_acroForm.pdf" size="489626" author="tallison" created="Fri, 31 Oct 2014 11:35:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21tb3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>