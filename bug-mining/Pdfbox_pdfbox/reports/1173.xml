<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:01:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2881] Radial and Axial shading steps are calculated incorrectly</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2881</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I found a shading bug while writing some code to dump all shadings in a PDF. I don&apos;t know if this affects PDF rendering within PageDrawer or not.&lt;/p&gt;

&lt;p&gt;RadialShadingContext and AxialShadingContext use the following code in their constructors to calculate the number of steps (pixels) in the shading and build a lookup table for each step:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// transform the distance to actual pixel space
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// use transform, because xform.getScaleX() does not &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; correct scaling on 90&#176; rotated matrix
&lt;/span&gt;Point2D point = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Point2D.&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;(longestDistance, longestDistance);
matrix.transform(point);
xform.transform(point, point);
factor = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.abs(point.getX()), &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.abs(point.getY()));
colorTable = calcColorTable();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The variable &quot;factor&quot; is the number of steps and &quot;matrix&quot; is the parent stream&apos;s matrix + the pattern matrix, so this code is taking the current scale and assuming that that is equal to the number of pixels. This works when a pattern is painted onto a 0...1 scaled surface, but otherwise it produces incorrect results.&lt;/p&gt;

&lt;p&gt;There&apos;s no way to calculate the number of pixels in the device from its scale, or its matrix. Paint#createContext() provides the device bounds Rectangle, which is what we should be using. Indeed, this is handled correctly in the other shading contexts.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12845096">PDFBOX-2881</key>
            <summary>Radial and Axial shading steps are calculated incorrectly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jahewson">John Hewson</assignee>
                                    <reporter username="jahewson">John Hewson</reporter>
                        <labels>
                            <label>shading</label>
                    </labels>
                <created>Tue, 14 Jul 2015 21:52:09 +0000</created>
                <updated>Thu, 17 Mar 2016 19:07:40 +0000</updated>
                            <resolved>Fri, 17 Jul 2015 19:22:36 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14627111" author="jira-bot" created="Tue, 14 Jul 2015 21:54:16 +0000"  >&lt;p&gt;Commit 1691093 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1691093&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1691093&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2881&quot; title=&quot;Radial and Axial shading steps are calculated incorrectly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2881&quot;&gt;&lt;del&gt;PDFBOX-2881&lt;/del&gt;&lt;/a&gt;: Calculate the number of steps using the device bounds&lt;/p&gt;</comment>
                            <comment id="14628214" author="tilman" created="Wed, 15 Jul 2015 15:17:42 +0000"  >&lt;p&gt;I ran my usual tests... many files are different, but the difference is invisible to see except for some tiny shadings that have a difference at the border. I see your change mostly as a reduction of complexity (which is a good thing).&lt;/p&gt;

&lt;p&gt;I have some doubt about the new calculation of the factor for shadings. The old formula was using the distance between two points (each on a zero axis) which is sqrt(a&amp;#42;&amp;#42;2+b&amp;#42;&amp;#42;2). The new formula uses max(a,b). IMHO we&apos;d get a factor that is too low if an axis is diagonal.&lt;/p&gt;</comment>
                            <comment id="14628698" author="jira-bot" created="Wed, 15 Jul 2015 20:45:09 +0000"  >&lt;p&gt;Commit 1691272 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1691272&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1691272&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2881&quot; title=&quot;Radial and Axial shading steps are calculated incorrectly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2881&quot;&gt;&lt;del&gt;PDFBOX-2881&lt;/del&gt;&lt;/a&gt;: Take into account the angle of the shading&lt;/p&gt;</comment>
                            <comment id="14628699" author="jahewson" created="Wed, 15 Jul 2015 20:45:41 +0000"  >&lt;p&gt;I see what you mean about the diagonal axis, yes, my new factor will be too low in some cases. I&apos;ll fix that.&lt;/p&gt;</comment>
                            <comment id="14628701" author="jahewson" created="Wed, 15 Jul 2015 20:47:38 +0000"  >&lt;p&gt;Note that the calculation of the radial factor is different from the old technique because the color table is calculated &quot;on the line that connects two circles&apos; centers&quot;, so I don&apos;t see why the old code was trying to take the radius into account, given that the color table doesn&apos;t use that. There might be an underlying problem here.&lt;/p&gt;

&lt;p&gt;Also, the deviceBounds is now not being taken into account (instead the user -&amp;gt; device transform is used). That&apos;s not ideal, because we should be clamping the calculation to the device bounds to avoid wasted work, but the current implementation of the color table does not permit that.&lt;/p&gt;</comment>
                            <comment id="14628725" author="tilman" created="Wed, 15 Jul 2015 21:03:18 +0000"  >&lt;p&gt;Reopening, now the radial shadings fail. Try e.g. the files asy-ring.pdf, asy-shadestroke.pdf, color_gradient.pdf, eci_altona-test-suite-v2_technical_H.pdf, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1931&quot; title=&quot;Radial shading is missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1931&quot;&gt;&lt;del&gt;PDFBOX-1931&lt;/del&gt;&lt;/a&gt;.pdf, jagpdf_doc_patterns.pdf, GWG060_Shading_x1a.pdf, GWG061_Shading_x1a.pdf, jagpdf_sun.pdf&lt;/p&gt;

&lt;p&gt;I&apos;m also wondering why you put back the complexity. If I&apos;ve understood you correctly, the device bounds values are pixels. So all there would have to be done would be that greek formula, or just add the two values instead (would be too high, but this doesn&apos;t hurt much).&lt;/p&gt;</comment>
                            <comment id="14628745" author="jahewson" created="Wed, 15 Jul 2015 21:12:37 +0000"  >&lt;p&gt;Hmm, that&apos;s interesting. It raises some questions about the correctness of this comment, because I set factor based on the distance between the two circles&apos; centers.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Calculate the color on the line that connects two circles&apos; centers and store the result
     * in an array.
     *
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; an array, index denotes the relative position, the corresponding value the color
     */
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[] calcColorTable() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
    {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Seems to me that the color table is actually calculated using points on each circle&apos;s radius.&lt;/p&gt;</comment>
                            <comment id="14628785" author="tilman" created="Wed, 15 Jul 2015 21:34:36 +0000"  >&lt;p&gt;The radial shading is very tricky code. Maybe we should introduce a comment similar to this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;// 
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// Dear maintainer:
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// 
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// Once you are done trying to &lt;span class=&quot;code-quote&quot;&gt;&apos;optimize&apos;&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; routine,
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// and have realized what a terrible mistake that was,
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// please increment the following counter as a warning
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// to the next guy:
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// 
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// total_hours_wasted_here = 42
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// &lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Source:&lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/a/482129/535646&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/a/482129/535646&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14628941" author="jira-bot" created="Wed, 15 Jul 2015 23:39:56 +0000"  >&lt;p&gt;Commit 1691294 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1691294&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1691294&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2881&quot; title=&quot;Radial and Axial shading steps are calculated incorrectly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2881&quot;&gt;&lt;del&gt;PDFBOX-2881&lt;/del&gt;&lt;/a&gt;: Simplistic computation of radial shading bounds&lt;/p&gt;</comment>
                            <comment id="14628944" author="jahewson" created="Wed, 15 Jul 2015 23:41:19 +0000"  >&lt;p&gt;Yep &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, I couldn&apos;t agree more!&lt;/p&gt;</comment>
                            <comment id="14628948" author="jahewson" created="Wed, 15 Jul 2015 23:42:32 +0000"  >&lt;p&gt;That&apos;s the best I could get working.&lt;/p&gt;</comment>
                            <comment id="14629261" author="tilman" created="Thu, 16 Jul 2015 06:14:32 +0000"  >&lt;p&gt;Reopening again, axial shading is also incorrect, try page 7 of &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2117&quot; title=&quot;AxialShadingContext is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2117&quot;&gt;&lt;del&gt;PDFBOX-2117&lt;/del&gt;&lt;/a&gt;-068519.pdf (but it is probably every page), the borders look poor at 96 dpi, and clearly incorrect at 300dpi. It looked OK in rev 1691093 (although my remark still stands).&lt;/p&gt;</comment>
                            <comment id="14630602" author="jahewson" created="Fri, 17 Jul 2015 00:37:19 +0000"  >&lt;p&gt;This shading code really is tricky. I&apos;ll apply the same simple trick which I used for radial shadings.&lt;/p&gt;</comment>
                            <comment id="14630607" author="jira-bot" created="Fri, 17 Jul 2015 00:42:13 +0000"  >&lt;p&gt;Commit 1691467 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1691467&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1691467&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2881&quot; title=&quot;Radial and Axial shading steps are calculated incorrectly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2881&quot;&gt;&lt;del&gt;PDFBOX-2881&lt;/del&gt;&lt;/a&gt;: Simplistic computation of axial shading bounds&lt;/p&gt;</comment>
                            <comment id="14630608" author="jahewson" created="Fri, 17 Jul 2015 00:42:27 +0000"  >&lt;p&gt;Fingers crossed!&lt;/p&gt;</comment>
                            <comment id="14630609" author="jira-bot" created="Fri, 17 Jul 2015 00:43:36 +0000"  >&lt;p&gt;Commit 1691469 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1691469&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1691469&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2881&quot; title=&quot;Radial and Axial shading steps are calculated incorrectly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2881&quot;&gt;&lt;del&gt;PDFBOX-2881&lt;/del&gt;&lt;/a&gt;: Fix typo&lt;/p&gt;</comment>
                            <comment id="14630610" author="jahewson" created="Fri, 17 Jul 2015 00:46:42 +0000"  >&lt;p&gt;Wait... that made it worse. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14630649" author="jahewson" created="Fri, 17 Jul 2015 01:36:13 +0000"  >&lt;p&gt;It&apos;s worse with JDK 1.6 but fine with 1.7. Some debugging reveals that 1.6 is passing the wrong matrix to createContext, it&apos;s the identity matrix instead of the actual matrix in use on the underlying graphics device.&lt;/p&gt;

&lt;p&gt;So I think we&apos;re good now? The rendering with 1.7 looks good to me.&lt;/p&gt;</comment>
                            <comment id="14631607" author="tilman" created="Fri, 17 Jul 2015 17:14:49 +0000"  >&lt;p&gt;Yes it works now! (But I use 1.7)&lt;/p&gt;</comment>
                            <comment id="14631777" author="jahewson" created="Fri, 17 Jul 2015 19:22:25 +0000"  >&lt;p&gt;Ok good, that will do &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 18 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2h98n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>