<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:13:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5696] COSStream lost, becomes a COSDictionary</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5696</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;This is reduced from the example presented by Pados Attila on the mailing list&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
{
    InputStream resourceAsStream = NewClass.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getResourceAsStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;/pdf/TemplateTank.pdf&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDDocument a1doc = Loader.loadPDF(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RandomAccessReadBuffer(resourceAsStream)))
    {
        PDAcroForm form = a1doc.getDocumentCatalog().getAcroForm();
        PDResources dr = form.getDefaultResources();

        form.getField(&lt;span class=&quot;code-quote&quot;&gt;&quot;Site Name&quot;&lt;/span&gt;).setValue(&lt;span class=&quot;code-quote&quot;&gt;&quot;Site Name&quot;&lt;/span&gt;);
        a1doc.save(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;30-1.pdf&quot;&lt;/span&gt;));

        PDFont font = PDType0Font.load(a1doc, PdfGenerator.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;getResourceAsStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;/fonts/CambriaMath.ttf&quot;&lt;/span&gt;), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
        dr.add(font);
        a1doc.save(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;30-2.pdf&quot;&lt;/span&gt;));
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The result file 30-1.pdf has &quot;Site Name&quot; in the rendering, the result file 30-2.pdf doesn&apos;t, because the appearance stream is now a dictionary.&lt;/p&gt;

&lt;p&gt;(The test was done on jdk21, I didn&apos;t test on another jdk)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13553238">PDFBOX-5696</key>
            <summary>COSStream lost, becomes a COSDictionary</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                    </labels>
                <created>Sat, 7 Oct 2023 10:43:31 +0000</created>
                <updated>Thu, 30 Nov 2023 21:19:24 +0000</updated>
                            <resolved>Sat, 14 Oct 2023 09:08:54 +0000</resolved>
                                    <version>3.0.0 PDFBox</version>
                                    <fixVersion>3.0.1 PDFBox</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17772795" author="lehmi" created="Sat, 7 Oct 2023 11:05:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; Is this really limited to 3.0.1, which isn&apos;t released btw &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, or is &quot;Affected version/s&quot; simply wrong?&lt;/p&gt;</comment>
                            <comment id="17772796" author="tilman" created="Sat, 7 Oct 2023 11:07:54 +0000"  >&lt;p&gt;I tested it with 3.0.1-SNAPSHOT. The complaint on the mailing list was about 3.0.0 first.&lt;/p&gt;</comment>
                            <comment id="17773210" author="mkl" created="Mon, 9 Oct 2023 09:39:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;because the appearance stream is now a dictionary&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not only has that appearance stream lost its stream data, it also has been added to an object stream which is not possible for streams. This might even have caused the loss of the stream data.&lt;/p&gt;

&lt;p&gt;Furthermore, another issue becomes apparent already in the first saved object: This single revision document has a cross reference stream with segmented object number ranges:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;/Index [0 3 4 1 8 13 22 3 26 9
36 15 52 5]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But single revision documents must have a single subsection cross reference only starting with object number 0 having &lt;em&gt;Size&lt;/em&gt; entries. Also there must be a mapping for every object number from 0 to _Size - 1 which isn&apos;t the case here either.&lt;br/&gt;
Usually PDF viewers have no problems if these rules aren&apos;t followed but in some cases (e.g. signature validation) that might result in issues.&lt;/p&gt;</comment>
                            <comment id="17773905" author="jira-bot" created="Wed, 11 Oct 2023 06:01:56 +0000"  >&lt;p&gt;Commit 1912886 from lehmi@apache.org in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1912886&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1912886&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5696&quot; title=&quot;COSStream lost, becomes a COSDictionary&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5696&quot;&gt;&lt;del&gt;PDFBOX-5696&lt;/del&gt;&lt;/a&gt;: update highest object number when saving a pdf&lt;/p&gt;</comment>
                            <comment id="17773906" author="jira-bot" created="Wed, 11 Oct 2023 06:02:07 +0000"  >&lt;p&gt;Commit 1912887 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1912887&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1912887&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5696&quot; title=&quot;COSStream lost, becomes a COSDictionary&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5696&quot;&gt;&lt;del&gt;PDFBOX-5696&lt;/del&gt;&lt;/a&gt;: update highest object number when saving a pdf&lt;/p&gt;</comment>
                            <comment id="17773907" author="lehmi" created="Wed, 11 Oct 2023 06:05:18 +0000"  >&lt;p&gt;The highest object number wasn&apos;t updated after writing the pdf so that all new objects are subject to be mixed up &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17773919" author="lehmi" created="Wed, 11 Oct 2023 06:39:52 +0000"  >&lt;p&gt;There seems to be an issue with one test&lt;/p&gt;</comment>
                            <comment id="17774149" author="jira-bot" created="Wed, 11 Oct 2023 17:29:41 +0000"  >&lt;p&gt;Commit 1912906 from lehmi@apache.org in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1912906&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1912906&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5696&quot; title=&quot;COSStream lost, becomes a COSDictionary&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5696&quot;&gt;&lt;del&gt;PDFBOX-5696&lt;/del&gt;&lt;/a&gt;: don&apos;t update highest object number for incremental updates&lt;/p&gt;</comment>
                            <comment id="17774150" author="jira-bot" created="Wed, 11 Oct 2023 17:30:44 +0000"  >&lt;p&gt;Commit 1912907 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1912907&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1912907&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5696&quot; title=&quot;COSStream lost, becomes a COSDictionary&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5696&quot;&gt;&lt;del&gt;PDFBOX-5696&lt;/del&gt;&lt;/a&gt;: don&apos;t update highest object number for incremental updates&lt;/p&gt;</comment>
                            <comment id="17774152" author="lehmi" created="Wed, 11 Oct 2023 17:32:36 +0000"  >&lt;p&gt;I&apos;ve found the root cause for the failing test cases. We have to skip the update of the highest object number for incremental updates&lt;/p&gt;</comment>
                            <comment id="17774301" author="tilman" created="Thu, 12 Oct 2023 02:56:53 +0000"  >&lt;p&gt;Thanks. Sadly the error still happens with the original code from Pados Attila, it turns out I had found a different bug (the one here) by trying to simplify his code. His actual bug is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5489&quot; title=&quot;Split result page missing dictionary after split&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5489&quot;&gt;&lt;del&gt;PDFBOX-5489&lt;/del&gt;&lt;/a&gt; but he used addPage instead of importPage. I&apos;ll write something in the user list, in the &quot;empty/missing pdf content&quot; thread.&lt;/p&gt;</comment>
                            <comment id="17774795" author="jira-bot" created="Fri, 13 Oct 2023 05:38:56 +0000"  >&lt;p&gt;Commit 1912927 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1912927&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1912927&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5696&quot; title=&quot;COSStream lost, becomes a COSDictionary&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5696&quot;&gt;&lt;del&gt;PDFBOX-5696&lt;/del&gt;&lt;/a&gt;: update highest object number when adding a page to a document as suggested by Tilman Hausherr&lt;/p&gt;</comment>
                            <comment id="17774796" author="jira-bot" created="Fri, 13 Oct 2023 05:39:15 +0000"  >&lt;p&gt;Commit 1912928 from lehmi@apache.org in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1912928&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1912928&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5696&quot; title=&quot;COSStream lost, becomes a COSDictionary&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5696&quot;&gt;&lt;del&gt;PDFBOX-5696&lt;/del&gt;&lt;/a&gt;: update highest object number when adding a page to a document as suggested by Tilman Hausherr&lt;/p&gt;</comment>
                            <comment id="17774800" author="lehmi" created="Fri, 13 Oct 2023 06:08:58 +0000"  >&lt;p&gt;I didn&apos;t have a look at the origin source &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; However I&apos;ve fixed the issue following &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; suggestion to update the highest object number when calling addPage.&lt;/p&gt;</comment>
                            <comment id="17775012" author="tilman" created="Fri, 13 Oct 2023 18:09:12 +0000"  >&lt;p&gt;Thank you. His code was somewhat... unusual, he manipulates pages of the template doc and then adds these pages to a new PDDocument. It works fine now, both the original code and another simplified code that I didn&apos;t post.&lt;/p&gt;</comment>
                            <comment id="17775168" author="lehmi" created="Sat, 14 Oct 2023 09:08:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; Thanks for the feedback, set to resolved&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13549010">PDFBOX-5666</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13063401" name="30-1.pdf" size="257002" author="tilman" created="Sat, 7 Oct 2023 10:41:27 +0000"/>
                            <attachment id="13063400" name="30-2.pdf" size="1072535" author="tilman" created="Sat, 7 Oct 2023 10:41:27 +0000"/>
                            <attachment id="13063399" name="CambriaMath.ttf" size="1408700" author="tilman" created="Sat, 7 Oct 2023 10:41:42 +0000"/>
                            <attachment id="13063398" name="TemplateTank.pdf" size="257667" author="tilman" created="Sat, 7 Oct 2023 10:41:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1kspk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>