<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:58:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2570] ClassCastException in PDCalGray: COSFloat cannot be cast to COSArray</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2570</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;INFORMATION: Rendering: PDFBOX-1724.pdf
java.lang.ClassCastException: org.apache.pdfbox.cos.COSFloat cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to org.apache.pdfbox.cos.COSArray
	at org.apache.pdfbox.pdmodel.graphics.color.PDCalRGB.getGamma(PDCalRGB.java:158)
	at org.apache.pdfbox.pdmodel.graphics.color.PDCalRGB.toRGB(PDCalRGB.java:95)
	at org.apache.pdfbox.pdmodel.graphics.color.PDCalGray.toRGB(PDCalGray.java:81)
	at org.apache.pdfbox.pdmodel.graphics.color.PDCIEBasedColorSpace.toRGBImage(PDCIEBasedColorSpace.java:88)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The cause is that in one of the redesigns it was overseen that the Gamma is a single value for CalGray, and not an array like in CalRGB. Thus PDCalGray cannot be extended from PDCalRGB. The bug didn&apos;t have an effect because the gamma wasn&apos;t used before &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2553&quot; title=&quot;CalRGB colors different&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2553&quot;&gt;&lt;del&gt;PDFBOX-2553&lt;/del&gt;&lt;/a&gt;. Instead I will extend it from PDCIEBasedColorSpace or from a new abstract class PDCalBasedColorSpace.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12761794">PDFBOX-2570</key>
            <summary>ClassCastException in PDCalGray: COSFloat cannot be cast to COSArray</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                            <label>CalGray</label>
                            <label>CalRGB</label>
                            <label>regression</label>
                    </labels>
                <created>Mon, 15 Dec 2014 17:06:25 +0000</created>
                <updated>Thu, 17 Mar 2016 19:07:10 +0000</updated>
                            <resolved>Wed, 17 Dec 2014 21:25:48 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Parsing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14247174" author="jahewson" created="Mon, 15 Dec 2014 20:26:08 +0000"  >&lt;p&gt;If you have a single-valued gray gamma &lt;em&gt;x&lt;/em&gt; then it is equivalent to the RGB gamma (r=x, g=x, b=x). All that is needed is to override getGamma() in CalGray so that parses a single float.&lt;/p&gt;

&lt;p&gt;It&apos;s probably best to do this by adding a new constructor to PDGamma which takes a single float and populates the RGB value COSArray.&lt;/p&gt;</comment>
                            <comment id="14247188" author="tilman" created="Mon, 15 Dec 2014 20:35:45 +0000"  >&lt;p&gt;Maybe, but the spec clearly mentions that it is a single float and not an array with one element, so the API should get and set a single float and not an array. While looking at this stuff, I also found some double code so I&apos;m now refactoring this stuff. And the toRGB method is also quite different to the one from CalRGB, but I&apos;m running tests first.&lt;/p&gt;</comment>
                            <comment id="14247194" author="jahewson" created="Mon, 15 Dec 2014 20:48:21 +0000"  >&lt;p&gt;Yes you can override getGamma and setGamma to do that. My understanding is that a CalRGB color space is identical to a CalRGB color space with a Gamma = &lt;span class=&quot;error&quot;&gt;&amp;#91;G, G, G&amp;#93;&lt;/span&gt; and Matrix = Identity.&lt;/p&gt;

&lt;p&gt;The PDGamma APIs are old and mostly unused, setGamma certainly needs some refactoring.&lt;/p&gt;</comment>
                            <comment id="14247245" author="tilman" created="Mon, 15 Dec 2014 21:22:42 +0000"  >&lt;p&gt;With refactoring, I mean refactoring of PDLab and PDCalRGB, because these have too many common code.&lt;/p&gt;

&lt;p&gt;What you are intending to do with PDGamma would make everything much more complex, i.e. PDGamma would probably need to have a split personality, i.e. once an array and once a float.&lt;/p&gt;

&lt;p&gt;There&apos;s another difference, the conversion to RGB in CalGray must use the whitepoint, while in CalRGB the whitepoint is not mentioned directly. However I couldn&apos;t find any example where the &quot;new&quot; conversion made any difference. One could probably just pass the parameter as result.&lt;/p&gt;

&lt;p&gt;But IMO CalGray is not a special case of CalRGB like DeviceGray is not a special case of DeviceRGB.&lt;/p&gt;</comment>
                            <comment id="14247246" author="jira-bot" created="Mon, 15 Dec 2014 21:22:54 +0000"  >&lt;p&gt;Commit 1645762 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1645762&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1645762&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2570&quot; title=&quot;ClassCastException in PDCalGray: COSFloat cannot be cast to COSArray&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2570&quot;&gt;&lt;del&gt;PDFBOX-2570&lt;/del&gt;&lt;/a&gt;: refactoring to get rid of double code in PDCal* / PDLab; corrected gamma according to spec&lt;/p&gt;</comment>
                            <comment id="14247249" author="tilman" created="Mon, 15 Dec 2014 21:23:57 +0000"  >&lt;p&gt;So there it is... if you feel you want CalGray be a derived of CalRGB, go ahead.&lt;/p&gt;</comment>
                            <comment id="14247262" author="jahewson" created="Mon, 15 Dec 2014 21:34:09 +0000"  >&lt;p&gt;I don&apos;t understand why you&apos;ve created a &quot;CIEDictionaryBasedColorSpace&quot; when there is no such thing in the PDF spec. Can&apos;t the common functionality just go in PDCIEBasedColorSpace?&lt;/p&gt;</comment>
                            <comment id="14247266" author="tilman" created="Mon, 15 Dec 2014 21:36:06 +0000"  >&lt;p&gt;It is an abstract class. It&apos;s needed because the PDCIEBasedColorSpace classes don&apos;t always have a dictionary. (e.g. PDICCBased)&lt;/p&gt;</comment>
                            <comment id="14247289" author="jahewson" created="Mon, 15 Dec 2014 21:57:27 +0000"  >&lt;p&gt;Ok, great, I see. Looks like ICCBased was a later addition to PDF, so it&apos;s the odd one out. There&apos;s no real need for CalGray to extend CalRGB, even though CalGray is logically just a special case of CalRGB. One advantage of not doing so is that the calculations for grayscale images will be faster with dedicated grayscale code.&lt;/p&gt;

&lt;p&gt;Neither of the CalXXX color spaces have received much attention, e.g. I notice that getGammaMatrix should be getMatrix - the matrix specifies an arbitrary transform and not gamma itself. This is a legacy from old 1.8 code.&lt;/p&gt;</comment>
                            <comment id="14250557" author="jira-bot" created="Wed, 17 Dec 2014 21:12:21 +0000"  >&lt;p&gt;Commit 1646337 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1646337&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1646337&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2570&quot; title=&quot;ClassCastException in PDCalGray: COSFloat cannot be cast to COSArray&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2570&quot;&gt;&lt;del&gt;PDFBOX-2570&lt;/del&gt;&lt;/a&gt;: renamed set/getGammaMatrix to set/getMatrix&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 48 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23fz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>