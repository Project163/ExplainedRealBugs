<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:03:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3347] COSName parsing doesn&apos;t handle ISO-8859-1 encoded bytes</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3347</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;As discussed here &lt;a href=&quot;http://stackoverflow.com/questions/36964496/pdfbox-2-0-overcoming-dictionary-key-encoding/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/36964496/pdfbox-2-0-overcoming-dictionary-key-encoding/&lt;/a&gt; a byte sequence making up a COSName is interpreted during parsing and writing where it shouldn&apos;t. Details are given my mkl&apos;s excellent analysis.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12966724">PDFBOX-3347</key>
            <summary>COSName parsing doesn&apos;t handle ISO-8859-1 encoded bytes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jahewson">John Hewson</assignee>
                                    <reporter username="msahyoun">Maruan Sahyoun</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 May 2016 13:02:22 +0000</created>
                <updated>Fri, 15 Dec 2023 12:12:18 +0000</updated>
                            <resolved>Thu, 9 May 2019 13:12:25 +0000</resolved>
                                    <version>1.8.12</version>
                    <version>2.0.1</version>
                    <version>2.0.2</version>
                                    <fixVersion>2.0.6</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Parsing</component>
                    <component>Writing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15278628" author="jahewson" created="Tue, 10 May 2016 18:22:21 +0000"  >&lt;p&gt;Note that parsing COSName as UTF-8, which we already do, is correct. mkl makes good points about how we compare and write out COSName (these should indeed be byte-based, like COSString is in 2.0). But that&apos;s not the issue here. The SO user is not correct in saying that the dictionary keys are supposed to be ISO-8859-1 encoded (though it looks like they are in this file). ISO-8859-1 is not used anywhere in the PDF spec.&lt;/p&gt;

&lt;p&gt;Looking at the &lt;tt&gt;Krematorier&lt;/tt&gt; field (26th in the Fields array) we see an appearance stream (AP &amp;gt; N &amp;gt; 1) with a raw name of &lt;tt&gt;/R#E5cksta&lt;/tt&gt;. The # is a hex escape character and the desired behaviour is that PDFBox should be parsing #E5 as U+00E5 which is &lt;tt&gt;&#229;&lt;/tt&gt;. However that&apos;s not happening.&lt;/p&gt;
</comment>
                            <comment id="15278670" author="jahewson" created="Tue, 10 May 2016 18:47:12 +0000"  >&lt;p&gt;Ok, so the UTF-8 sequence for &#229; (U+00E5) is &lt;b&gt;two bytes&lt;/b&gt; &lt;tt&gt;C3 A5&lt;/tt&gt;, so this PDF file is bad. This PDF appears to have its named encoded with ISO-8859-1, which is wrong.&lt;/p&gt;</comment>
                            <comment id="15278679" author="jahewson" created="Tue, 10 May 2016 18:57:16 +0000"  >&lt;p&gt;&lt;tt&gt;E5&lt;/tt&gt; on its own is not a valid UTF-8 sequence, which must be how iText is detecting that the encoding of this name is wrong, and falling back to ISO-8859-1. We can do the same.&lt;/p&gt;</comment>
                            <comment id="15278684" author="jira-bot" created="Tue, 10 May 2016 18:59:45 +0000"  >&lt;p&gt;Commit 1743248 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1743248&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1743248&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3347&quot; title=&quot;COSName parsing doesn&amp;#39;t handle ISO-8859-1 encoded bytes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3347&quot;&gt;&lt;del&gt;PDFBOX-3347&lt;/del&gt;&lt;/a&gt;: fallback to ISO-8859-1 for names with invalid UTF-8&lt;/p&gt;</comment>
                            <comment id="15278694" author="msahyoun" created="Tue, 10 May 2016 19:09:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; thanks for taking care of this. My main intention was to get the encoding/decoding part fixed as per mkl&apos;s comment which I think he is correct with. Will that be done in a different issue? I&apos;d think we should keep the raw value when parsing and rewriting the name. WDYT?&lt;br/&gt;
Shall we fix it for 2.1, 1.8 too?&lt;/p&gt;</comment>
                            <comment id="15279670" author="mkl" created="Wed, 11 May 2016 06:45:38 +0000"  >&lt;blockquote&gt;
&lt;p&gt;which must be how iText is detecting that the encoding of this name is wrong&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually iText in this regards is less sophisticated, it essentially assumes each byte of the name (after resolution of the #-sequences) to be the lower byte of U+00xx:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
                    ch = file.read();
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (delims[ch + 1])
                        &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ch == &lt;span class=&quot;code-quote&quot;&gt;&apos;#&apos;&lt;/span&gt;) {
                        ch = (getHex(file.read()) &amp;lt;&amp;lt; 4) + getHex(file.read());
                    }
                    outBuf.append((&lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;)ch);
                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;i.e. essentially it treats it as ISO-8859-1 encoded from the start.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;That been said, falling back to ISO-8859-1 is one option which kind of corresponds with PDF history (&quot;In Acrobat 4.0 and earlier versions, a name object being treated as text will typically be interpreted in a host platform encoding&quot;). Alternatively a fallback to &lt;b&gt;PDFDocEncoding&lt;/b&gt; would also make sense, especially considering &lt;/p&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;ISO 32000-1 section &lt;em&gt;12.7.4.2.3 Check Boxes&lt;/em&gt;&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;name objects in the appearance dictionary are limited to &lt;b&gt;PDFDocEncoding&lt;/b&gt;&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(Yes, this bit of the specification is at odds with the piece of it quoted on stackoverflow which recommended an UTF-8 interpretation...)&lt;/p&gt;

&lt;p&gt;Considering, though, that earlier PDF references on that issue wrote &quot;limited to the Latin character set&quot;, ISO-8859-1 might be more apropos.&lt;/p&gt;</comment>
                            <comment id="15280560" author="jahewson" created="Wed, 11 May 2016 18:19:11 +0000"  >&lt;p&gt;Thanks for the detailed analysis - looks like our new fallback mechanism makes the right choices.&lt;/p&gt;</comment>
                            <comment id="15280571" author="jahewson" created="Wed, 11 May 2016 18:23:22 +0000"  >&lt;p&gt;Lets follow up on that in another issue. We&apos;ve fixed the bug which was causing the SO issue here. While the re-encoding issue is a problem in theory it&apos;s not causing anyone any problems right now.&lt;/p&gt;

&lt;p&gt;&amp;gt; Shall we fix it for 2.1, 1.8 too?&lt;/p&gt;

&lt;p&gt;I don&apos;t see any great need to fix this in 1.8, especially as it&apos;s main use case is forms, which have changed significantly. One thing which surprises/confuses me how is &apos;trunk&apos; not automatically part of 2.1... have we messed up the branches somehow here?&lt;/p&gt;</comment>
                            <comment id="15998500" author="lehmi" created="Fri, 5 May 2017 15:59:38 +0000"  >&lt;p&gt;THe fix version is wrong as the changes weren&apos;t committed to the 2.0 branch&lt;/p&gt;</comment>
                            <comment id="15998501" author="jira-bot" created="Fri, 5 May 2017 16:00:23 +0000"  >&lt;p&gt;Commit 1794069 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1794069&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1794069&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3347&quot; title=&quot;COSName parsing doesn&amp;#39;t handle ISO-8859-1 encoded bytes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3347&quot;&gt;&lt;del&gt;PDFBOX-3347&lt;/del&gt;&lt;/a&gt;: fallback to ISO-8859-1 for names with invalid UTF-8&lt;/p&gt;</comment>
                            <comment id="15998503" author="lehmi" created="Fri, 5 May 2017 16:01:54 +0000"  >&lt;p&gt;I&apos;ve committed the changes to the 2.0 branch&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; There isn&apos;t any magic which merges changes from the trunk to any of the branches&lt;/p&gt;</comment>
                            <comment id="16836368" author="tilman" created="Thu, 9 May 2019 13:10:55 +0000"  >&lt;p&gt;Reopening to add file, for reference. An example of the problem can be found at &lt;tt&gt;Root/AcroForm/Fields/&lt;span class=&quot;error&quot;&gt;&amp;#91;26&amp;#93;&lt;/span&gt;/Kids/&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;/AP/N/R&#65533;cksta&lt;/tt&gt; (or&#160;R&#229;cksta).}}&lt;/p&gt;</comment>
                            <comment id="16859213" author="chunlinyao" created="Sat, 8 Jun 2019 13:06:38 +0000"  >&lt;p&gt;For some CJK pdfs, the name may be encoded in CP936 or MS932, especially for /BaseFont.&lt;/p&gt;</comment>
                            <comment id="16859387" author="tilman" created="Sun, 9 Jun 2019 07:07:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=chunlinyao&quot; class=&quot;user-hover&quot; rel=&quot;chunlinyao&quot;&gt;chunlinyao&lt;/a&gt; This is a closed issue; if you have such a file, please open a new issue (explain what you expected and what you got instead) and attach the file. Maybe our strategy with non UTF8 names needs some fine-tuning.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13277191">PDFBOX-4728</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13232449">PDFBOX-4539</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13561982">PDFBOX-5739</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12968302" name="KYF 211 Best&#228;llning 2014.pdf" size="4261615" author="tilman" created="Thu, 9 May 2019 13:12:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2xgev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>