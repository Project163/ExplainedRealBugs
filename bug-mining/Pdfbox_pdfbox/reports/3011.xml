<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:15:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5927] Saved file has &quot;Invalid dictionary&quot; when reloading</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5927</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDDocument doc = Loader.loadPDF(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;SO79293670.pdf&quot;&lt;/span&gt;)))
{
    doc.save(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;SO79293670-saved.pdf&quot;&lt;/span&gt;)); &lt;span class=&quot;code-comment&quot;&gt;//, CompressParameters.NO_COMPRESSION);
&lt;/span&gt;}
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDDocument doc = Loader.loadPDF(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;SO79293670-saved.pdf&quot;&lt;/span&gt;)))
{
    PDAcroForm acroForm = doc.getDocumentCatalog().getAcroForm();
    PDCheckBox cb = (PDCheckBox) acroForm.getField(&lt;span class=&quot;code-quote&quot;&gt;&quot;chkPrivacy1&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(cb.isChecked()); &lt;span class=&quot;code-comment&quot;&gt;// should be &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The output:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;19.12.2024 16:48:15 WARN  pdfparser.BaseParser.parseCOSDictionary:308 - Invalid dictionary, found: &apos;3&apos; but expected: &apos;/&apos; at offset 12814
19.12.2024 16:48:15 WARN  pdfparser.BaseParser.parseCOSDictionary:308 - Invalid dictionary, found: &apos;3&apos; but expected: &apos;/&apos; at offset 12851
false
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The offsets are in the object stream.&lt;/p&gt;

&lt;p&gt;When opening the modified file with Adobe Reader, I get&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13073588/13073588_screenshot-1.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
And after clicking CTRL-RETURN I get&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13073589/13073589_screenshot-2.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The problem does not happen when saving with compression disabled.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13602709">PDFBOX-5927</key>
            <summary>Saved file has &quot;Invalid dictionary&quot; when reloading</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Dec 2024 15:53:15 +0000</created>
                <updated>Thu, 23 Jan 2025 19:00:07 +0000</updated>
                            <resolved>Fri, 20 Dec 2024 11:01:20 +0000</resolved>
                                    <version>3.0.3 PDFBox</version>
                    <version>4.0.0</version>
                                    <fixVersion>3.0.4 PDFBox</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>Writing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17907121" author="tilman" created="Thu, 19 Dec 2024 17:01:42 +0000"  >&lt;p&gt;The problem is this dictionary:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;&amp;lt;/Off 223 0 R 305 0 R 224 0 R &amp;gt;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The dictionary key (305 0 R) is an indirect object. I found it:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/S#C3#AC
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;del&gt;Maybe related to that it&apos;s non ascii (&quot;S&#236;&quot;).&lt;/del&gt;&lt;/p&gt;</comment>
                            <comment id="17907155" author="tilman" created="Thu, 19 Dec 2024 18:43:45 +0000"  >&lt;p&gt;I think I understand most of it now. &quot;S&#236;&quot; is an indirect object in the source file as the value of /DV, this is unusual, but allowed:&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13073594/13073594_screenshot-3.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;In &lt;tt&gt;COSWriterObjectStream.writeObject()&lt;/tt&gt; there is this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!topLevel &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.compressionPool.contains(base))
{
    COSObjectKey key = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.compressionPool.getKey(base);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (key == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
    {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(
                &lt;span class=&quot;code-quote&quot;&gt;&quot;Error: Adding unknown object reference to object stream:&quot;&lt;/span&gt; + object);
    }
    writeObjectReference(output, key);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Because the key is also an object, the method will be called and will produce an indirect object.&lt;/p&gt;

&lt;p&gt;Two possible solutions:&lt;/p&gt;

&lt;p&gt;1) add &lt;tt&gt;&amp;amp;&amp;amp; !(base instanceof COSName)&lt;/tt&gt; to the &quot;if&quot;&lt;br/&gt;
2) in &lt;tt&gt;writeCOSDictionary&lt;/tt&gt; write the key with the &quot;topLevel&quot; parameter true (but I&apos;m not sure about what the intention of the parameter is, but in practice when true no indirect writing occurs)&lt;/p&gt;</comment>
                            <comment id="17907335" author="jira-bot" created="Fri, 20 Dec 2024 10:24:12 +0000"  >&lt;p&gt;Commit 1922607 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1922607&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1922607&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5927&quot; title=&quot;Saved file has &amp;quot;Invalid dictionary&amp;quot; when reloading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5927&quot;&gt;&lt;del&gt;PDFBOX-5927&lt;/del&gt;&lt;/a&gt;: prevent dictionary key from becoming an indirect object in an object stream&lt;/p&gt;</comment>
                            <comment id="17907336" author="jira-bot" created="Fri, 20 Dec 2024 10:24:16 +0000"  >&lt;p&gt;Commit 1922608 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1922608&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1922608&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5927&quot; title=&quot;Saved file has &amp;quot;Invalid dictionary&amp;quot; when reloading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5927&quot;&gt;&lt;del&gt;PDFBOX-5927&lt;/del&gt;&lt;/a&gt;: prevent dictionary key from becoming an indirect object in an object stream&lt;/p&gt;</comment>
                            <comment id="17907344" author="jira-bot" created="Fri, 20 Dec 2024 10:54:24 +0000"  >&lt;p&gt;Commit 1922609 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1922609&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1922609&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5927&quot; title=&quot;Saved file has &amp;quot;Invalid dictionary&amp;quot; when reloading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5927&quot;&gt;&lt;del&gt;PDFBOX-5927&lt;/del&gt;&lt;/a&gt;: add test&lt;/p&gt;</comment>
                            <comment id="17907345" author="jira-bot" created="Fri, 20 Dec 2024 10:54:28 +0000"  >&lt;p&gt;Commit 1922610 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1922610&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1922610&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5927&quot; title=&quot;Saved file has &amp;quot;Invalid dictionary&amp;quot; when reloading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5927&quot;&gt;&lt;del&gt;PDFBOX-5927&lt;/del&gt;&lt;/a&gt;: add test&lt;/p&gt;</comment>
                            <comment id="17907351" author="tilman" created="Fri, 20 Dec 2024 11:01:20 +0000"  >&lt;p&gt;After sleeping over it, I decided to use (2). My understanding is that &quot;topLevel&quot; was meant for the initial writing to the compressed object stream, as opposed to objects not in the list that are written later.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=capSVD&quot; class=&quot;user-hover&quot; rel=&quot;capSVD&quot;&gt;capSVD&lt;/a&gt; please have a look at the change and make yourself heard if you disagree.&lt;/p&gt;</comment>
                            <comment id="17913232" author="capsvd" created="Wed, 15 Jan 2025 09:26:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; sorry for taking so long to reply, I was on vacation.&lt;/p&gt;

&lt;p&gt;First of all - thank you for bringing this to my attention, I will consider this going forward.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;TL;DR:&lt;/b&gt; I agree to your change and the bugfix.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Meaning of topLevel:&lt;/b&gt;&lt;br/&gt;
I think you got that right. I meant to say: &lt;br/&gt;
The object must not be included in this objectstream - just reference it and don&#180;t worry about it. -&amp;gt; The object is placed elsewhere in the document - probably at the &quot;top level&quot;/&quot;root&quot;/&quot;body&quot; of the PDF document. Meaning - yes that would refer to objects written by the COSWriter later without applying compression.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Concerning the issue:&lt;/b&gt;&lt;br/&gt;
I do not actually remember, whether I had an actual reason for trying to include referenced &quot;key objects&quot; into object streams. But considering your findings I doubt, that this decision was made on purpose. I rather assume, that I was ignorant concerning this issue and did not give it proper thought, whether a key itself could be a referenced COSObject. I agree to your bugfix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13073587" name="ObjStm.txt" size="154601" author="tilman" created="Thu, 19 Dec 2024 15:52:22 +0000"/>
                            <attachment id="13073585" name="SO79293670-saved.pdf" size="834642" author="tilman" created="Thu, 19 Dec 2024 15:52:47 +0000"/>
                            <attachment id="13073586" name="SO79293670.pdf" size="1080956" author="tilman" created="Thu, 19 Dec 2024 15:52:23 +0000"/>
                            <attachment id="13073588" name="screenshot-1.png" size="36708" author="tilman" created="Thu, 19 Dec 2024 15:54:19 +0000"/>
                            <attachment id="13073589" name="screenshot-2.png" size="31882" author="tilman" created="Thu, 19 Dec 2024 15:54:48 +0000"/>
                            <attachment id="13073594" name="screenshot-3.png" size="19868" author="tilman" created="Thu, 19 Dec 2024 18:35:43 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://stackoverflow.com/questions/79293670/apache-pdfbox-checkbox-already-checked-is-then-set-to-unchecked]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            42 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1t854:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>