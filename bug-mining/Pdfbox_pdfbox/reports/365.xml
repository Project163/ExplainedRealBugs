<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:54:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1778] Rounding issue in generated PDF file</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1778</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;We have PDF file which was signed by some other application.&lt;br/&gt;
When we try to sign it with PDFbox, previous revision is damaged.&lt;/p&gt;

&lt;p&gt;We did some investigations and found such problem:&lt;br/&gt;
(question on stackoverflow is here: &lt;a href=&quot;http://stackoverflow.com/questions/19903884/pdf-document-is-modified-by-another-revision/19905271?noredirect=1#19905271&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/19903884/pdf-document-is-modified-by-another-revision/19905271?noredirect=1#19905271&lt;/a&gt; )&lt;/p&gt;

&lt;p&gt;Some PDF tags are changed in new revisions.&lt;br/&gt;
For example values of following tags:&lt;br/&gt;
/WhitePoint&lt;br/&gt;
/Gamma&lt;br/&gt;
/Matrix&lt;br/&gt;
are changed from values like this: 0.9505&lt;br/&gt;
to values like this: 0.9505000114&lt;/p&gt;

&lt;p&gt;We think this is problem of converting float/double inside COSFloat.&lt;/p&gt;

&lt;p&gt;Following code just opens and saves PDF file and this operation changes values of mentioned text:&lt;/p&gt;

&lt;p&gt;public void saveTo(String sourceFile, String destFile) throws Exception{&lt;br/&gt;
    PDDocument doc = PDDocument.load(new FileInputStream(sourceFile));&lt;br/&gt;
    doc.save(new FileOutputStream(destFile));&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment></environment>
        <key id="12678604">PDFBOX-1778</key>
            <summary>Rounding issue in generated PDF file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="v.koroghlishvili">vakhtang koroghlishvili</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Nov 2013 16:53:11 +0000</created>
                <updated>Sat, 30 Nov 2013 17:02:10 +0000</updated>
                            <resolved>Sun, 17 Nov 2013 18:36:47 +0000</resolved>
                                    <version>1.8.3</version>
                                    <fixVersion>1.8.3</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>PDModel</component>
                    <component>Signing</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13819130" author="v.koroghlishvili" created="Mon, 11 Nov 2013 17:06:44 +0000"  >&lt;p&gt;From attached files original.pdf is original PDF. And saved.pdf is file modified by code in description.&lt;br/&gt;
As you can see values for /WhitePoint, /Gamma and /Matrix are changed in saved.pdf.&lt;/p&gt;</comment>
                            <comment id="13819190" author="oneiros" created="Mon, 11 Nov 2013 18:35:32 +0000"  >&lt;p&gt;The difference is 0.0000000114 - I seriously doubt that any output device will honor that. Historically PDF isn&apos;t very precise - Adobe&apos;s last PDF spec (1.7) mentions 5 fractional digits and single precision floats as implementation limits.&lt;/p&gt;</comment>
                            <comment id="13819402" author="oneiros" created="Mon, 11 Nov 2013 21:15:08 +0000"  >&lt;p&gt;See also &lt;a href=&quot;http://stackoverflow.com/q/19903884/821436&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/q/19903884/821436&lt;/a&gt; - the problem is not the rounding, but the changes.&lt;/p&gt;</comment>
                            <comment id="13819486" author="v.koroghlishvili" created="Mon, 11 Nov 2013 22:08:11 +0000"  >&lt;p&gt;Do you mean changes of direct arrays into indirect? PDFbox creates that structure. How can we fix that problem, what do you think?&lt;/p&gt;</comment>
                            <comment id="13819854" author="tilman" created="Tue, 12 Nov 2013 05:51:16 +0000"  >&lt;p&gt;The problem is with the DecimalFormat in java, used in COSFloat.writePDF(). This code&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; num = 0.9505f;
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.format(&lt;span class=&quot;code-quote&quot;&gt;&quot;%f&quot;&lt;/span&gt;, num));
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println (((&lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;) num).toString());
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println (formatDecimal.format(num));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;brings this output:&lt;/p&gt;

&lt;p&gt;0,950500&lt;br/&gt;
0.9505&lt;br/&gt;
0.9505000114&lt;/p&gt;

&lt;p&gt;There is a test for writePDF, but it just compares the decimal representation instead of the value.&lt;/p&gt;

&lt;p&gt;Oh, and converting 0.9505 to a double gets 0.9505000114440918.&lt;/p&gt;</comment>
                            <comment id="13819880" author="tilman" created="Tue, 12 Nov 2013 06:36:43 +0000"  >&lt;p&gt;The solution will probably be to keep the number internally as BigDecimal instead of as a float:&lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/questions/916081/convert-float-to-double-without-losing-precision&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/916081/convert-float-to-double-without-losing-precision&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://piotrnowicki.com/2011/02/float-and-double-in-java-inaccurate-result/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://piotrnowicki.com/2011/02/float-and-double-in-java-inaccurate-result/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13819933" author="v.koroghlishvili" created="Tue, 12 Nov 2013 09:06:11 +0000"  >&lt;p&gt;I solve rounding problem, but I have the same problem - when we try to sign the pdf documen with PDFbox, previous revision is damaged (firs revision was created by another software).&lt;br/&gt;
The structural changes probably are caused by the quirk of PDFBox to force its preference of which kinds of objects should be direct or indirect onto existing objects it touches.  &lt;/p&gt;</comment>
                            <comment id="13819945" author="mkl" created="Tue, 12 Nov 2013 09:25:12 +0000"  >&lt;p&gt;In general, for the sake of accuracy, switching to BigDecimals would be a good step.&lt;/p&gt;

&lt;p&gt;When editing existing documents with signatures being part of the game, though, edited PDF object representations should remain &lt;em&gt;exactly&lt;/em&gt; as before, including e.g. the number of leading and trailing &apos;0&apos;s etc.&lt;/p&gt;

&lt;p&gt;Thus, for the purpose of editing in such situations one might even want to carry along (a copy of) the original representation of the object. For general editing, though, that might be a considered too big a burden on resources.&lt;/p&gt;

&lt;p&gt;As mentioned in my answer on stackoverflow leading to this issue (&lt;a href=&quot;http://stackoverflow.com/questions/19903884/pdf-document-is-modified-by-another-revision/19905271#19905271&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/19903884/pdf-document-is-modified-by-another-revision/19905271#19905271&lt;/a&gt;), it remains to be tested how exact an edited version of a signed document has to reflect the original in objects it touches.&lt;/p&gt;</comment>
                            <comment id="13819948" author="tilman" created="Tue, 12 Nov 2013 09:26:05 +0000"  >&lt;p&gt;&quot;I solve rounding problem&quot;: does this sentence mean that you did solve the problem (then please post your patch), or that you are planning to solve the problem in the future (then please do also post the patch when done). IMHO the rounding issue should be solved first (especially considering that it is the title of this issue).&lt;/p&gt;</comment>
                            <comment id="13820214" author="v.koroghlishvili" created="Tue, 12 Nov 2013 16:04:40 +0000"  >&lt;p&gt;Michael Klink&lt;br/&gt;
I have already fixed that problem , in the apache pdfbox core libs (which made structural changes) and now everything works great.Thank you, my friend &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; It was caused because  - indirect/direct references was changed. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  I will attach that patch&lt;/p&gt;
</comment>
                            <comment id="13822653" author="lehmi" created="Thu, 14 Nov 2013 17:37:36 +0000"  >&lt;p&gt;I fixed this issue in revision 1541989. I simply limited the number of fractional digits to 5 as mentioned by Martin Schr&#246;der&lt;/p&gt;

&lt;p&gt;Thanks to all for the input!&lt;/p&gt;</comment>
                            <comment id="13823482" author="mkl" created="Fri, 15 Nov 2013 08:44:23 +0000"  >&lt;p&gt;I don&apos;t think this resolution fixes anything.&lt;/p&gt;

&lt;p&gt;Consider the attached PDF  extreme-values.png which Acrobat Reader XI displays as two pages with numerous concentric rings:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12614037/12614037_extreme-values.png&quot; width=&quot;100%&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Trying to prepend red color setting tokens before the page content stream tokens of this PDF using this code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        PDDocument doc ;
        doc = PDDocument.load(source);
        List pages = doc.getDocumentCatalog().getAllPages();  
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; pages.size(); i++)  {
            PDPage page = (PDPage) pages.get(i);  
            PDStream contents = page.getContents();  
            PDFStreamParser parser = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFStreamParser(contents.getStream()); 
            parser.parse();
            List tokens = parser.getTokens();

            tokens.add(0, COSInteger.get(1));
            tokens.add(1, COSInteger.get(0));
            tokens.add(2, COSInteger.get(0));
            tokens.add(3, PDFOperator.getOperator(&lt;span class=&quot;code-quote&quot;&gt;&quot;rg&quot;&lt;/span&gt;));

            PDStream updatedStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDStream(doc);  
            OutputStream out = updatedStream.createOutputStream();  
            ContentStreamWriter tokenWriter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ContentStreamWriter(out);
            tokenWriter.writeTokens(tokens);  
            page.setContents(updatedStream);
        }
        doc.save(target); 
        doc.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with the current 2.0.0-SNAPSHOT results in the (also attached) PDF extreme-values-red.pdf which does not at all represent the original in red:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12614039/12614039_extreme-values-red.png&quot; width=&quot;100%&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;The reason is simple, I used somewhat extreme values for coordinates and coordinate transformations in the sample PDF:&lt;/p&gt;

&lt;p&gt;The first page uses small numbers in the transformation matrix and large coordinate values:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;0.000001 0 0 0.000001 0 0 cm
10000000 0 m
10000000 5522999.6 5522999.6 10000000 0 10000000 c
-5522999.6 10000000 -10000000 5522999.6 -10000000 0 c
-10000000 -5522999.6 -5522999.6 -10000000 0 -10000000 c
5522999.6 -10000000 10000000 -5522999.6 10000000 0 c
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here the result PDF sets a null transformation matrix:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 0 0 0 0 0 0 cm
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This obviously collapses all the rings.&lt;/p&gt;

&lt;p&gt;The first page uses large numbers in the transformation matrix and small coordinate values:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;10000000 0 0 10000000 0 0 cm
0.000001 0 m
0.000001 0.0000005523 0.0000005523 0.000001 0 0.000001 c
-0.0000005523 0.000001 -0.000001 0.0000005523 -0.000001 0 c
-0.000001 -0.0000005523 -0.0000005523 -0.000001 0 -0.000001 c
0.0000005523 -0.000001 0.000001 -0.0000005523 0.000001 0 c
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here the result wreaks havoc among the coordinates, many set to 0, many others collapsed to the same value...&lt;/p&gt;

&lt;p&gt;While the sample certainly is somewhat extreme, I don&apos;t think it invalid.&lt;/p&gt;

&lt;p&gt;PS Yes, the spec (ISO 32000-1, Annex C) mentions 5 as the &quot;Number of significant decimal digits of precision in fractional part&quot;, it also mentions  &#177; 1.175 &#215; 10^(-38) as &quot;Nonzero real values closest to 0&quot;. Thus, the 5 above obviously has to be interpreted in relation to this normalized number representation, not the PDF number style. In PDF number this means that after the first non-0 digit the exact value of only the following 5 digits counts, not after the decimal point.&lt;/p&gt;

&lt;p&gt;PPS: Using 1.8.2, the result looks as expected&lt;/p&gt;</comment>
                            <comment id="13823490" author="lehmi" created="Fri, 15 Nov 2013 09:00:21 +0000"  >&lt;p&gt;Sounds reasonable, we have to write our own formater -&amp;gt; reopened.&lt;/p&gt;

&lt;p&gt;Thanks for the veto and the sample pdf.&lt;/p&gt;</comment>
                            <comment id="13823526" author="tilman" created="Fri, 15 Nov 2013 10:17:49 +0000"  >&lt;p&gt;There&apos;s an easy solution for writePDF.writePDF(), replace&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;output.write(formatDecimal.format( value ).getBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;ISO-8859-1&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;with&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;output.write(formatDecimal.format(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(value))).getBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;ISO-8859-1&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and of course set back the MaximumFractionDigits to 10.&lt;/p&gt;

&lt;p&gt;This test shows the difference:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        DecimalFormat formatDecimal = (DecimalFormat)NumberFormat.getNumberInstance();
        formatDecimal.setMaximumFractionDigits( 10 );
        formatDecimal.setGroupingUsed( &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; );
        DecimalFormatSymbols symbols = formatDecimal.getDecimalFormatSymbols();
        symbols.setDecimalSeparator( &lt;span class=&quot;code-quote&quot;&gt;&apos;.&apos;&lt;/span&gt; );
        formatDecimal.setDecimalFormatSymbols( symbols );
        
        &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; value = 0.9505f;
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println (formatDecimal.format(value)); &lt;span class=&quot;code-comment&quot;&gt;//not so good
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println (formatDecimal.format(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(value)))); &lt;span class=&quot;code-comment&quot;&gt;//good&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The output is&lt;/p&gt;

&lt;p&gt;0.9505000114&lt;br/&gt;
0.9505&lt;/p&gt;

&lt;p&gt;Due to lack of time I didn&apos;t test Michaels example.&lt;/p&gt;</comment>
                            <comment id="13823546" author="mkl" created="Fri, 15 Nov 2013 11:00:34 +0000"  >&lt;p&gt;As the spec mentions floats down to 1.175 &#215; 10^(-38), setting the maximum digits to 10 (as in Tilman&apos;s code) does not suffice. But in combination with BigDecimals, it can be set way higher:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        DecimalFormat formatDecimal = (DecimalFormat)NumberFormat.getNumberInstance();
        formatDecimal.setMaximumFractionDigits( 300 );
        formatDecimal.setGroupingUsed( &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; );
        DecimalFormatSymbols symbols = formatDecimal.getDecimalFormatSymbols();
        symbols.setDecimalSeparator( &lt;span class=&quot;code-quote&quot;&gt;&apos;.&apos;&lt;/span&gt; );
        formatDecimal.setDecimalFormatSymbols( symbols );

        &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;[] testFloats = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;[] {
                1000000f,
                1000f,
                1f,
                0.001f,
                0.000001f,
                0.000000001f,
                0.000000000001f,
                0.000000000000001f,
                0.000000000000000001f,
                0.000000000000000000001f,
                0.000000000000000000000001f,
                0.000000000000000000000000001f,
                0.000000000000000000000000000001f,
                0.000000000000000000000000000000001f,
                0.000000000000000000000000000000000001f,
                0.000000000000000000000000000000000000001f
        };

        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; f : testFloats)
        {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println (f);
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println (formatDecimal.format(f));
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println (formatDecimal.format(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(f))));
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println();
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;results in &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;1000000.0
1000000
1000000

1000.0
1000
1000

[...]

1.0E-33
0.000000000000000000000000000000001000000023742228
0.000000000000000000000000000000001

1.0E-36
0.0000000000000000000000000000000000010000000359391298
0.000000000000000000000000000000000001

1.0E-39
0.0000000000000000000000000000000000000010000002153053333
0.000000000000000000000000000000000000001
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The main disadvantage:being that first executing toString, then building a BigDecimal, then formatting that object and throwing it away is quite a bad resource abuse.&lt;/p&gt;

&lt;p&gt;PS: Is there a need why the DecimalFormat is created anew each time? Ok, decimal formats are generally not synchronized, but external synchronization or ThreadLocal use would suffice...&lt;/p&gt;</comment>
                            <comment id="13823591" author="lehmi" created="Fri, 15 Nov 2013 12:10:48 +0000"  >&lt;p&gt;IMHO the easiest solution is to change the internal representation of the float to BigDecimal. Additionally we should save the value as string as well, so that we don&apos;t have to do the conversion anymore.&lt;/p&gt;</comment>
                            <comment id="13824629" author="tilman" created="Sat, 16 Nov 2013 21:06:25 +0000"  >&lt;p&gt;Per TDD ideology (which I like), one should first write a test that fails, and it should also fail with the previous version, that had 10 fraction digits. I added this to testAccept() and testWritePDF() before the testByteArrays() lines:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;useful text message&quot;&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Float&lt;/span&gt;.toString(cosFloat.floatValue()), outStream.toString(&lt;span class=&quot;code-quote&quot;&gt;&quot;ISO-8859-1&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13824923" author="lehmi" created="Sun, 17 Nov 2013 18:29:32 +0000"  >&lt;p&gt;I changed the internal representation to a BgiDecimal and the value is saved as String as well. I adjusted the test cases and added Tilmans test case as well.&lt;/p&gt;

&lt;p&gt;After my changes Michaels issue with the pdf containing some extreme values no longer exists.&lt;/p&gt;

&lt;p&gt;I applied the changes in revision 1542780.&lt;/p&gt;

&lt;p&gt;Thanks for all the input!&lt;/p&gt;</comment>
                            <comment id="13824927" author="lehmi" created="Sun, 17 Nov 2013 18:34:36 +0000"  >&lt;p&gt;I merged the changes to the 1.8 branch in revision 1542789&lt;/p&gt;</comment>
                            <comment id="13828901" author="mkl" created="Thu, 21 Nov 2013 13:11:52 +0000"  >&lt;p&gt;The constructor with a float argument will cause failures in case of extreme values:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; COSFloat( &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; aFloat )
    {
        valueAsString = &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(aFloat);
        value = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(valueAsString);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;E.g. a &lt;tt&gt;new COSFloat(0.000000000000000000000000000000001f)&lt;/tt&gt; will be serialized as &lt;tt&gt;1.0E-33&lt;/tt&gt; which is not desired.&lt;/p&gt;

&lt;p&gt;I would propose&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; COSFloat( &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; aFloat )
    {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BigDecimal(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(aFloat)));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;instead.&lt;/p&gt;

&lt;p&gt;Or do we even have to use some &lt;tt&gt;DecimalFormat&lt;/tt&gt; in case of the &lt;tt&gt;BigInteger&lt;/tt&gt; argument constructor?&lt;/p&gt;</comment>
                            <comment id="13830660" author="lehmi" created="Sat, 23 Nov 2013 13:31:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkl&quot; class=&quot;user-hover&quot; rel=&quot;mkl&quot;&gt;mkl&lt;/a&gt;&lt;br/&gt;
You are right again, but your proposal does exactly the some as the existing code. I added a fix in revision 1544789. We are now using BigDecimal#toPlainString to serialize the BigDecimal to a string. I upgraded the unit-test as well to cover that corner case.&lt;/p&gt;

&lt;p&gt;Thanks again for testing in depth.&lt;/p&gt;</comment>
                            <comment id="13830662" author="lehmi" created="Sat, 23 Nov 2013 13:37:41 +0000"  >&lt;p&gt;I merged the changes to the 1.8 branch in revision 1544791&lt;/p&gt;</comment>
                            <comment id="13835805" author="lehmi" created="Sat, 30 Nov 2013 17:02:10 +0000"  >&lt;p&gt;Closed after releasing 1.8.3&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12614038" name="extreme-values-red.pdf" size="21902" author="mkl" created="Fri, 15 Nov 2013 08:44:23 +0000"/>
                            <attachment id="12614039" name="extreme-values-red.png" size="104794" author="mkl" created="Fri, 15 Nov 2013 08:44:23 +0000"/>
                            <attachment id="12614036" name="extreme-values.pdf" size="4565" author="mkl" created="Fri, 15 Nov 2013 08:44:23 +0000"/>
                            <attachment id="12614037" name="extreme-values.png" size="223616" author="mkl" created="Fri, 15 Nov 2013 08:44:23 +0000"/>
                            <attachment id="12613179" name="original.pdf" size="3151" author="v.koroghlishvili" created="Mon, 11 Nov 2013 17:06:44 +0000"/>
                            <attachment id="12613180" name="saved.pdf" size="3117" author="v.koroghlishvili" created="Mon, 11 Nov 2013 17:06:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357971</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 51 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ppkn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>358261</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>