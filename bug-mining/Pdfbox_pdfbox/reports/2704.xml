<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:13:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5430] PDFStreamEngine.showTextStrings with font switch</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5430</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The attached PDF fails to render with an PDFStreamEngine.showTextStrings with the following exception:&lt;br/&gt;
&quot;java.io.IOException: Unknown type COSName in array for TJ operation:COSName{F3}&quot;&lt;/p&gt;

&lt;p&gt;This seems to be a font switch.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git &lt;span class=&quot;code-quote&quot;&gt;&quot;a/pdfbox/src/main/java/org/apache/pdfbox/contentstream/PDFStreamEngine.java&quot;&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;b/pdfbox/src/main/java/org/apache/pdfbox/contentstream/PDFStreamEngine.java&quot;&lt;/span&gt;
index e4f2259a5..12edadd2b 100644
--- &lt;span class=&quot;code-quote&quot;&gt;&quot;a/pdfbox/src/main/java/org/apache/pdfbox/contentstream/PDFStreamEngine.java&quot;&lt;/span&gt;
+++ &lt;span class=&quot;code-quote&quot;&gt;&quot;b/pdfbox/src/main/java/org/apache/pdfbox/contentstream/PDFStreamEngine.java&quot;&lt;/span&gt;
@@ -680,6 +680,18 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PDFStreamEngine
                 &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] string = ((COSString)obj).getBytes();
                 showText(string);
             }
+            &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (obj &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; COSName)
+            {
+                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(((COSName) obj).getName().startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;F&quot;&lt;/span&gt;))
+                {
+                    textState.setFont(resources.getFont((COSName) obj));
+                }
+                &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
+                {
+                    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unknown type &quot;&lt;/span&gt; + obj.getClass().getSimpleName()
+                            + &lt;span class=&quot;code-quote&quot;&gt;&quot; in array &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; TJ operation:&quot;&lt;/span&gt; + obj);
+                }
+            }
             &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (obj &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; COSArray)
             {
                 LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Nested arrays are not allowed in an array &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; TJ operation:&quot;&lt;/span&gt; + obj);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13443658">PDFBOX-5430</key>
            <summary>PDFStreamEngine.showTextStrings with font switch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="Schmidor">Oliver Schmidtmer</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 May 2022 14:46:40 +0000</created>
                <updated>Thu, 29 Sep 2022 17:57:15 +0000</updated>
                            <resolved>Sat, 7 May 2022 13:13:39 +0000</resolved>
                                    <version>2.0.26</version>
                                    <fixVersion>2.0.27</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Parsing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17532930" author="lehmi" created="Fri, 6 May 2022 15:38:27 +0000"  >&lt;p&gt;I guess you are referring to things like this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 [ /F3 8 (Monatliche Kosten  ) /F1 8 0 -11 ] TJ
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Maybe I&apos;m missing something, but the TJ operator doesn&apos;t define a font switch. It is simply malformed.&lt;/p&gt;
</comment>
                            <comment id="17532948" author="schmidor" created="Fri, 6 May 2022 15:57:32 +0000"  >&lt;p&gt;I can&apos;t say how the internal structure should be.&lt;/p&gt;

&lt;p&gt;But from testing, just ignoring the COSName objects lets me render the PDF, but with some texts in a normal weight font instead of a bold font as in Acrobat.&lt;/p&gt;

&lt;p&gt;Using the COSName for setting a font, it is displayed as in Actobat.&lt;/p&gt;</comment>
                            <comment id="17532952" author="tilman" created="Fri, 6 May 2022 16:06:51 +0000"  >&lt;p&gt;Your patch suggestion is a workaround for that file only. A better solution would be to log the error instead of throwing an exception. But this is really a terrible file.&lt;/p&gt;</comment>
                            <comment id="17532972" author="schmidor" created="Fri, 6 May 2022 16:37:34 +0000"  >&lt;p&gt;Just logging istead of throwing would at least help to display the file.&lt;/p&gt;</comment>
                            <comment id="17533182" author="jira-bot" created="Sat, 7 May 2022 03:58:08 +0000"  >&lt;p&gt;Commit 1900638 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1900638&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1900638&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5430&quot; title=&quot;PDFStreamEngine.showTextStrings with font switch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5430&quot;&gt;&lt;del&gt;PDFBOX-5430&lt;/del&gt;&lt;/a&gt;: don&apos;t throw, log error instead so that file can be rendered&lt;/p&gt;</comment>
                            <comment id="17533183" author="jira-bot" created="Sat, 7 May 2022 03:58:12 +0000"  >&lt;p&gt;Commit 1900639 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1900639&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1900639&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5430&quot; title=&quot;PDFStreamEngine.showTextStrings with font switch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5430&quot;&gt;&lt;del&gt;PDFBOX-5430&lt;/del&gt;&lt;/a&gt;: don&apos;t throw, log error instead so that file can be rendered&lt;/p&gt;</comment>
                            <comment id="17533196" author="jira-bot" created="Sat, 7 May 2022 05:49:04 +0000"  >&lt;p&gt;Commit 1900641 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1900641&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1900641&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5430&quot; title=&quot;PDFStreamEngine.showTextStrings with font switch&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5430&quot;&gt;&lt;del&gt;PDFBOX-5430&lt;/del&gt;&lt;/a&gt;: remove typo&lt;/p&gt;</comment>
                            <comment id="17533228" author="lehmi" created="Sat, 7 May 2022 08:44:41 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Using the COSName for setting a font, it is displayed as in Actobat.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sounds like a &quot;hidden feature&quot;. It is not in the spec but maybe in some addendum? BTW, looks like the pdf was created using Adobe Illustrator&lt;/p&gt;</comment>
                            <comment id="17533258" author="tilman" created="Sat, 7 May 2022 12:42:11 +0000"  >&lt;p&gt;Yes but this is weird - this is an invoice. Why would anybody do this with Adobe Illustrator?&lt;br/&gt;
My guess is that the invoice template was created with AI, and then the invoice data was added by some buggy billing software.&lt;br/&gt;
This is the raw 4th content stream (formatting like this in the original):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;BT
64 477 Td
[/F3 8 Tf
(Monatliche Kosten  ) Tj
/F1 8 Tf
0 -11 Td
] TJ
ET
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the correct content stream would have been&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;BT
64 477 Td
/F3 8 Tf
(Monatliche Kosten  ) Tj
/F1 8 Tf
0 -11 Td
ET
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17533262" author="tilman" created="Sat, 7 May 2022 13:13:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Schmidor&quot; class=&quot;user-hover&quot; rel=&quot;Schmidor&quot;&gt;Schmidor&lt;/a&gt; If possible, tell your client (likely P. M. GmbH) to contact their vendor (N. GmbH) to send this issue to the company that does their billing software.&lt;/p&gt;</comment>
                            <comment id="17533452" author="mkl" created="Sun, 8 May 2022 12:18:33 +0000"  >&lt;p&gt;Indeed, this content stream simply is broken. As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; has shown, a number of instructions therein have - incorrectly! - been made the contents of the array argument of a &lt;b&gt;TJ&lt;/b&gt; instruction.&lt;/p&gt;

&lt;p&gt;Adobe Acrobat apparently ignores that the instructions are so enclosed and acts as if there was no &lt;b&gt;[&lt;/b&gt; or &lt;b&gt;] TJ&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;Other viewers might simply ignore (or treat as strings) everything that is neither string nor number in the array.&lt;/p&gt;

&lt;p&gt;In case of content that matters (as invoice content does), this might lead completely different appearances if viewed with different viewers. Thus, PDFBox should definitively throw an exception here and not repair it one way or the other.&lt;/p&gt;</comment>
                            <comment id="17533921" author="tilman" created="Mon, 9 May 2022 17:27:45 +0000"  >&lt;p&gt;Yeah we should refuse all these weird files, but the problem is that users always have the winning argument &quot;but it renders on Adobe Reader!&quot;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13043335" name="keine Vorschau ELO-1228188_20220228_11462_HD_online.pdf" size="133453" author="Schmidor" created="Fri, 6 May 2022 14:39:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1254w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>