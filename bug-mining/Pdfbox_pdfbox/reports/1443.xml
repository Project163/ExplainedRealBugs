<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:03:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3280] PDDocument.importPage does not deep clone source page</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3280</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The method PDDocument.importPage does not deep clone the source page. This causes two issues, when closing the source document BEFORE saving the target document throws an already closed exception.&lt;/p&gt;

&lt;p&gt;Placing the close after saving the target document works fine. But... When splitting a document into a lot of small documents and than save that documents multithreaded will cause random exceptions like ArrayIndexOutOfBounds, COSStream closed etc.&lt;/p&gt;

&lt;p&gt;Check for example the following code. I attach the used source document.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Test.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        PDDocument doc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDDocument();
        PDDocument load = PDDocument.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(SOURCE_DOC));

        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; p = 0; p&amp;lt;1000; p++) {
            doc.importPage(load.getPage(0));
        }

        ByteArrayOutputStream baos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream();
        doc.save(baos);
        doc.close();
        load.close();

        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PDDocument doc2 = PDDocument.load(baos.toByteArray());
&lt;span class=&quot;code-comment&quot;&gt;// ok, now we have a big document loaded as it normally will be loaded.
&lt;/span&gt;        ExecutorService es = Executors.newFixedThreadPool(4);

        List&amp;lt;PDDocument&amp;gt; docs = Lists.newArrayList();
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; p = 0; p&amp;lt;doc2.getNumberOfPages(); p++) {
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PDDocument newDoc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDDocument();
            newDoc.importPage(doc2.getPage(p));
            docs.add(newDoc);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; p = 0; p&amp;lt;doc2.getNumberOfPages(); p++) {
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; page = p;
            es.submit(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;() {
                @Override
                &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run() {
                    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                        PDDocument newDoc = docs.get(page);
                        newDoc.save(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream());
                        newDoc.close();
                    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
                        e.printStackTrace();
                    }
                }
            });

        }
        es.shutdown();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</description>
                <environment></environment>
        <key id="12952105">PDFBOX-3280</key>
            <summary>PDDocument.importPage does not deep clone source page</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="c.hoeflake">Cornelis Hoeflake</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Mar 2016 17:25:22 +0000</created>
                <updated>Sun, 4 Nov 2018 10:10:49 +0000</updated>
                                            <version>2.0.0</version>
                    <version>2.0.1</version>
                    <version>2.0.2</version>
                    <version>3.0.0 PDFBox</version>
                                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15204678" author="c.hoeflake" created="Mon, 21 Mar 2016 17:26:03 +0000"  >&lt;p&gt;used source document&lt;/p&gt;</comment>
                            <comment id="15204687" author="c.hoeflake" created="Mon, 21 Mar 2016 17:29:14 +0000"  >&lt;p&gt;Using this construction in PDDocument.importPage fixes the issue.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;COSBase pageBase = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFCloneUtility(currentDocument).cloneForNewDocument(page.getCOSObject());
PDPage imported = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPage(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; COSDictionary((COSDictionary) pageBase), resourceCache);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15258861" author="tilman" created="Tue, 26 Apr 2016 20:31:35 +0000"  >&lt;p&gt;I had the same idea (or maybe remembered yours?) in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3328&quot; title=&quot;&amp;quot;COSStream has been closed and cannot be read&amp;quot; despite using importPage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3328&quot;&gt;&lt;del&gt;PDFBOX-3328&lt;/del&gt;&lt;/a&gt;. However I&apos;ll have to make &lt;tt&gt;PDFCloneUtility&lt;/tt&gt; public to use it. It was made non public in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2680&quot; title=&quot;Move multi-pdf classes from util into their own package&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2680&quot;&gt;&lt;del&gt;PDFBOX-2680&lt;/del&gt;&lt;/a&gt;. I&apos;ll wait a bit for other ideas.&lt;/p&gt;</comment>
                            <comment id="15259594" author="msahyoun" created="Wed, 27 Apr 2016 05:50:24 +0000"  >&lt;p&gt;+1 for making it public again as a short term solution. If we come up with a better approach (like baking deep copy into the objects themselves) we can deprecate it for 3.0&lt;/p&gt;</comment>
                            <comment id="15259915" author="lehmi" created="Wed, 27 Apr 2016 10:09:51 +0000"  >&lt;p&gt;+1, I agree with both of you&lt;/p&gt;</comment>
                            <comment id="15259928" author="c.hoeflake" created="Wed, 27 Apr 2016 10:17:37 +0000"  >&lt;p&gt;I ran with the clone implementation in my private build. That works fine. The only issue is that it is seriously slow compared to the old solution.&lt;/p&gt;</comment>
                            <comment id="15259991" author="msahyoun" created="Wed, 27 Apr 2016 11:26:56 +0000"  >&lt;p&gt;what was the old solution you are referring to?&lt;/p&gt;</comment>
                            <comment id="15259994" author="tilman" created="Wed, 27 Apr 2016 11:31:34 +0000"  >&lt;p&gt;I think he means the way it is now. I&apos;m not surprised that doing a deep copy is slower. I&apos;ll mention this in the javadoc.&lt;/p&gt;</comment>
                            <comment id="15259995" author="c.hoeflake" created="Wed, 27 Apr 2016 11:31:41 +0000"  >&lt;p&gt;Sorry, I mean current implementation.&lt;/p&gt;</comment>
                            <comment id="15259999" author="lehmi" created="Wed, 27 Apr 2016 11:36:06 +0000"  >&lt;p&gt;I expect an increased memory footprint as well when doing a deep clone&lt;/p&gt;</comment>
                            <comment id="15260419" author="jira-bot" created="Wed, 27 Apr 2016 16:22:53 +0000"  >&lt;p&gt;Commit 1741284 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1741284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1741284&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: make class public again, to allow cloning in importPage()&lt;/p&gt;</comment>
                            <comment id="15260420" author="jira-bot" created="Wed, 27 Apr 2016 16:23:23 +0000"  >&lt;p&gt;Commit 1741286 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1741286&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1741286&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: make class public again, to allow cloning in importPage()&lt;/p&gt;</comment>
                            <comment id="15260526" author="jira-bot" created="Wed, 27 Apr 2016 17:22:54 +0000"  >&lt;p&gt;Commit 1741292 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1741292&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1741292&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: create a test that fails&lt;/p&gt;</comment>
                            <comment id="15260527" author="jira-bot" created="Wed, 27 Apr 2016 17:23:44 +0000"  >&lt;p&gt;Commit 1741293 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1741293&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1741293&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: create a test that fails&lt;/p&gt;</comment>
                            <comment id="15260538" author="jira-bot" created="Wed, 27 Apr 2016 17:29:16 +0000"  >&lt;p&gt;Commit 1741294 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1741294&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1741294&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: do a deep clone, as suggested by Cornelis Hoeflake&lt;/p&gt;</comment>
                            <comment id="15260539" author="jira-bot" created="Wed, 27 Apr 2016 17:29:34 +0000"  >&lt;p&gt;Commit 1741295 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1741295&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1741295&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: do a deep clone, as suggested by Cornelis Hoeflake&lt;/p&gt;</comment>
                            <comment id="15260549" author="tilman" created="Wed, 27 Apr 2016 17:32:16 +0000"  >&lt;p&gt;I&apos;ve removed the part about copying the content stream. If my understanding is correct, that is already done by doing the cloning. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=c.hoeflake&quot; class=&quot;user-hover&quot; rel=&quot;c.hoeflake&quot;&gt;c.hoeflake&lt;/a&gt; please test your application with the change as it is now.&lt;/p&gt;</comment>
                            <comment id="15260762" author="jira-bot" created="Wed, 27 Apr 2016 19:09:57 +0000"  >&lt;p&gt;Commit 1741316 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1741316&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1741316&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: improve test with rendering comparison&lt;/p&gt;</comment>
                            <comment id="15260763" author="jira-bot" created="Wed, 27 Apr 2016 19:10:03 +0000"  >&lt;p&gt;Commit 1741317 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1741317&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1741317&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: improve test with rendering comparison&lt;/p&gt;</comment>
                            <comment id="15338493" author="jira-bot" created="Sun, 19 Jun 2016 11:53:47 +0000"  >&lt;p&gt;Commit 1749155 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1749155&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1749155&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: revert 1741295 because it resulted in split creating huge files&lt;/p&gt;</comment>
                            <comment id="15338495" author="jira-bot" created="Sun, 19 Jun 2016 11:55:25 +0000"  >&lt;p&gt;Commit 1749156 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1749156&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1749156&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: remove test due to revert in 1741295&lt;/p&gt;</comment>
                            <comment id="15338497" author="jira-bot" created="Sun, 19 Jun 2016 11:57:28 +0000"  >&lt;p&gt;Commit 1749157 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1749157&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1749157&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: revert 1741294 because it resulted in split creating huge files&lt;/p&gt;</comment>
                            <comment id="15338498" author="jira-bot" created="Sun, 19 Jun 2016 11:59:14 +0000"  >&lt;p&gt;Commit 1749158 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1749158&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1749158&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: remove test due to revert of 1741294&lt;/p&gt;</comment>
                            <comment id="15338501" author="tilman" created="Sun, 19 Jun 2016 12:11:10 +0000"  >&lt;p&gt;I have now reverted most of the changes due to split creating huge files and per the short discussion in the dev list&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;rev 1741295 in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt; (deep clone) was a bad decision related to splitting, or related to creating new documents from existing documents. What should be done now?&lt;/p&gt;

&lt;p&gt;my thought:&lt;/p&gt;

&lt;p&gt;1) revert the change per this logic (ignore the insults)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://article.gmane.org/gmane.linux.kernel/1369384&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://article.gmane.org/gmane.linux.kernel/1369384&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;2) create a third method additional to addPage and importPage, e.g. importPageClone, that does what importPage does now.&lt;/p&gt;

&lt;p&gt;The alternative would be to fix the splitter so that it does what importPage did in the past.&lt;/p&gt;

&lt;p&gt;However I think it is better to revert the mess, instead of correcting the mess. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Maruan agreed with (1) and John mentioned&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The original JIRA issue isn&#8217;t valid. The whole point is that the source PDF &lt;b&gt;should&lt;/b&gt; be kept open - we need to read from it. And multi-threaded writing isn&#8217;t supported, so no surprise there.&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="15586359" author="ronslow" created="Tue, 18 Oct 2016 19:05:02 +0000"  >&lt;p&gt;Using this code on the previously attached pdf generates thepreviously  attached output test.pdf with blank pages, which I suspect is related to the problem of deep cloning&lt;/p&gt;

&lt;p&gt;try{&lt;br/&gt;
		PDDocument doc = PDDocument.load(new File(&quot;023_CASEROOM-BROCHURE.PDF&quot;));&lt;br/&gt;
		//PDPage page = doc.getPage(0);&lt;br/&gt;
		PDDocument doc1 = new PDDocument();&lt;br/&gt;
		for (int i = 0; i &amp;lt; doc.getNumberOfPages(); i++) &lt;/p&gt;
{
			PDPage page = doc.getPage(i);
			doc1.importPage(page);
		}
&lt;p&gt;		doc1.save(&quot;test.pdf&quot;);&lt;br/&gt;
		doc1.close();&lt;br/&gt;
		doc.close();&lt;/p&gt;

&lt;p&gt;	} catch (Exception x) &lt;/p&gt;
{throw new RuntimeException(x);}

&lt;p&gt;Robert&lt;/p&gt;</comment>
                            <comment id="15589155" author="tilman" created="Wed, 19 Oct 2016 16:21:15 +0000"  >&lt;p&gt;After looking at this for the first time in several months, I think the problem can be solved in a different way, and the log output (done in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3428&quot; title=&quot;Objects inherited from its parents are lost in PDFBox while copying&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3428&quot;&gt;PDFBOX-3428&lt;/a&gt;) tells how:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;inherited resources of source document are not imported to destination page&lt;br/&gt;
call importedPage.setResources(page.getResources()) to do this&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Because your PDF has global resources.&lt;/p&gt;

&lt;p&gt;So all you&apos;d have to do is this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;PDPage importedPage = doc1.importPage(page);
importedPage.setResources(page.getResources());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I&apos;m thinking of adding this at the end of importPage()...&lt;/p&gt;</comment>
                            <comment id="15589268" author="ronslow" created="Wed, 19 Oct 2016 17:04:40 +0000"  >&lt;p&gt;Thanks, Tilman. That&apos;s great.&lt;/p&gt;

&lt;p&gt;Is it possible to somehow flush the resources to the new page/new document rather than simply set the reference to the resources in the way that you suggest?&lt;/p&gt;

&lt;p&gt;In my application I am merging pdfs, closing each source pdf after having imported its pages into the target pdf. Naturally, on the final save of the target document I get:&lt;/p&gt;

&lt;p&gt;java.io.IOException: COSStream has been closed and cannot be read. Perhaps its enclosing PDDocument has been closed?&lt;/p&gt;

&lt;p&gt;which is logical because all source pdfs have indeed been closed.&lt;/p&gt;

&lt;p&gt;I would prefer not to have to maintain all of the source pdfs open in memory.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;

&lt;p&gt;Robert&lt;/p&gt;</comment>
                            <comment id="15589296" author="tilman" created="Wed, 19 Oct 2016 17:17:34 +0000"  >&lt;p&gt;No, it&apos;s not possible with the 2.0.* versions.&lt;/p&gt;</comment>
                            <comment id="16495531" author="jira-bot" created="Wed, 30 May 2018 18:22:11 +0000"  >&lt;p&gt;Commit 1832560 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1832560&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1832560&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: improve javadoc, ordinary users should not use this class, see &lt;a href=&quot;https://stackoverflow.com/questions/50593597/pdfbox-clone-font&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/50593597/pdfbox-clone-font&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16495533" author="jira-bot" created="Wed, 30 May 2018 18:22:54 +0000"  >&lt;p&gt;Commit 1832561 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1832561&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1832561&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: make class package local again, see &lt;a href=&quot;https://stackoverflow.com/questions/50593597/pdfbox-clone-font&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/50593597/pdfbox-clone-font&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16591869" author="jira-bot" created="Fri, 24 Aug 2018 16:27:42 +0000"  >&lt;p&gt;Commit 1838895 from tilman@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1838895&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1838895&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: remove public modifier of method of non public class&lt;/p&gt;</comment>
                            <comment id="16674362" author="jira-bot" created="Sun, 4 Nov 2018 10:10:44 +0000"  >&lt;p&gt;Commit 1845720 from tilman@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1845720&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1845720&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3428&quot; title=&quot;Objects inherited from its parents are lost in PDFBox while copying&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3428&quot;&gt;PDFBOX-3428&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: format + improve + correct javadoc&lt;/p&gt;</comment>
                            <comment id="16674364" author="jira-bot" created="Sun, 4 Nov 2018 10:10:49 +0000"  >&lt;p&gt;Commit 1845721 from tilman@apache.org in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1845721&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1845721&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3428&quot; title=&quot;Objects inherited from its parents are lost in PDFBox while copying&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3428&quot;&gt;PDFBOX-3428&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;: format + improve + correct javadoc&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12962673">PDFBOX-3328</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12993733">PDFBOX-3443</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12990543">PDFBOX-3428</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12977876">PDFBOX-3380</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12834011" name="023_CASEROOM-BROCHURE.PDF" size="539651" author="ronslow" created="Tue, 18 Oct 2016 19:04:00 +0000"/>
                            <attachment id="12794547" name="1.pdf" size="80773" author="c.hoeflake" created="Mon, 21 Mar 2016 17:26:03 +0000"/>
                            <attachment id="12834012" name="test.pdf" size="3968" author="ronslow" created="Tue, 18 Oct 2016 19:04:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 1 week, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2uyw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>