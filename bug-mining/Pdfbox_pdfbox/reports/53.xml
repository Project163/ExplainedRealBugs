<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:52:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-506] PDFBox can&apos;t parse PDF documents from jstor.org</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-506</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The academic repository JStor makes papers available via PDF format.  The PDFs give this origin information:&lt;br/&gt;
  Content creator:  JstorPdfGenerator v1.0&lt;br/&gt;
  PDF producer:  iText 2.0.6 (by lowagie.com)&lt;/p&gt;

&lt;p&gt;These PDFs open fine in Acrobat, Preview, FoxIt, etc., but they throw an exception in PDFBox:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.io.IOException: Error: Expected to read &apos;%%EOF&apos; instead started reading &apos;1&apos;&lt;br/&gt;
	at org.apache.pdfbox.pdfparser.BaseParser.readExpectedString(BaseParser.java:1005)&lt;br/&gt;
	at org.apache.pdfbox.pdfparser.PDFParser.parseObject(PDFParser.java:456)&lt;br/&gt;
	at org.apache.pdfbox.pdfparser.PDFParser.parse(PDFParser.java:172)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.PDDocument.load(PDDocument.java:739)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.PDDocument.load(PDDocument.java:706)&lt;br/&gt;
	at org.apache.pdfbox.PDFDebugger.parseDocument(PDFDebugger.java:393)&lt;br/&gt;
	at org.apache.pdfbox.PDFDebugger.readPDFFile(PDFDebugger.java:369)&lt;br/&gt;
	at org.apache.pdfbox.PDFDebugger.main(PDFDebugger.java:355)&lt;/p&gt;


&lt;p&gt;I traced through the code, and it appears that PDFBox rejects these because they contain a &apos;startxref&apos; that is not followed by a %%EOF two lines later:&lt;/p&gt;

&lt;p&gt;...&lt;br/&gt;
startxref&lt;br/&gt;
613364&lt;br/&gt;
1 0 obj&lt;br/&gt;
...&lt;/p&gt;


&lt;p&gt;Here&apos;s a small patch that will accept files that are missing the EOF after the startxref:&lt;/p&gt;


&lt;p&gt;Index: src/main/java/org/apache/pdfbox/pdfparser/PDFParser.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; src/main/java/org/apache/pdfbox/pdfparser/PDFParser.java	(revision 802578)&lt;br/&gt;
+++ src/main/java/org/apache/pdfbox/pdfparser/PDFParser.java	(working copy)&lt;br/&gt;
@@ -453,11 +453,9 @@&lt;br/&gt;
             {  &lt;br/&gt;
                 parseStartXref();&lt;br/&gt;
                 //verify that EOF exists &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;String eof = readExpectedString( &quot;%%EOF&quot; );&lt;/li&gt;
	&lt;li&gt;if( eof.indexOf( &quot;%%EOF&quot; )== -1 &amp;amp;&amp;amp; !pdfSource.isEOF() )&lt;/li&gt;
	&lt;li&gt;{&lt;/li&gt;
	&lt;li&gt;throw new IOException( &quot;expected=&apos;%%EOF&apos; actual=&apos;&quot; + eof + &quot;&apos; next=&quot; + readString() +&lt;/li&gt;
	&lt;li&gt;&quot; next=&quot; +readString() );&lt;br/&gt;
+                int c = pdfSource.peek();&lt;br/&gt;
+                if (c == &apos;%&apos;) 
{
+                    readExpectedString(&quot;%%EOF&quot;);
                 }
&lt;p&gt;                 isEndOfFile = true; &lt;br/&gt;
             }&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12433499">PDFBOX-506</key>
            <summary>PDFBox can&apos;t parse PDF documents from jstor.org</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="adamnichols">Adam Nichols</assignee>
                                    <reporter username="engberg">Dave Engberg</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Aug 2009 19:29:03 +0000</created>
                <updated>Tue, 26 Oct 2010 09:33:41 +0000</updated>
                            <resolved>Fri, 27 Aug 2010 16:34:20 +0000</resolved>
                                                    <fixVersion>1.3.1</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12771088" author="lehmi" created="Wed, 28 Oct 2009 20:13:44 +0000"  >&lt;p&gt;I&apos;ve tested your patch and two strange things happened:&lt;/p&gt;

&lt;p&gt;1) If I decompress the pdf first, everything works fine, with and without your patch&lt;/p&gt;

&lt;p&gt;2) If I add your patch, the exception is gone but the first page is missing&lt;/p&gt;
</comment>
                            <comment id="12903165" author="wiley" created="Fri, 27 Aug 2010 00:51:06 +0000"  >&lt;p&gt;I&apos;m also experiencing this problem.  Looking at the code, it appears that PDFBox assumes the existence of one xref table per PDF file.  This won&apos;t necessarily be the case. &lt;br/&gt;
Reading the PDF spec (1.7),  section 7.5.6 describes a situation where multiple updates cause more objects and corresponding xref tables to be appended to the file. &lt;br/&gt;
Each subsequent startxref declaration is also preceeded by a /Prev line, which points to the previous xref table. &lt;/p&gt;

&lt;p&gt;Incremental updates can also contain new versions of already existing objects.&lt;/p&gt;

&lt;p&gt;Looks like it&apos;ll be more than a 5 line patch to fix this issue.&lt;/p&gt;


&lt;p&gt;27/08/2010 10:35:58 AM pdftesting.Main main&lt;br/&gt;
SEVERE: null&lt;br/&gt;
java.io.IOException: Error: Expected to read &apos;%%EOF&apos; instead started reading &apos;1&apos;&lt;br/&gt;
        at org.apache.pdfbox.pdfparser.BaseParser.readExpectedString(BaseParser.java:1090)&lt;br/&gt;
        at org.apache.pdfbox.pdfparser.PDFParser.parseObject(PDFParser.java:463)&lt;br/&gt;
        at org.apache.pdfbox.pdfparser.PDFParser.parse(PDFParser.java:179)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.PDDocument.load(PDDocument.java:859)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.PDDocument.load(PDDocument.java:826)&lt;br/&gt;
        at org.apache.pdfbox.util.PDFMergerUtility.mergeDocuments(PDFMergerUtility.java:191)&lt;br/&gt;
        at pdftesting.Main.main(Main.java:34)&lt;/p&gt;</comment>
                            <comment id="12903355" author="tchojecki" created="Fri, 27 Aug 2010 09:41:15 +0000"  >&lt;p&gt;Wiley Fuller, do you have some example file that you can attach?&lt;/p&gt;

&lt;p&gt;I&apos;m using incremental updates all the time with pdfbox and can&apos;t find any issue with the latest revision (last update a minute ago). &lt;/p&gt;</comment>
                            <comment id="12903364" author="wiley" created="Fri, 27 Aug 2010 11:04:57 +0000"  >&lt;p&gt;Hi Thomas.  The file already attached to this issue (siegel.pdf) can be used to replicate the problem in 1.2.1.   However, I just checked out and built 1.3.0-SNAPSHOT, and it works without any problems. &lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="12903434" author="m.martinez" created="Fri, 27 Aug 2010 14:44:15 +0000"  >&lt;p&gt;This sounds very familiar - wasn&apos;t this fixed a few months back?&lt;/p&gt;

&lt;p&gt;In fact I think I may have suggested a patch for it?   If only I wasn&apos;t going senile and could remember more clearly ...&lt;/p&gt;</comment>
                            <comment id="12903466" author="adamnichols" created="Fri, 27 Aug 2010 16:31:38 +0000"  >&lt;p&gt;I patched a similar issue with corrupt/missing %%EOF flags in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-802&quot; title=&quot;Better handle corrupt/missing %%EOF flags at the end of a file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-802&quot;&gt;&lt;del&gt;PDFBOX-802&lt;/del&gt;&lt;/a&gt;, but that patch doesn&apos;t handle missing %%EOFs in the middle of a file.  I saw it was throwing an exception and decided to keep that functionality as I didn&apos;t think any PDF generators were THAT bad.  I didn&apos;t use the patch provided, but I did update the code to handle this correctly.  I tested by trying to load the document, and then another test using PDFMergerUtility to merge the document with itself to make sure that all the pages were still there.  I also did regression testing with my files which have corrupt EOF flags to confirm they still work correctly.&lt;/p&gt;

&lt;p&gt;On a side note, if you use pdftk to decompress a file, it will also correct a lot of other technical issues in the process.  That&apos;s likely why it worked fine after decompression.&lt;/p&gt;</comment>
                            <comment id="12903468" author="adamnichols" created="Fri, 27 Aug 2010 16:34:20 +0000"  >&lt;p&gt;Committed my patch in revision 990201&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12391345">PDFBOX-311</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12472403">PDFBOX-802</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12417047" name="siegel.pdf" size="680507" author="engberg" created="Wed, 19 Aug 2009 19:29:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163293</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zj3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>205397</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>