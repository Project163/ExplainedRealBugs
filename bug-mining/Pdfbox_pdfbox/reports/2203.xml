<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:09:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4477] Large encrypted file takes days to be parsed</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4477</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;As reported by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slavago&quot; class=&quot;user-hover&quot; rel=&quot;slavago&quot;&gt;slavago&lt;/a&gt; in&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-2832&quot; title=&quot;Very slow large PDF text extraction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-2832&quot;&gt;TIKA-2832&lt;/a&gt;. File is confidential but I have it. Initial findings:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;File is AES256 encrypted with empty user password&lt;/li&gt;
	&lt;li&gt;File has about 1000 objects&lt;/li&gt;
	&lt;li&gt;File is a tagged PDF&lt;/li&gt;
	&lt;li&gt;HashMap in SecurityHandler grows to 100000?!&lt;/li&gt;
	&lt;li&gt;Using an IdentityHashMap speeds up the process dramatically (parsed in a few seconds), and it may also be a better solution that what was done in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4453&quot; title=&quot;Encrypted string not decrypted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4453&quot;&gt;&lt;del&gt;PDFBOX-4453&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Todo:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Read description of IdentityHashMap again&lt;/li&gt;
	&lt;li&gt;Find out why the HashMap grows so much. Could it be that identical objects are stored twice? Or does the file have many direct objects?&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="13218827">PDFBOX-4477</key>
            <summary>Large encrypted file takes days to be parsed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                            <label>optimization</label>
                    </labels>
                <created>Fri, 1 Mar 2019 07:27:52 +0000</created>
                <updated>Fri, 12 Apr 2019 14:39:47 +0000</updated>
                            <resolved>Sat, 2 Mar 2019 11:16:47 +0000</resolved>
                                    <version>2.0.14</version>
                                    <fixVersion>2.0.15</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Crypto</component>
                    <component>Parsing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16781384" author="tilman" created="Fri, 1 Mar 2019 07:33:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;A typical use of this class is topology-preserving object graph transformations, such as serialization or deep-copying. To perform such a transformation, a program must maintain a &quot;node table&quot; that keeps track of all the object references that have already been processed. The node table must not equate distinct objects even if they happen to be equal.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s definitively what is happening here.&lt;/p&gt;</comment>
                            <comment id="16781416" author="jira-bot" created="Fri, 1 Mar 2019 08:08:43 +0000"  >&lt;p&gt;Commit 1854562 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1854562&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1854562&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4477&quot; title=&quot;Large encrypted file takes days to be parsed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4477&quot;&gt;&lt;del&gt;PDFBOX-4477&lt;/del&gt;&lt;/a&gt;: use IdentityHashMap instead of HashMap to speed up things and because we really need == equality&lt;/p&gt;</comment>
                            <comment id="16781418" author="jira-bot" created="Fri, 1 Mar 2019 08:09:04 +0000"  >&lt;p&gt;Commit 1854563 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1854563&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1854563&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4477&quot; title=&quot;Large encrypted file takes days to be parsed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4477&quot;&gt;&lt;del&gt;PDFBOX-4477&lt;/del&gt;&lt;/a&gt;: use IdentityHashMap instead of HashMap to speed up things and because we really need == equality&lt;/p&gt;</comment>
                            <comment id="16781423" author="msahyoun" created="Fri, 1 Mar 2019 08:16:32 +0000"  >&lt;p&gt;The cause of the duplication may also have been that COSBase is mutable and as a result a mutated object will not be identified to equal to an already stored one in HashMap. That&apos;s also addressed by  IdentityHashMap.&lt;/p&gt;</comment>
                            <comment id="16781457" author="tilman" created="Fri, 1 Mar 2019 08:30:04 +0000"  >&lt;p&gt;But it is still there after the change. I found out one cause: decrypt() is called with COSInteger and other objects that don&apos;t get decrypted. Getting rid of these puts the count at 824289.&lt;/p&gt;</comment>
                            <comment id="16781474" author="jira-bot" created="Fri, 1 Mar 2019 08:51:39 +0000"  >&lt;p&gt;Commit 1854566 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1854566&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1854566&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4477&quot; title=&quot;Large encrypted file takes days to be parsed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4477&quot;&gt;&lt;del&gt;PDFBOX-4477&lt;/del&gt;&lt;/a&gt;: don&apos;t insert types into set that don&apos;t get decrypted&lt;/p&gt;</comment>
                            <comment id="16781475" author="jira-bot" created="Fri, 1 Mar 2019 08:51:48 +0000"  >&lt;p&gt;Commit 1854567 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1854567&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1854567&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4477&quot; title=&quot;Large encrypted file takes days to be parsed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4477&quot;&gt;&lt;del&gt;PDFBOX-4477&lt;/del&gt;&lt;/a&gt;: don&apos;t insert types into set that don&apos;t get decrypted&lt;/p&gt;</comment>
                            <comment id="16781679" author="lehmi" created="Fri, 1 Mar 2019 13:41:21 +0000"  >&lt;p&gt;The origin issue was about COSStrings which seemed to be equal because of the fact that COSString uses the represented String for calculating the hash von the HashSet. Maybe you should limit the newly introduced check to COSString objects, as only those seem to affected.&lt;/p&gt;</comment>
                            <comment id="16781696" author="tilman" created="Fri, 1 Mar 2019 14:02:16 +0000"  >&lt;p&gt;The last commit is just about whether object types are put into the set at all. The commit before didn&apos;t introduce a new check, it reverted the code&#160;to before &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4453&quot; title=&quot;Encrypted string not decrypted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4453&quot;&gt;&lt;del&gt;PDFBOX-4453&lt;/del&gt;&lt;/a&gt; (and refactored a bit) but replaced the set type. The huge set size is always there.&lt;/p&gt;

&lt;p&gt;I did think about only putting only COSString and COSStream into the set but not COSDictionary and not COSArray, but that would mean that these would still be processed one level.&lt;/p&gt;

&lt;p&gt;The real mystery (which I am investigating) is why are there so many objects.&lt;/p&gt;</comment>
                            <comment id="16781729" author="tilman" created="Fri, 1 Mar 2019 14:38:43 +0000"  >&lt;p&gt;I just found something that I had missed - each of the 160 pages has a /VP entry. Each one has 395 entries and these are completely inline. Each of them has maybe 10 objects that are array or dictionary. So that makes 10 * 160 * 295 = 472000 objects.&lt;/p&gt;</comment>
                            <comment id="16781741" author="tilman" created="Fri, 1 Mar 2019 14:51:40 +0000"  >&lt;p&gt;With the current code, it takes 2.6 seconds to open (best of several attempts).&lt;br/&gt;
With code that keeps only strings and streams in the sets, it takes 2.4 seconds. Element count goes down to 252869.&lt;/p&gt;</comment>
                            <comment id="16781785" author="tilman" created="Fri, 1 Mar 2019 15:30:14 +0000"  >&lt;p&gt;I also tried a smaller file (755045.pdf) and the times are about the same. &lt;/p&gt;

&lt;p&gt;I&apos;ll probably commit that latest change too&#8230; reasoning:&lt;/p&gt;

&lt;p&gt;Most arrays / dictionaries won&apos;t be referenced by several other objects. Those referenced aren&apos;t so many (e.g. fonts) and are also found in the confidential file.&lt;/p&gt;

&lt;p&gt;When we do have a complex / huge file, it is the memory footprint that could &quot;kill&quot; an application, while a possibly slower response time (that I haven&apos;t been able to show) would not.&lt;/p&gt;</comment>
                            <comment id="16782327" author="jira-bot" created="Sat, 2 Mar 2019 09:56:38 +0000"  >&lt;p&gt;Commit 1854632 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1854632&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1854632&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4477&quot; title=&quot;Large encrypted file takes days to be parsed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4477&quot;&gt;&lt;del&gt;PDFBOX-4477&lt;/del&gt;&lt;/a&gt;: only cache strings and streams, this improves speed and memory footprint&lt;/p&gt;</comment>
                            <comment id="16782328" author="jira-bot" created="Sat, 2 Mar 2019 09:56:55 +0000"  >&lt;p&gt;Commit 1854633 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1854633&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1854633&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4477&quot; title=&quot;Large encrypted file takes days to be parsed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4477&quot;&gt;&lt;del&gt;PDFBOX-4477&lt;/del&gt;&lt;/a&gt;: only cache strings and streams, this improves speed and memory footprint&lt;/p&gt;</comment>
                            <comment id="16782329" author="jira-bot" created="Sat, 2 Mar 2019 10:01:16 +0000"  >&lt;p&gt;Commit 1854634 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1854634&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1854634&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4477&quot; title=&quot;Large encrypted file takes days to be parsed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4477&quot;&gt;&lt;del&gt;PDFBOX-4477&lt;/del&gt;&lt;/a&gt;: add comment for later&lt;/p&gt;</comment>
                            <comment id="16782343" author="tilman" created="Sat, 2 Mar 2019 11:16:47 +0000"  >&lt;p&gt;Done. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=slavago&quot; class=&quot;user-hover&quot; rel=&quot;slavago&quot;&gt;slavago&lt;/a&gt; I&apos;ve deleted the confidential file. You can try with a snapshot at&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.15-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.15-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16782356" author="slavago" created="Sat, 2 Mar 2019 12:33:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; I tried, got next error:&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.io.IOException: You do not have permission to extract text&lt;br/&gt;
 at org.apache.pdfbox.tools.ExtractText.startExtraction(ExtractText.java:221)&lt;br/&gt;
 at org.apache.pdfbox.tools.ExtractText.main(ExtractText.java:96)&lt;br/&gt;
 at org.apache.pdfbox.tools.PDFBox.main(PDFBox.java:60)&lt;/p&gt;</comment>
                            <comment id="16782359" author="tilman" created="Sat, 2 Mar 2019 12:39:02 +0000"  >&lt;p&gt;Yes the file is encrypted, and the permissions probably prohibit text extraction, this is very common. I didn&apos;t try text extraction myself, I just looked at the file with PDFDebugger. You can still extract text programmatically, or use the owner password with the command line utility.&lt;/p&gt;</comment>
                            <comment id="16782360" author="slavago" created="Sat, 2 Mar 2019 12:44:36 +0000"  >&lt;p&gt;The password is empty, tried to find how I can provide empty password but can&apos;t find how.&lt;/p&gt;</comment>
                            <comment id="16782363" author="tilman" created="Sat, 2 Mar 2019 12:54:37 +0000"  >&lt;p&gt;The user password is empty. It is the owner password that is not empty. You need to ask that one to be able to extract the text. (Try with Adobe Reader, you&apos;ll have the same problem, you won&apos;t be able to copy &amp;amp; paste text). But like I said, you can still get the text with a java program, e.g. the ExtractText source code with one line commented.&lt;/p&gt;</comment>
                            <comment id="16782381" author="slavago" created="Sat, 2 Mar 2019 13:35:19 +0000"  >&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Well,&lt;/p&gt;

&lt;p&gt;Tried in Java, works like a charm,&#160;Thanks !!!.&lt;/p&gt;

&lt;p&gt;P.S. Off-topic any recommendation for speedup text extraction, as we are indexing&#160;thousands of PDF daily.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="16782407" author="tilman" created="Sat, 2 Mar 2019 15:02:36 +0000"  >&lt;p&gt;pdfbox in tika is pretty fast, the panama papers folks used it... other products:&lt;br/&gt;
&lt;a href=&quot;https://pdfliberation.wordpress.com/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://pdfliberation.wordpress.com/&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13218074">TIKA-2832</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13213386">PDFBOX-4453</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z007z4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>