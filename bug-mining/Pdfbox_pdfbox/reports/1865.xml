<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:06:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3990] Rendering will never complete</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3990</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I have a PDF file that I am attempting to render with:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
PDFRenderer renderer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFRenderer(document);
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 2; i++ ) { &lt;span class=&quot;code-comment&quot;&gt;// the document is two pages, code simplified
&lt;/span&gt;    BufferedImage image = renderer.renderImageWithDPI(i, dpi, ImageType.RGB); 
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, the code never returns. When I pause execution (in Eclipse) I see that execution never leaves the decode() method of org.apache.pdfbox.filter.RunLengthDecodeFilter.&lt;/p&gt;

&lt;p&gt;The problem is that the inner loop of while (amountToCopy &amp;gt; 0) in bold below is never executed because the stream has come to EOF! That means that the int compressedRead get a negative value and amountToCopy is _*added *_to instead of being subtracted from.&lt;br/&gt;
The loop seems to eventually step out of itself, Probably when the integer warps around when reaching it&apos;s max &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
The problem is easy to catch if setting a conditional breakpoint on compressedRead == -1.&lt;/p&gt;

&lt;p&gt;I&apos;ll include the PDF. The problem arises on page 2.  &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; DecodeResult decode(InputStream encoded, OutputStream decoded,
                                         COSDictionary parameters, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; index) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
    {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; dupAmount;
        &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] buffer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[128];
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((dupAmount = encoded.read()) != -1 &amp;amp;&amp;amp; dupAmount != RUN_LENGTH_EOD)
        {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dupAmount &amp;lt;= 127)
            {
                &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; amountToCopy = dupAmount + 1;
                &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compressedRead;
               * &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(amountToCopy &amp;gt; 0)
                {
                    compressedRead = encoded.read(buffer, 0, amountToCopy);
                    decoded.write(buffer, 0, compressedRead);
                    amountToCopy -= compressedRead;
                }*
            }
            &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
            {
                &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; dupByte = encoded.read();
                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 257 - dupAmount; i++)
                {
                    decoded.write(dupByte);
                }
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DecodeResult(parameters);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>Java 1.8</environment>
        <key id="13115907">PDFBOX-3990</key>
            <summary>Rendering will never complete</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="barsk">Kristian J&#246;rg</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Nov 2017 12:25:03 +0000</created>
                <updated>Sat, 24 Mar 2018 09:41:35 +0000</updated>
                            <resolved>Fri, 3 Nov 2017 17:12:38 +0000</resolved>
                                    <version>2.0.8</version>
                                    <fixVersion>2.0.9</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16238001" author="jira-bot" created="Fri, 3 Nov 2017 17:06:37 +0000"  >&lt;p&gt;Commit 1814226 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1814226&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1814226&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3990&quot; title=&quot;Rendering will never complete&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3990&quot;&gt;&lt;del&gt;PDFBOX-3990&lt;/del&gt;&lt;/a&gt;: detect EOF while decompressing&lt;/p&gt;</comment>
                            <comment id="16238008" author="jira-bot" created="Fri, 3 Nov 2017 17:08:46 +0000"  >&lt;p&gt;Commit 1814227 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1814227&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1814227&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3990&quot; title=&quot;Rendering will never complete&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3990&quot;&gt;&lt;del&gt;PDFBOX-3990&lt;/del&gt;&lt;/a&gt;: detect EOF while decompressing&lt;/p&gt;</comment>
                            <comment id="16238016" author="lehmi" created="Fri, 3 Nov 2017 17:12:38 +0000"  >&lt;p&gt;I can&apos;t confirm an endless loop. It works on my machine, but it is very slow. After adding the conditional breakpoint as suggested, everything is way much faster.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=barsk&quot; class=&quot;user-hover&quot; rel=&quot;barsk&quot;&gt;barsk&lt;/a&gt; for your finding and the fix!&lt;/p&gt;</comment>
                            <comment id="16238846" author="barsk" created="Sat, 4 Nov 2017 08:33:23 +0000"  >&lt;p&gt;Well, not sure I fixed it correctly since I don&apos;t understand the algorithm. But the workaround I made was this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(amountToCopy &amp;gt; 0)
                {
                    compressedRead = encoded.read(buffer, 0, amountToCopy);
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (compressedRead == -1) {
                         &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
                    }
                    decoded.write(buffer, 0, compressedRead);
                    amountToCopy -= compressedRead;
                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I haven&apos;t detected any ill effects from this. But I might just have been lucky... &lt;br/&gt;
Speedup from this fix is great though!&lt;/p&gt;</comment>
                            <comment id="16238848" author="lehmi" created="Sat, 4 Nov 2017 08:50:16 +0000"  >&lt;p&gt;I&apos;ve used exactly your suggestion to fix it&lt;/p&gt;</comment>
                            <comment id="16238854" author="barsk" created="Sat, 4 Nov 2017 09:08:04 +0000"  >&lt;p&gt;Maybe the author, Ben Litchfield, should be contacted to confirm this?&lt;/p&gt;</comment>
                            <comment id="16238941" author="lehmi" created="Sat, 4 Nov 2017 11:52:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;Maybe the author, Ben Litchfield, should be contacted to confirm this?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ben is the founder of PDFBox but no longer active. We, the members of the Apache PDFBox project, are maintaining the code for about 9 years now, you can be sure that we know what we are doing.&lt;/p&gt;</comment>
                            <comment id="16238957" author="tilman" created="Sat, 4 Nov 2017 12:22:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=barsk&quot; class=&quot;user-hover&quot; rel=&quot;barsk&quot;&gt;barsk&lt;/a&gt; your fix is ok. I tested it myself too yesterday afternoon. There is no code ownership. We try to review each others changes. You can get a snapshot here:&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.9-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.9-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The bug was related to a corner case.&lt;/p&gt;

&lt;p&gt;Here&apos;s the algorithm:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;The RunLengthDecode filter decodes data that has been encoded in a simple byte-oriented format based on run length. The encoded data shall be a sequence of runs, where each run shall consist of a length byte followed by 1 to 128 bytes of data. If the length byte is in the range 0 to 127, the following length + 1 (1 to 128) bytes shall be copied literally during decompression. If length is in the range 129 to 255, the following single byte shall be copied 257 - length (2 to 128) times during decompression. A length value of 128 shall denote EOD.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; why the assignment? I also suggest to check the return value of dupByte (line 63).&lt;/p&gt;</comment>
                            <comment id="16238991" author="jira-bot" created="Sat, 4 Nov 2017 13:12:10 +0000"  >&lt;p&gt;Commit 1814285 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1814285&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1814285&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3990&quot; title=&quot;Rendering will never complete&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3990&quot;&gt;&lt;del&gt;PDFBOX-3990&lt;/del&gt;&lt;/a&gt;: detect another possible EOF while decompressing, removed assignment&lt;/p&gt;</comment>
                            <comment id="16238994" author="jira-bot" created="Sat, 4 Nov 2017 13:13:22 +0000"  >&lt;p&gt;Commit 1814286 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1814286&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1814286&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3990&quot; title=&quot;Rendering will never complete&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3990&quot;&gt;&lt;del&gt;PDFBOX-3990&lt;/del&gt;&lt;/a&gt;: detect another possible EOF while decompressing, removed assignment&lt;/p&gt;</comment>
                            <comment id="16238995" author="lehmi" created="Sat, 4 Nov 2017 13:14:28 +0000"  >&lt;p&gt;The assigment was a left over from another not working solution I had in mind yesterday. I&apos;ve removed it and added the suggested EOF detection as well.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; Thanks or the hint&lt;/p&gt;</comment>
                            <comment id="16239029" author="barsk" created="Sat, 4 Nov 2017 14:02:14 +0000"  >&lt;p&gt;Ok, seems like you guys have the full comprehension of the situation. I&apos;ll copy the fix for dupByte also for my own patch and wait for the fix version. Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12895621" name="D90296482_20171102.PDF" size="25177" author="barsk" created="Fri, 3 Nov 2017 12:24:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3mczb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>