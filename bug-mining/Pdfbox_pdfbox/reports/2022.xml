<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:07:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4318] PDFont.encode results change on identical input</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4318</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;As reported Daniel Wildschut in the user mailing list:&lt;/p&gt;

&lt;p&gt;Hello, we use PDFBox to fill in PDF Forms and stumbled on a potential bug while sanitizing the input.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;We call PDFont.encode to check beforehand if a given character can be inserted using the given font.&lt;/p&gt;

&lt;p&gt;However we noticed that the results of the method call can change depending on what other strings have been checked before.&lt;/p&gt;

&lt;p&gt;Apparently PDType1Font stores previous results in a codeToBytesMap, which then causes the unexpected behavior.&lt;/p&gt;

&lt;p&gt;I&apos;d say that the key used in &quot;codeToBytesMap.put(code, bytes);&quot; is wrong; you probably want to use the method parameter &quot;unicode&quot; instead.&lt;/p&gt;

&lt;p&gt;I tested 2.0.11, the current 2.0.x branch and the 3.0.x branch and was able to reproduce the problem with all of them.&lt;/p&gt;

&lt;p&gt;Code to reproduce: &lt;/p&gt;&lt;/blockquote&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PDFBoxEncodeTest
{
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main( &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args )
    {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PDType1Font font = PDType1Font.HELVETICA_BOLD;
        tryEncode(font, &lt;span class=&quot;code-quote&quot;&gt;&quot;\u0080&quot;&lt;/span&gt;);
        tryEncode(font, &lt;span class=&quot;code-quote&quot;&gt;&quot;&#8364;&quot;&lt;/span&gt;);
        tryEncode(font, &lt;span class=&quot;code-quote&quot;&gt;&quot;\u0080&quot;&lt;/span&gt;);
    }

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void tryEncode(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PDFont font, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; str) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            font.encode(str);
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;Character&lt;/span&gt; &quot;&lt;/span&gt; + str.codePointAt(0) + &lt;span class=&quot;code-quote&quot;&gt;&quot; can be encoded in Font &quot;&lt;/span&gt; + font);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; IOException | IllegalArgumentException e) {
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;Character&lt;/span&gt; &quot;&lt;/span&gt; + str.codePointAt(0) + &lt;span class=&quot;code-quote&quot;&gt;&quot; cannot be encoded in Font &quot;&lt;/span&gt; + font + &lt;span class=&quot;code-quote&quot;&gt;&quot;: &quot;&lt;/span&gt; + e.getMessage());
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;

&lt;p&gt;Expected output:&lt;/p&gt;

&lt;p&gt;Character 128 cannot be encoded in Font PDType1Font Helvetica-Bold: U+0080 (&apos;.notdef&apos;) is not available in this font Helvetica-Bold encoding: WinAnsiEncoding&lt;br/&gt;
Character 8364 can be encoded in Font PDType1Font Helvetica-Bold&lt;br/&gt;
Character 128 cannot be encoded in Font PDType1Font Helvetica-Bold: U+0080 (&apos;.notdef&apos;) is not available in this font Helvetica-Bold encoding: WinAnsiEncoding&lt;/p&gt;

&lt;p&gt;Actual output:&lt;/p&gt;

&lt;p&gt;Character 128 cannot be encoded in Font PDType1Font Helvetica-Bold: U+0080 (&apos;.notdef&apos;) is not available in this font Helvetica-Bold encoding: WinAnsiEncoding&lt;br/&gt;
Character 8364 can be encoded in Font PDType1Font Helvetica-Bold&lt;br/&gt;
Character 128 can be encoded in Font PDType1Font Helvetica-Bold &lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="13185360">PDFBOX-4318</key>
            <summary>PDFont.encode results change on identical input</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                            <label>cache</label>
                            <label>caching</label>
                            <label>type1font</label>
                    </labels>
                <created>Sun, 16 Sep 2018 11:30:13 +0000</created>
                <updated>Fri, 5 Oct 2018 04:53:31 +0000</updated>
                            <resolved>Mon, 17 Sep 2018 16:25:20 +0000</resolved>
                                    <version>2.0.11</version>
                    <version>3.0.0 PDFBox</version>
                                    <fixVersion>2.0.12</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16617733" author="jira-bot" created="Mon, 17 Sep 2018 16:02:43 +0000"  >&lt;p&gt;Commit 1841080 from tilman@apache.org in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1841080&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1841080&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4318&quot; title=&quot;PDFont.encode results change on identical input&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4318&quot;&gt;&lt;del&gt;PDFBOX-4318&lt;/del&gt;&lt;/a&gt;: correct bug that wrong key was used for caching, thanks Daniel Wildschut&lt;/p&gt;</comment>
                            <comment id="16617735" author="jira-bot" created="Mon, 17 Sep 2018 16:02:49 +0000"  >&lt;p&gt;Commit 1841081 from tilman@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1841081&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1841081&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4318&quot; title=&quot;PDFont.encode results change on identical input&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4318&quot;&gt;&lt;del&gt;PDFBOX-4318&lt;/del&gt;&lt;/a&gt;: correct bug that wrong key was used for caching, thanks Daniel Wildschut&lt;/p&gt;</comment>
                            <comment id="16617761" author="jira-bot" created="Mon, 17 Sep 2018 16:24:18 +0000"  >&lt;p&gt;Commit 1841086 from tilman@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1841086&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1841086&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4318&quot; title=&quot;PDFont.encode results change on identical input&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4318&quot;&gt;&lt;del&gt;PDFBOX-4318&lt;/del&gt;&lt;/a&gt;: add test inspired by bug reproducing code of Daniel Wildschut&lt;/p&gt;</comment>
                            <comment id="16617762" author="jira-bot" created="Mon, 17 Sep 2018 16:24:23 +0000"  >&lt;p&gt;Commit 1841087 from tilman@apache.org in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1841087&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1841087&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4318&quot; title=&quot;PDFont.encode results change on identical input&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4318&quot;&gt;&lt;del&gt;PDFBOX-4318&lt;/del&gt;&lt;/a&gt;: add test inspired by bug reproducing code of Daniel Wildschut&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12979360">PDFBOX-3382</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 8 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3y4x3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>