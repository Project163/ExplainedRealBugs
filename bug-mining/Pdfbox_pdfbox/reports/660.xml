<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:56:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2275] ClassCastException in PDResources</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2275</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The code (added in revision 1606860)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;COSObject cosObject = (COSObject)dict.getItem(objName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; in the method getXObjects() in PDResources fails with a ClassCastException:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;org.apache.pdfbox.cos.COSStream cannot be cast to org.apache.pdfbox.cos.COSObject&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The document issuing this exception is created using the following code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;PDDocument doc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDDocument();	
PDPage page = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPage();
doc.addPage(page);
PDImageXObject image = JPEGFactory.createFromStream(doc, imageStream);
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDPageContentStream contentStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPageContentStream(doc, page, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)) {
    contentStream.drawImage(image, 20, 20);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12734723">PDFBOX-2275</key>
            <summary>ClassCastException in PDResources</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="dnt">Dominic Tubach</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Aug 2014 09:17:13 +0000</created>
                <updated>Thu, 17 Mar 2016 19:07:53 +0000</updated>
                            <resolved>Fri, 22 Aug 2014 18:06:31 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14100927" author="tilman" created="Mon, 18 Aug 2014 17:46:25 +0000"  >&lt;p&gt;I haven&apos;t understood the problem: does the exception (of which you didn&apos;t include the details) happen when creating or when opening the created PDF file? If the later, I can&apos;t reproduce it. I modified the code of ValidateXImage (search for &quot;loadNonSeq&quot; in that file), and I don&apos;t get an exception:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;document = PDDocument.loadNonSeq(pdfFile, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFRenderer(document).renderImage(0);
List&amp;lt;PDPage&amp;gt; pageList = document.getDocumentCatalog().getAllPages();
PDResources resources = pageList.get(0).getResources();
resources.getXObjects();
document.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Like I said in the other issue - the best is to submit the shortest possible standalone code that fails.&lt;/p&gt;</comment>
                            <comment id="14102100" author="dnt" created="Tue, 19 Aug 2014 10:22:42 +0000"  >&lt;p&gt;This code fails:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;PDDocument doc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDDocument();
PDPage page = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPage();
doc.addPage(page);
InputStream imageStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;image.jpg&quot;&lt;/span&gt;);
PDImageXObject image = JPEGFactory.createFromStream(doc, imageStream);
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDPageContentStream contentStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPageContentStream(doc, page, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)) {
    contentStream.drawImage(image, 0, 0);
}
doc.getPage(0).getResources().getXObjects();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14102405" author="tilman" created="Tue, 19 Aug 2014 16:21:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dnt&quot; class=&quot;user-hover&quot; rel=&quot;dnt&quot;&gt;dnt&lt;/a&gt; please change the code segment in PDResources to this and test your application:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
{
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name = objName.getName();
    COSBase item = dict.getItem(objName);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (item &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; COSObject)
    {
        COSObject cosObject = (COSObject) item;
        &lt;span class=&quot;code-comment&quot;&gt;// add the object number to create an unique identifier
&lt;/span&gt;        name += &lt;span class=&quot;code-quote&quot;&gt;&quot;#&quot;&lt;/span&gt; + cosObject.getObjectNumber().intValue();
        xobject = PDXObject.createXObject(cosObject.getObject(), name, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (item &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; COSBase)
    {
        xobject = PDXObject.createXObject(item, name, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the problem is that you&apos;re calling the method at a time where the objects are already prepared (but not the xobjects map), while the original intent was to use it at a time the objects were known only by their reference number (look into a PDF with an editor to see what I mean). My change takes care of this difference. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; WDYT? Patch proposal attached.&lt;/p&gt;</comment>
                            <comment id="14103691" author="dnt" created="Wed, 20 Aug 2014 09:46:21 +0000"  >&lt;p&gt;Yes, that fixes the problem. I&apos;ve temporarily done more or less the same at my copy of pdfbox. I think the second instanceof in your code is not necessary.&lt;/p&gt;</comment>
                            <comment id="14103720" author="lehmi" created="Wed, 20 Aug 2014 10:17:05 +0000"  >&lt;p&gt;I&apos;m not happy with the patch as it fixes the symptom only but not the real cause.&lt;/p&gt;

&lt;p&gt;The problem is, that the situation after parsing and after creating a pdf without saving can&apos;t be compared. All the information about direct/indirect objects, objects numbers etc. is generated when saving the pdf. There are a lot of parts in the code expecting all these information, like the one in PDResources.&lt;br/&gt;
So, the question is, should we somehow improve the creation process to produce all needed objects or just patch those parts which are affected because of expecting things which aren&apos;t there.&lt;/p&gt;</comment>
                            <comment id="14104425" author="jahewson" created="Wed, 20 Aug 2014 19:45:54 +0000"  >&lt;p&gt;That&apos;s a very good question Andreas. Because there&apos;s only a small minority of code which requires such object id information, I think we&apos;re better off patching the affected parts. Unless there&apos;s a clear systematic problem which can&apos;t be overcome?&lt;/p&gt;</comment>
                            <comment id="14106696" author="lehmi" created="Fri, 22 Aug 2014 10:34:39 +0000"  >&lt;p&gt;OK, let&apos;s apply Tilmans patch and see if similar issues will occur in the future.&lt;/p&gt;</comment>
                            <comment id="14107168" author="jira-bot" created="Fri, 22 Aug 2014 17:43:59 +0000"  >&lt;p&gt;Commit 1619873 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1619873&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1619873&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2275&quot; title=&quot;ClassCastException in PDResources&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2275&quot;&gt;&lt;del&gt;PDFBOX-2275&lt;/del&gt;&lt;/a&gt;: add xobjects that don&apos;t have to be dereferenced&lt;/p&gt;</comment>
                            <comment id="14107184" author="jira-bot" created="Fri, 22 Aug 2014 17:53:15 +0000"  >&lt;p&gt;Commit 1619876 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1619876&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1619876&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2275&quot; title=&quot;ClassCastException in PDResources&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2275&quot;&gt;&lt;del&gt;PDFBOX-2275&lt;/del&gt;&lt;/a&gt;: add a test that the resource map is filled at PDF creation time&lt;/p&gt;</comment>
                            <comment id="14107234" author="dnt" created="Fri, 22 Aug 2014 18:21:53 +0000"  >&lt;p&gt;Thanks. I&apos;m wondering why you kept the condition that always evaluates to true because item is of type COSBase:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (item &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; COSBase)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14107355" author="jira-bot" created="Fri, 22 Aug 2014 19:35:55 +0000"  >&lt;p&gt;Commit 1619917 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1619917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1619917&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2275&quot; title=&quot;ClassCastException in PDResources&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2275&quot;&gt;&lt;del&gt;PDFBOX-2275&lt;/del&gt;&lt;/a&gt;: remove code line that isn&apos;t needed&lt;/p&gt;</comment>
                            <comment id="14107356" author="tilman" created="Fri, 22 Aug 2014 19:36:22 +0000"  >&lt;p&gt;uh, yes, now I got it. Done, thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12662773" name="PDResources.diff" size="1586" author="tilman" created="Tue, 19 Aug 2014 16:21:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412663</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yznr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412649</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>