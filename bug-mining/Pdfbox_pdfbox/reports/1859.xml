<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:06:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3978] IllegalStateException on saveIncrementalForExternalSigning</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3978</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;When adding a signature to a PDF document which already contains an invisible signature, the following exception is thrown:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalStateException: signature reserve byte range has been changed after addSignature(), please set the byte range that existed after addSignature()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Step to reproduce:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Get a simple PDf document having an empty signature field and signed (using Adobe) with an invisible signature.&lt;/li&gt;
	&lt;li&gt;Run the &lt;em&gt;org.apache.pdfbox.examples.signature.CreateVisibleSignature&lt;/em&gt; setting &lt;em&gt;lateExternalSigning = true&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Full Stack trace:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalStateException: signature reserve byte range has been changed after addSignature(), please set the byte range that existed after addSignature()
	at org.apache.pdfbox.pdmodel.PDDocument.saveIncrementalForExternalSigning(PDDocument.java:1361)
	at org.apache.pdfbox.examples.signature.CreateVisibleSignature.signPDF(CreateVisibleSignature.java:270)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Use the attached PDF as reference to reproduce&lt;/p&gt;

&lt;p&gt;Maybe related to: &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3811&quot; title=&quot;Problem with calling &amp;quot;saveIncrementalForExternalSigning&amp;quot; more than once in the same document&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3811&quot;&gt;&lt;del&gt;PDFBOX-3811&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13111631">PDFBOX-3978</key>
            <summary>IllegalStateException on saveIncrementalForExternalSigning</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="ale.marini">Alessandro Marini</reporter>
                        <labels>
                            <label>regression</label>
                    </labels>
                <created>Tue, 24 Oct 2017 08:03:04 +0000</created>
                <updated>Thu, 2 Nov 2017 21:01:12 +0000</updated>
                            <resolved>Wed, 25 Oct 2017 15:24:31 +0000</resolved>
                                    <version>2.0.7</version>
                                    <fixVersion>2.0.8</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Signing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16216501" author="ale.marini" created="Tue, 24 Oct 2017 08:14:34 +0000"  >&lt;p&gt;The method &lt;em&gt;getLastSignatureDictionary()&lt;/em&gt; seems to return the signature dict of the invisible signature (which is having of course a byte range different from RESERVE_BYTE_RANGE)&lt;/p&gt;</comment>
                            <comment id="16217135" author="tilman" created="Tue, 24 Oct 2017 15:50:06 +0000"  >&lt;p&gt;The cause is this line in our code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[] byteRange = getLastSignatureDictionary().getByteRange();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The new signature is not the last one. The solution is to use the update flag instead.&lt;/p&gt;</comment>
                            <comment id="16217141" author="jira-bot" created="Tue, 24 Oct 2017 15:54:40 +0000"  >&lt;p&gt;Commit 1813187 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1813187&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1813187&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3978&quot; title=&quot;IllegalStateException on saveIncrementalForExternalSigning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3978&quot;&gt;&lt;del&gt;PDFBOX-3978&lt;/del&gt;&lt;/a&gt;: add test with empty signature before invisible signature; allow argument for empty signature example; don&apos;t use confusing method&lt;/p&gt;</comment>
                            <comment id="16217142" author="jira-bot" created="Tue, 24 Oct 2017 15:54:45 +0000"  >&lt;p&gt;Commit 1813188 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1813188&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1813188&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3978&quot; title=&quot;IllegalStateException on saveIncrementalForExternalSigning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3978&quot;&gt;&lt;del&gt;PDFBOX-3978&lt;/del&gt;&lt;/a&gt;: add test with empty signature before invisible signature; allow argument for empty signature example; don&apos;t use confusing method&lt;/p&gt;</comment>
                            <comment id="16217154" author="jira-bot" created="Tue, 24 Oct 2017 16:05:05 +0000"  >&lt;p&gt;Commit 1813189 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1813189&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1813189&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3978&quot; title=&quot;IllegalStateException on saveIncrementalForExternalSigning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3978&quot;&gt;&lt;del&gt;PDFBOX-3978&lt;/del&gt;&lt;/a&gt;: if there&apos;s a signature with the update flag, check that one instead of the &quot;last&quot; one; clarify javadoc; fix typo&lt;/p&gt;</comment>
                            <comment id="16217155" author="jira-bot" created="Tue, 24 Oct 2017 16:05:09 +0000"  >&lt;p&gt;Commit 1813190 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1813190&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1813190&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3978&quot; title=&quot;IllegalStateException on saveIncrementalForExternalSigning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3978&quot;&gt;&lt;del&gt;PDFBOX-3978&lt;/del&gt;&lt;/a&gt;: if there&apos;s a signature with the update flag, check that one instead of the &quot;last&quot; one; clarify javadoc; fix typo&lt;/p&gt;</comment>
                            <comment id="16217654" author="tilman" created="Tue, 24 Oct 2017 20:43:40 +0000"  >&lt;p&gt;Please test with a snapshot and give feedback&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.8-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.8-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16218192" author="ale.marini" created="Wed, 25 Oct 2017 07:03:24 +0000"  >&lt;p&gt;I confirm the resolution with v. 2.0.8-SNAPSHOT.&lt;br/&gt;
Thank you very much for the very quick reaction!&lt;/p&gt;

&lt;p&gt;Br,&lt;br/&gt;
Alessandro&lt;/p&gt;</comment>
                            <comment id="16218890" author="tilman" created="Wed, 25 Oct 2017 15:24:31 +0000"  >&lt;p&gt;Thanks for the report and the feedback!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13075152">PDFBOX-3811</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12893704" name="Test_certified_invisible.pdf" size="128968" author="ale.marini" created="Tue, 24 Oct 2017 07:56:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 3 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3lmnb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>