<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:53:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1016] Specification conform xref/trailer parsing + Fix</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1016</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;PDFBOX currently reads xref table/trailer and XRef objects without using startxref or &apos;Prev&apos; information which results in applying not active data resulting in using wrong objects or resulting in parsing exceptions because old trailer settings do not apply anymore. This happens especially with updated PDF documents where changes are simply appended  and old objects/xref entries remain but are not referenced. My last patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1014&quot; title=&quot;Unused XRef object streams cause parser to fail + FIX&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1014&quot;&gt;&lt;del&gt;PDFBOX-1014&lt;/del&gt;&lt;/a&gt;) tried to solve this for a specific case but it was based on assumptions which do not hold in every case.&lt;/p&gt;

&lt;p&gt;The specification compliant way is to read the last startxref which points to the last xref object which itself may reference further xref objects using &apos;Prev&apos; attribute.&lt;/p&gt;

&lt;p&gt;I have written a fix which works the standard way and can fall back to the old behavior in case startxref is wrong or missing. The fix tries to be as unobtrusive as possible. A new class (o.a.p.pdfparser.XrefTrailerResolver) is filled with all xref table/trailer and XRef object data. After document is parsed (and last startxref is read) this class creates xref table and trailer using startxref and &apos;Prev&apos; information. Beside this new class there are small changes to PDFParser and COSDocument.&lt;/p&gt;

&lt;p&gt;This bugfix/improvement should bring PDFBOX a good step closer to be PDF specification conform - especially as long as the new specification conform parser project is not finished.&lt;/p&gt;

&lt;p&gt;This bugfix supersedes the fix from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1014&quot; title=&quot;Unused XRef object streams cause parser to fail + FIX&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1014&quot;&gt;&lt;del&gt;PDFBOX-1014&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12507759">PDFBOX-1016</key>
            <summary>Specification conform xref/trailer parsing + Fix</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="tboehme">Timo Boehme</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 May 2011 14:13:13 +0000</created>
                <updated>Sat, 2 Jul 2011 16:28:56 +0000</updated>
                            <resolved>Thu, 23 Jun 2011 17:19:09 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.6.0</fixVersion>
                                    <component>Parsing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="600">10m</timeoriginalestimate>
                            <timeestimate seconds="600">10m</timeestimate>
                                        <comments>
                            <comment id="13036203" author="tboehme" created="Thu, 19 May 2011 14:15:29 +0000"  >&lt;p&gt;New class in o.a.p.pdfparser which collects all xref/trailer information and creates a combined xref table + trailer according to PDF specification.&lt;/p&gt;</comment>
                            <comment id="13036210" author="tboehme" created="Thu, 19 May 2011 14:18:38 +0000"  >&lt;p&gt;diff for COSDocument (against rev. 1092855)&lt;br/&gt;
diff for PDFParser (against rev. 1092855)&lt;/p&gt;</comment>
                            <comment id="13036244" author="tboehme" created="Thu, 19 May 2011 15:01:07 +0000"  >&lt;p&gt;bug fix version of previous XrefTrailerResolver attachement (read int value was compared with &apos;null&apos; instead of &apos;-1&apos;)&lt;/p&gt;</comment>
                            <comment id="13048539" author="lehmi" created="Mon, 13 Jun 2011 12:46:37 +0000"  >&lt;p&gt;I tried to apply your patch, but I guess some changes are missing. It seems there should also be a patch for the class &quot;PDFXrefStreamParser&quot;&lt;/p&gt;</comment>
                            <comment id="13049040" author="tboehme" created="Tue, 14 Jun 2011 07:51:12 +0000"  >&lt;p&gt;You&apos;re absolutely right, there are also some small changes in PDFXrefStreamParser which actually fills the XrefTrailerResolver. Missing diff added now.&lt;/p&gt;</comment>
                            <comment id="13052504" author="tchojecki" created="Tue, 21 Jun 2011 12:11:49 +0000"  >&lt;p&gt;I tried out the patch. Works as aspected.&lt;br/&gt;
It parse the XRefStream directly after receiving the object from parser. The order is still not the right one but it wouldn&apos;t cause any problem.&lt;/p&gt;

&lt;p&gt;Thx for the patch, hope someone can commit it for the 1.6 pdfbox version.&lt;/p&gt;</comment>
                            <comment id="13052510" author="tboehme" created="Tue, 21 Jun 2011 12:20:52 +0000"  >&lt;p&gt;Could you please explain why the order (actually which order) is not the right one? The used XREFs should be the ones which are active within the document and they are read in the order defined by specification. It first travels from last xref pointed to by startxref via &apos;prev&apos; to the first xref to be used and start from there creating the xref table.&lt;/p&gt;</comment>
                            <comment id="13052539" author="tchojecki" created="Tue, 21 Jun 2011 13:05:26 +0000"  >&lt;p&gt;---- PDF Document with 84 objets -----&lt;br/&gt;
HEADER&lt;br/&gt;
Object&lt;br/&gt;
XRefStream (2) &lt;span class=&quot;error&quot;&gt;&amp;#91;66-84&amp;#93;&lt;/span&gt; -&amp;gt; point to XRefStream (1)&lt;br/&gt;
startxref -&amp;gt; point to offset 0&lt;br/&gt;
%%EOF &lt;br/&gt;
Objects&lt;br/&gt;
XRefStream (1) &lt;span class=&quot;error&quot;&gt;&amp;#91;0-65&amp;#93;&lt;/span&gt; &lt;br/&gt;
TRAILER&lt;br/&gt;
startxref -&amp;gt; point to XRefStream (2)&lt;br/&gt;
%%EOF&lt;/p&gt;

&lt;p&gt;Right order, jump &amp;amp; read 2 -&amp;gt; jump &amp;amp; read 1 -&amp;gt; parse 1 -&amp;gt; parse 2&lt;br/&gt;
Your order, read &amp;amp; parse 2 -&amp;gt; read &amp;amp; parse 1&lt;/p&gt;

&lt;p&gt;This document was signed 3 time (incremental) with 100 objects&lt;/p&gt;

&lt;p&gt;So the document looks now&lt;/p&gt;

&lt;p&gt;HEADER&lt;br/&gt;
Object&lt;br/&gt;
XRefStream (2) &lt;span class=&quot;error&quot;&gt;&amp;#91;66-84&amp;#93;&lt;/span&gt; -&amp;gt; point to XRefStream (1)&lt;br/&gt;
startxref -&amp;gt; point to offset 0&lt;br/&gt;
%%EOF &lt;br/&gt;
Objects&lt;br/&gt;
XRefStream (1) &lt;span class=&quot;error&quot;&gt;&amp;#91;0-65&amp;#93;&lt;/span&gt; &lt;br/&gt;
TRAILER&lt;br/&gt;
startxref -&amp;gt; point to XRefStream (2)&lt;br/&gt;
%%EOF&lt;br/&gt;
Objects&lt;br/&gt;
XRefStream (3) -&amp;gt; point to (2)&lt;br/&gt;
TRAILER&lt;br/&gt;
startxref -&amp;gt; point to XRefStream (3)&lt;br/&gt;
%%EOF&lt;br/&gt;
Objects&lt;br/&gt;
XRefStream (4) -&amp;gt; point to (3)&lt;br/&gt;
TRAILER&lt;br/&gt;
startxref -&amp;gt; point to XRefStream (4)&lt;br/&gt;
%%EOF&lt;br/&gt;
Objects&lt;br/&gt;
XRefStream (5) -&amp;gt; point to (4)&lt;br/&gt;
TRAILER&lt;br/&gt;
startxref -&amp;gt; point to XRefStream (5)&lt;br/&gt;
%%EOF&lt;/p&gt;

&lt;p&gt;Conform reading: jump &amp;amp; read 5 -&amp;gt; jump &amp;amp; read 4 -&amp;gt; jump &amp;amp; read 3 -&amp;gt; jump &amp;amp; read 2 -&amp;gt; jump &amp;amp; read 1 -&amp;gt; parse 1 -&amp;gt; parse 2 -&amp;gt; parse 3 -&amp;gt; parse 4 -&amp;gt; parse 5&lt;br/&gt;
Your order, read &amp;amp; parse 2 -&amp;gt; read &amp;amp; parse 1 -&amp;gt; read &amp;amp; parse 3 -&amp;gt; read &amp;amp; parse 4 -&amp;gt; read &amp;amp; parse 5&lt;/p&gt;

&lt;p&gt;The first two xref sections doesn&apos;t conflict so it isn&apos;t conform but will work without problem.&lt;/p&gt;</comment>
                            <comment id="13052555" author="tboehme" created="Tue, 21 Jun 2011 13:26:01 +0000"  >&lt;p&gt;If you applied the patch from this Fix (with XrefTrailerResolver.java etc.) you should get the correct order where 2 overwrites 1. In XrefTrailerResolver first the list of XREFs ist build (in setStartxref()), which means in this case &lt;span class=&quot;error&quot;&gt;&amp;#91;2; 1&amp;#93;&lt;/span&gt; and this list is reversed &lt;span class=&quot;error&quot;&gt;&amp;#91;1; 2&amp;#93;&lt;/span&gt; and with the reversed list the table is build (first entries from 1 are applied, than entries from 2, possibly overwriting entries from 1).&lt;br/&gt;
Only in case startxref was not set or points to a wrong byte offset the algorithm falls back to current trunk behavior using xrefs in order they appear in document (here &lt;span class=&quot;error&quot;&gt;&amp;#91;2; 1&amp;#93;&lt;/span&gt;). In this case you should have got a warning in log.&lt;br/&gt;
Could you please check that startxref is set and no warning messages are generated?&lt;/p&gt;
</comment>
                            <comment id="13052598" author="tchojecki" created="Tue, 21 Jun 2011 14:49:27 +0000"  >&lt;p&gt;you are absolute right, my mistake. after take a second look at your code i find the call xrefTrailerResolver.getXrefTable() where the table was build the right way. &lt;br/&gt;
great solution.&lt;/p&gt;

&lt;p&gt;I set the breakpoint inside the PDFXrefStreamParser and never see what happen after parsing the whole document.&lt;/p&gt;</comment>
                            <comment id="13053982" author="lehmi" created="Thu, 23 Jun 2011 17:19:09 +0000"  >&lt;p&gt;I added the patch as proposed in revision 1138995, but I had to add some small changes and an improvement:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;reformated some code&lt;/li&gt;
	&lt;li&gt;added some documentation&lt;/li&gt;
	&lt;li&gt;added some java 5 stuff (generics)&lt;/li&gt;
	&lt;li&gt;using more COSName constants&lt;/li&gt;
	&lt;li&gt;fixed PDFParser to avoid a NPE when parsing documents which are containing some unreadable content after %%EOF (the original patch broke our extraction test: data-000001.pdf)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@Timo&lt;br/&gt;
Thanks for the contribution&lt;/p&gt;

&lt;p&gt;@Thomas&lt;br/&gt;
Thanks for the additional test&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12510975">PDFBOX-1042</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12479782" name="COSDocument.diff" size="2207" author="tboehme" created="Thu, 19 May 2011 14:18:38 +0000"/>
                            <attachment id="12479783" name="PDFParser.diff" size="5461" author="tboehme" created="Thu, 19 May 2011 14:18:38 +0000"/>
                            <attachment id="12482525" name="PDFXrefStreamParser.diff" size="1783" author="tboehme" created="Tue, 14 Jun 2011 07:51:12 +0000"/>
                            <attachment id="12479792" name="XrefTrailerResolver.java" size="7416" author="tboehme" created="Thu, 19 May 2011 15:01:07 +0000"/>
                            <attachment id="12479780" name="XrefTrailerResolver.java" size="7418" author="tboehme" created="Thu, 19 May 2011 14:15:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>69411</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 22 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zhtr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>205190</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>