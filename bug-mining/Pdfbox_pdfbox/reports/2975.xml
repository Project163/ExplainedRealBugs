<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:14:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5876] This jpeg2000 takes up a lot of memory, causing overflow.</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5876</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;pdf&#65306;&lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13071244/13071244_jpeg2000.pdf&quot; title=&quot;jpeg2000.pdf attached to PDFBOX-5876&quot;&gt;jpeg2000.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;br/&gt;
JVM&#65306;-Xmx600m&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//&#20195;&#30721;&#21344;&#20301;&#31526;
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, InterruptedException {
   File file = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;C:\\Users\\LYCIT\\Downloads\\jpeg2000.pdf&quot;&lt;/span&gt;);
   PDDocument pdf = Loader.loadPDF(file, IOUtils.createTempFileOnlyStreamCache());
   PDFRenderer renderer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFRenderer(pdf);
   &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numPages = 0;
   renderer.setSubsamplingAllowed(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
   BufferedImage bi = renderer.renderImage(numPages, 0.5f);
   pdf.close();
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13590795">PDFBOX-5876</key>
            <summary>This jpeg2000 takes up a lot of memory, causing overflow.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="lycheng">liu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Sep 2024 04:08:05 +0000</created>
                <updated>Sun, 29 Sep 2024 09:42:56 +0000</updated>
                                            <version>2.0.32</version>
                    <version>3.0.2 PDFBox</version>
                                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17878827" author="jira-bot" created="Tue, 3 Sep 2024 11:10:27 +0000"  >&lt;p&gt;Commit 1920420 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1920420&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1920420&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5876&quot; title=&quot;This jpeg2000 takes up a lot of memory, causing overflow.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5876&quot;&gt;PDFBOX-5876&lt;/a&gt;: pass subsampling for second read&lt;/p&gt;</comment>
                            <comment id="17878828" author="jira-bot" created="Tue, 3 Sep 2024 11:10:32 +0000"  >&lt;p&gt;Commit 1920421 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1920421&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1920421&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5876&quot; title=&quot;This jpeg2000 takes up a lot of memory, causing overflow.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5876&quot;&gt;PDFBOX-5876&lt;/a&gt;: pass subsampling for second read&lt;/p&gt;</comment>
                            <comment id="17878829" author="jira-bot" created="Tue, 3 Sep 2024 11:10:36 +0000"  >&lt;p&gt;Commit 1920422 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1920422&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1920422&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5876&quot; title=&quot;This jpeg2000 takes up a lot of memory, causing overflow.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5876&quot;&gt;PDFBOX-5876&lt;/a&gt;: pass subsampling for second read&lt;/p&gt;</comment>
                            <comment id="17878835" author="tilman" created="Tue, 3 Sep 2024 11:27:20 +0000"  >&lt;p&gt;The JPX image in that file is 7020 x 4964, which is quite big, and -Xmx600m is quite low. But I noticed that the subsampling parameter wasn&apos;t used when reading the JPX image the second time, which was the cause for the OOM. (JPX images have to be read twice because of some weirdness in the specification) It should work now, I tried it with PDFDebugger, which doesn&apos;t allow to set a temp cache.&lt;/p&gt;</comment>
                            <comment id="17878837" author="JIRAUSER297279" created="Tue, 3 Sep 2024 11:32:21 +0000"  >&lt;p&gt;I tried it, but it still seems to overflow.&lt;/p&gt;</comment>
                            <comment id="17878846" author="tilman" created="Tue, 3 Sep 2024 11:50:55 +0000"  >&lt;p&gt;Are you sure you are using the new version? You have to build yourself or wait until a new snapshot build is available. Instead of using PDFDebugger now I just tried your code as it is with a locally built 3.0.4-SNAPSHOT and it did work with -Xmx600m. (Also with 550, but not with 500)&lt;/p&gt;</comment>
                            <comment id="17878878" author="JIRAUSER297279" created="Tue, 3 Sep 2024 13:08:40 +0000"  >&lt;p&gt;It&apos;s still very large, one picture takes up 500M. Are there any other optimization solutions?&lt;/p&gt;</comment>
                            <comment id="17878879" author="tilman" created="Tue, 3 Sep 2024 13:18:51 +0000"  >&lt;p&gt;No... I used -Xmx4G for a production project.&lt;/p&gt;</comment>
                            <comment id="17878880" author="JIRAUSER297279" created="Tue, 3 Sep 2024 13:22:09 +0000"  >&lt;p&gt;4G JVM can only convert 8 pictures concurrently...It overflows so easily..&lt;/p&gt;</comment>
                            <comment id="17879119" author="tilman" created="Wed, 4 Sep 2024 07:03:55 +0000"  >&lt;p&gt;I need to make more changes, rendering regression tests failed.&lt;/p&gt;</comment>
                            <comment id="17879145" author="jira-bot" created="Wed, 4 Sep 2024 09:08:06 +0000"  >&lt;p&gt;Commit 1920451 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1920451&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1920451&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5876&quot; title=&quot;This jpeg2000 takes up a lot of memory, causing overflow.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5876&quot;&gt;PDFBOX-5876&lt;/a&gt;: revert due to rendering regression test failure&lt;/p&gt;</comment>
                            <comment id="17879146" author="jira-bot" created="Wed, 4 Sep 2024 09:08:10 +0000"  >&lt;p&gt;Commit 1920452 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1920452&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1920452&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5876&quot; title=&quot;This jpeg2000 takes up a lot of memory, causing overflow.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5876&quot;&gt;PDFBOX-5876&lt;/a&gt;: revert due to rendering regression test failure&lt;/p&gt;</comment>
                            <comment id="17879147" author="jira-bot" created="Wed, 4 Sep 2024 09:08:14 +0000"  >&lt;p&gt;Commit 1920453 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1920453&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1920453&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5876&quot; title=&quot;This jpeg2000 takes up a lot of memory, causing overflow.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5876&quot;&gt;PDFBOX-5876&lt;/a&gt;: revert due to rendering regression test failure&lt;/p&gt;</comment>
                            <comment id="17879148" author="tilman" created="Wed, 4 Sep 2024 09:11:17 +0000"  >&lt;p&gt;So many problems...&lt;/p&gt;

&lt;p&gt;The current code doesn&apos;t work when subsampling is off because the init value of MAXINT can&apos;t be used, I must use the actual subsampling value.&lt;/p&gt;

&lt;p&gt;However the actual subsampling value isn&apos;t known: the first call to initJPXValue() is done when calling PageDrawer.getSubsampling(), which calls getWidth(), which reads the image, because the dimensions are gathered from the image and not from the dictionary.&lt;br/&gt;
I don&apos;t know why it worked in my tests, maybe the cached value was already set, or maybe different versions of the decoder were used.&lt;br/&gt;
I could of course always set subsampling for that extra read, however that extra read also gets the mask for the SMaskInData case (&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5657&quot; title=&quot;SMaskInData not supported for JPX images&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5657&quot;&gt;&lt;del&gt;PDFBOX-5657&lt;/del&gt;&lt;/a&gt;) so I would get a subsampled mask despite not wanting it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13071244" name="jpeg2000.pdf" size="129918" author="lycheng" created="Tue, 3 Sep 2024 04:08:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 9 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1r70o:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>