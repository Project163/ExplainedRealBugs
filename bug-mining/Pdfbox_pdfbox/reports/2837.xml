<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:13:54 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5682] Long/permanent hang in PDFBox 3.x</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5682</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I found two files in the regression tests where we&apos;re now getting timeouts at 3 minutes where we weren&apos;t before.  Unfortunately, PDFBox&apos;s export:text works on both, so it is probably another structural feature, perhaps a problem in Tika?&lt;/p&gt;

&lt;p&gt;This file halts after printing out the header for Table 19 on page 46: &lt;a href=&quot;https://corpora.tika.apache.org/base/docs/govdocs1/078/078656.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://corpora.tika.apache.org/base/docs/govdocs1/078/078656.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Pure PDFBox&apos;s export:text complains multiple times: &quot;Page skipped due to an invalid or missing type null, but it does finish quickly.&quot;&lt;/p&gt;

&lt;p&gt;This file halts after extracting &lt;tt&gt;&quot;854,793,592&quot;&lt;/tt&gt;: &lt;br/&gt;
&lt;a href=&quot;https://corpora.tika.apache.org/base/docs/commoncrawl3_refetched/G7/G7BO7PNCCREVF2BCY5YSYOPYDLMBYASY&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://corpora.tika.apache.org/base/docs/commoncrawl3_refetched/G7/G7BO7PNCCREVF2BCY5YSYOPYDLMBYASY&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Pure PDFBox&apos;s export:text processes this without problem.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13550266">PDFBOX-5682</key>
            <summary>Long/permanent hang in PDFBox 3.x</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="tallison">Tim Allison</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Sep 2023 19:58:18 +0000</created>
                <updated>Thu, 30 Nov 2023 21:19:23 +0000</updated>
                            <resolved>Mon, 9 Oct 2023 06:11:49 +0000</resolved>
                                                    <fixVersion>3.0.1 PDFBox</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17763903" author="tallison@mitre.org" created="Mon, 11 Sep 2023 20:05:19 +0000"  >&lt;p&gt;Both files spend quite a bit of time in &quot;parseObjectDynamically&quot; when I call this:&lt;/p&gt;

&lt;p&gt;        PDDocument document = Loader.loadPDF(path.toFile());&lt;br/&gt;
        List&amp;lt;COSObject&amp;gt; objs = document.getDocument().getObjectsByType(COSName.FILESPEC);&lt;/p&gt;</comment>
                            <comment id="17763904" author="tallison@mitre.org" created="Mon, 11 Sep 2023 20:05:34 +0000"  >&lt;p&gt;It looks like that causes a full parse of the file?&lt;/p&gt;</comment>
                            <comment id="17764199" author="lehmi" created="Tue, 12 Sep 2023 13:54:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;It looks like that causes a full parse of the file?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&quot;getObjectsByType&quot; searches for all indirect objects of the type FILESPEC so that all indirect objects have to be loaded on demand which is more or less the whole file. In 2.0.x all objects are already loaded and therefore calling &quot;getObjectsByType&quot; is less performance consuming compared to 3.0.x.&lt;/p&gt;

&lt;p&gt;IMHO there are two possible solutions:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;maybe there is some room for improvements when loading of all objects&lt;/li&gt;
	&lt;li&gt;don&apos;t scan all objects when looking for some special object types like files. The example &quot;org.apache.pdfbox.examples.pdmodel.ExtractEmbeddedFiles&quot; shows how to get all files using PD-level objects. In 3.0.x this should be the preferred way to go as it doesn&apos;t scan all indirect objects&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17764225" author="tallison@mitre.org" created="Tue, 12 Sep 2023 14:35:42 +0000"  >&lt;p&gt;Thank you, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt;.  In Tika, we initially copied PDFBox&apos;s ExtractEmbeddedFiles example, but we found that PDF writers can stuff attached files/file specs/associated files on pretty much anything (&lt;a href=&quot;https://www.pdfa.org/wp-content/uploads/2018/10/PDF20_AN002-AF.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.pdfa.org/wp-content/uploads/2018/10/PDF20_AN002-AF.pdf&lt;/a&gt;) . &lt;/p&gt;

&lt;p&gt;From what we can tell with publicly available corpora, it is rare to have an attachment not in the name tree and not in an annotation on a page, but after making the change in &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-4012&quot; title=&quot;Improve extraction of embedded documents in PDFs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-4012&quot;&gt;&lt;del&gt;TIKA-4012&lt;/del&gt;&lt;/a&gt;, we did find a few new attachments.&lt;/p&gt;

&lt;p&gt;This may be a &quot;won&apos;t fix&quot; in 3.x. &lt;/p&gt;

&lt;p&gt;Perhaps we allow users to turn off the &quot;scan every object for an embedded file&quot; on the Tika side?&lt;/p&gt;</comment>
                            <comment id="17764228" author="tallison@mitre.org" created="Tue, 12 Sep 2023 14:36:50 +0000"  >&lt;p&gt;This is the part from that document that is, erm, eye-opening:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;4.2 AF entry not in the catalog
4.2.1 General
Most existing applications that take advantage of Associated Files use the AF entry in the
document catalog as the place to make the association. However, the concept of
Associated Files goes well beyond association only with the file as a whole, and also
allows for defining relations between embedded files and certain pages, annotations,
form fields, graphics objects, structure elements in the tagging structure, DParts or any
other PDF object.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And, yes, the document goes on to say, PDF writers should do the traditional thing, but...&lt;/p&gt;</comment>
                            <comment id="17764356" author="lehmi" created="Tue, 12 Sep 2023 19:53:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt; Thanks for the explanation. That is suboptimal ... in the end one has to dereference all indirect objects to collect all possible occurrences, e.g. the first mentioned pdf contains 100k indirect objects and it took some time to dereference them all. I&apos;ll see if there is any chance to optimize the process&lt;/p&gt;</comment>
                            <comment id="17764358" author="msahyoun" created="Tue, 12 Sep 2023 19:58:57 +0000"  >&lt;p&gt;we could add a benchmark to the benchmark package with the sample so track optimizations and also help find regressions later on. WDYT?&lt;/p&gt;</comment>
                            <comment id="17766472" author="jira-bot" created="Mon, 18 Sep 2023 16:48:54 +0000"  >&lt;p&gt;Commit 1912400 from lehmi@apache.org in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1912400&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1912400&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5682&quot; title=&quot;Long/permanent hang in PDFBox 3.x&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5682&quot;&gt;&lt;del&gt;PDFBOX-5682&lt;/del&gt;&lt;/a&gt;: don&apos;t use hashCode as key to avoid collisions&lt;/p&gt;</comment>
                            <comment id="17766473" author="jira-bot" created="Mon, 18 Sep 2023 16:49:17 +0000"  >&lt;p&gt;Commit 1912401 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1912401&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1912401&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5682&quot; title=&quot;Long/permanent hang in PDFBox 3.x&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5682&quot;&gt;&lt;del&gt;PDFBOX-5682&lt;/del&gt;&lt;/a&gt;: don&apos;t use hashCode as key to avoid collisions&lt;/p&gt;</comment>
                            <comment id="17766479" author="lehmi" created="Mon, 18 Sep 2023 17:01:47 +0000"  >&lt;p&gt;I&apos;ve found the reason for the regression. BaseParser implements a key cache for pdfs with huge cross reference tables. As it uses the hashCode of COSObjectKey as key for the underlying HashMap there were a chance for collisions so that the number of entries in the key cache might be smaller than the number of entries within the xref map. Every call of BaseParser.getObjectKey led to a rebuild of the key cache. The pdf in question contains 100k objects, so that in the end I&apos;m not suprised that this might take a while. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;However, I&apos;ve fixed that and now everything is speedy again &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt; please give it a try if possible, once the snapshot is available&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; Would it still make sense to have some benchmark?&lt;/p&gt;</comment>
                            <comment id="17766567" author="tallison@mitre.org" created="Mon, 18 Sep 2023 19:44:52 +0000"  >&lt;p&gt;Wow. Thank you!&lt;/p&gt;</comment>
                            <comment id="17773113" author="lehmi" created="Mon, 9 Oct 2023 06:11:49 +0000"  >&lt;p&gt;Set to resolved.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; I&apos;m planning to implement some performance tests in the context of some improvements/refactorings w.r.t. to the parser&lt;/p&gt;</comment>
                            <comment id="17773132" author="msahyoun" created="Mon, 9 Oct 2023 06:34:13 +0000"  >&lt;p&gt;Maybe some of the tooling used by the Apache Camel colleagues is useful too.&lt;br/&gt;
&lt;a href=&quot;https://camel.apache.org/blog/2023/05/camel-4-performance-improvements/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://camel.apache.org/blog/2023/05/camel-4-performance-improvements/&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 4 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1kae8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>