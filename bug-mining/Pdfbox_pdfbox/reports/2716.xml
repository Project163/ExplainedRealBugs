<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:13:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5149] 3.0.0-RC1: PDFCloneUtility is no longer accessible</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5149</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;PDFCloneUtility is no longer accessible by default. This is low level functionality, which is sometimes required and useful. PDFBox itself is low level, so I don&apos;t see why you would restrict access to this. Also this API is not really complicated nor unstable.&lt;/p&gt;

&lt;p&gt;For now I did a dirty workaround to access it (see&#160;&lt;a href=&quot;https://github.com/rototor/pdfbox-graphics2d/commit/5986bc653f83b2c06e5218ac906b9a9bc75f724e#diff-2113e77a03390c0cf920587a642fe7693e5b3c8402de783223035a79e13c2209R1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;). I would rather like to get rid of this workaround soon.&lt;/p&gt;

&lt;p&gt;Other than that, PDFBox-Graphics2d seems to work fine with PDFBox 3.0.0-RC1. I just released a 3.0.0-RC1 version of it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13369356">PDFBOX-5149</key>
            <summary>3.0.0-RC1: PDFCloneUtility is no longer accessible</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="rototor">Emmeran Seehuber</reporter>
                        <labels>
                    </labels>
                <created>Fri, 2 Apr 2021 20:14:46 +0000</created>
                <updated>Tue, 22 Aug 2023 05:41:58 +0000</updated>
                            <resolved>Tue, 22 Aug 2023 05:41:58 +0000</resolved>
                                    <version>3.0.0 PDFBox</version>
                                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17314252" author="tilman" created="Sat, 3 Apr 2021 12:11:04 +0000"  >&lt;p&gt;The problem was that people were misusing it&lt;br/&gt;
&lt;a href=&quot;https://stackoverflow.com/questions/50593597/pdfbox-clone-font&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/50593597/pdfbox-clone-font&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;See also &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3280&quot; title=&quot;PDDocument.importPage does not deep clone source page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3280&quot;&gt;PDFBOX-3280&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17314258" author="lehmi" created="Sat, 3 Apr 2021 13:24:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rototor&quot; class=&quot;user-hover&quot; rel=&quot;rototor&quot;&gt;rototor&lt;/a&gt; Thanks for the fast feedback on our first release candidate. Good to hear that most runs smoothly and nothing really serious came up. &lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;W.r.t. your issue. I had a look at your code (at least the affected part). You are calling the code in question exactly one time and I&apos;m wondering why at all. Maybe there is another way to solve that issue without making the class public again ...&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17314275" author="rototor" created="Sat, 3 Apr 2021 15:10:39 +0000"  >&lt;p&gt;I use PDFRenderer with my PdfBoxGraphics2D to &quot;rerender&quot; the PDFs and change certain aspects in the process. I.e. I do some kind of transformation on the PDF by rendering it.&lt;/p&gt;

&lt;p&gt;For a simple example look &lt;a href=&quot;https://github.com/rototor/pdfbox-graphics2d/blob/master/graphics2d/src/test/java/de/rototor/pdfbox/graphics2d/PdfRerenderTest.java#L123&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Depending on what I want to do I want to preserve as much of the original PDF as possible. So I also try to preserve the PDShadings (this is the code using the clone utility). This works for most parts, only transparency groups get &quot;messed up&quot;, because they are rasterized as bitmaps by the PDFRenderer. I have already thought about would could be done to avoid that, but did not yet find time do some prototyping on this. I would like to be able to use PDFRenderer -&amp;gt; PdfBoxGraphics2D to process a PDF without loosing anything (i.e. also preserving all images in their full colorspace etc.). This could be used for all different kind of things. E.g. optimizing image resolution for web publishing or even implement a full PrePress PDF transformation (i.e. changing all colorspaces to be the same target CMYK, reduce resolution of image if they are way above what the print machine can do and so on).&lt;/p&gt;

&lt;p&gt;At the moment I use this to convert some seperation color shapes into forms for sleeve foils. I.e. if you have some printed wedding card with some gold foil on it, the gold foil is applied by an extra step. In this step the shape which should get gold is printed with a CMYK(1,1,1,1) color and then put through a sleeve foil machine which will put foil where the toner is on the paper. After this step the real content is printed on the card. I get one PDF which contains the pages including the seperation color, and I have to preprocess it to get a page with only the shape for the gold and a page with the &quot;normal&quot; colors of the page, but without the special color.&lt;/p&gt;

&lt;p&gt;So in the long term I would really like to be able to clone objects into new documents. Maybe adding PDCloneableObject interface and let all stuff which can really be safe cloned into a new document be implemented by it? Or just renaming PDFCloneUtility into something like COSInternalCloner? So that nobody finds it if he not really knows what he wants?&lt;/p&gt;</comment>
                            <comment id="17315794" author="rototor" created="Tue, 6 Apr 2021 19:11:13 +0000"  >&lt;p&gt;I&apos;ve renamed my accessor class in PDFBox-Graphics2D to&#160;InternalDeprecatedCOSCloner now and added a&#160;@Deprecation annotation to it. So hopefully no one will find / use it...&lt;/p&gt;

&lt;p&gt;From my POV this is fine for now, as it works as long as PDFBox is not built and used as a Java 9 module. Because then this would no longer work.&lt;/p&gt;

&lt;p&gt;So I don&apos;t think that there is an urgent need at the moment to find a better solution.&lt;/p&gt;</comment>
                            <comment id="17561765" author="jira-bot" created="Sat, 2 Jul 2022 16:15:39 +0000"  >&lt;p&gt;Commit 1902412 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1902412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1902412&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5149&quot; title=&quot;3.0.0-RC1: PDFCloneUtility is no longer accessible&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5149&quot;&gt;&lt;del&gt;PDFBOX-5149&lt;/del&gt;&lt;/a&gt;: limit cloning to COSBase-objects, refactor cloneMerge, limit merge to COSArray and COSDictionary as it doesn&apos;t make sense to merge COSStreams&lt;/p&gt;</comment>
                            <comment id="17561768" author="lehmi" created="Sat, 2 Jul 2022 16:34:49 +0000"  >&lt;p&gt;After doing some basic refactoring I&apos;ve realised that we need to overhaul the code to clear up things:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;the cloning is limited to COSBase objects. The former code accepted PD-objects as well but cloned the underlying COSBase object and returned that clone. The input type didn&apos;t match the output type which is kind of disturbing. But IMHO the most important point is, now it should be clear that one can&apos;t simply clone a PD-object such as a PDFont, a PDPage or a whole PDDocument by calling &lt;tt&gt;cloneForNewDocument&lt;/tt&gt;. It is limited to COSBase objects. Hopefully something which indicates that cloning is expert stuff&lt;/li&gt;
	&lt;li&gt;merging is limited to COSArray and COSDictionary. The former code for merging COSStreams was buggy and more important is doesn&apos;t make sense to merge COSStreams in a simple way. Things like fonts, images can&apos;t be merged. Contentstreams can be merged by creating an array of streams. Compressed object stream can be theretically &quot;merged&quot; by decompressing the single COSStreams and repacking them. But that doesn&apos;t make sense.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Maybe the usecase for &lt;tt&gt;PDFCloneUtility&lt;/tt&gt; is clearer now and it is (safer!?!?) to make in public again. And, yes we should add some javadoc comment. WDYT?&lt;/p&gt;</comment>
                            <comment id="17561834" author="rototor" created="Sun, 3 Jul 2022 10:18:16 +0000"  >&lt;p&gt;Looks good to me. It may make sense to make to make cloneForNewDocument generic. Would save some casts. And of course public again. I.e. I would like to have this patch applied:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
--- a/pdfbox/src/main/java/org/apache/pdfbox/multipdf/PDFCloneUtility.java
+++ b/pdfbox/src/main/java/org/apache/pdfbox/multipdf/PDFCloneUtility.java
@@ -39,7 +39,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.pdmodel.common.COSObjectable;
  * Utility &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;used to clone PDF objects. It keeps track of objects it has already cloned.
  *
  */
-&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PDFCloneUtility
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PDFCloneUtility
 {
     &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Log LOG = LogFactory.getLog(PDFCloneUtility.class);

@@ -77,7 +77,8 @@ &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PDFCloneUtility
      * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the cloned instance of the base object
      * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; an I/O error occurs
      */
-    COSBase cloneForNewDocument(COSBase base) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
+    @SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;unchecked&quot;&lt;/span&gt;)
+    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &amp;lt;TCOSBase &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; COSBase&amp;gt; TCOSBase cloneForNewDocument(TCOSBase base) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
     {
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (base == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
         {
@@ -87,7 +88,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PDFCloneUtility
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (retval != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
         {
             &lt;span class=&quot;code-comment&quot;&gt;// we are done, it has already been converted.
&lt;/span&gt;-            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; retval;
+            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (TCOSBase)retval;
         }
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (clonedValues.contains(base))
         {
@@ -97,7 +98,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PDFCloneUtility
         retval = cloneCOSBaseForNewDocument((COSBase)base);
         clonedVersion.put(base, retval);
         clonedValues.add(retval);
-        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; retval;
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (TCOSBase)retval;
     }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;No idea regarding the MergeUtility. I don&apos;t use that directly. (And regarding merging ContentStream COSStream: I had to learn the hard way, that you can only place ContentStreams of Pages in an array. It is not allowed for XForms. PDFBox incorrectly just accepts that, but Acrobat etc. doesn&apos;t really like that...)&lt;/p&gt;</comment>
                            <comment id="17561863" author="tilman" created="Sun, 3 Jul 2022 13:09:49 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="17561911" author="jira-bot" created="Sun, 3 Jul 2022 16:39:24 +0000"  >&lt;p&gt;Commit 1902433 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1902433&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1902433&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5149&quot; title=&quot;3.0.0-RC1: PDFCloneUtility is no longer accessible&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5149&quot;&gt;&lt;del&gt;PDFBOX-5149&lt;/del&gt;&lt;/a&gt;: make class public again, add generic type as proposed by Emmeran Seehuber&lt;/p&gt;</comment>
                            <comment id="17562016" author="lehmi" created="Mon, 4 Jul 2022 05:49:10 +0000"  >&lt;p&gt;I guess we are done here. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rototor&quot; class=&quot;user-hover&quot; rel=&quot;rototor&quot;&gt;rototor&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; thanks for the input&lt;/p&gt;</comment>
                            <comment id="17757093" author="rototor" created="Mon, 21 Aug 2023 20:43:40 +0000"  >&lt;p&gt;Sorry, we are not done here &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;The constructor of PDFCloneUtility is package private. I did not have a problem with this, because I did an ugly workaround in my pdfbox-graphics2d 3.0.0 branch. I created a derived class InternalDeprecatedCOSCloner in the org.apache.pdfbox.multipdf package inside my project. And could access the constructor.&lt;/p&gt;

&lt;p&gt;This works fine as long as you don&apos;t plan to use the JPMS modules introduced with Java 9. Which I personally don&apos;t plan every to do.&lt;/p&gt;

&lt;p&gt;But it seems Apache POI is going to use those JPMS modules, at least &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fanningpj&quot; class=&quot;user-hover&quot; rel=&quot;fanningpj&quot;&gt;fanningpj&lt;/a&gt; is trying to get POI working with PDFBox 3.0.0 and my pdfbox-graphics2d with version 3.0.0. And now he gets a not so nice&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
&lt;tt&gt;/Users/pj.fanning/svn/poi/poi-ooxml/src/main/java9/module-info.java:18: error: module org.apache.poi.ooxml reads package org.apache.pdfbox.multipdf from both de.rototor.pdfbox.graphics2d and org.apache.pdfbox&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;As the - to be honest rather dirty - workaround done be me no longer works with JPMS...&lt;/p&gt;

&lt;p&gt;You can find the concrete usage for the cloner here &lt;a href=&quot;https://github.com/rototor/pdfbox-graphics2d/blob/master/graphics2d/src/main/java/de/rototor/pdfbox/graphics2d/PdfBoxGraphics2DPaintApplier.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rototor/pdfbox-graphics2d/blob/master/graphics2d/src/main/java/de/rototor/pdfbox/graphics2d/PdfBoxGraphics2DPaintApplier.java&lt;/a&gt;. Just search for PDFCloneUtility. I use it to clone PDShading when I&apos;m &quot;rewriting&quot; PDFs. I.e. I use PDFBox to draw on my Graphics2D adapter to create new PDFs and filter / change stuff in the PDF on the fly. Mostly to split PDFs for Seperation colors and such stuff.&lt;/p&gt;

&lt;p&gt;Just making the PDFClonerUtility constructor public again would of course work. But I&apos;m not sure that this is the right solution. AFAIR it was made package private because of many problems of users which did not really understand what this class was for.&lt;/p&gt;

&lt;p&gt;The &quot;downstream&quot; bug is here: &lt;a href=&quot;https://github.com/rototor/pdfbox-graphics2d/issues/56&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/rototor/pdfbox-graphics2d/issues/56&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Maybe a solution could be to make the constructor protected and create a package private getCloner() factory method? That would allow me to derive from the class from outside the original package but would also prevent people who don&apos;t know for sure that they really want to use this class from using it.&lt;/p&gt;</comment>
                            <comment id="17757208" author="lehmi" created="Tue, 22 Aug 2023 05:41:58 +0000"  >&lt;p&gt;Please don&apos;t reopen tickets which belong to already released versions.&lt;/p&gt;

&lt;p&gt;In cases like this we rely on the feedback of the user and you gave as a positive one when Tilman committed the last changes a year ago. You never came back in the past year, so that we had to assume that everything is fine and closed the ticket.&lt;/p&gt;

&lt;p&gt;Unfortunately there is a missing piece, the private constructor. I understand the issue and I support any reasonable solution. Please open a new ticket and we&apos;ll see which solution seems to be the best one.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0pht4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>