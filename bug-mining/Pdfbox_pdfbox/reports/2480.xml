<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:11:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4398] getLastSignatureDictionary modifies internal structure of PDDocument</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4398</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;If one calls PDDocument#getLastSignatureDictionary, the AcroFrom is populated with the defaults even if not needed. This modifies the internals of the PDDocument and therefore there are changes to be saved, even if the file is not modified by &quot;real&quot; changes.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
            PDDocument pdfDocument = PDDocument.load(pdfBytes);
            pdfDocument.getLastSignatureDictionary();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This calls the verifyOrCreateDefaults() method, which initializes the DR-Dictionary if not yet done. This is even done if getLastSignatureDictionary returns null.&lt;/p&gt;

&lt;p&gt;Why this bothers me: it is very unexpected behaviour that a getter modifies an objects state. This is no big deal for our usecase, the other issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4303&quot; title=&quot;Helv and ZaDb overridden&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4303&quot;&gt;&lt;del&gt;PDFBOX-4303&lt;/del&gt;&lt;/a&gt;) was a bigger problem as we are diffing objects between revisions (current vs last signed revision).&lt;/p&gt;</description>
                <environment></environment>
        <key id="13202745">PDFBOX-4398</key>
            <summary>getLastSignatureDictionary modifies internal structure of PDDocument</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="msahyoun">Maruan Sahyoun</assignee>
                                    <reporter username="weisskopf">beat weisskopf</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Dec 2018 10:35:24 +0000</created>
                <updated>Fri, 19 Mar 2021 15:41:42 +0000</updated>
                            <resolved>Tue, 9 Mar 2021 17:48:49 +0000</resolved>
                                    <version>2.0.12</version>
                                    <fixVersion>2.0.23</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>AcroForm</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16711279" author="tilman" created="Thu, 6 Dec 2018 11:00:13 +0000"  >&lt;p&gt;This was introduced in&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3732&quot; title=&quot;IllegalArgumentException when refreshing an appearance and no font resources are defined&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3732&quot;&gt;&lt;del&gt;PDFBOX-3732&lt;/del&gt;&lt;/a&gt; and also badly needed by &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4393&quot; title=&quot;PDF signature invalid after second interactive field signed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4393&quot;&gt;&lt;del&gt;PDFBOX-4393&lt;/del&gt;&lt;/a&gt;. Yes such side effects are usually a no-no but we replicated the behavior of Adobe. See also the ending comment by Maruan in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3732&quot; title=&quot;IllegalArgumentException when refreshing an appearance and no font resources are defined&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3732&quot;&gt;&lt;del&gt;PDFBOX-3732&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;From your text I understand that it bothers you, but it doesn&apos;t break anything. So I&apos;d just target this to 3.0 and keep 2.x as is. I won&apos;t do anything for now.&lt;/p&gt;</comment>
                            <comment id="16711372" author="weisskopf" created="Thu, 6 Dec 2018 12:24:00 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I won&apos;t do anything for now.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s ok for me. Thanks for all the work!&lt;/p&gt;</comment>
                            <comment id="17265093" author="tilman" created="Thu, 14 Jan 2021 18:06:55 +0000"  >&lt;p&gt;I suspect that this issue is moot, with the &quot;Fixup&quot; changes done by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17265101" author="msahyoun" created="Thu, 14 Jan 2021 18:15:01 +0000"  >&lt;p&gt;initiated by &lt;tt&gt;pdfDocument.getLastSignatureDictionary()&lt;/tt&gt; a call is done &lt;tt&gt;PDAcroForm acroForm = getDocumentCatalog().getAcroForm();&lt;/tt&gt; which does apply the fixups. If I understand the ticket correctly the call shall be done without applying the fixups (if not done before). For that &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
PDAcroForm acroForm = getDocumentCatalog().getAcroForm()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in &lt;tt&gt;public List&amp;lt;PDSignatureField&amp;gt; getSignatureFields()&lt;/tt&gt; would need to be changed to &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
PDAcroForm acroForm = getDocumentCatalog().getAcroForm(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17265118" author="tilman" created="Thu, 14 Jan 2021 18:40:07 +0000"  >&lt;p&gt;Indeed, thanks. I&apos;ll fix that tomorrow unless you do it first.&lt;/p&gt;</comment>
                            <comment id="17265135" author="jira-bot" created="Thu, 14 Jan 2021 19:04:52 +0000"  >&lt;p&gt;Commit 1885495 from Maruan Sahyoun in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1885495&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1885495&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4398&quot; title=&quot;getLastSignatureDictionary modifies internal structure of PDDocument&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4398&quot;&gt;&lt;del&gt;PDFBOX-4398&lt;/del&gt;&lt;/a&gt;: access AcroForm for signature creation without applying fixes&lt;/p&gt;</comment>
                            <comment id="17265137" author="msahyoun" created="Thu, 14 Jan 2021 19:05:40 +0000"  >&lt;p&gt;I&apos;ve also changed the AcroForm access in &lt;tt&gt;addSignature&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17265145" author="jira-bot" created="Thu, 14 Jan 2021 19:13:12 +0000"  >&lt;p&gt;Commit 1885497 from Maruan Sahyoun in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1885497&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1885497&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4398&quot; title=&quot;getLastSignatureDictionary modifies internal structure of PDDocument&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4398&quot;&gt;&lt;del&gt;PDFBOX-4398&lt;/del&gt;&lt;/a&gt;: access AcroForm for signature creation without applying fixes&lt;/p&gt;</comment>
                            <comment id="17265275" author="msahyoun" created="Thu, 14 Jan 2021 21:02:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; could you do a quick review of the changes as you are more familiar with the signature part? Should be fine I think.&lt;/p&gt;</comment>
                            <comment id="17265694" author="tilman" created="Fri, 15 Jan 2021 05:01:55 +0000"  >&lt;p&gt;I wonder whether this should also done for all CreateSignature examples too.&lt;/p&gt;</comment>
                            <comment id="17265843" author="msahyoun" created="Fri, 15 Jan 2021 09:09:17 +0000"  >&lt;p&gt;Think so if they don&apos;t depend on the AcroForm default resources being added automatically before signing.&lt;/p&gt;</comment>
                            <comment id="17266150" author="mkl" created="Fri, 15 Jan 2021 16:01:06 +0000"  >&lt;p&gt;I would be cautious applying any fixups automatically if the examples are meant to work for already signed input, too. In that case well-meant fixups can invalidate the existing signatures.&lt;/p&gt;</comment>
                            <comment id="17266578" author="jira-bot" created="Sat, 16 Jan 2021 11:42:32 +0000"  >&lt;p&gt;Commit 1885554 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1885554&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1885554&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4398&quot; title=&quot;getLastSignatureDictionary modifies internal structure of PDDocument&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4398&quot;&gt;&lt;del&gt;PDFBOX-4398&lt;/del&gt;&lt;/a&gt;: avoid modifying any acroform related stuff, because this could invalidate existing signatures&lt;/p&gt;</comment>
                            <comment id="17266579" author="jira-bot" created="Sat, 16 Jan 2021 11:42:35 +0000"  >&lt;p&gt;Commit 1885555 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1885555&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1885555&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4398&quot; title=&quot;getLastSignatureDictionary modifies internal structure of PDDocument&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4398&quot;&gt;&lt;del&gt;PDFBOX-4398&lt;/del&gt;&lt;/a&gt;: avoid modifying any acroform related stuff, because this could invalidate existing signatures&lt;/p&gt;</comment>
                            <comment id="17297501" author="tilman" created="Mon, 8 Mar 2021 16:21:01 +0000"  >&lt;p&gt;Are we done here?&lt;/p&gt;</comment>
                            <comment id="17297614" author="msahyoun" created="Mon, 8 Mar 2021 18:08:08 +0000"  >&lt;p&gt;AFAIK yes&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13058559">PDFBOX-3732</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13202221">PDFBOX-4393</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13181918">PDFBOX-4303</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 35 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s018dc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>