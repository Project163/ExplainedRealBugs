<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:03:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3401] PDObjectReference getReferencedObject() returns null if referenced obj is not a COSStream</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3401</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;When creating a pdf I am setting a PDAnnotation as the referenced object of a PDObjectReference using setReferencedObject.&lt;/p&gt;

&lt;p&gt;When I subsequently load the same document and then call getReferencedObject on the PDObjectReference, null is returned. This is because an exception is thrown in PDXObject.createXObject (called inside getReferencedObject) as the referenced object is not a COSStream, just a COSDictionary.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12983758">PDFBOX-3401</key>
            <summary>PDObjectReference getReferencedObject() returns null if referenced obj is not a COSStream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="mark.melling@savageminds.com">Mark Melling</reporter>
                        <labels>
                            <label>StructureTree</label>
                    </labels>
                <created>Mon, 27 Jun 2016 12:31:21 +0000</created>
                <updated>Sat, 24 Mar 2018 09:41:33 +0000</updated>
                            <resolved>Fri, 10 Nov 2017 20:41:54 +0000</resolved>
                                    <version>1.8.9</version>
                    <version>2.0.2</version>
                    <version>2.0.3</version>
                    <version>3.0.0 PDFBox</version>
                                    <fixVersion>2.0.9</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15351266" author="jira-bot" created="Mon, 27 Jun 2016 15:42:00 +0000"  >&lt;p&gt;Commit 1750362 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1750362&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1750362&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3401&quot; title=&quot;PDObjectReference getReferencedObject() returns null if referenced obj is not a COSStream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3401&quot;&gt;&lt;del&gt;PDFBOX-3401&lt;/del&gt;&lt;/a&gt;: call PDXObject.createXObject() only if parameter is a COSStream&lt;/p&gt;</comment>
                            <comment id="15351267" author="jira-bot" created="Mon, 27 Jun 2016 15:42:16 +0000"  >&lt;p&gt;Commit 1750363 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1750363&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1750363&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3401&quot; title=&quot;PDObjectReference getReferencedObject() returns null if referenced obj is not a COSStream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3401&quot;&gt;&lt;del&gt;PDFBOX-3401&lt;/del&gt;&lt;/a&gt;: call PDXObject.createXObject() only if parameter is a COSStream&lt;/p&gt;</comment>
                            <comment id="15351274" author="tilman" created="Mon, 27 Jun 2016 15:44:49 +0000"  >&lt;p&gt;Are you sure that the error happens in 1.8.9? I had a look and from what I saw, &lt;tt&gt;PDXObject.createXObject(obj);&lt;/tt&gt; would return null if not called with a &lt;tt&gt;COSStream&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;A snapshot should be available within a few hours. Please test and give feedback.&lt;/p&gt;</comment>
                            <comment id="15356689" author="mark.melling@savageminds.com" created="Thu, 30 Jun 2016 07:47:54 +0000"  >&lt;p&gt;Sorry, it looks like I was wrong regarding 1.8.9. I was in fact using this (&lt;a href=&quot;https://github.com/TomRoush/PdfBox-Android&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/TomRoush/PdfBox-Android&lt;/a&gt;) Android version of PDFBox, which says is based on 1.8.9. But looking at the source it looks like this is not the case. &lt;/p&gt;</comment>
                            <comment id="15357450" author="tilman" created="Thu, 30 Jun 2016 16:49:19 +0000"  >&lt;p&gt;Yes, I think it&apos;s both, this&lt;br/&gt;
&lt;a href=&quot;https://github.com/TomRoush/PdfBox-Android/tree/master/library/src/main/java/org/apache/pdfbox/pdmodel/graphics/image&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/TomRoush/PdfBox-Android/tree/master/library/src/main/java/org/apache/pdfbox/pdmodel/graphics/image&lt;/a&gt;&lt;br/&gt;
is clearly from 2.0.&lt;/p&gt;</comment>
                            <comment id="15357455" author="tilman" created="Thu, 30 Jun 2016 16:51:32 +0000"  >&lt;p&gt;Does this mean you can&apos;t test it, you will make the change in PDFBox for Android and test it there? Or ask its Author to make the change?&lt;/p&gt;</comment>
                            <comment id="15357460" author="mark.melling@savageminds.com" created="Thu, 30 Jun 2016 16:54:01 +0000"  >&lt;p&gt;I can make the change in PDFBox for Android and test it.&lt;/p&gt;</comment>
                            <comment id="15369144" author="tilman" created="Sat, 9 Jul 2016 15:39:37 +0000"  >&lt;p&gt;Any news on this?&lt;/p&gt;</comment>
                            <comment id="15410637" author="tilman" created="Sat, 6 Aug 2016 15:36:10 +0000"  >&lt;p&gt;While I still think that my fix is correct, there is something else that doesn&apos;t work at all. I used the code below to test my change but I didn&apos;t go very far:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDDocument doc = PDDocument.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;000671.pdf&quot;&lt;/span&gt;)))
        {
            PDStructureTreeRoot structureTreeRoot = doc.getDocumentCatalog().getStructureTreeRoot();
            PDNumberTreeNode parentTree = structureTreeRoot.getParentTree();
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (PDNumberTreeNode ntn : parentTree.getKids())
            {
                Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, COSObjectable&amp;gt; numbers = ntn.getNumbers();
                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Map.Entry&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, COSObjectable&amp;gt; entry : numbers.entrySet())
                {
                    COSObjectable val = entry.getValue();
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (val &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; COSDictionary)
                    {
                        PDStructureTreeRoot str = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDStructureTreeRoot((COSDictionary) val);
                        COSArray kArray = str.getKArray();
                        PDObjectReference objRef = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDObjectReference((COSDictionary) kArray.getObject(0));
                        COSObjectable referencedObject = objRef.getReferencedObject();
                        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (referencedObject != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
                        {
                            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Yes!!! ReferencedObject: &quot;&lt;/span&gt; + referencedObject.getClass());
                        }
                        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
                        {
                            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; :-(&quot;&lt;/span&gt;);
                        }
                    }
                }
            }
        }

Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.io.IOException: Error &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; trying to create value in number tree:org.apache.pdfbox.cos.COSBase.&amp;lt;init&amp;gt;(org.apache.pdfbox.cos.COSArray)
	at org.apache.pdfbox.pdmodel.common.PDNumberTreeNode.convertCOSToPD(PDNumberTreeNode.java:218)
	at org.apache.pdfbox.pdmodel.common.PDNumberTreeNode.getNumbers(PDNumberTreeNode.java:189)
	at pdfboxpageimageextraction.PDFBox3401.main(PDFBox3401.java:31)
Caused by: java.lang.NoSuchMethodException: org.apache.pdfbox.cos.COSBase.&amp;lt;init&amp;gt;(org.apache.pdfbox.cos.COSArray)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getConstructor0(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:2892)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.getConstructor(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:1723)
	at org.apache.pdfbox.pdmodel.common.PDNumberTreeNode.convertCOSToPD(PDNumberTreeNode.java:212)
	... 2 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;PDNumberTreeNode.convertCOSToPD() expects the valueType (here: COSBase) to have a constructor that accepts a COSArray as parameter. COSBase does not have any constructor with parameters.&lt;/p&gt;</comment>
                            <comment id="15410650" author="tilman" created="Sat, 6 Aug 2016 16:20:19 +0000"  >&lt;p&gt;Some random thoughts for a later time:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Annotation can be found here: &lt;tt&gt;Root/StructTreeRoot/ParentTree/Kids/[1]/Nums/[1]/[65]/K/[0]/Obj&lt;/tt&gt; in 000671.pdf&lt;/li&gt;
	&lt;li&gt;code was introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-90&quot; title=&quot;Support explicit retrieval of page labels&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-90&quot;&gt;&lt;del&gt;PDFBOX-90&lt;/del&gt;&lt;/a&gt; for page labels&lt;/li&gt;
	&lt;li&gt;the use of &lt;tt&gt;convertCOSToPD&lt;/tt&gt; was probably copied from other classes&lt;/li&gt;
	&lt;li&gt;a node in a structure number tree can be a reference or an array of references, i.e. it will never be a PD object&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16125715" author="eruiz0" created="Mon, 14 Aug 2017 14:08:01 +0000"  >&lt;p&gt;Hello. I&apos;m facing the same issue.&lt;/p&gt;

&lt;p&gt;I have tryied changing a local copy of pdfbox sources, line 165 in ./pdfbox/src/main/java/org/apache/pdfbox/pdmodel/common/PDNumberTreeNode.java: &lt;br/&gt;
&lt;tt&gt;COSObjectable pdValue = convertCOSToPD( cosValue );&lt;/tt&gt;&lt;br/&gt;
for&lt;br/&gt;
&lt;tt&gt;COSObjectable pdValue = (COSObjectable)  cosValue ;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;That solved the issue in my case (the node contained a reference, maybe it fails with an array of references?) &lt;/p&gt;</comment>
                            <comment id="16247860" author="tilman" created="Fri, 10 Nov 2017 18:02:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eruiz0&quot; class=&quot;user-hover&quot; rel=&quot;eruiz0&quot;&gt;eruiz0&lt;/a&gt; Your change avoids the exception mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4003&quot; title=&quot;Can&amp;#39;t retrieve number tree from structure tree&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4003&quot;&gt;&lt;del&gt;PDFBOX-4003&lt;/del&gt;&lt;/a&gt; (I&apos;ve added you as a watcher there), but it fails several build tests.&lt;/p&gt;</comment>
                            <comment id="16248012" author="jira-bot" created="Fri, 10 Nov 2017 20:39:55 +0000"  >&lt;p&gt;Commit 1814912 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1814912&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1814912&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3401&quot; title=&quot;PDObjectReference getReferencedObject() returns null if referenced obj is not a COSStream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3401&quot;&gt;&lt;del&gt;PDFBOX-3401&lt;/del&gt;&lt;/a&gt;: improve class javadoc&lt;/p&gt;</comment>
                            <comment id="16248013" author="jira-bot" created="Fri, 10 Nov 2017 20:40:00 +0000"  >&lt;p&gt;Commit 1814913 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1814913&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1814913&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3401&quot; title=&quot;PDObjectReference getReferencedObject() returns null if referenced obj is not a COSStream&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3401&quot;&gt;&lt;del&gt;PDFBOX-3401&lt;/del&gt;&lt;/a&gt;: improve class javadoc&lt;/p&gt;</comment>
                            <comment id="16248014" author="tilman" created="Fri, 10 Nov 2017 20:41:54 +0000"  >&lt;p&gt;Setting to resolved. I looked at my old commit again and I&apos;m still fine with it. The other problem is being handled in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4003&quot; title=&quot;Can&amp;#39;t retrieve number tree from structure tree&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4003&quot;&gt;&lt;del&gt;PDFBOX-4003&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12822435" name="000671.pdf" size="867979" author="tilman" created="Sat, 6 Aug 2016 15:37:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i306jz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>