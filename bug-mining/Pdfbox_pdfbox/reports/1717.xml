<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:05:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3752] PDVariableText text color changes to be the same as the background color after flattening</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3752</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;PDVariableText text color changes to be the same as the background color after flattening.  This effectively makes the text hidden and appear to be lost. &lt;br/&gt;
 This includes field types such as ListBox and TextField.  I don&apos;t believe I have tested a combo box.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;(PDDocument pdfDocument = PDDocument.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/travis/Desktop/fdpAttachment2.pdf&quot;&lt;/span&gt;))) {

            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PDDocumentCatalog docCatalog = pdfDocument.getDocumentCatalog();
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PDAcroForm acroForm = docCatalog.getAcroForm();

            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PDField textField = acroForm.getField(&lt;span class=&quot;code-quote&quot;&gt;&quot;Subaward &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt;&quot;&lt;/span&gt;);
            textField.setValue(&lt;span class=&quot;code-quote&quot;&gt;&quot;12345&quot;&lt;/span&gt;);

            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PDField listBoxField = acroForm.getField(&lt;span class=&quot;code-quote&quot;&gt;&quot;Contact &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; carryforward&quot;&lt;/span&gt;);
            listBoxField.setValue(&lt;span class=&quot;code-quote&quot;&gt;&quot;Administrative Contact&quot;&lt;/span&gt;);


            &lt;span class=&quot;code-comment&quot;&gt;//when flattening with refreshAppearances, a NPE will occur &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; each widget doesn&apos;t have a
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;//PDAppearanceDictionary instance with a normal PDAppearanceEntry instance set PDFBOX-3751
&lt;/span&gt;            pdfDocument.getDocumentCatalog().getAcroForm().getFields()
                    .stream()
                    .flatMap(f -&amp;gt; f.getWidgets().stream())
                    .filter(w -&amp;gt; w.getAppearance() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
                    .forEach(w -&amp;gt; {
                        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PDAppearanceDictionary appearance = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDAppearanceDictionary(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; COSDictionary());
                        appearance.setNormalAppearance(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDAppearanceEntry(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; COSDictionary()));
                        w.setAppearance(appearance);
                    });

pdfDocument.getDocumentCatalog().getAcroForm().flatten(pdfDocument.getDocumentCatalog().getAcroForm().getFields(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
            pdfDocument.save(&lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/travis/Desktop/fdpAttachment2-example-flattened.pdf&quot;&lt;/span&gt;);
        }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice in the attached fdpAttachment2-example-flattened.pdf, the fields are correctly set but the text is not visible.&lt;/p&gt;

&lt;p&gt;If I execute the same code but do not flatten, the text is visible for certain field types in certain pdf viewers.  See attached fdpAttachment2-example-not-flattened.pdf&lt;br/&gt;
In Adobe Acrobat Reader DC build 15.23.20056.213124 the &quot;Subaward Number&quot; field shows up but only when clicking on the field.  When using the Preview app in MacOS Sierra, it is visible.  In both apps the &quot;Contact for carryforward&quot; list box shows the text &quot;Administrative Contact&quot;&lt;/p&gt;

&lt;p&gt;As a side note I wonder if the behavior of the &quot;Subaward Number&quot; in relation to different pdf views may be related to a difference problem.  I think the real issue here is the text color.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13063482">PDFBOX-3752</key>
            <summary>PDVariableText text color changes to be the same as the background color after flattening</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="msahyoun">Maruan Sahyoun</assignee>
                                    <reporter username="leo.herbie">Travis Schneeberger</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Apr 2017 13:31:37 +0000</created>
                <updated>Thu, 8 Jun 2017 16:25:33 +0000</updated>
                            <resolved>Fri, 5 May 2017 14:17:16 +0000</resolved>
                                    <version>2.0.5</version>
                                    <fixVersion>2.0.6</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>AcroForm</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15965849" author="leo.herbie" created="Wed, 12 Apr 2017 13:33:04 +0000"  >&lt;p&gt;Original source file.&lt;/p&gt;</comment>
                            <comment id="15965851" author="leo.herbie" created="Wed, 12 Apr 2017 13:33:27 +0000"  >&lt;p&gt;Flattened File&lt;/p&gt;</comment>
                            <comment id="15969487" author="jira-bot" created="Fri, 14 Apr 2017 20:29:39 +0000"  >&lt;p&gt;Commit 1791407 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1791407&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1791407&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3752&quot; title=&quot;PDVariableText text color changes to be the same as the background color after flattening&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3752&quot;&gt;&lt;del&gt;PDFBOX-3752&lt;/del&gt;&lt;/a&gt;: support DeviceGray and DeviceCMYK operator for setting the font color in default appearance string&lt;/p&gt;</comment>
                            <comment id="15969489" author="msahyoun" created="Fri, 14 Apr 2017 20:32:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leo.herbie&quot; class=&quot;user-hover&quot; rel=&quot;leo.herbie&quot;&gt;leo.herbie&lt;/a&gt; could you test with the current trunk and let me know if that fixes your issue. If yes I&apos;ll apply the change to 2.0.6 too.&lt;/p&gt;</comment>
                            <comment id="15994651" author="jira-bot" created="Wed, 3 May 2017 10:51:24 +0000"  >&lt;p&gt;Commit 1793635 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1793635&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1793635&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3752&quot; title=&quot;PDVariableText text color changes to be the same as the background color after flattening&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3752&quot;&gt;&lt;del&gt;PDFBOX-3752&lt;/del&gt;&lt;/a&gt;: support DeviceGray and DeviceCMYK operator for setting the font color in default appearance string&lt;/p&gt;</comment>
                            <comment id="15998394" author="msahyoun" created="Fri, 5 May 2017 14:17:17 +0000"  >&lt;p&gt;setting to resolved &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leo.herbie&quot; class=&quot;user-hover&quot; rel=&quot;leo.herbie&quot;&gt;leo.herbie&lt;/a&gt; if there are still issues please reopen&lt;/p&gt;</comment>
                            <comment id="16042961" author="leo.herbie" created="Thu, 8 Jun 2017 16:25:33 +0000"  >&lt;p&gt;Retested and this is resolve for me too.  Thank you so much.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12863033" name="fdpAttachment2-example-flattened.pdf" size="3962195" author="leo.herbie" created="Wed, 12 Apr 2017 13:33:27 +0000"/>
                            <attachment id="12863037" name="fdpAttachment2-example-not-flattened.pdf" size="4073297" author="leo.herbie" created="Wed, 12 Apr 2017 13:43:41 +0000"/>
                            <attachment id="12863032" name="fdpAttachment2.pdf" size="4225145" author="leo.herbie" created="Wed, 12 Apr 2017 13:33:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3djav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>