<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:53:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1232] FlateDecoder in stream mode</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1232</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The zlib (the unlying spec for Flate compression) does not require an Z_STREAM_END to terminate the compression. The Java InflateInputStream is really assuming that you are reading a zip or gzip file which will always have a Z_STREAM_END (Z_STREAM_END is a constant in the zlib library which Java calls natively) . So the following chunk decodes fine using  the jcraft zlib decoder, but fails using the InflateInputStream.&lt;/p&gt;

&lt;p&gt;3 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/Type /XObject&lt;br/&gt;
/Subtype /Form&lt;br/&gt;
/FormType 1&lt;br/&gt;
/Resources &amp;lt;&amp;lt; /Font 4 0 R&lt;br/&gt;
/ProcSet &lt;span class=&quot;error&quot;&gt;&amp;#91;/PDF /ImageC /Text&amp;#93;&lt;/span&gt;&amp;gt;&amp;gt;&lt;br/&gt;
/BBox &lt;span class=&quot;error&quot;&gt;&amp;#91;0 0 595 842&amp;#93;&lt;/span&gt;&lt;br/&gt;
/Matrix &lt;span class=&quot;error&quot;&gt;&amp;#91;1 0 0 1 0 0&amp;#93;&lt;/span&gt;&lt;br/&gt;
/Filter /FlateDecode&lt;br/&gt;
/Length 5 &amp;gt;&amp;gt;&lt;br/&gt;
stream&lt;br/&gt;
H&amp;lt;89&amp;gt;&lt;sup&gt;C&lt;/sup&gt;@&lt;br/&gt;
endstream&lt;br/&gt;
endobj&lt;/p&gt;

&lt;p&gt;The blob is 72, -119, 3, 0, 13 decimal. It decodes to an empty string.&lt;/p&gt;


&lt;p&gt;The fix is to use Inflater and check to see if it has consumed all of the input buffer and make sure it has nothing to write into the output buffer.&lt;/p&gt;

&lt;p&gt;protected ByteArrayOutputStream decompress(InputStream in)&lt;br/&gt;
      throws IOException, DataFormatException&lt;br/&gt;
  {&lt;br/&gt;
      ByteArrayOutputStream out = new ByteArrayOutputStream();&lt;br/&gt;
      byte buf[] = new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;1000&amp;#93;&lt;/span&gt;;&lt;br/&gt;
      Inflater inflater = new Inflater();&lt;br/&gt;
      int read = in.read(buf);&lt;br/&gt;
      if(read == 0)&lt;/p&gt;
      {
              return out;
      }
&lt;p&gt;      inflater.setInput(buf,0,read);&lt;br/&gt;
      byte res[] = new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;1000&amp;#93;&lt;/span&gt;;&lt;br/&gt;
      while(true)&lt;br/&gt;
      {&lt;br/&gt;
              int resRead = inflater.inflate(res);&lt;br/&gt;
              if(resRead !=0)&lt;/p&gt;
              {
                      out.write(res,0,resRead);
                      continue;
              }
&lt;p&gt;              if(inflater.finished() || inflater.needsDictionary() ||  in.available()==0)&lt;/p&gt;
              {
                      out.close();
                      return out;
              }
&lt;p&gt;             read = in.read(buf);&lt;br/&gt;
             inflater.setInput(buf,0,read);&lt;/p&gt;

&lt;p&gt;      }&lt;br/&gt;
  }&lt;/p&gt;


&lt;p&gt;We then need to change FlateFilter.decode(InputStream compressedData, OutputStream result,&lt;br/&gt;
COSDictionary options, int filterIndex )&lt;/p&gt;

&lt;p&gt;to look like ...&lt;/p&gt;

&lt;p&gt; if (compressedData.available() &amp;gt; 0)&lt;br/&gt;
          {&lt;br/&gt;
              try&lt;/p&gt;
              {
                      baos =  decompress(compressedData);
              }
&lt;p&gt;if (predictor==-1 || predictor == 1 )&lt;/p&gt;
              {
                 result.write(baos.toByteArray());
              }
&lt;p&gt;else&lt;br/&gt;
{&lt;br/&gt;
 use the bytearrayoutput stream as before ...&lt;br/&gt;
}&lt;/p&gt;</description>
                <environment></environment>
        <key id="12543479">PDFBOX-1232</key>
            <summary>FlateDecoder in stream mode</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="dave.smith">Dave Smith</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Feb 2012 13:04:36 +0000</created>
                <updated>Tue, 29 May 2012 16:21:43 +0000</updated>
                            <resolved>Sat, 10 Mar 2012 15:20:46 +0000</resolved>
                                                    <fixVersion>1.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13225903" author="lehmi" created="Fri, 9 Mar 2012 07:11:56 +0000"  >&lt;p&gt;Just to be sure, what is the expected result of the decompression of the given 5 value stream?&lt;/p&gt;</comment>
                            <comment id="13226034" author="dave.smith" created="Fri, 9 Mar 2012 11:49:57 +0000"  >&lt;p&gt;Empty String ...&lt;/p&gt;</comment>
                            <comment id="13226040" author="lehmi" created="Fri, 9 Mar 2012 12:28:55 +0000"  >&lt;p&gt;Hmmm, ok, so the improvement is, that no exception is thrown and the stream is decoded. But why is the result empty, does this make sense? Can you share the pdf with us? If not can you share it with me in private?&lt;/p&gt;</comment>
                            <comment id="13226084" author="dave.smith" created="Fri, 9 Mar 2012 14:08:25 +0000"  >&lt;p&gt;Sent in private .&lt;/p&gt;</comment>
                            <comment id="13226877" author="lehmi" created="Sat, 10 Mar 2012 15:20:46 +0000"  >&lt;p&gt;I added the patch in revision 1299219 as proposed with some minor modifications. &lt;/p&gt;

&lt;p&gt;Thanks for the contribution!&lt;/p&gt;</comment>
                            <comment id="13226915" author="lehmi" created="Sat, 10 Mar 2012 18:08:33 +0000"  >&lt;p&gt;I fixed the usage of IOException in revision 1299245 as I used a wrong one by accident.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>228725</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zivr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>205361</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>