<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:04:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3572] AES-Decryption with Bouncycastle throws NullPointerException</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3572</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Using AES-Encryption with PdfBox and Bouncycastle yields a null pointer. When JCE is used everything works nicely:  com.sun.crypt.provider.AESCipher returns an empty byte array for the last 16 bytes of the metadata dictionary. Bouncycastle returns a null reference.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Demo.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Demo {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, NoSuchAlgorithmException, NoSuchPaddingException {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; password = &lt;span class=&quot;code-quote&quot;&gt;&quot;pw&quot;&lt;/span&gt;;
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; cipherString = &lt;span class=&quot;code-quote&quot;&gt;&quot;AES/CBC/PKCS5Padding&quot;&lt;/span&gt;;
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; testFilename = &lt;span class=&quot;code-quote&quot;&gt;&quot;test.pdf&quot;&lt;/span&gt;;

        PDDocument document = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDDocument();
        AccessPermission ap = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AccessPermission();
        ap.setReadOnly();

        StandardProtectionPolicy policy = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StandardProtectionPolicy(password, password, ap);
        policy.setEncryptionKeyLength(128);
        policy.setPreferAES(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        document.protect(policy);
        document.getDocumentInformation().setAuthor(&lt;span class=&quot;code-quote&quot;&gt;&quot;author&quot;&lt;/span&gt;);
        document.save(testFilename);
        document.close();

        &lt;span class=&quot;code-comment&quot;&gt;// Decryption with SunJCE works
&lt;/span&gt;        Cipher cipher = Cipher.getInstance(cipherString);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;Provider to use &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; %s decryption: %s\n&quot;&lt;/span&gt;, cipherString, cipher.getProvider());
        document = PDDocument.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(testFilename), password);

        Security.removeProvider(&lt;span class=&quot;code-quote&quot;&gt;&quot;SunJCE&quot;&lt;/span&gt;);

        &lt;span class=&quot;code-comment&quot;&gt;// Decryption with BouncyCastle fails with NPE
&lt;/span&gt;        cipher = Cipher.getInstance(cipherString);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;Provider to use &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; %s decryption: %s\n&quot;&lt;/span&gt;, cipherString, cipher.getProvider());
        document = PDDocument.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(testFilename), password);
    }

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Output with stacktrace&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Provider to use &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; AES/CBC/PKCS5Padding decryption: SunJCE version 1.8
Provider to use &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; AES/CBC/PKCS5Padding decryption: BC version 1.54
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.NullPointerException
	at java.io.OutputStream.write(OutputStream.java:75)
	at org.apache.pdfbox.pdmodel.encryption.SecurityHandler.encryptDataAESother(SecurityHandler.java:269)
	at org.apache.pdfbox.pdmodel.encryption.SecurityHandler.encryptData(SecurityHandler.java:152)
	at org.apache.pdfbox.pdmodel.encryption.SecurityHandler.decryptString(SecurityHandler.java:532)
	at org.apache.pdfbox.pdmodel.encryption.SecurityHandler.decrypt(SecurityHandler.java:391)
	at org.apache.pdfbox.pdmodel.encryption.SecurityHandler.decryptDictionary(SecurityHandler.java:512)
	at org.apache.pdfbox.pdmodel.encryption.SecurityHandler.decrypt(SecurityHandler.java:399)
	at org.apache.pdfbox.pdfparser.COSParser.parseFileObject(COSParser.java:798)
	at org.apache.pdfbox.pdfparser.COSParser.parseObjectDynamically(COSParser.java:726)
	at org.apache.pdfbox.pdfparser.COSParser.parseObjectDynamically(COSParser.java:657)
	at org.apache.pdfbox.pdfparser.COSParser.parseTrailerValuesDynamically(COSParser.java:2092)
	at org.apache.pdfbox.pdfparser.PDFParser.initialParse(PDFParser.java:201)
	at org.apache.pdfbox.pdfparser.PDFParser.parse(PDFParser.java:249)
	at org.apache.pdfbox.pdmodel.PDDocument.load(PDDocument.java:891)
	at org.apache.pdfbox.pdmodel.PDDocument.load(PDDocument.java:831)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This could possibly be fixed with a null check in the SecurityHandler before writing to the OutputStream.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13020835">PDFBOX-3572</key>
            <summary>AES-Decryption with Bouncycastle throws NullPointerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="markus.f">Markus Fensterer</reporter>
                        <labels>
                            <label>bouncycastle</label>
                            <label>decrypt</label>
                            <label>nullpointerexception</label>
                    </labels>
                <created>Tue, 15 Nov 2016 16:06:29 +0000</created>
                <updated>Sat, 25 Mar 2017 18:12:21 +0000</updated>
                            <resolved>Wed, 16 Nov 2016 08:39:50 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>2.0.1</version>
                    <version>2.0.2</version>
                    <version>2.0.3</version>
                                    <fixVersion>2.0.4</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Crypto</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15667803" author="jira-bot" created="Tue, 15 Nov 2016 17:59:05 +0000"  >&lt;p&gt;Commit 1769864 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1769864&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1769864&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3572&quot; title=&quot;AES-Decryption with Bouncycastle throws NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3572&quot;&gt;&lt;del&gt;PDFBOX-3572&lt;/del&gt;&lt;/a&gt;: avoid NPE due to BC sometimes returning null instead of an empty array&lt;/p&gt;</comment>
                            <comment id="15667804" author="jira-bot" created="Tue, 15 Nov 2016 17:59:11 +0000"  >&lt;p&gt;Commit 1769865 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1769865&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1769865&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3572&quot; title=&quot;AES-Decryption with Bouncycastle throws NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3572&quot;&gt;&lt;del&gt;PDFBOX-3572&lt;/del&gt;&lt;/a&gt;: avoid NPE due to BC sometimes returning null instead of an empty array&lt;/p&gt;</comment>
                            <comment id="15667824" author="tilman" created="Tue, 15 Nov 2016 18:06:17 +0000"  >&lt;p&gt;Is this what you had in mind? Please test with a snapshot (may take a few hours)&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.4-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.4-SNAPSHOT/&lt;/a&gt;&lt;br/&gt;
and give feedback. I can&apos;t reproduce it but I use a later BC version here.&lt;/p&gt;</comment>
                            <comment id="15669787" author="markus.f" created="Wed, 16 Nov 2016 08:12:14 +0000"  >&lt;p&gt;I tested it with the newest 2.0.4-SNAPSHOT and it works.&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i36cif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>