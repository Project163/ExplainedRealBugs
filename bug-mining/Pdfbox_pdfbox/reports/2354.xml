<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:10:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4814] Wrong COSType for OCProperties after merge</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4814</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;If you merge a PDF document with OCProperties to a PDF document without OCProperties, the result of the merge is that the OCProperties type is no longer a COSDictionary but a COSObject. If a third document with OCProperties is merged with the previously created merge result, this leads to the following ClassCastException:&lt;/p&gt;

&lt;p&gt;org.apache.pdfbox.cos.COSObject cannot be cast to org.apache.pdfbox.cos.COSDictionary at org.apache.pdfbox.multipdf.PDFCloneUtility.cloneMerge(PDFCloneUtility.java:227) at org.apache.pdfbox.multipdf.PDFCloneUtility.cloneMerge(PDFCloneUtility.java:229) at org.apache.pdfbox.multipdf.PDFMergerUtility.appendDocument(PDFMergerUtility.java:730) at pdfboxtest.Test.main(Test.java:38)&lt;/p&gt;

&lt;p&gt;According to PDF Specification, OCProperties is always a dictionary.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13298775">PDFBOX-4814</key>
            <summary>Wrong COSType for OCProperties after merge</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="kuelli">Andreas K&#252;llinger</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Apr 2020 10:58:12 +0000</created>
                <updated>Mon, 15 Jun 2020 04:54:04 +0000</updated>
                            <resolved>Thu, 16 Apr 2020 15:03:26 +0000</resolved>
                                    <version>2.0.19</version>
                                    <fixVersion>2.0.20</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17084791" author="tilman" created="Thu, 16 Apr 2020 11:45:04 +0000"  >&lt;p&gt;I tried to reproduce this but couldn&apos;t do so. (merge a document with OCG and one without and one with OCG; also merge a document without and one with OCG and one without)&lt;/p&gt;

&lt;p&gt;Can you share your PDF files?&lt;/p&gt;

&lt;p&gt;A &quot;COSObject&quot; is an indirect reference. Our code is somewhat suspicious there. I wonder if it fails because one dictionary is direct and one indirect.&lt;/p&gt;</comment>
                            <comment id="17084798" author="kuelli" created="Thu, 16 Apr 2020 11:50:13 +0000"  >&lt;p&gt;We try to reproduce it with test files.&lt;/p&gt;

&lt;p&gt;Our steps to reproduce it:&lt;/p&gt;

&lt;p&gt;The first file should have &quot;no ocg&quot;. Merge the file with &quot;ocg&quot; to the one &quot;without ocg&quot; and save it. Merge another file with ocg to the merged result.&lt;/p&gt;</comment>
                            <comment id="17084815" author="tilman" created="Thu, 16 Apr 2020 12:14:16 +0000"  >&lt;p&gt;Thanks, in the meantime I also found a way (very similar) to reproduce it.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        PDDocument doc1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDDocument();
        doc1.getDocumentCatalog().setOCProperties(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDOptionalContentProperties());
        doc1.addPage(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPage());
        ByteArrayOutputStream baos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream();
        doc1.save(baos);

        PDDocument doc2 = Loader.loadPDF(baos.toByteArray());

        PDFMergerUtility merger = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFMergerUtility();
        merger.appendDocument(doc2, doc1);
        
        
        doc2.close();
        doc1.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17084818" author="kuelli" created="Thu, 16 Apr 2020 12:19:37 +0000"  >&lt;p&gt;There is my easy code to reproduce it with merge utility:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; pdfboxtest;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.File;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.multipdf.PDFMergerUtility;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.pdmodel.PDDocument;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Test2
{

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args)
 {
 File f1 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;C:\\PDFnoocg.pdf&quot;&lt;/span&gt;);
 File f2 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;C:\\PDFocg1.pdf&quot;&lt;/span&gt;);
 File f3 = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;C:\\PDFocg2.pdf&quot;&lt;/span&gt;);
 File fr = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;C:\\merged.pdf&quot;&lt;/span&gt;);
 &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
 PDFMergerUtility merge = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFMergerUtility();
 PDDocument pd1 = PDDocument.load(f1);
 PDDocument pd2 = PDDocument.load(f2);
 PDDocument pd3 = PDDocument.load(f3);
 merge.appendDocument(pd1, pd2);
 pd1.save(fr);
 pd1.close();
 pd2.close();
 PDDocument pdr = PDDocument.load(fr);
 merge.appendDocument(pdr, pd3);
 pdr.save(fr);
 pdr.close();
 pd3.close();
 }
 &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
 &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error&quot;&lt;/span&gt; + e.getLocalizedMessage());
 e.printStackTrace();
 }
 }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17084849" author="jira-bot" created="Thu, 16 Apr 2020 13:04:41 +0000"  >&lt;p&gt;Commit 1876602 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1876602&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1876602&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4814&quot; title=&quot;Wrong COSType for OCProperties after merge&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4814&quot;&gt;&lt;del&gt;PDFBOX-4814&lt;/del&gt;&lt;/a&gt;: dereference COSArray and COSDictionary targets whe needed + test&lt;/p&gt;</comment>
                            <comment id="17084850" author="jira-bot" created="Thu, 16 Apr 2020 13:04:46 +0000"  >&lt;p&gt;Commit 1876603 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1876603&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1876603&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4814&quot; title=&quot;Wrong COSType for OCProperties after merge&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4814&quot;&gt;&lt;del&gt;PDFBOX-4814&lt;/del&gt;&lt;/a&gt;: dereference COSArray and COSDictionary targets whe needed + test&lt;/p&gt;</comment>
                            <comment id="17084851" author="jira-bot" created="Thu, 16 Apr 2020 13:04:51 +0000"  >&lt;p&gt;Commit 1876604 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1876604&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1876604&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4814&quot; title=&quot;Wrong COSType for OCProperties after merge&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4814&quot;&gt;&lt;del&gt;PDFBOX-4814&lt;/del&gt;&lt;/a&gt;: dereference COSArray and COSDictionary targets whe needed + test&lt;/p&gt;</comment>
                            <comment id="17084956" author="tilman" created="Thu, 16 Apr 2020 15:03:18 +0000"  >&lt;p&gt;I changed the handling of COSArray too. I don&apos;t have a test for that one because PDFBox saves arrays as direct objects.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Snapshot available here (at the bottom)&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.20-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.20-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thanks for reporting!&lt;/p&gt;</comment>
                            <comment id="17085128" author="jira-bot" created="Thu, 16 Apr 2020 17:55:52 +0000"  >&lt;p&gt;Commit 1876620 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1876620&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1876620&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4814&quot; title=&quot;Wrong COSType for OCProperties after merge&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4814&quot;&gt;&lt;del&gt;PDFBOX-4814&lt;/del&gt;&lt;/a&gt;: include asserts in test; have PD object return actual type&lt;/p&gt;</comment>
                            <comment id="17085129" author="jira-bot" created="Thu, 16 Apr 2020 17:55:56 +0000"  >&lt;p&gt;Commit 1876621 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1876621&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1876621&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4814&quot; title=&quot;Wrong COSType for OCProperties after merge&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4814&quot;&gt;&lt;del&gt;PDFBOX-4814&lt;/del&gt;&lt;/a&gt;: include asserts in test; have PD object return actual type&lt;/p&gt;</comment>
                            <comment id="17085130" author="jira-bot" created="Thu, 16 Apr 2020 17:56:02 +0000"  >&lt;p&gt;Commit 1876622 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1876622&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1876622&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4814&quot; title=&quot;Wrong COSType for OCProperties after merge&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4814&quot;&gt;&lt;del&gt;PDFBOX-4814&lt;/del&gt;&lt;/a&gt;: include asserts in test; have PD object return actual type&lt;/p&gt;</comment>
                            <comment id="17085232" author="kuelli" created="Thu, 16 Apr 2020 20:13:01 +0000"  >&lt;p&gt;Thank you for your quick investigations! It&apos;s now working for me. I think there is still a problem because the COSType changes from COSDictionary To COSObject. Adobe Acrobat has no problem with the merged result but I think OCProperties should remain a COSDictionary.&lt;/p&gt;

&lt;p&gt;On the left you see the original OCProperties, on the right after merging. Thanks for your help!&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13000195/13000195_image-2020-04-16-22-07-38-691.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17085234" author="tilman" created="Thu, 16 Apr 2020 20:19:14 +0000"  >&lt;p&gt;The OCProperties are both COSDictionaries, but on the right indirectly. The COSObject &quot;8 0 R&quot; references the COSDictionary. This is legit, PDFBox usually (but not always) stores dictionaries as indirect objects. In your visual software, this symbol&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13000197/13000197_image-2020-04-16-22-18-30-330.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;is for a dictionary.&lt;/p&gt;</comment>
                            <comment id="17085236" author="kuelli" created="Thu, 16 Apr 2020 20:24:51 +0000"  >&lt;p&gt;Ok, thank you for your statement. It&apos;s not so easy to understand&#8230;(direct, indirect references).&lt;/p&gt;</comment>
                            <comment id="17085241" author="tilman" created="Thu, 16 Apr 2020 20:30:40 +0000"  >&lt;p&gt;Indirect objects have a number. You&apos;ll find them in a PDF when opening with an text editor as e.g. &quot;8 0 obj&quot;. The reference to is would be &quot;8 0 R&quot;. Direct objects are within another object. So a dictionary can contain another dictionary as direct object or as indirect object.&lt;/p&gt;</comment>
                            <comment id="17085242" author="kuelli" created="Thu, 16 Apr 2020 20:33:02 +0000"  >&lt;p&gt;Oh, now is many clearer. Thank you very much!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13000141" name="PDFnoocg.pdf" size="330456" author="kuelli" created="Thu, 16 Apr 2020 12:19:37 +0000"/>
                            <attachment id="13000140" name="PDFocg1.pdf" size="383350" author="kuelli" created="Thu, 16 Apr 2020 12:19:46 +0000"/>
                            <attachment id="13000139" name="PDFocg2.pdf" size="2959714" author="kuelli" created="Thu, 16 Apr 2020 12:20:22 +0000"/>
                            <attachment id="13000195" name="image-2020-04-16-22-07-38-691.png" size="108838" author="kuelli" created="Thu, 16 Apr 2020 20:07:40 +0000"/>
                            <attachment id="13000197" name="image-2020-04-16-22-18-30-330.png" size="2849" author="tilman" created="Thu, 16 Apr 2020 20:18:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 30 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0dp94:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>