<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:00:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2798] PDTextStream does not support UTF16 with BOM</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2798</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;the getAsString() method from PDTextStream is quite useful, but it does not support UTF-16 text. I added a small check on the first two bytes to support UTF-16 content. This is needed because two-bytes encodings do not degrade gracefully like UTF-8, even for plain ASCII text and so the resulting string is unusable.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12829607">PDFBOX-2798</key>
            <summary>PDTextStream does not support UTF16 with BOM</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jahewson">John Hewson</assignee>
                                    <reporter username="briksoftware">Michele Balistreri</reporter>
                        <labels>
                    </labels>
                <created>Wed, 13 May 2015 17:20:21 +0000</created>
                <updated>Tue, 24 Aug 2021 16:04:24 +0000</updated>
                            <resolved>Thu, 14 May 2015 07:18:19 +0000</resolved>
                                    <version>1.8.10</version>
                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14542269" author="briksoftware" created="Wed, 13 May 2015 17:21:04 +0000"  >&lt;p&gt;fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2798&quot; title=&quot;PDTextStream does not support UTF16 with BOM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2798&quot;&gt;&lt;del&gt;PDFBOX-2798&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14542537" author="tilman" created="Wed, 13 May 2015 19:38:14 +0000"  >&lt;p&gt;Do you have a file where this happens, or a test that fails?&lt;/p&gt;</comment>
                            <comment id="14542558" author="briksoftware" created="Wed, 13 May 2015 19:47:39 +0000"  >&lt;p&gt;I do, but unfortunately I cannot share the file.&lt;/p&gt;

&lt;p&gt;Basically there is a stream where the content is UTF-16 encoded text. Reading it with the ISO-8859-1 charset creates a string with nulls after/before every character (depending on endianess) so &quot;hello&quot; would be read as &quot;h\0e\0l\0\l\0o\0&quot;. Printing this string does not reveal the issue, but if you do any string manipulation then it will not work (like searching something in the string). &lt;/p&gt;

&lt;p&gt;This patch simply checks if the first two bytes are a BOM marker and then uses the correct encoding.&lt;/p&gt;</comment>
                            <comment id="14542585" author="tilman" created="Wed, 13 May 2015 19:59:37 +0000"  >&lt;p&gt;I could try to find a file (I have 250000 PDF files to test), but for this I would need some code that detect such a file. To make it easier, first tell a string (e.g. &quot;/JS &quot; or whatever) that must be present. Then some code that would detect such a stream. &lt;/p&gt;</comment>
                            <comment id="14542653" author="briksoftware" created="Wed, 13 May 2015 20:32:16 +0000"  >&lt;p&gt;/JS would be a good bet. Detection is what happens in the patch, so basically the code would be&lt;/p&gt;

&lt;p&gt;        if (bytes.length &amp;gt;= 2 &amp;amp;&amp;amp; (bytes&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; == (byte) 0xFE &amp;amp;&amp;amp; bytes&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; == (byte) 0xFF) || (bytes&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; == (byte) 0xFF &amp;amp;&amp;amp; bytes&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; == (byte) 0xFE)) &lt;/p&gt;
        {
          System.out.println(&quot;this is UTF-16&quot;);        	
        }
&lt;p&gt;        else &lt;/p&gt;
        {
          System.out.println(&quot;this is not UTF-16&quot;);        	
        }</comment>
                            <comment id="14542778" author="jahewson" created="Wed, 13 May 2015 21:39:21 +0000"  >&lt;p&gt;There&apos;s another problem with PDTextStream, 8-bit encoded text should be treated as having PDFDocEncoding, however we see this line:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(out.toByteArray(), &lt;span class=&quot;code-quote&quot;&gt;&quot;ISO-8859-1&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that ISO-8859-1 is essentially WinAnsiEncoding. PDTextStream is looking pretty questionable to me, first of all it doesn&apos;t actually represent a &quot;text stream&quot; but &quot;a text string or a text stream&quot;, secondly it would be far simpler to just use COSString given that getAsStream() is never actually called.&lt;/p&gt;</comment>
                            <comment id="14542935" author="jira-bot" created="Wed, 13 May 2015 23:55:01 +0000"  >&lt;p&gt;Commit 1679299 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1679299&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1679299&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2798&quot; title=&quot;PDTextStream does not support UTF16 with BOM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2798&quot;&gt;&lt;del&gt;PDFBOX-2798&lt;/del&gt;&lt;/a&gt;: Replace PDTextStream with String&lt;/p&gt;</comment>
                            <comment id="14542946" author="jahewson" created="Thu, 14 May 2015 00:02:11 +0000"  >&lt;p&gt;Ok, I decided to bite the bullet and replace PDTextStream with String in 2.0. The current implementation of PDTextStream always gets the encoding wrong and its misuse has led to bugs such as &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2797&quot; title=&quot;PDJavascriptNameTreeNode does not support dictionaries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2797&quot;&gt;&lt;del&gt;PDFBOX-2797&lt;/del&gt;&lt;/a&gt; and other such buggy code which I found in FDFJavaScript and AppearanceGenerator, in both cases because name trees are not type safe. The PDTextStream abstraction isn&apos;t worth keeping because it&apos;s purpose is to represent &quot;this is a string&quot;, a need better served by, well, a String. Removing PDTextStream has also allowed the removal if a ton of helper code, which shows just how expensive and confusing this abstraction was. Especially, as I mentioned above, because PDTextStream isn&apos;t a &quot;text stream&quot; at all, but &quot;either a text string or a text stream&quot;.&lt;/p&gt;

&lt;p&gt;This change mostly affect the AcroForm APIs, which have been moving toward using Strings over COS objects anyway.&lt;/p&gt;

&lt;p&gt;For 1.8 Michele Balistreri&apos;s approach looks good - obviously we have to be careful not to introduce regressions into the stable branch.&lt;/p&gt;</comment>
                            <comment id="14543008" author="jira-bot" created="Thu, 14 May 2015 00:53:48 +0000"  >&lt;p&gt;Commit 1679300 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1679300&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1679300&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2798&quot; title=&quot;PDTextStream does not support UTF16 with BOM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2798&quot;&gt;&lt;del&gt;PDFBOX-2798&lt;/del&gt;&lt;/a&gt;: Replace PDTextStream with String (deleted files)&lt;/p&gt;</comment>
                            <comment id="14543028" author="jira-bot" created="Thu, 14 May 2015 01:04:14 +0000"  >&lt;p&gt;Commit 1679302 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1679302&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1679302&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2798&quot; title=&quot;PDTextStream does not support UTF16 with BOM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2798&quot;&gt;&lt;del&gt;PDFBOX-2798&lt;/del&gt;&lt;/a&gt;: Replace PDTextStream with String (deleted files)&lt;/p&gt;</comment>
                            <comment id="14543029" author="jahewson" created="Thu, 14 May 2015 01:04:34 +0000"  >&lt;p&gt;Ignore this, it was meant for &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2196&quot; title=&quot;[PATCH] Type safety in PDNameTreeNode and PDNumberTreeNode via generics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2196&quot;&gt;&lt;del&gt;PDFBOX-2196&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14543254" author="jira-bot" created="Thu, 14 May 2015 06:06:53 +0000"  >&lt;p&gt;Commit 1679315 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1679315&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1679315&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2798&quot; title=&quot;PDTextStream does not support UTF16 with BOM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2798&quot;&gt;&lt;del&gt;PDFBOX-2798&lt;/del&gt;&lt;/a&gt;: create a PDActionJavaScript and not a text stream&lt;/p&gt;</comment>
                            <comment id="14543263" author="tilman" created="Thu, 14 May 2015 06:15:40 +0000"  >&lt;p&gt;Ignore the above, that applied to &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2797&quot; title=&quot;PDJavascriptNameTreeNode does not support dictionaries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2797&quot;&gt;&lt;del&gt;PDFBOX-2797&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14543286" author="briksoftware" created="Thu, 14 May 2015 06:38:02 +0000"  >&lt;p&gt;I am happy with the solution of removing this class altogether, for me the issue is resolved.&lt;/p&gt;</comment>
                            <comment id="14543312" author="jahewson" created="Thu, 14 May 2015 07:17:11 +0000"  >&lt;p&gt;Excellent, thanks for testing it out.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13396963">PDFBOX-5264</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12732611" name="PDTextStream-UTF16.diff" size="908" author="briksoftware" created="Wed, 13 May 2015 17:21:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 27 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2eoun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>