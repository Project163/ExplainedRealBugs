<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:11:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5158] Infinite loop on corrupted PDF in 3.0.0-SNAPSHOT</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5158</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I found a bunch of files that had a &quot;read too many EOFs&quot;, which is a safety check we now do in TikaInputStream to identify parsers that read an EOF &amp;gt; 1000 times, which may be a sign of an infinite loop.&lt;/p&gt;

&lt;p&gt;When I turn off this safety check in TikaInputStream, I get an infinite loop.&lt;/p&gt;

&lt;p&gt;This is one of the triggering files: &lt;a href=&quot;https://corpora.tika.apache.org/base/docs/commoncrawl3/OE/OELHPKYAQPDNDWC535NE23Z6FKYRMN7W&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://corpora.tika.apache.org/base/docs/commoncrawl3/OE/OELHPKYAQPDNDWC535NE23Z6FKYRMN7W&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It&apos;s a truncated file from Common Crawl.&lt;/p&gt;

&lt;p&gt;The stacktrace when this is thrown is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;afterRead:809, TikaInputStream (org.apache.tika.io)
read:82, ProxyInputStream (org.apache.commons.io.input)
&amp;lt;init&amp;gt;:113, RandomAccessReadBuffer (org.apache.pdfbox.io)
loadPDF:454, Loader (org.apache.pdfbox)
loadPDF:430, Loader (org.apache.pdfbox)
getPDDocument:189, PDFParser (org.apache.tika.parser.pdf)
parse:148, PDFParser (org.apache.tika.parser.pdf)
parse:288, CompositeParser (org.apache.tika.parser)
parse:288, CompositeParser (org.apache.tika.parser)
parse:150, AutoDetectParser (org.apache.tika.parser)
parse:157, RecursiveParserWrapper (org.apache.tika.parser)
getRecursiveMetadata:379, TikaTest (org.apache.tika)
getRecursiveMetadata:369, TikaTest (org.apache.tika)
getRecursiveMetadata:357, TikaTest (org.apache.tika)
getRecursiveMetadata:351, TikaTest (org.apache.tika)


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13370436">PDFBOX-5158</key>
            <summary>Infinite loop on corrupted PDF in 3.0.0-SNAPSHOT</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="tallison">Tim Allison</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Apr 2021 16:54:56 +0000</created>
                <updated>Fri, 18 Aug 2023 05:46:11 +0000</updated>
                            <resolved>Fri, 9 Apr 2021 06:34:56 +0000</resolved>
                                    <version>3.0.0 PDFBox</version>
                                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17317429" author="tilman" created="Thu, 8 Apr 2021 18:58:18 +0000"  >&lt;p&gt;I get this&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.io.IOException: Page tree root must be a dictionary
    org.apache.pdfbox.pdfparser.COSParser.checkPages(COSParser.java:1955)
    org.apache.pdfbox.pdfparser.PDFParser.initialParse(PDFParser.java:140)
    org.apache.pdfbox.pdfparser.PDFParser.parse(PDFParser.java:180)
    org.apache.pdfbox.pdfparser.PDFParser.parse(PDFParser.java:154)
    org.apache.pdfbox.Loader.loadPDF(Loader.java:456)
    org.apache.pdfbox.Loader.loadPDF(Loader.java:393)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17317499" author="tallison@mitre.org" created="Thu, 8 Apr 2021 21:25:42 +0000"  >&lt;p&gt;Hmmm...will try to replicate with pure PDFBox.  Thank you!&lt;/p&gt;</comment>
                            <comment id="17317509" author="tallison@mitre.org" created="Thu, 8 Apr 2021 21:42:29 +0000"  >&lt;p&gt;Y, I get your stacktrace with a file, but I get an infinite loop with an inputstream.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        Path path = Paths.get(&quot;OELHPKYAQPDNDWC535NE23Z6FKYRMN7W.pdf&quot;);
        try (InputStream is = Files.newInputStream(path)) {
            Loader.loadPDF(is);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17317514" author="tallison@mitre.org" created="Thu, 8 Apr 2021 21:48:50 +0000"  >&lt;p&gt;Which in turn led me to find a bug in Tika&apos;s integration with 3.x: &lt;a href=&quot;https://github.com/apache/tika/commit/f336c599a5536c7d3a7c0a0c94c71c8b695832ec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/tika/commit/f336c599a5536c7d3a7c0a0c94c71c8b695832ec&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Oh, dear, this bug is active in the wild in 1.26... &lt;a href=&quot;https://issues.apache.org/jira/browse/TIKA-3350&quot; title=&quot;Tika&amp;#39;s PDFParser should use the underlying file via TikaInputStream if it exists&quot; class=&quot;issue-link&quot; data-issue-key=&quot;TIKA-3350&quot;&gt;TIKA-3350&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Three cheers for collaboration across projects!&lt;/p&gt;</comment>
                            <comment id="17317597" author="tilman" created="Fri, 9 Apr 2021 02:56:42 +0000"  >&lt;p&gt;Yes now I get it too. Surprisingly, the infinite loop does not happen when reading from &lt;tt&gt;new URL(&quot;...&quot;).openStream()&lt;/tt&gt;. Which makes me suspect that it&apos;s related to the size of chunks ready to read. We had something on that a few weeks ago &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17317606" author="jpyeron" created="Fri, 9 Apr 2021 03:21:34 +0000"  >&lt;p&gt;I have a valid (non-corrupt) pdf which seems to have similar behavior. I cannot share the PDF as it has customer data and PII in it, but I can run tests against it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://projects.pdinc.us/show_bug.cgi?id=2386&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;pdinc bug 2386&lt;/a&gt; getEOFEndingOffsets got caught in an endless loop due to too many PDF xref found by XrefTrailerResolver&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;type    pos (after EOF or start of xref)
======= ======
xref    217557
xref    220101
%%EOF   220298
xref    339064
xref    339461
%%EOF   339660
xref    533303
xref    533947
%%EOF   534146
xref    546909
xref    547346
%%EOF   547545
xref    625816
xref    626372
%%EOF   626571
xref    635964
xref    636321
%%EOF   636520
xref    657314
xref    657838
%%EOF   658037
xref    667430
xref    667787
%%EOF   667986
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17317607" author="tilman" created="Fri, 9 Apr 2021 03:22:47 +0000"  >&lt;p&gt;Constructor of RandomAccessReadBuffer has &lt;tt&gt;remainingBytes&lt;/tt&gt; 0 so &lt;tt&gt;bytesRead&lt;/tt&gt; is 0. It works by adding {{remainingBytes &amp;gt; 0 &amp;amp;&amp;amp; }} in the &quot;while&quot;.&lt;/p&gt;</comment>
                            <comment id="17317608" author="tilman" created="Fri, 9 Apr 2021 03:32:19 +0000"  >&lt;p&gt;proposed test&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /**
     * PDFBOX-5158: endless loop reading 4096 bytes from a FileInputStream. Test does not fail with
     * a ByteArrayInputStream, so we need to create a file.
     *
     * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
     */
    @Test
    void test4096() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
    {
        Path path = Files.createTempFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;len4096&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;.pdf&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (OutputStream os = Files.newOutputStream(path))
        {
            os.write(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[4096]);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (RandomAccessInputStream randomAccessInputStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RandomAccessInputStream(
                &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RandomAccessReadBuffer(Files.newInputStream(path))))
        {
            assertEquals(0, randomAccessInputStream.read());
        }
        Files.delete(path);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17317612" author="tilman" created="Fri, 9 Apr 2021 03:38:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpyeron&quot; class=&quot;user-hover&quot; rel=&quot;jpyeron&quot;&gt;jpyeron&lt;/a&gt; that sounds like a different thing, could you have a look into that file with an editor like NOTEPAD++ and look at the positions of %%EOF and the /Prev values and open a separate issue with that?&lt;/p&gt;</comment>
                            <comment id="17317668" author="lehmi" created="Fri, 9 Apr 2021 05:37:43 +0000"  >&lt;p&gt;Cool, we hit one of those rare corner cases revealing an implementation flaw. That is an advantage of having a huge collection of test files &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; the test and the fix looks good to me. Are you going to commit it?&lt;/p&gt;</comment>
                            <comment id="17317671" author="lehmi" created="Fri, 9 Apr 2021 05:41:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpyeron&quot; class=&quot;user-hover&quot; rel=&quot;jpyeron&quot;&gt;jpyeron&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5153&quot; title=&quot;New flatefilter exception on Tika unit test files with 3.0.0-RC1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5153&quot;&gt;&lt;del&gt;PDFBOX-5153&lt;/del&gt;&lt;/a&gt; may be related to your issue. Are you able to retest including that fix?&lt;/p&gt;</comment>
                            <comment id="17317679" author="tilman" created="Fri, 9 Apr 2021 05:52:43 +0000"  >&lt;p&gt;Yes&lt;/p&gt;</comment>
                            <comment id="17317685" author="jira-bot" created="Fri, 9 Apr 2021 06:03:51 +0000"  >&lt;p&gt;Commit 1888543 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1888543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1888543&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5158&quot; title=&quot;Infinite loop on corrupted PDF in 3.0.0-SNAPSHOT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5158&quot;&gt;&lt;del&gt;PDFBOX-5158&lt;/del&gt;&lt;/a&gt;: avoid endless loop on FileInputStreams that have a 4096 multiple length + test&lt;/p&gt;</comment>
                            <comment id="17317695" author="tilman" created="Fri, 9 Apr 2021 06:21:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jpyeron&quot; class=&quot;user-hover&quot; rel=&quot;jpyeron&quot;&gt;jpyeron&lt;/a&gt; snapshot will soon be here (but the snapshot with the other fixed bug mentioned is already there):&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/3.0.0-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/3.0.0-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;However the bug here is only related to files that have a length that is a multiple of 4096, and only if these files are read as a FileInputStream, which is not as efficient as reading from a file.&lt;/p&gt;</comment>
                            <comment id="17317702" author="tilman" created="Fri, 9 Apr 2021 06:33:59 +0000"  >&lt;p&gt;Actual test code is different than the one proposed because the original test was in the wrong class. However I re-checked that the code did trigger the endless loop with the previous code.&lt;/p&gt;</comment>
                            <comment id="17317705" author="tilman" created="Fri, 9 Apr 2021 06:34:56 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tallison&quot; class=&quot;user-hover&quot; rel=&quot;tallison&quot;&gt;tallison&lt;/a&gt; for the report and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; for the review!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13499691">PDFBOX-5543</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 31 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0poh4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>