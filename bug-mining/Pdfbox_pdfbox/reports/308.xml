<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:54:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1586] IndexOutOfBoundsException when saving a document (at random)</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1586</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Getting the following stacktrace:&lt;/p&gt;

&lt;p&gt;org.apache.pdfbox.exceptions.COSVisitorException: java.lang.IndexOutOfBoundsException: Index: 28, Size: 0&lt;br/&gt;
    at org.apache.pdfbox.pdfwriter.COSWriter.visitFromStream(COSWriter.java:1245)&lt;br/&gt;
    at org.apache.pdfbox.cos.COSStream.accept(COSStream.java:201)&lt;br/&gt;
    at org.apache.pdfbox.cos.COSObject.accept(COSObject.java:206)&lt;br/&gt;
    at org.apache.pdfbox.pdfwriter.COSWriter.doWriteObject(COSWriter.java:524)&lt;br/&gt;
    at org.apache.pdfbox.pdfwriter.COSWriter.doWriteBody(COSWriter.java:434)&lt;br/&gt;
    at org.apache.pdfbox.pdfwriter.COSWriter.visitFromDocument(COSWriter.java:1056)&lt;br/&gt;
    at org.apache.pdfbox.cos.COSDocument.accept(COSDocument.java:496)&lt;br/&gt;
    at org.apache.pdfbox.pdfwriter.COSWriter.write(COSWriter.java:1392)&lt;br/&gt;
    at org.apache.pdfbox.pdmodel.PDDocument.save(PDDocument.java:1157)&lt;br/&gt;
    at org.apache.pdfbox.pdmodel.PDDocument.save(PDDocument.java:1138)&lt;br/&gt;
...&lt;br/&gt;
Caused by: java.lang.IndexOutOfBoundsException: Index: 28, Size: 0&lt;br/&gt;
    at java.util.ArrayList.rangeCheck(ArrayList.java:604)&lt;br/&gt;
    at java.util.ArrayList.get(ArrayList.java:382)&lt;br/&gt;
    at org.apache.pdfbox.io.RandomAccessBuffer.seek(RandomAccessBuffer.java:84)&lt;br/&gt;
    at org.apache.pdfbox.io.RandomAccessFileInputStream.read(RandomAccessFileInputStream.java:96)&lt;br/&gt;
    at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)&lt;br/&gt;
    at java.io.BufferedInputStream.read1(BufferedInputStream.java:275)&lt;br/&gt;
    at java.io.BufferedInputStream.read(BufferedInputStream.java:334)&lt;br/&gt;
    at org.apache.pdfbox.pdfwriter.COSWriter.visitFromStream(COSWriter.java:1232)&lt;/p&gt;

&lt;p&gt;I&apos;ll add some context. We have a &quot;data pipeline&quot; in which a Windows Print Monitor sends postscript into a servlet which then uses GhostScript 9.05 to convert in-memory to PDF. This PDF is then loaded into PDFBox using PDDocument.load().&lt;/p&gt;

&lt;p&gt;At this point we split the original PDF into multiple smaller ones each of which is saved to a ByteArrayOutputStream. At the point of save() we are having serious reliability issues.&lt;/p&gt;

&lt;p&gt;Taking an original PDF from Ghostscript we have saved this into a unit test to replicate the problem without success. If we attempt to re-execute the pipeline to take the original PDF and split it, we get apparently random percentages of saved documents.&lt;/p&gt;

&lt;p&gt;For instance, on a 990 page document (text, no images), to be split into 990 1-page documents using Tomcat 7 with -Xmx=512m:&lt;/p&gt;

&lt;p&gt;Pass 1: 50% were saved, 50% ended with stack traces&lt;br/&gt;
Pass 2: 100% were saved&lt;br/&gt;
Pass 3: 100% were saved&lt;/p&gt;

&lt;p&gt;The same test with -Xmx=128m ended several times with just 1 document saved, the rest were stack traces.&lt;/p&gt;

&lt;p&gt;We have also seen this randomly hit a sample document consisting of four pages to be split into two two-page documents so it does not appear to be memory related. We also added code to catch the IndexOutOfBoundsException and make up to ten attempts to repeat, but it seems the save() either works the first time or not at all.&lt;/p&gt;

&lt;p&gt;We&apos;re thinking there are environmental factors here but we&apos;re now focused on getting this nailed. Any advice or assistance will be welcomed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12645393">PDFBOX-1586</key>
            <summary>IndexOutOfBoundsException when saving a document (at random)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="jmkgreen">James Green</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Apr 2013 08:52:23 +0000</created>
                <updated>Mon, 7 Aug 2023 06:26:29 +0000</updated>
                            <resolved>Mon, 7 Aug 2023 06:26:29 +0000</resolved>
                                    <version>1.8.1</version>
                                                    <component>Writing</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="13645432" author="lehmi" created="Tue, 30 Apr 2013 10:15:59 +0000"  >&lt;p&gt;What exactly are you doing to split the pdf? Are you using the Splitter class?&lt;/p&gt;</comment>
                            <comment id="13645439" author="jmkgreen" created="Tue, 30 Apr 2013 10:42:11 +0000"  >&lt;p&gt;No, Splitter assumes a consistent page count. In our case the first sub-document may have 5 pages, the second may have 7, the third 4, etc. We know to split based on regex match of the current page.&lt;/p&gt;

&lt;p&gt;Reading the code we iterate over the PDDocument loaded from a ByteArrayInputStream and create new PDDocument instances copying across references using subDoc.addPage(originalDoc.getPage(currentPageIndex) (abstracting the actual code rather a lot).&lt;/p&gt;

&lt;p&gt;We can now recreate the problem by using a 990 page document and setting the following in our pom:&lt;/p&gt;

&lt;p&gt;            &amp;lt;plugin&amp;gt;&lt;br/&gt;
                &amp;lt;groupId&amp;gt;org.apache.maven.plugins&amp;lt;/groupId&amp;gt;&lt;br/&gt;
                &amp;lt;artifactId&amp;gt;maven-surefire-plugin&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
                &amp;lt;version&amp;gt;2.12&amp;lt;/version&amp;gt;&lt;br/&gt;
                &amp;lt;configuration&amp;gt;&lt;br/&gt;
                    &amp;lt;additionalClasspathElements&amp;gt;&lt;br/&gt;
                        &amp;lt;additionalClasspathElement&amp;gt;src\main\webapp\&amp;lt;/additionalClasspathElement&amp;gt;&lt;br/&gt;
                    &amp;lt;/additionalClasspathElements&amp;gt;&lt;br/&gt;
                    &amp;lt;forkMode&amp;gt;pertest&amp;lt;/forkMode&amp;gt;&lt;br/&gt;
                    &amp;lt;argLine&amp;gt;-Xmx64m&amp;lt;/argLine&amp;gt;&lt;br/&gt;
                    &amp;lt;testFailureIgnore&amp;gt;false&amp;lt;/testFailureIgnore&amp;gt;&lt;br/&gt;
                &amp;lt;/configuration&amp;gt;&lt;br/&gt;
            &amp;lt;/plugin&amp;gt;&lt;/p&gt;

&lt;p&gt;It seems to be consistent with low memory conditions.&lt;/p&gt;</comment>
                            <comment id="13645455" author="lehmi" created="Tue, 30 Apr 2013 10:49:36 +0000"  >&lt;p&gt;Ah, I see. I guess the addPage is the culprit here. Try to adapt the splitter code (copied from Splitter#processNextPage)&lt;/p&gt;

&lt;p&gt;PDPage imported = subDocument.importPage( originalPage );&lt;br/&gt;
imported.setCropBox( originalPage .findCropBox() );&lt;br/&gt;
imported.setMediaBox( originalPage .findMediaBox() );&lt;br/&gt;
// only the resources of the page will be copied&lt;br/&gt;
imported.setResources( originalPage .getResources() );&lt;br/&gt;
imported.setRotation( originalPage .findRotation() );&lt;/p&gt;</comment>
                            <comment id="13645461" author="jmkgreen" created="Tue, 30 Apr 2013 11:00:31 +0000"  >&lt;p&gt;Changed addPage to importPage but no change to the stack traces.&lt;/p&gt;</comment>
                            <comment id="13646467" author="jmkgreen" created="Wed, 1 May 2013 08:57:53 +0000"  >&lt;p&gt;RandomAccessBuffer.seek() is called on an instance after it&apos;s close() is called. Now to understand why.&lt;/p&gt;</comment>
                            <comment id="13646469" author="lehmi" created="Wed, 1 May 2013 09:01:37 +0000"  >&lt;p&gt;Where, in your code or ours?&lt;/p&gt;</comment>
                            <comment id="13646475" author="jmkgreen" created="Wed, 1 May 2013 09:13:05 +0000"  >&lt;p&gt;Our code doesn&apos;t close them by the looks of things. GC I suspect. I&apos;m adding sout tracing to the io classes of PDFBox locally. Trouble is, the next run I conducted does not state that it was closed before seek. Still tracing!&lt;/p&gt;</comment>
                            <comment id="13646514" author="jmkgreen" created="Wed, 1 May 2013 11:51:11 +0000"  >&lt;p&gt;Fixed with pull request: &lt;a href=&quot;https://github.com/apache/pdfbox/pull/4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/pdfbox/pull/4&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We discovered that the COSDocument is being GC&apos;d but something else has used getScratchFile() which still wants to seek() within it. Anyway, closing something you can return a reference to is just bad.&lt;/p&gt;</comment>
                            <comment id="13646554" author="lehmi" created="Wed, 1 May 2013 13:06:19 +0000"  >&lt;p&gt;Thanks for your investigation and the proposed fix. But I have to admit that I don&apos;t like the idea not to close the scratchfile. I&apos;d prefer to improve the getter so that the scratchfile will only be returned if it isn&apos;t already closed. It can&apos;t be correct to access the scratch file of an already closed pdf.&lt;/p&gt;</comment>
                            <comment id="13646560" author="jmkgreen" created="Wed, 1 May 2013 13:14:12 +0000"  >&lt;p&gt;The correct fix is to not expose the scratch file at all. Until that point and without this fix, it will crash.&lt;/p&gt;</comment>
                            <comment id="13646687" author="frkj" created="Wed, 1 May 2013 16:20:03 +0000"  >&lt;p&gt;I also get a similar stack trace when creating an image of a PDF page. I&apos;m unable to reproduce the issue in a unit test since it works most of the time but once in a while creates stack traces like these in production:&lt;/p&gt;

&lt;p&gt;java.lang.IndexOutOfBoundsException: Index: 5, Size: 0&lt;br/&gt;
        at java.util.ArrayList.get(ArrayList.java:352)&lt;br/&gt;
        at org.apache.pdfbox.io.RandomAccessBuffer.seek(RandomAccessBuffer.java:84)&lt;br/&gt;
        at org.apache.pdfbox.io.RandomAccessFileInputStream.read(RandomAccessFileInputStream.java:96)&lt;br/&gt;
        at java.io.BufferedInputStream.read1(BufferedInputStream.java:267)&lt;br/&gt;
        at java.io.BufferedInputStream.read(BufferedInputStream.java:328)&lt;br/&gt;
        at java.io.BufferedInputStream.fill(BufferedInputStream.java:229)&lt;br/&gt;
        at java.io.BufferedInputStream.read(BufferedInputStream.java:248)&lt;br/&gt;
        at java.io.FilterInputStream.read(FilterInputStream.java:77)&lt;br/&gt;
        at java.io.PushbackInputStream.read(PushbackInputStream.java:133)&lt;br/&gt;
        at org.apache.pdfbox.io.PushBackInputStream.read(PushBackInputStream.java:91)&lt;br/&gt;
        at org.apache.pdfbox.pdfparser.BaseParser.parseDirObject(BaseParser.java:1221)&lt;br/&gt;
        at org.apache.pdfbox.pdfparser.BaseParser.parseCOSArray(BaseParser.java:1036)&lt;br/&gt;
        at org.apache.pdfbox.pdfparser.PDFStreamParser.parseNextToken(PDFStreamParser.java:266)&lt;br/&gt;
        at org.apache.pdfbox.pdfparser.PDFStreamParser.access$000(PDFStreamParser.java:46)&lt;br/&gt;
        at org.apache.pdfbox.pdfparser.PDFStreamParser$1.tryNext(PDFStreamParser.java:182)&lt;br/&gt;
        at org.apache.pdfbox.pdfparser.PDFStreamParser$1.hasNext(PDFStreamParser.java:194)&lt;br/&gt;
        at org.apache.pdfbox.util.PDFStreamEngine.processSubStream(PDFStreamEngine.java:255)&lt;br/&gt;
        at org.apache.pdfbox.util.PDFStreamEngine.processSubStream(PDFStreamEngine.java:235)&lt;br/&gt;
        at org.apache.pdfbox.util.PDFStreamEngine.processStream(PDFStreamEngine.java:215)&lt;br/&gt;
        at org.apache.pdfbox.pdfviewer.PageDrawer.drawPage(PageDrawer.java:125)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.PDPage.convertToImage(PDPage.java:769)&lt;/p&gt;

&lt;p&gt;java.lang.IndexOutOfBoundsException: Index: 3, Size: 0&lt;br/&gt;
        at java.util.ArrayList.get(ArrayList.java:352)&lt;br/&gt;
        at org.apache.pdfbox.io.RandomAccessBuffer.seek(RandomAccessBuffer.java:84)&lt;br/&gt;
        at org.apache.pdfbox.io.RandomAccessFileInputStream.read(RandomAccessFileInputStream.java:96)&lt;br/&gt;
        at java.io.BufferedInputStream.fill(BufferedInputStream.java:229)&lt;br/&gt;
        at java.io.BufferedInputStream.read1(BufferedInputStream.java:269)&lt;br/&gt;
        at java.io.BufferedInputStream.read(BufferedInputStream.java:328)&lt;br/&gt;
        at java.io.FilterInputStream.read(FilterInputStream.java:101)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.graphics.xobject.PDJpeg.removeAllFiltersButDCT(PDJpeg.java:305)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.graphics.xobject.PDJpeg.getRGBImage(PDJpeg.java:223)&lt;br/&gt;
        at org.apache.pdfbox.util.operator.pagedrawer.Invoke.process(Invoke.java:83)&lt;br/&gt;
        at org.apache.pdfbox.util.PDFStreamEngine.processOperator(PDFStreamEngine.java:554)&lt;br/&gt;
        at org.apache.pdfbox.util.PDFStreamEngine.processSubStream(PDFStreamEngine.java:268)&lt;br/&gt;
        at org.apache.pdfbox.util.PDFStreamEngine.processSubStream(PDFStreamEngine.java:235)&lt;br/&gt;
        at org.apache.pdfbox.util.PDFStreamEngine.processStream(PDFStreamEngine.java:215)&lt;br/&gt;
        at org.apache.pdfbox.pdfviewer.PageDrawer.drawPage(PageDrawer.java:125)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.PDPage.convertToImage(PDPage.java:769)&lt;/p&gt;

&lt;p&gt;The code:&lt;/p&gt;

&lt;p&gt;    InputStream pdfInputStream = new ByteArrayInputStream(...);&lt;br/&gt;
    PDDocument document = PDDocument.load(pdfInputStream);&lt;br/&gt;
    List&amp;lt;?&amp;gt; pages = document.getDocumentCatalog().getAllPages();&lt;br/&gt;
    PDPage page = (PDPage)pages.get(0);&lt;br/&gt;
    BufferedImage image = page.convertToImage(BufferedImage.TYPE_INT_RGB, 72);&lt;br/&gt;
    document.close();&lt;/p&gt;

&lt;p&gt;I agree with Andreas that the scratch file needs to be closed somewhere. The returned PDDocument holds a reference to the underlying COSDocument so why is it being GC&apos;d? It looks like the scratch file is supposed to be closed by PDDocument.close() that calls COSDocument.close(). Are there several COSDocument created in the process of parsing and creating an image?&lt;/p&gt;</comment>
                            <comment id="13646705" author="jmkgreen" created="Wed, 1 May 2013 16:48:00 +0000"  >&lt;p&gt;Once the scratch file is guaranteed to be private then it can be safely closed. I&apos;m betting that whatever calls to get access to that scratch file is probably buggy and maintaining references where the called PDDocument has fallen out of scope. Essentially my patch merely prevents a crash it does not fix the underlying problem of references to scratch files being made in error.&lt;/p&gt;</comment>
                            <comment id="13646724" author="lehmi" created="Wed, 1 May 2013 17:16:30 +0000"  >&lt;p&gt;@James&lt;br/&gt;
Please test what happens if the getter returns null if the scratch file is already closed (closed == true). Out test suite doesn&apos;t trigger any issue, maybe your test case will shed some light on this problem.&lt;/p&gt;</comment>
                            <comment id="13646727" author="frkj" created="Wed, 1 May 2013 17:19:05 +0000"  >&lt;p&gt;I added logging to the constructors and close methods of COSDocument and RandomAccessBuffer and there are only one instance of each object created in my code above. There are several calls to COSDocument.getScratchFile(), but none of them are closing the COSDocument or scratch file.&lt;/p&gt;

&lt;p&gt;Since you are able to reproduce the problem more easily than I, can you add logging to the same places and see how many instances are created and when they are closed?&lt;/p&gt;

&lt;p&gt;Can you share the part of your code that does the actual splitting of the PDF document?&lt;/p&gt;</comment>
                            <comment id="13648352" author="jmkgreen" created="Fri, 3 May 2013 11:56:03 +0000"  >&lt;p&gt;We aren&apos;t complaining that the getter itself is faulty. The problem is that there is more than one reference to the scratchFile. The COSDocument assumes it has exclusivity over that scratchFile and will close it.&lt;/p&gt;

&lt;p&gt;Sometimes a (single) scratchFile is being used by more than one object. As the COSDocument that created the scratchFile falls out of scope and gets GC&apos;d the finalize() calls close() on the scratchFile - but there&apos;s potentially another reference to it. If the COSDocument kept it&apos;s scratchFile private (remove the getter) this can no longer happen and make the closure during finalize safe.&lt;/p&gt;

&lt;p&gt;What we are seeing is that this stack trace is the result of the second reference to the scratchFile being invoked after the owning instance COSDocument has been GC&apos;d. The getter within the COSDocument won&apos;t ever be called on the COSDocument instance that originally created it when the crash occurs because that COSDocument instance has been GC&apos;d already - potentially long ago!&lt;/p&gt;

&lt;p&gt;COSDocument doc1 = new COSDocument()&lt;br/&gt;
RandomAccess sF1 = doc1.getScratchFile()&lt;br/&gt;
doc1 = null;&lt;br/&gt;
System.gc()&lt;br/&gt;
sF1.seek(...) &amp;lt;-- boom&lt;/p&gt;

&lt;p&gt;Note that our code does not reach into the COSDocument for the scratch file - the PDFBox library code does - &lt;a href=&quot;http://imagebin.org/256280&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://imagebin.org/256280&lt;/a&gt; for what we mean.&lt;/p&gt;

&lt;p&gt;It&apos;s a bit like having a factory close created instances then closing the factory - the instances are being used elsewhere.&lt;/p&gt;

&lt;p&gt;Why not just add a finalize() on the RandomAccessBuffer that closes the resource?&lt;/p&gt;

&lt;p&gt;If the architecture states that the scratchFile should indeed be exclusive to it&apos;s creating instance get rid of the getter else you cannot be assured of that fact.&lt;/p&gt;</comment>
                            <comment id="13648539" author="msahyoun" created="Fri, 3 May 2013 16:19:50 +0000"  >&lt;p&gt;Hi James,&lt;/p&gt;

&lt;p&gt;IMO your points are very valid but as you outlined it&apos;s not easy to change as getScratchFile is used a lot internally and others might depend on that too as it&apos;s public. Some utilities depend on that and these are typically used as a starting point to develop customer specific tools. As we are currently planning for 2.0 that&apos;s where a change might occur so it&apos;s good that the issue came up.&lt;/p&gt;

&lt;p&gt;For the specific issue you are getting could you share some code with us (and maybe some sample PDFs) how you do the splitting. E.g. currently you need to keep the source(es) open until all splitted files are saved.&lt;/p&gt;

&lt;p&gt;BR&lt;br/&gt;
Maruan&lt;/p&gt;</comment>
                            <comment id="13648715" author="jmkgreen" created="Fri, 3 May 2013 19:44:13 +0000"  >&lt;p&gt;Maruan,&lt;/p&gt;

&lt;p&gt;The patch I provided is very clear. Until the scratchFile is made completely private it remains fundamentally unsafe to close the scratchFile during finalize() within a COSDocument and so this is the only change.&lt;/p&gt;

&lt;p&gt;This is utterly independent of any investigation as to how or why more than one reference to a scratchFile can be made. I have no objection to such an investigation but the patch and the investigation are separate. One does not follow the other.&lt;/p&gt;

&lt;p&gt;We hope to spend a few hours performing investigation work soon but meantime we have had to internally ship a 1.8.2-PRIVATE of PDFBox containing the patch - and all is so far well. It would be appreciated if a real 1.8 release could be made so we can return to official upstream sources without this resource leak.&lt;/p&gt;

&lt;p&gt;We can all hope that v2 does not release scratchFiles and can therefore operate on it exclusively.&lt;/p&gt;</comment>
                            <comment id="13648768" author="msahyoun" created="Fri, 3 May 2013 20:24:57 +0000"  >&lt;p&gt;James,&lt;/p&gt;

&lt;p&gt;I fully understand the patch and that it&apos;s causing you issues. I thought I might be able to help to understand why the stack trace happens. We are using PDFBox to split and merge very large PDFs wo any issues. So yes, the issue with the scratch file exists and there has to be a solution. But it also exists for us and we don&apos;t get the tack trace. Doesn&apos;t mean that it shouldn&apos;t be fixed but there might be ways to avoid a stack trace with current code.&lt;/p&gt;

&lt;p&gt;BR&lt;br/&gt;
Maruan&lt;/p&gt;</comment>
                            <comment id="13649108" author="lehmi" created="Sat, 4 May 2013 16:46:56 +0000"  >&lt;p&gt;I removed/reworked some of the direct accesses to the scratch file in revision 1479136. Now it should be easier to find the real cause for the described issue and maybe it&apos;ll be easier to remove the direct access at all.&lt;/p&gt;</comment>
                            <comment id="13649156" author="jmkgreen" created="Sat, 4 May 2013 20:04:20 +0000"  >&lt;p&gt;I looked at this today. I now understand how we experience this problem.&lt;/p&gt;

&lt;p&gt;We have a class, Divider, which has a number of methods. We&apos;ll start at method a() which accepts a ByteArrayInputStream that holds a PDF. a() calls splitter() handing it this ByteArrayInputStream and expecting a list of PDDocuments back.&lt;/p&gt;

&lt;p&gt;class Divider {&lt;/p&gt;

&lt;p&gt;public List&amp;lt;byte[]&amp;gt; a(ByteArrayInputStream pdfBytes) {&lt;/p&gt;

&lt;p&gt;List&amp;lt;PDDocument&amp;gt; split = splitter(pdfBytes);&lt;br/&gt;
List&amp;lt;byte[]&amp;gt; retVal = new ArrayList&amp;lt;byte[]&amp;gt;();&lt;br/&gt;
for (PDDocument p : split) {&lt;br/&gt;
ByteArrayOutputStream os = new ByteArrayOutputStream();&lt;br/&gt;
p.save(os);&lt;br/&gt;
retVal.add(os.toByteArray());&lt;br/&gt;
}&lt;br/&gt;
return retVal;&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;public List&amp;lt;PDDocument&amp;gt; splitter(ByteArrayInputStream masterPdf) {&lt;br/&gt;
List&amp;lt;PDDocument&amp;gt; retVal = new ArrayList&amp;lt;PDDocument&amp;gt;();&lt;br/&gt;
PDDocument doc = PDDocument.load(masterPdf);&lt;br/&gt;
List&amp;lt;PDPage&amp;gt; pages = doc.getDocumentCatalog().getAllPages();&lt;/p&gt;

&lt;p&gt;// Iterate over the pages and import each page into new PDDocuments added to retVal&lt;br/&gt;
return retVal;&lt;br/&gt;
}&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Because splitter internally creates new PDDocument and performs importPage() referencing the individual pages from the master document, the master document falls of of scope the moment the splitter&apos;s work is done. Not unreasonable.&lt;/p&gt;

&lt;p&gt;The trouble is that importPage passes the new PDPage a reference to the original&apos;s scratchFile. So the moment the GC clears up the master document having returned to a() the scratchFile is closed, causing a()&apos;s saving to crash. All blindingly obvious when you realise the scratchFile is being copied inside the importPage routine which most people might expect would perform a clean clone.&lt;/p&gt;

&lt;p&gt;That hopefully concludes things. We can of course re-work our code to avoid the bug but it would be sensible to make importPage perform a proper clone at some point.&lt;/p&gt;</comment>
                            <comment id="13649315" author="lehmi" created="Sun, 5 May 2013 10:56:00 +0000"  >&lt;p&gt;@James: Thanks for the investigation. I&apos;ve removed the usage of the source scratch file when importing a page to a new document in revision 1479287. This should solve the described issue.&lt;/p&gt;</comment>
                            <comment id="13649330" author="lehmi" created="Sun, 5 May 2013 13:07:45 +0000"  >&lt;p&gt;Set to resolved as the root cause was found.&lt;/p&gt;</comment>
                            <comment id="13649345" author="jmkgreen" created="Sun, 5 May 2013 14:48:03 +0000"  >&lt;p&gt;Can we get a 1.8.2 in maven central so we can use this please? Then you can rightfully mark it resolved &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13649349" author="lehmi" created="Sun, 5 May 2013 14:55:53 +0000"  >&lt;p&gt;We didn&apos;t have a schedule for the next bugfix release yet.&lt;/p&gt;</comment>
                            <comment id="13679435" author="andy.dale" created="Mon, 10 Jun 2013 11:14:25 +0000"  >&lt;p&gt;Even though the bug has been set to fixed in the 1.8.2 release of PDFBox, it is in my opinion still there.  A simplified test case is:&lt;/p&gt;

&lt;p&gt;    @Test&lt;br/&gt;
    public void testPdfBox2() throws Exception {&lt;br/&gt;
        PDDocument returnDocument = new PDDocument();&lt;br/&gt;
        String outputFilename = &quot;/tmp/output.pdf&quot;;&lt;/p&gt;

&lt;p&gt;        List&amp;lt;Integer&amp;gt; pages = Arrays.asList(1, 2, 3, 4, 5);&lt;/p&gt;

&lt;p&gt;        try {&lt;br/&gt;
            // get/load current document&lt;br/&gt;
            PDDocument currentPdf = PDDocument.load(new File(&quot;/tmp/input.pdf&quot;));&lt;/p&gt;

&lt;p&gt;            @SuppressWarnings(&quot;unchecked&quot;)&lt;br/&gt;
            List&amp;lt;PDPage&amp;gt; currentDocumentPages = currentPdf.getDocumentCatalog().getAllPages();&lt;/p&gt;

&lt;p&gt;            for (Integer currentPage : pages) &lt;/p&gt;
{
                returnDocument.importPage(currentDocumentPages.get(currentPage - 1));
            }

&lt;p&gt;            currentPdf.close(); // cause of the problem, and everything works ok if this is closed after the returnDocument.save and returnDocument.close is called.&lt;/p&gt;

&lt;p&gt;        } finally &lt;/p&gt;
{
            returnDocument.save(outputFilename);
            returnDocument.close();
        }
&lt;p&gt;    }  &lt;/p&gt;

&lt;p&gt;This gives me the following stacktrace:&lt;/p&gt;

&lt;p&gt;org.apache.pdfbox.exceptions.COSVisitorException: java.lang.IndexOutOfBoundsException: Index: 72, Size: 0&lt;br/&gt;
        at org.apache.pdfbox.pdfwriter.COSWriter.visitFromStream(COSWriter.java:1354)&lt;br/&gt;
        at org.apache.pdfbox.cos.COSStream.accept(COSStream.java:217)&lt;br/&gt;
        at org.apache.pdfbox.cos.COSObject.accept(COSObject.java:206)&lt;br/&gt;
        at org.apache.pdfbox.pdfwriter.COSWriter.doWriteObject(COSWriter.java:525)&lt;br/&gt;
        at org.apache.pdfbox.pdfwriter.COSWriter.doWriteBody(COSWriter.java:435)&lt;br/&gt;
        at org.apache.pdfbox.pdfwriter.COSWriter.visitFromDocument(COSWriter.java:1122)&lt;br/&gt;
        at org.apache.pdfbox.cos.COSDocument.accept(COSDocument.java:552)&lt;br/&gt;
        at org.apache.pdfbox.pdfwriter.COSWriter.write(COSWriter.java:1501)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.PDDocument.save(PDDocument.java:1324)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.PDDocument.save(PDDocument.java:1305)&lt;br/&gt;
        at org.apache.pdfbox.pdmodel.PDDocument.save(PDDocument.java:1292)&lt;br/&gt;
        at com.test.PdfBoxTest.testPdfBox2(PdfBoxTest.java:77)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)&lt;br/&gt;
        at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)&lt;br/&gt;
        at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)&lt;br/&gt;
        at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)&lt;br/&gt;
        at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:271)&lt;br/&gt;
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:70)&lt;br/&gt;
        at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)&lt;br/&gt;
        at org.junit.runners.ParentRunner$3.run(ParentRunner.java:238)&lt;br/&gt;
        at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:63)&lt;br/&gt;
        at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:236)&lt;br/&gt;
        at org.junit.runners.ParentRunner.access$000(ParentRunner.java:53)&lt;br/&gt;
        at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:229)&lt;br/&gt;
        at org.junit.runners.ParentRunner.run(ParentRunner.java:309)&lt;br/&gt;
        at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50)&lt;br/&gt;
        at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)&lt;br/&gt;
        at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)&lt;br/&gt;
        at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)&lt;br/&gt;
        at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)&lt;br/&gt;
        at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)&lt;br/&gt;
Caused by: java.lang.IndexOutOfBoundsException: Index: 72, Size: 0&lt;br/&gt;
        at java.util.ArrayList.RangeCheck(ArrayList.java:547)&lt;br/&gt;
        at java.util.ArrayList.get(ArrayList.java:322)&lt;br/&gt;
        at org.apache.pdfbox.io.RandomAccessBuffer.seek(RandomAccessBuffer.java:84)&lt;br/&gt;
        at org.apache.pdfbox.io.RandomAccessFileInputStream.read(RandomAccessFileInputStream.java:96)&lt;br/&gt;
        at java.io.BufferedInputStream.fill(BufferedInputStream.java:218)&lt;br/&gt;
        at java.io.BufferedInputStream.read1(BufferedInputStream.java:258)&lt;br/&gt;
        at java.io.BufferedInputStream.read(BufferedInputStream.java:317)&lt;br/&gt;
        at org.apache.pdfbox.pdfwriter.COSWriter.visitFromStream(COSWriter.java:1337)&lt;br/&gt;
        ... 34 more&lt;/p&gt;

&lt;p&gt;I am using JDK 1.6.0_33 on Linux 64-Bit (Ubuntu)&lt;/p&gt;</comment>
                            <comment id="13783032" author="jmkgreen" created="Tue, 1 Oct 2013 15:05:00 +0000"  >&lt;p&gt;We have new code and it triggers the same bug with PDFBox 1.8.2. This time I&apos;m really not sure we can refactor to avoid it.&lt;/p&gt;</comment>
                            <comment id="13783038" author="jmkgreen" created="Tue, 1 Oct 2013 15:09:20 +0000"  >&lt;p&gt;org.apache.pdfbox.exceptions.COSVisitorException: java.lang.IndexOutOfBoundsException: Index: 0, Size: 0&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.visitFromStream(COSWriter.java:1354)&lt;br/&gt;
	at org.apache.pdfbox.cos.COSStream.accept(COSStream.java:217)&lt;br/&gt;
	at org.apache.pdfbox.cos.COSObject.accept(COSObject.java:206)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.doWriteObject(COSWriter.java:525)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.doWriteBody(COSWriter.java:435)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.visitFromDocument(COSWriter.java:1122)&lt;br/&gt;
	at org.apache.pdfbox.cos.COSDocument.accept(COSDocument.java:552)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.write(COSWriter.java:1501)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.PDDocument.save(PDDocument.java:1324)&lt;/p&gt;

&lt;p&gt;With 1.8.2, again mostly at random. This time our code is very complex with PDDocuments being optionally loaded in then at the end imported into a master document. Trouble is that the optional PDDocuments fall out of scope within both a for loop and if conditions. The master document saves after all is otherwise complete.&lt;/p&gt;</comment>
                            <comment id="13783108" author="jmkgreen" created="Tue, 1 Oct 2013 16:41:00 +0000"  >&lt;p&gt;If I comment out line 564 of &lt;a href=&quot;http://svn.apache.org/viewvc/pdfbox/tags/1.8.2/pdfbox/src/main/java/org/apache/pdfbox/cos/COSDocument.java?revision=1487585&amp;amp;view=markup&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/pdfbox/tags/1.8.2/pdfbox/src/main/java/org/apache/pdfbox/cos/COSDocument.java?revision=1487585&amp;amp;view=markup&lt;/a&gt; (our old friend COSDocument.close:scratchFile.close()) I get 10/10 successive passes of the test - I can&apos;t get beyond three otherwise.&lt;/p&gt;

&lt;p&gt;I&apos;m open to options at this point. The only one I can think of right now is forking and making the fix myself. Just like I did for the pull request back in May.&lt;/p&gt;</comment>
                            <comment id="13783125" author="jmkgreen" created="Tue, 1 Oct 2013 17:01:57 +0000"  >&lt;p&gt;Unit test that demonstrates the problem and causes our stack trace.&lt;/p&gt;

&lt;p&gt;-------------------------------------------------------------------------------&lt;br/&gt;
Test set: org.apache.pdfbox.TestBuildNewDocumentFromMultipleSources&lt;br/&gt;
-------------------------------------------------------------------------------&lt;br/&gt;
Tests run: 1, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 0.626 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
testCreateDocument(org.apache.pdfbox.TestBuildNewDocumentFromMultipleSources)  Time elapsed: 0.574 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
org.apache.pdfbox.exceptions.COSVisitorException: java.lang.IndexOutOfBoundsException: Index: 13, Size: 0&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.visitFromStream(COSWriter.java:1354)&lt;br/&gt;
	at org.apache.pdfbox.cos.COSStream.accept(COSStream.java:217)&lt;br/&gt;
	at org.apache.pdfbox.cos.COSObject.accept(COSObject.java:206)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.doWriteObject(COSWriter.java:525)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.doWriteBody(COSWriter.java:435)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.visitFromDocument(COSWriter.java:1122)&lt;br/&gt;
	at org.apache.pdfbox.cos.COSDocument.accept(COSDocument.java:552)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.write(COSWriter.java:1501)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.PDDocument.save(PDDocument.java:1335)&lt;br/&gt;
	at org.apache.pdfbox.TestBuildNewDocumentFromMultipleSources.testCreateDocument(TestBuildNewDocumentFromMultipleSources.java:58)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:601)&lt;br/&gt;
	at junit.framework.TestCase.runTest(TestCase.java:168)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:134)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:110)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:128)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:113)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:124)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:232)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:227)&lt;br/&gt;
	at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83)&lt;br/&gt;
	at org.apache.maven.surefire.junit4.JUnit4TestSet.execute(JUnit4TestSet.java:53)&lt;br/&gt;
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:123)&lt;br/&gt;
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:104)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:601)&lt;br/&gt;
	at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:164)&lt;br/&gt;
	at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:110)&lt;br/&gt;
	at org.apache.maven.surefire.booter.SurefireStarter.invokeProvider(SurefireStarter.java:172)&lt;br/&gt;
	at org.apache.maven.surefire.booter.SurefireStarter.runSuitesInProcessWhenForked(SurefireStarter.java:104)&lt;br/&gt;
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:70)&lt;br/&gt;
Caused by: java.lang.IndexOutOfBoundsException: Index: 13, Size: 0&lt;br/&gt;
	at java.util.ArrayList.rangeCheck(ArrayList.java:604)&lt;br/&gt;
	at java.util.ArrayList.get(ArrayList.java:382)&lt;br/&gt;
	at org.apache.pdfbox.io.RandomAccessBuffer.seek(RandomAccessBuffer.java:84)&lt;br/&gt;
	at org.apache.pdfbox.io.RandomAccessFileInputStream.read(RandomAccessFileInputStream.java:96)&lt;br/&gt;
	at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)&lt;br/&gt;
	at java.io.BufferedInputStream.read1(BufferedInputStream.java:275)&lt;br/&gt;
	at java.io.BufferedInputStream.read(BufferedInputStream.java:334)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.visitFromStream(COSWriter.java:1337)&lt;br/&gt;
	... 34 more&lt;/p&gt;</comment>
                            <comment id="13783874" author="jmkgreen" created="Wed, 2 Oct 2013 12:36:39 +0000"  >&lt;p&gt;My GitHub fork &lt;a href=&quot;https://github.com/jmkgreen/pdfbox&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jmkgreen/pdfbox&lt;/a&gt; now has a 1.8.2.1 branch+tag with the swapFile line commented out. Switching to an internally hosted package, our projects appear to be green so far. It would be great to hear if there are any obvious concerns about this in particular regarding memory leaks sooner rather than later. Clearly this will only be maintained so long as absolutely necessary.&lt;/p&gt;</comment>
                            <comment id="13823957" author="beta-brad" created="Fri, 15 Nov 2013 19:05:23 +0000"  >&lt;p&gt;I ran into this issue, and was able to work around it by cloning the pages prior to importing, as seen in &lt;em&gt;PDFMergeUtility.java&lt;/em&gt;.  &lt;/p&gt;

&lt;p&gt;PDPage newPage = new PDPage( (COSDictionary)cloner.cloneForNewDocument( page.getCOSDictionary() ) );&lt;br/&gt;
newPage.setCropBox( page.findCropBox() );&lt;br/&gt;
newPage.setMediaBox( page.findMediaBox() );&lt;br/&gt;
newPage.setRotation( page.findRotation() );&lt;/p&gt;

&lt;p&gt;This solution will still conserve pdf size (unlike the PDFMergeUtility), as well as avoid complications from the scratchFile issue described above.  &lt;/p&gt;
</comment>
                            <comment id="13825492" author="beta-brad" created="Mon, 18 Nov 2013 17:16:13 +0000"  >&lt;p&gt;I need to retract my previous solution above. The problem still persists with this method..  However I was truly able to work around the problem by keeping a list of all PDDocuments created, so they don&apos;t get GC&apos;d before I call close().  I&apos;ll be moving forward with this strategy until this issue is resolved. &lt;/p&gt;</comment>
                            <comment id="14030492" author="jmkgreen" created="Fri, 13 Jun 2014 11:01:40 +0000"  >&lt;p&gt;Given the internal APi changes flagged necessary to get this fixed - are we now looking at the roadmap to 2.0 or 3.0?&lt;/p&gt;

&lt;p&gt;Our servers are logging lots of warnings from PDFBox as a result of our forked version avoiding the closure. Would be good to get this fixed properly.&lt;/p&gt;</comment>
                            <comment id="14133166" author="lehmi" created="Sun, 14 Sep 2014 11:23:22 +0000"  >&lt;p&gt;I&apos;ve overhauled the scratch file usage for 2.0.0, so that the scratch file isn&apos;t exposed anymore, see &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2301&quot; title=&quot;RandomAccessBuffer consumes too much memory.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2301&quot;&gt;&lt;del&gt;PDFBOX-2301&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jgreen&quot; class=&quot;user-hover&quot; rel=&quot;jgreen&quot;&gt;jgreen&lt;/a&gt; I&apos;ve checked your testcase using the versions 1.8.3, 1.8.6 and the current 1.8 branch and everything works fine. Can you confirm that?&lt;/p&gt;</comment>
                            <comment id="14143321" author="jmkgreen" created="Mon, 22 Sep 2014 15:46:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; I&apos;ve just returned from annual leave and updated to 1.8.7 - so far all tests are passing. However, they fail usually at random (GC by nature), is there something specific in 1.8.3 you think has fixed our issue? I don&apos;t spot anything on the resolved list for 1.8.3 relevant.&lt;/p&gt;</comment>
                            <comment id="14218041" author="jmkgreen" created="Wed, 19 Nov 2014 15:54:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; We&apos;ve just had another random crash. I say random - there have been several builds without failure but jenkins just performed a release of the project and the next snapshot failed so I&apos;m guessing it&apos;s another garbage collection issue. Stacktrace follows, do you want this as a new JIRA? Using PDFBox-1.8.7.&lt;/p&gt;

&lt;p&gt;org.apache.pdfbox.exceptions.COSVisitorException: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.visitFromStream(COSWriter.java:1367)&lt;br/&gt;
	at org.apache.pdfbox.cos.COSStream.accept(COSStream.java:238)&lt;br/&gt;
	at org.apache.pdfbox.cos.COSObject.accept(COSObject.java:206)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.doWriteObject(COSWriter.java:530)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.doWriteBody(COSWriter.java:436)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.visitFromDocument(COSWriter.java:1135)&lt;br/&gt;
	at org.apache.pdfbox.cos.COSDocument.accept(COSDocument.java:568)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.write(COSWriter.java:1517)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.PDDocument.save(PDDocument.java:1346)&lt;br/&gt;
[ our app ... ]&lt;br/&gt;
Caused by: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.pdfbox.io.RandomAccessFileInputStream.read(RandomAccessFileInputStream.java:94)&lt;br/&gt;
	at java.io.BufferedInputStream.fill(BufferedInputStream.java:235)&lt;br/&gt;
	at java.io.BufferedInputStream.read1(BufferedInputStream.java:275)&lt;br/&gt;
	at java.io.BufferedInputStream.read(BufferedInputStream.java:334)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.visitFromStream(COSWriter.java:1350)&lt;br/&gt;
	... 41 more&lt;/p&gt;</comment>
                            <comment id="14909339" author="chengas123" created="Sat, 26 Sep 2015 16:45:41 +0000"  >&lt;p&gt;I wanted to clarify the status of this issue. It is fixed in 2.0.0, but remains on the 1.8 branch?&lt;/p&gt;

&lt;p&gt;It sounds extremely difficult if possible at all to fix for 1.8. I&apos;m wondering if we should leave this bug open. I.e. do we think it&apos;s possible to fix for 1.8 or should we just work towards getting 2.0 out the door and telling folks to use that?&lt;/p&gt;</comment>
                            <comment id="14909358" author="tilman" created="Sat, 26 Sep 2015 17:18:41 +0000"  >&lt;p&gt;It means that it was (thought to be) fixed for 2.0 but not for 1.8. I assume it was reopened because the error happened again in 2.0.&lt;/p&gt;</comment>
                            <comment id="14909361" author="chengas123" created="Sat, 26 Sep 2015 17:27:36 +0000"  >&lt;p&gt;It was reopened on 01/Oct/13, but the 2.0 fix was committed on 14/Sep/14, so I don&apos;t think that this error is happening on 2.0 anymore.&lt;/p&gt;</comment>
                            <comment id="14940856" author="tilman" created="Fri, 2 Oct 2015 07:36:53 +0000"  >&lt;p&gt;... which is a good reason to remove the 2.0 target. The internal stream stuff was rewritten. I&apos;m not closing it because it is unclear if it has been fixed in 1.8.&lt;/p&gt;</comment>
                            <comment id="17751474" author="lehmi" created="Mon, 7 Aug 2023 06:26:29 +0000"  >&lt;p&gt;It looks like it works in 2.x and 3.x at least there aren&apos;t any complaints &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Closed as &quot;Won&apos;t Fix&quot; as there won&apos;t be any fix for 1.8.x&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12738016">PDFBOX-2301</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12518733">PDFBOX-1093</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12606133" name="TestBuildNewDocumentFromMultipleSources.java" size="2619" author="jmkgreen" created="Tue, 1 Oct 2013 17:01:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>325755</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1k77r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>326100</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>