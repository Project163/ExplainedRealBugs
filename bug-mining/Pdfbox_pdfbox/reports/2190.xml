<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:09:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4233] Flatten does not work properly on field with type 0 font</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4233</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Pdf form&#160;&lt;b&gt;sampleform_filled.pdf&lt;/b&gt; contains one field called &quot;txtField&quot; with this content: &quot;&#283;&#353;&#269;&#345;&#382;&#253;&#225;&#237;&#233;&#250;&#367;&#243;&#271;&#357;&#282;&#352;&#268;&#344;&#381;&#221;&#193;&#205;&#201;&#218;&#366;&#211;&#270;&#356;&quot;.&#160; The font used in this field is &quot;/F5&quot;&lt;/p&gt;

&lt;p&gt;when you run this code:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
 PDDocument sourcePdfForm = PDDocument.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;sampleform_filled.pdf&quot;&lt;/span&gt;));
 PDAcroForm acroForm = sourcePdfForm.getDocumentCatalog()
 .getAcroForm();

 acroForm.flatten();
 sourcePdfForm.save(&lt;span class=&quot;code-quote&quot;&gt;&quot;sampleform_filled_flattened.pdf&quot;&lt;/span&gt;);
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
 e.printStackTrace();
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;You will get &lt;b&gt;sampleform_filled_flattened.pdf&lt;/b&gt; with empty or not visible content of the field.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment>win10, JDK 1.8</environment>
        <key id="13162646">PDFBOX-4233</key>
            <summary>Flatten does not work properly on field with type 0 font</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="rumburak">rumburak</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 May 2018 16:39:55 +0000</created>
                <updated>Thu, 28 Feb 2019 17:45:05 +0000</updated>
                            <resolved>Fri, 8 Feb 2019 13:25:59 +0000</resolved>
                                    <version>2.0.10</version>
                                    <fixVersion>2.0.14</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>AcroForm</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16762975" author="tilman" created="Thu, 7 Feb 2019 19:03:29 +0000"  >&lt;p&gt;Your file has empty appearance streams and needAppearances set so PDFBox should first draw the appearances, but it doesn&apos;t do that (Adobe does). This could be done like this by the user:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
acroForm.refreshAppearances();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but it doesn&apos;t work:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalArgumentException: No glyph &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; U+011B (&#283;) in font AACDGC+TimesSansSerif
	at org.apache.pdfbox.pdmodel.font.PDCIDFontType2.encode(PDCIDFontType2.java:366)
	at org.apache.pdfbox.pdmodel.font.PDType0Font.encode(PDType0Font.java:433)
	at org.apache.pdfbox.pdmodel.font.PDFont.encode(PDFont.java:328)
	at org.apache.pdfbox.pdmodel.font.PDFont.getStringWidth(PDFont.java:357)
	at org.apache.pdfbox.pdmodel.interactive.form.PlainTextFormatter.format(PlainTextFormatter.java:195)
	at org.apache.pdfbox.pdmodel.interactive.form.AppearanceGeneratorHelper.insertGeneratedAppearance(AppearanceGeneratorHelper.java:507)
	at org.apache.pdfbox.pdmodel.interactive.form.AppearanceGeneratorHelper.setAppearanceContent(AppearanceGeneratorHelper.java:366)
	at org.apache.pdfbox.pdmodel.interactive.form.AppearanceGeneratorHelper.setAppearanceValue(AppearanceGeneratorHelper.java:238)
	at org.apache.pdfbox.pdmodel.interactive.form.PDTextField.constructAppearances(PDTextField.java:262)
	at org.apache.pdfbox.pdmodel.interactive.form.PDTerminalField.applyChange(PDTerminalField.java:226)
	at org.apache.pdfbox.pdmodel.interactive.form.PDTextField.setValue(PDTextField.java:218)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I haven&apos;t understood all the details, but it seems that this font subset is missing some details to encode unicode to the codes used in the PDF.&lt;/p&gt;

&lt;p&gt;The best is not to use subsets for fonts in acroform fields. This doesn&apos;t end well, because a user might use characters not in the font.&lt;/p&gt;

&lt;p&gt;Another solution would be to replace the font:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
PDDocument sourcePdfForm = PDDocument.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;sampleform_filled.pdf&quot;&lt;/span&gt;));
PDAcroForm acroForm = sourcePdfForm.getDocumentCatalog().getAcroForm();
PDResources defaultResources = acroForm.getDefaultResources();
InputStream is = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(&lt;span class=&quot;code-quote&quot;&gt;&quot;c:/windows/fonts/times.ttf&quot;&lt;/span&gt;);
defaultResources.put(COSName.getPDFName(&lt;span class=&quot;code-quote&quot;&gt;&quot;F5&quot;&lt;/span&gt;), PDType0Font.load(sourcePdfForm, is, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;));
acroForm.refreshAppearances();
acroForm.flatten();
sourcePdfForm.save(&lt;span class=&quot;code-quote&quot;&gt;&quot;sampleform_filled_flattened.pdf&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16763585" author="jira-bot" created="Fri, 8 Feb 2019 13:24:11 +0000"  >&lt;p&gt;Commit 1853211 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1853211&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1853211&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4233&quot; title=&quot;Flatten does not work properly on field with type 0 font&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4233&quot;&gt;&lt;del&gt;PDFBOX-4233&lt;/del&gt;&lt;/a&gt;: add warning that subsetted font means trouble and what to do&lt;/p&gt;</comment>
                            <comment id="16763586" author="jira-bot" created="Fri, 8 Feb 2019 13:24:15 +0000"  >&lt;p&gt;Commit 1853212 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1853212&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1853212&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4233&quot; title=&quot;Flatten does not work properly on field with type 0 font&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4233&quot;&gt;&lt;del&gt;PDFBOX-4233&lt;/del&gt;&lt;/a&gt;: add warning that subsetted font means trouble and what to do&lt;/p&gt;</comment>
                            <comment id="16763587" author="jira-bot" created="Fri, 8 Feb 2019 13:25:02 +0000"  >&lt;p&gt;Commit 1853213 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1853213&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1853213&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4233&quot; title=&quot;Flatten does not work properly on field with type 0 font&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4233&quot;&gt;&lt;del&gt;PDFBOX-4233&lt;/del&gt;&lt;/a&gt;: add warning that visual field appearances may not have been set when /NeedAppearances is set and what to do&lt;/p&gt;</comment>
                            <comment id="16763588" author="jira-bot" created="Fri, 8 Feb 2019 13:25:06 +0000"  >&lt;p&gt;Commit 1853214 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1853214&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1853214&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4233&quot; title=&quot;Flatten does not work properly on field with type 0 font&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4233&quot;&gt;&lt;del&gt;PDFBOX-4233&lt;/del&gt;&lt;/a&gt;: add warning that visual field appearances may not have been set when /NeedAppearances is set and what to do&lt;/p&gt;</comment>
                            <comment id="16763590" author="tilman" created="Fri, 8 Feb 2019 13:25:59 +0000"  >&lt;p&gt;The changes don&apos;t make the problem go away, but the log messages will show the causes and ways out.&lt;/p&gt;</comment>
                            <comment id="16767166" author="rumburak" created="Wed, 13 Feb 2019 13:04:08 +0000"  >&lt;p&gt;ok,&#160;&lt;/p&gt;

&lt;p&gt;understood. Thanks for support.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Rumburak&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12925579" name="sampleform_filled.pdf" size="33598" author="rumburak" created="Tue, 29 May 2018 16:37:46 +0000"/>
                            <attachment id="12925578" name="sampleform_filled_flattened.pdf" size="33576" author="rumburak" created="Tue, 29 May 2018 16:37:51 +0000"/>
                            <attachment id="12925580" name="sampleform_filled_in_acrobat_reader.png" size="17359" author="rumburak" created="Tue, 29 May 2018 16:42:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3u9qn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>