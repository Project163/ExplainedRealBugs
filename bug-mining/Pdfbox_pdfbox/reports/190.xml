<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:53:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1125] NullPointerException when saving Document</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1125</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I am trying to fill out this form(official Norwegian Government form): &lt;a href=&quot;http://www.nav.no/Om+NAV/Skjemaer/Arbeidsgiverskjemaer/L%C3%B8nn+og+personalskjemaer+for+din+bedrift+%28HR%29/Yrkesskade/_attachment/1073746888?_ts=1271f676c80&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.nav.no/Om+NAV/Skjemaer/Arbeidsgiverskjemaer/L%C3%B8nn+og+personalskjemaer+for+din+bedrift+%28HR%29/Yrkesskade/_attachment/1073746888?_ts=1271f676c80&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;My code looks as follows: &lt;/p&gt;

&lt;p&gt;  public void setKode(InputStream inputStream, String value, OutputStream output) throws IOException, COSVisitorException&lt;br/&gt;
  {&lt;br/&gt;
    PDDocument pdfDocument = PDDocument.load(inputStream);&lt;br/&gt;
    if (LOGGER.isInfoEnabled())&lt;/p&gt;
    {
      LOGGER.info(pdfDocument.getCurrentAccessPermission().toString());
    }
&lt;p&gt;    PDDocumentCatalog docCatalog = pdfDocument.getDocumentCatalog();&lt;br/&gt;
    PDAcroForm acroForm = docCatalog.getAcroForm();&lt;br/&gt;
    PDField field = acroForm.getField(&quot;beskrivelse&quot;);&lt;br/&gt;
    if (field != null)&lt;br/&gt;
    &lt;/p&gt;
{
      field.setValue(value);
    }
&lt;p&gt; else&lt;/p&gt;
    {
      System.err.println(&quot;No field found with name:&quot; + &quot;beskrivelse&quot;);
    }
&lt;p&gt;    pdfDocument.save(output);&lt;br/&gt;
  }&lt;/p&gt;


&lt;p&gt;While trying to fill in the field &quot;beskrivelse&quot; (or any other field in this form) I get the following stacktrace:&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
	at java.io.FilterInputStream.close(FilterInputStream.java:155)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.doWriteSignature(COSWriter.java:688)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.visitFromDocument(COSWriter.java:1039)&lt;br/&gt;
	at org.apache.pdfbox.cos.COSDocument.accept(COSDocument.java:456)&lt;br/&gt;
	at org.apache.pdfbox.pdfwriter.COSWriter.write(COSWriter.java:1360)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.PDDocument.save(PDDocument.java:1121)&lt;br/&gt;
	at com.qmplus.PDFTest.App.setKode(App.java:36)&lt;br/&gt;
	at com.qmplus.PDFTest.AppTest.test(AppTest.java:35)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)&lt;br/&gt;
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)&lt;br/&gt;
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)&lt;br/&gt;
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)&lt;br/&gt;
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:263)&lt;br/&gt;
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:69)&lt;br/&gt;
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:48)&lt;br/&gt;
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:231)&lt;br/&gt;
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:60)&lt;br/&gt;
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:229)&lt;br/&gt;
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:50)&lt;br/&gt;
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:222)&lt;br/&gt;
	at org.junit.runners.ParentRunner.run(ParentRunner.java:292)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)&lt;/p&gt;

&lt;p&gt;The funny thing is, the output is created and looks to my eyes fine...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12524850">PDFBOX-1125</key>
            <summary>NullPointerException when saving Document</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="pabich">Per Abich</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Sep 2011 12:19:12 +0000</created>
                <updated>Tue, 29 May 2012 16:21:45 +0000</updated>
                            <resolved>Tue, 1 Nov 2011 16:37:20 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.7.0</fixVersion>
                                    <component>Writing</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13115459" author="pabich" created="Tue, 27 Sep 2011 12:55:58 +0000"  >&lt;p&gt;I found out what is happening. The Save operation tries to calculate the signature, but for this it accesses the Incremental Data which is not existent. So in COSWriter:679 a COSFilterInputStream is created with a &apos;null&apos; inputStream. The loop still handles it fine, but the &quot;close&quot;-operation fails with NPE. &lt;/p&gt;

&lt;p&gt;Since I am doing a normal save, all the initialization for the incremental stuff seems to be skipped. And since the Incremental save requires a FileInputStream, I guess I cannot use it anyways.&lt;/p&gt;</comment>
                            <comment id="13141100" author="gerhardt" created="Tue, 1 Nov 2011 12:21:37 +0000"  >&lt;p&gt;I have the same problem with pdfbox version 1.6 - using pdfbox version 1.4 the problem is not reproducible:&lt;br/&gt;
An additional check before calling doWriteSignature in the visitFromDocument function (COSWriter.java) fixed the problem:&lt;/p&gt;


&lt;p&gt;&amp;#8212; COSWriter.java.ori	2011-06-28 21:35:28.000000000 +0200&lt;br/&gt;
+++ COSWriter.java	2011-10-31 12:05:20.763036700 +0100&lt;br/&gt;
@@ -1036,7 +1036,8 @@&lt;br/&gt;
             else&lt;br/&gt;
                 doWriteXRef(doc);&lt;br/&gt;
             doWriteTrailer(doc);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;doWriteSignature(doc);&lt;br/&gt;
+            if(incrementalUpdate)&lt;br/&gt;
+                doWriteSignature(doc);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;             return null;&lt;br/&gt;
         }&lt;/p&gt;</comment>
                            <comment id="13141142" author="pabich" created="Tue, 1 Nov 2011 13:02:44 +0000"  >&lt;p&gt;I hope this fix will make it into the next release - whenever that is.&lt;/p&gt;</comment>
                            <comment id="13141301" author="lehmi" created="Tue, 1 Nov 2011 16:37:20 +0000"  >&lt;p&gt;I added the patch in revision 1196104 as proposed by Gerhard. I also did some reformating.&lt;/p&gt;

&lt;p&gt;Thanks for the contribution!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19178</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 3 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ziuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>205355</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>