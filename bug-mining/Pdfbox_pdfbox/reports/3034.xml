<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:15:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4744] PageDrawer is not rendering unrotatable Annotations on rotated pages</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4744</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Unrotatable Annotations are no longer rendered by the PageDrawer.&lt;/p&gt;

&lt;p&gt;The issue can be reproduced using the attached &quot;simple.pdf&quot; and the following code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;... args) {
        File pdfFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;pathto&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;simple.pdf&quot;&lt;/span&gt;);
        BufferedImage actualImage = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDDocument document = PDDocument.load(pdfFile)) {
                PDFRenderer pdfRenderer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFRenderer(document);
                pdfRenderer.setAnnotationsFilter(PDAnnotation::isPrinted);
                pdfRenderer.setDefaultDestination(RenderDestination.VIEW);
                actualImage = pdfRenderer.renderImage(0);
            }

            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (actualImage != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                ImageIO.write(actualImage, &lt;span class=&quot;code-quote&quot;&gt;&quot;png&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;somePath&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;out.png&quot;&lt;/span&gt;));
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
            e.printStackTrace();
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When setting the page rotation to 0 the annotation can be seen in the &quot;out.png&quot;, when selecting another rotation, it is gone.&lt;/p&gt;

&lt;p&gt;I am assuming, that the following code in PageDrawer (Method: showAnnotation(PDAnnotation annotation) Lines: 886 to 892) is not working as expected. Maybe the rotation anchor should be set to a different position?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (annotation.isNoRotate() &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getCurrentPage().getRotation() != 0) {
      PDRectangle rect = annotation.getRectangle();
      AffineTransform savedTransform =&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.graphics.getTransform();
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.graphics.rotate(&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.toRadians((&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getCurrentPage().getRotation()), (&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)rect.getLowerLeftX(),(&lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;)rect.getUpperRightY());
      &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.showAnnotation(annotation);
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.graphics.setTransform(savedTransform);
   } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.showAnnotation(annotation);
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The flags of the annotation are:&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12991235/12991235_screenshot-1.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;</description>
                <environment></environment>
        <key id="13280148">PDFBOX-4744</key>
            <summary>PageDrawer is not rendering unrotatable Annotations on rotated pages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="capSVD">Christian Appl</reporter>
                        <labels>
                            <label>Annotations</label>
                            <label>PDFBox</label>
                            <label>PageDrawer</label>
                    </labels>
                <created>Fri, 17 Jan 2020 14:38:50 +0000</created>
                <updated>Thu, 24 Apr 2025 18:37:52 +0000</updated>
                            <resolved>Thu, 6 Feb 2025 09:59:55 +0000</resolved>
                                    <version>2.0.18</version>
                    <version>2.0.33</version>
                    <version>3.0.4 PDFBox</version>
                                    <fixVersion>2.0.34</fixVersion>
                    <fixVersion>3.0.5 PDFBox</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17018487" author="tilman" created="Sat, 18 Jan 2020 03:40:55 +0000"  >&lt;p&gt;Yeah it can be reproduced in PDFDebugger with default settings. Re &quot;are no longer rendered&quot; they were rendered until 2.0.15, but rotated. This is weird because in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4447&quot; title=&quot;Support NoRotate flag when rendering annotations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4447&quot;&gt;&lt;del&gt;PDFBOX-4447&lt;/del&gt;&lt;/a&gt; where the NoRotate code was created, I had created a test PDF to verify that it works.&lt;/p&gt;</comment>
                            <comment id="17915957" author="tilman" created="Wed, 22 Jan 2025 08:22:09 +0000"  >&lt;p&gt;I&apos;ve tried solving this one a few times over the years and failed. Yesterday while playing around and trying all sort of modifications, I added &lt;tt&gt;graphics.translate(-30, 0);&lt;/tt&gt; just before &lt;tt&gt;super.showAnnotation(annotation);&lt;/tt&gt; and the annotation appeared, but in the &quot;wrong&quot; rotation, despite that we did apply a rotation transformation to the graphics device. This pointed me to transparency groups, where we render into a BufferedImage.&lt;/p&gt;

&lt;p&gt;So at this time there are two workarounds that make this work but are unsatisfying: 1) ignoring the /Group attribute everywhere 2) recreate the /AP ourself before rendering (the appearances we generate don&apos;t have transparency groups, except for highlight, but there the NoRotate flag wouldn&apos;t make sense anyway).&lt;/p&gt;

&lt;p&gt;I suspect that a real solution would be to apply another rotation somewhere in &lt;tt&gt;PDFStreamEngine.processAnnotation()&lt;/tt&gt;, but that method is very dangerous to change and we have only 3 test cases.&lt;/p&gt;</comment>
                            <comment id="17924458" author="jira-bot" created="Thu, 6 Feb 2025 09:56:06 +0000"  >&lt;p&gt;Commit 1923608 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1923608&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1923608&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4744&quot; title=&quot;PageDrawer is not rendering unrotatable Annotations on rotated pages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4744&quot;&gt;&lt;del&gt;PDFBOX-4744&lt;/del&gt;&lt;/a&gt;: reconstruct NoRotate annotations that have transparencies&lt;/p&gt;</comment>
                            <comment id="17924459" author="jira-bot" created="Thu, 6 Feb 2025 09:56:10 +0000"  >&lt;p&gt;Commit 1923609 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1923609&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1923609&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4744&quot; title=&quot;PageDrawer is not rendering unrotatable Annotations on rotated pages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4744&quot;&gt;&lt;del&gt;PDFBOX-4744&lt;/del&gt;&lt;/a&gt;: reconstruct NoRotate annotations that have transparencies&lt;/p&gt;</comment>
                            <comment id="17924460" author="jira-bot" created="Thu, 6 Feb 2025 09:56:18 +0000"  >&lt;p&gt;Commit 1923610 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1923610&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1923610&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4744&quot; title=&quot;PageDrawer is not rendering unrotatable Annotations on rotated pages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4744&quot;&gt;&lt;del&gt;PDFBOX-4744&lt;/del&gt;&lt;/a&gt;: reconstruct NoRotate annotations that have transparencies&lt;/p&gt;</comment>
                            <comment id="17924461" author="tilman" created="Thu, 6 Feb 2025 09:59:55 +0000"  >&lt;p&gt;I implemented one of the workarounds mentioned. This is better than what we have today which is that the annotation would sometimes not be visible at all.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12991235" name="screenshot-1.png" size="31239" author="capSVD" created="Fri, 17 Jan 2020 14:42:27 +0000"/>
                            <attachment id="12991232" name="simple.pdf" size="131466" author="capSVD" created="Fri, 17 Jan 2020 14:30:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            39 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0amco:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>