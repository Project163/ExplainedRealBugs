<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:56:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2141] Shading not applied to text</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2141</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The attached PDF draws a text filled with horizontal shading going from red to blue. When rendered via PDFBox, the text is completely filled with red. The problem is that AxialShadingContext#getRaster() gets called with positions that completely fell outside of the range stored in its coords[] field. The fix seems to be to set glyph transform rather than graphics2d transform in PageDrawer#writeText() as shown in the attached patch.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12721092">PDFBOX-2141</key>
            <summary>Shading not applied to text</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pslabycz">Petr Slaby</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Jun 2014 11:57:57 +0000</created>
                <updated>Fri, 19 Sep 2014 14:40:42 +0000</updated>
                            <resolved>Tue, 24 Jun 2014 20:55:18 +0000</resolved>
                                    <version>1.8.5</version>
                    <version>1.8.6</version>
                    <version>1.8.7</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.8.7</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14030618" author="tilman" created="Fri, 13 Jun 2014 13:35:39 +0000"  >&lt;p&gt;While it does work for your test case and &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1936&quot; title=&quot;text outline with shading pattern is invisible&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1936&quot;&gt;&lt;del&gt;PDFBOX-1936&lt;/del&gt;&lt;/a&gt;, it brings problems with some other files (see attachments).&lt;/p&gt;</comment>
                            <comment id="14031118" author="tilman" created="Fri, 13 Jun 2014 20:33:12 +0000"  >&lt;p&gt;Obviously, it is a ligature problem. I thought that a ligature is ONE glyph but at least in that code segment, it is not (although it is in the PDF source). For &quot;fi&quot;, glyphs.getNumGlyphs() == 2.&lt;/p&gt;

&lt;p&gt;This is of course not a solution, but if I use &quot;the old method&quot; for glyphs.getNumGlyphs() &amp;gt; 1 and &quot;your method&quot; for glyphs.getNumGlyphs() == 1 then I get a perfect rendering for over 100 test PDFs. (Except some very minor differences that may be the result of rounding)&lt;/p&gt;

&lt;p&gt;Could it be that if there is some relationship between the glyph entries, i.e. that the transform can&apos;t be applied to the 2nd glyph of the ligature in the same way as to the 1st?&lt;/p&gt;</comment>
                            <comment id="14031185" author="lehmi" created="Fri, 13 Jun 2014 21:17:40 +0000"  >&lt;p&gt;Maybe you should try a combination of both variants. Apply Petrs patch but move the at.scale() back inside the loop. To be frankly it doesn&apos;t make sense to me, but it is the only difference if it comes to one glyph vs. multiple glyphs&lt;/p&gt;</comment>
                            <comment id="14031215" author="tilman" created="Fri, 13 Jun 2014 21:41:32 +0000"  >&lt;p&gt;This just flips the &quot;i&quot; of &quot;fi&quot; (1st page of &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1917&quot; title=&quot;Rendering hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1917&quot;&gt;&lt;del&gt;PDFBOX-1917&lt;/del&gt;&lt;/a&gt;), still at the wrong position. Which brought me to a new idea: for the 2nd glyph, apply only the scale and not the translation. This works for one test page, I&apos;ll see if it works for all.&lt;/p&gt;</comment>
                            <comment id="14031228" author="pslabycz" created="Fri, 13 Jun 2014 21:52:31 +0000"  >&lt;p&gt;The following seems to make the trick, tested on a single file so far, though:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    private void writeFont(final AffineTransform at, final GlyphVector glyphs)
    {
        // Convert from PDF, where glyphs are upright when direction is from
        // bottom to top, to AWT, where this is the other way around
        at.scale(1, -1);
        for(int i=0; i&amp;lt;glyphs.getNumGlyphs(); i++)
        {
            AffineTransform glyphTransform = glyphs.getGlyphTransform(i);
            Point2D glyphPos = glyphs.getGlyphPosition(i);
            AffineTransform applyTransform;
            if(glyphTransform != null || glyphPos.getX() != 0 || glyphPos.getY() != 0) {
                AffineTransform translate = AffineTransform.getTranslateInstance(glyphPos.getX(), glyphPos.getY());
                if(glyphTransform != null)
                {
                    translate.concatenate(glyphTransform);
                }
                translate.preConcatenate(at);
                applyTransform = translate;
                glyphs.setGlyphPosition(i, new Point2D.Float(0, 0));
            }
            else 
            {
                applyTransform = at;
            }
            glyphs.setGlyphTransform(i, applyTransform);
        }
        graphics.drawGlyphVector(glyphs, 0, 0);        
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14031245" author="tilman" created="Fri, 13 Jun 2014 22:05:22 +0000"  >&lt;p&gt;Isn&apos;t that the same as what I do, i.e. neutralizing the translation? My current temporary code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            at.scale(1, -1);
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; glyphs.getNumGlyphs(); i++)
            {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i == 1)
                {
                    at = AffineTransform.getScaleInstance(at.getScaleX(), at.getScaleY());
                }
                glyphs.setGlyphTransform(i, at);
            }
            graphics.drawGlyphVector(glyphs, 0, 0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14031253" author="tilman" created="Fri, 13 Jun 2014 22:11:58 +0000"  >&lt;p&gt;&quot;for the 2nd glyph, apply only the scale and not the translation&quot; worked for the 100+ test files.&lt;/p&gt;</comment>
                            <comment id="14031274" author="pslabycz" created="Fri, 13 Jun 2014 22:30:48 +0000"  >&lt;p&gt;I am just not sure whether the incoming transform can also contain rotation or skew and whether you need to take that into account, too. For sure you should expect more than two glyphs, although I did not see such an example in my test suite. My code seems more generic - it concatenates everything into the glyph transform and sets its position to 0,0. On the other hand, less code is usually better...&lt;/p&gt;

&lt;p&gt;It is getting too late in the night for me now. I will retest both solutions with my test suite on Monday, but I assume they will render the same results.&lt;/p&gt;</comment>
                            <comment id="14031281" author="tilman" created="Fri, 13 Jun 2014 22:35:34 +0000"  >&lt;p&gt;Yes, nightly sessions are usually not helpful and I&apos;ll go to sleep too. Btw I saw something in your code that allowed me to remove two more lines in mine &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  (see updated code above)&lt;/p&gt;</comment>
                            <comment id="14031521" author="lehmi" created="Sat, 14 Jun 2014 09:16:40 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;at = AffineTransform.getScaleInstance(at.getScaleX(), at.getScaleY());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;eliminates not only the transformation but the shearing too. If you want to preserve that too, you might want to add something like that&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;at.shear(at.getShearX(), at.getShearY());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14031523" author="tilman" created="Sat, 14 Jun 2014 09:20:32 +0000"  >&lt;p&gt;Another good news is that the time to render all files is the same, despite the warning in the javadoc of setGlyphTransform().&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; yes indeed, I will test with &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;at = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AffineTransform(at.getScaleX(), at.getShearY(), at.getShearX(), at.getScaleY(), 0, 0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After that, I will also test the new code by Petr to see what happens and how long it takes.&lt;/p&gt;</comment>
                            <comment id="14031539" author="lehmi" created="Sat, 14 Jun 2014 10:08:29 +0000"  >&lt;p&gt;How about ignoring the translation for all glyphs and using it instead as parameters when drawing the glyphs?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;graphics.drawGlyphVector(glyphs, x, y); 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14031540" author="tilman" created="Sat, 14 Jun 2014 10:12:33 +0000"  >&lt;p&gt;Sounds like a good idea. I&apos;ll test that next. &lt;/p&gt;</comment>
                            <comment id="14031580" author="tilman" created="Sat, 14 Jun 2014 13:58:17 +0000"  >&lt;p&gt;The code of Petr worked too; and so does this code, based on the last suggestion of Andreas:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        AffineTransform atRS = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AffineTransform(at.getScaleX(), at.getShearY(), 
                -at.getShearX(), -at.getScaleY(), 0, 0);

        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; glyphs.getNumGlyphs(); i++)
        {
            glyphs.setGlyphTransform(i, atRS);
        }
        graphics.drawGlyphVector(glyphs, (&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;) at.getTranslateX(), (&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;) at.getTranslateY());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(Yes the &quot;-&quot; is correct. Either that or an extra scale(1,-1) call)&lt;/p&gt;</comment>
                            <comment id="14039402" author="tilman" created="Fri, 20 Jun 2014 21:39:01 +0000"  >&lt;p&gt;Committed in rev 1604282 for the trunk.&lt;/p&gt;</comment>
                            <comment id="14039490" author="tilman" created="Fri, 20 Jun 2014 22:44:30 +0000"  >&lt;p&gt;Fixed in the 1.8 version in rev 1604297.&lt;/p&gt;

&lt;p&gt;While working on the 1.8 version I noticed a comment that relates to &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-485&quot; title=&quot;Fonts not printed on HP laserjet (1320 &amp;amp; 8150) when having landscape orientation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-485&quot;&gt;&lt;del&gt;PDFBOX-485&lt;/del&gt;&lt;/a&gt;. In it, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vbier&quot; class=&quot;user-hover&quot; rel=&quot;vbier&quot;&gt;vbier&lt;/a&gt; told about printing problems with hp laserjet 8150 &amp;amp; hp laserjet 1320. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vbier&quot; class=&quot;user-hover&quot; rel=&quot;vbier&quot;&gt;vbier&lt;/a&gt;, are you still using PDFBox and these two printers? If yes, could you please test a snapshot version? (I will tell the URL tomorrow)&lt;/p&gt;</comment>
                            <comment id="14039738" author="tilman" created="Sat, 21 Jun 2014 08:49:24 +0000"  >&lt;p&gt;The URL is &lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox/1.8.7-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox/1.8.7-SNAPSHOT/&lt;/a&gt;&lt;br/&gt;
Take a file that is higher than number 11.&lt;/p&gt;</comment>
                            <comment id="14039833" author="tilman" created="Sat, 21 Jun 2014 14:01:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pslabycz&quot; class=&quot;user-hover&quot; rel=&quot;pslabycz&quot;&gt;pslabycz&lt;/a&gt; Would you agree that the new solution works because the transform is applied to the glyphs only, while the previous solution meant that the transform influenced &quot;also everything else that is done while rendering the glyphs&quot;?&lt;/p&gt;</comment>
                            <comment id="14039959" author="pslabycz" created="Sat, 21 Jun 2014 21:45:19 +0000"  >&lt;p&gt;My observation was that the coordinates arriving to the AxialShadingContext in getRaster() were not what the shading expects. Not applying the transform to the graphics fixed it. &lt;/p&gt;

&lt;p&gt;The problem will be that, regardless of whether the transform is applied to the graphics or to the glyphs, the coordinates arriving to getRaster() are always the same. However, the transform applied to the cords field in the constructor of AxialShadingContext is the one that was set to the graphics, i.e. it is a different one if the graphics was transformed. &lt;/p&gt;

&lt;p&gt;So yes, I agree.&lt;/p&gt;</comment>
                            <comment id="14040053" author="tilman" created="Sun, 22 Jun 2014 07:23:08 +0000"  >&lt;p&gt;pattern-shading-2-4-idMatrix.pdf is a file that I created from PostScript (also attached). The rendering of the text brings a bad surprise &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; - every glyph is rendered as if it is a single page.&lt;/p&gt;</comment>
                            <comment id="14040233" author="pslabycz" created="Sun, 22 Jun 2014 20:17:43 +0000"  >&lt;blockquote&gt;
&lt;p&gt;pattern-shading-2-4-idMatrix.pdf ...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;But the problem does not seem to be related to this issue. At least I get an identical rendering before and after the change made in revision 1604282.&lt;/p&gt;</comment>
                            <comment id="14040251" author="tilman" created="Sun, 22 Jun 2014 21:10:20 +0000"  >&lt;p&gt;Yes... sorry, I didn&apos;t make myself clear, it is not a regression, I forgot to mention that I also tested with earlier versions.&lt;/p&gt;

&lt;p&gt;What really puzzles me is that both the &lt;a href=&quot;http://pslib.sourceforge.net/shading.ps&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://pslib.sourceforge.net/shading.ps&lt;/a&gt; file and my file use a pattern-based approach and one works and the other doesn&apos;t. But I haven&apos;t had the time to analyze what really happens. &lt;/p&gt;</comment>
                            <comment id="14040456" author="vbier" created="Mon, 23 Jun 2014 06:15:06 +0000"  >&lt;p&gt;I printed the attached pdf with the snapshot version ending with 23. Printout looks good on the HP4015. The HP1320 prints the text okay, but above the text there is a horizontal line (about 3mm thick) that goes over the whole page.&lt;/p&gt;</comment>
                            <comment id="14040458" author="tilman" created="Mon, 23 Jun 2014 06:25:28 +0000"  >&lt;p&gt;Which attached PDF did you print? There are now several.&lt;/p&gt;</comment>
                            <comment id="14040461" author="vbier" created="Mon, 23 Jun 2014 06:34:07 +0000"  >&lt;p&gt;I used 000004_ShadingPatternTextPDF.pdf.&lt;/p&gt;
</comment>
                            <comment id="14040475" author="tilman" created="Mon, 23 Jun 2014 07:09:53 +0000"  >&lt;p&gt;This is really weird, because that PDF doesn&apos;t have a line. A line would be the operator &quot;l&quot;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;q
BT
50 792 Td
ET
Q
/Pattern cs /P1 scn
BT
1 0 0 1 100 100 Tm
/F1 40 Tf
(Look at &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; text!)Tj
ET
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can you try to update the printer driver and/or the firmware of that printer?&lt;/p&gt;

&lt;p&gt;I also wonder what happens if you print the 4th page of the file pslib-shading.pdf attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1942&quot; title=&quot;Regression: java.lang.IndexOutOfBoundsException in shading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1942&quot;&gt;&lt;del&gt;PDFBOX-1942&lt;/del&gt;&lt;/a&gt;. And to the file you mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-485&quot; title=&quot;Fonts not printed on HP laserjet (1320 &amp;amp; 8150) when having landscape orientation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-485&quot;&gt;&lt;del&gt;PDFBOX-485&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;And compare the print to what you get with version 1.8.6. (Which does not have that change)&lt;/p&gt;</comment>
                            <comment id="14040495" author="vbier" created="Mon, 23 Jun 2014 07:53:12 +0000"  >&lt;p&gt;Okay, i made the printouts:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;the file from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-485&quot; title=&quot;Fonts not printed on HP laserjet (1320 &amp;amp; 8150) when having landscape orientation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-485&quot;&gt;&lt;del&gt;PDFBOX-485&lt;/del&gt;&lt;/a&gt; is unchanged&lt;/li&gt;
	&lt;li&gt;pslib-shading.pdf does show text with a gradient in the new version (text is missing in the old version)&lt;/li&gt;
	&lt;li&gt;000004_ShadingPatternTextPDF.pdf does now show  text with a gradient in the new version (text is unicolored in the old version)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Both pslib... and 0000.. show the additional line on the HP1320, but that is also the case with the 1.8.6. version.&lt;br/&gt;
I can not update firmware as this is a company printer, and I am not sure with the driver as I use this as a network printer on my linux machine. &lt;/p&gt;</comment>
                            <comment id="14040860" author="tilman" created="Mon, 23 Jun 2014 15:42:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vbier&quot; class=&quot;user-hover&quot; rel=&quot;vbier&quot;&gt;vbier&lt;/a&gt; to summarize, the recent change is not harming the printing of the file of &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-485&quot; title=&quot;Fonts not printed on HP laserjet (1320 &amp;amp; 8150) when having landscape orientation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-485&quot;&gt;&lt;del&gt;PDFBOX-485&lt;/del&gt;&lt;/a&gt;, but we have discovered a new problem (unrelated to the recent change) involving printing on a HP1320 for which I have created issue &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2159&quot; title=&quot;horizontal line above shaded text when printing on HP1320&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2159&quot;&gt;&lt;del&gt;PDFBOX-2159&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14040874" author="tilman" created="Mon, 23 Jun 2014 15:51:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pslabycz&quot; class=&quot;user-hover&quot; rel=&quot;pslabycz&quot;&gt;pslabycz&lt;/a&gt; I think I found some new clues about the weird shadings. Your file and the pslib file both use standard 14 fonts. My file uses an embedded type1 font. Your file is rendered with graphics.drawGlyphVector(), my file is rendered with graphics.fill(path), and &quot;path&quot; is the shape of a glyph. Which brings us to a similar problem as the one you solved for standard 14 fonts: the shape is rendered at the same scale (0.00xxx) as its paint. But the paint should be rendered at a dpi-related scale, e.g. 4.16 for 300dpi, 1 at 72 dpi, etc. Sadly I don&apos;t have a solution at this time. Maybe create a glyphVector ourselves?&lt;/p&gt;</comment>
                            <comment id="14041034" author="tilman" created="Mon, 23 Jun 2014 17:45:39 +0000"  >&lt;p&gt;To prove my point, I mofified the postscript file so that it uses also Helvetica, which is one of the standard 14 fonts, and generated the two PDF files (as described before). The result is that now, the two Arial lines are weird, and the two Helvetica lines are correct.&lt;/p&gt;</comment>
                            <comment id="14041157" author="pslabycz" created="Mon, 23 Jun 2014 19:18:37 +0000"  >&lt;p&gt;I see. Why not do the same, then - apply the transform to the path instead of the graphics? The following works like magic on your test file. I am just not sure whether it might negatively affect performance and I tested it with this single file only (pattern-shading-2-4-idMatrix.pdf). &lt;/p&gt;

&lt;p&gt;Alternatively, we might either be able to compute the right transformation from the deviceBounds/userBounds in AxialShadingPaint#createContext()  (I am not sure, I just think the information we need might be in there), or use a custom rendering hint key and pass the additional transform along with the rendering hints.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    private void drawGlyph2D(Glyph2D glyph2D, int[] codePoints, AffineTransform at) throws IOException
    {
        graphics.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
        for (int i = 0; i &amp;lt; codePoints.length; i++)
        {
            GeneralPath path = glyph2D.getPathForCharacterCode(codePoints[i]);
            if (path != null)
            {
                if (!at.isIdentity())
                {
                    path = (GeneralPath) path.clone();
                    path.transform(at);
                }
                graphics.fill(path);
            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="14041207" author="tilman" created="Mon, 23 Jun 2014 19:55:50 +0000"  >&lt;p&gt;Damn, I didn&apos;t think about that. Btw Andreas had the same idea, but posted it in the wrong issue. Anyway, I am running it right now on 193 test files.&lt;/p&gt;</comment>
                            <comment id="14041260" author="tilman" created="Mon, 23 Jun 2014 20:27:42 +0000"  >&lt;p&gt;I had lots of differences, but only slight color / pixels differences. I tried again at a higher resolution, and IMHO the new files look slightly better. However I will have to run all my tests again twice because I have made an svn update before starting the tests, so it kindof mixes up the issues. But the change is most likely good &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14041721" author="tilman" created="Tue, 24 Jun 2014 05:43:00 +0000"  >&lt;p&gt;The change is good, I will commit it tonight, &lt;del&gt;and then start tests with the 1.8 version, commit that one, and also ask on &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2159&quot; title=&quot;horizontal line above shaded text when printing on HP1320&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2159&quot;&gt;&lt;del&gt;PDFBOX-2159&lt;/del&gt;&lt;/a&gt; if the printing gets better or worse.&lt;/del&gt;  Update: Nothing to do in 1.8, because that version has only one method to draw glyphs, and that was already taken care of earlier.&lt;/p&gt;</comment>
                            <comment id="14042379" author="tilman" created="Tue, 24 Jun 2014 17:06:54 +0000"  >&lt;p&gt;I committed a modified change in rev 1605137 for the trunk. I dropped the isIdentity call because it won&apos;t be an identity transform most of the time, and used a different call for the shape transform that is shorter (and is already used elsewhere). Thanks again for your help!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12696796">PDFBOX-1936</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12650283" name="000004_ShadingPatternTextPDF.pdf" size="1272" author="pslabycz" created="Fri, 13 Jun 2014 11:59:09 +0000"/>
                            <attachment id="12650306" name="PDFBOX-1917.pdf-1.png" size="84756" author="tilman" created="Fri, 13 Jun 2014 13:37:31 +0000"/>
                            <attachment id="12650307" name="PDFBOX-1917.pdf-1.png-diff.png" size="4524" author="tilman" created="Fri, 13 Jun 2014 13:37:31 +0000"/>
                            <attachment id="12650302" name="PDFBOX-1917.pdf-9.png" size="42607" author="tilman" created="Fri, 13 Jun 2014 13:35:39 +0000"/>
                            <attachment id="12650303" name="PDFBOX-1917.pdf-9.png-diff.png" size="4766" author="tilman" created="Fri, 13 Jun 2014 13:35:39 +0000"/>
                            <attachment id="12650304" name="PDFBOX-2135.pdf-2.png" size="190296" author="tilman" created="Fri, 13 Jun 2014 13:35:39 +0000"/>
                            <attachment id="12650305" name="PDFBOX-2135.pdf-2.png-diff.png" size="5050" author="tilman" created="Fri, 13 Jun 2014 13:35:39 +0000"/>
                            <attachment id="12650282" name="PageDrawer.writeFont.java.patch" size="1355" author="pslabycz" created="Fri, 13 Jun 2014 11:59:09 +0000"/>
                            <attachment id="12652009" name="pattern-shading-2-4-idMatrix.pdf" size="6036" author="tilman" created="Mon, 23 Jun 2014 17:45:39 +0000"/>
                            <attachment id="12651849" name="pattern-shading-2-4-idMatrix.pdf" size="5880" author="tilman" created="Sun, 22 Jun 2014 07:23:08 +0000"/>
                            <attachment id="12651850" name="pattern-shading-2-4-idMatrix1.jpg" size="756373" author="tilman" created="Sun, 22 Jun 2014 07:23:08 +0000"/>
                            <attachment id="12652010" name="pattern-shading-2-4-noMatrix.pdf" size="6036" author="tilman" created="Mon, 23 Jun 2014 17:45:39 +0000"/>
                            <attachment id="12652008" name="pattern-shading-2-4.ps" size="2381" author="tilman" created="Mon, 23 Jun 2014 17:45:39 +0000"/>
                            <attachment id="12651851" name="pattern-shading-2-4.ps" size="2005" author="tilman" created="Sun, 22 Jun 2014 07:23:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>399289</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 21 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1wqkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>399399</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>