<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:02:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2816] PDFBox makes disallowed changes when signing a signed document</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2816</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;It seems PDFBox make disallowed changes when signing a document containing a signature with visual appearance. Using the signing example &lt;tt&gt;org.apache.pdfbox.examples.signature.CreateSignature&lt;/tt&gt; (modified to use BC 1.52) I signed (invisible signature) a document (&lt;em&gt;acrosigned.pdf&lt;/em&gt;) containing signature with visual appearance. After signing Adobe Acrobat for the resulted pdf (&lt;em&gt;acrosigned_signed.pdf&lt;/em&gt;) shows an error for the first signature: &lt;blockquote&gt;
&lt;p&gt;1 Page(s) Modified &lt;br/&gt;
Signature is invalid:&lt;br/&gt;
Document has been altered or corrupted since it was signed.&lt;/p&gt;&lt;/blockquote&gt;&lt;br/&gt;
The first revision is intact after signing, but it seems PDFBox made some disallowed changes to the document. Adobe in its technical white paper &lt;a href=&quot;http://wwwimages.adobe.com/www.adobe.com/content/dam/Adobe/en/devnet/reader/pdfs/readercomp_digitalsignatures.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Adobe Acrobat 9 Digital Signatures, Changes and Improvements&lt;/a&gt; disallows such changes for the signed document:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Adding form fields other than signature fields&lt;/li&gt;
	&lt;li&gt;Changing page content&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Unfortunately, I could not identify the changes which caused this error, though I notice these changes in structure after signing:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Default resources (/DR) were droped from AcroForm dictionary;&lt;/li&gt;
	&lt;li&gt;An array of annotation dictionaries (value of /Annots in page object)  became direct;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;And probably there are more...&lt;br/&gt;
I thought the first change was fundamental, noticed that &lt;tt&gt;PDDocument#addSignature()&lt;/tt&gt; method removes /DR key for invisible signatures. Tried to disable it in 1.8.10-SNAPSHOT sources, but unfortunately it didn&apos;t help. Didn&apos;t tried to reuse the same array object for /Annots yet. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12833696">PDFBOX-2816</key>
            <summary>PDFBox makes disallowed changes when signing a signed document</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="msahyoun">Maruan Sahyoun</assignee>
                                    <reporter username="abyss">Petras</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 May 2015 07:11:01 +0000</created>
                <updated>Mon, 18 Jan 2016 12:01:48 +0000</updated>
                            <resolved>Thu, 17 Dec 2015 16:34:42 +0000</resolved>
                                    <version>1.8.9</version>
                    <version>2.0.0</version>
                                    <fixVersion>1.8.11</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                    <component>Signing</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14564867" author="abyss" created="Fri, 29 May 2015 14:12:57 +0000"  >&lt;p&gt;It appears that those two aforementioned changes caused Acrobat to invalidate the previous signature. I made a patch with suggested changes to COSWriter and PDDocument classes.&lt;br/&gt;
The patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;preserves indirect references to PDF array items;&lt;/li&gt;
	&lt;li&gt;for non-visual signatures does not remove default resources (/DR entry) from AcroForm, which might be already present;&lt;/li&gt;
	&lt;li&gt;does not create optional appearance dictionary in Signature field&apos;s annotation dictionary for non-visual signatures.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Additionally in this patch I also suggest a change in the way COSWriter includes the objects to be written during incremental update. So far it was that, even if indirect object of dictionary entry value or array item was flagged with &lt;tt&gt;#setNeedToBeUpdate(true)&lt;/tt&gt;, it was not included into the set of the objects to be written, if the container was not flagged with &lt;tt&gt;#setNeedToBeUpdate(true)&lt;/tt&gt;. The patch checks the items of not-flagged arrays/dictionaries, if they are indirect and have #needToBeUpdate flag set, they are included into the set of objects to be written. For this current issue it allowed to skip the rewriting of the page object when only the annotations array (indirect object value of /Annots entry) was updated.&lt;/p&gt;</comment>
                            <comment id="14564870" author="abyss" created="Fri, 29 May 2015 14:14:25 +0000"  >&lt;p&gt;Added suggested bug fixing patch and signing result with the patch applied.&lt;/p&gt;</comment>
                            <comment id="14985181" author="mkl" created="Mon, 2 Nov 2015 13:01:45 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Default resources (/DR) were droped from AcroForm dictionary;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This also turned out an issue in case of forms which were supposed to be filled in some more after the first signature, cf. the stackoverflow posting &lt;a href=&quot;http://stackoverflow.com/a/33174411/1729265&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PDFBox 1.8.10: Fill and Sign Document, Filling again fails&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14985352" author="jira-bot" created="Mon, 2 Nov 2015 15:04:07 +0000"  >&lt;p&gt;Commit 1712037 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1712037&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1712037&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2816&quot; title=&quot;PDFBox makes disallowed changes when signing a signed document&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2816&quot;&gt;&lt;del&gt;PDFBOX-2816&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3017&quot; title=&quot;Improve document signing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3017&quot;&gt;&lt;del&gt;PDFBOX-3017&lt;/del&gt;&lt;/a&gt;: don&apos;t drop AcroForm /DR for invisible signature&lt;/p&gt;</comment>
                            <comment id="14985368" author="jira-bot" created="Mon, 2 Nov 2015 15:15:42 +0000"  >&lt;p&gt;Commit 1712040 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/branches/1.8&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1712040&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1712040&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2816&quot; title=&quot;PDFBox makes disallowed changes when signing a signed document&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2816&quot;&gt;&lt;del&gt;PDFBOX-2816&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3017&quot; title=&quot;Improve document signing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3017&quot;&gt;&lt;del&gt;PDFBOX-3017&lt;/del&gt;&lt;/a&gt;: don&apos;t drop AcroForm /DR for invisible signature&lt;/p&gt;</comment>
                            <comment id="15003850" author="marcom1981@gmail.com" created="Fri, 13 Nov 2015 10:59:32 +0000"  >&lt;p&gt;I have the same problem with visible signature, when the document have fields other than signature fields.&lt;/p&gt;</comment>
                            <comment id="15004060" author="msahyoun" created="Fri, 13 Nov 2015 14:50:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marcom1981%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;marcom1981@gmail.com&quot;&gt;marcom1981@gmail.com&lt;/a&gt; which version of PDFBox did you use? Could you outline how to reproduce the issue? Reason I&apos;m asking is that i&apos;ve signed &lt;tt&gt;doc_v2_fillsigned&lt;/tt&gt; which was mentioned in &lt;span class=&quot;error&quot;&gt;&amp;#91;PDFBox 1.8.10: Fill and Sign Document, Filling again fails.&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://stackoverflow.com/a/33174411/1729265&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/a/33174411/1729265&lt;/a&gt;) using PDFBox 2.0.0  and the signature was fine.&lt;/p&gt;</comment>
                            <comment id="15004225" author="marcom1981@gmail.com" created="Fri, 13 Nov 2015 16:31:55 +0000"  >&lt;p&gt;Versione id 2.0.0 RC1.&lt;/p&gt;

&lt;p&gt;This link are sample file.&lt;br/&gt;
&lt;a href=&quot;https://drive.google.com/file/d/0B-qB8oXqKgqScUstRmdxeXFGMzg/view?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://drive.google.com/file/d/0B-qB8oXqKgqScUstRmdxeXFGMzg/view?usp=sharing&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Original PDF.&lt;br/&gt;
First Signature.&lt;br/&gt;
Second Signature some page no problem with acrobat&lt;br/&gt;
Second Signature different page problem with acrobat&lt;/p&gt;

&lt;p&gt;The byte range are OK.&lt;/p&gt;

&lt;p&gt;The probe are only with module pdf.&lt;/p&gt;

&lt;p&gt;Good Job&lt;/p&gt;</comment>
                            <comment id="15062282" author="tilman" created="Thu, 17 Dec 2015 16:34:00 +0000"  >&lt;p&gt;I&apos;m setting this one to resolved, as the /DR problem has been solved. The next problem (with your sample files) is being handled in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3114&quot; title=&quot;Visible signatures in different pages changes previous revision&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3114&quot;&gt;&lt;del&gt;PDFBOX-3114&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12736148" name="Fix_to_PDFBOX-2816.patch" size="6769" author="abyss" created="Fri, 29 May 2015 14:14:25 +0000"/>
                            <attachment id="12736069" name="acrosigned.pdf" size="102236" author="abyss" created="Fri, 29 May 2015 07:11:50 +0000"/>
                            <attachment id="12736070" name="acrosigned_signed.pdf" size="122614" author="abyss" created="Fri, 29 May 2015 07:11:50 +0000"/>
                            <attachment id="12736147" name="acrosigned_signed_fix.pdf" size="122383" author="abyss" created="Fri, 29 May 2015 14:14:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 48 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fd5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>