<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:07:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4131] Stack overflow in fields</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4131</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Note: unfortunately I can not attach original file for confidentiality reasons&lt;/p&gt;

&lt;p&gt;I have a pdf containing some fields :&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;/AcroForm 2 0 R&lt;/p&gt;

&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;2 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/DR 5 0 R&lt;br/&gt;
/Fields [ ...&#160; 15 0 R 16 0 R 17 0 R ...]&lt;br/&gt;
&amp;gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;and then for field object 17 :&lt;/p&gt;

&lt;p&gt;17 0 obj&lt;br/&gt;
&amp;lt;&amp;lt;&lt;br/&gt;
/DA (/Helv 8 Tf 0 g)&lt;br/&gt;
/FT /Tx&lt;br/&gt;
/Ff 1&lt;br/&gt;
/Kids &lt;span class=&quot;error&quot;&gt;&amp;#91;17 0 R 88 0 R 89 0 R&amp;#93;&lt;/span&gt;&lt;br/&gt;
/MaxLen 0&lt;br/&gt;
/T (Nom)&lt;br/&gt;
&amp;gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;Here we see that this field is contained in its children list : this triggers a recursivity loop during parsing (or at least during method call getAcroForm() )&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160; at java.lang.StringBuilder.toString(StringBuilder.java:407)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.pdfbox.cos.PDFDocEncoding.toString(PDFDocEncoding.java:135)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.pdfbox.cos.COSString.getString(COSString.java:203)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.pdfbox.cos.COSDictionary.getString(COSDictionary.java:670)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.pdfbox.pdmodel.interactive.form.PDFieldFactory.createField(PDFieldFactory.java:64)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.pdfbox.pdmodel.interactive.form.PDField.fromDictionary(PDField.java:80)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.pdfbox.pdmodel.interactive.form.PDNonTerminalField.getChildren(PDNonTerminalField.java:139)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.pdfbox.pdmodel.interactive.form.PDFieldTree$FieldIterator.enqueueKids(PDFieldTree.java:99)&lt;br/&gt;
&#160;&#160; &#160;at org.apache.pdfbox.pdmodel.interactive.form.PDFieldTree$FieldIterator.enqueueKids(PDFieldTree.java:102)&lt;/p&gt;

&lt;p&gt;...&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I use pdfbox 2.0.8&lt;/p&gt;

&lt;p&gt;Similar problem with preflight parser.&lt;/p&gt;

&lt;p&gt;In this case a simple fix would be to ignore children fields that are the same as their parent ; however the references loop may be much more complicated.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13141193">PDFBOX-4131</key>
            <summary>Stack overflow in fields</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="momaison">Maison</reporter>
                        <labels>
                    </labels>
                <created>Tue, 27 Feb 2018 11:19:09 +0000</created>
                <updated>Sun, 2 Dec 2018 17:08:43 +0000</updated>
                            <resolved>Wed, 18 Apr 2018 07:41:16 +0000</resolved>
                                    <version>2.0.8</version>
                                    <fixVersion>2.0.9</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>AcroForm</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16382017" author="momaison" created="Thu, 1 Mar 2018 13:51:55 +0000"  >&lt;p&gt;OK, attached a simple file that triggers the bug : fields_loop_kid_is_parent.pdf&lt;/p&gt;

&lt;p&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160; File pdf = new File(&quot;fields_loop_kid_is_parent.pdf&quot;);&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; PDDocument doc = PDDocument.load(pdf);&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; PDAcroForm acroForm = doc.getDocumentCatalog().getAcroForm();&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; PDFieldTree tree = acroForm.getFieldTree();&lt;br/&gt;
&#160;&#160;&#160;&#160;&#160;&#160;&#160; for (PDField field : tree) &lt;/p&gt;
{
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; System.out.println(&quot;field = &quot;+field);
&#160;&#160;&#160;&#160;&#160;&#160;&#160; }

&lt;p&gt;A quick fix for this case is to add in PDNonTerminalField.getChildren()&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (kid instanceof COSDictionary)&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; {&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;+&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; if (kid.equals(getCOSObject())) {&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;+&#160; &#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; //System.out.println(&quot;RECURSION AVOIDED !&quot;);&lt;/tt&gt;&lt;br/&gt;
&lt;tt&gt;+&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; continue;&lt;/tt&gt;&lt;br/&gt;
{{+&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; }}}&lt;br/&gt;
&lt;tt&gt;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; PDField field = PDField.fromDictionary(getAcroForm(), (COSDictionary) kid, this);&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also attached a less simple case, where obj 5 has kid 9, and obj 9 has kid 5:&#160; fields_loop_kid_is_parent_of_other_group.pdf&lt;/p&gt;

&lt;p&gt;Both files were generated thanks to libreoffice, then manually edited.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="16382525" author="jira-bot" created="Thu, 1 Mar 2018 19:40:19 +0000"  >&lt;p&gt;Commit 1825680 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1825680&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1825680&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4131&quot; title=&quot;Stack overflow in fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4131&quot;&gt;&lt;del&gt;PDFBOX-4131&lt;/del&gt;&lt;/a&gt;: skip self children&lt;/p&gt;</comment>
                            <comment id="16382526" author="jira-bot" created="Thu, 1 Mar 2018 19:40:30 +0000"  >&lt;p&gt;Commit 1825681 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1825681&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1825681&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4131&quot; title=&quot;Stack overflow in fields&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4131&quot;&gt;&lt;del&gt;PDFBOX-4131&lt;/del&gt;&lt;/a&gt;: skip self children&lt;/p&gt;</comment>
                            <comment id="16382722" author="tilman" created="Thu, 1 Mar 2018 21:58:18 +0000"  >&lt;p&gt;Snapshot is here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.9-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.9-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please test...&lt;/p&gt;</comment>
                            <comment id="16383677" author="momaison" created="Fri, 2 Mar 2018 15:14:05 +0000"  >&lt;p&gt;Thank you for your quick patch. I&apos;ve just tested:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;works fine on fields_loop_kid_is_parent.pdf&lt;/li&gt;
	&lt;li&gt;still fails on more complex fields_loop_kid_is_parent_of_other_group.pdf&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Regarding the second problem, is there a general approach regarding this kind of references loop ?&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1813&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/PDFBOX-1813&lt;/a&gt; seems related&lt;/p&gt;</comment>
                            <comment id="16383698" author="msahyoun" created="Fri, 2 Mar 2018 15:32:06 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=momaison&quot; class=&quot;user-hover&quot; rel=&quot;momaison&quot;&gt;momaison&lt;/a&gt; Do both cases show up in PDFs you have? How have these been created? The reason I&apos;m asking is that there might be other objects in a PDF which are organized in a tree like structure where a child could reference an ancestor.&lt;/p&gt;</comment>
                            <comment id="16383922" author="momaison" created="Fri, 2 Mar 2018 18:17:37 +0000"  >&lt;p&gt;The simple case, that has been solved by Tilman&apos;s patch, is from production (I only forged a simpler copy for this issue).&lt;br/&gt;
I don&apos;t know how such bad pdf are generated, real world is so wild in pdf area...&lt;/p&gt;

&lt;p&gt;For the second case I can&apos;t say if such a case actually occurs in production ; I only supposed it could, and forged a sample.&lt;br/&gt;
Do you mean the complete solution would be complicated, for a case that never occurs ? That&apos;s possible.&lt;br/&gt;
So I&apos;ll try the simple patch in production, and see what happen.&lt;/p&gt;
</comment>
                            <comment id="16383931" author="tilman" created="Fri, 2 Mar 2018 18:21:14 +0000"  >&lt;p&gt;Yes it would be complicated... we could pass the level and stop at whatever is mentioned in the specification, or make a check when opening the field tree...&lt;/p&gt;</comment>
                            <comment id="16441938" author="momaison" created="Wed, 18 Apr 2018 06:01:15 +0000"  >&lt;p&gt;This bug is solved : thank you !&lt;/p&gt;</comment>
                            <comment id="16442062" author="msahyoun" created="Wed, 18 Apr 2018 07:41:16 +0000"  >&lt;p&gt;Resolved per reports feedback. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=momaison&quot; class=&quot;user-hover&quot; rel=&quot;momaison&quot;&gt;momaison&lt;/a&gt; thanks for your feedback.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12912606" name="fields_loop_kid_is_parent.pdf" size="10522" author="momaison" created="Thu, 1 Mar 2018 13:39:39 +0000"/>
                            <attachment id="12912608" name="fields_loop_kid_is_parent_of_other_group.pdf" size="9988" author="momaison" created="Thu, 1 Mar 2018 13:48:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 30 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3qn3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>