<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:52:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-780] EXCEPTION_ACCESS_VIOLATION in fontmanager.so/fontmanager.dll</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-780</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;It seems when writing a PDF that has an invalid embedded font to an image there is a crash in the native function sun.font.FileFont.getGlyphImage(JI).   It can be reproduced using the PDFToImage program on a pdf with an invalid embedded font.&lt;/p&gt;


&lt;p&gt;Turing on  -Dsun.java2d.debugfonts=true on a bad pdf will show some like the follow for the bad font&lt;/p&gt;

&lt;p&gt;INFO: open TTF: C:\DOCUME~1\mdavis\LOCALS~1\Temp&amp;#43;~JF4968602841241472406.tmp&lt;br/&gt;
Jul 20, 2010 11:37:31 AM sun.font.TrueTypeGlyphMapper handleBadCMAP&lt;br/&gt;
SEVERE: Null Cmap for ** TrueType Font: Family=INKLBC+SymbolMT Name=INKLBC+SymbolMT style=0 fileName=C:\DOCUME~1\mdavis\LOCALS~1\Temp&amp;#43;~JF4968602841241472406.tmpsubstituting for this font&lt;br/&gt;
Jul 20, 2010 11:37:31 AM sun.font.FontManager deRegisterBadFont&lt;br/&gt;
SEVERE: Deregister bad font: ** TrueType Font: Family=INKLBC+SymbolMT Name=INKLBC+SymbolMT style=0 fileName=C:\DOCUME~1\mdavis\LOCALS~1\Temp&amp;#43;~JF4968602841241472406.tmp&lt;br/&gt;
Jul 20, 2010 11:37:31 AM sun.font.FileFontStrike &amp;lt;init&amp;gt;&lt;br/&gt;
INFO: Strike for ** TrueType Font: Family=INKLBC+SymbolMT Name=INKLBC+SymbolMT style=0 fileName=C:\DOCUME~1\mdavis\LOCALS~1\Temp&amp;#43;~JF4968602841241472406.tmp at size = 19 use natives = false useJavaRasteriser = true AAHint = 2 Has Embedded bitmaps = false&lt;/p&gt;



&lt;p&gt;The following code in PDSimpleFont.java seems to fix the crash although I am not sure if it is correct:&lt;/p&gt;


&lt;p&gt;public void drawString(String string, Graphics g, float fontSize, AffineTransform at, float x, float y) throws IOException {&lt;br/&gt;
		Font _awtFont = getawtFont();&lt;/p&gt;


&lt;p&gt;		//mdavis - fix fontmanager.so/dll on sun.font.FileFont.getGlyphImage for font with bad cmaps?&lt;br/&gt;
		if (_awtFont.canDisplayUpTo(string) != -1) &lt;/p&gt;
{
			log.warn(&quot;Changing fonts on &amp;lt;&quot; + string + &quot;&amp;gt; from &amp;lt;&quot; + _awtFont.getName() + &quot;&amp;gt; to default font&quot;);
			_awtFont = null;
		}


&lt;p&gt;		Graphics2D g2d = (Graphics2D) g;&lt;/p&gt;
</description>
                <environment>redhat linux rhel5 and windows xp</environment>
        <key id="12469722">PDFBOX-780</key>
            <summary>EXCEPTION_ACCESS_VIOLATION in fontmanager.so/fontmanager.dll</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jukkaz">Jukka Zitting</assignee>
                                    <reporter username="davis.matt.t">Matt Davis</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Jul 2010 15:40:53 +0000</created>
                <updated>Tue, 26 Oct 2010 09:33:46 +0000</updated>
                            <resolved>Tue, 24 Aug 2010 11:59:47 +0000</resolved>
                                                    <fixVersion>1.3.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12891211" author="davis.matt.t" created="Thu, 22 Jul 2010 15:16:11 +0000"  >&lt;p&gt;Page 3 of this file crashes PDFToImage&lt;/p&gt;</comment>
                            <comment id="12896540" author="jukkaz" created="Mon, 9 Aug 2010 13:25:21 +0000"  >&lt;p&gt;Thanks! Fixed as suggested in revision 983634.&lt;/p&gt;</comment>
                            <comment id="12900953" author="cstires" created="Sat, 21 Aug 2010 01:14:54 +0000"  >&lt;p&gt;Confirm that this fixes a SIGSEGV on Windows and Ubuntu for the same problem in PDSimpleFont:drawString()&lt;/p&gt;

&lt;p&gt;However, the fix starts causing NPE dumps to be thrown three lines later, in the writeFont method&lt;/p&gt;

&lt;p&gt;the call arrives as:&lt;br/&gt;
PDSimpleFont.java (109)&lt;br/&gt;
writeFont(g2d, at, _awtFont==null, fontSize, x, y, string);&lt;/p&gt;

&lt;p&gt;and throws the NPE in the writeFont code (2 places)&lt;br/&gt;
PDSimpleFont.java (379,397)&lt;br/&gt;
g2d.setFont(awtFont.deriveFont(fontSize));&lt;br/&gt;
g2d.setFont(awtFont.deriveFont( at ).deriveFont(fontSize));&lt;/p&gt;

&lt;p&gt;Should we do the check for ( _awtFont != null ) before calling writeFont, or should we catch this at the start of the writeFont method and return?&lt;/p&gt;</comment>
                            <comment id="12901796" author="jukkaz" created="Tue, 24 Aug 2010 09:37:10 +0000"  >&lt;p&gt;Reopened to address the problem reported by Craig&lt;/p&gt;</comment>
                            <comment id="12901831" author="jukkaz" created="Tue, 24 Aug 2010 11:59:47 +0000"  >&lt;p&gt;Thanks Craig! I fixed this in revision 988495 by setting _awtFont to Font.decode(null) instead of just null.&lt;/p&gt;

&lt;p&gt;The Font.decode(null) call is defined to return a default Font with &quot;the family name &apos;Dialog&apos;, a size of 12 and a PLAIN style&quot;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12469215">PDFBOX-774</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12450178" name="test.pdf" size="323883" author="davis.matt.t" created="Thu, 22 Jul 2010 15:16:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>163487</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zh0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>205059</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>