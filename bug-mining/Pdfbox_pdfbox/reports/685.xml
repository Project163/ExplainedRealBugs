<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:57:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2310] codeToGID NPE</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2310</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;java -jar ~/pdf-box-svn/app/target/pdfbox-app-2.0.0-SNAPSHOT.jar PDFToImage expected.pdf&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.lang.NullPointerException&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.font.PDType0Font.codeToGID(PDType0Font.java:306)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12738791">PDFBOX-2310</key>
            <summary>codeToGID NPE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jahewson">John Hewson</assignee>
                                    <reporter username="ssteiner">Simon Steiner</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Sep 2014 12:45:30 +0000</created>
                <updated>Thu, 17 Mar 2016 19:07:19 +0000</updated>
                            <resolved>Wed, 3 Sep 2014 17:05:37 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14120090" author="jahewson" created="Wed, 3 Sep 2014 17:03:02 +0000"  >&lt;p&gt;This problem is caused by PDFBox clearing a cache inside a PDFont object:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fonts != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
{
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(PDFont font : fonts.values())
    {
        font.clear();
    }
    fonts.clear();
    fonts = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The whole PDFont#clear() concept doesn&apos;t actually achieve anything, the subsequent Map#clear() call will free the font objects for garbage collection anyway. Likewise calling fonts.clear() before setting fonts = null does nothing. It&apos;s like somebody was trying to write a C++ destructor, but of course that&apos;s not needed in Java. The code above can be reduced to:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;fonts = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which will achieve the exact same thing as the garbage collector will take care of everything else. Likewise for similar code for PDXObject.&lt;/p&gt;

&lt;p&gt;I&apos;m going to remove all of these redundant clear() methods.&lt;/p&gt;</comment>
                            <comment id="14120092" author="jira-bot" created="Wed, 3 Sep 2014 17:05:25 +0000"  >&lt;p&gt;Commit 1622299 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1622299&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1622299&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2310&quot; title=&quot;codeToGID NPE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2310&quot;&gt;&lt;del&gt;PDFBOX-2310&lt;/del&gt;&lt;/a&gt;: Removed redundant clear() methods&lt;/p&gt;</comment>
                            <comment id="14120286" author="tilman" created="Wed, 3 Sep 2014 19:15:40 +0000"  >&lt;p&gt;You removed the clearCache() method of PDImageXObject. IMHO this went too far, and will have a negative impact on the memory footprint, because the cache of an existing (and linked) object won&apos;t be deleted by the garbage collector.&lt;/p&gt;</comment>
                            <comment id="14120409" author="jahewson" created="Wed, 3 Sep 2014 20:41:55 +0000"  >&lt;p&gt;There aren&apos;t any references to PDImageXObject held anywhere else in PDFBox. Maybe there used to be in the past.&lt;/p&gt;</comment>
                            <comment id="14120439" author="tilman" created="Wed, 3 Sep 2014 20:58:09 +0000"  >&lt;p&gt;I get 107 matches in 24 files. Specifically, the clear() method was very useful in the ExtractImages example where you removed it, and where it was added as a result of the discussion in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2101&quot; title=&quot;Surprising memory consumption when extracting images&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2101&quot;&gt;&lt;del&gt;PDFBOX-2101&lt;/del&gt;&lt;/a&gt;. People were having out of memory troubles. The PDImageXObject objects are held in the resource map; the BufferedImage is cached and the clear() method allowed to delete that cache without deleting the object itself.&lt;/p&gt;</comment>
                            <comment id="14120538" author="jahewson" created="Wed, 3 Sep 2014 21:53:30 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;I get 107 matches in 24 files. 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Only class member variables and any code which loops over page resources is relevant, I only looked for private fields.&lt;/p&gt;

&lt;p&gt;However, as you&apos;ve spotted even short-term retention of the PDImageXObject cache is a problem, and the file from  &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2101&quot; title=&quot;Surprising memory consumption when extracting images&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2101&quot;&gt;&lt;del&gt;PDFBOX-2101&lt;/del&gt;&lt;/a&gt; is now having issues with memory usage. This is due to a number of large images on a single page and because PDResources is retaining the PDImageXObject instances during the loop over the page&apos;s resources we end up accumulating cached images.&lt;/p&gt;

&lt;p&gt;However, something&apos;s not right here, PDFToImage can render the document without any memory issues, and it&apos;s not calling PDImageXObject#clear() and it loops over the PDResources in exactly the same manner. There&apos;s something specific about ExtractImages which is causing it to use more memory.&lt;/p&gt;

&lt;p&gt;As the author of the PDFormXObject#getImage() method I&apos;m beginning to wonder if it should simply not cache images, as they&apos;re just so large. Downstream callers such as PageDrawer could have their own much smarter caching policies such as LRU or some system which takes into account memory pressure such as a SoftReference.&lt;/p&gt;

&lt;p&gt;Either way, we should try and figure out what&apos;s causing ExtractImages to consume more memory than PDFToImage.&lt;/p&gt;</comment>
                            <comment id="14120556" author="tilman" created="Wed, 3 Sep 2014 22:02:47 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Either way, we should try and figure out what&apos;s causing ExtractImages to consume more memory than PDFToImage.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;because the PDF has more resources per page than it actually uses. According to PDFDebugger it has tons of global resources, but also tons of per-page resources.&lt;/p&gt;

&lt;p&gt;So PDFToImage will only create the BufferedImages it needs for a specific page. ExtractImages will create a BufferedImage for each image resource that exists.&lt;/p&gt;</comment>
                            <comment id="14120577" author="jahewson" created="Wed, 3 Sep 2014 22:17:37 +0000"  >&lt;p&gt;Yep, that explains it, 55 images which are never rendered on the first page alone. I&apos;ve opened a new issue against ExtractImages, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2313&quot; title=&quot;ExtractImages finds never-rendered images&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2313&quot;&gt;&lt;del&gt;PDFBOX-2313&lt;/del&gt;&lt;/a&gt; where we can discuss it.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12738950">PDFBOX-2313</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12717072">PDFBOX-2101</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12666215" name="expected.pdf" size="37814" author="ssteiner" created="Wed, 3 Sep 2014 12:45:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 11 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zmkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>