<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:09:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4475] PDFMergerUtility is very slow, almost in dead loop</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4475</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;When use PDFMergerUtility to merge PDF file, it is very slow to merge the struct tree. It seems that it in a dead loop.&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12960313/12960313_image-2019-02-27-15-43-42-304.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;Test code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; com.test;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.multipdf.PDFMergerUtility;


&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestMergeUtil {

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main( &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args ) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    PDFMergerUtility merger = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFMergerUtility();
    merger.addSource( &lt;span class=&quot;code-quote&quot;&gt;&quot;D:\\probe\\TourInventory_TourInventory_report.PDF&quot;&lt;/span&gt; );
    merger.addSource( &lt;span class=&quot;code-quote&quot;&gt;&quot;D:\\probe\\TourInventory_TourInventory_report.PDF&quot;&lt;/span&gt; );
    merger.setDestinationFileName( &lt;span class=&quot;code-quote&quot;&gt;&quot;D:\\probe\\TourInventory_TourInventory_report_merged.pdf&quot;&lt;/span&gt; );
    merger.mergeDocuments();
  }
}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;But after I comment bellow code, it can merge fast, but the merged PDF file size is very large.&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12960315/12960315_screenshot-1.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;</description>
                <environment></environment>
        <key id="13218280">PDFBOX-4475</key>
            <summary>PDFMergerUtility is very slow, almost in dead loop</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="liu1985629">Derek Liu</reporter>
                        <labels>
                            <label>merge</label>
                            <label>optimization</label>
                    </labels>
                <created>Wed, 27 Feb 2019 07:48:44 +0000</created>
                <updated>Fri, 12 Apr 2019 14:39:47 +0000</updated>
                            <resolved>Wed, 27 Feb 2019 16:41:20 +0000</resolved>
                                    <version>2.0.13</version>
                    <version>2.0.14</version>
                                    <fixVersion>2.0.15</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16779480" author="jira-bot" created="Wed, 27 Feb 2019 16:25:06 +0000"  >&lt;p&gt;Commit 1854469 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1854469&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1854469&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4475&quot; title=&quot;PDFMergerUtility is very slow, almost in dead loop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4475&quot;&gt;&lt;del&gt;PDFBOX-4475&lt;/del&gt;&lt;/a&gt;: optimize by using separate Set instead of calling Map.containsValue()&lt;/p&gt;</comment>
                            <comment id="16779482" author="jira-bot" created="Wed, 27 Feb 2019 16:25:11 +0000"  >&lt;p&gt;Commit 1854470 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1854470&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1854470&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4475&quot; title=&quot;PDFMergerUtility is very slow, almost in dead loop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4475&quot;&gt;&lt;del&gt;PDFBOX-4475&lt;/del&gt;&lt;/a&gt;: optimize by using separate Set instead of calling Map.containsValue()&lt;/p&gt;</comment>
                            <comment id="16779497" author="tilman" created="Wed, 27 Feb 2019 16:40:11 +0000"  >&lt;p&gt;Thanks, your screenshot points to a problem: &lt;tt&gt;clonedVersion.containsValue(base)&lt;/tt&gt; is slow, the javadoc tells that &lt;em&gt;This operation will probably require time linear in the map size for most implementations of the Map interface&lt;/em&gt;. I have fixed that. This is too late for the 2.0.14, but you can copy the source code of the merge and the clone class and keep these separate until 2.0.15.&lt;/p&gt;

&lt;p&gt;The target file is still very large, this is because we don&apos;t support compressed object streams. If this is important for you, then postprocess your file with a utility like qpdf.&lt;/p&gt;

&lt;p&gt;Do you need the structure tree? If not, then you can remove it. This is for tagged PDFs. The cloning of the structure tree was introduced because people were unhappy that after merging, one couldn&apos;t close the source file (because the destination file was referencing source streams).&lt;/p&gt;

&lt;p&gt;You can&apos;t remove the &quot;Don&apos;t clone a clone&quot; segment. 7 build tests will fail: the final PDF ends up with pages that are not in the page tree, these are pages that were cloned twice or even more. This results in larger files and potential mayhem.&lt;/p&gt;</comment>
                            <comment id="16779504" author="jira-bot" created="Wed, 27 Feb 2019 16:51:27 +0000"  >&lt;p&gt;Commit 1854471 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1854471&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1854471&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4475&quot; title=&quot;PDFMergerUtility is very slow, almost in dead loop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4475&quot;&gt;&lt;del&gt;PDFBOX-4475&lt;/del&gt;&lt;/a&gt;: remove code line that is called again immediately after (but keep the lines where the later call is not immediate)&lt;/p&gt;</comment>
                            <comment id="16779505" author="jira-bot" created="Wed, 27 Feb 2019 16:51:32 +0000"  >&lt;p&gt;Commit 1854472 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1854472&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1854472&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4475&quot; title=&quot;PDFMergerUtility is very slow, almost in dead loop&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4475&quot;&gt;&lt;del&gt;PDFBOX-4475&lt;/del&gt;&lt;/a&gt;: remove code line that is called again immediately after (but keep the lines where the later call is not immediate)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12960312" name="TourInventory_TourInventory_report.pdf" size="1839370" author="liu1985629" created="Wed, 27 Feb 2019 07:44:55 +0000"/>
                            <attachment id="12960313" name="image-2019-02-27-15-43-42-304.png" size="196725" author="liu1985629" created="Wed, 27 Feb 2019 07:43:43 +0000"/>
                            <attachment id="12960315" name="screenshot-1.png" size="84708" author="liu1985629" created="Wed, 27 Feb 2019 08:10:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 37 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z004mg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>