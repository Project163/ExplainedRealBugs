<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:11:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5086] DataFormatException after saving</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5086</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Attached file gets corrupted when saved in 3.0.0, but not in 2.0.*.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13353832">PDFBOX-5086</key>
            <summary>DataFormatException after saving</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Jan 2021 19:42:53 +0000</created>
                <updated>Fri, 18 Aug 2023 05:46:11 +0000</updated>
                            <resolved>Tue, 16 Feb 2021 06:57:38 +0000</resolved>
                                    <version>3.0.0 PDFBox</version>
                                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="17269945" author="lehmi" created="Fri, 22 Jan 2021 07:02:29 +0000"  >&lt;p&gt;I can&apos;t reproduce the issue. Did you do something else but load and save the pdf?&lt;/p&gt;</comment>
                            <comment id="17270276" author="tilman" created="Fri, 22 Jan 2021 17:09:03 +0000"  >&lt;p&gt;I used the SetField.java example without setting the field and now I realize what the problem is: writing in the same file that is still open.&lt;/p&gt;</comment>
                            <comment id="17270649" author="bn75" created="Sat, 23 Jan 2021 12:52:07 +0000"  >&lt;p&gt;I have tried the example&lt;br/&gt;
 Setfield.java and effectively the structure of the COSDictionary is broken. This is the example:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://drive.google.com/file/d/1cqVxnjmbV4GydnVRq6KKl45gA8BdX-df/view?usp=sharing&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;tatata&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For some reason the structure of the COSDictionary is modified.&lt;/p&gt;</comment>
                            <comment id="17270650" author="tilman" created="Sat, 23 Jan 2021 13:00:42 +0000"  >&lt;p&gt;In 3.0 the parser is on demand, so it likely reads from the file while writing, so this turns into chaos.&lt;/p&gt;</comment>
                            <comment id="17270866" author="jira-bot" created="Sun, 24 Jan 2021 12:57:00 +0000"  >&lt;p&gt;Commit 1885877 from lehmi@apache.org in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1885877&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1885877&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5086&quot; title=&quot;DataFormatException after saving&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5086&quot;&gt;&lt;del&gt;PDFBOX-5086&lt;/del&gt;&lt;/a&gt;: don&apos;t write to a loaded pdf document which is still open&lt;/p&gt;</comment>
                            <comment id="17270867" author="jira-bot" created="Sun, 24 Jan 2021 12:57:11 +0000"  >&lt;p&gt;Commit 1885878 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1885878&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1885878&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5086&quot; title=&quot;DataFormatException after saving&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5086&quot;&gt;&lt;del&gt;PDFBOX-5086&lt;/del&gt;&lt;/a&gt;: don&apos;t write to a loaded pdf document which is still open&lt;/p&gt;</comment>
                            <comment id="17270869" author="lehmi" created="Sun, 24 Jan 2021 13:06:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; was right, it is a bad idea to write to a file which is still open as the ondemand parser needs access to the unmodified file. In 2.0 it isn&apos;t an issue at all as the whole pdf is loaded at the begining.&lt;/p&gt;

&lt;p&gt;I&apos;ve fixed the Setfield example at it works now. Any idea on how to lock the file while open so that it isn&apos;t possible to write to it?&lt;/p&gt;</comment>
                            <comment id="17270878" author="tilman" created="Sun, 24 Jan 2021 14:12:40 +0000"  >&lt;p&gt;How about storing the File object in the PDDocument (when opened with a File parameter) and compare when saving? &lt;/p&gt;</comment>
                            <comment id="17270913" author="mkl" created="Sun, 24 Jan 2021 15:59:46 +0000"  >&lt;p&gt;You should make a big warning in the 3.0.0 documentation, &quot;don&apos;t write to the file you read&quot;.&lt;br/&gt;
And have you considered locking the file while it is still read?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17271095" author="msahyoun" created="Mon, 25 Jan 2021 07:10:07 +0000"  >&lt;p&gt;There are other areas where we allow to overwrite the source such as within the PDFBox app. Having parsed a PDF partially would it be possible with that information to do an incremental save? This way, instead of overwriting the source we would append to it. That would (only) leave us with the issue of doing a full save i.e. removing increments. For that using a temporary sink would do.&lt;/p&gt;

&lt;p&gt;If input and output are the same we&apos;d also need to maintain an input data view. &lt;br/&gt;
&#160;&lt;/p&gt;</comment>
                            <comment id="17271249" author="bn75" created="Mon, 25 Jan 2021 10:59:17 +0000"  >&lt;p&gt;The most practical thing in my humble opinion is to store the name of the input pdf and evaluate it with the name of the output pdf. In case both are similar throw the IOException.&lt;/p&gt;</comment>
                            <comment id="17271252" author="msahyoun" created="Mon, 25 Jan 2021 11:01:32 +0000"  >&lt;p&gt;This will only work for file based input other types such as InputStream are also supported&lt;/p&gt;</comment>
                            <comment id="17271265" author="bn75" created="Mon, 25 Jan 2021 11:53:15 +0000"  >&lt;p&gt;There is no point in storing an InputStream. The most logical thing would be OutputStream. The input is already working in the Loader ...&lt;/p&gt;</comment>
                            <comment id="17271413" author="lehmi" created="Mon, 25 Jan 2021 16:15:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;How about storing the File object in the PDDocument (when opened with a File parameter) and compare when saving? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I&apos;ve removed all the file stuff for loading a pdf and I don&apos;t want to bring it back, just to implement some locking&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There are other areas where we allow to overwrite the source such as within the PDFBox app. Having parsed a PDF partially would it be possible with that information to do an incremental save?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is all about saving a pdf using PDDocument#save and it doesn&apos;t make that much sense to overwrite the source by default&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This will only work for file based input other types such as InputStream are also supported&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Correct. We can&apos;t implement it idiot-proof. I&apos;m going to add a comment as proposed by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkl&quot; class=&quot;user-hover&quot; rel=&quot;mkl&quot;&gt;mkl&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m experimenting with a locking mechanism based on FileChannel#lock to avoid overwriting the source withing the same JVM.&lt;/p&gt;</comment>
                            <comment id="17280483" author="lehmi" created="Sun, 7 Feb 2021 12:24:39 +0000"  >&lt;p&gt;The lock mechanism doesn&apos;t work as expected, it would introduce some side effect: the input file is locked for reading as well, so that ist isn&apos;t possible to open a file twice (some of the tests are doing so and maybe there are some real life scenarios as well.&lt;/p&gt;

&lt;p&gt;IMHO we have the following options:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;lock the input file -&amp;gt; concurrent reading isn&apos;t possible anymore&lt;/li&gt;
	&lt;li&gt;don&apos;t overwrite an existing file at all -&amp;gt; one has to choose a new file name for each save operation&lt;/li&gt;
	&lt;li&gt;don&apos;t do anything and leave it to the user to ensure the input file isn&apos;t used as target&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The first solutions won&apos;t work at all if an outputstream is used as target. In such cases the damage is done once the outputstream is created.&lt;/p&gt;

&lt;p&gt;I tend to leave it to the user to take care of the issue.&lt;/p&gt;</comment>
                            <comment id="17282572" author="tilman" created="Wed, 10 Feb 2021 17:02:04 +0000"  >&lt;p&gt;First one no.&lt;/p&gt;

&lt;p&gt;Second one would make sense, but it is different than what java does - FileOutputStream  doesn&apos;t care if the file exists.&lt;/p&gt;

&lt;p&gt;Third one, maybe with a warning? &quot;You are overwriting an existing file, this will produce a corrupted file if you&apos;re also reading from it&quot;.&lt;/p&gt;</comment>
                            <comment id="17284583" author="jira-bot" created="Mon, 15 Feb 2021 07:26:05 +0000"  >&lt;p&gt;Commit 1886520 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1886520&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1886520&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5086&quot; title=&quot;DataFormatException after saving&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5086&quot;&gt;&lt;del&gt;PDFBOX-5086&lt;/del&gt;&lt;/a&gt;: add warning if the the target file already exists as proposed by Tilman, add warning to the javadoc&lt;/p&gt;</comment>
                            <comment id="17285061" author="jira-bot" created="Tue, 16 Feb 2021 06:56:46 +0000"  >&lt;p&gt;Commit 47f72c3d02f8ff3cdaba23d697cc2deec81508a2 in pdfbox-docs&apos;s branch refs/heads/master from Andreas Lehmk&#252;hler&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=pdfbox-docs.git;h=47f72c3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=pdfbox-docs.git;h=47f72c3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5086&quot; title=&quot;DataFormatException after saving&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5086&quot;&gt;&lt;del&gt;PDFBOX-5086&lt;/del&gt;&lt;/a&gt;: add comment about not to use input file as output when saving a pdf&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13019168" name="SalesUseTaxLA_R-5402_20060705.pdf" size="196683" author="tilman" created="Thu, 21 Jan 2021 19:39:44 +0000"/>
                            <attachment id="13019167" name="SalesUseTaxLA_R-5402_20060705_BAD.pdf" size="109248" author="tilman" created="Thu, 21 Jan 2021 19:40:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[https://stackoverflow.com/questions/65822533]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0muvc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>