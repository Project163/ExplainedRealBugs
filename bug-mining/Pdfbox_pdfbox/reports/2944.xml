<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:14:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5832] Error when writing a document with OutlineItems containing null SE objects</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5832</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;I&apos;m reaching out to you because we encountered some errors when loading documents after updating PDFBox to v3.0.2.&lt;/p&gt;

&lt;p&gt;I cloned the project in local env and tried with v3.0.3-SNAPSHOT but the same error appeared.&lt;/p&gt;

&lt;p&gt;When trying to save my document using the PDDocument save() method, the following exception occurs:&#160;&lt;br/&gt;
&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.io.IOException: Error: Unknown type in object stream:COSObject{2240, 0}
	at org.apache.pdfbox.pdfwriter.compress.COSWriterObjectStream.writeObject(COSWriterObjectStream.java:238)	at org.apache.pdfbox.pdfwriter.compress.COSWriterObjectStream.writeCOSDictionary(COSWriterObjectStream.java:341)	at org.apache.pdfbox.pdfwriter.compress.COSWriterObjectStream.writeObject(COSWriterObjectStream.java:230)	at org.apache.pdfbox.pdfwriter.compress.COSWriterObjectStream.writeObjectsToStream(COSWriterObjectStream.java:119)	at org.apache.pdfbox.pdfwriter.COSWriter.doWriteBodyCompressed(COSWriter.java:499)	at org.apache.pdfbox.pdfwriter.COSWriter.visitFromDocument(COSWriter.java:1307) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I can&apos;t share the document used for testing because it contains sensitive information, but after debugging a bit I found that it contains OutlineItems with null SE objects and that is apparently what&apos;s causing the error:&#160;&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13069200/13069200_image-2024-05-30-11-58-21-024.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13069199/13069199_image-2024-05-30-12-00-33-290.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;br/&gt;
&#160;&lt;br/&gt;
The document was produced using Adobe Acrobat Pro 2020 20.5 30636&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13069198/13069198_image-2024-05-30-12-01-30-708.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;br/&gt;
Unfortunately I don&apos;t have access to this software and I coulnd&apos;t recreate a similar document to reproduce the issue.&lt;br/&gt;
&#160;&lt;br/&gt;
I found a user with a similar issue in your mailing lists : &lt;a href=&quot;https://www.mail-archive.com/users@pdfbox.apache.org/msg13258.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.mail-archive.com/users@pdfbox.apache.org/msg13258.html&lt;/a&gt;&lt;br/&gt;
&#160;&lt;br/&gt;
Let me know if you need more details regarding this problem.&lt;br/&gt;
&#160;&lt;br/&gt;
Also, if you are able to create a test document that would reproduce the issue, would you please mind sharing it? It would be of great help.&lt;br/&gt;
Or if you have way to anonymize a document without altering its structure.&lt;br/&gt;
&#160;&lt;br/&gt;
Many thanks in advance!&lt;/p&gt;</description>
                <environment></environment>
        <key id="13580996">PDFBOX-5832</key>
            <summary>Error when writing a document with OutlineItems containing null SE objects</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="arthur.renard">Arthur Renard</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 May 2024 10:08:26 +0000</created>
                <updated>Sat, 10 Aug 2024 07:18:09 +0000</updated>
                            <resolved>Tue, 4 Jun 2024 05:20:24 +0000</resolved>
                                    <version>3.0.2 PDFBox</version>
                    <version>4.0.0</version>
                                    <fixVersion>3.0.3 PDFBox</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>Writing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="17850668" author="tilman" created="Thu, 30 May 2024 10:18:44 +0000"  >&lt;p&gt;&quot;because we encountered some errors when loading documents&quot; - but the error happened with writing, isn&apos;t it?&lt;/p&gt;

&lt;p&gt;Could you open the file with an editor like NOTEPAD++ and look for &quot;130 0 obj&quot; and make a screenshot if you find it?&lt;/p&gt;</comment>
                            <comment id="17850698" author="JIRAUSER305628" created="Thu, 30 May 2024 12:16:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; yes sorry, the error occurs when saving the doc with .save() method of PDDocument.&lt;/p&gt;

&lt;p&gt;It goes all the way to the writeObject() method of COSWriterObjectStream and ends up in the else statement L236-239:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
{
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error: Unknown type in object stream:&quot;&lt;/span&gt; + object);
} &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And that&apos;s what&apos;s weird, when opening the file with an editor I can&apos;t find any OutlineItems. 130 0 obj doesn&apos;t show up, neither 138 0 obj or the others.&lt;/p&gt;

&lt;p&gt;I only find the Outlines reference 129 0 R&lt;br/&gt;
&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13069202/13069202_image-2024-05-30-14-14-49-237.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17850713" author="tilman" created="Thu, 30 May 2024 13:22:30 +0000"  >&lt;p&gt;I was afraid of that, it means that it&apos;s in a compressed object stream. What you could try is to open the file with PDFDebugger, switch view to &quot;cross reference table&quot;, &lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13069206/13069206_screenshot-2.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
then look at the elements starting from the bottom. Here&apos;s an example, note the /ObjStm:&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13069205/13069205_screenshot-1.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
&quot;First:768&quot; is the offset of the first object. The object stream in my file starts with number pairs like this: &quot;27 0 28 1176 29 3009 30 3090 31 3147 32 3241 33 3279 34 3433 35 3488 36 3561 37 3629&quot;. 27 means object 27 starts at offset 768+0=768. Object 28 starts at offset 768+1176=1944. So you need to find an ObjStm object with a 129, save the object stream, go to the offset, and look what&apos;s there. It should be something like this &amp;lt;&amp;lt; /A 141 0 R /Next 138 0 R /Parent 129 0 R /SE ?????? &amp;gt;&amp;gt; I&apos;m wondering what&apos;s after SE. Maybe null, maybe a non existent reference, maybe a syntax error.&lt;/p&gt;</comment>
                            <comment id="17850724" author="JIRAUSER305628" created="Thu, 30 May 2024 13:58:28 +0000"  >&lt;p&gt;Thank you for the explanation!&lt;/p&gt;

&lt;p&gt;I think I found the Outlines object stream:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13069207/13069207_Screenshot+from+2024-05-30+15-49-52.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;There are 6 outline items, 5 of them have a SE object linked to them and only one points toward a &quot;real&quot; object (143 0 R).&lt;/p&gt;

&lt;p&gt;The other ones (which appear as null in the debugger) have an object number that doesn&apos;t exist in the document:&lt;/p&gt;

&lt;p&gt;2240 0 R&lt;/p&gt;

&lt;p&gt;2241 0 R&lt;/p&gt;

&lt;p&gt;2242 0 R&lt;/p&gt;

&lt;p&gt;The last object of the document has number 2239 so it seems that they are non existent references as you mentionned&lt;/p&gt;</comment>
                            <comment id="17850737" author="tilman" created="Thu, 30 May 2024 14:32:24 +0000"  >&lt;p&gt;I tried to alter a document so that it has an invalid reference, but this didn&apos;t have the effect, maybe because it isn&apos;t in an object stream. I can&apos;t edit these ones because they&apos;re compressed.&lt;/p&gt;</comment>
                            <comment id="17850746" author="tilman" created="Thu, 30 May 2024 14:44:43 +0000"  >&lt;p&gt;My theory is that base is null at line 238. I could add logging but our build server is currently broken. And I suspect the actual error is elsewhere, i.e. in parsing, and changing the code near line 238 (writing COSNull) would just hide the symptom.&lt;/p&gt;</comment>
                            <comment id="17851113" author="lehmi" created="Fri, 31 May 2024 14:02:00 +0000"  >&lt;p&gt;I agree with Tilmans theory. The indirect object isn&apos;t a known object and can&apos;t be dereferenced which ends up in a null-value if one tries to get the object from the COSObject instance. Unlike Tilman I like his proposal to handle the null similar to COSNull &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; But instead of extending the last &lt;tt&gt;if&lt;/tt&gt; checking for COSNull I&apos;d rather add that special case to the beginning of that method when COSObject are processed. Simply write COSNull if the base value of toplevel COSObjects is null due to a broken reference and add some debug-logging. This would handle orphaned indirect objects in a lenient way but doesn&apos;t swallow other possible issues.&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="17851122" author="tilman" created="Fri, 31 May 2024 14:35:11 +0000"  >&lt;p&gt;Sure we can do that... before or after the &quot;if (!topLevel)&quot; segment? But I still wonder why there isn&apos;t any mayhem when an invalid reference is outside of an ObjStm but I don&apos;t know enough of that code part.&lt;/p&gt;</comment>
                            <comment id="17851137" author="lehmi" created="Fri, 31 May 2024 15:32:38 +0000"  >&lt;p&gt;Yes, right after line 187&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;base = ((COSObject) object).getObject();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The objects 2240, 2241 and 2242 are unknown to the pdf as the last known object is 2239, so that the indirect references to that objects within the compressed object stream ended up in the middle of nowhere. It shouldn&apos;t make any difference whether those references are part of a compressed stream or not. Once the writer tries to write the object containing that reference it stumbles upon the broken reference and fails.&lt;/p&gt;

&lt;p&gt;Without having a hand on that specific pdf ii is just a theory, but I&apos;m quite sure to be right. The pdf or better its creator is to blame not pdfbox&lt;/p&gt;

&lt;p&gt;May I add the change?&lt;/p&gt;</comment>
                            <comment id="17851141" author="tilman" created="Fri, 31 May 2024 15:39:23 +0000"  >&lt;p&gt;Sure, go ahead.&lt;/p&gt;</comment>
                            <comment id="17851213" author="jira-bot" created="Fri, 31 May 2024 21:25:33 +0000"  >&lt;p&gt;Commit 1918084 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1918084&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1918084&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5832&quot; title=&quot;Error when writing a document with OutlineItems containing null SE objects&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5832&quot;&gt;&lt;del&gt;PDFBOX-5832&lt;/del&gt;&lt;/a&gt;: write COSNull for missing indirect objects due to a corrupt pdf&lt;/p&gt;</comment>
                            <comment id="17851214" author="jira-bot" created="Fri, 31 May 2024 21:25:46 +0000"  >&lt;p&gt;Commit 1918085 from lehmi@apache.org in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1918085&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1918085&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5832&quot; title=&quot;Error when writing a document with OutlineItems containing null SE objects&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5832&quot;&gt;&lt;del&gt;PDFBOX-5832&lt;/del&gt;&lt;/a&gt;: write COSNull for missing indirect objects due to a corrupt pdf&lt;/p&gt;</comment>
                            <comment id="17851260" author="lehmi" created="Sat, 1 Jun 2024 09:13:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arthur.renard&quot; class=&quot;user-hover&quot; rel=&quot;arthur.renard&quot;&gt;arthur.renard&lt;/a&gt; the last changes should avoid the IOException at least theoretically. Please give it a try by using either the current 4.0.0-SNAPSHOT or 3.0.3-SNAPSHOT version&lt;/p&gt;</comment>
                            <comment id="17851540" author="JIRAUSER305628" created="Mon, 3 Jun 2024 07:55:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; tried it with 3.0.3-SNAPSHOT and the document is now correctly saved, thank you for your quick response!&lt;/p&gt;</comment>
                            <comment id="17851898" author="lehmi" created="Tue, 4 Jun 2024 05:20:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=arthur.renard&quot; class=&quot;user-hover&quot; rel=&quot;arthur.renard&quot;&gt;arthur.renard&lt;/a&gt; thanks for the feddback. &lt;/p&gt;

&lt;p&gt;Set to resolved&lt;/p&gt;</comment>
                            <comment id="17853167" author="dvdm" created="Fri, 7 Jun 2024 14:06:20 +0000"  >&lt;p&gt;I was experiencing the same issue with user supplied PDF files, with the same exact stacktrace. I can confirm 3.0.3-SNAPSHOT is able to save those files, while 3.0.2 didn&apos;t work. Thanks for looking into this!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13069207" name="Screenshot from 2024-05-30 15-49-52.png" size="41996" author="arthur.renard" created="Thu, 30 May 2024 13:55:22 +0000"/>
                            <attachment id="13069200" name="image-2024-05-30-11-58-21-024.png" size="13802" author="arthur.renard" created="Thu, 30 May 2024 09:58:21 +0000"/>
                            <attachment id="13069199" name="image-2024-05-30-12-00-33-290.png" size="28200" author="arthur.renard" created="Thu, 30 May 2024 10:00:33 +0000"/>
                            <attachment id="13069198" name="image-2024-05-30-12-01-30-708.png" size="8175" author="arthur.renard" created="Thu, 30 May 2024 10:01:30 +0000"/>
                            <attachment id="13069202" name="image-2024-05-30-14-14-49-237.png" size="11140" author="arthur.renard" created="Thu, 30 May 2024 12:14:49 +0000"/>
                            <attachment id="13069205" name="screenshot-1.png" size="19466" author="tilman" created="Thu, 30 May 2024 13:18:37 +0000"/>
                            <attachment id="13069206" name="screenshot-2.png" size="30970" author="tilman" created="Thu, 30 May 2024 13:21:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1pimg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>