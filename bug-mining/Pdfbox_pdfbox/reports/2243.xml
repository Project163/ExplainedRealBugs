<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:09:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4525] PDF completely blow up the RAM on RedHat</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4525</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;We received a PDF that has completly killed the Tomcat on a production application.&lt;/p&gt;

&lt;p&gt;The symptoms are the same as &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4392&quot; title=&quot;PDF completely blow up the RAM on amazon instances&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4392&quot;&gt;&lt;del&gt;PDFBOX-4392&lt;/del&gt;&lt;/a&gt;, but the PDF file is different.&lt;/p&gt;

&lt;p&gt;Messages: 6000 times&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
avr. 24, 2019 3:02:33 PM org.apache.pdfbox.pdmodel.graphics.color.PDICCBased ensureDisplayProfile
AVERTISSEMENT: ICC profile is Perceptual, ignoring, treating as Display class
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We test it on RedHat5 VM in develop and reproduce it with a sample test program that read the PDF, and create a small image. The program is looping and after the 4th reading it took 20Gb of memory and was killed by the OS to prevent the crash of the computer.&lt;/p&gt;

&lt;p&gt;I&apos;ve tried with version 2.0.15 and the problem still be&#160;the same.&lt;/p&gt;

&lt;p&gt;We can test it with java -jar testPdfBox.jar crash_redhat.pdf&lt;/p&gt;</description>
                <environment></environment>
        <key id="13229871">PDFBOX-4525</key>
            <summary>PDF completely blow up the RAM on RedHat</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="add_erl">lienhardt</reporter>
                        <labels>
                            <label>optimization</label>
                    </labels>
                <created>Wed, 24 Apr 2019 13:07:59 +0000</created>
                <updated>Fri, 28 Jun 2019 04:39:51 +0000</updated>
                            <resolved>Wed, 24 Apr 2019 16:22:17 +0000</resolved>
                                    <version>2.0.9</version>
                    <version>2.0.15</version>
                                    <fixVersion>2.0.16</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16825203" author="tilman" created="Wed, 24 Apr 2019 14:18:25 +0000"  >&lt;p&gt;The PDF file has 6014 form xobjects. Each one of them is a transparency group with a colorspace. Creating this colorspace as a PD object does not use the resource cache, so it is created again each time.&lt;/p&gt;

&lt;p&gt;I think this can be fixed, either by using a different way to check whether it is gray, or by passing the resources.&lt;/p&gt;</comment>
                            <comment id="16825234" author="jira-bot" created="Wed, 24 Apr 2019 14:48:03 +0000"  >&lt;p&gt;Commit 1858056 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1858056&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1858056&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4525&quot; title=&quot;PDF completely blow up the RAM on RedHat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4525&quot;&gt;&lt;del&gt;PDFBOX-4525&lt;/del&gt;&lt;/a&gt;: pass the resources to profit from the resource cache when creating the colorspace&lt;/p&gt;</comment>
                            <comment id="16825235" author="jira-bot" created="Wed, 24 Apr 2019 14:48:09 +0000"  >&lt;p&gt;Commit 1858057 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1858057&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1858057&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4525&quot; title=&quot;PDF completely blow up the RAM on RedHat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4525&quot;&gt;&lt;del&gt;PDFBOX-4525&lt;/del&gt;&lt;/a&gt;: pass the resources to profit from the resource cache when creating the colorspace&lt;/p&gt;</comment>
                            <comment id="16825236" author="jira-bot" created="Wed, 24 Apr 2019 14:48:14 +0000"  >&lt;p&gt;Commit 1858058 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1858058&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1858058&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4525&quot; title=&quot;PDF completely blow up the RAM on RedHat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4525&quot;&gt;&lt;del&gt;PDFBOX-4525&lt;/del&gt;&lt;/a&gt;: pass the resources to profit from the resource cache when creating the colorspace&lt;/p&gt;</comment>
                            <comment id="16825245" author="add_erl" created="Wed, 24 Apr 2019 15:08:56 +0000"  >&lt;p&gt;Thanks for your reactivity. I will test that.&lt;/p&gt;

&lt;p&gt;The principal problem is that the Tomcat crash&#160;in reason that when we pass this file in pdfbox the memory is not deallocated. The&#160;warn&#160;message is secondary for us, because we use pdfbox to generate a small image of the first page of the PDF.&lt;/p&gt;

&lt;p&gt;I&apos;ve just tried the patch given in the&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4392&quot; title=&quot;PDF completely blow up the RAM on amazon instances&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4392&quot;&gt;&lt;del&gt;PDFBOX-4392&lt;/del&gt;&lt;/a&gt; and miracle I&apos;ve no more memory problem. The&#160;memory stay between 700Mb and 1.1Gb. Could you see if your commit resolve this problem of memory ?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="16825278" author="tilman" created="Wed, 24 Apr 2019 15:40:34 +0000"  >&lt;p&gt;I was able to render the file at 72dpi with &lt;tt&gt;-Xmx200m&lt;/tt&gt; with the snapshot, try it here:&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.16-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.16-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16825299" author="add_erl" created="Wed, 24 Apr 2019 16:04:24 +0000"  >&lt;p&gt;It&apos;s fast and low in memory.&lt;/p&gt;

&lt;p&gt;When do you relase the 2.0.16 ?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="16825314" author="tilman" created="Wed, 24 Apr 2019 16:21:17 +0000"  >&lt;p&gt;We just had a release. Releases are usually done every 3-4 months.&lt;/p&gt;</comment>
                            <comment id="16825371" author="jira-bot" created="Wed, 24 Apr 2019 17:35:33 +0000"  >&lt;p&gt;Commit 1858063 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1858063&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1858063&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4525&quot; title=&quot;PDF completely blow up the RAM on RedHat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4525&quot;&gt;&lt;del&gt;PDFBOX-4525&lt;/del&gt;&lt;/a&gt;: also pass the resources in other colorspace retrieval to keep code similar&lt;/p&gt;</comment>
                            <comment id="16825372" author="jira-bot" created="Wed, 24 Apr 2019 17:35:38 +0000"  >&lt;p&gt;Commit 1858064 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1858064&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1858064&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4525&quot; title=&quot;PDF completely blow up the RAM on RedHat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4525&quot;&gt;&lt;del&gt;PDFBOX-4525&lt;/del&gt;&lt;/a&gt;: also pass the resources in other colorspace retrieval to keep code similar&lt;/p&gt;</comment>
                            <comment id="16825373" author="jira-bot" created="Wed, 24 Apr 2019 17:35:43 +0000"  >&lt;p&gt;Commit 1858065 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1858065&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1858065&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4525&quot; title=&quot;PDF completely blow up the RAM on RedHat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4525&quot;&gt;&lt;del&gt;PDFBOX-4525&lt;/del&gt;&lt;/a&gt;: also pass the resources in other colorspace retrieval to keep code similar&lt;/p&gt;</comment>
                            <comment id="16825813" author="add_erl" created="Thu, 25 Apr 2019 07:27:55 +0000"  >&lt;p&gt;My program that generate this file 1000x&#160;&lt;/p&gt;

&lt;p&gt;Tested on windows: it took: 214Mo stable (no memory resource increased).&lt;/p&gt;

&lt;p&gt;on RedHat it starts at 214Mo and finish to 4.1Gb.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
top - 08:42:34 up 70 days, 11:26, 3 users, load average: 1.09, 1.10, 0.66
Tasks: 259 total, 1 running, 258 sleeping, 0 stopped, 0 zombie
Cpu(s): 14.3%us, 0.2%sy, 0.0%ni, 85.4%id, 0.0%wa, 0.0%hi, 0.0%si, 0.1%st
Mem: 20600384k total, 7052548k used, 13547836k free, 214040k buffers
Swap: 4063228k total, 74592k used, 3988636k free, 2160972k cached

PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND
14188 jservdev 20 0 6849m 4.0g 13m S 117.0 20.4 17:06.74 java
2788 root 20 0 1616m 18m 3300 S 0.7 0.1 142:28.77 python
1 root 20 0 19356 312 136 S 0.0 0.0 0:33.08 init
2 root 20 0 0 0 0 S 0.0 0.0 0:00.69 kthreadd
3 root RT 0 0 0 0 S 0.0 0.0 0:03.67 migration/0
4 root 20 0 0 0 0 S 0.0 0.0 0:03.09 ksoftirqd/0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;What is strange is that I&apos;ve tested the 2.0.9 with the patch (4392) on RedHat, and it took only ~700Mo.&lt;/p&gt;</comment>
                            <comment id="16825823" author="tilman" created="Thu, 25 Apr 2019 07:48:18 +0000"  >&lt;p&gt;What java version are you using on RedHat? The difference made by the &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4392&quot; title=&quot;PDF completely blow up the RAM on amazon instances&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4392&quot;&gt;&lt;del&gt;PDFBOX-4392&lt;/del&gt;&lt;/a&gt; patch is that it the ICC profile will only be parsed once instead of twice when it is perceptual.&lt;/p&gt;</comment>
                            <comment id="16825904" author="add_erl" created="Thu, 25 Apr 2019 09:33:18 +0000"  >&lt;ul&gt;
	&lt;li&gt;Bad test: (2.0.9 with patch) grow to 1.5Gb and stabilize to 700Mb&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java version &lt;span class=&quot;code-quote&quot;&gt;&quot;1.7.0_201&quot;&lt;/span&gt;
OpenJDK &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt; Environment (rhel-2.6.16.0.el6_10-x86_64 u201-b00)
OpenJDK 64-Bit Server VM (build 24.201-b00, mixed mode)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ul&gt;
	&lt;li&gt;I test with 1.8.0_60 :&#160;grow to 1.7Gb and stabilize to 480Mb&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java version &lt;span class=&quot;code-quote&quot;&gt;&quot;1.8.0_60&quot;&lt;/span&gt;
Java(TM) SE &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt; Environment (build 1.8.0_60-b27)
Java HotSpot(TM) 64-Bit Server VM (build 25.60-b23, mixed mode)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Test 2.0.16 with patch and&#160;1.8.0_60:&#160;214Mo and finish to 4.1Gb&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So I can have Fast and memory lost (2.0.16) or slow and memory acceptable (2.0.9).&lt;/p&gt;</comment>
                            <comment id="16825912" author="tilman" created="Thu, 25 Apr 2019 09:41:41 +0000"  >&lt;p&gt;1.8.0.60 is not good. 1.8 started to be good around 192. Even the KCMS option is no longer needed. Please try the latest public oracle 1.8 (new license is ok to use for test, but not for production), or use Amazon Corretto 8 (which has a friendlier license).&lt;/p&gt;</comment>
                            <comment id="16826010" author="add_erl" created="Thu, 25 Apr 2019 12:27:24 +0000"  >&lt;p&gt;With 2.0.16. I tried on a RedHat5 with&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java version &lt;span class=&quot;code-quote&quot;&gt;&quot;1.8.0_211&quot;&lt;/span&gt;
Java(TM) SE &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt; Environment (build 1.8.0_211-b12)
Java HotSpot(TM) 64-Bit Server VM (build 25.211-b12, mixed mode)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Took 1Gb-&amp;gt;3.3Gb&lt;/p&gt;

&lt;p&gt;On a RedHat 7: Took 1Gb stable&lt;/p&gt;

&lt;p&gt;I cannot change the&#160;OS until next year, so we will use the 2.0.9 with the patch hoping that the problem of memory will be resolved until the release of 2.0.16.&lt;/p&gt;</comment>
                            <comment id="16826704" author="tilman" created="Fri, 26 Apr 2019 06:45:27 +0000"  >&lt;p&gt;It is not a good idea to work with old versions&#8230; the best would be to find out when the memory problem started, by checking out different revisions to find out which one is the culprit. Something similar to &quot;git bisect&quot; but with svn. (But there is a git mirror on github). It takes several hours but can be done in parallel to other tasks but you need patience and a good test tool.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12966886" name="crash_redhat.pdf" size="3563271" author="add_erl" created="Wed, 24 Apr 2019 13:10:59 +0000"/>
                            <attachment id="12966885" name="testPdfBox.jar" size="11759240" author="add_erl" created="Wed, 24 Apr 2019 13:10:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z023iw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>