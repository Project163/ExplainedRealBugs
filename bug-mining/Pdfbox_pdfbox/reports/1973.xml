<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:07:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4227] java.util.zip.DataFormatException: invalid distance too far back</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4227</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I get a zip exception with the attached PDF file, which renders successfully in a couple of PDF viewers I tried.&lt;/p&gt;

&lt;p&gt;ByteArrayInputStream pdfInputStream = new ByteArrayInputStream(pdfByteArray);&lt;br/&gt;
PDFMergerUtility merger = new PDFMergerUtility();&lt;br/&gt;
merger.addSource(pdfInputStream);&lt;/p&gt;

&lt;p&gt;ByteArrayOutputStream outputStream = new ByteArrayOutputStream();&lt;br/&gt;
merger.setDestinationStream(outputStream);&lt;br/&gt;
merger.mergeDocuments(MemoryUsageSetting.setupMainMemoryOnly());&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;PDF file attached.&lt;/p&gt;



&lt;p&gt;Stack Trace:&lt;/p&gt;

&lt;p&gt;java.io.IOException: java.util.zip.DataFormatException: invalid distance too far back&lt;br/&gt;
 at org.apache.pdfbox.filter.FlateFilter.decode(FlateFilter.java:83)&lt;br/&gt;
 at org.apache.pdfbox.filter.Filter.decode(Filter.java:87)&lt;br/&gt;
 at org.apache.pdfbox.cos.COSInputStream.create(COSInputStream.java:77)&lt;br/&gt;
 at org.apache.pdfbox.cos.COSStream.createInputStream(COSStream.java:175)&lt;br/&gt;
 at org.apache.pdfbox.cos.COSStream.createInputStream(COSStream.java:163)&lt;br/&gt;
 at org.apache.pdfbox.multipdf.PDFMergerUtility.appendDocument(PDFMergerUtility.java:516)&lt;br/&gt;
 at org.apache.pdfbox.multipdf.PDFMergerUtility.mergeDocuments(PDFMergerUtility.java:263)&lt;br/&gt;
 ...&lt;br/&gt;
 Caused by: java.util.zip.DataFormatException: invalid distance too far back&lt;br/&gt;
 at java.util.zip.Inflater.inflateBytes(Native Method)&lt;br/&gt;
 at java.util.zip.Inflater.inflate(Inflater.java:259)&lt;br/&gt;
 at java.util.zip.Inflater.inflate(Inflater.java:280)&lt;br/&gt;
 at org.apache.pdfbox.filter.FlateFilter.decompress(FlateFilter.java:108)&lt;br/&gt;
 at org.apache.pdfbox.filter.FlateFilter.decode(FlateFilter.java:74)&lt;br/&gt;
 ... 35 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="13160930">PDFBOX-4227</key>
            <summary>java.util.zip.DataFormatException: invalid distance too far back</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="michaelgmiller">Michael Miller</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 May 2018 01:19:32 +0000</created>
                <updated>Thu, 21 Jun 2018 20:27:58 +0000</updated>
                            <resolved>Sat, 26 May 2018 12:33:22 +0000</resolved>
                                    <version>2.0.9</version>
                                    <fixVersion>2.0.10</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Utilities</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16483552" author="tilman" created="Tue, 22 May 2018 06:18:23 +0000"  >
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
3 0 obj
&amp;lt;&amp;lt;
/Length 2374
/Type /Metadata
/Subtype /XML
/Filter /FlateDecode
&amp;gt;&amp;gt;
stream
&amp;lt;x:xmpmeta xmlns:x=&lt;span class=&quot;code-quote&quot;&gt;&quot;adobe:ns:meta/&quot;&lt;/span&gt; x:xmptk=&lt;span class=&quot;code-quote&quot;&gt;&quot;XMP Core 5.4.0&quot;&lt;/span&gt;&amp;gt;
   &amp;lt;rdf:RDF xmlns:rdf=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.w3.org/1999/02/22-rdf-syntax-ns#&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;      &amp;lt;rdf:Description rdf:about=&quot;&quot;
            xmlns:xmp=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//ns.adobe.com/xap/1.0/&quot;&lt;/span&gt;
&lt;/span&gt;            xmlns:dc=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//purl.org/dc/elements/1.1/&quot;&lt;/span&gt;
&lt;/span&gt;            xmlns:xmpMM=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//ns.adobe.com/xap/1.0/mm/&quot;&lt;/span&gt;
&lt;/span&gt;            xmlns:stEvt=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//ns.adobe.com/xap/1.0/sType/ResourceEvent#&quot;&lt;/span&gt;
&lt;/span&gt;            xmlns:stRef=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//ns.adobe.com/xap/1.0/sType/ResourceRef#&quot;&lt;/span&gt;
&lt;/span&gt;            xmlns:pdf=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//ns.adobe.com/pdf/1.3/&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;         &amp;lt;xmp:CreatorTool&amp;gt;Adobe InDesign CC 2017 (Macintosh)&amp;lt;/xmp:CreatorTool&amp;gt;
         &amp;lt;xmp:MetadataDate&amp;gt;2017-12-18T17:55:15-05:00&amp;lt;/xmp:MetadataDate&amp;gt;
         &amp;lt;xmp:CreateDate&amp;gt;2017-05-10T21:51:02Z&amp;lt;/xmp:CreateDate&amp;gt;
         &amp;lt;xmp:ModifyDate&amp;gt;2017-12-18T17:55:15-05:00&amp;lt;/xmp:ModifyDate&amp;gt;
         &amp;lt;dc:format&amp;gt;application/pdf&amp;lt;/dc:format&amp;gt;
         &amp;lt;xmpMM:OriginalDocumentID&amp;gt;xmp.did:8371e414-957c-4e45-abbf-58c95e32809c&amp;lt;/xmpMM:OriginalDocumentID&amp;gt;
         &amp;lt;xmpMM:History&amp;gt;
            &amp;lt;rdf:Seq&amp;gt;
               &amp;lt;rdf:li rdf:parseType=&lt;span class=&quot;code-quote&quot;&gt;&quot;Resource&quot;&lt;/span&gt;&amp;gt;
                  &amp;lt;stEvt:softwareAgent&amp;gt;Adobe InDesign CC 2017 (Macintosh)&amp;lt;/stEvt:softwareAgent&amp;gt;
                  &amp;lt;stEvt:changed&amp;gt;/&amp;lt;/stEvt:changed&amp;gt;
                  &amp;lt;stEvt:action&amp;gt;converted&amp;lt;/stEvt:action&amp;gt;
                  &amp;lt;stEvt:when&amp;gt;2016-11-11T16:11:57-05:00&amp;lt;/stEvt:when&amp;gt;
                  &amp;lt;stEvt:parameters&amp;gt;from application/x-indesign to application/pdf&amp;lt;/stEvt:parameters&amp;gt;
               &amp;lt;/rdf:li&amp;gt;
            &amp;lt;/rdf:Seq&amp;gt;
         &amp;lt;/xmpMM:History&amp;gt;
         &amp;lt;xmpMM:InstanceID&amp;gt;uuid:faabd5b1-924a-834b-b999-022fd0608e4f&amp;lt;/xmpMM:InstanceID&amp;gt;
         &amp;lt;xmpMM:DocumentID&amp;gt;xmp.id:932ce8eb-b215-4b81-82e8-4e0b8c029f67&amp;lt;/xmpMM:DocumentID&amp;gt;
         &amp;lt;xmpMM:DerivedFrom rdf:parseType=&lt;span class=&quot;code-quote&quot;&gt;&quot;Resource&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;stRef:renditionClass&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&amp;lt;/stRef:renditionClass&amp;gt;
            &amp;lt;stRef:documentID&amp;gt;xmp.did:8371e414-957c-4e45-abbf-58c95e32809c&amp;lt;/stRef:documentID&amp;gt;
            &amp;lt;stRef:instanceID&amp;gt;xmp.iid:12fcd2dd-3fc4-4ab0-a5ee-85a8b58aa933&amp;lt;/stRef:instanceID&amp;gt;
            &amp;lt;stRef:originalDocumentID&amp;gt;xmp.did:8371e414-957c-4e45-abbf-58c95e32809c&amp;lt;/stRef:originalDocumentID&amp;gt;
         &amp;lt;/xmpMM:DerivedFrom&amp;gt;
         &amp;lt;xmpMM:RenditionClass&amp;gt;proof:pdf&amp;lt;/xmpMM:RenditionClass&amp;gt;
         &amp;lt;pdf:Trapped&amp;gt;False&amp;lt;/pdf:Trapped&amp;gt;
         &amp;lt;pdf:Producer&amp;gt;Mac OS X 10.12.4 Quartz PDFContext&amp;lt;/pdf:Producer&amp;gt;
      &amp;lt;/rdf:Description&amp;gt;
   &amp;lt;/rdf:RDF&amp;gt;
&amp;lt;/x:xmpmeta&amp;gt;

endstream
endobj
5 0 obj

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The metadata is said to be flate decodeded but it isn&apos;t, obviously. The file renders fine with PDFBox too. It&apos;s just merging that won&apos;t work. Is the problem only with this file? If so, open it with NOTEPAD++ and overwrite /Filter /FlateDecode with the same amount of blanks.&lt;/p&gt;</comment>
                            <comment id="16483693" author="michaelgmiller" created="Tue, 22 May 2018 09:09:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; yeah, the issue is that we have a bunch of PDFs like this that won&apos;t merge. It feels a bit janky to just attempt to remove the FlateDecode without knowing the content - Is there anything more elegant we can do to merge PDFs that have this property? Or can the merging use the same logic as the rendering for determining compression type?&lt;/p&gt;</comment>
                            <comment id="16487633" author="tilman" created="Wed, 23 May 2018 16:54:31 +0000"  >&lt;p&gt;Rendering works fine because the metadata isn&apos;t used.&lt;/p&gt;

&lt;p&gt;What would you like us to do? The easiest would be to skip a bad XMP metadata, but then it would be missing in the merged PDF. Another possibility would be to create some code just for you, that would repair such files (if you can identify them) prior to merging them.&lt;/p&gt;</comment>
                            <comment id="16489670" author="michaelgmiller" created="Thu, 24 May 2018 19:45:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; Yeah that&apos;s a hard question. In our case, we don&apos;t really care about the metadata, so an &quot;ignore metadata&quot; option would work great, and probably be the simplest!&lt;/p&gt;</comment>
                            <comment id="16491089" author="tilman" created="Fri, 25 May 2018 17:59:51 +0000"  >&lt;p&gt;An option to ignore the metadata would be a bit weird, there&apos;s already an option to set the metadata, although it must be non null. I&apos;ll make the merger more resilient.&lt;/p&gt;</comment>
                            <comment id="16491091" author="jira-bot" created="Fri, 25 May 2018 18:02:33 +0000"  >&lt;p&gt;Commit 1832259 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1832259&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1832259&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4227&quot; title=&quot;java.util.zip.DataFormatException: invalid distance too far back&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4227&quot;&gt;&lt;del&gt;PDFBOX-4227&lt;/del&gt;&lt;/a&gt;: be resilent if XMP metadata can&apos;t be read&lt;/p&gt;</comment>
                            <comment id="16491092" author="jira-bot" created="Fri, 25 May 2018 18:02:37 +0000"  >&lt;p&gt;Commit 1832260 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1832260&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1832260&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4227&quot; title=&quot;java.util.zip.DataFormatException: invalid distance too far back&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4227&quot;&gt;&lt;del&gt;PDFBOX-4227&lt;/del&gt;&lt;/a&gt;: be resilent if XMP metadata can&apos;t be read&lt;/p&gt;</comment>
                            <comment id="16491637" author="tilman" created="Sat, 26 May 2018 12:33:22 +0000"  >&lt;p&gt;Please test with the snapshot here:&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.10-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.10-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12924460" name="testCorrupt.pdf" size="399917" author="michaelgmiller" created="Tue, 22 May 2018 01:20:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 25 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3tz5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>