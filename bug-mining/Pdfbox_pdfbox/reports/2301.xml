<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:09:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4674] PDF Page Render Background Image has Gray Smudges</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4674</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The following text produces a PNG that has gray smudges in it.&#160; I&apos;ve attached the pdf and the PNG that is produced.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;TestPdfPageImage {

    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testGetPageImage() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDDocument pdDocument = PDDocument.load(FileUtils.toFile(getClass().getResource(&lt;span class=&quot;code-quote&quot;&gt;&quot;/bad_page_image.pdf&quot;&lt;/span&gt;)))) {
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PDFRenderer pdfRenderer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFRenderer(pdDocument);

            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; BufferedImage bufferedImage = pdfRenderer.renderImage(0);
            &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path tempPath = Files.createTempFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;es-page-image&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;.png&quot;&lt;/span&gt;);
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; File tempFile = tempPath.toFile();
                ImageIO.write(bufferedImage, &lt;span class=&quot;code-quote&quot;&gt;&quot;png&quot;&lt;/span&gt;, tempFile);

                Assert.assertTrue(Files.size(tempPath) &amp;gt; 0);
            } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
                Files.delete(tempPath);
            }
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13264371">PDFBOX-4674</key>
            <summary>PDF Page Render Background Image has Gray Smudges</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="jezerinac">Joseph Jezerinac</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Oct 2019 23:11:05 +0000</created>
                <updated>Mon, 23 Dec 2019 22:16:08 +0000</updated>
                            <resolved>Sat, 2 Nov 2019 11:52:19 +0000</resolved>
                                    <version>2.0.17</version>
                                    <fixVersion>2.0.18</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16959558" author="mkl" created="Fri, 25 Oct 2019 08:41:57 +0000"  >&lt;p&gt;When I try to open your PDF in Adobe Reader, it warns me that an error exists on the page and that it may not be displayed correctly.&lt;/p&gt;

&lt;p&gt;Errors on the page imply that the page may be displayed differently on different viewers. PDFBox shows the scanned page in that shadowy way. And Adobe Reader here does not display the scanned page at all.&lt;/p&gt;

&lt;p&gt;Garbage in - garbage out.&lt;/p&gt;

&lt;p&gt;You should consider using non-broken PDFs.&lt;/p&gt;

&lt;p&gt;In more detail:&lt;/p&gt;

&lt;p&gt;The scanned images on the pages of your PDF are invalid. Their dictionaries have these values:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;/Filter/DCTDecode
/BitsPerComponent 5
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;According to the PDF specification, though:&lt;/p&gt;

&lt;div class=&quot;panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;ISO 32000-2, Table 87 &#8212; Additional entries specific to an image dictionary&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;panelContent&quot;&gt;
&lt;p&gt;&lt;b&gt;BitsPerComponent&lt;/b&gt; &#8212; integer &#8212; &lt;em&gt;(Required except for image masks and images that use the &lt;b&gt;JPXDecode&lt;/b&gt; filter)&lt;/em&gt; The number of bits used to represent each colour component. Only a single value shall be specified; the number of bits shall be the same for all colour components. The value shall be &lt;em&gt;1, 2, 4, 8,&lt;/em&gt; or (from PDF 1.5) &lt;em&gt;16&lt;/em&gt;. If &lt;b&gt;ImageMask&lt;/b&gt; is &lt;em&gt;true&lt;/em&gt;, this entry is optional, but if specified, its value shall be &lt;em&gt;1&lt;/em&gt;.&lt;br/&gt;
If the image stream uses a filter, the value of &lt;b&gt;BitsPerComponent&lt;/b&gt; shall be consistent with the size of the data samples that the filter delivers. In particular, a &lt;b&gt;CCITTFaxDecode&lt;/b&gt; or &lt;b&gt;JBIG2Decode&lt;/b&gt; filter shall always deliver 1-bit samples, a &lt;b&gt;RunLengthDecode&lt;/b&gt; or &lt;b&gt;DCTDecode&lt;/b&gt; filter shall always deliver 8-bit samples, and an &lt;b&gt;LZWDecode&lt;/b&gt; or &lt;b&gt;FlateDecode&lt;/b&gt; filter shall deliver samples of a specified size if a predictor function is used.|&lt;/p&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thus, &lt;b&gt;BitsPerComponent&lt;/b&gt; must be one of &lt;em&gt;1, 2, 4, 8,&lt;/em&gt; and &lt;em&gt;16&lt;/em&gt; anyways, and in case of a &lt;b&gt;Filter DCTDecode&lt;/b&gt; it must be 8.&lt;/p&gt;

&lt;p&gt;In your case it is &lt;em&gt;5&lt;/em&gt;, i.e. invalid.&lt;/p&gt;

&lt;p&gt;PDFBox apparently tries to render it nonetheless and the output is the garbage you observed:&lt;/p&gt;

&lt;p&gt; &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12983974/12983974_es-page-image2455431271065294360.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="16959878" author="tilman" created="Fri, 25 Oct 2019 15:48:22 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkl&quot; class=&quot;user-hover&quot; rel=&quot;mkl&quot;&gt;mkl&lt;/a&gt; for the analysis&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jezerinac&quot; class=&quot;user-hover&quot; rel=&quot;jezerinac&quot;&gt;jezerinac&lt;/a&gt; I wonder if this is a file you got &quot;from the wild&quot; or did you create it yourself? It is said to be created by Aspose.PDF for Java 19.8.&lt;/p&gt;</comment>
                            <comment id="16959914" author="jezerinac" created="Fri, 25 Oct 2019 16:39:59 +0000"  >&lt;p&gt;This was created from PDF box (later modified by aspose) using the following:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PDImageXObject pdImageXObject = JPEGFactory.createFromImage(pdDocument, bufferedImage, imageCompressionQuality);
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDPageContentStream contentStream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPageContentStream(pdDocument, pdPage)) {
&#160; contentStream.drawImage(pdImageXObject, 0, 0, pageSize.getWidth(), pageSize.getHeight());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;But the bufferedImage did have image type of&#160;BufferedImage.TYPE_USHORT_555_RGB, I guess this is not compatible with&#160;JPEGFactory / drawImage (it would be nice if worked).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Testing above was done using Chrome PDF viewer which opens fine but your right this is invalid document.&#160; Thanks again &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkl&quot; class=&quot;user-hover&quot; rel=&quot;mkl&quot;&gt;mkl&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="16959949" author="tilman" created="Fri, 25 Oct 2019 17:44:35 +0000"  >&lt;p&gt;Oh, so Aspose is innocent here. We&apos;re passing &lt;tt&gt;awtColorImage.getColorModel().getComponentSize(0)&lt;/tt&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll see what I / we can do, this will be fixed. Hopefully within the next few days. Until then, just copy your image into a TYPE_RGB image. If your image was a JPEG file in the first place, then use &lt;tt&gt;createFromStream()&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="16959950" author="mkl" created="Fri, 25 Oct 2019 17:45:46 +0000"  >&lt;p&gt;In that case &lt;tt&gt;JPEGFactory.createFromImage&lt;/tt&gt; appears to require some additional sanity checks and transform or reject such inputs.&lt;/p&gt;</comment>
                            <comment id="16959964" author="tilman" created="Fri, 25 Oct 2019 18:10:56 +0000"  >&lt;p&gt;After looking around, I think I can pass &lt;tt&gt;8&lt;/tt&gt; instead of the component size, if the JPEG format is encoded that way. I&apos;ll first try create a test to reproduce the effect, so that I am sure this fixes the problem.&lt;/p&gt;</comment>
                            <comment id="16960024" author="tilman" created="Fri, 25 Oct 2019 19:54:32 +0000"  >&lt;p&gt;Commited in trunk: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=1868950&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1868950&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
in 2.0: &lt;a href=&quot;http://svn.apache.org/viewvc?rev=1868948&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1868948&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16960236" author="jira-bot" created="Sat, 26 Oct 2019 02:11:59 +0000"  >&lt;p&gt;Commit 1868967 from Tilman Hausherr in branch &apos;pdfbox/branches/issue4569&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1868967&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1868967&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4674&quot; title=&quot;PDF Page Render Background Image has Gray Smudges&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4674&quot;&gt;&lt;del&gt;PDFBOX-4674&lt;/del&gt;&lt;/a&gt;: make sure that USHORT_555_RGB images are properly handled if there are optimizations in the future&lt;/p&gt;</comment>
                            <comment id="16960237" author="jira-bot" created="Sat, 26 Oct 2019 02:12:03 +0000"  >&lt;p&gt;Commit 1868968 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1868968&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1868968&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4674&quot; title=&quot;PDF Page Render Background Image has Gray Smudges&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4674&quot;&gt;&lt;del&gt;PDFBOX-4674&lt;/del&gt;&lt;/a&gt;: make sure that USHORT_555_RGB images are properly handled if there are optimizations in the future&lt;/p&gt;</comment>
                            <comment id="16960238" author="jira-bot" created="Sat, 26 Oct 2019 02:12:07 +0000"  >&lt;p&gt;Commit 1868969 from Tilman Hausherr in branch &apos;pdfbox/branches/issue45&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1868969&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1868969&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4674&quot; title=&quot;PDF Page Render Background Image has Gray Smudges&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4674&quot;&gt;&lt;del&gt;PDFBOX-4674&lt;/del&gt;&lt;/a&gt;: make sure that USHORT_555_RGB images are properly handled if there are optimizations in the future&lt;/p&gt;</comment>
                            <comment id="16960239" author="jira-bot" created="Sat, 26 Oct 2019 02:12:11 +0000"  >&lt;p&gt;Commit 1868970 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1868970&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1868970&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4674&quot; title=&quot;PDF Page Render Background Image has Gray Smudges&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4674&quot;&gt;&lt;del&gt;PDFBOX-4674&lt;/del&gt;&lt;/a&gt;: make sure that USHORT_555_RGB images are properly handled if there are optimizations in the future&lt;/p&gt;</comment>
                            <comment id="16960243" author="tilman" created="Sat, 26 Oct 2019 02:20:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jezerinac&quot; class=&quot;user-hover&quot; rel=&quot;jezerinac&quot;&gt;jezerinac&lt;/a&gt; Could you please test your application again? There is a snapshot version at&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.18-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.18-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16965325" author="tilman" created="Sat, 2 Nov 2019 11:52:19 +0000"  >&lt;p&gt;No feedback but setting to resolved anyway. Assuming that such files haven&apos;t spread into the wild.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12983973" name="bad_page_image.pdf" size="3913653" author="jezerinac" created="Thu, 24 Oct 2019 23:11:18 +0000"/>
                            <attachment id="12983974" name="es-page-image2455431271065294360.png" size="350898" author="jezerinac" created="Thu, 24 Oct 2019 23:11:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z07xq0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>