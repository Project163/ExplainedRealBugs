<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:03:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3403] IllegalArgumentException: Symbolic fonts must have a built-in encoding</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3403</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Happens with text extraction and rendering:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; java.lang.IllegalArgumentException: Symbolic fonts must have a built-in encoding
	at org.apache.pdfbox.pdmodel.font.encoding.DictionaryEncoding.&amp;lt;init&amp;gt;(DictionaryEncoding.java:113)
	at org.apache.pdfbox.pdmodel.font.PDSimpleFont.readEncoding(PDSimpleFont.java:126)
	at org.apache.pdfbox.pdmodel.font.PDType1CFont.&amp;lt;init&amp;gt;(PDType1CFont.java:131)
	at org.apache.pdfbox.pdmodel.font.PDFontFactory.createFont(PDFontFactory.java:60)
	at org.apache.pdfbox.pdmodel.PDResources.getFont(PDResources.java:123)
	at org.apache.pdfbox.contentstream.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.text.SetFontAndSize.process(SetFontAndSize.java:60)
	at org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:829)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12984257">PDFBOX-3403</key>
            <summary>IllegalArgumentException: Symbolic fonts must have a built-in encoding</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jahewson">John Hewson</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Jun 2016 06:12:54 +0000</created>
                <updated>Tue, 25 Feb 2025 08:07:56 +0000</updated>
                            <resolved>Sun, 7 Aug 2016 13:02:10 +0000</resolved>
                                    <version>2.0.2</version>
                    <version>2.0.3</version>
                    <version>3.0.0 PDFBox</version>
                                    <fixVersion>2.0.3</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15352465" author="tilman" created="Tue, 28 Jun 2016 06:40:33 +0000"  >&lt;p&gt;The cause is related to font /R23 having MacExpertEncoding as BaseEncoding. We don&apos;t support that one anywhere.&lt;/p&gt;</comment>
                            <comment id="15352510" author="mkl" created="Tue, 28 Jun 2016 07:23:44 +0000"  >&lt;p&gt;... and even in this situation where neither explicit nor implicit base encoding is known, there is no need to throw an exception as the &lt;b&gt;Differences&lt;/b&gt; cover all glyphs of the font.&lt;/p&gt;

&lt;p&gt;Furthermore, if used in text extraction contexts only, a proper &lt;b&gt;ToUnicode&lt;/b&gt; map would suffice, no need to know the encoding.&lt;/p&gt;

&lt;p&gt;Thus, in addition to supporting &lt;b&gt;MacExpertEncoding&lt;/b&gt; one should consider never to throw that exception at all.&lt;/p&gt;</comment>
                            <comment id="15353244" author="jira-bot" created="Tue, 28 Jun 2016 15:39:54 +0000"  >&lt;p&gt;Commit 1750540 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1750540&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1750540&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;: add MacExpertEncoding&lt;/p&gt;</comment>
                            <comment id="15353249" author="jira-bot" created="Tue, 28 Jun 2016 15:42:52 +0000"  >&lt;p&gt;Commit 1750541 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1750541&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1750541&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;: add MacExpertEncoding&lt;/p&gt;</comment>
                            <comment id="15353253" author="tilman" created="Tue, 28 Jun 2016 15:45:00 +0000"  >&lt;p&gt;I agree with with first and the last sentence, but not with the second: at that time, it isn&apos;t known whether rendering or text extraction is being done. I&apos;ll do further tests to see if the exception can be removed, i.e. just keep null for baseencoding and keep the differences.&lt;/p&gt;</comment>
                            <comment id="15353257" author="tilman" created="Tue, 28 Jun 2016 15:46:31 +0000"  >&lt;p&gt;Fun fact: I used PDFBox to extract the table from the PDF specification, as copy &amp;amp; paste didn&apos;t work.&lt;/p&gt;</comment>
                            <comment id="15353578" author="jira-bot" created="Tue, 28 Jun 2016 19:24:15 +0000"  >&lt;p&gt;Commit 1750561 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1750561&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1750561&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;: don&apos;t throw exception if encoding is missing but use /differences table, as suggested by Michael Klink&lt;/p&gt;</comment>
                            <comment id="15353583" author="jira-bot" created="Tue, 28 Jun 2016 19:25:56 +0000"  >&lt;p&gt;Commit 1750562 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1750562&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1750562&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;: don&apos;t throw exception if encoding is missing but use /differences table, as suggested by Michael Klink&lt;/p&gt;</comment>
                            <comment id="15363568" author="jahewson" created="Wed, 6 Jul 2016 01:05:45 +0000"  >&lt;p&gt;Unfortunately this fix was not a good choice. The exception which was thrown is there to verify PDFBox&apos;s internal consistency (that&apos;s why it&apos;s an unchecked exception), and bypassing it now allows PDFBox to get into an inconsistent state with invariants such as &quot;getBaseEncoding() never returns null&quot; being violated.&lt;/p&gt;

&lt;p&gt;As the exception says, symbolic fonts &lt;b&gt;must&lt;/b&gt; have a built-in encoding. It&apos;s the job of the caller of this function to make sure the inputs are correct - that&apos;s what needs to happen. Otherwise it&apos;s garbage in, garbage out.&lt;/p&gt;

&lt;p&gt;The `readEncoding()` method of `PDSimpleFont` is responsible for reading, and making fixes to encodings. This code should be making sure that the invariants set by DictionaryEncoding are satisfied, rather than forcing through invalid data.&lt;/p&gt;

&lt;p&gt;The only change that appears to have been necessary here was to add support for MacExpertEncoding. We could consider the issue of what happens when the BaseEncoding is an invalid name - but it&apos;s hypothetical and we&apos;d really need an example PDF to work through the best solution.&lt;/p&gt;</comment>
                            <comment id="15363815" author="jira-bot" created="Wed, 6 Jul 2016 05:39:43 +0000"  >&lt;p&gt;Commit 1751600 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1751600&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1751600&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;: revert 1750561 for lack of consensus&lt;/p&gt;</comment>
                            <comment id="15363821" author="jira-bot" created="Wed, 6 Jul 2016 05:45:05 +0000"  >&lt;p&gt;Commit 1751602 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1751602&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1751602&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;: revert 1750562 for lack of consensus&lt;/p&gt;</comment>
                            <comment id="15363895" author="mkl" created="Wed, 6 Jul 2016 07:17:10 +0000"  >&lt;blockquote&gt;
&lt;p&gt;The exception which was thrown is there to verify PDFBox&apos;s internal consistency (that&apos;s why it&apos;s an unchecked exception), and bypassing it now allows PDFBox to get into an inconsistent state with invariants such as &quot;getBaseEncoding() never returns null&quot; being violated.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There is no need for PDFBox to become internally inconsistent just because a font has no base encoding. As the base encoding can completely be overridden by the &lt;b&gt;Differences&lt;/b&gt;, code depending on the contents of the base encoding likely is broken anyways.&lt;/p&gt;

&lt;p&gt;If it merely is a matter of preventing &lt;tt&gt;null&lt;/tt&gt; base encodings, one could interpret the absence of a built-in encoding in a font and base encoding name in the dictionary as an empty built-in encoding and create such an entry.&lt;/p&gt;

&lt;p&gt;Consider e.g. a symbolic Type 3 font. Type 3 fonts do not need a built-in encoding (cf. ISO 32000-1 9.6.6.1, &lt;em&gt;&quot;Except for Type 3 fonts, every font program shall have a built-in encoding.&quot;&lt;/em&gt;), and in their case we have an &lt;em&gt;&quot;encoding dictionary whose Differences array shall specify the complete character encoding for this font&quot;&lt;/em&gt; (ISO 32000-1 Table 112), so no need for the optional base encoding entry in the encoding dictionary.&lt;/p&gt;

&lt;p&gt;Thus, such a font may neither have a built-in encoding nor a base encoding entry in the encoding dictionary. And for symbols not usually found in font programs, a symbolic Type 3 font is the obvious choice.&lt;/p&gt;</comment>
                            <comment id="15363944" author="mkl" created="Wed, 6 Jul 2016 08:03:30 +0000"  >&lt;blockquote&gt;
&lt;p&gt;but not with the second: at that time, it isn&apos;t known whether rendering or text extraction is being done.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;... and that means that PDFBox has to insist on every PDF it opens to bring along the information required for all possible tasks?&lt;/p&gt;

&lt;p&gt;I would prefer it if missing information only cause a disruption like an exception in circumstances in which the information are required.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;keep null for baseencoding&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Cf. my reply to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt;, one should consider setting it to an empty encoding instead of &lt;tt&gt;null&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15364549" author="tilman" created="Wed, 6 Jul 2016 16:21:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;-XXX.pdf brings &quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot;. However the font has a built-in encoding, namely: &quot;XXXExpertEncoding&quot;. And Adobe can display the file.&lt;/p&gt;</comment>
                            <comment id="15364557" author="tilman" created="Wed, 6 Jul 2016 16:24:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;-YYY.pdf is displayed correctly. In that file, the font has no encoding, but no exception is coming.&lt;/p&gt;</comment>
                            <comment id="15364609" author="msahyoun" created="Wed, 6 Jul 2016 16:48:34 +0000"  >&lt;p&gt;I&apos;d support that statement&lt;/p&gt;

&lt;blockquote&gt;

&lt;p&gt;I would prefer it if missing information only cause a disruption like an exception in circumstances in which the information are required.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;E.g. do we/shall we  do the check if we merge PDFs? Fill form fields where such resource is not needed? ... If we go down that route that we check for consistency and otherwise throw an exception we should do it everywhere - which I don&apos;t consider to be a good idea.&lt;/p&gt;</comment>
                            <comment id="15364740" author="jira-bot" created="Wed, 6 Jul 2016 17:52:30 +0000"  >&lt;p&gt;Commit 1751717 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1751717&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1751717&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;: Sonar fixes&lt;/p&gt;</comment>
                            <comment id="15364742" author="jira-bot" created="Wed, 6 Jul 2016 17:52:46 +0000"  >&lt;p&gt;Commit 1751718 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1751718&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1751718&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;: Sonar fixes&lt;/p&gt;</comment>
                            <comment id="15367198" author="jahewson" created="Fri, 8 Jul 2016 04:06:19 +0000"  >&lt;p&gt;Looks like a good resolution.&lt;/p&gt;</comment>
                            <comment id="15367217" author="jahewson" created="Fri, 8 Jul 2016 04:48:40 +0000"  >&lt;p&gt;Just to add a little more background here, the DictionaryEncoding class in PDFBox is PDFBox&apos;s internal representation of what a dictionary encoding logically is, not a direct analog of the data in the PDF. To simplify what is an extremely complex process we have some distinct separations of concerns surrounding encodings so that the consumers of these classes don&apos;t have to handle the many possible failure cases (as pretty much any piece of data in a PDF file can be missing, incorrect, or in need of repair). This prevents the consumers from becoming error-handling spaghetti. So that&apos;s why it&apos;s PDType1Font&apos;s job to construct a valid DictionaryEncoding, not DictionaryEncoding&apos;s job to handle bad data. We fix bad data at the point it is encountered, we don&apos;t propagate it.&lt;/p&gt;

&lt;p&gt;Type3 fonts are handled by a separate mechanism, there is a single-argument DictionaryEncoding &lt;br/&gt;
constructor specifically for these.&lt;/p&gt;

&lt;p&gt;Note that with the exception of Type 3 fonts, there&apos;s no such thing as a `null` built-in encoding, it&apos;s not possible - every font file has an encoding - that&apos;s the invariant that was being violated here.&lt;/p&gt;</comment>
                            <comment id="15367232" author="jahewson" created="Fri, 8 Jul 2016 05:10:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;I would prefer it if missing information only cause a disruption like an exception in circumstances in which the information are required.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;For the most part, that&apos;s what we do. Most errors are silently repaired by PDFBox, or the problem content is simply skipped. There are some cases where we can&apos;t proceed and will throw an IOException, though these are rare. In this particular case it&apos;s a moot point, the exception was an unchecked exception being thrown because of a bug in PDFBox - that particular exception is just a sanity check to make sure that we&apos;ve called our own API correctly, which we hadn&apos;t because MacExpertEncoding hadn&apos;t been implemented.&lt;/p&gt;</comment>
                            <comment id="15367236" author="jahewson" created="Fri, 8 Jul 2016 05:16:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;Furthermore, if used in text extraction contexts only, a proper ToUnicode map would suffice, no need to know the encoding.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This is not the case. Text extraction has to reassemble the lines of text and uses the widths of the characters to do this, which requires using the Encoding. Also ToUnicode maps in simple fonts are pretty rare, they are found more often in Type 0 fonts.&lt;/p&gt;</comment>
                            <comment id="15367241" author="jahewson" created="Fri, 8 Jul 2016 05:24:51 +0000"  >&lt;p&gt;We don&apos;t check consistency. This was a runtime exception due to an invalid API call. That particular API does a sanity check on its arguments, because our code must normalise those arguments. In this case that normalisation was not happening because we had neglected to implement MacExpertEncoding. Note that without the normalisation occurring all bets are off and PDFBox would proceed in an invalid manner most likely concluding with a NullPointerException somewhere downstream.&lt;/p&gt;</comment>
                            <comment id="15367245" author="tilman" created="Fri, 8 Jul 2016 05:31:02 +0000"  >&lt;p&gt;It&apos;s not really moot, as the exception does happen with &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;-XXX.pdf.&lt;/p&gt;</comment>
                            <comment id="15367595" author="mkl" created="Fri, 8 Jul 2016 12:24:28 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Text extraction has to reassemble the lines of text and uses the widths of the characters to do this&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Are you sure?&lt;/p&gt;

&lt;p&gt;As far as I can see it does not look up the widths by characters but by glyph code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;org.apache.pdfbox.contentstream.PDFStreamEngine.showText(byte[])&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-comment&quot;&gt;// decode a character
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; before = in.available();
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; code = font.readCode(in);
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; codeLength = before - in.available();
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; unicode = font.toUnicode(code);
...
            &lt;span class=&quot;code-comment&quot;&gt;// get glyph&apos;s horizontal and vertical displacements, in text space
&lt;/span&gt;            Vector w = font.getDisplacement(code);
...
            showGlyph(textRenderingMatrix, font, code, unicode, w);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;org.apache.pdfbox.text.PDFTextStreamEngine.showGlyph(Matrix, PDFont, int, String, Vector)&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void showGlyph(Matrix textRenderingMatrix, PDFont font, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; code, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; unicode,
                             Vector displacement) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
...
        &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; displacementX = displacement.getX();
        &lt;span class=&quot;code-comment&quot;&gt;// the sorting algorithm is based on the width of the character. As the displacement
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; vertical characters doesn&apos;t provide any suitable value &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; it, we have to 
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// calculate our own
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (font.isVertical())
        {
            displacementX = font.getWidth(code) / 1000;
...
        }
        &lt;span class=&quot;code-comment&quot;&gt;// (modified) combined displacement, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is calculated *without* taking the character
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// spacing and word spacing into account, due to legacy code in TextStripper
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; tx = displacementX * fontSize * horizontalScaling;
        &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; ty = displacement.getY() * fontSize;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I have to admit, though, that the code is spread across many classes, probably I overlooked something...&lt;/p&gt;</comment>
                            <comment id="15367610" author="mkl" created="Fri, 8 Jul 2016 12:36:19 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Just to add a little more background here, the DictionaryEncoding class in PDFBox is PDFBox&apos;s internal representation of what a dictionary encoding logically is, not a direct analog of the data in the PDF.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Couldn&apos;t in that case an &lt;em&gt;empty encoding&lt;/em&gt; serve the extra needs?&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Type3 fonts are handled by a separate mechanism, there is a single-argument DictionaryEncoding constructor specifically for these.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ah, indeed. I was misled by the JavaDocs of the three-argument constructor which also mentions &lt;em&gt;Type 3 fonts.&lt;/em&gt;.&lt;/p&gt;</comment>
                            <comment id="15367867" author="jahewson" created="Fri, 8 Jul 2016 15:53:37 +0000"  >&lt;p&gt;Ah, ok I missed that. That was the hypothetical case I mentioned - so now we have an actual PDF.  The point is still moot though - you&apos;ve just uncovered another case where we&apos;ve failed to normalise the inputs, which we need to fix.&lt;/p&gt;</comment>
                            <comment id="15367894" author="jahewson" created="Fri, 8 Jul 2016 16:10:17 +0000"  >&lt;p&gt;Yes, I wrote that code &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Again font.getWidth is our internal, normalised representation of things. For example for a non-embedded TrueTypeFont font.getWidth will map the code to a GID (by first mapping it to a character via the PDF Font&apos;s Encoding and then to a GID via the substituted font&apos;s cmap table) in the substitute font and use that to lookup its width in the hmtx table. See codeToGID in in PDTrueTypeFont as called from PDTrueTypeFont .getWidthFromFont.&lt;/p&gt;</comment>
                            <comment id="15367949" author="jira-bot" created="Fri, 8 Jul 2016 16:41:06 +0000"  >&lt;p&gt;Commit 1751942 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1751942&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1751942&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;: Handle invalid BaseEncoding names&lt;/p&gt;</comment>
                            <comment id="15367968" author="jira-bot" created="Fri, 8 Jul 2016 16:54:02 +0000"  >&lt;p&gt;Commit 1751943 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1751943&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1751943&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;: Ignore invalid BaseEncoding names&lt;/p&gt;</comment>
                            <comment id="15367969" author="jahewson" created="Fri, 8 Jul 2016 16:54:28 +0000"  >&lt;p&gt;Ignore this - I got it wrong the first time.&lt;/p&gt;</comment>
                            <comment id="15367979" author="jahewson" created="Fri, 8 Jul 2016 16:56:41 +0000"  >&lt;p&gt;This is my fix for the &lt;tt&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;-XXX.pdf&lt;/tt&gt; case. Instead of just checking for the presence of BaseEncoding, we now also check that the name is valid. If not, then we treat it as missing and proceed to use the font&apos;s built-in encoding instead. Note that we maintain our invariant: built-in encoding is never null &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15367994" author="jahewson" created="Fri, 8 Jul 2016 17:06:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;Couldn&apos;t in that case an empty encoding serve the extra needs?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No because we&apos;re talking about a font&apos;s built-in encoding which can never be null, or empty, or missing. It must be there. If it&apos;s somehow not then PDFBox would substitute a valid font file in its place. So at this point in the code, the built-in encoding must be &lt;b&gt;something&lt;/b&gt;. Also, for symbolic fonts without a valid BaseEncoding, this is the encoding which we&apos;re going to actually use to read from that font - so empty is not a useful value, as it means we can&apos;t decode any of that font&apos;s text.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Ah, indeed. I was misled by the JavaDocs of the three-argument constructor which also mentions Type 3 fonts.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes we do overload the constructors, so Type 3 code does eventually call this, but it&apos;s handled as a special case, as the rules that apply to Type 3 fonts are much simpler (e.g they don&apos;t have built-in encodings, and that&apos;s ok, but it&apos;s not ok for all other font types).&lt;/p&gt;</comment>
                            <comment id="15368161" author="tilman" created="Fri, 8 Jul 2016 18:40:46 +0000"  >&lt;p&gt;works fine. Why didn&apos;t you commit to the trunk?&lt;/p&gt;</comment>
                            <comment id="15410935" author="jira-bot" created="Sun, 7 Aug 2016 12:29:24 +0000"  >&lt;p&gt;Commit 1755438 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1755438&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1755438&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3403&quot; title=&quot;IllegalArgumentException: Symbolic fonts must have a built-in encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3403&quot;&gt;&lt;del&gt;PDFBOX-3403&lt;/del&gt;&lt;/a&gt;: Handle invalid BaseEncoding names + Ignore invalid BaseEncoding names, as done by John Hewson in 2.0&lt;/p&gt;</comment>
                            <comment id="15410938" author="tilman" created="Sun, 7 Aug 2016 13:02:10 +0000"  >&lt;p&gt;Setting to resolved as this was fixed a month ago.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13609639">PDFBOX-5963</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12816450" name="PDFBOX-3403-XXX.pdf" size="101227" author="tilman" created="Wed, 6 Jul 2016 16:21:09 +0000"/>
                            <attachment id="12816451" name="PDFBOX-3403-YYY.pdf" size="101227" author="tilman" created="Wed, 6 Jul 2016 16:24:32 +0000"/>
                            <attachment id="12814036" name="PDFBOX-3403.pdf" size="101227" author="tilman" created="Tue, 28 Jun 2016 06:14:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i308kf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>