<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:03:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2984] PDFTextStripper adds extra word/line delimiters when PDF page orientation is 180 degrees</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2984</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The PDFTextStripper adds word delimiters between each character and new-line after each word when page orientation is 180 degrees. &lt;/p&gt;

&lt;p&gt;This happens because the PDFStreamEngine uses the raw scaling factor Matrix.getXScale() from the transformation Matrix to scale width/font-size which are used to calculate spacing between characters.&lt;/p&gt;

&lt;p&gt;=========================================================&lt;br/&gt;
Output of the PDFTextStripper.getText(pdDoc);&lt;/p&gt;

&lt;p&gt;T h i s  i s  &lt;br/&gt;
a  t e s t  1  ! ! !&lt;br/&gt;
T h i s  &lt;br/&gt;
i s  &lt;br/&gt;
a  t e s t  &lt;br/&gt;
2  &lt;br/&gt;
! ! !&lt;br/&gt;
T h i s  i s  &lt;br/&gt;
a  &lt;br/&gt;
t e s t  3  &lt;br/&gt;
! ! !&lt;br/&gt;
T h i s  i s  &lt;br/&gt;
a  t e s t  4 ! ! !&lt;/p&gt;

&lt;p&gt;=========================================================&lt;br/&gt;
Example: The following will result in negative spaceWidthDisp  / font-size in PDFTextStripper&lt;/p&gt;

&lt;p&gt;180 degrees = &lt;span class=&quot;error&quot;&gt;&amp;#91;-1, 0, 0; 0, -1, 0, w, h, 1&amp;#93;&lt;/span&gt;; therefore the textMatrix.getXScale() == -1&lt;/p&gt;

&lt;p&gt;float spaceWidthDisp = spaceWidthText * fontSizeText * horizontalScalingText * textMatrix.getXScale() * ctm.getXScale()&lt;/p&gt;

&lt;p&gt;fontSizeText * textMatrix.getXScale()&lt;/p&gt;
</description>
                <environment>Windows/Linux, JDK 1.7</environment>
        <key id="12895300">PDFBOX-2984</key>
            <summary>PDFTextStripper adds extra word/line delimiters when PDF page orientation is 180 degrees</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="dtd0">dariusz dusberger</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Sep 2015 01:19:43 +0000</created>
                <updated>Sat, 25 Mar 2017 18:12:26 +0000</updated>
                            <resolved>Sat, 27 Aug 2016 15:04:36 +0000</resolved>
                                    <version>1.8.10</version>
                    <version>1.8.11</version>
                    <version>2.0.0</version>
                    <version>2.0.2</version>
                    <version>2.0.3</version>
                    <version>3.0.0 PDFBox</version>
                                    <fixVersion>2.0.3</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Text extraction</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14901731" author="dtd0" created="Tue, 22 Sep 2015 01:22:48 +0000"  >&lt;p&gt;PDF example that causes the problem. The file was generated using OCR enabled scanner.&lt;/p&gt;</comment>
                            <comment id="14903402" author="dtd0" created="Tue, 22 Sep 2015 20:45:48 +0000"  >&lt;p&gt;Updated PDFStreamEngine.java which contains a workaround/fix for the problem. Uses Math.abs( ... ) when using getXScale/getYScale in the calculation.&lt;/p&gt;</comment>
                            <comment id="14965425" author="tilman" created="Tue, 20 Oct 2015 17:26:24 +0000"  >&lt;p&gt;I&apos;ve attached a diff to the revision you were working with. This isn&apos;t a real diff as required by us, but it shows your changes, which were more than just the one you described.&lt;/p&gt;

&lt;p&gt;Your change is probably going in the right direction, but what if the negative number is in the ctm and not in the text matrix? And would the change have an influence on RTL texts?&lt;/p&gt;

&lt;p&gt;So I&apos;m not doing anything now, but I have added your file to my test set. We&apos;ll probably have a closer look at the text extraction issues after releasing 2.0.&lt;/p&gt;</comment>
                            <comment id="15441447" author="tilman" created="Sat, 27 Aug 2016 12:50:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2984&quot; title=&quot;PDFTextStripper adds extra word/line delimiters when PDF page orientation is 180 degrees&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2984&quot;&gt;&lt;del&gt;PDFBOX-2984&lt;/del&gt;&lt;/a&gt;-039354-180&#176;.pdf and &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2984&quot; title=&quot;PDFTextStripper adds extra word/line delimiters when PDF page orientation is 180 degrees&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2984&quot;&gt;&lt;del&gt;PDFBOX-2984&lt;/del&gt;&lt;/a&gt;-072206-180&#176;.pdf are real world files from the GovDocs site. &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2984&quot; title=&quot;PDFTextStripper adds extra word/line delimiters when PDF page orientation is 180 degrees&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2984&quot;&gt;&lt;del&gt;PDFBOX-2984&lt;/del&gt;&lt;/a&gt;-180&#176;.pdf I created myself with this code, to confirm or refute my fear (&quot;but what if the negative number is in the ctm and not in the text matrix&quot;) from a year ago.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDDocument document = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDDocument())
        {
            PDPage page = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPage(PDRectangle.A4);
            page.setRotation(180);
            document.addPage(page);

            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDPageContentStream cs = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPageContentStream(document, page))
            {
                cs.beginText();
                cs.setLeading(50);
                cs.setFont(PDType1Font.HELVETICA, 50);
                cs.setTextMatrix(Matrix.getRotateInstance(&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.toRadians(180), 500, 100));
                cs.showText(&lt;span class=&quot;code-quote&quot;&gt;&quot;Apache PDFBox &#174;&quot;&lt;/span&gt;);
                cs.setFont(PDType1Font.HELVETICA, 12);
                cs.newLine();
                cs.showText(&lt;span class=&quot;code-quote&quot;&gt;&quot;180&#176; text matrix&quot;&lt;/span&gt;);
                cs.endText();
            }

            page = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPage(PDRectangle.A4);
            page.setRotation(180);
            document.addPage(page);

            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDPageContentStream cs = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPageContentStream(document, page))
            {
                cs.transform(Matrix.getRotateInstance(&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.toRadians(180), 500, 100));
                cs.beginText();
                cs.setLeading(50);
                cs.setFont(PDType1Font.HELVETICA, 50);
                cs.showText(&lt;span class=&quot;code-quote&quot;&gt;&quot;Apache PDFBox &#174;&quot;&lt;/span&gt;);
                cs.setFont(PDType1Font.HELVETICA, 12);
                cs.newLine();
                cs.showText(&lt;span class=&quot;code-quote&quot;&gt;&quot;180&#176; ctm&quot;&lt;/span&gt;);
                cs.endText();
            }

            document.save(&lt;span class=&quot;code-quote&quot;&gt;&quot;PDFBOX-2984-180&#176;.pdf&quot;&lt;/span&gt;);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15441528" author="jira-bot" created="Sat, 27 Aug 2016 13:14:39 +0000"  >&lt;p&gt;Commit 1758026 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1758026&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1758026&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2984&quot; title=&quot;PDFTextStripper adds extra word/line delimiters when PDF page orientation is 180 degrees&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2984&quot;&gt;&lt;del&gt;PDFBOX-2984&lt;/del&gt;&lt;/a&gt;: avoid negative height and space width&lt;/p&gt;</comment>
                            <comment id="15441531" author="jira-bot" created="Sat, 27 Aug 2016 13:14:44 +0000"  >&lt;p&gt;Commit 1758027 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1758027&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1758027&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2984&quot; title=&quot;PDFTextStripper adds extra word/line delimiters when PDF page orientation is 180 degrees&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2984&quot;&gt;&lt;del&gt;PDFBOX-2984&lt;/del&gt;&lt;/a&gt;: avoid negative height and space width&lt;/p&gt;</comment>
                            <comment id="15441540" author="jira-bot" created="Sat, 27 Aug 2016 13:22:29 +0000"  >&lt;p&gt;Commit 1758028 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1758028&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1758028&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2984&quot; title=&quot;PDFTextStripper adds extra word/line delimiters when PDF page orientation is 180 degrees&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2984&quot;&gt;&lt;del&gt;PDFBOX-2984&lt;/del&gt;&lt;/a&gt;: add test files&lt;/p&gt;</comment>
                            <comment id="15441544" author="jira-bot" created="Sat, 27 Aug 2016 13:24:47 +0000"  >&lt;p&gt;Commit 1758029 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1758029&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1758029&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2984&quot; title=&quot;PDFTextStripper adds extra word/line delimiters when PDF page orientation is 180 degrees&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2984&quot;&gt;&lt;del&gt;PDFBOX-2984&lt;/del&gt;&lt;/a&gt;: add test files&lt;/p&gt;</comment>
                            <comment id="15441563" author="tilman" created="Sat, 27 Aug 2016 13:39:13 +0000"  >&lt;p&gt;This patch uses two of three of the changes of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dtd0&quot; class=&quot;user-hover&quot; rel=&quot;dtd0&quot;&gt;dtd0&lt;/a&gt;, but in a different way. The last test file refutes my fear (&quot;but what if the negative number is in the ctm and not in the text matrix&quot;). Some arab test files I have keep their previous extraction result. I&apos;m not using the third suggested change because it has no effect. I also added a test for 90&#176; and 270&#176;, which work as well.&lt;/p&gt;</comment>
                            <comment id="15441717" author="jira-bot" created="Sat, 27 Aug 2016 14:52:19 +0000"  >&lt;p&gt;Commit 1758046 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1758046&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1758046&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2984&quot; title=&quot;PDFTextStripper adds extra word/line delimiters when PDF page orientation is 180 degrees&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2984&quot;&gt;&lt;del&gt;PDFBOX-2984&lt;/del&gt;&lt;/a&gt;: add 90&#176; ad 270&#176; to test files&lt;/p&gt;</comment>
                            <comment id="15441720" author="jira-bot" created="Sat, 27 Aug 2016 14:54:11 +0000"  >&lt;p&gt;Commit 1758047 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1758047&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1758047&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2984&quot; title=&quot;PDFTextStripper adds extra word/line delimiters when PDF page orientation is 180 degrees&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2984&quot;&gt;&lt;del&gt;PDFBOX-2984&lt;/del&gt;&lt;/a&gt;: add 90&#176; ad 270&#176; to test files&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12761538" name="1760_001.pdf" size="10175" author="dtd0" created="Tue, 22 Sep 2015 01:22:48 +0000"/>
                            <attachment id="12825846" name="PDFBOX-2984-039354-180&#176;.pdf" size="97808" author="tilman" created="Sat, 27 Aug 2016 12:00:38 +0000"/>
                            <attachment id="12825847" name="PDFBOX-2984-072206-180&#176;.pdf" size="30189" author="tilman" created="Sat, 27 Aug 2016 12:00:38 +0000"/>
                            <attachment id="12825857" name="PDFBOX-2984-180&#176;-bad.txt" size="109" author="tilman" created="Sat, 27 Aug 2016 12:46:48 +0000"/>
                            <attachment id="12825858" name="PDFBOX-2984-180&#176;.pdf" size="1374" author="tilman" created="Sat, 27 Aug 2016 12:46:48 +0000"/>
                            <attachment id="12825874" name="PDFBOX-2984-rotations.pdf" size="3244" author="tilman" created="Sat, 27 Aug 2016 15:50:48 +0000"/>
                            <attachment id="12761725" name="PDFStreamEngine.java" size="24948" author="dtd0" created="Tue, 22 Sep 2015 20:45:48 +0000"/>
                            <attachment id="12767628" name="diff-to-1.8-rev-1594047.txt" size="634" author="tilman" created="Tue, 20 Oct 2015 17:26:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 12 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ldjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>