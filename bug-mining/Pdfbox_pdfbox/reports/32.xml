<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:52:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-725] Text extraction fails due to font problem with Type0, supplement-0 font</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-725</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Text extraction fails. In particular, download and view pg23 or others (1-based) of:&lt;br/&gt;
&lt;a href=&quot;http://www.encana.com/investors/financial/annualreports/2008/pdfs/annual-report-2008.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.encana.com/investors/financial/annualreports/2008/pdfs/annual-report-2008.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;With pdfbox text extraction, last 5 lines of page are displayed as &quot;?&quot;. Other pages in the file have similar problems.&lt;br/&gt;
Text extraction yields multiple &quot;?&quot; because &quot;font.encode(buf,i,2)&quot; returns null.&lt;/p&gt;

&lt;p&gt;The font COSDictionary contains:&lt;br/&gt;
COSName&lt;/p&gt;
{Subtype}=COSName{Type0}&lt;br/&gt;
COSName{DescendantFonts}=COSArray{&lt;span class=&quot;error&quot;&gt;&amp;#91;COSObject{554, 0}&amp;#93;&lt;/span&gt;}&lt;br/&gt;
COSName{BaseFont}=COSName{HelveticaNeueLTStd-Lt-Identity-H}&lt;br/&gt;
COSName{Encoding}=COSName{Identity-H}&lt;br/&gt;
COSName{Type}=COSName{Font}&lt;br/&gt;
&lt;br/&gt;
The &quot;font.descendentFont&quot; has the following COSDictionary items:&lt;br/&gt;
COSName{Subtype}
&lt;p&gt;=COSName&lt;/p&gt;
{CIDFontType0}
&lt;p&gt;COSName&lt;/p&gt;
{FontDescriptor}=COSObject{540, 0}&lt;br/&gt;
COSName{BaseFont}=COSName{ALJOHE+HelveticaNeueLTStd-Lt}&lt;br/&gt;
COSName{W}=...&lt;br/&gt;
COSName{CIDSystemInfo}=COSDictionary{(COSName{Supplement}:COSInt{0}) (COSName{Ordering}:COSString{Identity},(COSName{Registry}:COSString{Adobe}) }&lt;br/&gt;
COSName{DW}=COSInt{1000}&lt;br/&gt;
COSName{Type}=COSName{Font}&lt;br/&gt;
&lt;br/&gt;
The &quot;fontDescriptor&quot; of the descendentFont is:&lt;br/&gt;
{COSName{StemV}=COSInt{58}, &lt;br/&gt;
COSName{FontName}=COSName{ALJOHE+HelveticaNeueLTStd-Lt}, &lt;br/&gt;
COSName{FontFile3}=COSObject{543, 0}, &lt;br/&gt;
COSName{CIDSet}=COSObject{545, 0}, &lt;br/&gt;
COSName{Flags}=COSInt{6}, &lt;br/&gt;
COSName{Descent}=COSInt{-271}, &lt;br/&gt;
COSName{FontBBox}=COSArray{&lt;span class=&quot;error&quot;&gt;&amp;#91;COSInt{-166}, COSInt{-214}, COSInt{1050}, COSInt{967}&amp;#93;&lt;/span&gt;}, COSName{Ascent}=COSInt{752}, &lt;br/&gt;
COSName{CapHeight}=COSInt{737}, &lt;br/&gt;
COSName{XHeight}=COSInt{553}, &lt;br/&gt;
COSName{Type}=COSName{FontDescriptor}
&lt;p&gt;, &lt;br/&gt;
COSName&lt;/p&gt;
{ItalicAngle}
&lt;p&gt;=COSInt&lt;/p&gt;
{0}
&lt;p&gt;, &lt;br/&gt;
COSName&lt;/p&gt;
{StemH}
&lt;p&gt;=COSInt{45}}&lt;/p&gt;

&lt;p&gt;The last 5 lines on the page are:&lt;br/&gt;
&quot;Increased Cash Flow by 11 percent to $9,386 million;&quot;&lt;br/&gt;
&quot;Increased Operating Earnings by ...&quot;&lt;br/&gt;
etc&lt;/p&gt;

&lt;p&gt;These 5 lines are encoded as 2 bytes per character (it is a type0 font)&lt;br/&gt;
Each 2 byte code is offset by 31 from its displayed value.&lt;br/&gt;
For instance, code &quot;0x00, 0x01&quot; should convert to ascii &quot;0x0020&quot; (a space).&lt;br/&gt;
The font is an &quot;Identity&quot; font, which means codes should just map to latin ISO chars.&lt;br/&gt;
Yeah, this is a Type0 font which can display a subset of another font (the latin ISO), &lt;br/&gt;
but how come codes differ from the ascii by +31?&lt;br/&gt;
This same 31 offset is found on all other pages of the file using this font.&lt;/p&gt;

&lt;p&gt;The font descriptor for the descendentFont has &quot;Flags=6&quot;. Bit 3 is &quot;Symbolic&quot;.&lt;br/&gt;
PDF Spec 5.7.1 &quot;Font contains glyphs outside the Adobe standard Latin character set.&quot;&lt;br/&gt;
Maybe because the Font is &quot;Symbolic&quot; there is not a 1:1 map from codes to ascii.&lt;/p&gt;

&lt;p&gt;The question is whether the PDF file specifies the +31 offset, and pdfbox fails to properly account for this offset.. I can&apos;t find any reference to such an offset in the PDF spec. The &apos;getFirstChar()&apos; in the descendentFont is -1, but the real value is&quot;32&quot;. Maybe this +31 offset just equals &apos;firstChar-1&apos;?&lt;/p&gt;

&lt;p&gt;The real firstChar can be found via:&lt;br/&gt;
  COSDictionary fontDict = (COSDictionary)font.getCOSObject();&lt;br/&gt;
  COSArray descendantFontArray = (COSArray)fontDict.getDictionaryObject(COSName.DESCENDANT_FONTS);&lt;br/&gt;
  if (descendantFontArray != null)  &lt;/p&gt;
{
    COSDictionary descendantFontDictionary = (COSDictionary)descendantFontArray.getObject(0);
    PDFont descendentFont = PDFontFactory.createFont(descendantFontDictionary);
    Encoding encoding = descendentFont.getEncoding();
    Iterator keyIterator = codeMap.keySet().iterator();
    int firstChar=Integer.MAX_VALUE;
    while (keyIterator.hasNext()) firstChar = Math.min(firstChar,((Integer)keyIterator.next()).intValue());
  }

&lt;p&gt;Other example on page 3 of the document:&lt;br/&gt;
Text  &quot;Portfolio of ....&quot; displays in Acrobat Reader, but the byte[] contains:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;0, 49, 0, 80, 0, 83, 0, 85, 0, 71, 0, 80, 0, 77, 0, 74, 0, 80, 0, 1, 0, 80, 0, 71, 0, 1, 0, 70, 0, 84, 0, 85, 0, 66, 0, 67, 0, 77, 0, 74, 0, 84, 0, 73, 0, 70, 0, 69, 0, 1, 0, 83&amp;#93;&lt;/span&gt;&lt;br/&gt;
Again, if +31 is added to each of these 2-byte codes then the Ascii is found. &lt;/p&gt;

&lt;p&gt;Where does this &quot;+31&quot; come from?  Acrobat reader gets it right.  How about pdfbox?&lt;/p&gt;</description>
                <environment>Fedora 11 or windows</environment>
        <key id="12464179">PDFBOX-725</key>
            <summary>Text extraction fails due to font problem with Type0, supplement-0 font</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="petercostello">Peter Costello</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 May 2010 20:47:46 +0000</created>
                <updated>Thu, 17 Mar 2016 19:08:28 +0000</updated>
                            <resolved>Sat, 2 Nov 2013 15:45:40 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Text extraction</component>
                        <due></due>
                            <votes>4</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12877620" author="petercostello" created="Thu, 10 Jun 2010 23:09:42 +0000"  >&lt;p&gt;Page 23 from Encana annual-report-2008.pdf&lt;/p&gt;

&lt;p&gt;There are other pages with comparable problems, and these problems are undoubtably related to similar problems with Chinese/Japanese/Korean Type0 fonts.&lt;/p&gt;</comment>
                            <comment id="12880920" author="petercostello" created="Mon, 21 Jun 2010 18:03:50 +0000"  >&lt;p&gt;I updated to latest repository and there was no fix to the issue reported in&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-725&quot; title=&quot;Text extraction fails due to font problem with Type0, supplement-0 font&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-725&quot;&gt;&lt;del&gt;PDFBOX-725&lt;/del&gt;&lt;/a&gt;.  I compared code and your updates from v955005 and v955007 were&lt;br/&gt;
there.  Your updates were to PDType1CFont.java.  Most of text in the problem&lt;br/&gt;
PDF is PDType1C, but the font with difficulties is at the end of the page&lt;br/&gt;
and is a PDType0Font and it&apos;s descendentFont is PDCIDFontType0Font.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Peter Costello&lt;/li&gt;
&lt;/ul&gt;


</comment>
                            <comment id="12882080" author="lehmi" created="Thu, 24 Jun 2010 07:41:26 +0000"  >&lt;p&gt;My updates are related to the issue but they didn&apos;t solved it. I&apos;m still investigating. The problem is the CID-encoding.&lt;/p&gt;</comment>
                            <comment id="13812032" author="lehmi" created="Sat, 2 Nov 2013 15:45:40 +0000"  >&lt;p&gt;The rendering works fine with the current trunk. &lt;br/&gt;
The text extraction works as expected. The PDFBox result is similar to those produced by the acrobat reader. As some of the used fonts doesn&apos;t provide a mapping to readable characters some parts of the extracted text are unreadable.&lt;/p&gt;

&lt;p&gt;Thanks for the report!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12446808" name="annual-report-2008_pg23.pdf" size="320946" author="petercostello" created="Thu, 10 Jun 2010 23:09:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>85040</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 3 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14uv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>236465</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>