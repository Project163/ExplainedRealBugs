<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:59:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2665] PDType1Font (HELVETICA) encode getting NullPointerException</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2665</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I have been trying to revert to previous pdfbox-2.0.0 versions, which is why the error is from a previous build, but this is applicable to the latest (2.0.0-20150204.015951-1042) too.&lt;/p&gt;

&lt;p&gt;I am getting this error, which I was not getting a month ago.&lt;/p&gt;

&lt;p&gt;Regards...&lt;/p&gt;


&lt;p&gt;Error: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.font.PDType1Font.encode(PDType1Font.java:309) &lt;span class=&quot;error&quot;&gt;&amp;#91;pdfbox-2.0.0-20150129.080600-1013.jar:2.0.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.font.PDFont.encode(PDFont.java:267) &lt;span class=&quot;error&quot;&gt;&amp;#91;pdfbox-2.0.0-20150129.080600-1013.jar:2.0.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.PDPageContentStream.showText(PDPageContentStream.java:316) &lt;span class=&quot;error&quot;&gt;&amp;#91;pdfbox-2.0.0-20150129.080600-1013.jar:2.0.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;/p&gt;</description>
                <environment>Win 7, JDK 7, JBoss AS 7</environment>
        <key id="12772381">PDFBOX-2665</key>
            <summary>PDType1Font (HELVETICA) encode getting NullPointerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jahewson">John Hewson</assignee>
                                    <reporter username="djbza">Daniel Brownell</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Feb 2015 14:53:15 +0000</created>
                <updated>Thu, 17 Mar 2016 19:08:01 +0000</updated>
                            <resolved>Fri, 6 Feb 2015 00:44:24 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14306631" author="jahewson" created="Thu, 5 Feb 2015 04:49:32 +0000"  >&lt;p&gt;What did you do to get this error? Please post code.&lt;/p&gt;</comment>
                            <comment id="14306864" author="djbza" created="Thu, 5 Feb 2015 08:50:29 +0000"  >&lt;p&gt;Here&apos;s the error from the latest one:&lt;/p&gt;

&lt;p&gt;Error: java.lang.NullPointerException&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.font.PDType1Font.encode(PDType1Font.java:309) &lt;span class=&quot;error&quot;&gt;&amp;#91;pdfbox-2.0.0-20150204.015951-1042.jar:2.0.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.font.PDFont.encode(PDFont.java:268) &lt;span class=&quot;error&quot;&gt;&amp;#91;pdfbox-2.0.0-20150204.015951-1042.jar:2.0.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.font.PDFont.getStringWidth(PDFont.java:297) &lt;span class=&quot;error&quot;&gt;&amp;#91;pdfbox-2.0.0-20150204.015951-1042.jar:2.0.0-SNAPSHOT&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Here is the line it happens on:&lt;/p&gt;

&lt;p&gt;float width = font.getStringWidth(text.substring(start,i)) / 1000 * (fontSize);&lt;/p&gt;

&lt;p&gt;where I define:&lt;br/&gt;
protected PDType1Font font = PDType1Font.TIMES_ROMAN;&lt;/p&gt;
</comment>
                            <comment id="14306950" author="djbza" created="Thu, 5 Feb 2015 10:13:25 +0000"  >&lt;p&gt;getInvertedEncoding() is apparently returning null.  I&apos;ll try attach the source and step through.&lt;/p&gt;</comment>
                            <comment id="14306965" author="djbza" created="Thu, 5 Feb 2015 10:27:36 +0000"  >&lt;p&gt;It appears that when it tries to draw my String, MEMO\t&lt;br/&gt;
It goes through M,E,M,O, then it looks for &quot;controlHT&quot; in the HashMap, called &#237;nverted, and dies on  int code = inverted.get(name); because it can&apos;t cast the null to an int.&lt;/p&gt;</comment>
                            <comment id="14307038" author="djbza" created="Thu, 5 Feb 2015 10:50:47 +0000"  >&lt;p&gt;The actual problem is probably that it&apos;s looking in  &lt;br/&gt;
Map&amp;lt;Integer, String&amp;gt; codeToName = MacOSRomanEncoding.INSTANCE.getCodeToNameMap(); &lt;br/&gt;
which doesn&apos;t have that &apos;controlHT&apos; character.  Why Is it looking in a MacOS encoding, when I&apos;m on Windows?&lt;/p&gt;</comment>
                            <comment id="14308334" author="jahewson" created="Fri, 6 Feb 2015 00:26:22 +0000"  >&lt;p&gt;Ok, I can reproduce the NPE when using the \t character.&lt;/p&gt;</comment>
                            <comment id="14308351" author="jahewson" created="Fri, 6 Feb 2015 00:39:54 +0000"  >&lt;p&gt;Font encodings are font-specific, rather than platform-specific, so the fact that you&apos;re on Windows doesn&apos;t matter. However, you&apos;ve still found a bug, as that line should be using the current font&apos;s encoding instead of hardcoding MacOSRoman.&lt;/p&gt;

&lt;p&gt;I&apos;ll fix this, however it doesn&apos;t actually solve the NPE.&lt;/p&gt;</comment>
                            <comment id="14308353" author="jira-bot" created="Fri, 6 Feb 2015 00:40:46 +0000"  >&lt;p&gt;Commit 1657727 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1657727&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1657727&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2665&quot; title=&quot;PDType1Font (HELVETICA) encode getting NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2665&quot;&gt;&lt;del&gt;PDFBOX-2665&lt;/del&gt;&lt;/a&gt;: Type 1 font invert needs to use the current encoding, not MacOSRoman&lt;/p&gt;</comment>
                            <comment id="14308356" author="jira-bot" created="Fri, 6 Feb 2015 00:43:04 +0000"  >&lt;p&gt;Commit 1657728 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1657728&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1657728&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2665&quot; title=&quot;PDType1Font (HELVETICA) encode getting NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2665&quot;&gt;&lt;del&gt;PDFBOX-2665&lt;/del&gt;&lt;/a&gt;: Check that Type 1 glyphs are present in the font when embedding&lt;/p&gt;</comment>
                            <comment id="14308357" author="jahewson" created="Fri, 6 Feb 2015 00:44:02 +0000"  >&lt;p&gt;This fixes the NPE, however you still get an IllegalArgumentException because Helvetica does not contain a glyph for \t.&lt;/p&gt;</comment>
                            <comment id="14309274" author="djbza" created="Fri, 6 Feb 2015 15:08:51 +0000"  >&lt;p&gt;Do you know of a font that has a tab glyph?  &lt;/p&gt;</comment>
                            <comment id="14309793" author="jahewson" created="Fri, 6 Feb 2015 20:11:52 +0000"  >&lt;p&gt;I don&apos;t know, I don&apos;t really use Type 1 fonts. Are you wanting a tab glyph with a certain width or would a space do?&lt;/p&gt;</comment>
                            <comment id="14310718" author="djbza" created="Sat, 7 Feb 2015 13:52:10 +0000"  >&lt;p&gt;Ack, JIRA keeps deleting my replies.  I am copy pasting again.  Sorry if you receive this message a few times:&lt;/p&gt;

&lt;p&gt;I&apos;m just converting the tabs to spaces in code now, but PDFBOX trunk was working, for tabs, last i checked, a few weeks ago.  &lt;/p&gt;

&lt;p&gt;It seems like a real common thing, to draw a String with a tab character, though I understand that a glyph wouldn&apos;t exist for a tab.&lt;/p&gt;

&lt;p&gt;Is this something you might be able to fix, or should I just keep my workaround?&lt;/p&gt;

&lt;p&gt;Alternatively, I just used Type 1 font because that&apos;s what the examples showed.  If you have another snippet of code, to use Helvetica or Arial or something common, that can handle all characters, please post it?&lt;/p&gt;</comment>
                            <comment id="14312120" author="djbza" created="Mon, 9 Feb 2015 11:30:50 +0000"  >&lt;p&gt;&lt;br/&gt;
What I&apos;m saying, is, I don&apos;t think getStringWidth should throw an exception if the string contains a tab&lt;/p&gt;</comment>
                            <comment id="14312678" author="jahewson" created="Mon, 9 Feb 2015 19:16:23 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I&apos;m just converting the tabs to spaces in code now, but PDFBOX trunk was working, for tabs, last i checked, a few weeks ago.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That was a bug, the intended behaviour for missing glyphs is to raise an IllegalArgumentException.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Alternatively, I just used Type 1 font because that&apos;s what the examples showed. If you have another snippet of code, to use Helvetica or Arial or something common, that can handle all characters, please post it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Generally TTF fonts support a broader range of characters, take a look at our EmbeddedFonts example.&lt;/p&gt;</comment>
                            <comment id="14312697" author="jahewson" created="Mon, 9 Feb 2015 19:26:25 +0000"  >&lt;p&gt;The real problem is the encode method, what should that do? getStringWidth simply returns the widths of the glyphs which encode has found in the font. The difficulty is that is a user expects a tab to be a single character, then its is wrong for us to say, replace it with four spaces. What if they want three spaces? What if they&apos;d rather have an error when a missing glyph is used, even if it is a whitespace? Different use cases are going to have different needs and our API has to work at the level of the lowest common denominator. Not to mention all the other kinds of whitespace, newlines, form feeds, non-breaking spaces, zero-width joiners, etc.&lt;/p&gt;

&lt;p&gt;It&apos;s too easy for end-users to generate PDFs with missing glyphs unless PDFBox catches this error and throws an exception. Though perhaps we should throw a checked exception?&lt;/p&gt;</comment>
                            <comment id="14312804" author="djbza" created="Mon, 9 Feb 2015 20:23:55 +0000"  >&lt;p&gt;I&apos;m not too sure what the API should do, but all of the smart ways I&apos;ve seen on Stackoverflow of formatting text use a technique of judging the width of a Font rendered String, by multiplying the getStringWidth() by a factor.&lt;/p&gt;

&lt;p&gt;What I&apos;d ideally like is for Type 1 fonts not to suck as much.  If I have to deal with width estimation, I&apos;ll need a hashmap, to convert my Strings before they reach PDFBox.&lt;/p&gt;

&lt;p&gt;For some reason I couldn&apos;t get \u0000 and \u0096 mapping, perhaps because they&apos;re too crazy for Java. I can&apos;t get a String to print out at all if it has a null character. I will take a look when I get back to work on Wednesday and let you know. It&apos;s some obvious bug but it might be a pdfbox issue yet. &lt;/p&gt;

&lt;p&gt;I think there should be a better way than whatever I&apos;m doing, mapping Strings, and it should be a default implementation option, since I&apos;d think it would be pretty common to deal with special characters and PDF fonts.  Like almost an ability to subclass the PdType1Fonts to add a default to the glyph map, so that I don&apos;t have to deal with exceptions.&lt;/p&gt;
</comment>
                            <comment id="14313181" author="jahewson" created="Mon, 9 Feb 2015 23:47:21 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I&apos;m not too sure what the API should do, but all of the smart ways I&apos;ve seen on Stackoverflow of formatting text use a technique of judging the width of a Font rendered String, by multiplying the getStringWidth() by a factor.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There were bugs in 1.8 which I&apos;ve seen worked-around in this manner. It&apos;s not a meaningful or correct workaround, but it clearly worked well enough for certain users. The underlying bugs have been fixed in 2.0 and all glyph metrics are now accurate.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;What I&apos;d ideally like is for Type 1 fonts not to suck as much. If I have to deal with width estimation, I&apos;ll need a hashmap, to convert my Strings before they reach PDFBox.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Type 1 fonts are old and deprecated, I&apos;d recommend not using them at all. TTF fonts are much more feature-rich. There&apos;s no estimation... we know the exact width of glyphs in any font format.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;For some reason I couldn&apos;t get \u0000 and \u0096 mapping, perhaps because they&apos;re too crazy for Java. I can&apos;t get a String to print out at all if it has a null character. I will take a look when I get back to work on Wednesday and let you know. It&apos;s some obvious bug but it might be a pdfbox issue yet.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Java can handle those characters just fine but it might be a bug in PDFBox, if it looks that way, please do open a new issue for it. I doubt that any Type1 font contains these characters, but you should at least get an exception from PDFBox rather than a silent failure of a bad PDF.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I think there should be a better way than whatever I&apos;m doing, mapping Strings, and it should be a default implementation option, since I&apos;d think it would be pretty common to deal with special characters and PDF fonts.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There&apos;s no reasonable way to map strings: what satisfies one user may thwart another. It&apos; just too subjective to be part of our API. What we could do is add an API so that you can check if a particular Unicode code point is supported by a font, e.g. boolean hasCodePoint(int codePoint). That way you can iterate through the characters in the string and do your own substitution.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt; Like almost an ability to subclass the PdType1Fonts to add a default to the glyph map, so that I don&apos;t have to deal with exceptions.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What are you going to do, map tab to a single space? That won&apos;t really help. No need for a subclass to do this, you can change the Encoding on a PDType1Fonts already, but that&apos;s not recommended.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 40 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i256mn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>