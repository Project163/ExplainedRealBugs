<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:02:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3151] getStringWidth is terribly slow (and resulting document is invalid)</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3151</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I&apos;m maintaining a PDF layout engine that makes heavy use of &quot;getStringWidth&quot;. With PDFBox 2.0.0 this got much slower. So please find attached an example which you can use for profiling purposes. I used &quot;OpenSans&quot; TTF as the basis (grab it at &lt;a href=&quot;https://github.com/google/fonts/tree/master/apache/opensans&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/google/fonts/tree/master/apache/opensans&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Beside it being slow, the created PDF cannot be opened (but this may have something to do with &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2945&quot; title=&quot;PDType1Font.getNameInFont(String) very slow when Unicode fallback is used&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2945&quot;&gt;&lt;del&gt;PDFBOX-2945&lt;/del&gt;&lt;/a&gt; in RC2???)&lt;/p&gt;</description>
                <environment>2.0.0-RC2</environment>
        <key id="12917582">PDFBOX-3151</key>
            <summary>getStringWidth is terribly slow (and resulting document is invalid)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="phax">Philip Helger</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Dec 2015 14:12:56 +0000</created>
                <updated>Thu, 17 Mar 2016 19:07:09 +0000</updated>
                            <resolved>Sun, 13 Dec 2015 12:40:53 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15035847" author="phax" created="Wed, 2 Dec 2015 14:13:41 +0000"  >&lt;p&gt;The InputStream to the OpenSans TTF must be changed and the imports adopted accordingly...&lt;/p&gt;</comment>
                            <comment id="15036193" author="jahewson" created="Wed, 2 Dec 2015 17:27:43 +0000"  >&lt;blockquote&gt;
&lt;p&gt;With PDFBox 2.0.0 this got much slower.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;How much slower?&lt;/p&gt;</comment>
                            <comment id="15036221" author="phax" created="Wed, 2 Dec 2015 17:38:28 +0000"  >&lt;p&gt;Can&apos;t give you exact number, but a test case using font PDType1Font.HELVETICA had the following times:&lt;br/&gt;
1.8.11: 0,9 sec&lt;br/&gt;
2.0.0-RC2: 36,1 sec&lt;/p&gt;

&lt;p&gt;So quite obvious. If you want to profile yourself (as I don&apos;t have one installed on this machine):&lt;br/&gt;
Project:&lt;br/&gt;
&lt;a href=&quot;https://github.com/phax/ph-pdf-layout&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/phax/ph-pdf-layout&lt;/a&gt;&lt;br/&gt;
Test file:&lt;br/&gt;
src\test\java\com\helger\pdflayout\element\PLTextTest.java&lt;br/&gt;
Test:&lt;br/&gt;
testWithTextExceedingPage&lt;/p&gt;</comment>
                            <comment id="15036228" author="phax" created="Wed, 2 Dec 2015 17:41:45 +0000"  >&lt;p&gt;Using the provided test case:&lt;br/&gt;
2.0.0-RC2: 10269ms&lt;br/&gt;
1.8.11: 680ms  (Using PDTrueTypeFont.loadTTF (doc, ClassPathResource.getInputStream (&quot;OpenSans-Regular.ttf&quot;)); to load the font)&lt;/p&gt;</comment>
                            <comment id="15036229" author="jahewson" created="Wed, 2 Dec 2015 17:41:54 +0000"  >&lt;p&gt;Thanks, that saves me having to set up 1.8 and measure it. Huge difference!&lt;/p&gt;</comment>
                            <comment id="15036230" author="jahewson" created="Wed, 2 Dec 2015 17:43:05 +0000"  >&lt;p&gt;Ok, so 15x slower.&lt;/p&gt;</comment>
                            <comment id="15038625" author="phax" created="Thu, 3 Dec 2015 21:28:57 +0000"  >&lt;p&gt;I attached a screenshot showing the profiling results on a different machine using 2.0.0-RC2. hth&lt;/p&gt;</comment>
                            <comment id="15047370" author="jira-bot" created="Tue, 8 Dec 2015 19:56:02 +0000"  >&lt;p&gt;Commit 1718684 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1718684&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1718684&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3151&quot; title=&quot;getStringWidth is terribly slow (and resulting document is invalid)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3151&quot;&gt;&lt;del&gt;PDFBOX-3151&lt;/del&gt;&lt;/a&gt;: use ArrayList instead of LinkedList, don&apos;t revert sort order of cid ranges&lt;/p&gt;</comment>
                            <comment id="15047409" author="lehmi" created="Tue, 8 Dec 2015 20:16:20 +0000"  >&lt;p&gt;With my last change the test runs in half of the time. The old code reverted the sort order of the cid ranges within the CMap so that the needed mappings for the latin characters were at the end of the LinkedList. Therefore my patch &quot;accidentically&quot; speeds up the execution by moving those mappings to the begining.&lt;/p&gt;

&lt;p&gt;I&apos;ve ran some test with an additional cach containing those values but it doesn&apos;t work.&lt;/p&gt;</comment>
                            <comment id="15048252" author="phax" created="Wed, 9 Dec 2015 08:05:22 +0000"  >&lt;p&gt;Thanks, the effective result is 4 times quicker on my machine. I also updated the profiling results in case you are interested.&lt;/p&gt;</comment>
                            <comment id="15048672" author="phax" created="Wed, 9 Dec 2015 13:34:46 +0000"  >&lt;p&gt;Here&apos;s another small patch the replaces some List&amp;lt;Byte&amp;gt; with a byte[] which makes it another approx 10% quicker&lt;/p&gt;</comment>
                            <comment id="15048690" author="phax" created="Wed, 9 Dec 2015 13:49:24 +0000"  >&lt;p&gt;3151-2.patch is a small patch that avoid &quot;containsKey/get&quot; and replaces it with &quot;get/!=null&quot; which spares a map lookup. Makes it even quicker&lt;/p&gt;</comment>
                            <comment id="15054358" author="jira-bot" created="Sat, 12 Dec 2015 15:31:29 +0000"  >&lt;p&gt;Commit 1719701 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1719701&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1719701&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3151&quot; title=&quot;getStringWidth is terribly slow (and resulting document is invalid)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3151&quot;&gt;&lt;del&gt;PDFBOX-3151&lt;/del&gt;&lt;/a&gt;: optimize the Hashmap access based on Philip Helgers proposal, DRY refactoring&lt;/p&gt;</comment>
                            <comment id="15054361" author="lehmi" created="Sat, 12 Dec 2015 15:32:50 +0000"  >&lt;p&gt;I&apos;ve applied some changes based on the second proposal of &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phax&quot; class=&quot;user-hover&quot; rel=&quot;phax&quot;&gt;phax&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15054368" author="jira-bot" created="Sat, 12 Dec 2015 15:45:44 +0000"  >&lt;p&gt;Commit 1719705 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1719705&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1719705&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3151&quot; title=&quot;getStringWidth is terribly slow (and resulting document is invalid)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3151&quot;&gt;&lt;del&gt;PDFBOX-3151&lt;/del&gt;&lt;/a&gt;: replace List&amp;lt;byte&amp;gt; with byte[] as proposed by Philip Helger&lt;/p&gt;</comment>
                            <comment id="15054370" author="lehmi" created="Sat, 12 Dec 2015 15:46:57 +0000"  >&lt;p&gt;I&apos;ve applied the first patch as well&lt;/p&gt;</comment>
                            <comment id="15054415" author="jira-bot" created="Sat, 12 Dec 2015 16:53:47 +0000"  >&lt;p&gt;Commit 1719712 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1719712&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1719712&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3151&quot; title=&quot;getStringWidth is terribly slow (and resulting document is invalid)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3151&quot;&gt;&lt;del&gt;PDFBOX-3151&lt;/del&gt;&lt;/a&gt;: check existing code lengths only&lt;/p&gt;</comment>
                            <comment id="15054417" author="lehmi" created="Sat, 12 Dec 2015 16:55:27 +0000"  >&lt;p&gt;My last commit should speed up the test case by another 10%&lt;/p&gt;</comment>
                            <comment id="15054524" author="phax" created="Sat, 12 Dec 2015 18:32:31 +0000"  >&lt;p&gt;Thanks. Compared to the last version this was really an improvement! The result is now fine for me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15054928" author="jira-bot" created="Sun, 13 Dec 2015 12:03:32 +0000"  >&lt;p&gt;Commit 1719796 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1719796&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1719796&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3151&quot; title=&quot;getStringWidth is terribly slow (and resulting document is invalid)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3151&quot;&gt;&lt;del&gt;PDFBOX-3151&lt;/del&gt;&lt;/a&gt;: reformatting&lt;/p&gt;</comment>
                            <comment id="15054937" author="lehmi" created="Sun, 13 Dec 2015 12:40:53 +0000"  >&lt;p&gt;Set to resolved as we are done here. &lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=phax&quot; class=&quot;user-hover&quot; rel=&quot;phax&quot;&gt;phax&lt;/a&gt; for the report and your input and help.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12776557" name="3151-2.patch" size="697" author="phax" created="Wed, 9 Dec 2015 13:49:24 +0000"/>
                            <attachment id="12776551" name="3151.patch" size="3819" author="phax" created="Wed, 9 Dec 2015 13:34:46 +0000"/>
                            <attachment id="12775281" name="HelloWorldType0.java" size="2553" author="phax" created="Wed, 2 Dec 2015 14:13:41 +0000"/>
                            <attachment id="12776504" name="Profiling after Andreas changes.png" size="75051" author="phax" created="Wed, 9 Dec 2015 08:04:44 +0000"/>
                            <attachment id="12775645" name="Profiling screenshot.png" size="79414" author="phax" created="Thu, 3 Dec 2015 21:28:19 +0000"/>
                            <attachment id="12777300" name="Profiling v3.png" size="74610" author="phax" created="Sat, 12 Dec 2015 18:31:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2p68n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>