<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:02:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3078] Text height coming in at half size, regression from 1.8</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3078</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Running 11/1 Dvlp build.&lt;br/&gt;
PrintTextLocations on attached file has height of 2.9, which is incorrect.&lt;/p&gt;

&lt;p&gt;String&lt;span class=&quot;error&quot;&gt;&amp;#91;30.699997,144.80005 fs=9.0 xscale=9.0 height=2.9236078 space=2.5020003 width=5.0040016&amp;#93;&lt;/span&gt;1&lt;br/&gt;
String&lt;span class=&quot;error&quot;&gt;&amp;#91;35.704,144.80005 fs=9.0 xscale=9.0 height=2.9236078 space=2.5020003 width=5.003998&amp;#93;&lt;/span&gt;2&lt;br/&gt;
String&lt;span class=&quot;error&quot;&gt;&amp;#91;40.707996,144.80005 fs=9.0 xscale=9.0 height=2.9236078 space=2.5020003 width=5.003998&amp;#93;&lt;/span&gt;8&lt;br/&gt;
String&lt;span class=&quot;error&quot;&gt;&amp;#91;45.711994,144.80005 fs=9.0 xscale=9.0 height=2.9236078 space=2.5020003 width=5.003998&amp;#93;&lt;/span&gt;6&lt;br/&gt;
String&lt;span class=&quot;error&quot;&gt;&amp;#91;50.715992,144.80005 fs=9.0 xscale=9.0 height=2.9236078 space=2.5020003 width=5.003998&amp;#93;&lt;/span&gt;2&lt;br/&gt;
String&lt;span class=&quot;error&quot;&gt;&amp;#91;63.79999,144.80005 fs=9.0 xscale=9.0 height=2.9236078 space=2.5020003 width=4.2210045&amp;#93;&lt;/span&gt;^&lt;/p&gt;

&lt;p&gt;Same file, Version 1.8 has height of 6.5, which is about right:&lt;br/&gt;
String&lt;span class=&quot;error&quot;&gt;&amp;#91;30.699997,144.80005 fs=9.0 xscale=9.0 height=6.327 space=2.5020003 width=5.0040016&amp;#93;&lt;/span&gt;1&lt;br/&gt;
String&lt;span class=&quot;error&quot;&gt;&amp;#91;35.704,144.80005 fs=9.0 xscale=9.0 height=6.327 space=2.5020003 width=5.0040016&amp;#93;&lt;/span&gt;2&lt;br/&gt;
String&lt;span class=&quot;error&quot;&gt;&amp;#91;40.708,144.80005 fs=9.0 xscale=9.0 height=6.4980006 space=2.5020003 width=5.0040016&amp;#93;&lt;/span&gt;8&lt;br/&gt;
String&lt;span class=&quot;error&quot;&gt;&amp;#91;45.712,144.80005 fs=9.0 xscale=9.0 height=6.4980006 space=2.5020003 width=5.0040016&amp;#93;&lt;/span&gt;6&lt;br/&gt;
String&lt;span class=&quot;error&quot;&gt;&amp;#91;50.716003,144.80005 fs=9.0 xscale=9.0 height=6.4980006 space=2.5020003 width=5.0040016&amp;#93;&lt;/span&gt;2&lt;br/&gt;
String&lt;span class=&quot;error&quot;&gt;&amp;#91;63.800007,144.80005 fs=9.0 xscale=9.0 height=3.8160002 space=2.5020003 width=4.220997&amp;#93;&lt;/span&gt;^&lt;/p&gt;</description>
                <environment></environment>
        <key id="12909493">PDFBOX-3078</key>
            <summary>Text height coming in at half size, regression from 1.8</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jhirsh">Joel Hirsh</reporter>
                        <labels>
                    </labels>
                <created>Sun, 1 Nov 2015 15:31:18 +0000</created>
                <updated>Thu, 17 Mar 2016 19:42:14 +0000</updated>
                            <resolved>Thu, 5 Nov 2015 19:53:09 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Text extraction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14984469" author="tilman" created="Sun, 1 Nov 2015 17:48:57 +0000"  >&lt;p&gt;In 1.8, the width is taken from AFM info and is 703 * 0,001 * 9 = 6,327&lt;/p&gt;

&lt;p&gt;In 2.0, the width is taken from the actual font (Arial TT). The BBox height is 1324, the half is taken (665) and this is multiplied with the actual font matrix which is 0.000488 i.e. half of 0,001.&lt;/p&gt;

&lt;p&gt;From the spec:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;The glyph coordinate system is the space in which an individual character&#8217;s glyph is defined. All path coordinates and metrics shall be interpreted in glyph space. For all font types except Type 3, the units of glyph space are one-thousandth of a unit of text space; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a Type 3 font, the transformation from glyph space to text space shall be defined by a font matrix specified in an explicit FontMatrix entry in the font
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A quick idea would be to replace in PDFTextStreamEngine&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; height = font.getFontMatrix().transformPoint(0, glyphHeight).y;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;with&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; height;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (font &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; PDType3Font)
        {
            height = font.getFontMatrix().transformPoint(0, glyphHeight).y;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
        {
            height = glyphHeight * 0.001f;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but this brings a difference in the extraction of the file of &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-679&quot; title=&quot;Corruption of Arabic output due to Japanese bug fix&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-679&quot;&gt;&lt;del&gt;PDFBOX-679&lt;/del&gt;&lt;/a&gt;. (Which is not in the official tests, but in mine).&lt;/p&gt;</comment>
                            <comment id="14984470" author="jhirsh" created="Sun, 1 Nov 2015 17:57:06 +0000"  >&lt;p&gt;I put a check in my application to correct for this, and then found such a change affected about a dozen test files (in a  good way).  &lt;/p&gt;

&lt;p&gt;Since those test files were created by very varied sources, it seems as though correcting this would be useful for more than just isolated cases.&lt;/p&gt;</comment>
                            <comment id="14984481" author="tilman" created="Sun, 1 Nov 2015 18:27:47 +0000"  >&lt;p&gt;I forgot to mention that while there&apos;s a difference in text extraction, I can&apos;t tell whether it is better or worse, because the text is in Arabic.&lt;/p&gt;</comment>
                            <comment id="14985546" author="tilman" created="Mon, 2 Nov 2015 17:08:40 +0000"  >&lt;p&gt;My proposed change is definitively not correct for &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-679&quot; title=&quot;Corruption of Arabic output due to Japanese bug fix&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-679&quot;&gt;&lt;del&gt;PDFBOX-679&lt;/del&gt;&lt;/a&gt;, see attached files.&lt;/p&gt;</comment>
                            <comment id="14985958" author="jahewson" created="Mon, 2 Nov 2015 20:24:20 +0000"  >&lt;p&gt;Yes, the bbox of a font is in glyph space, which is 1000x1000 for all font types except for Type 3, for which it is defined by the FontMatrix. But you can&apos;t transform a length by transforming a point, which is what you&apos;re trying to do (e.g. think about rotation).&lt;/p&gt;</comment>
                            <comment id="14985972" author="tilman" created="Mon, 2 Nov 2015 20:31:31 +0000"  >&lt;p&gt;I didn&apos;t do anything there, that code line was already there.&lt;/p&gt;</comment>
                            <comment id="14992186" author="jahewson" created="Thu, 5 Nov 2015 18:28:37 +0000"  >&lt;p&gt;So it was. Either way it&apos;s incorrect.&lt;/p&gt;</comment>
                            <comment id="14992330" author="jahewson" created="Thu, 5 Nov 2015 19:42:58 +0000"  >&lt;p&gt;The problem here is, as Tilman observed, the behaviour regarding whether or not the AFM (or Font dictionary) bbox overrides the FontBBox of the embedded font. It doesn&apos;t but it should be.&lt;/p&gt;</comment>
                            <comment id="14992344" author="jira-bot" created="Thu, 5 Nov 2015 19:52:35 +0000"  >&lt;p&gt;Commit 1712858 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1712858&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1712858&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3078&quot; title=&quot;Text height coming in at half size, regression from 1.8&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3078&quot;&gt;&lt;del&gt;PDFBOX-3078&lt;/del&gt;&lt;/a&gt;: use FontBBox before falling back to embedded bbox&lt;/p&gt;</comment>
                            <comment id="14994343" author="tilman" created="Fri, 6 Nov 2015 20:08:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jhirsh&quot; class=&quot;user-hover&quot; rel=&quot;jhirsh&quot;&gt;jhirsh&lt;/a&gt; please do also have a look at the new DrawPrintTextLocations example. If your application is about marking glyphs, then the blue lines there are for you.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12770119" name="PDFBOX-679-toobig-marked-1-modified.png" size="3529736" author="tilman" created="Mon, 2 Nov 2015 17:08:40 +0000"/>
                            <attachment id="12770120" name="PDFBOX-679-toobig-marked-1-original.png" size="3506738" author="tilman" created="Mon, 2 Nov 2015 17:08:40 +0000"/>
                            <attachment id="12769994" name="wrongsize.pdf" size="70971" author="jhirsh" created="Sun, 1 Nov 2015 15:31:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2nsin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>