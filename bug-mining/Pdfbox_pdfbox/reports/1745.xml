<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:05:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3751] Flattening a pdf with refreshAppearances set to true causes a NullPointerException</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3751</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Flattening a pdf with refreshAppearances set to true causes a NullPointerException.  This is because some fields do not have a NormalAppearance set.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;(PDDocument pdfDocument = PDDocument.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;/Users/travis/Desktop/fdpAttachment2.pdf&quot;&lt;/span&gt;))) {

            pdfDocument.getDocumentCatalog().getAcroForm().flatten(pdfDocument.getDocumentCatalog().getAcroForm().getFields(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;causes:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Exception in thread &quot;main&quot; java.lang.NullPointerException&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.interactive.form.PDButton.updateByValue(PDButton.java:356)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.interactive.form.PDButton.constructAppearances(PDButton.java:285)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.interactive.form.PDAcroForm.refreshAppearances(PDAcroForm.java:348)&lt;br/&gt;
	at org.apache.pdfbox.pdmodel.interactive.form.PDAcroForm.flatten(PDAcroForm.java:223)&lt;br/&gt;
	at org.kuali.coeus.sys.pdf.FlattenException.main(FlattenException.java:13)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The workaround is pretty simple.  Just make sure every widget without a NormalAppearance has one before calling flatten.  I would think pdfbox could do a null check internally when trying to refresh appearance.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        pdfDocument.getDocumentCatalog().getAcroForm().getFields()
                .stream()
                .flatMap(f -&amp;gt; f.getWidgets().stream())
                .filter(w -&amp;gt; w.getAppearance() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
                .forEach(w -&amp;gt; {
                    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; PDAppearanceDictionary appearance = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDAppearanceDictionary(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; COSDictionary());
                    appearance.setNormalAppearance(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDAppearanceEntry(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; COSDictionary()));
                    w.setAppearance(appearance);
                });
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13063472">PDFBOX-3751</key>
            <summary>Flattening a pdf with refreshAppearances set to true causes a NullPointerException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="msahyoun">Maruan Sahyoun</assignee>
                                    <reporter username="leo.herbie">Travis Schneeberger</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Apr 2017 13:11:27 +0000</created>
                <updated>Thu, 8 Jun 2017 16:08:52 +0000</updated>
                            <resolved>Thu, 8 Jun 2017 15:59:03 +0000</resolved>
                                    <version>2.0.5</version>
                                    <fixVersion>2.0.6</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>AcroForm</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15965802" author="leo.herbie" created="Wed, 12 Apr 2017 13:12:11 +0000"  >&lt;p&gt;Attached is the pdf that causes the exception&lt;/p&gt;</comment>
                            <comment id="15968770" author="msahyoun" created="Fri, 14 Apr 2017 08:23:02 +0000"  >&lt;p&gt;I&apos;ll investigate what other application - especial Adobes - are doing in this case. Avoiding the NPE is, as you described, an easy task. With the upcoming ISO/DIS 32000-2 specification (PDF 2.0) applications are required to generate an appearance stream. To comply with that we might need to generate a default appearance stream and not only an empty one.&lt;/p&gt;</comment>
                            <comment id="16006416" author="jira-bot" created="Thu, 11 May 2017 13:28:02 +0000"  >&lt;p&gt;Commit 1794836 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1794836&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1794836&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3751&quot; title=&quot;Flattening a pdf with refreshAppearances set to true causes a NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3751&quot;&gt;&lt;del&gt;PDFBOX-3751&lt;/del&gt;&lt;/a&gt;: don&apos;t try to update the value by option for a PDPushButton when refreshing the appearance&lt;/p&gt;</comment>
                            <comment id="16006425" author="jira-bot" created="Thu, 11 May 2017 13:33:18 +0000"  >&lt;p&gt;Commit 1794838 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=msahyoun&quot; class=&quot;user-hover&quot; rel=&quot;msahyoun&quot;&gt;msahyoun&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1794838&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1794838&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3751&quot; title=&quot;Flattening a pdf with refreshAppearances set to true causes a NullPointerException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3751&quot;&gt;&lt;del&gt;PDFBOX-3751&lt;/del&gt;&lt;/a&gt;: don&apos;t try to update the value by option for a PDPushButton when refreshing the appearance&lt;/p&gt;</comment>
                            <comment id="16006431" author="msahyoun" created="Thu, 11 May 2017 13:35:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=leo.herbie&quot; class=&quot;user-hover&quot; rel=&quot;leo.herbie&quot;&gt;leo.herbie&lt;/a&gt; could you verify the fix and let me know the result. Thanks for your patience.&lt;/p&gt;</comment>
                            <comment id="16042935" author="leo.herbie" created="Thu, 8 Jun 2017 16:08:52 +0000"  >&lt;p&gt;Sorry about my previous comment.  This issue has been resolved and for some reason Intellij got confused about the library update.  I&apos;m testing the other issues I reported as well.  Thanks again for being so responsive.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12863029" name="fdpAttachment2.pdf" size="4225145" author="leo.herbie" created="Wed, 12 Apr 2017 13:12:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 23 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3dj8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>