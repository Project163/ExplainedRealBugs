<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:54:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1824] [PATCH] CFF fonts render wrong glyphs</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1824</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I&apos;ve found three very closely related CFF encoding issues in v2.0.0 when using PDFToImage.&lt;/p&gt;

&lt;p&gt;Problem 1&lt;br/&gt;
---------&lt;/p&gt;

&lt;p&gt;Look a line 7 of the poem, it should be &quot;And the mouldering dust that years have made&quot;&lt;br/&gt;
but instead says &quot;Afld the fioulderiflg dust that years have fiade&quot;&lt;/p&gt;

&lt;p&gt;The CFF font is asseumed to use CIDs but it does not if its not a ROS font.&lt;br/&gt;
Therefore we add a check for CFF ROS class.&lt;/p&gt;

&lt;p&gt;Patch 1 fixes this.&lt;/p&gt;

&lt;p&gt;Problem 2&lt;br/&gt;
---------&lt;/p&gt;

&lt;p&gt;Look at line 3 &quot;of right shoice&quot; should be &quot;of right choice&quot;.&lt;br/&gt;
Likewise on line 2 of the 2nd paragraph &quot;And a staunsh&quot; should be &quot;And a staunch&quot;,&lt;br/&gt;
the st and ch ligatures are incorrect.&lt;/p&gt;

&lt;p&gt;This is because the font is an CFF ROS CID Font and the glyphs for the st and ch ligatures&lt;br/&gt;
both have no name. The CFF format achieves this by using SIDs beyond the size of the string&lt;br/&gt;
index, which map to .notdef. So there is a unique SID for each glyph, but not a unique name.&lt;/p&gt;

&lt;p&gt;Unfortuntely, PDFBox assumes that Type 1 fonts have glyphs with unique names, and this&lt;br/&gt;
assumtion appears throughout the codebase. Because a glyph name and a SID perform essentially&lt;br/&gt;
the same role, I recommend a simple solution to the problem: when an SID beyond the size of&lt;br/&gt;
the string index is encounteted, instead of mapping it to .notdef it should be mapped to &lt;br/&gt;
a new name with the prefix &quot;SID&quot; for example mapping SID 409 to the name &quot;SID409&quot;. That way&lt;br/&gt;
each glyph will have a unique name, which is what PDFbox assumes.&lt;/p&gt;

&lt;p&gt;Patch 2 fixes this.&lt;/p&gt;

&lt;p&gt;Problem 3&lt;br/&gt;
---------&lt;/p&gt;

&lt;p&gt;Look at line 2, &quot;That creepeth o&#201;er ruins old!&quot; the word &quot;o&apos;er&quot; is incorrectly rendered&lt;br/&gt;
as &quot;o&#201;er&quot;. This is because the Encoding entry in the PDF maps code 201 from &quot;Eacute&quot; in the&lt;br/&gt;
base encoding to &quot;quoteright&quot;, but this is being ignored by PDFBox.&lt;/p&gt;

&lt;p&gt;In the CFFGlyph2D constructor PDFBox examines the font&apos;s built-in charset. When the name&lt;br/&gt;
&quot;quoteright&quot; is encountered it is looked up in the PDF Encoding (i.e. nameToCode) where&lt;br/&gt;
it is changed to code 201. Thus code 201 is associated with the &quot;quoteright&quot; glyph in the&lt;br/&gt;
codeToGlyph map. This is correct. &lt;/p&gt;

&lt;p&gt;However, later when the &quot;Eacute&quot; glyph is encountered, its built-in charset code is also&lt;br/&gt;
201 (which is standard) and so the codeToGlyph map entry is overwritten, resulting in&lt;br/&gt;
code 201 being associated with the &quot;Eacute&quot; glyph. &lt;/p&gt;

&lt;p&gt;The solution is to build the codeToGlyph map in a strict order: first populate it with the&lt;br/&gt;
font&apos;s built-in charset, then the PDF Encoding overwrites any entries which it defines.&lt;/p&gt;

&lt;p&gt;Patch 3 fixes this (and also replaces patch 2)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12686938">PDFBOX-1824</key>
            <summary>[PATCH] CFF fonts render wrong glyphs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="jahewson">John Hewson</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Thu, 2 Jan 2014 08:29:41 +0000</created>
                <updated>Thu, 17 Mar 2016 19:08:24 +0000</updated>
                            <resolved>Sat, 4 Jan 2014 13:39:00 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13860107" author="lehmi" created="Thu, 2 Jan 2014 10:07:55 +0000"  >&lt;p&gt;I added the proposed patch(es) in revision 1554779.&lt;/p&gt;

&lt;p&gt;Thanks for the contribution!&lt;/p&gt;</comment>
                            <comment id="13860847" author="tilman" created="Thu, 2 Jan 2014 22:02:56 +0000"  >&lt;p&gt;The good news is that the file from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1697&quot; title=&quot;the text show Incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1697&quot;&gt;&lt;del&gt;PDFBOX-1697&lt;/del&gt;&lt;/a&gt; now displays nicely.&lt;br/&gt;
The bad news (regression) is that page 2 from the file &lt;a href=&quot;http://www.mzweb.com.br/grupobimbo/web/arquivos/Bimbo_Historia_20070409_Esp.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.mzweb.com.br/grupobimbo/web/arquivos/Bimbo_Historia_20070409_Esp.pdf&lt;/a&gt; (mentioned in several issues, e.g. &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1691&quot; title=&quot;&amp;quot;Foreign&amp;quot; characters are not rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1691&quot;&gt;&lt;del&gt;PDFBOX-1691&lt;/del&gt;&lt;/a&gt;) is worse than ever. I attach a current rendering and one from rev 1554775.&lt;/p&gt;</comment>
                            <comment id="13861772" author="jahewson" created="Fri, 3 Jan 2014 18:55:23 +0000"  >&lt;p&gt;The patch &quot;bimbo_historia.patch&quot; fixes the issue with the Bimbo Historia PDF file. The problem was an assumption made in the original CFFGlyph2D code that (Character Code =&amp;gt; Glyph Name) mappings are 1:1 but they are actually Many:1&lt;/p&gt;</comment>
                            <comment id="13861779" author="jahewson" created="Fri, 3 Jan 2014 18:59:49 +0000"  >&lt;p&gt;I&apos;ve attached &quot;bimbo_historia-patched.jpg&quot; which shows the result of the new patch. Note that some of the glyphs are missing, which I can confirm is a problem related to parsing Type1 CharStrings and is &lt;b&gt;not&lt;/b&gt; an Encoding issue. I will open a new bug for this with more details once the current issue is closed.&lt;/p&gt;</comment>
                            <comment id="13861784" author="lehmi" created="Fri, 3 Jan 2014 19:03:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; Thanks for the fast patch. I&apos;ve one too, but I&apos;m still testing to avoid side effects.&lt;/p&gt;

&lt;p&gt;The remaining issue maybe related to &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1691&quot; title=&quot;&amp;quot;Foreign&amp;quot; characters are not rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1691&quot;&gt;&lt;del&gt;PDFBOX-1691&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13861830" author="jahewson" created="Fri, 3 Jan 2014 19:33:29 +0000"  >&lt;p&gt;Yes, the remaining issue is indeed &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1691&quot; title=&quot;&amp;quot;Foreign&amp;quot; characters are not rendered&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-1691&quot;&gt;&lt;del&gt;PDFBOX-1691&lt;/del&gt;&lt;/a&gt; I will see if I can write a patch for it.&lt;/p&gt;</comment>
                            <comment id="13862307" author="lehmi" created="Sat, 4 Jan 2014 13:39:00 +0000"  >&lt;p&gt;I fixed the mapping issue in revision 1555348. I used my own patch, which follows the same idea than Johns proposal, but I guess mine is more elegant &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks to all for the input!&lt;/p&gt;</comment>
                            <comment id="13862381" author="jahewson" created="Sat, 4 Jan 2014 18:42:53 +0000"  >&lt;p&gt;Works for me! Indexing Type 1 fonts by (Code =&amp;gt; Name =&amp;gt; Glyph) is a good move.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12664187">PDFBOX-1697</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12621041" name="1.patch" size="1183" author="jahewson" created="Thu, 2 Jan 2014 08:34:23 +0000"/>
                            <attachment id="12621042" name="2.patch" size="540" author="jahewson" created="Thu, 2 Jan 2014 08:34:40 +0000"/>
                            <attachment id="12621043" name="3.patch" size="2465" author="jahewson" created="Thu, 2 Jan 2014 08:34:49 +0000"/>
                            <attachment id="12621166" name="Bimbo_Historia_20070409_Esp.pdf-2-rev-1554775.png" size="1063804" author="tilman" created="Thu, 2 Jan 2014 22:02:56 +0000"/>
                            <attachment id="12621167" name="Bimbo_Historia_20070409_Esp.pdf-2-rev-current.png" size="955727" author="tilman" created="Thu, 2 Jan 2014 22:02:56 +0000"/>
                            <attachment id="12621044" name="all.patch" size="3005" author="jahewson" created="Thu, 2 Jan 2014 08:34:58 +0000"/>
                            <attachment id="12621362" name="bimbo_historia-patched.jpg" size="390787" author="jahewson" created="Fri, 3 Jan 2014 18:59:49 +0000"/>
                            <attachment id="12621361" name="bimbo_historia.patch" size="3147" author="jahewson" created="Fri, 3 Jan 2014 18:55:23 +0000"/>
                            <attachment id="12621045" name="calluna-11.pdf" size="149176" author="jahewson" created="Thu, 2 Jan 2014 08:35:33 +0000"/>
                            <attachment id="12621047" name="patched.jpg" size="223983" author="jahewson" created="Thu, 2 Jan 2014 08:36:34 +0000"/>
                            <attachment id="12621046" name="trunk.jpg" size="274345" author="jahewson" created="Thu, 2 Jan 2014 08:36:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365933</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1r2sn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>366240</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>