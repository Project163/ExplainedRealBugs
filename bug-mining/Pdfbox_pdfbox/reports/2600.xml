<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:12:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5297] class org.apache.pdfbox.cos.COSName cannot be cast to class org.apache.pdfbox.cos.COSString</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5297</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;A customer provided us with a PDF that contains an AcroForm and has some of the data filled in. There are various ways to trigger the error, but here&apos;s a stacktrace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.pdfbox.cos.COSName cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;org.apache.pdfbox.cos.COSString (org.apache.pdfbox.cos.COSName and org.apache.pdfbox.cos.COSString are in unnamed module of loader &lt;span class=&quot;code-quote&quot;&gt;&apos;app&apos;&lt;/span&gt;)
 at org.apache.pdfbox.pdmodel.interactive.form.PDVariableText.getDefaultAppearanceString(PDVariableText.java:91)
 at org.apache.pdfbox.pdmodel.interactive.form.AppearanceGeneratorHelper.&amp;lt;init&amp;gt;(AppearanceGeneratorHelper.java:114)
 at org.apache.pdfbox.pdmodel.interactive.form.PDTextField.constructAppearances(PDTextField.java:263)
 at org.apache.pdfbox.pdmodel.interactive.form.PDAcroForm.refreshAppearances(PDAcroForm.java:331)
 at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
 at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
 at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
 at java.base/java.lang.reflect.Method.invoke(Method.java:566)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The PDF contains sensitive user information, so I cannot post it here publicly, but I&apos;d be willing to submit it to a private upload area. When I use an editor to remove/change the sensitive data, the problem goes away or sprouts up as a different error (related to fonts).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Here is a little bit of metadata I can provide right now:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
{
 &lt;span class=&quot;code-quote&quot;&gt;&quot;Author&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;SE:W:CAR:MP&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;CreationDate&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;D:20211012165530Z00&lt;span class=&quot;code-quote&quot;&gt;&apos;00&apos;&lt;/span&gt;&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;Creator&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;Adobe LiveCycle Designer ES 9.0&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;Keywords&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;Fillable&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;ModDate&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;D:20211012165530Z00&lt;span class=&quot;code-quote&quot;&gt;&apos;00&apos;&lt;/span&gt;&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;Producer&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;macOS Version 10.15.7 (Build 19H1417) Quartz PDFContext&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;Subject&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;Request &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Taxpayer Identification &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; and Certification&quot;&lt;/span&gt;,
 &lt;span class=&quot;code-quote&quot;&gt;&quot;Title&quot;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&quot;Form W-9 (Rev. October 2018)&quot;&lt;/span&gt;
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13407394">PDFBOX-5297</key>
            <summary>class org.apache.pdfbox.cos.COSName cannot be cast to class org.apache.pdfbox.cos.COSString</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="newhouse-anvil">Chris Newhouse</reporter>
                        <labels>
                    </labels>
                <created>Tue, 19 Oct 2021 22:05:22 +0000</created>
                <updated>Fri, 17 Dec 2021 06:50:07 +0000</updated>
                            <resolved>Sun, 31 Oct 2021 04:18:55 +0000</resolved>
                                    <version>2.0.24</version>
                                    <fixVersion>2.0.25</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>AcroForm</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17430990" author="jira-bot" created="Wed, 20 Oct 2021 06:12:53 +0000"  >&lt;p&gt;Commit 1894398 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1894398&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1894398&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5297&quot; title=&quot;class org.apache.pdfbox.cos.COSName cannot be cast to class org.apache.pdfbox.cos.COSString&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5297&quot;&gt;&lt;del&gt;PDFBOX-5297&lt;/del&gt;&lt;/a&gt;: avoid ClassCastException&lt;/p&gt;</comment>
                            <comment id="17430991" author="jira-bot" created="Wed, 20 Oct 2021 06:12:56 +0000"  >&lt;p&gt;Commit 1894399 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1894399&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1894399&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5297&quot; title=&quot;class org.apache.pdfbox.cos.COSName cannot be cast to class org.apache.pdfbox.cos.COSString&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5297&quot;&gt;&lt;del&gt;PDFBOX-5297&lt;/del&gt;&lt;/a&gt;: avoid ClassCastException&lt;/p&gt;</comment>
                            <comment id="17431372" author="tilman" created="Wed, 20 Oct 2021 17:19:33 +0000"  >&lt;p&gt;Please try with a snapshot&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.25-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.25-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I expect more exceptions because now the /DA entry is considered null and this is an illegal parameter in another method. That PDF file is likely very messed up. You can send it to me at tilman (at) snafu dot de .&lt;/p&gt;</comment>
                            <comment id="17431375" author="jira-bot" created="Wed, 20 Oct 2021 17:24:12 +0000"  >&lt;p&gt;Commit 1894412 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1894412&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1894412&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5297&quot; title=&quot;class org.apache.pdfbox.cos.COSName cannot be cast to class org.apache.pdfbox.cos.COSString&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5297&quot;&gt;&lt;del&gt;PDFBOX-5297&lt;/del&gt;&lt;/a&gt;: avoid ClassCastException&lt;/p&gt;</comment>
                            <comment id="17431383" author="jira-bot" created="Wed, 20 Oct 2021 17:25:27 +0000"  >&lt;p&gt;Commit 1894413 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1894413&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1894413&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5297&quot; title=&quot;class org.apache.pdfbox.cos.COSName cannot be cast to class org.apache.pdfbox.cos.COSString&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5297&quot;&gt;&lt;del&gt;PDFBOX-5297&lt;/del&gt;&lt;/a&gt;: avoid ClassCastException&lt;/p&gt;</comment>
                            <comment id="17432115" author="newhouse-anvil" created="Wed, 20 Oct 2021 22:13:18 +0000"  >&lt;p&gt;PDF sent to you, thanks.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if I&apos;ll be able to find the time to try things using the Snapshot...but I will try.&lt;/p&gt;</comment>
                            <comment id="17432183" author="tilman" created="Thu, 21 Oct 2021 03:19:53 +0000"  >&lt;p&gt;Wow, it has this multiple times:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/DA /Helvetica#209#20Tf#200#20g 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;instead of&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/DA (/Helvetica 9 Tf 0 g) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also, that font doesn&apos;t exist in the AcroForm default resources.&lt;/p&gt;</comment>
                            <comment id="17432699" author="newhouse-anvil" created="Thu, 21 Oct 2021 20:16:11 +0000"  >&lt;p&gt;Looks like a busted form of URL-encoding...is there a way to fix or handle this in PDF Box or AcroForm?&lt;/p&gt;

&lt;p&gt;If I can detect and/or fix these problems when they come through, I&apos;d love to do that.&lt;/p&gt;</comment>
                            <comment id="17433080" author="tilman" created="Fri, 22 Oct 2021 17:17:54 +0000"  >&lt;p&gt;It is a bug by the software filling that form. I have a fix but need to test it, but first I need to finish fixing a hardware problem with my PC.&lt;/p&gt;</comment>
                            <comment id="17433106" author="newhouse-anvil" created="Fri, 22 Oct 2021 18:01:20 +0000"  >&lt;p&gt;ok, thank you for the update. I&apos;ll stay tuned.&lt;/p&gt;

&lt;p&gt;Good luck with your hardware issue:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://bleuwire.com/wp-content/uploads/2019/07/computer-repair-services-miami.jpg&quot; height=&quot;152&quot; width=&quot;228&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17433212" author="tilman" created="Sat, 23 Oct 2021 03:07:00 +0000"  >&lt;p&gt;That file has multiple errors, it also didn&apos;t use the standard font names or add the fonts to the acroform default resources. You can repair it with this code before calling refreshAppearances:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (PDField field : acroForm.getFieldTree())
{
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (field &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; PDVariableText)
    {
        COSBase daBase = field.getCOSObject().getDictionaryObject(COSName.DA);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (daBase &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; COSName)
        {
            &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; da = ((COSName) daBase).getName();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (da.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;Helvetica&quot;&lt;/span&gt;))
            {
                da = da.replace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Helvetica&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;/Helv&quot;&lt;/span&gt;);
            }
            &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (da.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;ZapfDingbatsITC&quot;&lt;/span&gt;))
            {
                da = da.replace(&lt;span class=&quot;code-quote&quot;&gt;&quot;ZapfDingbatsITC&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;/ZaDb&quot;&lt;/span&gt;);
            }
            ((PDVariableText) field).setDefaultAppearance(da);
        }
    }
}
acroForm.refreshAppearances();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17435662" author="newhouse-anvil" created="Thu, 28 Oct 2021 21:17:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt;&#160;thank you so much for the &quot;fix&quot;! Very appreciated!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I noticed that the call to `setDefaultAppearances` is made in every iteration of the innermost loop, and not just when we&apos;ve replaced some bad strings. Is this intentional? I&apos;m guessing it is, and that the reason why is because if we&apos;re in that far, the `daBase` is a `COSName`, and needs to be &quot;fixed&quot;, ya?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m just trying to understand how much of the above code is specific to the file I provided you, versus being something generically applicable to many files that may have a similar problem.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also, will this become part of the library in a new version? Does it have any visual impact on the document if it&apos;s performed?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Many thanks!!!&lt;/p&gt;</comment>
                            <comment id="17435741" author="tilman" created="Fri, 29 Oct 2021 02:16:55 +0000"  >&lt;p&gt;Yes it is correct, it shouldn&apos;t be a name.&lt;/p&gt;

&lt;p&gt;(I just woke up, which is the reason for the (deleted) answer)&lt;/p&gt;</comment>
                            <comment id="17435742" author="tilman" created="Fri, 29 Oct 2021 02:18:23 +0000"  >&lt;p&gt;It is specific to this file, I&apos;ve never seen this in the wild before. But obviously there is some software out there that produces these bad files. The code presented here won&apos;t hurt correct files.&lt;/p&gt;</comment>
                            <comment id="17436098" author="newhouse-anvil" created="Fri, 29 Oct 2021 17:17:16 +0000"  >&lt;p&gt;OK, great, thanks! Inspired by this code/fix we&apos;ve also come across another bad file where `daBase` was an instance of `COSString`, but its value was `/Helvetica blah blah blah`. The above code didn&apos;t fix it. So I modified it to be something like the following, and it fixed things. Does this look reasonable?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (PDField field : acroForm.getFieldTree()) {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (field &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; PDVariableText) {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; da;
    
    &lt;span class=&quot;code-comment&quot;&gt;// If it was a COSName, it really ought to result in a setDefaultAppearance call, per the comments
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// in the PDFBOX issue above. Otherwise, we can probably avoid the call to setDefaultAppearance &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// it was already a COSString AND we didn&apos;t knowingly fix anything.
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; wasCosName = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;

    COSBase daBase = field.getCOSObject().getDictionaryObject(COSName.DA);

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (daBase &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; COSName) {
      da = ((COSName) daBase).getName();
      wasCosName = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (daBase &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; COSString) {
      da = ((COSString) daBase).getString();
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      &lt;span class=&quot;code-comment&quot;&gt;// Can&apos;t &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; anything about &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; one...
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
    }

    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; wasFixedThisRound = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (da.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;Helvetica&quot;&lt;/span&gt;)) {
      da = da.replace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Helvetica&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;/Helv&quot;&lt;/span&gt;);
      wasFixedThisRound = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (da.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/Helvetica&quot;&lt;/span&gt;)) {
      da = da.replace(&lt;span class=&quot;code-quote&quot;&gt;&quot;/Helvetica&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;/Helv&quot;&lt;/span&gt;);
      wasFixedThisRound = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (da.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;ZapfDingbatsITC&quot;&lt;/span&gt;)) {
      da = da.replace(&lt;span class=&quot;code-quote&quot;&gt;&quot;ZapfDingbatsITC&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;/ZaDb&quot;&lt;/span&gt;);
      wasFixedThisRound = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (da.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/ZapfDingbatsITC&quot;&lt;/span&gt;)) {
      da = da.replace(&lt;span class=&quot;code-quote&quot;&gt;&quot;/ZapfDingbatsITC&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;/ZaDb&quot;&lt;/span&gt;);
      wasFixedThisRound = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }    
    &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!da.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;/&quot;&lt;/span&gt;)) {
      &lt;span class=&quot;code-comment&quot;&gt;// Log here anything that doesn&apos;t start with `/`
&lt;/span&gt;    }

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (wasFixedThisRound || wasCosName) {
      ((PDVariableText) field).setDefaultAppearance(da);
    }
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17436125" author="tilman" created="Fri, 29 Oct 2021 17:50:30 +0000"  >&lt;p&gt;Yeah, looks OK.&lt;/p&gt;</comment>
                            <comment id="17436127" author="newhouse-anvil" created="Fri, 29 Oct 2021 17:57:22 +0000"  >&lt;p&gt;Thank you very much &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="17436466" author="mkl" created="Sun, 31 Oct 2021 11:10:32 +0000"  >&lt;p&gt;Beware, you shouldn&apos;t blindly replace away such &quot;/Helvetica&quot; or &quot;/ZapfDingbatsITC&quot; &lt;b&gt;DA&lt;/b&gt; starts like that:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;If it starts with &quot;/Helvetica&quot; it might actually start with e.g. &quot;/HelveticaNeue&quot; and your replacement would make that a &quot;/HelvNeue&quot; which wouldn&apos;t really fix anything.&lt;/li&gt;
	&lt;li&gt;There might actually be a &quot;/Helvetica&quot; font in the &lt;b&gt;DR&lt;/b&gt; default resources. In that case replacing &quot;/Helvetica&quot; with &quot;/Helv&quot; might not be desired.&lt;/li&gt;
	&lt;li&gt;The &lt;b&gt;DA&lt;/b&gt; default appearance does not necessarily start with the font setting instruction. It usually does but you here try to fix unusual cases...&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thus, for a proper repair of the &lt;b&gt;DA&lt;/b&gt; value you should correctly parse it into instructions, search the font setting instruction, and check its first argument. Then fix the font name if and only if it&apos;s not a name or it is a name that neither is the name of a font in the &lt;b&gt;DR&lt;/b&gt; default resources nor one of the &lt;b&gt;Helv&lt;/b&gt;, &lt;b&gt;HeBo&lt;/b&gt;, ... set of names.&lt;/p&gt;</comment>
                            <comment id="17437468" author="newhouse-anvil" created="Tue, 2 Nov 2021 16:48:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkl&quot; class=&quot;user-hover&quot; rel=&quot;mkl&quot;&gt;mkl&lt;/a&gt;&#160;thank you for the thoughts there. I&apos;ve created a Gist to show what I&apos;m now thinking about doing based on all the comments here. Please have a look and feel free to comment:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://gist.github.com/newhouse/df88fa098bc0f003009cb70ed5815a48&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/newhouse/df88fa098bc0f003009cb70ed5815a48&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m not sure how to parse the &lt;b&gt;DA&lt;/b&gt; into instructions, find the Font setting one and grab the first argument. Could you elaborate?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Also, could you elaborate on what the set of Font names that should be supported, even if they&apos;re not found in the &lt;b&gt;DR&lt;/b&gt;?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Many thanks, again, to everyone!&lt;/p&gt;</comment>
                            <comment id="17437849" author="mkl" created="Wed, 3 Nov 2021 09:19:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;Please have a look and feel free to comment&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It is improved insofar as you take the full first token until a space character. Nonetheless, there are many &lt;b&gt;DA&lt;/b&gt; forms your code will misinterpret.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure how to parse the DA into instructions, find the Font setting one and grab the first argument. Could you elaborate?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You might want to have a look at the PDFBox class &lt;tt&gt;org.apache.pdfbox.pdmodel.interactive.form.PDDefaultAppearanceString&lt;/tt&gt;, in particular its &lt;tt&gt;processAppearanceStringOperators&lt;/tt&gt; method and the other &lt;tt&gt;process...&lt;/tt&gt; method called from there. This is how PDFBox extracts text font, text size, and text color information from the &lt;b&gt;DA&lt;/b&gt; string.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, could you elaborate on what the set of Font names that should be supported, even if they&apos;re not found in the &lt;b&gt;DR&lt;/b&gt;?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Strictly speaking, i.e. according to the specification, &lt;em&gt;none at all&lt;/em&gt;. Nonetheless, Adobe Acrobat (and many other PDF form-fillers following Adobe&apos;s lead) accept a set of font names even if they are not defined in the &lt;b&gt;DR&lt;/b&gt;, see &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-1234?focusedCommentId=14304601#comment-14304601&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;this PDFBox-1234 comment&lt;/a&gt;.&lt;/p&gt;
</comment>
                            <comment id="17444886" author="newhouse-anvil" created="Wed, 17 Nov 2021 00:47:07 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkl&quot; class=&quot;user-hover&quot; rel=&quot;mkl&quot;&gt;mkl&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;I have gone through the source code as you suggested, and have altered my gist to find the Font string by finding the &lt;b&gt;&quot;Tf&quot;&lt;/b&gt; operator, then grabbing the element 2 positions behind it. This will handle the case where the &lt;b&gt;&quot;Tf&quot;&lt;/b&gt; operation is not the first one to occur in the &lt;b&gt;DA&lt;/b&gt; string.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;ll also carefully incorporate (privately) the font mappings in that are mentioned in that comment.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Many thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 51 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0vzkw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>