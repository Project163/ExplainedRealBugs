<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:14:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5781] OutOfMemoryError in FileSystemFontsProvider.scanFonts</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5781</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;We experienced an OutOfMemoryError when calling&lt;br/&gt;
PDAcroForm.getDefaultResources().getFont(COSName); with COSName{Helv}&lt;/p&gt;

&lt;p&gt;The reason seemed to be that PdfBox initializes a FontCache when getFont is called and this scans &lt;em&gt;all&lt;/em&gt; fonts on the system. This also loads some large system fonts (AppleColorEmoji is 189,9MB). Each font gets copied into a single large byte array at the location below and this causes an OutOfMemoryError at this point in the code.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;org.apache.pdfbox.pdmodel.font.FileSystemFontProvider#addTrueTypeFontImpl:773&lt;/tt&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
InputStream is = ttf.getOriginalData();
&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] ba = IOUtils.toByteArray(is);
is.close();
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; hash = computeHash(ba); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think this would be easily fixed by using a DigestInputStream instead of a byte array to compute hashes at this location. I have tested this locally and it seemed to work. Please see the attached .patch file&lt;/p&gt;</description>
                <environment>Running inside a JVM with -Xmx512&lt;br/&gt;
openjdk version &amp;quot;17.0.10&amp;quot; 2024-01-16 LTS&lt;br/&gt;
OpenJDK Runtime Environment (build 17.0.10+13-LTS)&lt;br/&gt;
OpenJDK 64-Bit Server VM (build 17.0.10+13-LTS, mixed mode, sharing)&lt;br/&gt;
macOS Sonoma 14.3.1 (23D60)</environment>
        <key id="13571169">PDFBOX-5781</key>
            <summary>OutOfMemoryError in FileSystemFontsProvider.scanFonts</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="kim_hage">Kim Hage</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Mar 2024 16:34:53 +0000</created>
                <updated>Thu, 14 Mar 2024 20:57:40 +0000</updated>
                            <resolved>Fri, 8 Mar 2024 10:15:20 +0000</resolved>
                                    <version>2.0.30</version>
                    <version>3.0.1 PDFBox</version>
                                    <fixVersion>2.0.31</fixVersion>
                    <fixVersion>3.0.2 PDFBox</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>FontBox</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17824466" author="tilman" created="Thu, 7 Mar 2024 16:39:49 +0000"  >&lt;p&gt;Your patch is against an older code version. The current code is like this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; computeHash(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] ba)
    {
        CRC32 crc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CRC32();
        crc.update(ba);
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; l = crc.getValue();
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.toHexString(l);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We got rid of SHA512 in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5727&quot; title=&quot;Font operation takes a long time with 3.0.1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5727&quot;&gt;&lt;del&gt;PDFBOX-5727&lt;/del&gt;&lt;/a&gt; because it was too slow.&lt;/p&gt;</comment>
                            <comment id="17824470" author="JIRAUSER304528" created="Thu, 7 Mar 2024 16:46:07 +0000"  >&lt;p&gt;This is what i checked out from &lt;a href=&quot;https://github.com/apache/pdfbox/releases/tag/2.0.30&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/pdfbox/releases/tag/2.0.30&lt;/a&gt; today. Seemed to be the most up to date state of version 2. Is version 2 still supported or is it all version 3 now?&lt;/p&gt;</comment>
                            <comment id="17824475" author="tilman" created="Thu, 7 Mar 2024 16:53:17 +0000"  >&lt;p&gt;Version 2 is still supported. What you got is the 2.0.30 release, not the current work. If you don&apos;t want to check out the trunk, get the source here:&lt;br/&gt;
&lt;a href=&quot;https://svn.apache.org/repos/asf/pdfbox/branches/2.0/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/pdfbox/branches/2.0/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;ideally patches should be against the trunk&lt;br/&gt;
&lt;a href=&quot;https://svn.apache.org/repos/asf/pdfbox/trunk/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/pdfbox/trunk/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;but that shouldn&apos;t be too difficult, the logic is similar.&lt;/p&gt;</comment>
                            <comment id="17824572" author="JIRAUSER304528" created="Thu, 7 Mar 2024 23:22:32 +0000"  >&lt;p&gt;Alright, here we go again ...&lt;/p&gt;

&lt;p&gt;-&amp;gt; &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13067334/13067334_2.0.31.patch&quot; title=&quot;2.0.31.patch attached to PDFBOX-5781&quot;&gt;2.0.31.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;br/&gt;
-&amp;gt; &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13067335/13067335_3.0.patch&quot; title=&quot;3.0.patch attached to PDFBOX-5781&quot;&gt;3.0.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17824685" author="jira-bot" created="Fri, 8 Mar 2024 09:33:19 +0000"  >&lt;p&gt;Commit 1916176 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1916176&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1916176&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5781&quot; title=&quot;OutOfMemoryError in FileSystemFontsProvider.scanFonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5781&quot;&gt;&lt;del&gt;PDFBOX-5781&lt;/del&gt;&lt;/a&gt;: avoid OOM that can happen with huge fonts, by Kim Hage&lt;/p&gt;</comment>
                            <comment id="17824691" author="jira-bot" created="Fri, 8 Mar 2024 09:46:16 +0000"  >&lt;p&gt;Commit 1916178 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1916178&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1916178&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5781&quot; title=&quot;OutOfMemoryError in FileSystemFontsProvider.scanFonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5781&quot;&gt;&lt;del&gt;PDFBOX-5781&lt;/del&gt;&lt;/a&gt;: avoid OOM that can happen with huge fonts, by Kim Hage&lt;/p&gt;</comment>
                            <comment id="17824701" author="jira-bot" created="Fri, 8 Mar 2024 09:56:10 +0000"  >&lt;p&gt;Commit 1916180 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1916180&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1916180&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5781&quot; title=&quot;OutOfMemoryError in FileSystemFontsProvider.scanFonts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5781&quot;&gt;&lt;del&gt;PDFBOX-5781&lt;/del&gt;&lt;/a&gt;: avoid OOM that can happen with huge fonts, by Kim Hage&lt;/p&gt;</comment>
                            <comment id="17824715" author="tilman" created="Fri, 8 Mar 2024 10:15:10 +0000"  >&lt;p&gt;Thank you for the patches, a new snapshot is available here:&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.31-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.31-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13067334" name="2.0.31.patch" size="2952" author="kim_hage" created="Thu, 7 Mar 2024 23:21:13 +0000"/>
                            <attachment id="13067335" name="3.0.patch" size="2773" author="kim_hage" created="Thu, 7 Mar 2024 23:21:30 +0000"/>
                            <attachment id="13067329" name="FileSystemFontProvider_OutOfMemoryError.stacktrace" size="3107" author="kim_hage" created="Thu, 7 Mar 2024 16:34:01 +0000"/>
                            <attachment id="13067330" name="FileSystemFontProvider_use_DigestInputStream.patch" size="4538" author="kim_hage" created="Thu, 7 Mar 2024 16:33:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 35 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1nui8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>