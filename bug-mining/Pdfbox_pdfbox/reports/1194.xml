<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:01:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2204] Indexed color space in JPX</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2204</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I get this with the attached file on page 11:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.ArrayIndexOutOfBoundsException: 8296
	at org.apache.pdfbox.pdmodel.graphics.image.SampledImageReader.from8bit(SampledImageReader.java:253)
	at org.apache.pdfbox.pdmodel.graphics.image.SampledImageReader.getRGBImage(SampledImageReader.java:146)
	at org.apache.pdfbox.pdmodel.graphics.image.PDImageXObject.getImage(PDImageXObject.java:188)
	at org.apache.pdfbox.util.&lt;span class=&quot;code-keyword&quot;&gt;operator&lt;/span&gt;.pagedrawer.Invoke.process(Invoke.java:80)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is in JPXFilter. Per the spec, we must ignore the BITS_PER_COMPONENT value from the PDF and use the one from the image. We set BITS_PER_COMPONENT to 8 because colorModel.getComponentSize(0) is 8. colorModel.getPixelSize() is 4. In &quot;normal&quot; images, the sum of the colorModel.getComponentSize() values equals colorModel.getPixelSize().&lt;/p&gt;

&lt;p&gt;I&apos;m not sure what to do. I am using this code locally:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            ColorModel colorModel = image.getColorModel();
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; pixelSize = colorModel.getPixelSize();
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;[] componentSize = colorModel.getComponentSize();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (pixelSize &amp;lt; componentSize[0])
            {
                LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;componentSize[0] of image ignored, because pixelSize &amp;lt; componentSize[0]&quot;&lt;/span&gt;);
                LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;pixelSize: &quot;&lt;/span&gt; + pixelSize);
                LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;componentSize.length &quot;&lt;/span&gt; + componentSize.length);
                &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; componentSize.length; ++i)
                {
                    LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;componentSize[&quot;&lt;/span&gt; + i + &lt;span class=&quot;code-quote&quot;&gt;&quot;]: &quot;&lt;/span&gt; + componentSize[i]);
                }
            }
            &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
            {
                parameters.setInt(COSName.BITS_PER_COMPONENT, componentSize[0]);
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and now the PDF renders properly and the image at the bottom right is almost correct. (A circle on the left is missing)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12726943">PDFBOX-2204</key>
            <summary>Indexed color space in JPX</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jahewson">John Hewson</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                            <label>JPEG2000</label>
                            <label>JPXDecode</label>
                            <label>JPXFilter</label>
                    </labels>
                <created>Sat, 12 Jul 2014 12:52:55 +0000</created>
                <updated>Sat, 29 Sep 2018 11:46:53 +0000</updated>
                            <resolved>Tue, 11 Aug 2015 03:17:55 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14059782" author="tilman" created="Sat, 12 Jul 2014 13:12:17 +0000"  >&lt;p&gt;Rendering after the change. Adobe Reader and GSView can display the file, one JS and one Java based open source product can&apos;t.&lt;/p&gt;</comment>
                            <comment id="14059965" author="jahewson" created="Sun, 13 Jul 2014 00:24:14 +0000"  >&lt;p&gt;The image is using an indexed color model, which is why getComponentSize(0) is 8, as expected, but getPixelSize() is only 4. The current code doesn&apos;t take that into account though. I don&apos;t see any way to query the color space to discover how many bits per components are in the &lt;em&gt;input&lt;/em&gt; to the index instead of the &lt;em&gt;output&lt;/em&gt;, but I think we can discover this from the raster, maybe: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;bpc = image.getColorModel().getPixelSize() / image.getRaster.getNumBands()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which in this case is a 1bpc index (which maps to 8bpc RGB output), so we&apos;d get:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;bpc = 4 / 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which is 4, as the PDF file claims.&lt;/p&gt;

&lt;p&gt;&amp;#8212;&lt;/p&gt;

&lt;p&gt;I &lt;em&gt;think&lt;/em&gt; that indexed color spaces are not allowed in JPXs inside PDF, which might be why we&apos;re seeing other PDF readers having issues with this file (OS X Preview doesn&apos;t display it).&lt;/p&gt;</comment>
                            <comment id="14681163" author="jahewson" created="Tue, 11 Aug 2015 03:17:15 +0000"  >&lt;p&gt;Looking again at this, the PDF spec says:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;In addition, the image&#8217;s colour space may serve as the foundation for a palette of colours that are selected using samples&lt;br/&gt;
coming from the image&#8217;s data channels: the equivalent of an Indexed colour space in PDF.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So it appears the Indexed color spaces are supported. I&apos;ve made the change I mentioned above in to the BPC calculation in JPXFilter, so that we&apos;re measuring the size of the samples going in, not the samples coming out.&lt;/p&gt;</comment>
                            <comment id="14681164" author="jira-bot" created="Tue, 11 Aug 2015 03:17:42 +0000"  >&lt;p&gt;Commit 1695202 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1695202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1695202&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2204&quot; title=&quot;Indexed color space in JPX&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2204&quot;&gt;&lt;del&gt;PDFBOX-2204&lt;/del&gt;&lt;/a&gt;: Support for Indexed color spaces in JPX&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13188319">PDFBOX-4326</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12655396" name="PDFBOX-2204-012411.pdf" size="1302958" author="tilman" created="Sat, 12 Jul 2014 12:54:23 +0000"/>
                            <attachment id="12655397" name="pdfbox-2204-012411.pdf-11.png" size="213026" author="tilman" created="Sat, 12 Jul 2014 13:12:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>405050</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xpin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>405086</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>