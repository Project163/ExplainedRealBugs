<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:02:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2729] Can&apos;t sign encrypted PDF files</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2729</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;It is not possible to sign an encrypted PDF document.&lt;/p&gt;

&lt;p&gt;More details here :&lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/questions/29232684/signing-an-encrypted-pdf-document-with-pdfbox-2-0-0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/29232684/signing-an-encrypted-pdf-document-with-pdfbox-2-0-0&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12785865">PDFBOX-2729</key>
            <summary>Can&apos;t sign encrypted PDF files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="cbremaud">Cyril Bremaud</reporter>
                        <labels>
                    </labels>
                <created>Thu, 26 Mar 2015 12:23:58 +0000</created>
                <updated>Wed, 7 Sep 2016 17:42:00 +0000</updated>
                            <resolved>Sat, 23 Jan 2016 12:24:20 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Signing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14386344" author="mkl" created="Mon, 30 Mar 2015 07:57:09 +0000"  >&lt;p&gt;After some debugging it looks to me like the PDFBox signing code has not been developed or tested for encrypted files.&lt;/p&gt;

&lt;p&gt;Here &lt;tt&gt;StandardSecurityHandler&lt;/tt&gt; is initialized when the original file is parsed. In this context the default constructor is used. This default constructor implicitly sets &lt;tt&gt;policy&lt;/tt&gt; to &lt;tt&gt;null&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;When writing the file, though, some &lt;tt&gt;StandardSecurityHandler&lt;/tt&gt; methods are called which require a nun-&lt;tt&gt;null&lt;/tt&gt; value of &lt;tt&gt;policy&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15066755" author="tilman" created="Mon, 21 Dec 2015 17:34:27 +0000"  >&lt;p&gt;I&apos;d be interested to see an encrypted document that has been signed with a visual signature.&lt;/p&gt;</comment>
                            <comment id="15067014" author="gglad" created="Mon, 21 Dec 2015 20:09:10 +0000"  >&lt;p&gt;I&apos;ve managed to create a visible signature on protected file. My initial goal is to protect file and sign it at one time, but it works for protected files too. My problem that I cannot sign document twice, without damaging first signature. &lt;br/&gt;
I&apos;ve attached my pdfs&lt;br/&gt;
Password is 111&lt;br/&gt;
Document content is irrelevant to the topic &lt;/p&gt;

&lt;p&gt;Here is my snippets&lt;br/&gt;
When you load your pdf file, check if it is protected, load it with Owner password and reset all security.&lt;/p&gt;

&lt;p&gt;         ...&lt;br/&gt;
        this.document = PDDocument.load(pdf, ownerPassword);&lt;br/&gt;
        document.setAllSecurityToBeRemoved(true);&lt;br/&gt;
        ...&lt;br/&gt;
To make document protected again you should create new StandartProtectionPolicy with old passwords and premissions, save document, and then load it with password, sign it and save it again.&lt;/p&gt;

&lt;p&gt;    .....&lt;br/&gt;
    StandardProtectionPolicy policy = new StandertProtectionPolicy(ownerPassword, userPassword, accessPremission)&lt;br/&gt;
       doc.protect(policy);&lt;br/&gt;
       doc.save(signedFile);&lt;br/&gt;
       doc.close();&lt;br/&gt;
       doc = PDDocument.load(signedFile, policy.getOwnerPassword());&lt;br/&gt;
       doc.protect(policy);&lt;br/&gt;
       ....&lt;br/&gt;
       doc.addSignature(signature, this, options);&lt;br/&gt;
This works for me.&lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/questions/29232684/signing-an-encrypted-pdf-document-with-pdfbox-2-0-0/34403363#34403363&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/29232684/signing-an-encrypted-pdf-document-with-pdfbox-2-0-0/34403363#34403363&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15087728" author="jira-bot" created="Thu, 7 Jan 2016 17:33:38 +0000"  >&lt;p&gt;Commit 1723601 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1723601&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1723601&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2729&quot; title=&quot;Can&amp;#39;t sign encrypted PDF files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2729&quot;&gt;&lt;del&gt;PDFBOX-2729&lt;/del&gt;&lt;/a&gt;: prepare AES 128 bit encryption&lt;/p&gt;</comment>
                            <comment id="15087739" author="tilman" created="Thu, 7 Jan 2016 17:41:42 +0000"  >&lt;p&gt;This almost enables AES128 encryption, only the //TODO line must be implemented so that it works by default. I&apos;ve tested it with TestSymmetricKeyEncryption and it passes, and the files are really encrypted with AES128 and this is confirmed by Adobe Reader.&lt;/p&gt;

&lt;p&gt;Gleb, your solution has the problem that it reads and saves the file first, so it is no longer the same before signing. Another problem is that we must encrypt with the same method than initially done, which is why I implemented AES128 too. A third problem will happen with AES256: this one has a random component. We must find a way to keep the encryption key after loading the file. Currently it is lost due to the SecurityHandler object being created a second time for saving, &lt;del&gt;I haven&apos;t fully understood that part yet.&lt;/del&gt;&lt;/p&gt;</comment>
                            <comment id="15087980" author="tilman" created="Thu, 7 Jan 2016 19:47:58 +0000"  >&lt;p&gt;Three encrypted files just signed by PDFBox.&lt;/p&gt;</comment>
                            <comment id="15087988" author="tilman" created="Thu, 7 Jan 2016 19:50:37 +0000"  >&lt;p&gt;The encryption object is created in PDFParser.prepareDecryption(), has the encryption key, and is then &quot;lost&quot;. The solution will be to pass this object to the PDDocument object that is created later.&lt;/p&gt;</comment>
                            <comment id="15088042" author="jira-bot" created="Thu, 7 Jan 2016 20:20:30 +0000"  >&lt;p&gt;Commit 1723624 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1723624&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1723624&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2729&quot; title=&quot;Can&amp;#39;t sign encrypted PDF files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2729&quot;&gt;&lt;del&gt;PDFBOX-2729&lt;/del&gt;&lt;/a&gt;: pass encryption to PDDocument&lt;/p&gt;</comment>
                            <comment id="15088046" author="jira-bot" created="Thu, 7 Jan 2016 20:23:11 +0000"  >&lt;p&gt;Commit 1723625 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1723625&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1723625&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2729&quot; title=&quot;Can&amp;#39;t sign encrypted PDF files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2729&quot;&gt;&lt;del&gt;PDFBOX-2729&lt;/del&gt;&lt;/a&gt;: don&apos;t prepare encryption stuff when incremental writing&lt;/p&gt;</comment>
                            <comment id="15088053" author="tilman" created="Thu, 7 Jan 2016 20:28:04 +0000"  >&lt;p&gt;Oops, sorry, now I see it was assigned to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt;. I wanted to ask you for your opinion anyway,&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=GGlad&quot; class=&quot;user-hover&quot; rel=&quot;GGlad&quot;&gt;GGlad&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cbremaud&quot; class=&quot;user-hover&quot; rel=&quot;cbremaud&quot;&gt;cbremaud&lt;/a&gt; please try the latest snapshot and tell whether you can sign encrypted files.&lt;/p&gt;</comment>
                            <comment id="15088840" author="tilman" created="Fri, 8 Jan 2016 07:37:46 +0000"  >&lt;p&gt;File that has been encrypted and signed twice.&lt;/p&gt;</comment>
                            <comment id="15113722" author="lehmi" created="Sat, 23 Jan 2016 12:50:16 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Oops, sorry, now I see it was assigned to Andreas Lehmk&#252;hler. I wanted to ask you for your opinion anyway,&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No need to worry, thanks for taking over &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15231873" author="cbremaud" created="Fri, 8 Apr 2016 08:36:46 +0000"  >&lt;p&gt;It works fine. I can sign encrypted files but I must use bouncycastle provider. See &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3311&quot; title=&quot;Make SecurityHandlerFactory uses a genenic provider&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3311&quot;&gt;&lt;del&gt;PDFBOX-3311&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Thank you !&lt;/p&gt;</comment>
                            <comment id="15471294" author="tilman" created="Wed, 7 Sep 2016 17:42:00 +0000"  >&lt;p&gt;Unrelated but I&apos;m trying to reach signature users:&lt;br/&gt;
Please have a look at &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3065&quot; title=&quot;Right now PDFBOX does not permit to sign multiple files while calling an external signing service.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3065&quot;&gt;&lt;del&gt;PDFBOX-3065&lt;/del&gt;&lt;/a&gt;, this is about a different way to sign that will replace the current situation in 2.1, and in 2.0.* it will coexist. More explanation in &lt;tt&gt;PDDocument.saveIncrementalForExternalSigning&lt;/tt&gt;, see [ &lt;a href=&quot;https://svn.apache.org/r1759639&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1759639&lt;/a&gt; ].&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12617670">PDFBOX-1453</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12778897" name="Scan0001.pdf" size="205045" author="GGlad" created="Mon, 21 Dec 2015 20:09:10 +0000"/>
                            <attachment id="12778898" name="Scan0001_protected.pdf" size="205366" author="GGlad" created="Mon, 21 Dec 2015 20:09:10 +0000"/>
                            <attachment id="12778899" name="Scan0001_protected_signed.pdf" size="227309" author="GGlad" created="Mon, 21 Dec 2015 20:09:10 +0000"/>
                            <attachment id="12781046" name="Simple-128-bit-encrypted_signed.pdf" size="1029029" author="tilman" created="Thu, 7 Jan 2016 19:47:58 +0000"/>
                            <attachment id="12781047" name="Simple-256-bit-encrypted_signed.pdf" size="1055394" author="tilman" created="Thu, 7 Jan 2016 19:47:58 +0000"/>
                            <attachment id="12781157" name="Simple-256-bit-encrypted_signed_signed.pdf" size="1078763" author="tilman" created="Fri, 8 Jan 2016 07:37:46 +0000"/>
                            <attachment id="12781045" name="Simple-40-bit-encrypted_signed.pdf" size="1029033" author="tilman" created="Thu, 7 Jan 2016 19:47:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 10 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i27e87:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>