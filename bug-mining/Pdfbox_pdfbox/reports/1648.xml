<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:05:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3653] NegativeArraySizeException thrown when converting PDF to Image (in TilingPaint.java)</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3653</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Specifically page 7 of the PDF document is failing.&lt;br/&gt;
PDF Document:&lt;br/&gt;
&lt;a href=&quot;http://download.win2pdf.com/samples/PowerPoint-slides.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://download.win2pdf.com/samples/PowerPoint-slides.pdf&lt;/a&gt;&lt;br/&gt;
(also attached to ticket)&lt;/p&gt;

&lt;p&gt;Stack trace:&lt;br/&gt;
Exception in thread &quot;main&quot; java.lang.NegativeArraySizeException &lt;br/&gt;
at java.awt.image.DataBufferByte.&amp;lt;init&amp;gt;(DataBufferByte.java:76)&lt;br/&gt;
at java.awt.image.Raster.createInterleavedRaster(Raster.java:266)&lt;br/&gt;
at java.awt.image.Raster.createInterleavedRaster(Raster.java:212)&lt;br/&gt;
at java.awt.image.ComponentColorModel.createCompatibleWritableRaster(ComponentColorModel.java:2825)&lt;br/&gt;
at org.apache.pdfbox.rendering.TilingPaint.getImage(TilingPaint.java:134)&lt;br/&gt;
at org.apache.pdfbox.rendering.TilingPaint.&amp;lt;init&amp;gt;(TilingPaint.java:69)&lt;br/&gt;
at org.apache.pdfbox.rendering.PageDrawer.getPaint(PageDrawer.java:251)&lt;br/&gt;
at org.apache.pdfbox.rendering.PageDrawer.getNonStrokingPaint(PageDrawer.java:526)&lt;br/&gt;
at org.apache.pdfbox.rendering.PageDrawer.fillPath(PageDrawer.java:597)&lt;br/&gt;
at org.apache.pdfbox.contentstream.operator.graphics.FillEvenOddRule.process(FillEvenOddRule.java:36)&lt;br/&gt;
at org.apache.pdfbox.contentstream.PDFStreamEngine.processOperator(PDFStreamEngine.java:829)&lt;br/&gt;
at org.apache.pdfbox.contentstream.PDFStreamEngine.processStreamOperators(PDFStreamEngine.java:486)&lt;br/&gt;
at org.apache.pdfbox.contentstream.PDFStreamEngine.processStream(PDFStreamEngine.java:460)&lt;br/&gt;
at org.apache.pdfbox.contentstream.PDFStreamEngine.processPage(PDFStreamEngine.java:150)&lt;br/&gt;
at org.apache.pdfbox.rendering.PageDrawer.drawPage(PageDrawer.java:189)&lt;br/&gt;
at org.apache.pdfbox.rendering.PDFRenderer.renderImage(PDFRenderer.java:145)&lt;br/&gt;
at org.apache.pdfbox.rendering.PDFRenderer.renderImageWithDPI(PDFRenderer.java:94)&lt;br/&gt;
at org.apache.pdfbox.tools.PDFToImage.main(PDFToImage.java:236)&lt;br/&gt;
at org.apache.pdfbox.tools.PDFBox.main(PDFBox.java:94)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13035895">PDFBOX-3653</key>
            <summary>NegativeArraySizeException thrown when converting PDF to Image (in TilingPaint.java)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="emc">Emily Coyne</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Jan 2017 14:57:22 +0000</created>
                <updated>Fri, 30 Jun 2017 16:17:03 +0000</updated>
                            <resolved>Tue, 24 Jan 2017 17:05:54 +0000</resolved>
                                    <version>2.0.4</version>
                                    <fixVersion>2.0.5</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15828962" author="tilman" created="Wed, 18 Jan 2017 23:25:29 +0000"  >&lt;p&gt;I get an OutOfMemoryError on JDK8. On JDK9 it works. Maybe the JDK you&apos;re using believes that the huge number is negative.&lt;/p&gt;

&lt;p&gt;Some observations:&lt;br/&gt;
createCompatibleWritableRaster gets called with rasterWidth 923 and rasterHeight 499494. The cause is the pattern in &lt;tt&gt;Root/Pages/Kids/&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;/Resources/Pattern/p480&lt;/tt&gt; and the calculations done in &lt;tt&gt;TilingPaint.getAnchorRect()&lt;/tt&gt;. The YStep 3847 is multiplied with the Y scale 129 so the result is a huge number &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15836313" author="jira-bot" created="Tue, 24 Jan 2017 16:59:28 +0000"  >&lt;p&gt;Commit 1780091 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1780091&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1780091&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3653&quot; title=&quot;NegativeArraySizeException thrown when converting PDF to Image (in TilingPaint.java)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3653&quot;&gt;&lt;del&gt;PDFBOX-3653&lt;/del&gt;&lt;/a&gt;: clip large patterns; return actual pattern xy step values&lt;/p&gt;</comment>
                            <comment id="15836314" author="jira-bot" created="Tue, 24 Jan 2017 16:59:33 +0000"  >&lt;p&gt;Commit 1780092 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1780092&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1780092&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3653&quot; title=&quot;NegativeArraySizeException thrown when converting PDF to Image (in TilingPaint.java)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3653&quot;&gt;&lt;del&gt;PDFBOX-3653&lt;/del&gt;&lt;/a&gt;: clip large patterns; return actual pattern xy step values&lt;/p&gt;</comment>
                            <comment id="15836316" author="tilman" created="Tue, 24 Jan 2017 17:03:05 +0000"  >&lt;p&gt;I have set a maximum surface of 25000000 for a pattern image, this is 5000 x 5000 and dpi isn&apos;t even counted.&lt;/p&gt;

&lt;p&gt;Initially, this check activated only with your file and another ( &lt;a href=&quot;https://bugs.ghostscript.com/show_bug.cgi?id=693134&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.ghostscript.com/show_bug.cgi?id=693134&lt;/a&gt; ) that doesn&apos;t have an issue here yet. The values are arbitrary and there might still be trouble with a large dpi. Your file renders fine up to 400% (= 288dpi), but not at 1000% (720dpi).&lt;/p&gt;

&lt;p&gt;I also tried to limit the sizes to the page sizes, but that didn&apos;t work with several other files; I suspect that at a later time, the calculated large patterns get resized so their full surface is needed.&lt;/p&gt;

&lt;p&gt;I have also decided to remove the code that sets big (&amp;gt; 32767) XStep and YStep values to 0. Rendering with the modified code shows improvements:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3447&quot; title=&quot;IllegalArgumentException: Dimensions (width=99999 height=99999) are too large&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3447&quot;&gt;&lt;del&gt;PDFBOX-3447&lt;/del&gt;&lt;/a&gt;-XStep99999.pdf: the pattern repetition at the top (didn&apos;t notice before, it is on top of the blue part) is gone&lt;/li&gt;
	&lt;li&gt;PDFJS-6496-XStep99999.pdf: the pattern repetition at the right (didn&apos;t notice before, the dotted line was double) is gone&lt;/li&gt;
	&lt;li&gt;PDFJS-7731-XStep99999.pdf: the pattern repetition at the bottom (easy to see) is gone&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;An even better solution for the future would be to paint patterns with big sizes only once, i.e. not use TexturePaint.&lt;/p&gt;</comment>
                            <comment id="15836320" author="tilman" created="Tue, 24 Jan 2017 17:06:25 +0000"  >&lt;p&gt;Snapshot will be at&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.5-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.5-SNAPSHOT/&lt;/a&gt;&lt;br/&gt;
within a few hours.&lt;/p&gt;</comment>
                            <comment id="15870296" author="jira-bot" created="Thu, 16 Feb 2017 17:11:02 +0000"  >&lt;p&gt;Commit 1783252 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1783252&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1783252&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3653&quot; title=&quot;NegativeArraySizeException thrown when converting PDF to Image (in TilingPaint.java)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3653&quot;&gt;&lt;del&gt;PDFBOX-3653&lt;/del&gt;&lt;/a&gt;: make max smaller and configurable&lt;/p&gt;</comment>
                            <comment id="15870297" author="jira-bot" created="Thu, 16 Feb 2017 17:11:06 +0000"  >&lt;p&gt;Commit 1783253 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1783253&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1783253&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3653&quot; title=&quot;NegativeArraySizeException thrown when converting PDF to Image (in TilingPaint.java)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3653&quot;&gt;&lt;del&gt;PDFBOX-3653&lt;/del&gt;&lt;/a&gt;: make max smaller and configurable&lt;/p&gt;</comment>
                            <comment id="15870302" author="tilman" created="Thu, 16 Feb 2017 17:11:58 +0000"  >&lt;p&gt;I&apos;ve reduced the number to 3000 (I got OOM exceptions when running my tests) and set a property so that if there is trouble people can change this without having to wait for a new version. Ghostscript has a similar problem and they have an option -dMaxPatternBitmap.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13083725">PDFBOX-3846</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12848232" name="PDFBOX-3653_reduced.pdf" size="6303" author="tilman" created="Thu, 19 Jan 2017 04:48:35 +0000"/>
                            <attachment id="12848070" name="PowerPoint-slides.pdf" size="1721828" author="emc" created="Wed, 18 Jan 2017 14:57:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 39 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38vmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>