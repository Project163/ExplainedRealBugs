<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:15:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5894] Problem loading FDF</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5894</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Loading the attached &lt;tt&gt;sticky-notes.fdf&lt;/tt&gt; produces incorrect results. PDFBox logs a bunch of errors like this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;15:59:55.131 [main] ERROR org.apache.pdfbox.cos.COSObject -- Can&apos;t dereference COSObject{6 0 R}
java.io.IOException: org.apache.pdfbox.io.RandomAccessReadBufferedFile already closed
&#160; &#160; at org.apache.pdfbox.io.RandomAccessReadBufferedFile.checkClosed(RandomAccessReadBufferedFile.java:266)
&#160; &#160; at org.apache.pdfbox.io.RandomAccessReadBufferedFile.getPosition(RandomAccessReadBufferedFile.java:118)
&#160; &#160; at org.apache.pdfbox.pdfparser.COSParser.dereferenceCOSObject(COSParser.java:623)
&#160; &#160; at org.apache.pdfbox.cos.COSObject.getObject(COSObject.java:117)
&#160; &#160; at org.apache.pdfbox.cos.COSDocument.getObjectsByType(COSDocument.java:273)
&#160; &#160; at org.apache.pdfbox.cos.COSDocument.getObjectsByType(COSDocument.java:255)
&#160; &#160; at org.apache.pdfbox.cos.COSDocument.getObjectsByType(COSDocument.java:241)
&#160; &#160; at PdfboxLoadFDFRegressionTest.main(PdfboxLoadFDFRegressionTest.java:16)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The issue seems to be that &lt;tt&gt;Loader.loadFDF&lt;/tt&gt; closes the &lt;tt&gt;RandomAccessReadBuffer&lt;/tt&gt; immediately after parsing, but the read buffer is still being used. A workaround is to make sure the read buffer is kept open until you&apos;re done with the &lt;tt&gt;FDFDocument&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Reproduction code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.Loader;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.cos.COSName;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.io.RandomAccessReadBuffer;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.pdfparser.FDFParser;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.file.Files;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.nio.file.Path;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;PdfboxLoadFDFRegressionTest {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; filename = &lt;span class=&quot;code-quote&quot;&gt;&quot;sticky-notes.fdf&quot;&lt;/span&gt;;

        &lt;span class=&quot;code-comment&quot;&gt;// broken:
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; fdf = Loader.loadFDF(filename)) {
            &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; annots = fdf.getDocument().getObjectsByType(COSName.ANNOT);
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(annots); &lt;span class=&quot;code-comment&quot;&gt;// []
&lt;/span&gt;        }

        &lt;span class=&quot;code-comment&quot;&gt;// workaround:
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; readBuffer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RandomAccessReadBuffer(Files.readAllBytes(Path.of(filename)));
             &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; fdf = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FDFParser(readBuffer).parse()) {
            &lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt; annots = fdf.getDocument().getObjectsByType(COSName.ANNOT);
            &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(annots); &lt;span class=&quot;code-comment&quot;&gt;// [COSObject{3 0 R}, COSObject{4 0 R}, COSObject{5 0 R}, COSObject{6 0 R}]
&lt;/span&gt;        }
    }
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13597271">PDFBOX-5894</key>
            <summary>Problem loading FDF</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="dwickern">Derek Wickern</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Oct 2024 23:15:33 +0000</created>
                <updated>Thu, 23 Jan 2025 19:00:07 +0000</updated>
                            <resolved>Fri, 1 Nov 2024 09:07:30 +0000</resolved>
                                    <version>3.0.3 PDFBox</version>
                                    <fixVersion>3.0.4 PDFBox</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17894420" author="tilman" created="Thu, 31 Oct 2024 04:53:17 +0000"  >&lt;p&gt;Indeed, the implementation of loadPDF and loadFDF are different in that aspect.&lt;/p&gt;</comment>
                            <comment id="17894472" author="jira-bot" created="Thu, 31 Oct 2024 07:58:36 +0000"  >&lt;p&gt;Commit 1921703 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1921703&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1921703&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5894&quot; title=&quot;Problem loading FDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5894&quot;&gt;&lt;del&gt;PDFBOX-5894&lt;/del&gt;&lt;/a&gt;: don&apos;t close prematurely, as suggested by Derek Wickern&lt;/p&gt;</comment>
                            <comment id="17894473" author="jira-bot" created="Thu, 31 Oct 2024 07:58:41 +0000"  >&lt;p&gt;Commit 1921704 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1921704&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1921704&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5894&quot; title=&quot;Problem loading FDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5894&quot;&gt;&lt;del&gt;PDFBOX-5894&lt;/del&gt;&lt;/a&gt;: don&apos;t close prematurely, as suggested by Derek Wickern&lt;/p&gt;</comment>
                            <comment id="17894478" author="jira-bot" created="Thu, 31 Oct 2024 08:09:46 +0000"  >&lt;p&gt;Commit 1921705 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1921705&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1921705&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5894&quot; title=&quot;Problem loading FDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5894&quot;&gt;&lt;del&gt;PDFBOX-5894&lt;/del&gt;&lt;/a&gt;: load test file&lt;/p&gt;</comment>
                            <comment id="17894480" author="jira-bot" created="Thu, 31 Oct 2024 08:10:23 +0000"  >&lt;p&gt;Commit 1921706 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1921706&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1921706&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5894&quot; title=&quot;Problem loading FDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5894&quot;&gt;&lt;del&gt;PDFBOX-5894&lt;/del&gt;&lt;/a&gt;: load test file&lt;/p&gt;</comment>
                            <comment id="17894482" author="jira-bot" created="Thu, 31 Oct 2024 08:16:51 +0000"  >&lt;p&gt;Commit 1921707 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1921707&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1921707&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5894&quot; title=&quot;Problem loading FDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5894&quot;&gt;&lt;del&gt;PDFBOX-5894&lt;/del&gt;&lt;/a&gt;: add test&lt;/p&gt;</comment>
                            <comment id="17894483" author="jira-bot" created="Thu, 31 Oct 2024 08:16:55 +0000"  >&lt;p&gt;Commit 1921708 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1921708&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1921708&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5894&quot; title=&quot;Problem loading FDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5894&quot;&gt;&lt;del&gt;PDFBOX-5894&lt;/del&gt;&lt;/a&gt;: add test&lt;/p&gt;</comment>
                            <comment id="17894485" author="tilman" created="Thu, 31 Oct 2024 08:24:54 +0000"  >&lt;p&gt;Thank you for reporting this. A snapshot will be available here soon:&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/3.0.4-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/3.0.4-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17894656" author="JIRAUSER303045" created="Thu, 31 Oct 2024 16:52:15 +0000"  >&lt;p&gt;There is an issue now that &lt;tt&gt;Loader.loadFDF(String)&lt;/tt&gt; and &lt;tt&gt;Loader.loadFDF(File)&lt;/tt&gt; overloads will leak a &lt;tt&gt;FileChannel&lt;/tt&gt;, because the &lt;tt&gt;RandomAccessReadBufferedFile&lt;/tt&gt; won&apos;t be closed.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;PDDocument&lt;/tt&gt; holds a reference to the &lt;tt&gt;RandomAccessRead&lt;/tt&gt; and closes it when the document is closed:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/pdfbox/blob/1ea3ae6fda8558a4a006f982d93a49ff53c89f19/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java#L1272&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/pdfbox/blob/1ea3ae6fda8558a4a006f982d93a49ff53c89f19/pdfbox/src/main/java/org/apache/pdfbox/pdmodel/PDDocument.java#L1272&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Maybe &lt;tt&gt;FDFDocument&lt;/tt&gt; should also keep a reference to the &lt;tt&gt;RandomAccessRead?&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="17894691" author="tilman" created="Thu, 31 Oct 2024 20:05:03 +0000"  >&lt;p&gt;Thanks. I have prepared something but I&apos;ll recheck it tomorrow.&lt;/p&gt;</comment>
                            <comment id="17894767" author="jira-bot" created="Fri, 1 Nov 2024 04:47:46 +0000"  >&lt;p&gt;Commit 1921731 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1921731&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1921731&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5894&quot; title=&quot;Problem loading FDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5894&quot;&gt;&lt;del&gt;PDFBOX-5894&lt;/del&gt;&lt;/a&gt;: keep and close the source, as suggested by Derek Wickern&lt;/p&gt;</comment>
                            <comment id="17894768" author="jira-bot" created="Fri, 1 Nov 2024 04:47:51 +0000"  >&lt;p&gt;Commit 1921732 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1921732&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1921732&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5894&quot; title=&quot;Problem loading FDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5894&quot;&gt;&lt;del&gt;PDFBOX-5894&lt;/del&gt;&lt;/a&gt;: keep and close the source, as suggested by Derek Wickern&lt;/p&gt;</comment>
                            <comment id="17894800" author="jira-bot" created="Fri, 1 Nov 2024 07:37:22 +0000"  >&lt;p&gt;Commit 1921733 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1921733&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1921733&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5894&quot; title=&quot;Problem loading FDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5894&quot;&gt;&lt;del&gt;PDFBOX-5894&lt;/del&gt;&lt;/a&gt;: remove deprecated, remove unneeded code&lt;/p&gt;</comment>
                            <comment id="17894816" author="tilman" created="Fri, 1 Nov 2024 09:07:30 +0000"  >&lt;p&gt;Thank you again. It should be fixed now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13072508" name="sticky-notes.fdf" size="1425" author="dwickern" created="Wed, 30 Oct 2024 23:12:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1saw8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>