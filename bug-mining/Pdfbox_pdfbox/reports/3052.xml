<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:15:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5966] Rendered PDF is missing shading pattern graphics</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5966</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Rendering pages from &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13075219/13075219_issuedFilePDF.pdf&quot; title=&quot;issuedFilePDF.pdf attached to PDFBOX-5966&quot;&gt;issuedFilePDF.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; (e.g. first page) results in missing shading pattern behind the line numbers.&lt;/p&gt;

&lt;p&gt;Expected: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13075217/13075217_screen-capture-issuedFilePDF-page1-acrobatreader.png&quot; title=&quot;screen-capture-issuedFilePDF-page1-acrobatreader.png attached to PDFBOX-5966&quot;&gt;screen-capture-issuedFilePDF-page1-acrobatreader.png&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Actual: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13075218/13075218_issuedFilePDF.pdf-page1.png&quot; title=&quot;issuedFilePDF.pdf-page1.png attached to PDFBOX-5966&quot;&gt;issuedFilePDF.pdf-page1.png&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] fileBytes = Files.readAllBytes(Paths.get(pdfPath));
DataInputStream data = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DataInputStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(fileBytes));
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDDocument pdfboxDocument = PDDocument.load(data)) {
  PDFRenderer renderer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFRenderer(pdfboxDocument);
  renderer.setImageDownscalingOptimizationThreshold(0.2f);
  BufferedImage bim = renderer.renderImageWithDPI(pageIndex, 72, ImageType.RGB);
  File outputFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(pngPath);
  ImageIO.write(bim, &lt;span class=&quot;code-quote&quot;&gt;&quot;png&quot;&lt;/span&gt;, outputFile);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is this incorrect pdfbox usage, or is this a pdfbox issue?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13610614">PDFBOX-5966</key>
            <summary>Rendered PDF is missing shading pattern graphics</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="accusoftrmcmullen">Roderick McMullen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Mar 2025 18:11:08 +0000</created>
                <updated>Thu, 24 Apr 2025 18:37:52 +0000</updated>
                            <resolved>Sun, 9 Mar 2025 12:48:17 +0000</resolved>
                                    <version>2.0.33</version>
                    <version>3.0.4 PDFBox</version>
                                    <fixVersion>2.0.34</fixVersion>
                    <fixVersion>3.0.5 PDFBox</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17932402" author="tilman" created="Tue, 4 Mar 2025 18:32:36 +0000"  >&lt;p&gt;PDFBox issue.&lt;/p&gt;

&lt;p&gt;Page 4 is special: it has segments that render properly and one that doesn&apos;t. Here&apos;s some reduced files:  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13075243/13075243_PDFBOX-5966-p4-reduced-good.pdf&quot; title=&quot;PDFBOX-5966-p4-reduced-good.pdf attached to PDFBOX-5966&quot;&gt;PDFBOX-5966-p4-reduced-good.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt;  &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13075244/13075244_PDFBOX-5966-p4-reduced-bad.pdf&quot; title=&quot;PDFBOX-5966-p4-reduced-bad.pdf attached to PDFBOX-5966&quot;&gt;PDFBOX-5966-p4-reduced-bad.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/13075335/13075335_PDFBOX-5966-p4-reduced-bad2.pdf&quot; title=&quot;PDFBOX-5966-p4-reduced-bad2.pdf attached to PDFBOX-5966&quot;&gt;PDFBOX-5966-p4-reduced-bad2.pdf&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;Sadly, the &quot;good&quot; file is uses a completely different strategy for the same color, so it won&apos;t help us.&lt;/p&gt;</comment>
                            <comment id="17933547" author="tilman" created="Sat, 8 Mar 2025 16:52:13 +0000"  >&lt;p&gt;My observations debugging this:&lt;/p&gt;

&lt;p&gt;In &lt;tt&gt;applySoftMaskToPaint&lt;/tt&gt; the image created contains a shading.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;transparencyGroup.getBounds()&lt;/tt&gt; returns &lt;tt&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;x=0.0,y=686.0,w=125.0,h=106.0&amp;#93;&lt;/span&gt;&lt;/tt&gt;. The y value has a bad influence in the &lt;tt&gt;SoftMaskSoftPaintContext.getRaster()&lt;/tt&gt; method (it is used for &lt;tt&gt;bboxDevice&lt;/tt&gt;), because there &lt;tt&gt;y1&lt;/tt&gt; becomes a negative value and the pixels are never within mask bounds.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;transparencyGroup.getBounds()&lt;/tt&gt; has a TODO comment, and seems also suspicious in that it uses the pageSize. Maybe that isn&apos;t correct when it&apos;s in a softmask nested in a pattern. Or maybe it&apos;s correct but the y-axis flip shouldn&apos;t be applied (&lt;tt&gt;flipTG&lt;/tt&gt; field).&lt;/p&gt;</comment>
                            <comment id="17933550" author="tilman" created="Sat, 8 Mar 2025 17:35:39 +0000"  >&lt;p&gt;Adjusting the code like this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (flipTG)
    r = 
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Rectangle2D.&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;(
                minX,
                minY,
                width,
                height);
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
     r = 
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Rectangle2D.&lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;(
                minX - pageSize.getLowerLeftX() * xformScalingFactorX,
                (pageSize.getLowerLeftY() + pageSize.getHeight()) * xformScalingFactorY - minY - height,
                width,
                height);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;fixes the problem and also &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5251&quot; title=&quot;Grey area appears white&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5251&quot;&gt;&lt;del&gt;PDFBOX-5251&lt;/del&gt;&lt;/a&gt;, &lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13075340/13075340_image-2025-03-08-19-10-23-360.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
and somewhat &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5852&quot; title=&quot;Hi CPU and memory usage when converting a PDF with type 4 shading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5852&quot;&gt;&lt;del&gt;PDFBOX-5852&lt;/del&gt;&lt;/a&gt; (ugly border). &lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13075339/13075339_image-2025-03-08-18-42-46-386.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;br/&gt;
&lt;a href=&quot;https://bugs.chromium.org/p/pdfium/issues/detail?id=1317&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PDFIUM-1317&lt;/a&gt; is differently wrong&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13075338/13075338_image-2025-03-08-18-43-00-444.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &lt;/p&gt;</comment>
                            <comment id="17933634" author="jira-bot" created="Sun, 9 Mar 2025 12:43:09 +0000"  >&lt;p&gt;Commit 1924245 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1924245&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1924245&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5966&quot; title=&quot;Rendered PDF is missing shading pattern graphics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5966&quot;&gt;&lt;del&gt;PDFBOX-5966&lt;/del&gt;&lt;/a&gt;: do y-axis flip only if flipTG isn&apos;t set&lt;/p&gt;</comment>
                            <comment id="17933635" author="jira-bot" created="Sun, 9 Mar 2025 12:43:12 +0000"  >&lt;p&gt;Commit 1924246 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1924246&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1924246&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5966&quot; title=&quot;Rendered PDF is missing shading pattern graphics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5966&quot;&gt;&lt;del&gt;PDFBOX-5966&lt;/del&gt;&lt;/a&gt;: do y-axis flip only if flipTG isn&apos;t set&lt;/p&gt;</comment>
                            <comment id="17933636" author="jira-bot" created="Sun, 9 Mar 2025 12:43:16 +0000"  >&lt;p&gt;Commit 1924247 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1924247&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1924247&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5966&quot; title=&quot;Rendered PDF is missing shading pattern graphics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5966&quot;&gt;&lt;del&gt;PDFBOX-5966&lt;/del&gt;&lt;/a&gt;: do y-axis flip only if flipTG isn&apos;t set&lt;/p&gt;</comment>
                            <comment id="17933638" author="tilman" created="Sun, 9 Mar 2025 12:48:17 +0000"  >&lt;p&gt;After sleeping over it I decided to commit the change because it&apos;s still better than what we had before, despite not being perfect. None of my test files is worse. If a user submits a file that renders worse I&apos;ll revert it. The comment in the code change hopefully indicates that there might still be work to do.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="13393319">PDFBOX-5251</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13075244" name="PDFBOX-5966-p4-reduced-bad.pdf" size="238598" author="tilman" created="Wed, 5 Mar 2025 12:03:53 +0000"/>
                            <attachment id="13075335" name="PDFBOX-5966-p4-reduced-bad2.pdf" size="5421" author="tilman" created="Sat, 8 Mar 2025 10:36:07 +0000"/>
                            <attachment id="13075243" name="PDFBOX-5966-p4-reduced-good.pdf" size="239005" author="tilman" created="Wed, 5 Mar 2025 12:03:53 +0000"/>
                            <attachment id="13075339" name="image-2025-03-08-18-42-46-386.png" size="8054" author="tilman" created="Sat, 8 Mar 2025 17:42:47 +0000"/>
                            <attachment id="13075338" name="image-2025-03-08-18-43-00-444.png" size="15081" author="tilman" created="Sat, 8 Mar 2025 17:43:01 +0000"/>
                            <attachment id="13075340" name="image-2025-03-08-19-10-23-360.png" size="33206" author="tilman" created="Sat, 8 Mar 2025 18:10:24 +0000"/>
                            <attachment id="13075219" name="issuedFilePDF.pdf" size="2678381" author="accusoftrmcmullen" created="Tue, 4 Mar 2025 18:06:16 +0000"/>
                            <attachment id="13075218" name="issuedFilePDF.pdf-page1.png" size="42491" author="accusoftrmcmullen" created="Tue, 4 Mar 2025 18:06:28 +0000"/>
                            <attachment id="13075217" name="screen-capture-issuedFilePDF-page1-acrobatreader.png" size="101007" author="accusoftrmcmullen" created="Tue, 4 Mar 2025 18:06:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ukf4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>