<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:04:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-3506] Not able to read the custom metadata in trailer section</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-3506</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;When using below code does not able to retrieve custom metadata stored in trailer section of pdf&lt;/p&gt;

&lt;p&gt;PDDocumentInformation documentInformation = document.getDocumentInformation();&lt;br/&gt;
		Set&amp;lt;String&amp;gt; customMetadataKeys = documentInformation.getMetadataKeys();&lt;/p&gt;

&lt;p&gt;Pdfbox 1.8.12 does not have this issues&lt;/p&gt;</description>
                <environment>Windows 7, PDF version 1.5</environment>
        <key id="13006373">PDFBOX-3506</key>
            <summary>Not able to read the custom metadata in trailer section</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="klee">Kent Lee</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Sep 2016 04:35:14 +0000</created>
                <updated>Sat, 25 Mar 2017 18:12:42 +0000</updated>
                            <resolved>Thu, 17 Nov 2016 18:00:44 +0000</resolved>
                                    <version>2.0.3</version>
                    <version>3.0.0 PDFBox</version>
                                    <fixVersion>2.0.4</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Parsing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15509400" author="klee" created="Wed, 21 Sep 2016 09:43:58 +0000"  >&lt;p&gt;Sample file attached!&lt;/p&gt;</comment>
                            <comment id="15510493" author="tilman" created="Wed, 21 Sep 2016 16:50:23 +0000"  >&lt;p&gt;Now I get it: you&apos;re missing /Classification, /bjDocumentLabelXML, /bjLabelRefreshRequired.&lt;/p&gt;

&lt;p&gt;The file has been updated, i.e. there are three versions of the /Info dictionary. The old parser (default in 1.8) took the last one, the nonSeq (and in 2.* only) parser takes the first one. The first one does not have the custom meta data mentioned, the last one has it.&lt;/p&gt;

&lt;p&gt;To demonstrate this, I changed the first character of the authors first name &quot;Paritosh&quot; to 1, 2 and 3. Adobe shows a &quot;3&quot;, and we show a &quot;1&quot;.&lt;/p&gt;

&lt;p&gt;The cause:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;xrefTrailerResolver.setXRef(objKey, currOffset);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is called twice with the same objKey (7 0 R) but different offsets.&lt;/p&gt;

&lt;p&gt;The cause is an XRefStm in each trailer. This results in a call to parseXrefStream, which does not reset the &lt;tt&gt;curXrefTrailerObj.xrefTable&lt;/tt&gt; map by calling &lt;tt&gt;xrefTrailerResolver.nextXrefObj&lt;/tt&gt;, per the comment&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-comment&quot;&gt;// the cross reference stream of a hybrid xref table will be added to the existing one
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// and we must not override the offset and the trailer&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;One solution would be to make a change in XrefTrailerResolver and insert elements only if they don&apos;t exist:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setXRef( COSObjectKey objKey, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; offset )
    {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( curXrefTrailerObj == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; )
        {
            &lt;span class=&quot;code-comment&quot;&gt;// should not happen...
&lt;/span&gt;            LOG.warn( &lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot add XRef entry &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&apos;&quot;&lt;/span&gt; + objKey.getNumber() + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt; because XRef start was not signalled.&quot;&lt;/span&gt; );
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!curXrefTrailerObj.xrefTable.containsKey(objKey)) &lt;span class=&quot;code-comment&quot;&gt;// NEW
&lt;/span&gt;        {
            curXrefTrailerObj.xrefTable.put(objKey, offset);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;i.e. entries from the table have a higher priority than entries from the XRefStm.&lt;/p&gt;</comment>
                            <comment id="15512635" author="klee" created="Thu, 22 Sep 2016 08:42:19 +0000"  >&lt;p&gt;Thanks for the quick reply. This fix is very critical to us, when we can expect the fix in a formal release?&lt;/p&gt;</comment>
                            <comment id="15513887" author="jira-bot" created="Thu, 22 Sep 2016 17:26:05 +0000"  >&lt;p&gt;Commit 1761981 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1761981&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1761981&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3506&quot; title=&quot;Not able to read the custom metadata in trailer section&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3506&quot;&gt;&lt;del&gt;PDFBOX-3506&lt;/del&gt;&lt;/a&gt;: check before adding to the map, to avoid entries from the table being overwritten by obsolete entries in hybrid files&lt;/p&gt;</comment>
                            <comment id="15513888" author="jira-bot" created="Thu, 22 Sep 2016 17:26:10 +0000"  >&lt;p&gt;Commit 1761982 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1761982&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1761982&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-3506&quot; title=&quot;Not able to read the custom metadata in trailer section&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-3506&quot;&gt;&lt;del&gt;PDFBOX-3506&lt;/del&gt;&lt;/a&gt;: check before adding to the map, to avoid entries from the table being overwritten by obsolete entries in hybrid files&lt;/p&gt;</comment>
                            <comment id="15513890" author="tilman" created="Thu, 22 Sep 2016 17:26:32 +0000"  >&lt;p&gt;I&apos;ve just committed the change. I&apos;d like &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lehmi&quot; class=&quot;user-hover&quot; rel=&quot;lehmi&quot;&gt;lehmi&lt;/a&gt; to have a look at it. The 2.0.3 version was released last week, so it will be a few months before the next version will be released. &lt;/p&gt;

&lt;p&gt;A snapshot will be available within a few hours here:&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.4-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.4-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15515567" author="lehmi" created="Fri, 23 Sep 2016 06:29:13 +0000"  >&lt;p&gt;I didn&apos;t have a look at the details yet, but I guess a possible solution maybe more complicated. As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; already found out it is a question of the right order of processing the different parts of xreftables/streams.&lt;/p&gt;</comment>
                            <comment id="15515623" author="msahyoun" created="Fri, 23 Sep 2016 06:56:33 +0000"  >&lt;p&gt;I&apos;d think that one of the main topics here is how to process a PDF with hybrid XRef stream/table. Hybrid Xrefs were introduced to allow 1.4x and earlier parsers to process the PDF using the ref table while 1.5 onwards should process and follow the xref stream. Normally there is no need to switch between these two so we either process the xref stream or the xref table.&lt;/p&gt;

&lt;p&gt;Having said that updating a PDF with hybrid ref information one would need to update both the stream and the table to keep them in sync.&lt;/p&gt;</comment>
                            <comment id="15516160" author="klee" created="Fri, 23 Sep 2016 11:21:31 +0000"  >&lt;p&gt;Thanks for the quick fixed. Tested 2.0.4 snapshot with few of files. Looking good and working as expected.&lt;/p&gt;</comment>
                            <comment id="15516786" author="tilman" created="Fri, 23 Sep 2016 15:40:24 +0000"  >&lt;p&gt;We do process both, and with this file, we must do so, because the /XRefStm is always the same: 81244.&lt;/p&gt;

&lt;p&gt;A slightly advanced strategy might be to make a check, i.e. to put in the map the offset that is the highest, but only if the offsets are positive. (Negative offsets are the object numbers of Object Streams)&lt;/p&gt;

&lt;p&gt;In the attached file, offset 83043 would have priority over offset 1016.&lt;/p&gt;

&lt;p&gt;Here&apos;s what&apos;s going on with the file. Note that it&apos;s going backwards, i.e. the first table here is the one at the bottom of the file.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;nextXrefObj() at offset 83707, type: TABLE
objKey: 7 0 R, offset: 83043 added to map
objKey: 1 0 R, offset: 17 added to map
objKey: 2 0 R, offset: 124 added to map
objKey: 3 0 R, offset: 180 added to map
objKey: 4 0 R, offset: 416 added to map
objKey: 5 0 R, offset: 609 added to map
objKey: 6 0 R, offset: 777 added to map
objKey: 7 0 R, offset: 1016 *** ignored ***
objKey: 8 0 R, offset: -14 added to map
objKey: 9 0 R, offset: -14 added to map
objKey: 10 0 R, offset: -14 added to map
objKey: 11 0 R, offset: -14 added to map
objKey: 12 0 R, offset: -14 added to map
objKey: 13 0 R, offset: -14 added to map
objKey: 14 0 R, offset: 1243 added to map
objKey: 15 0 R, offset: 1627 added to map
objKey: 16 0 R, offset: 1828 added to map
nextXrefObj() at offset 82841, type: TABLE
objKey: 7 0 R, offset: 82208 added to map
objKey: 1 0 R, offset: 17 added to map
objKey: 2 0 R, offset: 124 added to map
objKey: 3 0 R, offset: 180 added to map
objKey: 4 0 R, offset: 416 added to map
objKey: 5 0 R, offset: 609 added to map
objKey: 6 0 R, offset: 777 added to map
objKey: 7 0 R, offset: 1016 *** ignored ***
objKey: 8 0 R, offset: -14 added to map
objKey: 9 0 R, offset: -14 added to map
objKey: 10 0 R, offset: -14 added to map
objKey: 11 0 R, offset: -14 added to map
objKey: 12 0 R, offset: -14 added to map
objKey: 13 0 R, offset: -14 added to map
objKey: 14 0 R, offset: 1243 added to map
objKey: 15 0 R, offset: 1627 added to map
objKey: 16 0 R, offset: 1828 added to map
nextXrefObj() at offset 82030, type: TABLE
objKey: 1 0 R, offset: 17 added to map
objKey: 2 0 R, offset: 124 added to map
objKey: 3 0 R, offset: 180 added to map
objKey: 4 0 R, offset: 416 added to map
objKey: 5 0 R, offset: 609 added to map
objKey: 6 0 R, offset: 777 added to map
objKey: 7 0 R, offset: 1016 added to map
objKey: 8 0 R, offset: -14 added to map
objKey: 9 0 R, offset: -14 added to map
objKey: 10 0 R, offset: -14 added to map
objKey: 11 0 R, offset: -14 added to map
objKey: 12 0 R, offset: -14 added to map
objKey: 13 0 R, offset: -14 added to map
objKey: 14 0 R, offset: 1243 added to map
objKey: 15 0 R, offset: 1627 added to map
objKey: 16 0 R, offset: 1828 added to map
nextXrefObj() at offset 81514, type: TABLE
objKey: 1 0 R, offset: 17 added to map
objKey: 2 0 R, offset: 124 added to map
objKey: 3 0 R, offset: 180 added to map
objKey: 4 0 R, offset: 416 added to map
objKey: 5 0 R, offset: 609 added to map
objKey: 6 0 R, offset: 777 added to map
objKey: 7 0 R, offset: 1016 added to map
objKey: 15 0 R, offset: 1627 added to map
objKey: 16 0 R, offset: 1828 added to map
objKey: 17 0 R, offset: 81244 added to map
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I also had a look at a few files from the digitalcorpora site with many XRefStm entries, and these were always different.&lt;/p&gt;</comment>
                            <comment id="15578228" author="lehmi" created="Sat, 15 Oct 2016 14:47:55 +0000"  >&lt;p&gt;According to the spec Tilmans approach is exactly what we are supposed to do here:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;When a conforming reader opens a hybrid-reference file, objects with entries in cross-reference streams are&lt;br/&gt;
not hidden. When the conforming reader searches for an object, if an entry is not found in any given standard&lt;br/&gt;
cross-reference section, the search shall proceed to a cross-reference stream specified by the XRefStm entry&lt;br/&gt;
before looking in the previous cross-reference section (the Prev entry in the trailer).&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="15579528" author="msahyoun" created="Sun, 16 Oct 2016 07:39:21 +0000"  >&lt;p&gt;Yes, that&apos;s correct. The handling might be put behind a switch as it&apos;s assuming that we handle the processing like a 1.5+ conforming reader. Doing it like 1.4 and earlier the XrefStm wouldn&apos;t be available and as a result the objects are not available.  Now for whatever reason one would like to switch between both version e.g. to check how a 1.4 compliant rest would be.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12829614" name="PDFBOX-3506.pdf" size="83909" author="tilman" created="Wed, 21 Sep 2016 16:51:44 +0000"/>
                            <attachment id="12829535" name="test.pdf" size="83909" author="klee" created="Wed, 21 Sep 2016 09:43:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 4 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33vh3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>