<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:59:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-2660] Text missing</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-2660</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;java -jar ~/pdf-box-svn/app/target/pdfbox-app-2.0.0-SNAPSHOT.jar PDFToImage out2.pdf&lt;/p&gt;</description>
                <environment></environment>
        <key id="12772060">PDFBOX-2660</key>
            <summary>Text missing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jahewson">John Hewson</assignee>
                                    <reporter username="ssteiner">Simon Steiner</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Feb 2015 15:59:00 +0000</created>
                <updated>Thu, 17 Mar 2016 19:08:18 +0000</updated>
                            <resolved>Wed, 4 Feb 2015 21:22:50 +0000</resolved>
                                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>Rendering</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14304333" author="jahewson" created="Tue, 3 Feb 2015 23:50:11 +0000"  >&lt;p&gt;This is a weird PDF, the content stream is empty, except for marked content operators. The text itself is contained in form field annotations.&lt;/p&gt;</comment>
                            <comment id="14304348" author="msahyoun" created="Wed, 4 Feb 2015 00:05:13 +0000"  >&lt;p&gt;Seems to be a form with no boilerplate content, generated using Adobe LiveCycle Designer, with the XFA being removed. Has been processed by another PDF library.&lt;/p&gt;</comment>
                            <comment id="14304385" author="tilman" created="Wed, 4 Feb 2015 00:35:25 +0000"  >&lt;p&gt;It showed more in rev 1633472, but wasn&apos;t correct. Here&apos;s a reduced version that has only two of the annotations, 23 0 R 24 0 R. If I overwrite &quot;23 0 R&quot; with blanks, the other annotation can be seen.&lt;/p&gt;</comment>
                            <comment id="14304399" author="jira-bot" created="Wed, 4 Feb 2015 00:43:24 +0000"  >&lt;p&gt;Commit 1656958 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1656958&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1656958&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2660&quot; title=&quot;Text missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2660&quot;&gt;&lt;del&gt;PDFBOX-2660&lt;/del&gt;&lt;/a&gt;: Perform deep clone of clipping path&lt;/p&gt;</comment>
                            <comment id="14304401" author="jahewson" created="Wed, 4 Feb 2015 00:44:45 +0000"  >&lt;p&gt;I found the problem. When intersecting a clipping path with the graphics state, we call Area#clone(), however it creates a shallow copy, so the underling path gets clobbered if there are subsequent clipping operations.&lt;/p&gt;</comment>
                            <comment id="14304404" author="tilman" created="Wed, 4 Feb 2015 00:46:53 +0000"  >&lt;p&gt;I haven&apos;t looked at the latest change by John, maybe it is also a solution. I tried saving and reseting the graphics state, that solves it (too). The reduced file has the problem that the q and Q operator count doesn&apos;t match. But now I&apos;m going to sleep.&lt;/p&gt;</comment>
                            <comment id="14304406" author="jahewson" created="Wed, 4 Feb 2015 00:49:26 +0000"  >&lt;blockquote&gt;
&lt;p&gt;The reduced file has the problem that the q and Q operator count doesn&apos;t match.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We should probably try to address this too, as it&apos;s going to be a problem in general (if not in this specific instance).&lt;/p&gt;</comment>
                            <comment id="14304754" author="tilman" created="Wed, 4 Feb 2015 07:50:06 +0000"  >&lt;p&gt;Regression in gs-bugzilla694385.pdf, crestron-p9.pdf, gs-bugzilla691628.pdf, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2117&quot; title=&quot;AxialShadingContext is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2117&quot;&gt;&lt;del&gt;PDFBOX-2117&lt;/del&gt;&lt;/a&gt;-068519.pdf, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2307&quot; title=&quot;NPE in TrueTypeFont.getWidth&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2307&quot;&gt;&lt;del&gt;PDFBOX-2307&lt;/del&gt;&lt;/a&gt;-159827.pdf, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2359&quot; title=&quot;Lines show on top of image&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2359&quot;&gt;PDFBOX-2359&lt;/a&gt;.pdf, hsv-shading.pdf ... will do more tests to be sure that the cause is really 1656958.&lt;/p&gt;

&lt;p&gt;Btw hsv-shading.pdf is very sensitive to clipping problems... that one &quot;breaks easily&quot; when the clipping isn&apos;t done correctly, and did so several times in the past.&lt;/p&gt;</comment>
                            <comment id="14304779" author="jira-bot" created="Wed, 4 Feb 2015 08:28:22 +0000"  >&lt;p&gt;Commit 1657025 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1657025&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1657025&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2660&quot; title=&quot;Text missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2660&quot;&gt;&lt;del&gt;PDFBOX-2660&lt;/del&gt;&lt;/a&gt;: revert 1652678 because of regression&lt;/p&gt;</comment>
                            <comment id="14304780" author="tilman" created="Wed, 4 Feb 2015 08:30:45 +0000"  >&lt;p&gt;The cause is really 1656958, the regressions go away after the revert.&lt;/p&gt;</comment>
                            <comment id="14304960" author="tilman" created="Wed, 4 Feb 2015 11:12:59 +0000"  >&lt;p&gt;The file from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2521&quot; title=&quot;Don&amp;#39;t throw IOException if stream length is missing in lenient mode&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2521&quot;&gt;&lt;del&gt;PDFBOX-2521&lt;/del&gt;&lt;/a&gt;.pdf has the same problem.&lt;/p&gt;

&lt;p&gt;IMO the real solution would be to find a way save the graphics stack (and not just the graphics state), and start rendering the annotation with a new graphics stack, and restore the stack afterwards. Alternatively find a way to protect the graphics stack against &quot;too much pop&quot; and to restore the stack to a certain level if there weren&apos;t enough pop operations in a stream.&lt;/p&gt;

&lt;p&gt;This second best solution is this code in PageDrawer.showAnnotation that works for me and has no regressions (it replaces &quot;super.showAnnotation(annotation);&quot;), however it does not protect against &quot;too much pop&quot; (i.e. too many &quot;Q&quot; operators), only against &quot;not enough pop&quot; (i.e. not enough &quot;Q&quot; operators):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; oldGraphicsStackSize = getGraphicsStackSize();
            &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.showAnnotation(annotation);
            &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (getGraphicsStackSize() &amp;gt; oldGraphicsStackSize)
            {
                &lt;span class=&quot;code-comment&quot;&gt;// todo warning msg
&lt;/span&gt;                restoreGraphicsState();
            }
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (oldGraphicsStackSize != getGraphicsStackSize())
            {
                &lt;span class=&quot;code-comment&quot;&gt;// todo warning msg
&lt;/span&gt;            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14305908" author="jahewson" created="Wed, 4 Feb 2015 20:44:40 +0000"  >&lt;p&gt;Thanks Tilman, as soon as I saw your comment from yesterday I thought &quot;uh oh&quot;. I wonder if there really is a bug in the code which I identified though, I&apos;ll have to take a much closer look.&lt;/p&gt;</comment>
                            <comment id="14305919" author="jahewson" created="Wed, 4 Feb 2015 20:49:07 +0000"  >&lt;p&gt;Yep, there&apos;s a bigger problem here. We save and restore the stack in &lt;em&gt;lots&lt;/em&gt; of places in a similar manner and unbalanced save/restore operators in streams will break all of those cases too. There are cases where we can&apos;t use a new stack too, e.g. forms.&lt;/p&gt;

&lt;p&gt;The &quot;too much pop&quot; issue is a tricky one, we effectively have to give child streams their own graphics stack.&lt;/p&gt;</comment>
                            <comment id="14305986" author="jira-bot" created="Wed, 4 Feb 2015 21:19:31 +0000"  >&lt;p&gt;Commit 1657400 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jahewson&quot; class=&quot;user-hover&quot; rel=&quot;jahewson&quot;&gt;jahewson&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1657400&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1657400&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2660&quot; title=&quot;Text missing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2660&quot;&gt;&lt;del&gt;PDFBOX-2660&lt;/del&gt;&lt;/a&gt;: Save and restore the entire graphics stack when processing child streams&lt;/p&gt;</comment>
                            <comment id="14305987" author="jahewson" created="Wed, 4 Feb 2015 21:21:30 +0000"  >&lt;p&gt;This gives each child stream its own stack which is initialised with a clone of the top of its parent&apos;s stack, which protects against both &quot;too much&quot; and &quot;too little pop&quot;.&lt;/p&gt;</comment>
                            <comment id="14306009" author="jahewson" created="Wed, 4 Feb 2015 21:33:40 +0000"  >&lt;p&gt;Ok, I took a look at that code, I was right, there is a bug to do with clone() but there was a typo in my patch. It should have been &lt;tt&gt;cloned.add(clippingPath);&lt;/tt&gt; instead of &lt;tt&gt;cloned.add(area);&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;m going to open a new issue for this. --&amp;gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2668&quot; title=&quot;intersectClippingPath does a shallow copy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2668&quot;&gt;&lt;del&gt;PDFBOX-2668&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14306244" author="tilman" created="Wed, 4 Feb 2015 23:49:12 +0000"  >&lt;p&gt;Works!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12696332" name="PDFBOX-2660_unc.pdf" size="64360" author="tilman" created="Wed, 4 Feb 2015 00:35:25 +0000"/>
                            <attachment id="12696199" name="out2.pdf" size="63004" author="ssteiner" created="Tue, 3 Feb 2015 15:59:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i254p3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>