<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:13:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5489] Split result page missing dictionary after split</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5489</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Splitting the file from &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5488&quot; title=&quot;JPEG image rendered with wrong colors when using TwelveMonkeys&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5488&quot;&gt;&lt;del&gt;PDFBOX-5488&lt;/del&gt;&lt;/a&gt; brings up a useless page 2, parts of a dictionary is missing. (tested with the command line application)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13475778">PDFBOX-5489</key>
            <summary>Split result page missing dictionary after split</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="tilman">Tilman Hausherr</reporter>
                        <labels>
                    </labels>
                <created>Mon, 8 Aug 2022 15:51:26 +0000</created>
                <updated>Fri, 18 Aug 2023 05:46:16 +0000</updated>
                            <resolved>Sun, 16 Oct 2022 11:25:47 +0000</resolved>
                                    <version>3.0.0 PDFBox</version>
                                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Writing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17597842" author="jira-bot" created="Tue, 30 Aug 2022 12:31:30 +0000"  >&lt;p&gt;Commit 1903778 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1903778&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1903778&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5489&quot; title=&quot;Split result page missing dictionary after split&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5489&quot;&gt;&lt;del&gt;PDFBOX-5489&lt;/del&gt;&lt;/a&gt;: inherit highest xref object number from source document to avoid mixed up object numbers when saving the resulting file(s)&lt;/p&gt;</comment>
                            <comment id="17597845" author="lehmi" created="Tue, 30 Aug 2022 12:35:33 +0000"  >&lt;p&gt;The object numbers somehow got mixed up when saving the document for page 2. It is related to the delayed on demand loading of indirect objects. I&apos;ve simply fixed the issue by using the highest xref object number of the source document for all resulting pdfs so that PDFBox won&apos;t reuse an object number of an object if an imported page for a new object.&lt;/p&gt;</comment>
                            <comment id="17597956" author="tilman" created="Tue, 30 Aug 2022 15:54:43 +0000"  >&lt;p&gt;This change is kindof scary, because it means that an ordinary user would have to care for the xref object number if that user creates some code that uses importPage() .&lt;/p&gt;

&lt;p&gt;Can&apos;t this be done in COSWriter or in COSDocument somewhow?&lt;/p&gt;</comment>
                            <comment id="17598184" author="lehmi" created="Wed, 31 Aug 2022 05:49:14 +0000"  >&lt;p&gt;My solution seems to be the easiest solution to fix the issue but &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; is right, it is kind of scary. I&apos;ll try to find a way to determine the object numbers of the imported indirect objects so that the highest one can be used as intended in my origin fix.&lt;/p&gt;</comment>
                            <comment id="17598753" author="jira-bot" created="Thu, 1 Sep 2022 05:44:33 +0000"  >&lt;p&gt;Commit 1903800 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1903800&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1903800&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5489&quot; title=&quot;Split result page missing dictionary after split&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5489&quot;&gt;&lt;del&gt;PDFBOX-5489&lt;/del&gt;&lt;/a&gt;: revert changes from previous commit r1903778&lt;/p&gt;</comment>
                            <comment id="17605135" author="jira-bot" created="Thu, 15 Sep 2022 06:33:41 +0000"  >&lt;p&gt;Commit 1904086 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1904086&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1904086&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5489&quot; title=&quot;Split result page missing dictionary after split&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5489&quot;&gt;&lt;del&gt;PDFBOX-5489&lt;/del&gt;&lt;/a&gt;: get highest xref object number of an imported page to avoid mixed up object numbers when saving the resulting file(s)&lt;/p&gt;</comment>
                            <comment id="17605136" author="lehmi" created="Thu, 15 Sep 2022 06:35:03 +0000"  >&lt;p&gt;I&apos;ve found a (hopefully) better way to fix the issue. The idea is still the very same, but I moved the code to PDDocument.importPage&lt;/p&gt;</comment>
                            <comment id="17606278" author="tilman" created="Sun, 18 Sep 2022 11:22:15 +0000"  >&lt;p&gt;What still remains is that this is something non trivial that would happen to people joining parts of different PDFs without using importPages.&lt;/p&gt;</comment>
                            <comment id="17606279" author="lehmi" created="Sun, 18 Sep 2022 11:28:38 +0000"  >&lt;p&gt;Hmmm, do you have some particular sample? In the end merging pdfs is complicated and if people decide to use their own code they have to deal with such side effects. Or do you have any ideas how to handle such cases?&lt;/p&gt;</comment>
                            <comment id="17606281" author="tilman" created="Sun, 18 Sep 2022 11:35:37 +0000"  >&lt;p&gt;I don&apos;t have a sample.&lt;/p&gt;

&lt;p&gt;Can we call &lt;tt&gt;setHighestImportedObjectNumber(document)&lt;/tt&gt; i.e. on the result document itself when saving and if not, why not?&lt;/p&gt;</comment>
                            <comment id="17606289" author="lehmi" created="Sun, 18 Sep 2022 12:27:15 +0000"  >&lt;p&gt;Shouldn&apos;t be a problem, at least theoretically. One would need to find a way to scan the whole document for indirect objects and their object number. The question is, is there any negative impact on the processing time as it won&apos;t be necessary to do so in every case it is limited to merged pdfs.&lt;/p&gt;</comment>
                            <comment id="17606303" author="tilman" created="Sun, 18 Sep 2022 13:49:47 +0000"  >&lt;p&gt;I tried this with the file of &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4149&quot; title=&quot;PDF consisting on one page with 5 MB renders until the end of time using renderImageWithDPI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4149&quot;&gt;&lt;del&gt;PDFBOX-4149&lt;/del&gt;&lt;/a&gt; (and noticed I can&apos;t pass a document):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        PDDocument doc = Loader.loadPDF(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;PDFBOX-4149-veryslow.pdf&quot;&lt;/span&gt;));
        List&amp;lt;COSObjectKey&amp;gt; indirectObjectKeys = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; t0 = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
        doc.getDocumentCatalog().getCOSObject().getIndirectObjectKeys(indirectObjectKeys);
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; highestImportedNumber = indirectObjectKeys.stream().map(COSObjectKey::getNumber).max(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;::compare).get();
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(indirectObjectKeys.size());
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; t1 = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;highestImportedNumber: &quot;&lt;/span&gt; + highestImportedNumber);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println((t1-t0)/1000f);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The output is:&lt;/p&gt;

&lt;p&gt;2&lt;br/&gt;
highestImportedNumber: 3&lt;br/&gt;
0.038&lt;/p&gt;

&lt;p&gt;This is suspiciously low... looking at the code of &lt;tt&gt;getIndirectObjectKeys&lt;/tt&gt;, now I see you don&apos;t go through arrays.&lt;/p&gt;</comment>
                            <comment id="17606309" author="lehmi" created="Sun, 18 Sep 2022 14:08:05 +0000"  >&lt;blockquote&gt;
&lt;p&gt;This is suspiciously low... looking at the code of getIndirectObjectKeys, now I see you don&apos;t go through arrays.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Correct, I don&apos;t expect any within a page, maybe a wrong expectation?&lt;/p&gt;</comment>
                            <comment id="17606315" author="tilman" created="Sun, 18 Sep 2022 14:30:07 +0000"  >&lt;p&gt;annotations is an array. Some colorspaces too.&lt;/p&gt;</comment>
                            <comment id="17606322" author="lehmi" created="Sun, 18 Sep 2022 15:52:20 +0000"  >&lt;p&gt;I&apos;ll see if I can extend the code to arrays&lt;/p&gt;</comment>
                            <comment id="17609295" author="jira-bot" created="Mon, 26 Sep 2022 05:32:58 +0000"  >&lt;p&gt;Commit 1904257 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1904257&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1904257&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5489&quot; title=&quot;Split result page missing dictionary after split&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5489&quot;&gt;&lt;del&gt;PDFBOX-5489&lt;/del&gt;&lt;/a&gt;: don&apos;t copy parent reference, avoid NoSuchElementException&lt;/p&gt;</comment>
                            <comment id="17616213" author="jira-bot" created="Wed, 12 Oct 2022 06:23:32 +0000"  >&lt;p&gt;Commit 1904541 from lehmi@apache.org in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1904541&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1904541&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5489&quot; title=&quot;Split result page missing dictionary after split&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5489&quot;&gt;&lt;del&gt;PDFBOX-5489&lt;/del&gt;&lt;/a&gt;: include COSArrays when searching for indirect object numbers&lt;/p&gt;</comment>
                            <comment id="17618254" author="lehmi" created="Sun, 16 Oct 2022 11:25:47 +0000"  >&lt;p&gt;I&apos;ve extended the search to include COSArrays as well.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; thanks for the review and input&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13047884" name="PDFBOX-5489-p2.pdf" size="1192" author="tilman" created="Mon, 8 Aug 2022 15:51:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 3 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z17kw8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>