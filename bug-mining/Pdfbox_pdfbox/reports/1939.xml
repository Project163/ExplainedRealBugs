<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:07:15 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-4151] FlateFilter, LZWFilter with predictor causes double memory usage</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-4151</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The problem occurred in our production during processing file with size 400kB. The file was generated by the scanner with resolution 5960 x 8430 pixels with 8 bit per pixel (unfortunately we have no control over files which should be processed). Our analysis showed that problem is in FlateFilter.decode where uncompressed data are written into ByteArrayOutputStream. Since the final size of the file is unknown to OutputStream its size is growing by internal call Arrays.copyOf. By the end of processing file, this leads to usage of memory at two times file size.&lt;/p&gt;

&lt;p&gt;What we have tried and helped in our case was slightly modification of FlateFilter and LZWFilter decode method implementation. Here is the code snippet of original method body:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; DecodeResult decode(InputStream encoded, OutputStream decoded,
COSDictionary parameters, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; index) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
{
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; predictor = -1;

&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; COSDictionary decodeParams = getDecodeParams(parameters, index);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (decodeParams != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
{
predictor = decodeParams.getInt(COSName.PREDICTOR);
}

&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
{
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (predictor &amp;gt; 1)
{
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; colors = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(decodeParams.getInt(COSName.COLORS, 1), 32);
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; bitsPerPixel = decodeParams.getInt(COSName.BITS_PER_COMPONENT, 8);
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; columns = decodeParams.getInt(COSName.COLUMNS, 1);
ByteArrayOutputStream baos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream();
decompress(encoded, baos);
ByteArrayInputStream bais = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayInputStream(baos.toByteArray());
Predictor.decodePredictor(predictor, colors, bitsPerPixel, columns, bais, decoded);
decoded.flush();
baos.reset();
bais.reset();
}
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
{
decompress(encoded, decoded);
}
} 
&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (DataFormatException e)
{
&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the stream is corrupt a DataFormatException may occur
&lt;/span&gt;LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;FlateFilter: stop reading corrupt stream due to a DataFormatException&quot;&lt;/span&gt;);

&lt;span class=&quot;code-comment&quot;&gt;// re-&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; the exception
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(e);
}
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DecodeResult(parameters);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and here is our implementation:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; DecodeResult decode(InputStream encoded, OutputStream decoded,
                                         COSDictionary parameters, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; index) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
    {
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; COSDictionary decodeParams = getDecodeParams(parameters, index);
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; predictor = decodeParams.getInt(COSName.PREDICTOR);

        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;
        {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (predictor &amp;gt; 1)
            {
            	File tempFile = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
                FileOutputStream fos = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
                FileInputStream fis = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; colors = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(decodeParams.getInt(COSName.COLORS, 1), 32);
                	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; bitsPerPixel = decodeParams.getInt(COSName.BITS_PER_COMPONENT, 8);
                	&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; columns = decodeParams.getInt(COSName.COLUMNS, 1);
                	tempFile = File.createTempFile(&lt;span class=&quot;code-quote&quot;&gt;&quot;tmpPdf&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
                	fos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileOutputStream(tempFile);
                	decompress(encoded, fos);
                	fos.close();
                	fis = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(tempFile);
                	Predictor.decodePredictor(predictor, colors, bitsPerPixel, columns, fis, decoded);
                	decoded.flush();
                } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
                	IOUtils.closeQuietly(fos);
                	IOUtils.closeQuietly(fis);
                	&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; { 
                		&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; to delete but don&apos;t care &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it fails
&lt;/span&gt;						tempFile.delete();
					} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(Exception e) {
						LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Could not delete temp data file&quot;&lt;/span&gt;, e);
					}
                }
            }
            &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;
            {
                decompress(encoded, decoded);
            }
        } 
        &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (DataFormatException e)
        {
            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the stream is corrupt a DataFormatException may occur
&lt;/span&gt;            LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;FlateFilter: stop reading corrupt stream due to a DataFormatException&quot;&lt;/span&gt;);

            &lt;span class=&quot;code-comment&quot;&gt;// re-&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; the exception
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(e);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DecodeResult(parameters);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The picture OriginalFilters.png shows memory usage during processing this file with unmodified filters and the picture ModifiedFilters.png shows memory usage during processing same file with modified filters.&lt;/p&gt;

&lt;p&gt;For testing purposes, we have created two small applications with same Main class and Main method, but different libraries used (one, called TestOriginalFilters uses Filters implementation without any change and the second one called TestModifiedFilters uses Filters with our modification). Since original document contains personal data, we propose given file&#160;(TEST.pdf) with an almost same resolution for internal testing. The application waits for 10 seconds before starting file processing to ensure enough time for starting jvisualvm. The application is also prepared for multi-page documents. The application MainTest class:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; test;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.awt.Dimension;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.awt.image.BufferedImage;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.File;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.ArrayList;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.List;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.swing.ImageIcon;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.swing.JLabel;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.io.MemoryUsageSetting;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.pdmodel.PDDocument;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.rendering.PDFRenderer;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;MainTest {

	&lt;span class=&quot;code-comment&quot;&gt;// This is simple test &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; amount of memory consumption by PDFBox library
&lt;/span&gt;	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {

		&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (args.length != 1) {
			&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;File is needed to &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;&quot;&lt;/span&gt;);
		}

		&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; fileName = args[0];

		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;start sleep &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 10 second to start jvisualvm&quot;&lt;/span&gt;);
			&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(10000);
			&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;sleep is over&quot;&lt;/span&gt;);
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
			e.printStackTrace();
		}

		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
			File dataFile = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(fileName);
			PDDocument document = PDDocument.load(dataFile, MemoryUsageSetting.setupMixed(64 * 1024));
			&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; pages = document.getNumberOfPages();
			PDFRenderer renderer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFRenderer(document);
			List&amp;lt;BufferedImage&amp;gt; images = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
			&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; j = 0; j &amp;lt; pages; j++) {
				&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Procesing page with index: &quot;&lt;/span&gt; + j);
				&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; startime = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime();
				BufferedImage image = renderer.renderImage(j, computeZoomFactor(document, j, 500));
				&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Page with index: &quot;&lt;/span&gt; + j + &lt;span class=&quot;code-quote&quot;&gt;&quot; done in &quot;&lt;/span&gt; + ((&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.nanoTime() - startime)) / 1000000);
				JLabel result = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JLabel(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ImageIcon(image));
				result.setPreferredSize(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Dimension(image.getWidth(), image.getHeight()));
				images.add(image);
			}

			&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Processing finished&quot;&lt;/span&gt;);
		} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {
			ioe.printStackTrace();
		}

	}

	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; computeZoomFactor(PDDocument document, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; pageIndex, &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; width) {
		&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; docWidth = document.getPage(pageIndex).getCropBox().getWidth();
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; width &amp;gt; 0 ? (width / docWidth) : 1.0f;
	}

}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13144748">PDFBOX-4151</key>
            <summary>FlateFilter, LZWFilter with predictor causes double memory usage</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="marekpribula">Marek Pribula</reporter>
                        <labels>
                            <label>Optimization</label>
                            <label>Predictor</label>
                    </labels>
                <created>Tue, 13 Mar 2018 14:40:41 +0000</created>
                <updated>Thu, 21 Jun 2018 20:27:58 +0000</updated>
                            <resolved>Sat, 24 Mar 2018 12:39:22 +0000</resolved>
                                    <version>2.0.8</version>
                                    <fixVersion>2.0.10</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16397352" author="tilman" created="Tue, 13 Mar 2018 17:44:37 +0000"  >&lt;p&gt;1) Please tell what version you&apos;re using&lt;/p&gt;

&lt;p&gt;2) We can&apos;t use your patch. It writes into a temp directory. This will make things slower. You can have that without making a change, by using a scratch file when opening your document.&lt;/p&gt;

&lt;p&gt;3) In upcoming version 2.0.9 you can turn on subsampling in the PDFRenderer class. This will reduce memory usage.&lt;/p&gt;</comment>
                            <comment id="16398371" author="marekpribula" created="Wed, 14 Mar 2018 10:30:11 +0000"  >&lt;p&gt;1) Currently, we are using 2.0.7.&lt;/p&gt;

&lt;p&gt;2) We are using scratch files in our production, but I am not sure it would help with filters since they allocate double size of the original file.&lt;/p&gt;

&lt;p&gt;3) Subsampling sounds very good, that could work for us. Can you please tell me when is planned the release of 2.0.9? Is there any beta version with this feature so we can start testing it and see the real impact (for example on the file we had the problem with). Thank you very much.&lt;/p&gt;</comment>
                            <comment id="16398382" author="itai" created="Wed, 14 Mar 2018 10:51:25 +0000"  >&lt;p&gt;Note that the subsampling in filters is implemented only for JPEG (DCT), JBIG2000 and JPX, as it relies on ImageIO subsampling. Since Flate and LZW can&#160;be used for non-images, and since at the filter level they have no real image-decoding mechanisms, they ignore subsampling options. I believe I pointed it in my original mail about the subsampling feature, but I may have neglected to point it out in the actual issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4137&quot; title=&quot;Allow subsampled/downscaled rendering of images, and rendering subimages &quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4137&quot;&gt;&lt;del&gt;PDFBOX-4137&lt;/del&gt;&lt;/a&gt;)&#160; .&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;SampledImageReader&lt;/tt&gt; would still allocate a smaller &lt;tt&gt;BufferedImage&lt;/tt&gt;&#160;if subsampling is enabled and used (and will effectively perform the subsampling itself), but the memory and time savings won&apos;t be as dramatic as in the case of JPEG, JBIG2000 and JPX streams.&#160;&#160;&lt;/p&gt;

&lt;p&gt;Edit: Actually, it looks like it may be possible (but not very simple) to implement subsampling inside the &lt;tt&gt;Predictor&lt;/tt&gt; class. But looking at the file attached here (TEST.pdf) - it has a JPEG (DCT-encoded) image, so subsampling does help in both memory and processing time when rendering it (if used). I&apos;m confused as to how the change in &lt;tt&gt;FlateFilter&lt;/tt&gt; affects it, though.&#160;&lt;/p&gt;</comment>
                            <comment id="16398903" author="tilman" created="Wed, 14 Mar 2018 17:07:15 +0000"  >&lt;p&gt;It&apos;s like &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=itai&quot; class=&quot;user-hover&quot; rel=&quot;itai&quot;&gt;itai&lt;/a&gt; wrote, you&apos;ll still have the memory usage you complain about, but you&apos;ll save memory elsewhere.&lt;/p&gt;

&lt;p&gt;A snapshot can be found here:&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.9-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.9-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We&apos;re currently doing pre-release tests and fixing one last bug, so the new version should come within a few weeks. Please try also 2.0.8, each version is better than the one before.&lt;/p&gt;</comment>
                            <comment id="16400205" author="itai" created="Thu, 15 Mar 2018 10:51:13 +0000"  >&lt;p&gt;I&apos;m attaching a patch making &lt;tt&gt;Predictor&lt;/tt&gt; implemented as a stream, so no extra byte-array streams would be created. I have tested it on a few files, but I saw no notable&#160;differences&#160;in either speed or memory footprint, as I couldn&apos;t find PDF files with really huge Flate or LZW encoded images which have a predictor (biggest I could find was ~1800x600 pixels, or just over 3MB, which I&apos;m assuming would be hardly noticeable).&#160;&lt;/p&gt;

&lt;p&gt;It would be nice to test it on some really big images, but I don&apos;t know where&#160;I could find such examples.&#160;&lt;/p&gt;

&lt;p&gt;P.S: While working on it, I noticed in &lt;tt&gt;FlateFilter&lt;/tt&gt; there is the constant &lt;tt&gt;int BUFFER_SIZE = 16348&lt;/tt&gt; - I&apos;m assuming it&apos;s a typo, and should be 16384 = 2^14^ ?&#160;&#160;&lt;/p&gt;</comment>
                            <comment id="16400568" author="marekpribula" created="Thu, 15 Mar 2018 15:23:00 +0000"  >&lt;p&gt;The subsampling helps with our problem file - the memory usage gets to the half of the previous values. But I am also confused why is it&#160;because changes in Filters play no role.&lt;/p&gt;

&lt;p&gt;I have also tested supplied patch with this file. My results are same as was mentioned. The memory usage and also&#160;time consumption&#160;are same (or at least without notable changes) in comparison to using only subsampling.&#160;&lt;/p&gt;

&lt;p&gt;Thank you for information about new version release and also for snapshot. We are going to test it within our production application and hopefully it will help as have showned&#160;my previous test.&lt;/p&gt;</comment>
                            <comment id="16400569" author="marekpribula" created="Thu, 15 Mar 2018 15:23:38 +0000"  >&lt;p&gt;The subsampling helps with our problem file - the memory usage gets to the half of the previous values. But I am also confused why is it&#160;because changes in Filters play no role.&lt;/p&gt;

&lt;p&gt;I have also tested supplied a patch with this file. My results are same as was mentioned. The memory usage and also&#160;time consumption&#160;is same (or at least without notable changes) in comparison to using only subsampling.&#160;&lt;/p&gt;

&lt;p&gt;Thank you for information about new version release and also for the snapshot. We are going to test it within our production application and hopefully, it will help as have shown&#160;my previous test.&lt;/p&gt;</comment>
                            <comment id="16400744" author="tilman" created="Thu, 15 Mar 2018 17:05:05 +0000"  >&lt;p&gt;gs-bugzilla690022.pdf is a file that should have a large stream with predictor.&lt;/p&gt;</comment>
                            <comment id="16400811" author="tilman" created="Thu, 15 Mar 2018 17:39:56 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=itai&quot; class=&quot;user-hover&quot; rel=&quot;itai&quot;&gt;itai&lt;/a&gt; for the patch which sounds interesting, but which I would only use if there&apos;s an improvement with the memory footprint.&lt;/p&gt;

&lt;p&gt;I get a rendering difference with two files:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;pop-bugzilla93476.pdf&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-2554&quot; title=&quot;Stars in wrong place&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-2554&quot;&gt;&lt;del&gt;PDFBOX-2554&lt;/del&gt;&lt;/a&gt;-cmykrasterobjecttypes.pdf&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In the first one, I suspect that the object is &lt;tt&gt;Root/Pages/Kids/&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;/Resources/XObject/Fm3/Resources/XObject/Fm2/Resources/XObject/Im1/SMask&lt;/tt&gt;. From the way it looks, it is probably an incorrect stream, the original issue ( &lt;a href=&quot;https://bugs.freedesktop.org/show_bug.cgi?id=93476&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.freedesktop.org/show_bug.cgi?id=93476&lt;/a&gt; ) mentions fuzzing. For the second file I can&apos;t tell where it is.&lt;/p&gt;</comment>
                            <comment id="16400826" author="tilman" created="Thu, 15 Mar 2018 17:49:10 +0000"  >&lt;p&gt;I&apos;ve changed the constant in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4071&quot; title=&quot;Improve code quality (3)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4071&quot;&gt;&lt;del&gt;PDFBOX-4071&lt;/del&gt;&lt;/a&gt;, thanks.&lt;/p&gt;</comment>
                            <comment id="16400974" author="itai" created="Thu, 15 Mar 2018 19:10:05 +0000"  >&lt;p&gt;Can you clarify which file you mean by &quot;pop-bugzilla93476.pdf&quot;? The attachment in the linked issue has a few PDF files in it (although they may be all the same?), but all of them completely fail to render for me, on both patched trunk and 2.0.8 , both with the same error: &quot;java.util.concurrent.ExecutionException: java.awt.image.RasterFormatException: (y + height) is outside raster&quot;.&#160;&lt;/p&gt;</comment>
                            <comment id="16400986" author="tilman" created="Thu, 15 Mar 2018 19:20:14 +0000"  >&lt;p&gt;Sorry I forgot to attach these files. Re the error message, try the twelvemonkeys jpg plugin:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;dependency&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;groupId&amp;gt;&lt;/span&gt;com.twelvemonkeys.imageio&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/groupId&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;artifactId&amp;gt;&lt;/span&gt;imageio-jpeg&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/artifactId&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;version&amp;gt;&lt;/span&gt;3.3.2&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/version&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/dependency&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16400992" author="tilman" created="Thu, 15 Mar 2018 19:24:19 +0000"  >&lt;p&gt;Oops, I see what you meant, you used the link. Please use the files I attached. I don&apos;t know which of the files from the original 7z file I used. Sorry for the confusion. It should work without the twelvemonkeys plugin, although the plugin helps elsewhere.&lt;/p&gt;</comment>
                            <comment id="16401144" author="itai" created="Thu, 15 Mar 2018 21:39:22 +0000"  >&lt;p&gt;The issue with the file not rendering apparently has something to do with the JRE I&apos;m using - it fails to render (with or without twelvemonkeys) with OpenJDK 1.8.0_151, but renders fine with Oracle&apos;s 9.0.4.&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m attaching a revised patch. The differences in rendering probably resulted from two bugs -&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;I did not account for the last row being allowed to be shorter, and needing to be padded with zeroes.&#160;&lt;/li&gt;
	&lt;li&gt;The file&#160;pop-bugzilla93476.pdf is almost certainly corrupted, as at some point the predictor values it produces are 45 then 9. In the current implementation this would be ignored, but in my patch that resulted in resetting the &quot;different predictor per row&quot; option. I have changed the code so it should match the current implementation.&#160;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;As per&#160;any improvements - rendering time seems virtually unchanged, while memory can be slightly improved (possibly depending on when the JVM decides to GC?). The best results I&apos;ve seen were when making sure there was enough heap space for the entire render operation to complete without any GC runs (which is possibly when saving memory is least important?). Here is the code I used to test this (using the suggested test case &quot;gs-bugzilla690022.pdf&quot;):&#160;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; ntest = 20;
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; t = 0;
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; m = 0;
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt;= ntest; i++) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDDocument doc = PDDocument.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;gs-bugzilla690022.pdf&quot;&lt;/span&gt;))) {
            PDFRenderer renderer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDFRenderer(doc);
            renderer.setSubsamplingAllowed(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
            &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; s = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
            renderer.renderImage(0);
            &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; e = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
            &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; memused = &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.getRuntime().totalMemory() - &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.getRuntime().freeMemory();

            &lt;span class=&quot;code-comment&quot;&gt;// discard first run (warmup?)
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i &amp;gt; 0) {
                m += memused;
                t += (e - s);
            }
        }
        &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.getRuntime().gc();
    }
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.printf(&lt;span class=&quot;code-quote&quot;&gt;&quot;Time: %dms, Mem: %dMB%n&quot;&lt;/span&gt;, t / ntest, m / (ntest * 1024 * 1024));
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.exit(0);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For the original version, the results were &quot;Time: 3565ms, Mem: 1616MB&quot;, while with the patched version they are &quot;Time: 3556ms, Mem: 1222MB&quot;. This is when running with &lt;tt&gt;-Xms2g&lt;/tt&gt; or more.&#160;With smaller values the results were much less conclusive.&#160;&lt;/p&gt;

&lt;p&gt;I understand if this is not conclusive enough to merit a change, I mainly did it out of personal interest.&#160;&lt;/p&gt;</comment>
                            <comment id="16401886" author="itai" created="Fri, 16 Mar 2018 13:26:59 +0000"  >&lt;p&gt;Followup on the rendering issue - it was most probably this Java bug: &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8048782&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.openjdk.java.net/browse/JDK-8048782&lt;/a&gt;&#160; so the solution is to either use Oracle JRE or Java&amp;gt;=9.&#160;&lt;/p&gt;</comment>
                            <comment id="16402217" author="tilman" created="Fri, 16 Mar 2018 17:21:27 +0000"  >&lt;p&gt;Your revised patch now works fine, thank. I tested by changing the &lt;tt&gt;-Xmx&lt;/tt&gt; values. With the trunk, it worked with &lt;tt&gt;-Xmx420m&lt;/tt&gt; and not with &lt;tt&gt;-Xmx410m&lt;/tt&gt;. With your change, it worked with &lt;tt&gt;-Xmx380m&lt;/tt&gt; and not with &lt;tt&gt;-Xmx370m&lt;/tt&gt;. So we&apos;re saving around 40MB.&lt;/p&gt;

&lt;p&gt;Next thing I&apos;ll do is to review this... If I commit this change, I&apos;ll wait after the release of 2.0.9 (which is currently planned for next week), I&apos;m getting more and scared of doing last minute changes...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=marekpribula&quot; class=&quot;user-hover&quot; rel=&quot;marekpribula&quot;&gt;marekpribula&lt;/a&gt; wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The subsampling helps with our problem file - the memory usage gets to the half of the previous values. But I am also confused why is it because changes in Filters play no role.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It helps because the result images get smaller.&lt;/p&gt;</comment>
                            <comment id="16412575" author="jira-bot" created="Sat, 24 Mar 2018 12:13:34 +0000"  >&lt;p&gt;Commit 1827637 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
 [ &lt;a href=&quot;https://svn.apache.org/r1827637&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1827637&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4071&quot; title=&quot;Improve code quality (3)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4071&quot;&gt;&lt;del&gt;PDFBOX-4071&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4151&quot; title=&quot;FlateFilter, LZWFilter with predictor causes double memory usage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4151&quot;&gt;&lt;del&gt;PDFBOX-4151&lt;/del&gt;&lt;/a&gt;: avoid potential ClassCastException, avoid returning null (see trunk rev 1824680)&lt;/p&gt;</comment>
                            <comment id="16412584" author="jira-bot" created="Sat, 24 Mar 2018 12:33:30 +0000"  >&lt;p&gt;Commit 1827641 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1827641&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1827641&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4151&quot; title=&quot;FlateFilter, LZWFilter with predictor causes double memory usage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4151&quot;&gt;&lt;del&gt;PDFBOX-4151&lt;/del&gt;&lt;/a&gt;: avoid double memory usage with predictor, by Itai Shaked&lt;/p&gt;</comment>
                            <comment id="16412585" author="jira-bot" created="Sat, 24 Mar 2018 12:33:36 +0000"  >&lt;p&gt;Commit 1827642 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1827642&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1827642&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4151&quot; title=&quot;FlateFilter, LZWFilter with predictor causes double memory usage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4151&quot;&gt;&lt;del&gt;PDFBOX-4151&lt;/del&gt;&lt;/a&gt;: avoid double memory usage with predictor, by Itai Shaked&lt;/p&gt;</comment>
                            <comment id="16412586" author="jira-bot" created="Sat, 24 Mar 2018 12:34:38 +0000"  >&lt;p&gt;Commit 1827643 from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1827643&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1827643&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4151&quot; title=&quot;FlateFilter, LZWFilter with predictor causes double memory usage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4151&quot;&gt;&lt;del&gt;PDFBOX-4151&lt;/del&gt;&lt;/a&gt;: remove unused imports&lt;/p&gt;</comment>
                            <comment id="16412589" author="tilman" created="Sat, 24 Mar 2018 12:39:22 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=itai&quot; class=&quot;user-hover&quot; rel=&quot;itai&quot;&gt;itai&lt;/a&gt;!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310361">
                    <name>Blocked</name>
                                            <outwardlinks description="Blocked">
                                        <issuelink>
            <issuekey id="13024384">PDFBOX-3606</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12914284" name="ModifiedFilters.png" size="173695" author="marekpribula" created="Tue, 13 Mar 2018 14:41:39 +0000"/>
                            <attachment id="12914285" name="OriginalFilters.png" size="161377" author="marekpribula" created="Tue, 13 Mar 2018 14:41:39 +0000"/>
                            <attachment id="12914767" name="PDFBOX-2554-cmykrasterobjecttypes.pdf" size="513522" author="tilman" created="Thu, 15 Mar 2018 19:18:28 +0000"/>
                            <attachment id="12915156" name="PDFJS-9581-hugeimage.pdf" size="651496" author="tilman" created="Mon, 19 Mar 2018 16:44:04 +0000"/>
                            <attachment id="12914283" name="TEST.pdf" size="503124" author="marekpribula" created="Tue, 13 Mar 2018 14:41:29 +0000"/>
                            <attachment id="12914746" name="gs-bugzilla690022.pdf" size="5270658" author="tilman" created="Thu, 15 Mar 2018 17:41:22 +0000"/>
                            <attachment id="12914766" name="pop-bugzilla93476.pdf" size="110360" author="tilman" created="Thu, 15 Mar 2018 19:16:01 +0000"/>
                            <attachment id="12914682" name="predictor_stream.patch" size="28075" author="itai" created="Thu, 15 Mar 2018 10:49:24 +0000"/>
                            <attachment id="12914787" name="predictor_stream_rev2.patch" size="28778" author="itai" created="Thu, 15 Mar 2018 21:38:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3r8kn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>