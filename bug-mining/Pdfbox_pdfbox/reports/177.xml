<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:53:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1088] Class PDDocument Method getPageMap returns a ClassCastException</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1088</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;Trying to get the map of bookmarks to page numbers by using method getPageMap but throws a java.lang.ClassCastException: org.apache.pdfbox.pdmodel.PDPage&lt;/p&gt;</description>
                <environment>Windows XP </environment>
        <key id="12518591">PDFBOX-1088</key>
            <summary>Class PDDocument Method getPageMap returns a ClassCastException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lehmi">Andreas Lehmk&#252;hler</assignee>
                                    <reporter username="nnkfws333">Nghi Nguyen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Aug 2011 13:59:59 +0000</created>
                <updated>Tue, 29 May 2012 16:21:46 +0000</updated>
                            <resolved>Tue, 20 Sep 2011 20:27:05 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.7.0</fixVersion>
                                    <component>PDModel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13084636" author="msahyoun" created="Sat, 13 Aug 2011 16:27:19 +0000"  >&lt;p&gt;Patch for generating the pageMap&lt;/p&gt;</comment>
                            <comment id="13084637" author="msahyoun" created="Sat, 13 Aug 2011 16:28:02 +0000"  >&lt;p&gt;Added a patch for generating the pageMap. The main issue was that neither PDPageNode nor PDPage can be casted to COSObject which is neccesary to get to teh objectNumber. The patch works by goinf through the dictionary associated with PDPageNode objects.&lt;/p&gt;</comment>
                            <comment id="13090483" author="nnkfws333" created="Wed, 24 Aug 2011 21:02:42 +0000"  >&lt;p&gt;I will test it right now. If it works, do I need to do anything to push this to version 1.7?&lt;/p&gt;</comment>
                            <comment id="13090766" author="adamnichols" created="Thu, 25 Aug 2011 04:41:51 +0000"  >&lt;p&gt;Is this patch for non-conforming PDFs?  The only things allowed to be in the /Pages object are pages, or arrays of pages, or arrays of arrays or pages, etc.  What types of objects were you getting which were unable to be cast?  Also, what line was throwing the exception?  Is there a sample PDF which we can use to duplicate the error and use for JUnit tests?&lt;/p&gt;</comment>
                            <comment id="13091313" author="nnkfws333" created="Thu, 25 Aug 2011 20:43:08 +0000"  >&lt;p&gt;Maruan&lt;br/&gt;
After trying your patch, I seem to be getting object id&apos;s for every page. In the document, there is not a bookmark on every page.&lt;/p&gt;

&lt;p&gt;Adam,&lt;br/&gt;
I was initially trying to get the page map which should contain object id&apos;s to page numbers for bookmarks. I cannot share the PDF I am using but I am testing this over 50+ pdf documents. Here are the exceptions when I call out the getPageMap&lt;/p&gt;

&lt;p&gt;java.lang.ClassCastException: org.apache.pdfbox.pdmodel.PDPage&lt;br/&gt;
	org.apache.pdfbox.pdmodel.PDDocument.processListOfPageReferences(PDDocument.java:163)&lt;br/&gt;
	org.apache.pdfbox.pdmodel.PDDocument.processListOfPageReferences(PDDocument.java:167)&lt;br/&gt;
	org.apache.pdfbox.pdmodel.PDDocument.processListOfPageReferences(PDDocument.java:167)&lt;br/&gt;
	org.apache.pdfbox.pdmodel.PDDocument.generatePageMap(PDDocument.java:152)&lt;br/&gt;
	org.apache.pdfbox.pdmodel.PDDocument.getPageMap(PDDocument.java:242)&lt;/p&gt;</comment>
                            <comment id="13092005" author="adamnichols" created="Fri, 26 Aug 2011 20:31:03 +0000"  >&lt;p&gt;So it was expected a PDPage, but what type of object did it actually get?  Also, would you be able to track down the actual section of the PDF which is causing this?  It may be a parsing issue which caused the data to be loaded incorrectly.&lt;/p&gt;</comment>
                            <comment id="13092888" author="nnkfws333" created="Mon, 29 Aug 2011 14:57:50 +0000"  >&lt;p&gt;Adam, it actually passed a PDPage object but I can&apos;t determine which section of the pdf is causing this. This issue is starting to get annoying &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13093153" author="msahyoun" created="Mon, 29 Aug 2011 20:14:40 +0000"  >&lt;p&gt;Nghi,&lt;/p&gt;

&lt;p&gt;getPageMap is generating a map of all pages not only for the pages with a bookmark pointing to it. You can then use the map to get the page number of the page a bookmark is pointing to as the reference in the bookmark will be the objectnumber and generation number not the page number.&lt;/p&gt;

&lt;p&gt;Adam,&lt;br/&gt;
I had the same issue Nghi had which is a ClassCastException for PDPage to COSObject. The object handled is a PDPage at least that&apos;s what getClass().getName() said. Unfortunately I didn&apos;t check against earlier versions of PDFBox which I just did now. So the bug was introduced in version 1.6.0. Version 1.5.0 works fine. So I think you&apos;re right - it might be a parsing issue introduced in 1.6.0. The test document I was using is the pdf reference 1.7. So instead of applying the patch the parsing issue - if it proves to be one - should be fixed. I can start to look into that mid next week at the earliest. &lt;/p&gt;

&lt;p&gt;Sorry for the confusion I might have caused. &lt;/p&gt;</comment>
                            <comment id="13093202" author="nnkfws333" created="Mon, 29 Aug 2011 21:03:32 +0000"  >&lt;p&gt;Thank you very much Maruan for the help! I really appreciate it. I just have one more last question if you could point me in the right direction. If I have the object number and generation number, how can I get the bookmark title? Or how would I get the object number and generation number from the bookmarks?&lt;/p&gt;</comment>
                            <comment id="13102728" author="msahyoun" created="Mon, 12 Sep 2011 15:27:31 +0000"  >&lt;p&gt;The issue was introduced in rev. 1092855 by changing the line in the method processListOfPageReferences&lt;/p&gt;

&lt;p&gt;from&lt;br/&gt;
COSArray pageArray = ((COSArrayList)(((PDPage)pageOrArray).getParent()).getKids()).toList();&lt;/p&gt;

&lt;p&gt;to&lt;br/&gt;
List pageArray = ((((PDPage)pageOrArray).getParent()).getKids());&lt;/p&gt;

&lt;p&gt;For the newer version the next line &lt;/p&gt;

&lt;p&gt;parseCatalogObject((COSObject)pageArray.get&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;); will fail as get will return a PDPage where for the original version it will return a COSObject.&lt;/p&gt;

&lt;p&gt;I&apos;ll submit a patch to revert to the original version.&lt;/p&gt;

</comment>
                            <comment id="13102740" author="msahyoun" created="Mon, 12 Sep 2011 15:42:43 +0000"  >&lt;p&gt;Patch to correct generatePageMap()&lt;/p&gt;</comment>
                            <comment id="13102766" author="msahyoun" created="Mon, 12 Sep 2011 16:15:09 +0000"  >&lt;p&gt;Added test for getPageMap()&lt;/p&gt;</comment>
                            <comment id="13103032" author="nnkfws333" created="Mon, 12 Sep 2011 20:46:59 +0000"  >&lt;p&gt;That fixed the problem Maruan. Would you or anyone happen to know how to get the bookmarks if you have the object number and generation number? &lt;/p&gt;</comment>
                            <comment id="13103241" author="adamnichols" created="Tue, 13 Sep 2011 01:03:55 +0000"  >&lt;p&gt;I didn&apos;t test this, but I looked at the commit logs and I can confirm that the change which broke it was not related to the signing interface (which is what the comment in the commit says).  So changing it back shouldn&apos;t cause any regression issues.&lt;/p&gt;</comment>
                            <comment id="13103377" author="msahyoun" created="Tue, 13 Sep 2011 05:54:55 +0000"  >&lt;p&gt;@Adam&lt;br/&gt;
Thanks for doing a quick review. I did a very basic although not full test for the signature which worked fine. As generatePageMap() didn&apos;t work at all I also don&apos;t think that it was used. &lt;/p&gt;

&lt;p&gt;@Ngi&lt;br/&gt;
For a single bookmark entry you can do either&lt;/p&gt;

&lt;p&gt;((PDPageDestination)item.getDestination()).findPageNumber()&lt;/p&gt;

&lt;p&gt;if the bookmark entry is a PDPageDestination or&lt;/p&gt;

&lt;p&gt;COSArray destination = (COSArray) item.getDestination().getCOSObject();&lt;br/&gt;
// Get the page reference from the destination&lt;br/&gt;
String pageKey = ((COSObject)destination.get(0)).getObjectNumber().intValue() + &quot;,&quot; + ((COSObject)destination.get(0)).getGenerationNumber().intValue();&lt;br/&gt;
// get the page number from the page map&lt;br/&gt;
int pageNumber = (Integer) document.getPageMap().get(pageKey);&lt;/p&gt;

&lt;p&gt;for other Destination types.&lt;/p&gt;

&lt;p&gt;You might want to look up the different types in the PDF reference (PDF:1.7, section: 8.2.1) &lt;/p&gt;</comment>
                            <comment id="13104851" author="nnkfws333" created="Wed, 14 Sep 2011 20:17:24 +0000"  >&lt;p&gt;Thanks Mauran, helped a bunch but I noticed sometimes item.getDestination will return a null even though the item in the actual PDF will have a page reference. Maybe it&apos;s just the limitation of PDFBox. &lt;/p&gt;</comment>
                            <comment id="13104853" author="msahyoun" created="Wed, 14 Sep 2011 20:22:25 +0000"  >&lt;p&gt;Nghi, maybe you want to check the bookmark dictionary and compare with the PDF spec. Not always will there be a destination entry. All that is described in the spec.&lt;/p&gt;

&lt;p&gt;In addition we should move the discussion to the users mailing list as this is no longer bug related.&lt;/p&gt;</comment>
                            <comment id="13105019" author="nnkfws333" created="Wed, 14 Sep 2011 23:59:39 +0000"  >&lt;p&gt;Should I go ahead and move this to be resolved?&lt;/p&gt;</comment>
                            <comment id="13108859" author="lehmi" created="Tue, 20 Sep 2011 17:51:04 +0000"  >&lt;p&gt;I added the 2nd patch to avoid the ClassCastExcpetion and the test case in revision 1173275. Am I right that the first patch isn&apos;t needed anymore?&lt;/p&gt;</comment>
                            <comment id="13108910" author="msahyoun" created="Tue, 20 Sep 2011 18:29:51 +0000"  >&lt;p&gt;Andreas, you&apos;re correct, the first patch isn&apos;t needed anymore. Thanks for applying the fix. &lt;/p&gt;</comment>
                            <comment id="13108977" author="lehmi" created="Tue, 20 Sep 2011 20:27:05 +0000"  >&lt;p&gt;@Maruan&lt;br/&gt;
Thanks for coming back and of course for the contribution as well.&lt;/p&gt;

&lt;p&gt;Set to resolved&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12494048" name="PDDocument.patch" size="749" author="msahyoun" created="Mon, 12 Sep 2011 15:42:43 +0000"/>
                            <attachment id="12490341" name="PDDocument.patch" size="5796" author="msahyoun" created="Sat, 13 Aug 2011 16:27:19 +0000"/>
                            <attachment id="12494055" name="TestPDDocumentCatalog.patch" size="1030" author="msahyoun" created="Mon, 12 Sep 2011 16:15:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2815</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zhxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>205208</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>