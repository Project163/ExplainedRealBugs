<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 20:53:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-1299] BaseParser.readUntilEndOfStream can stop too early, causing IOException on valid PDFs</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-1299</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;The purpose of BaseParser.readUntilEndOfStream is to scan ahead,&lt;br/&gt;
copying bytes to the output, stopping once it sees &quot;endstream&quot;.&lt;/p&gt;

&lt;p&gt;The problem with this approach is sometimes the stream data itself&lt;br/&gt;
contains endstream causing readUntilEndOfStream to stop too early.&lt;/p&gt;

&lt;p&gt;This can legitimately happen when the stream is an embedded PDF; I&apos;ll&lt;br/&gt;
attach a test PDF showing this.&lt;/p&gt;

&lt;p&gt;However, the stream dict declares the stream length (in bytes)...  so&lt;br/&gt;
it seems like we should be respecting that length (if present) and&lt;br/&gt;
simply copy over that many bytes, instead of scanning the stream bytes&lt;br/&gt;
for endstream?  This should be a lot faster too...&lt;/p&gt;

&lt;p&gt;I imagine we always scan so that we are more robust if the length is&lt;br/&gt;
missing/invalid?  Is that why this method was used?  (I don&apos;t know the&lt;br/&gt;
history here...).  If so, maybe we can have an option to use&lt;br/&gt;
the declared stream length if present.&lt;/p&gt;

&lt;p&gt;I have a patch to use the declared stream length (if present), and it enables&lt;br/&gt;
at least this test PDF to correctly parse.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12553281">PDFBOX-1299</key>
            <summary>BaseParser.readUntilEndOfStream can stop too early, causing IOException on valid PDFs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tboehme">Timo Boehme</assignee>
                                    <reporter username="mikemccand">Michael McCandless</reporter>
                        <labels>
                    </labels>
                <created>Sun, 29 Apr 2012 13:44:47 +0000</created>
                <updated>Fri, 20 Jun 2025 03:56:41 +0000</updated>
                            <resolved>Mon, 21 May 2012 14:07:28 +0000</resolved>
                                    <version>1.6.0</version>
                                    <fixVersion>1.7.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13264540" author="mikemccand" created="Sun, 29 Apr 2012 13:45:16 +0000"  >&lt;p&gt;Test PDF showing the problem.  I got the PDF from&lt;br/&gt;
&lt;a href=&quot;http://acrobatusers.com/gallery/pdf_portfolio_gallery&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://acrobatusers.com/gallery/pdf_portfolio_gallery&lt;/a&gt;, specifically&lt;br/&gt;
&lt;a href=&quot;http://acrobatusers.com/assets/uploads/gallery/Tracey_Prather_31-Dec-2010_211843_2011Portfolio.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://acrobatusers.com/assets/uploads/gallery/Tracey_Prather_31-Dec-2010_211843_2011Portfolio.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In this PDF, at offset=446726, we have a &quot;4 0 obj&quot; stream, with&lt;br/&gt;
Length=368286.&lt;/p&gt;

&lt;p&gt;If you skip ahead by that length, the next object is &quot;5 0 obj&quot;.&lt;/p&gt;

&lt;p&gt;But, unfortunately, within those bytes is an &quot;endstream&quot; on its own&lt;br/&gt;
line, just before offset=714247 (this &quot;belongs&quot; to the embedded PDF),&lt;br/&gt;
and that causes readUntilEndOfStream to stop too early, leading to&lt;br/&gt;
this IOException when running ExtractText (on current trunk):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;main&quot; java.io.IOException: Unknown dir object c=&apos;]&apos; cInt=93 peek=&apos;]&apos; peekInt=93 757109
	at org.apache.pdfbox.pdfparser.BaseParser.parseDirObject(BaseParser.java:1215)
	at org.apache.pdfbox.pdfparser.BaseParser.parseCOSDictionaryValue(BaseParser.java:216)
	at org.apache.pdfbox.pdfparser.BaseParser.parseCOSDictionary(BaseParser.java:342)
	at org.apache.pdfbox.pdfparser.BaseParser.parseDirObject(BaseParser.java:1117)
ununun	at org.apache.pdfbox.pdfparser.PDFParser.parseObject(PDFParser.java:557)
	at org.apache.pdfbox.pdfparser.PDFParser.parse(PDFParser.java:187)
	at org.apache.pdfbox.pdmodel.PDDocument.load(PDDocument.java:1090)
	at org.apache.pdfbox.pdmodel.PDDocument.load(PDDocument.java:1055)
	at org.apache.pdfbox.pdmodel.PDDocument.load(PDDocument.java:980)
	at org.apache.pdfbox.ExtractText.startExtraction(ExtractText.java:196)
	at org.apache.pdfbox.ExtractText.main(ExtractText.java:76)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13264541" author="mikemccand" created="Sun, 29 Apr 2012 13:46:44 +0000"  >&lt;p&gt;Attached patch that at least fixes this one document.  The patch uses&lt;br/&gt;
the length in the stream dict and copies exactly that many bytes...&lt;/p&gt;</comment>
                            <comment id="13264560" author="mikemccand" created="Sun, 29 Apr 2012 14:38:47 +0000"  >&lt;p&gt;Sorry, wrong attachment: this one is the right one.&lt;/p&gt;</comment>
                            <comment id="13280121" author="mikemccand" created="Mon, 21 May 2012 12:45:07 +0000"  >&lt;p&gt;Hi, any feedback on my patch here...?&lt;/p&gt;

&lt;p&gt;I think it fixes a real issue (that a stream may itself contain the substring &apos;endstream&apos;, causing us to end the stream too early)...&lt;/p&gt;</comment>
                            <comment id="13280163" author="tboehme" created="Mon, 21 May 2012 14:07:28 +0000"  >&lt;p&gt;While the new NonSequentialPDFParser uses length information in every case the sequential working PDFParser did not since in most cases length information is an indirect object with its value provided later. However there are some cases where this information is present at point of parsing the stream (like in the example) and for these cases I applied your patch with small modification. I only kept length information if defined directly because in case of indirect object we do not know if this will be revised later on (since PDFParser hasn&apos;t read xref table at this time) and thus we would read wrong number of bytes. However this limitation shouldn&apos;t be a real one since indirect defined length comes typically after stream object.&lt;/p&gt;

&lt;p&gt;Fixed in rev. 1341030; thanks for contribution&lt;/p&gt;</comment>
                            <comment id="13280238" author="mikemccand" created="Mon, 21 May 2012 15:51:20 +0000"  >&lt;p&gt;Thanks Timo!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12762221">PDFBOX-2575</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12525022" name="PDFBOX-1299.patch" size="1820" author="mikemccand" created="Sun, 29 Apr 2012 13:46:44 +0000"/>
                            <attachment id="12525024" name="Tracey_Prather_31-Dec-2010_211843_2011Portfolio.pdf" size="7223462" author="mikemccand" created="Sun, 29 Apr 2012 14:38:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>237396</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0zit3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>205349</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>