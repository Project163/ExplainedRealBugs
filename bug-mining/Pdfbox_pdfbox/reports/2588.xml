<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:11:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5278] PDPage.getAnnotations() causes subsequent calls to PDDocument.getPages() to fail</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5278</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I have stumbled across a strange issue with a certain PDF where&#160;PDPage.getAnnotations() causes subsequent calls to PDDocument.getPages() to fail.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am not at liberty to share the PDF publicly, but am happy to DM the PDF privately if it helps.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The code to reproduce is pretty straightforward:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.File;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.pdmodel.PDDocument;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.pdfbox.pdmodel.PDPage;


&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;AnnotationsTest {

	
	&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

		
		

		&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;( PDDocument doc = PDDocument.load(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(args[0]));){

			&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (PDPage page : doc.getPages()) {
				&lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; line will cause the doc to not be re-iterable in the next block, commenting it out will allow it to pass.
&lt;/span&gt;				page.getAnnotations();

			}
			
			&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;We get here, no problem - not sure why we can&apos;t re-iterate again...&quot;&lt;/span&gt;);
			
			&lt;span class=&quot;code-comment&quot;&gt;//doc.getPages() fails.
&lt;/span&gt;			&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (PDPage page : doc.getPages()) {
				&lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; something
&lt;/span&gt;				
			}

		} 
	}

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;The Exception:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Exception in thread &quot;main&quot; java.lang.IllegalStateException: Expected &apos;Page&apos; but found COSName{Annot}Exception in thread &quot;main&quot; java.lang.IllegalStateException: Expected &apos;Page&apos; but found COSName{Annot} at org.apache.pdfbox.pdmodel.PDPageTree.sanitizeType(PDPageTree.java:266) at org.apache.pdfbox.pdmodel.PDPageTree.access$400(PDPageTree.java:43) at org.apache.pdfbox.pdmodel.PDPageTree$PageIterator.next(PDPageTree.java:224) at org.apache.pdfbox.pdmodel.PDPageTree$PageIterator.next(PDPageTree.java:172) at AnnotationsTest.main(AnnotationsTest.java:28)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13399847">PDFBOX-5278</key>
            <summary>PDPage.getAnnotations() causes subsequent calls to PDDocument.getPages() to fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="alistairo">Alistair Oldfield</reporter>
                        <labels>
                    </labels>
                <created>Tue, 7 Sep 2021 19:56:15 +0000</created>
                <updated>Fri, 17 Dec 2021 06:50:07 +0000</updated>
                            <resolved>Thu, 9 Sep 2021 17:32:50 +0000</resolved>
                                    <version>2.0.24</version>
                                    <fixVersion>2.0.25</fixVersion>
                    <fixVersion>3.0.0 PDFBox</fixVersion>
                                    <component>Text extraction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17411656" author="tilman" created="Wed, 8 Sep 2021 03:35:44 +0000"  >&lt;p&gt;You can send me the file to me here:   tilman at snafu dot de .&lt;/p&gt;</comment>
                            <comment id="17411929" author="mkl" created="Wed, 8 Sep 2021 13:27:36 +0000"  >&lt;p&gt;Maybe some page has an annotation array which (incorrectly!) directly references a page object. In that case PDFBox would &quot;fix&quot; the type entry of the page dictionary to be &lt;b&gt;Annot&lt;/b&gt;. (Maybe the &lt;tt&gt;PDAnnotation(COSDictionary)&lt;/tt&gt; constructor should only set the type if it is not set, and otherwise check the value and throw an exception if it&apos;s not &lt;b&gt;Annot&lt;/b&gt; - or ignore this in a non-strict mode.)&lt;/p&gt;

&lt;p&gt;But maybe there is a different error in the PDF. Hard to tell without the PDF.&lt;/p&gt;</comment>
                            <comment id="17412113" author="jira-bot" created="Wed, 8 Sep 2021 17:55:12 +0000"  >&lt;p&gt;Commit 1893151 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1893151&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1893151&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5278&quot; title=&quot;PDPage.getAnnotations() causes subsequent calls to PDDocument.getPages() to fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5278&quot;&gt;&lt;del&gt;PDFBOX-5278&lt;/del&gt;&lt;/a&gt;: don&apos;t modify type, as suggested by Michael Klink&lt;/p&gt;</comment>
                            <comment id="17412114" author="jira-bot" created="Wed, 8 Sep 2021 17:55:15 +0000"  >&lt;p&gt;Commit 1893152 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1893152&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1893152&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5278&quot; title=&quot;PDPage.getAnnotations() causes subsequent calls to PDDocument.getPages() to fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5278&quot;&gt;&lt;del&gt;PDFBOX-5278&lt;/del&gt;&lt;/a&gt;: don&apos;t modify type, as suggested by Michael Klink&lt;/p&gt;</comment>
                            <comment id="17412115" author="tilman" created="Wed, 8 Sep 2021 17:55:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkl&quot; class=&quot;user-hover&quot; rel=&quot;mkl&quot;&gt;mkl&lt;/a&gt; Your suspicion is correct &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alistairo&quot; class=&quot;user-hover&quot; rel=&quot;alistairo&quot;&gt;alistairo&lt;/a&gt; Your files are a mess. For example, the &quot;64&quot; file has a annotation 31 on page 7 referencing not an annotation directory, but page 1. Look for &quot;43 0 R&quot; and &quot;43 0 obj&quot; with notepad++ in that file.&lt;/p&gt;</comment>
                            <comment id="17412125" author="tilman" created="Wed, 8 Sep 2021 18:22:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=alistairo&quot; class=&quot;user-hover&quot; rel=&quot;alistairo&quot;&gt;alistairo&lt;/a&gt; please retry with the snapshot&lt;br/&gt;
&lt;a href=&quot;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.25-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/groups/snapshots/org/apache/pdfbox/pdfbox-app/2.0.25-SNAPSHOT/&lt;/a&gt;&lt;br/&gt;
(due to lack of time I only tried with PDFDebugger but was able to reproduce the effect by moving up and down the pages)&lt;/p&gt;</comment>
                            <comment id="17412127" author="jira-bot" created="Wed, 8 Sep 2021 18:35:35 +0000"  >&lt;p&gt;Commit 1893153 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1893153&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1893153&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5278&quot; title=&quot;PDPage.getAnnotations() causes subsequent calls to PDDocument.getPages() to fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5278&quot;&gt;&lt;del&gt;PDFBOX-5278&lt;/del&gt;&lt;/a&gt;: revert personal comment&lt;/p&gt;</comment>
                            <comment id="17412409" author="alistairo" created="Thu, 9 Sep 2021 07:35:08 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt;&#160;and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mkl&quot; class=&quot;user-hover&quot; rel=&quot;mkl&quot;&gt;mkl&lt;/a&gt;, the problem seems to go away with&#160;pdfbox-app-2.0.25-20210908.180722-89.jar (at least in the sample app I provided above).&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I will inform if something pops up during regression tests later on in case there are any unintended consequences.&lt;/p&gt;

&lt;p&gt;I appreciate the fix!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17412632" author="mkl" created="Thu, 9 Sep 2021 15:05:52 +0000"  >&lt;p&gt;&quot;further mayhem may follow&quot; -&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="17412735" author="tilman" created="Thu, 9 Sep 2021 17:32:50 +0000"  >&lt;p&gt;Thanks for the feedback!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 9 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0up1s:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>