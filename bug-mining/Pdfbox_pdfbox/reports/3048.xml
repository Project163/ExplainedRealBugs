<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:15:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[PDFBOX-5230] Zero-width non-joiner characters visible in generated PDF</title>
                <link>https://issues.apache.org/jira/browse/PDFBOX-5230</link>
                <project id="12310760" key="PDFBOX">PDFBox</project>
                    <description>&lt;p&gt;I&apos;d like to use the &lt;a href=&quot;https://en.wikipedia.org/wiki/Zero-width_non-joiner&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;zero-width non-joiner&lt;/a&gt; (ZWNJ) character to prevent character shaping in some cases when using Arabic and Indic scripts. This works correctly using some fonts like Arial Unicode (character shaping is prevented and no ZWNJ glyph is visible in the PDF), but does not work correctly when using fonts like Tahoma or Google Noto Sans Regular, where the ZWNJ character is visible in the PDF. The ZWNJ glyph is not visible when using these fonts in other programs, like Microsoft Word.&lt;/p&gt;

&lt;p&gt;I suspect that the `advanceWidth` settings in the `hmtx` table should be taken into account somehow but are not, because the `advanceWidth` for this glyph is 0 in both of these fonts which are erroneously generating visual artifacts for the ZWNJ character (Tahoma and Google Noto Sans Regular).&lt;/p&gt;

&lt;p&gt;Test case generating the attached PDF file:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ZwnjTest {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDDocument document = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDDocument()) {

            PDPage page = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPage(PDRectangle.LETTER);
            document.addPage(page);

            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; (PDPageContentStream stream = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PDPageContentStream(document, page)) {

                &lt;span class=&quot;code-comment&quot;&gt;// Tahoma: ZWNJ glyph is a vertical bar, but advanceWidth in hmtx table is 0 -&amp;gt; shown in PDF anyway (unexpected)
&lt;/span&gt;                PDFont tahoma = PDType0Font.load(document, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;C:/Windows/Fonts/tahoma.ttf&quot;&lt;/span&gt;));
                stream.beginText();
                stream.setFont(tahoma, 20);
                stream.newLineAtOffset(50, 650);
                stream.showText(&lt;span class=&quot;code-quote&quot;&gt;&quot;t\u200Ce\u200Cs\u200Ct\u200C \u200C1&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// U+200C = zero width non-joiner
&lt;/span&gt;                stream.endText();

                &lt;span class=&quot;code-comment&quot;&gt;// Arial Unicode: ZWNJ glyph contains no outline -&amp;gt; not shown in PDF (as expected)
&lt;/span&gt;                PDFont arialu = PDType0Font.load(document, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;C:/Windows/Fonts/ARIALUNI.TTF&quot;&lt;/span&gt;));
                stream.beginText();
                stream.setFont(arialu, 20);
                stream.newLineAtOffset(50, 600);
                stream.showText(&lt;span class=&quot;code-quote&quot;&gt;&quot;t\u200Ce\u200Cs\u200Ct\u200C \u200C2&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// U+200C = zero width non-joiner
&lt;/span&gt;                stream.endText();

                &lt;span class=&quot;code-comment&quot;&gt;// Google Noto Sans Regular: ZWNJ glyph is a vertical bar, but advanceWidth in hmtx table is 0 -&amp;gt; shown in PDF anyway (unexpected)
&lt;/span&gt;                PDFont gnotos = PDType0Font.load(document, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;noto-sans-regular.ttf&quot;&lt;/span&gt;));
                stream.beginText();
                stream.setFont(gnotos, 20);
                stream.newLineAtOffset(50, 550);
                stream.showText(&lt;span class=&quot;code-quote&quot;&gt;&quot;t\u200Ce\u200Cs\u200Ct\u200C \u200C3&quot;&lt;/span&gt;); &lt;span class=&quot;code-comment&quot;&gt;// U+200C = zero width non-joiner
&lt;/span&gt;                stream.endText();
            }

            document.save(&lt;span class=&quot;code-quote&quot;&gt;&quot;zwnj.pdf&quot;&lt;/span&gt;);
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13386934">PDFBOX-5230</key>
            <summary>Zero-width non-joiner characters visible in generated PDF</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tilman">Tilman Hausherr</assignee>
                                    <reporter username="sdanig">Daniel Gredler</reporter>
                        <labels>
                    </labels>
                <created>Thu, 1 Jul 2021 02:43:37 +0000</created>
                <updated>Wed, 22 Oct 2025 09:28:59 +0000</updated>
                            <resolved>Sat, 8 Mar 2025 09:50:38 +0000</resolved>
                                    <version>2.0.16</version>
                                    <fixVersion>2.0.34</fixVersion>
                    <fixVersion>3.0.5 PDFBox</fixVersion>
                    <fixVersion>4.0.0</fixVersion>
                                    <component>FontBox</component>
                    <component>PDModel</component>
                    <component>Writing</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17372981" author="tilman" created="Thu, 1 Jul 2021 18:04:27 +0000"  >&lt;p&gt;Character shaping isn&apos;t done in PDFBox. I started DTL OTMaster 3.7 light and I looked at the Arial font in windows and the glyph you mention is at GID 744 and yes there is a shape. In Arial Unicode it is at 3233 and there is no shape. Maybe WORD decides for itself never to show this glyph?&lt;/p&gt;

&lt;p&gt;I tested using it in WORD and saved as PDF, in the final PDF the &quot;glyph&quot; was missing, but WORD takes care to separate the two.&lt;/p&gt;</comment>
                            <comment id="17373142" author="sdanig" created="Fri, 2 Jul 2021 01:51:35 +0000"  >&lt;p&gt;Out of curiosity, I generated the same file using &lt;a href=&quot;https://pdfkit.org/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PDFKit&lt;/a&gt; (code below). As expected, the generated PDF (attached) does not display the ZWNJ glyphs, regardless of the font used.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; PdfDocument = require(&lt;span class=&quot;code-quote&quot;&gt;&apos;pdfkit&apos;&lt;/span&gt;);
&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; fs = require(&lt;span class=&quot;code-quote&quot;&gt;&apos;fs&apos;&lt;/span&gt;);

&lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; doc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PdfDocument();
doc.pipe(fs.createWriteStream(&lt;span class=&quot;code-quote&quot;&gt;&apos;zwnj-pdfkit.pdf&apos;&lt;/span&gt;));
doc.font(&lt;span class=&quot;code-quote&quot;&gt;&apos;tahoma.ttf&apos;&lt;/span&gt;).fontSize(20).text(&lt;span class=&quot;code-quote&quot;&gt;&apos;t\u200Ce\u200Cs\u200Ct\u200C \u200C1&apos;&lt;/span&gt;, 50, 50);
doc.font(&lt;span class=&quot;code-quote&quot;&gt;&apos;ARIALUNI.TTF&apos;&lt;/span&gt;).fontSize(20).text(&lt;span class=&quot;code-quote&quot;&gt;&apos;t\u200Ce\u200Cs\u200Ct\u200C \u200C2&apos;&lt;/span&gt;, 50, 100);
doc.font(&lt;span class=&quot;code-quote&quot;&gt;&apos;noto-sans-regular.ttf&apos;&lt;/span&gt;).fontSize(20).text(&lt;span class=&quot;code-quote&quot;&gt;&apos;t\u200Ce\u200Cs\u200Ct\u200C \u200C3&apos;&lt;/span&gt;, 50, 150);
doc.end();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17373201" author="tilman" created="Fri, 2 Jul 2021 03:46:39 +0000"  >&lt;p&gt;They have put a space character instead (try copying the text).&lt;/p&gt;</comment>
                            <comment id="17375103" author="sdanig" created="Tue, 6 Jul 2021 01:52:06 +0000"  >&lt;p&gt;Yep, that seems to be the behavior for PDFKit.&lt;/p&gt;

&lt;p&gt;I also tried the same using standard Java2D, and the ZWNJ chars are also not displayed &#8211; code below, output attached (zwnj.png).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ZwnjG2dTest {
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

        BufferedImage img = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BufferedImage(500, 300, BufferedImage.TYPE_INT_ARGB);
        Graphics2D g2d = img.createGraphics();
        g2d.setRenderingHint(RenderingHints.KEY_FRACTIONALMETRICS, RenderingHints.VALUE_FRACTIONALMETRICS_ON);
        g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
        g2d.setColor(Color.WHITE);
        g2d.fillRect(0, 0, img.getWidth(), img.getHeight());
        g2d.setColor(Color.BLACK);

        Font tahoma = Font.createFont(Font.TRUETYPE_FONT, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;C:/Windows/Fonts/tahoma.ttf&quot;&lt;/span&gt;)).deriveFont(50f);
        g2d.setFont(tahoma);
        g2d.drawString(&lt;span class=&quot;code-quote&quot;&gt;&quot;t\u200Ce\u200Cs\u200Ct\u200C \u200C1&quot;&lt;/span&gt;, 50, 50); &lt;span class=&quot;code-comment&quot;&gt;// U+200C = zero width non-joiner
&lt;/span&gt;
        Font arial = Font.createFont(Font.TRUETYPE_FONT, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;C:/Windows/Fonts/ARIALUNI.TTF&quot;&lt;/span&gt;)).deriveFont(50f);
        g2d.setFont(arial);
        g2d.drawString(&lt;span class=&quot;code-quote&quot;&gt;&quot;t\u200Ce\u200Cs\u200Ct\u200C \u200C2&quot;&lt;/span&gt;, 50, 100); &lt;span class=&quot;code-comment&quot;&gt;// U+200C = zero width non-joiner
&lt;/span&gt;
        Font noto = Font.createFont(Font.TRUETYPE_FONT, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;noto-sans-regular.ttf&quot;&lt;/span&gt;)).deriveFont(50f);
        g2d.setFont(noto);
        g2d.drawString(&lt;span class=&quot;code-quote&quot;&gt;&quot;t\u200Ce\u200Cs\u200Ct\u200C \u200C3&quot;&lt;/span&gt;, 50, 150); &lt;span class=&quot;code-comment&quot;&gt;// U+200C = zero width non-joiner
&lt;/span&gt;
        ImageIO.write(img, &lt;span class=&quot;code-quote&quot;&gt;&quot;png&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;zwnj.png&quot;&lt;/span&gt;));
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17929808" author="sdanig" created="Mon, 24 Feb 2025 15:23:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tilman&quot; class=&quot;user-hover&quot; rel=&quot;tilman&quot;&gt;tilman&lt;/a&gt; I wanted to have another look at this one, and perhaps create a fix PR. I think I&apos;ll use the &quot;Save as PDF&quot; functionality in LibreOffice Writer and in the online version of Microsoft Office to check their behavior, and if their behavior matches, assume that&apos;s &quot;best practice&quot; (or at least a good starting point). Does this sound like a good foundation for a possible fix for this issue? Also, if you have any other thoughts or advice on this one, I&apos;m all ears.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;EDIT:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;LibreOffice and MS Office actually behave slightly differently, unfortunately.&lt;/p&gt;

&lt;p&gt;So here&apos;s the approach I&apos;m thinking about using for ZWNJ (and possibly also ZWSP, ZWJ, WJ and ZWNBSP):&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;If the font being used is one of the 14 built-in fonts (Times Roman, Helvetica, Courier, Symbol or Dingbats), it means that only Latin text is supported. For these fonts, remove the zero-width character from the text: it should not be rendered, and it usually serves no layout purpose in Latin text (since we are not concerned with line break calculation).&lt;/li&gt;
	&lt;li&gt;If the font being used is a custom subset font, customize the subsetting process to force the zero-width character glyph to actually be zero-width and zero-contour / zero-path, regardless of whether the source font defines a glyph with a non-zero width and/or contour paths. This way if e.g. ZWNJ is used to break up an Arabic ligature, the in-PDF text still contains the ZWNJ and behaves correctly, but there is no risk of an extra unwanted glyph being rendered.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Thoughts?&lt;/p&gt;

&lt;p&gt;I can put together a PR, if you&apos;d like to see what this would look like.&lt;/p&gt;</comment>
                            <comment id="17929990" author="tilman" created="Tue, 25 Feb 2025 03:51:53 +0000"  >&lt;p&gt;I wonder why I wrote &quot;Character shaping isn&apos;t done in PDFBox&quot; in 2021 despite that &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4189&quot; title=&quot;Enable PDF creation with Indian languages, by reading and utilizing the GSUB table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4189&quot;&gt;&lt;del&gt;PDFBOX-4189&lt;/del&gt;&lt;/a&gt; was started in 2018. I agree that the ZWNJ should have its &quot;effect&quot; in preventing the GSUB processor (this should already work, try it with latin ligatures, see &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5599&quot; title=&quot;Support latin ligatures&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5599&quot;&gt;&lt;del&gt;PDFBOX-5599&lt;/del&gt;&lt;/a&gt;, it works with Calibri), and in a later step be removed or replaced with an 0 size glyph.&lt;/p&gt;</comment>
                            <comment id="17930762" author="sdanig" created="Wed, 26 Feb 2025 17:19:23 +0000"  >&lt;p&gt;Thanks for the pointer! I&apos;ll pursue this avenue and let you know how it goes.&lt;/p&gt;

&lt;p&gt;I think ZWNJ, ZWSP, WJ and ZWNBSP can all be treated the same way: no additional handling needed in the GSUB processing, since all we need is their presence in the text to behave correctly, and then during font subsetting we force these glyphs to be invisible (zero width, no contours), even if the source font defines them with a non-zero width or with contours. Liberation Sans (already used elsewhere in the tests) has a glyph for ZWNJ that is zero-width but has contours, so seems like a decent test candidate.&lt;/p&gt;

&lt;p&gt;I think it&apos;s worth scoping out ZWJ and a few other zero-width characters for now, because they would need additional handling in the GSUB processing or elsewhere (i.e. not as simple).&lt;/p&gt;

&lt;p&gt;BTW, I created a focused clean-up PR for the GSUB code in `PDAbstractContentStream` while I was digging around the GSUB code: &lt;a href=&quot;https://github.com/apache/pdfbox/pull/202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/pdfbox/pull/202&lt;/a&gt; . More details are available at the link, but let me know whether you&apos;re interested in smaller cleanup PRs like this one.&lt;/p&gt;</comment>
                            <comment id="17930970" author="tilman" created="Thu, 27 Feb 2025 04:49:55 +0000"  >&lt;p&gt;Re the PR, some parts I&apos;ll do and some I won&apos;t. For example, you&apos;re removing the optimization done in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5823&quot; title=&quot;StringUtil.PATTERN_SPACE memory optmisation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5823&quot;&gt;&lt;del&gt;PDFBOX-5823&lt;/del&gt;&lt;/a&gt;. So I&apos;m keeping these, which sadly will also prevent removing the exceptions. I also want to keep the error messages like they are because these helped me in debugging. I&apos;m keeping the null check in version 3 because this is a released version but have removed it in the trunk because I don&apos;t think that split() would ever return null, but obviously it was there for a reason.&lt;/p&gt;</comment>
                            <comment id="17931076" author="jira-bot" created="Thu, 27 Feb 2025 09:58:11 +0000"  >&lt;p&gt;Commit 1924076 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1924076&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1924076&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5230&quot; title=&quot;Zero-width non-joiner characters visible in generated PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5230&quot;&gt;&lt;del&gt;PDFBOX-5230&lt;/del&gt;&lt;/a&gt;: improve javadoc and optimizations by Daniel Gredler&lt;/p&gt;</comment>
                            <comment id="17931083" author="jira-bot" created="Thu, 27 Feb 2025 10:08:25 +0000"  >&lt;p&gt;Commit 1924078 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1924078&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1924078&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5230&quot; title=&quot;Zero-width non-joiner characters visible in generated PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5230&quot;&gt;&lt;del&gt;PDFBOX-5230&lt;/del&gt;&lt;/a&gt;: improve javadoc and optimizations by Daniel Gredler&lt;/p&gt;</comment>
                            <comment id="17931105" author="mkl" created="Thu, 27 Feb 2025 10:34:26 +0000"  >&lt;p&gt;As a side note: This special treatment of ZW codes might break use cases in which users parse text in one PDF and add that text to another (or the same) PDF if in the original document glyphs are actually rendered which are associated with some ZW character.&lt;/p&gt;

&lt;p&gt;One could argue that such source PDFs make use of inappropriate Unicode mappings and not consider this a problem. Nonetheless, issues might be posted here considering this a breaking change.&lt;/p&gt;</comment>
                            <comment id="17931120" author="tilman" created="Thu, 27 Feb 2025 11:08:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;let me know whether you&apos;re interested in smaller cleanup PRs like this one.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Keep them coming, but try not to do too much.&lt;/p&gt;</comment>
                            <comment id="17931182" author="sdanig" created="Thu, 27 Feb 2025 14:20:21 +0000"  >&lt;p&gt;Thanks for all the feedback!&lt;/p&gt;

&lt;p&gt;&amp;gt; Re the PR, some parts I&apos;ll do and some I won&apos;t.&lt;/p&gt;

&lt;p&gt;Makes sense, I saw that you already incorporated the parts that made sense, so I&apos;ve closed the PR in GitHub.&lt;/p&gt;

&lt;p&gt;&amp;gt; you&apos;re removing the optimization done in &lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5823&quot; title=&quot;StringUtil.PATTERN_SPACE memory optmisation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5823&quot;&gt;&lt;del&gt;PDFBOX-5823&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Yes, but this optimization was of the if-check, not the resultant logic, no? I think the question is whether the logic inside the if-block is significantly faster / more memory-efficient than the logic in the else-block. The current logic does avoid the instantiation of at least 3 objects when the word is a space, though (I think).&lt;/p&gt;

&lt;p&gt;&amp;gt; I don&apos;t think that split() would ever return null, but obviously it was there for a reason&lt;/p&gt;

&lt;p&gt;Yeah, it seems impossible to me, but I&apos;ve been wrong before!&lt;/p&gt;

&lt;p&gt;&amp;gt; This special treatment of ZW codes might break use cases&lt;/p&gt;

&lt;p&gt;The proposed change doesn&apos;t really break anything though, does it? What I mean is that today these four zero-width characters, with their original glyphs, are making it into the PDFs generated by PDFBox. The only change is to make sure that if PDFBox is in charge of the PDF creation, that the glyphs we add are indeed zero width and zero contour (invisible). Copy/pasting the text, or programmatically extracting it, will indeed still include these characters &#8211; but that&apos;s the same behavior as today, and I would argue probably the desired behavior. Let me know if that makes sense, or if I misunderstood part of the problem!&lt;/p&gt;

&lt;p&gt;Here is my first pass at a fix for this issue: &lt;a href=&quot;https://github.com/apache/pdfbox/pull/203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/pdfbox/pull/203&lt;/a&gt; I tried to add the necessary flexibility to `fontbox` without changing any default behavior, and only change the default behavior in `pdfbox`. The new test in `fontbox` passes, but the new test in `pdfbox` doesn&apos;t, and I&apos;m not sure why. For some reason the widths aren&apos;t coming back as zero for U+200C. It seems like there&apos;s some sort of char / gid / cid mapping issue and it just returns the default font char width (1000). Any suggestions?&lt;/p&gt;</comment>
                            <comment id="17931419" author="tilman" created="Fri, 28 Feb 2025 10:09:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yes, but this optimization was of the if-check, not the resultant logic, no?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sorry, you are correct, I misread the diff. The blank check has been there since the beginning (&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-4189&quot; title=&quot;Enable PDF creation with Indian languages, by reading and utilizing the GSUB table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-4189&quot;&gt;&lt;del&gt;PDFBOX-4189&lt;/del&gt;&lt;/a&gt; in 2018). So I have to guess why it is there. Likely because this avoids running the blanks through every GSUB feature. The code of that user was good and his idea on how to handle the GSUB replacements was very smart, so I&apos;d still prefer to keep it.&lt;/p&gt;

&lt;p&gt;(off topic: I&apos;ve always been wondering why we never heard from him after 2018. After clicking on the original PR and on his icon and then on his LinkedIn page, it turned out that he started a job as team leader at JPMorgan Chase in 2019)&lt;/p&gt;

&lt;p&gt;more on the rest later....&lt;/p&gt;</comment>
                            <comment id="17931421" author="jira-bot" created="Fri, 28 Feb 2025 10:10:28 +0000"  >&lt;p&gt;Commit 1924097 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1924097&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1924097&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5230&quot; title=&quot;Zero-width non-joiner characters visible in generated PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5230&quot;&gt;&lt;del&gt;PDFBOX-5230&lt;/del&gt;&lt;/a&gt;: remove comment&lt;/p&gt;</comment>
                            <comment id="17933506" author="jira-bot" created="Sat, 8 Mar 2025 08:05:40 +0000"  >&lt;p&gt;Commit 1924224 from Tilman Hausherr in branch &apos;pdfbox/trunk&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1924224&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1924224&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5230&quot; title=&quot;Zero-width non-joiner characters visible in generated PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5230&quot;&gt;&lt;del&gt;PDFBOX-5230&lt;/del&gt;&lt;/a&gt;: make zero-width non-joiner characters invisible, by Daniel Gredler&lt;/p&gt;</comment>
                            <comment id="17933507" author="jira-bot" created="Sat, 8 Mar 2025 08:24:15 +0000"  >&lt;p&gt;Commit 1924225 from Tilman Hausherr in branch &apos;pdfbox/branches/3.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1924225&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1924225&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5230&quot; title=&quot;Zero-width non-joiner characters visible in generated PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5230&quot;&gt;&lt;del&gt;PDFBOX-5230&lt;/del&gt;&lt;/a&gt;: make zero-width non-joiner characters invisible, by Daniel Gredler; closes #203&lt;/p&gt;</comment>
                            <comment id="17933509" author="jira-bot" created="Sat, 8 Mar 2025 09:29:13 +0000"  >&lt;p&gt;Commit 1924227 from Tilman Hausherr in branch &apos;pdfbox/branches/2.0&apos;&lt;br/&gt;
[ &lt;a href=&quot;https://svn.apache.org/r1924227&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/r1924227&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/PDFBOX-5230&quot; title=&quot;Zero-width non-joiner characters visible in generated PDF&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PDFBOX-5230&quot;&gt;&lt;del&gt;PDFBOX-5230&lt;/del&gt;&lt;/a&gt;: make zero-width non-joiner characters invisible, by Daniel Gredler; closes #203&lt;/p&gt;</comment>
                            <comment id="17933511" author="tilman" created="Sat, 8 Mar 2025 09:50:38 +0000"  >&lt;p&gt;Thanks for the contribution!&lt;/p&gt;</comment>
                            <comment id="17933512" author="sdanig" created="Sat, 8 Mar 2025 09:52:59 +0000"  >&lt;p&gt;No problem, thanks for helping to get the fix past the finish line! (And thanks for all of the work you do on PDFBox, it&apos;s a great tool!)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="13632083">PDFBOX-6085</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="13027546" name="Af.pdf" size="33247" author="tilman" created="Thu, 1 Jul 2021 18:04:32 +0000"/>
                            <attachment id="13027557" name="zwnj-pdfkit.pdf" size="22670" author="sdanig" created="Fri, 2 Jul 2021 01:52:59 +0000"/>
                            <attachment id="13027477" name="zwnj.pdf" size="22071" author="sdanig" created="Thu, 1 Jul 2021 02:41:35 +0000"/>
                            <attachment id="13030118" name="zwnj.png" size="8321" author="sdanig" created="Tue, 6 Jul 2021 01:52:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            35 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0shg8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>