diff --git a/src/main/java/com/google/devtools/build/lib/analysis/producers/PlatformFlagsProducer.java b/src/main/java/com/google/devtools/build/lib/analysis/producers/PlatformFlagsProducer.java
index 664fa58db6..3f3076f9e0 100644
--- a/src/main/java/com/google/devtools/build/lib/analysis/producers/PlatformFlagsProducer.java
+++ b/src/main/java/com/google/devtools/build/lib/analysis/producers/PlatformFlagsProducer.java
@@ -100,7 +100,12 @@ public class PlatformFlagsProducer implements StateMachine, PlatformInfoProducer
 
     PackageContext packageContext =
         PackageContext.of(platformLabel.getPackageIdentifier(), this.platformRepositoryMapping);
-    ParsedFlagsValue.Key parsedFlagsKey = ParsedFlagsValue.Key.create(flags, packageContext);
+    ParsedFlagsValue.Key parsedFlagsKey =
+        ParsedFlagsValue.Key.create(
+            flags,
+            packageContext,
+            // Include default values so that any flags explicitly reset to the default are kept.
+            /* includeDefaultValues= */ true);
     tasks.lookUp(parsedFlagsKey, OptionsParsingException.class, this::acceptParsedFlagsValue);
     return this::handleParsedFlags;
   }
diff --git a/src/test/java/com/google/devtools/build/lib/analysis/producers/BuildConfigurationKeyProducerTest.java b/src/test/java/com/google/devtools/build/lib/analysis/producers/BuildConfigurationKeyProducerTest.java
index 114a93a593..4788860be0 100644
--- a/src/test/java/com/google/devtools/build/lib/analysis/producers/BuildConfigurationKeyProducerTest.java
+++ b/src/test/java/com/google/devtools/build/lib/analysis/producers/BuildConfigurationKeyProducerTest.java
@@ -320,7 +320,6 @@ public class BuildConfigurationKeyProducerTest extends ProducerTestCase {
 
   // Regression test for https://github.com/bazelbuild/bazel/issues/23147
   @Test
-  @Ignore("https://github.com/bazelbuild/bazel/issues/23147")
   public void createKey_platformFlags_resetToDefault_starlark() throws Exception {
     createStarlarkFlag();
     scratch.overwriteFile(
diff --git a/src/test/java/com/google/devtools/build/lib/analysis/producers/PlatformFlagsProducerTest.java b/src/test/java/com/google/devtools/build/lib/analysis/producers/PlatformFlagsProducerTest.java
index eaa00fd0e0..76246198ca 100644
--- a/src/test/java/com/google/devtools/build/lib/analysis/producers/PlatformFlagsProducerTest.java
+++ b/src/test/java/com/google/devtools/build/lib/analysis/producers/PlatformFlagsProducerTest.java
@@ -22,7 +22,6 @@ import com.google.devtools.build.lib.skyframe.toolchains.PlatformLookupUtil.Inva
 import com.google.devtools.build.skyframe.state.StateMachine;
 import com.google.devtools.common.options.OptionsParsingException;
 import javax.annotation.Nullable;
-import org.junit.Ignore;
 import org.junit.Test;
 import org.junit.runner.RunWith;
 import org.junit.runners.JUnit4;
@@ -98,7 +97,6 @@ public class PlatformFlagsProducerTest extends ProducerTestCase {
 
   // Regression test for https://github.com/bazelbuild/bazel/issues/23147
   @Test
-  @Ignore("https://github.com/bazelbuild/bazel/issues/23147")
   public void starlarkFlag_resetToDefault() throws Exception {
     createStarlarkFlag();
     scratch.overwriteFile(
diff --git a/src/test/shell/integration/platform_based_flags_test.sh b/src/test/shell/integration/platform_based_flags_test.sh
index 252a789d56..454ecbeb5e 100755
--- a/src/test/shell/integration/platform_based_flags_test.sh
+++ b/src/test/shell/integration/platform_based_flags_test.sh
@@ -137,7 +137,7 @@ exports_files([
 
 sample_flag(
     name = "flag",
-    build_setting_default = "default",
+    build_setting_default = "default_value_for_flag",
 )
 
 show_sample_flag(
@@ -150,7 +150,7 @@ EOF
 # No platform flags, just verifying the flags.
 function test_sample_flag() {
   bazel build //pbf:show &> $TEST_log || fail "bazel failed"
-  expect_log '//pbf:show: value = "default"'
+  expect_log '//pbf:show: value = "default_value_for_flag"'
 
   bazel build --//pbf:flag=cli //pbf:show &> $TEST_log || fail "bazel failed"
   expect_log '//pbf:show: value = "cli"'
@@ -248,7 +248,7 @@ load(":sample_flag2.bzl", "sample_flag2", "show_sample_flag2")
 
 sample_flag2(
     name = "flag2",
-    build_setting_default = "default",
+    build_setting_default = "default_value_for_flag2",
 )
 
 show_sample_flag2(
@@ -320,7 +320,7 @@ EOF
   add_to_bazelrc "common:pbf --platforms=//$pkg:pbf_demo"
 
   bazel build //pbf:show &> $TEST_log || fail "bazel failed"
-  expect_log '//pbf:show: value = "default"'
+  expect_log '//pbf:show: value = "default_value_for_flag"'
 
   bazel build --config=pbf //pbf:show &> $TEST_log || fail "bazel failed"
   expect_log '//pbf:show: value = "platform"'
@@ -442,4 +442,33 @@ EOF
   expect_log '//pbf:show: value = "second"'
 }
 
+# Regression test for https://github.com/bazelbuild/bazel/issues/23147
+function test_reset_starlark_flag_to_default() {
+  local -r pkg="$FUNCNAME"
+  mkdir -p "$pkg"
+
+  cat > "$pkg/BUILD" <<EOF
+platform(
+    name = "pbf_demo",
+    flags = [
+        # Reset the flag to the default value.
+        "--//pbf:flag=default_value_for_flag",
+    ],
+)
+EOF
+
+  bazel build --//pbf:flag=cli --platforms="//$pkg:pbf_demo" //pbf:show &> $TEST_log || fail "bazel failed"
+
+  # Ensure the default value is seen.
+  expect_not_log '//pbf:show: value = "platform"'
+  expect_log '//pbf:show: value = "default_value_for_flag"'
+
+  # Check that the now-default Starlark flag is not present in the
+  # configuration.
+  for config in $(bazel config | tail -n +2 | cut -d ' ' -f 1); do
+    bazel config "${config}" &> $TEST_log
+    expect_not_log "//pbf:flag:.*default_value_for_flag" "Found default value for //pbf:flag in config ${config}"
+  done
+}
+
 run_suite "Tests for platform based flags"
