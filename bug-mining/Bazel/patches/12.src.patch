diff --git a/src/main/starlark/tests/builtins_bzl/cc/cc_shared_library/test_cc_shared_library/BUILD.builtin_test b/src/main/starlark/tests/builtins_bzl/cc/cc_shared_library/test_cc_shared_library/BUILD.builtin_test
index 1ac2bc2739..d1d12ae87d 100644
--- a/src/main/starlark/tests/builtins_bzl/cc/cc_shared_library/test_cc_shared_library/BUILD.builtin_test
+++ b/src/main/starlark/tests/builtins_bzl/cc/cc_shared_library/test_cc_shared_library/BUILD.builtin_test
@@ -8,6 +8,7 @@ load(
     "paths_test",
     "runfiles_test",
     "no_exporting_static_lib_test",
+    "check_already_linked_inputs_are_not_passed_to_linking_action_test",
 )
 
 LINKABLE_MORE_THAN_ONCE = "LINKABLE_MORE_THAN_ONCE"
@@ -470,6 +471,18 @@ no_exporting_static_lib_test(
     target_under_test = ":lib_with_no_exporting_roots",
 )
 
+check_already_linked_inputs_are_not_passed_to_linking_action_test(
+    name = "check_binary_doesnt_take_already_linked_in_libs",
+    target_under_test = ":binary",
+    libs_that_shouldnt_be_present = ["foo", "bar"],
+)
+
+check_already_linked_inputs_are_not_passed_to_linking_action_test(
+    name = "check_shared_lib_doesnt_take_already_linked_in_libs",
+    target_under_test = ":foo_so",
+    libs_that_shouldnt_be_present = ["bar"],
+)
+
 build_failure_test(
     name = "shared_library_without_deps",
     message = "'cc_shared_library' must have at least one dependency in 'deps' (or 'roots')",
diff --git a/src/main/starlark/tests/builtins_bzl/cc/cc_shared_library/test_cc_shared_library/starlark_tests.bzl b/src/main/starlark/tests/builtins_bzl/cc/cc_shared_library/test_cc_shared_library/starlark_tests.bzl
index c5de4978aa..678c03bba1 100644
--- a/src/main/starlark/tests/builtins_bzl/cc/cc_shared_library/test_cc_shared_library/starlark_tests.bzl
+++ b/src/main/starlark/tests/builtins_bzl/cc/cc_shared_library/test_cc_shared_library/starlark_tests.bzl
@@ -223,6 +223,30 @@ interface_library_output_group_test = analysistest.make(
     },
 )
 
+def _check_already_linked_inputs_are_not_passed_to_linking_action_test_impl(ctx):
+    env = analysistest.begin(ctx)
+
+    actions = analysistest.target_actions(env)
+
+    target_action = None
+    for action in actions:
+        if action.mnemonic == "FileWrite":
+            target_action = action
+            break
+    args = target_action.content.split("\n")
+    for arg in args:
+        for bad_lib_entry in ctx.attr.libs_that_shouldnt_be_present:
+            asserts.true(env, arg.find("{}.".format(bad_lib_entry)) == -1, "Should not have seen library `{}` in command line".format(arg))
+
+    return analysistest.end(env)
+
+check_already_linked_inputs_are_not_passed_to_linking_action_test = analysistest.make(
+    _check_already_linked_inputs_are_not_passed_to_linking_action_test_impl,
+    attrs = {
+        "libs_that_shouldnt_be_present": attr.string_list(),
+    },
+)
+
 def _no_exporting_static_lib_test_impl(ctx):
     env = analysistest.begin(ctx)
 
