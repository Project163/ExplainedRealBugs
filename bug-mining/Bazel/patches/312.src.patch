diff --git a/src/main/java/com/google/devtools/build/lib/remote/AbstractActionInputPrefetcher.java b/src/main/java/com/google/devtools/build/lib/remote/AbstractActionInputPrefetcher.java
index 2e367222e9..3a2769cf46 100644
--- a/src/main/java/com/google/devtools/build/lib/remote/AbstractActionInputPrefetcher.java
+++ b/src/main/java/com/google/devtools/build/lib/remote/AbstractActionInputPrefetcher.java
@@ -376,10 +376,9 @@ public abstract class AbstractActionInputPrefetcher implements ActionInputPrefet
 
       PathFragment execPath = input.getExecPath();
 
-      // input is known to be a non-source artifact and thus must have metadata.
-      FileArtifactValue metadata =
-          checkNotNull(metadataSupplier.getMetadata(input), "no metadata for %s", input);
-      if (!canDownloadFile(execRoot.getRelative(execPath), metadata)) {
+      // Metadata may legitimately be missing, e.g. if this is an optional test output.
+      FileArtifactValue metadata = metadataSupplier.getMetadata(input);
+      if (metadata == null || !canDownloadFile(execRoot.getRelative(execPath), metadata)) {
         return immediateVoidFuture();
       }
 
