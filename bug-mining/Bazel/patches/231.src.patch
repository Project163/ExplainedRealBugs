diff --git a/src/main/java/com/google/devtools/build/lib/actions/AbstractAction.java b/src/main/java/com/google/devtools/build/lib/actions/AbstractAction.java
index 2536826c2c..3d837acf0e 100644
--- a/src/main/java/com/google/devtools/build/lib/actions/AbstractAction.java
+++ b/src/main/java/com/google/devtools/build/lib/actions/AbstractAction.java
@@ -125,8 +125,8 @@ public abstract class AbstractAction extends ActionKeyComputer implements Action
   /**
    * {@inheritDoc}
    *
-   * <p>Should be overridden along with {@link #discoverInputs}, {@link #inputsDiscovered}, and
-   * {@link #setInputsDiscovered} by actions that do input discovery.
+   * <p>Should be overridden along with {@link #discoverInputs}, {@link #inputsDiscovered}, {@link
+   * #setInputsDiscovered} and {@link #getOriginalInputs} by actions that do input discovery.
    */
   @Override
   public boolean discoversInputs() {
@@ -137,8 +137,7 @@ public abstract class AbstractAction extends ActionKeyComputer implements Action
   @Nullable
   public NestedSet<Artifact> discoverInputs(ActionExecutionContext actionExecutionContext)
       throws ActionExecutionException, InterruptedException {
-    throw new IllegalStateException("discoverInputs cannot be called for " + this.prettyPrint()
-        + " since it does not discover inputs");
+    throw new IllegalStateException("Not an input-discovering action: " + this);
   }
 
   @Override
@@ -147,12 +146,9 @@ public abstract class AbstractAction extends ActionKeyComputer implements Action
     if (!inputsKnown()) {
       return;
     }
-    NestedSet<Artifact> originalInputs = getOriginalInputs();
-    if (originalInputs != null) {
-      synchronized (this) {
-        inputs = originalInputs;
-        setInputsDiscovered(false);
-      }
+    synchronized (this) {
+      inputs = getOriginalInputs();
+      setInputsDiscovered(false);
     }
   }
 
@@ -168,7 +164,7 @@ public abstract class AbstractAction extends ActionKeyComputer implements Action
   @ForOverride
   @GuardedBy("this")
   protected boolean inputsDiscovered() {
-    throw new IllegalStateException("Must be overridden by input-discovering actions: " + this);
+    throw new IllegalStateException("Must be overridden by input-discovering action: " + this);
   }
 
   /**
@@ -178,26 +174,19 @@ public abstract class AbstractAction extends ActionKeyComputer implements Action
   @ForOverride
   @GuardedBy("this")
   protected void setInputsDiscovered(boolean inputsDiscovered) {
-    throw new IllegalStateException("Must be overridden by input-discovering actions: " + this);
+    throw new IllegalStateException("Must be overridden by input-discovering action: " + this);
   }
 
-  /**
-   * Returns this action's <em>original</em> inputs, prior to {@linkplain #discoverInputs input
-   * discovery}.
-   *
-   * <p>Input-discovering actions which are able to reconstitute their original inputs may override
-   * this, allowing for memory savings.
-   */
-  @Nullable
-  @ForOverride
-  protected NestedSet<Artifact> getOriginalInputs() {
-    return null;
+  @Override
+  public NestedSet<Artifact> getOriginalInputs() {
+    checkState(!discoversInputs(), "Must be overridden by input-discovering action");
+    return getInputs();
   }
 
   @Override
   public NestedSet<Artifact> getAllowedDerivedInputs() {
     throw new IllegalStateException(
-        "Method must be overridden for actions that may have unknown inputs.");
+        "Must be overridden for action that may have unknown inputs: " + this);
   }
 
   @Override
@@ -217,7 +206,7 @@ public abstract class AbstractAction extends ActionKeyComputer implements Action
    */
   @Override
   public synchronized void updateInputs(NestedSet<Artifact> inputs) {
-    checkState(discoversInputs(), "Can't update inputs unless discovering: %s %s", this, inputs);
+    checkState(discoversInputs(), "Not an input-discovering action: %s", this);
     this.inputs = inputs;
     setInputsDiscovered(true);
   }
@@ -295,9 +284,7 @@ public abstract class AbstractAction extends ActionKeyComputer implements Action
     // The default behavior is to return the first input artifact of the original input list (before
     // input discovery).
     // Call through the method, not the field, because it may be overridden.
-    NestedSet<Artifact> originalInputs = getOriginalInputs();
-    NestedSet<Artifact> inputs = originalInputs == null ? getInputs() : originalInputs;
-    return Iterables.getFirst(inputs.toList(), null);
+    return Iterables.getFirst(getOriginalInputs().toList(), null);
   }
 
   @Override
diff --git a/src/main/java/com/google/devtools/build/lib/actions/ActionAnalysisMetadata.java b/src/main/java/com/google/devtools/build/lib/actions/ActionAnalysisMetadata.java
index 0fd1146552..de39c32846 100644
--- a/src/main/java/com/google/devtools/build/lib/actions/ActionAnalysisMetadata.java
+++ b/src/main/java/com/google/devtools/build/lib/actions/ActionAnalysisMetadata.java
@@ -128,12 +128,19 @@ public interface ActionAnalysisMetadata {
   /**
    * Returns the input Artifacts that this Action depends upon. May be empty.
    *
-   * <p>For actions that do input discovery or input pruning, a different result may be returned
-   * before and after action execution, because input discovery may add additional artifacts from
-   * {@link #getSchedulingDependencies}, and input pruning may remove them.
+   * <p>For actions that do input discovery, a different result may be returned before and after
+   * action execution, because input discovery may add or remove inputs. The original input set may
+   * be retrieved from {@link ActionExecutionMetadata#getOriginalInputs}.
    */
   NestedSet<Artifact> getInputs();
 
+  /**
+   * Returns this action's original inputs prior to input discovery.
+   *
+   * <p>Unlike {@link #getInputs}, the same result is returned before and after action execution.
+   */
+  NestedSet<Artifact> getOriginalInputs();
+
   /**
    * Returns the input Artifacts that must be built before the action can be executed, but are not
    * dependencies of the action in the action cache.
@@ -167,7 +174,7 @@ public interface ActionAnalysisMetadata {
    * other files as well. For example C(++) compilation may perform include file header scanning.
    * This needs to be mirrored by the extra_action rule. Called by {@link
    * com.google.devtools.build.lib.analysis.extra.ExtraAction} at execution time for actions that
-   * return true for {link #discoversInputs()}.
+   * return true for {link ActionExecutionMetadata#discoversInputs}.
    *
    * @param actionExecutionContext Services in the scope of the action, like the Out/Err streams.
    * @throws ActionExecutionException only when code called from this method throws that exception.
diff --git a/src/main/java/com/google/devtools/build/lib/actions/ActionExecutionMetadata.java b/src/main/java/com/google/devtools/build/lib/actions/ActionExecutionMetadata.java
index eb9cc3d0e6..606491accd 100644
--- a/src/main/java/com/google/devtools/build/lib/actions/ActionExecutionMetadata.java
+++ b/src/main/java/com/google/devtools/build/lib/actions/ActionExecutionMetadata.java
@@ -79,7 +79,8 @@ public interface ActionExecutionMetadata extends ActionAnalysisMetadata {
   String describeKey();
 
   /**
-   * Returns true iff the {@link #getInputs} set is known to be complete.
+   * Returns true iff the {@link #getInputs} set has been updated taking input discovery into
+   * account.
    *
    * <p>For most actions, this always returns true. For actions which {@linkplain #discoversInputs
    * discover inputs} (e.g. C++ compilation), inputs are dynamically discovered from the previous
diff --git a/src/main/java/com/google/devtools/build/lib/analysis/actions/SpawnActionTemplate.java b/src/main/java/com/google/devtools/build/lib/analysis/actions/SpawnActionTemplate.java
index 90c91a3518..dac19db781 100644
--- a/src/main/java/com/google/devtools/build/lib/analysis/actions/SpawnActionTemplate.java
+++ b/src/main/java/com/google/devtools/build/lib/analysis/actions/SpawnActionTemplate.java
@@ -206,6 +206,11 @@ public final class SpawnActionTemplate extends ActionKeyComputer
     return allInputs;
   }
 
+  @Override
+  public NestedSet<Artifact> getOriginalInputs() {
+    return getInputs();
+  }
+
   @Override
   public NestedSet<Artifact> getSchedulingDependencies() {
     return NestedSetBuilder.emptySet(Order.STABLE_ORDER);
diff --git a/src/main/java/com/google/devtools/build/lib/analysis/actions/StarlarkAction.java b/src/main/java/com/google/devtools/build/lib/analysis/actions/StarlarkAction.java
index 7288670b9f..c6df48534c 100644
--- a/src/main/java/com/google/devtools/build/lib/analysis/actions/StarlarkAction.java
+++ b/src/main/java/com/google/devtools/build/lib/analysis/actions/StarlarkAction.java
@@ -256,7 +256,7 @@ public class StarlarkAction extends SpawnAction {
     }
 
     @Override
-    protected NestedSet<Artifact> getOriginalInputs() {
+    public NestedSet<Artifact> getOriginalInputs() {
       return allStarlarkActionInputs;
     }
 
diff --git a/src/main/java/com/google/devtools/build/lib/analysis/extra/ExtraAction.java b/src/main/java/com/google/devtools/build/lib/analysis/extra/ExtraAction.java
index b1c4c6391a..d2a3f12892 100644
--- a/src/main/java/com/google/devtools/build/lib/analysis/extra/ExtraAction.java
+++ b/src/main/java/com/google/devtools/build/lib/analysis/extra/ExtraAction.java
@@ -136,6 +136,11 @@ public final class ExtraAction extends SpawnAction {
         Order.STABLE_ORDER, Sets.difference(getInputs().toSet(), oldInputs.toSet()));
   }
 
+  @Override
+  public NestedSet<Artifact> getOriginalInputs() {
+    return shadowedAction.getOriginalInputs();
+  }
+
   @Override
   public NestedSet<Artifact> getSchedulingDependencies() {
     return shadowedAction.getSchedulingDependencies();
diff --git a/src/main/java/com/google/devtools/build/lib/buildtool/AqueryProcessor.java b/src/main/java/com/google/devtools/build/lib/buildtool/AqueryProcessor.java
index d938f7ae11..be2787e860 100644
--- a/src/main/java/com/google/devtools/build/lib/buildtool/AqueryProcessor.java
+++ b/src/main/java/com/google/devtools/build/lib/buildtool/AqueryProcessor.java
@@ -87,7 +87,7 @@ public final class AqueryProcessor extends PostAnalysisQueryProcessor<Configured
             new ActionGraphDump(
                 aqueryOptions.includeCommandline,
                 aqueryOptions.includeArtifacts,
-                aqueryOptions.includeSchedulingDependencies,
+                aqueryOptions.includePrunedInputs,
                 actionFilters,
                 aqueryOptions.includeParamFiles,
                 aqueryOptions.includeFileWriteContents,
diff --git a/src/main/java/com/google/devtools/build/lib/buildtool/BuildTool.java b/src/main/java/com/google/devtools/build/lib/buildtool/BuildTool.java
index 79c78797b9..e78715b406 100644
--- a/src/main/java/com/google/devtools/build/lib/buildtool/BuildTool.java
+++ b/src/main/java/com/google/devtools/build/lib/buildtool/BuildTool.java
@@ -589,7 +589,7 @@ public class BuildTool {
           new ActionGraphDump(
               /* includeActionCmdLine= */ false,
               /* includeArtifacts= */ true,
-              /* includeSchedulingDependencies= */ true,
+              /* includePrunedInputs= */ true,
               /* actionFilters= */ null,
               /* includeParamFiles= */ false,
               /* includeFileWriteContents= */ false,
diff --git a/src/main/java/com/google/devtools/build/lib/includescanning/SpawnIncludeScanner.java b/src/main/java/com/google/devtools/build/lib/includescanning/SpawnIncludeScanner.java
index 190ee1c2e4..c963770e58 100644
--- a/src/main/java/com/google/devtools/build/lib/includescanning/SpawnIncludeScanner.java
+++ b/src/main/java/com/google/devtools/build/lib/includescanning/SpawnIncludeScanner.java
@@ -202,6 +202,11 @@ public class SpawnIncludeScanner {
       return actionExecutionMetadata.getInputs();
     }
 
+    @Override
+    public NestedSet<Artifact> getOriginalInputs() {
+      return actionExecutionMetadata.getInputs();
+    }
+
     @Override
     public NestedSet<Artifact> getSchedulingDependencies() {
       throw new UnsupportedOperationException();
diff --git a/src/main/java/com/google/devtools/build/lib/query2/aquery/ActionGraphProtoOutputFormatterCallback.java b/src/main/java/com/google/devtools/build/lib/query2/aquery/ActionGraphProtoOutputFormatterCallback.java
index b328d234b4..7f608e1f0b 100644
--- a/src/main/java/com/google/devtools/build/lib/query2/aquery/ActionGraphProtoOutputFormatterCallback.java
+++ b/src/main/java/com/google/devtools/build/lib/query2/aquery/ActionGraphProtoOutputFormatterCallback.java
@@ -75,7 +75,7 @@ public class ActionGraphProtoOutputFormatterCallback extends AqueryThreadsafeCal
         new ActionGraphDump(
             options.includeCommandline,
             options.includeArtifacts,
-            options.includeSchedulingDependencies,
+            options.includePrunedInputs,
             this.actionFilters,
             options.includeParamFiles,
             options.includeFileWriteContents,
diff --git a/src/main/java/com/google/devtools/build/lib/query2/aquery/ActionGraphSummaryOutputFormatterCallback.java b/src/main/java/com/google/devtools/build/lib/query2/aquery/ActionGraphSummaryOutputFormatterCallback.java
index 69a74f0c2e..bf7c6919f5 100644
--- a/src/main/java/com/google/devtools/build/lib/query2/aquery/ActionGraphSummaryOutputFormatterCallback.java
+++ b/src/main/java/com/google/devtools/build/lib/query2/aquery/ActionGraphSummaryOutputFormatterCallback.java
@@ -82,7 +82,7 @@ class ActionGraphSummaryOutputFormatterCallback extends AqueryThreadsafeCallback
   }
 
   private void processAction(ActionAnalysisMetadata action) throws InterruptedException {
-    if (!AqueryUtils.matchesAqueryFilters(action, actionFilters)) {
+    if (!AqueryUtils.matchesAqueryFilters(action, actionFilters, options.includePrunedInputs)) {
       return;
     }
 
diff --git a/src/main/java/com/google/devtools/build/lib/query2/aquery/ActionGraphTextOutputFormatterCallback.java b/src/main/java/com/google/devtools/build/lib/query2/aquery/ActionGraphTextOutputFormatterCallback.java
index 836e5849e7..1e55768699 100644
--- a/src/main/java/com/google/devtools/build/lib/query2/aquery/ActionGraphTextOutputFormatterCallback.java
+++ b/src/main/java/com/google/devtools/build/lib/query2/aquery/ActionGraphTextOutputFormatterCallback.java
@@ -14,6 +14,7 @@
 package com.google.devtools.build.lib.query2.aquery;
 
 import static com.google.common.collect.ImmutableList.toImmutableList;
+import static com.google.devtools.build.lib.query2.aquery.AqueryUtils.getActionInputs;
 import static com.google.devtools.build.lib.util.StringUtil.reencodeInternalToExternal;
 import static java.nio.charset.StandardCharsets.UTF_8;
 
@@ -37,6 +38,7 @@ import com.google.devtools.build.lib.analysis.actions.TemplateExpansionAction;
 import com.google.devtools.build.lib.analysis.starlark.UnresolvedSymlinkAction;
 import com.google.devtools.build.lib.buildeventstream.BuildEvent;
 import com.google.devtools.build.lib.buildeventstream.BuildEventStreamProtos;
+import com.google.devtools.build.lib.collect.nestedset.NestedSet;
 import com.google.devtools.build.lib.events.ExtendedEventHandler;
 import com.google.devtools.build.lib.packages.AspectDescriptor;
 import com.google.devtools.build.lib.packages.LabelPrinter;
@@ -122,7 +124,7 @@ class ActionGraphTextOutputFormatterCallback extends AqueryThreadsafeCallback {
       getParamFileNameToContentMap().put(paramFileName, fileContent);
     }
 
-    if (!AqueryUtils.matchesAqueryFilters(action, actionFilters)) {
+    if (!AqueryUtils.matchesAqueryFilters(action, actionFilters, options.includePrunedInputs)) {
       return;
     }
 
@@ -199,26 +201,17 @@ class ActionGraphTextOutputFormatterCallback extends AqueryThreadsafeCallback {
     }
 
     if (options.includeArtifacts) {
+      NestedSet<Artifact> inputs = getActionInputs(action, options.includePrunedInputs);
+
       stringBuilder
           .append("  Inputs: [")
           .append(
-              action.getInputs().toList().stream()
+              inputs.toList().stream()
                   .map(input -> escapeBytestringUtf8(input.getExecPathString()))
                   .sorted()
                   .collect(Collectors.joining(", ")))
           .append("]\n");
 
-      if (options.includeSchedulingDependencies && !action.getSchedulingDependencies().isEmpty()) {
-        stringBuilder
-            .append("  SchedulingDependencies: [")
-            .append(
-                action.getSchedulingDependencies().toList().stream()
-                    .map(input -> escapeBytestringUtf8(input.getExecPathString()))
-                    .sorted()
-                    .collect(Collectors.joining(", ")))
-            .append("]\n");
-      }
-
       stringBuilder
           .append("  Outputs: [")
           .append(
@@ -279,7 +272,7 @@ class ActionGraphTextOutputFormatterCallback extends AqueryThreadsafeCallback {
     if (options.includeParamFiles) {
       // Assumption: if an Action takes a param file as an input, it will be used
       // to provide params to the command.
-      for (Artifact input : action.getInputs().toList()) {
+      for (Artifact input : getActionInputs(action, options.includePrunedInputs).toList()) {
         String inputFileName = input.getExecPathString();
         if (getParamFileNameToContentMap().containsKey(inputFileName)) {
           stringBuilder
diff --git a/src/main/java/com/google/devtools/build/lib/query2/aquery/AqueryOptions.java b/src/main/java/com/google/devtools/build/lib/query2/aquery/AqueryOptions.java
index 845477c0a6..699ee950d2 100644
--- a/src/main/java/com/google/devtools/build/lib/query2/aquery/AqueryOptions.java
+++ b/src/main/java/com/google/devtools/build/lib/query2/aquery/AqueryOptions.java
@@ -43,20 +43,19 @@ public class AqueryOptions extends CommonQueryOptions {
       defaultValue = "true",
       documentationCategory = OptionDocumentationCategory.QUERY,
       effectTags = {OptionEffectTag.TERMINAL_OUTPUT},
-      help =
-          "Includes names of the action inputs and outputs in the output " + "(potentially large).")
+      help = "Includes names of the action inputs and outputs in the output (potentially large).")
   public boolean includeArtifacts;
 
   @Option(
-      name = "include_scheduling_dependencies",
-      defaultValue = "false",
+      name = "include_pruned_inputs",
+      defaultValue = "true",
       documentationCategory = OptionDocumentationCategory.QUERY,
       effectTags = {OptionEffectTag.TERMINAL_OUTPUT},
       help =
-          "Includes names of the scheduling dependencies of actions "
-              + "(potentially large). "
-              + "Only takes effect if --include_artifacts is also set.")
-  public boolean includeSchedulingDependencies;
+          "Includes action inputs that were pruned during action execution. Only affects actions"
+              + " that discover inputs and have been executed in a previous invocation. Only takes"
+              + " effect if --include_artifacts is also set.")
+  public boolean includePrunedInputs;
 
   @Option(
       name = "include_param_files",
diff --git a/src/main/java/com/google/devtools/build/lib/query2/aquery/AqueryUtils.java b/src/main/java/com/google/devtools/build/lib/query2/aquery/AqueryUtils.java
index 0eba0fd1da..abfc2f04d0 100644
--- a/src/main/java/com/google/devtools/build/lib/query2/aquery/AqueryUtils.java
+++ b/src/main/java/com/google/devtools/build/lib/query2/aquery/AqueryUtils.java
@@ -19,26 +19,59 @@ import static com.google.devtools.build.lib.query2.engine.OutputsFunction.OUTPUT
 
 import com.google.common.collect.Streams;
 import com.google.devtools.build.lib.actions.ActionAnalysisMetadata;
+import com.google.devtools.build.lib.actions.ActionExecutionMetadata;
 import com.google.devtools.build.lib.actions.Artifact;
 import com.google.devtools.build.lib.actions.Artifact.DerivedArtifact;
 import com.google.devtools.build.lib.actions.ArtifactPathResolver;
 import com.google.devtools.build.lib.analysis.actions.TemplateExpansionAction;
 import com.google.devtools.build.lib.collect.nestedset.NestedSet;
+import com.google.devtools.build.lib.collect.nestedset.NestedSetBuilder;
 import java.io.IOException;
 
 /** Utility class for Aquery */
 public class AqueryUtils {
 
+  private AqueryUtils() {}
+
+  /**
+   * Returns the set of action inputs according to the --include_pruned_inputs flag.
+   *
+   * <p>This may differ from {@link ActionAnalysisMetadata#getInputs} for actions that discover
+   * inputs.
+   *
+   * @param action the analysis metadata of an action
+   * @param includePrunedInputs the value of the --include_pruned_inputs flag
+   */
+  public static NestedSet<Artifact> getActionInputs(
+      ActionAnalysisMetadata action, boolean includePrunedInputs) {
+    if (includePrunedInputs
+        || (action instanceof ActionExecutionMetadata actionExecutionMetadata
+            && !actionExecutionMetadata.inputsKnown())) {
+      // getInputs() is potentially missing inputs that will be added by discovery (if the action
+      // hasn't yet executed) and inputs that have been removed by discovery (if the action has
+      // already executed). Instead, assemble the inputs from getOriginalInputs() and
+      // getSchedulingDependencies(), which also include those added or removed by discovery.
+      return NestedSetBuilder.<Artifact>stableOrder()
+          .addTransitive(action.getOriginalInputs())
+          .addTransitive(action.getSchedulingDependencies())
+          .build();
+    }
+    return action.getInputs();
+  }
+
   /**
    * Return true if the given {@code action} matches the filters specified in {@code actionFilters}.
    *
    * @param action the analysis metadata of an action
    * @param actionFilters the filters parsed from the query expression
+   * @param includePrunedInputs the value of the --include_pruned_inputs flag
    * @return whether the action matches the filtering patterns
    */
   public static boolean matchesAqueryFilters(
-      ActionAnalysisMetadata action, AqueryActionFilter actionFilters) {
-    NestedSet<Artifact> inputs = action.getInputs();
+      ActionAnalysisMetadata action,
+      AqueryActionFilter actionFilters,
+      boolean includePrunedInputs) {
+    NestedSet<Artifact> inputs = getActionInputs(action, includePrunedInputs);
     Iterable<Artifact> outputs = action.getOutputs();
     String mnemonic = action.getMnemonic();
 
@@ -49,7 +82,7 @@ public class AqueryUtils {
     }
 
     if (actionFilters.hasFilterForFunction(INPUTS)) {
-      Boolean containsFile =
+      boolean containsFile =
           inputs.toList().stream()
               .anyMatch(
                   artifact ->
@@ -62,7 +95,7 @@ public class AqueryUtils {
     }
 
     if (actionFilters.hasFilterForFunction(OUTPUTS)) {
-      Boolean containsFile =
+      boolean containsFile =
           Streams.stream(outputs)
               .anyMatch(
                   artifact ->
diff --git a/src/main/java/com/google/devtools/build/lib/rules/cpp/CppCompileAction.java b/src/main/java/com/google/devtools/build/lib/rules/cpp/CppCompileAction.java
index 533b2d96c2..8ba94f289c 100644
--- a/src/main/java/com/google/devtools/build/lib/rules/cpp/CppCompileAction.java
+++ b/src/main/java/com/google/devtools/build/lib/rules/cpp/CppCompileAction.java
@@ -616,7 +616,7 @@ public class CppCompileAction extends AbstractAction implements IncludeScannable
   }
 
   @Override
-  protected final NestedSet<Artifact> getOriginalInputs() {
+  public final NestedSet<Artifact> getOriginalInputs() {
     return mandatoryInputs;
   }
 
diff --git a/src/main/java/com/google/devtools/build/lib/rules/cpp/CppCompileActionTemplate.java b/src/main/java/com/google/devtools/build/lib/rules/cpp/CppCompileActionTemplate.java
index 518d9d17e9..6968a2651c 100644
--- a/src/main/java/com/google/devtools/build/lib/rules/cpp/CppCompileActionTemplate.java
+++ b/src/main/java/com/google/devtools/build/lib/rules/cpp/CppCompileActionTemplate.java
@@ -346,6 +346,11 @@ public final class CppCompileActionTemplate extends ActionKeyComputer
         .build();
   }
 
+  @Override
+  public NestedSet<Artifact> getOriginalInputs() {
+    return getInputs();
+  }
+
   @Override
   public NestedSet<Artifact> getSchedulingDependencies() {
     return NestedSetBuilder.emptySet(Order.STABLE_ORDER);
diff --git a/src/main/java/com/google/devtools/build/lib/rules/cpp/LtoBackendAction.java b/src/main/java/com/google/devtools/build/lib/rules/cpp/LtoBackendAction.java
index 5546f87bb8..2f50b6a6e6 100644
--- a/src/main/java/com/google/devtools/build/lib/rules/cpp/LtoBackendAction.java
+++ b/src/main/java/com/google/devtools/build/lib/rules/cpp/LtoBackendAction.java
@@ -223,7 +223,7 @@ public final class LtoBackendAction extends SpawnAction {
   }
 
   @Override
-  protected NestedSet<Artifact> getOriginalInputs() {
+  public NestedSet<Artifact> getOriginalInputs() {
     return mandatoryInputs;
   }
 
diff --git a/src/main/java/com/google/devtools/build/lib/rules/cpp/LtoBackendActionTemplate.java b/src/main/java/com/google/devtools/build/lib/rules/cpp/LtoBackendActionTemplate.java
index 01021d282c..6c40c222a3 100644
--- a/src/main/java/com/google/devtools/build/lib/rules/cpp/LtoBackendActionTemplate.java
+++ b/src/main/java/com/google/devtools/build/lib/rules/cpp/LtoBackendActionTemplate.java
@@ -408,6 +408,11 @@ public final class LtoBackendActionTemplate extends ActionKeyComputer
     return allInputs;
   }
 
+  @Override
+  public NestedSet<Artifact> getOriginalInputs() {
+    return allInputs;
+  }
+
   @Override
   public ImmutableSet<Artifact> getOutputs() {
     ImmutableSet.Builder<Artifact> builder = ImmutableSet.builder();
diff --git a/src/main/java/com/google/devtools/build/lib/skyframe/actiongraph/v2/ActionGraphDump.java b/src/main/java/com/google/devtools/build/lib/skyframe/actiongraph/v2/ActionGraphDump.java
index 50fbeb1304..9449bbc0d7 100644
--- a/src/main/java/com/google/devtools/build/lib/skyframe/actiongraph/v2/ActionGraphDump.java
+++ b/src/main/java/com/google/devtools/build/lib/skyframe/actiongraph/v2/ActionGraphDump.java
@@ -13,6 +13,8 @@
 // limitations under the License.
 package com.google.devtools.build.lib.skyframe.actiongraph.v2;
 
+import static com.google.devtools.build.lib.query2.aquery.AqueryUtils.getActionInputs;
+
 import com.google.common.base.Preconditions;
 import com.google.common.collect.ImmutableList;
 import com.google.common.collect.ImmutableMap;
@@ -68,7 +70,7 @@ public class ActionGraphDump {
   @Nullable private final AqueryActionFilter actionFilters;
   private final boolean includeActionCmdLine;
   private final boolean includeArtifacts;
-  private final boolean includeSchedulingDependencies;
+  private final boolean includePrunedInputs;
   private final boolean includeParamFiles;
   private final boolean includeFileWriteContents;
   private final AqueryOutputHandler aqueryOutputHandler;
@@ -79,7 +81,7 @@ public class ActionGraphDump {
   public ActionGraphDump(
       boolean includeActionCmdLine,
       boolean includeArtifacts,
-      boolean includeSchedulingDependencies,
+      boolean includePrunedInputs,
       AqueryActionFilter actionFilters,
       boolean includeParamFiles,
       boolean includeFileWriteContents,
@@ -89,7 +91,7 @@ public class ActionGraphDump {
         /* actionGraphTargets= */ ImmutableList.of("..."),
         includeActionCmdLine,
         includeArtifacts,
-        includeSchedulingDependencies,
+        includePrunedInputs,
         actionFilters,
         includeParamFiles,
         includeFileWriteContents,
@@ -101,7 +103,7 @@ public class ActionGraphDump {
       List<String> actionGraphTargets,
       boolean includeActionCmdLine,
       boolean includeArtifacts,
-      boolean includeSchedulingDependencies,
+      boolean includePrunedInputs,
       AqueryActionFilter actionFilters,
       boolean includeParamFiles,
       boolean includeFileWriteContents,
@@ -110,7 +112,7 @@ public class ActionGraphDump {
     this.actionGraphTargets = ImmutableSet.copyOf(actionGraphTargets);
     this.includeActionCmdLine = includeActionCmdLine;
     this.includeArtifacts = includeArtifacts;
-    this.includeSchedulingDependencies = includeSchedulingDependencies;
+    this.includePrunedInputs = includePrunedInputs;
     this.actionFilters = actionFilters;
     this.includeParamFiles = includeParamFiles;
     this.includeFileWriteContents = includeFileWriteContents;
@@ -150,7 +152,8 @@ public class ActionGraphDump {
       getParamFileNameToContentMap().put(paramFileExecPath, fileContent);
     }
 
-    if (actionFilters != null && !AqueryUtils.matchesAqueryFilters(action, actionFilters)) {
+    if (actionFilters != null
+        && !AqueryUtils.matchesAqueryFilters(action, actionFilters, includePrunedInputs)) {
       return;
     }
 
@@ -217,7 +220,7 @@ public class ActionGraphDump {
     if (includeParamFiles) {
       // Assumption: if an Action takes a params file as an input, it will be used
       // to provide params to the command.
-      for (Artifact input : action.getInputs().toList()) {
+      for (Artifact input : getActionInputs(action, includePrunedInputs).toList()) {
         String inputFileExecPath = input.getExecPathString();
         if (getParamFileNameToContentMap().containsKey(inputFileExecPath)) {
           AnalysisProtosV2.ParamFile paramFile =
@@ -257,19 +260,13 @@ public class ActionGraphDump {
     }
 
     if (includeArtifacts) {
-      // Store inputs
-      NestedSet<Artifact> inputs = action.getInputs();
+      // Store inputs.
+      NestedSet<Artifact> inputs = getActionInputs(action, includePrunedInputs);
       if (!inputs.isEmpty()) {
         actionBuilder.addInputDepSetIds(knownNestedSets.dataToIdAndStreamOutputProto(inputs));
       }
 
-      NestedSet<Artifact> schedulingDependencies = action.getSchedulingDependencies();
-      if (includeSchedulingDependencies && !schedulingDependencies.isEmpty()) {
-        actionBuilder.addInputDepSetIds(
-            knownNestedSets.dataToIdAndStreamOutputProto(schedulingDependencies));
-      }
-
-      // store outputs
+      // Store outputs.
       for (Artifact artifact : action.getOutputs()) {
         actionBuilder.addOutputIds(knownArtifacts.dataToIdAndStreamOutputProto(artifact));
       }
diff --git a/src/main/protobuf/analysis_v2.proto b/src/main/protobuf/analysis_v2.proto
index 83f420359a..89ad91c410 100644
--- a/src/main/protobuf/analysis_v2.proto
+++ b/src/main/protobuf/analysis_v2.proto
@@ -80,14 +80,10 @@ message Action {
   repeated KeyValuePair environment_variables = 7;
 
   // The set of input dep sets that the action depends upon. If the action does
-  // input discovery, the contents of this set might change during execution.
+  // input discovery and `--include_pruned_outputs` is disabled, the contents of
+  // this set might differ before and after execution.
   repeated uint32 input_dep_set_ids = 8;
 
-  // The set of scheduling dependency dep sets the action depends on.
-  // Only set of both --include_artifacts and --include_scheduling_dependencies
-  // is set to true.
-  repeated uint32 scheduling_dep_dep_set_ids = 20;
-
   // The list of Artifact IDs that represent the output files that this action
   // will generate.
   repeated uint32 output_ids = 9;
@@ -129,6 +125,8 @@ message Action {
   // If FileWrite actions should make their output executable.
   // (ctx.actions.write(is_executable=True))
   bool is_executable = 19;
+
+  reserved 20;
 }
 
 // Represents a single target (without configuration information) that is
diff --git a/src/test/java/com/google/devtools/build/lib/actions/ResourceManagerTest.java b/src/test/java/com/google/devtools/build/lib/actions/ResourceManagerTest.java
index dcb5c4ec8b..0d2db28283 100644
--- a/src/test/java/com/google/devtools/build/lib/actions/ResourceManagerTest.java
+++ b/src/test/java/com/google/devtools/build/lib/actions/ResourceManagerTest.java
@@ -860,6 +860,11 @@ public final class ResourceManagerTest {
       throw new IllegalStateException();
     }
 
+    @Override
+    public NestedSet<Artifact> getOriginalInputs() {
+      throw new IllegalStateException();
+    }
+
     @Override
     public NestedSet<Artifact> getSchedulingDependencies() {
       throw new IllegalStateException();
diff --git a/src/test/java/com/google/devtools/build/lib/actions/util/TestAction.java b/src/test/java/com/google/devtools/build/lib/actions/util/TestAction.java
index 38144fec8b..dd4a5f9c3f 100644
--- a/src/test/java/com/google/devtools/build/lib/actions/util/TestAction.java
+++ b/src/test/java/com/google/devtools/build/lib/actions/util/TestAction.java
@@ -105,6 +105,11 @@ public class TestAction extends AbstractAction {
     this.inputsDiscovered = inputsDiscovered;
   }
 
+  @Override
+  public NestedSet<Artifact> getOriginalInputs() {
+    return mandatoryInputs;
+  }
+
   @Override
   public NestedSet<Artifact> getAllowedDerivedInputs() {
     return NestedSetBuilder.<Artifact>wrap(Order.STABLE_ORDER, optionalInputs);
diff --git a/src/test/java/com/google/devtools/build/lib/exec/util/FakeOwner.java b/src/test/java/com/google/devtools/build/lib/exec/util/FakeOwner.java
index d11baababd..2f52090552 100644
--- a/src/test/java/com/google/devtools/build/lib/exec/util/FakeOwner.java
+++ b/src/test/java/com/google/devtools/build/lib/exec/util/FakeOwner.java
@@ -136,6 +136,11 @@ public class FakeOwner implements ActionExecutionMetadata {
     throw new UnsupportedOperationException();
   }
 
+  @Override
+  public NestedSet<Artifact> getOriginalInputs() {
+    throw new UnsupportedOperationException();
+  }
+
   @Override
   public NestedSet<Artifact> getSchedulingDependencies() {
     throw new UnsupportedOperationException();
diff --git a/src/test/java/com/google/devtools/build/lib/skyframe/ActionTemplateExpansionFunctionTest.java b/src/test/java/com/google/devtools/build/lib/skyframe/ActionTemplateExpansionFunctionTest.java
index 990bb9738e..db3df56ec7 100644
--- a/src/test/java/com/google/devtools/build/lib/skyframe/ActionTemplateExpansionFunctionTest.java
+++ b/src/test/java/com/google/devtools/build/lib/skyframe/ActionTemplateExpansionFunctionTest.java
@@ -506,6 +506,11 @@ public final class ActionTemplateExpansionFunctionTest extends FoundationTestCas
       return NestedSetBuilder.create(Order.STABLE_ORDER, inputTreeArtifact);
     }
 
+    @Override
+    public NestedSet<Artifact> getOriginalInputs() {
+      return getInputs();
+    }
+
     @Override
     public NestedSet<Artifact> getSchedulingDependencies() {
       return NestedSetBuilder.emptySet(Order.STABLE_ORDER);
diff --git a/src/test/java/com/google/devtools/build/lib/skyframe/SequencedSkyframeExecutorTest.java b/src/test/java/com/google/devtools/build/lib/skyframe/SequencedSkyframeExecutorTest.java
index 0ce35b40b6..ca07e206da 100644
--- a/src/test/java/com/google/devtools/build/lib/skyframe/SequencedSkyframeExecutorTest.java
+++ b/src/test/java/com/google/devtools/build/lib/skyframe/SequencedSkyframeExecutorTest.java
@@ -1458,6 +1458,11 @@ public final class SequencedSkyframeExecutorTest extends BuildViewTestCase {
       return NestedSetBuilder.create(Order.STABLE_ORDER, inputArtifact);
     }
 
+    @Override
+    public NestedSet<Artifact> getOriginalInputs() {
+      return getInputs();
+    }
+
     @Override
     public NestedSet<Artifact> getSchedulingDependencies() {
       return NestedSetBuilder.emptySet(Order.STABLE_ORDER);
diff --git a/src/test/java/com/google/devtools/build/lib/testutil/FakeResourceOwner.java b/src/test/java/com/google/devtools/build/lib/testutil/FakeResourceOwner.java
index 1a19428793..0aef5076f6 100644
--- a/src/test/java/com/google/devtools/build/lib/testutil/FakeResourceOwner.java
+++ b/src/test/java/com/google/devtools/build/lib/testutil/FakeResourceOwner.java
@@ -117,6 +117,11 @@ public class FakeResourceOwner implements ActionExecutionMetadata {
     return NestedSetBuilder.emptySet(Order.STABLE_ORDER);
   }
 
+  @Override
+  public NestedSet<Artifact> getOriginalInputs() {
+    return NestedSetBuilder.emptySet(Order.STABLE_ORDER);
+  }
+
   @Override
   public NestedSet<Artifact> getSchedulingDependencies() {
     return NestedSetBuilder.emptySet(Order.STABLE_ORDER);
diff --git a/src/test/shell/integration/aquery_test.sh b/src/test/shell/integration/aquery_test.sh
index 5a0d790146..38a31f51a6 100755
--- a/src/test/shell/integration/aquery_test.sh
+++ b/src/test/shell/integration/aquery_test.sh
@@ -243,33 +243,261 @@ EOF
   assert_not_contains "Outputs: \[" output
 }
 
-function test_aquery_include_scheduling_dependencies() {
+function test_prunable_headers() {
   local pkg="${FUNCNAME[0]}"
   mkdir -p "$pkg" || fail "mkdir -p $pkg"
   cat > "$pkg/BUILD" <<'EOF'
-cc_binary(name="b", srcs=["b.cc"], deps=[":l"])
-cc_library(name="l", hdrs=["library_header.h"])
+cc_binary(
+  name = "foo",
+  srcs = ["foo.cc"],
+  deps = [":bar"],
+)
+cc_library(
+  name = "bar",
+  hdrs = ["used.h", "useless.h"],
+)
+EOF
+  cat > "$pkg/foo.cc" <<'EOF'
+#include "used.h"
+int main() { used(); return 0; }
+EOF
+  cat > "$pkg/used.h" <<'EOF'
+inline void used() {}
+EOF
+  cat > "$pkg/useless.h" <<'EOF'
+inline void useless() {}
 EOF
 
-  bazel aquery \
-    --include_artifacts \
-    --include_scheduling_dependencies \
-    "mnemonic(CppCompile,//$pkg:b)" > output 2> "$TEST_log" \
+  # Test --include_pruned_inputs before build.
+  # Expect used.h and useless.h to be considered inputs.
+
+  bazel aquery "mnemonic(CppCompile,//$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_contains "Inputs:.*used.h" output
+  assert_contains "Inputs:.*useless.h" output
+
+  bazel aquery "inputs(.*used.h, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_nonempty_file output
+
+  bazel aquery "inputs(.*useless.h, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_nonempty_file output
+
+  # Test --include_pruned_inputs after build.
+  # Expect used.h and useless.h to be considered inputs.
+
+  bazel build "//$pkg:foo" || fail "Expected success"
+
+  bazel aquery "mnemonic(CppCompile,//$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_contains "Inputs:.*used.h" output
+  assert_contains "Inputs:.*useless.h" output
+
+  bazel aquery "inputs(.*used.h, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_nonempty_file output
+
+  bazel aquery "inputs(.*useless.h, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_nonempty_file output
+
+  if [[ "${PRODUCT_NAME}" == "bazel" ]]; then
+    # Include scanning not supported.
+    return 0
+  fi
+
+  bazel clean
+
+  # Test --noinclude_pruned_inputs before build.
+  # Expect used.h and useless.h to be considered inputs.
+
+  bazel aquery --noinclude_pruned_inputs \
+    "mnemonic(CppCompile,//$pkg:foo)" > output 2> "$TEST_log" \
     || fail "Expected success"
   cat output >> "$TEST_log"
 
-  assert_contains "SchedulingDependencies:.*library_header.h" output
+  assert_contains "Inputs:.*used.h" output
+  assert_contains "Inputs:.*useless.h" output
 
-  bazel aquery \
-    --include_artifacts \
-    --include_scheduling_dependencies \
-    --output=jsonproto \
-    "mnemonic(CppCompile,//$pkg:b)" > output 2> "$TEST_log" \
+  bazel aquery --noinclude_pruned_inputs \
+    "inputs(.*used.h, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_nonempty_file output
+
+  bazel aquery --noinclude_pruned_inputs \
+    "inputs(.*useless.h, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_nonempty_file output
+
+  # Test --noinclude_pruned_inputs after build.
+  # Expect used.h to be considered an input, but not useless.h.
+
+  bazel build "//$pkg:foo" || fail "Expected success"
+
+  bazel aquery --noinclude_pruned_inputs \
+    "mnemonic(CppCompile,//$pkg:foo)" > output 2> "$TEST_log" \
     || fail "Expected success"
   cat output >> "$TEST_log"
-  assert_contains "library_header.h" output
+
+  assert_contains "Inputs:.*used.h" output
+  assert_not_contains "Inputs:.*useless.h" output
+
+  bazel aquery --noinclude_pruned_inputs \
+    "inputs(.*used.h, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_nonempty_file output
+
+  bazel aquery --noinclude_pruned_inputs \
+    "inputs(.*useless.h, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_empty_file output
 }
 
+function test_unused_inputs() {
+  local pkg="${FUNCNAME[0]}"
+  mkdir -p "$pkg" || fail "mkdir -p $pkg"
+  cat > "$pkg/defs.bzl" <<EOF
+def _impl(ctx):
+  ctx.actions.run(
+    inputs = [ctx.file.used, ctx.file.unused],
+    outputs = [ctx.outputs.out],
+    unused_inputs_list = ctx.outputs.out,
+    executable = ctx.executable._tool,
+    arguments = [ctx.file.unused.path, ctx.outputs.out.path],
+  )
+  return DefaultInfo(files = depset([ctx.outputs.out]))
+
+foo = rule(
+  _impl,
+  attrs = {
+    "used": attr.label(allow_single_file = True),
+    "unused": attr.label(allow_single_file = True),
+    "out": attr.output(),
+    "_tool": attr.label(cfg = "exec", executable = True, default = "//$pkg:tool")
+  },
+)
+EOF
+  cat > "$pkg/BUILD" <<'EOF'
+load(":defs.bzl", "foo")
+sh_binary(
+    name = "tool",
+    srcs = ["tool.sh"],
+)
+foo(
+  name = "foo",
+  used = "used.txt",
+  unused = "useless.txt",
+  out = "out.txt",
+)
+EOF
+  cat > "$pkg/tool.sh" <<'EOF'
+#!/bin/bash
+echo "$1" > "$2"
+EOF
+  chmod +x "$pkg/tool.sh"
+  touch "$pkg/used.txt" "$pkg/useless.txt"
+
+  # Test --include_pruned_inputs before build.
+  # Expect used.txt and useless.txt to be considered inputs.
+
+  bazel aquery "mnemonic(Action,//$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_contains "Inputs:.*used.txt" output
+  assert_contains "Inputs:.*useless.txt" output
+
+  bazel aquery "inputs(.*used.txt, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_nonempty_file output
+
+  bazel aquery "inputs(.*useless.txt, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_nonempty_file output
+
+  # Test --include_pruned_inputs after build.
+  # Expect used.txt and useless.txt to be considered inputs.
+
+  bazel build "//$pkg:foo" || fail "Expected success"
+
+  bazel aquery "mnemonic(Action,//$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_contains "Inputs:.*used.txt" output
+  assert_contains "Inputs:.*useless.txt" output
+
+  bazel aquery "inputs(.*used.txt, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_nonempty_file output
+
+  bazel aquery "inputs(.*useless.txt, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_nonempty_file output
+
+  bazel clean
+
+  # Test --noinclude_pruned_inputs before build.
+  # Expect used.txt and useless.txt to be considered inputs.
+
+  bazel aquery --noinclude_pruned_inputs \
+    "mnemonic(Action,//$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+  cat output >> "$TEST_log"
+
+  assert_contains "Inputs:.*used.txt" output
+  assert_contains "Inputs:.*useless.txt" output
+
+  bazel aquery --noinclude_pruned_inputs \
+    "inputs(.*used.txt, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_nonempty_file output
+
+  bazel aquery --noinclude_pruned_inputs \
+    "inputs(.*useless.txt, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_nonempty_file output
+
+  # Test --noinclude_pruned_inputs after build.
+  # Expect used.h to be considered an input, but not useless.h.
+
+  bazel build "//$pkg:foo" || fail "Expected success"
+
+  bazel aquery --noinclude_pruned_inputs \
+    "mnemonic(Action,//$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+  cat output >> "$TEST_log"
+
+  assert_contains "Inputs:.*used.txt" output
+  assert_not_contains "Inputs:.*useless.txt" output
+
+  bazel aquery --noinclude_pruned_inputs \
+    "inputs(.*used.txt, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_nonempty_file output
+
+  bazel aquery --noinclude_pruned_inputs \
+    "inputs(.*useless.txt, //$pkg:foo)" > output 2> "$TEST_log" \
+    || fail "Expected success"
+
+  assert_empty_file output
+}
 
 function test_aquery_starlark_env() {
   local pkg="${FUNCNAME[0]}"
diff --git a/src/test/shell/unittest.bash b/src/test/shell/unittest.bash
index 9cdc011a4b..2b92e634e4 100644
--- a/src/test/shell/unittest.bash
+++ b/src/test/shell/unittest.bash
@@ -514,6 +514,36 @@ function assert_contains_n() {
     return 1
 }
 
+# Usage: assert_empty_file <file> [error-message]
+# Asserts that the file exists and is empty. On failure copies the file to
+# undeclared outputs, prints the specified (optional) error message, and returns
+# non-zero.
+function assert_empty_file() {
+    local file=$1
+    local message=${2:-"Expected '$file' to exist and be empty"}
+    if [[ -f "$file" && ! -s "$file" ]]; then
+        return 0
+    fi
+
+    fail "$message" $(__copy_to_undeclared_outputs "$1")
+    return 1
+}
+
+# Usage: assert_nonempty_file <file> [error-message]
+# Asserts that the file exists and is nonempty. On failure copies the file to
+# undeclared outputs, prints the specified (optional) error message, and returns
+# non-zero.
+function assert_nonempty_file() {
+    local file=$1
+    local message=${2:-"Expected '$file' to exist and be nonempty"}
+    if [[ -f "$file" && -s "$file" ]]; then
+        return 0
+    fi
+
+    fail "$message" $(__copy_to_undeclared_outputs "$1")
+    return 1
+}
+
 # Copies $1 to undeclared outputs with a unique path and logs the mapping
 # between the original file and the new file.
 function __copy_to_undeclared_outputs() {
