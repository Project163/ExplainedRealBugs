diff --git a/src/main/java/com/google/devtools/build/lib/skyframe/BzlmodRepoRuleFunction.java b/src/main/java/com/google/devtools/build/lib/skyframe/BzlmodRepoRuleFunction.java
index fb91b59c6e..4b2d97b130 100644
--- a/src/main/java/com/google/devtools/build/lib/skyframe/BzlmodRepoRuleFunction.java
+++ b/src/main/java/com/google/devtools/build/lib/skyframe/BzlmodRepoRuleFunction.java
@@ -158,7 +158,7 @@ public final class BzlmodRepoRuleFunction implements SkyFunction {
     if (moduleKey == null) {
       return Optional.empty();
     }
-    return Optional.of(bazelDepGraphValue.getDepGraph().get(moduleKey).getRepoSpec());
+    return Optional.ofNullable(bazelDepGraphValue.getDepGraph().get(moduleKey).getRepoSpec());
   }
 
   @Nullable
diff --git a/src/test/py/bazel/bzlmod/mod_command_test.py b/src/test/py/bazel/bzlmod/mod_command_test.py
index 699c42da46..f76464d4fa 100644
--- a/src/test/py/bazel/bzlmod/mod_command_test.py
+++ b/src/test/py/bazel/bzlmod/mod_command_test.py
@@ -507,14 +507,15 @@ class ModCommandTest(test_base.TestBase):
         stderr,
     )
 
+  # fix for https://github.com/bazelbuild/bazel/issues/22587
   def testShowRepoThrowsNonexistentRepo(self):
     _, _, stderr = self.RunBazel(
-        ['mod', 'show_repo', '@@lol'],
+        ['mod', 'show_repo', '<root>'],
         allow_failure=True,
         rstrip=True,
     )
     self.assertIn(
-        "ERROR: In repo argument @@lol: no such repo. Type 'bazel help mod' "
+        "ERROR: In repo argument <root>: no such repo. Type 'bazel help mod' "
         'for syntax and help.',
         stderr,
     )
