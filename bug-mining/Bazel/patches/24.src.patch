diff --git a/src/main/java/com/google/devtools/build/lib/bazel/BUILD b/src/main/java/com/google/devtools/build/lib/bazel/BUILD
index e3b6f6342b..6c86c6d6df 100644
--- a/src/main/java/com/google/devtools/build/lib/bazel/BUILD
+++ b/src/main/java/com/google/devtools/build/lib/bazel/BUILD
@@ -63,6 +63,18 @@ java_library(
     ],
 )
 
+java_library(
+    name = "bazel_configuration",
+    srcs = ["BazelConfiguration.java"],
+    deps = [
+        "//src/main/java/com/google/devtools/build/lib/analysis:config/build_options",
+        "//src/main/java/com/google/devtools/build/lib/analysis:config/fragment",
+        "//src/main/java/com/google/devtools/build/lib/analysis:config/fragment_options",
+        "//src/main/java/com/google/devtools/build/lib/concurrent:thread_safety",
+        "//src/main/java/com/google/devtools/common/options",
+    ],
+)
+
 java_library(
     name = "builtin_command_module",
     srcs = ["BazelBuiltinCommandModule.java"],
diff --git a/src/main/java/com/google/devtools/build/lib/bazel/BazelConfiguration.java b/src/main/java/com/google/devtools/build/lib/bazel/BazelConfiguration.java
new file mode 100644
index 0000000000..bb04d74826
--- /dev/null
+++ b/src/main/java/com/google/devtools/build/lib/bazel/BazelConfiguration.java
@@ -0,0 +1,61 @@
+// Copyright 2023 The Bazel Authors. All rights reserved.
+//
+// Licensed under the Apache License, Version 2.0 (the "License");
+// you may not use this file except in compliance with the License.
+// You may obtain a copy of the License at
+//
+//    http://www.apache.org/licenses/LICENSE-2.0
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+package com.google.devtools.build.lib.bazel;
+
+import com.google.devtools.build.lib.analysis.config.BuildOptions;
+import com.google.devtools.build.lib.analysis.config.Fragment;
+import com.google.devtools.build.lib.analysis.config.FragmentOptions;
+import com.google.devtools.build.lib.analysis.config.RequiresOptions;
+import com.google.devtools.build.lib.concurrent.ThreadSafety.Immutable;
+import com.google.devtools.common.options.Option;
+import com.google.devtools.common.options.OptionDocumentationCategory;
+import com.google.devtools.common.options.OptionEffectTag;
+import com.google.devtools.common.options.OptionMetadataTag;
+
+/** Bazel-specific settings. */
+@Immutable
+@RequiresOptions(options = {BazelConfiguration.Options.class})
+public class BazelConfiguration extends Fragment {
+
+  /** Command-line options. */
+  public static class Options extends FragmentOptions {
+
+    @Option(
+        name = "incompatible_check_visibility_for_toolchains",
+        defaultValue = "false",
+        documentationCategory = OptionDocumentationCategory.INPUT_STRICTNESS,
+        effectTags = {OptionEffectTag.BUILD_FILE_SEMANTICS},
+        metadataTags = {OptionMetadataTag.INCOMPATIBLE_CHANGE},
+        help = "If enabled, visibility checking also applies to toolchain implementations.")
+    public boolean checkVisibilityForToolchains;
+
+    @Override
+    public FragmentOptions getExec() {
+      Options exec = (Options) getDefault();
+      exec.checkVisibilityForToolchains = checkVisibilityForToolchains;
+
+      return exec;
+    }
+  }
+
+  private final Options options;
+
+  public BazelConfiguration(BuildOptions buildOptions) {
+    this.options = buildOptions.get(Options.class);
+  }
+
+  public boolean checkVisibilityForToolchains() {
+    return options.checkVisibilityForToolchains;
+  }
+}
diff --git a/src/main/java/com/google/devtools/build/lib/bazel/rules/BUILD b/src/main/java/com/google/devtools/build/lib/bazel/rules/BUILD
index bdebed708f..f095dcfc4d 100644
--- a/src/main/java/com/google/devtools/build/lib/bazel/rules/BUILD
+++ b/src/main/java/com/google/devtools/build/lib/bazel/rules/BUILD
@@ -47,6 +47,7 @@ java_library(
         "//src/main/java/com/google/devtools/build/lib/analysis:constraints/environment_rule",
         "//src/main/java/com/google/devtools/build/lib/analysis:platform_configuration",
         "//src/main/java/com/google/devtools/build/lib/analysis:statically_linked_marker_provider",
+        "//src/main/java/com/google/devtools/build/lib/bazel:bazel_configuration",
         "//src/main/java/com/google/devtools/build/lib/bazel/repository",
         "//src/main/java/com/google/devtools/build/lib/bazel/rules/android",
         "//src/main/java/com/google/devtools/build/lib/bazel/rules/common",
diff --git a/src/main/java/com/google/devtools/build/lib/bazel/rules/BazelPrerequisiteValidator.java b/src/main/java/com/google/devtools/build/lib/bazel/rules/BazelPrerequisiteValidator.java
index 1fe8b09665..5d5f8accf9 100644
--- a/src/main/java/com/google/devtools/build/lib/bazel/rules/BazelPrerequisiteValidator.java
+++ b/src/main/java/com/google/devtools/build/lib/bazel/rules/BazelPrerequisiteValidator.java
@@ -16,6 +16,7 @@ package com.google.devtools.build.lib.bazel.rules;
 
 import com.google.devtools.build.lib.analysis.CommonPrerequisiteValidator;
 import com.google.devtools.build.lib.analysis.RuleContext;
+import com.google.devtools.build.lib.bazel.BazelConfiguration;
 import com.google.devtools.build.lib.cmdline.PackageIdentifier;
 
 /** Ensures that a target's prerequisites are visible to it and match its testonly status. */
@@ -40,7 +41,10 @@ public class BazelPrerequisiteValidator extends CommonPrerequisiteValidator {
 
   @Override
   protected boolean checkVisibilityForToolchains(RuleContext.Builder context) {
-    return false;
+    return context
+        .getConfiguration()
+        .getFragment(BazelConfiguration.class)
+        .checkVisibilityForToolchains();
   }
 
   @Override
diff --git a/src/main/java/com/google/devtools/build/lib/bazel/rules/BazelRuleClassProvider.java b/src/main/java/com/google/devtools/build/lib/bazel/rules/BazelRuleClassProvider.java
index 6150bbe11f..44daf05444 100644
--- a/src/main/java/com/google/devtools/build/lib/bazel/rules/BazelRuleClassProvider.java
+++ b/src/main/java/com/google/devtools/build/lib/bazel/rules/BazelRuleClassProvider.java
@@ -32,6 +32,7 @@ import com.google.devtools.build.lib.analysis.config.CoreOptions;
 import com.google.devtools.build.lib.analysis.config.Fragment;
 import com.google.devtools.build.lib.analysis.config.FragmentOptions;
 import com.google.devtools.build.lib.analysis.config.RequiresOptions;
+import com.google.devtools.build.lib.bazel.BazelConfiguration;
 import com.google.devtools.build.lib.bazel.repository.LocalConfigPlatformRule;
 import com.google.devtools.build.lib.bazel.rules.android.AndroidNdkRepositoryRule;
 import com.google.devtools.build.lib.bazel.rules.android.AndroidSdkRepositoryRule;
@@ -300,6 +301,7 @@ public class BazelRuleClassProvider {
               .setActionEnvironmentProvider(SHELL_ACTION_ENV)
               .addUniversalConfigurationFragment(ShellConfiguration.class)
               .addUniversalConfigurationFragment(PlatformConfiguration.class)
+              .addUniversalConfigurationFragment(BazelConfiguration.class)
               .addUniversalConfigurationFragment(StrictActionEnvConfiguration.class)
               .addConfigurationOptions(CoreOptions.class);
 
