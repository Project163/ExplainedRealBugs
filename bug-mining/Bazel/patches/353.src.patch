diff --git a/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/BUILD b/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/BUILD
index 767764ca8e..17e4fd4e29 100644
--- a/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/BUILD
+++ b/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/BUILD
@@ -13,14 +13,12 @@ filegroup(
 
 java_library(
     name = "credential_module",
-    srcs = [
-        "CredentialModule.java",
-        "SystemMillisTicker.java",
-    ],
+    srcs = ["CredentialModule.java"],
     deps = [
         ":credentialhelper",
         "//src/main/java/com/google/devtools/build/lib:runtime",
         "//src/main/java/com/google/devtools/build/lib/authandtls",
+        "//src/main/java/com/google/devtools/build/lib/clock",
         "//src/main/java/com/google/devtools/common/options",
         "//third_party:caffeine",
         "//third_party:guava",
@@ -31,12 +29,10 @@ java_library(
     name = "credentialhelper",
     srcs = glob(
         ["*.java"],
-        exclude = [
-            "CredentialModule.java",
-            "SystemMillisTicker.java",
-        ],
+        exclude = ["CredentialModule.java"],
     ),
     deps = [
+        "//src/main/java/com/google/devtools/build/lib/clock",
         "//src/main/java/com/google/devtools/build/lib/events",
         "//src/main/java/com/google/devtools/build/lib/profiler",
         "//src/main/java/com/google/devtools/build/lib/shell",
diff --git a/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialCacheExpiry.java b/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialCacheExpiry.java
index 225dea0395..f632ec97fc 100644
--- a/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialCacheExpiry.java
+++ b/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialCacheExpiry.java
@@ -14,6 +14,8 @@
 
 package com.google.devtools.build.lib.authandtls.credentialhelper;
 
+import static com.google.common.base.Preconditions.checkNotNull;
+
 import com.github.benmanes.caffeine.cache.Expiry;
 import com.google.common.base.Preconditions;
 import com.google.errorprone.annotations.CanIgnoreReturnValue;
@@ -32,46 +34,48 @@ final class CredentialCacheExpiry implements Expiry<URI, GetCredentialsResponse>
     this.defaultCacheDuration = Preconditions.checkNotNull(duration);
   }
 
-  private Duration getExpirationTime(GetCredentialsResponse response, Instant currentTime) {
-    Preconditions.checkNotNull(response);
+  private Duration getCacheDuration(GetCredentialsResponse response, Instant now) {
+    checkNotNull(response);
 
     var expires = response.expires();
     if (expires.isEmpty()) {
       return defaultCacheDuration;
     }
 
-    return Duration.between(currentTime, expires.get());
+    return Duration.between(now, expires.get());
   }
 
   @Override
   public long expireAfterCreate(URI uri, GetCredentialsResponse response, long currentTime) {
-    Preconditions.checkNotNull(uri);
-    Preconditions.checkNotNull(response);
+    checkNotNull(uri);
+    checkNotNull(response);
+
+    // currentTime is in nanos since epoch (see WallTicker).
+    Instant now = Instant.ofEpochSecond(0, currentTime);
 
-    return getExpirationTime(response, Instant.ofEpochMilli(nanoToMilli(currentTime))).toNanos();
+    return getCacheDuration(response, now).toNanos();
   }
 
   @Override
   public long expireAfterUpdate(
       URI uri, GetCredentialsResponse response, long currentTime, long currentDuration) {
-    Preconditions.checkNotNull(uri);
-    Preconditions.checkNotNull(response);
+    checkNotNull(uri);
+    checkNotNull(response);
+
+    // currentTime is in nanos since epoch (see WallTicker).
+    Instant now = Instant.ofEpochSecond(0, currentTime);
 
-    return getExpirationTime(response, Instant.ofEpochMilli(nanoToMilli(currentTime))).toNanos();
+    return getCacheDuration(response, now).toNanos();
   }
 
   @CanIgnoreReturnValue
   @Override
   public long expireAfterRead(
       URI uri, GetCredentialsResponse response, long currentTime, long currentDuration) {
-    Preconditions.checkNotNull(uri);
-    Preconditions.checkNotNull(response);
+    checkNotNull(uri);
+    checkNotNull(response);
 
-    // We don't extend the duration on access.
+    // Don't extend the duration on read access.
     return currentDuration;
   }
-
-  private static final long nanoToMilli(long nano) {
-    return Duration.ofNanos(nano).toMillis();
-  }
 }
diff --git a/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModule.java b/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModule.java
index 2729ce3724..d3afe333d0 100644
--- a/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModule.java
+++ b/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModule.java
@@ -16,10 +16,11 @@ package com.google.devtools.build.lib.authandtls.credentialhelper;
 
 import com.github.benmanes.caffeine.cache.Cache;
 import com.github.benmanes.caffeine.cache.Caffeine;
-import com.github.benmanes.caffeine.cache.Ticker;
 import com.google.common.annotations.VisibleForTesting;
 import com.google.common.collect.ImmutableList;
 import com.google.devtools.build.lib.authandtls.AuthAndTLSOptions;
+import com.google.devtools.build.lib.clock.Clock;
+import com.google.devtools.build.lib.clock.JavaClock;
 import com.google.devtools.build.lib.runtime.BlazeModule;
 import com.google.devtools.build.lib.runtime.CommandEnvironment;
 import com.google.devtools.common.options.OptionsBase;
@@ -28,17 +29,22 @@ import java.time.Duration;
 
 /** A module whose sole purpose is to hold the credential cache which is shared by other modules. */
 public class CredentialModule extends BlazeModule {
-  private final CredentialCacheExpiry cacheExpiry = new CredentialCacheExpiry();
+  private final CredentialCacheExpiry credentialCacheExpiry;
   private final Cache<URI, GetCredentialsResponse> credentialCache;
   private Duration lastDefaultCacheDuration = Duration.ZERO;
 
   public CredentialModule() {
-    this(Ticker.systemTicker());
+    this(new JavaClock());
   }
 
   @VisibleForTesting
-  CredentialModule(Ticker ticker) {
-    this.credentialCache = Caffeine.newBuilder().ticker(ticker).expireAfter(cacheExpiry).build();
+  CredentialModule(Clock clock) {
+    this.credentialCacheExpiry = new CredentialCacheExpiry();
+    this.credentialCache =
+        Caffeine.newBuilder()
+            .ticker(new WallTicker(clock))
+            .expireAfter(credentialCacheExpiry)
+            .build();
   }
 
   /** Returns the credential cache. */
@@ -66,6 +72,6 @@ public class CredentialModule extends BlazeModule {
     }
 
     // Update the expiration policy for future entries.
-    cacheExpiry.setDefaultCacheDuration(defaultCacheDuration);
+    credentialCacheExpiry.setDefaultCacheDuration(defaultCacheDuration);
   }
 }
diff --git a/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/SystemMillisTicker.java b/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/WallTicker.java
similarity index 50%
rename from src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/SystemMillisTicker.java
rename to src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/WallTicker.java
index 31328cc653..5a9732ccea 100644
--- a/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/SystemMillisTicker.java
+++ b/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/WallTicker.java
@@ -15,21 +15,27 @@
 package com.google.devtools.build.lib.authandtls.credentialhelper;
 
 import com.github.benmanes.caffeine.cache.Ticker;
+import com.google.devtools.build.lib.clock.Clock;
+import java.time.Duration;
 
 /**
- * SystemMillisTicker is a Ticker which uses the unix epoch as its fixed reference point.
+ * WallTicker is a Ticker which reports wall time since the unix epoch.
  *
- * <p>It is preferable to com.github.benmanes.caffeine.cache.Ticker.SystemTicker because that class
- * doesn't increment its time-source while the system is asleep, which isn't appropriate when
- * expiring tokens which have wall-time-based expiry policies.
+ * <p>We use this instead of com.github.benmanes.caffeine.cache.Ticker.SystemTicker because the
+ * latter uses monotonic time (which doesn't increment the time source while the system is asleep)
+ * with an unspecified reference point (which is unhelpful when computing the cache duration for
+ * credentials whose expiry is a fixed point in time, not a fixed duration).
  */
-public class SystemMillisTicker implements Ticker {
-  public static final SystemMillisTicker INSTANCE = new SystemMillisTicker();
+final class WallTicker implements Ticker {
+  private final Clock clock;
 
-  private SystemMillisTicker() {}
+  WallTicker(Clock clock) {
+    this.clock = clock;
+  }
 
   @Override
   public long read() {
-    return System.currentTimeMillis() * 1_000_000;
+    // Documented to return a value in nanoseconds.
+    return Duration.ofMillis(clock.currentTimeMillis()).toNanos();
   }
 }
diff --git a/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/BUILD b/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/BUILD
index eec2bb1345..4b806ed471 100644
--- a/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/BUILD
+++ b/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/BUILD
@@ -35,6 +35,7 @@ java_test(
         "//src/main/java/com/google/devtools/build/lib/vfs:pathfragment",
         "//src/main/java/com/google/devtools/build/lib/vfs/inmemoryfs",
         "//src/main/java/com/google/devtools/common/options:options_internal",
+        "//src/test/java/com/google/devtools/build/lib/testutil",
         "//src/test/java/com/google/devtools/build/lib/vfs/util",
         "//third_party:caffeine",
         "//third_party:gson",
diff --git a/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModuleTest.java b/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModuleTest.java
index f13f489ccd..c43fb50d4d 100644
--- a/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModuleTest.java
+++ b/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModuleTest.java
@@ -19,9 +19,9 @@ import static org.mockito.Mockito.when;
 
 import com.github.benmanes.caffeine.cache.Cache;
 import com.github.benmanes.caffeine.cache.Policy.CacheEntry;
-import com.github.benmanes.caffeine.cache.Ticker;
 import com.google.devtools.build.lib.authandtls.AuthAndTLSOptions;
 import com.google.devtools.build.lib.runtime.CommandEnvironment;
+import com.google.devtools.build.lib.testutil.ManualClock;
 import com.google.devtools.common.options.OptionsParsingResult;
 import java.net.URI;
 import java.time.Duration;
@@ -38,25 +38,23 @@ public final class CredentialModuleTest {
   private static final GetCredentialsResponse DEFAULT_RESPONSE =
       GetCredentialsResponse.newBuilder().build();
 
-  private Instant currentTime = Instant.parse("2001-01-01T00:00:00Z");
-
-  private final Ticker ticker = () -> toEpochNano(currentTime);
-  private final CredentialModule module = new CredentialModule(ticker);
+  private final ManualClock clock = new ManualClock();
+  private final CredentialModule module = new CredentialModule(clock);
   private final Cache<URI, GetCredentialsResponse> cache = module.getCredentialCache();
 
   @Test
   public void putWithExplicitExpiration() {
     initModule("build", Duration.ofMinutes(60));
 
-    var expiry = currentTime.plus(Duration.ofMinutes(123));
+    var expiry = clock.now().plus(Duration.ofMinutes(123));
 
     cache.put(TEST_URI, GetCredentialsResponse.newBuilder().setExpires(expiry).build());
     assertInCache(TEST_URI, expiry);
 
-    currentTime = expiry.minusSeconds(1);
+    clock.advance(Duration.ofMinutes(122));
     assertInCache(TEST_URI, expiry);
 
-    currentTime = expiry.plusSeconds(1);
+    clock.advance(Duration.ofMinutes(2));
     assertNotInCache(TEST_URI);
   }
 
@@ -64,15 +62,15 @@ public final class CredentialModuleTest {
   public void putWithNonzeroDefaultExpiration() {
     initModule("build", Duration.ofMinutes(60));
 
-    var expiry = currentTime.plus(Duration.ofMinutes(60));
+    var expiry = clock.now().plus(Duration.ofMinutes(60));
 
     cache.put(TEST_URI, DEFAULT_RESPONSE);
     assertInCache(TEST_URI, expiry);
 
-    currentTime = expiry.minusSeconds(1);
+    clock.advance(Duration.ofMinutes(59));
     assertInCache(TEST_URI, expiry);
 
-    currentTime = expiry.plusSeconds(1);
+    clock.advance(Duration.ofMinutes(2));
     assertNotInCache(TEST_URI);
   }
 
@@ -90,11 +88,11 @@ public final class CredentialModuleTest {
     initModule("build", Duration.ofMinutes(60));
 
     cache.put(TEST_URI, DEFAULT_RESPONSE);
-    assertInCache(TEST_URI, currentTime.plus(Duration.ofMinutes(60)));
+    assertInCache(TEST_URI, clock.now().plus(Duration.ofMinutes(60)));
 
     initModule("build", Duration.ofMinutes(60));
 
-    assertInCache(TEST_URI, currentTime.plus(Duration.ofMinutes(60)));
+    assertInCache(TEST_URI, clock.now().plus(Duration.ofMinutes(60)));
   }
 
   @Test
@@ -102,7 +100,7 @@ public final class CredentialModuleTest {
     initModule("build", Duration.ofMinutes(60));
 
     cache.put(TEST_URI, DEFAULT_RESPONSE);
-    assertInCache(TEST_URI, currentTime.plus(Duration.ofMinutes(60)));
+    assertInCache(TEST_URI, clock.now().plus(Duration.ofMinutes(60)));
 
     initModule("build", Duration.ofMinutes(30));
 
@@ -114,7 +112,7 @@ public final class CredentialModuleTest {
     initModule("build", Duration.ofMinutes(30));
 
     cache.put(TEST_URI, DEFAULT_RESPONSE);
-    assertInCache(TEST_URI, currentTime.plus(Duration.ofMinutes(30)));
+    assertInCache(TEST_URI, clock.now().plus(Duration.ofMinutes(30)));
 
     initModule("build", Duration.ofMinutes(60));
 
@@ -126,7 +124,7 @@ public final class CredentialModuleTest {
     initModule("build", Duration.ofMinutes(60));
 
     cache.put(TEST_URI, DEFAULT_RESPONSE);
-    assertInCache(TEST_URI, currentTime.plus(Duration.ofMinutes(60)));
+    assertInCache(TEST_URI, clock.now().plus(Duration.ofMinutes(60)));
 
     initModule("clean", Duration.ofMinutes(60));
 
@@ -163,11 +161,6 @@ public final class CredentialModuleTest {
   }
 
   private static Instant fromEpochNano(long nano) {
-    return Instant.ofEpochSecond(
-        nano / Duration.ofSeconds(1).toNanos(), nano % Duration.ofSeconds(1).toNanos());
-  }
-
-  private static long toEpochNano(Instant instant) {
-    return Duration.ofSeconds(1).toNanos() * instant.getEpochSecond() + instant.getNano();
+    return Instant.ofEpochSecond(0, nano);
   }
 }
diff --git a/src/test/shell/bazel/remote/remote_execution_test.sh b/src/test/shell/bazel/remote/remote_execution_test.sh
index b3facc9159..c6096b966c 100755
--- a/src/test/shell/bazel/remote/remote_execution_test.sh
+++ b/src/test/shell/bazel/remote/remote_execution_test.sh
@@ -76,7 +76,7 @@ function has_utf8_locale() {
 }
 
 function setup_credential_helper_test() {
-  setup_credential_helper
+  setup_credential_helper 3600
 
   mkdir -p a
 
@@ -111,6 +111,9 @@ function test_credential_helper_remote_cache() {
   # First build should have called helper for 4 distinct URIs.
   expect_credential_helper_calls 4
 
+  # Don't clean to avoid clearing credential cache; delete manually instead.
+  rm -rf "$(bazel info output_base)/execroot"
+
   bazel build \
       --remote_cache=grpc://localhost:${worker_port} \
       --credential_helper="${TEST_TMPDIR}/credhelper" \
@@ -141,6 +144,9 @@ function test_credential_helper_remote_execution() {
   # First build should have called helper for 5 distinct URIs.
   expect_credential_helper_calls 5
 
+  # Don't clean to avoid clearing credential cache; delete manually instead.
+  rm -rf "$(bazel info output_base)/execroot"
+
   bazel build \
       --spawn_strategy=remote \
       --remote_executor=grpc://localhost:${worker_port} \
diff --git a/src/test/shell/bazel/remote_helpers.sh b/src/test/shell/bazel/remote_helpers.sh
index 9cc550460d..1d9b23cb15 100755
--- a/src/test/shell/bazel/remote_helpers.sh
+++ b/src/test/shell/bazel/remote_helpers.sh
@@ -288,14 +288,17 @@ function kill_nc() {
 }
 
 # Sets up a credential helper binary at ${TEST_TMPDIR}/credhelper and resets
-# the call counter.
+# the call counter. The argument gives the credential expiry in seconds.
 function setup_credential_helper() {
+  local -r expiry=$1
+
   # Each call atomically writes one byte to this file.
   # The file can be read later determine how many calls were made.
-  cat > "${TEST_TMPDIR}/credhelper.callcount_${TEST_SHARD_INDEX}"
+  cat > "${TEST_TMPDIR}/credhelper.callcount_${TEST_SHARD_INDEX:-0}"
 
   cat > "${TEST_TMPDIR}/credhelper" <<'EOF'
 #!/usr/bin/env python3
+import datetime
 import json
 import os
 import sys
@@ -306,21 +309,35 @@ if uri.startswith("https://bcr.bazel.build/"):
   print("{}")
   sys.exit(0)
 
-path = os.path.join(os.environ["TEST_TMPDIR"], "credhelper.callcount_" + os.environ["TEST_SHARD_INDEX"])
+shard = os.environ.get("TEST_SHARD_INDEX", "0")
+path = os.path.join(os.environ["TEST_TMPDIR"], "credhelper.callcount_" + shard)
 fd = os.open(path, os.O_WRONLY|os.O_CREAT|os.O_APPEND)
 os.write(fd, b"1")
 os.close(fd)
 
+expires = datetime.datetime.now(datetime.timezone.utc) + datetime.timedelta(seconds=__EXPIRY__)
+
 # Must match //src/test/shell/bazel/testing_server.py.
-print("""{"headers":{"Authorization":["Bearer TOKEN"]}}""")
+res = {
+  "headers": {
+    "Authorization": ["Bearer TOKEN"],
+  },
+  "expires": expires.isoformat(timespec="seconds")
+}
+
+print(json.dumps(res))
 EOF
+
+  # Replace the expiry placeholder.
+  inplace-sed "s/__EXPIRY__/$expiry/" "${TEST_TMPDIR}/credhelper"
+
   chmod +x "${TEST_TMPDIR}/credhelper"
 }
 
 # Asserts how many times the credential helper was called.
 function expect_credential_helper_calls() {
   local -r expected=$1
-  local -r actual=$(wc -c "${TEST_TMPDIR}/credhelper.callcount_${TEST_SHARD_INDEX}" | awk '{print $1}')
+  local -r actual=$(wc -c "${TEST_TMPDIR}/credhelper.callcount_${TEST_SHARD_INDEX:-0}" | awk '{print $1}')
   if [[ "$expected" != "$actual" ]]; then
     fail "expected $expected instead of $actual credential helper calls"
   fi
diff --git a/src/test/shell/bazel/starlark_repository_test.sh b/src/test/shell/bazel/starlark_repository_test.sh
index 9f6aba67ee..c6fc82001d 100755
--- a/src/test/shell/bazel/starlark_repository_test.sh
+++ b/src/test/shell/bazel/starlark_repository_test.sh
@@ -1352,21 +1352,14 @@ maybe_with_auth(
 )
 EOF
 
-  cat > BUILD <<'EOF'
-genrule(
-  name = "it",
-  srcs = ["@ext//x:file.txt"],
-  outs = ["it.txt"],
-  cmd = "cp $< $@",
-)
-EOF
+  touch BUILD
 }
 
 function test_auth_from_starlark() {
   setup_auth foo bar
 
-  bazel build //:it \
-      || fail "Expected success when downloading repo with basic auth"
+  bazel fetch --force @ext//... \
+      || fail "Expected success when fetching repo with basic auth"
 }
 
 function test_auth_from_credential_helper() {
@@ -1375,36 +1368,62 @@ function test_auth_from_credential_helper() {
     return
   fi
 
-  setup_credential_helper
+  setup_credential_helper 3600
 
-  setup_auth # no auth
+  setup_auth # no auth headers in bzl
 
-  bazel build //:it \
-      && fail "Expected failure when downloading repo without credential helper"
+  bazel fetch --force @ext//... \
+      && fail "Expected failure when fetching repo without credential helper"
 
-  bazel build --credential_helper="${TEST_TMPDIR}/credhelper" //:it \
-      || fail "Expected success when downloading repo with credential helper"
+  bazel fetch --force \
+      --credential_helper=127.0.0.1="${TEST_TMPDIR}/credhelper" @ext//... \
+      || fail "Expected success when fetching repo with credential helper"
 
   expect_credential_helper_calls 1
 
-  bazel build --credential_helper="${TEST_TMPDIR}/credhelper" //:it \
-      || fail "Expected success when downloading repo with credential helper"
+  bazel fetch --force \
+      --credential_helper=127.0.0.1="${TEST_TMPDIR}/credhelper" @ext//... \
+      || fail "Expected success when fetching repo with credential helper"
 
   expect_credential_helper_calls 1 # expect credentials to have been cached
 }
 
+function test_auth_from_credential_helper_with_expiry() {
+  if "$is_windows"; then
+    # Skip on Windows: credential helper is a Python script.
+    return
+  fi
+
+  setup_credential_helper 0 # expire credentials immediately
+
+  setup_auth # no auth headers in bzl
+
+  bazel fetch --force \
+      --credential_helper=127.0.0.1="${TEST_TMPDIR}/credhelper" @ext//... \
+      || fail "Expected success when fetching repo with credential helper"
+
+  expect_credential_helper_calls 1
+
+  bazel fetch --force \
+      --credential_helper=127.0.0.1="${TEST_TMPDIR}/credhelper" @ext//... \
+      || fail "Expected success when fetching repo with credential helper"
+
+  expect_credential_helper_calls 2 # expect credentials to have been re-fetched
+}
+
 function test_auth_from_credential_helper_overrides_starlark() {
   if "$is_windows"; then
     # Skip on Windows: credential helper is a Python script.
     return
   fi
 
-  setup_credential_helper
+  setup_credential_helper 3600
 
   setup_auth baduser badpass
 
-  bazel build --credential_helper="${TEST_TMPDIR}/credhelper" //:it \
-      || fail "Expected success when downloading repo with credential helper overriding basic auth"
+  bazel fetch --force \
+      --credential_helper=127.0.0.1="${TEST_TMPDIR}/credhelper" @ext//... \
+      || fail "Expected success when fetching repo with credential helper overriding basic auth"
 }
 
 function test_netrc_reading() {
@@ -1796,7 +1815,7 @@ function test_http_archive_credential_helper() {
     return
   fi
 
-  setup_credential_helper
+  setup_credential_helper 3600
 
   mkdir x
   echo 'exports_files(["file.txt"])' > x/BUILD
@@ -1830,7 +1849,7 @@ function test_http_archive_credential_helper_overrides_netrc() {
     return
   fi
 
-  setup_credential_helper
+  setup_credential_helper 3600
 
   mkdir x
   echo 'exports_files(["file.txt"])' > x/BUILD
@@ -1952,7 +1971,7 @@ function test_cred_helper_overrides_starlark_headers() {
     return
   fi
 
-  setup_credential_helper
+  setup_credential_helper 3600
 
   filename="cred_helper_starlark.txt"
   echo $filename > $filename
