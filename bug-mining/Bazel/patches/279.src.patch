diff --git a/MODULE.bazel b/MODULE.bazel
index 51bf973691..9c07e2c1f4 100644
--- a/MODULE.bazel
+++ b/MODULE.bazel
@@ -94,7 +94,7 @@ maven.install(
     artifacts = [
         # keep sorted
         "com.beust:jcommander:1.82",
-        "com.github.ben-manes.caffeine:caffeine:3.0.5",
+        "com.github.ben-manes.caffeine:caffeine:3.1.8",
         "com.github.stephenc.jcip:jcip-annotations:1.0-1",
         "com.google.api-client:google-api-client:1.35.2",
         "com.google.api-client:google-api-client-gson:1.35.2",
diff --git a/maven_install.json b/maven_install.json
index f67cde46ea..3d67587dd1 100644
--- a/maven_install.json
+++ b/maven_install.json
@@ -1,7 +1,7 @@
 {
   "__AUTOGENERATED_FILE_DO_NOT_MODIFY_THIS_FILE_MANUALLY": "THERE_IS_NO_DATA_ONLY_ZUUL",
-  "__INPUT_ARTIFACTS_HASH": -312936207,
-  "__RESOLVED_ARTIFACTS_HASH": -2086665994,
+  "__INPUT_ARTIFACTS_HASH": 1401292213,
+  "__RESOLVED_ARTIFACTS_HASH": 1825399554,
   "conflict_resolution": {
     "com.google.api.grpc:proto-google-common-protos:2.29.0": "com.google.api.grpc:proto-google-common-protos:2.41.0",
     "com.google.auth:google-auth-library-credentials:1.6.0": "com.google.auth:google-auth-library-credentials:1.23.0",
@@ -52,9 +52,9 @@
     },
     "com.github.ben-manes.caffeine:caffeine": {
       "shasums": {
-        "jar": "8a9b54d3506a3b92ee46b217bcee79196b21ca6d52dc2967c686a205fb2f9c15"
+        "jar": "7dd15f9df1be238ffaa367ce6f556737a88031de4294dad18eef57c474ddf1d3"
       },
-      "version": "3.0.5"
+      "version": "3.1.8"
     },
     "com.github.kevinstern:software-and-algorithms": {
       "shasums": {
@@ -1068,9 +1068,7 @@
       "com.google.auto:auto-common",
       "com.google.guava:guava"
     ],
-    "com.google.auto:auto-common": [
-      "com.google.guava:guava"
-    ],
+    "com.google.auto:auto-common": ["com.google.guava:guava"],
     "com.google.caliper:caliper": [
       "com.google.caliper:caliper-core",
       "com.google.caliper:caliper-runner",
@@ -1138,18 +1136,14 @@
       "org.ow2.asm:asm-tree",
       "org.ow2.asm:asm-util"
     ],
-    "com.google.dagger:dagger": [
-      "javax.inject:javax.inject"
-    ],
+    "com.google.dagger:dagger": ["javax.inject:javax.inject"],
     "com.google.dagger:dagger-producers": [
       "com.google.dagger:dagger",
       "com.google.guava:guava",
       "javax.inject:javax.inject",
       "org.checkerframework:checker-compat-qual"
     ],
-    "com.google.errorprone:error_prone_annotation": [
-      "com.google.guava:guava"
-    ],
+    "com.google.errorprone:error_prone_annotation": ["com.google.guava:guava"],
     "com.google.errorprone:error_prone_check_api": [
       "com.github.ben-manes.caffeine:caffeine",
       "com.github.kevinstern:software-and-algorithms",
@@ -1176,16 +1170,12 @@
       "org.jspecify:jspecify",
       "org.pcollections:pcollections"
     ],
-    "com.google.flogger:flogger": [
-      "org.checkerframework:checker-compat-qual"
-    ],
+    "com.google.flogger:flogger": ["org.checkerframework:checker-compat-qual"],
     "com.google.flogger:flogger-system-backend": [
       "com.google.flogger:flogger",
       "org.checkerframework:checker-compat-qual"
     ],
-    "com.google.flogger:google-extensions": [
-      "com.google.flogger:flogger"
-    ],
+    "com.google.flogger:google-extensions": ["com.google.flogger:flogger"],
     "com.google.guava:guava": [
       "com.google.code.findbugs:jsr305",
       "com.google.errorprone:error_prone_annotations",
@@ -1217,9 +1207,7 @@
       "com.google.code.gson:gson",
       "com.google.http-client:google-http-client"
     ],
-    "com.google.jimfs:jimfs": [
-      "com.google.guava:guava"
-    ],
+    "com.google.jimfs:jimfs": ["com.google.guava:guava"],
     "com.google.oauth-client:google-oauth-client": [
       "com.google.guava:guava",
       "com.google.http-client:google-http-client",
@@ -1304,19 +1292,13 @@
       "com.google.code.gson:gson",
       "io.sweers.autotransient:autotransient"
     ],
-    "com.squareup.okhttp:okhttp": [
-      "com.squareup.okio:okio"
-    ],
+    "com.squareup.okhttp:okhttp": ["com.squareup.okio:okio"],
     "com.squareup.okio:okio": [
       "org.jetbrains.kotlin:kotlin-stdlib",
       "org.jetbrains.kotlin:kotlin-stdlib-common"
     ],
-    "com.sun.jersey:jersey-client": [
-      "com.sun.jersey:jersey-core"
-    ],
-    "com.sun.jersey:jersey-core": [
-      "javax.ws.rs:jsr311-api"
-    ],
+    "com.sun.jersey:jersey-client": ["com.sun.jersey:jersey-core"],
+    "com.sun.jersey:jersey-core": ["javax.ws.rs:jsr311-api"],
     "io.grpc:grpc-api": [
       "com.google.code.findbugs:jsr305",
       "com.google.errorprone:error_prone_annotations",
@@ -1327,9 +1309,7 @@
       "com.google.guava:guava",
       "io.grpc:grpc-api"
     ],
-    "io.grpc:grpc-context": [
-      "io.grpc:grpc-api"
-    ],
+    "io.grpc:grpc-context": ["io.grpc:grpc-api"],
     "io.grpc:grpc-core": [
       "com.google.android:annotations",
       "com.google.code.gson:gson",
@@ -1381,9 +1361,7 @@
       "io.grpc:grpc-core",
       "org.codehaus.mojo:animal-sniffer-annotations"
     ],
-    "io.netty:netty-buffer": [
-      "io.netty:netty-common"
-    ],
+    "io.netty:netty-buffer": ["io.netty:netty-common"],
     "io.netty:netty-codec": [
       "io.netty:netty-buffer",
       "io.netty:netty-common",
@@ -1432,9 +1410,7 @@
       "io.netty:netty-common",
       "io.netty:netty-transport"
     ],
-    "io.netty:netty-resolver": [
-      "io.netty:netty-common"
-    ],
+    "io.netty:netty-resolver": ["io.netty:netty-common"],
     "io.netty:netty-resolver-dns": [
       "io.netty:netty-buffer",
       "io.netty:netty-codec",
@@ -1557,9 +1533,7 @@
       "io.netty:netty-common",
       "io.netty:netty-transport"
     ],
-    "io.opencensus:opencensus-api": [
-      "io.grpc:grpc-context"
-    ],
+    "io.opencensus:opencensus-api": ["io.grpc:grpc-context"],
     "io.opencensus:opencensus-contrib-grpc-metrics": [
       "com.google.guava:guava",
       "io.opencensus:opencensus-api"
@@ -1568,12 +1542,8 @@
       "com.google.guava:guava",
       "io.opencensus:opencensus-api"
     ],
-    "io.reactivex.rxjava3:rxjava": [
-      "org.reactivestreams:reactive-streams"
-    ],
-    "junit:junit": [
-      "org.hamcrest:hamcrest-core"
-    ],
+    "io.reactivex.rxjava3:rxjava": ["org.reactivestreams:reactive-streams"],
+    "junit:junit": ["org.hamcrest:hamcrest-core"],
     "org.apache.commons:commons-compress": [
       "commons-codec:commons-codec",
       "commons-io:commons-io",
@@ -1589,9 +1559,7 @@
     "org.jetbrains.kotlin:kotlin-metadata-jvm": [
       "org.jetbrains.kotlin:kotlin-stdlib"
     ],
-    "org.jetbrains.kotlin:kotlin-stdlib": [
-      "org.jetbrains:annotations"
-    ],
+    "org.jetbrains.kotlin:kotlin-stdlib": ["org.jetbrains:annotations"],
     "org.mockito:mockito-core": [
       "net.bytebuddy:byte-buddy",
       "net.bytebuddy:byte-buddy-agent",
@@ -1601,30 +1569,20 @@
       "net.sf.jopt-simple:jopt-simple",
       "org.apache.commons:commons-math3"
     ],
-    "org.openjdk.jmh:jmh-generator-annprocess": [
-      "org.openjdk.jmh:jmh-core"
-    ],
-    "org.osgi:org.osgi.util.function": [
-      "org.osgi:osgi.annotation"
-    ],
+    "org.openjdk.jmh:jmh-generator-annprocess": ["org.openjdk.jmh:jmh-core"],
+    "org.osgi:org.osgi.util.function": ["org.osgi:osgi.annotation"],
     "org.osgi:org.osgi.util.promise": [
       "org.osgi:org.osgi.util.function",
       "org.osgi:osgi.annotation"
     ],
-    "org.osgi:org.osgi.util.tracker": [
-      "org.osgi:osgi.annotation"
-    ],
-    "org.ow2.asm:asm-analysis": [
-      "org.ow2.asm:asm-tree"
-    ],
+    "org.osgi:org.osgi.util.tracker": ["org.osgi:osgi.annotation"],
+    "org.ow2.asm:asm-analysis": ["org.ow2.asm:asm-tree"],
     "org.ow2.asm:asm-commons": [
       "org.ow2.asm:asm",
       "org.ow2.asm:asm-analysis",
       "org.ow2.asm:asm-tree"
     ],
-    "org.ow2.asm:asm-tree": [
-      "org.ow2.asm:asm"
-    ],
+    "org.ow2.asm:asm-tree": ["org.ow2.asm:asm"],
     "org.ow2.asm:asm-util": [
       "org.ow2.asm:asm",
       "org.ow2.asm:asm-analysis",
@@ -1806,12 +1764,8 @@
       "blogspot.software_and_algorithms.stern_library.optimization",
       "blogspot.software_and_algorithms.stern_library.string"
     ],
-    "com.github.stephenc.jcip:jcip-annotations": [
-      "net.jcip.annotations"
-    ],
-    "com.google.android:annotations": [
-      "android.annotation"
-    ],
+    "com.github.stephenc.jcip:jcip-annotations": ["net.jcip.annotations"],
+    "com.google.android:annotations": ["android.annotation"],
     "com.google.api-client:google-api-client": [
       "com.google.api.client.googleapis",
       "com.google.api.client.googleapis.apache",
@@ -1854,9 +1808,7 @@
       "com.google.shopping.type",
       "com.google.type"
     ],
-    "com.google.auth:google-auth-library-credentials": [
-      "com.google.auth"
-    ],
+    "com.google.auth:google-auth-library-credentials": ["com.google.auth"],
     "com.google.auth:google-auth-library-oauth2-http": [
       "com.google.auth.http",
       "com.google.auth.oauth2"
@@ -1911,9 +1863,7 @@
       "com.google.auto.value.extension.serializable",
       "com.google.auto.value.extension.toprettystring"
     ],
-    "com.google.auto:auto-common": [
-      "com.google.auto.common"
-    ],
+    "com.google.auto:auto-common": ["com.google.auto.common"],
     "com.google.caliper:caliper": [
       "com.google.caliper.runner",
       "com.google.caliper.runner.instrument",
@@ -1953,9 +1903,7 @@
       "com.google.caliper.worker.handler",
       "com.google.caliper.worker.instrument"
     ],
-    "com.google.caliper:caliper-worker-jvm": [
-      "com.google.caliper.worker"
-    ],
+    "com.google.caliper:caliper-worker-jvm": ["com.google.caliper.worker"],
     "com.google.code.findbugs:jsr305": [
       "javax.annotation",
       "javax.annotation.concurrent",
@@ -2014,9 +1962,7 @@
       "dagger.producers.monitoring",
       "dagger.producers.monitoring.internal"
     ],
-    "com.google.errorprone:error_prone_annotation": [
-      "com.google.errorprone"
-    ],
+    "com.google.errorprone:error_prone_annotation": ["com.google.errorprone"],
     "com.google.errorprone:error_prone_annotations": [
       "com.google.errorprone.annotations",
       "com.google.errorprone.annotations.concurrent"
@@ -2075,9 +2021,7 @@
     "com.google.flogger:flogger-system-backend": [
       "com.google.common.flogger.backend.system"
     ],
-    "com.google.flogger:google-extensions": [
-      "com.google.common.flogger"
-    ],
+    "com.google.flogger:google-extensions": ["com.google.common.flogger"],
     "com.google.guava:failureaccess": [
       "com.google.common.util.concurrent.internal"
     ],
@@ -2135,12 +2079,8 @@
     "com.google.http-client:google-http-client-gson": [
       "com.google.api.client.json.gson"
     ],
-    "com.google.j2objc:j2objc-annotations": [
-      "com.google.j2objc.annotations"
-    ],
-    "com.google.jimfs:jimfs": [
-      "com.google.common.jimfs"
-    ],
+    "com.google.j2objc:j2objc-annotations": ["com.google.j2objc.annotations"],
+    "com.google.jimfs:jimfs": ["com.google.common.jimfs"],
     "com.google.oauth-client:google-oauth-client": [
       "com.google.api.client.auth.oauth",
       "com.google.api.client.auth.oauth2",
@@ -2150,12 +2090,8 @@
       "com.google.protobuf",
       "com.google.protobuf.compiler"
     ],
-    "com.google.protobuf:protobuf-javalite": [
-      "com.google.protobuf"
-    ],
-    "com.google.re2j:re2j": [
-      "com.google.re2j"
-    ],
+    "com.google.protobuf:protobuf-javalite": ["com.google.protobuf"],
+    "com.google.re2j:re2j": ["com.google.re2j"],
     "com.google.testing.compile:compile-testing": [
       "com.google.testing.compile"
     ],
@@ -2168,9 +2104,7 @@
     "com.google.truth.extensions:truth-proto-extension": [
       "com.google.common.truth.extensions.proto"
     ],
-    "com.google.truth:truth": [
-      "com.google.common.truth"
-    ],
+    "com.google.truth:truth": ["com.google.common.truth"],
     "com.google.turbine:turbine": [
       "com.google.turbine.binder",
       "com.google.turbine.binder.bound",
@@ -2359,13 +2293,8 @@
       "com.squareup.okhttp.internal.io",
       "com.squareup.okhttp.internal.tls"
     ],
-    "com.squareup.okio:okio": [
-      "okio",
-      "okio.internal"
-    ],
-    "com.squareup:javapoet": [
-      "com.squareup.javapoet"
-    ],
+    "com.squareup.okio:okio": ["okio", "okio.internal"],
+    "com.squareup:javapoet": ["com.squareup.javapoet"],
     "com.sun.jersey:jersey-client": [
       "com.sun.jersey.api.client",
       "com.sun.jersey.api.client.async",
@@ -2454,9 +2383,7 @@
       "org.apache.commons.lang.text",
       "org.apache.commons.lang.time"
     ],
-    "info.picocli:picocli": [
-      "picocli"
-    ],
+    "info.picocli:picocli": ["picocli"],
     "io.github.eisop:dataflow-errorprone": [
       "org.checkerframework.dataflow.qual",
       "org.checkerframework.errorprone.checker.builder.qual",
@@ -2534,38 +2461,16 @@
       "com.github.difflib.text",
       "com.github.difflib.unifieddiff"
     ],
-    "io.grpc:grpc-api": [
-      "io.grpc"
-    ],
-    "io.grpc:grpc-auth": [
-      "io.grpc.auth"
-    ],
-    "io.grpc:grpc-core": [
-      "io.grpc.internal"
-    ],
-    "io.grpc:grpc-inprocess": [
-      "io.grpc.inprocess"
-    ],
-    "io.grpc:grpc-netty": [
-      "io.grpc.netty"
-    ],
-    "io.grpc:grpc-protobuf": [
-      "io.grpc.protobuf"
-    ],
-    "io.grpc:grpc-protobuf-lite": [
-      "io.grpc.protobuf.lite"
-    ],
-    "io.grpc:grpc-stub": [
-      "io.grpc.stub",
-      "io.grpc.stub.annotations"
-    ],
-    "io.grpc:grpc-util": [
-      "io.grpc.util"
-    ],
-    "io.netty:netty-buffer": [
-      "io.netty.buffer",
-      "io.netty.buffer.search"
-    ],
+    "io.grpc:grpc-api": ["io.grpc"],
+    "io.grpc:grpc-auth": ["io.grpc.auth"],
+    "io.grpc:grpc-core": ["io.grpc.internal"],
+    "io.grpc:grpc-inprocess": ["io.grpc.inprocess"],
+    "io.grpc:grpc-netty": ["io.grpc.netty"],
+    "io.grpc:grpc-protobuf": ["io.grpc.protobuf"],
+    "io.grpc:grpc-protobuf-lite": ["io.grpc.protobuf.lite"],
+    "io.grpc:grpc-stub": ["io.grpc.stub", "io.grpc.stub.annotations"],
+    "io.grpc:grpc-util": ["io.grpc.util"],
+    "io.netty:netty-buffer": ["io.netty.buffer", "io.netty.buffer.search"],
     "io.netty:netty-codec": [
       "io.netty.handler.codec",
       "io.netty.handler.codec.base64",
@@ -2578,9 +2483,7 @@
       "io.netty.handler.codec.string",
       "io.netty.handler.codec.xml"
     ],
-    "io.netty:netty-codec-dns": [
-      "io.netty.handler.codec.dns"
-    ],
+    "io.netty:netty-codec-dns": ["io.netty.handler.codec.dns"],
     "io.netty:netty-codec-http": [
       "io.netty.handler.codec.http",
       "io.netty.handler.codec.http.cookie",
@@ -2592,9 +2495,7 @@
       "io.netty.handler.codec.rtsp",
       "io.netty.handler.codec.spdy"
     ],
-    "io.netty:netty-codec-http2": [
-      "io.netty.handler.codec.http2"
-    ],
+    "io.netty:netty-codec-http2": ["io.netty.handler.codec.http2"],
     "io.netty:netty-codec-socks": [
       "io.netty.handler.codec.socks",
       "io.netty.handler.codec.socksx",
@@ -2626,18 +2527,10 @@
       "io.netty.handler.timeout",
       "io.netty.handler.traffic"
     ],
-    "io.netty:netty-handler-proxy": [
-      "io.netty.handler.proxy"
-    ],
-    "io.netty:netty-resolver": [
-      "io.netty.resolver"
-    ],
-    "io.netty:netty-resolver-dns": [
-      "io.netty.resolver.dns"
-    ],
-    "io.netty:netty-tcnative-classes": [
-      "io.netty.internal.tcnative"
-    ],
+    "io.netty:netty-handler-proxy": ["io.netty.handler.proxy"],
+    "io.netty:netty-resolver": ["io.netty.resolver"],
+    "io.netty:netty-resolver-dns": ["io.netty.resolver.dns"],
+    "io.netty:netty-tcnative-classes": ["io.netty.internal.tcnative"],
     "io.netty:netty-transport": [
       "io.netty.bootstrap",
       "io.netty.channel",
@@ -2652,15 +2545,9 @@
       "io.netty.channel.socket.nio",
       "io.netty.channel.socket.oio"
     ],
-    "io.netty:netty-transport-classes-epoll": [
-      "io.netty.channel.epoll"
-    ],
-    "io.netty:netty-transport-classes-kqueue": [
-      "io.netty.channel.kqueue"
-    ],
-    "io.netty:netty-transport-native-unix-common": [
-      "io.netty.channel.unix"
-    ],
+    "io.netty:netty-transport-classes-epoll": ["io.netty.channel.epoll"],
+    "io.netty:netty-transport-classes-kqueue": ["io.netty.channel.kqueue"],
+    "io.netty:netty-transport-native-unix-common": ["io.netty.channel.unix"],
     "io.netty:netty-transport-native-unix-common:jar:linux-aarch_64": [
       "io.netty.channel.unix"
     ],
@@ -2699,9 +2586,7 @@
       "io.opencensus.contrib.http",
       "io.opencensus.contrib.http.util"
     ],
-    "io.perfmark:perfmark-api": [
-      "io.perfmark"
-    ],
+    "io.perfmark:perfmark-api": ["io.perfmark"],
     "io.reactivex.rxjava3:rxjava": [
       "io.reactivex.rxjava3.annotations",
       "io.reactivex.rxjava3.core",
@@ -2736,9 +2621,7 @@
       "io.reactivex.rxjava3.subjects",
       "io.reactivex.rxjava3.subscribers"
     ],
-    "io.sweers.autotransient:autotransient": [
-      "io.sweers.autotransient"
-    ],
+    "io.sweers.autotransient:autotransient": ["io.sweers.autotransient"],
     "it.unimi.dsi:fastutil": [
       "it.unimi.dsi.fastutil",
       "it.unimi.dsi.fastutil.booleans",
@@ -2752,17 +2635,13 @@
       "it.unimi.dsi.fastutil.objects",
       "it.unimi.dsi.fastutil.shorts"
     ],
-    "javax.activation:javax.activation-api": [
-      "javax.activation"
-    ],
+    "javax.activation:javax.activation-api": ["javax.activation"],
     "javax.annotation:javax.annotation-api": [
       "javax.annotation",
       "javax.annotation.security",
       "javax.annotation.sql"
     ],
-    "javax.inject:javax.inject": [
-      "javax.inject"
-    ],
+    "javax.inject:javax.inject": ["javax.inject"],
     "javax.ws.rs:jsr311-api": [
       "javax.ws.rs",
       "javax.ws.rs.core",
@@ -3216,12 +3095,8 @@
       "org.intellij.lang.annotations",
       "org.jetbrains.annotations"
     ],
-    "org.json:json": [
-      "org.json"
-    ],
-    "org.jspecify:jspecify": [
-      "org.jspecify.annotations"
-    ],
+    "org.json:json": ["org.json"],
+    "org.jspecify:jspecify": ["org.jspecify.annotations"],
     "org.mockito:mockito-core": [
       "org.mockito",
       "org.mockito.codegen",
@@ -3319,9 +3194,7 @@
       "org.openjdk.jmh.generators",
       "org.openjdk.jmh.generators.annotations"
     ],
-    "org.osgi:org.osgi.dto": [
-      "org.osgi.dto"
-    ],
+    "org.osgi:org.osgi.dto": ["org.osgi.dto"],
     "org.osgi:org.osgi.framework": [
       "org.osgi.framework",
       "org.osgi.framework.dto",
@@ -3340,47 +3213,22 @@
       "org.osgi.resource",
       "org.osgi.resource.dto"
     ],
-    "org.osgi:org.osgi.service.log": [
-      "org.osgi.service.log"
-    ],
-    "org.osgi:org.osgi.service.repository": [
-      "org.osgi.service.repository"
-    ],
-    "org.osgi:org.osgi.util.function": [
-      "org.osgi.util.function"
-    ],
-    "org.osgi:org.osgi.util.promise": [
-      "org.osgi.util.promise"
-    ],
-    "org.osgi:org.osgi.util.tracker": [
-      "org.osgi.util.tracker"
-    ],
+    "org.osgi:org.osgi.service.log": ["org.osgi.service.log"],
+    "org.osgi:org.osgi.service.repository": ["org.osgi.service.repository"],
+    "org.osgi:org.osgi.util.function": ["org.osgi.util.function"],
+    "org.osgi:org.osgi.util.promise": ["org.osgi.util.promise"],
+    "org.osgi:org.osgi.util.tracker": ["org.osgi.util.tracker"],
     "org.osgi:osgi.annotation": [
       "org.osgi.annotation.bundle",
       "org.osgi.annotation.versioning"
     ],
-    "org.ow2.asm:asm": [
-      "org.objectweb.asm",
-      "org.objectweb.asm.signature"
-    ],
-    "org.ow2.asm:asm-analysis": [
-      "org.objectweb.asm.tree.analysis"
-    ],
-    "org.ow2.asm:asm-commons": [
-      "org.objectweb.asm.commons"
-    ],
-    "org.ow2.asm:asm-tree": [
-      "org.objectweb.asm.tree"
-    ],
-    "org.ow2.asm:asm-util": [
-      "org.objectweb.asm.util"
-    ],
-    "org.pcollections:pcollections": [
-      "org.pcollections"
-    ],
-    "org.reactivestreams:reactive-streams": [
-      "org.reactivestreams"
-    ],
+    "org.ow2.asm:asm": ["org.objectweb.asm", "org.objectweb.asm.signature"],
+    "org.ow2.asm:asm-analysis": ["org.objectweb.asm.tree.analysis"],
+    "org.ow2.asm:asm-commons": ["org.objectweb.asm.commons"],
+    "org.ow2.asm:asm-tree": ["org.objectweb.asm.tree"],
+    "org.ow2.asm:asm-util": ["org.objectweb.asm.util"],
+    "org.pcollections:pcollections": ["org.pcollections"],
+    "org.reactivestreams:reactive-streams": ["org.reactivestreams"],
     "org.slf4j:slf4j-api": [
       "org.slf4j",
       "org.slf4j.event",
@@ -3428,9 +3276,7 @@
       "org.yaml.snakeyaml.tokens",
       "org.yaml.snakeyaml.util"
     ],
-    "tools.profiler:async-profiler": [
-      "one.profiler"
-    ]
+    "tools.profiler:async-profiler": ["one.profiler"]
   },
   "repositories": {
     "https://repo1.maven.org/maven2/": [
@@ -3742,12 +3588,8 @@
         "io.grpc.netty.NettyChannelProvider",
         "io.grpc.netty.UdsNettyChannelProvider"
       ],
-      "io.grpc.NameResolverProvider": [
-        "io.grpc.netty.UdsNameResolverProvider"
-      ],
-      "io.grpc.ServerProvider": [
-        "io.grpc.netty.NettyServerProvider"
-      ]
+      "io.grpc.NameResolverProvider": ["io.grpc.netty.UdsNameResolverProvider"],
+      "io.grpc.ServerProvider": ["io.grpc.netty.NettyServerProvider"]
     },
     "io.grpc:grpc-util": {
       "io.grpc.LoadBalancerProvider": [
diff --git a/src/main/java/com/google/devtools/build/lib/authandtls/AuthAndTLSOptions.java b/src/main/java/com/google/devtools/build/lib/authandtls/AuthAndTLSOptions.java
index d2f2c164c5..15e42da281 100644
--- a/src/main/java/com/google/devtools/build/lib/authandtls/AuthAndTLSOptions.java
+++ b/src/main/java/com/google/devtools/build/lib/authandtls/AuthAndTLSOptions.java
@@ -183,8 +183,8 @@ public class AuthAndTLSOptions extends OptionsBase {
       documentationCategory = OptionDocumentationCategory.UNCATEGORIZED,
       effectTags = {OptionEffectTag.UNKNOWN},
       help =
-          "The default duration for which credentials supplied by a credential helper are cached if"
-              + " the helper does not provide when the credentials expire.")
+          "How long to cache credentials for if the credential helper doesn't return an expiration"
+              + " time. Changing the value of this flag clears the cache.")
   public Duration credentialHelperCacheTimeout;
 
   /**
diff --git a/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModule.java b/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModule.java
index db98eb7bea..2729ce3724 100644
--- a/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModule.java
+++ b/src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModule.java
@@ -16,18 +16,30 @@ package com.google.devtools.build.lib.authandtls.credentialhelper;
 
 import com.github.benmanes.caffeine.cache.Cache;
 import com.github.benmanes.caffeine.cache.Caffeine;
+import com.github.benmanes.caffeine.cache.Ticker;
+import com.google.common.annotations.VisibleForTesting;
 import com.google.common.collect.ImmutableList;
 import com.google.devtools.build.lib.authandtls.AuthAndTLSOptions;
 import com.google.devtools.build.lib.runtime.BlazeModule;
 import com.google.devtools.build.lib.runtime.CommandEnvironment;
 import com.google.devtools.common.options.OptionsBase;
 import java.net.URI;
+import java.time.Duration;
 
 /** A module whose sole purpose is to hold the credential cache which is shared by other modules. */
 public class CredentialModule extends BlazeModule {
   private final CredentialCacheExpiry cacheExpiry = new CredentialCacheExpiry();
-  private final Cache<URI, GetCredentialsResponse> credentialCache =
-      Caffeine.newBuilder().ticker(SystemMillisTicker.INSTANCE).expireAfter(cacheExpiry).build();
+  private final Cache<URI, GetCredentialsResponse> credentialCache;
+  private Duration lastDefaultCacheDuration = Duration.ZERO;
+
+  public CredentialModule() {
+    this(Ticker.systemTicker());
+  }
+
+  @VisibleForTesting
+  CredentialModule(Ticker ticker) {
+    this.credentialCache = Caffeine.newBuilder().ticker(ticker).expireAfter(cacheExpiry).build();
+  }
 
   /** Returns the credential cache. */
   public Cache<URI, GetCredentialsResponse> getCredentialCache() {
@@ -41,13 +53,19 @@ public class CredentialModule extends BlazeModule {
 
   @Override
   public void beforeCommand(CommandEnvironment env) {
-    // Update the cache expiration policy according to the command options.
-    AuthAndTLSOptions authAndTlsOptions = env.getOptions().getOptions(AuthAndTLSOptions.class);
-    cacheExpiry.setDefaultCacheDuration(authAndTlsOptions.credentialHelperCacheTimeout);
+    Duration defaultCacheDuration =
+        env.getOptions().getOptions(AuthAndTLSOptions.class).credentialHelperCacheTimeout;
+
+    boolean defaultCacheDurationChanged = !defaultCacheDuration.equals(lastDefaultCacheDuration);
+    lastDefaultCacheDuration = defaultCacheDuration;
 
-    // Clear the cache on clean.
-    if (env.getCommand().name().equals("clean")) {
+    // Clear the cache on clean or when the default cache duration changes.
+    if (env.getCommandName().equals("clean") || defaultCacheDurationChanged) {
       credentialCache.invalidateAll();
+      credentialCache.cleanUp();
     }
+
+    // Update the expiration policy for future entries.
+    cacheExpiry.setDefaultCacheDuration(defaultCacheDuration);
   }
 }
diff --git a/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/BUILD b/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/BUILD
index f6ac2cdeee..eec2bb1345 100644
--- a/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/BUILD
+++ b/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/BUILD
@@ -25,16 +25,22 @@ java_test(
         "//src/test/java/com/google/devtools/build/lib:test_runner",
     ],
     deps = [
+        "//src/main/java/com/google/devtools/build/lib:runtime",
+        "//src/main/java/com/google/devtools/build/lib/authandtls",
         "//src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper",
+        "//src/main/java/com/google/devtools/build/lib/authandtls/credentialhelper:credential_module",
         "//src/main/java/com/google/devtools/build/lib/events",
         "//src/main/java/com/google/devtools/build/lib/util:os",
         "//src/main/java/com/google/devtools/build/lib/vfs",
         "//src/main/java/com/google/devtools/build/lib/vfs:pathfragment",
         "//src/main/java/com/google/devtools/build/lib/vfs/inmemoryfs",
+        "//src/main/java/com/google/devtools/common/options:options_internal",
         "//src/test/java/com/google/devtools/build/lib/vfs/util",
+        "//third_party:caffeine",
         "//third_party:gson",
         "//third_party:guava",
         "//third_party:junit4",
+        "//third_party:mockito",
         "//third_party:truth",
         "@rules_java//java/runfiles",
     ],
diff --git a/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModuleTest.java b/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModuleTest.java
new file mode 100644
index 0000000000..f13f489ccd
--- /dev/null
+++ b/src/test/java/com/google/devtools/build/lib/authandtls/credentialhelper/CredentialModuleTest.java
@@ -0,0 +1,173 @@
+// Copyright 2024 The Bazel Authors. All rights reserved.
+//
+// Licensed under the Apache License, Version 2.0 (the "License");
+// you may not use this file except in compliance with the License.
+// You may obtain a copy of the License at
+//
+//    http://www.apache.org/licenses/LICENSE-2.0
+//
+// Unless required by applicable law or agreed to in writing, software
+// distributed under the License is distributed on an "AS IS" BASIS,
+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+// See the License for the specific language governing permissions and
+// limitations under the License.
+package com.google.devtools.build.lib.authandtls.credentialhelper;
+
+import static com.google.common.truth.Truth.assertThat;
+import static org.mockito.Mockito.mock;
+import static org.mockito.Mockito.when;
+
+import com.github.benmanes.caffeine.cache.Cache;
+import com.github.benmanes.caffeine.cache.Policy.CacheEntry;
+import com.github.benmanes.caffeine.cache.Ticker;
+import com.google.devtools.build.lib.authandtls.AuthAndTLSOptions;
+import com.google.devtools.build.lib.runtime.CommandEnvironment;
+import com.google.devtools.common.options.OptionsParsingResult;
+import java.net.URI;
+import java.time.Duration;
+import java.time.Instant;
+import org.junit.Test;
+import org.junit.runner.RunWith;
+import org.junit.runners.JUnit4;
+
+/** Tests for {@link CredentialModule}. */
+@RunWith(JUnit4.class)
+public final class CredentialModuleTest {
+
+  private static final URI TEST_URI = URI.create("https://example.com");
+  private static final GetCredentialsResponse DEFAULT_RESPONSE =
+      GetCredentialsResponse.newBuilder().build();
+
+  private Instant currentTime = Instant.parse("2001-01-01T00:00:00Z");
+
+  private final Ticker ticker = () -> toEpochNano(currentTime);
+  private final CredentialModule module = new CredentialModule(ticker);
+  private final Cache<URI, GetCredentialsResponse> cache = module.getCredentialCache();
+
+  @Test
+  public void putWithExplicitExpiration() {
+    initModule("build", Duration.ofMinutes(60));
+
+    var expiry = currentTime.plus(Duration.ofMinutes(123));
+
+    cache.put(TEST_URI, GetCredentialsResponse.newBuilder().setExpires(expiry).build());
+    assertInCache(TEST_URI, expiry);
+
+    currentTime = expiry.minusSeconds(1);
+    assertInCache(TEST_URI, expiry);
+
+    currentTime = expiry.plusSeconds(1);
+    assertNotInCache(TEST_URI);
+  }
+
+  @Test
+  public void putWithNonzeroDefaultExpiration() {
+    initModule("build", Duration.ofMinutes(60));
+
+    var expiry = currentTime.plus(Duration.ofMinutes(60));
+
+    cache.put(TEST_URI, DEFAULT_RESPONSE);
+    assertInCache(TEST_URI, expiry);
+
+    currentTime = expiry.minusSeconds(1);
+    assertInCache(TEST_URI, expiry);
+
+    currentTime = expiry.plusSeconds(1);
+    assertNotInCache(TEST_URI);
+  }
+
+  @Test
+  public void putWithZeroDefaultExpiration() {
+    initModule("build", Duration.ZERO);
+
+    cache.put(TEST_URI, DEFAULT_RESPONSE);
+
+    assertNotInCache(TEST_URI);
+  }
+
+  @Test
+  public void keepingDefaultDoesNotClearCache() {
+    initModule("build", Duration.ofMinutes(60));
+
+    cache.put(TEST_URI, DEFAULT_RESPONSE);
+    assertInCache(TEST_URI, currentTime.plus(Duration.ofMinutes(60)));
+
+    initModule("build", Duration.ofMinutes(60));
+
+    assertInCache(TEST_URI, currentTime.plus(Duration.ofMinutes(60)));
+  }
+
+  @Test
+  public void changingDefaultToSmallerValueClearsCache() {
+    initModule("build", Duration.ofMinutes(60));
+
+    cache.put(TEST_URI, DEFAULT_RESPONSE);
+    assertInCache(TEST_URI, currentTime.plus(Duration.ofMinutes(60)));
+
+    initModule("build", Duration.ofMinutes(30));
+
+    assertNotInCache(TEST_URI);
+  }
+
+  @Test
+  public void changingDefaultToLargerValueClearsCache() {
+    initModule("build", Duration.ofMinutes(30));
+
+    cache.put(TEST_URI, DEFAULT_RESPONSE);
+    assertInCache(TEST_URI, currentTime.plus(Duration.ofMinutes(30)));
+
+    initModule("build", Duration.ofMinutes(60));
+
+    assertNotInCache(TEST_URI);
+  }
+
+  @Test
+  public void cleanCommandClearsCache() {
+    initModule("build", Duration.ofMinutes(60));
+
+    cache.put(TEST_URI, DEFAULT_RESPONSE);
+    assertInCache(TEST_URI, currentTime.plus(Duration.ofMinutes(60)));
+
+    initModule("clean", Duration.ofMinutes(60));
+
+    assertNotInCache(TEST_URI);
+  }
+
+  private void initModule(String commandName, Duration cacheTimeout) {
+    module.beforeCommand(createCommandEnvironment(commandName, cacheTimeout));
+  }
+
+  private static CommandEnvironment createCommandEnvironment(
+      String commandName, Duration cacheTimeout) {
+    AuthAndTLSOptions authAndTlsOptions = new AuthAndTLSOptions();
+    authAndTlsOptions.credentialHelperCacheTimeout = cacheTimeout;
+
+    OptionsParsingResult optionsParsingResult = mock(OptionsParsingResult.class);
+    when(optionsParsingResult.getOptions(AuthAndTLSOptions.class)).thenReturn(authAndTlsOptions);
+
+    CommandEnvironment env = mock(CommandEnvironment.class);
+    when(env.getCommandName()).thenReturn(commandName);
+    when(env.getOptions()).thenReturn(optionsParsingResult);
+
+    return env;
+  }
+
+  private void assertInCache(URI uri, Instant expiry) {
+    CacheEntry<URI, GetCredentialsResponse> entry = cache.policy().getEntryIfPresentQuietly(uri);
+    assertThat(entry).isNotNull();
+    assertThat(fromEpochNano(entry.expiresAt())).isEqualTo(expiry);
+  }
+
+  private void assertNotInCache(URI uri) {
+    assertThat(cache.policy().getEntryIfPresentQuietly(uri)).isNull();
+  }
+
+  private static Instant fromEpochNano(long nano) {
+    return Instant.ofEpochSecond(
+        nano / Duration.ofSeconds(1).toNanos(), nano % Duration.ofSeconds(1).toNanos());
+  }
+
+  private static long toEpochNano(Instant instant) {
+    return Duration.ofSeconds(1).toNanos() * instant.getEpochSecond() + instant.getNano();
+  }
+}
