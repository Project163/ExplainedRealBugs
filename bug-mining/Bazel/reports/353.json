{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/26726","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/26726/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/26726/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/26726/events","html_url":"https://github.com/bazelbuild/bazel/issues/26726","id":3303778490,"node_id":"I_kwDOATz7jc7E66i6","number":26726,"title":"Bazel maintains HTTP connection after 401 with failed credential helper","user":{"login":"chrisstaite-menlo","id":137425734,"node_id":"U_kgDOCDDzRg","avatar_url":"https://avatars.githubusercontent.com/u/137425734?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisstaite-menlo","html_url":"https://github.com/chrisstaite-menlo","followers_url":"https://api.github.com/users/chrisstaite-menlo/followers","following_url":"https://api.github.com/users/chrisstaite-menlo/following{/other_user}","gists_url":"https://api.github.com/users/chrisstaite-menlo/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisstaite-menlo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisstaite-menlo/subscriptions","organizations_url":"https://api.github.com/users/chrisstaite-menlo/orgs","repos_url":"https://api.github.com/users/chrisstaite-menlo/repos","events_url":"https://api.github.com/users/chrisstaite-menlo/events{/privacy}","received_events_url":"https://api.github.com/users/chrisstaite-menlo/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":192364170,"node_id":"MDU6TGFiZWwxOTIzNjQxNzA=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P2","name":"P2","color":"e99695","default":false,"description":"We'll consider working on this in future. (Assignee optional)"},{"id":1020663381,"node_id":"MDU6TGFiZWwxMDIwNjYzMzgx","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-ExternalDeps","name":"team-ExternalDeps","color":"f1f442","default":false,"description":"External dependency handling, remote repositiories, WORKSPACE file."},{"id":2051939153,"node_id":"MDU6TGFiZWwyMDUxOTM5MTUz","url":"https://api.github.com/repos/bazelbuild/bazel/labels/help%20wanted","name":"help wanted","color":"159818","default":true,"description":"Someone outside the Bazel team could own this"}],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":10,"created_at":"2025-08-08T11:59:17Z","updated_at":"2025-08-29T14:37:24Z","closed_at":null,"author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\nWhen the credential helper fails in an async manner as documented, the [HTTP downloader continues](https://github.com/bazelbuild/bazel/blob/master/src/main/java/com/google/devtools/build/lib/bazel/repository/downloader/HttpConnectorMultiplexer.java#L149) to attempt a download anyway.  When this inevitably results in a 401 response, the HTTP downloader is cached in the Bazel server and re-used for all subsequent attempts to download from that server even when the credentials have been updated in the credential helper.\n\nThis requires that Bazel is shut down after re-authenticating with the credential helper before it will re-attempt running the credential helper and resolving the 401 error.\n\nThe ideal solution would be for the HTTP downloader not to plough on regardless if the credential helper fails.  However, if it is desired to do so, then the connection to the upstream should not be cached and therefore allow the credential helper to be invoked once again when a new build command comes in.\n\nFurthermore, this caching of connection completely ignores the expiry provided to Bazel in the credential helper response.\n\n### Which category does this issue belong to?\n\n_No response_\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\nUse a http_archive to download from a server that requires authentication.  Provide the authentication through a credential_helper script.  Provide invalid credentials on the first execution of Bazel (exit code 1).  Update the script to provide the correct credentials (exit 0 with valid JSON).  Note that Bazel still gets 401 from the download.\n\n### Which operating system are you running Bazel on?\n\n\nLinux\n\n### What is the output of `bazel info release`?\n\n\nrelease 8.1.1\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\n_No response_\n\n### What's the output of `git remote get-url origin; git rev-parse HEAD` ?\n\n\n```text\n\n```\n\n### If this is a regression, please try to identify the Bazel commit where the bug was introduced with bazelisk --bisect.\n\n\n_No response_\n\n### Have you found anything relevant by searching the web?\n\n_No response_\n\n### Any other information, logs, or outputs that you want to share?\n\n_No response_","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/26726/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/26726/timeline","performed_via_github_app":null,"state_reason":"reopened"}