{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/22260","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/22260/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/22260/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/22260/events","html_url":"https://github.com/bazelbuild/bazel/issues/22260","id":2281908336,"node_id":"I_kwDOATz7jc6IAyhw","number":22260,"title":"Could not move output artifacts from sandboxed execution","user":{"login":"AustinSchuh","id":294043,"node_id":"MDQ6VXNlcjI5NDA0Mw==","avatar_url":"https://avatars.githubusercontent.com/u/294043?v=4","gravatar_id":"","url":"https://api.github.com/users/AustinSchuh","html_url":"https://github.com/AustinSchuh","followers_url":"https://api.github.com/users/AustinSchuh/followers","following_url":"https://api.github.com/users/AustinSchuh/following{/other_user}","gists_url":"https://api.github.com/users/AustinSchuh/gists{/gist_id}","starred_url":"https://api.github.com/users/AustinSchuh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AustinSchuh/subscriptions","organizations_url":"https://api.github.com/users/AustinSchuh/orgs","repos_url":"https://api.github.com/users/AustinSchuh/repos","events_url":"https://api.github.com/users/AustinSchuh/events{/privacy}","received_events_url":"https://api.github.com/users/AustinSchuh/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":1020665933,"node_id":"MDU6TGFiZWwxMDIwNjY1OTMz","url":"https://api.github.com/repos/bazelbuild/bazel/labels/untriaged","name":"untriaged","color":"c34ddd","default":false,"description":""},{"id":1193206953,"node_id":"MDU6TGFiZWwxMTkzMjA2OTUz","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Local-Exec","name":"team-Local-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Local) team"}],"state":"closed","locked":false,"assignee":{"login":"tjgq","id":4370077,"node_id":"MDQ6VXNlcjQzNzAwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4370077?v=4","gravatar_id":"","url":"https://api.github.com/users/tjgq","html_url":"https://github.com/tjgq","followers_url":"https://api.github.com/users/tjgq/followers","following_url":"https://api.github.com/users/tjgq/following{/other_user}","gists_url":"https://api.github.com/users/tjgq/gists{/gist_id}","starred_url":"https://api.github.com/users/tjgq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjgq/subscriptions","organizations_url":"https://api.github.com/users/tjgq/orgs","repos_url":"https://api.github.com/users/tjgq/repos","events_url":"https://api.github.com/users/tjgq/events{/privacy}","received_events_url":"https://api.github.com/users/tjgq/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"tjgq","id":4370077,"node_id":"MDQ6VXNlcjQzNzAwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4370077?v=4","gravatar_id":"","url":"https://api.github.com/users/tjgq","html_url":"https://github.com/tjgq","followers_url":"https://api.github.com/users/tjgq/followers","following_url":"https://api.github.com/users/tjgq/following{/other_user}","gists_url":"https://api.github.com/users/tjgq/gists{/gist_id}","starred_url":"https://api.github.com/users/tjgq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjgq/subscriptions","organizations_url":"https://api.github.com/users/tjgq/orgs","repos_url":"https://api.github.com/users/tjgq/repos","events_url":"https://api.github.com/users/tjgq/events{/privacy}","received_events_url":"https://api.github.com/users/tjgq/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":8,"created_at":"2024-05-06T22:39:19Z","updated_at":"2024-06-21T21:09:17Z","closed_at":"2024-06-19T11:33:12Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\nI'm getting the following error:\r\n\r\n```\r\nERROR: /home/austin/local/971-Robot-Code/BUILD:8:22: Extracting npm package pngjs@5.0.0 failed: I/O exception during sandboxed execution: Could not move output artifacts from sandboxed execution\r\n```\r\n\r\nThe command which is failing is:\r\n```\r\nSUBCOMMAND: # //:.aspect_rules_js/node_modules/pngjs@5.0.0/pkg [action 'Extracting npm package pngjs@5.0.0', configuration: 49e96f04a0aa88743eaf8768eee2a9ade7e65a49fe5db58df8a940a3a0f9a35b, execution platform: //tools/platforms:linux_x86, mnemonic: NpmPackageExtract]\r\n(cd /media/austin/a7ea7e92-b2f9-4e20-8134-54e7a3d73a5c/home/austin/.cache/bazel/_bazel_austin/8f2824674f275a56b96be13cdc66e9a4/execroot/org_frc971 && \\\r\n  exec env - \\\r\n  external/bsd_tar_linux_amd64/tar --extract --no-same-owner --no-same-permissions --strip-components 1 --file external/npm__pngjs__5.0.0/package.tgz --directory bazel-out/k8-opt/bin/node_modules/.aspect_rules_js/pngjs@5.0.0/node_modules/pngjs)\r\n```\r\n\r\nDigging in:\r\n```\r\naustin[231573] aschuh-3950x /dev/shm/bazel-sandbox.8aaf1503237d2b46ad4a0e5c8239c8c7048fb0dbbee040c344aefd94a2f1a91d/linux-sandbox/20665/execroot/org_frc971\r\n$ tar tvf external/npm__pngjs__5.0.0/package.tgz\r\ndrw-rw-rw- 0/0               0 2020-04-15 12:14 package\r\n-rw-rw-rw- 0/0              31 2020-04-15 12:11 package/.eslintignore\r\n-rw-rw-rw- 0/0             320 2020-04-15 12:11 package/.eslintrc.json\r\n-rw-rw-rw- 0/0              43 2020-04-15 12:11 package/.prettierignore\r\n-rw-rw-rw- 0/0          480994 2020-04-15 12:16 package/browser.js\r\ndrw-rw-rw- 0/0               0 2020-04-10 04:53 package/coverage\r\ndrw-rw-rw- 0/0               0 2020-04-15 12:11 package/lib\r\n-rw-rw-rw- 0/0            1151 2017-04-30 02:34 package/LICENSE\r\n-rw-rw-rw- 0/0            1805 2020-04-15 12:14 package/package.json\r\n-rw-rw-rw- 0/0           13396 2020-04-15 12:13 package/README.md\r\ndrw-rw-rw- 0/0               0 2020-04-10 04:53 package/coverage/lcov-report\r\n-rw-rw-rw- 0/0           28336 2020-04-10 04:53 package/coverage/lcov.info\r\n-rw-rw-rw- 0/0            6477 2020-04-15 12:11 package/lib/bitmapper.js\r\n-rw-rw-rw- 0/0            4670 2020-04-15 12:11 package/lib/bitpacker.js\r\n-rw-rw-rw- 0/0            4249 2020-04-15 12:11 package/lib/chunkstream.js\r\n-rw-rw-rw- 0/0             662 2020-04-15 12:11 package/lib/constants.js\r\n-rw-rw-rw- 0/0             853 2020-04-15 12:11 package/lib/crc.js\r\n-rw-rw-rw- 0/0            4279 2020-04-15 12:11 package/lib/filter-pack.js\r\n-rw-rw-rw- 0/0             558 2020-04-15 12:11 package/lib/filter-parse-async.js\r\n-rw-rw-rw- 0/0             483 2020-04-15 12:11 package/lib/filter-parse-sync.js\r\n-rw-rw-rw- 0/0            4798 2020-04-15 12:11 package/lib/filter-parse.js\r\n-rw-rw-rw- 0/0            2329 2020-04-15 12:11 package/lib/format-normaliser.js\r\n-rw-rw-rw- 0/0            2004 2020-04-15 12:11 package/lib/interlace.js\r\n```\r\n\r\nA simple reproducer is:\r\n```\r\nload(\"@aspect_bazel_lib//lib:run_binary.bzl\", \"run_binary\")\r\n\r\nsh_binary(\r\n    name = \"foo_gen\",\r\n    srcs = [ \r\n        \"foo_gen.sh\",\r\n    ],\r\n)\r\n\r\nrun_binary(\r\n    name = \"foo\",\r\n    args = [\"$(RULEDIR)\"],\r\n    out_dirs = [\"pkg\"],\r\n    tool = \":foo_gen\",\r\n)\r\n```\r\nwith `foo_gen.sh` being:\r\n\r\n```#!/bin/bash\r\n\r\nOUT=\"$@/pkg\"\r\n\r\nrm -rf $OUT\r\n\r\nmkdir $OUT\r\ntouch $OUT/bar\r\nchmod a-x $OUT\r\n```\n\n### Which category does this issue belong to?\n\nCore\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\nSee above\n\n### Which operating system are you running Bazel on?\n\n\nDebian Bookworm\n\n### What is the output of `bazel info release`?\n\n\nrelease 7.1.2rc1\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\n_No response_\n\n### What's the output of `git remote get-url origin; git rev-parse HEAD` ?\n\n\n_No response_\n\n### Is this a regression? If yes, please try to identify the Bazel commit where the bug was introduced.\n\n\nI don't know.  With bazel 6, the Aspect javascript rules worked, and I'm unable to use them in bazel 7.\n\n### Have you found anything relevant by searching the web?\n\n_No response_\n\n### Any other information, logs, or outputs that you want to share?\n\n_No response_","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/22260/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/22260/timeline","performed_via_github_app":null,"state_reason":"completed"}