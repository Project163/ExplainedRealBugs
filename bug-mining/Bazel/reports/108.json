{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/20246","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/20246/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/20246/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/20246/events","html_url":"https://github.com/bazelbuild/bazel/issues/20246","id":1999686197,"node_id":"I_kwDOATz7jc53MMo1","number":20246,"title":"Build failures and internal errors when switching from 7.0.0rc3 to 7.0.0rc4","user":{"login":"rsalvador","id":1301827,"node_id":"MDQ6VXNlcjEzMDE4Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/1301827?v=4","gravatar_id":"","url":"https://api.github.com/users/rsalvador","html_url":"https://github.com/rsalvador","followers_url":"https://api.github.com/users/rsalvador/followers","following_url":"https://api.github.com/users/rsalvador/following{/other_user}","gists_url":"https://api.github.com/users/rsalvador/gists{/gist_id}","starred_url":"https://api.github.com/users/rsalvador/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rsalvador/subscriptions","organizations_url":"https://api.github.com/users/rsalvador/orgs","repos_url":"https://api.github.com/users/rsalvador/repos","events_url":"https://api.github.com/users/rsalvador/events{/privacy}","received_events_url":"https://api.github.com/users/rsalvador/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":1193207358,"node_id":"MDU6TGFiZWwxMTkzMjA3MzU4","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Remote-Exec","name":"team-Remote-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Remote) team"}],"state":"closed","locked":false,"assignee":{"login":"tjgq","id":4370077,"node_id":"MDQ6VXNlcjQzNzAwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4370077?v=4","gravatar_id":"","url":"https://api.github.com/users/tjgq","html_url":"https://github.com/tjgq","followers_url":"https://api.github.com/users/tjgq/followers","following_url":"https://api.github.com/users/tjgq/following{/other_user}","gists_url":"https://api.github.com/users/tjgq/gists{/gist_id}","starred_url":"https://api.github.com/users/tjgq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjgq/subscriptions","organizations_url":"https://api.github.com/users/tjgq/orgs","repos_url":"https://api.github.com/users/tjgq/repos","events_url":"https://api.github.com/users/tjgq/events{/privacy}","received_events_url":"https://api.github.com/users/tjgq/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"tjgq","id":4370077,"node_id":"MDQ6VXNlcjQzNzAwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4370077?v=4","gravatar_id":"","url":"https://api.github.com/users/tjgq","html_url":"https://github.com/tjgq","followers_url":"https://api.github.com/users/tjgq/followers","following_url":"https://api.github.com/users/tjgq/following{/other_user}","gists_url":"https://api.github.com/users/tjgq/gists{/gist_id}","starred_url":"https://api.github.com/users/tjgq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjgq/subscriptions","organizations_url":"https://api.github.com/users/tjgq/orgs","repos_url":"https://api.github.com/users/tjgq/repos","events_url":"https://api.github.com/users/tjgq/events{/privacy}","received_events_url":"https://api.github.com/users/tjgq/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":12,"created_at":"2023-11-17T18:18:08Z","updated_at":"2023-11-21T13:42:19Z","closed_at":"2023-11-21T13:42:19Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\nBazel 7.0.0rc3 was building without problems our big monorepo, but 7.0.0rc4 fails with errors, e.g.:\r\n```\r\nWARNING: /Users/rsalvador/.../BUILD.bazel:3:17: output 'ui-services-connection-models-api/modelbuilder_generated' of //ui-services-connection-models-api:ui_services_connection_model is a directory; dependency checking of directories is unsound\r\nERROR: /Users/rsalvador/.../BUILD.bazel:3:17: modelbuilder generating srcjar modelbuilder_generated.srcjar failed: Exec failed due to IOException: /Users/rsalvador/.cache/bazel/b6de016d545fc335c6fe85486d422c54/execroot/core/bazel-out/darwin_x86_64-fastbuild/bin/ui-services-connection-models-api/modelbuilder_generated (No such file or directory)\r\n```\r\n\r\nand\r\n\r\n```\r\nFATAL: bazel crashed due to an internal error. Printing stack trace:\r\njava.lang.RuntimeException: Unrecoverable error while evaluating node 'ActionLookupData6{actionLookupKey=ConfiguredTargetKey{label=//tools/build/bazel/rules/lwc/js:bundle, config=BuildConfigurationKey[6aa701ced8cd3692bfda0c63eeb4de6bb53c8649464bf1688db8c6f5976ed915]}, actionIndex=6}' (requested by nodes 'ArtifactNestedSetKey[6]@774500339', 'ArtifactNestedSetKey[5]@1662963755')\r\n\tat com.google.devtools.build.skyframe.AbstractParallelEvaluator$Evaluate.run(AbstractParallelEvaluator.java:550)\r\n\tat com.google.devtools.build.lib.concurrent.AbstractQueueVisitor$WrappedRunnable.run(AbstractQueueVisitor.java:414)\r\n\tat java.base/java.util.concurrent.ForkJoinTask$RunnableExecuteAction.exec(ForkJoinTask.java:1426)\r\n\tat java.base/java.util.concurrent.ForkJoinTask.doExec(ForkJoinTask.java:290)\r\n\tat java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(ForkJoinPool.java:1020)\r\n\tat java.base/java.util.concurrent.ForkJoinPool.scan(ForkJoinPool.java:1656)\r\n\tat java.base/java.util.concurrent.ForkJoinPool.runWorker(ForkJoinPool.java:1594)\r\n\tat java.base/java.util.concurrent.ForkJoinWorkerThread.run(ForkJoinWorkerThread.java:183)\r\nCaused by: java.lang.UnsupportedOperationException: Cannot get node id for RegularFileArtifactValue{digest=e58e4f6d4f57ab1e4a503a523d1c4e34ed03eee292a0237a898ac158c1b7bc69, size=1080, proxy=ctime of 1700240624111 and mtime of 499162500000 and nodeId of 2582129255}\r\n\tat com.google.devtools.build.lib.remote.RemoteActionFileSystem$2.getNodeId(RemoteActionFileSystem.java:634)\r\n\tat com.google.devtools.build.lib.vfs.DigestUtils$CacheKey.<init>(DigestUtils.java:67)\r\n\tat com.google.devtools.build.lib.vfs.DigestUtils.manuallyComputeDigest(DigestUtils.java:193)\r\n\tat com.google.devtools.build.lib.vfs.DigestUtils.getDigestWithManualFallback(DigestUtils.java:160)\r\n\tat com.google.devtools.build.lib.exec.SpawnLogContext.computeDigest(SpawnLogContext.java:348)\r\n\tat com.google.devtools.build.lib.exec.SpawnLogContext.listDirectoryContents(SpawnLogContext.java:296)\r\n\tat com.google.devtools.build.lib.exec.SpawnLogContext.logSpawn(SpawnLogContext.java:130)\r\n\tat com.google.devtools.build.lib.exec.AbstractSpawnStrategy.exec(AbstractSpawnStrategy.java:192)\r\n\tat com.google.devtools.build.lib.exec.AbstractSpawnStrategy.exec(AbstractSpawnStrategy.java:119)\r\n\tat com.google.devtools.build.lib.exec.SpawnStrategyResolver.exec(SpawnStrategyResolver.java:45)\r\n\tat com.google.devtools.build.lib.analysis.actions.SpawnAction.execute(SpawnAction.java:261)\r\n\tat com.google.devtools.build.lib.skyframe.SkyframeActionExecutor$ActionRunner.executeAction(SkyframeActionExecutor.java:1148)\r\n\tat com.google.devtools.build.lib.skyframe.SkyframeActionExecutor$ActionRunner.run(SkyframeActionExecutor.java:1065)\r\n\tat com.google.devtools.build.lib.skyframe.ActionExecutionState.runStateMachine(ActionExecutionState.java:165)\r\n\tat com.google.devtools.build.lib.skyframe.ActionExecutionState.getResultOrDependOnFuture(ActionExecutionState.java:94)\r\n\tat com.google.devtools.build.lib.skyframe.SkyframeActionExecutor.executeAction(SkyframeActionExecutor.java:562)\r\n\tat com.google.devtools.build.lib.skyframe.ActionExecutionFunction.checkCacheAndExecuteIfNeeded(ActionExecutionFunction.java:859)\r\n\tat com.google.devtools.build.lib.skyframe.ActionExecutionFunction.computeInternal(ActionExecutionFunction.java:333)\r\n\tat com.google.devtools.build.lib.skyframe.ActionExecutionFunction.compute(ActionExecutionFunction.java:171)\r\n\tat com.google.devtools.build.skyframe.AbstractParallelEvaluator$Evaluate.run(AbstractParallelEvaluator.java:461)\r\n```\r\n\r\nthe first error we can probably fix in the generator, but the internal error may point to some regression?\r\n\r\nThe internal error goes away if we don't use the `--execution_log_json_file` and `--noexecution_log_sort` flags.\n\n### Which category does this issue belong to?\n\n\nCore\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\nWe can't provide a minimal example, hit happens deep into the build of a very big monorepo.\n\n### Which operating system are you running Bazel on?\n\n\nMacOS Version 14.1\n\n### What is the output of `bazel info release`?\n\n\nrelease 7.0.0rc4\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\n_No response_\n\n### What's the output of `git remote get-url origin; git rev-parse master; git rev-parse HEAD` ?\n\n\n_No response_\n\n### Is this a regression? If yes, please try to identify the Bazel commit where the bug was introduced.\n\n\nYes, it is a regression.\n\n### Have you found anything relevant by searching the web?\n\n_No response_\n\n### Any other information, logs, or outputs that you want to share?\n\n_No response_","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/20246/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/20246/timeline","performed_via_github_app":null,"state_reason":"completed"}