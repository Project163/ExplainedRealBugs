[{"id":9047140716,"node_id":"LE_lADOATz7jc5j1kuNzwAAAAIbQGls","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9047140716","actor":{"login":"alexofortune","id":130081690,"node_id":"U_kgDOB8Djmg","avatar_url":"https://avatars.githubusercontent.com/u/130081690?v=4","gravatar_id":"","url":"https://api.github.com/users/alexofortune","html_url":"https://github.com/alexofortune","followers_url":"https://api.github.com/users/alexofortune/followers","following_url":"https://api.github.com/users/alexofortune/following{/other_user}","gists_url":"https://api.github.com/users/alexofortune/gists{/gist_id}","starred_url":"https://api.github.com/users/alexofortune/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexofortune/subscriptions","organizations_url":"https://api.github.com/users/alexofortune/orgs","repos_url":"https://api.github.com/users/alexofortune/repos","events_url":"https://api.github.com/users/alexofortune/events{/privacy}","received_events_url":"https://api.github.com/users/alexofortune/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-04-19T14:10:33Z","label":{"name":"type: bug","color":"0052cc"},"performed_via_github_app":null},{"id":9047140727,"node_id":"LE_lADOATz7jc5j1kuNzwAAAAIbQGl3","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9047140727","actor":{"login":"alexofortune","id":130081690,"node_id":"U_kgDOB8Djmg","avatar_url":"https://avatars.githubusercontent.com/u/130081690?v=4","gravatar_id":"","url":"https://api.github.com/users/alexofortune","html_url":"https://github.com/alexofortune","followers_url":"https://api.github.com/users/alexofortune/followers","following_url":"https://api.github.com/users/alexofortune/following{/other_user}","gists_url":"https://api.github.com/users/alexofortune/gists{/gist_id}","starred_url":"https://api.github.com/users/alexofortune/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexofortune/subscriptions","organizations_url":"https://api.github.com/users/alexofortune/orgs","repos_url":"https://api.github.com/users/alexofortune/repos","events_url":"https://api.github.com/users/alexofortune/events{/privacy}","received_events_url":"https://api.github.com/users/alexofortune/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-04-19T14:10:33Z","label":{"name":"untriaged","color":"c34ddd"},"performed_via_github_app":null},{"id":9047140825,"node_id":"AE_lADOATz7jc5j1kuNzwAAAAIbQGnZ","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9047140825","actor":{"login":"alexofortune","id":130081690,"node_id":"U_kgDOB8Djmg","avatar_url":"https://avatars.githubusercontent.com/u/130081690?v=4","gravatar_id":"","url":"https://api.github.com/users/alexofortune","html_url":"https://github.com/alexofortune","followers_url":"https://api.github.com/users/alexofortune/followers","following_url":"https://api.github.com/users/alexofortune/following{/other_user}","gists_url":"https://api.github.com/users/alexofortune/gists{/gist_id}","starred_url":"https://api.github.com/users/alexofortune/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexofortune/subscriptions","organizations_url":"https://api.github.com/users/alexofortune/orgs","repos_url":"https://api.github.com/users/alexofortune/repos","events_url":"https://api.github.com/users/alexofortune/events{/privacy}","received_events_url":"https://api.github.com/users/alexofortune/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2023-04-19T14:10:33Z","assignee":{"login":"ShreeM01","id":109167932,"node_id":"U_kgDOBoHFPA","avatar_url":"https://avatars.githubusercontent.com/u/109167932?v=4","gravatar_id":"","url":"https://api.github.com/users/ShreeM01","html_url":"https://github.com/ShreeM01","followers_url":"https://api.github.com/users/ShreeM01/followers","following_url":"https://api.github.com/users/ShreeM01/following{/other_user}","gists_url":"https://api.github.com/users/ShreeM01/gists{/gist_id}","starred_url":"https://api.github.com/users/ShreeM01/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ShreeM01/subscriptions","organizations_url":"https://api.github.com/users/ShreeM01/orgs","repos_url":"https://api.github.com/users/ShreeM01/repos","events_url":"https://api.github.com/users/ShreeM01/events{/privacy}","received_events_url":"https://api.github.com/users/ShreeM01/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":9047140889,"node_id":"AE_lADOATz7jc5j1kuNzwAAAAIbQGoZ","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9047140889","actor":{"login":"alexofortune","id":130081690,"node_id":"U_kgDOB8Djmg","avatar_url":"https://avatars.githubusercontent.com/u/130081690?v=4","gravatar_id":"","url":"https://api.github.com/users/alexofortune","html_url":"https://github.com/alexofortune","followers_url":"https://api.github.com/users/alexofortune/followers","following_url":"https://api.github.com/users/alexofortune/following{/other_user}","gists_url":"https://api.github.com/users/alexofortune/gists{/gist_id}","starred_url":"https://api.github.com/users/alexofortune/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexofortune/subscriptions","organizations_url":"https://api.github.com/users/alexofortune/orgs","repos_url":"https://api.github.com/users/alexofortune/repos","events_url":"https://api.github.com/users/alexofortune/events{/privacy}","received_events_url":"https://api.github.com/users/alexofortune/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2023-04-19T14:10:33Z","assignee":{"login":"sgowroji","id":48122892,"node_id":"MDQ6VXNlcjQ4MTIyODky","avatar_url":"https://avatars.githubusercontent.com/u/48122892?v=4","gravatar_id":"","url":"https://api.github.com/users/sgowroji","html_url":"https://github.com/sgowroji","followers_url":"https://api.github.com/users/sgowroji/followers","following_url":"https://api.github.com/users/sgowroji/following{/other_user}","gists_url":"https://api.github.com/users/sgowroji/gists{/gist_id}","starred_url":"https://api.github.com/users/sgowroji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgowroji/subscriptions","organizations_url":"https://api.github.com/users/sgowroji/orgs","repos_url":"https://api.github.com/users/sgowroji/repos","events_url":"https://api.github.com/users/sgowroji/events{/privacy}","received_events_url":"https://api.github.com/users/sgowroji/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":9047214121,"node_id":"LE_lADOATz7jc5j1kuNzwAAAAIbQYgp","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9047214121","actor":{"login":"meisterT","id":418721,"node_id":"MDQ6VXNlcjQxODcyMQ==","avatar_url":"https://avatars.githubusercontent.com/u/418721?v=4","gravatar_id":"","url":"https://api.github.com/users/meisterT","html_url":"https://github.com/meisterT","followers_url":"https://api.github.com/users/meisterT/followers","following_url":"https://api.github.com/users/meisterT/following{/other_user}","gists_url":"https://api.github.com/users/meisterT/gists{/gist_id}","starred_url":"https://api.github.com/users/meisterT/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meisterT/subscriptions","organizations_url":"https://api.github.com/users/meisterT/orgs","repos_url":"https://api.github.com/users/meisterT/repos","events_url":"https://api.github.com/users/meisterT/events{/privacy}","received_events_url":"https://api.github.com/users/meisterT/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-04-19T14:16:25Z","label":{"name":"team-Remote-Exec","color":"f1f442"},"performed_via_github_app":null},{"id":9047283666,"node_id":"UNE_lADOATz7jc5j1kuNzwAAAAIbQpfS","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9047283666","actor":{"login":"sgowroji","id":48122892,"node_id":"MDQ6VXNlcjQ4MTIyODky","avatar_url":"https://avatars.githubusercontent.com/u/48122892?v=4","gravatar_id":"","url":"https://api.github.com/users/sgowroji","html_url":"https://github.com/sgowroji","followers_url":"https://api.github.com/users/sgowroji/followers","following_url":"https://api.github.com/users/sgowroji/following{/other_user}","gists_url":"https://api.github.com/users/sgowroji/gists{/gist_id}","starred_url":"https://api.github.com/users/sgowroji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgowroji/subscriptions","organizations_url":"https://api.github.com/users/sgowroji/orgs","repos_url":"https://api.github.com/users/sgowroji/repos","events_url":"https://api.github.com/users/sgowroji/events{/privacy}","received_events_url":"https://api.github.com/users/sgowroji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unassigned","commit_id":null,"commit_url":null,"created_at":"2023-04-19T14:22:05Z","assignee":{"login":"sgowroji","id":48122892,"node_id":"MDQ6VXNlcjQ4MTIyODky","avatar_url":"https://avatars.githubusercontent.com/u/48122892?v=4","gravatar_id":"","url":"https://api.github.com/users/sgowroji","html_url":"https://github.com/sgowroji","followers_url":"https://api.github.com/users/sgowroji/followers","following_url":"https://api.github.com/users/sgowroji/following{/other_user}","gists_url":"https://api.github.com/users/sgowroji/gists{/gist_id}","starred_url":"https://api.github.com/users/sgowroji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgowroji/subscriptions","organizations_url":"https://api.github.com/users/sgowroji/orgs","repos_url":"https://api.github.com/users/sgowroji/repos","events_url":"https://api.github.com/users/sgowroji/events{/privacy}","received_events_url":"https://api.github.com/users/sgowroji/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":9047283674,"node_id":"UNE_lADOATz7jc5j1kuNzwAAAAIbQpfa","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9047283674","actor":{"login":"sgowroji","id":48122892,"node_id":"MDQ6VXNlcjQ4MTIyODky","avatar_url":"https://avatars.githubusercontent.com/u/48122892?v=4","gravatar_id":"","url":"https://api.github.com/users/sgowroji","html_url":"https://github.com/sgowroji","followers_url":"https://api.github.com/users/sgowroji/followers","following_url":"https://api.github.com/users/sgowroji/following{/other_user}","gists_url":"https://api.github.com/users/sgowroji/gists{/gist_id}","starred_url":"https://api.github.com/users/sgowroji/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sgowroji/subscriptions","organizations_url":"https://api.github.com/users/sgowroji/orgs","repos_url":"https://api.github.com/users/sgowroji/repos","events_url":"https://api.github.com/users/sgowroji/events{/privacy}","received_events_url":"https://api.github.com/users/sgowroji/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unassigned","commit_id":null,"commit_url":null,"created_at":"2023-04-19T14:22:05Z","assignee":{"login":"ShreeM01","id":109167932,"node_id":"U_kgDOBoHFPA","avatar_url":"https://avatars.githubusercontent.com/u/109167932?v=4","gravatar_id":"","url":"https://api.github.com/users/ShreeM01","html_url":"https://github.com/ShreeM01","followers_url":"https://api.github.com/users/ShreeM01/followers","following_url":"https://api.github.com/users/ShreeM01/following{/other_user}","gists_url":"https://api.github.com/users/ShreeM01/gists{/gist_id}","starred_url":"https://api.github.com/users/ShreeM01/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ShreeM01/subscriptions","organizations_url":"https://api.github.com/users/ShreeM01/orgs","repos_url":"https://api.github.com/users/ShreeM01/repos","events_url":"https://api.github.com/users/ShreeM01/events{/privacy}","received_events_url":"https://api.github.com/users/ShreeM01/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1514833831","html_url":"https://github.com/bazelbuild/bazel/issues/18145#issuecomment-1514833831","issue_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18145","id":1514833831,"node_id":"IC_kwDOATz7jc5aSoen","user":{"login":"tjgq","id":4370077,"node_id":"MDQ6VXNlcjQzNzAwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4370077?v=4","gravatar_id":"","url":"https://api.github.com/users/tjgq","html_url":"https://github.com/tjgq","followers_url":"https://api.github.com/users/tjgq/followers","following_url":"https://api.github.com/users/tjgq/following{/other_user}","gists_url":"https://api.github.com/users/tjgq/gists{/gist_id}","starred_url":"https://api.github.com/users/tjgq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjgq/subscriptions","organizations_url":"https://api.github.com/users/tjgq/orgs","repos_url":"https://api.github.com/users/tjgq/repos","events_url":"https://api.github.com/users/tjgq/events{/privacy}","received_events_url":"https://api.github.com/users/tjgq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-19T14:25:18Z","updated_at":"2023-04-19T14:25:18Z","body":"Can you share the full list of flags you're building with? (Feel free to redact out sensitive data like URLs, etc)\r\n\r\nOne thing that could help debug this would be to capture a heap histogram (`jmap -histo`) for the \"with bytes\" and \"without bytes\" scenarios and diff them to see where the extra allocations are coming from. I think this should be ok to share, since it would only contain the names of classes in the Bazel codebase, and nothing specific to your project?","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1514833831/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"tjgq","id":4370077,"node_id":"MDQ6VXNlcjQzNzAwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4370077?v=4","gravatar_id":"","url":"https://api.github.com/users/tjgq","html_url":"https://github.com/tjgq","followers_url":"https://api.github.com/users/tjgq/followers","following_url":"https://api.github.com/users/tjgq/following{/other_user}","gists_url":"https://api.github.com/users/tjgq/gists{/gist_id}","starred_url":"https://api.github.com/users/tjgq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjgq/subscriptions","organizations_url":"https://api.github.com/users/tjgq/orgs","repos_url":"https://api.github.com/users/tjgq/repos","events_url":"https://api.github.com/users/tjgq/events{/privacy}","received_events_url":"https://api.github.com/users/tjgq/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1514932011","html_url":"https://github.com/bazelbuild/bazel/issues/18145#issuecomment-1514932011","issue_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18145","id":1514932011,"node_id":"IC_kwDOATz7jc5aTAcr","user":{"login":"alexofortune","id":130081690,"node_id":"U_kgDOB8Djmg","avatar_url":"https://avatars.githubusercontent.com/u/130081690?v=4","gravatar_id":"","url":"https://api.github.com/users/alexofortune","html_url":"https://github.com/alexofortune","followers_url":"https://api.github.com/users/alexofortune/followers","following_url":"https://api.github.com/users/alexofortune/following{/other_user}","gists_url":"https://api.github.com/users/alexofortune/gists{/gist_id}","starred_url":"https://api.github.com/users/alexofortune/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexofortune/subscriptions","organizations_url":"https://api.github.com/users/alexofortune/orgs","repos_url":"https://api.github.com/users/alexofortune/repos","events_url":"https://api.github.com/users/alexofortune/events{/privacy}","received_events_url":"https://api.github.com/users/alexofortune/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-19T15:24:21Z","updated_at":"2023-04-20T08:17:15Z","body":"Hi @tjgq , yes, sure. Here are the flags, I redacted target names and URLs but I suppose that should be OK:\r\n\r\n```\r\nbuild --auto_cpu_environment_group=[redacted]\r\nbuild --crosstool_top=[redacted]\r\nbuild --platforms [redacted]\r\nbuild --host_platform [redacted]\r\nbuild --noincompatible_remove_legacy_whole_archive\r\nbuild --sandbox_base=/dev/shm\r\nbuild --experimental_strict_action_env\r\nbuild --jobs 32\r\nbuild --local_test_jobs 2\r\nbuild --noremote_allow_symlink_upload\r\nbuild --noremote_verify_downloads\r\nbuild --experimental_remote_merkle_tree_cache=true\r\nbuild --experimental_remote_merkle_tree_cache_size=10000\r\nbuild --disk_cache=[redacted]\r\nbuild --test_tmpdir=[redacted]\r\nbuild --incompatible_remote_results_ignore_disk\r\nbuild --remote_download_toplevel\r\nbuild --remote_upload_local_results=false\r\nbuild --remote_cache=[redacted, remote-cache-grpc-upstream url]\r\nbuild --test_tmpdir=/mnt/cache/bazel/test_tmpdir\r\n```\r\n\r\nEDIT:\r\n\r\nHere are the histograms.\r\n\r\nWithout BWOB:\r\n\r\n```\r\n  1:       5046563      443718888  [B (java.base@11.0.6)\r\n   2:       4748176      284030144  [Ljava.lang.Object; (java.base@11.0.6)\r\n   3:       3990750       95778000  java.lang.String (java.base@11.0.6)\r\n   4:       2692717       86166944  java.util.concurrent.ConcurrentHashMap$Node (java.base@11.0.6)\r\n   5:       2078356       83134240  com.google.common.collect.MapMakerInternalMap$WeakKeyDummyValueEntry\r\n   6:       1839395       73575800  com.google.devtools.build.skyframe.InMemoryNodeEntry\r\n   7:       2407414       38518624  com.google.devtools.build.lib.vfs.PathFragment$RelativePathFragment\r\n   8:       1479944       35518656  com.google.devtools.build.lib.collect.nestedset.NestedSet\r\n   9:       1143955       27454920  java.util.ArrayList (java.base@11.0.6)\r\n  10:           169       24973880  [Ljava.util.concurrent.ConcurrentHashMap$Node; (java.base@11.0.6)\r\n  11:        575593       23023720  java.util.LinkedHashMap$Entry (java.base@11.0.6)\r\n  12:        542849       21713960  com.google.devtools.build.lib.actions.FileContentsProxy\r\n  13:        880121       21122904  com.google.devtools.build.lib.vfs.RootedPath\r\n  14:        593551       18993632  com.google.devtools.build.lib.actions.Artifact$DerivedArtifact\r\n  15:       1091842       17469472  com.google.common.collect.RegularImmutableList\r\n  16:        527896       16892672  com.google.devtools.build.lib.actions.FileArtifactValue$RegularFileArtifactValue\r\n  17:        274841       15391096  com.google.devtools.build.lib.packages.Rule\r\n  18:        268540       15038240  java.util.LinkedHashMap (java.base@11.0.6)\r\n[...]\r\nTotal      45904234     1794130736\r\n```\r\n\r\nAnd for BWOB ( a bazel server that stopped responding, sometimes it crashes sometimes it stays in some \"zombie state\" ):\r\n\r\n```\r\n 1:      12763072      990879536  [B (java.base@11.0.6)\r\n   2:      16448840      895386536  [Ljava.lang.Object; (java.base@11.0.6)\r\n   3:       7860660      314426400  com.google.devtools.build.skyframe.InMemoryNodeEntry\r\n   4:       9688347      310027104  java.util.concurrent.ConcurrentHashMap$Node (java.base@11.0.6)\r\n   5:      10308844      247412256  java.lang.String (java.base@11.0.6)\r\n   6:       3173465      126938600  java.util.LinkedHashMap$Entry (java.base@11.0.6)\r\n   7:       4789560      114949440  java.util.ArrayList (java.base@11.0.6)\r\n   8:       4254406      102105744  com.google.devtools.build.lib.collect.nestedset.NestedSet\r\n   9:       6061622       96985952  com.google.devtools.build.lib.vfs.PathFragment$RelativePathFragment\r\n  10:       1707246       95605776  com.google.devtools.build.lib.packages.Rule\r\n  11:           488       91158512  [Ljava.util.concurrent.ConcurrentHashMap$Node; (java.base@11.0.6)\r\n  12:       2223180       88927200  com.google.common.collect.MapMakerInternalMap$WeakKeyDummyValueEntry\r\n  13:       1386372       77636832  java.util.LinkedHashMap (java.base@11.0.6)\r\n  14:       1441043       69969088  [Ljava.util.HashMap$Node; (java.base@11.0.6)\r\n  15:       2151420       68845440  java.util.HashMap$Node (java.base@11.0.6)\r\n  16:       1238280       59437440  com.google.common.collect.SingletonImmutableBiMap\r\n  17:       3643862       58301792  com.google.common.collect.RegularImmutableList\r\n  18:       1720587       55058784  com.google.devtools.build.lib.packages.CallStack$Node\r\n[...]\r\nTotal     143838308     5324807032\r\n```\r\n\r\nDifference seems quite dramatic, it's more than 3x. \r\n\r\nEDIT:\r\n\r\nTo make things clearer for debugging, here are the flags that were added to the BWOB box comparing to Non-BWOB box ( they're a subset of the flags posted above ):\r\n```\r\nbuild --disk_cache=[redacted]\r\nbuild --test_tmpdir=[redacted]\r\nbuild --incompatible_remote_results_ignore_disk\r\nbuild --remote_download_toplevel\r\nbuild --remote_upload_local_results=false\r\nbuild --remote_cache=[redacted, remote-cache-grpc-upstream url]\r\nbuild --test_tmpdir=/mnt/cache/bazel/test_tmpdir\r\n```\r\n\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1514932011/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"alexofortune","id":130081690,"node_id":"U_kgDOB8Djmg","avatar_url":"https://avatars.githubusercontent.com/u/130081690?v=4","gravatar_id":"","url":"https://api.github.com/users/alexofortune","html_url":"https://github.com/alexofortune","followers_url":"https://api.github.com/users/alexofortune/followers","following_url":"https://api.github.com/users/alexofortune/following{/other_user}","gists_url":"https://api.github.com/users/alexofortune/gists{/gist_id}","starred_url":"https://api.github.com/users/alexofortune/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexofortune/subscriptions","organizations_url":"https://api.github.com/users/alexofortune/orgs","repos_url":"https://api.github.com/users/alexofortune/repos","events_url":"https://api.github.com/users/alexofortune/events{/privacy}","received_events_url":"https://api.github.com/users/alexofortune/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":9047998647,"node_id":"MEE_lADOATz7jc5j1kuNzwAAAAIbTYC3","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9047998647","actor":{"login":"tjgq","id":4370077,"node_id":"MDQ6VXNlcjQzNzAwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4370077?v=4","gravatar_id":"","url":"https://api.github.com/users/tjgq","html_url":"https://github.com/tjgq","followers_url":"https://api.github.com/users/tjgq/followers","following_url":"https://api.github.com/users/tjgq/following{/other_user}","gists_url":"https://api.github.com/users/tjgq/gists{/gist_id}","starred_url":"https://api.github.com/users/tjgq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjgq/subscriptions","organizations_url":"https://api.github.com/users/tjgq/orgs","repos_url":"https://api.github.com/users/tjgq/repos","events_url":"https://api.github.com/users/tjgq/events{/privacy}","received_events_url":"https://api.github.com/users/tjgq/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-04-19T15:24:21Z","performed_via_github_app":null},{"id":9047998661,"node_id":"SE_lADOATz7jc5j1kuNzwAAAAIbTYDF","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9047998661","actor":{"login":"tjgq","id":4370077,"node_id":"MDQ6VXNlcjQzNzAwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4370077?v=4","gravatar_id":"","url":"https://api.github.com/users/tjgq","html_url":"https://github.com/tjgq","followers_url":"https://api.github.com/users/tjgq/followers","following_url":"https://api.github.com/users/tjgq/following{/other_user}","gists_url":"https://api.github.com/users/tjgq/gists{/gist_id}","starred_url":"https://api.github.com/users/tjgq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjgq/subscriptions","organizations_url":"https://api.github.com/users/tjgq/orgs","repos_url":"https://api.github.com/users/tjgq/repos","events_url":"https://api.github.com/users/tjgq/events{/privacy}","received_events_url":"https://api.github.com/users/tjgq/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-04-19T15:24:21Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1516332356","html_url":"https://github.com/bazelbuild/bazel/issues/18145#issuecomment-1516332356","issue_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18145","id":1516332356,"node_id":"IC_kwDOATz7jc5aYWVE","user":{"login":"alexofortune","id":130081690,"node_id":"U_kgDOB8Djmg","avatar_url":"https://avatars.githubusercontent.com/u/130081690?v=4","gravatar_id":"","url":"https://api.github.com/users/alexofortune","html_url":"https://github.com/alexofortune","followers_url":"https://api.github.com/users/alexofortune/followers","following_url":"https://api.github.com/users/alexofortune/following{/other_user}","gists_url":"https://api.github.com/users/alexofortune/gists{/gist_id}","starred_url":"https://api.github.com/users/alexofortune/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexofortune/subscriptions","organizations_url":"https://api.github.com/users/alexofortune/orgs","repos_url":"https://api.github.com/users/alexofortune/repos","events_url":"https://api.github.com/users/alexofortune/events{/privacy}","received_events_url":"https://api.github.com/users/alexofortune/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-20T13:28:54Z","updated_at":"2023-04-20T13:28:54Z","body":"The plot thickens.\r\n\r\nI took three heap dumps:\r\n\r\n* Heap Dump from non-BWOB server, after build ( resting state )\r\n* Heap Dump from BWOB server after build ( resting state ). I forgot to mention BWOB doesn't crash consistently 100% of the time\r\n* Heap Dump after OOM on BWOB server.\r\n\r\nHeap Dump from BWOB server after build vs Heap dump taken off a resting Bazel server post non-BWOB build is like 3x in difference.\r\nAnd what's more - dominator tree in Memory Analyzer ( shows biggest objects and their connections to GC roots ) looks basically the same in the resting bazel server post BWOB build and the one that crashed with OOM during BWOB build. The tree looks completely different on non-BWOB resting bazel heapdump ( no mention of \"cli-update-thread\" at all, the majority is a single memoizing evaluator that is pointed to by SequencedSkyframeExecutor which is rooted in main Thread )\r\n\r\nFor me, that looks like a memory leak that eventually leads to memory pressure that bazel server is unable to handle, but if there's any other ideas you have, lemme know!","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1516332356/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"alexofortune","id":130081690,"node_id":"U_kgDOB8Djmg","avatar_url":"https://avatars.githubusercontent.com/u/130081690?v=4","gravatar_id":"","url":"https://api.github.com/users/alexofortune","html_url":"https://github.com/alexofortune","followers_url":"https://api.github.com/users/alexofortune/followers","following_url":"https://api.github.com/users/alexofortune/following{/other_user}","gists_url":"https://api.github.com/users/alexofortune/gists{/gist_id}","starred_url":"https://api.github.com/users/alexofortune/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexofortune/subscriptions","organizations_url":"https://api.github.com/users/alexofortune/orgs","repos_url":"https://api.github.com/users/alexofortune/repos","events_url":"https://api.github.com/users/alexofortune/events{/privacy}","received_events_url":"https://api.github.com/users/alexofortune/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1516809472","html_url":"https://github.com/bazelbuild/bazel/issues/18145#issuecomment-1516809472","issue_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18145","id":1516809472,"node_id":"IC_kwDOATz7jc5aaK0A","user":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-20T19:04:31Z","updated_at":"2023-04-20T19:04:31Z","body":"`cli-update-thread`s, created by `UiEventHandler`, are used to handle UI related events.\r\n\r\nFor BwoB specifically, it might be https://github.com/bazelbuild/bazel/pull/17604 where Bazel sends download progress to the UI. It keeps some [state for each active download](https://cs.opensource.google/bazel/bazel/+/master:src/main/java/com/google/devtools/build/lib/runtime/UiStateTracker.java;l=354;drc=1751ac1fe2749c8f9a4b2c80bdd202dda6425d35).\r\n\r\n In your case, I guess there are many active downloads which causes OOM. Can you try with a patched Bazel that comments out function [`downloadProgress`](https://cs.opensource.google/bazel/bazel/+/refs/heads/master:src/main/java/com/google/devtools/build/lib/runtime/UiEventHandler.java;l=672;drc=7fb50baaa00f92c6f009dcf1684427fc8fa1f301) to see whether the OOM still happens?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1516809472/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1516953670","html_url":"https://github.com/bazelbuild/bazel/issues/18145#issuecomment-1516953670","issue_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18145","id":1516953670,"node_id":"IC_kwDOATz7jc5aauBG","user":{"login":"alexofortune","id":130081690,"node_id":"U_kgDOB8Djmg","avatar_url":"https://avatars.githubusercontent.com/u/130081690?v=4","gravatar_id":"","url":"https://api.github.com/users/alexofortune","html_url":"https://github.com/alexofortune","followers_url":"https://api.github.com/users/alexofortune/followers","following_url":"https://api.github.com/users/alexofortune/following{/other_user}","gists_url":"https://api.github.com/users/alexofortune/gists{/gist_id}","starred_url":"https://api.github.com/users/alexofortune/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexofortune/subscriptions","organizations_url":"https://api.github.com/users/alexofortune/orgs","repos_url":"https://api.github.com/users/alexofortune/repos","events_url":"https://api.github.com/users/alexofortune/events{/privacy}","received_events_url":"https://api.github.com/users/alexofortune/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-20T21:11:20Z","updated_at":"2023-04-20T21:12:26Z","body":"@coeuvre I tracked this even further, you're pointing to the right thing, but I still believe Bazel is defective here - In fact, I believe there is at least one , and might be two bugs at play here. Brace yourself, there's a lot of text :)\r\n\r\n**Bug #1:**\r\n\r\nI looked more into the heap dumps - it seems UIStateTracker that is owned by UIEventHandler does have a non-zero-size \"runningDownloads\" deque. Fortunately, this class also hosts a \"downloads\" TreeMap which points to the latest event for the given URL. And the instances of this event are of instance type DownloadProgress and it matches perfectly to the fact that these are dispatched to be observed **only** if download is done with Priority.LOW. And guess what - this is done by ToplevelArtifactsDownloader , which is created only when we use BWOB!\r\n\r\nSee:\r\nhttps://sourcegraph.com/github.com/bazelbuild/bazel/-/blob/src/main/java/com/google/devtools/build/lib/remote/RemoteModule.java?L975 ( Toplevel downloader created only if we do not download all outputs )\r\nhttps://sourcegraph.com/github.com/bazelbuild/bazel/-/blob/src/main/java/com/google/devtools/build/lib/remote/RemoteActionInputFetcher.java?L99 ( Only Priority.LOW downloads are dispatching events eventually listened to by the UIEventHandler )\r\n\r\nNow, the interesting bit: Remember the tree i mentioned above? The last progress message is empty. And there's only one moment when progress message can be empty - when a download is started. See this code:\r\n\r\nhttps://sourcegraph.com/github.com/bazelbuild/bazel/-/blob/src/main/java/com/google/devtools/build/lib/remote/RemoteCache.java?L286\r\n\r\nQuick read will tell you that it only returns an empty progress message if  includeBytes = false and finished = false. And this combination is called only in started(), here:\r\n\r\nhttps://sourcegraph.com/github.com/bazelbuild/bazel/-/blob/src/main/java/com/google/devtools/build/lib/remote/RemoteCache.java?L273\r\n\r\nThe logical conclusion is - we got the \"started\" event but never got to listen on finished() event which would remove entries from UI tracking downloads and ultimately allow shutting down UI thread.\r\n\r\nNow, where all this machinery is called - see here:\r\n\r\nhttps://sourcegraph.com/github.com/bazelbuild/bazel/-/blob/src/main/java/com/google/devtools/build/lib/remote/RemoteCache.java?L374\r\n\r\nIt calls started(), and then attaches a listener that calls finished() when blob is downloaded. My guess is that either this listener does not fire, or `out.close();` throws an IOException and finished() never runs. I believe in my case it's \"listener never fires\" situation, as i didn't see the exception logged in my log ( but this probably should be fixed regardless ).\r\n\r\nClosing thought - we should look into why potentially this listener wouldn't run. On my end, I'll compile Bazel tomorrow with some logging and see if it indeed does not run ( or if it runs but out.close() throws an exception ).\r\n\r\n**Bug nr #2:**\r\n\r\nThis is in relation to how UIEventHandler eventually stops the updating thread. UIEventThread has `stopUpdateThread()` which will stop the thread. For this to happen, several conditions have to happen - during various events, `stateTracker.hasActivities()` is called ( either directly or via a helper method `checkActivities()` on the class ) to re-check for these conditions when some of this state is changed.. \r\n\r\nHasActivities looks like this:\r\n\r\n```\r\n  synchronized boolean hasActivities() {\r\n    return !(buildCompleted()\r\n        && bepOpenTransports.isEmpty()\r\n        && activeActionUploads.get() == 0\r\n        && activeActionDownloads.get() == 0 // this variable is dead and always zero btw \r\n        && runningDownloads.isEmpty());\r\n  }\r\n```\r\n\r\nNow, when those things change, events are being listened on and checking is re-done in UIEventHandler to ensure that in case of a new state, we can stop the UI update thread.\r\n\r\nFor example:\r\n\r\nhttps://sourcegraph.com/github.com/bazelbuild/bazel/-/blob/src/main/java/com/google/devtools/build/lib/runtime/UiEventHandler.java?L583 ( BuildCompletedEvent )\r\n\r\nhttps://sourcegraph.com/github.com/bazelbuild/bazel/-/blob/src/main/java/com/google/devtools/build/lib/runtime/UiEventHandler.java?L760 ( ActionUploadFinishedEvent )\r\n\r\nHowever, for the event that updates the downloads:\r\n\r\nhttps://sourcegraph.com/github.com/bazelbuild/bazel/-/blob/src/main/java/com/google/devtools/build/lib/runtime/UiEventHandler.java?L672\r\n\r\nWe don't seem to call `checkActivities()` or `stateTracker.hasActivities()` anywhere in this method, so, even if we dropped downloads back to zero, it seems that if these events came last and none of above wuould come after it, we'd never re-check the state and never shut down the UI thread.\r\n\r\nThis also matches my observations - one of the leaked cli-update-threads indeed had an empty `runningDownloads` deque, yet it was still leaking, so my guess is this is what happened.\r\n\r\nOn my end, I'll compile Bazel tomorrow with the downloadProgress commented out ( just like you said ) , which should help with the leaking. I'll report tomorrow whether it works.\r\n\r\n\r\n\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1516953670/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"alexofortune","id":130081690,"node_id":"U_kgDOB8Djmg","avatar_url":"https://avatars.githubusercontent.com/u/130081690?v=4","gravatar_id":"","url":"https://api.github.com/users/alexofortune","html_url":"https://github.com/alexofortune","followers_url":"https://api.github.com/users/alexofortune/followers","following_url":"https://api.github.com/users/alexofortune/following{/other_user}","gists_url":"https://api.github.com/users/alexofortune/gists{/gist_id}","starred_url":"https://api.github.com/users/alexofortune/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexofortune/subscriptions","organizations_url":"https://api.github.com/users/alexofortune/orgs","repos_url":"https://api.github.com/users/alexofortune/repos","events_url":"https://api.github.com/users/alexofortune/events{/privacy}","received_events_url":"https://api.github.com/users/alexofortune/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":9061612013,"node_id":"MEE_lADOATz7jc5j1kuNzwAAAAIcHTnt","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9061612013","actor":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-04-20T21:11:21Z","performed_via_github_app":null},{"id":9061612026,"node_id":"SE_lADOATz7jc5j1kuNzwAAAAIcHTn6","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9061612026","actor":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-04-20T21:11:21Z","performed_via_github_app":null},{"id":9090016161,"node_id":"AE_lADOATz7jc5j1kuNzwAAAAIdzqOh","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9090016161","actor":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2023-04-25T09:18:14Z","assignee":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"id":9090017145,"node_id":"UNLE_lADOATz7jc5j1kuNzwAAAAIdzqd5","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9090017145","actor":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2023-04-25T09:18:21Z","label":{"name":"untriaged","color":"c34ddd"},"performed_via_github_app":null},{"id":9090017150,"node_id":"LE_lADOATz7jc5j1kuNzwAAAAIdzqd-","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9090017150","actor":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2023-04-25T09:18:21Z","label":{"name":"P2","color":"e99695"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1524005540","html_url":"https://github.com/bazelbuild/bazel/issues/18145#issuecomment-1524005540","issue_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18145","id":1524005540,"node_id":"IC_kwDOATz7jc5a1nqk","user":{"login":"alexofortune","id":130081690,"node_id":"U_kgDOB8Djmg","avatar_url":"https://avatars.githubusercontent.com/u/130081690?v=4","gravatar_id":"","url":"https://api.github.com/users/alexofortune","html_url":"https://github.com/alexofortune","followers_url":"https://api.github.com/users/alexofortune/followers","following_url":"https://api.github.com/users/alexofortune/following{/other_user}","gists_url":"https://api.github.com/users/alexofortune/gists{/gist_id}","starred_url":"https://api.github.com/users/alexofortune/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexofortune/subscriptions","organizations_url":"https://api.github.com/users/alexofortune/orgs","repos_url":"https://api.github.com/users/alexofortune/repos","events_url":"https://api.github.com/users/alexofortune/events{/privacy}","received_events_url":"https://api.github.com/users/alexofortune/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-26T20:28:36Z","updated_at":"2023-04-26T20:28:36Z","body":"Hi there,\r\n\r\nSorry, busy days & didn't have time to work on this. I'd like to report that patching out the event handler in UI tracker indeed helped with the memory leak - we don't see our bazel server crashing anymore.\r\n\r\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1524005540/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"alexofortune","id":130081690,"node_id":"U_kgDOB8Djmg","avatar_url":"https://avatars.githubusercontent.com/u/130081690?v=4","gravatar_id":"","url":"https://api.github.com/users/alexofortune","html_url":"https://github.com/alexofortune","followers_url":"https://api.github.com/users/alexofortune/followers","following_url":"https://api.github.com/users/alexofortune/following{/other_user}","gists_url":"https://api.github.com/users/alexofortune/gists{/gist_id}","starred_url":"https://api.github.com/users/alexofortune/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexofortune/subscriptions","organizations_url":"https://api.github.com/users/alexofortune/orgs","repos_url":"https://api.github.com/users/alexofortune/repos","events_url":"https://api.github.com/users/alexofortune/events{/privacy}","received_events_url":"https://api.github.com/users/alexofortune/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1525091080","html_url":"https://github.com/bazelbuild/bazel/issues/18145#issuecomment-1525091080","issue_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18145","id":1525091080,"node_id":"IC_kwDOATz7jc5a5wsI","user":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-27T08:20:35Z","updated_at":"2023-04-27T08:20:35Z","body":"Thanks for confirming! I will work on the fix soon.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1525091080/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1540772345","html_url":"https://github.com/bazelbuild/bazel/issues/18145#issuecomment-1540772345","issue_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18145","id":1540772345,"node_id":"IC_kwDOATz7jc5b1lH5","user":{"login":"jacobmou","id":54453872,"node_id":"MDQ6VXNlcjU0NDUzODcy","avatar_url":"https://avatars.githubusercontent.com/u/54453872?v=4","gravatar_id":"","url":"https://api.github.com/users/jacobmou","html_url":"https://github.com/jacobmou","followers_url":"https://api.github.com/users/jacobmou/followers","following_url":"https://api.github.com/users/jacobmou/following{/other_user}","gists_url":"https://api.github.com/users/jacobmou/gists{/gist_id}","starred_url":"https://api.github.com/users/jacobmou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jacobmou/subscriptions","organizations_url":"https://api.github.com/users/jacobmou/orgs","repos_url":"https://api.github.com/users/jacobmou/repos","events_url":"https://api.github.com/users/jacobmou/events{/privacy}","received_events_url":"https://api.github.com/users/jacobmou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-05-09T19:28:16Z","updated_at":"2023-05-10T20:43:31Z","body":"@coeuvre Do we have a formal fix for the issue so far or still just comment out https://sourcegraph.com/github.com/bazelbuild/bazel/-/blob/src/main/java/com/google/devtools/build/lib/runtime/UiEventHandler.java?L672?\r\ni was trying to upgrade to bazel 6.1.1 and would hope to leverage builds without the bytes.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1540772345/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"jacobmou","id":54453872,"node_id":"MDQ6VXNlcjU0NDUzODcy","avatar_url":"https://avatars.githubusercontent.com/u/54453872?v=4","gravatar_id":"","url":"https://api.github.com/users/jacobmou","html_url":"https://github.com/jacobmou","followers_url":"https://api.github.com/users/jacobmou/followers","following_url":"https://api.github.com/users/jacobmou/following{/other_user}","gists_url":"https://api.github.com/users/jacobmou/gists{/gist_id}","starred_url":"https://api.github.com/users/jacobmou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jacobmou/subscriptions","organizations_url":"https://api.github.com/users/jacobmou/orgs","repos_url":"https://api.github.com/users/jacobmou/repos","events_url":"https://api.github.com/users/jacobmou/events{/privacy}","received_events_url":"https://api.github.com/users/jacobmou/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":9215410132,"node_id":"MEE_lADOATz7jc5j1kuNzwAAAAIlR__U","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9215410132","actor":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2023-05-10T20:43:31Z","performed_via_github_app":null},{"id":9215410134,"node_id":"SE_lADOATz7jc5j1kuNzwAAAAIlR__W","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9215410134","actor":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2023-05-10T20:43:31Z","performed_via_github_app":null},{"actor":{"login":"joeljeske","id":5332920,"node_id":"MDQ6VXNlcjUzMzI5MjA=","avatar_url":"https://avatars.githubusercontent.com/u/5332920?v=4","gravatar_id":"","url":"https://api.github.com/users/joeljeske","html_url":"https://github.com/joeljeske","followers_url":"https://api.github.com/users/joeljeske/followers","following_url":"https://api.github.com/users/joeljeske/following{/other_user}","gists_url":"https://api.github.com/users/joeljeske/gists{/gist_id}","starred_url":"https://api.github.com/users/joeljeske/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joeljeske/subscriptions","organizations_url":"https://api.github.com/users/joeljeske/orgs","repos_url":"https://api.github.com/users/joeljeske/repos","events_url":"https://api.github.com/users/joeljeske/events{/privacy}","received_events_url":"https://api.github.com/users/joeljeske/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-05-23T23:37:01Z","updated_at":"2023-05-23T23:37:01Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/16913","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/16913/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/16913/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/16913/events","html_url":"https://github.com/bazelbuild/bazel/issues/16913","id":1474157110,"node_id":"I_kwDOATz7jc5X3do2","number":16913,"title":"Running a big build on Remote execution causes Bazel to OOM","user":{"login":"BalestraPatrick","id":3658887,"node_id":"MDQ6VXNlcjM2NTg4ODc=","avatar_url":"https://avatars.githubusercontent.com/u/3658887?v=4","gravatar_id":"","url":"https://api.github.com/users/BalestraPatrick","html_url":"https://github.com/BalestraPatrick","followers_url":"https://api.github.com/users/BalestraPatrick/followers","following_url":"https://api.github.com/users/BalestraPatrick/following{/other_user}","gists_url":"https://api.github.com/users/BalestraPatrick/gists{/gist_id}","starred_url":"https://api.github.com/users/BalestraPatrick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BalestraPatrick/subscriptions","organizations_url":"https://api.github.com/users/BalestraPatrick/orgs","repos_url":"https://api.github.com/users/BalestraPatrick/repos","events_url":"https://api.github.com/users/BalestraPatrick/events{/privacy}","received_events_url":"https://api.github.com/users/BalestraPatrick/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":192364170,"node_id":"MDU6TGFiZWwxOTIzNjQxNzA=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P2","name":"P2","color":"e99695","default":false,"description":"We'll consider working on this in future. (Assignee optional)"},{"id":1193207358,"node_id":"MDU6TGFiZWwxMTkzMjA3MzU4","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Remote-Exec","name":"team-Remote-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Remote) team"}],"state":"closed","locked":false,"assignee":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":18,"created_at":"2022-12-03T17:04:54Z","updated_at":"2024-08-29T12:46:03Z","closed_at":"2024-08-29T12:46:02Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":20773773,"node_id":"MDEwOlJlcG9zaXRvcnkyMDc3Mzc3Mw==","name":"bazel","full_name":"bazelbuild/bazel","private":false,"owner":{"login":"bazelbuild","id":11684617,"node_id":"MDEyOk9yZ2FuaXphdGlvbjExNjg0NjE3","avatar_url":"https://avatars.githubusercontent.com/u/11684617?v=4","gravatar_id":"","url":"https://api.github.com/users/bazelbuild","html_url":"https://github.com/bazelbuild","followers_url":"https://api.github.com/users/bazelbuild/followers","following_url":"https://api.github.com/users/bazelbuild/following{/other_user}","gists_url":"https://api.github.com/users/bazelbuild/gists{/gist_id}","starred_url":"https://api.github.com/users/bazelbuild/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bazelbuild/subscriptions","organizations_url":"https://api.github.com/users/bazelbuild/orgs","repos_url":"https://api.github.com/users/bazelbuild/repos","events_url":"https://api.github.com/users/bazelbuild/events{/privacy}","received_events_url":"https://api.github.com/users/bazelbuild/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/bazelbuild/bazel","description":"a fast, scalable, multi-language and extensible build system","fork":false,"url":"https://api.github.com/repos/bazelbuild/bazel","forks_url":"https://api.github.com/repos/bazelbuild/bazel/forks","keys_url":"https://api.github.com/repos/bazelbuild/bazel/keys{/key_id}","collaborators_url":"https://api.github.com/repos/bazelbuild/bazel/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/bazelbuild/bazel/teams","hooks_url":"https://api.github.com/repos/bazelbuild/bazel/hooks","issue_events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/events{/number}","events_url":"https://api.github.com/repos/bazelbuild/bazel/events","assignees_url":"https://api.github.com/repos/bazelbuild/bazel/assignees{/user}","branches_url":"https://api.github.com/repos/bazelbuild/bazel/branches{/branch}","tags_url":"https://api.github.com/repos/bazelbuild/bazel/tags","blobs_url":"https://api.github.com/repos/bazelbuild/bazel/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/bazelbuild/bazel/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/bazelbuild/bazel/git/refs{/sha}","trees_url":"https://api.github.com/repos/bazelbuild/bazel/git/trees{/sha}","statuses_url":"https://api.github.com/repos/bazelbuild/bazel/statuses/{sha}","languages_url":"https://api.github.com/repos/bazelbuild/bazel/languages","stargazers_url":"https://api.github.com/repos/bazelbuild/bazel/stargazers","contributors_url":"https://api.github.com/repos/bazelbuild/bazel/contributors","subscribers_url":"https://api.github.com/repos/bazelbuild/bazel/subscribers","subscription_url":"https://api.github.com/repos/bazelbuild/bazel/subscription","commits_url":"https://api.github.com/repos/bazelbuild/bazel/commits{/sha}","git_commits_url":"https://api.github.com/repos/bazelbuild/bazel/git/commits{/sha}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/comments{/number}","issue_comment_url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments{/number}","contents_url":"https://api.github.com/repos/bazelbuild/bazel/contents/{+path}","compare_url":"https://api.github.com/repos/bazelbuild/bazel/compare/{base}...{head}","merges_url":"https://api.github.com/repos/bazelbuild/bazel/merges","archive_url":"https://api.github.com/repos/bazelbuild/bazel/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/bazelbuild/bazel/downloads","issues_url":"https://api.github.com/repos/bazelbuild/bazel/issues{/number}","pulls_url":"https://api.github.com/repos/bazelbuild/bazel/pulls{/number}","milestones_url":"https://api.github.com/repos/bazelbuild/bazel/milestones{/number}","notifications_url":"https://api.github.com/repos/bazelbuild/bazel/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/bazelbuild/bazel/labels{/name}","releases_url":"https://api.github.com/repos/bazelbuild/bazel/releases{/id}","deployments_url":"https://api.github.com/repos/bazelbuild/bazel/deployments","created_at":"2014-06-12T16:00:38Z","updated_at":"2025-11-10T01:33:52Z","pushed_at":"2025-11-08T01:50:45Z","git_url":"git://github.com/bazelbuild/bazel.git","ssh_url":"git@github.com:bazelbuild/bazel.git","clone_url":"https://github.com/bazelbuild/bazel.git","svn_url":"https://github.com/bazelbuild/bazel","homepage":"https://bazel.build","size":990573,"stargazers_count":24742,"watchers_count":24742,"language":"Java","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":4332,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1832,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["bazel","build","build-system","correct","fast","multi-language","scalable","test"],"visibility":"public","forks":4332,"open_issues":1832,"watchers":24742,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"### Description of the bug:\r\n\r\n\r\nBazel throws `FATAL: bazel ran out of memory and crashed.` when running our build (Swift, Objective-C, C++) on remote execution. I can see the Bazel process using up to 65GB+ of RAM. I ran the build with `--heap_dump_on_oom` and I can reproduce it consistently when running a full clean build on remote execution. If I try again the build, I can get it to complete after 2-3 OOM exceptions.\r\n\r\nThe full stacktrace is the following:\r\n```\r\nFATAL: bazel ran out of memory and crashed. An attempt will be made to write a heap dump to /private/var/tmp/me/9c146a5e97098b318f66f519df2b642d/a886b233-ed1b-4a65-b703-1a9ac9a64c3d.heapdump.hprof. Printing stack trace:\r\njava.lang.OutOfMemoryError: Java heap space\r\n    at java.base/jdk.internal.misc.Unsafe.allocateUninitializedArray(Unknown Source)\r\n    at java.base/java.lang.invoke.StringConcatFactory$MethodHandleInlineCopyStrategy.newArray(Unknown Source)\r\n    at java.base/java.lang.invoke.DirectMethodHandle$Holder.invokeStatic(Unknown Source)\r\n    at java.base/java.lang.invoke.LambdaForm$MH/0x00000008000c2c40.invoke(LambdaForm$MH)\r\n    at java.base/java.lang.invoke.DelegatingMethodHandle$Holder.reinvoke_L(Unknown Source)\r\n    at java.base/java.lang.invoke.LambdaForm$MH/0x00000008000c2040.linkToTargetMethod(LambdaForm$MH)\r\n    at com.google.devtools.build.lib.vfs.PathFragment.getRelative(PathFragment.java:229)\r\n    at com.google.devtools.build.lib.vfs.PathFragment.getRelative(PathFragment.java:196)\r\n    at com.google.devtools.build.lib.vfs.Path.getRelative(Path.java:114)\r\n    at com.google.devtools.build.lib.vfs.Root$PathRoot.getRelative(Root.java:92)\r\n    at com.google.devtools.build.lib.actions.Artifact.getPath(Artifact.java:545)\r\n    at com.google.devtools.build.lib.actions.ActionInputHelper.toInputPath(ActionInputHelper.java:174)\r\n    at com.google.devtools.build.lib.remote.merkletree.DirectoryTreeBuilder.lambda$buildFromActionInputs$1(DirectoryTreeBuilder.java:167)\r\n    at com.google.devtools.build.lib.remote.merkletree.DirectoryTreeBuilder$$Lambda$1106/0x000000080098d440.visit(Unknown Source)\r\n    at com.google.devtools.build.lib.remote.merkletree.DirectoryTreeBuilder.build(DirectoryTreeBuilder.java:252)\r\n    at com.google.devtools.build.lib.remote.merkletree.DirectoryTreeBuilder.buildFromActionInputs(DirectoryTreeBuilder.java:141)\r\n    at com.google.devtools.build.lib.remote.merkletree.DirectoryTreeBuilder.fromActionInputs(DirectoryTreeBuilder.java:78)\r\n    at com.google.devtools.build.lib.remote.merkletree.MerkleTree.build(MerkleTree.java:254)\r\n    at com.google.devtools.build.lib.remote.RemoteExecutionService.buildInputMerkleTree(RemoteExecutionService.java:389)\r\n    at com.google.devtools.build.lib.remote.RemoteExecutionService.buildRemoteAction(RemoteExecutionService.java:448)\r\n    at com.google.devtools.build.lib.remote.RemoteSpawnRunner.exec(RemoteSpawnRunner.java:189)\r\n    at com.google.devtools.build.lib.exec.SpawnRunner.execAsync(SpawnRunner.java:299)\r\n    at com.google.devtools.build.lib.exec.AbstractSpawnStrategy.exec(AbstractSpawnStrategy.java:152)\r\n    at com.google.devtools.build.lib.exec.AbstractSpawnStrategy.exec(AbstractSpawnStrategy.java:112)\r\n    at com.google.devtools.build.lib.actions.SpawnStrategy.beginExecution(SpawnStrategy.java:47)\r\n    at com.google.devtools.build.lib.exec.SpawnStrategyResolver.beginExecution(SpawnStrategyResolver.java:64)\r\n    at com.google.devtools.build.lib.rules.cpp.CppCompileAction.beginExecution(CppCompileAction.java:1509)\r\n    at com.google.devtools.build.lib.actions.Action.execute(Action.java:133)\r\n    at com.google.devtools.build.lib.skyframe.SkyframeActionExecutor$5.execute(SkyframeActionExecutor.java:936)\r\n    at com.google.devtools.build.lib.skyframe.SkyframeActionExecutor$ActionRunner.continueAction(SkyframeActionExecutor.java:1103)\r\n    at com.google.devtools.build.lib.skyframe.SkyframeActionExecutor$ActionRunner.run(SkyframeActionExecutor.java:1061)\r\n    at com.google.devtools.build.lib.skyframe.ActionExecutionState.runStateMachine(ActionExecutionState.java:160)\r\n```\r\n\r\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\r\n\r\n\r\nBuild a big codebase on remote execution. Unfortunately I can't provide an example at the moment, but a full clean build is about 15K actions executed remotely (plus some locally as well of course).\r\n\r\n### Which operating system are you running Bazel on?\r\n\r\n\r\nmacOS 13.0\r\n\r\n### What is the output of `bazel info release`?\r\n\r\n\r\n6.0.0rc2\r\n\r\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\r\n\r\n\r\n_No response_\r\n\r\n### What's the output of `git remote get-url origin; git rev-parse master; git rev-parse HEAD` ?\r\n\r\n\r\n_No response_\r\n\r\n### Have you found anything relevant by searching the web?\r\n\r\n_No response_\r\n\r\n### Any other information, logs, or outputs that you want to share?\r\n\r\nSomething interesting is that passing `--experimental_remote_merkle_tree_cache` seems to workaround the issue.","reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/16913/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/16913/timeline","performed_via_github_app":null,"state_reason":"not_planned"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1578590879","html_url":"https://github.com/bazelbuild/bazel/issues/18145#issuecomment-1578590879","issue_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18145","id":1578590879,"node_id":"IC_kwDOATz7jc5eF2Kf","user":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-06T11:47:11Z","updated_at":"2023-06-06T11:47:11Z","body":"I believe this is fixed in Bazel HEAD due to other changes. Let me try to work out a dedicated fix for 6.3.0.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments/1578590879/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-06T15:23:35Z","updated_at":"2023-06-06T15:23:35Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/18593","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18593/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18593/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18593/events","html_url":"https://github.com/bazelbuild/bazel/pull/18593","id":1744099779,"node_id":"PR_kwDOATz7jc5SUXiU","number":18593,"title":"Fix potential memory leak in UI","user":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1193207358,"node_id":"MDU6TGFiZWwxMTkzMjA3MzU4","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Remote-Exec","name":"team-Remote-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Remote) team"},{"id":4761872548,"node_id":"LA_kwDOATz7jc8AAAABG9RopA","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-CLI","name":"team-CLI","color":"f1f442","default":false,"description":"Console UI"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2023-06-06T15:23:34Z","updated_at":"2023-06-13T18:05:09Z","closed_at":"2023-06-13T11:41:20Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":20773773,"node_id":"MDEwOlJlcG9zaXRvcnkyMDc3Mzc3Mw==","name":"bazel","full_name":"bazelbuild/bazel","private":false,"owner":{"login":"bazelbuild","id":11684617,"node_id":"MDEyOk9yZ2FuaXphdGlvbjExNjg0NjE3","avatar_url":"https://avatars.githubusercontent.com/u/11684617?v=4","gravatar_id":"","url":"https://api.github.com/users/bazelbuild","html_url":"https://github.com/bazelbuild","followers_url":"https://api.github.com/users/bazelbuild/followers","following_url":"https://api.github.com/users/bazelbuild/following{/other_user}","gists_url":"https://api.github.com/users/bazelbuild/gists{/gist_id}","starred_url":"https://api.github.com/users/bazelbuild/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bazelbuild/subscriptions","organizations_url":"https://api.github.com/users/bazelbuild/orgs","repos_url":"https://api.github.com/users/bazelbuild/repos","events_url":"https://api.github.com/users/bazelbuild/events{/privacy}","received_events_url":"https://api.github.com/users/bazelbuild/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/bazelbuild/bazel","description":"a fast, scalable, multi-language and extensible build system","fork":false,"url":"https://api.github.com/repos/bazelbuild/bazel","forks_url":"https://api.github.com/repos/bazelbuild/bazel/forks","keys_url":"https://api.github.com/repos/bazelbuild/bazel/keys{/key_id}","collaborators_url":"https://api.github.com/repos/bazelbuild/bazel/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/bazelbuild/bazel/teams","hooks_url":"https://api.github.com/repos/bazelbuild/bazel/hooks","issue_events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/events{/number}","events_url":"https://api.github.com/repos/bazelbuild/bazel/events","assignees_url":"https://api.github.com/repos/bazelbuild/bazel/assignees{/user}","branches_url":"https://api.github.com/repos/bazelbuild/bazel/branches{/branch}","tags_url":"https://api.github.com/repos/bazelbuild/bazel/tags","blobs_url":"https://api.github.com/repos/bazelbuild/bazel/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/bazelbuild/bazel/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/bazelbuild/bazel/git/refs{/sha}","trees_url":"https://api.github.com/repos/bazelbuild/bazel/git/trees{/sha}","statuses_url":"https://api.github.com/repos/bazelbuild/bazel/statuses/{sha}","languages_url":"https://api.github.com/repos/bazelbuild/bazel/languages","stargazers_url":"https://api.github.com/repos/bazelbuild/bazel/stargazers","contributors_url":"https://api.github.com/repos/bazelbuild/bazel/contributors","subscribers_url":"https://api.github.com/repos/bazelbuild/bazel/subscribers","subscription_url":"https://api.github.com/repos/bazelbuild/bazel/subscription","commits_url":"https://api.github.com/repos/bazelbuild/bazel/commits{/sha}","git_commits_url":"https://api.github.com/repos/bazelbuild/bazel/git/commits{/sha}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/comments{/number}","issue_comment_url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments{/number}","contents_url":"https://api.github.com/repos/bazelbuild/bazel/contents/{+path}","compare_url":"https://api.github.com/repos/bazelbuild/bazel/compare/{base}...{head}","merges_url":"https://api.github.com/repos/bazelbuild/bazel/merges","archive_url":"https://api.github.com/repos/bazelbuild/bazel/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/bazelbuild/bazel/downloads","issues_url":"https://api.github.com/repos/bazelbuild/bazel/issues{/number}","pulls_url":"https://api.github.com/repos/bazelbuild/bazel/pulls{/number}","milestones_url":"https://api.github.com/repos/bazelbuild/bazel/milestones{/number}","notifications_url":"https://api.github.com/repos/bazelbuild/bazel/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/bazelbuild/bazel/labels{/name}","releases_url":"https://api.github.com/repos/bazelbuild/bazel/releases{/id}","deployments_url":"https://api.github.com/repos/bazelbuild/bazel/deployments","created_at":"2014-06-12T16:00:38Z","updated_at":"2025-11-10T01:33:52Z","pushed_at":"2025-11-08T01:50:45Z","git_url":"git://github.com/bazelbuild/bazel.git","ssh_url":"git@github.com:bazelbuild/bazel.git","clone_url":"https://github.com/bazelbuild/bazel.git","svn_url":"https://github.com/bazelbuild/bazel","homepage":"https://bazel.build","size":990573,"stargazers_count":24742,"watchers_count":24742,"language":"Java","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":4332,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1832,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["bazel","build","build-system","correct","fast","multi-language","scalable","test"],"visibility":"public","forks":4332,"open_issues":1832,"watchers":24742,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/bazelbuild/bazel/pulls/18593","html_url":"https://github.com/bazelbuild/bazel/pull/18593","diff_url":"https://github.com/bazelbuild/bazel/pull/18593.diff","patch_url":"https://github.com/bazelbuild/bazel/pull/18593.patch","merged_at":null},"body":"We report download progress to UI when downloading outputs from remote cache. UI thread keeps track of active downloads. There are two cases the UI thread could leak memory:\r\n\r\n1. If we failed to close the output stream, the `reporter.finished()` will never be called, prevent UI thread from releasing the active download. This is fixed by calling `reporter.finished()` in `finally` block.\r\n2. Normally, UI thread stops after `BuildCompleted` event. However, if we have background download after build is completed, UI thread is not stopped to continue printing out download progress. But after all downloads are done, we forgot to stop the UI thread, resulting all referenced objects leaked. This is fixed by calling `checkActivities()` for every download progress.\r\n\r\nFixes #18145.","reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/18593/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18593/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":9515095533,"node_id":"CE_lADOATz7jc5j1kuNzwAAAAI3JNXt","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9515095533","actor":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"event":"closed","commit_id":"ce8836dd05de94b92a494be12a47a56bf9819107","commit_url":"https://api.github.com/repos/bazelbuild/bazel/commits/ce8836dd05de94b92a494be12a47a56bf9819107","created_at":"2023-06-13T11:41:19Z","state_reason":null,"performed_via_github_app":null},{"id":9519469928,"node_id":"REFE_lADOATz7jc5j1kuNzwAAAAI3Z5Vo","url":"https://api.github.com/repos/bazelbuild/bazel/issues/events/9519469928","actor":{"login":"iancha1992","id":132618328,"node_id":"U_kgDOB-eYWA","avatar_url":"https://avatars.githubusercontent.com/u/132618328?v=4","gravatar_id":"","url":"https://api.github.com/users/iancha1992","html_url":"https://github.com/iancha1992","followers_url":"https://api.github.com/users/iancha1992/followers","following_url":"https://api.github.com/users/iancha1992/following{/other_user}","gists_url":"https://api.github.com/users/iancha1992/gists{/gist_id}","starred_url":"https://api.github.com/users/iancha1992/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iancha1992/subscriptions","organizations_url":"https://api.github.com/users/iancha1992/orgs","repos_url":"https://api.github.com/users/iancha1992/repos","events_url":"https://api.github.com/users/iancha1992/events{/privacy}","received_events_url":"https://api.github.com/users/iancha1992/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"59748fbf7bef4424dcbac1b15fd22215b8767c6e","commit_url":"https://api.github.com/repos/iancha1992/bazel/commits/59748fbf7bef4424dcbac1b15fd22215b8767c6e","created_at":"2023-06-13T18:00:18Z","performed_via_github_app":null},{"actor":{"login":"iancha1992","id":132618328,"node_id":"U_kgDOB-eYWA","avatar_url":"https://avatars.githubusercontent.com/u/132618328?v=4","gravatar_id":"","url":"https://api.github.com/users/iancha1992","html_url":"https://github.com/iancha1992","followers_url":"https://api.github.com/users/iancha1992/followers","following_url":"https://api.github.com/users/iancha1992/following{/other_user}","gists_url":"https://api.github.com/users/iancha1992/gists{/gist_id}","starred_url":"https://api.github.com/users/iancha1992/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iancha1992/subscriptions","organizations_url":"https://api.github.com/users/iancha1992/orgs","repos_url":"https://api.github.com/users/iancha1992/repos","events_url":"https://api.github.com/users/iancha1992/events{/privacy}","received_events_url":"https://api.github.com/users/iancha1992/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-13T18:05:32Z","updated_at":"2023-06-13T18:05:32Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/18659","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18659/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18659/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18659/events","html_url":"https://github.com/bazelbuild/bazel/pull/18659","id":1755412268,"node_id":"PR_kwDOATz7jc5S6lsl","number":18659,"title":"[6.3.0] Fix potential memory leak in UI","user":{"login":"iancha1992","id":132618328,"node_id":"U_kgDOB-eYWA","avatar_url":"https://avatars.githubusercontent.com/u/132618328?v=4","gravatar_id":"","url":"https://api.github.com/users/iancha1992","html_url":"https://github.com/iancha1992","followers_url":"https://api.github.com/users/iancha1992/followers","following_url":"https://api.github.com/users/iancha1992/following{/other_user}","gists_url":"https://api.github.com/users/iancha1992/gists{/gist_id}","starred_url":"https://api.github.com/users/iancha1992/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iancha1992/subscriptions","organizations_url":"https://api.github.com/users/iancha1992/orgs","repos_url":"https://api.github.com/users/iancha1992/repos","events_url":"https://api.github.com/users/iancha1992/events{/privacy}","received_events_url":"https://api.github.com/users/iancha1992/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1193207358,"node_id":"MDU6TGFiZWwxMTkzMjA3MzU4","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Remote-Exec","name":"team-Remote-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Remote) team"},{"id":4761872548,"node_id":"LA_kwDOATz7jc8AAAABG9RopA","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-CLI","name":"team-CLI","color":"f1f442","default":false,"description":"Console UI"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-06-13T18:05:31Z","updated_at":"2023-07-12T22:56:29Z","closed_at":"2023-06-14T18:33:53Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":20773773,"node_id":"MDEwOlJlcG9zaXRvcnkyMDc3Mzc3Mw==","name":"bazel","full_name":"bazelbuild/bazel","private":false,"owner":{"login":"bazelbuild","id":11684617,"node_id":"MDEyOk9yZ2FuaXphdGlvbjExNjg0NjE3","avatar_url":"https://avatars.githubusercontent.com/u/11684617?v=4","gravatar_id":"","url":"https://api.github.com/users/bazelbuild","html_url":"https://github.com/bazelbuild","followers_url":"https://api.github.com/users/bazelbuild/followers","following_url":"https://api.github.com/users/bazelbuild/following{/other_user}","gists_url":"https://api.github.com/users/bazelbuild/gists{/gist_id}","starred_url":"https://api.github.com/users/bazelbuild/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bazelbuild/subscriptions","organizations_url":"https://api.github.com/users/bazelbuild/orgs","repos_url":"https://api.github.com/users/bazelbuild/repos","events_url":"https://api.github.com/users/bazelbuild/events{/privacy}","received_events_url":"https://api.github.com/users/bazelbuild/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/bazelbuild/bazel","description":"a fast, scalable, multi-language and extensible build system","fork":false,"url":"https://api.github.com/repos/bazelbuild/bazel","forks_url":"https://api.github.com/repos/bazelbuild/bazel/forks","keys_url":"https://api.github.com/repos/bazelbuild/bazel/keys{/key_id}","collaborators_url":"https://api.github.com/repos/bazelbuild/bazel/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/bazelbuild/bazel/teams","hooks_url":"https://api.github.com/repos/bazelbuild/bazel/hooks","issue_events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/events{/number}","events_url":"https://api.github.com/repos/bazelbuild/bazel/events","assignees_url":"https://api.github.com/repos/bazelbuild/bazel/assignees{/user}","branches_url":"https://api.github.com/repos/bazelbuild/bazel/branches{/branch}","tags_url":"https://api.github.com/repos/bazelbuild/bazel/tags","blobs_url":"https://api.github.com/repos/bazelbuild/bazel/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/bazelbuild/bazel/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/bazelbuild/bazel/git/refs{/sha}","trees_url":"https://api.github.com/repos/bazelbuild/bazel/git/trees{/sha}","statuses_url":"https://api.github.com/repos/bazelbuild/bazel/statuses/{sha}","languages_url":"https://api.github.com/repos/bazelbuild/bazel/languages","stargazers_url":"https://api.github.com/repos/bazelbuild/bazel/stargazers","contributors_url":"https://api.github.com/repos/bazelbuild/bazel/contributors","subscribers_url":"https://api.github.com/repos/bazelbuild/bazel/subscribers","subscription_url":"https://api.github.com/repos/bazelbuild/bazel/subscription","commits_url":"https://api.github.com/repos/bazelbuild/bazel/commits{/sha}","git_commits_url":"https://api.github.com/repos/bazelbuild/bazel/git/commits{/sha}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/comments{/number}","issue_comment_url":"https://api.github.com/repos/bazelbuild/bazel/issues/comments{/number}","contents_url":"https://api.github.com/repos/bazelbuild/bazel/contents/{+path}","compare_url":"https://api.github.com/repos/bazelbuild/bazel/compare/{base}...{head}","merges_url":"https://api.github.com/repos/bazelbuild/bazel/merges","archive_url":"https://api.github.com/repos/bazelbuild/bazel/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/bazelbuild/bazel/downloads","issues_url":"https://api.github.com/repos/bazelbuild/bazel/issues{/number}","pulls_url":"https://api.github.com/repos/bazelbuild/bazel/pulls{/number}","milestones_url":"https://api.github.com/repos/bazelbuild/bazel/milestones{/number}","notifications_url":"https://api.github.com/repos/bazelbuild/bazel/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/bazelbuild/bazel/labels{/name}","releases_url":"https://api.github.com/repos/bazelbuild/bazel/releases{/id}","deployments_url":"https://api.github.com/repos/bazelbuild/bazel/deployments","created_at":"2014-06-12T16:00:38Z","updated_at":"2025-11-10T01:33:52Z","pushed_at":"2025-11-08T01:50:45Z","git_url":"git://github.com/bazelbuild/bazel.git","ssh_url":"git@github.com:bazelbuild/bazel.git","clone_url":"https://github.com/bazelbuild/bazel.git","svn_url":"https://github.com/bazelbuild/bazel","homepage":"https://bazel.build","size":990573,"stargazers_count":24742,"watchers_count":24742,"language":"Java","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":true,"has_pages":false,"has_discussions":true,"forks_count":4332,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1832,"license":{"key":"apache-2.0","name":"Apache License 2.0","spdx_id":"Apache-2.0","url":"https://api.github.com/licenses/apache-2.0","node_id":"MDc6TGljZW5zZTI="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["bazel","build","build-system","correct","fast","multi-language","scalable","test"],"visibility":"public","forks":4332,"open_issues":1832,"watchers":24742,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/bazelbuild/bazel/pulls/18659","html_url":"https://github.com/bazelbuild/bazel/pull/18659","diff_url":"https://github.com/bazelbuild/bazel/pull/18659.diff","patch_url":"https://github.com/bazelbuild/bazel/pull/18659.patch","merged_at":"2023-06-14T18:33:53Z"},"body":"We report download progress to UI when downloading outputs from remote cache. UI thread keeps track of active downloads. There are two cases the UI thread could leak memory:\r\n\r\n1. If we failed to close the output stream, the `reporter.finished()` will never be called, prevent UI thread from releasing the active download. This is fixed by calling `reporter.finished()` in `finally` block.\r\n2. Normally, UI thread stops after `BuildCompleted` event. However, if we have background download after build is completed, UI thread is not stopped to continue printing out download progress. But after all downloads are done, we forgot to stop the UI thread, resulting all referenced objects leaked. This is fixed by calling `checkActivities()` for every download progress.\r\n\r\nFixes #18145.\r\n\r\nCloses #18593.\r\n\r\nCommit https://github.com/bazelbuild/bazel/commit/ce8836dd05de94b92a494be12a47a56bf9819107\r\n\r\nPiperOrigin-RevId: 539923685\r\nChange-Id: I7e2887035e540b39e382ab5fcbc06bad03b10427","reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/18659/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18659/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"}]