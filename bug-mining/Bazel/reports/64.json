{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/19333","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/19333/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/19333/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/19333/events","html_url":"https://github.com/bazelbuild/bazel/issues/19333","id":1866483769,"node_id":"I_kwDOATz7jc5vQEg5","number":19333,"title":"--enable_runfiles is not applied correctly without manual cleaning","user":{"login":"hofst","id":2535762,"node_id":"MDQ6VXNlcjI1MzU3NjI=","avatar_url":"https://avatars.githubusercontent.com/u/2535762?v=4","gravatar_id":"","url":"https://api.github.com/users/hofst","html_url":"https://github.com/hofst","followers_url":"https://api.github.com/users/hofst/followers","following_url":"https://api.github.com/users/hofst/following{/other_user}","gists_url":"https://api.github.com/users/hofst/gists{/gist_id}","starred_url":"https://api.github.com/users/hofst/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hofst/subscriptions","organizations_url":"https://api.github.com/users/hofst/orgs","repos_url":"https://api.github.com/users/hofst/repos","events_url":"https://api.github.com/users/hofst/events{/privacy}","received_events_url":"https://api.github.com/users/hofst/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":1020665933,"node_id":"MDU6TGFiZWwxMDIwNjY1OTMz","url":"https://api.github.com/repos/bazelbuild/bazel/labels/untriaged","name":"untriaged","color":"c34ddd","default":false,"description":""},{"id":1182274167,"node_id":"MDU6TGFiZWwxMTgyMjc0MTY3","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Core","name":"team-Core","color":"f1f442","default":false,"description":"Skyframe, bazel query, BEP, options parsing, bazelrc"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2023-08-25T07:19:46Z","updated_at":"2024-01-03T13:07:19Z","closed_at":"2024-01-03T13:07:19Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\n--enable_runfiles controls whether bazel will fill the runfiles directory with the specified dependencies (symlinked or copied).\r\nIt defaults to off on posix and to off on Windows.\r\nWhen it is off, tests need to find their dependencies on their own, e.g., by inspecting the environment variables that bazel provides for this case.\r\nSwitching this flag, however, currently has a bug: It looks like bazel will do nothing unless the directory is manually cleaned.\r\nE.g., if you previously did a build with runfiles enabled, and then turn it off, your test will run inside a *filled* runfiles directory. On the other hand, if you started with the flag off and then turned it on, your test will run in an empty runfiles directory. At least that is what I observe on Windows.\r\nThis is very problematic since it will cause test failures (very confusing ones).\n\n### Which category does this issue belong to?\n\n\nCore\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\nCreate a test with runfiles dependencies. Turn the flag off, run the test, turn the flag on, run the test.\n\n### Which operating system are you running Bazel on?\n\n\nWindows\n\n### What is the output of `bazel info release`?\n\n\n6.3.1\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\n_No response_\n\n### What's the output of `git remote get-url origin; git rev-parse master; git rev-parse HEAD` ?\n\n\n_No response_\n\n### Is this a regression? If yes, please try to identify the Bazel commit where the bug was introduced.\n\n\n_No response_\n\n### Have you found anything relevant by searching the web?\n\n_No response_\n\n### Any other information, logs, or outputs that you want to share?\n\n_No response_","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/19333/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/19333/timeline","performed_via_github_app":null,"state_reason":"completed"}