{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/21043","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/21043/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/21043/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/21043/events","html_url":"https://github.com/bazelbuild/bazel/issues/21043","id":2101604442,"node_id":"I_kwDOATz7jc59Q_Ba","number":21043,"title":"--experimental_output_paths=strip is not effective when actions are scheduled in parallel","user":{"login":"DavidANeil","id":19960231,"node_id":"MDQ6VXNlcjE5OTYwMjMx","avatar_url":"https://avatars.githubusercontent.com/u/19960231?v=4","gravatar_id":"","url":"https://api.github.com/users/DavidANeil","html_url":"https://github.com/DavidANeil","followers_url":"https://api.github.com/users/DavidANeil/followers","following_url":"https://api.github.com/users/DavidANeil/following{/other_user}","gists_url":"https://api.github.com/users/DavidANeil/gists{/gist_id}","starred_url":"https://api.github.com/users/DavidANeil/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DavidANeil/subscriptions","organizations_url":"https://api.github.com/users/DavidANeil/orgs","repos_url":"https://api.github.com/users/DavidANeil/repos","events_url":"https://api.github.com/users/DavidANeil/events{/privacy}","received_events_url":"https://api.github.com/users/DavidANeil/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503261,"node_id":"MDU6TGFiZWwxMDY1MDMyNjE=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20feature%20request","name":"type: feature request","color":"0052cc","default":false,"description":null},{"id":192364134,"node_id":"MDU6TGFiZWwxOTIzNjQxMzQ=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P1","name":"P1","color":"d93f0b","default":false,"description":"I'll work on this now. (Assignee required)"},{"id":1193206953,"node_id":"MDU6TGFiZWwxMTkzMjA2OTUz","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Local-Exec","name":"team-Local-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Local) team"}],"state":"closed","locked":false,"assignee":{"login":"fmeum","id":4312191,"node_id":"MDQ6VXNlcjQzMTIxOTE=","avatar_url":"https://avatars.githubusercontent.com/u/4312191?v=4","gravatar_id":"","url":"https://api.github.com/users/fmeum","html_url":"https://github.com/fmeum","followers_url":"https://api.github.com/users/fmeum/followers","following_url":"https://api.github.com/users/fmeum/following{/other_user}","gists_url":"https://api.github.com/users/fmeum/gists{/gist_id}","starred_url":"https://api.github.com/users/fmeum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmeum/subscriptions","organizations_url":"https://api.github.com/users/fmeum/orgs","repos_url":"https://api.github.com/users/fmeum/repos","events_url":"https://api.github.com/users/fmeum/events{/privacy}","received_events_url":"https://api.github.com/users/fmeum/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"fmeum","id":4312191,"node_id":"MDQ6VXNlcjQzMTIxOTE=","avatar_url":"https://avatars.githubusercontent.com/u/4312191?v=4","gravatar_id":"","url":"https://api.github.com/users/fmeum","html_url":"https://github.com/fmeum","followers_url":"https://api.github.com/users/fmeum/followers","following_url":"https://api.github.com/users/fmeum/following{/other_user}","gists_url":"https://api.github.com/users/fmeum/gists{/gist_id}","starred_url":"https://api.github.com/users/fmeum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmeum/subscriptions","organizations_url":"https://api.github.com/users/fmeum/orgs","repos_url":"https://api.github.com/users/fmeum/repos","events_url":"https://api.github.com/users/fmeum/events{/privacy}","received_events_url":"https://api.github.com/users/fmeum/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":8,"created_at":"2024-01-26T05:07:01Z","updated_at":"2024-07-29T22:56:45Z","closed_at":"2024-07-23T10:20:02Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the feature request:\r\n\r\n\r\n`--experimental_output_paths=strip` can allow for a `exec` and `target` spawn to have the same input digest, and therefore be cache hits.  Unfortunately, because these actions frequently have identical or exactly duplicated input dependency graphs, it isn't uncommon that the two actions are scheduled at the same time, meaning the work is still duplicated.\r\n\r\nI'm not totally certain on the solution, but my first bad idea is that the spawn strategy should, if this flag is enabled, check to see if any sibling spawns match the input digest of spawn that is about to start executing, and if so somehow \"join\" the spawn results.\r\n\r\n### Which category does this issue belong to?\r\n\r\n\r\nLocal Execution\r\n\r\n### What underlying problem are you trying to solve with this feature?\r\n\r\n\r\nOur host and target platforms are identical, so all duplicated `[for tool]` actions are pure overhead.  This flag seems promising at reducing that overhead, but we still frequently see duplicated actions since the \"exec\" and \"target\" dependency chains tend to stay in sync, since one branch falling behind due to chance of the scheduler means it gets cache hits until it catches back up and starts duplicating execution again.","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/21043/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/21043/timeline","performed_via_github_app":null,"state_reason":"completed"}