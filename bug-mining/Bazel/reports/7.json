{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/17366","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/17366/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/17366/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/17366/events","html_url":"https://github.com/bazelbuild/bazel/issues/17366","id":1564350991,"node_id":"I_kwDOATz7jc5dPhoP","number":17366,"title":"Bazel does not re-evaluate remote actions, even after shutdown","user":{"login":"ozio85","id":44941036,"node_id":"MDQ6VXNlcjQ0OTQxMDM2","avatar_url":"https://avatars.githubusercontent.com/u/44941036?v=4","gravatar_id":"","url":"https://api.github.com/users/ozio85","html_url":"https://github.com/ozio85","followers_url":"https://api.github.com/users/ozio85/followers","following_url":"https://api.github.com/users/ozio85/following{/other_user}","gists_url":"https://api.github.com/users/ozio85/gists{/gist_id}","starred_url":"https://api.github.com/users/ozio85/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ozio85/subscriptions","organizations_url":"https://api.github.com/users/ozio85/orgs","repos_url":"https://api.github.com/users/ozio85/repos","events_url":"https://api.github.com/users/ozio85/events{/privacy}","received_events_url":"https://api.github.com/users/ozio85/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":1193207358,"node_id":"MDU6TGFiZWwxMTkzMjA3MzU4","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Remote-Exec","name":"team-Remote-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Remote) team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":14,"created_at":"2023-01-31T13:50:55Z","updated_at":"2023-02-20T11:23:10Z","closed_at":"2023-02-20T11:23:10Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\r\n\r\n\r\nCurrently Bazel does not re-evaluate remote actions towards the remote execution service, even after a shutdown is performed.\r\n\r\nThis causes errors when:\r\n1. The remote cache rotates\r\n2. The remote cache is completely wiped.\r\n\r\nThis leads to a:\r\n(Exit 34): /home/path/to/file.h (No such file or directory)\r\n(BulkTransferException)\r\n\r\nAnd before this could be reparied by rerunning (since this error causes bazel to shutdown). But the behavior now is even after restart, Bazel still remembers the state, and the BulkTransferException remains until a `bazel clean` is performed\r\n\r\nI am using:\r\n--remote_download_toplevel\r\n\r\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\r\n\r\n\r\n`bazel build //something --experimental_remote_grpc_log=first.run.log`\r\n\r\n`bazel shutdown`\r\n\r\n`bazel build //something --experimental_remote_grpc_log=second.run.log`\r\n\r\nI expect bazel to reevaluate the actions towards the remote server, to see if any needs a re-run.\r\n\r\n### Which operating system are you running Bazel on?\r\n\r\n\r\nlinux\r\n\r\n### What is the output of `bazel info release`?\r\n\r\n\r\n7.0.0-pre.20221111.3\r\n\r\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\r\n\r\n\r\n_No response_\r\n\r\n### What's the output of `git remote get-url origin; git rev-parse master; git rev-parse HEAD` ?\r\n\r\n\r\n_No response_\r\n\r\n### Have you found anything relevant by searching the web?\r\n\r\nThis is the same issue as #13882, however in 7.0.0, it is enabled by default\r\nHow is this ever going to work?\r\n\r\n### Any other information, logs, or outputs that you want to share?\r\n\r\n_No response_","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/17366/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/17366/timeline","performed_via_github_app":null,"state_reason":"completed"}