{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/23598","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/23598/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/23598/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/23598/events","html_url":"https://github.com/bazelbuild/bazel/issues/23598","id":2520120519,"node_id":"I_kwDOATz7jc6WNfzH","number":23598,"title":"Support a configurable allowlist in one version enforcement","user":{"login":"cushon","id":478458,"node_id":"MDQ6VXNlcjQ3ODQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/478458?v=4","gravatar_id":"","url":"https://api.github.com/users/cushon","html_url":"https://github.com/cushon","followers_url":"https://api.github.com/users/cushon/followers","following_url":"https://api.github.com/users/cushon/following{/other_user}","gists_url":"https://api.github.com/users/cushon/gists{/gist_id}","starred_url":"https://api.github.com/users/cushon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cushon/subscriptions","organizations_url":"https://api.github.com/users/cushon/orgs","repos_url":"https://api.github.com/users/cushon/repos","events_url":"https://api.github.com/users/cushon/events{/privacy}","received_events_url":"https://api.github.com/users/cushon/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503261,"node_id":"MDU6TGFiZWwxMDY1MDMyNjE=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20feature%20request","name":"type: feature request","color":"0052cc","default":false,"description":null},{"id":192364134,"node_id":"MDU6TGFiZWwxOTIzNjQxMzQ=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P1","name":"P1","color":"d93f0b","default":false,"description":"I'll work on this now. (Assignee required)"},{"id":1020663976,"node_id":"MDU6TGFiZWwxMDIwNjYzOTc2","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Rules-Java","name":"team-Rules-Java","color":"f1f442","default":false,"description":"Issues for Java rules"}],"state":"closed","locked":false,"assignee":{"login":"fmeum","id":4312191,"node_id":"MDQ6VXNlcjQzMTIxOTE=","avatar_url":"https://avatars.githubusercontent.com/u/4312191?v=4","gravatar_id":"","url":"https://api.github.com/users/fmeum","html_url":"https://github.com/fmeum","followers_url":"https://api.github.com/users/fmeum/followers","following_url":"https://api.github.com/users/fmeum/following{/other_user}","gists_url":"https://api.github.com/users/fmeum/gists{/gist_id}","starred_url":"https://api.github.com/users/fmeum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmeum/subscriptions","organizations_url":"https://api.github.com/users/fmeum/orgs","repos_url":"https://api.github.com/users/fmeum/repos","events_url":"https://api.github.com/users/fmeum/events{/privacy}","received_events_url":"https://api.github.com/users/fmeum/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"fmeum","id":4312191,"node_id":"MDQ6VXNlcjQzMTIxOTE=","avatar_url":"https://avatars.githubusercontent.com/u/4312191?v=4","gravatar_id":"","url":"https://api.github.com/users/fmeum","html_url":"https://github.com/fmeum","followers_url":"https://api.github.com/users/fmeum/followers","following_url":"https://api.github.com/users/fmeum/following{/other_user}","gists_url":"https://api.github.com/users/fmeum/gists{/gist_id}","starred_url":"https://api.github.com/users/fmeum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmeum/subscriptions","organizations_url":"https://api.github.com/users/fmeum/orgs","repos_url":"https://api.github.com/users/fmeum/repos","events_url":"https://api.github.com/users/fmeum/events{/privacy}","received_events_url":"https://api.github.com/users/fmeum/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":0,"created_at":"2024-09-11T15:50:23Z","updated_at":"2024-09-13T19:44:23Z","closed_at":"2024-09-13T19:44:23Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"I am spinning this off from https://github.com/bazelbuild/bazel/issues/1071#issuecomment-1997838903, see also https://github.com/bazelbuild/bazel/pull/23592#issuecomment-2343920446\r\n\r\n> The internal version of the [one version] tool has support for an allowlist of existing violations to ignore, because when we rolled it out there were many violations and it wasn't practical to clean them up. I'm not sure what the priority of that is for Bazel: new projects may be able to just avoid introducing one version issues, but some existing projects may want a similar way to roll out enforcement to catch new violations and allowlist existing ones. The internal implementation uses and SSTable library that isn't open-source, for Bazel we could probably start with a text file.\r\n\r\nThe interface is present in the open-source tool, but it isn't wired up to be configurable: https://github.com/bazelbuild/bazel/blob/master/src/tools/one_version/allowlist.h\r\n\r\nThe internal formal is a file with entries where each line is a `<Java package name> <Bazel target label>`, e.g.:\r\n\r\n```\r\ncom/example/foo //src/com/example/foo:bar\r\n```\r\n\r\nand then the tool ignores classes in that package provided by that target when checking for violations.\r\n\r\nI think all of the plumbing is there to set an allowlist file in the `java_toolchain` and have the file be passed to one version, https://github.com/bazelbuild/bazel/commit/417c6b803db1078d20077068471427c86c016190 ensures the file isn't passed if it isn't set because the external tool doesn't recognize the flag yet.\r\n\r\nThe FR here is basically to add the flag to oneversion, and have it parse a file into an implementation of the interface in `allowlist.h`.","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/23598/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/23598/timeline","performed_via_github_app":null,"state_reason":"completed"}