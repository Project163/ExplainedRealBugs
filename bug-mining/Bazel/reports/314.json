{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/25773","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/25773/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/25773/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/25773/events","html_url":"https://github.com/bazelbuild/bazel/issues/25773","id":2974354788,"node_id":"I_kwDOATz7jc6xSQ1k","number":25773,"title":"Do not require sparse checkout attributes in `git_worker` APIs.","user":{"login":"cgrindel","id":159968,"node_id":"MDQ6VXNlcjE1OTk2OA==","avatar_url":"https://avatars.githubusercontent.com/u/159968?v=4","gravatar_id":"","url":"https://api.github.com/users/cgrindel","html_url":"https://github.com/cgrindel","followers_url":"https://api.github.com/users/cgrindel/followers","following_url":"https://api.github.com/users/cgrindel/following{/other_user}","gists_url":"https://api.github.com/users/cgrindel/gists{/gist_id}","starred_url":"https://api.github.com/users/cgrindel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgrindel/subscriptions","organizations_url":"https://api.github.com/users/cgrindel/orgs","repos_url":"https://api.github.com/users/cgrindel/repos","events_url":"https://api.github.com/users/cgrindel/events{/privacy}","received_events_url":"https://api.github.com/users/cgrindel/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":1020663381,"node_id":"MDU6TGFiZWwxMDIwNjYzMzgx","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-ExternalDeps","name":"team-ExternalDeps","color":"f1f442","default":false,"description":"External dependency handling, remote repositiories, WORKSPACE file."},{"id":1020665933,"node_id":"MDU6TGFiZWwxMDIwNjY1OTMz","url":"https://api.github.com/repos/bazelbuild/bazel/labels/untriaged","name":"untriaged","color":"c34ddd","default":false,"description":""},{"id":1182274167,"node_id":"MDU6TGFiZWwxMTgyMjc0MTY3","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Core","name":"team-Core","color":"f1f442","default":false,"description":"Skyframe, bazel query, BEP, options parsing, bazelrc"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2025-04-05T16:50:10Z","updated_at":"2025-04-13T14:17:08Z","closed_at":"2025-04-07T16:40:09Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\n[The daily CI runs for swift_gazelle_plugin](https://github.com/bazelbuild/bazel/commit/4006e059737d214fc4116083d9c4e58d5a2e40c0) started to fail for Bazel last green tests after [support for sparse checkouts](https://github.com/bazelbuild/bazel/commit/4006e059737d214fc4116083d9c4e58d5a2e40c0) was added. The code expects the newly introduced attributes to be available by all clients of the `git_worker.bzl` APIs.\n\ncc:@jpc-sf\n\n### Which category does this issue belong to?\n\nCore, External Dependency\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\nRun the following after cloning [the swift_gazelle_plugin repo](https://github.com/cgrindel/swift_gazelle_plugin).\n\n```sh\nbazel test //examples:grpc_example_test_bazel_last_green\n```\n\n\n### Which operating system are you running Bazel on?\n\n\nMacOS, Linux\n\n### What is the output of `bazel info release`?\n\n\nlast green\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\n_No response_\n\n### What's the output of `git remote get-url origin; git rev-parse HEAD` ?\n\n\n```text\n\n```\n\n### If this is a regression, please try to identify the Bazel commit where the bug was introduced with bazelisk --bisect.\n\n\nhttps://github.com/bazelbuild/bazel/commit/4006e059737d214fc4116083d9c4e58d5a2e40c0\n\n\n### Have you found anything relevant by searching the web?\n\n_No response_\n\n### Any other information, logs, or outputs that you want to share?\n\n`swift_gazelle_plugin` CI error:\n\n```\nERROR: /home/runner/.cache/bazel/_bazel_runner/08c09e7a19e19539e62b43fedc1de0bf/execroot/_main/_tmp/7dfd64ec019dadb2597b0e4fbc92113b/_bazel_runner/4fb6266081e113994c5925fdaec3877b/external/bazel_tools/tools/build_defs/repo/git_worker.bzl:161:48: An error occurred during the fetch of repository 'rules_swift_package_manager++swift_deps+swiftpkg_swift_protobuf':\n   Traceback (most recent call last):\n\tFile \"/home/runner/.cache/bazel/_bazel_runner/08c09e7a19e19539e62b43fedc1de0bf/execroot/_main/_tmp/7dfd64ec019dadb2597b0e4fbc92113b/_bazel_runner/4fb6266081e113994c5925fdaec3877b/external/rules_swift_package_manager+/swiftpkg/internal/swift_package.bzl\", line 47, column 35, in _swift_package_impl\n\t\tupdate = _clone_or_update_repo(repository_ctx, directory)\n\tFile \"/home/runner/.cache/bazel/_bazel_runner/08c09e7a19e19539e62b43fedc1de0bf/execroot/_main/_tmp/7dfd64ec019dadb2597b0e4fbc92113b/_bazel_runner/4fb6266081e113994c5925fdaec3877b/external/rules_swift_package_manager+/swiftpkg/internal/swift_package.bzl\", line 25, column 20, in _clone_or_update_repo\n\t\tgit_ = git_repo(repository_ctx, directory)\n\tFile \"/home/runner/.cache/bazel/_bazel_runner/08c09e7a19e19539e62b43fedc1de0bf/execroot/_main/_tmp/7dfd64ec019dadb2597b0e4fbc92113b/_bazel_runner/4fb6266081e113994c5925fdaec3877b/external/bazel_tools/tools/build_defs/repo/git_worker.bzl\", line 98, column 12, in git_repo\n\t\t_update(ctx, git_repo)\n\tFile \"/home/runner/.cache/bazel/_bazel_runner/08c09e7a19e19539e62b43fedc1de0bf/execroot/_main/_tmp/7dfd64ec019dadb2597b0e4fbc92113b/_bazel_runner/4fb6266081e113994c5925fdaec3877b/external/bazel_tools/tools/build_defs/repo/git_worker.bzl\", line 138, column 10, in _update\n\t\tfetch(ctx, git_repo)\n\tFile \"/home/runner/.cache/bazel/_bazel_runner/08c09e7a19e19539e62b43fedc1de0bf/execroot/_main/_tmp/7dfd64ec019dadb2597b0e4fbc92113b/_bazel_runner/4fb6266081e113994c5925fdaec3877b/external/bazel_tools/tools/build_defs/repo/git_worker.bzl\", line 161, column 48, in fetch\n\t\tsparse_checkout_patterns_or_file = ctx.attr.sparse_checkout_patterns or ctx.attr.sparse_checkout_file\nError: No such attribute 'sparse_checkout_patterns'\nAvailable attributes: _action_listener, _config_dependencies, _configure, _environ, _original_name, aspect_hints, bazel_package_name, branch, commit, compatible_with, dependencies_index, deprecation, env, expect_failure, features, generator_function, generator_location, generator_name, init_submodules, name, package_metadata, patch_args, patch_cmds, patch_cmds_win, patch_tool, patches, publicly_expose_all_targets, recursive_init_submodules, remote, restricted_to, shallow_since, tag, tags, testonly, transitive_configs, verbose, version, visibility\nERROR: no such package '@@rules_swift_package_manager++swift_deps+swiftpkg_swift_protobuf//': No such attribute 'sparse_checkout_patterns'\nAvailable attributes: _action_listener, _config_dependencies, _configure, _environ, _original_name, aspect_hints, bazel_package_name, branch, commit, compatible_with, dependencies_index, deprecation, env, expect_failure, features, generator_function, generator_location, generator_name, init_submodules, name, package_metadata, patch_args, patch_cmds, patch_cmds_win, patch_tool, patches, publicly_expose_all_targets, recursive_init_submodules, remote, restricted_to, shallow_since, tag, tags, testonly, transitive_configs, verbose, version, visibility\nERROR: /home/runner/.cache/bazel/_bazel_runner/08c09e7a19e19539e62b43fedc1de0bf/execroot/_main/_tmp/7dfd64ec019dadb2597b0e4fbc92113b/_bazel_runner/4fb6266081e113994c5925fdaec3877b/external/rules_swift_package_manager++swift_deps+swift_deps_info/BUILD.bazel:4:17: @@rules_swift_package_manager++swift_deps+swift_deps_info//:swift_deps_index depends on @@rules_swift_package_manager++swift_deps+swiftpkg_swift_protobuf//:pkg_info.json in repository @@rules_swift_package_manager++swift_deps+swiftpkg_swift_protobuf which failed to fetch. no such package '@@rules_swift_package_manager++swift_deps+swiftpkg_swift_protobuf//': No such attribute 'sparse_checkout_patterns'\nAvailable attributes: _action_listener, _config_dependencies, _configure, _environ, _original_name, aspect_hints, bazel_package_name, branch, commit, compatible_with, dependencies_index, deprecation, env, expect_failure, features, generator_function, generator_location, generator_name, init_submodules, name, package_metadata, patch_args, patch_cmds, patch_cmds_win, patch_tool, patches, publicly_expose_all_targets, recursive_init_submodules, remote, restricted_to, shallow_since, tag, tags, testonly, transitive_configs, verbose, version, visibility\n```","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/25773/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/25773/timeline","performed_via_github_app":null,"state_reason":"completed"}