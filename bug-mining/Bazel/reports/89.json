{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/19952","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/19952/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/19952/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/19952/events","html_url":"https://github.com/bazelbuild/bazel/issues/19952","id":1963053045,"node_id":"I_kwDOATz7jc51Ac_1","number":19952,"title":"Analysis performance regression when lockfile is enabled","user":{"login":"purkhusid","id":5622403,"node_id":"MDQ6VXNlcjU2MjI0MDM=","avatar_url":"https://avatars.githubusercontent.com/u/5622403?v=4","gravatar_id":"","url":"https://api.github.com/users/purkhusid","html_url":"https://github.com/purkhusid","followers_url":"https://api.github.com/users/purkhusid/followers","following_url":"https://api.github.com/users/purkhusid/following{/other_user}","gists_url":"https://api.github.com/users/purkhusid/gists{/gist_id}","starred_url":"https://api.github.com/users/purkhusid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/purkhusid/subscriptions","organizations_url":"https://api.github.com/users/purkhusid/orgs","repos_url":"https://api.github.com/users/purkhusid/repos","events_url":"https://api.github.com/users/purkhusid/events{/privacy}","received_events_url":"https://api.github.com/users/purkhusid/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":192364134,"node_id":"MDU6TGFiZWwxOTIzNjQxMzQ=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P1","name":"P1","color":"d93f0b","default":false,"description":"I'll work on this now. (Assignee required)"},{"id":1020663381,"node_id":"MDU6TGFiZWwxMDIwNjYzMzgx","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-ExternalDeps","name":"team-ExternalDeps","color":"f1f442","default":false,"description":"External dependency handling, remote repositiories, WORKSPACE file."},{"id":3718884690,"node_id":"LA_kwDOATz7jc7dqa1S","url":"https://api.github.com/repos/bazelbuild/bazel/labels/area-Bzlmod","name":"area-Bzlmod","color":"a4fc20","default":false,"description":"Bzlmod-specific PRs, issues, and feature requests"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2023-10-26T09:06:40Z","updated_at":"2023-12-01T18:48:06Z","closed_at":"2023-11-02T04:39:31Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\r\n\r\n\r\nWhile migrating our repo to bzlmod we encountered an 3x slowdown in analysis when using bzlmod.\r\n\r\nLooking further into it it seems like it's caused by the newly introduced lockfile because the performance returns back to normal when `--lockfile_mode=off` is set.\r\n\r\nI can unfortunately not share an reproduction since the repo is private. The repo is using MODULE.bazel and WORKSPACE.bzlmod since not all of our external deps have been migrated to bzlmod.\r\n\r\nI'll share a profile with and without the lockfile:\r\n[timing_profile_with_lockfile.gz](https://github.com/bazelbuild/bazel/files/13175335/timing_profile_with_lockfile.gz)\r\n[timing_profile_without_lockfile.gz](https://github.com/bazelbuild/bazel/files/13175338/timing_profile_without_lockfile.gz)\r\n\r\nTagging @fmeum and @Wyverald since I had talked to them on Slack \r\n\r\n### Which operating system are you running Bazel on?\r\n\r\n\r\nLinux Fedora 38\r\n\r\n### What is the output of `bazel info release`?\r\n\r\n\r\nrelease 7.0.0rc2\r\n\r\n","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/19952/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/19952/timeline","performed_via_github_app":null,"state_reason":"completed"}