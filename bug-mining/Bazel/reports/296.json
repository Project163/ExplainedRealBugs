{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/25192","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/25192/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/25192/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/25192/events","html_url":"https://github.com/bazelbuild/bazel/issues/25192","id":2830857554,"node_id":"I_kwDOATz7jc6ou3VS","number":25192,"title":"New `repository_ctx.original_name` produces \"canonical reproducible\" warnings","user":{"login":"mbland","id":301547,"node_id":"MDQ6VXNlcjMwMTU0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/301547?v=4","gravatar_id":"","url":"https://api.github.com/users/mbland","html_url":"https://github.com/mbland","followers_url":"https://api.github.com/users/mbland/followers","following_url":"https://api.github.com/users/mbland/following{/other_user}","gists_url":"https://api.github.com/users/mbland/gists{/gist_id}","starred_url":"https://api.github.com/users/mbland/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbland/subscriptions","organizations_url":"https://api.github.com/users/mbland/orgs","repos_url":"https://api.github.com/users/mbland/repos","events_url":"https://api.github.com/users/mbland/events{/privacy}","received_events_url":"https://api.github.com/users/mbland/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":192364134,"node_id":"MDU6TGFiZWwxOTIzNjQxMzQ=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P1","name":"P1","color":"d93f0b","default":false,"description":"I'll work on this now. (Assignee required)"},{"id":1020663381,"node_id":"MDU6TGFiZWwxMDIwNjYzMzgx","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-ExternalDeps","name":"team-ExternalDeps","color":"f1f442","default":false,"description":"External dependency handling, remote repositiories, WORKSPACE file."}],"state":"closed","locked":false,"assignee":{"login":"fmeum","id":4312191,"node_id":"MDQ6VXNlcjQzMTIxOTE=","avatar_url":"https://avatars.githubusercontent.com/u/4312191?v=4","gravatar_id":"","url":"https://api.github.com/users/fmeum","html_url":"https://github.com/fmeum","followers_url":"https://api.github.com/users/fmeum/followers","following_url":"https://api.github.com/users/fmeum/following{/other_user}","gists_url":"https://api.github.com/users/fmeum/gists{/gist_id}","starred_url":"https://api.github.com/users/fmeum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmeum/subscriptions","organizations_url":"https://api.github.com/users/fmeum/orgs","repos_url":"https://api.github.com/users/fmeum/repos","events_url":"https://api.github.com/users/fmeum/events{/privacy}","received_events_url":"https://api.github.com/users/fmeum/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"fmeum","id":4312191,"node_id":"MDQ6VXNlcjQzMTIxOTE=","avatar_url":"https://avatars.githubusercontent.com/u/4312191?v=4","gravatar_id":"","url":"https://api.github.com/users/fmeum","html_url":"https://github.com/fmeum","followers_url":"https://api.github.com/users/fmeum/followers","following_url":"https://api.github.com/users/fmeum/following{/other_user}","gists_url":"https://api.github.com/users/fmeum/gists{/gist_id}","starred_url":"https://api.github.com/users/fmeum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmeum/subscriptions","organizations_url":"https://api.github.com/users/fmeum/orgs","repos_url":"https://api.github.com/users/fmeum/repos","events_url":"https://api.github.com/users/fmeum/events{/privacy}","received_events_url":"https://api.github.com/users/fmeum/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2025-02-04T17:20:17Z","updated_at":"2025-02-06T04:01:56Z","closed_at":"2025-02-05T19:46:52Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\nSince commit 8bcfb06e902c3d9b3d0839a1d9a38827f8b68672 introduced `repository_ctx.original_name`, closing #24467 and #25121, I've noticed the following \"canonical reproducible\" warnings (formatted for readability) when using the `last_green` build (at `4c3863e61136a10564f01d920e4f29e142256e7c` as of the timestamp below, in Eastern Standard Time):\n\n```txt1\n2025/02/04 10:28:44 Using unreleased version at commit 4c3863e61136a10564f01d920e4f29e142256e7c \n\nDEBUG: Rule 'rules_java++toolchains+remote_java_tools'\n  indicated that a canonical reproducible form can be obtained\n  by dropping arguments [\"_original_name\"]\n\nDEBUG: Rule 'rules_java++toolchains+remote_java_tools_darwin_arm64'\n  indicated that a canonical reproducible form can be obtained\n  by dropping arguments [\"_original_name\"]\n\nDEBUG: Rule 'rules_python++python+python_3_11_aarch64-apple-darwin'\n  indicated that a canonical reproducible form can be obtained\n  by dropping arguments [\"_original_name\"]\n\nDEBUG: Rule 'rules_java++toolchains+remotejdk11_macos_aarch64'\n  indicated that a canonical reproducible form can be obtained\n  by dropping arguments [\"_original_name\"]\n\nDEBUG: Rule 'rules_java++toolchains+remotejdk21_macos_aarch64'\n  indicated that a canonical reproducible form can be obtained\n  by dropping arguments [\"_original_name\"]\n\nDEBUG: Rule 'rules_scala++scala_deps+scala_compiler_source_2_12_14'\n  indicated that a canonical reproducible form can be obtained\n  by dropping arguments [\"_original_name\"]\n```\n\nAll of these except the last are followed by stanzas similar to:\n\n```txt\nDEBUG: Repository rules_java++toolchains+remote_java_tools instantiated at:\n  <builtin>: in <toplevel>\nRepository rule http_archive defined at:\n  .../external/bazel_tools/tools/build_defs/repo/http.bzl:392:31: in <toplevel>\n```\n\nNone of the following Bazel versions produce this error:\n\n- 6.5.0\n- 7.5.0\n- 8.0.1\n- `rolling` [9.0.0-pre.20250121.1](https://releases.bazel.build/9.0.0/rolling/9.0.0-pre.20250121.1/index.html) (2025-01-30)\n\n### Which category does this issue belong to?\n\nExternal Dependency\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\nNote that, as I write this, mbland/rules_scala@21e4be9557645885ba2aabab7922c457ffdf03ee is the `HEAD` of the [bzlmod-bazel-8 branch of my rules_scala fork](https://github.com/mbland/rules_scala/tree/bzlmod-bazel-8). This branch contains my work on bazelbuild/rules_scala#1482 (Bzlmod compatibility) and bazelbuild/rules_scala#1687 (Bazel 8 compatibility).\n\n```txt\ngit clone https://github.com/mbland/rules_scala.git\ncd rules_scala\ngit checkout 21e4be9557645885ba2aabab7922c457ffdf03ee\ncd dt_patches/test_dt_patches_user_srcjar\nUSE_BAZEL_VERSION=4c3863e61136a10564f01d920e4f29e142256e7c bazel clean --expunge  # if not the first build\nUSE_BAZEL_VERSION=4c3863e61136a10564f01d920e4f29e142256e7c bazel build --repo_env=SCALA_VERSION=2.12.14 //...\n```\n\n### Which operating system are you running Bazel on?\n\n\nmacOS Sequoia 15.3 (24D60)\n\n### What is the output of `bazel info release`?\n\n\ndevelopment version\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\nUsing the `last_green` build from Bazelisk\n\n### What's the output of `git remote get-url origin; git rev-parse HEAD` ?\n\n\n```text\n4c3863e61136a10564f01d920e4f29e142256e7c\n```\n\n### If this is a regression, please try to identify the Bazel commit where the bug was introduced with bazelisk --bisect.\n\n\n8bcfb06e902c3d9b3d0839a1d9a38827f8b68672\n\n### Have you found anything relevant by searching the web?\n\nIt seems a similar problem surfaced in 2020:\n\n- https://github.com/bazelbuild/bazel/issues/11040#issuecomment-612144661\n- https://github.com/bazelbuild/bazel/pull/11113\n\nBased on the above, it seems the fix may be to add `original_name` to `RepositoryResolvedEvent.IGNORED_ATTRIBUTE_NAMES` at: https://github.com/bazelbuild/bazel/blob/544887e0a8175dc17bce19772aa15169e9a024c2/src/main/java/com/google/devtools/build/lib/bazel/repository/RepositoryResolvedEvent.java#L239-L244\n\n### Any other information, logs, or outputs that you want to share?\n\nIn the [bzlmod-bazel-8 branch of my rules_scala fork](https://github.com/mbland/rules_scala/tree/bzlmod-bazel-8), which contains my work on bazelbuild/rules_scala#1482 and bazelbuild/rules_scala#1687, this causes several `dt_patches/dt_patch_test.sh` test cases to fail.\n\nThe failing `test_compiler_srcjar` cases, which check for `! grep \"canonical reproducible\"`, appear towards the end (formatting slightly to split `DEBUG:` messages on separate lines):\n\n```txt\n# Assuming `$PWD` is still `dt_patches/test_dt_patches_user_srcjar`\n# after the repro steps above:\n$ cd ..\n\n# `$PWD` should now be `dt_patches/`\n$ USE_BAZEL_VERSION=4c3863e61136a10564f01d920e4f29e142256e7c ./dt_patch_test.sh\n\n[ ...snip... ]\n\nStarting local Bazel server (no_version) and connecting to it...\nINFO: Starting clean (this may take a while). Use --async if the clean takes more than several minutes.\nrunning test test_compiler_srcjar 2.12.14\nDEBUG: Rule 'rules_java++toolchains+remote_java_tools_darwin_arm64' indicated that a canonical reproducible form can be obtained by dropping arguments [\"_original_name\"]\nDEBUG: Rule 'rules_java++toolchains+remote_java_tools' indicated that a canonical reproducible form can be obtained by dropping arguments [\"_original_name\"]\nDEBUG: Rule 'rules_python++python+python_3_11_aarch64-apple-darwin' indicated that a canonical reproducible form can be obtained by dropping arguments [\"_original_name\"]\nDEBUG: Rule 'rules_java++toolchains+remotejdk11_macos_aarch64' indicated that a canonical reproducible form can be obtained by dropping arguments [\"_original_name\"]\nDEBUG: Rule 'rules_java++toolchains+remotejdk21_macos_aarch64' indicated that a canonical reproducible form can be obtained by dropping arguments [\"_original_name\"]\nDEBUG: Rule 'rules_scala++scala_deps+scala_compiler_source_2_12_14' indicated that a canonical reproducible form can be obtained by dropping arguments [\"_original_name\"]\n Test \"test_compiler_srcjar 2.12.14\" failed  (43 sec)\nrunning test test_compiler_srcjar 2.12.15\nDEBUG: Rule 'rules_scala++scala_deps+scala_compiler_source_2_12_15' indicated that a canonical reproducible form can be obtained by dropping arguments [\"_original_name\"]\n Test \"test_compiler_srcjar 2.12.15\" failed  (8 sec)\nrunning test test_compiler_srcjar 2.12.16\nDEBUG: Rule '+compiler_user_srcjar_repos+scala_compiler_srcjar' indicated that a canonical reproducible form can be obtained by dropping arguments [\"_original_name\"]\n Test \"test_compiler_srcjar 2.12.16\" failed  (7 sec)\nrunning test test_compiler_srcjar_nonhermetic 2.12.17\n Test \"test_compiler_srcjar_nonhermetic 2.12.17\" successful (8 sec)\nrunning test test_compiler_srcjar_nonhermetic 2.12.18\n Test \"test_compiler_srcjar_nonhermetic 2.12.18\" successful (8 sec)\nrunning test test_compiler_srcjar_nonhermetic 2.12.19\n Test \"test_compiler_srcjar_nonhermetic 2.12.19\" successful (8 sec)\nrunning test test_compiler_srcjar_nonhermetic 2.12.20\n Test \"test_compiler_srcjar_nonhermetic 2.12.20\" successful (10 sec)\nrunning test test_compiler_srcjar_nonhermetic 2.13.11\n Test \"test_compiler_srcjar_nonhermetic 2.13.11\" successful (7 sec)\nrunning test test_compiler_srcjar_nonhermetic 2.13.12\n Test \"test_compiler_srcjar_nonhermetic 2.13.12\" successful (8 sec)\nrunning test test_compiler_srcjar_nonhermetic 2.13.14\n Test \"test_compiler_srcjar_nonhermetic 2.13.14\" successful (9 sec)\nrunning test test_compiler_srcjar_nonhermetic 2.13.15\n Test \"test_compiler_srcjar_nonhermetic 2.13.15\" successful (8 sec)\nrunning test test_compiler_srcjar 3.1.3\nDEBUG: Rule 'rules_scala++scala_deps+scala_compiler_source_3_1_3' indicated that a canonical reproducible form can be obtained by dropping arguments [\"_original_name\"]\n Test \"test_compiler_srcjar 3.1.3\" failed  (8 sec)\nrunning test test_compiler_srcjar 3.2.2\nDEBUG: Rule 'rules_scala++scala_deps+scala_compiler_source_3_2_2' indicated that a canonical reproducible form can be obtained by dropping arguments [\"_original_name\"]\n Test \"test_compiler_srcjar 3.2.2\" failed  (8 sec)\nrunning test test_compiler_srcjar_nonhermetic 3.3.5\n Test \"test_compiler_srcjar_nonhermetic 3.3.5\" successful (8 sec)\nrunning test test_compiler_srcjar 3.4.3\nDEBUG: Rule '+compiler_user_srcjar_repos+scala3_compiler_srcjar' indicated that a canonical reproducible form can be obtained by dropping arguments [\"_original_name\"]\n Test \"test_compiler_srcjar 3.4.3\" failed  (9 sec)\nrunning test test_compiler_srcjar_nonhermetic 3.5.2\n Test \"test_compiler_srcjar_nonhermetic 3.5.2\" successful (9 sec)\nrunning test test_compiler_srcjar_nonhermetic 3.6.2\n Test \"test_compiler_srcjar_nonhermetic 3.6.2\" successful (10 sec)\n```","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/25192/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/25192/timeline","performed_via_github_app":null,"state_reason":"completed"}