{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/17458","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/17458/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/17458/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/17458/events","html_url":"https://github.com/bazelbuild/bazel/issues/17458","id":1578549974,"node_id":"I_kwDOATz7jc5eFsLW","number":17458,"title":"@bazel_tools//tools/java/runfiles:auto_bazel_repository_processor does not compile with JDK 8","user":{"login":"nacl","id":70147,"node_id":"MDQ6VXNlcjcwMTQ3","avatar_url":"https://avatars.githubusercontent.com/u/70147?v=4","gravatar_id":"","url":"https://api.github.com/users/nacl","html_url":"https://github.com/nacl","followers_url":"https://api.github.com/users/nacl/followers","following_url":"https://api.github.com/users/nacl/following{/other_user}","gists_url":"https://api.github.com/users/nacl/gists{/gist_id}","starred_url":"https://api.github.com/users/nacl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nacl/subscriptions","organizations_url":"https://api.github.com/users/nacl/orgs","repos_url":"https://api.github.com/users/nacl/repos","events_url":"https://api.github.com/users/nacl/events{/privacy}","received_events_url":"https://api.github.com/users/nacl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":1020663976,"node_id":"MDU6TGFiZWwxMDIwNjYzOTc2","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Rules-Java","name":"team-Rules-Java","color":"f1f442","default":false,"description":"Issues for Java rules"},{"id":1020665933,"node_id":"MDU6TGFiZWwxMDIwNjY1OTMz","url":"https://api.github.com/repos/bazelbuild/bazel/labels/untriaged","name":"untriaged","color":"c34ddd","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2023-02-09T20:26:52Z","updated_at":"2023-05-05T18:37:51Z","closed_at":"2023-02-15T19:19:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\nOur internal build uses JDK 11 to build code against JDK 8, using the JDK 8 bootclasspath.  When upgrading to Bazel 6, the Java runfiles library fails to compile:\r\n\r\n```\r\nexternal/bazel_tools/tools/java/runfiles/AutoBazelRepositoryProcessor.java:84: error: method iterate in interface Stream<T#2> cannot be applied to given types;\r\n        Stream.iterate(\r\n              ^\r\n  required: T#1,UnaryOperator<T#1>\r\n  found: TypeElement,(element)-[...]ement,Element::g[...]ement\r\n  reason: cannot infer type-variable(s) T#1\r\n    (actual and formal argument lists differ in length)\r\n  where T#1,T#2 are type-variables:\r\n    T#1 extends Object declared in method <T#1>iterate(T#1,UnaryOperator<T#1>)\r\n    T#2 extends Object declared in interface Stream\r\nTarget @bazel_tools//tools/java/runfiles:auto_bazel_repository_processor failed to build\r\n```\r\n\r\nThis appears to be occurring because the three-argument `Stream.iterate` method used here:\r\n\r\nhttps://github.com/bazelbuild/bazel/blob/338bbc02132da7de8681196b6a0afbb6297038aa/tools/java/runfiles/AutoBazelRepositoryProcessor.java#L84-L90 \r\n\r\ndoes not exist in JDK 8, there is only a [two-argument one](https://docs.oracle.com/javase/8/docs/api/java/util/stream/Stream.html#iterate-T-java.util.function.UnaryOperator-).  It was added in JDK 9 (JDK 11 docs [here](https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/stream/Stream.html#iterate(T,java.util.function.Predicate,java.util.function.UnaryOperator)).\r\n\r\nA simple enough fix would be to replace this `Stream` call with a `for` loop, which seems to work for me locally.  I can prepare a PR should this be desirable.  My understanding is that while Bazel itself needs JDK 11, Bazel should still be able to compile code for JDK 8, including libraries intended to be loaded by end-users like this one.\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\nSince this only uses the standard library, you can just use `javac` from JDK 8 without invoking Bazel:\r\n\r\n```javac tools/java/runfiles/AutoBazelRepositoryProcessor.java```\r\n\r\nReproduced using OpenJDK 11 using the OpenJDK 8 bootclasspath, and OpenJDK 8 itself.\n\n### Which operating system are you running Bazel on?\n\n\nLinux (Alma 8 aarch64, CentOS 7 amd64)\n\n### What is the output of `bazel info release`?\n\n\n6.0.0-vmware\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\n_No response_\n\n### What's the output of `git remote get-url origin; git rev-parse master; git rev-parse HEAD` ?\n\n\n_No response_\n\n### Have you found anything relevant by searching the web?\n\nhttps://github.com/bazelbuild/bazel/issues/17281 is in the same area, but does not correspond to this precise issue.\n\n### Any other information, logs, or outputs that you want to share?\n\n_No response_","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/17458/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/17458/timeline","performed_via_github_app":null,"state_reason":"completed"}