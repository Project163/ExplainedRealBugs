{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/24237","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/24237/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/24237/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/24237/events","html_url":"https://github.com/bazelbuild/bazel/issues/24237","id":2641180140,"node_id":"I_kwDOATz7jc6dbTXs","number":24237,"title":"--worker_extra_flag does not respect worker-key-mnemonic","user":{"login":"AlessandroPatti","id":26909254,"node_id":"MDQ6VXNlcjI2OTA5MjU0","avatar_url":"https://avatars.githubusercontent.com/u/26909254?v=4","gravatar_id":"","url":"https://api.github.com/users/AlessandroPatti","html_url":"https://github.com/AlessandroPatti","followers_url":"https://api.github.com/users/AlessandroPatti/followers","following_url":"https://api.github.com/users/AlessandroPatti/following{/other_user}","gists_url":"https://api.github.com/users/AlessandroPatti/gists{/gist_id}","starred_url":"https://api.github.com/users/AlessandroPatti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AlessandroPatti/subscriptions","organizations_url":"https://api.github.com/users/AlessandroPatti/orgs","repos_url":"https://api.github.com/users/AlessandroPatti/repos","events_url":"https://api.github.com/users/AlessandroPatti/events{/privacy}","received_events_url":"https://api.github.com/users/AlessandroPatti/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":1020665933,"node_id":"MDU6TGFiZWwxMDIwNjY1OTMz","url":"https://api.github.com/repos/bazelbuild/bazel/labels/untriaged","name":"untriaged","color":"c34ddd","default":false,"description":""},{"id":1193206953,"node_id":"MDU6TGFiZWwxMTkzMjA2OTUz","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Local-Exec","name":"team-Local-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Local) team"}],"state":"closed","locked":false,"assignee":{"login":"tjgq","id":4370077,"node_id":"MDQ6VXNlcjQzNzAwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4370077?v=4","gravatar_id":"","url":"https://api.github.com/users/tjgq","html_url":"https://github.com/tjgq","followers_url":"https://api.github.com/users/tjgq/followers","following_url":"https://api.github.com/users/tjgq/following{/other_user}","gists_url":"https://api.github.com/users/tjgq/gists{/gist_id}","starred_url":"https://api.github.com/users/tjgq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjgq/subscriptions","organizations_url":"https://api.github.com/users/tjgq/orgs","repos_url":"https://api.github.com/users/tjgq/repos","events_url":"https://api.github.com/users/tjgq/events{/privacy}","received_events_url":"https://api.github.com/users/tjgq/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"tjgq","id":4370077,"node_id":"MDQ6VXNlcjQzNzAwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4370077?v=4","gravatar_id":"","url":"https://api.github.com/users/tjgq","html_url":"https://github.com/tjgq","followers_url":"https://api.github.com/users/tjgq/followers","following_url":"https://api.github.com/users/tjgq/following{/other_user}","gists_url":"https://api.github.com/users/tjgq/gists{/gist_id}","starred_url":"https://api.github.com/users/tjgq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjgq/subscriptions","organizations_url":"https://api.github.com/users/tjgq/orgs","repos_url":"https://api.github.com/users/tjgq/repos","events_url":"https://api.github.com/users/tjgq/events{/privacy}","received_events_url":"https://api.github.com/users/tjgq/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":2,"created_at":"2024-11-07T14:25:09Z","updated_at":"2024-11-22T23:31:23Z","closed_at":"2024-11-08T11:48:22Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\nThe `worker-key-mnemonic` execution info allows sharing the same worker across multiple actions using different mnemonics by overriding the mnemonic that identifies the worker. This allows avoiding spawning multiple, usually resource intensive, workers for different actions that use the same worker executable. However, this does not work with `--worker_extra_flag=<mnemonic>=<flag>` since the mnemonic in this syntax is not the worker mnemonic, but the action mnemonic. This results in spawning multiple worker, nullifying the effect of the execution info, unless the same flags are specified for all the mnemonic using the worker.\n\n### Which category does this issue belong to?\n\nRules API\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\nCreate a rule with two actions:\r\n```\r\nctx.actions.run(\r\n    mnemonic = \"Foo\",\r\n    executable = ctx.executable._worker,\r\n    execution_info = {\"worker-key-mnemonic\": \"Foo\"},\r\n    ...\r\n)\r\nctx.actions.run(\r\n    mnemonic = \"Bar\",\r\n    executable = ctx.executable._worker,\r\n    execution_info = {\"worker-key-mnemonic\": \"Foo\"},\r\n    ...\r\n)\r\n```\r\nThe build a target of that rule passing `--worker_extra_flag=Foo=--bar` and see two workers spawned.\n\n### Which operating system are you running Bazel on?\n\n\nUbuntu\n\n### What is the output of `bazel info release`?\n\n\nrelease 6.5.0\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\n_No response_\n\n### What's the output of `git remote get-url origin; git rev-parse HEAD` ?\n\n\n_No response_\n\n### If this is a regression, please try to identify the Bazel commit where the bug was introduced with bazelisk --bisect.\n\n\n_No response_\n\n### Have you found anything relevant by searching the web?\n\n_No response_\n\n### Any other information, logs, or outputs that you want to share?\n\n_No response_","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/24237/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/24237/timeline","performed_via_github_app":null,"state_reason":"completed"}