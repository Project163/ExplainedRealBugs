{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/18755","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18755/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18755/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18755/events","html_url":"https://github.com/bazelbuild/bazel/issues/18755","id":1771412423,"node_id":"I_kwDOATz7jc5plZvH","number":18755,"title":"Silent failure when credentials file is malformed","user":{"login":"stgpetrovic","id":194756,"node_id":"MDQ6VXNlcjE5NDc1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/194756?v=4","gravatar_id":"","url":"https://api.github.com/users/stgpetrovic","html_url":"https://github.com/stgpetrovic","followers_url":"https://api.github.com/users/stgpetrovic/followers","following_url":"https://api.github.com/users/stgpetrovic/following{/other_user}","gists_url":"https://api.github.com/users/stgpetrovic/gists{/gist_id}","starred_url":"https://api.github.com/users/stgpetrovic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stgpetrovic/subscriptions","organizations_url":"https://api.github.com/users/stgpetrovic/orgs","repos_url":"https://api.github.com/users/stgpetrovic/repos","events_url":"https://api.github.com/users/stgpetrovic/events{/privacy}","received_events_url":"https://api.github.com/users/stgpetrovic/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":192364134,"node_id":"MDU6TGFiZWwxOTIzNjQxMzQ=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P1","name":"P1","color":"d93f0b","default":false,"description":"I'll work on this now. (Assignee required)"},{"id":1020665933,"node_id":"MDU6TGFiZWwxMDIwNjY1OTMz","url":"https://api.github.com/repos/bazelbuild/bazel/labels/untriaged","name":"untriaged","color":"c34ddd","default":false,"description":""},{"id":1193207358,"node_id":"MDU6TGFiZWwxMTkzMjA3MzU4","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Remote-Exec","name":"team-Remote-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Remote) team"}],"state":"closed","locked":false,"assignee":{"login":"tjgq","id":4370077,"node_id":"MDQ6VXNlcjQzNzAwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4370077?v=4","gravatar_id":"","url":"https://api.github.com/users/tjgq","html_url":"https://github.com/tjgq","followers_url":"https://api.github.com/users/tjgq/followers","following_url":"https://api.github.com/users/tjgq/following{/other_user}","gists_url":"https://api.github.com/users/tjgq/gists{/gist_id}","starred_url":"https://api.github.com/users/tjgq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjgq/subscriptions","organizations_url":"https://api.github.com/users/tjgq/orgs","repos_url":"https://api.github.com/users/tjgq/repos","events_url":"https://api.github.com/users/tjgq/events{/privacy}","received_events_url":"https://api.github.com/users/tjgq/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"tjgq","id":4370077,"node_id":"MDQ6VXNlcjQzNzAwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4370077?v=4","gravatar_id":"","url":"https://api.github.com/users/tjgq","html_url":"https://github.com/tjgq","followers_url":"https://api.github.com/users/tjgq/followers","following_url":"https://api.github.com/users/tjgq/following{/other_user}","gists_url":"https://api.github.com/users/tjgq/gists{/gist_id}","starred_url":"https://api.github.com/users/tjgq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tjgq/subscriptions","organizations_url":"https://api.github.com/users/tjgq/orgs","repos_url":"https://api.github.com/users/tjgq/repos","events_url":"https://api.github.com/users/tjgq/events{/privacy}","received_events_url":"https://api.github.com/users/tjgq/received_events","type":"User","user_view_type":"public","site_admin":false},{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":3,"created_at":"2023-06-23T12:53:56Z","updated_at":"2023-06-26T12:52:39Z","closed_at":"2023-06-26T12:52:39Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\nWhen using remote build/remote caching, bazel can authenticate using a `--google_credentials=path/to/creds.json` flag to point to a JSON file containing credentials to authenticate with gcloud. If this flag points to a file that exists but is not valid json (e.g. empty), the bazel server crashes `IllegalArgumentException` and the client silently exists with nothing to report.\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\nPlease see the following repository: https://github.com/stgpetrovic/bazel-creds-errors\r\n\r\nYou can find `reproduce.sh` there, with a full explanation in its `README.md`.\r\n\r\nFor having everything in one place, though, here's a quick way to reproduce it. I have a suggested fix there, but did not want to spend much time on it (e.g. adding test) before it's validated from your side. Let me know if you'd like me to contribute that fix, or a similar one.\r\n\r\nThanks!\r\n\r\n```\r\nB_TMP_DIR=\"/tmp/test_bazel_xxxxxxxxxxxxxx12\"\r\nrm -rf $B_TMP_DIR; mkdir $B_TMP_DIR; pushd $B_TMP_DIR\r\ntouch WORKSPACE\r\necho -e \"cc_binary(name='main', srcs='main.cc')\" >> BUILD\r\necho -e \"void main() {}\" >> main.cc\r\ntouch /tmp/mycredsfile.23213211.json\r\nbazel build //:main --google_credentials=/tmp/mycredsfile.23213211.json --remote_cache=grpcs://remotebuildexecution.googleapis.com\r\necho $?\r\nrm /tmp/mycredsfile.23213211.json\r\npopd\r\nrm -rf $B_TMP_DIR\r\n```\r\n\r\nNote that if the file does not exist (the `IOException` path) is OK since that gets caught and reported.\r\n\r\n```\r\nB_TMP_DIR=\"/tmp/test_bazel_xxxxxxxxxxxxxx12\"\r\nrm -rf $B_TMP_DIR; mkdir $B_TMP_DIR; pushd $B_TMP_DIR\r\ntouch WORKSPACE\r\necho -e \"cc_binary(name='main', srcs='main.cc')\" >> BUILD\r\necho -e \"void main() {}\" >> main.cc\r\nrm /tmp/mycredsfile.23213211.json\r\nbazel build //:main --google_credentials=/tmp/mycredsfile.23213211.json --remote_cache=grpcs://remotebuildexecution.googleapis.com\r\necho $?\r\nrm /tmp/mycredsfile.23213211.json\r\npopd\r\nrm -rf $B_TMP_DIR\r\n```\n\n### Which operating system are you running Bazel on?\n\n\nLinux 6.1.25-1rodete1-amd64\n\n### What is the output of `bazel info release`?\n\n\nrelease 6.2.1\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\n_No response_\n\n### What's the output of `git remote get-url origin; git rev-parse master; git rev-parse HEAD` ?\n\n\n_No response_\n\n### Is this a regression? If yes, please try to identify the Bazel commit where the bug was introduced.\n\n\n_No response_\n\n### Have you found anything relevant by searching the web?\n\n_No response_\n\n### Any other information, logs, or outputs that you want to share?\n\n_No response_","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/18755/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18755/timeline","performed_via_github_app":null,"state_reason":"completed"}