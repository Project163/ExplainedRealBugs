{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/23179","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/23179/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/23179/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/23179/events","html_url":"https://github.com/bazelbuild/bazel/issues/23179","id":2440968333,"node_id":"I_kwDOATz7jc6RfjiN","number":23179,"title":"--incompatible_bazel_test_exec_run_under","user":{"login":"gregestren","id":5130366,"node_id":"MDQ6VXNlcjUxMzAzNjY=","avatar_url":"https://avatars.githubusercontent.com/u/5130366?v=4","gravatar_id":"","url":"https://api.github.com/users/gregestren","html_url":"https://github.com/gregestren","followers_url":"https://api.github.com/users/gregestren/followers","following_url":"https://api.github.com/users/gregestren/following{/other_user}","gists_url":"https://api.github.com/users/gregestren/gists{/gist_id}","starred_url":"https://api.github.com/users/gregestren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gregestren/subscriptions","organizations_url":"https://api.github.com/users/gregestren/orgs","repos_url":"https://api.github.com/users/gregestren/repos","events_url":"https://api.github.com/users/gregestren/events{/privacy}","received_events_url":"https://api.github.com/users/gregestren/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":192364170,"node_id":"MDU6TGFiZWwxOTIzNjQxNzA=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P2","name":"P2","color":"e99695","default":false,"description":"We'll consider working on this in future. (Assignee optional)"},{"id":1020660688,"node_id":"MDU6TGFiZWwxMDIwNjYwNjg4","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Configurability","name":"team-Configurability","color":"f1f442","default":false,"description":"platforms, toolchains, cquery, select(), config transitions"},{"id":1080536511,"node_id":"MDU6TGFiZWwxMDgwNTM2NTEx","url":"https://api.github.com/repos/bazelbuild/bazel/labels/incompatible-change","name":"incompatible-change","color":"5319e7","default":false,"description":"Incompatible/breaking change"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-07-31T21:17:07Z","updated_at":"2025-02-25T19:21:55Z","closed_at":"2025-02-25T19:21:54Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Motivation\n\n`$ bazel test //:mytest --run_under=//:runner` will call `//:runner` on an exec machine. \n\nBazel currently configures it for the target platform, which is incorrect. \n\n### Description\n\nWith this flag, `//:runner` is configured for the exec platform, where it actually runs.\n\n### Incompatible Flag\n\n--incompatible_bazel_test_exec_run_under\n\n### Migration Guide\n\n1) If you have a `$ bazel test //:mytest --run_under=//:runner` command, add `--incompatible_bazel_test_exec_run_under`.\n\nIf this fails, that means `//:runner` configures itself with target config information. This might be:\n\n - reads target platform properties from `--platforms`\n - reads `--define` or `--//foo` flags that don't propagate from the target to exec config\n - has a `select()` on any of the above.\n\nSince `//:runner` is an execution tool, refactor it so it doesn't have target config dependencies. This may require moving target-configured deps (like some `data` binary) to `//:mytest` and having the test reference them from there.\n\n### In which Bazel LTS version will this incompatible change be enabled?\n\nBazel 8\n\n### Additional Context\n\nMotivation: https://github.com/bazelbuild/bazel/issues/22624\n\n### TODO List\n\n- [x] Implement the incompatible change at Bazel HEAD and guard it behind a flag.\n- [ ] Test the incompatible change with [downstream projects](https://github.com/bazelbuild/continuous-integration/blob/master/docs/downstream-testing.md#bazel-downstream-testing) and inform broken projects.\n- [ ] Flip the incompatible flag at Bazel HEAD.\n- [ ] Delete the incompatible flag and the old behavior at Bazel HEAD.","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/23179/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/23179/timeline","performed_via_github_app":null,"state_reason":"completed"}