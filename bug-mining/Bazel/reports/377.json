{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/21747","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/21747/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/21747/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/21747/events","html_url":"https://github.com/bazelbuild/bazel/issues/21747","id":2197800948,"node_id":"I_kwDOATz7jc6C_8f0","number":21747,"title":"ctx.actions.symlink + building without the bytes misbehaves on Windows","user":{"login":"hauserx","id":32371993,"node_id":"MDQ6VXNlcjMyMzcxOTkz","avatar_url":"https://avatars.githubusercontent.com/u/32371993?v=4","gravatar_id":"","url":"https://api.github.com/users/hauserx","html_url":"https://github.com/hauserx","followers_url":"https://api.github.com/users/hauserx/followers","following_url":"https://api.github.com/users/hauserx/following{/other_user}","gists_url":"https://api.github.com/users/hauserx/gists{/gist_id}","starred_url":"https://api.github.com/users/hauserx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hauserx/subscriptions","organizations_url":"https://api.github.com/users/hauserx/orgs","repos_url":"https://api.github.com/users/hauserx/repos","events_url":"https://api.github.com/users/hauserx/events{/privacy}","received_events_url":"https://api.github.com/users/hauserx/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":192364170,"node_id":"MDU6TGFiZWwxOTIzNjQxNzA=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P2","name":"P2","color":"e99695","default":false,"description":"We'll consider working on this in future. (Assignee optional)"},{"id":1020660006,"node_id":"MDU6TGFiZWwxMDIwNjYwMDA2","url":"https://api.github.com/repos/bazelbuild/bazel/labels/area-Windows","name":"area-Windows","color":"a4fc20","default":false,"description":"Windows-specific issues and feature requests"},{"id":1193207358,"node_id":"MDU6TGFiZWwxMTkzMjA3MzU4","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Remote-Exec","name":"team-Remote-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Remote) team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2024-03-20T15:16:23Z","updated_at":"2025-10-30T13:19:50Z","closed_at":"2025-10-30T13:19:50Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\r\n\r\n\r\n\r\nThe issue seems to be that if built normally, the `builder_reset\\builder.exe` created in `rules_go` below through `ctx.actions.symlink` ([link](https://github.com/bazelbuild/rules_go/blob/aeb83e878033ef357642c87122e193df44da03fe/go/private/rules/transition.bzl#L287C9-L287C28)) is a regular file when run without cache, but is JUNCTION when taken from remote cache. \r\n\r\nLooks like junctions for files do not work well under Windows.\r\n\r\nBelow reproduction on hello world example using rules_go: https://github.com/hauserx/rules-go-startup\r\n\r\n```\r\nAfter regular build:\r\n\r\n> dir C:\\b\\execroot\\_main\\bazel-out\\x64_windows-opt-exec-ST-13d3ddad9198\\bin\\external\\go_sdk\\builder_reset\r\n2024-03-20  15:57         5,992,448 builder.exe\r\n\r\nAfter taking from remote cache:\r\n\r\n> dir C:\\b\\execroot\\_main\\bazel-out\\x64_windows-opt-exec-ST-13d3ddad9198\\bin\\external\\go_sdk\\builder_reset\r\n2024-03-20  15:48    <JUNCTION>     builder.exe [C:\\b\\execroot\\_main\\bazel-out\\x64_windows-opt-exec-ST-13d3ddad9198\\bin\\external\\go_sdk\\builder.exe]\r\n\r\n```\r\n\r\n```\r\n>bazel clean\r\nStarting local Bazel server and connecting to it...\r\nINFO: Starting clean.\r\n\r\n>bazel build :hello --remote_cache=<remote cache>\r\nTarget //:hello up-to-date:\r\n  bazel-bin/hello_/hello.exe\r\nINFO: Build completed successfully, 11 total actions\r\n\r\n>bazel clean\r\nINFO: Starting clean.\r\n\r\n>bazel build :hello --remote_cache=<remote cache>\r\nINFO: 11 processes: 4 remote cache hit, 7 internal.\r\nINFO: Build completed successfully, 11 total actions\r\n\r\n>bazel build :hello\r\nINFO: Analyzed target //:hello (0 packages loaded, 0 targets configured).\r\nERROR: C:/b/external/io_bazel_rules_go/BUILD.bazel:42:7: GoStdlib external/io_bazel_rules_go/stdlib_/pkg failed: (Exit -1): builder.exe failed: error executing GoStdlib command (from target @@io_bazel_rules_go//:stdlib) bazel-out\\x64_windows-opt-exec-ST-13d3ddad9198\\bin\\external\\go_sdk\\builder_reset\\builder.exe stdlib -sdk external/go_sdk -installsuffix windows_amd64 -out ... (remaining 5 arguments skipped)\r\nAction failed to execute: java.io.IOException: ERROR: src/main/native/windows/process.cc(202): CreateProcessW(\"C:\\b\\execroot\\_main\\bazel-out\\x64_windows-opt-exec-ST-13d3ddad9198\\bin\\external\\go_sdk\\builder_reset\\builder.exe\" stdlib -sdk external/go_sdk -installsuffix windows_amd64 -out bazel-out/x64_windows-fastbuild/bin/external/io_bazel_rules_go/stdlib_ -package std -gcflags \"\"): Access is denied.\r\n (error: 5)\r\nTarget //:hello failed to build\r\nUse --verbose_failures to see the command lines of failed build steps.\r\nINFO: Elapsed time: 26.594s, Critical Path: 25.80s\r\nINFO: 3 processes: 2 internal, 1 local.\r\nERROR: Build did NOT complete successfully\r\n```\r\n\r\n### Which category does this issue belong to?\r\n\r\nCore\r\n\r\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\r\n\r\n\r\n_No response_\r\n\r\n### Which operating system are you running Bazel on?\r\n\r\n\r\nWindows\r\n\r\n### What is the output of `bazel info release`?\r\n\r\n\r\nrelease 7.1.0\r\n\r\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\r\n\r\n\r\n_No response_\r\n\r\n### What's the output of `git remote get-url origin; git rev-parse HEAD` ?\r\n\r\n\r\n_No response_\r\n\r\n### Is this a regression? If yes, please try to identify the Bazel commit where the bug was introduced.\r\n\r\n\r\n_No response_\r\n\r\n### Have you found anything relevant by searching the web?\r\n\r\nBelow bug describes some non-deterministic behavior with same symptoms. \r\nhttps://github.com/bazelbuild/bazel/issues/19018\r\nIn contrary this bug is fully reproducible and seems to be caused by build without bytes behavior.\r\n\r\n### Any other information, logs, or outputs that you want to share?\r\n\r\n_No response_","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/21747/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/21747/timeline","performed_via_github_app":null,"state_reason":"completed"}