{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/18696","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18696/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18696/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18696/events","html_url":"https://github.com/bazelbuild/bazel/issues/18696","id":1759074148,"node_id":"I_kwDOATz7jc5o2Vdk","number":18696,"title":"`--experimental_remote_cache_eviction_retries` doesn't evict all metadata causing build failure","user":{"login":"BalestraPatrick","id":3658887,"node_id":"MDQ6VXNlcjM2NTg4ODc=","avatar_url":"https://avatars.githubusercontent.com/u/3658887?v=4","gravatar_id":"","url":"https://api.github.com/users/BalestraPatrick","html_url":"https://github.com/BalestraPatrick","followers_url":"https://api.github.com/users/BalestraPatrick/followers","following_url":"https://api.github.com/users/BalestraPatrick/following{/other_user}","gists_url":"https://api.github.com/users/BalestraPatrick/gists{/gist_id}","starred_url":"https://api.github.com/users/BalestraPatrick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BalestraPatrick/subscriptions","organizations_url":"https://api.github.com/users/BalestraPatrick/orgs","repos_url":"https://api.github.com/users/BalestraPatrick/repos","events_url":"https://api.github.com/users/BalestraPatrick/events{/privacy}","received_events_url":"https://api.github.com/users/BalestraPatrick/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":192364170,"node_id":"MDU6TGFiZWwxOTIzNjQxNzA=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P2","name":"P2","color":"e99695","default":false,"description":"We'll consider working on this in future. (Assignee optional)"},{"id":601152907,"node_id":"MDU6TGFiZWw2MDExNTI5MDc=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/more%20data%20needed","name":"more data needed","color":"bfdadc","default":false,"description":null},{"id":1193207358,"node_id":"MDU6TGFiZWwxMTkzMjA3MzU4","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Remote-Exec","name":"team-Remote-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Remote) team"}],"state":"closed","locked":false,"assignee":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":47,"created_at":"2023-06-15T15:22:55Z","updated_at":"2024-11-30T22:06:45Z","closed_at":"2024-09-09T14:25:50Z","author_association":"MEMBER","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\nHello!\r\n\r\nWe have used `--experimental_remote_cache_eviction_retries=1` with `--remote_download_toplevel` during the last few weeks, and we noticed from our data that in some cases, when Bazel exits with exit code 39, the following invocation will fail with the exact same error. This is not always the case (we have seen it correctly recover in some situations), but for one specific `CppArchive` action, we see it failing in about 1% of our builds.\r\n\r\nThe logs look like the following:\r\n```\r\n# first invocation\r\nERROR: /Users/path/BUILD.bazel:122:16: Linking fl.a failed: Failed to fetch blobs because they do not exist remotely.: Missing digest: 6c23fb8f89c7a10035172c6f6fcadcd37a58078ac7f141bce745ee4dee40899c/159248\r\n...\r\nFound remote cache eviction error, retrying the build...\r\n...\r\n# second invocation\r\nERROR: /Users/path/BUILD.bazel:122:16: Linking fl.a failed: Failed to fetch blobs because they do not exist remotely.: Missing digest: 6c23fb8f89c7a10035172c6f6fcadcd37a58078ac7f141bce745ee4dee40899c/159248\r\n```\r\n\r\nThe only way to recover from this failure seems to be to run `bazel clean` or disable BwtB (`--remote_download_toplevel`).\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\nIn the gRPC log for the second invocation, we see the following:\r\n```\r\n---------------------------------------------------------\r\nmetadata {\r\n  tool_details {\r\n    tool_name: \"bazel\"\r\n    tool_version: \"6.1.0-7ccf98d\" <- don't mind this, we build Bazel from source from our own fork and we currently pass the wrong version even though it's based off the 6.2.0 branch.\r\n  }\r\n  action_id: \"7d45850557079c80512a065d2250586c4ac53cd91a468cc137e1ca59b3e1fbaa\"\r\n  tool_invocation_id: \"007220b0-22de-401e-a407-5d6dd56225bf\"\r\n  correlated_invocations_id: \"cdaeafdf-8dde-44e0-94a6-6dbc3c47c3a6\"\r\n  action_mnemonic: \"CppArchive\"\r\n  target_id: \"//path:lib\"\r\n  configuration_id: \"702272d6c0c9a184ce867b340aaf98a381dfa7e5f316a7a64e42777e966f1345\"\r\n}\r\nstatus {\r\n  code: 1\r\n  message: \"com.google.devtools.build.lib.remote.common.CacheNotFoundException: Missing digest: 6c23fb8f89c7a10035172c6f6fcadcd37a58078ac7f141bce745ee4dee40899c/159248\"\r\n}\r\nmethod_name: \"google.bytestream.ByteStream/Write\"\r\ndetails {\r\n  write {\r\n  }\r\n}\r\nstart_time {\r\n  seconds: 1686831469\r\n  nanos: 922000000\r\n}\r\nend_time {\r\n  seconds: 1686831469\r\n  nanos: 943000000\r\n}\r\n```\n\n### Which operating system are you running Bazel on?\n\n\nmacOS\n\n### What is the output of `bazel info release`?\n\n\n6.2.0 @ 286306e\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\n_No response_\n\n### What's the output of `git remote get-url origin; git rev-parse master; git rev-parse HEAD` ?\n\n\n_No response_\n\n### Is this a regression? If yes, please try to identify the Bazel commit where the bug was introduced.\n\n\n_No response_\n\n### Have you found anything relevant by searching the web?\n\n_No response_\n\n### Any other information, logs, or outputs that you want to share?\n\n_No response_","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/18696/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/18696/timeline","performed_via_github_app":null,"state_reason":"completed"}