{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/20741","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/20741/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/20741/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/20741/events","html_url":"https://github.com/bazelbuild/bazel/issues/20741","id":2064829887,"node_id":"I_kwDOATz7jc57Es2_","number":20741,"title":"Windows remote test error: failed: java.io.IOException: test.err (Permission denied)","user":{"login":"jayconrod","id":164791,"node_id":"MDQ6VXNlcjE2NDc5MQ==","avatar_url":"https://avatars.githubusercontent.com/u/164791?v=4","gravatar_id":"","url":"https://api.github.com/users/jayconrod","html_url":"https://github.com/jayconrod","followers_url":"https://api.github.com/users/jayconrod/followers","following_url":"https://api.github.com/users/jayconrod/following{/other_user}","gists_url":"https://api.github.com/users/jayconrod/gists{/gist_id}","starred_url":"https://api.github.com/users/jayconrod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jayconrod/subscriptions","organizations_url":"https://api.github.com/users/jayconrod/orgs","repos_url":"https://api.github.com/users/jayconrod/repos","events_url":"https://api.github.com/users/jayconrod/events{/privacy}","received_events_url":"https://api.github.com/users/jayconrod/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":192364134,"node_id":"MDU6TGFiZWwxOTIzNjQxMzQ=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P1","name":"P1","color":"d93f0b","default":false,"description":"I'll work on this now. (Assignee required)"},{"id":1020660006,"node_id":"MDU6TGFiZWwxMDIwNjYwMDA2","url":"https://api.github.com/repos/bazelbuild/bazel/labels/area-Windows","name":"area-Windows","color":"a4fc20","default":false,"description":"Windows-specific issues and feature requests"},{"id":1193207358,"node_id":"MDU6TGFiZWwxMTkzMjA3MzU4","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Remote-Exec","name":"team-Remote-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Remote) team"}],"state":"closed","locked":false,"assignee":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2024-01-04T00:44:34Z","updated_at":"2024-02-22T23:37:13Z","closed_at":"2024-01-08T12:34:36Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\nI apologize in advance, I've found another weird Windows remote execution bug.\r\n\r\nWhen using Windows remote execution, I'm seeing `bazel test` invocations fail with messages like:\r\n\r\n```\r\nERROR: C:/actionsrunner/_work/engflow/engflow/test/java/com/engflow/re/integration/auth/BUILD:1:10: Testing //test/java/com/engflow/re/integration/auth:auth failed: java.io.IOException: C:/_b/bpc5uood/execroot/engflow/bazel-out/x64_windows-opt/testlogs/test/java/com/engflow/re/integration/auth/auth/test.err (Permission denied)\r\n```\r\n\r\nThe test is actually failing remotely, but Bazel shouldn't crash. It also fails to complete its BES stream, which is frustrating but not the main issue.\r\n\r\nFrom the message, I'd guess Bazel is opening the file, then attempting to delete it.\r\n\r\nThe `test.err` file exists, is owned by `BUILTIN/Administrators`, and has no special ACLs. No other processes have it open after `bazel test` exits. It can be deleted manually. I think the path comes from [`TestRunnerAction.java`](https://github.com/bazelbuild/bazel/blob/81e1333c2e4e0f7db7cf3e38be750fe8cc58420c/src/main/java/com/google/devtools/build/lib/analysis/test/TestRunnerAction.java#L252C41-L252C49). Its purpose seems to be to hold stderr from tests, however, that's not what's happening here.\r\n\r\nThe thing that triggers this is a new remote execution feature where we populate the [`ExecuteResponse.message`](https://github.com/bazelbuild/remote-apis/blob/d20ae8b97fd3330748e04660343964e6c8a13704/build/bazel/remote/execution/v2/remote_execution.proto#L1486) field. The contents of the `test.err` file match the string that the server puts in that field.\n\n### Which category does this issue belong to?\n\n\nRemote Execution\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\n1. Write a test that fails. I've mainly seen this in Java tests, but I don't believe it's language specific.\r\n2. Run the test from a Windows client on a Windows remote execution service that populates the `ExecuteResponse.message` field.\r\n\r\n(Sorry I realize this isn't going to be easy for anyone else. It reproduces 100% for me though, so if you have code pointers or debugging suggestions, I'll help as much as I can).\n\n### Which operating system are you running Bazel on?\n\n\nWindows Server 2022 / x86_64\n\n### What is the output of `bazel info release`?\n\n\nrelease 8.0.0-pre.20231030.2\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\nn/a\n\n### What's the output of `git remote get-url origin; git rev-parse master; git rev-parse HEAD` ?\n\n\n```text\nn/a\n```\n\n\n### Is this a regression? If yes, please try to identify the Bazel commit where the bug was introduced.\n\n\nNo\n\n### Have you found anything relevant by searching the web?\n\nNo\n\n### Any other information, logs, or outputs that you want to share?\n\nn/a","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/20741/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/20741/timeline","performed_via_github_app":null,"state_reason":"completed"}