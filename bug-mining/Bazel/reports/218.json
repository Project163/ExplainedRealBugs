{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/23305","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/23305/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/23305/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/23305/events","html_url":"https://github.com/bazelbuild/bazel/issues/23305","id":2466575079,"node_id":"I_kwDOATz7jc6TBPLn","number":23305,"title":"Bazel silently exits with status 37 when using --credential_helper with PATH containing an empty element","user":{"login":"jayconrod","id":164791,"node_id":"MDQ6VXNlcjE2NDc5MQ==","avatar_url":"https://avatars.githubusercontent.com/u/164791?v=4","gravatar_id":"","url":"https://api.github.com/users/jayconrod","html_url":"https://github.com/jayconrod","followers_url":"https://api.github.com/users/jayconrod/followers","following_url":"https://api.github.com/users/jayconrod/following{/other_user}","gists_url":"https://api.github.com/users/jayconrod/gists{/gist_id}","starred_url":"https://api.github.com/users/jayconrod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jayconrod/subscriptions","organizations_url":"https://api.github.com/users/jayconrod/orgs","repos_url":"https://api.github.com/users/jayconrod/repos","events_url":"https://api.github.com/users/jayconrod/events{/privacy}","received_events_url":"https://api.github.com/users/jayconrod/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":192364170,"node_id":"MDU6TGFiZWwxOTIzNjQxNzA=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P2","name":"P2","color":"e99695","default":false,"description":"We'll consider working on this in future. (Assignee optional)"},{"id":1193207358,"node_id":"MDU6TGFiZWwxMTkzMjA3MzU4","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Remote-Exec","name":"team-Remote-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Remote) team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2024-08-14T18:43:49Z","updated_at":"2024-10-11T21:18:09Z","closed_at":"2024-08-21T07:50:33Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\nThe `--credential_helper` flag lets the user specify a binary that Bazel should call to obtain credentials for a remote service. The binary may be an absolute path, workspace-relative path, or a name to be resolved with `PATH`.\r\n\r\nThe user can set `PATH` to something that doesn't necessarily make sense. I had an empty element in mine, which causes Bazel to exit with status 37 (internal error). Most tools ignore empty elements.\r\n\r\nI briefly looked through the code to figure out what was going on: at [CommandLinePathFactory.java:137](https://github.com/EngFlow/bazel/blob/0869f45fd3f89c7b56d624fe0b3b34c2e799cb5d/src/main/java/com/google/devtools/build/lib/runtime/CommandLinePathFactory.java#L130), it calls `fileSystem.getPath` with an unsanitized path element. That seems to expect an absolute, normalized path, so the empty string triggers an assertion.\n\n### Which category does this issue belong to?\n\nCLI\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\n1. Set `PATH` with an empty element, like `/bin::/usr/bin`.\r\n2. Run any `bazel` command with `--credential_helper=anything`. `anything` doesn't need to exist.\r\n3. Observe bazel exits with status 37.\n\n### Which operating system are you running Bazel on?\n\n\nmacOS\n\n### What is the output of `bazel info release`?\n\n\nrelease 7.3.0\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\nn/a\n\n### What's the output of `git remote get-url origin; git rev-parse HEAD` ?\n\n\n```text\nn/a\n```\n\n\n### If this is a regression, please try to identify the Bazel commit where the bug was introduced with bazelisk --bisect.\n\n\nn/a\n\n### Have you found anything relevant by searching the web?\n\nn/a\n\n### Any other information, logs, or outputs that you want to share?\n\n`bazel info server_log` didn't contain any related error message. It took me a while to figure out what was causing this.","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/23305/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/23305/timeline","performed_via_github_app":null,"state_reason":"completed"}