{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/24467","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/24467/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/24467/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/24467/events","html_url":"https://github.com/bazelbuild/bazel/issues/24467","id":2684242101,"node_id":"I_kwDOATz7jc6f_ki1","number":24467,"title":"Add a `repository_ctx` field to accommodate default repo target names","user":{"login":"mbland","id":301547,"node_id":"MDQ6VXNlcjMwMTU0Nw==","avatar_url":"https://avatars.githubusercontent.com/u/301547?v=4","gravatar_id":"","url":"https://api.github.com/users/mbland","html_url":"https://github.com/mbland","followers_url":"https://api.github.com/users/mbland/followers","following_url":"https://api.github.com/users/mbland/following{/other_user}","gists_url":"https://api.github.com/users/mbland/gists{/gist_id}","starred_url":"https://api.github.com/users/mbland/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mbland/subscriptions","organizations_url":"https://api.github.com/users/mbland/orgs","repos_url":"https://api.github.com/users/mbland/repos","events_url":"https://api.github.com/users/mbland/events{/privacy}","received_events_url":"https://api.github.com/users/mbland/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503261,"node_id":"MDU6TGFiZWwxMDY1MDMyNjE=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20feature%20request","name":"type: feature request","color":"0052cc","default":false,"description":null},{"id":192364241,"node_id":"MDU6TGFiZWwxOTIzNjQyNDE=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P3","name":"P3","color":"fbca04","default":false,"description":"We're not considering working on this, but happy to review a PR. (No assignee)"},{"id":1020663381,"node_id":"MDU6TGFiZWwxMDIwNjYzMzgx","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-ExternalDeps","name":"team-ExternalDeps","color":"f1f442","default":false,"description":"External dependency handling, remote repositiories, WORKSPACE file."},{"id":2051939153,"node_id":"MDU6TGFiZWwyMDUxOTM5MTUz","url":"https://api.github.com/repos/bazelbuild/bazel/labels/help%20wanted","name":"help wanted","color":"159818","default":true,"description":"Someone outside the Bazel team could own this"}],"state":"closed","locked":false,"assignee":{"login":"fmeum","id":4312191,"node_id":"MDQ6VXNlcjQzMTIxOTE=","avatar_url":"https://avatars.githubusercontent.com/u/4312191?v=4","gravatar_id":"","url":"https://api.github.com/users/fmeum","html_url":"https://github.com/fmeum","followers_url":"https://api.github.com/users/fmeum/followers","following_url":"https://api.github.com/users/fmeum/following{/other_user}","gists_url":"https://api.github.com/users/fmeum/gists{/gist_id}","starred_url":"https://api.github.com/users/fmeum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmeum/subscriptions","organizations_url":"https://api.github.com/users/fmeum/orgs","repos_url":"https://api.github.com/users/fmeum/repos","events_url":"https://api.github.com/users/fmeum/events{/privacy}","received_events_url":"https://api.github.com/users/fmeum/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"fmeum","id":4312191,"node_id":"MDQ6VXNlcjQzMTIxOTE=","avatar_url":"https://avatars.githubusercontent.com/u/4312191?v=4","gravatar_id":"","url":"https://api.github.com/users/fmeum","html_url":"https://github.com/fmeum","followers_url":"https://api.github.com/users/fmeum/followers","following_url":"https://api.github.com/users/fmeum/following{/other_user}","gists_url":"https://api.github.com/users/fmeum/gists{/gist_id}","starred_url":"https://api.github.com/users/fmeum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmeum/subscriptions","organizations_url":"https://api.github.com/users/fmeum/orgs","repos_url":"https://api.github.com/users/fmeum/repos","events_url":"https://api.github.com/users/fmeum/events{/privacy}","received_events_url":"https://api.github.com/users/fmeum/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":5,"created_at":"2024-11-22T18:50:49Z","updated_at":"2025-10-20T22:21:15Z","closed_at":"2025-02-03T19:25:52Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the feature request:\n\n\nA `repository_ctx` parameter holding the original, user-provided `name` value, facilitating the creation of default repo target names without workarounds\n\n### Which category does this issue belong to?\n\nRules API\n\n### What underlying problem are you trying to solve with this feature?\n\n\n[Label supports default target names based on repo names](https://github.com/bazelbuild/bazel/blob/9.0.0-pre.20241105.2/src/main/java/com/google/devtools/build/lib/cmdline/LabelParser.java#L99-L100). For example, `@repo` expands to `@repo//:repo`.\r\n\r\nUnder Bzlmod, `repository_ctx.name` is now the canonical repo name, invalidating previous `repository_rule` implementations that used this value to construct a default target name under `WORKSPACE`. One can work around this issue by adding a separate `attr` to duplicate the `name` parameter of a given `repository` rule, but this degrades the interface somewhat and is potentially error prone.\r\n\r\nI've implemented a pattern in bazelbuild/rules_scala#1650 to wrap a `repository_rule` in a macro to handle this duplication on behalf of the user, keeping the ergonomics of the original rule, but with trade-offs. This came after my first workaround, parsing the original name from `repository_ctx.name`, from bazelbuild/rules_scala#1621 and the withdrawn bazelbuild/bazel-skylib#548. Both flavors of workaround, however, reflect extra effort to grab information already passed as the `name` parameter of a `repository_rule`.\r\n\r\nAs originally discussed with @Wyverald and @fmeum in [a #bzlmod channel thread in the Bazel Slack Workspace](https://bazelbuild.slack.com/archives/C014RARENH0/p1730909824656159), a dedicated `repository_ctx` field would eliminate the need for such workarounds in the future. I'd imagine it could be backported to Bazel 7, and even to Bazel 6, to remove friction from Bzlmod migrations.\n\n### Which operating system are you running Bazel on?\n\n\nN/A\n\n### What is the output of `bazel info release`?\n\n\nN/A\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\nN/A\n\n### What's the output of `git remote get-url origin; git rev-parse HEAD` ?\n\n\n```text\nN/A\n```\n\n\n### Have you found anything relevant by searching the web?\n\nN/A\n\n### Any other information, logs, or outputs that you want to share?\n\nN/A","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/24467/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/24467/timeline","performed_via_github_app":null,"state_reason":"completed"}