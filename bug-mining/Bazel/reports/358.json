{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/26537","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/26537/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/26537/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/26537/events","html_url":"https://github.com/bazelbuild/bazel/issues/26537","id":3227851325,"node_id":"I_kwDOATz7jc7AZRo9","number":26537,"title":"Virtual headers symlink action is not called or creates nothing","user":{"login":"spektrof","id":17802487,"node_id":"MDQ6VXNlcjE3ODAyNDg3","avatar_url":"https://avatars.githubusercontent.com/u/17802487?v=4","gravatar_id":"","url":"https://api.github.com/users/spektrof","html_url":"https://github.com/spektrof","followers_url":"https://api.github.com/users/spektrof/followers","following_url":"https://api.github.com/users/spektrof/following{/other_user}","gists_url":"https://api.github.com/users/spektrof/gists{/gist_id}","starred_url":"https://api.github.com/users/spektrof/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/spektrof/subscriptions","organizations_url":"https://api.github.com/users/spektrof/orgs","repos_url":"https://api.github.com/users/spektrof/repos","events_url":"https://api.github.com/users/spektrof/events{/privacy}","received_events_url":"https://api.github.com/users/spektrof/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":192364241,"node_id":"MDU6TGFiZWwxOTIzNjQyNDE=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P3","name":"P3","color":"fbca04","default":false,"description":"We're not considering working on this, but happy to review a PR. (No assignee)"},{"id":1020664427,"node_id":"MDU6TGFiZWwxMDIwNjY0NDI3","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Rules-CPP","name":"team-Rules-CPP","color":"f1f442","default":false,"description":"Issues for C++ rules"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2025-07-14T08:26:24Z","updated_at":"2025-10-27T20:37:13Z","closed_at":"2025-09-16T10:02:57Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\nThe symlink action for C++ virtual headers is either omitted or generates nothing and seeing non-existing include paths at the compilation command, resulting a build failure.\n\nThis problem only occurs in special cases, with specific project layout.\nMoving the `BUILD.bazel` files to different folders could be an option to fix but I think this shouldn't be a limitation.\n\n\n### Which category does this issue belong to?\n\nC++ Rules\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\nTo reproduce the problem, the project must have a specific layout.\nI have an example project at https://github.com/spektrof/bazel/tree/issues/issues/1 \n\n### Using 'include_prefix'\n\nAdd a library target to `src/prefix/BUILD.bazel` with `include_prefix=\"prefix\"`.\n\nThis case the virtual file and the original file will have the same path but no virtual headers are generated.\n\n``` shell\n$ bazel run //bin:app --config dep_mode2\nprefix/foo.cpp:1:10: error: 'prefix/foo.hpp' file not found with <angled> include; use \"quotes\" instead\n    1 | #include <prefix/foo.hpp>\n      |          ^~~~~~~~~~~~~~~~\n```\n\nEven the command line includes `-Ibazel-out/darwin_x86_64-fastbuild/bin/prefix/_virtual_includes/lib` but no files are there.\n\n``` shell\n$ ls bazel-out/darwin_x86_64-fastbuild/bin/prefix/_virtual_includes/lib\nls: bazel-out/darwin_x86_64-fastbuild/bin/prefix/_virtual_includes/lib: No such file or directory\n```\n\nMoving the library target to a subfolder is working.\n\n``` shell\n$ bazel run //bin:app --config dep_mode4 \nTarget //bin:app up-to-date:\n  bazel-bin/bin/app\nINFO: Elapsed time: 1.897s, Critical Path: 1.60s\nINFO: 8 processes: 6 action cache hit, 4 internal, 4 darwin-sandbox.\nINFO: Build completed successfully, 8 total actions\nINFO: Running command line: bazel-bin/bin/app\nMy lucky number: 42\n```\n\n### Using 'strip_include_prefix'\n\nAdd a library target to `src/BUILD.bazel` with `strip_include_prefix=\".\"`.\n\n``` shell\n$ bazel run //bin:app --config dep_mode1\nprefix/foo.cpp:1:10: error: 'prefix/foo.hpp' file not found with <angled> include; use \"quotes\" instead\n    1 | #include <prefix/foo.hpp>\n```\n\nMoving the library target to a subfolder is working.\n\n``` shell\n$ bazel run //bin:app --config dep_mode3\nINFO: Found 1 target...\nTarget //bin:app up-to-date:\n  bazel-bin/bin/app\nINFO: Elapsed time: 1.104s, Critical Path: 0.87s\nINFO: 4 processes: 10 action cache hit, 3 internal, 1 darwin-sandbox.\nINFO: Build completed successfully, 4 total actions\nINFO: Running command line: bazel-bin/bin/app\nMy lucky number: 42\n```\n\n### Which operating system are you running Bazel on?\n\n\nMacOs Sequoia , RedHat Linux 6+\n\n### What is the output of `bazel info release`?\n\n\nrelease 8.2.1\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\nPlease note that we discovered the issue in release 6.0.0 which is still there in release 8.0.1 and 8.2.1, there weren't any problem in release 5.2.0 as far as I can tell.\n\nFor Bazel 6, we applied a source patch to fix the problem.\n\n### What's the output of `git remote get-url origin; git rev-parse HEAD` ?\n\n\n```text\nhttps://github.com/bazelbuild/bazel.git\ne953910efaed807e320858bf39da9844b2142391\n```\n\n### If this is a regression, please try to identify the Bazel commit where the bug was introduced with bazelisk --bisect.\n\n\n_No response_\n\n### Have you found anything relevant by searching the web?\n\n_No response_\n\n### Any other information, logs, or outputs that you want to share?\n\n_No response_","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/26537/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/26537/timeline","performed_via_github_app":null,"state_reason":"completed"}