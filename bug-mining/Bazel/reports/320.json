{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/25860","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/25860/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/25860/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/25860/events","html_url":"https://github.com/bazelbuild/bazel/issues/25860","id":2996992443,"node_id":"I_kwDOATz7jc6yonm7","number":25860,"title":"Bazel 8.2.0 remote cache timed out regression","user":{"login":"fishy","id":78183,"node_id":"MDQ6VXNlcjc4MTgz","avatar_url":"https://avatars.githubusercontent.com/u/78183?v=4","gravatar_id":"","url":"https://api.github.com/users/fishy","html_url":"https://github.com/fishy","followers_url":"https://api.github.com/users/fishy/followers","following_url":"https://api.github.com/users/fishy/following{/other_user}","gists_url":"https://api.github.com/users/fishy/gists{/gist_id}","starred_url":"https://api.github.com/users/fishy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fishy/subscriptions","organizations_url":"https://api.github.com/users/fishy/orgs","repos_url":"https://api.github.com/users/fishy/repos","events_url":"https://api.github.com/users/fishy/events{/privacy}","received_events_url":"https://api.github.com/users/fishy/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":1020665933,"node_id":"MDU6TGFiZWwxMDIwNjY1OTMz","url":"https://api.github.com/repos/bazelbuild/bazel/labels/untriaged","name":"untriaged","color":"c34ddd","default":false,"description":""},{"id":1193207358,"node_id":"MDU6TGFiZWwxMTkzMjA3MzU4","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Remote-Exec","name":"team-Remote-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Remote) team"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":15,"created_at":"2025-04-15T16:28:08Z","updated_at":"2025-08-21T08:29:43Z","closed_at":"2025-04-24T09:50:02Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\nWe run our CI tests with a remote cache setup with a s3 bucket and a local go http proxy to the s3 bucket, and bazel args of `--remote_cache=http://localhost --remote_proxy=unix:/tmp/bazel_cache_proxy`. There's no remote execution.\n\nIt worked perfectly fine with bazel 8.1.1 and before. But when we try to upgrade to 8.2.0, with the diff of:\n\n```diff\ndiff --git a/.bazelversion b/.bazelversion\nindex 0e79152459..fbb9ea12de 100644\n--- a/.bazelversion\n+++ b/.bazelversion\n@@ -1 +1 @@\n-8.1.1\n+8.2.0\ndiff --git a/MODULE.bazel.lock b/MODULE.bazel.lock\nindex 7219cc582c..06924910b3 100644\n--- a/MODULE.bazel.lock\n+++ b/MODULE.bazel.lock\n@@ -110,10 +110,10 @@\n     \"https://bcr.bazel.build/modules/rules_java/7.2.0/MODULE.bazel\": \"06c0334c9be61e6cef2c8c84a7800cef502063269a5af25ceb100b192453d4ab\",\n     \"https://bcr.bazel.build/modules/rules_java/7.3.2/MODULE.bazel\": \"50dece891cfdf1741ea230d001aa9c14398062f2b7c066470accace78e412bc2\",\n     \"https://bcr.bazel.build/modules/rules_java/7.6.1/MODULE.bazel\": \"2f14b7e8a1aa2f67ae92bc69d1ec0fa8d9f827c4e17ff5e5f02e91caa3b2d0fe\",\n+    \"https://bcr.bazel.build/modules/rules_java/8.11.0/MODULE.bazel\": \"c3d280bc5ff1038dcb3bacb95d3f6b83da8dd27bba57820ec89ea4085da767ad\",\n+    \"https://bcr.bazel.build/modules/rules_java/8.11.0/source.json\": \"302b52a39259a85aa06ca3addb9787864ca3e03b432a5f964ea68244397e7544\",\n     \"https://bcr.bazel.build/modules/rules_java/8.3.2/MODULE.bazel\": \"7336d5511ad5af0b8615fdc7477535a2e4e723a357b6713af439fe8cf0195017\",\n     \"https://bcr.bazel.build/modules/rules_java/8.5.1/MODULE.bazel\": \"d8a9e38cc5228881f7055a6079f6f7821a073df3744d441978e7a43e20226939\",\n-    \"https://bcr.bazel.build/modules/rules_java/8.6.1/MODULE.bazel\": \"f4808e2ab5b0197f094cabce9f4b006a27766beb6a9975931da07099560ca9c2\",\n-    \"https://bcr.bazel.build/modules/rules_java/8.6.1/source.json\": \"f18d9ad3c4c54945bf422ad584fa6c5ca5b3116ff55a5b1bc77e5c1210be5960\",\n     \"https://bcr.bazel.build/modules/rules_jvm_external/4.4.2/MODULE.bazel\": \"a56b85e418c83eb1839819f0b515c431010160383306d13ec21959ac412d2fe7\",\n     \"https://bcr.bazel.build/modules/rules_jvm_external/5.1/MODULE.bazel\": \"33f6f999e03183f7d088c9be518a63467dfd0be94a11d0055fe2d210f89aa909\",\n     \"https://bcr.bazel.build/modules/rules_jvm_external/5.2/MODULE.bazel\": \"d9351ba35217ad0de03816ef3ed63f89d411349353077348a45348b096615036\",\n@@ -582,28 +582,6 @@\n         ]\n       }\n     },\n-    \"@@rules_java+//java:rules_java_deps.bzl%compatibility_proxy\": {\n-      \"general\": {\n-        \"bzlTransitiveDigest\": \"84xJEZ1jnXXwo8BXMprvBm++rRt4jsTu9liBxz0ivps=\",\n-        \"usagesDigest\": \"jTQDdLDxsS43zuRmg1faAjIEPWdLAbDAowI1pInQSoo=\",\n-        \"recordedFileInputs\": {},\n-        \"recordedDirentsInputs\": {},\n-        \"envVariables\": {},\n-        \"generatedRepoSpecs\": {\n-          \"compatibility_proxy\": {\n-            \"repoRuleId\": \"@@rules_java+//java:rules_java_deps.bzl%_compatibility_proxy_repo_rule\",\n-            \"attributes\": {}\n-          }\n-        },\n-        \"recordedRepoMappingEntries\": [\n-          [\n-            \"rules_java+\",\n-            \"bazel_tools\",\n-            \"bazel_tools\"\n-          ]\n-        ]\n-      }\n-    },\n     \"@@rules_kotlin+//src/main/starlark/core/repositories:bzlmod_setup.bzl%rules_kotlin_extensions\": {\n       \"general\": {\n         \"bzlTransitiveDigest\": \"sFhcgPbDQehmbD1EOXzX4H1q/CD5df8zwG4kp4jbvr8=\",\n```\n\nIt suddenly starts to fail the tests with:\n\n```\nERROR: /path/to/BUILD.bazel:157:8: Testing //path/to:to_test failed: Failed to fetch blobs because of a remote cache error.: Download of '/cas/895986e760f9feb60526662e4d39924c4ca7e5d7c59495bc446b00734f0b6f5e' timed out. Received 0 bytes.\n```\n\nWhich would also fail the whole CI run without local fallback.\n\nThe interesting things here are:\n\n1. This fails every time not just randomly. No matter how many times I retry the CI run, with 8.2.0 it always fails with the same error, never succeeded\n2. If I update the go proxy from using `aws-sdk-go` to `aws-sdk-go-v2`, that actually fixes the issue with 8.2.0, but when I try that with 8.1.1, I don't see it actually run faster than `aws-sdk-go`.\n\nThe test that failed with time out is one of the tests with bigger output, so it's possible that the bug only triggers with the combination of 8.2.0 and the cache exceeding some size threshold.\n\n### Which category does this issue belong to?\n\n_No response_\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\n_No response_\n\n### Which operating system are you running Bazel on?\n\n\nlinux\n\n### What is the output of `bazel info release`?\n\n\n`release 8.2.0`\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\n_No response_\n\n### What's the output of `git remote get-url origin; git rev-parse HEAD` ?\n\n\n```text\n\n```\n\n### If this is a regression, please try to identify the Bazel commit where the bug was introduced with bazelisk --bisect.\n\n\nWe only have access to the s3 bucket in the CI environment, so I cannot do the bisect locally. But this is one of the commits between 8.1.1 and 8.2.0\n\n### Have you found anything relevant by searching the web?\n\n_No response_\n\n### Any other information, logs, or outputs that you want to share?\n\n_No response_","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/25860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/25860/timeline","performed_via_github_app":null,"state_reason":"completed"}