{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/20342","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/20342/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/20342/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/20342/events","html_url":"https://github.com/bazelbuild/bazel/issues/20342","id":2014574477,"node_id":"I_kwDOATz7jc54E_eN","number":20342,"title":"Bazel calls GetCapabilities when using Remote Asset API in 7.0.0","user":{"login":"mortenmj","id":489061,"node_id":"MDQ6VXNlcjQ4OTA2MQ==","avatar_url":"https://avatars.githubusercontent.com/u/489061?v=4","gravatar_id":"","url":"https://api.github.com/users/mortenmj","html_url":"https://github.com/mortenmj","followers_url":"https://api.github.com/users/mortenmj/followers","following_url":"https://api.github.com/users/mortenmj/following{/other_user}","gists_url":"https://api.github.com/users/mortenmj/gists{/gist_id}","starred_url":"https://api.github.com/users/mortenmj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mortenmj/subscriptions","organizations_url":"https://api.github.com/users/mortenmj/orgs","repos_url":"https://api.github.com/users/mortenmj/repos","events_url":"https://api.github.com/users/mortenmj/events{/privacy}","received_events_url":"https://api.github.com/users/mortenmj/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":192364134,"node_id":"MDU6TGFiZWwxOTIzNjQxMzQ=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P1","name":"P1","color":"d93f0b","default":false,"description":"I'll work on this now. (Assignee required)"},{"id":1193207358,"node_id":"MDU6TGFiZWwxMTkzMjA3MzU4","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Remote-Exec","name":"team-Remote-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Remote) team"}],"state":"closed","locked":false,"assignee":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":6,"created_at":"2023-11-28T14:29:58Z","updated_at":"2023-12-01T19:28:05Z","closed_at":"2023-11-30T13:11:59Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\r\n\r\n\r\nStarting with https://github.com/bazelbuild/bazel/commit/0d36c6baee286fabef4a5188208a02c61031c762, Bazel will call GetCapabilities on the Asset service when using `--experimental_remote_downloader`.\r\nAs Capabilities is not a part of the Remote Asset v1 API spec, this breaks faithful implementations of the API.\r\n\r\nThis commit, and therefore the error, is not in Bazel 6.4.0 but exists in all 7.0.0 RCs\r\n\r\n### Which category does this issue belong to?\r\n\r\n\r\nRemote Asset\r\n\r\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\r\n\r\n\r\nRun a build/test with Bazel newer than 0d36c6baee286fabef4a5188208a02c61031c762 with `--experimental_remote_downloader`, using an implementation of the Remote Asset API that does not expose Capabilities, e.g. https://github.com/buildbarn/bb-remote-asset\r\n\r\n### Which operating system are you running Bazel on?\r\n\r\n\r\nLinux\r\n\r\n### What is the output of `bazel info release`?\r\n\r\n\r\nrelease 7.0.0rc4\r\n\r\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\r\n\r\n\r\n_No response_\r\n\r\n### What's the output of `git remote get-url origin; git rev-parse master; git rev-parse HEAD` ?\r\n\r\n\r\n_No response_\r\n\r\n### Is this a regression? If yes, please try to identify the Bazel commit where the bug was introduced.\r\n\r\n\r\nThis is a regression. Some existing implementations of Remote Asset are incompatible with Bazel 7.0.0, because they do not expose a service which is not part of the API. The bug was introduced with https://github.com/bazelbuild/bazel/commit/0d36c6baee286fabef4a5188208a02c61031c762\r\n\r\n### Have you found anything relevant by searching the web?\r\n\r\n_No response_\r\n\r\n### Any other information, logs, or outputs that you want to share?\r\n\r\nBazel errors with this message:\r\n\r\n```\r\nERROR: Failed to query remote execution capabilities: UNIMPLEMENTED: unknown service build.bazel.remote.execution.v2.Capabilities\r\nio.grpc.StatusRuntimeException: UNIMPLEMENTED: unknown service build.bazel.remote.execution.v2.Capabilities\r\n        at io.grpc.Status.asRuntimeException(Status.java:535)\r\n        at io.grpc.stub.ClientCalls$UnaryStreamToFuture.onClose(ClientCalls.java:542)\r\n        at io.grpc.internal.DelayedClientCall$DelayedListener$3.run(DelayedClientCall.java:468)\r\n        at io.grpc.internal.DelayedClientCall$DelayedListener.delayOrExecute(DelayedClientCall.java:432)\r\n        at io.grpc.internal.DelayedClientCall$DelayedListener.onClose(DelayedClientCall.java:465)\r\n        at io.grpc.internal.ClientCallImpl.closeObserver(ClientCallImpl.java:562)\r\n        at io.grpc.internal.ClientCallImpl.access$300(ClientCallImpl.java:70)\r\n        at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInternal(ClientCallImpl.java:743)\r\n        at io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInContext(ClientCallImpl.java:722)\r\n        at io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)\r\n        at io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\r\n        at java.base/java.lang.Thread.run(Unknown Source)\r\n```","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/20342/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/20342/timeline","performed_via_github_app":null,"state_reason":"completed"}