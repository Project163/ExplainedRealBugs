{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/24611","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/24611/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/24611/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/24611/events","html_url":"https://github.com/bazelbuild/bazel/issues/24611","id":2727555500,"node_id":"I_kwDOATz7jc6ikzGs","number":24611,"title":"Crash due to `IGNORED_SUBDIRECTORIES` introduced in PR #23999","user":{"login":"jpsim","id":474794,"node_id":"MDQ6VXNlcjQ3NDc5NA==","avatar_url":"https://avatars.githubusercontent.com/u/474794?v=4","gravatar_id":"","url":"https://api.github.com/users/jpsim","html_url":"https://github.com/jpsim","followers_url":"https://api.github.com/users/jpsim/followers","following_url":"https://api.github.com/users/jpsim/following{/other_user}","gists_url":"https://api.github.com/users/jpsim/gists{/gist_id}","starred_url":"https://api.github.com/users/jpsim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jpsim/subscriptions","organizations_url":"https://api.github.com/users/jpsim/orgs","repos_url":"https://api.github.com/users/jpsim/repos","events_url":"https://api.github.com/users/jpsim/events{/privacy}","received_events_url":"https://api.github.com/users/jpsim/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":1020665933,"node_id":"MDU6TGFiZWwxMDIwNjY1OTMz","url":"https://api.github.com/repos/bazelbuild/bazel/labels/untriaged","name":"untriaged","color":"c34ddd","default":false,"description":""},{"id":1182274167,"node_id":"MDU6TGFiZWwxMTgyMjc0MTY3","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Core","name":"team-Core","color":"f1f442","default":false,"description":"Skyframe, bazel query, BEP, options parsing, bazelrc"},{"id":4761864827,"node_id":"LA_kwDOATz7jc8AAAABG9RKew","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Loading-API","name":"team-Loading-API","color":"f1f442","default":false,"description":"BUILD file and macro processing: labels, package(), visibility, glob"}],"state":"closed","locked":false,"assignee":{"login":"lberki","id":3524818,"node_id":"MDQ6VXNlcjM1MjQ4MTg=","avatar_url":"https://avatars.githubusercontent.com/u/3524818?v=4","gravatar_id":"","url":"https://api.github.com/users/lberki","html_url":"https://github.com/lberki","followers_url":"https://api.github.com/users/lberki/followers","following_url":"https://api.github.com/users/lberki/following{/other_user}","gists_url":"https://api.github.com/users/lberki/gists{/gist_id}","starred_url":"https://api.github.com/users/lberki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lberki/subscriptions","organizations_url":"https://api.github.com/users/lberki/orgs","repos_url":"https://api.github.com/users/lberki/repos","events_url":"https://api.github.com/users/lberki/events{/privacy}","received_events_url":"https://api.github.com/users/lberki/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"lberki","id":3524818,"node_id":"MDQ6VXNlcjM1MjQ4MTg=","avatar_url":"https://avatars.githubusercontent.com/u/3524818?v=4","gravatar_id":"","url":"https://api.github.com/users/lberki","html_url":"https://github.com/lberki","followers_url":"https://api.github.com/users/lberki/followers","following_url":"https://api.github.com/users/lberki/following{/other_user}","gists_url":"https://api.github.com/users/lberki/gists{/gist_id}","starred_url":"https://api.github.com/users/lberki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lberki/subscriptions","organizations_url":"https://api.github.com/users/lberki/orgs","repos_url":"https://api.github.com/users/lberki/repos","events_url":"https://api.github.com/users/lberki/events{/privacy}","received_events_url":"https://api.github.com/users/lberki/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":9,"created_at":"2024-12-09T16:04:08Z","updated_at":"2025-02-04T22:45:03Z","closed_at":"2024-12-10T10:25:01Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\nI'm experiencing a new crash in 8.0.0rc8 that doesn't occur in 7.4.1 or 8.0.0rc1, seemingly introduced in https://github.com/bazelbuild/bazel/pull/23999.\r\n\r\nHere's what the crash stack trace looks like:\r\n\r\n```console\r\n$ USE_BAZEL_VERSION=8.0.0rc8 bazel run cli\r\nStarting local Bazel server and connecting to it...\r\nWARNING: Couldn't auto load rules or symbols, because no dependency on module/repository 'rules_android' found. This will result in a failure if there's a reference to those rules or symbols.\r\nAnalyzing: target //:cli (72 packages loaded, 1277 targets configured)\r\n    Fetching repository @@apple_support++apple_cc_configure_extension+local_config_apple_cc; starting\r\nFATAL: bazel crashed due to an internal error. Printing stack trace:\r\njava.lang.RuntimeException: Unrecoverable error while evaluating node 'IGNORED_SUBDIRECTORIES:@@rules_swift_package_manager++swift_deps+swiftpkg_asc_swift' (requested by nodes 'PACKAGE_LOOKUP:@@rules_swift_package_manager++swift_deps+swiftpkg_asc_swift//')\r\n\tat com.google.devtools.build.skyframe.AbstractParallelEvaluator$Evaluate.run(AbstractParallelEvaluator.java:547)\r\n\tat com.google.devtools.build.lib.concurrent.AbstractQueueVisitor$WrappedRunnable.run(AbstractQueueVisitor.java:435)\r\n\tat java.base/java.util.concurrent.ForkJoinTask$RunnableExecuteAction.exec(Unknown Source)\r\n\tat java.base/java.util.concurrent.ForkJoinTask.doExec(Unknown Source)\r\n\tat java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(Unknown Source)\r\n\tat java.base/java.util.concurrent.ForkJoinPool.scan(Unknown Source)\r\n\tat java.base/java.util.concurrent.ForkJoinPool.runWorker(Unknown Source)\r\n\tat java.base/java.util.concurrent.ForkJoinWorkerThread.run(Unknown Source)\r\nCaused by: java.lang.IllegalArgumentException\r\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:131)\r\n\tat com.google.devtools.build.lib.cmdline.IgnoredSubdirectories.of(IgnoredSubdirectories.java:103)\r\n\tat com.google.devtools.build.lib.skyframe.IgnoredSubdirectoriesValue.of(IgnoredSubdirectoriesValue.java:45)\r\n\tat com.google.devtools.build.lib.skyframe.IgnoredSubdirectoriesFunction.compute(IgnoredSubdirectoriesFunction.java:191)\r\n\tat com.google.devtools.build.skyframe.AbstractParallelEvaluator$Evaluate.run(AbstractParallelEvaluator.java:467)\r\n\t... 7 more\r\n```\r\n\r\nInitially reported here: https://github.com/cgrindel/rules_swift_package_manager/issues/1394\n\n### Which category does this issue belong to?\n\nCore, Loading API\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\nTo reproduce (assuming bazelisk & Xcode are installed):\r\n\r\n**`MODULE.bazel`**\r\n\r\n```python\r\nbazel_dep(name = \"apple_support\", version = \"1.17.1\")\r\nbazel_dep(name = \"rules_swift\", version = \"2.2.4\")\r\nbazel_dep(name = \"rules_swift_package_manager\", version = \"0.42.0\")\r\n\r\nswift_deps = use_extension(\r\n    \"@rules_swift_package_manager//:extensions.bzl\",\r\n    \"swift_deps\",\r\n)\r\nswift_deps.from_package(\r\n    resolved = \"//:Package.resolved\",\r\n    swift = \"//:Package.swift\",\r\n)\r\nuse_repo(\r\n    swift_deps,\r\n    \"swift_package\",\r\n    \"swiftpkg_asc_swift\",\r\n)\r\n```\r\n\r\n**`Package.swift`**\r\n\r\n```swift\r\n// swift-tools-version: 5.10\r\n\r\nimport PackageDescription\r\n\r\nlet package = Package(\r\n    name: \"basic_bazel_swift_cli\",\r\n    dependencies: [\r\n        .package(url: \"https://github.com/aaronsky/asc-swift\", from: \"1.2.0\"),\r\n    ]\r\n)\r\n```\r\n\r\n**`main.swift`**\r\n\r\n```swift\r\nimport AppStoreConnect\r\n\r\nprint(\"Hello world\")\r\n```\r\n\r\n**`BUILD`**\r\n\r\n```python\r\nload(\"@rules_swift//swift:swift_binary.bzl\", \"swift_binary\")\r\n\r\nswift_binary(\r\n    name = \"cli\",\r\n    srcs = [\"main.swift\"],\r\n    deps = [\r\n        \"@swiftpkg_asc_swift//:AppStoreConnect\",\r\n    ],\r\n)\r\n```\r\n\r\nRun the following:\r\n\r\n```console\r\n$ swift package resolve\r\n$ USE_BAZEL_VERSION=7.4.1 bazel run cli\r\nINFO: Analyzed target //:cli (112 packages loaded, 4071 targets configured).\r\nINFO: Found 1 target...\r\nTarget //:cli up-to-date:\r\n  bazel-bin/cli\r\nINFO: Elapsed time: 195.762s, Critical Path: 189.37s\r\nINFO: 55 processes: 27 internal, 23 darwin-sandbox, 5 worker.\r\nINFO: Build completed successfully, 55 total actions\r\nINFO: Running command line: bazel-bin/cli\r\nHello world\r\n$ USE_BAZEL_VERSION=8.0.0rc8 bazel run cli\r\nStarting local Bazel server and connecting to it...\r\nWARNING: Couldn't auto load rules or symbols, because no dependency on module/repository 'rules_android' found. This will result in a failure if there's a reference to those rules or symbols.\r\nAnalyzing: target //:cli (72 packages loaded, 1277 targets configured)\r\n    Fetching repository @@apple_support++apple_cc_configure_extension+local_config_apple_cc; starting\r\nFATAL: bazel crashed due to an internal error. Printing stack trace:\r\njava.lang.RuntimeException: Unrecoverable error while evaluating node 'IGNORED_SUBDIRECTORIES:@@rules_swift_package_manager++swift_deps+swiftpkg_asc_swift' (requested by nodes 'PACKAGE_LOOKUP:@@rules_swift_package_manager++swift_deps+swiftpkg_asc_swift//')\r\n\tat com.google.devtools.build.skyframe.AbstractParallelEvaluator$Evaluate.run(AbstractParallelEvaluator.java:547)\r\n\tat com.google.devtools.build.lib.concurrent.AbstractQueueVisitor$WrappedRunnable.run(AbstractQueueVisitor.java:435)\r\n\tat java.base/java.util.concurrent.ForkJoinTask$RunnableExecuteAction.exec(Unknown Source)\r\n\tat java.base/java.util.concurrent.ForkJoinTask.doExec(Unknown Source)\r\n\tat java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(Unknown Source)\r\n\tat java.base/java.util.concurrent.ForkJoinPool.scan(Unknown Source)\r\n\tat java.base/java.util.concurrent.ForkJoinPool.runWorker(Unknown Source)\r\n\tat java.base/java.util.concurrent.ForkJoinWorkerThread.run(Unknown Source)\r\nCaused by: java.lang.IllegalArgumentException\r\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:131)\r\n\tat com.google.devtools.build.lib.cmdline.IgnoredSubdirectories.of(IgnoredSubdirectories.java:103)\r\n\tat com.google.devtools.build.lib.skyframe.IgnoredSubdirectoriesValue.of(IgnoredSubdirectoriesValue.java:45)\r\n\tat com.google.devtools.build.lib.skyframe.IgnoredSubdirectoriesFunction.compute(IgnoredSubdirectoriesFunction.java:191)\r\n\tat com.google.devtools.build.skyframe.AbstractParallelEvaluator$Evaluate.run(AbstractParallelEvaluator.java:467)\r\n\t... 7 more\r\n```\n\n### Which operating system are you running Bazel on?\n\n\nmacOS 15.1.1 (24B91)\n\n### What is the output of `bazel info release`?\n\n\nrelease 8.0.0rc8\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\n_No response_\n\n### What's the output of `git remote get-url origin; git rev-parse HEAD` ?\n\n\n_No response_\n\n### If this is a regression, please try to identify the Bazel commit where the bug was introduced with bazelisk --bisect.\n\n\n8bfb921004ade0a05e80dfbbaf0083512574a424\n\n### Have you found anything relevant by searching the web?\n\n_No response_\n\n### Any other information, logs, or outputs that you want to share?\n\nInitially reported here: https://github.com/cgrindel/rules_swift_package_manager/issues/1394","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/24611/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/24611/timeline","performed_via_github_app":null,"state_reason":"completed"}