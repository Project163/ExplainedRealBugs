{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/26262","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/26262/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/26262/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/26262/events","html_url":"https://github.com/bazelbuild/bazel/issues/26262","id":3136479492,"node_id":"I_kwDOATz7jc668uEE","number":26262,"title":"`--incompatible_compact_repo_mapping_manifest`","user":{"login":"fmeum","id":4312191,"node_id":"MDQ6VXNlcjQzMTIxOTE=","avatar_url":"https://avatars.githubusercontent.com/u/4312191?v=4","gravatar_id":"","url":"https://api.github.com/users/fmeum","html_url":"https://github.com/fmeum","followers_url":"https://api.github.com/users/fmeum/followers","following_url":"https://api.github.com/users/fmeum/following{/other_user}","gists_url":"https://api.github.com/users/fmeum/gists{/gist_id}","starred_url":"https://api.github.com/users/fmeum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmeum/subscriptions","organizations_url":"https://api.github.com/users/fmeum/orgs","repos_url":"https://api.github.com/users/fmeum/repos","events_url":"https://api.github.com/users/fmeum/events{/privacy}","received_events_url":"https://api.github.com/users/fmeum/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":192364170,"node_id":"MDU6TGFiZWwxOTIzNjQxNzA=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P2","name":"P2","color":"e99695","default":false,"description":"We'll consider working on this in future. (Assignee optional)"},{"id":1020663381,"node_id":"MDU6TGFiZWwxMDIwNjYzMzgx","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-ExternalDeps","name":"team-ExternalDeps","color":"f1f442","default":false,"description":"External dependency handling, remote repositiories, WORKSPACE file."},{"id":1080536511,"node_id":"MDU6TGFiZWwxMDgwNTM2NTEx","url":"https://api.github.com/repos/bazelbuild/bazel/labels/incompatible-change","name":"incompatible-change","color":"5319e7","default":false,"description":"Incompatible/breaking change"}],"state":"closed","locked":false,"assignee":{"login":"fmeum","id":4312191,"node_id":"MDQ6VXNlcjQzMTIxOTE=","avatar_url":"https://avatars.githubusercontent.com/u/4312191?v=4","gravatar_id":"","url":"https://api.github.com/users/fmeum","html_url":"https://github.com/fmeum","followers_url":"https://api.github.com/users/fmeum/followers","following_url":"https://api.github.com/users/fmeum/following{/other_user}","gists_url":"https://api.github.com/users/fmeum/gists{/gist_id}","starred_url":"https://api.github.com/users/fmeum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmeum/subscriptions","organizations_url":"https://api.github.com/users/fmeum/orgs","repos_url":"https://api.github.com/users/fmeum/repos","events_url":"https://api.github.com/users/fmeum/events{/privacy}","received_events_url":"https://api.github.com/users/fmeum/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"fmeum","id":4312191,"node_id":"MDQ6VXNlcjQzMTIxOTE=","avatar_url":"https://avatars.githubusercontent.com/u/4312191?v=4","gravatar_id":"","url":"https://api.github.com/users/fmeum","html_url":"https://github.com/fmeum","followers_url":"https://api.github.com/users/fmeum/followers","following_url":"https://api.github.com/users/fmeum/following{/other_user}","gists_url":"https://api.github.com/users/fmeum/gists{/gist_id}","starred_url":"https://api.github.com/users/fmeum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fmeum/subscriptions","organizations_url":"https://api.github.com/users/fmeum/orgs","repos_url":"https://api.github.com/users/fmeum/repos","events_url":"https://api.github.com/users/fmeum/events{/privacy}","received_events_url":"https://api.github.com/users/fmeum/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":1,"created_at":"2025-06-11T11:27:30Z","updated_at":"2025-11-03T19:12:04Z","closed_at":"2025-11-03T19:12:04Z","author_association":"COLLABORATOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Motivation\n\nThe size of the `<binary>.repo_mapping` file linked into every runfiles tree is currently quadratic in the largest number of repositories provided by a single module extension. This can result in very large text files (100s of MBs) that are costly to write, store and upload to RBE.\n\n### Description\n\nWith the flag enabled, `<binary>.repo_mapping` contains\n\n```\n+deps+*,aaa,_main\n+deps+*,dep,+deps+dep1\n+deps+*,dep1,+deps+dep1\n+deps+*,dep2,+deps+dep2\n+deps+*,dep3,+deps+dep3\n```\n\ninstead of\n\n```\n+deps+dep1,aaa,_main\n+deps+dep1,dep,+deps+dep1\n+deps+dep1,dep1,+deps+dep1\n+deps+dep1,dep2,+deps+dep2\n+deps+dep1,dep3,+deps+dep3\n+deps+dep2,aaa,_main\n+deps+dep2,dep,+deps+dep1\n+deps+dep2,dep1,+deps+dep1\n+deps+dep2,dep2,+deps+dep2\n+deps+dep2,dep3,+deps+dep3\n...\n```\n\nfor the deps module extension, thus reducing the size to be linear in the number of repos.\n\n### Incompatible Flag\n\n--incompatible_compact_repo_mapping_manifest\n\n### Migration Guide\n\nUsers don't need to take action.\n\nRunfiles libraries have to add support for the new entries, which can be unambiguously detected by the terminal `*` character, which is otherwise illegal in canonical repository names. Libraries are heavily discouraged from relying on the particular structure of canonical names to implement the prefix match and should instead use a sorted map or list for lookups. They can assume that no source repo prefix is a prefix of any other source repo prefix or full name.\n\nThe old format is a subset of the new format and such will continue to be supported by runfiles libraries that have been updated to support the new format.\n\n### In which Bazel LTS version will this incompatible change be enabled?\n\nBazel 9\n\n### Additional Context\n\n_No response_\n\n### TODO List\n\nUpdate the following runfiles libraries:\n- [x] https://github.com/bazelbuild/rules_shell/pull/32\n- [x] https://github.com/bazelbuild/rules_cc/pull/417\n- [x] https://github.com/bazelbuild/rules_java/pull/301\n- [x] https://github.com/bazel-contrib/rules_python/issues/3022\n- [x] https://github.com/bazel-contrib/rules_go/pull/4375\n\nOther libraries will have to be updated by the community.\n","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/26262/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/26262/timeline","performed_via_github_app":null,"state_reason":"completed"}