{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/19988","repository_url":"https://api.github.com/repos/bazelbuild/bazel","labels_url":"https://api.github.com/repos/bazelbuild/bazel/issues/19988/labels{/name}","comments_url":"https://api.github.com/repos/bazelbuild/bazel/issues/19988/comments","events_url":"https://api.github.com/repos/bazelbuild/bazel/issues/19988/events","html_url":"https://github.com/bazelbuild/bazel/issues/19988","id":1969039092,"node_id":"I_kwDOATz7jc51XSb0","number":19988,"title":"7.0rc2 java.lang.NullPointerException: input File:path/to/foo.pic.o.d belongs to a tree artifact whose metadata is missing","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":106503259,"node_id":"MDU6TGFiZWwxMDY1MDMyNTk=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/type:%20bug","name":"type: bug","color":"0052cc","default":false,"description":null},{"id":192364134,"node_id":"MDU6TGFiZWwxOTIzNjQxMzQ=","url":"https://api.github.com/repos/bazelbuild/bazel/labels/P1","name":"P1","color":"d93f0b","default":false,"description":"I'll work on this now. (Assignee required)"},{"id":1193207358,"node_id":"MDU6TGFiZWwxMTkzMjA3MzU4","url":"https://api.github.com/repos/bazelbuild/bazel/labels/team-Remote-Exec","name":"team-Remote-Exec","color":"f1f442","default":false,"description":"Issues and PRs for the Execution (Remote) team"}],"state":"closed","locked":false,"assignee":{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"coeuvre","id":5947531,"node_id":"MDQ6VXNlcjU5NDc1MzE=","avatar_url":"https://avatars.githubusercontent.com/u/5947531?v=4","gravatar_id":"","url":"https://api.github.com/users/coeuvre","html_url":"https://github.com/coeuvre","followers_url":"https://api.github.com/users/coeuvre/followers","following_url":"https://api.github.com/users/coeuvre/following{/other_user}","gists_url":"https://api.github.com/users/coeuvre/gists{/gist_id}","starred_url":"https://api.github.com/users/coeuvre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coeuvre/subscriptions","organizations_url":"https://api.github.com/users/coeuvre/orgs","repos_url":"https://api.github.com/users/coeuvre/repos","events_url":"https://api.github.com/users/coeuvre/events{/privacy}","received_events_url":"https://api.github.com/users/coeuvre/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":4,"created_at":"2023-10-30T19:08:44Z","updated_at":"2023-12-04T21:28:07Z","closed_at":"2023-10-31T14:31:37Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Description of the bug:\n\n\nWhile experimenting with Bazel 7.0rc2, I have run into multiple crashes with the following stack trace. These actions compile source code which is generated by another action during the build. The outputs of the code generator are unknown in advance, and so they are emitted into a tree artifact.\r\n\r\n```\r\nFATAL: bazel crashed due to an internal error. Printing stack trace:\r\njava.lang.RuntimeException: Unrecoverable error while evaluating node 'ActionLookupData0{actionLookupKey=ActionTemplateExpansionKey{actionLookupKey=ConfiguredTargetKey{label=//mypackage:mylabel, config=BuildConfigurationKey[digest]}, actionIndex=0}, actionIndex=0}' (requested by nodes 'File:[[<execution_root>]bazel-out/k8-dbg-obj/bin]mypackage/_pic_objs/mylabel/mysubdir')\r\n        at com.google.devtools.build.skyframe.AbstractParallelEvaluator$Evaluate.run(AbstractParallelEvaluator.java:550)\r\n        at com.google.devtools.build.lib.concurrent.AbstractQueueVisitor$WrappedRunnable.run(AbstractQueueVisitor.java:414)\r\n        at java.base/java.util.concurrent.ForkJoinTask$RunnableExecuteAction.exec(Unknown Source)\r\n        at java.base/java.util.concurrent.ForkJoinTask.doExec(Unknown Source)\r\n        at java.base/java.util.concurrent.ForkJoinPool$WorkQueue.topLevelExec(Unknown Source)\r\n        at java.base/java.util.concurrent.ForkJoinPool.scan(Unknown Source)\r\n        at java.base/java.util.concurrent.ForkJoinPool.runWorker(Unknown Source)\r\n        at java.base/java.util.concurrent.ForkJoinWorkerThread.run(Unknown Source)\r\nCaused by: java.lang.NullPointerException: input File:[[<execution_root>]bazel-out/k8-dbg-obj/bin]mypackage/_pic_dotd/mylabel/mysubdir/foo.pic.o.d belongs to a tree artifact whose metadata is missing\r\n        at com.google.common.base.Preconditions.checkNotNull(Preconditions.java:1010)\r\n        at com.google.devtools.build.lib.remote.AbstractActionInputPrefetcher.maybeGetSymlink(AbstractActionInputPrefetcher.java:408)\r\n        at com.google.devtools.build.lib.remote.AbstractActionInputPrefetcher.prefetchFile(AbstractActionInputPrefetcher.java:336)\r\n        at com.google.devtools.build.lib.remote.AbstractActionInputPrefetcher.lambda$prefetchFiles$0(AbstractActionInputPrefetcher.java:299)\r\n        at io.reactivex.rxjava3.internal.operators.flowable.FlowableFlatMapSingle$FlatMapSingleSubscriber.onNext(FlowableFlatMapSingle.java:118)\r\n        at io.reactivex.rxjava3.internal.operators.flowable.FlowableFromIterable$IteratorSubscription.fastPath(FlowableFromIterable.java:185)\r\n        at io.reactivex.rxjava3.internal.operators.flowable.FlowableFromIterable$BaseRangeSubscription.request(FlowableFromIterable.java:129)\r\n        at io.reactivex.rxjava3.internal.operators.flowable.FlowableFlatMapSingle$FlatMapSingleSubscriber.onSubscribe(FlowableFlatMapSingle.java:106)\r\n        at io.reactivex.rxjava3.internal.operators.flowable.FlowableFromIterable.subscribe(FlowableFromIterable.java:69)\r\n        at io.reactivex.rxjava3.internal.operators.flowable.FlowableFromIterable.subscribeActual(FlowableFromIterable.java:47)\r\n        at io.reactivex.rxjava3.core.Flowable.subscribe(Flowable.java:15917)\r\n        at io.reactivex.rxjava3.internal.operators.flowable.FlowableFlatMapSingle.subscribeActual(FlowableFlatMapSingle.java:53)\r\n        at io.reactivex.rxjava3.core.Flowable.subscribe(Flowable.java:15917)\r\n        at io.reactivex.rxjava3.internal.operators.flowable.FlowableCollectSingle.subscribeActual(FlowableCollectSingle.java:53)\r\n        at io.reactivex.rxjava3.core.Single.subscribe(Single.java:4855)\r\n        at io.reactivex.rxjava3.internal.operators.single.SingleFlatMapCompletable.subscribeActual(SingleFlatMapCompletable.java:44)\r\n        at io.reactivex.rxjava3.core.Completable.subscribe(Completable.java:2859)\r\n        at io.reactivex.rxjava3.internal.operators.completable.CompletablePeek.subscribeActual(CompletablePeek.java:51)\r\n        at io.reactivex.rxjava3.core.Completable.subscribe(Completable.java:2859)\r\n        at com.google.devtools.build.lib.remote.util.RxFutures.toListenableFuture(RxFutures.java:195)\r\n        at com.google.devtools.build.lib.remote.AbstractActionInputPrefetcher.prefetchFiles(AbstractActionInputPrefetcher.java:314)\r\n        at com.google.devtools.build.lib.remote.AbstractActionInputPrefetcher.finalizeAction(AbstractActionInputPrefetcher.java:666)\r\n        at com.google.devtools.build.lib.remote.RemoteOutputService.finalizeAction(RemoteOutputService.java:183)\r\n        at com.google.devtools.build.lib.skyframe.SkyframeActionExecutor$ActionRunner.actuallyCompleteAction(SkyframeActionExecutor.java:1238)\r\n        at com.google.devtools.build.lib.skyframe.SkyframeActionExecutor$ActionRunner.executeAction(SkyframeActionExecutor.java:1171)\r\n        at com.google.devtools.build.lib.skyframe.SkyframeActionExecutor$ActionRunner.run(SkyframeActionExecutor.java:1062)\r\n        at com.google.devtools.build.lib.skyframe.ActionExecutionState.runStateMachine(ActionExecutionState.java:165)\r\n        at com.google.devtools.build.lib.skyframe.ActionExecutionState.getResultOrDependOnFuture(ActionExecutionState.java:94)\r\n        at com.google.devtools.build.lib.skyframe.SkyframeActionExecutor.executeAction(SkyframeActionExecutor.java:559)\r\n        at com.google.devtools.build.lib.skyframe.ActionExecutionFunction.checkCacheAndExecuteIfNeeded(ActionExecutionFunction.java:859)\r\n        at com.google.devtools.build.lib.skyframe.ActionExecutionFunction.computeInternal(ActionExecutionFunction.java:333)\r\n        at com.google.devtools.build.lib.skyframe.ActionExecutionFunction.compute(ActionExecutionFunction.java:171)\r\n        at com.google.devtools.build.skyframe.AbstractParallelEvaluator$Evaluate.run(AbstractParallelEvaluator.java:461)\r\n        ... 7 more\r\n```\n\n### Which category does this issue belong to?\n\n\nRemote Execution\n\n### What's the simplest, easiest way to reproduce this bug? Please provide a minimal example if possible.\n\n\nI don't yet know. I haven't been able to come up with a toy reproduction for this yet.\n\n### Which operating system are you running Bazel on?\n\n\nLinux\n\n### What is the output of `bazel info release`?\n\n\n_No response_\n\n### If `bazel info release` returns `development version` or `(@non-git)`, tell us how you built Bazel.\n\n\n_No response_\n\n### What's the output of `git remote get-url origin; git rev-parse master; git rev-parse HEAD` ?\n\n\n_No response_\n\n### Is this a regression? If yes, please try to identify the Bazel commit where the bug was introduced.\n\n\nhttps://github.com/bazelbuild/bazel/commit/76fcd8d2d0734753adc18dbf5ecaf39f3b833755\r\n\r\nNote: I couldn't use `bazelisk --bisect` this time because, while bisecting, some changes led to unrelated build breaks. I resorted to old school `git bisect` to determine hashes. Still, kudos to the folks at Google who've wired up the CI such that I can feed an arbitrary hash to bazelisk via `USE_BAZEL_VERSION=<hash>` and have things just work. :)\n\n### Have you found anything relevant by searching the web?\n\nNo.\n\n### Any other information, logs, or outputs that you want to share?\n\nI have seen errors like this in the past when experimenting with BwoB, and so we've always avoided BwoB.  However, Bazel 7 is now enabling BwoB features by default, and so I'm using `--remote_download_outputs=all` in an attempt to explicitly disable the feature (including while bisecting).\r\n\r\nIt appears that I can work around this (though I'm not sure of the consequences) by adding `--noexperimental_inmemory_dotd_files` to my command line.","closed_by":{"login":"copybara-service[bot]","id":56741989,"node_id":"MDM6Qm90NTY3NDE5ODk=","avatar_url":"https://avatars.githubusercontent.com/in/44061?v=4","gravatar_id":"","url":"https://api.github.com/users/copybara-service%5Bbot%5D","html_url":"https://github.com/apps/copybara-service","followers_url":"https://api.github.com/users/copybara-service%5Bbot%5D/followers","following_url":"https://api.github.com/users/copybara-service%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/copybara-service%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/copybara-service%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/copybara-service%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/copybara-service%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/copybara-service%5Bbot%5D/repos","events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/copybara-service%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/bazelbuild/bazel/issues/19988/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/bazelbuild/bazel/issues/19988/timeline","performed_via_github_app":null,"state_reason":"completed"}