{"url":"https://api.github.com/repos/fastlane/fastlane/issues/11711","repository_url":"https://api.github.com/repos/fastlane/fastlane","labels_url":"https://api.github.com/repos/fastlane/fastlane/issues/11711/labels{/name}","comments_url":"https://api.github.com/repos/fastlane/fastlane/issues/11711/comments","events_url":"https://api.github.com/repos/fastlane/fastlane/issues/11711/events","html_url":"https://github.com/fastlane/fastlane/issues/11711","id":291947345,"node_id":"MDU6SXNzdWUyOTE5NDczNDU=","number":11711,"title":"last_testflight_build_number returns 1 if \"anything\" goes wrong, resulting in confusion.","user":{"login":"marcpalmer","id":40849,"node_id":"MDQ6VXNlcjQwODQ5","avatar_url":"https://avatars.githubusercontent.com/u/40849?v=4","gravatar_id":"","url":"https://api.github.com/users/marcpalmer","html_url":"https://github.com/marcpalmer","followers_url":"https://api.github.com/users/marcpalmer/followers","following_url":"https://api.github.com/users/marcpalmer/following{/other_user}","gists_url":"https://api.github.com/users/marcpalmer/gists{/gist_id}","starred_url":"https://api.github.com/users/marcpalmer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marcpalmer/subscriptions","organizations_url":"https://api.github.com/users/marcpalmer/orgs","repos_url":"https://api.github.com/users/marcpalmer/repos","events_url":"https://api.github.com/users/marcpalmer/events{/privacy}","received_events_url":"https://api.github.com/users/marcpalmer/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":153483174,"node_id":"MDU6TGFiZWwxNTM0ODMxNzQ=","url":"https://api.github.com/repos/fastlane/fastlane/labels/type:%20bug","name":"type: bug","color":"fc2929","default":false,"description":null},{"id":153483177,"node_id":"MDU6TGFiZWwxNTM0ODMxNzc=","url":"https://api.github.com/repos/fastlane/fastlane/labels/complexity:%20you%20can%20do%20this","name":"complexity: you can do this","color":"eb6420","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2018-01-26T16:00:56Z","updated_at":"2018-04-01T17:35:25Z","closed_at":"2018-01-29T18:12:17Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"\r\n### New Issue Checklist\r\n\r\n- [x] Updated fastlane to the latest version\r\n- [x] I read the [Contribution Guidelines](https://github.com/fastlane/fastlane/blob/master/CONTRIBUTING.md)\r\n- [x] I read [docs.fastlane.tools](https://docs.fastlane.tools)\r\n- [x] I searched for [existing GitHub issues](https://github.com/fastlane/fastlane/issues)\r\n\r\n### Issue Description\r\n\r\n##### Complete output when running fastlane, including the stack trace and command used\r\n[âœ”] ðŸš€ \r\n[15:40:05]: Get started using a Gemfile for fastlane https://docs.fastlane.tools/getting-started/ios/setup/#use-a-gemfile\r\nINFO [2018-01-26 15:40:05.94]: ----------------------------------------\r\nINFO [2018-01-26 15:40:05.94]: --- Step: Verifying fastlane version ---\r\nINFO [2018-01-26 15:40:05.94]: ----------------------------------------\r\nINFO [2018-01-26 15:40:05.94]: Your fastlane version 2.78.0 matches the minimum requirement of 2.73.0  âœ…\r\nINFO [2018-01-26 15:40:05.97]: ------------------------------\r\nINFO [2018-01-26 15:40:05.97]: --- Step: default_platform ---\r\nINFO [2018-01-26 15:40:05.97]: ------------------------------\r\nINFO [2018-01-26 15:40:05.97]: Driving the lane 'ios stock_app_store_submit' ðŸš€\r\nINFO [2018-01-26 15:40:05.97]: --------------------------------------\r\nINFO [2018-01-26 15:40:05.97]: --- Step: mkdir -p ./fastlane_logs ---\r\nINFO [2018-01-26 15:40:05.97]: --------------------------------------\r\nINFO [2018-01-26 15:40:05.97]: $ mkdir -p ./fastlane_logs\r\nINFO [2018-01-26 15:40:05.98]: ------------------------------------------------------\r\nINFO [2018-01-26 15:40:05.98]: --- Step: Switch to ios get_marketing_version lane ---\r\nINFO [2018-01-26 15:40:05.98]: ------------------------------------------------------\r\nINFO [2018-01-26 15:40:05.98]: Cruising over to lane 'ios get_marketing_version' ðŸš–\r\nINFO [2018-01-26 15:40:06.06]: gem 'Xcodeproj' is already installed\r\nINFO [2018-01-26 15:40:06.06]: Cruising back to lane 'ios stock_app_store_submit' ðŸš˜\r\nINFO [2018-01-26 15:40:06.09]: --------------------------------------------\r\nINFO [2018-01-26 15:40:06.09]: --- Step: latest_testflight_build_number ---\r\nINFO [2018-01-26 15:40:06.09]: --------------------------------------------\r\nINFO [2018-01-26 15:40:06.16]: Login to iTunes Connect (XXXX)\r\nLoading session from 'XXXX'\r\nLooking for iTunes Connect Team with ID XXXX\r\nINFO [2018-01-26 15:40:08.40]: Login successful\r\nINFO [2018-01-26 15:40:09.10]: Fetching the latest build number for version 1.1.27\r\nINFO [2018-01-26 15:40:09.10]: Latest upload for version 1.1.27 is build: 1\r\nINFO [2018-01-26 15:40:09.10]: The build number we are using is 1\r\nINFO [2018-01-26 15:40:09.10]: Successfully generated documentation at path '/Users/marc/Projects/checkout/UPStep/skyport/fastlane/README.md'\r\n\r\n+------+------------------------------------------+-------------+\r\n|                       fastlane summary                        |\r\n+------+------------------------------------------+-------------+\r\n| Step | Action                                   | Time (in s) |\r\n+------+------------------------------------------+-------------+\r\n| 1    | Verifying fastlane version               | 0           |\r\n| 2    | default_platform                         | 0           |\r\n| 3    | mkdir -p ./fastlane_logs                 | 0           |\r\n| 4    | Switch to ios get_marketing_version lane | 0           |\r\n| 5    | latest_testflight_build_number           | 3           |\r\n+------+------------------------------------------+-------------+\r\n\r\nINFO [2018-01-26 15:40:09.11]: fastlane.tools finished successfully ðŸŽ‰\r\n\r\n### Environment\r\n\r\n<details><summary>âœ… fastlane environment âœ…</summary>\r\n\r\n### Stack\r\n\r\n| Key                         | Value                                           |\r\n| --------------------------- | ----------------------------------------------- |\r\n| OS                          | 10.12.6                                         |\r\n| Ruby                        | 2.4.2                                           |\r\n| Bundler?                    | false                                           |\r\n| Git                         | git version 2.5.0                               |\r\n| Installation Source         | /usr/local/bin/fastlane                         |\r\n| Host                        | Mac OS X 10.12.6 (16G29)                        |\r\n| Ruby Lib Dir                | /usr/local/Cellar/ruby/2.4.2_1/lib              |\r\n| OpenSSL Version             | OpenSSL 1.0.2l  25 May 2017                     |\r\n| Is contained                | false                                           |\r\n| Is homebrew                 | false                                           |\r\n| Is installed via Fabric.app | false                                           |\r\n| Xcode Path                  | /Applications/Xcode-9.1.app/Contents/Developer/ |\r\n| Xcode Version               | 9.1                                             |\r\n\r\n\r\n### System Locale\r\n\r\n| Variable | Value       |   |\r\n| -------- | ----------- | - |\r\n| LANG     | en_GB.UTF-8 | âœ… |\r\n| LC_ALL   |             |   |\r\n| LANGUAGE |             |   |\r\n\r\n\r\n### fastlane files:\r\n\r\nREMOVED\r\n\r\n### fastlane gems\r\n\r\n| Gem      | Version | Update-Status |\r\n| -------- | ------- | ------------- |\r\n| fastlane | 2.78.0  | âœ… Up-To-Date  |\r\n\r\n\r\n### Loaded fastlane plugins:\r\n\r\n**No plugins Loaded**\r\n\r\n\r\n<details><summary><b>Loaded gems</b></summary>\r\n\r\n| Gem                       | Version      |\r\n| ------------------------- | ------------ |\r\n| did_you_mean              | 1.1.0        |\r\n| slack-notifier            | 2.3.2        |\r\n| CFPropertyList            | 2.3.6        |\r\n| claide                    | 1.0.2        |\r\n| colored2                  | 3.1.2        |\r\n| nanaimo                   | 0.2.3        |\r\n| xcodeproj                 | 1.5.3        |\r\n| rouge                     | 2.0.7        |\r\n| xcpretty                  | 0.2.8        |\r\n| terminal-notifier         | 1.8.0        |\r\n| unicode-display_width     | 1.3.0        |\r\n| terminal-table            | 1.8.0        |\r\n| plist                     | 3.4.0        |\r\n| public_suffix             | 2.0.5        |\r\n| addressable               | 2.5.2        |\r\n| multipart-post            | 2.0.0        |\r\n| word_wrap                 | 1.0.0        |\r\n| tty-screen                | 0.6.3        |\r\n| tty-cursor                | 0.5.0        |\r\n| tty-spinner               | 0.8.0        |\r\n| babosa                    | 1.0.2        |\r\n| colored                   | 1.2          |\r\n| highline                  | 1.7.10       |\r\n| commander-fastlane        | 4.4.5        |\r\n| excon                     | 0.59.0       |\r\n| faraday                   | 0.13.1       |\r\n| unf_ext                   | 0.0.7.4      |\r\n| unf                       | 0.1.4        |\r\n| domain_name               | 0.5.20170404 |\r\n| http-cookie               | 1.0.3        |\r\n| faraday-cookie_jar        | 0.0.6        |\r\n| fastimage                 | 2.1.0        |\r\n| gh_inspector              | 1.0.3        |\r\n| json                      | 2.0.4        |\r\n| mini_magick               | 4.5.1        |\r\n| multi_json                | 1.12.2       |\r\n| multi_xml                 | 0.6.0        |\r\n| rubyzip                   | 1.2.1        |\r\n| security                  | 0.1.3        |\r\n| xcpretty-travis-formatter | 1.0.0        |\r\n| dotenv                    | 2.2.1        |\r\n| bundler                   | 1.16.0       |\r\n| faraday_middleware        | 0.12.2       |\r\n| uber                      | 0.1.0        |\r\n| declarative               | 0.0.10       |\r\n| declarative-option        | 0.1.0        |\r\n| representable             | 3.0.4        |\r\n| retriable                 | 3.1.1        |\r\n| mime-types-data           | 3.2016.0521  |\r\n| mime-types                | 3.1          |\r\n| little-plugger            | 1.1.4        |\r\n| logging                   | 2.2.2        |\r\n| jwt                       | 2.1.0        |\r\n| memoist                   | 0.16.0       |\r\n| os                        | 0.9.6        |\r\n| signet                    | 0.8.1        |\r\n| googleauth                | 0.6.2        |\r\n| httpclient                | 2.8.3        |\r\n| google-api-client         | 0.13.6       |\r\n| openssl                   | 2.0.5        |\r\n| io-console                | 0.4.6        |\r\n</details>\r\n\r\n\r\n*generated on:* **2018-01-26**\r\n</details>\r\n\r\nOK so I saw there are a bunch of past issues where `latest_testflight_build_number` returns \"1\" mysteriously.\r\n\r\nI established today, having suffered this, that it returns 1 basically any time something goes wrong. This needs to change IMO it should fail with an error. Returning a bogus value is *never* the right action.\r\n\r\nScenarios I verified that it returns \"1\":\r\n\r\n* Calling `latest_testflight_build_number` with the incorrect team / app ID (e.g. using your enterprise count due to a default in your Appfile instead of your release team/app ID)\r\n* Calling `latest_testflight_build_number` with an app version that has not got any TestFlight releases\r\n\r\nOther past issues have shown this also seems to happen if iTC is down or there is an API endpoint problem.\r\n\r\nCan we please get this to \"raise\" or similar if there is an actual problem extracting the information?","closed_by":{"login":"taquitos","id":1304821,"node_id":"MDQ6VXNlcjEzMDQ4MjE=","avatar_url":"https://avatars.githubusercontent.com/u/1304821?v=4","gravatar_id":"","url":"https://api.github.com/users/taquitos","html_url":"https://github.com/taquitos","followers_url":"https://api.github.com/users/taquitos/followers","following_url":"https://api.github.com/users/taquitos/following{/other_user}","gists_url":"https://api.github.com/users/taquitos/gists{/gist_id}","starred_url":"https://api.github.com/users/taquitos/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/taquitos/subscriptions","organizations_url":"https://api.github.com/users/taquitos/orgs","repos_url":"https://api.github.com/users/taquitos/repos","events_url":"https://api.github.com/users/taquitos/events{/privacy}","received_events_url":"https://api.github.com/users/taquitos/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/fastlane/fastlane/issues/11711/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fastlane/fastlane/issues/11711/timeline","performed_via_github_app":null,"state_reason":"completed"}