{"url":"https://api.github.com/repos/fastlane/fastlane/issues/11073","repository_url":"https://api.github.com/repos/fastlane/fastlane","labels_url":"https://api.github.com/repos/fastlane/fastlane/issues/11073/labels{/name}","comments_url":"https://api.github.com/repos/fastlane/fastlane/issues/11073/comments","events_url":"https://api.github.com/repos/fastlane/fastlane/issues/11073/events","html_url":"https://github.com/fastlane/fastlane/issues/11073","id":278134384,"node_id":"MDU6SXNzdWUyNzgxMzQzODQ=","number":11073,"title":"[Regression] Unable to find provisioning profile generated by match","user":{"login":"a13xb","id":539049,"node_id":"MDQ6VXNlcjUzOTA0OQ==","avatar_url":"https://avatars.githubusercontent.com/u/539049?v=4","gravatar_id":"","url":"https://api.github.com/users/a13xb","html_url":"https://github.com/a13xb","followers_url":"https://api.github.com/users/a13xb/followers","following_url":"https://api.github.com/users/a13xb/following{/other_user}","gists_url":"https://api.github.com/users/a13xb/gists{/gist_id}","starred_url":"https://api.github.com/users/a13xb/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/a13xb/subscriptions","organizations_url":"https://api.github.com/users/a13xb/orgs","repos_url":"https://api.github.com/users/a13xb/repos","events_url":"https://api.github.com/users/a13xb/events{/privacy}","received_events_url":"https://api.github.com/users/a13xb/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":696635555,"node_id":"MDU6TGFiZWw2OTY2MzU1NTU=","url":"https://api.github.com/repos/fastlane/fastlane/labels/status:%20regression","name":"status: regression","color":"b60205","default":false,"description":null}],"state":"closed","locked":true,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2017-11-30T14:15:55Z","updated_at":"2018-02-02T15:21:39Z","closed_at":"2017-12-04T15:18:03Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### New Issue Checklist\r\n\r\n- [x] Updated fastlane to the latest version\r\n- [x] I read the [Contribution Guidelines](https://github.com/fastlane/fastlane/blob/master/CONTRIBUTING.md)\r\n- [x] I read [docs.fastlane.tools](https://docs.fastlane.tools)\r\n- [x] I searched for [existing GitHub issues](https://github.com/fastlane/fastlane/issues)\r\n\r\n### Issue Description\r\n\r\nXcode 9.1 is struggling to find the ad-hoc provisioning profile managed by `match`. There are a lot of very similar issues floating around, but I couldn't find anything specific to `match`.\r\n\r\nBasically an ad-hoc build fails the archive step with an all-too-familiar error:\r\n> Error Domain=IDEProfileLocatorErrorDomain Code=1 \"No profiles for 'com.example.app' were found\" UserInfo={NSLocalizedDescription=No profiles for 'com.example.app' were found, NSLocalizedRecoverySuggestion=Xcode couldn't find any iOS Ad Hoc provisioning profiles matching 'com.example.app'. Automatic signing is disabled and unable to generate a profile. To enable automatic signing, pass -allowProvisioningUpdates to xcodebuild.}\r\n\r\n`match` definitely installed the provisioning profile and I don't want to enable `-allowProvisioningUpdates` as most workarounds suggest because that would generate and use Xcode-generated profiles.\r\n\r\nWhat I did next:\r\n1. Clear `~/Library/MobileDevice/Provisioning Profiles` (and derived data folder) and resync. The only provisioning profiles left are the wildcard team profiles and one ad-hoc profile created by `match`.\r\n2. Make sure a single signing identity (used by `match`) is left on the machine (delete the others from the keychain).\r\n3. Check that a correct Xcode installation is used by the command line tools (`xcode-select -p`).\r\n\r\nThe build is still failing.\r\n\r\n### Workaround that worked\r\nI noticed that the following export options were generated:\r\n```\r\n{\r\n  \"provisioningProfiles\": {\r\n    \"com.example.app\": \"match AdHoc com.example.app\"\r\n  },\r\n  \"method\": \"ad-hoc\",\r\n  \"signingStyle\": \"automatic\"\r\n}\r\n```\r\n1. If I change `signingStyle` from \"automatic\" to \"manual\" and rerun the export step, it succeeds.\r\n2. If the `signingStyle` option is removed entirely, the build still fails.\r\n\r\nThis seems to have been introduced by #11033 (specifically [by changing from \"manual\" signing style to whatever is set in the project file](https://github.com/fastlane/fastlane/pull/11033/files#diff-1bdc008605f6443a52954ea425ab2430R173)), which is automatic by default. Changing this line back to hardcoded \"manual\" fixes the build.\r\n\r\nBut I don't really want to change project settings for this, because I still want automatic management of development certificates.\r\n\r\n### One more thingâ€¦\r\n\r\nI retried the build on another machine at some point, and lo and behold, it worked perfectly. Same version of Xcode/OSX/Fastlane. Just to be sure I cleared out all provisioning profiles again and the build started failing. I inspected the successful build, and it turned out it used a completely wrong provisioning profile, an old Xcode-managed profile, instead of the match profile as specified. So in some circumstances the build may appear to work if you happen some cached valid provisioning profiles that Xcode happens to find.\r\n\r\n**TL;DR Xcode ignores the provisioning profile specified in export options, unless signing style is set to \"manual\".**\r\n\r\n### Captured Output\r\n\r\nCommand Used: `my_custom_lane`\r\n<details><summary>Output/Log</summary>\r\n\r\n```\r\n\r\nSuccessfully loaded Appfile at path '/Users/USER/ios/fastlane/Appfile'\r\n- apple_id: 'my@apple.id'\r\n-------\r\nSuccessfully loaded Appfile at path '/Users/USER/ios/fastlane/Appfile'\r\n- apple_id: 'my@apple.id'\r\n- team_id: 'XXXXXXXXXX'\r\n- app_identifier: 'com.example.app'\r\n-------\r\n\r\n+------------+----------------------------------+\r\n|  Detected Values from './fastlane/Matchfile'  |\r\n+------------+----------------------------------+\r\n| username   | my@apple.id                      |\r\n| git_url    | git@github.com:company/match.git |\r\n| git_branch | somebranch                       |\r\n+------------+----------------------------------+\r\n\r\n\r\n+-----------------------+----------------------------------+\r\n|                 Summary for match 2.67.0                 |\r\n+-----------------------+----------------------------------+\r\n| type                  | adhoc                            |\r\n| force_for_new_devices | true                             |\r\n| git_url               | git@github.com:company/match.git |\r\n| git_branch            | somebranch                       |\r\n| app_identifier        | com.example.app                  |\r\n| username              | my@apple.id                      |\r\n| keychain_name         | login.keychain                   |\r\n| readonly              | false                            |\r\n| team_id               | XXXXXXXXXX                       |\r\n| verbose               | false                            |\r\n| force                 | false                            |\r\n| skip_confirmation     | false                            |\r\n| shallow_clone         | false                            |\r\n| clone_branch_directly | false                            |\r\n| skip_docs             | false                            |\r\n| platform              | ios                              |\r\n+-----------------------+----------------------------------+\r\n\r\nLoading session from '/Users/USER/.fastlane/spaceship/my@apple.id/cookie'\r\n\r\n+-------------------+-------------------------------------------------------------------------+\r\n|                                    Installed Certificate                                    |\r\n+-------------------+-------------------------------------------------------------------------+\r\n| User ID           | XXXXXXXXXX                                                              |\r\n| Common Name       | iPhone Distribution: ACME, Inc. (XXXXXXXXXX)                            |\r\n| Organisation Unit | XXXXXXXXXX                                                              |\r\n| Organisation      | ACME, Inc.                                                              |\r\n| Country           | US                                                                      |\r\n| Start Datetime    | Feb 26 04:38:57 2017 GMT                                                |\r\n| End Datetime      | Feb 26 04:38:57 2018 GMT                                                |\r\n+-------------------+-------------------------------------------------------------------------+\r\n\r\n\r\n+---------------------+------------------------+------------------------+\r\n|                    Installed Provisioning Profile                     |\r\n+---------------------+------------------------+------------------------+\r\n| Parameter           | Environment Variable   | Value                  |\r\n+---------------------+------------------------+------------------------+\r\n| App Identifier      |                        | com.example.app        |\r\n| Type                |                        | adhoc                  |\r\n| Platform            |                        | ios                    |\r\n| Profile UUID        | sigh_com.example.app_  | d3381967-bc8e-4c78-a4  |\r\n|                     | adhoc                  | 7a-50413b04ca47        |\r\n| Profile Name        | sigh_com.example.app_  | match AdHoc            |\r\n|                     | adhoc_profile-name     | com.example.app        |\r\n| Profile Path        | sigh_com.example.app_  | /Users/USER/Library/M  |\r\n|                     | adhoc_profile-path     | obileDevice/Provision  |\r\n|                     |                        | ing                    |\r\n|                     |                        | Profiles/d3381967-bc8  |\r\n|                     |                        | e-4c78-a47a-50413b04c  |\r\n|                     |                        | a47.mobileprovision    |\r\n| Development Team ID | sigh_com.example.app_  | XXXXXXXXXX             |\r\n|                     | adhoc_team-id          |                        |\r\n+---------------------+------------------------+------------------------+\r\n\r\n\r\n+---------------------+---------------------+\r\n| Detected Values from './fastlane/Gymfile' |\r\n+---------------------+---------------------+\r\n| scheme              | CompanyApp          |\r\n+---------------------+---------------------+\r\n\r\n\r\n+---------------------+---------------------+\r\n| Detected Values from './fastlane/Gymfile' |\r\n+---------------------+---------------------+\r\n| scheme              | CompanyApp          |\r\n+---------------------+---------------------+\r\n\r\n\r\n+--------------------------------------+--------------------------------------+\r\n|                           Summary for gym 2.67.0                            |\r\n+--------------------------------------+--------------------------------------+\r\n| export_method                        | ad-hoc                               |\r\n| export_options.provisioningProfiles  | match AdHoc com.example.app          |\r\n| .com.example.app                     |                                      |\r\n| workspace                            | ./myapp.xcworkspace                  |\r\n| destination                          | generic/platform=iOS                 |\r\n| output_name                          | CompanyApp                           |\r\n| build_path                           | /Users/USER/Library/Developer/Xcode  |\r\n|                                      | /Archives/2017-11-30                 |\r\n| scheme                               | CompanyApp                           |\r\n| clean                                | false                                |\r\n| output_directory                     | .                                    |\r\n| silent                               | false                                |\r\n| skip_package_ipa                     | false                                |\r\n| buildlog_path                        | ~/Library/Logs/gym                   |\r\n| skip_profile_detection               | false                                |\r\n| xcode_path                           | /Applications/Xcode.app              |\r\n+--------------------------------------+--------------------------------------+\r\n\r\n+--------------------------------------+----------------------+\r\n|                   Generated Build Command                   |\r\n+--------------------------------------+----------------------+\r\n| Option                               | Value                |\r\n+--------------------------------------+----------------------+\r\n| set -o pipefail &&                   |                      |\r\n| xcodebuild                           |                      |\r\n| -workspace ./myapp.xcworkspace       |                      |\r\n| -scheme CompanyApp                   |                      |\r\n| -destination                         | generic/platform=iOS |\r\n| -archivePath                         |                      |\r\n| /Users/USER/Library/Developer/Xcode  |                      |\r\n| /Archives/2017-11-30/CompanyApp\\     |                      |\r\n| 2017-11-30\\ 23.56.50.xcarchive       |                      |\r\n| archive                              |                      |\r\n| | tee                                |                      |\r\n| /Users/USER/Library/Logs/gym/Compan  |                      |\r\n| yApp.log                             |                      |\r\n| | xcpretty                           |                      |\r\n+--------------------------------------+----------------------+\r\n+--------------------------------------+--------------------------------------+\r\n|                          Generated Package Command                          |\r\n+--------------------------------------+--------------------------------------+\r\n| Option                               | Value                                |\r\n+--------------------------------------+--------------------------------------+\r\n| /usr/bin/xcrun                       |                                      |\r\n| /Users/USER/.fastlane/bin/bundle/li  |                                      |\r\n| b/ruby/gems/2.2.0/gems/fastlane-2.6  |                                      |\r\n| 7.0/gym/lib/assets/wrap_xcodebuild/  |                                      |\r\n| xcbuild-safe.sh -exportArchive       |                                      |\r\n| -exportOptionsPlist                  | /var/folders/nr/sfqd96m52q76_f0fl1x  |\r\n|                                      | zr8ch0000gn/T/gym_config20171201-67  |\r\n|                                      | 367-129iq3t.plist                    |\r\n| -archivePath                         |                                      |\r\n| /Users/USER/Library/Developer/Xcode  |                                      |\r\n| /Archives/2017-11-30/CompanyApp\\     |                                      |\r\n| 2017-11-30\\ 23.56.50.xcarchive       |                                      |\r\n| -exportPath                          | /var/folders/nr/sfqd96m52q76_f0fl1x  |\r\n|                                      | zr8ch0000gn/T/gym_output20171201-67  |\r\n|                                      | 367-rjrezi                           |\r\n+--------------------------------------+--------------------------------------+\r\n+ xcodebuild -exportArchive -exportOptionsPlist /var/folders/nr/sfqd96m52q76_f0fl1xzr8ch0000gn/T/gym_config20171201-67367-129iq3t.plist -archivePath '/Users/USER/Library/Developer/Xcode/Archives/2017-11-30/CompanyApp 2017-11-30 23.56.50.xcarchive' -exportPath /var/folders/nr/sfqd96m52q76_f0fl1xzr8ch0000gn/T/gym_output20171201-67367-rjrezi\r\n2017-12-01 00:00:24.622 xcodebuild[71282:7072084] [MT] IDEDistribution: -[IDEDistributionLogging _createLoggingBundleAtPath:]: Created bundle at path '/var/folders/nr/sfqd96m52q76_f0fl1xzr8ch0000gn/T/CompanyApp_2017-12-01_00-00-24.621.xcdistributionlogs'.\r\n2017-12-01 00:00:26.846 xcodebuild[71282:7072084] [MT] IDEDistribution: Step failed: <IDEDistributionSigningAssetsStep: 0x7f999c610a70>: Error Domain=IDEDistributionSigningAssetStepErrorDomain Code=0 \"Locating signing assets failed.\" UserInfo={NSLocalizedDescription=Locating signing assets failed., IDEDistributionSigningAssetStepUnderlyingErrors=(\r\n\"Error Domain=IDEProfileLocatorErrorDomain Code=1 \\\"No profiles for 'com.example.app' were found\\\" UserInfo={NSLocalizedDescription=No profiles for 'com.example.app' were found, NSLocalizedRecoverySuggestion=Xcode couldn't find any iOS Ad Hoc provisioning profiles matching 'com.example.app'. Automatic signing is disabled and unable to generate a profile. To enable automatic signing, pass -allowProvisioningUpdates to xcodebuild.}\"\r\n)}\r\nerror: exportArchive: No profiles for 'com.example.app' were found\r\n\r\nError Domain=IDEProfileLocatorErrorDomain Code=1 \"No profiles for 'com.example.app' were found\" UserInfo={NSLocalizedDescription=No profiles for 'com.example.app' were found, NSLocalizedRecoverySuggestion=Xcode couldn't find any iOS Ad Hoc provisioning profiles matching 'com.example.app'. Automatic signing is disabled and unable to generate a profile. To enable automatic signing, pass -allowProvisioningUpdates to xcodebuild.}\r\n\r\n** EXPORT FAILED **\r\n\r\n+---------------+-------------------------+\r\n|            Build environment            |\r\n+---------------+-------------------------+\r\n| xcode_path    | /Applications/Xcode.app |\r\n| gym_version   | 2.67.0                  |\r\n| export_method | ad-hoc                  |\r\n| sdk           | iPhoneOS11.1.sdk        |\r\n+---------------+-------------------------+\r\n\r\n\r\n+------+------------------------+-------------+\r\n|              fastlane summary               |\r\n+------+------------------------+-------------+\r\n| Step | Action                 | Time (in s) |\r\n+------+------------------------+-------------+\r\n| 1    | Verifying required     | 0           |\r\n|      | fastlane version       |             |\r\n| 2    | default_platform       | 0           |\r\n| 3    | ensure_git_status_cle  | 0           |\r\n|      | an                     |             |\r\n| 4    | cocoapods              | 13          |\r\n| 5    | Switch to ios beta     | 0           |\r\n|      | lane                   |             |\r\n| 6    | match                  | 18          |\r\n| ðŸ’¥   | gym                    | 221         |\r\n+------+------------------------+-------------+\r\n\r\n\r\n\r\n```\r\n\r\n</details>\r\n\r\n<details><summary>âœ… fastlane environment âœ…</summary>\r\n\r\n### Stack\r\n\r\n| Key                         | Value                                       |\r\n| --------------------------- | ------------------------------------------- |\r\n| OS                          | 10.12.6                                     |\r\n| Ruby                        | 2.2.4                                       |\r\n| Bundler?                    | false                                       |\r\n| Git                         | git version 2.15.0                          |\r\n| Installation Source         | ~/.fastlane/bin/bundle/bin/fastlane         |\r\n| Host                        | Mac OS X 10.12.6 (16G1036)                  |\r\n| Ruby Lib Dir                | ~/.fastlane/bin/bundle/lib                  |\r\n| OpenSSL Version             | OpenSSL 1.0.2g  1 Mar 2016                  |\r\n| Is contained                | false                                       |\r\n| Is homebrew                 | true                                        |\r\n| Is installed via Fabric.app | false                                       |\r\n| Xcode Path                  | /Applications/Xcode.app/Contents/Developer/ |\r\n| Xcode Version               | 9.1                                         |\r\n\r\n\r\n### System Locale\r\n\r\n| Variable | Value       |   |\r\n| -------- | ----------- | - |\r\n| LANG     | en_US.UTF-8 | âœ… |\r\n| LC_ALL   | en_US.UTF-8 | âœ… |\r\n| LANGUAGE | en_US.UTF-8 | âœ… |\r\n\r\n\r\n### fastlane files:\r\n\r\n<details><summary>`./fastlane/Fastfile`</summary>\r\n\r\n```ruby\r\nfastlane_version \"2.18.3\"\r\ndefault_platform :ios\r\n\r\nplatform :ios do\r\n    before_all do\r\n        ensure_git_status_clean\r\n        cocoapods\r\n    end\r\n\r\n    private_lane :beta do |options|\r\n        match(type: \"adhoc\", force_for_new_devices: true)\r\n        gym(export_method: \"ad-hoc\")\r\n        # ... distribute the build ...\r\n    end\r\n\r\n    desc \"app2 build\"\r\n    lane :company_app2 do |options|\r\n        beta(**options)\r\n    end\r\n\r\n    desc \"app1 build\"\r\n    lane :company_app1 do |options|\r\n        beta(**options)\r\n    end\r\nend\r\n\r\n```\r\n</details>\r\n\r\n<details><summary>`./fastlane/Appfile`</summary>\r\n\r\n```ruby\r\napple_id ENV[\"APPLE_ID\"]\r\n\r\nfor_platform :ios do\r\n    for_lane :company_app2 do\r\n        team_id 'YYYYYYYYYY'\r\n        app_identifier 'com.example.app2'\r\n    end\r\n    for_lane :company_app1 do\r\n        team_id 'XXXXXXXXXX'\r\n        app_identifier 'com.example.app'\r\n    end\r\nend\r\n\r\n```\r\n</details>\r\n\r\n### fastlane gems\r\n\r\n| Gem      | Version | Update-Status |\r\n| -------- | ------- | ------------- |\r\n| fastlane | 2.67.0  | âœ… Up-To-Date  |\r\n\r\n\r\n### Loaded fastlane plugins:\r\n\r\n**No plugins Loaded**\r\n\r\n\r\n<details><summary><b>Loaded gems</b></summary>\r\n\r\n| Gem                       | Version      |\r\n| ------------------------- | ------------ |\r\n| slack-notifier            | 1.5.1        |\r\n| CFPropertyList            | 2.3.5        |\r\n| claide                    | 1.0.2        |\r\n| colored2                  | 3.1.2        |\r\n| nanaimo                   | 0.2.3        |\r\n| xcodeproj                 | 1.5.3        |\r\n| rouge                     | 1.11.1       |\r\n| xcpretty                  | 0.2.6        |\r\n| terminal-notifier         | 1.7.1        |\r\n| unicode-display_width     | 1.1.3        |\r\n| terminal-table            | 1.7.3        |\r\n| plist                     | 3.2.0        |\r\n| public_suffix             | 2.0.5        |\r\n| addressable               | 2.5.1        |\r\n| multipart-post            | 2.0.0        |\r\n| word_wrap                 | 1.0.0        |\r\n| tty-screen                | 0.6.3        |\r\n| babosa                    | 1.0.2        |\r\n| colored                   | 1.2          |\r\n| highline                  | 1.7.8        |\r\n| commander-fastlane        | 4.4.5        |\r\n| excon                     | 0.55.0       |\r\n| faraday                   | 0.12.1       |\r\n| unf_ext                   | 0.0.7.4      |\r\n| unf                       | 0.1.4        |\r\n| domain_name               | 0.5.20170404 |\r\n| http-cookie               | 1.0.3        |\r\n| faraday-cookie_jar        | 0.0.6        |\r\n| fastimage                 | 2.1.0        |\r\n| gh_inspector              | 1.0.3        |\r\n| json                      | 1.8.1        |\r\n| mini_magick               | 4.5.1        |\r\n| multi_json                | 1.12.1       |\r\n| multi_xml                 | 0.6.0        |\r\n| rubyzip                   | 1.2.1        |\r\n| security                  | 0.1.3        |\r\n| xcpretty-travis-formatter | 0.0.4        |\r\n| dotenv                    | 2.2.0        |\r\n| bundler                   | 1.14.6       |\r\n| faraday_middleware        | 0.11.0.1     |\r\n| uber                      | 0.0.15       |\r\n| declarative               | 0.0.9        |\r\n| declarative-option        | 0.1.0        |\r\n| representable             | 3.0.4        |\r\n| retriable                 | 2.1.0        |\r\n| mime-types-data           | 3.2016.0521  |\r\n| mime-types                | 3.1          |\r\n| little-plugger            | 1.1.4        |\r\n| logging                   | 2.2.2        |\r\n| jwt                       | 1.5.6        |\r\n| memoist                   | 0.15.0       |\r\n| os                        | 0.9.6        |\r\n| signet                    | 0.7.3        |\r\n| googleauth                | 0.5.1        |\r\n| httpclient                | 2.8.3        |\r\n| google-api-client         | 0.13.4       |\r\n| psych                     | 2.0.8        |\r\n| libxml-ruby               | 3.0.0        |\r\n</details>\r\n\r\n\r\n*generated on:* **2017-12-01**\r\n</details>","closed_by":{"login":"ohayon","id":2587018,"node_id":"MDQ6VXNlcjI1ODcwMTg=","avatar_url":"https://avatars.githubusercontent.com/u/2587018?v=4","gravatar_id":"","url":"https://api.github.com/users/ohayon","html_url":"https://github.com/ohayon","followers_url":"https://api.github.com/users/ohayon/followers","following_url":"https://api.github.com/users/ohayon/following{/other_user}","gists_url":"https://api.github.com/users/ohayon/gists{/gist_id}","starred_url":"https://api.github.com/users/ohayon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ohayon/subscriptions","organizations_url":"https://api.github.com/users/ohayon/orgs","repos_url":"https://api.github.com/users/ohayon/repos","events_url":"https://api.github.com/users/ohayon/events{/privacy}","received_events_url":"https://api.github.com/users/ohayon/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/fastlane/fastlane/issues/11073/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/fastlane/fastlane/issues/11073/timeline","performed_via_github_app":null,"state_reason":"completed"}