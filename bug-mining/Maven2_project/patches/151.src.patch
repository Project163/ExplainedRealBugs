diff --git a/maven-project/pom.xml b/maven-project/pom.xml
index 9daa8a065..350da247c 100644
--- a/maven-project/pom.xml
+++ b/maven-project/pom.xml
@@ -57,6 +57,10 @@ under the License.
       <groupId>org.apache.maven</groupId>
       <artifactId>maven-plugin-registry</artifactId>
     </dependency>
+    <dependency>
+      <groupId>org.codehaus.plexus</groupId>
+      <artifactId>plexus-interpolation</artifactId>
+    </dependency>
     <dependency>
       <groupId>org.codehaus.plexus</groupId>
       <artifactId>plexus-utils</artifactId>
diff --git a/maven-project/src/main/java/org/apache/maven/project/DefaultMavenProjectBuilder.java b/maven-project/src/main/java/org/apache/maven/project/DefaultMavenProjectBuilder.java
index 112544195..f8fb196f1 100644
--- a/maven-project/src/main/java/org/apache/maven/project/DefaultMavenProjectBuilder.java
+++ b/maven-project/src/main/java/org/apache/maven/project/DefaultMavenProjectBuilder.java
@@ -97,7 +97,6 @@ import java.util.LinkedHashSet;
 import java.util.LinkedList;
 import java.util.List;
 import java.util.Map;
-import java.util.Properties;
 import java.util.Set;
 import java.util.TreeMap;
 
@@ -994,7 +993,7 @@ public class DefaultMavenProjectBuilder
 
         model.setBuild( ModelUtils.cloneBuild( dynamicBuild ) );
 
-        model = interpolate( model, projectDir, isSuperPom, config, strict );
+        model = modelInterpolator.interpolate( model, project.getBasedir(), config, getLogger().isDebugEnabled() );
 
         mergeDeterministicBuildElements( model.getBuild(), dynamicBuild );
 
@@ -1098,57 +1097,6 @@ public class DefaultMavenProjectBuilder
         return project;
     }
 
-    private Model interpolate( Model model,
-                              File projectDir,
-                              boolean isSuperPom,
-                              ProjectBuilderConfiguration config,
-                              boolean strict )
-        throws ModelInterpolationException
-    {
-        // We don't need all the project methods that are added over those in the model, but we do need basedir
-        Map context = new HashMap();
-
-        Build build = model.getBuild();
-
-        if ( projectDir != null )
-        {
-            context.put( "basedir", projectDir.getAbsolutePath() );
-
-            // MNG-1927, MNG-2124, MNG-3355:
-            // If the build section is present and the project directory is non-null, we should make
-            // sure interpolation of the directories below uses translated paths.
-            // Afterward, we'll double back and translate any paths that weren't covered during interpolation via the
-            // code below...
-            context.put( "build.directory", pathTranslator.alignToBaseDirectory( build.getDirectory(), projectDir ) );
-            context.put( "build.outputDirectory", pathTranslator.alignToBaseDirectory( build.getOutputDirectory(), projectDir ) );
-            context.put( "build.testOutputDirectory", pathTranslator.alignToBaseDirectory( build.getTestOutputDirectory(), projectDir ) );
-            context.put( "build.sourceDirectory", pathTranslator.alignToBaseDirectory( build.getSourceDirectory(), projectDir ) );
-            context.put( "build.testSourceDirectory", pathTranslator.alignToBaseDirectory( build.getTestSourceDirectory(), projectDir ) );
-        }
-
-        if ( !isSuperPom )
-        {
-            Properties userProps = config.getUserProperties();
-            if ( userProps != null )
-            {
-                context.putAll( userProps );
-            }
-        }
-
-        model = modelInterpolator.interpolate( model, context, strict );
-
-        // second pass allows ${user.home} to work, if it needs to.
-        // [MNG-2339] ensure the system properties are still interpolated for backwards compat, but the model values must win
-        if ( config.getExecutionProperties() != null && !config.getExecutionProperties().isEmpty() )
-        {
-            context.putAll( config.getExecutionProperties() );
-        }
-
-        model = modelInterpolator.interpolate( model, context, strict );
-
-        return model;
-    }
-
     private void mergeDeterministicBuildElements( Build interpolatedBuild,
                                                   Build dynamicBuild )
     {
@@ -1866,17 +1814,15 @@ public class DefaultMavenProjectBuilder
         // We don't need all the project methods that are added over those in the model, but we do need basedir
         Map context = new HashMap();
 
-        boolean isSuperPom = project.getGroupId().equals( STANDALONE_SUPERPOM_GROUPID )
-                             && project.getArtifactId().equals( STANDALONE_SUPERPOM_ARTIFACTID )
-                             && project.getVersion().equals( STANDALONE_SUPERPOM_VERSION );
-
         File basedir = project.getBasedir();
 
-        model = interpolate( model, basedir, isSuperPom, config, true );
+        model = modelInterpolator.interpolate( model, project.getBasedir(), config, getLogger().isDebugEnabled() );
 
         List originalInterpolatedCompileSourceRoots = interpolateListOfStrings( project.getCompileSourceRoots(),
                                                                            model,
-                                                                           context );
+                                                                           project.getBasedir(),
+                                                                           config,
+                                                                           getLogger().isDebugEnabled() );
 
         project.preserveCompileSourceRoots( originalInterpolatedCompileSourceRoots );
 
@@ -1885,7 +1831,9 @@ public class DefaultMavenProjectBuilder
 
         List originalInterpolatedTestCompileSourceRoots = interpolateListOfStrings( project.getTestCompileSourceRoots(),
                                                                                model,
-                                                                               context );
+                                                                               project.getBasedir(),
+                                                                               config,
+                                                                               getLogger().isDebugEnabled() );
 
         project.preserveTestCompileSourceRoots( originalInterpolatedTestCompileSourceRoots );
         project.setTestCompileSourceRoots( originalInterpolatedTestCompileSourceRoots == null ? null
@@ -1893,7 +1841,9 @@ public class DefaultMavenProjectBuilder
 
         List originalInterpolatedScriptSourceRoots = interpolateListOfStrings( project.getScriptSourceRoots(),
                                                                           model,
-                                                                          context );
+                                                                          project.getBasedir(),
+                                                                          config,
+                                                                          getLogger().isDebugEnabled() );
 
         project.preserveScriptSourceRoots( originalInterpolatedScriptSourceRoots );
         project.setScriptSourceRoots( originalInterpolatedScriptSourceRoots == null ? null
@@ -1964,14 +1914,8 @@ public class DefaultMavenProjectBuilder
             return;
         }
 
-        Build changedBuild = project.getBuild();
-
-        Map context = new HashMap();
-        populateBuildPaths( changedBuild, context, project.getBasedir() );
-        populateExecutionProperties( config, context );
-
-        restoreBuildRoots( project, config, context );
-        restoreModelBuildSection( project, config, context );
+        restoreBuildRoots( project, config, getLogger().isDebugEnabled() );
+        restoreModelBuildSection( project, config, getLogger().isDebugEnabled() );
 
         restoreDynamicProjectReferences( project, config );
         if ( project.getExecutionProject() != null )
@@ -1999,33 +1943,36 @@ public class DefaultMavenProjectBuilder
 
     private void restoreBuildRoots( MavenProject project,
                                     ProjectBuilderConfiguration config,
-                                    Map context )
+                                    boolean debugMessages )
         throws ModelInterpolationException
     {
         project.setCompileSourceRoots( restoreListOfStrings( project.getDynamicCompileSourceRoots(),
                                                              project.getOriginalInterpolatedCompileSourceRoots(),
                                                              project.getCompileSourceRoots(),
                                                              project,
-                                                             context ) );
+                                                             config,
+                                                             debugMessages ) );
 
         project.setTestCompileSourceRoots( restoreListOfStrings( project.getDynamicTestCompileSourceRoots(),
                                                                  project.getOriginalInterpolatedTestCompileSourceRoots(),
                                                                  project.getTestCompileSourceRoots(),
                                                                  project,
-                                                                 context ) );
+                                                                 config,
+                                                                 debugMessages ) );
 
         project.setScriptSourceRoots( restoreListOfStrings( project.getDynamicScriptSourceRoots(),
                                                             project.getOriginalInterpolatedScriptSourceRoots(),
                                                             project.getScriptSourceRoots(),
                                                             project,
-                                                            context ) );
+                                                            config,
+                                                            debugMessages ) );
 
         project.clearRestorableRoots();
     }
 
     private void restoreModelBuildSection( MavenProject project,
                                            ProjectBuilderConfiguration config,
-                                           Map context )
+                                           boolean debugMessages )
         throws ModelInterpolationException
     {
         Build changedBuild = project.getBuild();
@@ -2036,67 +1983,78 @@ public class DefaultMavenProjectBuilder
                                                          originalInterpolatedBuild.getResources(),
                                                          changedBuild.getResources(),
                                                          project,
-                                                         context ) );
+                                                         config,
+                                                         debugMessages ) );
 
         dynamicBuild.setTestResources( restoreResources( dynamicBuild.getTestResources(),
                                                          originalInterpolatedBuild.getTestResources(),
                                                          changedBuild.getTestResources(),
                                                          project,
-                                                         context ) );
+                                                         config,
+                                                         debugMessages ) );
 
         dynamicBuild.setFilters( restoreListOfStrings( dynamicBuild.getFilters(),
                                                            originalInterpolatedBuild.getFilters(),
                                                            changedBuild.getFilters(),
                                                            project,
-                                                           context ) );
+                                                           config,
+                                                           debugMessages ) );
 
         dynamicBuild.setFinalName( restoreString( dynamicBuild.getFinalName(),
                                                   originalInterpolatedBuild.getFinalName(),
                                                   changedBuild.getFinalName(),
                                                   project,
-                                                  context ) );
+                                                  config,
+                                                  debugMessages ) );
 
         dynamicBuild.setDefaultGoal( restoreString( dynamicBuild.getDefaultGoal(),
                                                   originalInterpolatedBuild.getDefaultGoal(),
                                                   changedBuild.getDefaultGoal(),
                                                   project,
-                                                  context ) );
+                                                  config,
+                                                  debugMessages ) );
 
         dynamicBuild.setSourceDirectory( restoreString( dynamicBuild.getSourceDirectory(),
                                                             originalInterpolatedBuild.getSourceDirectory(),
                                                             changedBuild.getSourceDirectory(),
                                                             project,
-                                                            context ) );
+                                                            config,
+                                                            debugMessages ) );
 
         dynamicBuild.setTestSourceDirectory( restoreString( dynamicBuild.getTestSourceDirectory(),
                                                                 originalInterpolatedBuild.getTestSourceDirectory(),
                                                                 changedBuild.getTestSourceDirectory(),
                                                                 project,
-                                                                context ) );
+                                                                config,
+                                                                debugMessages ) );
 
         dynamicBuild.setScriptSourceDirectory( restoreString( dynamicBuild.getScriptSourceDirectory(),
                                                                   originalInterpolatedBuild.getScriptSourceDirectory(),
                                                                   changedBuild.getScriptSourceDirectory(),
                                                                   project,
-                                                                  context ) );
+                                                                  config,
+                                                                  debugMessages ) );
 
         dynamicBuild.setOutputDirectory( restoreString( dynamicBuild.getOutputDirectory(),
                                                             originalInterpolatedBuild.getOutputDirectory(),
                                                             changedBuild.getOutputDirectory(),
                                                             project,
-                                                            context ) );
+                                                            config,
+                                                            debugMessages ) );
 
         dynamicBuild.setTestOutputDirectory( restoreString( dynamicBuild.getTestOutputDirectory(),
                                                                 originalInterpolatedBuild.getTestOutputDirectory(),
                                                                 changedBuild.getTestOutputDirectory(),
                                                                 project,
-                                                                context ) );
+                                                                config,
+                                                                debugMessages ) );
 
         dynamicBuild.setDirectory( restoreString( dynamicBuild.getDirectory(),
                                                       originalInterpolatedBuild.getDirectory(),
                                                       changedBuild.getDirectory(),
                                                       project,
-                                                      context ) );
+                                                      config,
+                                                      debugMessages ) );
 
         project.setBuild( dynamicBuild );
 
@@ -2105,7 +2063,9 @@ public class DefaultMavenProjectBuilder
 
     private List interpolateListOfStrings( List originalStrings,
                                            Model model,
-                                           Map context )
+                                           File projectDir,
+                                           ProjectBuilderConfiguration config,
+                                           boolean debugMessages )
         throws ModelInterpolationException
     {
         if ( originalStrings == null )
@@ -2118,7 +2078,7 @@ public class DefaultMavenProjectBuilder
         for ( Iterator it = originalStrings.iterator(); it.hasNext(); )
         {
             String original = (String) it.next();
-            String interpolated = modelInterpolator.interpolate( original, model, context );
+            String interpolated = modelInterpolator.interpolate( original, model, projectDir, config, debugMessages );
 
             result.add( interpolated );
         }
@@ -2130,7 +2090,8 @@ public class DefaultMavenProjectBuilder
                                       String originalInterpolatedString,
                                       String changedString,
                                       MavenProject project,
-                                      Map context )
+                                      ProjectBuilderConfiguration config,
+                                      boolean debugMessages )
         throws ModelInterpolationException
     {
         if ( originalString == null )
@@ -2154,13 +2115,29 @@ public class DefaultMavenProjectBuilder
             relativeChangedString = changedString;
         }
 
-        String interpolatedOriginal = modelInterpolator.interpolate( originalString, model, context );
-        String interpolatedOriginal2 = modelInterpolator.interpolate( originalInterpolatedString,
-                                                                 model,
-                                                                 context );
+        String interpolatedOriginal = modelInterpolator.interpolate( originalString,
+                                                                     model,
+                                                                     project.getBasedir(),
+                                                                     config,
+                                                                     debugMessages );
 
-        String interpolatedChanged = modelInterpolator.interpolate( changedString, model, context );
-        String relativeInterpolatedChanged = modelInterpolator.interpolate( relativeChangedString, model, context );
+        String interpolatedOriginal2 = modelInterpolator.interpolate( originalInterpolatedString,
+                                                                      model,
+                                                                      project.getBasedir(),
+                                                                      config,
+                                                                      debugMessages );
+
+        String interpolatedChanged = modelInterpolator.interpolate( changedString,
+                                                                    model,
+                                                                    project.getBasedir(),
+                                                                    config,
+                                                                    debugMessages );
+
+        String relativeInterpolatedChanged = modelInterpolator.interpolate( relativeChangedString,
+                                                                            model,
+                                                                            project.getBasedir(),
+                                                                            config,
+                                                                            debugMessages );
 
         if ( interpolatedOriginal.equals( interpolatedChanged )
              || interpolatedOriginal2.equals( interpolatedChanged ) )
@@ -2180,7 +2157,8 @@ public class DefaultMavenProjectBuilder
                                            List originalInterpolatedStrings,
                                            List changedStrings,
                                            MavenProject project,
-                                           Map context )
+                                           ProjectBuilderConfiguration config,
+                                           boolean debugMessages )
         throws ModelInterpolationException
     {
         if ( originalStrings == null )
@@ -2218,8 +2196,17 @@ public class DefaultMavenProjectBuilder
                 relativeChangedString = changedString;
             }
 
-            String interpolated = modelInterpolator.interpolate( changedString, project.getModel(), orig );
-            String relativeInterpolated = modelInterpolator.interpolate( relativeChangedString, project.getModel(), orig );
+            String interpolated = modelInterpolator.interpolate( changedString,
+                                                                 project.getModel(),
+                                                                 project.getBasedir(),
+                                                                 config,
+                                                                 debugMessages );
+
+            String relativeInterpolated = modelInterpolator.interpolate( relativeChangedString,
+                                                                         project.getModel(),
+                                                                         project.getBasedir(),
+                                                                         config,
+                                                                         debugMessages );
 
             String[] original = (String[]) orig.get( interpolated );
             if ( original == null )
@@ -2244,7 +2231,8 @@ public class DefaultMavenProjectBuilder
                                        List originalInterpolatedResources,
                                        List changedResources,
                                        MavenProject project,
-                                       Map context )
+                                       ProjectBuilderConfiguration config,
+                                       boolean debugMessages )
         throws ModelInterpolationException
     {
         if ( originalResources == null || changedResources == null )
@@ -2268,7 +2256,11 @@ public class DefaultMavenProjectBuilder
         for ( Iterator it = changedResources.iterator(); it.hasNext(); )
         {
             Resource resource = (Resource) it.next();
-            String rDir = modelInterpolator.interpolate( resource.getDirectory(), project.getModel(), orig );
+            String rDir = modelInterpolator.interpolate( resource.getDirectory(),
+                                                         project.getModel(),
+                                                         project.getBasedir(),
+                                                         config,
+                                                         debugMessages );
 
             String relativeDir;
             if ( project.getBasedir() != null )
@@ -2281,7 +2273,11 @@ public class DefaultMavenProjectBuilder
                 relativeDir = resource.getDirectory();
             }
 
-            String relativeRDir = modelInterpolator.interpolate( relativeDir, project.getModel(), context );
+            String relativeRDir = modelInterpolator.interpolate( relativeDir,
+                                                                 project.getModel(),
+                                                                 project.getBasedir(),
+                                                                 config,
+                                                                 debugMessages );
 
             Resource[] original = (Resource[]) orig.get( rDir );
             if ( original == null )
@@ -2306,58 +2302,4 @@ public class DefaultMavenProjectBuilder
         return result;
     }
 
-    private void populateExecutionProperties( ProjectBuilderConfiguration config,
-                                              Map context )
-    {
-        // second pass allows ${user.home} to work, if it needs to.
-        // [MNG-2339] ensure the system properties are still interpolated for backwards compat, but the model values must win
-        if ( config.getExecutionProperties() != null
-             && !config.getExecutionProperties().isEmpty() )
-        {
-            for ( Iterator it = config.getExecutionProperties().entrySet().iterator(); it.hasNext(); )
-            {
-                Map.Entry entry = (Map.Entry) it.next();
-
-                String key = (String) entry.getKey();
-                if ( "basedir".equals( key ) )
-                {
-                    continue;
-                }
-                else
-                {
-                    context.put( key, entry.getValue() );
-                }
-            }
-        }
-    }
-
-    private void populateBuildPaths( Build build,
-                                     Map context,
-                                     File projectDir )
-    {
-        if ( projectDir != null )
-        {
-            context.put( "basedir", projectDir.getAbsolutePath() );
-
-            // MNG-1927, MNG-2124, MNG-3355:
-            // If the build section is present and the project directory is non-null, we should make
-            // sure interpolation of the directories below uses translated paths.
-            // Afterward, we'll double back and translate any paths that weren't covered during interpolation via the
-            // code below...
-//            context.put( "build.directory",
-//                         pathTranslator.alignToBaseDirectory( build.getDirectory(), projectDir ) );
-//            context.put( "build.outputDirectory",
-//                         pathTranslator.alignToBaseDirectory( build.getOutputDirectory(),
-//                                                              projectDir ) );
-//            context.put( "build.testOutputDirectory",
-//                         pathTranslator.alignToBaseDirectory( build.getTestOutputDirectory(),
-//                                                              projectDir ) );
-//            context.put( "build.sourceDirectory",
-//                         pathTranslator.alignToBaseDirectory( build.getSourceDirectory(),
-//                                                              projectDir ) );
-//            context.put( "build.testSourceDirectory",
-//                         pathTranslator.alignToBaseDirectory( build.getTestSourceDirectory(),
-//                                                              projectDir ) );
-        }
-    }
 }
diff --git a/maven-project/src/main/java/org/apache/maven/project/DefaultProjectBuilderConfiguration.java b/maven-project/src/main/java/org/apache/maven/project/DefaultProjectBuilderConfiguration.java
index fbf20d032..77fb4b773 100644
--- a/maven-project/src/main/java/org/apache/maven/project/DefaultProjectBuilderConfiguration.java
+++ b/maven-project/src/main/java/org/apache/maven/project/DefaultProjectBuilderConfiguration.java
@@ -3,6 +3,7 @@ package org.apache.maven.project;
 import org.apache.maven.artifact.repository.ArtifactRepository;
 import org.apache.maven.profiles.ProfileManager;
 
+import java.util.Date;
 import java.util.Properties;
 
 public class DefaultProjectBuilderConfiguration
@@ -17,6 +18,8 @@ public class DefaultProjectBuilderConfiguration
 
     private Properties executionProperties = System.getProperties();
 
+    private Date buildStartTime;
+
     public DefaultProjectBuilderConfiguration()
     {
     }
@@ -70,4 +73,15 @@ public class DefaultProjectBuilderConfiguration
         return this;
     }
 
+    public Date getBuildStartTime()
+    {
+        return buildStartTime;
+    }
+
+    public ProjectBuilderConfiguration setBuildStartTime( Date buildStartTime )
+    {
+        this.buildStartTime = buildStartTime;
+        return this;
+    }
+
 }
diff --git a/maven-project/src/main/java/org/apache/maven/project/ProjectBuilderConfiguration.java b/maven-project/src/main/java/org/apache/maven/project/ProjectBuilderConfiguration.java
index 000f8d855..f8ce413a6 100644
--- a/maven-project/src/main/java/org/apache/maven/project/ProjectBuilderConfiguration.java
+++ b/maven-project/src/main/java/org/apache/maven/project/ProjectBuilderConfiguration.java
@@ -3,6 +3,7 @@ package org.apache.maven.project;
 import org.apache.maven.artifact.repository.ArtifactRepository;
 import org.apache.maven.profiles.ProfileManager;
 
+import java.util.Date;
 import java.util.Properties;
 
 public interface ProjectBuilderConfiguration
@@ -24,4 +25,8 @@ public interface ProjectBuilderConfiguration
 
     ProjectBuilderConfiguration setExecutionProperties( Properties executionProperties );
 
+    Date getBuildStartTime();
+
+    ProjectBuilderConfiguration setBuildStartTime( Date buildStartTime );
+
 }
diff --git a/maven-project/src/main/java/org/apache/maven/project/interpolation/BuildTimestampValueSource.java b/maven-project/src/main/java/org/apache/maven/project/interpolation/BuildTimestampValueSource.java
new file mode 100644
index 000000000..40fdb677d
--- /dev/null
+++ b/maven-project/src/main/java/org/apache/maven/project/interpolation/BuildTimestampValueSource.java
@@ -0,0 +1,32 @@
+package org.apache.maven.project.interpolation;
+
+import org.codehaus.plexus.interpolation.ValueSource;
+
+import java.text.SimpleDateFormat;
+import java.util.Date;
+
+public class BuildTimestampValueSource
+    implements ValueSource
+{
+
+    private String formattedDate;
+
+    public BuildTimestampValueSource( Date startTime, String format )
+    {
+        if ( startTime != null )
+        {
+            formattedDate = new SimpleDateFormat( format ).format( startTime );
+        }
+    }
+
+    public Object getValue( String expression )
+    {
+        if ( "build.timestamp".equals( expression ) || "maven.build.timestamp".equals( expression ) )
+        {
+            return formattedDate;
+        }
+
+        return null;
+    }
+
+}
diff --git a/maven-project/src/main/java/org/apache/maven/project/interpolation/ModelInterpolator.java b/maven-project/src/main/java/org/apache/maven/project/interpolation/ModelInterpolator.java
index 46312f88e..64a8dd0dd 100644
--- a/maven-project/src/main/java/org/apache/maven/project/interpolation/ModelInterpolator.java
+++ b/maven-project/src/main/java/org/apache/maven/project/interpolation/ModelInterpolator.java
@@ -20,7 +20,9 @@ package org.apache.maven.project.interpolation;
  */
 
 import org.apache.maven.model.Model;
+import org.apache.maven.project.ProjectBuilderConfiguration;
 
+import java.io.File;
 import java.util.Map;
 
 /**
@@ -30,16 +32,34 @@ import java.util.Map;
  */
 public interface ModelInterpolator
 {
+    String DEFAULT_BUILD_TIMESTAMP_FORMAT = "yyyyMMdd-hhmm";
+
+    String BUILD_TIMESTAMP_FORMAT_PROPERTY = "maven.build.timestamp.format";
+
     String ROLE = ModelInterpolator.class.getName();
 
+    /**
+     * @deprecated Use {@link ModelInterpolator#interpolate(Model, File, ProjectBuilderConfiguration, boolean)} instead.
+     */
     Model interpolate( Model project, Map context )
         throws ModelInterpolationException;
 
+    /**
+     * @deprecated Use {@link ModelInterpolator#interpolate(Model, File, ProjectBuilderConfiguration, boolean)} instead.
+     */
     Model interpolate( Model model, Map context, boolean strict )
         throws ModelInterpolationException;
 
+    Model interpolate( Model model,
+                       File projectDir,
+                       ProjectBuilderConfiguration config,
+                       boolean debugEnabled )
+        throws ModelInterpolationException;
+
     String interpolate( String src,
                         Model model,
-                        Map context )
+                        File projectDir,
+                        ProjectBuilderConfiguration config,
+                        boolean debugEnabled )
         throws ModelInterpolationException;
 }
\ No newline at end of file
diff --git a/maven-project/src/main/java/org/apache/maven/project/interpolation/PathTranslatingValueSource.java b/maven-project/src/main/java/org/apache/maven/project/interpolation/PathTranslatingValueSource.java
new file mode 100644
index 000000000..bd2689dd1
--- /dev/null
+++ b/maven-project/src/main/java/org/apache/maven/project/interpolation/PathTranslatingValueSource.java
@@ -0,0 +1,37 @@
+package org.apache.maven.project.interpolation;
+
+import org.apache.maven.project.path.PathTranslator;
+import org.codehaus.plexus.interpolation.AbstractFunctionValueSourceWrapper;
+import org.codehaus.plexus.interpolation.ValueSource;
+
+import java.io.File;
+import java.util.List;
+
+public class PathTranslatingValueSource
+    extends AbstractFunctionValueSourceWrapper
+{
+
+    private final List unprefixedPathKeys;
+    private final File projectDir;
+    private final PathTranslator pathTranslator;
+
+    protected PathTranslatingValueSource( ValueSource valueSource, List unprefixedPathKeys, File projectDir, PathTranslator pathTranslator )
+    {
+        super( valueSource );
+        this.unprefixedPathKeys = unprefixedPathKeys;
+        this.projectDir = projectDir;
+        this.pathTranslator = pathTranslator;
+    }
+
+    protected Object executeFunction( String expression,
+                                      Object value )
+    {
+        if ( projectDir != null && value != null && unprefixedPathKeys.contains( expression ) )
+        {
+            return pathTranslator.alignToBaseDirectory( String.valueOf( value ), projectDir );
+        }
+
+        return value;
+    }
+
+}
diff --git a/maven-project/src/main/java/org/apache/maven/project/interpolation/RegexBasedModelInterpolator.java b/maven-project/src/main/java/org/apache/maven/project/interpolation/RegexBasedModelInterpolator.java
index 233f3d9e8..6c406d135 100644
--- a/maven-project/src/main/java/org/apache/maven/project/interpolation/RegexBasedModelInterpolator.java
+++ b/maven-project/src/main/java/org/apache/maven/project/interpolation/RegexBasedModelInterpolator.java
@@ -22,20 +22,32 @@ package org.apache.maven.project.interpolation;
 import org.apache.maven.model.Model;
 import org.apache.maven.model.io.xpp3.MavenXpp3Reader;
 import org.apache.maven.model.io.xpp3.MavenXpp3Writer;
+import org.apache.maven.project.DefaultProjectBuilderConfiguration;
+import org.apache.maven.project.ProjectBuilderConfiguration;
+import org.apache.maven.project.path.PathTranslator;
+import org.codehaus.plexus.interpolation.InterpolationException;
+import org.codehaus.plexus.interpolation.MapBasedValueSource;
+import org.codehaus.plexus.interpolation.ObjectBasedValueSource;
+import org.codehaus.plexus.interpolation.PrefixAwareRecursionInterceptor;
+import org.codehaus.plexus.interpolation.PrefixedObjectValueSource;
+import org.codehaus.plexus.interpolation.PrefixedValueSourceWrapper;
+import org.codehaus.plexus.interpolation.RecursionInterceptor;
+import org.codehaus.plexus.interpolation.RegexBasedInterpolator;
+import org.codehaus.plexus.interpolation.ValueSource;
 import org.codehaus.plexus.logging.AbstractLogEnabled;
 import org.codehaus.plexus.logging.Logger;
-import org.codehaus.plexus.util.StringUtils;
-import org.codehaus.plexus.util.cli.CommandLineUtils;
-import org.codehaus.plexus.util.introspection.ReflectionValueExtractor;
 import org.codehaus.plexus.util.xml.pull.XmlPullParserException;
 
+import java.io.File;
 import java.io.IOException;
 import java.io.StringReader;
 import java.io.StringWriter;
+import java.util.ArrayList;
+import java.util.Arrays;
+import java.util.Iterator;
+import java.util.List;
 import java.util.Map;
 import java.util.Properties;
-import java.util.regex.Matcher;
-import java.util.regex.Pattern;
 
 /**
  * Use a regular expression search to find and resolve expressions within the POM.
@@ -48,19 +60,43 @@ public class RegexBasedModelInterpolator
     extends AbstractLogEnabled
     implements ModelInterpolator
 {
-    static final Pattern EXPRESSION_PATTERN = Pattern.compile( "\\$\\{(pom\\.|project\\.|env\\.)?([^}]+)\\}" );
+    private static final List PROJECT_PREFIXES = Arrays.asList( new String[]{ "pom.", "project." } );
 
-    Properties envars;
+    private static final List TRANSLATED_PATH_EXPRESSIONS;
+
+    static
+    {
+        List translatedPrefixes = new ArrayList();
+
+        // MNG-1927, MNG-2124, MNG-3355:
+        // If the build section is present and the project directory is non-null, we should make
+        // sure interpolation of the directories below uses translated paths.
+        // Afterward, we'll double back and translate any paths that weren't covered during interpolation via the
+        // code below...
+        translatedPrefixes.add( "build.directory" );
+        translatedPrefixes.add( "build.outputDirectory" );
+        translatedPrefixes.add( "build.testOutputDirectory" );
+        translatedPrefixes.add( "build.sourceDirectory" );
+        translatedPrefixes.add( "build.testSourceDirectory" );
+        translatedPrefixes.add( "build.scriptSourceDirectory" );
+        translatedPrefixes.add( "reporting.outputDirectory" );
+
+        TRANSLATED_PATH_EXPRESSIONS = translatedPrefixes;
+    }
+
+    private PathTranslator pathTranslator;
 
     public RegexBasedModelInterpolator( Properties envars )
     {
-        this.envars = envars;
     }
 
+    /**
+     * @todo: Remove the throws clause.
+     * @throws IOException This exception is not thrown any more, and needs to be removed.
+     */
     public RegexBasedModelInterpolator()
         throws IOException
     {
-        envars = CommandLineUtils.getSystemEnvVars();
     }
 
     public Model interpolate( Model model, Map context )
@@ -78,6 +114,8 @@ public class RegexBasedModelInterpolator
      * @param model   The inbound Model instance, to serialize and reference for expression resolution
      * @param context The other context map to be used during resolution
      * @return The resolved instance of the inbound Model. This is a different instance!
+     *
+     * @deprecated Use {@link ModelInterpolator#interpolate(Model, File, ProjectBuilderConfiguration, boolean)} instead.
      */
     public Model interpolate( Model model, Map context, boolean strict )
         throws ModelInterpolationException
@@ -95,7 +133,15 @@ public class RegexBasedModelInterpolator
         }
 
         String serializedModel = sWriter.toString();
-        serializedModel = interpolate( serializedModel, model, context );
+
+        Properties props = new Properties();
+        props.putAll( context );
+
+        serializedModel = interpolate( serializedModel,
+                                               model,
+                                               null,
+                                               new DefaultProjectBuilderConfiguration().setExecutionProperties( props ),
+                                               true );
 
         StringReader sReader = new StringReader( serializedModel );
 
@@ -118,80 +164,168 @@ public class RegexBasedModelInterpolator
         return model;
     }
 
-    public String interpolate( String src, Model model, Map context )
+    public Model interpolate( Model model,
+                              File projectDir,
+                              ProjectBuilderConfiguration config,
+                              boolean debugEnabled )
         throws ModelInterpolationException
     {
-        String result = src;
-        Matcher matcher = EXPRESSION_PATTERN.matcher( result );
-        while ( matcher.find() )
+        StringWriter sWriter = new StringWriter();
+
+        MavenXpp3Writer writer = new MavenXpp3Writer();
+        try
+        {
+            writer.write( sWriter, model );
+        }
+        catch ( IOException e )
+        {
+            throw new ModelInterpolationException( "Cannot serialize project model for interpolation.", e );
+        }
+
+        String serializedModel = sWriter.toString();
+        serializedModel = interpolate( serializedModel, model, projectDir, config, debugEnabled );
+
+        StringReader sReader = new StringReader( serializedModel );
+
+        MavenXpp3Reader modelReader = new MavenXpp3Reader();
+        try
+        {
+            model = modelReader.read( sReader );
+        }
+        catch ( IOException e )
+        {
+            throw new ModelInterpolationException(
+                "Cannot read project model from interpolating filter of serialized version.", e );
+        }
+        catch ( XmlPullParserException e )
+        {
+            throw new ModelInterpolationException(
+                "Cannot read project model from interpolating filter of serialized version.", e );
+        }
+
+        return model;
+    }
+
+    /**
+     * Interpolates all expressions in the src parameter.
+     * <p>
+     * The algorithm used for each expression is:
+     * <ul>
+     *   <li>If it starts with either "pom." or "project.", the expression is evaluated against the model.</li>
+     *   <li>If the value is null, get the value from the context.</li>
+     *   <li>If the value is null, but the context contains the expression, don't replace the expression string
+     *       with the value, and continue to find other expressions.</li>
+     *   <li>If the value is null, get it from the model properties.</li>
+     *   <li>
+     * @param overrideContext
+     * @param outputDebugMessages
+     */
+    public String interpolate( String src,
+                               Model model,
+                               final File projectDir,
+                               ProjectBuilderConfiguration config,
+                               boolean debug )
+        throws ModelInterpolationException
+    {
+        Logger logger = getLogger();
+
+        String timestampFormat = DEFAULT_BUILD_TIMESTAMP_FORMAT;
+
+        Properties modelProperties = model.getProperties();
+        if ( modelProperties != null )
         {
-            String wholeExpr = matcher.group( 0 );
-            String realExpr = matcher.group( 2 );
+            timestampFormat = modelProperties.getProperty( BUILD_TIMESTAMP_FORMAT_PROPERTY, timestampFormat );
+        }
+
+        ValueSource baseModelValueSource1 = new PrefixedObjectValueSource( PROJECT_PREFIXES, model, false );
+        ValueSource modelValueSource1 = new PathTranslatingValueSource( baseModelValueSource1,
+                                                                       TRANSLATED_PATH_EXPRESSIONS,
+                                                                       projectDir, pathTranslator );
 
-            Object value = context.get( realExpr );
+        ValueSource baseModelValueSource2 = new ObjectBasedValueSource( model );
+        ValueSource modelValueSource2 = new PathTranslatingValueSource( baseModelValueSource2,
+                                                                       TRANSLATED_PATH_EXPRESSIONS,
+                                                                       projectDir, pathTranslator );
 
-            if ( value == null )
+        ValueSource basedirValueSource = new PrefixedValueSourceWrapper( new ValueSource(){
+            public Object getValue( String expression )
             {
-                // This may look out of place, but its here for the MNG-2124/MNG-1927 fix described in the project builder
-                if ( context.containsKey( realExpr ) )
+                if ( projectDir != null && "basedir".equals( expression ) )
                 {
-                    // It existed, but was null. Leave it alone.
-                    continue;
+                    return projectDir.getAbsolutePath();
                 }
 
-                value = model.getProperties().getProperty( realExpr );
+                return null;
             }
+        },
+        PROJECT_PREFIXES, true );
 
-            if ( value == null )
+        RegexBasedInterpolator interpolator = new RegexBasedInterpolator();
+
+        // NOTE: Order counts here!
+        interpolator.addValueSource( basedirValueSource );
+        interpolator.addValueSource( new BuildTimestampValueSource( config.getBuildStartTime(), timestampFormat ) );
+        interpolator.addValueSource( new MapBasedValueSource( config.getExecutionProperties() ) );
+        interpolator.addValueSource( modelValueSource1 );
+        interpolator.addValueSource( new PrefixedValueSourceWrapper( new MapBasedValueSource( modelProperties ), PROJECT_PREFIXES, true ) );
+        interpolator.addValueSource( modelValueSource2 );
+        interpolator.addValueSource( new MapBasedValueSource( config.getUserProperties() ) );
+
+        RecursionInterceptor recursionInterceptor = new PrefixAwareRecursionInterceptor( PROJECT_PREFIXES );
+
+        String result = src;
+        try
+        {
+            result = interpolator.interpolate( result, "", recursionInterceptor );
+        }
+        catch( InterpolationException e )
+        {
+            throw new ModelInterpolationException( e.getMessage(), e );
+        }
+
+        if ( debug )
+        {
+            List feedback = interpolator.getFeedback();
+            if ( feedback != null && !feedback.isEmpty() )
             {
-                try
-                {
-                    // NOTE: We've already trimmed off any leading expression parts like 'project.'
-                    // or 'pom.', and now we have to ensure that the ReflectionValueExtractor
-                    // doesn't try to do it again.
-                    value = ReflectionValueExtractor.evaluate( realExpr, model, false );
-                }
-                catch ( Exception e )
+                logger.debug( "Maven encountered the following problems during initial POM interpolation:" );
+
+                Object last = null;
+                for ( Iterator it = feedback.iterator(); it.hasNext(); )
                 {
-                    Logger logger = getLogger();
-                    if ( logger != null )
+                    Object next = it.next();
+
+                    if ( next instanceof Throwable )
                     {
-                        logger.debug( "POM interpolation cannot proceed with expression: " + wholeExpr + ". Skipping...", e );
+                        if ( last == null )
+                        {
+                            logger.debug( "", ( (Throwable) next ) );
+                        }
+                        else
+                        {
+                            logger.debug( String.valueOf( last ), ( (Throwable) next ) );
+                        }
                     }
-                }
-            }
-
-            if ( value == null )
-            {
-                value = envars.getProperty( realExpr );
-            }
-
-            // if the expression refers to itself, skip it.
-            if ( String.valueOf( value ).indexOf( wholeExpr ) > -1 )
-            {
-                throw new ModelInterpolationException( wholeExpr, "Expression value '" + value + "' references itself in '" + model.getId() + "'." );
-            }
+                    else
+                    {
+                        if ( last != null )
+                        {
+                            logger.debug( String.valueOf( last ) );
+                        }
 
-            if ( value != null )
-            {
-                result = StringUtils.replace( result, wholeExpr, String.valueOf( value ) );
-                // could use:
-                // result = matcher.replaceFirst( stringValue );
-                // but this could result in multiple lookups of stringValue, and replaceAll is not correct behaviour
-                matcher.reset( result );
-            }
-/*
-        // This is the desired behaviour, however there are too many crappy poms in the repo and an issue with the
-        // timing of executing the interpolation
+                        last = next;
+                    }
+                }
 
-            else
-            {
-                throw new ModelInterpolationException(
-                    "Expression '" + wholeExpr + "' did not evaluate to anything in the model" );
+                if ( last != null )
+                {
+                    logger.debug( String.valueOf( last ) );
+                }
             }
-*/
         }
 
+        interpolator.clearFeedback();
+
         return result;
     }
 
diff --git a/maven-project/src/main/java/org/apache/maven/project/path/DefaultPathTranslator.java b/maven-project/src/main/java/org/apache/maven/project/path/DefaultPathTranslator.java
index daf5ae90b..d60e21a49 100644
--- a/maven-project/src/main/java/org/apache/maven/project/path/DefaultPathTranslator.java
+++ b/maven-project/src/main/java/org/apache/maven/project/path/DefaultPathTranslator.java
@@ -21,6 +21,7 @@ package org.apache.maven.project.path;
 
 import org.apache.maven.model.Build;
 import org.apache.maven.model.Model;
+import org.apache.maven.model.Reporting;
 import org.apache.maven.model.Resource;
 
 import java.io.File;
@@ -28,19 +29,27 @@ import java.util.ArrayList;
 import java.util.Iterator;
 import java.util.List;
 
+/**
+ * Default implementation of {@link PathTranslator}.
+ */
 public class DefaultPathTranslator
     implements PathTranslator
 {
-    private static final String FILE_SEPARATOR = "/";
-
-    private static final String[] BASEDIR_NAMES = {
+    private static final String[] BASEDIR_EXPRESSIONS = {
         "${basedir}",
         "${pom.basedir}",
         "${project.basedir}"
     };
 
+    private static final String FILE_SEPARATOR = "/";
+
     public void alignToBaseDirectory( Model model, File basedir )
     {
+        if ( basedir == null )
+        {
+            throw new IllegalArgumentException( "Cannot align model to null basedir." );
+        }
+
         Build build = model.getBuild();
 
         if ( build != null )
@@ -51,6 +60,8 @@ public class DefaultPathTranslator
 
             build.setTestSourceDirectory( alignToBaseDirectory( build.getTestSourceDirectory(), basedir ) );
 
+            build.setScriptSourceDirectory( alignToBaseDirectory( build.getScriptSourceDirectory(), basedir ) );
+
             for ( Iterator i = build.getResources().iterator(); i.hasNext(); )
             {
                 Resource resource = (Resource) i.next();
@@ -80,11 +91,30 @@ public class DefaultPathTranslator
             build.setOutputDirectory( alignToBaseDirectory( build.getOutputDirectory(), basedir ) );
 
             build.setTestOutputDirectory( alignToBaseDirectory( build.getTestOutputDirectory(), basedir ) );
+
+            Reporting reporting = model.getReporting();
+            if ( reporting != null )
+            {
+                reporting.setOutputDirectory( alignToBaseDirectory( reporting.getOutputDirectory(), basedir ) );
+            }
         }
     }
 
+    /**
+     * {@inheritDoc}
+     */
     public String alignToBaseDirectory( String path, File basedir )
     {
+        if ( basedir == null )
+        {
+            throw new IllegalArgumentException( "Cannot align path to null basedir." );
+        }
+
+        if ( path == null )
+        {
+            return null;
+        }
+
         String s = stripBasedirToken( path );
 
         if ( requiresBaseDirectoryAlignment( s ) )
@@ -99,12 +129,10 @@ public class DefaultPathTranslator
     {
         if ( s != null )
         {
-            s = s.trim();
-
             String basedirExpr = null;
-            for ( int i = 0; i < BASEDIR_NAMES.length; i++ )
+            for ( int i = 0; i < BASEDIR_EXPRESSIONS.length; i++ )
             {
-                basedirExpr = BASEDIR_NAMES[i];
+                basedirExpr = BASEDIR_EXPRESSIONS[i];
                 if ( s.startsWith( basedirExpr ) )
                 {
                     break;
@@ -119,8 +147,8 @@ public class DefaultPathTranslator
             {
                 if ( s.length() > basedirExpr.length() )
                 {
-                    // Take out ${basedir} and the leading slash
-                    s = s.substring( basedirExpr.length() + 1 );
+                    // Take out basedir expression and the leading slash
+                    s = chopLeadingFileSeparator( s.substring( basedirExpr.length() ) );
                 }
                 else
                 {
@@ -132,6 +160,25 @@ public class DefaultPathTranslator
         return s;
     }
 
+    /**
+     * Removes the leading directory separator from the specified filesystem path (if any). For platform-independent
+     * behavior, this method accepts both the forward slash and the backward slash as separator.
+     *
+     * @param path The filesystem path, may be <code>null</code>.
+     * @return The altered filesystem path or <code>null</code> if the input path was <code>null</code>.
+     */
+    private String chopLeadingFileSeparator( String path )
+    {
+        if ( path != null )
+        {
+            if ( path.startsWith( "/" ) || path.startsWith( "\\" ) )
+            {
+                path = path.substring( 1 );
+            }
+        }
+        return path;
+    }
+
     private boolean requiresBaseDirectoryAlignment( String s )
     {
         if ( s != null )
@@ -151,8 +198,16 @@ public class DefaultPathTranslator
         return false;
     }
 
+    /**
+     * {@inheritDoc}
+     */
     public void unalignFromBaseDirectory( Model model, File basedir )
     {
+        if ( basedir == null )
+        {
+            throw new IllegalArgumentException( "Cannot relativize model from null basedir." );
+        }
+
         Build build = model.getBuild();
 
         if ( build != null )
@@ -163,6 +218,8 @@ public class DefaultPathTranslator
 
             build.setTestSourceDirectory( unalignFromBaseDirectory( build.getTestSourceDirectory(), basedir ) );
 
+            build.setScriptSourceDirectory( unalignFromBaseDirectory( build.getScriptSourceDirectory(), basedir ) );
+
             for ( Iterator i = build.getResources().iterator(); i.hasNext(); )
             {
                 Resource resource = (Resource) i.next();
@@ -192,17 +249,44 @@ public class DefaultPathTranslator
             build.setOutputDirectory( unalignFromBaseDirectory( build.getOutputDirectory(), basedir ) );
 
             build.setTestOutputDirectory( unalignFromBaseDirectory( build.getTestOutputDirectory(), basedir ) );
+
+            Reporting reporting = model.getReporting();
+            if ( reporting != null )
+            {
+                reporting.setOutputDirectory( unalignFromBaseDirectory( reporting.getOutputDirectory(), basedir ) );
+            }
         }
     }
 
-    public String unalignFromBaseDirectory( String directory, File basedir )
+    /**
+     * {@inheritDoc}
+     */
+    public String unalignFromBaseDirectory( String path, File basedir )
     {
-        String path = basedir.getPath();
-        if ( directory.startsWith( path ) )
+        if ( basedir == null )
         {
-            directory = directory.substring( path.length() + 1 ).replace( '\\', '/' );
+            throw new IllegalArgumentException( "Cannot relativize path from null basedir." );
         }
-        return directory;
+
+        if ( path == null )
+        {
+            return null;
+        }
+
+        path = path.trim();
+
+        String base = basedir.getAbsolutePath();
+        if ( path.startsWith( base ) )
+        {
+            path = chopLeadingFileSeparator( path.substring( base.length() ) );
+        }
+
+        if ( !new File( path ).isAbsolute() )
+        {
+            path = path.replace( '\\', '/' );
+        }
+
+        return path;
     }
 
 }
diff --git a/maven-project/src/main/resources/META-INF/plexus/components.xml b/maven-project/src/main/resources/META-INF/plexus/components.xml
index 7800fa1cc..6e82a1845 100644
--- a/maven-project/src/main/resources/META-INF/plexus/components.xml
+++ b/maven-project/src/main/resources/META-INF/plexus/components.xml
@@ -41,6 +41,11 @@ under the License.
     <component>
       <role>org.apache.maven.project.interpolation.ModelInterpolator</role>
       <implementation>org.apache.maven.project.interpolation.RegexBasedModelInterpolator</implementation>
+      <requirements>
+        <requirement>
+          <role>org.apache.maven.project.path.PathTranslator</role>
+        </requirement>
+      </requirements>
     </component>
 <!--
      |
diff --git a/maven-project/src/test/java/org/apache/maven/project/MavenProjectDynamismTest.java b/maven-project/src/test/java/org/apache/maven/project/MavenProjectDynamismTest.java
index 7d94821a2..8ca568448 100644
--- a/maven-project/src/test/java/org/apache/maven/project/MavenProjectDynamismTest.java
+++ b/maven-project/src/test/java/org/apache/maven/project/MavenProjectDynamismTest.java
@@ -233,7 +233,7 @@ public class MavenProjectDynamismTest
                       compileSourceRoots.size() );
 
         assertEquals( "Restored compile-source roots should contain uninterpolated source-directory value.",
-                      "src/main/java",
+                      "${pom.basedir}/src/main/java",
                       compileSourceRoots.get( 0 ) );
 
         testCompileSourceRoots = project.getTestCompileSourceRoots();
@@ -246,7 +246,7 @@ public class MavenProjectDynamismTest
                       testCompileSourceRoots.size() );
 
         assertEquals( "Restored test-compile-source roots should contain uninterpolated test-source-directory value.",
-                      "src/test/java",
+                      "${pom.basedir}/src/test/java",
                       testCompileSourceRoots.get( 0 ) );
 
         scriptSourceRoots = project.getScriptSourceRoots();
@@ -258,7 +258,7 @@ public class MavenProjectDynamismTest
                       scriptSourceRoots.size() );
 
         assertEquals( "Restored script-source roots should contain uninterpolated script-source-directory value.",
-                      "src/main/scripts",
+                      "${pom.basedir}/src/main/scripts",
                       scriptSourceRoots.get( 0 ) );
 
         resources = build.getResources();
diff --git a/maven-project/src/test/java/org/apache/maven/project/interpolation/ModelInterpolationEdgeCases.java b/maven-project/src/test/java/org/apache/maven/project/interpolation/ModelInterpolationEdgeCases.java
new file mode 100644
index 000000000..344529d02
--- /dev/null
+++ b/maven-project/src/test/java/org/apache/maven/project/interpolation/ModelInterpolationEdgeCases.java
@@ -0,0 +1,213 @@
+package org.apache.maven.project.interpolation;
+
+import org.apache.maven.model.Build;
+import org.apache.maven.model.Model;
+
+import java.util.HashMap;
+import java.util.Properties;
+
+import junit.framework.TestCase;
+
+public class ModelInterpolationEdgeCases
+    extends TestCase
+{
+
+    public void testMultiExpressionRecursion()
+        throws Throwable
+    {
+        Test test = new Test()
+        {
+
+            void run()
+            {
+                Model model = new Model();
+                Build build = new Build();
+
+                model.setBuild( build );
+
+                build.setDirectory( "${project.build.sourceDirectory}" );
+                build.setSourceDirectory( "${project.build.testSourceDirectory}/../main" );
+                build.setTestSourceDirectory( "${project.build.directory}/test" );
+
+                try
+                {
+                    interpolate( model );
+
+                    System.out.println( "Should fail." );
+
+                    failureMessage = "should fail with expression cycle in build paths.";
+//                    fail("should fail with expression cycle in build paths.");
+                }
+                catch ( ModelInterpolationException e )
+                {
+                    // expected
+                }
+                catch ( Throwable e )
+                {
+                    error = e;
+//                    throw e;
+                }
+            }
+        };
+
+
+        run( test );
+    }
+
+    public void testMultiPrefixRecursion_Synonyms()
+        throws Throwable
+    {
+        Test test = new Test()
+        {
+
+            void run()
+            {
+                Model model = new Model();
+                Build build = new Build();
+
+                model.setBuild( build );
+
+                build.setDirectory( "${project.build.directory}" );
+                build.setSourceDirectory( "${pom.build.sourceDirectory}" );
+                build.setTestSourceDirectory( "${build.testSourceDirectory}" );
+
+                try
+                {
+                    interpolate( model );
+
+                    System.out.println( "Should fail." );
+
+                    failureMessage = "should fail with expression synonym recursion.";
+                }
+                catch ( ModelInterpolationException e )
+                {
+                    // expected
+                }
+                catch ( Throwable e )
+                {
+                    error = e;
+                }
+            }
+        };
+
+        run( test );
+    }
+
+    public void testMultiPrefixSeparation_EnvarPropertyDifference()
+        throws Throwable
+    {
+        Test test = new Test()
+        {
+
+            void run()
+            {
+                Model model = new Model();
+
+                Properties properties = new Properties();
+
+                properties.setProperty( "ENVAR", "pomValue" );
+                properties.setProperty( "prop", "${env.ENVAR}" );
+                properties.setProperty( "prop2", "${pom.ENVAR}" );
+
+                model.setProperties( properties );
+
+                try
+                {
+                    Model result = interpolate( model );
+
+                    Properties resultProps = result.getProperties();
+                    assertFalse( "Values should not match!", resultProps.getProperty( "prop" ).equals( resultProps.getProperty( "prop2" ) ) );
+                }
+                catch ( ModelInterpolationException e )
+                {
+                    error = e;
+                }
+                catch ( Throwable e )
+                {
+                    error = e;
+                }
+            }
+        };
+
+        run( test );
+    }
+
+    private void run( Test test )
+        throws Throwable
+    {
+        Thread t = new Thread( new TestRunnable( test ) );
+        t.setDaemon( true );
+
+        t.start();
+
+        try
+        {
+            t.join( 5000 );
+        }
+        catch ( InterruptedException e )
+        {
+        }
+
+        if ( t.isAlive() )
+        {
+            StackTraceElement element = new Throwable().getStackTrace()[1];
+
+            fail( "Test: "
+                  + element.getMethodName()
+                  + " failed to execute in 5 seconds. Looks like it's caught in an infinite loop of some kind." );
+        }
+        else
+        {
+            test.checkFailure();
+        }
+    }
+
+    private Model interpolate( Model model )
+        throws Throwable
+    {
+        ModelInterpolator interpolator = new RegexBasedModelInterpolator();
+
+        return interpolator.interpolate( model, new HashMap(), true );
+    }
+
+    private static final class TestRunnable
+        implements Runnable
+    {
+        private Test test;
+
+        TestRunnable( Test test )
+        {
+            this.test = test;
+        }
+
+        public void run()
+        {
+            test.run();
+        }
+
+    }
+
+    private static abstract class Test
+    {
+        String failureMessage;
+
+        Throwable error;
+
+        abstract void run();
+
+        void checkFailure()
+            throws Throwable
+        {
+            if ( error != null )
+            {
+                throw error;
+            }
+            else if ( failureMessage != null )
+            {
+                fail( failureMessage );
+            }
+        }
+
+    }
+
+}
diff --git a/maven-project/src/test/java/org/apache/maven/project/interpolation/RegexBasedModelInterpolatorTest.java b/maven-project/src/test/java/org/apache/maven/project/interpolation/RegexBasedModelInterpolatorTest.java
index ffd74b4b1..e2db9b4c4 100644
--- a/maven-project/src/test/java/org/apache/maven/project/interpolation/RegexBasedModelInterpolatorTest.java
+++ b/maven-project/src/test/java/org/apache/maven/project/interpolation/RegexBasedModelInterpolatorTest.java
@@ -29,6 +29,7 @@ import org.apache.maven.model.Scm;
 
 import java.io.IOException;
 import java.util.Collections;
+import java.util.HashMap;
 import java.util.Iterator;
 import java.util.List;
 import java.util.Map;
@@ -210,9 +211,9 @@ public class RegexBasedModelInterpolatorTest
     public void testEnvars()
         throws Exception
     {
-        Properties envars = new Properties();
+        Map context = new HashMap();
 
-        envars.setProperty( "HOME", "/path/to/home" );
+        context.put( "env.HOME", "/path/to/home" );
 
         Model model = new Model();
 
@@ -222,7 +223,7 @@ public class RegexBasedModelInterpolatorTest
 
         model.setProperties( modelProperties );
 
-        Model out = new RegexBasedModelInterpolator( envars ).interpolate( model, context );
+        Model out = new RegexBasedModelInterpolator().interpolate( model, context );
 
         assertEquals( out.getProperties().getProperty( "outputDirectory" ), "/path/to/home" );
     }
