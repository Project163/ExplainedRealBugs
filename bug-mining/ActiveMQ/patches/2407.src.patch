diff --git a/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java b/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java
index 88dde7531..13e9b3c1d 100644
--- a/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java
+++ b/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java
@@ -1306,6 +1306,7 @@ public abstract class MessageDatabase extends ServiceSupport implements BrokerSe
                 if (sd.subscriptions != null && !sd.subscriptions.isEmpty(tx)) {
                     addAckLocationForNewMessage(tx, sd, id);
                 }
+                metadata.lastUpdate = location;
             } else {
                 // If the message ID is indexed, then the broker asked us to store a duplicate before the message was dispatched and acked, we ignore this add attempt
                 LOG.warn("Duplicate message add attempt rejected. Destination: {}://{}, Message id: {}", command.getDestination().getType(), command.getDestination().getName(), command.getMessageId());
@@ -1318,10 +1319,10 @@ public abstract class MessageDatabase extends ServiceSupport implements BrokerSe
             // added message. We don't want to assign it a new id as the other indexes would
             // be wrong..
             sd.locationIndex.put(tx, location, previous);
+            metadata.lastUpdate = location;
         }
         // record this id in any event, initial send or recovery
         metadata.producerSequenceIdTracker.isDuplicate(command.getMessageId());
-        metadata.lastUpdate = location;
         return id;
     }
 
@@ -1355,10 +1356,10 @@ public abstract class MessageDatabase extends ServiceSupport implements BrokerSe
             if(previousKeys != null) {
                 sd.locationIndex.remove(tx, previousKeys.location);
             }
+            metadata.lastUpdate = location;
         } else {
             LOG.warn("Non existent message update attempt rejected. Destination: {}://{}, Message id: {}", command.getDestination().getType(), command.getDestination().getName(), command.getMessageId());
         }
-        metadata.lastUpdate = location;
     }
 
     void updateIndex(Transaction tx, KahaRemoveMessageCommand command, Location ackLocation) throws IOException {
@@ -1372,6 +1373,7 @@ public abstract class MessageDatabase extends ServiceSupport implements BrokerSe
                 if (keys != null) {
                     sd.locationIndex.remove(tx, keys.location);
                     recordAckMessageReferenceLocation(ackLocation, keys.location);
+                    metadata.lastUpdate = ackLocation;
                 }  else if (LOG.isDebugEnabled()) {
                     LOG.debug("message not found in order index: " + sequenceId  + " for: " + command.getMessageId());
                 }
@@ -1398,12 +1400,12 @@ public abstract class MessageDatabase extends ServiceSupport implements BrokerSe
                 }
                 // The following method handles deleting un-referenced messages.
                 removeAckLocation(tx, sd, subscriptionKey, sequence);
+                metadata.lastUpdate = ackLocation;
             } else if (LOG.isDebugEnabled()) {
                 LOG.debug("no message sequence exists for id: " + command.getMessageId() + " and sub: " + command.getSubscriptionKey());
             }
 
         }
-        metadata.lastUpdate = ackLocation;
     }
 
     private void recordAckMessageReferenceLocation(Location ackLocation, Location messageLocation) {
