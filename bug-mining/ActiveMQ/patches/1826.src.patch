diff --git a/activemq-unit-tests/src/test/java/org/apache/activemq/store/jdbc/JDBCXACommitExceptionTest.java b/activemq-unit-tests/src/test/java/org/apache/activemq/store/jdbc/JDBCXACommitExceptionTest.java
index 2cc889f44..2713f9fb3 100644
--- a/activemq-unit-tests/src/test/java/org/apache/activemq/store/jdbc/JDBCXACommitExceptionTest.java
+++ b/activemq-unit-tests/src/test/java/org/apache/activemq/store/jdbc/JDBCXACommitExceptionTest.java
@@ -40,11 +40,18 @@ public class JDBCXACommitExceptionTest extends JDBCCommitExceptionTest {
 
     private long txGenerator = System.currentTimeMillis();
 
-    protected ActiveMQXAConnectionFactory factory = new ActiveMQXAConnectionFactory(
-            "tcp://localhost:61616?jms.prefetchPolicy.all=0&jms.redeliveryPolicy.maximumRedeliveries="+messagesExpected);
+    protected ActiveMQXAConnectionFactory factory;
 
     boolean onePhase = true;
 
+    @Override
+    public void setUp() throws Exception {
+        super.setUp();
+
+        factory = new ActiveMQXAConnectionFactory(
+            connectionUri + "?jms.prefetchPolicy.all=0&jms.redeliveryPolicy.maximumRedeliveries="+messagesExpected);
+    }
+
     public void testTwoPhaseSqlException() throws Exception {
         onePhase = false;
         doTestSqlException();
