diff --git a/activemq-karaf/src/main/java/org/apache/activemq/karaf/commands/ActiveMQCommand.java b/activemq-karaf/src/main/java/org/apache/activemq/karaf/commands/ActiveMQCommand.java
index 581852b28..3571a5cfa 100644
--- a/activemq-karaf/src/main/java/org/apache/activemq/karaf/commands/ActiveMQCommand.java
+++ b/activemq-karaf/src/main/java/org/apache/activemq/karaf/commands/ActiveMQCommand.java
@@ -17,11 +17,20 @@
  */
 package org.apache.activemq.karaf.commands;
 
+import java.lang.reflect.Field;
+import java.lang.reflect.Type;
+import java.util.ArrayList;
+import java.util.HashMap;
+import java.util.Iterator;
+import java.util.List;
+import java.util.Map;
+
 import org.apache.felix.gogo.commands.Action;
 import org.apache.felix.gogo.commands.Argument;
 import org.apache.felix.gogo.commands.basic.AbstractCommand;
 import org.apache.felix.gogo.commands.basic.ActionPreparator;
 import org.apache.felix.gogo.commands.basic.DefaultActionPreparator;
+import org.apache.felix.service.command.CommandSession;
 import org.apache.karaf.shell.console.BlueprintContainerAware;
 import org.apache.karaf.shell.console.BundleContextAware;
 import org.apache.karaf.shell.console.CompletableFunction;
@@ -30,15 +39,6 @@ import org.apache.karaf.shell.console.commands.GenericType;
 import org.osgi.framework.BundleContext;
 import org.osgi.service.blueprint.container.BlueprintContainer;
 import org.osgi.service.blueprint.container.Converter;
-import org.osgi.service.command.CommandSession;
-
-import java.lang.reflect.Field;
-import java.lang.reflect.Type;
-import java.util.ArrayList;
-import java.util.HashMap;
-import java.util.Iterator;
-import java.util.List;
-import java.util.Map;
 
 /**
  * Base command to process options and wrap native ActiveMQ console commands.
@@ -62,6 +62,7 @@ public class ActiveMQCommand extends AbstractCommand implements CompletableFunct
         this.actionId = actionId;
     }
 
+    @Override
     public List<Completer> getCompleters() {
         return completers;
     }
@@ -143,6 +144,7 @@ public class ActiveMQCommand extends AbstractCommand implements CompletableFunct
         }
     }
 
+    @Override
     public Action createNewAction() {
         Action action = (Action) blueprintContainer.getComponentInstance(actionId);
         if (action instanceof BlueprintContainerAware) {
diff --git a/activemq-karaf/src/main/resources/OSGI-INF/blueprint/activemq-karaf.xml b/activemq-karaf/src/main/resources/OSGI-INF/blueprint/activemq-karaf.xml
index 0830b5711..f7e66ed34 100644
--- a/activemq-karaf/src/main/resources/OSGI-INF/blueprint/activemq-karaf.xml
+++ b/activemq-karaf/src/main/resources/OSGI-INF/blueprint/activemq-karaf.xml
@@ -41,7 +41,7 @@
 
     <service ref="listcommand" activation="lazy" >
         <interfaces>
-            <value>org.osgi.service.command.Function</value>
+            <value>org.apache.felix.service.command.Function</value>
             <value>org.apache.karaf.shell.console.CompletableFunction</value>
         </interfaces>
         <service-properties>
@@ -67,7 +67,7 @@
 
     <service ref="querycommand" activation="lazy" >
         <interfaces>
-            <value>org.osgi.service.command.Function</value>
+            <value>org.apache.felix.service.command.Function</value>
             <value>org.apache.karaf.shell.console.CompletableFunction</value>
         </interfaces>
         <service-properties>
@@ -93,7 +93,7 @@
 
     <service ref="browsecommand" activation="lazy" >
         <interfaces>
-            <value>org.osgi.service.command.Function</value>
+            <value>org.apache.felix.service.command.Function</value>
             <value>org.apache.karaf.shell.console.CompletableFunction</value>
         </interfaces>
         <service-properties>
@@ -119,7 +119,7 @@
 
     <service ref="bstatcommand" activation="lazy" >
         <interfaces>
-            <value>org.osgi.service.command.Function</value>
+            <value>org.apache.felix.service.command.Function</value>
             <value>org.apache.karaf.shell.console.CompletableFunction</value>
         </interfaces>
         <service-properties>
@@ -145,7 +145,7 @@
 
     <service ref="purgecommand" activation="lazy" >
         <interfaces>
-            <value>org.osgi.service.command.Function</value>
+            <value>org.apache.felix.service.command.Function</value>
             <value>org.apache.karaf.shell.console.CompletableFunction</value>
         </interfaces>
         <service-properties>
diff --git a/activemq-karaf/src/main/resources/features.xml b/activemq-karaf/src/main/resources/features.xml
index a3d7a5a0f..55fdd07fb 100644
--- a/activemq-karaf/src/main/resources/features.xml
+++ b/activemq-karaf/src/main/resources/features.xml
@@ -18,8 +18,8 @@
 -->
 
 <features name="activemq-${activemq-version}">
-    <repository>mvn:org.apache.karaf/apache-karaf/${karaf-version}/xml/features</repository>
-        
+  <repository>mvn:org.apache.karaf.assemblies.features/standard/${karaf.version}/xml/features</repository>
+
     <feature name="activemq" version="${activemq-version}">
         <bundle>mvn:org.apache.geronimo.specs/geronimo-annotation_1.0_spec/1.1.1</bundle>
         <bundle>mvn:org.apache.geronimo.specs/geronimo-jta_1.1_spec/1.1.1</bundle> 
@@ -42,7 +42,7 @@
     </feature>
 
     <feature name="activemq-spring" version="${activemq-version}">
-        <feature version="1.2.0">spring-dm</feature> 
+        <feature version="[1,2)">spring-dm</feature> 
         <feature version="${activemq-version}">activemq</feature> 
         <bundle>mvn:org.apache.activemq/activemq-spring/${activemq-version}</bundle> 
         <bundle>mvn:org.apache.xbean/xbean-spring/${xbean-version}</bundle> 
@@ -55,7 +55,7 @@
         <bundle>mvn:org.apache.xbean/xbean-blueprint/${xbean-version}</bundle> 
         <bundle>mvn:org.apache.activemq/activemq-blueprint/${activemq-version}</bundle> 
     </feature>
-    
+
     <!-- do "features:install war" before installing this one  -->
     <feature name="activemq-web-console" version="${activemq-version}">
         <bundle>war:mvn:org.apache.activemq/activemq-web-console/${activemq-version}/war?Webapp-Context=activemq-web-console</bundle>
diff --git a/pom.xml b/pom.xml
index 22f7b6728..2af9ed177 100755
--- a/pom.xml
+++ b/pom.xml
@@ -70,7 +70,7 @@
     <jmock-version>2.5.1</jmock-version>
     <junit-version>4.5</junit-version>
     <jxta-version>2.0</jxta-version>
-    <karaf-version>2.1.0</karaf-version>
+    <karaf-version>2.2.0</karaf-version>
     <log4j-version>1.2.14</log4j-version>
     <org-apache-derby-version>10.1.3.1</org-apache-derby-version>
     <p2psockets-version>1.1.2</p2psockets-version>
