diff --git a/activemq-core/src/main/java/org/apache/activemq/broker/TransportConnection.java b/activemq-core/src/main/java/org/apache/activemq/broker/TransportConnection.java
index 22c9be17a..84c8e726c 100755
--- a/activemq-core/src/main/java/org/apache/activemq/broker/TransportConnection.java
+++ b/activemq-core/src/main/java/org/apache/activemq/broker/TransportConnection.java
@@ -731,9 +731,10 @@ public class TransportConnection implements Service,Connection,Task,CommandVisit
 
             if(command.isMessageDispatch()){
                 MessageDispatch md=(MessageDispatch) command;
-                Runnable sub=(Runnable) md.getConsumer();
                 broker.processDispatch(md);
-                if(sub!=null){
+                Object consumer = md.getConsumer();
+                if (consumer instanceof Runnable) {
+                    Runnable sub=(Runnable) consumer;
                     sub.run();
                 }
             }
