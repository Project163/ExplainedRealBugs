diff --git a/activemq-core/src/main/java/org/apache/activemq/transport/nio/NIOOutputStream.java b/activemq-core/src/main/java/org/apache/activemq/transport/nio/NIOOutputStream.java
index b1fe4569d..4da5b7cd5 100644
--- a/activemq-core/src/main/java/org/apache/activemq/transport/nio/NIOOutputStream.java
+++ b/activemq-core/src/main/java/org/apache/activemq/transport/nio/NIOOutputStream.java
@@ -197,7 +197,7 @@ public class NIOOutputStream extends OutputStream implements TimeStampStream {
                 // wrap more packets until we reach the end of data, but only when plain
                 // has no more space since we are non-blocking and a write might not have
                 // written anything.
-                if (data.hasRemaining() && !plain.hasRemaining()) {
+                if (engine != null && data.hasRemaining() && !plain.hasRemaining()) {
                     plain.clear();
                     engine.wrap(data, plain);
                     plain.flip();
