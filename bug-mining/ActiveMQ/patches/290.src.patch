diff --git a/activemq-core/src/main/java/org/apache/activemq/store/memory/MemoryPersistenceAdapter.java b/activemq-core/src/main/java/org/apache/activemq/store/memory/MemoryPersistenceAdapter.java
index 87ff7650e..9d876476f 100755
--- a/activemq-core/src/main/java/org/apache/activemq/store/memory/MemoryPersistenceAdapter.java
+++ b/activemq-core/src/main/java/org/apache/activemq/store/memory/MemoryPersistenceAdapter.java
@@ -29,6 +29,7 @@ import org.apache.activemq.command.ActiveMQQueue;
 import org.apache.activemq.command.ActiveMQTopic;
 import org.apache.activemq.store.MessageStore;
 import org.apache.activemq.store.PersistenceAdapter;
+import org.apache.activemq.store.ProxyMessageStore;
 import org.apache.activemq.store.TopicMessageStore;
 import org.apache.activemq.store.TransactionStore;
 import org.apache.activemq.usage.SystemUsage;
@@ -143,6 +144,12 @@ public class MemoryPersistenceAdapter implements PersistenceAdapter {
         if (value instanceof MemoryMessageStore) {
             return (MemoryMessageStore)value;
         }
+        if (value instanceof ProxyMessageStore) {
+            MessageStore delegate = ((ProxyMessageStore)value).getDelegate();
+            if (delegate instanceof MemoryMessageStore) {
+                return (MemoryMessageStore) delegate;
+            }
+        }
         LOG.warn("Expected an instance of MemoryMessageStore but was: " + value);
         return null;
     }
