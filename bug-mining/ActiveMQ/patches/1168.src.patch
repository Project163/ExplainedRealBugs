diff --git a/activemq-core/src/main/java/org/apache/activemq/TransactionContext.java b/activemq-core/src/main/java/org/apache/activemq/TransactionContext.java
index aa0b64a56..4136d791d 100755
--- a/activemq-core/src/main/java/org/apache/activemq/TransactionContext.java
+++ b/activemq-core/src/main/java/org/apache/activemq/TransactionContext.java
@@ -88,7 +88,7 @@ public class TransactionContext implements XAResource {
     }
 
     public boolean isInXATransaction() {
-        return transactionId != null && transactionId.isXATransaction();
+        return (transactionId != null && transactionId.isXATransaction()) || !ENDED_XA_TRANSACTION_CONTEXTS.isEmpty();
     }
 
     public boolean isInLocalTransaction() {
@@ -579,6 +579,7 @@ public class TransactionContext implements XAResource {
         } catch (JMSException e) {
             throw toXAException(e);
         }
+        ENDED_XA_TRANSACTION_CONTEXTS.remove(x);
     }
 
     public boolean isSameRM(XAResource xaResource) throws XAException {
diff --git a/activemq-core/src/test/java/org/apache/activemq/store/jdbc/JDBCXACommitExceptionTest.java b/activemq-core/src/test/java/org/apache/activemq/store/jdbc/JDBCXACommitExceptionTest.java
index 2fed6b49d..8fb9f4285 100644
--- a/activemq-core/src/test/java/org/apache/activemq/store/jdbc/JDBCXACommitExceptionTest.java
+++ b/activemq-core/src/test/java/org/apache/activemq/store/jdbc/JDBCXACommitExceptionTest.java
@@ -108,7 +108,7 @@ public class JDBCXACommitExceptionTest extends JDBCCommitExceptionTest {
                 LOG.debug("Caught exception:", e);
 
                 try {
-                    LOG.debug("Rolling back transaction (just in case, no need to do this as it is implicit in a commit failure) " + tid);
+                    LOG.debug("Rolling back transaction (just in case, no need to do this as it is implicit in a 1pc commit failure) " + tid);
                     resource.rollback(tid);
                 }
                 catch (XAException ex) {
