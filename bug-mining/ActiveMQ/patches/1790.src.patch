diff --git a/activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/StompSubscription.java b/activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/StompSubscription.java
index 714bce914..d4492e1bf 100644
--- a/activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/StompSubscription.java
+++ b/activemq-stomp/src/main/java/org/apache/activemq/transport/stomp/StompSubscription.java
@@ -107,20 +107,26 @@ public class StompSubscription {
         unconsumedMessage.clear();
     }
 
-    synchronized void onStompCommit(TransactionId transactionId) {
-        for (Iterator<?> iter = dispatchedMessage.entrySet().iterator(); iter.hasNext();) {
-            @SuppressWarnings("rawtypes")
-            Map.Entry entry = (Entry)iter.next();
-            MessageDispatch msg = (MessageDispatch)entry.getValue();
-            if (unconsumedMessage.contains(msg)) {
-                iter.remove();
+    void onStompCommit(TransactionId transactionId) {
+        MessageAck ack = null;
+        synchronized (this) {
+            for (Iterator<?> iter = dispatchedMessage.entrySet().iterator(); iter.hasNext();) {
+                @SuppressWarnings("rawtypes")
+                Map.Entry entry = (Entry)iter.next();
+                MessageDispatch msg = (MessageDispatch)entry.getValue();
+                if (unconsumedMessage.contains(msg)) {
+                    iter.remove();
+                }
             }
-        }
 
-        if (!unconsumedMessage.isEmpty()) {
-            MessageAck ack = new MessageAck(unconsumedMessage.getLast(), MessageAck.STANDARD_ACK_TYPE, unconsumedMessage.size());
+            if (!unconsumedMessage.isEmpty()) {
+                ack = new MessageAck(unconsumedMessage.getLast(), MessageAck.STANDARD_ACK_TYPE, unconsumedMessage.size());
+                unconsumedMessage.clear();
+            }
+        }
+        // avoid contention with onMessageDispatch
+        if (ack != null) {
             protocolConverter.getStompTransport().sendToActiveMQ(ack);
-            unconsumedMessage.clear();
         }
     }
 
