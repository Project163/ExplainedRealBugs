diff --git a/activemq-core/src/main/java/org/apache/activemq/ActiveMQConnection.java b/activemq-core/src/main/java/org/apache/activemq/ActiveMQConnection.java
index aea6794e6..5ea09cacc 100755
--- a/activemq-core/src/main/java/org/apache/activemq/ActiveMQConnection.java
+++ b/activemq-core/src/main/java/org/apache/activemq/ActiveMQConnection.java
@@ -577,10 +577,12 @@ public class ActiveMQConnection implements Connection, TopicConnection, QueueCon
                     }
 
                     if (isConnectionInfoSentToBroker) {
+                    	// If we announced ourselfs to the broker.. Try to let the broker
+                        // know that the connection is being shutdown.
                         syncSendPacket(info.createRemoveCommand(), closeTimeout);
+                        asyncSendPacket(new ShutdownInfo());
                     }
 
-                    asyncSendPacket(new ShutdownInfo());
                     ServiceSupport.dispose(this.transport);
 
                     started.set(false);
diff --git a/activemq-core/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java b/activemq-core/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java
index cef01052d..749939039 100755
--- a/activemq-core/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java
+++ b/activemq-core/src/main/java/org/apache/activemq/ActiveMQConnectionFactory.java
@@ -239,11 +239,11 @@ public class ActiveMQConnectionFactory extends JNDIBaseStorable implements Conne
         if (brokerURL == null) {
             throw new ConfigurationException("brokerURL not set.");
         }
-        Transport transport;
+        ActiveMQConnection connection=null;
         try {
-            transport = createTransport();
-            ActiveMQConnection connection = createActiveMQConnection(transport, factoryStats);
-
+        	Transport transport = createTransport();
+        	connection = createActiveMQConnection(transport, factoryStats);
+        	
             connection.setUserName(userName);
             connection.setPassword(password);
             connection.setPrefetchPolicy(getPrefetchPolicy());
@@ -269,10 +269,14 @@ public class ActiveMQConnectionFactory extends JNDIBaseStorable implements Conne
             return connection;
         }
         catch (JMSException e) {
+        	// Clean up!
+        	try { connection.close(); } catch ( Throwable ignore ) {}
             throw e;
         }
         catch (Exception e) {
-            throw JMSExceptionSupport.create("Could not connect to broker URL: " + brokerURL + ". Reason: " + e, e);
+        	// Clean up!
+        	try { connection.close(); } catch ( Throwable ignore ) {}
+        	throw JMSExceptionSupport.create("Could not connect to broker URL: " + brokerURL + ". Reason: " + e, e);
         }
     }
 
