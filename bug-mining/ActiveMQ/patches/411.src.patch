diff --git a/activemq-core/src/main/java/org/apache/activemq/broker/region/Queue.java b/activemq-core/src/main/java/org/apache/activemq/broker/region/Queue.java
index 5959b6e65..d6234f15f 100755
--- a/activemq-core/src/main/java/org/apache/activemq/broker/region/Queue.java
+++ b/activemq-core/src/main/java/org/apache/activemq/broker/region/Queue.java
@@ -1164,7 +1164,7 @@ public class Queue extends BaseDestination implements Task {
                         // pick the least loaded to add the message too
                         for (Subscription s : targets) {
                             if (target == null
-                                    || target.getInFlightUsage() > s.getInFlightUsage()) {
+                                    || target.getPendingQueueSize() > s.getPendingQueueSize()) {
                                 target = s;
                             }
                         }
diff --git a/activemq-core/src/test/java/org/apache/activemq/bugs/AMQ1866.java b/activemq-core/src/test/java/org/apache/activemq/bugs/AMQ1866.java
index 69ac3de78..7c29c48fb 100644
--- a/activemq-core/src/test/java/org/apache/activemq/bugs/AMQ1866.java
+++ b/activemq-core/src/test/java/org/apache/activemq/bugs/AMQ1866.java
@@ -33,6 +33,7 @@ import org.apache.activemq.broker.BrokerService;
 import org.apache.activemq.broker.region.policy.PolicyEntry;
 import org.apache.activemq.broker.region.policy.PolicyMap;
 import org.apache.activemq.command.ActiveMQQueue;
+import org.apache.activemq.store.amq.AMQPersistenceAdapter;
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
 
@@ -60,6 +61,9 @@ public class AMQ1866 extends TestCase {
     protected void setUp() throws Exception {
         // Start an embedded broker up.
         brokerService = new BrokerService();
+        AMQPersistenceAdapter adaptor = new AMQPersistenceAdapter();
+        adaptor.setIndexBinSize(4096);
+        brokerService.setPersistenceAdapter(adaptor);
         brokerService.deleteAllMessages();
         
         // A small max page size makes this issue occur faster.
