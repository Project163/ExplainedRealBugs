diff --git a/activemq-broker/src/main/java/org/apache/activemq/broker/TransportConnector.java b/activemq-broker/src/main/java/org/apache/activemq/broker/TransportConnector.java
index 5aa074b01..5e9c64527 100755
--- a/activemq-broker/src/main/java/org/apache/activemq/broker/TransportConnector.java
+++ b/activemq-broker/src/main/java/org/apache/activemq/broker/TransportConnector.java
@@ -90,9 +90,6 @@ public class TransportConnector implements Connector, BrokerServiceAware {
                 setEnableStatusMonitor(false);
             }
         }
-        if (server != null){
-            setAllowLinkStealing(server.isAllowLinkStealing());
-        }
     }
 
     /**
@@ -582,7 +579,7 @@ public class TransportConnector implements Connector, BrokerServiceAware {
 
     @Override
     public boolean isAllowLinkStealing() {
-        return allowLinkStealing;
+        return server.isAllowLinkStealing();
     }
 
     public void setAllowLinkStealing (boolean allowLinkStealing) {
diff --git a/activemq-mqtt/src/test/java/org/apache/activemq/transport/mqtt/MQTTTestSupport.java b/activemq-mqtt/src/test/java/org/apache/activemq/transport/mqtt/MQTTTestSupport.java
index 470e273ac..558873ffc 100644
--- a/activemq-mqtt/src/test/java/org/apache/activemq/transport/mqtt/MQTTTestSupport.java
+++ b/activemq-mqtt/src/test/java/org/apache/activemq/transport/mqtt/MQTTTestSupport.java
@@ -19,6 +19,7 @@ package org.apache.activemq.transport.mqtt;
 
 import java.io.File;
 import java.io.IOException;
+import java.net.URI;
 import java.security.ProtectionDomain;
 import java.security.SecureRandom;
 import java.security.cert.CertificateException;
@@ -157,6 +158,7 @@ public class MQTTTestSupport {
 
         brokerService.start();
         brokerService.waitUntilStarted();
+        port = brokerService.getTransportConnectorByName("mqtt").getConnectUri().getPort();
     }
 
     protected void applyMemoryLimitPolicy() throws Exception {
@@ -214,7 +216,11 @@ public class MQTTTestSupport {
             connectorURI.append("?").append(protocolConfig);
         }
 
-        port = brokerService.addConnector(connectorURI.toString()).getConnectUri().getPort();
+        TransportConnector connector = new TransportConnector();
+        connector.setUri(new URI(connectorURI.toString()));
+        connector.setName("mqtt");
+        brokerService.addConnector(connector);
+
         LOG.info("Added connector {} to broker", getProtocolScheme());
     }
 
