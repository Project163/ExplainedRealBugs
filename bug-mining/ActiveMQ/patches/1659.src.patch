diff --git a/activemq-core/src/main/java/org/apache/activemq/transport/nio/NIOOutputStream.java b/activemq-core/src/main/java/org/apache/activemq/transport/nio/NIOOutputStream.java
index b3d401951..b1fe4569d 100644
--- a/activemq-core/src/main/java/org/apache/activemq/transport/nio/NIOOutputStream.java
+++ b/activemq-core/src/main/java/org/apache/activemq/transport/nio/NIOOutputStream.java
@@ -23,10 +23,10 @@ import java.io.OutputStream;
 import java.nio.ByteBuffer;
 import java.nio.channels.WritableByteChannel;
 
-import org.apache.activemq.transport.tcp.TimeStampStream;
-
 import javax.net.ssl.SSLEngine;
 
+import org.apache.activemq.transport.tcp.TimeStampStream;
+
 /**
  * An optimized buffered outputstream for Tcp
  */
@@ -192,6 +192,16 @@ public class NIOOutputStream extends OutputStream implements TimeStampStream {
                 // written.
                 out.write(plain);
                 remaining = data.remaining();
+
+                // if the data buffer was larger than the packet buffer we might need to
+                // wrap more packets until we reach the end of data, but only when plain
+                // has no more space since we are non-blocking and a write might not have
+                // written anything.
+                if (data.hasRemaining() && !plain.hasRemaining()) {
+                    plain.clear();
+                    engine.wrap(data, plain);
+                    plain.flip();
+                }
             }
         } finally {
             writeTimestamp = -1;
diff --git a/activemq-core/src/test/java/org/apache/activemq/transport/stomp/StompTest.java b/activemq-core/src/test/java/org/apache/activemq/transport/stomp/StompTest.java
index 59bbca2a0..3fd106de5 100644
--- a/activemq-core/src/test/java/org/apache/activemq/transport/stomp/StompTest.java
+++ b/activemq-core/src/test/java/org/apache/activemq/transport/stomp/StompTest.java
@@ -2174,4 +2174,44 @@ public class StompTest extends CombinationTestSupport {
         frame = "DISCONNECT\n" + "\n\n" + Stomp.NULL;
         stompConnection.sendFrame(frame);
     }
+
+    public void testSendReceiveBigMessage() throws Exception {
+
+        String frame = "CONNECT\n" + "login:system\n" + "passcode:manager\n\n" + Stomp.NULL;
+        stompConnection.sendFrame(frame);
+
+        frame = stompConnection.receiveFrame();
+        assertTrue(frame.startsWith("CONNECTED"));
+
+        frame = "SUBSCRIBE\n" + "destination:/queue/" + getQueueName() + "\n" + "ack:auto\n\n" + Stomp.NULL;
+        stompConnection.sendFrame(frame);
+
+        int size = 100;
+        char[] bigBodyArray = new char[size];
+        Arrays.fill(bigBodyArray, 'a');
+        String bigBody = new String(bigBodyArray);
+
+        frame = "SEND\n" + "destination:/queue/" + getQueueName() + "\n\n" + bigBody + Stomp.NULL;
+
+        stompConnection.sendFrame(frame);
+
+        StompFrame sframe = stompConnection.receive();
+        assertNotNull(sframe);
+        assertEquals("MESSAGE", sframe.getAction());
+        assertEquals(bigBody, sframe.getBody());
+
+        size = 3000000;
+        bigBodyArray = new char[size];
+        Arrays.fill(bigBodyArray, 'a');
+        bigBody = new String(bigBodyArray);
+
+        frame = "SEND\n" + "destination:/queue/" + getQueueName() + "\n\n" + bigBody + Stomp.NULL;
+
+        stompConnection.sendFrame(frame);
+
+        sframe = stompConnection.receive(30000);
+        assertNotNull(sframe);
+        assertEquals("MESSAGE", sframe.getAction());
+        assertEquals(bigBody, sframe.getBody());
+    }
 }
