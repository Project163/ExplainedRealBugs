diff --git a/activemq-core/src/main/java/org/apache/activemq/store/jdbc/TransactionContext.java b/activemq-core/src/main/java/org/apache/activemq/store/jdbc/TransactionContext.java
index c8e328bf7..c7f11dc8b 100755
--- a/activemq-core/src/main/java/org/apache/activemq/store/jdbc/TransactionContext.java
+++ b/activemq-core/src/main/java/org/apache/activemq/store/jdbc/TransactionContext.java
@@ -162,10 +162,13 @@ public class TransactionContext {
             }
         } catch (SQLException e) {
             JDBCPersistenceAdapter.log("Commit failed: ", e);
+            
+            this.rollback(); 
+            
             throw IOExceptionSupport.create(e);
         } finally {
-            inTx = false;
             close();
+            inTx = false;
         }
     }
 
@@ -192,8 +195,8 @@ public class TransactionContext {
             JDBCPersistenceAdapter.log("Rollback failed: ", e);
             throw IOExceptionSupport.create(e);
         } finally {
-            inTx = false;
             close();
+            inTx = false;
         }
     }
 
diff --git a/activemq-core/src/main/java/org/apache/activemq/store/jdbc/adapter/DB2JDBCAdapter.java b/activemq-core/src/main/java/org/apache/activemq/store/jdbc/adapter/DB2JDBCAdapter.java
index 26f0b7c5a..75dac0c90 100644
--- a/activemq-core/src/main/java/org/apache/activemq/store/jdbc/adapter/DB2JDBCAdapter.java
+++ b/activemq-core/src/main/java/org/apache/activemq/store/jdbc/adapter/DB2JDBCAdapter.java
@@ -27,9 +27,6 @@ import org.apache.activemq.store.jdbc.Statements;
  * @org.apache.xbean.XBean element="db2JDBCAdapter"
  */
 public class DB2JDBCAdapter extends DefaultJDBCAdapter {
-    public DB2JDBCAdapter() {
-        batchStatments = false;
-    }
 
     public void setStatements(Statements statements) {
         String lockCreateStatement = "LOCK TABLE " + statements.getFullLockTableName() + " IN EXCLUSIVE MODE";
diff --git a/activemq-core/src/test/java/org/apache/activemq/store/jdbc/JDBCStoreBrokerTest.java b/activemq-core/src/test/java/org/apache/activemq/store/jdbc/JDBCStoreBrokerTest.java
new file mode 100644
index 000000000..b0eccb31d
--- /dev/null
+++ b/activemq-core/src/test/java/org/apache/activemq/store/jdbc/JDBCStoreBrokerTest.java
@@ -0,0 +1,44 @@
+package org.apache.activemq.store.jdbc;
+
+import junit.framework.Test;
+
+import org.apache.activemq.broker.BrokerService;
+import org.apache.activemq.broker.BrokerTest;
+import org.apache.derby.jdbc.EmbeddedDataSource;
+
+public class JDBCStoreBrokerTest extends BrokerTest {
+
+    protected BrokerService createBroker() throws Exception {
+        BrokerService broker = new BrokerService();
+        JDBCPersistenceAdapter jdbc = new JDBCPersistenceAdapter();
+        EmbeddedDataSource dataSource = new EmbeddedDataSource();
+        dataSource.setDatabaseName("derbyDb");
+        dataSource.setCreateDatabase("create");
+        jdbc.setDataSource(dataSource);
+        
+        jdbc.deleteAllMessages();
+        broker.setPersistenceAdapter(jdbc);
+        return broker;
+    }
+    
+    protected BrokerService createRestartedBroker() throws Exception {
+        BrokerService broker = new BrokerService();
+        JDBCPersistenceAdapter jdbc = new JDBCPersistenceAdapter();
+        EmbeddedDataSource dataSource = new EmbeddedDataSource();
+        dataSource.setDatabaseName("derbyDb");
+        dataSource.setCreateDatabase("create");
+        jdbc.setDataSource(dataSource);
+        broker.setPersistenceAdapter(jdbc);
+        return broker;
+    }
+    
+    
+    public static Test suite() {
+        return suite(JDBCStoreBrokerTest.class);
+    }
+    
+    public static void main(String[] args) {
+        junit.textui.TestRunner.run(suite());
+    }
+	
+}
