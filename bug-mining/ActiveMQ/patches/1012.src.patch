diff --git a/activemq-rar/pom.xml b/activemq-rar/pom.xml
index 3479bf901..7277fc76a 100644
--- a/activemq-rar/pom.xml
+++ b/activemq-rar/pom.xml
@@ -217,15 +217,47 @@
       <groupId>log4j</groupId>
       <artifactId>log4j</artifactId>
     </dependency>
+    <dependency>
+      <groupId>org.apache.activemq</groupId>
+      <artifactId>activemq-all</artifactId>
+      <scope>test</scope>
+    </dependency>
+    <dependency>
+      <groupId>junit</groupId>
+      <artifactId>junit</artifactId>
+      <scope>test</scope>
+    </dependency>  
   </dependencies>
   <build>
     <plugins>
       <plugin>
         <artifactId>maven-surefire-plugin</artifactId>
         <configuration>
-          <skip>true</skip>
+          <forkMode>pertest</forkMode>
+          <childDelegation>false</childDelegation>
         </configuration>
       </plugin>
+      <plugin>
+        <groupId>org.apache.maven.plugins</groupId>
+        <artifactId>maven-resources-plugin</artifactId>
+        <executions>
+          <execution>
+            <id>copy-conf</id>
+            <phase>process-test-resources</phase>
+            <goals>
+              <goal>copy-resources</goal>
+            </goals>
+            <configuration>
+              <outputDirectory>target/test-classes</outputDirectory>
+              <resources>
+                <resource>
+                  <directory>src/main/rar</directory>
+                </resource>
+              </resources>
+            </configuration>
+          </execution>
+        </executions>
+      </plugin>
     </plugins>
   </build>
   
diff --git a/activemq-rar/src/main/rar/broker-config.xml b/activemq-rar/src/main/rar/broker-config.xml
index 98757ffc5..3b1dd3b5c 100644
--- a/activemq-rar/src/main/rar/broker-config.xml
+++ b/activemq-rar/src/main/rar/broker-config.xml
@@ -16,10 +16,15 @@
     limitations under the License.
 -->
 <!-- START SNIPPET: xbean -->
-<beans xmlns="http://activemq.apache.org/schema/core">
+<beans
+  xmlns="http://www.springframework.org/schema/beans"
+  xmlns:amq="http://activemq.apache.org/schema/core"
+  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
+  xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
+  http://activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd">
 
   <!--  shutdown hook is disabled as RAR classloader may be gone at shutdown -->
-  <broker useJmx="true" useShutdownHook="false">
+  <broker xmlns="http://activemq.apache.org/schema/core" useJmx="true" useShutdownHook="false">
 
      <managementContext>
        <!-- use appserver provided context instead of creating one,
@@ -27,9 +32,9 @@
        <managementContext createConnector="false"/>
      </managementContext>
 
-    <persistenceFactory>
-      <journalPersistenceAdapterFactory journalLogFiles="5" dataDirectory="../data"/>
-    </persistenceFactory>
+    <persistenceAdapter>
+       <kahaDB directory="activemq-data/kahadb"/>
+     </persistenceAdapter>
 
     <transportConnectors>
       <transportConnector uri="tcp://localhost:61616"/>
diff --git a/activemq-rar/src/test/java/org/apache/activemq/BrokerConfigTest.java b/activemq-rar/src/test/java/org/apache/activemq/BrokerConfigTest.java
new file mode 100644
index 000000000..533ecdf0f
--- /dev/null
+++ b/activemq-rar/src/test/java/org/apache/activemq/BrokerConfigTest.java
@@ -0,0 +1,30 @@
+/**
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.activemq;
+
+import org.apache.activemq.broker.BrokerFactory;
+import org.apache.activemq.broker.BrokerService;
+import org.junit.Test;
+
+public class BrokerConfigTest {
+
+    @Test
+    public void testEmbeddedxMLConfig() throws Exception {
+        BrokerService broker = BrokerFactory.createBroker("xbean:broker-config.xml");
+        broker.stop();
+    }
+}
\ No newline at end of file
