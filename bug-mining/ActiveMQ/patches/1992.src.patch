diff --git a/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java b/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java
index 1cce8a761..b3c2d6f3b 100644
--- a/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java
+++ b/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java
@@ -1838,31 +1838,34 @@ public abstract class MessageDatabase extends ServiceSupport implements BrokerSe
                     pageFile.tx().execute(new Transaction.Closure<IOException>() {
                         @Override
                         public void execute(Transaction tx) throws IOException {
-                            BTreeIndex<Long, HashSet<String>> oldAckPositions =
-                                new BTreeIndex<Long, HashSet<String>>(pageFile, dataIn.readLong());
-                            oldAckPositions.setKeyMarshaller(LongMarshaller.INSTANCE);
-                            oldAckPositions.setValueMarshaller(HashSetStringMarshaller.INSTANCE);
-                            oldAckPositions.load(tx);
-
                             LinkedHashMap<String, SequenceSet> temp = new LinkedHashMap<String, SequenceSet>();
 
-                            // Do the initial build of the data in memory before writing into the store
-                            // based Ack Positions List to avoid a lot of disk thrashing.
-                            Iterator<Entry<Long, HashSet<String>>> iterator = oldAckPositions.iterator(tx);
-                            while (iterator.hasNext()) {
-                                Entry<Long, HashSet<String>> entry = iterator.next();
-
-                                for(String subKey : entry.getValue()) {
-                                    SequenceSet pendingAcks = temp.get(subKey);
-                                    if (pendingAcks == null) {
-                                        pendingAcks = new SequenceSet();
-                                        temp.put(subKey, pendingAcks);
+                            if (metadata.version >= 3) {
+                                // migrate
+                                BTreeIndex<Long, HashSet<String>> oldAckPositions =
+                                        new BTreeIndex<Long, HashSet<String>>(pageFile, dataIn.readLong());
+                                oldAckPositions.setKeyMarshaller(LongMarshaller.INSTANCE);
+                                oldAckPositions.setValueMarshaller(HashSetStringMarshaller.INSTANCE);
+                                oldAckPositions.load(tx);
+
+
+                                // Do the initial build of the data in memory before writing into the store
+                                // based Ack Positions List to avoid a lot of disk thrashing.
+                                Iterator<Entry<Long, HashSet<String>>> iterator = oldAckPositions.iterator(tx);
+                                while (iterator.hasNext()) {
+                                    Entry<Long, HashSet<String>> entry = iterator.next();
+
+                                    for(String subKey : entry.getValue()) {
+                                        SequenceSet pendingAcks = temp.get(subKey);
+                                        if (pendingAcks == null) {
+                                            pendingAcks = new SequenceSet();
+                                            temp.put(subKey, pendingAcks);
+                                        }
+
+                                        pendingAcks.add(entry.getKey());
                                     }
-
-                                    pendingAcks.add(entry.getKey());
                                 }
                             }
-
                             // Now move the pending messages to ack data into the store backed
                             // structure.
                             value.ackPositions = new ListIndex<String, SequenceSet>(pageFile, tx.allocate());
diff --git a/activemq-unit-tests/src/test/java/org/apache/activemq/store/kahadb/KahaDBVersionTest.java b/activemq-unit-tests/src/test/java/org/apache/activemq/store/kahadb/KahaDBVersionTest.java
index c163759f2..c03f60db0 100644
--- a/activemq-unit-tests/src/test/java/org/apache/activemq/store/kahadb/KahaDBVersionTest.java
+++ b/activemq-unit-tests/src/test/java/org/apache/activemq/store/kahadb/KahaDBVersionTest.java
@@ -168,7 +168,7 @@ public class KahaDBVersionTest extends TestCase {
                 TextMessage msg = (TextMessage) topicConsumer.receive(10000);
                 count++;
                 // System.err.println(msg.getText());
-                assertNotNull(msg);
+                assertNotNull("" + count, msg);
             }
             LOG.info("Consumed " + count + " from topic");
             connection.close();
