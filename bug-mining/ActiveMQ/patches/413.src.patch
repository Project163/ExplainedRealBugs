diff --git a/activemq-core/src/main/java/org/apache/activemq/transport/fanout/FanoutTransport.java b/activemq-core/src/main/java/org/apache/activemq/transport/fanout/FanoutTransport.java
index abd71c072..f049c34ae 100755
--- a/activemq-core/src/main/java/org/apache/activemq/transport/fanout/FanoutTransport.java
+++ b/activemq-core/src/main/java/org/apache/activemq/transport/fanout/FanoutTransport.java
@@ -77,7 +77,7 @@ public class FanoutTransport implements CompositeTransport {
     private int maxReconnectAttempts;
     private Exception connectionFailure;
     private FanoutTransportHandler primary;
-    private boolean fanOutQueues;
+    private boolean fanOutQueues = false;
 
     static class RequestCounter {
 
diff --git a/activemq-core/src/main/java/org/apache/activemq/transport/fanout/FanoutTransportFactory.java b/activemq-core/src/main/java/org/apache/activemq/transport/fanout/FanoutTransportFactory.java
index 2e0657b59..16165232d 100755
--- a/activemq-core/src/main/java/org/apache/activemq/transport/fanout/FanoutTransportFactory.java
+++ b/activemq-core/src/main/java/org/apache/activemq/transport/fanout/FanoutTransportFactory.java
@@ -63,11 +63,11 @@ public class FanoutTransportFactory extends TransportFactory {
      */
     public Transport createTransport(URI location) throws IOException, URISyntaxException {
 
-        CompositeData compositData = URISupport.parseComposite(location);
-        Map<String, String> parameters = new HashMap<String, String>(compositData.getParameters());
+        CompositeData compositeData = URISupport.parseComposite(location);
+        Map<String, String> parameters = new HashMap<String, String>(compositeData.getParameters());
         DiscoveryTransport transport = new DiscoveryTransport(createTransport(parameters));
 
-        DiscoveryAgent discoveryAgent = DiscoveryAgentFactory.createDiscoveryAgent(compositData.getComponents()[0]);
+        DiscoveryAgent discoveryAgent = DiscoveryAgentFactory.createDiscoveryAgent(compositeData.getComponents()[0]);
         transport.setDiscoveryAgent(discoveryAgent);
 
         return transport;
diff --git a/activemq-core/src/test/java/org/apache/activemq/transport/fanout/FanoutTransportBrokerTest.java b/activemq-core/src/test/java/org/apache/activemq/transport/fanout/FanoutTransportBrokerTest.java
index 05b8ce795..01fe7e0ab 100755
--- a/activemq-core/src/test/java/org/apache/activemq/transport/fanout/FanoutTransportBrokerTest.java
+++ b/activemq-core/src/test/java/org/apache/activemq/transport/fanout/FanoutTransportBrokerTest.java
@@ -57,7 +57,7 @@ public class FanoutTransportBrokerTest extends NetworkTestSupport {
 
     public void initCombosForTestPublisherFansout() {
         addCombinationValues("deliveryMode", new Object[] {Integer.valueOf(DeliveryMode.NON_PERSISTENT), Integer.valueOf(DeliveryMode.PERSISTENT)});
-        addCombinationValues("destination", new Object[] {new ActiveMQTopic("TEST")});
+        addCombinationValues("destination", new Object[] {new ActiveMQTopic("TEST"), new ActiveMQQueue("TEST")});
     }
 
     public void testPublisherFansout() throws Exception {
@@ -193,7 +193,7 @@ public class FanoutTransportBrokerTest extends NetworkTestSupport {
     }
 
     protected StubConnection createFanoutConnection() throws Exception {
-        URI fanoutURI = new URI("fanout://static://(" + connector.getServer().getConnectURI() + "," + "mock://" + remoteConnector.getServer().getConnectURI() + ")");
+        URI fanoutURI = new URI("fanout://(static://(" + connector.getServer().getConnectURI() + "," + "mock://" + remoteConnector.getServer().getConnectURI() + "))?fanOutQueues=true");
         Transport transport = TransportFactory.connect(fanoutURI);
         StubConnection connection = new StubConnection(transport);
         connections.add(connection);
