diff --git a/cms/activemqcms/src/activemq/ActiveMQConnectionFactory.cpp b/cms/activemqcms/src/activemq/ActiveMQConnectionFactory.cpp
index b213d2b53..1e0578d2f 100644
--- a/cms/activemqcms/src/activemq/ActiveMQConnectionFactory.cpp
+++ b/cms/activemqcms/src/activemq/ActiveMQConnectionFactory.cpp
@@ -48,7 +48,7 @@ ActiveMQConnectionFactory::ActiveMQConnectionFactory( const char* userName,
 	this->userName = userName;
 	this->password = password;
 
-    brokerUrl = brokerUrl;
+    this->brokerUrl = brokerUrl;
     
     transportFactory = new activemq::transport::stomp::StompTransportFactory();
 }
diff --git a/cms/activemqcms/src/activemq/transport/stomp/StompTransportFactory.cpp b/cms/activemqcms/src/activemq/transport/stomp/StompTransportFactory.cpp
index 7f43489fb..d5fb8e905 100644
--- a/cms/activemqcms/src/activemq/transport/stomp/StompTransportFactory.cpp
+++ b/cms/activemqcms/src/activemq/transport/stomp/StompTransportFactory.cpp
@@ -26,8 +26,16 @@ using namespace std;
 ////////////////////////////////////////////////////////////////////////////////
 Transport* StompTransportFactory::createTransport( const char* brokerUrl ){
     
-    brokerHost = "127.0.0.1";
-    brokerPort = 61626;
+    string temp = brokerUrl;
+    unsigned int ix = temp.find( ':' );
+    if( ix == string::npos ){
+        throw new ActiveMQException( "StompTransportFactory::createTransport - no port provided in url" );
+    }
+    
+    brokerHost = temp.substr(0,ix);
+    
+    sscanf(brokerUrl+ix+1, "%d", &brokerPort );
+    
     return new StompTransport( brokerHost.c_str(), brokerPort, "", "" );
 }
 
