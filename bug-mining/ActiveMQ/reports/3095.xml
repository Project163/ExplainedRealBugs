<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:41:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6798] Queue left StoreUsage object in memory. Memory leak</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6798</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Our services create queues on broker. It queues exists in 1 day then they become inactive, cause clients turned off. Active mq removes them by Inactivity timeout 60 seconds. But memory consumption of broker grows permanently. We acquired heap dump, and saw that org.apache.activemq.usage.StoreUsage contains 2.7 millions of object with 1.5 gb. That objects belongs to StoreUsage of queues. &lt;/p&gt;

&lt;p&gt;I don&apos;t sure that we uses broker as it should be used. Maybe we shouldn&apos;t create new queues. But this behavior is stranged for me.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux 3.10.0-327.36.3.el7.x86_64 #1 SMP Mon Oct 24 16:09:20 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux&lt;/p&gt;</environment>
        <key id="13097283">AMQ-6798</key>
            <summary>Queue left StoreUsage object in memory. Memory leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="tolikrdi">Anatolii Botov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Aug 2017 10:20:26 +0000</created>
                <updated>Thu, 24 Aug 2017 13:25:34 +0000</updated>
                            <resolved>Thu, 24 Aug 2017 13:25:34 +0000</resolved>
                                    <version>5.10.2</version>
                    <version>5.15.0</version>
                                    <fixVersion>5.15.1</fixVersion>
                    <fixVersion>5.16.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16139866" author="tolikrdi" created="Thu, 24 Aug 2017 10:26:43 +0000"  >&lt;p&gt;Dump of ActiveMQ Broker memory - this dump is after test cases but StoreUsage objects hold here too.&lt;/p&gt;</comment>
                            <comment id="16139868" author="tolikrdi" created="Thu, 24 Aug 2017 10:27:43 +0000"  >&lt;p&gt;ActiveMQ configuration file.&lt;/p&gt;</comment>
                            <comment id="16139908" author="christopher.l.shannon" created="Thu, 24 Aug 2017 11:23:38 +0000"  >&lt;p&gt;Can you try a newer version of ActiveMQ to see if your issue still exists? Such as 5.14.5 or 5.15.0 ?&lt;/p&gt;</comment>
                            <comment id="16139936" author="tolikrdi" created="Thu, 24 Aug 2017 11:52:07 +0000"  >&lt;p&gt;I suggest that org.apache.activemq.broker.region.Queue in method start() runs StoreUsage like this:&lt;br/&gt;
if (systemUsage.getStoreUsage() != null) {&lt;br/&gt;
       systemUsage.getStoreUsage().start();&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;But in method stop StoreUsage isn&apos;t stoped. So it remains in its parent StoreUsage.&lt;/p&gt;

&lt;p&gt;Ok i&apos;ll try to test on 5.14.5 or 5.15.0.&lt;/p&gt;</comment>
                            <comment id="16139952" author="christopher.l.shannon" created="Thu, 24 Aug 2017 12:10:03 +0000"  >&lt;p&gt;I think you might be right, the memoryUsage variable is stopped in the stop() method but the systemUsage variable is not stopped which I think would lead to this leak.  I&apos;ll take a look at this closer today.&lt;/p&gt;</comment>
                            <comment id="16139989" author="tolikrdi" created="Thu, 24 Aug 2017 12:41:16 +0000"  >&lt;p&gt;I&apos;ve tested on ActiveMq 5.15.0. Story is the same. StoreUsage is hung in their parent. Memory grows after each queue instance creation.&lt;/p&gt;</comment>
                            <comment id="16140028" author="jira-bot" created="Thu, 24 Aug 2017 13:24:53 +0000"  >&lt;p&gt;Commit 35bd3ad938f5c378b17a34980d2f3480bf3bbfc3 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=35bd3ad&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=35bd3ad&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6798&quot; title=&quot;Queue left StoreUsage object in memory. Memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6798&quot;&gt;&lt;del&gt;AMQ-6798&lt;/del&gt;&lt;/a&gt; - Clean up store usage object on Queue stop&lt;/p&gt;

&lt;p&gt;When queues are stopped the StoreUsage object needs to be stopped so it&lt;br/&gt;
will be removed from the parent StoreUsage.  This allows the object to&lt;br/&gt;
be garbage collected and prevents a memory leak.&lt;/p&gt;</comment>
                            <comment id="16140029" author="jira-bot" created="Thu, 24 Aug 2017 13:25:25 +0000"  >&lt;p&gt;Commit eca72dc81ad8113e31fadf161580bf5e2b93e27a in activemq&apos;s branch refs/heads/activemq-5.15.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=eca72dc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=eca72dc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6798&quot; title=&quot;Queue left StoreUsage object in memory. Memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6798&quot;&gt;&lt;del&gt;AMQ-6798&lt;/del&gt;&lt;/a&gt; - Clean up store usage object on Queue stop&lt;/p&gt;

&lt;p&gt;When queues are stopped the StoreUsage object needs to be stopped so it&lt;br/&gt;
will be removed from the parent StoreUsage.  This allows the object to&lt;br/&gt;
be garbage collected and prevents a memory leak.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 35bd3ad938f5c378b17a34980d2f3480bf3bbfc3)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12883522" name="1535.dmp" size="31107025" author="tolikrdi" created="Thu, 24 Aug 2017 10:26:40 +0000"/>
                            <attachment id="12883523" name="activemq.xml" size="3150" author="tolikrdi" created="Thu, 24 Aug 2017 10:27:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 12 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3j8hb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>