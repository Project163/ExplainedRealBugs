<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:46:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1464] AMQ 5.0 Fanout Regression  </title>
                <link>https://issues.apache.org/jira/browse/AMQ-1464</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;On 4.1.1, the fanout transport works as expected. My producer is fanning out message sends (queues) to two unrelated message brokers and clients connected to both those brokers get the messages.&lt;/p&gt;

&lt;p&gt;However, when I run the same exact test under 5.0 (the 10/10 SNAPSHOT), fanout no longer works as expected   Only the 5.0 broker that my producer first connects with gets the messages. The second broker never gets the messages and hurls this exception.&lt;/p&gt;

&lt;p&gt;ERROR Service      - Async error occurred: java.lang.IllegalStateException: Cannot remove a consumer that had not been registered: ID:DIEGO-3739-1192470567781-0:0:-1:1&lt;br/&gt;
java.lang.IllegalStateException: Cannot remove a consumer that had not been registered: ID:DIEGO-3739-1192470567781-0:0:-1:1&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.processRemoveConsumer(&lt;br/&gt;
TransportConnection.java:547)&lt;br/&gt;
        at org.apache.activemq.command.RemoveInfo.visit(RemoveInfo.java:64)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:281)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:178)&lt;br/&gt;
        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:67)&lt;br/&gt;
        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:134)&lt;br/&gt;
        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:124)&lt;br/&gt;
        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:183)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:170)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:595)&lt;/p&gt;

&lt;p&gt;Joe&lt;/p&gt;
</description>
                <environment>&lt;p&gt;AMQ 5.0 - the 10/10/07 SNAPSHOT&lt;/p&gt;</environment>
        <key id="12483263">AMQ-1464</key>
            <summary>AMQ 5.0 Fanout Regression  </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dejanb">Dejan Bosanac</assignee>
                                    <reporter username="joef">Joe Francis</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Oct 2007 18:14:00 +0000</created>
                <updated>Mon, 24 May 2010 18:44:07 +0000</updated>
                            <resolved>Mon, 24 May 2010 18:44:07 +0000</resolved>
                                    <version>5.0.0</version>
                                    <fixVersion>5.4.0</fixVersion>
                                    <component>JMS client</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12939167" author="chirino" created="Mon, 22 Oct 2007 14:29:39 +0000"  >&lt;p&gt;Hi Joe,&lt;/p&gt;

&lt;p&gt;So are you saying that you are trying to fan out to two JMS Queues??  It seems like you are trying to deliver the message to two consumer, and if that&apos;s the case, you should be using Topics instead.&lt;/p&gt;</comment>
                            <comment id="12939136" author="joef" created="Mon, 22 Oct 2007 15:02:23 +0000"  >&lt;p&gt;Hi Hiram,&lt;/p&gt;

&lt;p&gt;Yes, I am trying to fanout to two queues, each on two &apos;unrelated&apos; brokers.&lt;br/&gt;
It works great on 4.1.1, but doesn&apos;t on 5.0. &lt;/p&gt;

&lt;p&gt;Joe&lt;/p&gt;


</comment>
                            <comment id="12939184" author="chirino" created="Mon, 22 Oct 2007 17:30:18 +0000"  >&lt;p&gt;Um..  I think the problem is that this was &apos;fixed&apos; since 4.1&lt;br/&gt;
Logically it does not make sense to fanout queues since messages sent to queues should only be consumed once.  I&apos;ll add a option to the transport so that fanout on queues is also supported in the 5.0 release.  Right now fanout is only fanning out messages to Topics.&lt;/p&gt;</comment>
                            <comment id="12939166" author="joef" created="Mon, 22 Oct 2007 18:06:23 +0000"  >&lt;p&gt;Hmm, here is what the fanout transport reference page states.&lt;/p&gt;

&lt;p&gt;&quot;The Fanout transport layers reconnect and replication logic on top of any&lt;br/&gt;
of the other transports. It is used replicate commands to multiple brokers.&quot;&lt;/p&gt;

&lt;p&gt;Perhaps I am missing it, but nowhere in the documentation does it state that&lt;br/&gt;
the fanout can only be used for Topics.&lt;/p&gt;

&lt;p&gt;My apologies for not properly interpreting the purpose of the fanout and&lt;br/&gt;
thus not using it in a logical manner; however, we do have a need to have a&lt;br/&gt;
producer &quot;replicate&quot; a message to two completely different systems and we&lt;br/&gt;
want the message consumed only once on each of those systems. The two&lt;br/&gt;
systems are completely separate from one another (i.e., the brokers and&lt;br/&gt;
consumers on those systems are not interconnected).  &lt;/p&gt;

</comment>
                            <comment id="12939129" author="chirino" created="Mon, 22 Oct 2007 18:41:01 +0000"  >&lt;p&gt;Hi &lt;/p&gt;

&lt;p&gt;As of revision 587188 the broker will now support at fanOutQueues option the defaults to false which enables fanning out on queues too.  So to enable just update your URI to something like:&lt;/p&gt;

&lt;p&gt;fanout://( discovery-agent )?fanOutQueues=true&lt;/p&gt;</comment>
                            <comment id="12939164" author="garyw" created="Thu, 1 Nov 2007 21:48:31 +0000"  >&lt;p&gt;It appears that the Queues versus Topics issue has been resolved, with the addition of the new fanOutQueues option. However, the problem of java.lang.IllegalStateException remains.&lt;/p&gt;

&lt;p&gt;I am using Topics with the 10/28/07 5.0 Snapshot. I have 2 standalone brokers, each connected to a Topic consumer. I start a Topic producer that uses fanout to connect to the 2 brokers. The messages that are sent by the producer are received by each consumer (good), but after the producer closes the session, one of the the brokers throws the exception &quot;ERROR Service      - Async error occurred: java.lang.IllegalStateException: Cannot remove a consumer that had not been registered&quot; as Joe reported.&lt;/p&gt;</comment>
                            <comment id="12940010" author="hadrian" created="Wed, 30 Jul 2008 15:13:56 +0000"  >&lt;p&gt;I added a test to the FanoutTransportBrokerTest for that and I cannot reproduce it.  Please let us know if this is still an issue for you, or we could close it with a could not reproduce.  Adding a unit test will also help a lot.&lt;/p&gt;

&lt;p&gt;One other (quite important) thing I noticed is that the initial description mentioned that the feature did work in 4.1.1 so I assume that had to be topics not queues and Gary tested with topics too.  I don&apos;t know how much sense would make to implement fan-out for queues as topics should be used in such a case.  Could you please give more details why fan-out would be needed for queues?&lt;/p&gt;</comment>
                            <comment id="12940172" author="gtully" created="Mon, 8 Sep 2008 17:15:47 +0000"  >&lt;p&gt;partial fix helps and IllegalStateException cannot be reproduced. To progress further if necessary, a unit test would be required.&lt;/p&gt;</comment>
                            <comment id="12940794" author="mcarter" created="Thu, 19 Feb 2009 03:10:44 +0000"  >&lt;p&gt;I&apos;m using activeMQ 5.2.0 and I get this exact issue. I&apos;ll attach a test that causes it on my machine as well as the output from that test&lt;/p&gt;</comment>
                            <comment id="12940791" author="mcarter" created="Thu, 19 Feb 2009 03:14:31 +0000"  >&lt;p&gt;Here are the aforementioned test and test output files.&lt;/p&gt;</comment>
                            <comment id="12940837" author="mcarter" created="Thu, 19 Feb 2009 03:25:44 +0000"  >&lt;p&gt;I should also point out that while that test doesn&apos;t have the &apos;fanOutQueues=true&apos; option explicitly specified, I get the same output when using that option as well.&lt;/p&gt;</comment>
                            <comment id="12942727" author="dejanb" created="Mon, 24 May 2010 18:44:07 +0000"  >&lt;p&gt;Fixed with svn revision 947757&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461353" name="illegal-state-test-2009-02-19.txt" size="1219" author="mcarter" created="Thu, 19 Feb 2009 03:14:31 +0000"/>
                            <attachment id="12461277" name="illegal-state-test-output-2009-02-19.txt" size="5377" author="mcarter" created="Thu, 19 Feb 2009 03:14:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42094</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 27 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rpyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>159851</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>