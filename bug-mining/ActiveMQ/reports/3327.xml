<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:49:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-7480] NPE after XA transaction timeout</title>
                <link>https://issues.apache.org/jira/browse/AMQ-7480</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Under abnormal conditions some of our JMS listeners use longer than expected time. The listeners are using XA transactions. If a XA transaction timer is triggered then even though the listener successfully processed the message we get an NPE and JDBC connection leak in the broker.&#160;&lt;/p&gt;

&lt;p&gt;The offending stack is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2020-05-06 14:01:51,697 [eListenerContainer-1] WARN .x.XAResourceTransaction - XA resource &apos;xamq&apos;: rollback for XID &apos;3139322E3136382E322E3134302E746D313538383739383839393936303030303036:3139322E3136382E322E3134302E746D36&apos; raised -7: the XA resource has become unavailable
javax.transaction.xa.XAException: java.lang.NullPointerException
 at org.apache.activemq.TransactionContext.toXAException(TransactionContext.java:803) ~[activemq-client-5.15.12.jar:5.15.12]
 at org.apache.activemq.TransactionContext.rollback(TransactionContext.java:552) ~[activemq-client-5.15.12.jar:5.15.12]
 at com.atomikos.datasource.xa.XAResourceTransaction.rollback(XAResourceTransaction.java:460) [transactions-jta-4.0.6.jar:?]
 at com.atomikos.icatch.imp.RollbackMessage.send(RollbackMessage.java:47) [transactions-4.0.6.jar:?]
 at com.atomikos.icatch.imp.RollbackMessage.send(RollbackMessage.java:20) [transactions-4.0.6.jar:?]
 at com.atomikos.icatch.imp.PropagationMessage.submit(PropagationMessage.java:67) [transactions-4.0.6.jar:?]
 at com.atomikos.icatch.imp.Propagator$PropagatorThread.run(Propagator.java:63) [transactions-4.0.6.jar:?]
 at com.atomikos.icatch.imp.Propagator.submitPropagationMessage(Propagator.java:42) [transactions-4.0.6.jar:?]
 at com.atomikos.icatch.imp.CoordinatorStateHandler.rollbackFromWithinCallback(CoordinatorStateHandler.java:468) [transactions-4.0.6.jar:?]
 at com.atomikos.icatch.imp.ActiveStateHandler$4.doRollback(ActiveStateHandler.java:189) [transactions-4.0.6.jar:?]
 at com.atomikos.icatch.imp.CoordinatorStateHandler.rollbackWithAfterCompletionNotification(CoordinatorStateHandler.java:563) [transactions-4.0.6.jar:?]
 at com.atomikos.icatch.imp.ActiveStateHandler.prepare(ActiveStateHandler.java:184) [transactions-4.0.6.jar:?]
 at com.atomikos.icatch.imp.CoordinatorImp.prepare(CoordinatorImp.java:523) [transactions-4.0.6.jar:?]
 at com.atomikos.icatch.imp.CoordinatorImp.terminate(CoordinatorImp.java:687) [transactions-4.0.6.jar:?]
 at com.atomikos.icatch.imp.CompositeTransactionImp.commit(CompositeTransactionImp.java:282) [transactions-4.0.6.jar:?]
 at com.atomikos.icatch.jta.TransactionImp.commit(TransactionImp.java:172) [transactions-jta-4.0.6.jar:?]
 at com.atomikos.icatch.jta.TransactionManagerImp.commit(TransactionManagerImp.java:414) [transactions-jta-4.0.6.jar:?]
 at com.atomikos.icatch.jta.UserTransactionImp.commit(UserTransactionImp.java:86) [transactions-jta-4.0.6.jar:?]
 at org.springframework.transaction.jta.JtaTransactionManager.doCommit(JtaTransactionManager.java:1035) [spring-tx-5.2.4.RELEASE.jar:5.2.4.RELEASE]
 at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:743) [spring-tx-5.2.4.RELEASE.jar:5.2.4.RELEASE]
 at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:711) [spring-tx-5.2.4.RELEASE.jar:5.2.4.RELEASE]
 at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:251) [spring-jms-5.2.4.RELEASE.jar:5.2.4.RELEASE]
 at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1189) [spring-jms-5.2.4.RELEASE.jar:5.2.4.RELEASE]
 at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1179) [spring-jms-5.2.4.RELEASE.jar:5.2.4.RELEASE]
 at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:1076) [spring-jms-5.2.4.RELEASE.jar:5.2.4.RELEASE]
 at java.lang.Thread.run(Thread.java:834) [?:?]
Caused by: javax.jms.JMSException: java.lang.NullPointerException
 at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:54) ~[activemq-client-5.15.12.jar:5.15.12]
 at org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1403) ~[activemq-client-5.15.12.jar:5.15.12]
 at org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1436) ~[activemq-client-5.15.12.jar:5.15.12]
 at org.apache.activemq.TransactionContext.rollback(TransactionContext.java:538) ~[activemq-client-5.15.12.jar:5.15.12]
 ... 24 more
Caused by: java.lang.NullPointerException
 at org.apache.activemq.store.jdbc.JdbcMemoryTransactionStore.rollback(JdbcMemoryTransactionStore.java:181) ~[activemq-jdbc-store-5.15.12.jar:5.15.12]
 at org.apache.activemq.transaction.XATransaction.rollback(XATransaction.java:146) ~[activemq-broker-5.15.12.jar:5.15.12]
 at org.apache.activemq.broker.TransactionBroker.rollbackTransaction(TransactionBroker.java:257) ~[activemq-broker-5.15.12.jar:5.15.12]
 at org.apache.activemq.broker.BrokerFilter.rollbackTransaction(BrokerFilter.java:149) ~[activemq-broker-5.15.12.jar:5.15.12]
 at org.apache.activemq.broker.BrokerFilter.rollbackTransaction(BrokerFilter.java:149) ~[activemq-broker-5.15.12.jar:5.15.12]
 at org.apache.activemq.broker.TransportConnection.processRollbackTransaction(TransportConnection.java:553) ~[activemq-broker-5.15.12.jar:5.15.12]
 at org.apache.activemq.command.TransactionInfo.visit(TransactionInfo.java:104) ~[activemq-client-5.15.12.jar:5.15.12]
 at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:336) ~[activemq-broker-5.15.12.jar:5.15.12]
 at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:200) ~[activemq-broker-5.15.12.jar:5.15.12]
 at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50) ~[activemq-client-5.15.12.jar:5.15.12]
 at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:125) ~[activemq-client-5.15.12.jar:5.15.12]
 at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:301) ~[activemq-client-5.15.12.jar:5.15.12]
 at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83) ~[activemq-client-5.15.12.jar:5.15.12]
 at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:233) ~[activemq-client-5.15.12.jar:5.15.12]
 at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:215) ~[activemq-client-5.15.12.jar:5.15.12]
 at java.lang.Thread.run(Thread.java:834) ~[?:?]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It is believed that this might be related to, or have same underlying root condition as &lt;a href=&quot;#AMQ-7424&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;AMQ-7424&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13303255">AMQ-7480</key>
            <summary>NPE after XA transaction timeout</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbonofre">Jean-Baptiste Onofr&#233;</assignee>
                                    <reporter username="terjestrand">Terje Strand</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 May 2020 02:55:56 +0000</created>
                <updated>Mon, 2 Dec 2024 19:18:05 +0000</updated>
                            <resolved>Thu, 21 May 2020 07:55:28 +0000</resolved>
                                    <version>5.15.12</version>
                                    <fixVersion>5.16.0</fixVersion>
                    <fixVersion>5.15.13</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17112894" author="jira-bot" created="Thu, 21 May 2020 07:52:44 +0000"  >&lt;p&gt;Commit ecbeb6d2eb8675832acec243a4e50fea735763e0 in activemq&apos;s branch refs/heads/master from jbonofre&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=ecbeb6d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=ecbeb6d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7480&quot; title=&quot;NPE after XA transaction timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7480&quot;&gt;&lt;del&gt;AMQ-7480&lt;/del&gt;&lt;/a&gt; Avoid NPE if original exception is null&lt;/p&gt;</comment>
                            <comment id="17112895" author="jira-bot" created="Thu, 21 May 2020 07:52:45 +0000"  >&lt;p&gt;Commit 173426c55c043858445a39d4210e001629f08859 in activemq&apos;s branch refs/heads/master from Jean-Baptiste Onofr&#233;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=173426c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=173426c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #535 from jbonofre/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7480&quot; title=&quot;NPE after XA transaction timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7480&quot;&gt;&lt;del&gt;AMQ-7480&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7480&quot; title=&quot;NPE after XA transaction timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7480&quot;&gt;&lt;del&gt;AMQ-7480&lt;/del&gt;&lt;/a&gt; Avoid NPE if original exception is null&lt;/p&gt;</comment>
                            <comment id="17112896" author="jira-bot" created="Thu, 21 May 2020 07:52:47 +0000"  >&lt;p&gt;Commit 173426c55c043858445a39d4210e001629f08859 in activemq&apos;s branch refs/heads/master from Jean-Baptiste Onofr&#233;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=173426c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=173426c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #535 from jbonofre/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7480&quot; title=&quot;NPE after XA transaction timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7480&quot;&gt;&lt;del&gt;AMQ-7480&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7480&quot; title=&quot;NPE after XA transaction timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7480&quot;&gt;&lt;del&gt;AMQ-7480&lt;/del&gt;&lt;/a&gt; Avoid NPE if original exception is null&lt;/p&gt;</comment>
                            <comment id="17112898" author="jira-bot" created="Thu, 21 May 2020 07:54:18 +0000"  >&lt;p&gt;Commit 82f3658ce188090f25152b6ad0d4f99450040693 in activemq&apos;s branch refs/heads/activemq-5.15.x from jbonofre&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=82f3658&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=82f3658&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7480&quot; title=&quot;NPE after XA transaction timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7480&quot;&gt;&lt;del&gt;AMQ-7480&lt;/del&gt;&lt;/a&gt; Avoid NPE if original exception is null&lt;/p&gt;

&lt;p&gt;(cherry picked from commit ecbeb6d2eb8675832acec243a4e50fea735763e0)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 25 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0egj4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>