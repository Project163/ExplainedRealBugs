<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:41:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6687] destination memory usage incorrect after flow control (PFC) sendTimeout and rollback</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6687</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When using PFC, to block a producer on a memory limit and using a sendTimeout to error out after some timeout. If there is a send transaction the send completes in error even though the transaction has completed once usage allows.&lt;br/&gt;
Leaving a dangling send that shows up in the memory usage.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13074810">AMQ-6687</key>
            <summary>destination memory usage incorrect after flow control (PFC) sendTimeout and rollback</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 May 2017 11:14:56 +0000</created>
                <updated>Thu, 25 May 2017 15:58:15 +0000</updated>
                            <resolved>Thu, 25 May 2017 15:58:15 +0000</resolved>
                                    <version>5.14.0</version>
                                    <fixVersion>5.15.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16024568" author="gtully" created="Thu, 25 May 2017 11:16:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4467&quot; title=&quot;Memory usage percent can be exceeded much if PFC is disabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4467&quot;&gt;&lt;del&gt;AMQ-4467&lt;/del&gt;&lt;/a&gt; needed a revisit b/c that change prevented pfc from kicking in in this scenario in error.&lt;/p&gt;</comment>
                            <comment id="16024603" author="jira-bot" created="Thu, 25 May 2017 11:44:04 +0000"  >&lt;p&gt;Commit 25f112c5c9a843f162296ad38eb79be47183e0be in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=25f112c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=25f112c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6687&quot; title=&quot;destination memory usage incorrect after flow control (PFC) sendTimeout and rollback&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6687&quot;&gt;&lt;del&gt;AMQ-6687&lt;/del&gt;&lt;/a&gt; ensure transacted sends blocked on pfc do not resume after tx completion. &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4467&quot; title=&quot;Memory usage percent can be exceeded much if PFC is disabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4467&quot;&gt;&lt;del&gt;AMQ-4467&lt;/del&gt;&lt;/a&gt; refine the fix such that PFC kicks in such that the cache will accept messsages that push it over it&apos;s limit while it is still under the limit&lt;/p&gt;</comment>
                            <comment id="16024737" author="gtully" created="Thu, 25 May 2017 13:38:08 +0000"  >&lt;p&gt;With transactions or concurrentStoreAndDispatch - memory is accounted for before it reaches the cache which typically means that the cursor cache stops accepting messages early. If we want the cache and PFC we have to let the cache consume &amp;gt;100% of memory. To achieve this we must set the cursorHighWaterMark&amp;gt;100% something like 120% such that it will still allow a message to be cached while is is &amp;lt;100 that will put it over the 100% (full) limit.&lt;br/&gt;
Ie: we check is full and we are at 99%, we accept another message that pushes us to 101%, without a cursorHighWaterMark &amp;gt; 101 the cursor won&apos;t cache and will stick at 99% and producer flow control (PFC) won&apos;t kick in.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12641980">AMQ-4467</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 25 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fgjb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>