<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:58:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4338] MQTTSSLTest has multiple test cases that fail frequently</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4338</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;MQTTSSLTest has multiple different test cases (including testSendAndReceiveExactlyOnce, testSendAndReceiveLargeMessages, testSendAndReceiveMQTT, testSendAtLeastOnceReceiveAtMostOnce, testSendAtLeastOnceReceiveExactlyOnce, testSendJMSReceiveMQTT, testSendMQTTReceiveJMS) which fail fairly frequently because of a hang on the provider.connect() call in initializeConnection() as shown in the stacktrace below. &lt;/p&gt;

&lt;p&gt;Another problem with this test is it was giving a misleading error when run under Hudson, showing that the test that followed it (MQTTTest) was failing instead.  I think this was because of the way it was using AutoFailTestSupport.  I will attach a patch which removes that and uses timeouts on @Test annotations instead.&lt;/p&gt;

&lt;p&gt;testSendAndReceiveLargeMessages(org.apache.activemq.transport.mqtt.MQTTSSLTest)  Time elapsed: 30.004 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!&lt;br/&gt;
java.lang.Exception: test timed out after 30000 milliseconds&lt;br/&gt;
        at sun.misc.Unsafe.park(Native Method)&lt;br/&gt;
        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)&lt;br/&gt;
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)&lt;br/&gt;
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireSharedInterruptibly(AbstractQueuedSynchronizer.java:994)&lt;br/&gt;
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireSharedInterruptibly(AbstractQueuedSynchronizer.java:1303)&lt;br/&gt;
        at java.util.concurrent.CountDownLatch.await(CountDownLatch.java:236)&lt;br/&gt;
        at org.fusesource.mqtt.client.Promise.await(Promise.java:88)&lt;br/&gt;
        at org.fusesource.mqtt.client.BlockingConnection.connect(BlockingConnection.java:49)&lt;br/&gt;
        at org.apache.activemq.transport.mqtt.FuseMQQTTClientProvider.connect(FuseMQQTTClientProvider.java:39)&lt;br/&gt;
        at org.apache.activemq.transport.mqtt.MQTTSSLTest.initializeConnection(MQTTSSLTest.java:60)&lt;/p&gt;


&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests in error:&lt;br/&gt;
  MQTTSSLTest&amp;gt;AbstractMQTTTest.testSendAndReceiveLargeMessages:247-&amp;gt;initializeConnection:60 &#187;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12633271">AMQ-4338</key>
            <summary>MQTTSSLTest has multiple test cases that fail frequently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kearls">Kevin Anthony Earls</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Feb 2013 20:52:25 +0000</created>
                <updated>Tue, 21 May 2013 16:36:53 +0000</updated>
                            <resolved>Tue, 21 May 2013 16:36:53 +0000</resolved>
                                                                    <component>Test Cases</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13582646" author="tabish121" created="Wed, 20 Feb 2013 23:17:38 +0000"  >&lt;p&gt;Added the patch, guess we need to figure out why these are all failing now. &lt;/p&gt;</comment>
                            <comment id="13583523" author="kearls" created="Thu, 21 Feb 2013 20:27:16 +0000"  >&lt;p&gt;This patch bumps up the timeouts from the previous patch.  I had set them to 30 seconds, but that&apos;s not enough on some slow nodes.&lt;/p&gt;</comment>
                            <comment id="13585924" author="tabish121" created="Mon, 25 Feb 2013 15:22:24 +0000"  >&lt;p&gt;Are you sure those timeouts are sensible, going from 30000 to 300000 seems like there must be something else going on.  &lt;/p&gt;</comment>
                            <comment id="13585942" author="kearls" created="Mon, 25 Feb 2013 15:52:44 +0000"  >&lt;p&gt;Actually, you&apos;re right, those are probably not sensible.  The problem test cases include:&lt;/p&gt;

&lt;p&gt;testSendAndReceiveAtLeastOnce&lt;br/&gt;
testSendAtLeastOnceReceiveAtMostOnce&lt;br/&gt;
testSendAtLeastOnceReceiveExactlyOnce&lt;br/&gt;
testSendJMSReceiveMQTT&lt;/p&gt;

&lt;p&gt;On my mac all test cases run in less that 3 seconds.  On Ubuntu and AIX, the cases named above sometimes run for ~120 seconds, and sometimes can run even longer, or just hang if there&apos;s no timeout.&lt;/p&gt;
</comment>
                            <comment id="13587349" author="tabish121" created="Tue, 26 Feb 2013 18:22:20 +0000"  >&lt;p&gt;I did some profiling and testing today.  So far I couldn&apos;t find any real issues.  It seems that in the case of these tests the QOS setting just makes things ungodly slow due to all the back and forth acking that&apos;s going on.  I guess its possible there&apos;s something amiss in the FuseSource MQTT client library but so far I haven&apos;t found anything.&lt;/p&gt;</comment>
                            <comment id="13606200" author="pmarques" created="Tue, 19 Mar 2013 10:04:33 +0000"  >&lt;p&gt;We have this problem in our servers (activemq 5.8.0)... It actually behaves a little more predictably, if we try to access the service locally everything works great, if the server and client are in different machines every call to connect blocks permanently. I would think that this problem should have a priority higher than &quot;Minor&quot; since it makes mqtt over ssl unusable... &lt;br/&gt;
We use activemq server and clients in windows and tried both mqtt+nio+ssl and mqtt+ssl without success. Using only tcp connections everything works fine.&lt;/p&gt;</comment>
                            <comment id="13606479" author="tabish121" created="Tue, 19 Mar 2013 16:36:34 +0000"  >&lt;p&gt;Pedro, what MQTT client are you using to connect to the Broker with?&lt;/p&gt;</comment>
                            <comment id="13607508" author="pmarques" created="Wed, 20 Mar 2013 11:07:11 +0000"  >&lt;p&gt;I was testing the system with fusesource client... My code is basically this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	MQTT mqtt = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MQTT();
	mqtt.setHost(url);
	mqtt.setUserName(user);
	mqtt.setPassword(password);

	BlockingConnection connection = mqtt.blockingConnection();
	connection.connect();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think the problem I was having was the one described in this issue because the call hangs on &quot;connection.connect()&quot;. The code works perfectly when run on the same machine as the server or when the url is not ssl based.&lt;/p&gt;


</comment>
                            <comment id="13662198" author="tabish121" created="Mon, 20 May 2013 17:44:06 +0000"  >&lt;p&gt;This one looks like its fixed now with the latest MQTT client pulled into the build. &lt;/p&gt;</comment>
                            <comment id="13663099" author="tabish121" created="Tue, 21 May 2013 16:36:53 +0000"  >&lt;p&gt;Tests seems stable now.  &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12570180" name="AMQ-4338.patch" size="23048" author="kearls" created="Wed, 20 Feb 2013 20:54:39 +0000"/>
                            <attachment id="12570350" name="AMQ-4338A.patch" size="22124" author="kearls" created="Thu, 21 Feb 2013 20:27:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313767</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1i59j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314112</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10092"><![CDATA[Unit Test Broken]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>