<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:45:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2677] org.apache.activemq.pool.ConnectionPool should not set &quot;started&quot; flag if start() throws an exception</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2677</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;If org.apache.activemq.pool.ConnectionPool.start throws a JMSException, the &quot;started&quot; flag in ConnectionPool should not be set to true.  If start() throws an exception, the underlying ActiveMQConnection object will not be started.  Since started=true, any subsequent calls to ConnectionPool.start will do nothing, and a non-started connection may be used by the pool.&lt;/p&gt;

&lt;p&gt;I ran into this problem when using Camel to consume messages - see the attached test program for an example.  This test program does the following:&lt;/p&gt;

&lt;p&gt;1. Starts a bean consuming from queue test.queue using Camel.  The URL used by Camel to connect to ActiveMQ is:&lt;/p&gt;

&lt;p&gt;failover:(tcp://127.0.0.1:61616)?timeout=1000&amp;amp;initialReconnectDelay=1000&amp;amp;maxReconnectDelay=1000&amp;amp;useExponentialBackOff=false&lt;/p&gt;

&lt;p&gt;The test program uses the default behavior of Camel&apos;s ActiveMQComponent which creates a PooledConnectionFactory.&lt;/p&gt;

&lt;p&gt;2. Waits 10 seconds, then starts an ActiveMQ broker on port 61616.  During this wait time, Camel&apos;s connection to the broker fails every second and it is continually retrying.&lt;/p&gt;

&lt;p&gt;3. Sends 10 messages to the queue &quot;test.queue&quot;.&lt;/p&gt;

&lt;p&gt;The call to ConnectionPool.start by camel throws an exception after blocking for 1 second since timeout=1000 is set in the URL.  However the &quot;started&quot; flag is set to true, so subsequent calls to ConnectionPool.start by Camel on connection retries do not restart the ActiveMQConnection.&lt;/p&gt;

&lt;p&gt;So, after step 3 in the test the Camel consumer appears to be connected to the broker, but it does not receive any messages and I get the following warning:&lt;/p&gt;

&lt;p&gt;2010-03-27 09:47:02,994 &lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:61616&amp;#93;&lt;/span&gt; WARN  org.apache.activemq.ActiveMQSessionExecutor - Received a message on a connection which is not yet started. Have you forgotten to call Connection.start()?&lt;/p&gt;

&lt;p&gt;I am attaching a patch to org.apache.activemq.pool.ConnectionPool that does not set started=true if start throws an exception.  This fixes my test program - now each connection retry by camel actually attempts to start the ActiveMQConnection.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu Linux 9.10, Sun JDK 1.6.0_15&lt;/p&gt;</environment>
        <key id="12483268">AMQ-2677</key>
            <summary>org.apache.activemq.pool.ConnectionPool should not set &quot;started&quot; flag if start() throws an exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dejanb">Dejan Bosanac</assignee>
                                    <reporter username="ariekenb">Aaron Riekenberg</reporter>
                        <labels>
                    </labels>
                <created>Sat, 27 Mar 2010 15:57:03 +0000</created>
                <updated>Wed, 31 Mar 2010 11:52:36 +0000</updated>
                            <resolved>Wed, 31 Mar 2010 11:52:36 +0000</resolved>
                                    <version>5.3.1</version>
                                    <fixVersion>5.4.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12942280" author="ariekenb" created="Sat, 27 Mar 2010 15:58:20 +0000"  >&lt;p&gt;Test program showing issue.&lt;/p&gt;</comment>
                            <comment id="12942282" author="ariekenb" created="Sat, 27 Mar 2010 15:59:10 +0000"  >&lt;p&gt;Attaching patch.&lt;/p&gt;</comment>
                            <comment id="12942046" author="dejanb" created="Wed, 31 Mar 2010 11:52:36 +0000"  >&lt;p&gt;This should be fixed with svn revision 929488. I also added modified test to system tests. Thanks&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461607" name="connection_pool_start.patch" size="1286" author="ariekenb" created="Sat, 27 Mar 2010 15:59:10 +0000"/>
                            <attachment id="12461606" name="jmstest.zip" size="5029" author="ariekenb" created="Sat, 27 Mar 2010 15:58:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74849</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rqhb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>159934</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>