<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:39:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1593] redeliveryCounter not updated correctly when using XA transactions and Spring</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1593</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When using ActiveMQ 5 in combination with XA, I noticed that redelivery of messages is not correctly performed. I am using XA in combination with Spring&apos;s DefaultMessageListenerContainer (DMLC) and have a simple test case in which the MessageListener throws an IllegalStateException which triggers a transaction rollback. After that, the message is redelivered, but unfortunately not as many times as my redelivery policy specifies. I am using the following settings:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;maximumRedeliveries=3&lt;/li&gt;
	&lt;li&gt;initialRedeliveryDelay=10&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If I am not mistaken this means I should receive the message 4 times (once initially and then three times redelivered), but I only get it three times. When I log the messages I receive prior to throwing an ISE, I see the following &quot;inconsistency&quot; with the redeliveryCounter: the initial message has a counter value of 0, the first redelivery message has a counter value of 2 and the second redelivery message has a counter value of 4. After that, I do not receive an additional message.&lt;/p&gt;

&lt;p&gt;I created a simple test case attached to this issue (a Maven 2 project) which is configured with the above settings and shows the described behavior. In order to run the test case, however, you need the Bitronix Transaction Manager (v 1.2) in your local repository (since it is currently not listed in one of the public repositories, you have to download it and put it manually into the local repo). The download url is &lt;a href=&quot;http://dist.codehaus.org/btm/1.2/btm-dist-1.2.zip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://dist.codehaus.org/btm/1.2/btm-dist-1.2.zip&lt;/a&gt; and installation is done by unzipping the archive and using&lt;/p&gt;

&lt;p&gt;mvn -Dfile=btm-1.2.jar -DgroupId=btm -DartifactId=btm -Dversion=1.2 -DgeneratePom=true -Dpackaging=jar install:install-file &lt;/p&gt;

&lt;p&gt;to copy it to the repo.&lt;/p&gt;

&lt;p&gt;Spring&apos;s DMLC is set to a cacheLevel of 0 (CACHE_NONE) if an external transaction manager is used. If I change the cacheLevel to 2 (CACHE_SESSION) then the correct number of messages is delivered and the counter is correctly updated, so I am not sure whether this is an issue with ActiveMQ or Spring. Anyways, I think I should not loose any messages if I use XA, regardless of the cacheLevel setting...&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac OS X 10.4, Java 1.6 DP1&lt;/p&gt;</environment>
        <key id="12482790">AMQ-1593</key>
            <summary>redeliveryCounter not updated correctly when using XA transactions and Spring</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="svenpanko">Sven Panko</reporter>
                        <labels>
                    </labels>
                <created>Fri, 22 Feb 2008 09:49:39 +0000</created>
                <updated>Fri, 30 Jan 2009 15:34:29 +0000</updated>
                            <resolved>Fri, 30 Jan 2009 15:34:29 +0000</resolved>
                                    <version>5.0.0</version>
                                    <fixVersion>5.3.0</fixVersion>
                                        <due></due>
                            <votes>3</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12940729" author="gtully" created="Fri, 30 Jan 2009 13:36:10 +0000"  >&lt;p&gt;Hi Sven, Would it be possible to grant an ASF license to your test case? There is a check box in the file upload dialog.  I would like to include a variant in the code base. With the current trunk, (5.3-SNAPSHOT) I see redelivery go 0,1,3 which is still odd. Want to delve a little deeper.&lt;/p&gt;</comment>
                            <comment id="12940718" author="gtully" created="Fri, 30 Jan 2009 14:34:23 +0000"  >&lt;p&gt;scrap the license request, I have been able to reproduce with a simple test case. thanks.&lt;/p&gt;</comment>
                            <comment id="12940707" author="gtully" created="Fri, 30 Jan 2009 15:33:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/activemq/browse/AMQ-2087&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/activemq/browse/AMQ-2087&lt;/a&gt; provides part of the fix.&lt;/p&gt;</comment>
                            <comment id="12940706" author="gtully" created="Fri, 30 Jan 2009 15:34:29 +0000"  >&lt;p&gt;fixed in r739307&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12482763">AMQ-2087</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12460963" name="ASF.LICENSE.NOT.GRANTED--activemq-redeliverytest.zip" size="13002" author="svenpanko" created="Fri, 22 Feb 2008 09:49:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84639</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 43 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rrqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>160138</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>