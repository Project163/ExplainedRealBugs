<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:07:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5456] AMQP messages accepted transactionally by a consumer should retain the TransactionalState until commit/rollback</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5456</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When the broker receives a disposition frame accepting a message using TransactionalState to make it part of a transaction, it sets the local message state to Accepted and settles the delivery. If the incoming disposition was not settled, this process causes a settled disposition frame to be sent to the client which contains a non-transactional Accepted outcome. The message has not yet actually reached this state (only doing so if the transaction is committed successfully) and so should still have a TransactionalState linking it to the transaction.&lt;/p&gt;

&lt;p&gt;This issue can be seen in the protocol trace below:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;TCP time=&quot;10:05:17.783758&quot; seqno=&quot;732965115&quot; size=&quot;38&quot;&amp;gt;
  &amp;lt;source host=&quot;127.0.0.1&quot; port=&quot;57536&quot;/&amp;gt;
  &amp;lt;target host=&quot;127.0.0.1&quot; port=&quot;5672&quot;/&amp;gt;
  
  &amp;lt;frame size=&quot;38&quot; doff=&quot;2&quot; chan=&quot;1&quot;&amp;gt; 
    
    &amp;lt;small-descriptor code=&quot;0x0:0x15&quot;/&amp;gt; # disposition
    &amp;lt;list8 size=&quot;25&quot; count=&quot;5&quot;&amp;gt; # disposition
      &amp;lt;true/&amp;gt; # role
      &amp;lt;uint0/&amp;gt; # first
      &amp;lt;uint0/&amp;gt; # last
      &amp;lt;false/&amp;gt; # settled
      &amp;lt;small-descriptor code=&quot;0x0:0x34&quot;/&amp;gt; # state    &amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt; transactional state
      &amp;lt;list8 size=&quot;15&quot; count=&quot;2&quot;&amp;gt; # state
        &amp;lt;bin8 size=&quot;8&quot;&amp;gt; # txn-id
          00 00 00 00 00 00 00 01 
        &amp;lt;/bin8&amp;gt;
        &amp;lt;small-descriptor code=&quot;0x0:0x24&quot;/&amp;gt; # outcome
        &amp;lt;list0/&amp;gt; # accepted
      &amp;lt;/list8&amp;gt;
      # &amp;lt;null/&amp;gt; batchable [false]
    &amp;lt;/list8&amp;gt;
    
  &amp;lt;/frame&amp;gt;
  
&amp;lt;/TCP&amp;gt;

&amp;lt;TCP time=&quot;10:05:17.785657&quot; seqno=&quot;1813532080&quot; size=&quot;22&quot;&amp;gt;
  &amp;lt;source host=&quot;127.0.0.1&quot; port=&quot;5672&quot;/&amp;gt;
  &amp;lt;target host=&quot;127.0.0.1&quot; port=&quot;57536&quot;/&amp;gt;
  
  &amp;lt;frame size=&quot;22&quot; doff=&quot;2&quot; chan=&quot;1&quot;&amp;gt; 
    
    &amp;lt;small-descriptor code=&quot;0x0:0x15&quot;/&amp;gt; # disposition
    &amp;lt;list8 size=&quot;9&quot; count=&quot;5&quot;&amp;gt; # disposition
      &amp;lt;false/&amp;gt; # role
      &amp;lt;uint0/&amp;gt; # first
      &amp;lt;uint0/&amp;gt; # last
      &amp;lt;true/&amp;gt; # settled
      &amp;lt;small-descriptor code=&quot;0x0:0x24&quot;/&amp;gt; # state    &amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt; non-transactional state
      &amp;lt;list0/&amp;gt; # accepted
      # &amp;lt;null/&amp;gt; batchable [false]
    &amp;lt;/list8&amp;gt;
    
  &amp;lt;/frame&amp;gt;
  
&amp;lt;/TCP&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12757678">AMQ-5456</key>
            <summary>AMQP messages accepted transactionally by a consumer should retain the TransactionalState until commit/rollback</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="robbie">Robbie Gemmell</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Nov 2014 12:22:52 +0000</created>
                <updated>Tue, 25 Nov 2014 14:17:32 +0000</updated>
                            <resolved>Tue, 25 Nov 2014 14:17:32 +0000</resolved>
                                    <version>5.10.0</version>
                                    <fixVersion>5.11.0</fixVersion>
                                    <component>AMQP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14224470" author="gemmellr" created="Tue, 25 Nov 2014 12:34:04 +0000"  >&lt;p&gt;Attaching patch which updates the broker to use a local TransactionalState acceptance before settling messages being consumed in a transaction. This causes the disposition reply state to match the clients earlier update.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;lt;TCP time=&quot;10:54:07.144849&quot; seqno=&quot;477148551&quot; size=&quot;38&quot;&amp;gt;
  &amp;lt;source host=&quot;127.0.0.1&quot; port=&quot;34451&quot;/&amp;gt;
  &amp;lt;target host=&quot;127.0.0.1&quot; port=&quot;5672&quot;/&amp;gt;
  
  &amp;lt;frame size=&quot;38&quot; doff=&quot;2&quot; chan=&quot;1&quot;&amp;gt; 
    
    &amp;lt;small-descriptor code=&quot;0x0:0x15&quot;/&amp;gt; # disposition
    &amp;lt;list8 size=&quot;25&quot; count=&quot;5&quot;&amp;gt; # disposition
      &amp;lt;true/&amp;gt; # role
      &amp;lt;uint0/&amp;gt; # first
      &amp;lt;uint0/&amp;gt; # last
      &amp;lt;false/&amp;gt; # settled
      &amp;lt;small-descriptor code=&quot;0x0:0x34&quot;/&amp;gt; # state    &amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt; transactional state
      &amp;lt;list8 size=&quot;15&quot; count=&quot;2&quot;&amp;gt; # state
        &amp;lt;bin8 size=&quot;8&quot;&amp;gt; # txn-id
          00 00 00 00 00 00 00 01 
        &amp;lt;/bin8&amp;gt;
        &amp;lt;small-descriptor code=&quot;0x0:0x24&quot;/&amp;gt; # outcome
        &amp;lt;list0/&amp;gt; # accepted
      &amp;lt;/list8&amp;gt;
      # &amp;lt;null/&amp;gt; batchable [false]
    &amp;lt;/list8&amp;gt;
    
  &amp;lt;/frame&amp;gt;
  
&amp;lt;/TCP&amp;gt;

&amp;lt;TCP time=&quot;10:54:07.147447&quot; seqno=&quot;2677401021&quot; size=&quot;38&quot;&amp;gt;
  &amp;lt;source host=&quot;127.0.0.1&quot; port=&quot;5672&quot;/&amp;gt;
  &amp;lt;target host=&quot;127.0.0.1&quot; port=&quot;34451&quot;/&amp;gt;
  
  &amp;lt;frame size=&quot;38&quot; doff=&quot;2&quot; chan=&quot;1&quot;&amp;gt; 
    
    &amp;lt;small-descriptor code=&quot;0x0:0x15&quot;/&amp;gt; # disposition
    &amp;lt;list8 size=&quot;25&quot; count=&quot;5&quot;&amp;gt; # disposition
      &amp;lt;false/&amp;gt; # role
      &amp;lt;uint0/&amp;gt; # first
      &amp;lt;uint0/&amp;gt; # last
      &amp;lt;true/&amp;gt; # settled
      &amp;lt;small-descriptor code=&quot;0x0:0x34&quot;/&amp;gt; # state    &amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt;&amp;lt; transactional state
      &amp;lt;list8 size=&quot;15&quot; count=&quot;2&quot;&amp;gt; # state
        &amp;lt;bin8 size=&quot;8&quot;&amp;gt; # txn-id
          00 00 00 00 00 00 00 01 
        &amp;lt;/bin8&amp;gt;
        &amp;lt;small-descriptor code=&quot;0x0:0x24&quot;/&amp;gt; # outcome
        &amp;lt;list0/&amp;gt; # accepted
      &amp;lt;/list8&amp;gt;
      # &amp;lt;null/&amp;gt; batchable [false]
    &amp;lt;/list8&amp;gt;
    
  &amp;lt;/frame&amp;gt;
  
&amp;lt;/TCP&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14224581" author="tabish121" created="Tue, 25 Nov 2014 14:17:32 +0000"  >&lt;p&gt;Patch applied, thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12683531" name="0001-AMQ-5456-use-a-TransactionalState-acceptance-when-se.patch" size="2587" author="robbie" created="Tue, 25 Nov 2014 12:34:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22ren:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>