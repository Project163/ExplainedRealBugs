<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:19:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2174] Modifying an existing Durable subscription blocks that subscription from receiving messages</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2174</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When modifying an existing durable subscription, for example to change selectors, that subscription no longer gets any messages and error messages are produced.&lt;/p&gt;

&lt;p&gt;Juni test case attached and broker output with log level set to TRACE, which is based on the ProducerTool and ConsumerTool examples.&lt;/p&gt;

&lt;p&gt;Sequence to produce the problem is &lt;/p&gt;

&lt;p&gt;1. Clean data directory&lt;br/&gt;
2. Run test case testConsumeWithNoSelectors - this creates the topic and blocks waiting for messages&lt;br/&gt;
3. Run test case testProduceWithProperties - this creates 6 messages each with a single String property.  First 2 have &quot;selectorProp = 0&quot;, second 2 have value 1 and third pair have value 0 again.  Consumer test case in (2) will consume messages and exit.&lt;br/&gt;
4. Run test case testConsumeWithSelectors - this changes the durable subscription and adds the selectorProp = &apos;0&apos; to the subscription.&lt;br/&gt;
5. Run same test case as (3).  The consumer will then receive the first 2 messages produced by this producer and then block as it changes the subscription to have selectorProp = &apos;1&apos;.&lt;/p&gt;

&lt;p&gt;At this point this would appear to be a problem.  According to the JMS TopicSubscriber Javadocs&lt;/p&gt;

&lt;p&gt;&quot;A client can change an existing durable subscription by creating a durable TopicSubscriber with the same name and a new topic and/or message selector. Changing a durable subscription is equivalent to unsubscribing (deleting) the old one and creating a new one. &quot;&lt;/p&gt;

&lt;p&gt;so, if step (4) above has now changed the durable subscription to add a selector it still receives the first two messages from step 5, so from that, it appears that the broker is able to recognise this as a modification (although it is delete+create).  So, when it then tried to make the modification to change the selector to &quot;selectorProp = 1&quot; and receive the next two it does not get any messages.  So, I would expect that as it has now blocked waiting for messages with those properties, if I do&lt;/p&gt;

&lt;p&gt;6. Run same test case as (3)&lt;/p&gt;

&lt;p&gt;I would expect the middle two messages to be received by the blocked consumer, but no more messages are consumed and I get the following messages to the broker log&lt;/p&gt;

&lt;p&gt;ERROR RecoveryListenerAdapter        - Message id ID:aconcagua-4821-1237761609609-0:0:1:1:3 could not be recovered from the data store - already dispatched&lt;/p&gt;

&lt;p&gt;This particular subscription for clientId and topic now seems to be blocked forever and messages posted to this topic can never be received by this subscriber.&lt;/p&gt;




</description>
                <environment>&lt;p&gt;Windows XPSP3&lt;/p&gt;</environment>
        <key id="12483649">AMQ-2174</key>
            <summary>Modifying an existing Durable subscription blocks that subscription from receiving messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="adb">Antony Bowesman</reporter>
                        <labels>
                    </labels>
                <created>Sun, 22 Mar 2009 23:11:38 +0000</created>
                <updated>Thu, 20 Aug 2015 18:53:52 +0000</updated>
                            <resolved>Thu, 20 Aug 2015 18:53:52 +0000</resolved>
                                    <version>5.2.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="12941031" author="adb" created="Sun, 22 Mar 2009 23:14:24 +0000"  >&lt;p&gt;Test cases and log output from the test cases when running the test sequence as described&lt;/p&gt;</comment>
                            <comment id="12941047" author="adb" created="Sun, 22 Mar 2009 23:37:46 +0000"  >&lt;p&gt;The broker is the default broker from a standard 5.2.0 installation run from bin/activemq.bat&lt;/p&gt;</comment>
                            <comment id="12939281" author="gtully" created="Mon, 9 Aug 2010 10:40:11 +0000"  >&lt;p&gt;ran the test on trunk, there is still an issue.. attaching the test case in the more integrated form with an embedded broker...&lt;/p&gt;</comment>
                            <comment id="14705542" author="jira-bot" created="Thu, 20 Aug 2015 18:52:23 +0000"  >&lt;p&gt;Commit 3f5cfcf6de7910e52871604c8886f2b0da3084b4 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=3f5cfcf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=3f5cfcf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2174&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-2174&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Add a test case.&lt;/p&gt;</comment>
                            <comment id="14705547" author="tabish121" created="Thu, 20 Aug 2015 18:53:52 +0000"  >&lt;p&gt;Test case added does not reproduce, changes to durable subs appears to working as expected.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461792" name="AMQ2174Test.java" size="12290" author="gtully" created="Mon, 9 Aug 2010 10:40:11 +0000"/>
                            <attachment id="12461419" name="SelectorBugTest.java" size="12007" author="adb" created="Sun, 22 Mar 2009 23:14:24 +0000"/>
                            <attachment id="12461420" name="selector.log" size="189204" author="adb" created="Sun, 22 Mar 2009 23:14:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75041</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 13 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0al6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59706</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>