<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:44:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6979] consumer message pull timeout being effected by long running scheduled tasks</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6979</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;The messagePull timeout, used for prefetch=0 consumers with consumer.receive(timeout) is not reliable in the event that the broker scheduler timer task is busy with long running tasks.&lt;/p&gt;

&lt;p&gt;If an existing task exceeds the timeout then the pull response is delayed.&lt;/p&gt;

&lt;p&gt;In the main, scheduled tasks should be short lived and in the case of message expiry processing for topic durable subs, they may not be, depending on the amount of durable subs and their backlog.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;The expiryProcessing scheduler task should simply signal the start of the task such that it can return and leave the real work to the taskExecutor&lt;/p&gt;</description>
                <environment></environment>
        <key id="13162856">AMQ-6979</key>
            <summary>consumer message pull timeout being effected by long running scheduled tasks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 May 2018 09:51:43 +0000</created>
                <updated>Fri, 1 Jun 2018 12:00:27 +0000</updated>
                            <resolved>Fri, 1 Jun 2018 12:00:27 +0000</resolved>
                                    <version>5.15.0</version>
                                    <fixVersion>5.16.0</fixVersion>
                                    <component>JMS client</component>
                    <component>Message Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16494954" author="gtully" created="Wed, 30 May 2018 09:56:10 +0000"  >&lt;p&gt;I had a quick peek at giving the existing&#160;TimerThread based scheduler a pool via&#160;ScheduledThreadPoolExecutor but b/c that pool is fixed, it still can have the same problem and changing that implementation detail may have more unintentional side effects.&lt;/p&gt;

&lt;p&gt;The solution is to keep the scheduler task short lived, in the case of expiry processing - treat it as a signal generator.&lt;/p&gt;</comment>
                            <comment id="16495124" author="gtully" created="Wed, 30 May 2018 13:07:17 +0000"  >&lt;p&gt;Linking in&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5129&quot; title=&quot;Substitute TimeTask with ScheduledExecutorService in org.apache.activemq.thread.Scheduler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5129&quot;&gt;AMQ-5129&lt;/a&gt; which has&#160;a patch for replacing the timerThread with the schedule executor. It will still have a sizing issue b/c the core pool size is fixed.&lt;/p&gt;

&lt;p&gt;Ensuring that any long running tasks are triggered by the scheduler rather than executed by it is the better solution.&#160;&lt;/p&gt;</comment>
                            <comment id="16495671" author="jira-bot" created="Wed, 30 May 2018 21:04:08 +0000"  >&lt;p&gt;Commit cdb38b32756d70bf7ae149e994abcccc9adca5ae in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=cdb38b3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=cdb38b3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6979&quot; title=&quot;consumer message pull timeout being effected by long running scheduled tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6979&quot;&gt;&lt;del&gt;AMQ-6979&lt;/del&gt;&lt;/a&gt; - use scheduler as trigger task - do heavy lifting via the task runner executor, take care to trap errors to keep scheduler timer alive &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5129&quot; title=&quot;Substitute TimeTask with ScheduledExecutorService in org.apache.activemq.thread.Scheduler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5129&quot;&gt;AMQ-5129&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16496440" author="jira-bot" created="Thu, 31 May 2018 12:12:57 +0000"  >&lt;p&gt;Commit 4521f47e3691320251e85e886074e3c2a97ae10a in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4521f47&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4521f47&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6979&quot; title=&quot;consumer message pull timeout being effected by long running scheduled tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6979&quot;&gt;&lt;del&gt;AMQ-6979&lt;/del&gt;&lt;/a&gt; - fix test regression dependent on serial excution of expiry processing across destinations&lt;/p&gt;</comment>
                            <comment id="16496482" author="jira-bot" created="Thu, 31 May 2018 12:44:12 +0000"  >&lt;p&gt;Commit 6d14e4e85bcf4ba37eb3c60d68773788e2cb19e1 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=6d14e4e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=6d14e4e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6979&quot; title=&quot;consumer message pull timeout being effected by long running scheduled tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6979&quot;&gt;&lt;del&gt;AMQ-6979&lt;/del&gt;&lt;/a&gt; - fix test regression, avoid gc during shutdown such that the error check on the logging remains valid&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12705623">AMQ-5129</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 24 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3ub13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>