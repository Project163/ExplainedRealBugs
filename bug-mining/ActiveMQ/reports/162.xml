<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:33:00 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1078] Messages consumed with the Resource Adapter are intermittently not delivered</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1078</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;The cause is that the ActiveMQSessionExecutor was starting and using it&apos;s dispatch thread instead of the Thread managed by the resource adapter.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12481949">AMQ-1078</key>
            <summary>Messages consumed with the Resource Adapter are intermittently not delivered</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chirino">Hiram R. Chirino</assignee>
                                    <reporter username="chirino">Hiram R. Chirino</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Nov 2006 21:25:33 +0000</created>
                <updated>Fri, 9 Mar 2007 17:29:33 +0000</updated>
                            <resolved>Fri, 9 Mar 2007 17:25:07 +0000</resolved>
                                    <version>4.0</version>
                                    <fixVersion>4.1.1</fixVersion>
                    <fixVersion>5.0.0</fixVersion>
                                    <component>Broker</component>
                    <component>Connector</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12938564" author="chirino" created="Wed, 29 Nov 2006 21:27:19 +0000"  >&lt;p&gt;Fixed in trunk revision 480717&lt;/p&gt;</comment>
                            <comment id="12938553" author="chirino" created="Thu, 30 Nov 2006 07:28:44 +0000"  >&lt;p&gt;fix in 4.1 branch rev 480862&lt;/p&gt;</comment>
                            <comment id="12936615" author="cgs" created="Wed, 10 Jan 2007 18:18:25 +0000"  >&lt;p&gt;Is this &quot;fixed, but not closed&quot; or &quot;not really fixed&quot;?&lt;/p&gt;</comment>
                            <comment id="12936602" author="cgs" created="Thu, 18 Jan 2007 18:36:58 +0000"  >&lt;p&gt;Well, I pulled out the patch and applied it to 4.1.0 and it fixed the problem.&lt;/p&gt;</comment>
                            <comment id="12938941" author="jstalker" created="Fri, 9 Mar 2007 17:12:24 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
  It appears that there is still a bug some place in the rar.&lt;br/&gt;
  Here&apos;s the scenario:&lt;br/&gt;
I recently (ie, a couple days ago) downloaded and built the 4.1 branch, set up JBoss 4.0.5.GA with a slightly modified activemq-ra.rar (ra.xml modified to communicate with an external instance of the broker via tcp and setting of UseInboundSession is set to true...not sure what this does really, but I tried it as false and the same behavior happens).&lt;/p&gt;

&lt;p&gt;Via a persistent queue (oracle backing) I&apos;m consuming messages in an MDB via the JCA message datasource using XA.&lt;/p&gt;

&lt;p&gt;Here&apos;s the problem I&apos;m seeing: if I shut down the JMS server, I see the appropriate EOF exception and subsequent reconnection attempts by the rar in JBoss.  When I startup the external activemq broker again, the connection appears to get reestablished and work is accepted, started, and completed...EXCEPT there&apos;s no mention of XA and thus the message is never actually accepted and consumed.&lt;/p&gt;

&lt;p&gt;Here&apos;s some debug output from the JCA:&lt;/p&gt;

&lt;p&gt;PRE shutdown of external broker:&lt;br/&gt;
2007-03-09 11:43:02,883 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionPoolImpl&amp;#93;&lt;/span&gt; ServerSession requested.&lt;br/&gt;
2007-03-09 11:43:02,883 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionPoolImpl&amp;#93;&lt;/span&gt; Using idle session: ServerSessionImpl:1&lt;br/&gt;
2007-03-09 11:43:02,883 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; Starting run.&lt;br/&gt;
2007-03-09 11:43:02,883 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; Work accepted: javax.resource.spi.work.WorkEvent&lt;span class=&quot;error&quot;&gt;&amp;#91;source=org.jboss.resource.work.JBossWorkManager@1461b5b&amp;#93;&lt;/span&gt;&lt;br/&gt;
2007-03-09 11:43:02,883 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; Work started: javax.resource.spi.work.WorkEvent&lt;span class=&quot;error&quot;&gt;&amp;#91;source=org.jboss.resource.work.JBossWorkManager@1461b5b&amp;#93;&lt;/span&gt;&lt;br/&gt;
2007-03-09 11:43:02,883 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; Running&lt;br/&gt;
2007-03-09 11:43:02,883 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; run loop start   &lt;br/&gt;
2007-03-09 11:43:02,884 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.TransactionContext&amp;#93;&lt;/span&gt; Start: XidImpl&lt;span class=&quot;error&quot;&gt;&amp;#91;FormatId=257, GlobalId=node118/114, BranchQual=1, localId=114&amp;#93;&lt;/span&gt;&lt;br/&gt;
2007-03-09 11:43:02,884 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.TransactionContext&amp;#93;&lt;/span&gt; Started XA transaction: XID:257:6e6f64653131382f313134:31 &lt;/p&gt;

&lt;p&gt;&amp;#8211; snip &amp;#8211; output of a resulting consumption of message&lt;/p&gt;

&lt;p&gt;2007-03-09 11:43:04,447 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.TransactionContext&amp;#93;&lt;/span&gt; End: XidImpl&lt;span class=&quot;error&quot;&gt;&amp;#91;FormatId=257, GlobalId=node118/114, BranchQual=1, localId=114&amp;#93;&lt;/span&gt;&lt;br/&gt;
2007-03-09 11:43:04,447 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.TransactionContext&amp;#93;&lt;/span&gt; Ended XA transaction: XID:257:6e6f64653131382f313134:31&lt;br/&gt;
2007-03-09 11:43:04,448 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.TransactionContext&amp;#93;&lt;/span&gt; Prepare: XidImpl&lt;span class=&quot;error&quot;&gt;&amp;#91;FormatId=257, GlobalId=node118/114, BranchQual=1, localId=114&amp;#93;&lt;/span&gt;&lt;br/&gt;
2007-03-09 11:43:04,454 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.TransactionContext&amp;#93;&lt;/span&gt; Commit: XidImpl&lt;span class=&quot;error&quot;&gt;&amp;#91;FormatId=257, GlobalId=node118/114, BranchQual=1, localId=114&amp;#93;&lt;/span&gt;&lt;br/&gt;
2007-03-09 11:43:05,150 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; run loop end&lt;br/&gt;
2007-03-09 11:43:05,178 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionPoolImpl&amp;#93;&lt;/span&gt; Session returned to pool: ServerSessionImpl:1&lt;br/&gt;
2007-03-09 11:43:05,178 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; Run finished&lt;br/&gt;
2007-03-09 11:43:05,178 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; Work completed: javax.resource.spi.work.WorkEvent&lt;span class=&quot;error&quot;&gt;&amp;#91;source=org.jboss.resource.work.JBossWorkManager@1461b5b&amp;#93;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;POST shutdown and restart of external broker&lt;/p&gt;

&lt;p&gt;2007-03-09 11:46:33,077 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.transport.WireFormatNegotiator&amp;#93;&lt;/span&gt; Sending: WireFormatInfo { version=2, properties=&lt;/p&gt;
{TightEncodingEnabled=true, CacheSize=1024, TcpNoDelayEnabled=true, SizePrefixDisabled=false, StackTraceEnabled=true, MaxInactivityDuration=30000, CacheEnabled=true}, magic=&lt;span class=&quot;error&quot;&gt;&amp;#91;A,c,t,i,v,e,M,Q&amp;#93;&lt;/span&gt;}&lt;br/&gt;
2007-03-09 11:46:33,126 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.transport.WireFormatNegotiator&amp;#93;&lt;/span&gt; Received WireFormat: WireFormatInfo { version=2, properties={TightEncodingEnabled=true, CacheSize=1024, TcpNoDelayEnabled=true, SizePrefixDisabled=false, StackTraceEnabled=true, MaxInactivityDuration=30000, CacheEnabled=true}
&lt;p&gt;, magic=&lt;span class=&quot;error&quot;&gt;&amp;#91;A,c,t,i,v,e,M,Q&amp;#93;&lt;/span&gt;}&lt;br/&gt;
2007-03-09 11:46:33,126 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.transport.WireFormatNegotiator&amp;#93;&lt;/span&gt; tcp://seqlims.broad.mit.edu/18.103.10.168:61616 before negotiation: OpenWireFormat&lt;/p&gt;
{version=2, cacheEnabled=false, stackTraceEnabled=false, tightEncodingEnabled=false, sizePrefixDisabled=false}
&lt;p&gt;2007-03-09 11:46:33,126 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.transport.WireFormatNegotiator&amp;#93;&lt;/span&gt; tcp://seqlims.broad.mit.edu/18.103.10.168:61616 after negotiation: OpenWireFormat&lt;/p&gt;
{version=2, cacheEnabled=true, stackTraceEnabled=true, tightEncodingEnabled=true, sizePrefixDisabled=false}
&lt;p&gt;2007-03-09 11:53:15,196 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionPoolImpl&amp;#93;&lt;/span&gt; ServerSession requested.&lt;br/&gt;
2007-03-09 11:53:15,196 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionPoolImpl&amp;#93;&lt;/span&gt; Using idle session: ServerSessionImpl:1&lt;br/&gt;
2007-03-09 11:53:15,196 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; Starting run.&lt;br/&gt;
2007-03-09 11:53:15,196 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; Work accepted: javax.resource.spi.work.WorkEvent&lt;span class=&quot;error&quot;&gt;&amp;#91;source=org.jboss.resource.work.JBossWorkManager@1461b5b&amp;#93;&lt;/span&gt;&lt;br/&gt;
2007-03-09 11:53:15,196 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; Work started: javax.resource.spi.work.WorkEvent&lt;span class=&quot;error&quot;&gt;&amp;#91;source=org.jboss.resource.work.JBossWorkManager@1461b5b&amp;#93;&lt;/span&gt;&lt;br/&gt;
2007-03-09 11:53:15,197 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; Running&lt;/p&gt;

&lt;p&gt;&amp;#8211; as you can see, no XA here&lt;/p&gt;

&lt;p&gt;2007-03-09 11:53:15,197 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; run loop start&lt;br/&gt;
2007-03-09 11:53:15,197 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; run loop end&lt;br/&gt;
2007-03-09 11:53:15,197 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionPoolImpl&amp;#93;&lt;/span&gt; Session returned to pool: ServerSessionImpl:1&lt;br/&gt;
2007-03-09 11:53:15,197 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; Run finished&lt;br/&gt;
2007-03-09 11:53:15,197 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.ra.ServerSessionImpl:1&amp;#93;&lt;/span&gt; Work completed: javax.resource.spi.work.WorkEvent&lt;span class=&quot;error&quot;&gt;&amp;#91;source=org.jboss.resource.work.JBossWorkManager@1461b5b&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;Thanks for your help!&lt;br/&gt;
John&lt;/p&gt;</comment>
                            <comment id="12938822" author="cgs" created="Fri, 9 Mar 2007 17:18:49 +0000"  >&lt;p&gt;Does it look like the attached patch is applied to the source that you downloaded and built?&lt;/p&gt;</comment>
                            <comment id="12938873" author="chirino" created="Fri, 9 Mar 2007 17:25:07 +0000"  >&lt;p&gt;The patch has been applied to 4.1 and is the current RC 1 for ActiveMQ 4.1.1&lt;/p&gt;

&lt;p&gt;But the XA problem that john is reporting seems to be something different entirely from the original problem addressed.  I going to close this issue out since it did fix a problem.  John you could you open a new issue specifically for the XA problem you are seeing.  Thanks!&lt;/p&gt;</comment>
                            <comment id="12938876" author="cgs" created="Fri, 9 Mar 2007 17:26:47 +0000"  >&lt;p&gt;Also, how is this &quot;intermittently not delivered&quot;?  If it&apos;s being delivered, but for some reason without XA, it&apos;s still being delivered.  Sounds like a different issue.&lt;/p&gt;</comment>
                            <comment id="12938866" author="jstalker" created="Fri, 9 Mar 2007 17:27:51 +0000"  >&lt;p&gt;Yeah, looking at the source for the session executor, I see this in the wakeup() method:&lt;br/&gt;
if( session.isSessionAsyncDispatch() ) { &lt;br/&gt;
which replaced taskRunner != null as the 2nd test in the method...the taskRunner == null shows up in the try block &amp;#8211; the same as the patch.&lt;/p&gt;</comment>
                            <comment id="12938881" author="jstalker" created="Fri, 9 Mar 2007 17:29:33 +0000"  >&lt;p&gt;you&apos;re both right, it appears to be a combination of JCA reconnect / XA restart (or whatever you want to call it).  I Reopened this bug pre-maturely...sorry about that!&lt;/p&gt;

&lt;p&gt;I&apos;ll file a new bug.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12460661" name="AMQ-1078.patch" size="1394" author="cgs" created="Thu, 25 Jan 2007 16:45:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84309</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s2tz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161935</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>