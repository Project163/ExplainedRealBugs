<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:34:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-775] MessageAuthorizationPolicy doesn&apos;t work</title>
                <link>https://issues.apache.org/jira/browse/AMQ-775</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Use default config, set a MessageAuthorizationPolicy to BrokerService and start the broker.&lt;br/&gt;
There are several issues:&lt;br/&gt;
1) In BrokerService::startTransportConnector() method, connector.setMessageAuthorizationPolicy(policy); is in the wrong place, it should be moved to almost the very end of the method, otherwise if you use JMX, the ManageedTransportConnector won&apos;t have authorization policy info.&lt;br/&gt;
2) ManagedTransportConnector doesn&apos;t pass the auth policy to ManagedTransport, I think the easiest way to fix it is in AbstractConnection constructor,&lt;br/&gt;
adding this line:&lt;br/&gt;
    this.messageAuthorizationPolicy = connector.getMessageAuthorizationPolicy();&lt;br/&gt;
and remove this line:&lt;br/&gt;
   answer.setMessageAuthorizationPolicy(messageAuthorizationPolicy); &lt;br/&gt;
from TransportConnector::createConnection(), then it will work for both TransportConnection and ManagedTransportConnection&lt;br/&gt;
3) AbstrctConnection doesn&apos;t pass the auth policy to ConnectionContext, I think this can be fixed by adding this line:&lt;br/&gt;
  context.setMessageAuthorizationPolicy(this.getMessageAuthorizationPolicy());&lt;br/&gt;
to AbstractConnection::processAddConnection() method.&lt;/p&gt;

&lt;p&gt;Now the auth policy can be reached by MessageAuthorizationPolicy::isAllowedToConsume(ConnectionContext context, Message message) method, but the real problem is message value is null, but we need to use it to check right, some of the right information is a property inside the message. &lt;/p&gt;

&lt;p&gt;Please take a look at the problem, thanks&lt;/p&gt;</description>
                <environment>&lt;p&gt;windows NT 2003 server&lt;/p&gt;</environment>
        <key id="12482273">AMQ-775</key>
            <summary>MessageAuthorizationPolicy doesn&apos;t work</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jstrachan">James Strachan</assignee>
                                    <reporter username="ning.li">Ning Li</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Jun 2006 05:11:19 +0000</created>
                <updated>Thu, 17 Jan 2008 14:24:00 +0000</updated>
                            <resolved>Thu, 17 Jan 2008 14:24:00 +0000</resolved>
                                    <version>4.0</version>
                                    <fixVersion>5.1.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12938615" author="jkurtz" created="Mon, 11 Dec 2006 15:56:20 +0000"  >&lt;p&gt;cross reference to: &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-591&quot; title=&quot;add a per message authorization hook so that content-based authorization can be performed using a special plugin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-591&quot;&gt;&lt;del&gt;AMQ-591&lt;/del&gt;&lt;/a&gt;...&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/activemq/browse/AMQ-591&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/activemq/browse/AMQ-591&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12936616" author="jstrachan" created="Thu, 17 Jan 2008 14:24:00 +0000"  >&lt;p&gt;I&apos;ve added the test case MessageAuthenticationTest to show things working correctly. I applied your patches - thanks! Things now seem to work fine.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84331</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 45 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14bfb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233314</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>