<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:39:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6441] Incorrect File System Size Reported with Amazon Elastic File System (EFS)</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6441</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I&apos;ve set up Active MQ in production with a shared file system master/slave configuration (KahaDB). I&apos;ve set everything up and mounted the EFS on both EC2 instances. &lt;/p&gt;

&lt;p&gt;When I check the disk free stats I get 8 exabytes for the shared file system: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ df -h 
eu-west-1a.***.efs.eu-west-1.amazonaws.com:/  8.0E     0  8.0E   0% /mnt/efs 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Unfortunately, ActiveMQ cannot interpret this number (8 exabytes). This may be due to integer truncation.&lt;/p&gt;

&lt;p&gt;Here is a snippet of the log:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Store limit is 102400 mb (current store usage is 0 mb). The data directory: /mnt/efs/kahadb only has -8796093022208 mb of usable space - resetting to maximum available disk space: -8796093022207 mb 
Store limit is -8796093022207 mb, whilst the max journal file size &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the store is: 32 mb, the store will not accept any data when used. 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13007166">AMQ-6441</key>
            <summary>Incorrect File System Size Reported with Amazon Elastic File System (EFS)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="visibilityltd">Ismail Bhana</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Sep 2016 14:26:16 +0000</created>
                <updated>Sat, 27 Jan 2018 20:32:24 +0000</updated>
                            <resolved>Thu, 8 Dec 2016 11:18:19 +0000</resolved>
                                    <version>5.11.1</version>
                                    <fixVersion>5.15.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>10</watches>
                                                                                                                <comments>
                            <comment id="15516848" author="christopher.l.shannon" created="Fri, 23 Sep 2016 16:08:32 +0000"  >&lt;p&gt;I&apos;m not really sure why it&apos;s doing that because all of the usage and limit calculations use a long.  Since none of the developers have anything near that size of disk space to test on you will probably have to do some more debugging on your end to see what the problem is.  The code where the limits are checked is here: &lt;a href=&quot;https://github.com/apache/activemq/blob/master/activemq-broker/src/main/java/org/apache/activemq/broker/BrokerService.java#L2044&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/master/activemq-broker/src/main/java/org/apache/activemq/broker/BrokerService.java#L2044&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You could try setting up a remote debugger and some break points to see where the value is going bad.  The other option is you can add some logging statements to the code and rebuild it, etc. and deploy the rebuilt version.&lt;/p&gt;</comment>
                            <comment id="15517036" author="william.crowell" created="Fri, 23 Sep 2016 17:24:38 +0000"  >&lt;p&gt;I have a theory that a long is not large enough to represent 8,796,093,022,208 megabytes, and we are running into an overflow issue.&lt;/p&gt;

&lt;p&gt;Given that a long primitive type in Java 7 has a range of -2 to the 63rd power and a maximum value of 2 to the 63rd power -1.&lt;/p&gt;

&lt;p&gt;This means that a long can have values -9,223,372,036,854,775,808 to 9,223,372,036,854,775,807.&lt;/p&gt;

&lt;p&gt;If I convert 8796093022208 megabytes into bytes then that value is 9,223,372,036,854,780,000 which is 4,193 outside the maximum value of a long.&lt;/p&gt;

&lt;p&gt;If you happen to be running Java 8, then a unsigned 64-bit long can have a maximum value of 18,446,744,073,709,500,000 which would be large enough.&lt;/p&gt;

&lt;p&gt;This means that the call to Java&apos;s java.io.File.getTotalSpace() would overflow since it returns a long: &lt;a href=&quot;https://docs.oracle.com/javase/7/docs/api/java/io/File.html#getTotalSpace(&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/7/docs/api/java/io/File.html#getTotalSpace(&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;In Java 8, this probably works fine.  Could I propose changing the variable on line 2050 of org.apache.activemq.broker.BrokerService to a double instead of a long?&lt;/p&gt;

&lt;p&gt;...&lt;br/&gt;
double totalSpace = dir.getTotalSpace();&lt;br/&gt;
...                                                              &lt;/p&gt;

&lt;p&gt;From the link: &lt;a href=&quot;https://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://docs.oracle.com/javase/tutorial/java/nutsandbolts/datatypes.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&quot;The double data type is a double-precision 64-bit IEEE 754 floating point.&quot;&lt;/p&gt;</comment>
                            <comment id="15517121" author="christopher.l.shannon" created="Fri, 23 Sep 2016 17:57:35 +0000"  >&lt;p&gt;I think you are right, I was thinking that the value would still fit into a long but looks like it is just a bit too large as you pointed out to fit in a long value.&lt;/p&gt;

&lt;p&gt;But I don&apos;t see how changing totalSpace to a double would do anything.  java.io.File.getTotalSpace() would still overflow and return a negative long value which would then just become a negative double.&lt;/p&gt;</comment>
                            <comment id="15517131" author="william.crowell" created="Fri, 23 Sep 2016 18:02:45 +0000"  >&lt;p&gt;Unfortunately, I think you are right.  The user would need to move to JDK 1.8 so an unsigned long is returned.&lt;/p&gt;</comment>
                            <comment id="15517134" author="christopher.l.shannon" created="Fri, 23 Sep 2016 18:05:29 +0000"  >&lt;p&gt;Yep, nothing can really be done here because it&apos;s a JDK api method that returns a long.  The only real solution is to use something like the BigInteger class but that can&apos;t be done in this case since we don&apos;t control the method call.  So you probably will need to just configure a smaller partition for your broker.&lt;/p&gt;</comment>
                            <comment id="15517146" author="christopher.l.shannon" created="Fri, 23 Sep 2016 18:08:50 +0000"  >&lt;p&gt;Closing as not a problem as we use the Java File api and can&apos;t control if the value overflows a long.&lt;/p&gt;</comment>
                            <comment id="15525992" author="tbain98" created="Tue, 27 Sep 2016 12:39:12 +0000"  >&lt;p&gt;An OpenJDK bug was opened about this issue: &lt;a href=&quot;https://bugs.openjdk.java.net/browse/JDK-8162520&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://bugs.openjdk.java.net/browse/JDK-8162520&lt;/a&gt;.  Presumably that means that a fix would be part of HotSpot and other non-open JDKs as well.  But since it would require an API change, I suspect we wouldn&apos;t see it until Java 9, if they can convince the Java 9 people to include it there as well.&lt;/p&gt;</comment>
                            <comment id="15526017" author="tbain98" created="Tue, 27 Sep 2016 12:48:49 +0000"  >&lt;p&gt;I don&apos;t agree that there&apos;s nothing we can do, and I think this bug should be reopened.&lt;/p&gt;

&lt;p&gt;One option would be to explicitly work around this particular use case, by assuming that if the long we get back from getTotalSpace() is negative, that means the filesystem is plenty big enough to hold the broker&apos;s data files.  Obviously you can construct cases where the overflow will result in a small positive number and we&apos;ll still give the wrong answer, but the hack would still cover anyone with an 8EB filesystem (including the reporter of this bug).  16 EB or any multiple thereof, however, would be a problem.&lt;/p&gt;

&lt;p&gt;Another option would be to provide a config flag that allows you to skip the filesystem free space check, eliminating the problem entirely for all filesystem sizes when the flag is used.  We should do this at a minimum, whether or not we try to do hacks based on negative return values from getTotalSpace().&lt;/p&gt;</comment>
                            <comment id="15526048" author="william.crowell" created="Tue, 27 Sep 2016 13:01:38 +0000"  >&lt;p&gt;I agree with Tim.  I would like to see this fixed with the workaround Tim proposed.&lt;/p&gt;</comment>
                            <comment id="15526057" author="tabish121" created="Tue, 27 Sep 2016 13:03:05 +0000"  >&lt;p&gt;Contributions are always welcomed&lt;/p&gt;</comment>
                            <comment id="15526064" author="tbain98" created="Tue, 27 Sep 2016 13:04:36 +0000"  >&lt;p&gt;Let&apos;s start with reopening the bug.  No one will contribute code for a bug with a Resolution of &quot;Not A Problem.&quot;&lt;/p&gt;</comment>
                            <comment id="15526075" author="christopher.l.shannon" created="Tue, 27 Sep 2016 13:08:24 +0000"  >&lt;p&gt;Reopening the issue so that a workaround can be done for too large of a filesystem size.&lt;/p&gt;</comment>
                            <comment id="15527156" author="william.crowell" created="Tue, 27 Sep 2016 19:18:37 +0000"  >&lt;p&gt;I can work on this, but I do not have an 8 exabyte volume to test this on.  Does AWS provision volumes like this for no cost?  Or a trial?&lt;/p&gt;</comment>
                            <comment id="15527178" author="christopher.l.shannon" created="Tue, 27 Sep 2016 19:26:24 +0000"  >&lt;p&gt;This should be tested in a unit test regardless so my recommendation is to not worry about that and see if you could use something like mockito to mock/spy on the File api interface and then you can configure it to return whatever value you want (ie 8 EB) to test.  Off the top of my head maybe something like mocking out what the getPersistenceAdapter() method returns in BrokerService could work so that when the usage checks get the directory to check the size it will return your Directory/File mock etc.&lt;/p&gt;</comment>
                            <comment id="15527335" author="william.crowell" created="Tue, 27 Sep 2016 20:33:08 +0000"  >&lt;p&gt;I am able to reproduce it like this:&lt;/p&gt;

&lt;p&gt;import java.io.File;&lt;br/&gt;
import org.junit.Before;&lt;br/&gt;
import org.junit.Test;&lt;br/&gt;
import static org.mockito.Mockito.mock;&lt;br/&gt;
import static org.mockito.Mockito.when;&lt;/p&gt;

&lt;p&gt;public class FileApiTest {&lt;br/&gt;
	private File mockFile;&lt;/p&gt;

&lt;p&gt;    @Before&lt;br/&gt;
    public void setUp() &lt;/p&gt;
{
        mockFile = mock(File.class);
    }

&lt;p&gt;    @Test&lt;br/&gt;
    public void test1() &lt;/p&gt;
{
        when(mockFile.getTotalSpace()).thenReturn(9223372036854775807L + 4193L);
        long totalSpace = mockFile.getTotalSpace();
        //totalSpace will be equal to -9223372036854771616
    }
&lt;p&gt;}&lt;/p&gt;</comment>
                            <comment id="15529181" author="christopher.l.shannon" created="Wed, 28 Sep 2016 10:16:49 +0000"  >&lt;p&gt;Right that&apos;s basically what I had in mind with mocking the File API, but you&apos;ll want to wire that in for a test with the BrokerService to test that a real Broker instance still starts up when the value is negative (if the new flag is set to disable the disk usage check, etc).  If you take a look at the unit test project you&apos;ll see a ton of examples of tests and how to configure a BrokerService to start a real broker in JUnit.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure how familiar you are with the code base so if you can&apos;t figure out how to set up a test or don&apos;t have time then I should be able to do it when I get a chance.&lt;/p&gt;</comment>
                            <comment id="15529481" author="william.crowell" created="Wed, 28 Sep 2016 12:42:17 +0000"  >&lt;p&gt;I think you might be referring to activemq-unit-tests&apos; org.apache.activemq.broker.BrokerServiceTest.java.  I am also checking out BrokerTest.java and BrokerTestSupport.java in that same package.&lt;/p&gt;</comment>
                            <comment id="15529849" author="william.crowell" created="Wed, 28 Sep 2016 14:39:26 +0000"  >&lt;p&gt;I am concerned that if I introduce this flag that skips the file system check, then users with smaller file systems will set this flag to true and not understand the repercussions.&#8194;&#8194;This may cause problems with the store outgrowing the size of the file system and cause instability.&lt;/p&gt;</comment>
                            <comment id="15530559" author="khokhani" created="Wed, 28 Sep 2016 19:05:21 +0000"  >&lt;p&gt;I think it should be whenever JDK call returns negative value for max file system size then BrokerService method set it to Long.MAX_VALUE will avoid any other side effects. &lt;/p&gt;

&lt;p&gt;If file system is small then it should do normal operation of resetting max size to actual file size.&lt;/p&gt;</comment>
                            <comment id="15532648" author="githubbot" created="Thu, 29 Sep 2016 12:29:13 +0000"  >&lt;p&gt;GitHub user wcrowell opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/202&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/202&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6441&quot; title=&quot;Incorrect File System Size Reported with Amazon Elastic File System (EFS)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6441&quot;&gt;&lt;del&gt;AMQ-6441&lt;/del&gt;&lt;/a&gt; where a negative value can be returned with large AWS EFS files systems when calling java.io.File.getTotalSpace()&lt;/p&gt;

&lt;p&gt;    Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6441&quot; title=&quot;Incorrect File System Size Reported with Amazon Elastic File System (EFS)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6441&quot;&gt;&lt;del&gt;AMQ-6441&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    A test, testLargeFileSystem(), was added to org.apache.activemq.broker.BrokerServiceTest for checking if the total space on a volume was too large to fit into a primitive long.  If this happens, then totalSpace is set to java.lang.Long.MAX_VALUE.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/wcrowell/activemq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/wcrowell/activemq&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/202.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/202.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #202&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c94b1a2eec78a0fd15763b64dcdff455bfc66e52&lt;br/&gt;
Author: William Crowell &amp;lt;william.crowell@roguewave.com&amp;gt;&lt;br/&gt;
Date:   2016-09-29T12:22:46Z&lt;/p&gt;

&lt;p&gt;    Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6441&quot; title=&quot;Incorrect File System Size Reported with Amazon Elastic File System (EFS)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6441&quot;&gt;&lt;del&gt;AMQ-6441&lt;/del&gt;&lt;/a&gt; where a negative value can be returned with large AWS EFS files systems when calling java.io.File.getTotalSpace()&lt;/p&gt;

&lt;p&gt;commit 0c98ecfa2b903ce1301802617b8c5152048364f4&lt;br/&gt;
Author: William Crowell &amp;lt;william.crowell@roguewave.com&amp;gt;&lt;br/&gt;
Date:   2016-09-29T12:24:41Z&lt;/p&gt;

&lt;p&gt;    Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6441&quot; title=&quot;Incorrect File System Size Reported with Amazon Elastic File System (EFS)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6441&quot;&gt;&lt;del&gt;AMQ-6441&lt;/del&gt;&lt;/a&gt; where a negative value can be returned with large AWS EFS files systems when calling java.io.File.getTotalSpace()&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15532687" author="tbain98" created="Thu, 29 Sep 2016 12:48:21 +0000"  >&lt;p&gt;This approach addresses the immediate problem, with an 8 EB volume.  It will do nothing for a 16EB volume, a 32 EB volume, or any other multiple of 16 EB, because those volumes will all show as small positively-sized volumes.  (If 8EB is 4193 bytes over half the range of a long, double that - 16 EB - will be 4193 * 2 = 8386 bytes over the full range of a long, and will mod down to the small but positive remainder: 8386 bytes.  And multiplying that number by anything will result in a volume that is 8386 bytes times the multiplier, which will probably be smaller than the KahaDB store.)  So the proposed (and implemented) algorithm fixes today&apos;s problem, but does nothing for the next problem.&lt;/p&gt;

&lt;p&gt;The only safe way to allow people to not be bit by this in the future is to implement the flag.  It would be defaulted to false, and enabled only when they deem it necessary based on their own knowledge of their storage situation.  People don&apos;t go changing values randomly, so no one&apos;s going to make the change unless they believe they need it, and if they know about the setting to misconfigure it, they&apos;ll know what to set back when it causes them problems.&lt;/p&gt;

&lt;p&gt;Based on the above, I recommend rejecting the pull request that was just made, and reworking the change to include a flag.  Otherwise, we&apos;re going to get to do this all over again whenever Amazon increases the default EFS volume size to 16EB.&lt;/p&gt;</comment>
                            <comment id="15532690" author="tbain98" created="Thu, 29 Sep 2016 12:49:19 +0000"  >&lt;p&gt;I recommend rejecting this pull request, and reworking the change to include a flag.  See the details of my reasoning in my reply to the previous comment.&lt;/p&gt;</comment>
                            <comment id="15532727" author="william.crowell" created="Thu, 29 Sep 2016 13:06:26 +0000"  >&lt;p&gt;So if totalSpace is negative do we just fail starting up the broker?  If we introduce the flag and set it to true and totalSpace is negative, then would that not have other consequences (e.g. looking strange in the JMX and web consoles and other issues)?&lt;/p&gt;</comment>
                            <comment id="15532849" author="christopher.l.shannon" created="Thu, 29 Sep 2016 13:59:28 +0000"  >&lt;p&gt;I would probably do a combination of the two things.&lt;/p&gt;

&lt;p&gt;First, as Tim said, I would implement a flag (defaulting to false) that can be turned on that would disable the usage check altogether.  Also note that there is a task that gets scheduled to periodically check the usage and this flag should also make sure this task is not scheduled.&lt;/p&gt;

&lt;p&gt;Second, as a sanity check, I see no harm in also adding a check for a negative value of totalSpace.  If the value is negative then I would think the safest thing to do is to throw an exception with a good error message that explains why the error most likely happened (probably an overflow) and how to fix it (enable the new flag to true to disable the check).  You could also just allow the broker to start up with the negative value and skip the check but I would think it&apos;s better to error to make sure the user is aware of the issue and can explicitly decide if they want to disable the check or use a smaller partition.&lt;/p&gt;</comment>
                            <comment id="15706052" author="davsclaus" created="Tue, 29 Nov 2016 18:06:37 +0000"  >&lt;p&gt;Is anyone working on implementing the last suggestions from Christopher about that flag to turn on | off.&lt;/p&gt;</comment>
                            <comment id="15706074" author="christopher.l.shannon" created="Tue, 29 Nov 2016 18:13:44 +0000"  >&lt;p&gt;I don&apos;t think anything has been done since the original PR.  I haven&apos;t gotten around to it yet but if no one else does then it&apos;s something I can work on for a future 5.14.x or 5.15.0 release.&lt;/p&gt;</comment>
                            <comment id="15706080" author="william.crowell" created="Tue, 29 Nov 2016 18:15:51 +0000"  >&lt;p&gt;I would love to take this on, but I am swamped.&lt;/p&gt;</comment>
                            <comment id="15728934" author="gtully" created="Wed, 7 Dec 2016 14:50:02 +0000"  >&lt;p&gt;I had a peek at this and think maybe this can be recast as allowing the user to specify the quantity of disk that is available to the broker; i.e: allow the dependency on the file.getTotalSpace and getUsableSpace to be overridden.&lt;/p&gt;

&lt;p&gt;The typical use case is to limit the brokers disk usage through flow control or blocking. &lt;br/&gt;
In the case where the broker does not have exclusive access to a disk partition, or in the case of the partition giving bad information, it is useful to be able to specify the expected hard limit.&lt;/p&gt;

&lt;p&gt;I am thinking that an StoreUsage.setTotalSpace(long v) option will suffice. Any value &amp;gt; 0 will be taken as the total available space and the filesystem will not be queried further.&lt;br/&gt;
Any limit will then be relative to the actual store usage (index and journal data files) as a portion of the totalSpace value. Irrespective of what the actual file system reports.&lt;br/&gt;
This feature then allows a user to partition a shared disk between brokers.&lt;br/&gt;
In the EFS case, it allows the user to specify the value of disk space that is to be used by the broker.&lt;/p&gt;</comment>
                            <comment id="15729437" author="jira-bot" created="Wed, 7 Dec 2016 18:10:30 +0000"  >&lt;p&gt;Commit f225120f61c9acfbe64b5f7590fbd72bb668525f in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=william.crowell&quot; class=&quot;user-hover&quot; rel=&quot;william.crowell&quot;&gt;william.crowell&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=f225120&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=f225120&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6441&quot; title=&quot;Incorrect File System Size Reported with Amazon Elastic File System (EFS)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6441&quot;&gt;&lt;del&gt;AMQ-6441&lt;/del&gt;&lt;/a&gt; where a negative value can be returned with large AWS EFS files systems when calling java.io.File.getTotalSpace()&lt;/p&gt;</comment>
                            <comment id="15729438" author="jira-bot" created="Wed, 7 Dec 2016 18:10:32 +0000"  >&lt;p&gt;Commit 41bec0d65814448d0495462a6eafe7cbd54b36e0 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=william.crowell&quot; class=&quot;user-hover&quot; rel=&quot;william.crowell&quot;&gt;william.crowell&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=41bec0d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=41bec0d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6441&quot; title=&quot;Incorrect File System Size Reported with Amazon Elastic File System (EFS)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6441&quot;&gt;&lt;del&gt;AMQ-6441&lt;/del&gt;&lt;/a&gt; where a negative value can be returned with large AWS EFS files systems when calling java.io.File.getTotalSpace()&lt;/p&gt;</comment>
                            <comment id="15729439" author="jira-bot" created="Wed, 7 Dec 2016 18:10:34 +0000"  >&lt;p&gt;Commit 8a28c065554750ea5063333e2ff479a84d689a51 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=8a28c06&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=8a28c06&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6441&quot; title=&quot;Incorrect File System Size Reported with Amazon Elastic File System (EFS)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6441&quot;&gt;&lt;del&gt;AMQ-6441&lt;/del&gt;&lt;/a&gt; add option to specify the hard limits on a usage such that spurious values from the file system can be overridden. this closes #202 thanks William Crowell for the patch with test&lt;/p&gt;</comment>
                            <comment id="15729449" author="william.crowell" created="Wed, 7 Dec 2016 18:13:48 +0000"  >&lt;p&gt;No problem.  Thank you!&lt;/p&gt;</comment>
                            <comment id="15729456" author="gtully" created="Wed, 7 Dec 2016 18:16:33 +0000"  >&lt;p&gt;with the above changes a negative value from the filesystem will error out. To workaround the problem a user provides a hard limit via the  usage where there limit is specified via the total attribute. This value is then taken as the available space, negating the need to ask the file system.&lt;br/&gt;
Maybe a negative value should default, but I think if there are limits set then it is best to error out if they won&apos;t be respected.&lt;br/&gt;
feedback most welcome. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=william.crowell&quot; class=&quot;user-hover&quot; rel=&quot;william.crowell&quot;&gt;william.crowell&lt;/a&gt; I reused your mock and LargeFile - thanks!&lt;/p&gt;</comment>
                            <comment id="15729498" author="jira-bot" created="Wed, 7 Dec 2016 18:33:54 +0000"  >&lt;p&gt;Commit 4b3f07e90ea497164aaf9cc00591e8e0f868f83b in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4b3f07e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4b3f07e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6441&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6441&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6526&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6526&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Adding missing license headers&lt;/p&gt;</comment>
                            <comment id="15729506" author="christopher.l.shannon" created="Wed, 7 Dec 2016 18:35:53 +0000"  >&lt;p&gt;Looks good to me, 5.14.2 is under vote already but this can go into 5.14.3 (if there is one) and 5.15.0&lt;/p&gt;</comment>
                            <comment id="15730947" author="tbain98" created="Thu, 8 Dec 2016 03:15:45 +0000"  >&lt;p&gt;The one downside to Gary&apos;s implementation is that if you use this option, we&apos;re no longer going to detect a disk that&apos;s nearly full and doesn&apos;t have enough space for the broker&apos;s data store.  As long as this is only used in cases where you&apos;ve got exadata-scale storage where that&apos;s not a realistic concern, that&apos;s probably just an academic concern, but we need to make very clear in the wiki documentation that you should use Gary&apos;s setting only if you have storage on that scale; anyone whose storage is smaller than MAX_INT should not use it under any circumstances, and the documentation should say that explicitly to protect newbies from themselves.&lt;/p&gt;</comment>
                            <comment id="15730986" author="tabish121" created="Thu, 8 Dec 2016 03:38:21 +0000"  >&lt;p&gt;Sounds good, why don&apos;t you go ahead and add that to the Wiki&lt;/p&gt;</comment>
                            <comment id="15731891" author="gtully" created="Thu, 8 Dec 2016 11:18:21 +0000"  >&lt;p&gt;I added a PercentUsage section at the end of&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; that covers the percentLimit and total attributes that are common to the Store and Temp Usage. With a note on the caveat.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://cwiki.apache.org/confluence/display/ACTIVEMQ/Producer+Flow+Control&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://cwiki.apache.org/confluence/display/ACTIVEMQ/Producer+Flow+Control&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13029798">CASSANDRA-13067</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="13025798">ARTEMIS-872</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 49 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i340bz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>