<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:42:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2183] Master/slave out of sync with multiple consumers of a VirtualTopic on the same broker</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2183</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;1. producer of VirtualTopic.testTopic publish message to brokerA&lt;br/&gt;
2. consumer 1 on brokerB with &quot;Consumer.A.VirtualTopic.testTopic&lt;br/&gt;
    consumer 2 on brokerB with &quot;Consumer.A2.VirtualTopic.testTopic&lt;br/&gt;
3. brokerA and brokerB are bridged.&lt;/p&gt;

&lt;p&gt;Result: you will get &lt;br/&gt;
ERROR MasterBroker - Slave Failed&lt;br/&gt;
javax.jms.JMSException: Slave broker out of sync with master - Message: ID:yhe-1337-1236273055924-0:16:1:1:738 on queue does not exist among pending(0) for subscription: ID:yhe-3603-1236271682179-0:13:1:1&lt;/p&gt;

&lt;p&gt;Reason:&lt;br/&gt;
In TransactionBroker.java there is a ActiveMQMessageAudit and it will be configured if the broker is a slave. ActiveMQMessageAudit is using the messageId alone to check whether the message is a duplicate. The message for consumer2 will be ignored as duplicate and not saved to the message store because consumer1&apos;s same message arrives early.&lt;/p&gt;</description>
                <environment>&lt;p&gt;solaris 10&lt;/p&gt;</environment>
        <key id="12483418">AMQ-2183</key>
            <summary>Master/slave out of sync with multiple consumers of a VirtualTopic on the same broker</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dejanb">Dejan Bosanac</assignee>
                                    <reporter username="yinghe0101">ying</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Mar 2009 19:18:02 +0000</created>
                <updated>Tue, 27 Apr 2010 08:28:26 +0000</updated>
                            <resolved>Tue, 27 Apr 2010 08:28:26 +0000</resolved>
                                    <version>5.2.0</version>
                                    <fixVersion>5.4.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="12941063" author="yinghe0101" created="Wed, 25 Mar 2009 19:23:49 +0000"  >&lt;p&gt;Attached patch fix the issue. I create this new children ActiveMQMessageAuditWithDestination.java because it will be used only in TransactionBroker.java for a slave. Other code use is using the original ActiveMQMessageAudit.java&lt;/p&gt;

&lt;p&gt;Please review and refactor when you see fit. Thanks&lt;/p&gt;</comment>
                            <comment id="12941775" author="gtully" created="Wed, 22 Jul 2009 09:43:56 +0000"  >&lt;p&gt;I added a test case to try and understand this issue and reproduce but I am missing some information. In a pure master slave setup, how can you have a producer connected to brokerA and consumers connected to brokerB at the same time?&lt;/p&gt;

&lt;p&gt;Can you modify the test case: activemq-core/src/test/java/org/apache/activemq/bugs/AMQ2183Test.java to demonstrate the problem?&lt;/p&gt;</comment>
                            <comment id="12941773" author="yinghe0101" created="Wed, 22 Jul 2009 13:07:06 +0000"  >&lt;p&gt;hi, Gary,&lt;/p&gt;

&lt;p&gt;we have a setup of 4 master/slave broker pair( totally 8 brokers), each pair is a pure master/slave. All masters are multicast discovered and bridged. However only the master&apos;s url are exposed to the client, we only use slave for data replication. &lt;br/&gt;
in my previous comments, brokerA and brokerB all refers to a master in a network of brokers. hope this clears things. I will see whether i have time after work to modify the test.&lt;/p&gt;</comment>
                            <comment id="12941125" author="gtully" created="Tue, 1 Sep 2009 09:51:56 +0000"  >&lt;p&gt;pushing this out to 5.4 pending a test case that can demonstrate the problem. Don&apos;t think this can block the 5.3 release, downgrade to major. &lt;/p&gt;</comment>
                            <comment id="12942525" author="dejanb" created="Tue, 27 Apr 2010 08:28:26 +0000"  >&lt;p&gt;Fixed with svn revision 938353.&lt;/p&gt;

&lt;p&gt;The order of TransactionBroker and CompositeDestinationBroker interceptor should be enough to fix this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461454" name="AMQ-2183.patch" size="1750" author="yinghe0101" created="Thu, 26 Mar 2009 21:18:41 +0000"/>
                            <attachment id="12461455" name="ActiveMQMessageAuditWithDestination.java" size="4234" author="yinghe0101" created="Thu, 26 Mar 2009 21:18:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75037</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rpzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>159856</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>