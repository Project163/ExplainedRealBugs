<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:48:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-7106] TransportConnection pendingStop support during start is broken</title>
                <link>https://issues.apache.org/jira/browse/AMQ-7106</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;If start blocks, the inactivity monitor can kick in. The intent is that it can see the starting state and initiate a pending stop and complete.&lt;br/&gt;
 The current synchronization breaks this b/c the start code holds a lock for its duration, which requires the stopAsync code to block in error.&lt;br/&gt;
 This means there is a blocked inactivity monitor thread per blocked starting connection...&#160; very quickly too many threads.&lt;br/&gt;
 A blocked ssl handshake can demonstrate.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;MQTTInactivityMonitor Async Task: java.util.concurrent.ThreadPoolExecutor$Worker@7c1745f4[State = -1, empty queue]&quot;&lt;/span&gt; #4412 daemon prio=5 os_prio=0 tid=0x00007fd524f2c800 nid=0x622d waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; monitor entry [0x00007fd393776000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: BLOCKED (on object monitor)
        at org.apache.activemq.broker.TransportConnection.stopAsync(TransportConnection.java:1136)
        - waiting to lock &amp;lt;0x00000004dc8059b0&amp;gt; (a org.apache.activemq.broker.jmx.ManagedTransportConnection)
        at org.apache.activemq.broker.jmx.ManagedTransportConnection.stopAsync(ManagedTransportConnection.java:66)
        at org.apache.activemq.broker.TransportConnection.stopAsync(TransportConnection.java:1131)
        at org.apache.activemq.broker.TransportConnection.serviceTransportException(TransportConnection.java:235)
        at org.apache.activemq.broker.TransportConnection$1.onException(TransportConnection.java:206)
        at org.apache.activemq.transport.TransportFilter.onException(TransportFilter.java:101)
        at org.apache.activemq.transport.mqtt.MQTTInactivityMonitor.onException(MQTTInactivityMonitor.java:196)
        at org.apache.activemq.transport.mqtt.MQTTInactivityMonitor$1$1.run(MQTTInactivityMonitor.java:81)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)

   Locked ownable synchronizers:
        - &amp;lt;0x00000004d7803c60&amp;gt; (a java.util.concurrent.ThreadPoolExecutor$Worker)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ BrokerService[BB] Task-51959&quot;&lt;/span&gt; #4414527 daemon prio=5 os_prio=0 tid=0x00007fd5f83b9800 nid=0x1846 runnable [0x00007fd3873b3000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
        at sun.nio.ch.EPollArrayWrapper.epollWait(Native Method)
        at sun.nio.ch.EPollArrayWrapper.poll(EPollArrayWrapper.java:269)
        at sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:93)
        at sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:86)
        - locked &amp;lt;0x00000004dc805830&amp;gt; (a sun.nio.ch.Util$3)
        - locked &amp;lt;0x00000004dc805820&amp;gt; (a java.util.Collections$UnmodifiableSet)
        - locked &amp;lt;0x00000004dc805840&amp;gt; (a sun.nio.ch.EPollSelectorImpl)
        at sun.nio.ch.SelectorImpl.select(SelectorImpl.java:97)
        at org.apache.activemq.transport.nio.NIOSSLTransport.doHandshake(NIOSSLTransport.java:380)
        at org.apache.activemq.transport.nio.NIOSSLTransport.initializeStreams(NIOSSLTransport.java:137)
        at org.apache.activemq.transport.mqtt.MQTTNIOSSLTransport.initializeStreams(MQTTNIOSSLTransport.java:46)
        at org.apache.activemq.transport.tcp.TcpTransport.connect(TcpTransport.java:519)
        at org.apache.activemq.transport.nio.NIOTransport.doStart(NIOTransport.java:160)
        at org.apache.activemq.transport.nio.NIOSSLTransport.doStart(NIOSSLTransport.java:412)
        at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:55)
        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)
        at org.apache.activemq.transport.mqtt.MQTTTransportFilter.start(MQTTTransportFilter.java:157)
        at org.apache.activemq.transport.mqtt.MQTTInactivityMonitor.start(MQTTInactivityMonitor.java:148)
        at org.apache.activemq.transport.TransportFilter.start(TransportFilter.java:58)
        at org.apache.activemq.broker.TransportConnection.start(TransportConnection.java:1066)
        - locked &amp;lt;0x00000004dc8059b0&amp;gt; (a org.apache.activemq.broker.jmx.ManagedTransportConnection)
        at org.apache.activemq.broker.TransportConnector$1$1.run(TransportConnector.java:218)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)

   Locked ownable synchronizers:
        - &amp;lt;0x00000004dc805a78&amp;gt; (a java.util.concurrent.ThreadPoolExecutor$Worker)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;mqtt nio ssl&lt;/p&gt;</environment>
        <key id="13199803">AMQ-7106</key>
            <summary>TransportConnection pendingStop support during start is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Nov 2018 10:19:57 +0000</created>
                <updated>Thu, 11 Mar 2021 14:55:49 +0000</updated>
                            <resolved>Wed, 21 Nov 2018 10:30:32 +0000</resolved>
                                    <version>5.15.0</version>
                                    <fixVersion>5.15.9</fixVersion>
                    <fixVersion>5.16.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16694528" author="jira-bot" created="Wed, 21 Nov 2018 10:23:30 +0000"  >&lt;p&gt;Commit 8cc0c5ad6c85381cf6bbeaf179086d451d96650e in activemq&apos;s branch refs/heads/master from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=8cc0c5a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=8cc0c5a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7106&quot; title=&quot;TransportConnection pendingStop support during start is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7106&quot;&gt;&lt;del&gt;AMQ-7106&lt;/del&gt;&lt;/a&gt; - fix pending stop support by avoiding sync through single shared status var - fix and test&lt;/p&gt;</comment>
                            <comment id="16694533" author="gtully" created="Wed, 21 Nov 2018 10:30:32 +0000"  >&lt;p&gt;The same fix pattern could be applied to the stop/stopping choreography however that problem goes deeper due to the interaction with the service stopper state etc. It gets very involved quickly. This is a small step with specific intent and scope.&lt;/p&gt;</comment>
                            <comment id="16719198" author="jira-bot" created="Wed, 12 Dec 2018 16:57:30 +0000"  >&lt;p&gt;Commit 540999654a8d581e2ba7c4c160a522378b318bbf in activemq&apos;s branch refs/heads/activemq-5.15.x from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=5409996&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=5409996&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7106&quot; title=&quot;TransportConnection pendingStop support during start is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7106&quot;&gt;&lt;del&gt;AMQ-7106&lt;/del&gt;&lt;/a&gt; - fix pending stop support by avoiding sync through single shared status var - fix and test&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 8cc0c5ad6c85381cf6bbeaf179086d451d96650e)&lt;/p&gt;</comment>
                            <comment id="16979288" author="jira-bot" created="Thu, 21 Nov 2019 13:53:23 +0000"  >&lt;p&gt;Commit e4f155f548f63aa9693ae8bbdb9ed3f224ee616e in activemq&apos;s branch refs/heads/master from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=e4f155f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=e4f155f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7106&quot; title=&quot;TransportConnection pendingStop support during start is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7106&quot;&gt;&lt;del&gt;AMQ-7106&lt;/del&gt;&lt;/a&gt; - fix intermittent failure in the test&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                            <outwardlinks description="causes">
                                        <issuelink>
            <issuekey id="13363870">AMQ-8183</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 51 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|s00qd4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>