<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:52:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-9153] Fix Slow Consumer Advisory for Queue subscriptions</title>
                <link>https://issues.apache.org/jira/browse/AMQ-9153</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;The &lt;tt&gt;AdvisoryTests&lt;/tt&gt; class was not running due to a bug with the the test configuration that is now fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9152&quot; title=&quot;ActiveMQ unit tests are not running all tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9152&quot;&gt;&lt;del&gt;AMQ-9152&lt;/del&gt;&lt;/a&gt;. The &lt;tt&gt;testSlowConsumerAdvisory&lt;/tt&gt; test is now failing when run so this needs to be investigated to see if it&apos;s a real failure and something broke or if the test needs to be fixed.&lt;/p&gt;

&lt;p&gt;After further investigation it turns out after changse in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-1902&quot; title=&quot;org.apache.activemq.broker.region.cursors.CursorQueueStoreTest often fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-1902&quot;&gt;&lt;del&gt;AMQ-1902&lt;/del&gt;&lt;/a&gt; it no longer works at all for queues (only durables and topic subs) so it needs to be fixed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13493994">AMQ-9153</key>
            <summary>Fix Slow Consumer Advisory for Queue subscriptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="cshannon">Christopher L. Shannon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Nov 2022 10:42:43 +0000</created>
                <updated>Tue, 1 Nov 2022 14:32:18 +0000</updated>
                            <resolved>Tue, 1 Nov 2022 14:32:18 +0000</resolved>
                                    <version>5.17.2</version>
                                    <fixVersion>5.18.0</fixVersion>
                    <fixVersion>5.17.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6000">1h 40m</timespent>
                                <comments>
                            <comment id="17627108" author="christopher.l.shannon" created="Tue, 1 Nov 2022 11:08:09 +0000"  >&lt;p&gt;It looks like this has been broken for 10 years. The change back in 2012 in this Jira &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-1902&quot; title=&quot;org.apache.activemq.broker.region.cursors.CursorQueueStoreTest often fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-1902&quot;&gt;&lt;del&gt;AMQ-1902&lt;/del&gt;&lt;/a&gt; prevents messages from being dispatched to &lt;b&gt;queue&lt;/b&gt; subscriptions so the pending cursor ends up being 0 and the logic to detect the slow consumer never is true. It looks like durable subscriptions are fine.&lt;/p&gt;

&lt;p&gt;This fix prevents adding to full consumers:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/activemq/blob/ba0b7a25a0fb8d225147748f28f69ba5abee01b5/activemq-broker/src/main/java/org/apache/activemq/broker/region/Queue.java#L2199&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/ba0b7a25a0fb8d225147748f28f69ba5abee01b5/activemq-broker/src/main/java/org/apache/activemq/broker/region/Queue.java#L2199&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is where the logic is supposed to check if it&apos;s slow:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/activemq/blob/ba0b7a25a0fb8d225147748f28f69ba5abee01b5/activemq-broker/src/main/java/org/apache/activemq/broker/region/PrefetchSubscription.java#L670&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/ba0b7a25a0fb8d225147748f28f69ba5abee01b5/activemq-broker/src/main/java/org/apache/activemq/broker/region/PrefetchSubscription.java#L670&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="17627191" author="jira-bot" created="Tue, 1 Nov 2022 14:30:02 +0000"  >&lt;p&gt;Commit 596ee316874894ad0342475d8f242913bd507cd1 in activemq&apos;s branch refs/heads/main from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=596ee3168&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=596ee3168&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9153&quot; title=&quot;Fix Slow Consumer Advisory for Queue subscriptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9153&quot;&gt;&lt;del&gt;AMQ-9153&lt;/del&gt;&lt;/a&gt;: Fix slow consumer advisory for queue subscriptions&lt;/p&gt;

&lt;p&gt;Due to changes with Queues to check if consumers are full before adding&lt;br/&gt;
more messages to the subscription, the Queue dispatch logic needed to be&lt;br/&gt;
updated to mark subscriptions as slow and send advisories if configured&lt;br/&gt;
instead of relying on the subscription itself to do it.&lt;/p&gt;</comment>
                            <comment id="17627192" author="jira-bot" created="Tue, 1 Nov 2022 14:32:07 +0000"  >&lt;p&gt;Commit bc9e728123463c467cfd2b6125449f09db8c488c in activemq&apos;s branch refs/heads/activemq-5.17.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=bc9e72812&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=bc9e72812&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9153&quot; title=&quot;Fix Slow Consumer Advisory for Queue subscriptions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9153&quot;&gt;&lt;del&gt;AMQ-9153&lt;/del&gt;&lt;/a&gt;: Fix slow consumer advisory for queue subscriptions&lt;/p&gt;

&lt;p&gt;Due to changes with Queues to check if consumers are full before adding&lt;br/&gt;
more messages to the subscription, the Queue dispatch logic needed to be&lt;br/&gt;
updated to mark subscriptions as slow and send advisories if configured&lt;br/&gt;
instead of relying on the subscription itself to do it.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 596ee316874894ad0342475d8f242913bd507cd1)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13494029">AMQ-9154</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 2 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1aomg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>