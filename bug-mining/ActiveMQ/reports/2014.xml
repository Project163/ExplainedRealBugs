<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:01:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4596] AMQP: JMSSecurityExceptions are not propagated back to QPID client on authentication failures</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4596</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I created a broker using a config file that contained:&lt;/p&gt;

&lt;p&gt;&amp;lt;simpleAuthenticationPlugin&amp;gt;&lt;br/&gt;
    &amp;lt;users&amp;gt;&lt;br/&gt;
        &amp;lt;authenticationUser username=&quot;system&quot; password=&quot;systemPassword&quot; groups=&quot;users,admins&quot;/&amp;gt;&lt;br/&gt;
       &amp;lt;authenticationUser username=&quot;user&quot; password=&quot;userPassword&quot; groups=&quot;users&quot;/&amp;gt;&lt;br/&gt;
       &amp;lt;authenticationUser username=&quot;guest&quot; password=&quot;guestPassword&quot; groups=&quot;guests&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/users&amp;gt;&lt;br/&gt;
&amp;lt;/simpleAuthenticationPlugin&amp;gt;&lt;/p&gt;

&lt;p&gt;With a normal client, the following code will throw a JMSSecurityException on the connection.start(), or connection.createProducer(), or I assume on anything you do with connection.  The same is true if I call createConnection with an unknown user, or a known user and invalid password&lt;/p&gt;

&lt;p&gt;    ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory(&quot;vm://localhost&quot;);&lt;br/&gt;
    Connection connection = factory.createConnection();&lt;br/&gt;
    connection.start();&lt;/p&gt;

&lt;p&gt;When I use the QPID client though, I don&apos;t get the JMSSecurityException.  In the logs I can see the exception being thrown by the broker, but it doesn&apos;t get propagated back to the client, even if I add an exception listener.  The code below will continue along until it hangs on the session.CreateProducer() call.&lt;/p&gt;

&lt;p&gt;    ConnectionFactoryImpl factory = new ConnectionFactoryImpl(&quot;localhost&quot;, port, &quot;admin&quot;, &quot;password&quot;);&lt;br/&gt;
     Connection connection = factory.createConnection();&lt;br/&gt;
     connection.setExceptionListener(new ExceptionListener() {&lt;br/&gt;
         @Override&lt;br/&gt;
         public void onException(JMSException exception) &lt;/p&gt;
{
             exception.printStackTrace();
         }
&lt;p&gt;     });&lt;br/&gt;
     Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);&lt;br/&gt;
     QueueImpl queue = new QueueImpl(&quot;queue://txqueue&quot;);&lt;br/&gt;
     MessageProducer p = session.createProducer(queue);&lt;/p&gt;

&lt;p&gt;I will attach a unit test that reproduces this.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12654475">AMQ-4596</key>
            <summary>AMQP: JMSSecurityExceptions are not propagated back to QPID client on authentication failures</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="kearls">Kevin Anthony Earls</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Jun 2013 11:47:16 +0000</created>
                <updated>Wed, 4 Sep 2013 14:27:22 +0000</updated>
                            <resolved>Wed, 4 Sep 2013 14:27:22 +0000</resolved>
                                                    <fixVersion>5.9.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13691898" author="kearls" created="Mon, 24 Jun 2013 11:50:10 +0000"  >&lt;p&gt;Unit test that reproduces the problem.&lt;/p&gt;</comment>
                            <comment id="13702324" author="tabish121" created="Mon, 8 Jul 2013 19:40:59 +0000"  >&lt;p&gt;The trick is figuring out how to return the exception to the amqp client, currently its not obvious how that&apos;s supposed to work.  &lt;/p&gt;</comment>
                            <comment id="13749912" author="kearls" created="Mon, 26 Aug 2013 08:41:12 +0000"  >&lt;p&gt;We need to update to version 0.5 of proton in order to fix this.  Then we can call setCondition on the proton connection to send the error back to the client.&lt;/p&gt;
</comment>
                            <comment id="13751425" author="kearls" created="Tue, 27 Aug 2013 16:48:05 +0000"  >&lt;p&gt;This patch should fix this issue in proton 0.5 (or 1.0-SNAPSHOT), although it causes the &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4563&quot; title=&quot;Persisted messages reappear after broker restart when using amqp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4563&quot;&gt;&lt;del&gt;AMQ-4563&lt;/del&gt;&lt;/a&gt;Test to fail.&lt;/p&gt;</comment>
                            <comment id="13751629" author="tabish121" created="Tue, 27 Aug 2013 19:43:15 +0000"  >&lt;p&gt;For me if I add in this code to the onActiveMQCommand&apos;s handling of MessageDispatch commands then everything seems to work.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (md.getMessage() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                    Message message = md.getMessage();
                    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!message.getProperties().containsKey(&lt;span class=&quot;code-quote&quot;&gt;&quot;JMS_AMQP_MESSAGE_FORMAT&quot;&lt;/span&gt;)) {
                        message.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;JMS_AMQP_MESSAGE_FORMAT&quot;&lt;/span&gt;, 0);
                    }
                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I couldn&apos;t really find anything that informs on the values this property should have but from the code it appears that zero is the not set fall-back so it might be safe enough. &lt;/p&gt;</comment>
                            <comment id="13752172" author="kearls" created="Wed, 28 Aug 2013 07:01:03 +0000"  >&lt;p&gt;This patch contains Tim&apos;s suggested change, plus a couple of other minor updates.  The constructors we were using for protonConnection (ConnectionImpl) and protonTransport (TransportImpl) have both been deprecated so I updated those definitions.&lt;/p&gt;</comment>
                            <comment id="13752370" author="tabish121" created="Wed, 28 Aug 2013 13:06:17 +0000"  >&lt;p&gt;Not quite sure at this point what the right patches are since I get some conflicts on the third one, can you make on big rollup patch or clue me in on what I should be applying?&lt;/p&gt;</comment>
                            <comment id="13752459" author="kearls" created="Wed, 28 Aug 2013 14:52:36 +0000"  >&lt;p&gt;Sorry, I&apos;ll get it straightened out either this evening or tomorrow morning and upload a single patch.&lt;/p&gt;</comment>
                            <comment id="13755959" author="kearls" created="Mon, 2 Sep 2013 08:46:41 +0000"  >&lt;p&gt;Tim, this patch should work correctly.  Please note a couple of things:&lt;/p&gt;

&lt;p&gt;1. This includes the code change for AMQ4696, so you should probably apply that first, or ask me for another update.&lt;br/&gt;
2. Besides the changes for this bug (which occurs at line 405) there are several other changes for things that were either deprecated in or removed from proton-jms 0.5&lt;/p&gt;</comment>
                            <comment id="13757056" author="tabish121" created="Tue, 3 Sep 2013 20:53:10 +0000"  >&lt;p&gt;Not sure what I&apos;m doing wrong but after applying &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4696&quot; title=&quot;Durable Subscriptions are not created properly when using AMQP&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4696&quot;&gt;&lt;del&gt;AMQ-4696&lt;/del&gt;&lt;/a&gt; and then trying to apply this one I get a bunch of errors trying to compile. Things like AmqpTransport not defined etc.&lt;/p&gt;</comment>
                            <comment id="13757548" author="kearls" created="Wed, 4 Sep 2013 08:24:31 +0000"  >&lt;p&gt;Sorry, that&apos;s bizarre.  I recreated it, and tested it on a freshly checkedout version of the code.  If you still have problems please ping me.&lt;/p&gt;</comment>
                            <comment id="13757808" author="tabish121" created="Wed, 4 Sep 2013 14:27:22 +0000"  >&lt;p&gt;Patch applied cleanly this time, tests look good. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12600199" name="AMQ-4596-partial.patch" size="7015" author="kearls" created="Tue, 27 Aug 2013 16:48:05 +0000"/>
                            <attachment id="12589391" name="AMQ-4596.patch" size="11164" author="kearls" created="Mon, 24 Jun 2013 11:50:10 +0000"/>
                            <attachment id="12601039" name="AMQ-4596_final.patch" size="22939" author="kearls" created="Mon, 2 Sep 2013 08:46:41 +0000"/>
                            <attachment id="12601331" name="AMQ-4596_final_fixed.patch" size="21559" author="kearls" created="Wed, 4 Sep 2013 08:25:19 +0000"/>
                            <attachment id="12600343" name="AMQ-4596_updated.patch" size="7818" author="kearls" created="Wed, 28 Aug 2013 07:01:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334752</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 11 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lqt3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335078</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>