<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:24:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6058] Certain VirtualTopic configurations send messages to the wrong queue</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6058</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When testing out configurations of VirtualTopics I noticed some of the behavior doesn&apos;t seem quite right when using certain VirtualTopic set ups.&lt;/p&gt;

&lt;p&gt;Consider a VirtualTopic with the default name of &lt;tt&gt;&amp;gt;&lt;/tt&gt; and a prefix called &lt;tt&gt;q.test.vt.*.&lt;/tt&gt;  Normally the desired behavior is to only forward messages to consumers with that prefix.  For example,  if a message is published to a topic called &lt;tt&gt;mytopic&lt;/tt&gt;, then the consumer would be on queue &lt;tt&gt;q.test.vt.myconsumer.mytopic&lt;/tt&gt;.  &lt;/p&gt;

&lt;p&gt;However, I&apos;ve noticed that based on the interceptor logic that uses the destination map to find matching destinations, if a higher level queue exists, such as &lt;tt&gt;q.test.&amp;gt;&lt;/tt&gt; in this case, that queue will also receive the message.&lt;/p&gt;

&lt;p&gt;It seems desirable that only queues starting with the defined prefix should get the message so we should probably do a quick sanity check in the VirtualTopicInterceptor to make sure the destinations that match start with the VirtualTopic prefix defined.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12915529">AMQ-6058</key>
            <summary>Certain VirtualTopic configurations send messages to the wrong queue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="cshannon">Christopher L. Shannon</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Nov 2015 19:42:53 +0000</created>
                <updated>Sat, 4 Jun 2016 03:17:25 +0000</updated>
                            <resolved>Mon, 23 Nov 2015 20:38:49 +0000</resolved>
                                    <version>5.12.1</version>
                                    <fixVersion>5.13.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15022888" author="githubbot" created="Mon, 23 Nov 2015 20:11:16 +0000"  >&lt;p&gt;GitHub user czobrisky opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/159&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/159&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6058&quot; title=&quot;Certain VirtualTopic configurations send messages to the wrong queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6058&quot;&gt;&lt;del&gt;AMQ-6058&lt;/del&gt;&lt;/a&gt; added a check to make sure the destination starts with the v&#8230;&lt;/p&gt;

&lt;p&gt;    &#8230;irtual topic prefix.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/czobrisky/activemq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/czobrisky/activemq&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6058&quot; title=&quot;Certain VirtualTopic configurations send messages to the wrong queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6058&quot;&gt;&lt;del&gt;AMQ-6058&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/159.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/159.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #159&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit dca6e4506eab2c6f5752085e39dd3368ead4afed&lt;br/&gt;
Author: Chad Zobrisky &amp;lt;czobrisky@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-11-23T19:49:02Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6058&quot; title=&quot;Certain VirtualTopic configurations send messages to the wrong queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6058&quot;&gt;&lt;del&gt;AMQ-6058&lt;/del&gt;&lt;/a&gt; added a check to make sure the destination starts with the virtual topic prefix.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15022942" author="jira-bot" created="Mon, 23 Nov 2015 20:36:30 +0000"  >&lt;p&gt;Commit dca6e4506eab2c6f5752085e39dd3368ead4afed in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=czobrisky&quot; class=&quot;user-hover&quot; rel=&quot;czobrisky&quot;&gt;czobrisky&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=dca6e45&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=dca6e45&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6058&quot; title=&quot;Certain VirtualTopic configurations send messages to the wrong queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6058&quot;&gt;&lt;del&gt;AMQ-6058&lt;/del&gt;&lt;/a&gt; added a check to make sure the destination starts with the virtual topic prefix.&lt;/p&gt;</comment>
                            <comment id="15022943" author="jira-bot" created="Mon, 23 Nov 2015 20:36:31 +0000"  >&lt;p&gt;Commit bc9edf00d198634722e4e8a2699a285e6050c184 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=bc9edf0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=bc9edf0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6058&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6058&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Updating patch to make sure SelectorAwareVirtualTopics are covered&lt;br/&gt;
and code cleanup&lt;/p&gt;</comment>
                            <comment id="15022944" author="githubbot" created="Mon, 23 Nov 2015 20:36:42 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/159&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/159&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15022948" author="christopher.l.shannon" created="Mon, 23 Nov 2015 20:38:49 +0000"  >&lt;p&gt;Patch applied with thanks to Chad Zobrisky.&lt;/p&gt;</comment>
                            <comment id="15315292" author="jonathanmalek" created="Sat, 4 Jun 2016 03:17:25 +0000"  >&lt;p&gt;We have some brokers (5.11.1) configured with &lt;tt&gt;prefix=&quot;&amp;#42;.&amp;#42;.&quot;&lt;/tt&gt;.  After the upgrade to 5.13.3, I believe the change to shouldDispatch(...) is failing the destination name check, and the result is that messages are not being dispatched to the virtual topics.&lt;/p&gt;

&lt;p&gt;A naive (but working) option would be to change the shouldDispatch(...) from:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;return prefix.contains(&quot;.&amp;#42;&quot;) ? ...&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;to:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&lt;tt&gt;return prefix.contains(&quot;.&amp;#42;&quot;) &amp;amp;&amp;amp; !prefix.startsWith(&quot;&amp;#42;&quot;) ? ...&lt;/tt&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Which should satisfy both objectives: the original objective of &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6058&quot; title=&quot;Certain VirtualTopic configurations send messages to the wrong queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6058&quot;&gt;&lt;del&gt;AMQ-6058&lt;/del&gt;&lt;/a&gt;, and the need to support virtual topics whose prefix starts with a wildcard.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2otkn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>