<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:52:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3605] NullPointerException in TransportConnection</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3605</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I&apos;m running ActiveMQ 5.5.0 and clients using Net::Stomp 0.38_99 and I&apos;m seeing infrequent NullPointerExceptions in TransportConnection:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;ActiveMQ Connection Dispatcher: /172.31.201.11:50607&quot; java.lang.NullPointerException
        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:327)
        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:179)
        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)
        at org.apache.activemq.transport.stomp.StompTransportFilter.sendToActiveMQ(StompTransportFilter.java:81)
        at org.apache.activemq.transport.stomp.StompSubscription.onMessageDispatch(StompSubscription.java:79)
        at org.apache.activemq.transport.stomp.ProtocolConverter.onActiveMQCommand(ProtocolConverter.java:596)
        at org.apache.activemq.transport.stomp.StompTransportFilter.oneway(StompTransportFilter.java:58)
        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)
        at org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1270)
        at org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:815)
        at org.apache.activemq.broker.TransportConnection.iterate(TransportConnection.java:851)
        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:104)
        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:42)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This seems to happen 1-2 times per month or so but the result is dire: new messages aren&apos;t delivered to the affected client (you can see the number of pending messages increasing in the admin web interface) until the client or ActiveMQ is restarted.&lt;/p&gt;

&lt;p&gt;Relevant code snippet from TransportConnection.java,&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;326         if (context != null) {
327             if (context.isDontSendReponse()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;implies that we are dealing with a race condition. I&apos;m not familiar with the ActiveMQ code base but it looks like it grabs a lock (serviceLock) before entering that function, so not sure what&apos;s going on.&lt;/p&gt;

&lt;p&gt;Since there&apos;s no timestamp associated with the stack trace I&apos;m not completly sure what&apos;s going on on the client side. I&apos;ve tried to reproduce it by writing a small script that uses Net::Stomp in a similar way to my real clients, but no luck so far.&lt;/p&gt;

&lt;p&gt;No idea if it&apos;s relevant, but my affected clients have been both consuming and producing, and sending/receiving on both topics and queues.&lt;/p&gt;</description>
                <environment>&lt;p&gt;SLES 11 SP1&lt;br/&gt;
java version &quot;1.6.0_23&quot;&lt;br/&gt;
perl 5.10.0 + Net::Stomp 0.38_99&lt;/p&gt;</environment>
        <key id="12532462">AMQ-3605</key>
            <summary>NullPointerException in TransportConnection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="tomyl">Tommy Lindgren</reporter>
                        <labels>
                            <label>stomp</label>
                    </labels>
                <created>Wed, 23 Nov 2011 12:15:16 +0000</created>
                <updated>Tue, 13 Dec 2011 23:14:12 +0000</updated>
                            <resolved>Tue, 13 Dec 2011 23:14:12 +0000</resolved>
                                    <version>5.5.0</version>
                                    <fixVersion>5.6.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13155832" author="tomyl" created="Wed, 23 Nov 2011 12:23:10 +0000"  >&lt;p&gt;I haven&apos;t tried the trunk version yet, but I don&apos;t see any relevant changes in svn so figured I should ask here first.&lt;/p&gt;</comment>
                            <comment id="13155849" author="gtully" created="Wed, 23 Nov 2011 13:04:31 +0000"  >&lt;p&gt;please try trunk, if you reproduce it will provide a stack trace (line numbers) and context that matches trunk where it will be fixed.&lt;br/&gt;
The addition of an inactivity monitor for stomp 1.1 support has caused some tightening up of the synchronization between stomp and amq request paths, this may be relevant.&lt;/p&gt;

&lt;p&gt;Also please attach the broker log files, it may be contention between connection tear down and dispatch. In addition, if you can reproduce, add trace level logging to TransportConnection to gather some extra information.  &lt;/p&gt;</comment>
                            <comment id="13155870" author="tomyl" created="Wed, 23 Nov 2011 13:46:35 +0000"  >&lt;p&gt;Thanks for quick reply.&lt;/p&gt;

&lt;p&gt;I saved the stack trace above from the console output, I don&apos;t see it in my activemq.log. I do see some EOFExceptions for other clients in activemq.log around that time:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2011-11-21 17:26:58,051 | INFO  | Transport failed: java.io.EOFException | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ Transport: tcp:///172.31
.201.11:50680
2011-11-21 17:44:39,533 | INFO  | Transport failed: java.io.EOFException | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ Transport: tcp:///172.31
.201.11:46575
2011-11-21 18:30:38,362 | INFO  | Transport failed: java.io.EOFException | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ Transport: tcp:///172.31
.201.11:46577
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the NullPointerException occured shortly after 17:44. As far as I can tell, EOFExceptions are normal for stomp clients in 5.5.0, and I don&apos;t see it for affected clients anyway.&lt;/p&gt;

&lt;p&gt;I&apos;ll try a trunk snapshot.&lt;/p&gt;</comment>
                            <comment id="13155943" author="tabish121" created="Wed, 23 Nov 2011 16:18:13 +0000"  >&lt;p&gt;I&apos;ve started looking into this a bit and while I haven&apos;t been able to reproduce the NullPointerException I can cause a different exception that seems to be related.  The error seems to be coming from the auto ack of a message that&apos;s being dispatched as the connection is closed or broker on the client side.  This happens more often with a large prefetch such that the broker is busy dispatching messages when the disconnect comes in.&lt;/p&gt;

&lt;p&gt;Attaching the test case I have so far as I will be out over thanksgiving.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2011-11-23 10:20:42,152 [127.0.0.1:57419] - WARN  Service                        - Async error occurred: java.lang.IllegalStateException: Cannot lookup a consumer from a connection that had not been registered: ID:OfficePC-40536-1322061638124-3:1
java.lang.IllegalStateException: Cannot lookup a consumer from a connection that had not been registered: ID:OfficePC-40536-1322061638124-3:1
	at org.apache.activemq.broker.SingleTransportConnectionStateRegister.lookupConnectionState(SingleTransportConnectionStateRegister.java:83)
	at org.apache.activemq.broker.TransportConnection.lookupConnectionState(TransportConnection.java:1434)
	at org.apache.activemq.broker.TransportConnection.getConsumerBrokerExchange(TransportConnection.java:1348)
	at org.apache.activemq.broker.TransportConnection.processMessageAck(TransportConnection.java:476)
	at org.apache.activemq.command.MessageAck.visit(MessageAck.java:229)
	at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:318)
	at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:181)
	at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:45)
	at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:229)
	at org.apache.activemq.transport.stomp.StompTransportFilter.sendToActiveMQ(StompTransportFilter.java:87)
	at org.apache.activemq.transport.stomp.StompSubscription.onMessageDispatch(StompSubscription.java:78)
	at org.apache.activemq.transport.stomp.ProtocolConverter.onActiveMQCommand(ProtocolConverter.java:746)
	at org.apache.activemq.transport.stomp.StompTransportFilter.oneway(StompTransportFilter.java:64)
	at org.apache.activemq.transport.AbstractInactivityMonitor.doOnewaySend(AbstractInactivityMonitor.java:262)
	at org.apache.activemq.transport.AbstractInactivityMonitor.oneway(AbstractInactivityMonitor.java:244)
	at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:68)
	at org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1281)
	at org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:830)
	at org.apache.activemq.broker.TransportConnection.iterate(TransportConnection.java:866)
	at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)
	at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13156035" author="tabish121" created="Wed, 23 Nov 2011 18:29:10 +0000"  >&lt;p&gt;For the error I was able to reproduce the problem comes from a race between the processDispatch in TransportConnection&apos;s iterate method and the processRemoveConnection method where is does:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; TransportConnectionState state = unregisterConnectionState(id);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since the connection is removed right before the processDispatch males the loop from the Stomp transport&apos;s auto ack of the dispatched message we end up with the above error.  The NPE that the reporter has seen is probably related to something similar.  &lt;/p&gt;</comment>
                            <comment id="13160020" author="tabish121" created="Wed, 30 Nov 2011 13:05:40 +0000"  >&lt;p&gt;Patch the seems to resolve the issue,&lt;/p&gt;</comment>
                            <comment id="13160021" author="tabish121" created="Wed, 30 Nov 2011 13:07:21 +0000"  >&lt;p&gt;Updated test case, not really meant for inclusion as it doesn&apos;t actually assert anything to show the exceptions but at least allows them to be seen.  Can fail as the disconnect response isn&apos;t always read fast enough due to all the prefetched messages.&lt;/p&gt;</comment>
                            <comment id="13160023" author="tabish121" created="Wed, 30 Nov 2011 13:08:55 +0000"  >&lt;p&gt;Added a tentative patch to the TransportConnection class.  Seems to resolve the issue but I was seeing some failures in some unit tests locally and haven&apos;t fully resolved if they are related to this change or just the normal flaky tests we see fail sometimes.  Most failures seem to be in the Network bridge areas.&lt;/p&gt;</comment>
                            <comment id="13167478" author="tomyl" created="Mon, 12 Dec 2011 12:50:44 +0000"  >&lt;p&gt;I&apos;ve done some testing against 5.6-SNAPSHOT (as of 2011-11-23). I don&apos;t see the NPE anymore but clients closing the socket in an unclean fashion seems to still be a problem. &lt;/p&gt;

&lt;p&gt;It looks like my affected client now hangs on the SEND call. I can reproduce this problem within minutes by stressing my clients while a script repeatedly forks, connects to AMQ, subscribes to a topic and then calls _exit() (to make sure the socket isn&apos;t closed by the garbage collector).&lt;/p&gt;

&lt;p&gt;The resulting AMQ log is 200MB+ and may contain sensitive information, so I can&apos;t attach it as it is. Just before the client hangs I see (log excerpts slightly edited, message bodies and headers are removed):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2011-12-12 10:56:21,776 | TRACE | Received: 
SEND
[...]

2011-12-12 10:56:21,776 | DEBUG | message is ActiveMQTextMessage {commandId = 2262, responseRequired = false, messageId = ID:dev01-54928-1323379526715-4:15980:-1:1:
2254, originalDestination = null, originalTransactionId = null, producerId = ID:dev01-54928-1323379526715-4:15980:-1:1, destination = topic://change.TRANSFER, trans
actionId = null, expiration = 0, timestamp = 1323683781775, arrival = 0, brokerInTime = 1323683781775, brokerOutTime = 1323683781775, correlationId = null, replyTo = n
ull, persistent = false, type = EVENT.ResourceChangeEvent, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null,
 content = null, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 1507, properties = {[...]}, readOnlyProperties = true, readO
nlyBody = true, droppable = false, text = &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
&amp;lt;atom:...atom:entry&amp;gt;
}
2011-12-12 10:56:21,776 | DEBUG | Message available, but continuation is already resumed.  Buffer for next time.
2011-12-12 10:56:21,776 | DEBUG | Transport failed: java.io.EOFException
java.io.EOFException
        at java.io.DataInputStream.readByte(DataInputStream.java:250)
        at org.apache.activemq.transport.stomp.StompWireFormat.readHeaderLine(StompWireFormat.java:155)
        at org.apache.activemq.transport.stomp.StompWireFormat.readLine(StompWireFormat.java:148)
        at org.apache.activemq.transport.stomp.StompWireFormat.parseAction(StompWireFormat.java:170)
        at org.apache.activemq.transport.stomp.StompWireFormat.unmarshal(StompWireFormat.java:98)
        at org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:229)
        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:221)
        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:204)
        at java.lang.Thread.run(Thread.java:662)
2011-12-12 10:56:21,776 | DEBUG | message for ActiveMQMessageConsumer { value=ID:dev01-54928-1323379526715-8:58:1:1, started=true } continuation=org.eclipse.jetty.s
erver.AsyncContinuation@e9b412d@IDLE,initial
2011-12-12 10:56:21,776 | DEBUG | message for ActiveMQMessageConsumer { value=ID:dev01-54928-1323379526715-8:57:1:1, started=true } continuation=org.eclipse.jetty.s
erver.AsyncContinuation@50afeae@IDLE,initial
2011-12-12 10:56:21,776 | TRACE | org.apache.activemq.broker.region.cursors.QueueStorePrefetch@73a2335d:daemon.archived,batchResetNeeded=false,storeHasMessages=true,si
ze=0,cacheEnabled=true - fillBatch
2011-12-12 10:56:21,777 | TRACE | ID:dev01-54928-1323379526715-8:58:1:1 received message: MessageDispatch {commandId = 391, responseRequired = false, consumerId = I
D:dev01-54928-1323379526715-8:58:1:1, destination = topic://change.TRANSFER, message = ActiveMQTextMessage {commandId = 2262, responseRequired = false, messageId = 
ID:dev01-54928-1323379526715-4:15980:-1:1:2254, originalDestination = null, originalTransactionId = null, producerId = ID:dev01-54928-1323379526715-4:15980:-1:1,
 destination = topic://change.TRANSFER, transactionId = null, expiration = 0, timestamp = 1323683781775, arrival = 0, brokerInTime = 1323683781775, brokerOutTime = 132
3683781775, correlationId = null, replyTo = null, persistent = false, type = EVENT.ResourceChangeEvent, priority = 4, groupID = null, groupSequence = 0, targetConsumer
Id = null, compressed = false, userID = null, content = null, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 1507, properties = {[...]},
readOnlyProperties = true, readOnlyBody = true, droppable = false, text = &amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;
&amp;lt;atom:...atom:entry&amp;gt;
}, redeliveryCounter = 0}
2011-12-12 10:56:21,776 | DEBUG | Transport failed: java.net.SocketException: Broken pipe
java.net.SocketException: Broken pipe
        at java.net.SocketOutputStream.socketWrite0(Native Method)
        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)
        at java.net.SocketOutputStream.write(SocketOutputStream.java:136)
        at org.apache.activemq.transport.tcp.TcpBufferedOutputStream.flush(TcpBufferedOutputStream.java:115)
        at java.io.DataOutputStream.flush(DataOutputStream.java:106)
        at org.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:184)
        at org.apache.activemq.transport.stomp.StompTransportFilter.sendToStomp(StompTransportFilter.java:97)
        at org.apache.activemq.transport.stomp.StompSubscription.onMessageDispatch(StompSubscription.java:99)
        at org.apache.activemq.transport.stomp.ProtocolConverter.onActiveMQCommand(ProtocolConverter.java:746)
        at org.apache.activemq.transport.stomp.StompTransportFilter.oneway(StompTransportFilter.java:64)
        at org.apache.activemq.transport.AbstractInactivityMonitor.doOnewaySend(AbstractInactivityMonitor.java:262)
        at org.apache.activemq.transport.AbstractInactivityMonitor.oneway(AbstractInactivityMonitor.java:244)
        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:68)
        at org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1281)
        at org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:830)
        at org.apache.activemq.broker.TransportConnection.iterate(TransportConnection.java:866)
        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)
        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &quot;Received: SEND&quot; message is from my affected client. I see a bunch of such messages after the SocketException before the client hangs two seconds later. I assume the client hangs because some buffer at some level is full. I can&apos;t see anything obvious explaining why AMQ stops processing the client&apos;s messages.&lt;/p&gt;

&lt;p&gt;Occasionally I also see the following exception:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.IllegalStateException: Cannot lookup a producer from a connection that had not been registered: ID:dev01-54928-1323379526715-4:59
        at org.apache.activemq.broker.SingleTransportConnectionStateRegister.lookupConnectionState(SingleTransportConnectionStateRegister.java:93)
        at org.apache.activemq.broker.TransportConnection.lookupConnectionState(TransportConnection.java:1438)
        at org.apache.activemq.broker.TransportConnection.getProducerBrokerExchange(TransportConnection.java:1314)
        at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:468)
        at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:681)
        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:318)
        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:181)
        at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:45)
        at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:229)
        at org.apache.activemq.transport.stomp.StompTransportFilter.sendToActiveMQ(StompTransportFilter.java:87)
        at org.apache.activemq.transport.stomp.ProtocolConverter.sendToActiveMQ(ProtocolConverter.java:166)
        at org.apache.activemq.transport.stomp.ProtocolConverter.onStompSend(ProtocolConverter.java:292)
        at org.apache.activemq.transport.stomp.ProtocolConverter.onStompCommand(ProtocolConverter.java:204)
        at org.apache.activemq.transport.stomp.StompTransportFilter.onCommand(StompTransportFilter.java:76)
        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)
        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:222)
        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:204)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This exception is triggered more often when I do the stress test but sometimes it doesn&apos;t appear to have been thrown at all when the client has hanged.&lt;/p&gt;

&lt;p&gt;Not sure how useful these log excerpts are. I haven&apos;t tested the attached patch yet. If you think it will help I can try to build AMQ myself.&lt;/p&gt;
</comment>
                            <comment id="13167609" author="tomyl" created="Mon, 12 Dec 2011 17:24:02 +0000"  >&lt;p&gt;I went ahead and tested the patch. It didn&apos;t apply cleanly, but the rejected hunks were only change of for-loop constructs, so I ignored those.&lt;/p&gt;

&lt;p&gt;The patch didn&apos;t solve the issue. Perhaps not related but at 17:54:01 I see a SocketException, and at 17:54:05 there&apos;s an InactivityIOException (my client hanged at 17:54:13):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2011-12-12 17:54:05,045 | TRACE | Received:
SEND
[...]

2011-12-12 17:54:05,043 | DEBUG | Transport failed: org.apache.activemq.transport.InactivityIOException: Cannot send, channel has already failed: tcp://172.31.201.1:45
974
org.apache.activemq.transport.InactivityIOException: Cannot send, channel has already failed: tcp://172.31.201.1:45974
        at org.apache.activemq.transport.AbstractInactivityMonitor.doOnewaySend(AbstractInactivityMonitor.java:255)
        at org.apache.activemq.transport.AbstractInactivityMonitor.oneway(AbstractInactivityMonitor.java:244)
        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:68)
        at org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1268)
        at org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:804)
        at org.apache.activemq.broker.TransportConnection.iterate(TransportConnection.java:839)
        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)
        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The SEND message is from the affected client.&lt;/p&gt;

&lt;p&gt;Are there any particular messages I should look for? Or do you have any suggestions on where to put extra LOG.debug calls?&lt;/p&gt;</comment>
                            <comment id="13167667" author="tabish121" created="Mon, 12 Dec 2011 18:47:20 +0000"  >&lt;p&gt;Depends somewhat on what branch of code you applied this to.  It should be applied to trunk and not a 5.5.x branch.  Testing here shows no issues of this sort so far.&lt;/p&gt;
</comment>
                            <comment id="13167671" author="tomyl" created="Mon, 12 Dec 2011 18:52:59 +0000"  >&lt;p&gt;The patch was applied to trunk (checkout from today, r1213236).&lt;/p&gt;</comment>
                            <comment id="13167710" author="tabish121" created="Mon, 12 Dec 2011 19:43:23 +0000"  >&lt;p&gt;From the little bit of info provided I don&apos;t see an issue here as it looks as though the client was disconnected due to inactivity.  The debug log seems fine as it indicates that the send to the client fails because it was dropped.  You didn&apos;t get any NullPointerExceptions correct?&lt;/p&gt;</comment>
                            <comment id="13167774" author="tomyl" created="Mon, 12 Dec 2011 20:35:25 +0000"  >&lt;p&gt;No NullPointerExceptions with 4.6-SNAPSHOT/trunk, that is correct.&lt;/p&gt;

&lt;p&gt;According to the &quot;Connections&quot; admin web page (and netstat), the affected client is still connected to AMQ. I assume all or most EOFExceptions, SocketExceptions and InactivityIOException are from my fork/connect/subscribe/exit script.&lt;/p&gt;</comment>
                            <comment id="13168838" author="tabish121" created="Tue, 13 Dec 2011 23:14:12 +0000"  >&lt;p&gt;Fix applied in trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12505618" name="AMQ-3605-Patch.txt" size="6318" author="tabish" created="Wed, 30 Nov 2011 13:05:40 +0000"/>
                            <attachment id="12505619" name="StompDedicatedTaskRunnerTests.java" size="7280" author="tabish" created="Wed, 30 Nov 2011 13:07:21 +0000"/>
                            <attachment id="12504890" name="StompDedicatedTaskRunnerTests.java" size="4736" author="tabish" created="Wed, 23 Nov 2011 16:18:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>218195</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0aiiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59274</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>