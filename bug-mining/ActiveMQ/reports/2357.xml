<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:05:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5295] HTTPS Network Connector doesn&apos;t work with Mutual authentication- HTTPSClientTransport uses wrong SSLSocketFactory</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5295</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;HttpsClientTransport is getting wrong SSLSocketFactory.&lt;/p&gt;

&lt;p&gt;The problem is here:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; SchemeRegistry createSchemeRegistry() {

        SchemeRegistry schemeRegistry = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SchemeRegistry();
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-comment&quot;&gt;// register the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; socket factory so that it looks at the javax.net.ssl.keyStore,
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// javax.net.ssl.trustStore, etc, properties by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
&lt;/span&gt;            SSLSocketFactory sslSocketFactory =
                    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SSLSocketFactory((javax.net.ssl.SSLSocketFactory) javax.net.ssl.SSLSocketFactory.getDefault(),
                    SSLSocketFactory.BROWSER_COMPATIBLE_HOSTNAME_VERIFIER);
            schemeRegistry.register(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Scheme(&lt;span class=&quot;code-quote&quot;&gt;&quot;https&quot;&lt;/span&gt;, getRemoteUrl().getPort(), sslSocketFactory));
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; schemeRegistry;
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failure trying to create scheme registry&quot;&lt;/span&gt;, e);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem with that code is, that it never take SSLSocketFactory from spring context. So the one defined in XML is ignored.&lt;/p&gt;

&lt;p&gt;So it&apos;s code have to be replaced with:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; SchemeRegistry createSchemeRegistry() {

        SchemeRegistry schemeRegistry = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SchemeRegistry();
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            &lt;span class=&quot;code-comment&quot;&gt;// register the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; socket factory so that it looks at the javax.net.ssl.keyStore,
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// javax.net.ssl.trustStore, etc, properties by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
&lt;/span&gt;            SSLSocketFactory sslSocketFactory = createSocketFactory();
            schemeRegistry.register(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Scheme(&lt;span class=&quot;code-quote&quot;&gt;&quot;https&quot;&lt;/span&gt;, getRemoteUrl().getPort(), sslSocketFactory));
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; schemeRegistry;
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failure trying to create scheme registry&quot;&lt;/span&gt;, e);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And then new method should be added:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    /**
     * Creates a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SSL SocketFactory. The given factory will use user-provided
     * key and trust managers (&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the user provided them).
     *
     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Newly created (Ssl)SocketFactory.
     * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
     */
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; SocketFactory createSocketFactory() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (SslContext.getCurrentSslContext() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            SslContext ctx = SslContext.getCurrentSslContext();
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ctx.getSSLContext().getSocketFactory();
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
                &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; IOExceptionSupport.create(e);
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; SSLSocketFactory.getDefault();
        }

    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is consistent solution with other transports.&lt;/p&gt;

&lt;p&gt;I will prepare patches and tests for this scenerio.&lt;/p&gt;

&lt;p&gt;Greetings&lt;br/&gt;
Piotr Klimczak&lt;/p&gt;</description>
                <environment>&lt;p&gt;JBoss Fuse 6.1&lt;/p&gt;</environment>
        <key id="12730591">AMQ-5295</key>
            <summary>HTTPS Network Connector doesn&apos;t work with Mutual authentication- HTTPSClientTransport uses wrong SSLSocketFactory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nannou9">Piotr Klimczak</reporter>
                        <labels>
                            <label>SSL</label>
                            <label>TLS</label>
                            <label>mutualSSL</label>
                    </labels>
                <created>Tue, 29 Jul 2014 20:04:15 +0000</created>
                <updated>Wed, 11 Feb 2015 10:43:39 +0000</updated>
                            <resolved>Wed, 13 Aug 2014 16:45:02 +0000</resolved>
                                    <version>5.9.0</version>
                                    <fixVersion>5.10.1</fixVersion>
                    <fixVersion>5.11.0</fixVersion>
                                    <component>Connector</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="57600">16h</timeoriginalestimate>
                            <timeestimate seconds="57600">16h</timeestimate>
                                        <comments>
                            <comment id="14079100" author="nannou9" created="Wed, 30 Jul 2014 09:24:35 +0000"  >&lt;p&gt;It looks like it is not the only problem with mutual authentication functionality.&lt;br/&gt;
Once SSLSocketFactory is ok, then NullPointerExceptions occurs.&lt;br/&gt;
Debugging...&lt;/p&gt;</comment>
                            <comment id="14079137" author="nannou9" created="Wed, 30 Jul 2014 10:10:02 +0000"  >&lt;p&gt;I&apos;ve just hit a logging bug.&lt;br/&gt;
When certificate is not trusted, then real reason is not thrown.&lt;br/&gt;
It is also not logged unless debug is enabled.&lt;br/&gt;
And then code fails with NPE in much different part of code not pointing to the real cause of problem.&lt;br/&gt;
When problems with keys from SSL security point of view was solved, everything started to work.&lt;/p&gt;

&lt;p&gt;So now working on patches.&lt;/p&gt;</comment>
                            <comment id="14086450" author="githubbot" created="Tue, 5 Aug 2014 16:15:16 +0000"  >&lt;p&gt;GitHub user PiotrKlimczak opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/40&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/40&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5295&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5295&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    HTTPS Network Connector doesn&apos;t work with Mutual authentication- HTTPSClientTransport uses wrong SSLSocketFactory&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/PiotrKlimczak/activemq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/PiotrKlimczak/activemq&lt;/a&gt; trunk&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/40.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/40.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #40&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8a56a40ab8494740cc05b50d848a3be65e8b2ff5&lt;br/&gt;
Author: PiotrKlimczak &amp;lt;nannou9@gmail.com&amp;gt;&lt;br/&gt;
Date:   2014-08-05T16:09:52Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5295&quot; title=&quot;HTTPS Network Connector doesn&amp;#39;t work with Mutual authentication- HTTPSClientTransport uses wrong SSLSocketFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5295&quot;&gt;&lt;del&gt;AMQ-5295&lt;/del&gt;&lt;/a&gt; HTTPS Network Connector doesn&apos;t work with Mutual&lt;br/&gt;
    authentication- HTTPSClientTransport uses wrong SSLSocketFactory&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14086454" author="nannou9" created="Tue, 5 Aug 2014 16:17:21 +0000"  >&lt;p&gt;Pull request created:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/activemq/pull/40&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/40&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Patch submitted on behalf of WM Promus by Piotr Klimczak&lt;/p&gt;</comment>
                            <comment id="14087906" author="githubbot" created="Wed, 6 Aug 2014 17:06:09 +0000"  >&lt;p&gt;GitHub user PiotrKlimczak opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/42&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/42&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5295&quot; title=&quot;HTTPS Network Connector doesn&amp;#39;t work with Mutual authentication- HTTPSClientTransport uses wrong SSLSocketFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5295&quot;&gt;&lt;del&gt;AMQ-5295&lt;/del&gt;&lt;/a&gt; HTTPS Network Connector doesn&apos;t work with Mutual&lt;/p&gt;

&lt;p&gt;    authentication- HTTPSClientTransport uses wrong SSLSocketFactory&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/PiotrKlimczak/activemq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/PiotrKlimczak/activemq&lt;/a&gt; trunk-5295&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/42.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/42.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #42&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 8a56a40ab8494740cc05b50d848a3be65e8b2ff5&lt;br/&gt;
Author: PiotrKlimczak &amp;lt;nannou9@gmail.com&amp;gt;&lt;br/&gt;
Date:   2014-08-05T16:09:52Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5295&quot; title=&quot;HTTPS Network Connector doesn&amp;#39;t work with Mutual authentication- HTTPSClientTransport uses wrong SSLSocketFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5295&quot;&gt;&lt;del&gt;AMQ-5295&lt;/del&gt;&lt;/a&gt; HTTPS Network Connector doesn&apos;t work with Mutual&lt;br/&gt;
    authentication- HTTPSClientTransport uses wrong SSLSocketFactory&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14087907" author="githubbot" created="Wed, 6 Aug 2014 17:07:11 +0000"  >&lt;p&gt;Github user PiotrKlimczak closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/40&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/40&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14095684" author="tabish121" created="Wed, 13 Aug 2014 16:45:02 +0000"  >&lt;p&gt;Patch applied, thanks.&lt;/p&gt;</comment>
                            <comment id="14315996" author="githubbot" created="Wed, 11 Feb 2015 10:43:39 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/42&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/42&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>408664</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ybef:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>408662</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>