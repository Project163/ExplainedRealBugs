<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:42:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1763] Acknowledgment of Messages consumed from VirtualTopic consumer queues fails</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1763</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;The Message Broker throws an exception each time a client tries to acknowledge a message consumed from a  VirtualTopic consumer queue:&lt;/p&gt;

&lt;p&gt;ERROR Service                        - Async error occurred: java.lang.IllegalArgumentException: The subscription does not exist: ID:seautpc271-1314-1212495185267-0:0:1:1&lt;br/&gt;
java.lang.IllegalArgumentException: The subscription does not exist: ID:seautpc271-1314-1212495185267-0:0:1:1&lt;br/&gt;
        at org.apache.activemq.broker.region.AbstractRegion.acknowledge(AbstractRegion.java:357)&lt;br/&gt;
        at org.apache.activemq.broker.region.RegionBroker.acknowledge(RegionBroker.java:470)&lt;br/&gt;
        at org.apache.activemq.broker.TransactionBroker.acknowledge(TransactionBroker.java:194)&lt;br/&gt;
        at org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:73)&lt;br/&gt;
        at org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:73)&lt;br/&gt;
        at org.apache.activemq.broker.MutableBrokerFilter.acknowledge(MutableBrokerFilter.java:84)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.processMessageAck(TransportConnection.java:443)&lt;br/&gt;
        at org.apache.activemq.command.MessageAck.visit(MessageAck.java:196)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:292)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:180)&lt;br/&gt;
        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)&lt;br/&gt;
        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:143)&lt;br/&gt;
        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:206)&lt;br/&gt;
        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:196)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:183)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;Consequently the message gets re-delivered as soon as the client connects to the queue again (and fails again on aknowledgement). Strangely enough the subscription mentioned in the exception is visible in the JMX console. I can reproduce this error every time I try to consume from VirtualTopic consumer queues.&lt;br/&gt;
I have attached the broker configuration (which is rather minimal) and the test classes I used to trigger this error.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows XP, Java(TM) SE Runtime Environment (build 1.6.0_06-b02)&lt;/p&gt;</environment>
        <key id="12483310">AMQ-1763</key>
            <summary>Acknowledgment of Messages consumed from VirtualTopic consumer queues fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kpodloucky">Konrad Podloucky</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Jun 2008 12:31:30 +0000</created>
                <updated>Fri, 8 Jul 2011 21:28:36 +0000</updated>
                            <resolved>Fri, 8 Jul 2011 21:28:36 +0000</resolved>
                                    <version>5.1.0</version>
                                    <fixVersion>NEEDS_REVIEW</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>11</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="12939840" author="kpodloucky" created="Tue, 17 Jun 2008 11:40:32 +0000"  >&lt;p&gt;Just verified this problem with the broker running on Java(TM) SE Runtime Environment 1.6.0_06 (Sun) on SuSE Enterprise Linux.&lt;/p&gt;</comment>
                            <comment id="12940659" author="tmccubbin" created="Fri, 23 Jan 2009 00:30:21 +0000"  >&lt;p&gt;Can I do anything to help this issue along...I am experiencing the same problem and I would be happy to dig in and do some fixin&apos;...&lt;/p&gt;</comment>
                            <comment id="12941657" author="magellings" created="Tue, 30 Jun 2009 13:32:24 +0000"  >&lt;p&gt;Any reason why this issue can&apos;t get resolved in version 5.3?  Virtual Topics are a documented feature of ActiveMQ.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://activemq.apache.org/virtual-destinations.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/virtual-destinations.html&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;The broker receives the same error with a transactional session on commit.  Here&apos;s a thread further discussing the problem:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.nabble.com/uses-virtual-topic---and-ClientAcknowledge-to-submit-the-message-occured-probem-ts22486742.html#a24260251&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.nabble.com/uses-virtual-topic---and-ClientAcknowledge-to-submit-the-message-occured-probem-ts22486742.html#a24260251&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12941650" author="gtully" created="Wed, 1 Jul 2009 09:29:11 +0000"  >&lt;p&gt;There is an existing test case on trunk VirtualTopicPubSubTest  - &lt;a href=&quot;http://svn.apache.org/viewvc/activemq/trunk/activemq-core/src/test/java/org/apache/activemq/broker/virtual/VirtualTopicPubSubTest.java?view=annotate&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/activemq/trunk/activemq-core/src/test/java/org/apache/activemq/broker/virtual/VirtualTopicPubSubTest.java?view=annotate&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I modified it to use client ack but it does not show the behavior above. &lt;/p&gt;

&lt;p&gt;If that test (or one like) could be extended or replicated to show the problem it would speed up the process of getting a resolution.&lt;/p&gt;</comment>
                            <comment id="12941680" author="magellings" created="Wed, 1 Jul 2009 16:26:58 +0000"  >&lt;p&gt;patch to apply to test class to try and replicate message redelivery problem with virtual topics.&lt;/p&gt;</comment>
                            <comment id="12941678" author="magellings" created="Wed, 1 Jul 2009 16:27:46 +0000"  >&lt;p&gt;Thanks for you effort and quick response to this Gary.&lt;/p&gt;

&lt;p&gt;The reason the above test may be passing is because you are using the same connection when instantiating the consumers.&lt;/p&gt;

&lt;p&gt;The issue is when a subsequent connection is made (or consumer is disposed) the messages get redelivered.  They do not get redelivered on the same connection.  The broker just spits out the error as mentioned in the original post of the reporter.  The next connection the broker redelivers the same messages.  The pattern repeats.&lt;/p&gt;

&lt;p&gt;As you suggested, I&apos;ve attached a patch (testPatch.patch) to extend this test and ConsumerBean to try and replicate the issue.  &lt;/p&gt;

&lt;p&gt;I&apos;m a .NET programmer so I have replicated the problem with ActiveMQ NMS similar to how the patch does.  So forgive me if there are any syntactical errors in the java code.  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  The logic should be correct though and hopefully we can trigger the error.&lt;/p&gt;

&lt;p&gt;If we can trigger it, fix it, and bump this issue to 5.3 that would be great!  &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Please keep me informed on how it goes.&lt;/p&gt;

&lt;p&gt;PS Also note the reporter attached the broker configuration and the test classes he used to trigger this error.&lt;/p&gt;
</comment>
                            <comment id="12941718" author="gtully" created="Wed, 8 Jul 2009 16:43:26 +0000"  >&lt;p&gt;mark, i applied ur changes and refactored a bit more to use separate connections for each consumer, but to no avail. the test still works. Cannot do much with this till we get a failing test case. I cannot see any real difference between the test classes from the original reporter and the current test case on trunk.&lt;br/&gt;
latest test is in r792220&lt;/p&gt;</comment>
                            <comment id="12941713" author="cejones" created="Wed, 8 Jul 2009 16:46:07 +0000"  >&lt;p&gt;I am out of the office until Thursday, July 9th. Please call the reference line at 414-566-6740 if you need immediate assistance.&lt;/p&gt;</comment>
                            <comment id="12941725" author="magellings" created="Wed, 8 Jul 2009 18:30:07 +0000"  >&lt;p&gt;Your auto-reply somehow got added as a comment to this JIRA issue.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/activemq/browse/AMQ-1763?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=52743#action_52743&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/activemq/browse/AMQ-1763?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=52743#action_52743&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;Weird...&lt;/p&gt;


</comment>
                            <comment id="12941730" author="magellings" created="Wed, 8 Jul 2009 19:00:48 +0000"  >&lt;p&gt;Hey Gary.&lt;/p&gt;

&lt;p&gt;Thanks for helping out on this issue.  I looked at your code and it looks like it should be replicating the problem and failing.&lt;/p&gt;

&lt;p&gt;Since it isn&apos;t, do you think you could try running the code the reporter attached.  I&apos;m thinking if you run the producer once and then the consumer messages will come through as expected.  Then if you stop and run the consumer a second time the same messages will be redelivered.  This forsurely replicates the problem when using the ActiveMQ NMS framework.&lt;/p&gt;

&lt;p&gt;If you could do this that would be great because maybe we are missing something in the unit test.&lt;/p&gt;

&lt;p&gt;I think if you run the reporters producer/consumer and everything works correctly then it&apos;s safe to assume this is an issue with the ActiveMQ NMS framework.&lt;/p&gt;

&lt;p&gt;-Regards&lt;/p&gt;

&lt;p&gt;PS Sorry about the previous comments.  Looks like auto-reply can be a nuisance.  Especially if you aren&apos;t aware of it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461089" name="ASF.LICENSE.NOT.GRANTED--TestConsumer.java" size="1584" author="kpodloucky" created="Tue, 3 Jun 2008 12:31:30 +0000"/>
                            <attachment id="12461140" name="ASF.LICENSE.NOT.GRANTED--TestProducer.java" size="1076" author="kpodloucky" created="Tue, 3 Jun 2008 12:31:30 +0000"/>
                            <attachment id="12461041" name="ASF.LICENSE.NOT.GRANTED--test.xml" size="2379" author="kpodloucky" created="Tue, 3 Jun 2008 12:31:30 +0000"/>
                            <attachment id="12461552" name="testPatch.patch" size="4119" author="magellings" created="Wed, 1 Jul 2009 16:26:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>68691</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 20 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0alyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59831</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>