<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:46:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2125] javax.jms.JMSException: Could not correlate acknowledgment with dispatched message thrown on failover</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2125</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When failing over to a new broker we see this exception. Although the exception is thrown no messages seem to be lost.&lt;/p&gt;

&lt;p&gt;This can be reproduced using the following unit test and this setup:&lt;br/&gt;
1. Create two activemq&apos;s using the same datasource.&lt;br/&gt;
2. Run the test&lt;br/&gt;
3. Kill the first active mq before the test completes (after you see the first Recieved Message... in the system out)&lt;br/&gt;
4. See the exception thrown in the second activemq log&lt;/p&gt;

&lt;p&gt;import org.apache.activemq.ActiveMQConnectionFactory;&lt;/p&gt;

&lt;p&gt;import javax.jms.*;&lt;br/&gt;
import static javax.jms.Session.AUTO_ACKNOWLEDGE;&lt;br/&gt;
import static javax.jms.Session.SESSION_TRANSACTED;&lt;/p&gt;

&lt;p&gt;import junit.framework.TestCase;&lt;/p&gt;

&lt;p&gt;import java.util.concurrent.atomic.AtomicInteger;&lt;/p&gt;

&lt;p&gt;public class BrokerTest extends TestCase {&lt;/p&gt;

&lt;p&gt;    public void testFoo() throws Exception {&lt;br/&gt;
        ConnectionFactory connectionFactory = new ActiveMQConnectionFactory(&quot;failover:(tcp://localhost:61616,tcp://localhost:61617)&quot;);&lt;/p&gt;

&lt;p&gt;        Connection connection = connectionFactory.createConnection();&lt;br/&gt;
        connection.start();&lt;/p&gt;

&lt;p&gt;        Session producerSession = connection.createSession(false, AUTO_ACKNOWLEDGE);&lt;/p&gt;

&lt;p&gt;        MessageProducer producer = producerSession.createProducer(producerSession.createQueue(&quot;testQueue&quot;));&lt;/p&gt;

&lt;p&gt;        for (int i = 0; i &amp;lt; 100; i++) &lt;/p&gt;
{
            System.out.println(&quot;Sending messages&quot;);
            producer.send(producerSession.createTextMessage(&quot;Hello&quot;));
        }

&lt;p&gt;        final AtomicInteger atomicInteger = new AtomicInteger(0);&lt;/p&gt;

&lt;p&gt;        final Session consumerSession = connection.createSession(true, SESSION_TRANSACTED);&lt;br/&gt;
        MessageConsumer messageConsumer = consumerSession.createConsumer(consumerSession.createQueue(&quot;testQueue&quot;));&lt;br/&gt;
        messageConsumer.setMessageListener(new MessageListener() {&lt;/p&gt;



&lt;p&gt;            public void onMessage(Message message) {&lt;br/&gt;
                try &lt;/p&gt;
{
                    System.out.println(&quot;Received Message&quot; + message);
                    Thread.sleep(1000);
                    atomicInteger.addAndGet(1);
                    System.out.println(atomicInteger.get());
                    consumerSession.commit();
                }
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
                    throw new RuntimeException(&quot;Oh dear&quot;, e);
                }
&lt;p&gt;            }&lt;br/&gt;
        });&lt;/p&gt;

&lt;p&gt;        Thread.sleep(2 * 60 * 1000);&lt;/p&gt;

&lt;p&gt;        assertEquals(100, atomicInteger.get());&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;}&lt;/p&gt;
</description>
                <environment>&lt;p&gt;MacOS 10.5 and Solaris 10&lt;/p&gt;</environment>
        <key id="12482501">AMQ-2125</key>
            <summary>javax.jms.JMSException: Could not correlate acknowledgment with dispatched message thrown on failover</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="teamhiro">Team Hiro</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Feb 2009 12:17:32 +0000</created>
                <updated>Fri, 6 Aug 2010 14:31:48 +0000</updated>
                            <resolved>Fri, 6 Aug 2010 14:31:48 +0000</resolved>
                                    <version>5.2.0</version>
                                    <fixVersion>5.4.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12940816" author="gtully" created="Thu, 19 Feb 2009 15:28:44 +0000"  >&lt;p&gt;This exception is expected on failover if a transaction was in progress at the point of failover. &lt;br/&gt;
The failover transport on the client side has a state tracker for commands and transactions that have been sent so that it can recreate its state on the failover broker. In the case of a transaction commit that is out standing, the message acks will be replayed as part of the commit, the transaction will be replayed but the messages will not be present (as dispatched messages to a consumer ) on the failover broker, they will still be in the store as the original tx will have rolledback when the connection was dropped. These messages will be subsequently be redelivered. The exception occurs when the message corresponding to the ack cannot be found as pending in the broker but it can be safely ignored.&lt;/p&gt;

&lt;p&gt;Just to be sure this is what is occurring, is it possible to provide a log of both brokers with full logging enabled.&lt;/p&gt;</comment>
                            <comment id="12941831" author="fredrikj" created="Thu, 19 Nov 2009 08:36:28 +0000"  >&lt;p&gt;In activemq 5.2 and probably 5.3 this message is logged at loglevel ERROR. It would perhaps make sense to reduce it to loglevel WARN? From Gary&apos;s description it appears to be harmless when using failover connections.&lt;/p&gt;</comment>
                            <comment id="12939149" author="gtully" created="Fri, 6 Aug 2010 14:31:48 +0000"  >&lt;p&gt;log message at warn level in 5.4&lt;br/&gt;
r982990&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75064</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rq2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>159868</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>