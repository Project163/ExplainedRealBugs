<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:47:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2813] BrokerService @PostConstruct invalidates XBeanBrokerService w/ start=false</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2813</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;XBeanBrokerService#afterPropertiesSet() method checks the start flag and is annotated as @PostConstruct so it&apos;s called at startup&lt;/li&gt;
	&lt;li&gt;BrokerService#start() method has the @PostConstruct annotation as well&lt;/li&gt;
	&lt;li&gt;There is no way for the BrokerService class to check the &apos;start&apos; flag in the XBeanBrokerService subclass.&lt;/li&gt;
	&lt;li&gt;Spring will call BOTH @PostConstruct methods resulting in the broker being started regardless of the xbean start flag&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;According to Gary Tully:&lt;/p&gt;

&lt;p&gt;That looks like a bug that was introduced in&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?rev=908182&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=908182&amp;amp;view=rev&lt;/a&gt; the postConstruct on&lt;br/&gt;
the start method does invalidate the&lt;br/&gt;
XBeanBrokerService#afterPropertiesSet()  smarts. &lt;/p&gt;

&lt;p&gt;As discussed in:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://old.nabble.com/XBean-%27start%3Dfalse%27-not-working--td29086727.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://old.nabble.com/XBean-%27start%3Dfalse%27-not-working--td29086727.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12483489">AMQ-2813</key>
            <summary>BrokerService @PostConstruct invalidates XBeanBrokerService w/ start=false</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dejanb">Dejan Bosanac</assignee>
                                    <reporter username="dnawrocki">Dan Nawrocki</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Jul 2010 17:16:30 +0000</created>
                <updated>Mon, 6 Sep 2010 09:39:22 +0000</updated>
                            <resolved>Mon, 6 Sep 2010 09:39:22 +0000</resolved>
                                    <version>5.3.1</version>
                                    <fixVersion>5.4.1</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12939507" author="dejanb" created="Fri, 6 Aug 2010 16:04:33 +0000"  >&lt;p&gt;It seems that this works fine on the trunk. I just committed two tests that shows it works properly for both plain Spring and XBean.&lt;/p&gt;

&lt;p&gt;If you still see the problem, please reopen it and attach the test case.&lt;/p&gt;</comment>
                            <comment id="12942815" author="dnawrocki" created="Wed, 1 Sep 2010 17:21:56 +0000"  >&lt;p&gt;Still doesn&apos;t work as of AMQ 5.4.0.&lt;/p&gt;

&lt;p&gt;Let me explain what I&apos;m trying to do:&lt;br/&gt;
1) Shared file system master-slave using nfsv4&lt;br/&gt;
2) Broker instantiated by Spring&lt;/p&gt;

&lt;p&gt;The 1st AS will come up OK, but the 2nd (3rd, 4th, etc) AS will block indefinitely at org.apache.activemq.store.kahadb.MessageDatabase.lock(MessageDatabase.java:329).  Spring is calling the @PostConstruct method on BrokerService, which doesn&apos;t (cannot) check the XBeanBrokerService&apos;s &apos;start&apos; flag.&lt;/p&gt;

&lt;p&gt;Removal of the @PostConstruct annotation on BrokerService#start fixed the issue for 5.3.2, I haven&apos;t verified on 5.4.0.&lt;/p&gt;</comment>
                            <comment id="12942812" author="dnawrocki" created="Wed, 1 Sep 2010 20:44:30 +0000"  >&lt;p&gt;I can confirm that removing the @PostConstruct annotation work w/ 5.4.0 as well.&lt;/p&gt;

&lt;p&gt;I should also mention that the reason I am having so much trouble with this is because I am running my webapp under JBoss.  When JBoss attempts to deploy my EAR file, the &quot;main&quot; thread ends up calling BrokerService#start.  Because the &quot;main&quot; thread is not blocked indefinitely, JBoss is left in an inconsistent state and will never serve ANY http requests, and will not respond to a kill command.  I have to kill -9 the java process to get it to terminate.&lt;/p&gt;</comment>
                            <comment id="12942826" author="dejanb" created="Thu, 2 Sep 2010 08:18:56 +0000"  >&lt;p&gt;So should we resolve this issue again?&lt;/p&gt;</comment>
                            <comment id="12942841" author="dnawrocki" created="Fri, 3 Sep 2010 15:23:08 +0000"  >&lt;p&gt;Attached is a patch (generated with svn diff) that fixes it for my use case.  I don&apos;t think it will have any unintended consequences for users instantiating a BrokerService and not using the XBeanBrokerService.  If this makes it into 5.4.1 I&apos;d be happy to close this issue.&lt;/p&gt;</comment>
                            <comment id="12942849" author="dejanb" created="Mon, 6 Sep 2010 09:39:22 +0000"  >&lt;p&gt;Patch applied with svn revision 992984. Thanks Dan.&lt;/p&gt;

&lt;p&gt;The problem this missed in our tests was, because XBean+Spring combination doesn&apos;t call @PostConstruct on parent objects as it is done in EJB environment you&apos;re using.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12482859">AMQ-2601</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12461802" name="broker_startup_fix.patch" size="1500" author="dnawrocki" created="Fri, 3 Sep 2010 15:23:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14823</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ba4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63752</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>