<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:40:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1859] Race condition when browsing a queue with active Producers / Consumers</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1859</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Browsing a queue aggressively ( ie repeatedly with high frequency ) that is also experiencing message production and consumption results in some messages failing to be delivered to pre-registered consumers.  Messages are visible on the queue to new consumers, but not pre-existing ones.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a junit test case that show this behaviour.  Note that since this is a race condition, it manifests sporadically.  You may need to run the test a few times before it fails.&lt;/p&gt;

&lt;p&gt;The interesting bit is the method testProducerBrowserConsumer().  This sets up a couple of message producers, a message consumer, and a message browser on the same queue.  The producers send a known number of messages on the queue while the browsers creates a number of queue browsers and iterates through the contents.  The consumer pulls messages from the queue using a receive method set to time out after 30 sec.  Once the consumer exits, we start a cleanup consumer to process any remaining messages on the queue.  There should be zero messages outstanding.  This is often not the case.  I&apos;ve modified the test case, originally, we just asserted that we had received the sent number of messages.  I added the cleanup receiver to demonstrate that new consumers on the queue can see messages that pre-existing ones do not.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows XP Professional, SP2&lt;/p&gt;</environment>
        <key id="12482787">AMQ-1859</key>
            <summary>Race condition when browsing a queue with active Producers / Consumers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dejanb">Dejan Bosanac</assignee>
                                    <reporter username="aenache">Anthony Enache</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Jul 2008 19:11:08 +0000</created>
                <updated>Thu, 26 Feb 2009 16:40:59 +0000</updated>
                            <resolved>Thu, 26 Feb 2009 16:40:59 +0000</resolved>
                                    <version>5.1.0</version>
                                    <fixVersion>5.3.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12940595" author="dejanb" created="Mon, 22 Dec 2008 16:23:07 +0000"  >&lt;p&gt;Can you test this one against 5.2.0. It should be fixed. Thanks, Dejan&lt;/p&gt;</comment>
                            <comment id="12940833" author="aenache" created="Tue, 24 Feb 2009 14:24:59 +0000"  >&lt;p&gt;Hello Dejan,&lt;/p&gt;

&lt;p&gt;I&apos;ve tested this with the 5.1, 5.2, and the Feb. 17, 2009 5.3 snapshot.&lt;br/&gt;
They all failed, but in slightly different ways.  I&apos;ve modified the&lt;br/&gt;
QueueBrowserTest.java file to show this by changing the&lt;br/&gt;
testProducerBrowserConsumer() method as below.&lt;/p&gt;

&lt;p&gt;Previously, the method verified that &quot;Cleanup Receiver 1&quot; did not see any&lt;br/&gt;
messages on the queue.  In 5.1 and 5.2 this test would fail.  In 5.3 it now&lt;br/&gt;
passes.  However, in all versions, the number of sent messages does not&lt;br/&gt;
equal the number received.  I have added this assertion to the test and it&lt;br/&gt;
fails across the board.&lt;/p&gt;


&lt;p&gt;  public void testProducerBrowserConsumer() throws InterruptedException,&lt;br/&gt;
JMSException&lt;/p&gt;
  {
    int      count     = 1000;
    Producer producer1 = new Producer(&quot;Producer 1&quot;, count / 2);
    Producer producer2 = new Producer(&quot;Producer 2&quot;, count / 2);
    Browser  browser   = new Browser(&quot;Browser 1&quot;);
    Receiver receiver  = new Receiver(&quot;Receiver 1&quot;);

    browser.start();
    receiver.start();
    producer1.start();
    producer2.start();
    receiver.join();
    browser.finish();

    int received = receiver.getCount();

    System.out.println(&quot;Received &quot; + received + &quot; of &quot; + count + &quot;.&quot;);

    receiver  = new Receiver(&quot;Cleanup Receiver 1&quot;);
    receiver.start();
    receiver.join();

    assertEquals(0, receiver.getCount());
    assertEquals(count, received);
  }

</comment>
                            <comment id="12940820" author="dejanb" created="Tue, 24 Feb 2009 14:34:11 +0000"  >&lt;p&gt;Hi Anthony, thanks for this update, I&apos;ll take a look.&lt;/p&gt;</comment>
                            <comment id="12940849" author="dejanb" created="Thu, 26 Feb 2009 16:40:59 +0000"  >&lt;p&gt;Fix committed to SVN revision 748204.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461147" name="ASF.LICENSE.NOT.GRANTED--QueueBrowserTest.java" size="8454" author="aenache" created="Thu, 17 Jul 2008 19:11:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84746</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 39 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s27b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161833</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>