<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:33:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6188] Queues containing PERSISTENT messages can be garbage collected due to Inactivity</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6188</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;It is possible for a queue to be garbage collected due to inactivity despite undelivered &lt;tt&gt;PERSISTENT&lt;/tt&gt; messages being present on the queue.&lt;/p&gt;

&lt;p&gt;Order of events-&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;unused queue is marked for garbage collection due to inactivity&lt;/li&gt;
	&lt;li&gt;prior to garbage collection, an anonymous producer comes online, sending one or more messages, then closing
	&lt;ul&gt;
		&lt;li&gt;Note: the queue&apos;s &lt;tt&gt;lastActiveTime&lt;/tt&gt; is not reset when an anonymous producer is created because they are not bound to a destination at creation.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;queue with pending Message(s) is garbage collected&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;A simple fix for this seems to be resetting &lt;tt&gt;BaseDestination#lastActiveTime&lt;/tt&gt; to zero each time a message is sent (&lt;tt&gt;BaseDestination#messageDelivered(context, messageReference)&lt;/tt&gt;).&lt;/p&gt;

&lt;p&gt;I&apos;ll submit a PR with a patch shortly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12945035">AMQ-6188</key>
            <summary>Queues containing PERSISTENT messages can be garbage collected due to Inactivity</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="brianjohnson">Brian D. Johnson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Feb 2016 20:17:57 +0000</created>
                <updated>Wed, 1 Feb 2017 11:14:46 +0000</updated>
                            <resolved>Fri, 26 Feb 2016 21:06:59 +0000</resolved>
                                    <version>5.13.0</version>
                    <version>5.13.1</version>
                                    <fixVersion>5.13.2</fixVersion>
                    <fixVersion>5.14.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15169731" author="githubbot" created="Fri, 26 Feb 2016 20:24:52 +0000"  >&lt;p&gt;GitHub user bdjdev opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/170&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/170&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6188&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6188&lt;/a&gt; - reset BaseDestinatio&#8230;&lt;/p&gt;

&lt;p&gt;    Fix and test for &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6188&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6188&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/bdjdev/activemq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/bdjdev/activemq&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6188&quot; title=&quot;Queues containing PERSISTENT messages can be garbage collected due to Inactivity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6188&quot;&gt;&lt;del&gt;AMQ-6188&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/170.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/170.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #170&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit c88bcedff0e498667db53af561ab01d03b286e0c&lt;br/&gt;
Author: Brian D. Johnson &amp;lt;brian@thejohnsonfamily.name&amp;gt;&lt;br/&gt;
Date:   2016-02-26T20:19:50Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6188&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6188&lt;/a&gt; - reset BaseDestination.lastActiveTime each time a message is delivered to the broker.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15169748" author="tabish121" created="Fri, 26 Feb 2016 20:33:47 +0000"  >&lt;p&gt;I think you could assume passing faster in the test so long as the send causes the canGC to once again return false instead of doing the hard sleep&lt;/p&gt;</comment>
                            <comment id="15169762" author="christopher.l.shannon" created="Fri, 26 Feb 2016 20:43:45 +0000"  >&lt;p&gt;This looks good to me but I think it would also be a good idea to add an extra failsafe check to the canGC method and make sure that the message count is still 0 before returning true.&lt;/p&gt;</comment>
                            <comment id="15169765" author="brianjohnson" created="Fri, 26 Feb 2016 20:44:24 +0000"  >&lt;p&gt;Updated commit to remove sleep and assert canGC is false following message send.&lt;/p&gt;</comment>
                            <comment id="15169772" author="brianjohnson" created="Fri, 26 Feb 2016 20:47:19 +0000"  >&lt;p&gt;Also added the extra failsafe check to the canGC method.&lt;/p&gt;</comment>
                            <comment id="15169800" author="jira-bot" created="Fri, 26 Feb 2016 21:00:16 +0000"  >&lt;p&gt;Commit 552c0f0f7a7502c0337b13699de51a11b29723a2 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brianjohnson&quot; class=&quot;user-hover&quot; rel=&quot;brianjohnson&quot;&gt;brianjohnson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=552c0f0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=552c0f0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6188&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6188&lt;/a&gt; - reset BaseDestination.lastActiveTime each time a message is delivered to the broker.&lt;/p&gt;</comment>
                            <comment id="15169801" author="jira-bot" created="Fri, 26 Feb 2016 21:00:17 +0000"  >&lt;p&gt;Commit 012e4d0a1c85a17f90391b264617b4c9f0683d23 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=012e4d0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=012e4d0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6188&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6188&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Patch applied with thanks to Brian D. Johnson&lt;/p&gt;</comment>
                            <comment id="15169802" author="githubbot" created="Fri, 26 Feb 2016 21:00:31 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/170&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/170&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15169810" author="jira-bot" created="Fri, 26 Feb 2016 21:03:52 +0000"  >&lt;p&gt;Commit 5dfd8cdfa806ae6cf708e3dc3ee8b174655a89dd in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=brianjohnson&quot; class=&quot;user-hover&quot; rel=&quot;brianjohnson&quot;&gt;brianjohnson&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=5dfd8cd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=5dfd8cd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6188&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6188&lt;/a&gt; - reset BaseDestination.lastActiveTime each time a message is delivered to the broker.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 552c0f0f7a7502c0337b13699de51a11b29723a2)&lt;/p&gt;</comment>
                            <comment id="15169815" author="christopher.l.shannon" created="Fri, 26 Feb 2016 21:06:59 +0000"  >&lt;p&gt;Patch applied, thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="13039432">AMQ-6587</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tu8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>