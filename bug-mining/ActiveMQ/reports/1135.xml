<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:49:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2852] Memory leak when undeploying webapp with ActiveMQ client</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2852</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I have a web app with an ActiveMQ client. When undeploying the app, Tomcat logs the following messages.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;28.07.2010 17:44:28 org.apache.catalina.loader.WebappClassLoader clearReferencesThreads
SCHWERWIEGEND: The web application [] appears to have started a thread named [InactivityMonitor Async Task: java.util.concurrent.ThreadPoolExecutor$Worker@c821ef] but has failed to stop it. This is very likely to create a memory leak. 
28.07.2010 17:44:28 org.apache.catalina.loader.WebappClassLoader clearReferencesThreads
SCHWERWIEGEND: The web application [] appears to have started a thread named [TcpSocketClose: java.util.concurrent.ThreadPoolExecutor$Worker@19ac2e3] but has failed to stop it. This is very likely to create a memory leak. 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Searching for &quot;InactivityMonitor Async Task&quot; and &quot;TcpSocketClose&quot;, I found org.apache.activemq.transport.tcp.TcpTransport and org.apache.activemq.transport.InactivityMonitor which both start a ThreadPoolExecutor in their static intializers but never stop them. The ThreadPoolExecutors hold references to ActiveMQ classes which hold a reference to the webapp classloader. These references prevent the webapp classes from being unloaded when the webapp is undeployed. Due to this the servlet container runs out of memory after a few redeployments.&lt;/p&gt;

&lt;p&gt;The ActiveMQ client should dispose all resources when being closed, including the ThreadPoolExecutors. Or to provide some methods to explicitly stop these Threads (like org.apache.activemq.thread.Scheduler.shutdown() does).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12483952">AMQ-2852</key>
            <summary>Memory leak when undeploying webapp with ActiveMQ client</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="daniel.spilker@hamburg.de">Daniel Spilker</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Jul 2010 16:01:27 +0000</created>
                <updated>Mon, 15 Aug 2011 10:47:43 +0000</updated>
                            <resolved>Wed, 23 Mar 2011 16:37:54 +0000</resolved>
                                    <version>5.3.2</version>
                                    <fixVersion>5.5.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>11</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="12942807" author="henryju" created="Thu, 23 Sep 2010 09:18:09 +0000"  >&lt;p&gt;I still have this issue with ActiveMQ 5.4.1.&lt;/p&gt;</comment>
                            <comment id="12971224" author="coderman" created="Tue, 14 Dec 2010 10:44:37 +0000"  >&lt;p&gt;The same with 5.4.2&lt;/p&gt;</comment>
                            <comment id="12971225" author="coderman" created="Tue, 14 Dec 2010 10:50:16 +0000"  >&lt;p&gt;here is the log output:&lt;/p&gt;

&lt;p&gt;SEVERE: The web application &lt;span class=&quot;error&quot;&gt;&amp;#91;/webapp&amp;#93;&lt;/span&gt; appears to have started a thread named &lt;span class=&quot;error&quot;&gt;&amp;#91;AMQPersistenceAdaptor Task&amp;#93;&lt;/span&gt; but has failed to stop it. This is very likely to create a memory leak.&lt;br/&gt;
Dec 14, 2010 11:22:37 AM org.apache.catalina.loader.WebappClassLoader clearReferencesThreads&lt;br/&gt;
SEVERE: The web application &lt;span class=&quot;error&quot;&gt;&amp;#91;/webapp&amp;#93;&lt;/span&gt; appears to have started a thread named &lt;span class=&quot;error&quot;&gt;&amp;#91;VMTransport&amp;#93;&lt;/span&gt; but has failed to stop it. This is very likely to create a memory leak.&lt;br/&gt;
Dec 14, 2010 11:22:37 AM org.apache.catalina.loader.WebappClassLoader clearReferencesThreads&lt;br/&gt;
SEVERE: The web application &lt;span class=&quot;error&quot;&gt;&amp;#91;/webapp&amp;#93;&lt;/span&gt; appears to have started a thread named &lt;span class=&quot;error&quot;&gt;&amp;#91;VMTransport&amp;#93;&lt;/span&gt; but has failed to stop it. This is very likely to create a memory leak.&lt;br/&gt;
Dec 14, 2010 11:22:37 AM org.apache.catalina.loader.WebappClassLoader clearReferencesThreads&lt;br/&gt;
SEVERE: The web application &lt;span class=&quot;error&quot;&gt;&amp;#91;/webapp&amp;#93;&lt;/span&gt; appears to have started a thread named &lt;span class=&quot;error&quot;&gt;&amp;#91;VMTransport&amp;#93;&lt;/span&gt; but has failed to stop it. This is very likely to create a memory leak.&lt;br/&gt;
Dec 14, 2010 11:22:37 AM org.apache.catalina.loader.WebappClassLoader clearReferencesThreads&lt;br/&gt;
SEVERE: The web application &lt;span class=&quot;error&quot;&gt;&amp;#91;/webapp&amp;#93;&lt;/span&gt; appears to have started a thread named &lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Task&amp;#93;&lt;/span&gt; but has failed to stop it. This is very likely to create a memory leak.&lt;br/&gt;
Dec 14, 2010 11:22:37 AM org.apache.catalina.loader.WebappClassLoader clearThreadLocalMap&lt;/p&gt;</comment>
                            <comment id="12971331" author="gtully" created="Tue, 14 Dec 2010 17:29:32 +0000"  >&lt;p&gt;resolve client side issues in r1049184&lt;br/&gt;
addition of org.apache.activemq.thread.DefaultThreadPools#shutdown to allow the default pool to be shutdown on undeploy.&lt;/p&gt;</comment>
                            <comment id="12971665" author="gtully" created="Wed, 15 Dec 2010 12:45:55 +0000"  >&lt;p&gt;additional broker improvements in r1049527 - have discovery agent and network connector delegate to the common pool that can be explicitly shutdown.&lt;/p&gt;</comment>
                            <comment id="12971746" author="gtully" created="Wed, 15 Dec 2010 17:26:32 +0000"  >&lt;p&gt;still seems to be an issue with the amq persistence adapter&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SEVERE: The web application [/web-app] appears to have started a thread named [AMQPersistenceAdaptor Task] but has failed to stop it. This is very likely to create a memory leak.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13010207" author="gtully" created="Wed, 23 Mar 2011 16:37:54 +0000"  >&lt;p&gt;fixed up AMQStore piece in revision - &lt;a href=&quot;http://svn.apache.org/viewvc?rev=1084633&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1084633&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13070257" author="danttran" created="Sun, 24 Jul 2011 21:24:34 +0000"  >&lt;p&gt;I am using AMQ 5.5 using embedded mode with no persistent listening for external producer connectors and consumed via VM connector. Still see the issue&lt;/p&gt;

&lt;p&gt;turn on persistent still see the issue ( &amp;lt;amq:broker useJmx=&quot;true&quot; persistent=&quot;true&quot; advisorySupport=&quot;false&quot;&amp;gt; )&lt;/p&gt;

&lt;p&gt;SEVERE: The web application &lt;span class=&quot;error&quot;&gt;&amp;#91;/mc&amp;#93;&lt;/span&gt; appears to have started a thread named &lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Task-20&amp;#93;&lt;/span&gt; but has failed to stop it. This is very likely to create a memory leak.&lt;/p&gt;

&lt;p&gt;Any suggestion?&lt;/p&gt;</comment>
                            <comment id="13085018" author="beowulf" created="Mon, 15 Aug 2011 10:44:30 +0000"  >&lt;p&gt;The bug persists in ActiveMQ 5.5, I have created a new issue &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-3451&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-3451&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12518840">AMQ-3451</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12483602">AMQ-2138</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14610</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 15 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0akdr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59575</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>