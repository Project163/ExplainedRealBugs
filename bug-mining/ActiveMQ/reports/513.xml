<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:39:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1842] HashIndex leaks file handles when destination is removed</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1842</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When a destination is removed, all open file handles inside HashIndex will be leaked because HashIndex.clear() closes the index, deletes the backing store files, then reopens the files.  There is no provision for closing the HashIndex without reopening the files.  Eventually the broker runs out of file handles and hangs.&lt;/p&gt;

&lt;p&gt;For reference, here is the stack trace down to HashIndex.clear from the removeDestination call:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	  at org.apache.activemq.kaha.impl.index.hash.HashIndex.clear(HashIndex.java:313)
	  at org.apache.activemq.kaha.impl.container.MapContainerImpl.clear(MapContainerImpl.java:385)
	  at org.apache.activemq.store.kahadaptor.KahaReferenceStore.removeAllMessages(KahaReferenceStore.java:201)
	  at org.apache.activemq.store.kahadaptor.KahaTopicReferenceStore.removeAllMessages(KahaTopicReferenceStore.java:320)
	  at org.apache.activemq.store.amq.AMQMessageStore.removeAllMessages(AMQMessageStore.java:503)
	  at org.apache.activemq.broker.region.Topic.dispose(Topic.java:452)
	  at org.apache.activemq.broker.region.AbstractRegion.dispose(AbstractRegion.java:469)
	  at org.apache.activemq.broker.region.AbstractRegion.removeDestination(AbstractRegion.java:185)
	  at org.apache.activemq.broker.region.RegionBroker.removeDestination(RegionBroker.java:289)
	  at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:146)
	  at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:146)
	  at org.apache.activemq.advisory.AdvisoryBroker.removeDestination(AdvisoryBroker.java:173)
	  at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:146)
	  at org.apache.activemq.broker.MutableBrokerFilter.removeDestination(MutableBrokerFilter.java:153)
	  at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:146)
	  at org.apache.activemq.broker.MutableBrokerFilter.removeDestination(MutableBrokerFilter.java:153)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12482726">AMQ-1842</key>
            <summary>HashIndex leaks file handles when destination is removed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                            <parent id="12482330">AMQ-1623</parent>
                                    <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="snstanton">Scott Stanton</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Jul 2008 22:20:42 +0000</created>
                <updated>Wed, 7 Jan 2009 07:57:03 +0000</updated>
                            <resolved>Mon, 29 Dec 2008 16:51:32 +0000</resolved>
                                    <version>5.2.0</version>
                                    <fixVersion>5.3.0</fixVersion>
                                    <component>Message Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12939937" author="snstanton" created="Thu, 10 Jul 2008 01:17:17 +0000"  >&lt;p&gt;The attached patch attempts to resolve this issue by removing the state associated with a destination when it is removed.  Note that this patch resolves the issue for the Kaha message store, but does not attempt to resolve it for other message store types.&lt;/p&gt;

&lt;p&gt;Summary of changes:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Changed BaseDestination.dispose() to call dispose() on the MessageStore.&lt;/li&gt;
	&lt;li&gt;Added Index.delete() method.&lt;/li&gt;
	&lt;li&gt;Factored out AbstractMessageStore to hold the destination and the default implementations of various methods.&lt;/li&gt;
	&lt;li&gt;Added dispose() to the MessageStore interface with implementations for KahaReferenceStore and KahaTopicReferenceStore that delete the messageContainer and subscriberContainer.&lt;/li&gt;
	&lt;li&gt;Added KahaReferenceStoreAdapter.removeReferenceStore() that drops references to a message store that is being deleted.&lt;/li&gt;
	&lt;li&gt;Added MapContainer.delete() with implementations for all three container types.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12940604" author="rajdavies" created="Mon, 29 Dec 2008 16:51:32 +0000"  >&lt;p&gt;Fixed by SVN revision 729939, 729940, 729942&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461092" name="patches" size="31273" author="snstanton" created="Thu, 10 Jul 2008 01:17:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>41684</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 48 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rzxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161467</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>