<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:35:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6370] JDBC message store - jdbc connection pool - potential deadlock with cleanup task when pool exhausted</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6370</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;There is an read/write lock guarding the cleanup task and other jdbc ops in the jdbc message store.&lt;br/&gt;
Typically the read lock is obtained before the connection from the jdbc connection pool.&lt;br/&gt;
In the case of xa transactions, the connection is obtained before the read lock, in transactioncontext.begin, leaving a window between which readlock holders can be blocked pending the connection release.&lt;br/&gt;
If there is a cleanup (and write lock) request before release, the xa transaction cannot obtain a read lock and we are stuck.&lt;br/&gt;
Disabling the cleanup task avoids this issue, but that is only an option if there are no durable subs or if the durable sub cleanup task can be tackled through db admin.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12991247">AMQ-6370</key>
            <summary>JDBC message store - jdbc connection pool - potential deadlock with cleanup task when pool exhausted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Jul 2016 21:11:08 +0000</created>
                <updated>Tue, 26 Jul 2016 13:06:19 +0000</updated>
                            <resolved>Thu, 21 Jul 2016 10:00:22 +0000</resolved>
                                    <version>5.13.0</version>
                                    <fixVersion>5.14.0</fixVersion>
                                    <component>JDBC</component>
                    <component>Message Store</component>
                    <component>XA</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15386641" author="gtully" created="Wed, 20 Jul 2016 21:15:17 +0000"  >&lt;p&gt;The fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2551&quot; title=&quot;Locking issue with MySQL InnoDB&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-2551&quot;&gt;&lt;del&gt;AMQ-2551&lt;/del&gt;&lt;/a&gt; is the root cause.&lt;br/&gt;
Moving the locking to the transaction context, essentially up a level, will ensure that the datasource connection handling is always done with the appropriate lock.&lt;/p&gt;</comment>
                            <comment id="15387460" author="jira-bot" created="Thu, 21 Jul 2016 09:58:59 +0000"  >&lt;p&gt;Commit 2a815c2e08a5e2f5a056fdafbcd9c30dacf369d5 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2a815c2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2a815c2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6370&quot; title=&quot;JDBC message store - jdbc connection pool - potential deadlock with cleanup task when pool exhausted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6370&quot;&gt;&lt;del&gt;AMQ-6370&lt;/del&gt;&lt;/a&gt; - move cleanup lock to connection allocation to avoid contention with between store and connection pool. pool connection grant or block is now guarded by store lock which lasts till connection is closed&lt;/p&gt;</comment>
                            <comment id="15387465" author="gtully" created="Thu, 21 Jul 2016 10:00:22 +0000"  >&lt;p&gt;moved locking up to connection allocation ensuring lock is held till close.&lt;/p&gt;</comment>
                            <comment id="15391831" author="jira-bot" created="Mon, 25 Jul 2016 12:41:36 +0000"  >&lt;p&gt;Commit ad657cc202f30bc279316ed34c1e48c7291070cf in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ad657cc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ad657cc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6370&quot; title=&quot;JDBC message store - jdbc connection pool - potential deadlock with cleanup task when pool exhausted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6370&quot;&gt;&lt;del&gt;AMQ-6370&lt;/del&gt;&lt;/a&gt; - ensure derby instance is created&lt;/p&gt;</comment>
                            <comment id="15393758" author="jira-bot" created="Tue, 26 Jul 2016 13:06:19 +0000"  >&lt;p&gt;Commit 29856516098ba3edc0d1cd5d68bc70beeae1e73d in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2985651&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2985651&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6370&quot; title=&quot;JDBC message store - jdbc connection pool - potential deadlock with cleanup task when pool exhausted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6370&quot;&gt;&lt;del&gt;AMQ-6370&lt;/del&gt;&lt;/a&gt; - speed up the test and wait a bit longer for sends in slow ci&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12483705">AMQ-2551</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 17 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i31a6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>