<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:00:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4628] Improve Performance of JDBC store with large number of messages</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4628</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Currently JDBC store doesn&apos;t behave well when there&apos;s a huge backlog of messages (like 1 million or more). With some SQL improvements, we can make it work properly for this use case as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12657251">AMQ-4628</key>
            <summary>Improve Performance of JDBC store with large number of messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dejanb">Dejan Bosanac</assignee>
                                    <reporter username="dejanb">Dejan Bosanac</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Jul 2013 12:30:11 +0000</created>
                <updated>Thu, 3 Oct 2013 09:51:01 +0000</updated>
                            <resolved>Thu, 3 Oct 2013 09:51:01 +0000</resolved>
                                    <version>5.8.0</version>
                                    <fixVersion>5.9.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13705869" author="dejanb" created="Thu, 11 Jul 2013 14:20:12 +0000"  >&lt;p&gt;svn commit 1502206 contains the improvement related to XID column. The column was blob and not indexed, and most of the queries for non-xa case uses &quot;AND XID IS NULL&quot; in the queries, which kills the performance on large tables.&lt;/p&gt;

&lt;p&gt;The change was introduced to treat XID as String, and put it into indexed varchar column.&lt;/p&gt;

&lt;p&gt;In my tests it made the broker work properly with close to 2 million messages.&lt;/p&gt;

&lt;p&gt;The testing scenario:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Download the latest snapshot with the fix (or build locally)&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;I introduced a bit optimized configuration that turns off every non-essential feature, like expiry processing, database cleanup and priority messages. So start a broker with&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;bin/activemq console xbean:conf/activemq-jdbc-performance.xml&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
	&lt;li&gt;Send large number of messages with&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ant producer -Durl=tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:61616 -DparallelThreads=10 -Dtransacted=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dsubject=BenchmarkQueue -Dmax=200000 -Ddurable=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dbatch=1000&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note that I added batch to work with producer tool, so we can send faster&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Restart the broker to check broker startup time&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Consumer messages with something like&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ant consumer -Durl=tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:61616 -DparallelThreads=10 -Dtransacted=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; -Dsubject=BenchmarkQueue -Dmax=80000&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I tested with local MySQL and it seems to work fine. It&apos;d be good if people could test it with other RDBMS they use (Oracle, Postgres, etc.), to check if there&apos;s any other bottlenecks.&lt;/p&gt;</comment>
                            <comment id="13705880" author="dejanb" created="Thu, 11 Jul 2013 14:36:37 +0000"  >&lt;p&gt;One thing though is that this schema is not compatible with the previous version if you&apos;re using XA transactions. You&apos;ll need to:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Make sure you don&apos;t have an inflight transactions&lt;/li&gt;
	&lt;li&gt;Stop the broker&lt;/li&gt;
	&lt;li&gt;Alter the tables, by executing something like&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ALTER TABLE ACTIVEMQ_MSGS ALTER COLUMN XID VARCHAR(250)
CREATE INDEX ACTIVEMQ_MSGS_XIDX ON ACTIVEMQ_MSGS (XID)
ALTER TABLE ACTIVEMQ_ACKS ALTER COLUMN XID VARCHAR(250)
CREATE INDEX ACTIVEMQ_ACKS_XIDX ON ACTIVEMQ_ACKS (XID)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
	&lt;li&gt;Start the broker&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This isn&apos;t needed if XA transactions are not used.&lt;br/&gt;
We need to put this into migration guide for 5.9&lt;/p&gt;</comment>
                            <comment id="13784873" author="davsclaus" created="Thu, 3 Oct 2013 07:08:08 +0000"  >&lt;p&gt;Dejan, any more work to do? Or can we move this to 5.10 or should it be included in 5.9?&lt;/p&gt;</comment>
                            <comment id="13784951" author="dejanb" created="Thu, 3 Oct 2013 09:51:01 +0000"  >&lt;p&gt;That&apos;s it for now. We should just add those schema upgrade to the release notes&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>337473</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1m7jr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>337796</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>