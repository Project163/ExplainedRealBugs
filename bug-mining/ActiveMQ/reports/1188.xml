<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:50:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2256] Unnecessary TcpTransportFactory NumberFormatException and warning</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2256</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When executing TcpTransportFactory.createTransport(URI location, WireFormat wf) the following warning is incorrectly generated:&lt;/p&gt;

&lt;p&gt;WARNING: path isn&apos;t a valid local location for TcpTransport to use&lt;br/&gt;
java.lang.NumberFormatException: For input string: &quot;/exampleTopic&quot;&lt;br/&gt;
	at java.lang.NumberFormatException.forInputString(NumberFormatException.java:48)&lt;br/&gt;
	at java.lang.Integer.parseInt(Integer.java:447)&lt;br/&gt;
	at java.lang.Integer.parseInt(Integer.java:497)&lt;br/&gt;
	at org.apache.activemq.transport.tcp.TcpTransportFactory.createTransport(TcpTransportFactory.java:125)&lt;br/&gt;
	at org.apache.activemq.transport.TransportFactory.doConnect(TransportFactory.java:141)&lt;br/&gt;
	at org.apache.activemq.transport.TransportFactory.doConnect(TransportFactory.java:51)&lt;br/&gt;
	at org.apache.activemq.transport.TransportFactory.connect(TransportFactory.java:80)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnectionFactory.createTransport(ActiveMQConnectionFactory.java:237)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:252)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnectionFactory.createActiveMQConnection(ActiveMQConnectionFactory.java:224)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnectionFactory.createConnection(ActiveMQConnectionFactory.java:172)&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;With the topic name set to &quot;/exampleTopic&quot;&lt;/p&gt;

&lt;p&gt;The code responsible for this looks like:&lt;/p&gt;

&lt;p&gt;        URI localLocation = null;&lt;br/&gt;
        String path = location.getPath();&lt;br/&gt;
        // see if the path is a local URI location&lt;br/&gt;
        if (path != null &amp;amp;&amp;amp; path.length() &amp;gt; 0) {&lt;br/&gt;
            int localPortIndex = path.indexOf(&apos;:&apos;);&lt;br/&gt;
            try &lt;/p&gt;
{
                Integer.parseInt(path.substring(localPortIndex + 1, path.length()));
                String localString = location.getScheme() + &quot;:/&quot; + path;
                localLocation = new URI(localString);
            }
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
                LOG.warn(&quot;path isn&apos;t a valid local location for TcpTransport to use&quot;, e);
            }
&lt;p&gt;        }&lt;br/&gt;
        SocketFactory socketFactory = createSocketFactory();&lt;br/&gt;
        return createTcpTransport(wf, socketFactory, location, localLocation);&lt;br/&gt;
    }&lt;/p&gt;


&lt;p&gt;The problem seems to be that for the path=&quot;/exampleTopic&quot;, the following line:&lt;/p&gt;

&lt;p&gt;           int localPortIndex = path.indexOf(&apos;:&apos;);&lt;/p&gt;

&lt;p&gt;returns -1 (no colon and no port specified in path&lt;/p&gt;

&lt;p&gt;and the subsequent line:&lt;/p&gt;

&lt;p&gt;             Integer.parseInt(path.substring(localPortIndex + 1, path.length()));&lt;/p&gt;

&lt;p&gt;generates the NumberFormatException (because the path does not have any integer).&lt;/p&gt;

&lt;p&gt;It seems that perhaps there should be some test like:&lt;/p&gt;

&lt;p&gt;if (localPortIndex != -1) {&lt;br/&gt;
...&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;I will create a patch if desired.  Just LMK.&lt;/p&gt;

</description>
                <environment>&lt;p&gt;Windows XP&lt;/p&gt;</environment>
        <key id="12483701">AMQ-2256</key>
            <summary>Unnecessary TcpTransportFactory NumberFormatException and warning</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="sblewis">Scott Lewis</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 May 2009 21:30:47 +0000</created>
                <updated>Thu, 7 May 2015 13:18:30 +0000</updated>
                            <resolved>Sat, 26 Feb 2011 22:53:45 +0000</resolved>
                                    <version>5.2.0</version>
                                    <fixVersion>5.5.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12940981" author="sblewis" created="Wed, 5 Aug 2009 22:40:05 +0000"  >&lt;p&gt;Is there any way to shut off the presentation of this NumberFormatException in 5.2.0.  Short of having it fixed, it would be very nice to at least prevent the spurious NumberFormatException and stack trace from appearing when using the tcp protocol in this manner&lt;/p&gt;</comment>
                            <comment id="12940956" author="gtully" created="Thu, 6 Aug 2009 09:04:27 +0000"  >&lt;p&gt;could you attach a test case for this issue? Exactly what parameters are passed to the API?&lt;/p&gt;</comment>
                            <comment id="12940953" author="sblewis" created="Thu, 6 Aug 2009 15:25:20 +0000"  >&lt;p&gt;The String path passed to the API  at org.apache.activemq.transport.tcp.TcpTransportFactory.createTransport(TcpTransportFactory.java:125)&lt;/p&gt;

&lt;p&gt;is &quot;/exampleTopic&quot;.  The exact contents of the string doesn&apos;t matter.&lt;/p&gt;

</comment>
                            <comment id="12999805" author="tabish121" created="Sat, 26 Feb 2011 15:54:40 +0000"  >&lt;p&gt;Not enough information provided to construct a test case.  Can be reopened if a test case is provided so this can be validated.&lt;/p&gt;</comment>
                            <comment id="12999851" author="sblewis" created="Sat, 26 Feb 2011 22:12:24 +0000"  >&lt;p&gt;The test case is simply:&lt;/p&gt;

&lt;p&gt;new ActiveMQConnectionFactory(&quot;tcp://localhost:61616/exampleTopic&quot;).createConnection();&lt;/p&gt;

&lt;p&gt;The connection is created successfully, bu the NumberFormatException is still being produced to standard error.&lt;/p&gt;

&lt;p&gt;Although originally reported on 5.2.0, the same problem exists on 5.3.2 as well (what I happen to be using now).&lt;/p&gt;

&lt;p&gt;As stated in the bug, the problem is in TcpTransportFactory.createTransport.  Here is an annotated code fragment that shows the problem (modified slightly from TcpTransportFactory.createTransport)&lt;/p&gt;

&lt;p&gt;URI location = new URI(&quot;tcp://localhost:61616/exampleTopic&quot;);&lt;br/&gt;
String path = location.getPath();&lt;br/&gt;
// path is &quot;/exampleTopic&quot;&lt;br/&gt;
if (path != null &amp;amp;&amp;amp; path.length() &amp;gt; 0) {&lt;br/&gt;
  int localPortIndex = path.indexOf(&apos;:&apos;);&lt;br/&gt;
// localPortIndex == -1 ...this is wrong, since //exampleTopic has no port in it&lt;br/&gt;
  try {&lt;br/&gt;
    Integer.parseInt(path.substring(localPortIndex + 1,path.length()));  &lt;br/&gt;
// the previous line throws NumberFormatException because path.substring(0.path.length()) does not produce a number, because path is &quot;/exampleTopic&quot;&lt;/p&gt;
</comment>
                            <comment id="12999853" author="tabish121" created="Sat, 26 Feb 2011 22:53:45 +0000"  >&lt;p&gt;Thanks, having your full URI made that much easier.  The code will suppress the full exception stack and just log a warning now unless debug logging is on.&lt;/p&gt;</comment>
                            <comment id="13506369" author="gangliu" created="Thu, 29 Nov 2012 10:01:44 +0000"  >&lt;p&gt;sorry, But I found we still have some output which looks like:&lt;br/&gt;
&lt;b&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;/50/data/fileIn&amp;#93;&lt;/span&gt; TcpTransportFactory            WARN  path isn&apos;t a valid local location for TcpTransport to use&lt;/b&gt;&lt;br/&gt;
I tested on activemq-5.7.0, it&apos;s a problem or not? Thanks.&lt;/p&gt;</comment>
                            <comment id="14532586" author="ghenry@lswe.com" created="Thu, 7 May 2015 13:18:30 +0000"  >&lt;p&gt;My two cents&lt;br/&gt;
Same warning with amq 5.8. used with Apche Camel &lt;br/&gt;
Solved by not adding a / at the end of the amq server url &lt;br/&gt;
tcp://myhost:61616/  give a warning &lt;br/&gt;
tcp://myhost:61616 don&apos;t !&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14698</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 28 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0akqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59632</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>