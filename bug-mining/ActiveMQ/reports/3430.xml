<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:52:26 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-9156] In flight destination statistics are not properly decremented on Topic sub failure or close</title>
                <link>https://issues.apache.org/jira/browse/AMQ-9156</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;In flight statistics were enhanced back in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5837&quot; title=&quot;Add inflight message size to SubscriptionStatistics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5837&quot;&gt;&lt;del&gt;AMQ-5837&lt;/del&gt;&lt;/a&gt; and I noticed a small edge case issue for Topic subscriptions where the in flight count on the destination the topic subscription was consuming from would not be properly decremented on Topic subscription failure due to dispatch failure or on subscription close. We just need to make sure on failure/close the stats are updated properly (Prefetch subs already do this for queues/durables). I will push a small fix for this and a couple new tests.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13494599">AMQ-9156</key>
            <summary>In flight destination statistics are not properly decremented on Topic sub failure or close</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="cshannon">Christopher L. Shannon</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Nov 2022 14:35:04 +0000</created>
                <updated>Wed, 16 Nov 2022 11:53:38 +0000</updated>
                            <resolved>Thu, 3 Nov 2022 14:43:17 +0000</resolved>
                                    <version>5.17.2</version>
                                    <fixVersion>5.18.0</fixVersion>
                    <fixVersion>5.17.3</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17628358" author="jira-bot" created="Thu, 3 Nov 2022 14:42:09 +0000"  >&lt;p&gt;Commit 58666afffde7eb43509d155e709e76e6fdba8084 in activemq&apos;s branch refs/heads/main from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=58666afff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=58666afff&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9156&quot; title=&quot;In flight destination statistics are not properly decremented on Topic sub failure or close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9156&quot;&gt;&lt;del&gt;AMQ-9156&lt;/del&gt;&lt;/a&gt; - Make sure in flight metrics are properly decremented on&lt;br/&gt;
subscription destroys and dispatch failures&lt;/p&gt;</comment>
                            <comment id="17628359" author="jira-bot" created="Thu, 3 Nov 2022 14:42:58 +0000"  >&lt;p&gt;Commit 9c5a6219eafa3d02a4c00aaa00234063468ea411 in activemq&apos;s branch refs/heads/activemq-5.17.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=9c5a6219e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=9c5a6219e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9156&quot; title=&quot;In flight destination statistics are not properly decremented on Topic sub failure or close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9156&quot;&gt;&lt;del&gt;AMQ-9156&lt;/del&gt;&lt;/a&gt; - Make sure in flight metrics are properly decremented on&lt;br/&gt;
subscription destroys and dispatch failures&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 58666afffde7eb43509d155e709e76e6fdba8084)&lt;/p&gt;</comment>
                            <comment id="17628363" author="jira-bot" created="Thu, 3 Nov 2022 14:44:55 +0000"  >&lt;p&gt;Commit 3bd099f4697e140bbb6c782ab0677d930f59518d in activemq&apos;s branch refs/heads/activemq-5.17.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=3bd099f46&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=3bd099f46&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9156&quot; title=&quot;In flight destination statistics are not properly decremented on Topic sub failure or close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9156&quot;&gt;&lt;del&gt;AMQ-9156&lt;/del&gt;&lt;/a&gt; - fix formatting&lt;/p&gt;</comment>
                            <comment id="17628364" author="jira-bot" created="Thu, 3 Nov 2022 14:45:20 +0000"  >&lt;p&gt;Commit 2306a26aef2680005396a109385d5913a53442d3 in activemq&apos;s branch refs/heads/main from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=2306a26ae&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=2306a26ae&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9156&quot; title=&quot;In flight destination statistics are not properly decremented on Topic sub failure or close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9156&quot;&gt;&lt;del&gt;AMQ-9156&lt;/del&gt;&lt;/a&gt; - fix formatting&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 3bd099f4697e140bbb6c782ab0677d930f59518d)&lt;/p&gt;</comment>
                            <comment id="17634543" author="jira-bot" created="Tue, 15 Nov 2022 22:01:17 +0000"  >&lt;p&gt;Commit 8554a1464c6471f81ebbcd6c482376ae32cf6808 in activemq&apos;s branch refs/heads/main from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=8554a1464&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=8554a1464&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9156&quot; title=&quot;In flight destination statistics are not properly decremented on Topic sub failure or close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9156&quot;&gt;&lt;del&gt;AMQ-9156&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9167&quot; title=&quot;Fix TwoSecureBrokerRequestReplyTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9167&quot;&gt;&lt;del&gt;AMQ-9167&lt;/del&gt;&lt;/a&gt;) - Update TopicSubscription to use a new counter for&lt;br/&gt;
current dispatched count&lt;/p&gt;

&lt;p&gt;The previous way of computing the count of using total dispatched minus&lt;br/&gt;
total dequeued didn&apos;t work in the case of destination removal and&lt;br/&gt;
messages were not acked. The counter is needed as the dispatched list is&lt;br/&gt;
optional unlike prefetch subs.&lt;/p&gt;</comment>
                            <comment id="17634545" author="jira-bot" created="Tue, 15 Nov 2022 22:02:45 +0000"  >&lt;p&gt;Commit 46cdecf05f38b122fb834355192712ba0e611bdb in activemq&apos;s branch refs/heads/activemq-5.17.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=46cdecf05&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=46cdecf05&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;(&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9156&quot; title=&quot;In flight destination statistics are not properly decremented on Topic sub failure or close&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9156&quot;&gt;&lt;del&gt;AMQ-9156&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9167&quot; title=&quot;Fix TwoSecureBrokerRequestReplyTest&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9167&quot;&gt;&lt;del&gt;AMQ-9167&lt;/del&gt;&lt;/a&gt;) - Update TopicSubscription to use a new counter for&lt;br/&gt;
current dispatched count&lt;/p&gt;

&lt;p&gt;The previous way of computing the count of using total dispatched minus&lt;br/&gt;
total dequeued didn&apos;t work in the case of destination removal and&lt;br/&gt;
messages were not acked. The counter is needed as the dispatched list is&lt;br/&gt;
optional unlike prefetch subs.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 8554a1464c6471f81ebbcd6c482376ae32cf6808)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1ascg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>