<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:33:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6108] SelectorManager Executor is not shutdown when transport os stopped.</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6108</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;SelectorManager creates an Executor that is not shut down on termination of the Transport.&lt;/p&gt;

&lt;p&gt;The Executor currently uses non-daemon threads and is is not guaranteed the the SelectorWorker thread exit condition is ever met.&lt;/p&gt;

&lt;p&gt;This causes the shutdown to hang when using transports that utilise the SelectorManager, such as nio+ssl for example.&lt;/p&gt;

&lt;p&gt;The proposed patch shuts down the ExecutorService on/after Transport shutdown. The SelectorWorkers also check for this as an exit condition.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12924073">AMQ-6108</key>
            <summary>SelectorManager Executor is not shutdown when transport os stopped.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="andyg">Andy Gumbrecht</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Dec 2015 19:45:35 +0000</created>
                <updated>Tue, 15 Mar 2016 19:45:08 +0000</updated>
                            <resolved>Thu, 14 Jan 2016 21:50:01 +0000</resolved>
                                                    <fixVersion>5.13.1</fixVersion>
                    <fixVersion>5.14.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15070938" author="andyg" created="Thu, 24 Dec 2015 12:00:21 +0000"  >&lt;p&gt;Updated patch&lt;/p&gt;</comment>
                            <comment id="15083458" author="christopher.l.shannon" created="Tue, 5 Jan 2016 17:54:02 +0000"  >&lt;p&gt;It&apos;s a good idea to include a test if possible to demonstrate the issue (in this case to show that the shutdown hangs) and also to show that your patch fixes the problem.  It also helps to make sure that any future changes won&apos;t cause the problem to show up again.&lt;/p&gt;</comment>
                            <comment id="15098910" author="tabish121" created="Thu, 14 Jan 2016 21:33:42 +0000"  >&lt;p&gt;Since the SelectorManager instance is shared amongst every Transport instance created when using the NIOTransport types it doesn&apos;t make any sense to shutdown the executor when any one instance is stopped, or when any one TransportConnector instance is stopped as that defeats the purpose of the NIO bits sharing resources.  The Threads in the executor should be set deamon though in order to prevent them keeping a JVM running.  &lt;/p&gt;</comment>
                            <comment id="15098940" author="jira-bot" created="Thu, 14 Jan 2016 21:47:34 +0000"  >&lt;p&gt;Commit 5adbafef3b9ec05de7186caa9112f3639c7a6253 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=5adbafe&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=5adbafe&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6108&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6108&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Ensure that executor threads are created as daemon threads, fix a&lt;br/&gt;
try/finaly block, clean up some warnings.  &lt;/p&gt;</comment>
                            <comment id="15098943" author="jira-bot" created="Thu, 14 Jan 2016 21:48:07 +0000"  >&lt;p&gt;Commit 1d9fdbcbeaacf2d5673bb5435b1caae0b1cfc7a7 in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=1d9fdbc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=1d9fdbc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6108&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6108&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Ensure that executor threads are created as daemon threads, fix a&lt;br/&gt;
try/finaly block, clean up some warnings.&lt;br/&gt;
(cherry picked from commit 5adbafef3b9ec05de7186caa9112f3639c7a6253)&lt;/p&gt;</comment>
                            <comment id="15098947" author="tabish121" created="Thu, 14 Jan 2016 21:50:01 +0000"  >&lt;p&gt;Updated thread creation to be daemon threads and fixed some warnings in the code.  Shutdown of the SelectorManager doesn&apos;t make sense on Transport stop given that all other active NIO Transport based instances still need to use the SelectorManager &lt;/p&gt;</comment>
                            <comment id="15194293" author="volkerk" created="Mon, 14 Mar 2016 22:27:41 +0000"  >&lt;p&gt;Actually these check-ins by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt; call setDaemon(false), i.e. they create the ActiveMQ IO Worker thread as user thread, not as daemon. This is exactly the wrong way around, so this issue remains unfixed, or rather the fix here really broke things!&lt;/p&gt;

&lt;p&gt;This is a major problem, as it prevents proper shutdown and restart of JVMs running AMQ. In all previous releases these threads actually were daemon threads, as can easily be verified in thread dumps, but the newly added explicit setDaemon(false) call broke that in 5.13.1.&lt;/p&gt;</comment>
                            <comment id="15195818" author="jira-bot" created="Tue, 15 Mar 2016 18:03:31 +0000"  >&lt;p&gt;Commit e2b4ca2c59a316be91cf391c758a10e518dd3a1f in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e2b4ca2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e2b4ca2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6108&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6108&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Update the threads created by the SelectorManager to be daemon threads. &lt;/p&gt;</comment>
                            <comment id="15195827" author="jira-bot" created="Tue, 15 Mar 2016 18:06:18 +0000"  >&lt;p&gt;Commit e0081014bfd95140b0545ffc20e1d25558044a02 in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e008101&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e008101&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6108&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6108&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Update the threads created by the SelectorManager to be daemon threads. &lt;br/&gt;
(cherry picked from commit e2b4ca2c59a316be91cf391c758a10e518dd3a1f)&lt;/p&gt;

&lt;p&gt;Conflicts:&lt;br/&gt;
	activemq-client/src/main/java/org/apache/activemq/transport/nio/SelectorManager.java&lt;/p&gt;</comment>
                            <comment id="15196057" author="volkerk" created="Tue, 15 Mar 2016 19:45:08 +0000"  >&lt;p&gt;Thanks for the quick fix!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12779432" name="SelectorManager.Shutdown.patch" size="8977" author="andyg" created="Thu, 24 Dec 2015 12:00:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 36 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2q9q7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>