<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:49:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-7291] Message body is read-only exception when setting property on Bytes message </title>
                <link>https://issues.apache.org/jira/browse/AMQ-7291</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://github.com/openzipkin/brave/tree/master/instrumentation/jms&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Zipkin&apos;s Brave instrumentation for JMS clients&lt;/a&gt;, we are currently having issues on adding properties to ActiveMQ BytesMessage &amp;lt;&lt;a href=&quot;https://github.com/openzipkin/brave/issues/967&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/openzipkin/brave/issues/967&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;While setting String property on `ActiveMQMessage` works fine, setting String property on `ActiveMQBytesMessage` throws &quot;Message body is read-only exception&quot;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Checking the source code `ActiveMQMessage` only checks if properties are read-only: &lt;a href=&quot;https://github.com/apache/activemq/blob/master/activemq-client/src/main/java/org/apache/activemq/command/ActiveMQMessage.java#L493-L495&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/master/activemq-client/src/main/java/org/apache/activemq/command/ActiveMQMessage.java#L493-L495&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;While `ActiveMQBytesMessage` check if body is read-only when setting property: &lt;a href=&quot;https://github.com/apache/activemq/blob/master/activemq-client/src/main/java/org/apache/activemq/command/ActiveMQBytesMessage.java#L917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/master/activemq-client/src/main/java/org/apache/activemq/command/ActiveMQBytesMessage.java#L917&lt;/a&gt; calling &lt;a href=&quot;https://github.com/apache/activemq/blob/master/activemq-client/src/main/java/org/apache/activemq/command/ActiveMQBytesMessage.java#L834&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/master/activemq-client/src/main/java/org/apache/activemq/command/ActiveMQBytesMessage.java#L834&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Would love if someone can clarify if this is actually a bug and how to deal with this scenario if it is not.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13253119">AMQ-7291</key>
            <summary>Message body is read-only exception when setting property on Bytes message </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbonofre">Jean-Baptiste Onofr&#233;</assignee>
                                    <reporter username="jeqo">Jorge Esteban Quilcate Otoya</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Aug 2019 19:29:49 +0000</created>
                <updated>Thu, 21 May 2020 09:44:03 +0000</updated>
                            <resolved>Thu, 21 May 2020 09:44:03 +0000</resolved>
                                    <version>5.x</version>
                                    <fixVersion>5.16.0</fixVersion>
                                    <component>JMS client</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>7</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16916093" author="jeqo" created="Mon, 26 Aug 2019 19:32:37 +0000"  >&lt;p&gt;This issue seems related: &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-1457&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-1457&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16978464" author="frederic.kneier" created="Wed, 20 Nov 2019 14:21:54 +0000"  >&lt;p&gt;IMHO this definitively is a bug if the&#160; ActiveMQBytesMessage allows to clear properties but not to set them afterwards.&lt;/p&gt;

&lt;p&gt;It seems that the code&#160; in ActiveMQBytesMessage.setObjectProperty checks for &quot;readOnlyBody&quot; while ActiveMQMessage.clearProperties is setting &quot;readOnlyProperties&quot;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;In this case Zipkin is able to clear the properties but not to set them afterwards.&lt;/p&gt;</comment>
                            <comment id="16980172" author="me3x" created="Fri, 22 Nov 2019 14:05:27 +0000"  >&lt;p&gt;Please check this PR:&#160;&lt;a href=&quot;https://github.com/apache/activemq/pull/420&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/420&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17024174" author="jbonofre" created="Mon, 27 Jan 2020 08:52:11 +0000"  >&lt;p&gt;Just as a reminder, the spec says that the message should be read-only (for the payload). I would like to double check the PR to validate we are compliant with the spec.&lt;/p&gt;</comment>
                            <comment id="17039994" author="gtully" created="Wed, 19 Feb 2020 12:59:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbonofre&quot; class=&quot;user-hover&quot; rel=&quot;jbonofre&quot;&gt;jbonofre&lt;/a&gt;, I think the properties on a message are different, normally not used on bytes messages but there all the same. I think the fix is good, I have a little test case to demonstrates the incorrect behaviour after clear properties. If you don&apos;t mind, I will jump in and fix.&lt;/p&gt;</comment>
                            <comment id="17039996" author="jira-bot" created="Wed, 19 Feb 2020 13:01:49 +0000"  >&lt;p&gt;Commit 503416a00167e2910630512426df77ecc32492a2 in activemq&apos;s branch refs/heads/master from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=503416a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=503416a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7291&quot; title=&quot;Message body is read-only exception when setting property on Bytes message &quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7291&quot;&gt;&lt;del&gt;AMQ-7291&lt;/del&gt;&lt;/a&gt; - allow setting properties after clearProperties for BytesMessage, closes #420&lt;/p&gt;</comment>
                            <comment id="17043157" author="jira-bot" created="Mon, 24 Feb 2020 04:59:34 +0000"  >&lt;p&gt;Commit b999e2b7787f8b9bd556456b1e6ebf4cbfc0881e in activemq&apos;s branch refs/heads/activemq-5.15.x from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=b999e2b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=b999e2b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7291&quot; title=&quot;Message body is read-only exception when setting property on Bytes message &quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7291&quot;&gt;&lt;del&gt;AMQ-7291&lt;/del&gt;&lt;/a&gt; - allow setting properties after clearProperties for BytesMessage, closes #420&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 503416a00167e2910630512426df77ecc32492a2)&lt;/p&gt;</comment>
                            <comment id="17055768" author="jbonofre" created="Tue, 10 Mar 2020 10:03:00 +0000"  >&lt;p&gt;This change is breaking AMQ6244Test unit test.&lt;/p&gt;</comment>
                            <comment id="17055769" author="jbonofre" created="Tue, 10 Mar 2020 10:03:09 +0000"  >&lt;p&gt;I&apos;m fixing the test.&lt;/p&gt;</comment>
                            <comment id="17055818" author="jbonofre" created="Tue, 10 Mar 2020 10:59:18 +0000"  >&lt;p&gt;This change also impacts the KahaDB Lease test. Let me revert the change to gives time to fix for 5.15.13.&lt;/p&gt;</comment>
                            <comment id="17056047" author="jira-bot" created="Tue, 10 Mar 2020 15:16:12 +0000"  >&lt;p&gt;Commit 6355f507c3b8ad5f38853d11e0ae0da58659d0c6 in activemq&apos;s branch refs/heads/master from jbonofre&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=6355f50&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=6355f50&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7291&quot; title=&quot;Message body is read-only exception when setting property on Bytes message &quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7291&quot;&gt;&lt;del&gt;AMQ-7291&lt;/del&gt;&lt;/a&gt; - allow setting properties after clearProperties for BytesMessage, closes #420&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 503416a00167e2910630512426df77ecc32492a2.&lt;/p&gt;</comment>
                            <comment id="17056049" author="jira-bot" created="Tue, 10 Mar 2020 15:16:53 +0000"  >&lt;p&gt;Commit 6e75460aab63b222984f73d01145b7c229034824 in activemq&apos;s branch refs/heads/activemq-5.15.x from jbonofre&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=6e75460&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=6e75460&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7291&quot; title=&quot;Message body is read-only exception when setting property on Bytes message &quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7291&quot;&gt;&lt;del&gt;AMQ-7291&lt;/del&gt;&lt;/a&gt; - allow setting properties after clearProperties for BytesMessage, closes #420&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit b999e2b7787f8b9bd556456b1e6ebf4cbfc0881e.&lt;/p&gt;</comment>
                            <comment id="17112346" author="gtully" created="Wed, 20 May 2020 15:20:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbonofre&quot; class=&quot;user-hover&quot; rel=&quot;jbonofre&quot;&gt;jbonofre&lt;/a&gt; I am peeking again at this fix and the compression test failure, AMQ6244Test.&lt;br/&gt;
I think the solution is to just check for readOnlyProperties in initialiseWriting when we are dealing with properties rather than skip that call. In that way the change is minimal.&lt;br/&gt;
I will run the tests with the change to validate.&lt;br/&gt;
I don&apos;t see any other related failure, as in the kahadb lease test you references is unaffected.&lt;br/&gt;
Are you aware of any other related failure?&lt;/p&gt;</comment>
                            <comment id="17112348" author="jbonofre" created="Wed, 20 May 2020 15:22:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&#160;Hey, thanks for your help ! No, I don&apos;t think we have other related failure.&lt;/p&gt;</comment>
                            <comment id="17113015" author="jira-bot" created="Thu, 21 May 2020 09:42:17 +0000"  >&lt;p&gt;Commit 62cfe83e9d16acd0b466e9fb6b40146394b3792d in activemq&apos;s branch refs/heads/master from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=62cfe83&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=62cfe83&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7291&quot; title=&quot;Message body is read-only exception when setting property on Bytes message &quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7291&quot;&gt;&lt;del&gt;AMQ-7291&lt;/del&gt;&lt;/a&gt; rework fix to initializeWriting but just with the read only properties check&lt;/p&gt;</comment>
                            <comment id="17113016" author="gtully" created="Thu, 21 May 2020 09:44:03 +0000"  >&lt;p&gt;fix reworked to resolve test regression, still doing intializeWriting but without the readonly body check which was in error.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 25 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0621k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>