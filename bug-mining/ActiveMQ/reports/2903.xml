<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:36:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6422] AMQP - flow(1) without a dispositon can lead to blocked receive</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6422</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Setting prefetch based on the credit can get in a knot if the credit is small and the dispositions are outstanding.&lt;br/&gt;
The prefetch gets set to 1, but with an inflight message, there is nothing dispatched b/c the sub looks full.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13003301">AMQ-6422</key>
            <summary>AMQP - flow(1) without a dispositon can lead to blocked receive</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Sep 2016 16:26:13 +0000</created>
                <updated>Tue, 26 Sep 2017 10:02:32 +0000</updated>
                            <resolved>Wed, 21 Sep 2016 13:00:55 +0000</resolved>
                                                    <fixVersion>5.14.1</fixVersion>
                    <fixVersion>5.15.0</fixVersion>
                                    <component>AMQP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15471071" author="jira-bot" created="Wed, 7 Sep 2016 16:29:03 +0000"  >&lt;p&gt;Commit 88daeec28f25266c6fce15e200ac6d2ca9d11eb6 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=88daeec&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=88daeec&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6422&quot; title=&quot;AMQP - flow(1) without a dispositon can lead to blocked receive&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6422&quot;&gt;&lt;del&gt;AMQ-6422&lt;/del&gt;&lt;/a&gt; - include the inflight count in the prefetch for positive remote credit flows. Fix and test&lt;/p&gt;</comment>
                            <comment id="15471075" author="gtully" created="Wed, 7 Sep 2016 16:31:09 +0000"  >&lt;p&gt;I think this fix can be further refined by avoiding some updates to the prefetch. not done yet and maybe the tests will be sensitive to proton event production order.&lt;/p&gt;</comment>
                            <comment id="15471361" author="jira-bot" created="Wed, 7 Sep 2016 18:05:42 +0000"  >&lt;p&gt;Commit ee271afe9041172df24b572231b394a7c6fec0ce in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ee271af&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ee271af&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6422&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6422&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve made a few minor test changes and added a couple more cases.  Under&lt;br/&gt;
heavy CPU load I&apos;m able to get test,&lt;br/&gt;
testReceiveMessageAndRefillCreditBeforeAcceptOnQueue to fail on the&lt;br/&gt;
second receive call where it should get the second message since it&lt;br/&gt;
granted credit.&lt;/p&gt;</comment>
                            <comment id="15471382" author="tabish121" created="Wed, 7 Sep 2016 18:10:53 +0000"  >&lt;p&gt;A couple things to note here, the unsettled count and the credit on the link aren&apos;t really tied to each other at all.  The remote can keep granting credit and not settle anything if it wishes and I don&apos;t think there&apos;s test that cover that case.  Also the remote could request that all deliveries are sent settled so there&apos;d be no movement on that counter, which I don&apos;t think is tested much here so there could be issues yet to be discovered in that area.  &lt;/p&gt;</comment>
                            <comment id="15471423" author="tabish121" created="Wed, 7 Sep 2016 18:25:05 +0000"  >&lt;p&gt;Also see failures in testDispatchOrderWithPrefetchOfOne test in repeated runs with varied CPU loads.&lt;/p&gt;</comment>
                            <comment id="15473344" author="gtully" created="Thu, 8 Sep 2016 09:17:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt; I have a variant of (added in some send threads)  org.apache.activemq.transport.amqp.interop.AmqpSendReceiveTest#testReceiveMessageAndRefillCreditBeforeAcceptOnQueue that can&apos;t get past 3 iterations.&lt;br/&gt;
optimizeDispatch=true sorts this one case, but that is too general a solution.&lt;/p&gt;</comment>
                            <comment id="15477569" author="jira-bot" created="Fri, 9 Sep 2016 16:53:02 +0000"  >&lt;p&gt;Commit 640289868e18e82b054be8aff5580d3665518f5c in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=6402898&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=6402898&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6422&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6422&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Add test for credit grants but no settles for a single receiver.&lt;/p&gt;</comment>
                            <comment id="15477600" author="jira-bot" created="Fri, 9 Sep 2016 17:02:12 +0000"  >&lt;p&gt;Commit 2fdc2600ac37d11d2d660654b327dddd852eeef7 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2fdc260&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2fdc260&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6422&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6422&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Small fix to test and check for zero inflight on successive send to&lt;br/&gt;
destination that should have no credit on the registered receiver.&lt;/p&gt;</comment>
                            <comment id="15478479" author="jira-bot" created="Fri, 9 Sep 2016 22:34:24 +0000"  >&lt;p&gt;Commit da9fedead4078cc82efb32e15d8d9cd53c8e82dc in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=da9fede&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=da9fede&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6422&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6422&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Adds a split consumer test that uses presettled receivers.&lt;/p&gt;</comment>
                            <comment id="15509374" author="jira-bot" created="Wed, 21 Sep 2016 09:33:39 +0000"  >&lt;p&gt;Commit ffee8b442f57b38d57a59745b9062e8d963c65ba in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ffee8b4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ffee8b4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6422&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6422&lt;/a&gt; - match proton sender view credit to prefetchExtension - tracking credit to dispatch delta to track additional flow requests. Proton sender layer is distinct from the transport layer - they mirror each other&lt;/p&gt;</comment>
                            <comment id="15509633" author="gemmellr" created="Wed, 21 Sep 2016 11:32:11 +0000"  >&lt;p&gt;The &apos;logicalDeliveryCount&apos; increment added at the end of the &apos;delivery&apos; method seems off since that method is called based on disposition activity, and may either never be called for a given message (if sent pre-settled) or be called multiple times for the same message (due to multiple dispositions).&lt;/p&gt;

&lt;p&gt;For the purposes of credit tracking, the credit is used as soon as the message is finished being handed to proton, in this case in &apos;pumpOutbound&apos; when the link is advanced to complete the current delivery, or the links &apos;current&apos; incomplete delivery is settled (which must advance the link to complete the delivery).&lt;/p&gt;</comment>
                            <comment id="15509842" author="jira-bot" created="Wed, 21 Sep 2016 13:00:05 +0000"  >&lt;p&gt;Commit 6c01b641b1850b384e57d74ad6471ea4c8fcf01f in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=6c01b64&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=6c01b64&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6422&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6422&lt;/a&gt; - move delivery tracking to pumpoutbound and additional test that shows how the presettle case breaks. Thanks to Robbie Gemmell for the feedback&lt;/p&gt;</comment>
                            <comment id="15509850" author="gtully" created="Wed, 21 Sep 2016 13:03:10 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gemmellr&quot; class=&quot;user-hover&quot; rel=&quot;gemmellr&quot;&gt;gemmellr&lt;/a&gt; for the quick review. I managed to build a test that showed the problem with using delivery in the successive flow case. When drained there is a flow with credit 0 that reset in the more normal case.&lt;/p&gt;</comment>
                            <comment id="15526698" author="jira-bot" created="Tue, 27 Sep 2016 16:46:14 +0000"  >&lt;p&gt;Commit ca11674f37cf3a67a9215f341a8e8458ce7b0641 in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ca11674&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ca11674&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6422&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6422&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Add test for credit grants but no settles for a single receiver.&lt;/p&gt;</comment>
                            <comment id="15526699" author="jira-bot" created="Tue, 27 Sep 2016 16:46:17 +0000"  >&lt;p&gt;Commit 566e82614aa3cb31c80d44d155debe0e63cc2a3c in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=566e826&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=566e826&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6422&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6422&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Small fix to test and check for zero inflight on successive send to&lt;br/&gt;
destination that should have no credit on the registered receiver.&lt;/p&gt;</comment>
                            <comment id="15526700" author="jira-bot" created="Tue, 27 Sep 2016 16:46:18 +0000"  >&lt;p&gt;Commit 14c5c5276c9f6bfa360c24d4e2b875483dc43888 in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=14c5c52&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=14c5c52&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6422&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6422&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Adds a split consumer test that uses presettled receivers.&lt;/p&gt;</comment>
                            <comment id="15526701" author="jira-bot" created="Tue, 27 Sep 2016 16:46:19 +0000"  >&lt;p&gt;Commit ebbb7ab437b3023be5afe731a0015fec58a51d57 in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ebbb7ab&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ebbb7ab&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6422&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6422&lt;/a&gt; - match proton sender view credit to prefetchExtension - tracking credit to dispatch delta to track additional flow requests. Proton sender layer is distinct from the transport layer - they mirror each other&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13105037">AMQ-6824</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 8 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33cjb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>