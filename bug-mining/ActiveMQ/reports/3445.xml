<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:54:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-9262] Composite consumers do not work properly with a network of brokers</title>
                <link>https://issues.apache.org/jira/browse/AMQ-9262</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I found an interesting edge case where consumers that use a composite destination do not correctly work dynamically included destinations with a network of brokers. The issue is the composite destination that is used by the consumer causes the bridge to not be able to correctly create conduit subscriptions as the logic used to to check for matching subscriptions fails.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Note:&lt;/b&gt; This is referring to a consumer that uses a composite destination string when consuming to subscribe to multiple topics, &lt;b&gt;NOT&lt;/b&gt; virtual topics or the composite destination feature in the broker itself.&lt;/p&gt;

&lt;p&gt;The end result is that duplicate subscriptions will be created for both topic/queue subscriptions even if conduit subscriptions is enabled. In the durable subscription case this is actually even worse because an exception occurs as it tries to create the same durable more than once which is not allowed of course.&lt;/p&gt;

&lt;p&gt;An example like the following fails because the network bridge tries to create the same durable twice and it already exists.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ActiveMQTopic compositeTopic = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ActiveMQTopic(testTopic1 + &lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt; + testTopic2);
TopicSubscriber durSub1 = session1.createDurableSubscriber(compositeTopic, subName + &lt;span class=&quot;code-quote&quot;&gt;&quot;1&quot;&lt;/span&gt;);
TopicSubscriber durSub2 = session1.createDurableSubscriber(compositeTopic, subName + &lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I looked at a few ways to fix this and the simplest/best way I found is to split the composite destination into individual destinations and create a network demand subscription per destination instead of 1 for the entire composite destination. This solves the issue and allow conduit subscriptions to work and having demand be generated as intended. It also works correctly for durable subs as well.&#160;&lt;/p&gt;

&lt;p&gt;I have a PR and tests I will push up, the one caveat is the dynamically include destinations that are allowed need to use a wild card for the filter because of how the advisory filters work for consumers. Ie, the dynamically included list config should have a destination added such as &lt;tt&gt;my.topic.&amp;gt;&lt;/tt&gt;. This will allow composite consumers to work that use something like &lt;tt&gt;my.topic.test.1,my.topic.test.2&lt;/tt&gt;. Listing out individual topics do not work and would require much more work to fix.&lt;/p&gt;

&lt;p&gt;Lastly, I did not add a flag to optionally disable/enable this feature. I was thinking about it but this seems like a a bug that should just be fixed and I don&apos;t see a reason to keep the old broken behavior. The way it is now conduit subscriptions are completely broken so I think breaking the composite destination into individual for network subs is the correct fix and likely what we should just do. It&apos;s also probably an edge case since no one has reported a bug with it so probably not a big deal to change this behavior.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13538970">AMQ-9262</key>
            <summary>Composite consumers do not work properly with a network of brokers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="cshannon">Christopher L. Shannon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Jun 2023 23:03:56 +0000</created>
                <updated>Tue, 13 Jun 2023 12:11:04 +0000</updated>
                            <resolved>Wed, 7 Jun 2023 11:21:25 +0000</resolved>
                                    <version>5.18.1</version>
                                    <fixVersion>6.0.0</fixVersion>
                    <fixVersion>5.17.5</fixVersion>
                    <fixVersion>5.18.2</fixVersion>
                                    <component>Network of Brokers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17730069" author="jira-bot" created="Wed, 7 Jun 2023 11:18:28 +0000"  >&lt;p&gt;Commit 901956d4ddb6a0ea9fe5fedf39732117ab68f087 in activemq&apos;s branch refs/heads/main from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=901956d4dd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=901956d4dd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9262&quot; title=&quot;Composite consumers do not work properly with a network of brokers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9262&quot;&gt;&lt;del&gt;AMQ-9262&lt;/del&gt;&lt;/a&gt; - Fix network subscriptions for composite consumers (#1014)&lt;/p&gt;

&lt;p&gt;This fixes network subscriptions that are generated on demand when a&lt;br/&gt;
consumer uses composite destinations. Before this fix conduit&lt;br/&gt;
subscriptions didn&apos;t work correctly. This fix now splits up the&lt;br/&gt;
composite dest and generates correct demand for each of the individual&lt;br/&gt;
destinations.&lt;/p&gt;</comment>
                            <comment id="17730072" author="jira-bot" created="Wed, 7 Jun 2023 11:20:26 +0000"  >&lt;p&gt;Commit 04cb6585bde51818eff089a2823b20e9e4a62991 in activemq&apos;s branch refs/heads/activemq-5.18.x from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=04cb6585bd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=04cb6585bd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9262&quot; title=&quot;Composite consumers do not work properly with a network of brokers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9262&quot;&gt;&lt;del&gt;AMQ-9262&lt;/del&gt;&lt;/a&gt; - Fix network subscriptions for composite consumers (#1014)&lt;/p&gt;

&lt;p&gt;This fixes network subscriptions that are generated on demand when a&lt;br/&gt;
consumer uses composite destinations. Before this fix conduit&lt;br/&gt;
subscriptions didn&apos;t work correctly. This fix now splits up the&lt;br/&gt;
composite dest and generates correct demand for each of the individual&lt;br/&gt;
destinations.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 901956d4ddb6a0ea9fe5fedf39732117ab68f087)&lt;/p&gt;</comment>
                            <comment id="17730073" author="jira-bot" created="Wed, 7 Jun 2023 11:20:57 +0000"  >&lt;p&gt;Commit 1707cc194b1c74808c67ff54db8b909f8ef4b990 in activemq&apos;s branch refs/heads/activemq-5.17.x from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=1707cc194b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=1707cc194b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9262&quot; title=&quot;Composite consumers do not work properly with a network of brokers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9262&quot;&gt;&lt;del&gt;AMQ-9262&lt;/del&gt;&lt;/a&gt; - Fix network subscriptions for composite consumers (#1014)&lt;/p&gt;

&lt;p&gt;This fixes network subscriptions that are generated on demand when a&lt;br/&gt;
consumer uses composite destinations. Before this fix conduit&lt;br/&gt;
subscriptions didn&apos;t work correctly. This fix now splits up the&lt;br/&gt;
composite dest and generates correct demand for each of the individual&lt;br/&gt;
destinations.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 901956d4ddb6a0ea9fe5fedf39732117ab68f087)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1id6w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>