<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:34:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1272] Stomp protocol does not correctly check authentication (security hole)</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1272</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;ActiveMQ does not correctly validate the username and password of Stomp clients.  A security exception is generated, but ignored, leaving the client connected, and with full and unrestricted access to ActiveMQ.&lt;/p&gt;

&lt;p&gt;Further description, and a partial patch:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.nabble.com/Getting-Stomp-support-to-a-usable-state...-tf3858629s2354.html#a11060452&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.nabble.com/Getting-Stomp-support-to-a-usable-state...-tf3858629s2354.html#a11060452&lt;/a&gt; &lt;/p&gt;


&lt;p&gt;BTW, while the patch in the above post, is crude, however, leaving unauthenticated users connected with full-access makes ActiveMQ and Stomp pretty unusable.  So please apply the path, rather than do nothing.&lt;/p&gt;</description>
                <environment>&lt;p&gt;4.2-SNAPSHOT&lt;/p&gt;</environment>
        <key id="12483348">AMQ-1272</key>
            <summary>Stomp protocol does not correctly check authentication (security hole)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tom@samplonius.org">Tom Samplonius</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Jun 2007 06:25:45 +0000</created>
                <updated>Wed, 5 Oct 2011 14:33:55 +0000</updated>
                            <resolved>Wed, 5 Oct 2011 14:33:55 +0000</resolved>
                                    <version>5.0.0</version>
                                    <fixVersion>5.x</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12936459" author="jstrachan" created="Tue, 12 Jun 2007 09:48:09 +0000"  >&lt;p&gt;added an affected version&lt;/p&gt;</comment>
                            <comment id="12936213" author="tom@samplonius.org" created="Sat, 16 Jun 2007 08:09:45 +0000"  >&lt;p&gt;I have tested the patch that Pieter  posted, and it doesn&apos;t make any changed.&lt;/p&gt;

&lt;p&gt;It doesn&apos;t seem like this should be a hard problem to fix.  I&apos;d fix it, but I&apos;m wish I understand the interaction between the various protocol classes and the core.&lt;/p&gt;</comment>
                            <comment id="12936414" author="ijsklont" created="Fri, 22 Jun 2007 12:05:48 +0000"  >&lt;p&gt;I am the author of the patch mentioned. It worked for me (the patch was against apache-activemq-4.2-20070510.230653-54 snapshot). Without the patch applied, SecurityException&apos;s were already visible in the debug log, however the were silently dropped (there is a try/catch block somewhere in the connection handler that handles this. It then creates an ExceptionResponse which is passed to the handler in onStompConnect, where the response isn&apos;t checked anymore). If these were not visbile, I guess something else is wrong with the authentication setup.&lt;/p&gt;

&lt;p&gt;I&apos;m using the simple authenticator btw, but this shouldn&apos;t matter.&lt;/p&gt;</comment>
                            <comment id="12936520" author="tom@samplonius.org" created="Sun, 24 Jun 2007 05:57:57 +0000"  >&lt;p&gt;I have re-tested the patch.  I applied the patch (more or less) to activemq-5.0-20070621&lt;/p&gt;

&lt;p&gt;The behaviour is a bit strange.  A Stomp producer simply blocks (I&apos;m using Net::Stomp).  A Stomp consumer does too.  Very odd.  At least unauthenticated Stomp clients can&apos;t steal messages.&lt;/p&gt;

&lt;p&gt;I&apos;m going to try to attach my patch (context diff).&lt;/p&gt;</comment>
                            <comment id="12936467" author="tom@samplonius.org" created="Sun, 24 Jun 2007 06:02:01 +0000"  >&lt;p&gt;Patch to Stomp ProtocolConverter.java&lt;/p&gt;

&lt;p&gt;This is just an adapted from Pieter&apos;s patch, but to activemq-5.0-20070621, as a context diff.&lt;/p&gt;</comment>
                            <comment id="12936555" author="tom@samplonius.org" created="Sun, 24 Jun 2007 08:56:22 +0000"  >&lt;p&gt;Here is the config that I&apos;m using:&lt;/p&gt;

&lt;p&gt;    &amp;lt;plugins&amp;gt;&lt;br/&gt;
      &amp;lt;simpleAuthenticationPlugin&amp;gt;&lt;br/&gt;
         &amp;lt;users&amp;gt;&lt;br/&gt;
           &amp;lt;authenticationUser username=&quot;system&quot; password=&quot;manager&quot; groups=&quot;producers,consumers,admins&quot; /&amp;gt;&lt;br/&gt;
           &amp;lt;authenticationUser username=&quot;frontend&quot; password=&quot;manager&quot; groups=&quot;producers&quot; /&amp;gt;&lt;br/&gt;
           &amp;lt;authenticationUser username=&quot;backend&quot; password=&quot;manager&quot; groups=&quot;consumers&quot; /&amp;gt;&lt;br/&gt;
         &amp;lt;/users&amp;gt;&lt;br/&gt;
       &amp;lt;/simpleAuthenticationPlugin&amp;gt;&lt;br/&gt;
       &amp;lt;authorizationPlugin&amp;gt;&lt;br/&gt;
         &amp;lt;map&amp;gt;&lt;br/&gt;
           &amp;lt;authorizationMap&amp;gt;&lt;br/&gt;
             &amp;lt;authorizationEntries&amp;gt;&lt;br/&gt;
               &amp;lt;authorizationEntry queue=&quot;&amp;gt;&quot; read=&quot;backend&quot; write=&quot;frontend&quot; admin=&quot;admins&quot; /&amp;gt;&lt;br/&gt;
             &amp;lt;/authorizationEntries&amp;gt;&lt;br/&gt;
           &amp;lt;/authorizationMap&amp;gt;&lt;br/&gt;
         &amp;lt;/map&amp;gt;&lt;br/&gt;
       &amp;lt;/authorizationPlugin&amp;gt;&lt;br/&gt;
    &amp;lt;/plugins&amp;gt;&lt;/p&gt;</comment>
                            <comment id="12936460" author="tom@samplonius.org" created="Sun, 24 Jun 2007 09:48:27 +0000"  >&lt;p&gt;Just some further clarification.  activemq-5.0-20070621 with the patch has the following behavior:&lt;/p&gt;

&lt;p&gt;1.  If a Stomp client uses the wrong password and/or wrong user name, it will just block forever when trying to send to a destination.&lt;/p&gt;

&lt;p&gt;2.  If a Stomp client uses a matching username and password, but that user does not have permission to write to the queue (as in the above nonsensical auth configuration, where none of the groups match), ActiveMQ will just eat the message and log an exception for each message:&lt;/p&gt;

&lt;p&gt; ERROR Service                        - Async error occurred: java.lang.SecurityException: User system is not authorized to write to: queue://foo&lt;br/&gt;
java.lang.SecurityException: User system is not authorized to write to: queue://foo&lt;/p&gt;


&lt;p&gt;So the client is never disconnected, and never is sent an error.  It is a step in the right direction.&lt;/p&gt;</comment>
                            <comment id="12936528" author="ijsklont" created="Sun, 24 Jun 2007 14:23:54 +0000"  >&lt;p&gt;I&apos;m using the PHP Stomp client, that might explain the difference in the behaviour with incorrecht auth details. I don&apos;t have access to the setup right now, I will report the exact behaviour when I do. I guess it&apos;s possible that the Net::Stomp code expects a Stomp ERROR frame, which isn&apos;t sent, or a CONNECTED frame (which isn&apos;t sent either). Perhaps it&apos;s waiting for these frames, I don&apos;t know the code. I think in my case the socket was disconnected, but I&apos;m not sure. I will investigate.&lt;/p&gt;</comment>
                            <comment id="12936234" author="tom@samplonius.org" created="Mon, 16 Jul 2007 02:58:08 +0000"  >&lt;p&gt;Well, the Perl Net::Stomp client definitely notices if the socket goes away, because if I kill ActiveMQ, my client reports an immediate error:&lt;/p&gt;

&lt;p&gt;Error reading command:  at /usr/local/lib/perl5/site_perl/5.8.8/Net/Stomp/Frame.pm line 37, &amp;lt;GEN0&amp;gt; line 25076.&lt;/p&gt;


&lt;p&gt;This is expected though.  When the receive_frame() method is called, Net::Stomp does a blocking read on a socket.  If that socket is closed, the read will return with an error code.  And then the Net::Stomp kicks out an &quot;Error reading command&quot; exception.&lt;/p&gt;

&lt;p&gt;I have also retested this with a 5.0 snapshot from July 12, with the stomp.diff patch that I posed above.  The behavior is the same.  A Stomp client will just block during login.  I can see in netstat that there is a one 61613 socket open as well, so it is not definitely not being closed by ActiveMQ.&lt;/p&gt;
</comment>
                            <comment id="12939273" author="dejanb" created="Sun, 16 Dec 2007 20:12:05 +0000"  >&lt;p&gt;I&apos;ve refactored a ProtocolConverter, StompTest and added a few tests to make all this work.&lt;/p&gt;

&lt;p&gt;Here&apos;s a list of things that has been done:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added xbean resources to set up a test broker with configured authentication&lt;/li&gt;
	&lt;li&gt;modified existing tests to connect with system/manager user so that they have right privileges&lt;/li&gt;
	&lt;li&gt;modified protocolconverter.onStompConnect to send &quot;error&quot; frame on connect attempt with wrong credentials&lt;/li&gt;
	&lt;li&gt;modified protocolConverter.createResponseHandler to send &quot;error&quot; frame on security exception on any other command&lt;/li&gt;
	&lt;li&gt;added test cases to assert proper behavior on connect, send and subscribe&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12939263" author="chirino" created="Thu, 20 Dec 2007 14:39:57 +0000"  >&lt;p&gt;Applied Dejan&apos;s patch.&lt;/p&gt;</comment>
                            <comment id="12940076" author="drwoods" created="Mon, 25 Aug 2008 13:31:37 +0000"  >&lt;p&gt;This security fix also needs to be applied to the 4.1 branch, for users like Geronimo who have not upgraded to AMQ 5.1.0 yet.&lt;/p&gt;</comment>
                            <comment id="12940088" author="drwoods" created="Mon, 25 Aug 2008 13:39:55 +0000"  >&lt;p&gt;Patch created against branches/activemq-4.1  Rev647819 (current as of 20080825)&lt;/p&gt;</comment>
                            <comment id="12941613" author="gtully" created="Thu, 25 Jun 2009 09:22:50 +0000"  >&lt;p&gt;patch requested against 4.1.x  - fix is on on trunk.&lt;/p&gt;</comment>
                            <comment id="13121010" author="tabish121" created="Wed, 5 Oct 2011 14:33:55 +0000"  >&lt;p&gt;This has since been resolved&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12481860">AMQ-998</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12461107" name="AMQ1272-stomp-auth-v412.patch" size="18766" author="drwoods" created="Mon, 25 Aug 2008 13:39:55 +0000"/>
                            <attachment id="12461065" name="stomp-auth.patch" size="20681" author="dejanb" created="Sun, 16 Dec 2007 20:12:05 +0000"/>
                            <attachment id="12460712" name="stomp.diff" size="1836" author="tom@samplonius.org" created="Sun, 24 Jun 2007 06:02:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>46465</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 7 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0am4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59859</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>