<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:49:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3094] ajax client does not receive all messages</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3094</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Not all messages written to a destination are delivered to an ajax client.  This seems particularly true if more than 1 message should be returned to a client at once.  Often, if 5 messages are available, only the first 1 is actually returned in the &amp;lt;ajax-response&amp;gt; XML.  The other 4 are lost.&lt;/p&gt;

&lt;p&gt;Steps to reproduce:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Place the attached chat-sent.html in activemq/webapps/demo/  (or in activemq-trunk/activemq-web-demo/src/main/webapp in an svn working copy).&lt;/li&gt;
	&lt;li&gt;Start ActiveMQ.&lt;/li&gt;
	&lt;li&gt;Browse to &lt;a href=&quot;http://localhost:8161/demo/chat.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8161/demo/chat.html&lt;/a&gt; &amp;amp; join the chat room.&lt;/li&gt;
	&lt;li&gt;In a new window, browse to &lt;a href=&quot;http://localhost:8161/demo/chat-send.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8161/demo/chat-send.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;chat-send.html will send 5 message to topic://CHAT.DEMO.  Only 1 (or sometimes 2) messages will be received by the original browser window which is subscribed to the topic.  The activemq web admin will verify that 5 messages were actually sent.&lt;/p&gt;</description>
                <environment>&lt;p&gt;OSX 10.6 on MacBook Pro&lt;/p&gt;

&lt;p&gt;java version &quot;1.6.0_20&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0_20-b02-279-10M3065)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 16.3-b01-279, mixed mode)&lt;/p&gt;</environment>
        <key id="12493543">AMQ-3094</key>
            <summary>ajax client does not receive all messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dejanb">Dejan Bosanac</assignee>
                                    <reporter username="alexdean">Alex Dean</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Dec 2010 18:29:16 +0000</created>
                <updated>Mon, 12 May 2014 17:09:00 +0000</updated>
                            <resolved>Fri, 28 Jan 2011 15:26:18 +0000</resolved>
                                    <version>5.4.2</version>
                                    <fixVersion>5.5.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12972580" author="alexdean" created="Fri, 17 Dec 2010 18:30:20 +0000"  >&lt;p&gt;Test file which publishes 5 messages to topic://CHAT.DEMO.&lt;/p&gt;</comment>
                            <comment id="12972600" author="alexdean" created="Fri, 17 Dec 2010 19:10:55 +0000"  >&lt;p&gt;Attached test case does the following:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;publishes 3 messages to queue://test&lt;/li&gt;
	&lt;li&gt;subscribes to queue://test using an http POST to the AjaxServlet&lt;/li&gt;
	&lt;li&gt;polls for messages&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The results of the test are inconsistent.  Sometimes the client receives all messages, sometimes the client receives 0 messages.  (See attached test output in AjaxTest-output.txt.)  These results are not consistent with what I&apos;m seeing in JavaScript testing, where I always seem to receive at least one message, but still provide some documentation for the issue.&lt;/p&gt;</comment>
                            <comment id="12972666" author="alexdean" created="Fri, 17 Dec 2010 22:10:30 +0000"  >&lt;p&gt;In AjaxTest-output.txt, also note that for the test runs where no messages are received also show 2 GET requests being made.  The test run where all messages are received shows only a single GET request.  I&apos;m not sure what that means, given that the test has only a single GET.&lt;/p&gt;</comment>
                            <comment id="12974442" author="alexdean" created="Wed, 22 Dec 2010 23:52:12 +0000"  >&lt;p&gt;I added 1 debugging statement to MessageListenerServlet.writeMessageResponse.  (See attached patch &amp;amp; sample output.)  The output shows that several individual messages sent from another web client are contained in properties of this single ActiveMQTextMessage.  This seems very likely to be the root cause of the problem.&lt;/p&gt;

&lt;p&gt;Is this normal behavior, and we need to search all properties of a TextMessage when writing a response to a client?  Or is it that we need to send messages differently so each &apos;send&apos; POST actually creates a distinct TextMessage?&lt;/p&gt;</comment>
                            <comment id="12974618" author="dejanb" created="Thu, 23 Dec 2010 13:22:31 +0000"  >&lt;p&gt;Fixed with svn revision 1052259.&lt;/p&gt;

&lt;p&gt;The problem was that messages received between POST and GET calls were ignored. That should be fixed now. I modified a provided test a bit to demonstrate this issue every time.&lt;/p&gt;

&lt;p&gt;Thanks for the great work!&lt;/p&gt;</comment>
                            <comment id="12974789" author="alexdean" created="Thu, 23 Dec 2010 23:47:30 +0000"  >&lt;p&gt;Dejan: Take a look at the message properties in &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12466851/write_message_response_debugging_output.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12466851/write_message_response_debugging_output.txt&lt;/a&gt;.  There are four messages here, but only 1 of them gets delivered.&lt;/p&gt;

&lt;p&gt;The interesting bits are these:&lt;br/&gt;
  message=&amp;lt;message type=&quot;chat&quot; from=&quot;test-user&quot;&amp;gt;message two&amp;lt;/message&amp;gt;&lt;br/&gt;
  text = &amp;lt;message type=&quot;chat&quot; from=&quot;test-user&quot;&amp;gt;message five&amp;lt;/message&amp;gt;&lt;br/&gt;
  destination = topic://CHAT.DEMO&lt;br/&gt;
  m1=&amp;lt;message type=&quot;chat&quot; from=&quot;test-user&quot;&amp;gt;message three&amp;lt;/message&amp;gt;&lt;br/&gt;
  m2=&amp;lt;message type=&quot;chat&quot; from=&quot;test-user&quot;&amp;gt;message four&amp;lt;/message&amp;gt;&lt;br/&gt;
  m3=&amp;lt;message type=&quot;chat&quot; from=&quot;test-user&quot;&amp;gt;message five&amp;lt;/message&amp;gt;&lt;br/&gt;
  t1=send&lt;br/&gt;
  t3=send&lt;br/&gt;
  t2=send&lt;br/&gt;
  d1=topic://CHAT.DEMO&lt;br/&gt;
  d2=topic://CHAT.DEMO&lt;br/&gt;
  d3=topic://CHAT.DEMO&lt;/p&gt;

&lt;p&gt;When an ajax client sends many messages in a short amount of time, they are then delivered to other clients in a single ActiveMQTextMessage.  writeMessageResponse() doesn&apos;t handle this properly, and only delivers one of the messages to a subscriber.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if this is a problem on the sending or receiving side.  (Is it legitimate to have multiple messages piled into a single ActiveMQTextMessage like this?)  I agree the junit test now passes, but I don&apos;t think the issue is resolved yet.  I&apos;ll work on getting some more tests created which reproduce this issue.  For now, you should be able to reproduce it using the chat-send.html script I&apos;ve already attached to the ticket.&lt;/p&gt;</comment>
                            <comment id="12977931" author="alexdean" created="Wed, 5 Jan 2011 19:44:54 +0000"  >&lt;p&gt;Attached test shows that an ajax client will miss messages which arrive while an ajax poll request is in progress.&lt;/p&gt;

&lt;p&gt;This test uses org.eclipse.jetty.client.HttpClient rather than org.apache.commons.httpclient.HttpClient.  I was able to get session handling working with the Jetty HttpClient, and it&apos;s much better at async requests than the commons HttpClient.&lt;/p&gt;

&lt;p&gt;I sometimes see an org.eclipse.jetty.io.EofException in the poll request.  The cause is unclear.  Sometimes the error disappears simply by re-running the test.  Sometimes doing a recompile of activemq-trunk/activemq-web and then re-running the test causes the error to disappear.&lt;/p&gt;</comment>
                            <comment id="12977932" author="alexdean" created="Wed, 5 Jan 2011 19:46:11 +0000"  >&lt;p&gt;Sample test output showing the presence/absence of the EofException I noted.&lt;/p&gt;</comment>
                            <comment id="12978948" author="alexdean" created="Fri, 7 Jan 2011 20:27:54 +0000"  >&lt;p&gt;Patch will allow an ajax client to receive all messages.  Several other tests are included for previously-untested ajax code.&lt;/p&gt;

&lt;p&gt;The following tests fail w/o the patch:&lt;br/&gt;
  testAjaxClientReceivesMessagesWhichAreSentToQueueWhileClientIsPolling&lt;br/&gt;
  testAjaxClientReceivesMessagesWhichAreSentToTopicWhileClientIsPolling&lt;br/&gt;
  testStompMessagesAreReceivedByAjaxClient&lt;/p&gt;</comment>
                            <comment id="12979612" author="alexdean" created="Mon, 10 Jan 2011 15:47:37 +0000"  >&lt;p&gt;Updated my svn working copy &amp;amp; re-generated patch due to request from Jeff Rose.  Now based on trunk r1057227.&lt;/p&gt;</comment>
                            <comment id="12979614" author="alexdean" created="Mon, 10 Jan 2011 15:55:51 +0000"  >&lt;p&gt;Updated my svn working copy &amp;amp; re-generated patch due to request from Jeff Rose. Now based on trunk r1057227.  Previous version of this patch (w/ identical file name) was missing 1 test which should not have been omitted.&lt;/p&gt;</comment>
                            <comment id="12988105" author="alexdean" created="Fri, 28 Jan 2011 15:26:18 +0000"  >&lt;p&gt;Resolved in svn revision 1064725.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="12530969">AMQ-3585</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12713666">AMQ-5182</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12467892" name="all_messages_are_delivered_to_ajax_clients.2.patch" size="29423" author="alexdean" created="Mon, 10 Jan 2011 15:55:51 +0000"/>
                            <attachment id="12467757" name="all_messages_are_delivered_to_ajax_clients.patch" size="29423" author="alexdean" created="Fri, 7 Jan 2011 20:27:54 +0000"/>
                            <attachment id="12466479" name="chat-send.html" size="2855" author="alexdean" created="Fri, 17 Dec 2010 18:30:20 +0000"/>
                            <attachment id="12466485" name="include-commons-httpclient-in-pom-xml.patch" size="466" author="alexdean" created="Fri, 17 Dec 2010 19:10:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14715</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 43 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ak5b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59537</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>