<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:00:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4598] Negative JMX QueueSize attribute in due to purging a queue</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4598</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;If you purge a queue that has a bunch of messages prefetched you may end up with a negative QueueSize in JMX as the prefetched messages get acked after the purge. &lt;br/&gt;
This behavior should be considered a bug as many users depend on these JMX statistics.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12654707">AMQ-4598</key>
            <summary>Negative JMX QueueSize attribute in due to purging a queue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dejanb">Dejan Bosanac</assignee>
                                    <reporter username="dejanb">Dejan Bosanac</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Jun 2013 11:43:16 +0000</created>
                <updated>Thu, 3 Nov 2016 22:09:02 +0000</updated>
                            <resolved>Tue, 25 Jun 2013 11:49:36 +0000</resolved>
                                    <version>5.8.0</version>
                                    <fixVersion>5.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13692951" author="dejanb" created="Tue, 25 Jun 2013 11:49:36 +0000"  >&lt;p&gt;Fixed with svn revision 1496430&lt;/p&gt;</comment>
                            <comment id="14324048" author="metatech" created="Tue, 17 Feb 2015 10:54:14 +0000"  >&lt;p&gt;This fix works, but the queue size hides all the inflight messages because the counter goes immediately to 0, although inflight messages are still being processed.&lt;br/&gt;
The behaviour is different when a queue is not purged (all inflight messages are counted in) and when a queue is purged (inflight messages are not counted in).  &lt;br/&gt;
This would be more consistent to always reset the counter to the number of inflight messages in the queue (see attachment amq_negative_queue_size_after_purge.diff)&lt;/p&gt;</comment>
                            <comment id="14324058" author="githubbot" created="Tue, 17 Feb 2015 11:03:50 +0000"  >&lt;p&gt;GitHub user metatechbe opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/62&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/62&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4598&quot; title=&quot;Negative JMX QueueSize attribute in due to purging a queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4598&quot;&gt;&lt;del&gt;AMQ-4598&lt;/del&gt;&lt;/a&gt; purge enhancement&lt;/p&gt;

&lt;p&gt;    Reset queue counter during &quot;purge&quot; to the number of inflight messages, so that they are not &quot;hidden&quot; while still being processed.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/metatechbe/activemq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/metatechbe/activemq&lt;/a&gt; patch-1&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/62.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/62.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #62&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 752573dbee35a86cb83ceaed1c122e878f298d27&lt;br/&gt;
Author: metatechbe &amp;lt;metatechbe@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-02-17T11:03:42Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4598&quot; title=&quot;Negative JMX QueueSize attribute in due to purging a queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4598&quot;&gt;&lt;del&gt;AMQ-4598&lt;/del&gt;&lt;/a&gt; purge enhancement&lt;/p&gt;

&lt;p&gt;    Reset queue counter during &quot;purge&quot; to the number of inflight messages, so that they are not &quot;hidden&quot; while still being processed.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15634458" author="githubbot" created="Thu, 3 Nov 2016 22:09:02 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/62&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/62&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12494539">AMQ-3111</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12519968">AMQ-3472</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12699237" name="amq_negative_queue_size_after_purge.diff" size="577" author="metatech" created="Tue, 17 Feb 2015 10:54:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334984</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 2 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ls7z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335308</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>