<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:01:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4683] Scheduler discards overdue messages on startup</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4683</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When message is scheduled for a delivery (using AMQ_SCHEDULED_PERIOD property) it is not posted to the queue, but saved to the scheduler&#8217;s repository instead. If Broker instance is shut down at the time for which the message is scheduled for a delivery, the scheduler will try to process the message at the next time broker is started up. Due to a bug in the scheduler implementation such messages may be dismissed rather than posted to the queue depending on the racing conditions inside the JVM.&lt;/p&gt;

&lt;p&gt;Actual bug resides in org.apache.activemq.broker.scheduler.SchedulerBroker.getInternalScheduler() method. &lt;br/&gt;
This method first calls JobSchedulerStoreImpl. getJobScheduler(String name) method which in turn creates an instance of runnable JobSchedulerImpl class and starts it.&lt;br/&gt;
Then SchedulerBroker registers itselfas a listener of the newly created JobSchedulerImpl.&lt;br/&gt;
Unfortunately this may happen after the JobSchedulerImpl have dismissed all the &#8220;missed&#8221; tasks as &#8220;fired&#8221; as there were no listeners configured.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 7 64bit, JDK 1.6.0_26&lt;/p&gt;</environment>
        <key id="12663657">AMQ-4683</key>
            <summary>Scheduler discards overdue messages on startup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="andrey.zavodnik">Andrey Zavodnik</reporter>
                        <labels>
                            <label>scheduler</label>
                    </labels>
                <created>Wed, 14 Aug 2013 14:07:05 +0000</created>
                <updated>Fri, 4 Oct 2013 13:13:48 +0000</updated>
                            <resolved>Fri, 23 Aug 2013 16:04:09 +0000</resolved>
                                    <version>5.8.0</version>
                                    <fixVersion>5.9.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13739693" author="andrey.zavodnik" created="Wed, 14 Aug 2013 14:10:32 +0000"  >&lt;p&gt;Test case. As the issue affected by race condition, the test may not fail every time, but it does fail often&lt;/p&gt;</comment>
                            <comment id="13739695" author="andrey.zavodnik" created="Wed, 14 Aug 2013 14:13:37 +0000"  >&lt;p&gt;This issue assumes that this is an intended behaviour, but looking at the code it is obvious that it was intended that messages that have missed their delivery time will be posted upon system start up.&lt;/p&gt;</comment>
                            <comment id="13747815" author="tabish121" created="Thu, 22 Aug 2013 19:45:52 +0000"  >&lt;p&gt;Fixed on trunk, thanks for the great test.  &lt;/p&gt;</comment>
                            <comment id="13748380" author="andrey.zavodnik" created="Fri, 23 Aug 2013 08:08:06 +0000"  >&lt;p&gt;The current fix (revision 1516561) makes JobSchedulerImpl to wait on a semaphore until the &quot;main&quot; thread executes either doStart() or addListener().&lt;br/&gt;
This fix has two big issues:&lt;br/&gt;
1. If the &quot;main&quot; thread manages to execute addListener() before the JobSchedulerImpl thread arrives to semaphore wait() point, the JobSchedulerImpl thread will be blocked indefinitely.&lt;br/&gt;
2. JobSchedulerImpl is designed to accept an arbitrary number of listeners. This solution will only work when there is exactly one. If zero, worker will be blocked. If more than one, there is a chance that listeners number 2 and over will not receive a notification, just like the first one didn&apos;t in the original bug.&lt;/p&gt;</comment>
                            <comment id="13748658" author="tabish121" created="Fri, 23 Aug 2013 16:04:00 +0000"  >&lt;p&gt;Case 1 analysis is incorrect.&lt;br/&gt;
Case 2 is true although the broker implementation doesn&apos;t currently use more than one listener so it wouldn&apos;t happen this way. &lt;/p&gt;

&lt;p&gt;I&apos;ve made some changes to make the start of dispatching separate from starting the store.  Now the start of dispatch occurs when the SchedulerBroker is started and is stopped when its stopped.  Any listener added after the broker could miss jobs but that&apos;s an inherent trait in any event based model. &lt;/p&gt;</comment>
                            <comment id="13748659" author="tabish121" created="Fri, 23 Aug 2013 16:04:26 +0000"  >&lt;p&gt;Fixed on trunk, make future enhancement requests in new issues. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12648934">AMQ-4550</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12672233">AMQ-4783</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12648934">AMQ-4550</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12597975" name="LostScheduledMessagesTest.java" size="4401" author="andrey.zavodnik" created="Wed, 14 Aug 2013 14:10:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>343658</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1n9k7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>343962</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>