<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:37:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1796] expired messages not moved to DLQ on trunk (5.2)</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1796</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Expired messages (transient) are not moved to DLQ on trunk (667098).&lt;/p&gt;

&lt;p&gt;Following tests are failing:&lt;br/&gt;
Running org.apache.activemq.broker.policy.IndividualDeadLetterTest&lt;br/&gt;
Tests run: 4, Failures: 2, Errors: 0, Skipped: 0, Time elapsed: 4.172 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
Running org.apache.activemq.broker.policy.MessageListenerDeadLetterTest&lt;br/&gt;
Tests run: 4, Failures: 2, Errors: 0, Skipped: 0, Time elapsed: 9.469 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
Running org.apache.activemq.broker.policy.DeadLetterTest&lt;br/&gt;
Tests run: 4, Failures: 2, Errors: 0, Skipped: 0, Time elapsed: 4.359 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
Running org.apache.activemq.camel.CamelJmsTest&lt;br/&gt;
Tests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 2.203 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
Running org.apache.activemq.broker.policy.IndividualDeadLetterViaXmlTest&lt;br/&gt;
Tests run: 4, Failures: 2, Errors: 0, Skipped: 0, Time elapsed: 4.734 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;/p&gt;</description>
                <environment></environment>
        <key id="12483174">AMQ-1796</key>
            <summary>expired messages not moved to DLQ on trunk (5.2)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="mlukica">Mario Lukica</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Jun 2008 14:43:51 +0000</created>
                <updated>Mon, 7 Dec 2009 19:47:09 +0000</updated>
                            <resolved>Wed, 9 Jul 2008 06:36:15 +0000</resolved>
                                    <version>5.2.0</version>
                                    <fixVersion>5.2.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12939775" author="mlukica" created="Thu, 12 Jun 2008 15:05:08 +0000"  >&lt;p&gt;Additional info:&lt;/p&gt;

&lt;p&gt;After expiration on original queue:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;messages are removed from original queue (although not moved to DLQ)&lt;/li&gt;
	&lt;li&gt;queue size is decremented&lt;/li&gt;
	&lt;li&gt;DequeueCount is not incremented&lt;/li&gt;
	&lt;li&gt;CursorMemoryUsage and MemoryPercentUsage are not decremented (statistics is not updated)&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12939822" author="rajdavies" created="Mon, 16 Jun 2008 12:59:07 +0000"  >&lt;p&gt;In 5.2 the Default Dead Letter strategy has changed - to not send to a DLQ non-persistent messages by default&lt;/p&gt;

&lt;p&gt;Fixes to test cases etc in SVN revision 668146&lt;/p&gt;</comment>
                            <comment id="12939928" author="gtully" created="Thu, 3 Jul 2008 11:28:51 +0000"  >&lt;p&gt;seeing a classcast exception after these changes.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SEVERE: Failed to page in more queue messages
java.lang.ClassCastException: org.apache.activemq.command.ActiveMQBytesMessage
at org.apache.activemq.broker.region.Queue.messageExpired(Queue.java:1045)
at org.apache.activemq.broker.region.Queue.messageExpired(Queue.java:1037)
at org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:1117)
at org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1196)
at org.apache.activemq.broker.region.Queue.iterate(Queue.java:951)
at org.apache.activemq.thread.DeterministicTaskRunner.runTask(DeterministicTaskRunner.java:84)
at org.apache.activemq.thread.DeterministicTaskRunner$1.run(DeterministicTaskRunner.java:41)
at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:650)
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:675)
at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:595)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;fix seems to be:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Index: src/main/java/org/apache/activemq/broker/region/Queue.java
===================================================================
--- src/main/java/org/apache/activemq/broker/region/Queue.java  (revision 673649)
+++ src/main/java/org/apache/activemq/broker/region/Queue.java  (working copy)
@@ -1114,7 +1114,7 @@
                                 result.add(ref);
                                 count++;
                             } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
-                                messageExpired(createConnectionContext(), node);
+                                messageExpired(createConnectionContext(), createMessageReference(node.getMessage()));
                             }
                         }
                     } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12939925" author="gtully" created="Tue, 8 Jul 2008 14:12:03 +0000"  >&lt;p&gt;reopen till classcast exception is resolved, patch in the comment.&lt;/p&gt;</comment>
                            <comment id="12939891" author="rajdavies" created="Wed, 9 Jul 2008 06:36:15 +0000"  >&lt;p&gt;Resolved by SVN revision 675104&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95907</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 20 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tsxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>171996</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>