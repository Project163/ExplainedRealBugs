<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:45:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-7219] ActiveMQ replays journal file on a clean/unclean shutdown with transacted session + Non persistent Messages</title>
                <link>https://issues.apache.org/jira/browse/AMQ-7219</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Sending non persistent messages on a Transacted session is causing activeMQ to keep and replay (on startup) unnecessary journal files. If all messages are in this situation activemq will replay the whole journal file even with a clean shutdown.&lt;/p&gt;

&lt;p&gt;&#160;The problem is because is if the transaction has no persistent operation, the&#160;metadata.lastUpdate is never updated.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/activemq/blob/master/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java#L1400&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/master/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java#L1400&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13236391">AMQ-7219</key>
            <summary>ActiveMQ replays journal file on a clean/unclean shutdown with transacted session + Non persistent Messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="alanprot">Alan Protasio</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 May 2019 03:00:41 +0000</created>
                <updated>Fri, 31 May 2019 17:14:09 +0000</updated>
                            <resolved>Fri, 31 May 2019 09:07:13 +0000</resolved>
                                    <version>5.15.9</version>
                                    <fixVersion>5.16.0</fixVersion>
                                    <component>KahaDB</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                <comments>
                            <comment id="16852838" author="jira-bot" created="Fri, 31 May 2019 09:03:07 +0000"  >&lt;p&gt;Commit bce979349ea9be499d1a686582e8638d369251d1 in activemq&apos;s branch refs/heads/master from Alan Protasio&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=bce9793&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=bce9793&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7219&quot; title=&quot;ActiveMQ replays journal file on a clean/unclean shutdown with transacted session + Non persistent Messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7219&quot;&gt;&lt;del&gt;AMQ-7219&lt;/del&gt;&lt;/a&gt; - ActiveMQ replays journal file on a clean/unclean shutdown with transacted session + Non persistent Messages&lt;/p&gt;</comment>
                            <comment id="16852839" author="jira-bot" created="Fri, 31 May 2019 09:03:08 +0000"  >&lt;p&gt;Commit f5db964e86fc26bae00118f3342353b396fecf15 in activemq&apos;s branch refs/heads/master from Gary Tully&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=f5db964&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=f5db964&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #363 from alanprot/fix/empty-transaction&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7219&quot; title=&quot;ActiveMQ replays journal file on a clean/unclean shutdown with transacted session + Non persistent Messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7219&quot;&gt;&lt;del&gt;AMQ-7219&lt;/del&gt;&lt;/a&gt; - ActiveMQ replays journal file on a clean/unclean shutdown &#8230;&lt;/p&gt;</comment>
                            <comment id="16852844" author="gtully" created="Fri, 31 May 2019 09:07:13 +0000"  >&lt;p&gt;looks good.&lt;/p&gt;

&lt;p&gt;it does beg the question; can we bypass the journal write for the empty commit, maybe that is something for future work.&#160;It would not be a trivial change, but maybe something to consider.&lt;/p&gt;</comment>
                            <comment id="16853228" author="alanprot" created="Fri, 31 May 2019 17:14:09 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&#160;thought the same about skipping the write of the commit command for empty transactions.. But it would be a larger change... Probably we would have to create another visitor to execute the write and call it &lt;span class=&quot;error&quot;&gt;&amp;#91;here&amp;#93;&lt;/span&gt;(&lt;a href=&quot;https://github.com/apache/activemq/blob/master/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java#L1133&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/master/activemq-kahadb-store/src/main/java/org/apache/activemq/store/kahadb/MessageDatabase.java#L1133&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;This would be an optimization though..&#160;&#160;I can create another Jira and do this if you think it worth!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z037q0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>