<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:38:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1489] discoveryUri in transportConnector and uri in networkConnector partially ignored if multicast</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1489</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;This bug relates to the MulticastDiscoveryAgent and was discovered when &lt;/p&gt;

&lt;p&gt;1. the discoveryUri of a transportConnector is a multicast-uri such as&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;transportConnector uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;...&quot;&lt;/span&gt; discoveryUri=&lt;span class=&quot;code-quote&quot;&gt;&quot;multicast://239.3.7.0:37000&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or&lt;/p&gt;

&lt;p&gt;2. the uri of a networkConnector is a multicast-uri such as&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;networkConnector name=&lt;span class=&quot;code-quote&quot;&gt;&quot;...&quot;&lt;/span&gt; uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;multicast://239.3.7.0:37000&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In these cases, the uri is partially ignored by the MulticastDiscoveryAgent: the host-name of the uri (239.3.7.0) is extracted and used as the group name by the MulticastDiscoveryAgent. But the actual multicast group IP is always 239.255.2.3 and the multicast port is always 6155, regardless of what the actual uri is in the configuration.&lt;/p&gt;

&lt;p&gt;The reason for this is that MulticastDiscoveryAgentFactory creates a new MulticastDiscoveryAgent and sets the group based on the uri&apos;s host, but fails to set the discoveryURI itself. MulticastDiscoveryAgentFactory should be corrected to do this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;MulticastDiscoveryAgent rc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MulticastDiscoveryAgent();
rc.setDiscoveryURI(uri); &lt;span class=&quot;code-comment&quot;&gt;// missing
&lt;/span&gt;rc.setGroup(uri.getHost());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Without the above setting of the discoveryURI the MulticastDiscoveryAgent always uses the DEFAULT_DISCOVERY_URI_STRING which is &quot;multicast://239.255.2.3:6155&quot;, explaining the erroneous behaviour described above.&lt;/p&gt;

&lt;p&gt;  kind regards,&lt;br/&gt;
  gerald&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.gerald-loeffler.net&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.gerald-loeffler.net&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12482730">AMQ-1489</key>
            <summary>discoveryUri in transportConnector and uri in networkConnector partially ignored if multicast</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="geraldloeffler">Gerald Loeffler</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Nov 2007 12:20:42 +0000</created>
                <updated>Tue, 23 Dec 2008 09:45:48 +0000</updated>
                            <resolved>Mon, 8 Sep 2008 11:31:24 +0000</resolved>
                                    <version>4.1.1</version>
                    <version>5.0.0</version>
                                    <fixVersion>5.2.0</fixVersion>
                                    <component>Connector</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12939403" author="djencks" created="Mon, 24 Mar 2008 23:09:31 +0000"  >&lt;p&gt;Fixed rev 640636.&lt;/p&gt;</comment>
                            <comment id="12939423" author="aricooperman" created="Fri, 28 Mar 2008 14:31:49 +0000"  >&lt;p&gt;This fix is missing in 5.+&lt;/p&gt;</comment>
                            <comment id="12939457" author="djencks" created="Fri, 28 Mar 2008 19:32:20 +0000"  >&lt;p&gt;I&apos;m no expert in how this is supposed to work, but the comment in the trunk code makes me wonder if the patch is correct.&lt;/p&gt;

&lt;p&gt;Without the patch, a URI with ?discoveryURI=foo will result in setting the discoveryURI and other URIs will use the default.&lt;/p&gt;

&lt;p&gt;With the patch, IIUC, the default will never be used.&lt;/p&gt;</comment>
                            <comment id="12939448" author="djencks" created="Sat, 29 Mar 2008 16:39:35 +0000"  >&lt;p&gt;After further thought I&apos;ve reverted the patch as I think it can&apos;t possibly be correct to always overwrite the default multicast info.  I don&apos;t understand how this is supposed to work well enough to fix it without help.&lt;/p&gt;

&lt;p&gt;It looks to me as if it is possible to specify the discoveryURI with the current code by using configurations like&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;transportConnector uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;...&quot;&lt;/span&gt; discoveryUri=&lt;span class=&quot;code-quote&quot;&gt;&quot;multicast:&lt;span class=&quot;code-comment&quot;&gt;//239.3.7.0:37000?discoveryURI=multicast://239.3.7.0:37000&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;networkConnector name=&lt;span class=&quot;code-quote&quot;&gt;&quot;...&quot;&lt;/span&gt; uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;multicast:&lt;span class=&quot;code-comment&quot;&gt;//239.3.7.0:37000?discoveryURI=multicast://239.3.7.0:37000&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;i.e. specifying the discoveryURI as a uri query parameter even when directly specifying the discoveryURI.  If this is the expected usage then perhaps a documentation update is what is required, although the first example looks weird to me.  Perhaps a flag as to whether the uri is intended to be the discovery URI would be more appropriate or perhaps the code processing the first case could add the discoveryURI as a parameter itself.&lt;/p&gt;</comment>
                            <comment id="12939450" author="djencks" created="Mon, 7 Apr 2008 22:22:01 +0000"  >&lt;p&gt;Did not get fixed in 4.1.2&lt;/p&gt;</comment>
                            <comment id="12939988" author="joef" created="Thu, 17 Jul 2008 15:38:07 +0000"  >&lt;p&gt;Submitted the patch for review. With this patch, you don&apos;t have to use a query parameter to specify a host:port. You can simply specify it  as follows: multicast://&amp;lt;host&amp;gt;:&amp;lt;port&amp;gt;. However, the patch doesn&apos;t preclude you from specifying the discoveryURI via a query paramter; doing so will override &amp;lt;host&amp;gt;:&amp;lt;port&amp;gt; provided via the URI.  &lt;/p&gt;

&lt;p&gt;Also, the default group value, which is &quot;default&quot;, can only be overriden via a query parameter; as I think it should. For example, with the URI below, the agent will end up using the default IP and port number, but is given a group name of &quot;foo&quot;.  &lt;/p&gt;

&lt;p&gt;multicast://default?group=foo &lt;/p&gt;</comment>
                            <comment id="12940169" author="rajdavies" created="Fri, 5 Sep 2008 05:48:22 +0000"  >&lt;p&gt;Patch applied in SVN revision 692340&lt;/p&gt;</comment>
                            <comment id="12940180" author="gtully" created="Fri, 5 Sep 2008 20:42:36 +0000"  >&lt;p&gt;bunch of unit test failures (14) with this fix, needs some investigation. eg BrokerServiceTest&lt;br/&gt;
java.net.UnknownHostException: group-1220646703756: group-1220646703756&lt;br/&gt;
	at java.net.InetAddress.getAllByName0(InetAddress.java:1145)&lt;br/&gt;
	at java.net.InetAddress.getAllByName(InetAddress.java:1072)&lt;br/&gt;
	at java.net.InetAddress.getAllByName(InetAddress.java:1008)&lt;br/&gt;
	at java.net.InetAddress.getByName(InetAddress.java:958)&lt;br/&gt;
	at org.apache.activemq.transport.discovery.multicast.MulticastDiscoveryAgent.start(MulticastDiscoveryAgent.java:300)&lt;br/&gt;
	at org.apache.activemq.network.DiscoveryNetworkConnector.handleStart(DiscoveryNetworkConnector.java:164)&lt;br/&gt;
	at org.apache.activemq.network.NetworkConnector$1.doStart(NetworkConnector.java:56)&lt;br/&gt;
	at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:53)&lt;br/&gt;
	at org.apache.activemq.network.NetworkConnector.start(NetworkConnector.java:197)&lt;br/&gt;
	at org.apache.activemq.broker.BrokerService.startAllConnectors(BrokerService.java:1873)&lt;br/&gt;
	at org.apache.activemq.broker.BrokerService.start(BrokerService.java:480)&lt;br/&gt;
	at org.apache.activemq.broker.BrokerServiceTest.testAddRemoveNetworkWithJMX(BrokerServiceTest.java:58)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
	at junit.framework.TestCase.runTest(TestCase.java:154)&lt;br/&gt;
	at junit.framework.TestCase.runBare(TestCase.java:127)&lt;br/&gt;
	at junit.framework.TestResult$1.protect(TestResult.java:106)&lt;br/&gt;
	at junit.framework.TestResult.runProtected(TestResult.java:124)&lt;br/&gt;
	at junit.framework.TestResult.run(TestResult.java:109)&lt;br/&gt;
	at junit.framework.TestCase.run(TestCase.java:118)&lt;br/&gt;
	at junit.framework.TestSuite.runTest(TestSuite.java:208)&lt;br/&gt;
	at junit.framework.TestSuite.run(TestSuite.java:203)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.junit3.JUnit3TestReference.run(JUnit3TestReference.java:130)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:460)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:673)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:386)&lt;br/&gt;
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:196)&lt;/p&gt;
</comment>
                            <comment id="12940188" author="gtully" created="Mon, 8 Sep 2008 11:31:24 +0000"  >&lt;p&gt;a bunch of unit tests made use of the group being taken from the unused host portion of the url. changing them to default?group=&quot;&quot; resolved the failures. FWIR the group was added to help test isolation on the same subnet.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461095" name="patchfile.txt" size="5248" author="joef" created="Thu, 17 Jul 2008 15:38:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84528</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s25r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161826</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>