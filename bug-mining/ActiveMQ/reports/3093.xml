<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:41:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6796] Acknowledging messages out of order in a STOMP 1.1 transaction raises exception</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6796</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Reproducing the problem:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Receive two messages via STOMP on a subscription with ack:client-individual&lt;/li&gt;
	&lt;li&gt;Start a transaction&lt;/li&gt;
	&lt;li&gt;Acknowledge message #2&lt;/li&gt;
	&lt;li&gt;Acknowledge message #1&lt;/li&gt;
	&lt;li&gt;Commit the transaction&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Expected behaviour:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Both messages are acknowledged, life goes on&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Observed behaviour:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Exception is raised&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;{{javax.jms.JMSException: Unmatched acknowledge: MessageAck &lt;/p&gt;
{commandId = 0, responseRequired = false, ackType = 2, consumerId = ID:(...)-6:555:-1:1, firstMessageId = null, lastMessageId = ID:(...)-6:555:-1:1:1, destination = queue://(...), transactionId = null, messageCount = 2, poisonCause = null}
&lt;p&gt;; Expected message count (2) differs from count in dispatched-list (1)&lt;br/&gt;
  	at org.apache.activemq.broker.region.PrefetchSubscription.assertAckMatchesDispatched(PrefetchSubscription.java:519)&lt;br/&gt;
  	at org.apache.activemq.broker.region.PrefetchSubscription.acknowledge(PrefetchSubscription.java:211)&lt;br/&gt;
  	at org.apache.activemq.broker.region.AbstractRegion.acknowledge(AbstractRegion.java:528)&lt;br/&gt;
  	at org.apache.activemq.broker.region.RegionBroker.acknowledge(RegionBroker.java:475)&lt;br/&gt;
(..)}}&lt;/p&gt;

&lt;p&gt;I have prepared a &lt;a href=&quot;https://github.com/Anthchirp/activemq/commit/7df4f25975c6500e65b1688ca81e761c1825a32a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;unit test&lt;/a&gt; for this (&lt;a href=&quot;https://github.com/Anthchirp/activemq/commit/7df4f25975c6500e65b1688ca81e761c1825a32a.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;patch file&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;The exception is not raised if the messages are acknowledged outside of a transaction.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13096666">AMQ-6796</key>
            <summary>Acknowledging messages out of order in a STOMP 1.1 transaction raises exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="mgerstel">Markus Gerstel</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Aug 2017 08:08:55 +0000</created>
                <updated>Wed, 23 Aug 2017 16:24:47 +0000</updated>
                            <resolved>Wed, 23 Aug 2017 16:24:47 +0000</resolved>
                                    <version>5.15.0</version>
                                    <fixVersion>5.15.1</fixVersion>
                    <fixVersion>5.16.0</fixVersion>
                                    <component>STOMP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16138567" author="jira-bot" created="Wed, 23 Aug 2017 16:21:11 +0000"  >&lt;p&gt;Commit 4c986d102cd5c862d88fd84eec1889b9786e9970 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4c986d1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4c986d1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6796&quot; title=&quot;Acknowledging messages out of order in a STOMP 1.1 transaction raises exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6796&quot;&gt;&lt;del&gt;AMQ-6796&lt;/del&gt;&lt;/a&gt; Avoid double Ack on commit in STOMP individual ack mode&lt;/p&gt;

&lt;p&gt;During commit of transaction when subscription mode is individual ack&lt;br/&gt;
the messages can get double acked leading to an error about receipt of&lt;br/&gt;
an invalid ack.&lt;/p&gt;</comment>
                            <comment id="16138572" author="jira-bot" created="Wed, 23 Aug 2017 16:23:24 +0000"  >&lt;p&gt;Commit 8e9f80e7d6fdee3e3ecd2293fa364c05a2e9b18b in activemq&apos;s branch refs/heads/activemq-5.15.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=8e9f80e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=8e9f80e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6796&quot; title=&quot;Acknowledging messages out of order in a STOMP 1.1 transaction raises exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6796&quot;&gt;&lt;del&gt;AMQ-6796&lt;/del&gt;&lt;/a&gt; Avoid double Ack on commit in STOMP individual ack mode&lt;/p&gt;

&lt;p&gt;During commit of transaction when subscription mode is individual ack&lt;br/&gt;
the messages can get double acked leading to an error about receipt of&lt;br/&gt;
an invalid ack.&lt;br/&gt;
(cherry picked from commit 4c986d102cd5c862d88fd84eec1889b9786e9970)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3j4pb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>