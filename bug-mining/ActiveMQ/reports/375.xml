<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:37:09 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1771] Failover transport should always signal resume of transport</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1771</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;The FailoverTransport does currently not signal the initial resume of the transport (due to race condition) nor the failure (if maxReconnectAttempts is 0) and therefore we don&apos;t know if the connection is successfully connected or not.&lt;/p&gt;

&lt;p&gt;The attached patch adds a sleep (copied from the failure processing part some lines below) that ensures that the &lt;cite&gt;transportListener&lt;/cite&gt; is set and the &lt;cite&gt;transportListener.transportResumed()&lt;/cite&gt; is called.&lt;/p&gt;</description>
                <environment>&lt;p&gt;WinXP, JDK5&lt;/p&gt;</environment>
        <key id="12482415">AMQ-1771</key>
            <summary>Failover transport should always signal resume of transport</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="akuhtz">Andreas Kuhtz</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Jun 2008 11:27:02 +0000</created>
                <updated>Fri, 20 Jun 2008 05:22:46 +0000</updated>
                            <resolved>Wed, 11 Jun 2008 23:22:31 +0000</resolved>
                                    <version>5.1.0</version>
                                    <fixVersion>5.2.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12939757" author="rajdavies" created="Thu, 5 Jun 2008 17:58:34 +0000"  >&lt;p&gt;Fixed by SVN revision 663680 and 663691&lt;/p&gt;</comment>
                            <comment id="12939782" author="akuhtz" created="Mon, 9 Jun 2008 13:59:29 +0000"  >&lt;p&gt;There is another timing issue because the reconnect task is triggered via the &lt;tt&gt;FailoverTransport.add(URI u[])&lt;/tt&gt; method before the connection is configured (see &lt;tt&gt;ActiveMConnectionFactory.createActiveMQConnection(...)&lt;/tt&gt;) and therefore the transport listener is not set.&lt;/p&gt;

&lt;p&gt;The attached patch (amq-failover-reconnect.patch) checks if the transport is started and does not call &lt;tt&gt;reconnect()&lt;/tt&gt; because the &lt;tt&gt;start()&lt;/tt&gt; will do it later after the connection is configured.&lt;/p&gt;</comment>
                            <comment id="12939791" author="rajdavies" created="Wed, 11 Jun 2008 23:22:31 +0000"  >&lt;p&gt;Fixed by revision 666893&lt;/p&gt;</comment>
                            <comment id="12939877" author="janbartel" created="Fri, 20 Jun 2008 05:22:46 +0000"  >&lt;p&gt;Hi Rob,&lt;/p&gt;

&lt;p&gt;A jetty hightide user has posted me the following problem description, which I think may be fixed by the patches above, but I&apos;m not entirely sure - could you confirm for me if that&apos;s the case?&lt;/p&gt;

&lt;p&gt;Here&apos;s the problem as it was reported:&lt;/p&gt;

&lt;p&gt;&quot;ActiveMQConnection&lt;br/&gt;
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&lt;br/&gt;
The Main thread is stuck waiting for ActiveMQConnection.brokerInfoReceived CountDownLatch in the ActiveMQConnection.waitForBrokerInfo() method. The brokerInfoReceived latch is released when the ActiveMQConnection.onCommand().processBrokerInfo() Listner event is received.&lt;/p&gt;

&lt;p&gt;FailoverTransport&lt;br/&gt;
&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;&#8212;-&lt;br/&gt;
When the FailoverTransport is instantiated it immediately attempts to connect to the brokers. On successful connection to the broker it calls the Listener, if one is attached.&lt;br/&gt;
The processBrokerInfo command from the broker is sent to the listener, in this case the ActiveMQConnection which releases the latch.&lt;/p&gt;

&lt;p&gt;The sequence of wiring the connection to the transport is as follows...&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ActiveMQConnectionFactory.createActiveMQConnection() creates the transport, then creates the ActiveMQConnection(transport)&lt;/li&gt;
	&lt;li&gt;The ActiveMQConnection constructor calls transport.setTransportListener(this) which attaches the connection listener to the transport&lt;/li&gt;
	&lt;li&gt;Finally the factory calls start() on the transport&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The problem is the FailoverTransport starts to connect doReconnect() at construction time using its own thread. On successful connection to the broker it notifies using the listener but only if the listener is set. The race condition occurs on the main thread to attach the listener to the FailoverTransport before the FailoverTransport connects. If the FailoverTransport connects and the listener is not connected, notification messages are lost..&quot;&lt;/p&gt;

&lt;p&gt;ta muchly,&lt;br/&gt;
Jan&lt;/p&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12460985" name="ASF.LICENSE.NOT.GRANTED--amq-failover.patch" size="1668" author="akuhtz" created="Thu, 5 Jun 2008 11:27:02 +0000"/>
                            <attachment id="12461161" name="amq-failover-reconnect.patch" size="1306" author="akuhtz" created="Mon, 9 Jun 2008 14:00:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84775</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s1of:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161748</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>