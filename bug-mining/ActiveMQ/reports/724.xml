<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:43:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2414] JDBC datastore locking does not work when using MYSQL cluster</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2414</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;JDBC Master/Slave doesn&apos;t work properly for mysql cluster when the master and slave brokers are using different MYSQL frontends as would be required in a HA setup.  The code currently locks the database using a TABLE lock which are not cluster wide in mysql.&lt;br/&gt;
&lt;a href=&quot;http://dev.mysql.com/doc/refman/5.1/en/mysql-cluster-limitations-multiple-nodes.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://dev.mysql.com/doc/refman/5.1/en/mysql-cluster-limitations-multiple-nodes.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The default code path uses a SELECT FOR UPDATE to get a lock.  This is supported in mysql cluster.&lt;br/&gt;
The attached patch works for me.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12483691">AMQ-2414</key>
            <summary>JDBC datastore locking does not work when using MYSQL cluster</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="alexjfisher">Alexander Fisher</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Sep 2009 13:48:57 +0000</created>
                <updated>Fri, 10 Feb 2012 11:47:09 +0000</updated>
                            <resolved>Thu, 27 Oct 2011 16:10:08 +0000</resolved>
                                    <version>5.3.0</version>
                                    <fixVersion>5.6.0</fixVersion>
                                    <component>Message Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12941460" author="chirino" created="Fri, 25 Sep 2009 13:57:35 +0000"  >&lt;p&gt;Does SELECT for UPDATE work on all the MySQL back end types, and previous MySQL versions?&lt;/p&gt;</comment>
                            <comment id="12941468" author="chirino" created="Fri, 25 Sep 2009 14:03:15 +0000"  >&lt;p&gt;Perhaps the best strategy may be to property to the adapter like:&lt;/p&gt;

&lt;p&gt;String mysqlEngine=&quot;INODB&quot;;&lt;/p&gt;

&lt;p&gt;And then the setStatements() method can change it&apos;s behavior based on the setting of mysqlEngine.&lt;/p&gt;</comment>
                            <comment id="12941493" author="chirino" created="Fri, 25 Sep 2009 16:14:45 +0000"  >&lt;p&gt;Applied a version of the patch /w the configurable property I discussed earlier in rev 818905.&lt;/p&gt;</comment>
                            <comment id="12941526" author="alexjfisher" created="Fri, 25 Sep 2009 18:06:13 +0000"  >&lt;p&gt;Two problems when testing with ndbcluser (mysql cluster).&lt;/p&gt;

&lt;p&gt;1) Only the first table is created.  The other CREATE TABLES fail mysteriously with Table &apos;ACTIVEMQ_ACKS&apos; already exists SQLState: 42S01 Vendor code: 1050.&lt;/p&gt;

&lt;p&gt;2) Assuming manually created tables, console output on slave is filled with SQL exceptions and stacktraces due to &apos;lock timeout exceeded&apos; exceptions.  These are quite normal and should be handled quietly.&lt;/p&gt;</comment>
                            <comment id="13137237" author="gtully" created="Thu, 27 Oct 2011 16:10:09 +0000"  >&lt;p&gt;please reopen again if there are problems and add as much information as possible There have been multiple updates since the patch was applied.&lt;/p&gt;</comment>
                            <comment id="13177502" author="wangyin" created="Fri, 30 Dec 2011 01:36:39 +0000"  >&lt;p&gt;Other tow problems when testing with ndbcluster.&lt;br/&gt;
1)No distributed table locks support yet, so it&apos;s impossible to set up a master/slave broker for HA with ndbcluster.&lt;br/&gt;
2)Low performance and from time to time producer is suspended and resumes to send messages after several minutes.&lt;/p&gt;</comment>
                            <comment id="13205369" author="kimmking" created="Fri, 10 Feb 2012 11:47:09 +0000"  >&lt;p&gt;it is a good way to use zookeeper for independent distributed locks;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461446" name="mysql-cluster-locking-r818849.patch" size="2537" author="alexjfisher" created="Fri, 25 Sep 2009 13:51:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60075</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 41 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0akon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59624</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>