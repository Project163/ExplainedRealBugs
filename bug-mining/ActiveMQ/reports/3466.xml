<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:59:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-9420] KahaDB durable subscription stats can go negative on duplicate acks</title>
                <link>https://issues.apache.org/jira/browse/AMQ-9420</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6375&quot; title=&quot;Add non-blocking subscription statistics to KahaDB&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6375&quot;&gt;&lt;del&gt;AMQ-6375&lt;/del&gt;&lt;/a&gt; added support for non blocking durable subscription statistics to KahaDB to track pending message count and message size metrics. By default this is disabled and can be enabled with the&#160;enableSubscriptionStatistics flag on KahaDB.&lt;/p&gt;

&lt;p&gt;On rare occasions I have noticed that sometimes the metrics may got negative or be slightly off. I found an area where it&apos;s possible if a duplicate ack comes in then in some scenarios the metrics may be deprecated twice. This issue only applies to the subscription stats and not the store statistics for the overall destination as those stats would only get decremented once when the message is removed from the order index.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13565814">AMQ-9420</key>
            <summary>KahaDB durable subscription stats can go negative on duplicate acks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="cshannon">Christopher L. Shannon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Jan 2024 14:49:03 +0000</created>
                <updated>Tue, 23 Jan 2024 16:02:25 +0000</updated>
                            <resolved>Tue, 23 Jan 2024 16:02:25 +0000</resolved>
                                    <version>5.18.3</version>
                    <version>6.0.1</version>
                                    <fixVersion>6.1.0</fixVersion>
                    <fixVersion>5.18.4</fixVersion>
                    <fixVersion>5.17.7</fixVersion>
                    <fixVersion>6.0.2</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="5400">1.5h</timespent>
                                <comments>
                            <comment id="17810009" author="jira-bot" created="Tue, 23 Jan 2024 15:34:34 +0000"  >&lt;p&gt;Commit f73cf2aaab026dcddeed7a46b272801a43d95113 in activemq&apos;s branch refs/heads/main from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=f73cf2aaa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=f73cf2aaa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9420&quot; title=&quot;KahaDB durable subscription stats can go negative on duplicate acks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9420&quot;&gt;&lt;del&gt;AMQ-9420&lt;/del&gt;&lt;/a&gt; - Don&apos;t decrement KahaDB durable sub metrics on duplicate ack&lt;/p&gt;

&lt;p&gt;This adds a check in case a duplicate ack is passed to the store to make&lt;br/&gt;
sure that the subscription statistics (if enabled) for a durable sub do&lt;br/&gt;
not have the metrics decremented a second time&lt;/p&gt;</comment>
                            <comment id="17810010" author="jira-bot" created="Tue, 23 Jan 2024 15:34:35 +0000"  >&lt;p&gt;Commit 38b6d86ff8fb45c6f9795ed1c3cf7046dc521eb2 in activemq&apos;s branch refs/heads/main from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=38b6d86ff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=38b6d86ff&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #1142 from cshannon/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9420&quot; title=&quot;KahaDB durable subscription stats can go negative on duplicate acks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9420&quot;&gt;&lt;del&gt;AMQ-9420&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9420&quot; title=&quot;KahaDB durable subscription stats can go negative on duplicate acks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9420&quot;&gt;&lt;del&gt;AMQ-9420&lt;/del&gt;&lt;/a&gt; - Don&apos;t decrement KahaDB durable sub metrics on duplicate ack&lt;/p&gt;</comment>
                            <comment id="17810011" author="jira-bot" created="Tue, 23 Jan 2024 15:39:40 +0000"  >&lt;p&gt;Commit 918099cb7ee4c46c9a3ea1d418411444dd00fcec in activemq&apos;s branch refs/heads/activemq-6.0.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=918099cb7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=918099cb7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9420&quot; title=&quot;KahaDB durable subscription stats can go negative on duplicate acks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9420&quot;&gt;&lt;del&gt;AMQ-9420&lt;/del&gt;&lt;/a&gt; - Don&apos;t decrement KahaDB durable sub metrics on duplicate ack&lt;/p&gt;

&lt;p&gt;This adds a check in case a duplicate ack is passed to the store to make&lt;br/&gt;
sure that the subscription statistics (if enabled) for a durable sub do&lt;br/&gt;
not have the metrics decremented a second time&lt;/p&gt;

&lt;p&gt;(cherry picked from commit f73cf2aaab026dcddeed7a46b272801a43d95113)&lt;br/&gt;
(cherry picked from commit a0b8a1fe55b7b309d754dceaf6cde81967c7f78b)&lt;/p&gt;</comment>
                            <comment id="17810020" author="jira-bot" created="Tue, 23 Jan 2024 15:59:55 +0000"  >&lt;p&gt;Commit 1fce36b3e50ed7254fbdcfc1c57e339c31b9b5e2 in activemq&apos;s branch refs/heads/activemq-5.18.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=1fce36b3e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=1fce36b3e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9420&quot; title=&quot;KahaDB durable subscription stats can go negative on duplicate acks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9420&quot;&gt;&lt;del&gt;AMQ-9420&lt;/del&gt;&lt;/a&gt; - Don&apos;t decrement KahaDB durable sub metrics on duplicate ack&lt;/p&gt;

&lt;p&gt;This adds a check in case a duplicate ack is passed to the store to make&lt;br/&gt;
sure that the subscription statistics (if enabled) for a durable sub do&lt;br/&gt;
not have the metrics decremented a second time&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 918099cb7ee4c46c9a3ea1d418411444dd00fcec)&lt;/p&gt;</comment>
                            <comment id="17810021" author="jira-bot" created="Tue, 23 Jan 2024 16:02:16 +0000"  >&lt;p&gt;Commit 1208138390ed363f85528ce47449280d994b16cc in activemq&apos;s branch refs/heads/activemq-5.17.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=120813839&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=120813839&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9420&quot; title=&quot;KahaDB durable subscription stats can go negative on duplicate acks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9420&quot;&gt;&lt;del&gt;AMQ-9420&lt;/del&gt;&lt;/a&gt; - Don&apos;t decrement KahaDB durable sub metrics on duplicate ack&lt;/p&gt;

&lt;p&gt;This adds a check in case a duplicate ack is passed to the store to make&lt;br/&gt;
sure that the subscription statistics (if enabled) for a durable sub do&lt;br/&gt;
not have the metrics decremented a second time&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 918099cb7ee4c46c9a3ea1d418411444dd00fcec)&lt;br/&gt;
(cherry picked from commit 1fce36b3e50ed7254fbdcfc1c57e339c31b9b5e2)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12992627">AMQ-6375</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1mxy8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>