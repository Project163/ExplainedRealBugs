<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:08:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5082] ActiveMQ replicatedLevelDB cluster breaks, all nodes stop listening</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5082</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I have a 3 node amq cluster and one zookeeper node using a replicatedLevelDB persistence adapter.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &amp;lt;persistenceAdapter&amp;gt;
            &amp;lt;replicatedLevelDB
              directory=&lt;span class=&quot;code-quote&quot;&gt;&quot;${activemq.data}/leveldb&quot;&lt;/span&gt;
              replicas=&lt;span class=&quot;code-quote&quot;&gt;&quot;3&quot;&lt;/span&gt;
              bind=&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//0.0.0.0:0&quot;&lt;/span&gt;
&lt;/span&gt;              zkAddress=&lt;span class=&quot;code-quote&quot;&gt;&quot;zookeep0:2181&quot;&lt;/span&gt;
              zkPath=&lt;span class=&quot;code-quote&quot;&gt;&quot;/activemq/leveldb-stores&quot;&lt;/span&gt;/&amp;gt;
        &amp;lt;/persistenceAdapter&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After about a day or so of sitting idle there are cascading failures and the cluster completely stops listening all together.&lt;/p&gt;

&lt;p&gt;I can reproduce this consistently on 5.9 and the latest 5.10 (commit 2360fb859694bacac1e48092e53a56b388e1d2f0).  I am going to attach logs from the three mq nodes and the zookeeper logs that reflect the time where the cluster starts having issues.&lt;/p&gt;

&lt;p&gt;The cluster stops listening Mar 4, 2014 4:56:50 AM (within 5 seconds).&lt;/p&gt;

&lt;p&gt;The OSs are all centos 5.9 on one esx server, so I doubt networking is an issue.&lt;/p&gt;

&lt;p&gt;If you need more data it should be pretty easy to get whatever is needed since it is consistently reproducible.&lt;/p&gt;

&lt;p&gt;This bug may be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5026&quot; title=&quot;Replicated LevelDB Store getting EOF exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5026&quot;&gt;&lt;del&gt;AMQ-5026&lt;/del&gt;&lt;/a&gt;, but looks different enough to file a separate issue.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12698796">AMQ-5082</key>
            <summary>ActiveMQ replicatedLevelDB cluster breaks, all nodes stop listening</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="ceposta">Christian Posta</assignee>
                                    <reporter username="scottmf">Scott Feldstein</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Mar 2014 03:03:55 +0000</created>
                <updated>Fri, 3 Feb 2017 15:02:41 +0000</updated>
                            <resolved>Fri, 3 Feb 2017 15:02:41 +0000</resolved>
                                    <version>5.9.0</version>
                    <version>5.10.0</version>
                                                    <component>LevelDB</component>
                        <due></due>
                            <votes>12</votes>
                                    <watches>25</watches>
                                                                                                                <comments>
                            <comment id="13920424" author="scottmf" created="Wed, 5 Mar 2014 03:04:42 +0000"  >&lt;p&gt;Attaching logs from three mq nodes and zookeeper.&lt;/p&gt;</comment>
                            <comment id="13924689" author="scottmf" created="Sat, 8 Mar 2014 03:14:43 +0000"  >&lt;p&gt;I&apos;ve been doing some more digging on this.  It turns out that there is a job on another vm on the esx box that occurs exactly when things fail.  The job is backing up @ 60GB s3.  At that point there is a big hiccup in the system and all the activemq nodes stop listening and never recover.  I tried to increase the zookeeper timeout from 2s to 10s on the activemq nodes and that still doesn&apos;t help.&lt;/p&gt;

&lt;p&gt;I think the bug here is that the nodes never recover from this outage.  It seems like there should be some type of recovery logic when all the nodes lose their connection and come back to life at some later point in time.&lt;/p&gt;

&lt;p&gt;I am adding more logs with DEBUG enabled from 03/07/14.&lt;/p&gt;

&lt;p&gt;This set of logs shows the behavior that I am talking about.  Starting at 04:52:22,366 the nodes go into a state where none are elected&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;$ egrep &lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&apos;&lt;/span&gt; mq-node1-activemq.log.bug 
2014-03-07 04:50:49,325 DEBUG [main-EventThread] [org.apache.activemq.leveldb.replicated.MasterElector@112] ZooKeeper group changed: Map(localhost -&amp;gt; ListBuffer((0000000169,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;0000000171&quot;&lt;/span&gt;}), (0000000171,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//10.1.1.218:58506&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;})))
&lt;/span&gt;2014-03-07 04:50:54,453 DEBUG [main-EventThread] [org.apache.activemq.leveldb.replicated.MasterElector@112] ZooKeeper group changed: Map(localhost -&amp;gt; ListBuffer((0000000169,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;0000000171&quot;&lt;/span&gt;}), (0000000171,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//10.1.1.218:58506&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000173,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161531,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;})))
&lt;/span&gt;2014-03-07 04:51:06,008 DEBUG [main-EventThread] [org.apache.activemq.leveldb.replicated.MasterElector@112] ZooKeeper group changed: Map(localhost -&amp;gt; ListBuffer((0000000169,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;0000000171&quot;&lt;/span&gt;}), (0000000171,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//10.1.1.218:58506&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;})))
&lt;/span&gt;2014-03-07 04:51:42,386 DEBUG [main-EventThread] [org.apache.activemq.leveldb.replicated.MasterElector@112] ZooKeeper group changed: Map(localhost -&amp;gt; ListBuffer((0000000169,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;0000000171&quot;&lt;/span&gt;}), (0000000171,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161609,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;})))
2014-03-07 04:52:22,366 DEBUG [main] [org.apache.activemq.leveldb.replicated.MasterElector@112] ZooKeeper group changed: Map(localhost -&amp;gt; ListBuffer((0000000174,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//10.1.1.218:49168&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;})))
&lt;/span&gt;2014-03-07 04:52:24,160 DEBUG [main-EventThread] [org.apache.activemq.leveldb.replicated.MasterElector@112] ZooKeeper group changed: Map(localhost -&amp;gt; ListBuffer((0000000174,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//10.1.1.218:49168&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000175,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161609,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;})))
&lt;/span&gt;2014-03-07 04:52:24,167 DEBUG [main-EventThread] [org.apache.activemq.leveldb.replicated.MasterElector@112] ZooKeeper group changed: Map(localhost -&amp;gt; ListBuffer((0000000174,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//10.1.1.218:49168&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000175,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161609,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000176,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161609,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;})))
&lt;/span&gt;2014-03-07 04:52:58,259 DEBUG [main-EventThread] [org.apache.activemq.leveldb.replicated.MasterElector@112] ZooKeeper group changed: Map(localhost -&amp;gt; ListBuffer((0000000174,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//10.1.1.218:49168&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000175,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161609,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000176,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161609,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000177,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161531,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;})))
&lt;/span&gt;2014-03-07 04:55:12,679 DEBUG [main-EventThread] [org.apache.activemq.leveldb.replicated.MasterElector@112] ZooKeeper group changed: Map(localhost -&amp;gt; ListBuffer((0000000174,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//10.1.1.218:49168&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000175,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161609,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000176,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161609,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;})))
&lt;/span&gt;2014-03-07 04:55:12,681 DEBUG [main-EventThread] [org.apache.activemq.leveldb.replicated.MasterElector@112] ZooKeeper group changed: Map(localhost -&amp;gt; ListBuffer((0000000174,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//10.1.1.218:49168&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000175,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161609,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;})))
&lt;/span&gt;2014-03-07 04:56:02,014 DEBUG [main-EventThread] [org.apache.activemq.leveldb.replicated.MasterElector@112] ZooKeeper group changed: Map(localhost -&amp;gt; ListBuffer((0000000174,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//10.1.1.218:49168&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000175,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161609,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000178,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161609,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;})))
&lt;/span&gt;2014-03-07 05:00:20,550 DEBUG [main-EventThread] [org.apache.activemq.leveldb.replicated.MasterElector@112] ZooKeeper group changed: Map(localhost -&amp;gt; ListBuffer((0000000174,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//10.1.1.218:49168&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000175,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161609,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;})))
&lt;/span&gt;2014-03-07 05:01:32,446 DEBUG [main-EventThread] [org.apache.activemq.leveldb.replicated.MasterElector@112] ZooKeeper group changed: Map(localhost -&amp;gt; ListBuffer((0000000174,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//10.1.1.218:49168&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:-1,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000175,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161609,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;}), (0000000179,{&lt;span class=&quot;code-quote&quot;&gt;&quot;id&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;container&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;address&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;position&quot;&lt;/span&gt;:161531,&lt;span class=&quot;code-quote&quot;&gt;&quot;weight&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;elected&quot;&lt;/span&gt;:&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;})))&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13967034" author="krm1312" created="Fri, 11 Apr 2014 20:05:56 +0000"  >&lt;p&gt;I believe I am seeing the same issue.  We have a three node dev setup that seems to consistently get into this state.  Attached are thread dumps from each of the nodes.&lt;/p&gt;</comment>
                            <comment id="13967035" author="krm1312" created="Fri, 11 Apr 2014 20:06:50 +0000"  >&lt;p&gt;Thread dump of non-listening cluster.&lt;/p&gt;</comment>
                            <comment id="13967040" author="krm1312" created="Fri, 11 Apr 2014 20:13:32 +0000"  >&lt;p&gt;Shutting down node1 from the attached thread dumps properly promoted node3 to be the master.  So, it appears that node1 is somehow maintaining its leadership (but not listening) when this happens.&lt;/p&gt;</comment>
                            <comment id="13967073" author="scottmf" created="Fri, 11 Apr 2014 20:37:50 +0000"  >&lt;p&gt;This can be reproduced by causing a network disruption where all the apache nodes can&apos;t access any of the zookeeper cluster.  The disruption needs to be longer than the zk timeout.  The quickest way I&apos;ve been able to accomplish this is by using my local firewall, although the state of the objects isn&apos;t always the exact same as the logs that i posted the overall symptoms are.&lt;/p&gt;

&lt;p&gt;In code I think the problem is in the org.apache.activemq.leveldb.replicated.MasterElector.scala -&amp;gt; change_listener.  As Kevin said, the node thinks that it is the master but it is not correctly initializing the listener when it gets into this state.&lt;/p&gt;</comment>
                            <comment id="13978219" author="krm1312" created="Wed, 23 Apr 2014 14:04:22 +0000"  >&lt;p&gt;Still exists in 5.9.1.&lt;/p&gt;</comment>
                            <comment id="13979002" author="krm1312" created="Wed, 23 Apr 2014 22:17:30 +0000"  >&lt;p&gt;This actually seems pretty easy to reproduce without network errors or slow IO.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Setup 3 node ActiveMQ cluster&lt;/li&gt;
	&lt;li&gt;Setup 3 node ZK cluster on same hosts&lt;/li&gt;
	&lt;li&gt;Start ActiveMQ and ZK on each host&lt;/li&gt;
	&lt;li&gt;Determine which ActiveMQ process is the master (telnet 61616 on each host)&lt;/li&gt;
	&lt;li&gt;Look in ActiveMQ log of the master, determine which ZK it is connected to via DEBUG log&lt;br/&gt;
&lt;tt&gt;Got ping response for sessionid: ... after 1ms | org.apache.zookeeper.ClientCnxn | main-SendThread($host:2181)&lt;/tt&gt;&lt;/li&gt;
	&lt;li&gt;Restart that ZK process.&lt;/li&gt;
	&lt;li&gt;Most of the time the ActiveMQ cluster does not recover/is dead at this point.  If it does recover go to #4.  I haven&apos;t made it past rolling two ZK processes.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13979145" author="krm1312" created="Thu, 24 Apr 2014 00:46:41 +0000"  >&lt;p&gt;The 7 step process above requires a step 0.  That is, have a rogue process listening on 61619 on a single host in your cluster.  After stopping that, I can&apos;t reproduce easily anymore.  I&apos;m not sure if ActiveMQ could check ports that it requires at startup or not, even when it is not going to bind to them unless it becomes the master.&lt;/p&gt;</comment>
                            <comment id="14041885" author="adewavrin" created="Tue, 24 Jun 2014 08:53:23 +0000"  >&lt;p&gt;Dear all,&lt;/p&gt;

&lt;p&gt;We had the exact same problem due to backups at our hosting company, that we could not avoid.&lt;/p&gt;

&lt;p&gt;So we can consider that the cluster behaves  normally : when unable to communicate with each others, the brokers try to fail over.&lt;/p&gt;

&lt;p&gt;We increased the ticktime in zookeeper and it works perfectly. 4 months in production already.&lt;/p&gt;

&lt;p&gt;Anselme&lt;/p&gt;</comment>
                            <comment id="14052614" author="scottmf" created="Fri, 4 Jul 2014 18:46:11 +0000"  >&lt;p&gt;increasing the ticktime didn&apos;t solve the issue for me.  I increased it to 20000 and it still consistently fails.&lt;/p&gt;</comment>
                            <comment id="14357632" author="jim.robinson@gmail.com" created="Wed, 11 Mar 2015 21:17:45 +0000"  >&lt;p&gt;I was seeing similar behavior on 5.11.1 when I spun up two 3-node clusters in a VirtualBox environment.  I assumed the problem was not enough cpu cycles to keep the zookeeper session alive.  I&apos;ve got a proposed Unit Test:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/jimrobinson/activemq/commit/58b7198880f5296af6b2e4e9efbbdfdb51220411&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jimrobinson/activemq/commit/58b7198880f5296af6b2e4e9efbbdfdb51220411&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and a potential fix:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/jimrobinson/activemq/commit/d272a116ff5c0916a6044d657f99df48f264bd2a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jimrobinson/activemq/commit/d272a116ff5c0916a6044d657f99df48f264bd2a&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I believe the underlying issue is that ZooKeeperGroup is relying on&lt;/p&gt;

&lt;p&gt;org.linkedin.zookeeper.tracker.ZooKeeperTreeTracker&lt;/p&gt;

&lt;p&gt;to keep its membership list up to date, and I don&apos;t believe that is happening on zookeeper session expiration.&lt;/p&gt;</comment>
                            <comment id="14363414" author="githubbot" created="Mon, 16 Mar 2015 16:13:37 +0000"  >&lt;p&gt;GitHub user jimrobinson opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/74&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/74&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5082&quot; title=&quot;ActiveMQ replicatedLevelDB cluster breaks, all nodes stop listening&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5082&quot;&gt;&lt;del&gt;AMQ-5082&lt;/del&gt;&lt;/a&gt; unit test and patch&lt;/p&gt;

&lt;p&gt;    A proposed unit test and patch to address the issues raised in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5082&quot; title=&quot;ActiveMQ replicatedLevelDB cluster breaks, all nodes stop listening&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5082&quot;&gt;&lt;del&gt;AMQ-5082&lt;/del&gt;&lt;/a&gt; (the quorum never recovered after a broker&apos;s zookeeper session expires)&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jimrobinson/activemq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jimrobinson/activemq&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/74.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/74.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #74&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 58b7198880f5296af6b2e4e9efbbdfdb51220411&lt;br/&gt;
Author: James A. Robinson &amp;lt;jim.robinson@stanford.edu&amp;gt;&lt;br/&gt;
Date:   2015-03-06T23:22:46Z&lt;/p&gt;

&lt;p&gt;    unit test for &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5082&quot; title=&quot;ActiveMQ replicatedLevelDB cluster breaks, all nodes stop listening&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5082&quot;&gt;&lt;del&gt;AMQ-5082&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;commit d272a116ff5c0916a6044d657f99df48f264bd2a&lt;br/&gt;
Author: James A. Robinson &amp;lt;jim.robinson@stanford.edu&amp;gt;&lt;br/&gt;
Date:   2015-03-11T20:47:14Z&lt;/p&gt;

&lt;p&gt;    recompute ZooKeeperTreeTracker on reconnect&lt;/p&gt;

&lt;p&gt;commit 8e5558c731fe0ddeee4136d806315023c47f108c&lt;br/&gt;
Author: James A. Robinson &amp;lt;jim.robinson@stanford.edu&amp;gt;&lt;br/&gt;
Date:   2015-03-16T16:10:24Z&lt;/p&gt;

&lt;p&gt;    synchronize the entire tree check/rebuild operation; use a boolean instead of a counter to track reconnected state&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14385419" author="scottmf" created="Sat, 28 Mar 2015 17:11:57 +0000"  >&lt;p&gt;I&apos;ve been running with Jim&apos;s patch for several days now without failure.  Everytime I try to break the cluster - via load spikes or blocking zookeeper ports - the system recovers immediately after the failure event ends.&lt;/p&gt;</comment>
                            <comment id="14385634" author="ceposta" created="Sun, 29 Mar 2015 05:30:08 +0000"  >&lt;p&gt;Awesome, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jim.robinson%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;jim.robinson@gmail.com&quot;&gt;jim.robinson@gmail.com&lt;/a&gt; for the patch. I&apos;ll take a look tomorrow or Monday and get this in.&lt;/p&gt;</comment>
                            <comment id="14387628" author="ceposta" created="Mon, 30 Mar 2015 23:47:42 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jim.robinson%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;jim.robinson@gmail.com&quot;&gt;jim.robinson@gmail.com&lt;/a&gt; i&apos;m trying to apply your patch but the unit tests you have doesn&apos;t pass w/ or w/o the patch. Can you take a look with the patch applied to master? &lt;a href=&quot;https://github.com/apache/activemq/pull/74.diff&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/74.diff&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14387659" author="ceposta" created="Tue, 31 Mar 2015 00:09:32 +0000"  >&lt;p&gt;After running a handful more times, it seems to pass ~90% of the time. Is that the same behavior for you? The patch looks fine to me (e.g., rebuilding the ZK tracking tree on reconnect). I&apos;ll keep running to see if it&apos;s my env or if there is a timing issue with the test.&lt;/p&gt;

&lt;p&gt;I&apos;ve applied the patch (w/o using the pull request which had some other merge noise) as a clean commit here: &lt;a href=&quot;https://github.com/apache/activemq/commit/a39e51e0519852332f7779443c3db09b6e691d49&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/commit/a39e51e0519852332f7779443c3db09b6e691d49&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=scottmf&quot; class=&quot;user-hover&quot; rel=&quot;scottmf&quot;&gt;scottmf&lt;/a&gt; can you test on the latest master to verify things look good?&lt;/p&gt;</comment>
                            <comment id="14387689" author="jim.robinson@gmail.com" created="Tue, 31 Mar 2015 00:24:41 +0000"  >&lt;p&gt;I ran the leveldb based tests a few times in a row before I submitted&lt;br/&gt;
it, but never ran the full scaffold.  Do you have a copy of one of the&lt;br/&gt;
output text files that failed, so that I can see which line it failed&lt;br/&gt;
on?&lt;/p&gt;
</comment>
                            <comment id="14387955" author="ceposta" created="Tue, 31 Mar 2015 04:26:37 +0000"  >&lt;p&gt;The very last assert it was failing. I&apos;ve run it about 10 times in a row and seems to pass now. Not sure what was up earlier.&lt;/p&gt;</comment>
                            <comment id="14388237" author="jim.robinson@gmail.com" created="Tue, 31 Mar 2015 08:29:41 +0000"  >

&lt;p&gt;It&apos;s possible that it took longer than 30 seconds to re-run the&lt;br/&gt;
election.  I&apos;m not sure what the appropriate time to wait is, but it&lt;br/&gt;
was pretty ugly as it was with all the 30 second delays I had plugged&lt;br/&gt;
in. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14388891" author="tabish121" created="Tue, 31 Mar 2015 17:30:46 +0000"  >&lt;p&gt;Most recent Jenkins build indicates there is still an issue, either with the test or the fix:&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/ActiveMQ-Java8/org.apache.activemq$activemq-leveldb-store/308/console&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ActiveMQ-Java8/org.apache.activemq$activemq-leveldb-store/308/console&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14389036" author="jim.robinson@gmail.com" created="Tue, 31 Mar 2015 18:07:41 +0000"  >&lt;p&gt;I&apos;m running some iterations of the test now, to see if I can&lt;br/&gt;
get it to fail the same way on my system.&lt;/p&gt;</comment>
                            <comment id="14389116" author="jim.robinson@gmail.com" created="Tue, 31 Mar 2015 18:33:41 +0000"  >&lt;p&gt;If I run the test enough times I can get a failure.  I&apos;ll dig into this.&lt;/p&gt;</comment>
                            <comment id="14389197" author="jim.robinson@gmail.com" created="Tue, 31 Mar 2015 18:58:41 +0000"  >&lt;p&gt;This is from a successful run:&lt;/p&gt;

&lt;p&gt;2015-03-31 10:57:48,599 | INFO  | ActiveMQ Task-EventThread | Promoted to&lt;br/&gt;
master&lt;br/&gt;
2015-03-31 10:57:48,601 | INFO  | ActiveMQ Task | Using the pure java&lt;br/&gt;
LevelDB implementation.&lt;br/&gt;
2015-03-31 10:57:48,621 | INFO  | ActiveMQ Task | Master started:&lt;br/&gt;
tcp://localhost:61227&lt;br/&gt;
2015-03-31 10:57:48,625 | INFO  | ActiveMQ Task | Using the pure java&lt;br/&gt;
LevelDB implementation.&lt;br/&gt;
2015-03-31 10:57:48,625 | INFO  | ActiveMQ Task | Using the pure java&lt;br/&gt;
LevelDB implementation.&lt;br/&gt;
2015-03-31 10:57:48,626 | INFO  | ActiveMQ Task | Attaching to master:&lt;br/&gt;
tcp://localhost:61227&lt;br/&gt;
2015-03-31 10:57:48,626 | INFO  | ActiveMQ Task | Attaching to master:&lt;br/&gt;
tcp://localhost:61227&lt;br/&gt;
2015-03-31 10:57:48,626 | INFO  | ActiveMQ Task | Slave started&lt;br/&gt;
2015-03-31 10:57:48,627 | INFO  | ActiveMQ Task | Slave started&lt;br/&gt;
2015-03-31 10:57:48,883 | INFO  | hawtdispatch-DEFAULT-3 | Slave has&lt;br/&gt;
connected: 03942600-8462-4b44-b40d-e3a398193638&lt;br/&gt;
2015-03-31 10:57:49,130 | INFO  | hawtdispatch-DEFAULT-4 | Slave has&lt;br/&gt;
connected: 85f59a26-8faf-4d0c-992c-dc04ffa0e051&lt;br/&gt;
2015-03-31 10:57:49,132 | INFO  | hawtdispatch-DEFAULT-5 | Attaching...&lt;br/&gt;
Downloaded 0.00/0.00 kb and 1/1 files&lt;br/&gt;
2015-03-31 10:57:49,132 | INFO  | hawtdispatch-DEFAULT-5 | Attached&lt;br/&gt;
2015-03-31 10:57:49,137 | INFO  | hawtdispatch-DEFAULT-7 | Attaching...&lt;br/&gt;
Downloaded 0.00/0.00 kb and 1/1 files&lt;br/&gt;
2015-03-31 10:57:49,137 | INFO  | hawtdispatch-DEFAULT-7 | Attached&lt;br/&gt;
2015-03-31 10:57:49,142 | INFO  | hawtdispatch-DEFAULT-3 | Slave has now&lt;br/&gt;
caught up: 03942600-8462-4b44-b40d-e3a398193638&lt;br/&gt;
2015-03-31 10:57:49,143 | INFO  | hawtdispatch-DEFAULT-4 | Slave has now&lt;br/&gt;
caught up: 85f59a26-8faf-4d0c-992c-dc04ffa0e051&lt;br/&gt;
2015-03-31 10:58:15,391 | INFO  | Thread-6 | Checking for a single master&lt;/p&gt;

&lt;p&gt;And this is from a failed run:&lt;/p&gt;

&lt;p&gt;2015-03-31 11:24:58,612 | INFO  | ActiveMQ Task-EventThread | Promoted to&lt;br/&gt;
master&lt;br/&gt;
2015-03-31 11:24:58,614 | INFO  | ActiveMQ Task | Using the pure java&lt;br/&gt;
LevelDB implementation.&lt;br/&gt;
2015-03-31 11:24:58,631 | INFO  | ActiveMQ Task | Master started:&lt;br/&gt;
tcp://localhost:49958&lt;br/&gt;
2015-03-31 11:24:58,636 | INFO  | ActiveMQ Task | Using the pure java&lt;br/&gt;
LevelDB implementation.&lt;br/&gt;
2015-03-31 11:24:58,637 | INFO  | ActiveMQ Task | Attaching to master:&lt;br/&gt;
tcp://localhost:49958&lt;br/&gt;
2015-03-31 11:24:58,637 | INFO  | ActiveMQ Task | Slave started&lt;br/&gt;
2015-03-31 11:24:58,936 | INFO  | hawtdispatch-DEFAULT-3 | Slave has&lt;br/&gt;
connected: 143f918b-8ff0-4d8e-ba9b-04bd6644a443&lt;br/&gt;
2015-03-31 11:24:58,940 | INFO  | hawtdispatch-DEFAULT-4 | Attaching...&lt;br/&gt;
Downloaded 0.00/0.00 kb and 1/1 files&lt;br/&gt;
2015-03-31 11:24:58,940 | INFO  | hawtdispatch-DEFAULT-4 | Attached&lt;br/&gt;
2015-03-31 11:24:58,949 | INFO  | hawtdispatch-DEFAULT-3 | Slave has now&lt;br/&gt;
caught up: 143f918b-8ff0-4d8e-ba9b-04bd6644a443&lt;br/&gt;
2015-03-31 11:24:59,248 | INFO  | ActiveMQ&lt;br/&gt;
Task-SendThread(fe80:0:0:0:0:0:0:1%1:49627) | Socket connection established&lt;br/&gt;
to fe80:0:0:0:0:0:0:1%1/fe80:0:0:0:0:0:0:1%1:49627, initiating session&lt;br/&gt;
2015-03-31 11:24:59,248 | INFO  | NIOServerCxn.Factory:0.0.0.0/0.0.0.0:0 |&lt;br/&gt;
Accepted socket connection from /fe80:0:0:0:0:0:0:1%1:49962&lt;br/&gt;
2015-03-31 11:24:59,248 | INFO  | NIOServerCxn.Factory:0.0.0.0/0.0.0.0:0 |&lt;br/&gt;
Client attempting to renew session 0x14c7112e2cc0001 at&lt;br/&gt;
/fe80:0:0:0:0:0:0:1%1:49962&lt;br/&gt;
2015-03-31 11:24:59,249 | INFO  | NIOServerCxn.Factory:0.0.0.0/0.0.0.0:0 |&lt;br/&gt;
Invalid session 0x14c7112e2cc0001 for client /fe80:0:0:0:0:0:0:1%1:49962,&lt;br/&gt;
probably expired&lt;br/&gt;
2015-03-31 11:24:59,249 | INFO  | NIOServerCxn.Factory:0.0.0.0/0.0.0.0:0 |&lt;br/&gt;
Closed socket connection for client /fe80:0:0:0:0:0:0:1%1:49962 which had&lt;br/&gt;
sessionid 0x14c7112e2cc0001&lt;br/&gt;
2015-03-31 11:24:59,249 | INFO  | ActiveMQ Task-EventThread | Initiating&lt;br/&gt;
client connection, connectString=localhost:49627 sessionTimeout=15000&lt;br/&gt;
watcher=org.apache.activemq.leveldb.replicated.groups.ZKClient@99b2a1d&lt;br/&gt;
2015-03-31 11:24:59,249 | INFO  | ActiveMQ Task-EventThread | EventThread&lt;br/&gt;
shut down&lt;br/&gt;
2015-03-31 11:24:59,250 | INFO  | ActiveMQ Task-SendThread(localhost:49627)&lt;br/&gt;
session&lt;br/&gt;
2015-03-31 11:24:59,250 | INFO  | NIOServerCxn.Factory:0.0.0.0/0.0.0.0:0 |&lt;br/&gt;
Accepted socket connection from /127.0.0.1:49963&lt;br/&gt;
2015-03-31 11:24:59,250 | INFO  | NIOServerCxn.Factory:0.0.0.0/0.0.0.0:0 |&lt;br/&gt;
Client attempting to establish new session at /127.0.0.1:49963&lt;br/&gt;
2015-03-31 11:24:59,252 | INFO  | SyncThread:0 | Established session&lt;br/&gt;
0x14c7112e2cc0005 with negotiated timeout 10000 for client /127.0.0.1:49963&lt;br/&gt;
2015-03-31 11:24:59,252 | INFO  | ActiveMQ Task-SendThread(localhost:49627)&lt;br/&gt;
sessionid = 0x14c7112e2cc0005, negotiated timeout = 10000&lt;br/&gt;
2015-03-31 11:24:59,257 | INFO  | ActiveMQ Task | Using the pure java&lt;br/&gt;
LevelDB implementation.&lt;br/&gt;
2015-03-31 11:24:59,258 | INFO  | ActiveMQ Task | Attaching to master:&lt;br/&gt;
tcp://localhost:49958&lt;br/&gt;
2015-03-31 11:24:59,260 | INFO  | ActiveMQ Task | Slave started&lt;br/&gt;
2015-03-31 11:24:59,541 | INFO  | hawtdispatch-DEFAULT-5 | Slave has&lt;br/&gt;
connected: 5f12ef48-86ab-472a-ae1a-5379bf490902&lt;br/&gt;
2015-03-31 11:24:59,544 | INFO  | hawtdispatch-DEFAULT-6 | Attaching...&lt;br/&gt;
Downloaded 0.00/0.00 kb and 1/1 files&lt;br/&gt;
2015-03-31 11:24:59,544 | INFO  | hawtdispatch-DEFAULT-6 | Attached&lt;br/&gt;
2015-03-31 11:24:59,553 | INFO  | hawtdispatch-DEFAULT-5 | Slave has now&lt;br/&gt;
caught up: 5f12ef48-86ab-472a-ae1a-5379bf490902&lt;br/&gt;
2015-03-31 11:25:25,396 | INFO  | Thread-6 | Checking for a single master&lt;/p&gt;</comment>
                            <comment id="14389459" author="jim.robinson@gmail.com" created="Tue, 31 Mar 2015 21:33:41 +0000"  >&lt;p&gt;So, for some reason the call to&lt;/p&gt;

&lt;p&gt;ElectingLevelDBStore.isMaster()&lt;/p&gt;

&lt;p&gt;is returning false during some runs.  That function checks&lt;br/&gt;
two atomic booleans:&lt;/p&gt;

&lt;p&gt;master_started.get() &amp;amp;&amp;amp; !master_stopped.get()&lt;/p&gt;

&lt;p&gt;and in some cases master_stopped.get() is returning true&lt;br/&gt;
(triggering failure) and in other cases it is returning false.&lt;/p&gt;

&lt;p&gt;Jim&lt;/p&gt;</comment>
                            <comment id="14389681" author="githubbot" created="Tue, 31 Mar 2015 23:45:01 +0000"  >&lt;p&gt;Github user jimrobinson closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/74&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/74&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14389735" author="jim.robinson@gmail.com" created="Wed, 1 Apr 2015 00:17:41 +0000"  >&lt;p&gt;It&apos;s not at all clear to me how master_stopped is sometimes true&lt;br/&gt;
and sometimes false.  I&apos;m wondering if there&apos;s a section of the&lt;br/&gt;
code that I&apos;m missing where the broker is discarded and then&lt;br/&gt;
recreated on failure.&lt;/p&gt;

&lt;p&gt;I&apos;m running a round of tests after having made a change to&lt;br/&gt;
reset master_stopped after master.start():&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;diff --git a/activemq-leveldb-store/src/main/scala/org/apache/activemq/leveldb/replicated/ElectingLevelDBStore.scala
b/activemq-leveldb-store/src/main/scala/org/apache/activemq/leveldb/replicated/ElectingLevelDBStore.scala
index 331d06b..a47baab 100644
--- a/activemq-leveldb-store/src/main/scala/org/apache/activemq/leveldb/replicated/ElectingLevelDBStore.scala
+++ b/activemq-leveldb-store/src/main/scala/org/apache/activemq/leveldb/replicated/ElectingLevelDBStore.scala
@@ -228,6 +228,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;ElectingLevelDBStore &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ProxyLevelDBStore {
     master_started.set(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)
     master.blocking_executor.execute(^{
       master.start();
+      master_stopped.set(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)
       master_started_latch.countDown()
     })
     master.blocking_executor.execute(^{
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14389928" author="githubbot" created="Wed, 1 Apr 2015 03:20:32 +0000"  >&lt;p&gt;GitHub user jimrobinson opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/76&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/76&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    fix the inconsistency with ElectingLevelDBStore.isMaster() under &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5082&quot; title=&quot;ActiveMQ replicatedLevelDB cluster breaks, all nodes stop listening&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5082&quot;&gt;&lt;del&gt;AMQ-5082&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I&apos;ve run through 100 iterations of the ElectingLevelDBStoreTest, I believe this fixes the intermittent issue with the ElectingLevelDBStore failing its isMaster() check.&lt;/p&gt;


&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/jimrobinson/activemq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jimrobinson/activemq&lt;/a&gt; amq-5082-unit-test-fix&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/76.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/76.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #76&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit fd917ed3b40e8132876cab11d090e33eb6ac5de8&lt;br/&gt;
Author: James A. Robinson &amp;lt;jimr@highwire.org&amp;gt;&lt;br/&gt;
Date:   2015-04-01T02:51:15Z&lt;/p&gt;

&lt;p&gt;    fix the inconsistency with ElectingLevelDBStore.isMaster() under &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5082&quot; title=&quot;ActiveMQ replicatedLevelDB cluster breaks, all nodes stop listening&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5082&quot;&gt;&lt;del&gt;AMQ-5082&lt;/del&gt;&lt;/a&gt; unit test conditions&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14390648" author="ceposta" created="Wed, 1 Apr 2015 14:42:07 +0000"  >&lt;p&gt;Thanks Jim for digging into this. I&apos;ve committed your PR. Running tests on my side I&apos;ve not gotten it to fail. Hopefully jenkins thinks the same thing &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Thanks again for your contributions!! Look forward to others &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14390671" author="githubbot" created="Wed, 1 Apr 2015 14:49:58 +0000"  >&lt;p&gt;Github user jimrobinson closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/76&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/76&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14390730" author="adewavrin" created="Wed, 1 Apr 2015 14:54:16 +0000"  >&lt;p&gt;A big Thank you Jim, we were truly annoyed by this !&lt;/p&gt;

&lt;p&gt;Christian, will this be included in the main branch of the downloadable binaries ? In which version ?&lt;/p&gt;

&lt;p&gt;Thanks in advance,&lt;/p&gt;

&lt;p&gt;Anselme&lt;/p&gt;</comment>
                            <comment id="14390759" author="ceposta" created="Wed, 1 Apr 2015 15:08:40 +0000"  >&lt;p&gt;Will be in 5.12 when released. Do you needed it back ported to a 5.11.x?&lt;br/&gt;
Or can test with the nightly builds here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/5.12-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/5.12-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14392618" author="adewavrin" created="Thu, 2 Apr 2015 11:57:08 +0000"  >&lt;p&gt;Well, it depends... When do you think v5.12 is planned for release ?&lt;/p&gt;

&lt;p&gt;How do I patch a 5.11 ?&lt;/p&gt;

&lt;p&gt;Thank you, we have been using ActiveMQ a lot in production for 20 months and it works well. We could give testimonial.&lt;/p&gt;

&lt;p&gt;Anselme&lt;/p&gt;</comment>
                            <comment id="14392908" author="jim.robinson@gmail.com" created="Thu, 2 Apr 2015 16:26:41 +0000"  >&lt;p&gt;On Thu, Apr 2, 2015 at 6:30 AM, anselme dewavrin (JIRA) &amp;lt;jira@apache.org&amp;gt;&lt;/p&gt;



&lt;p&gt;You can just drop in the updated files into the 5.11 source tree and&lt;br/&gt;
rebuild the activemq-leveldb-store tree.  You should then be able to&lt;br/&gt;
take new activemq-leveldb-store-5.11.2-SNAPSHOT.jar and use that&lt;br/&gt;
to run the updated code.&lt;/p&gt;

&lt;p&gt;The two fixes were in:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/activemq/blob/master/activemq-leveldb-store/src/main/scala/org/apache/activemq/leveldb/replicated/ElectingLevelDBStore.scala&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/master/activemq-leveldb-store/src/main/scala/org/apache/activemq/leveldb/replicated/ElectingLevelDBStore.scala&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/activemq/blob/master/activemq-leveldb-store/src/main/scala/org/apache/activemq/leveldb/replicated/groups/ZooKeeperGroup.scala&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/master/activemq-leveldb-store/src/main/scala/org/apache/activemq/leveldb/replicated/groups/ZooKeeperGroup.scala&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The unit test changes were:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/activemq/blob/master/activemq-leveldb-store/src/test/java/org/apache/activemq/leveldb/test/ElectingLevelDBStoreTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/master/activemq-leveldb-store/src/test/java/org/apache/activemq/leveldb/test/ElectingLevelDBStoreTest.java&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/activemq/blob/master/activemq-leveldb-store/src/test/java/org/apache/activemq/leveldb/test/ZooKeeperTestSupport.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/master/activemq-leveldb-store/src/test/java/org/apache/activemq/leveldb/test/ZooKeeperTestSupport.java&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/activemq/blob/master/activemq-leveldb-store/src/test/java/org/apache/zookeeper/server/TestServerCnxnFactory.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/master/activemq-leveldb-store/src/test/java/org/apache/zookeeper/server/TestServerCnxnFactory.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Jim&lt;/p&gt;</comment>
                            <comment id="14392950" author="adewavrin" created="Thu, 2 Apr 2015 16:58:37 +0000"  >&lt;p&gt;Thanks Jim for these precisions.&lt;/p&gt;

&lt;p&gt;doing it very soon !&lt;/p&gt;

&lt;p&gt;Anselme&lt;/p&gt;</comment>
                            <comment id="14637081" author="jim.robinson@gmail.com" created="Wed, 22 Jul 2015 15:37:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adewavrin&quot; class=&quot;user-hover&quot; rel=&quot;adewavrin&quot;&gt;adewavrin&lt;/a&gt;, did you end up applying this patch?  Is it working for you?&lt;/p&gt;</comment>
                            <comment id="14637098" author="jim.robinson@gmail.com" created="Wed, 22 Jul 2015 15:43:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=scottmf&quot; class=&quot;user-hover&quot; rel=&quot;scottmf&quot;&gt;scottmf&lt;/a&gt;, have you had any new issues with the brokers getting into a bad state?  I&apos;m seeing some intermittent cases where the brokers end up in a state where none of them think they are the master.  It&apos;s frustratingly similar in nature to this bug so I am thinking I missed another edge case w/ my original patches.&lt;/p&gt;</comment>
                            <comment id="14638308" author="anujkhandelwal" created="Thu, 23 Jul 2015 06:46:51 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;It was really helpful to see this patch. With this path broker cluster should not become orphan.  However, It is still not clear to me why zookeeper server is not able to reply within the timeframe. This error still comes even after increasing the &quot;zksessionTimeout&quot;. &lt;/p&gt;

&lt;p&gt;Details from zookeeper: From what i understand the client sends a ping every 1/3 the timeout, and then looks for a response before another 1/3 elapses. This allows time to reconnect to a different server (and still maintain the session) if the current server were to become unavailable.&lt;/p&gt;

&lt;p&gt;&quot;2014-03-04 04:56:46,861 | INFO  | Client session timed out, have not heard from server in 2667ms for sessionid 0x1437e99789c040c, closing socket connection and attempting reconnect | org.apache.zookeeper.ClientCnxn | main-SendThread(10.1.1.230:2181)&quot;&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Anuj&lt;/p&gt;</comment>
                            <comment id="14638341" author="larsn" created="Thu, 23 Jul 2015 07:03:06 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I applied to patch to two brokers but they still become unresponsive, though it seems like there are up a bit longer than without the patch. Playing with the &lt;tt&gt;zksessionTimeout&lt;/tt&gt; didn&apos;t help.&lt;/p&gt;

&lt;p&gt;Cheers,&lt;br/&gt;
Lars&lt;/p&gt;</comment>
                            <comment id="14638940" author="scottmf" created="Thu, 23 Jul 2015 14:56:22 +0000"  >&lt;p&gt;I have not seen this issue since applying the patch on top of the origin/activemq-5.11.x branch.&lt;/p&gt;

&lt;p&gt;My zookeeper timeout setting is pretty high.  On activemq my zkSessionTimeout is 60s and time timeouts in my zoo.cfg are set to:&lt;/p&gt;

&lt;p&gt;tickTime=5000&lt;br/&gt;
minSessionTimeout=2&lt;br/&gt;
maxSessionTimeout=180000&lt;/p&gt;

&lt;p&gt;Let me know if you want me to check the logs for anything specific.  It is running on DEBUG level and the logs are being forwarded to a log collection tool so i should be able to easily check&lt;/p&gt;</comment>
                            <comment id="14638990" author="jim.robinson@gmail.com" created="Thu, 23 Jul 2015 15:29:57 +0000"  >&lt;p&gt;Lars,&lt;/p&gt;

&lt;p&gt;Thanks for the reply.  Can you tell me whether or not your zkSessionTimeout matches the timeout value of your zookeeper server?  I&apos;m not sure what &quot;playing with&quot; the value means. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14638995" author="jim.robinson@gmail.com" created="Thu, 23 Jul 2015 15:30:59 +0000"  >&lt;p&gt;Ok, so that looks very much like what I have seen on my dev cluster.  Can you tell me whether or not your zkSessionTimeout value matches the value used in your zookeeper cluster?&lt;/p&gt;</comment>
                            <comment id="14661481" author="larsn" created="Fri, 7 Aug 2015 08:12:30 +0000"  >&lt;p&gt;Jim,&lt;/p&gt;

&lt;p&gt;Sorry for the late reply. My current configuration is as follows&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;zkSessionTimeout is 4s&lt;/li&gt;
	&lt;li&gt;zoo.cfg is set to tickTime=5000, minSessionTimeout and maxSessionTimeout are not set at all.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;By &quot;playing around&quot; I meant that I decreased and increased zkSessionTimeout and tickTime in quite a few different ways.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;decrease/increase both&lt;/li&gt;
	&lt;li&gt;decrease/increase only one of them&lt;/li&gt;
	&lt;li&gt;increase one and decrease the other and vice versa&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So far I did not experience the issue any more.&lt;/p&gt;
</comment>
                            <comment id="14728828" author="anujkhandelwal" created="Thu, 3 Sep 2015 10:26:27 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Sorry for the late reply. &lt;br/&gt;
No both values are different. I am using zksesseionTimeout= 15s in ActiveMQ configuration to give it more time while zookeeper configuration is : &lt;/p&gt;

&lt;p&gt;ticktime = 2000 &lt;br/&gt;
minSessionTimeout and maxSessionTimeout are not set.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Anuj&lt;/p&gt;
</comment>
                            <comment id="14728831" author="anujkhandelwal" created="Thu, 3 Sep 2015 10:30:01 +0000"  >&lt;p&gt;Should we configure zookeeper ticktime also. What is the relation between both the timeouts ?&lt;/p&gt;</comment>
                            <comment id="14729326" author="jim.robinson@gmail.com" created="Thu, 3 Sep 2015 16:07:37 +0000"  >&lt;p&gt;If you look at this code:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://grepcode.com/file/repo1.maven.org/maven2/org.apache.zookeeper/zookeeper/3.3.0/org/apache/zookeeper/server/ZooKeeperServer.java#664&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://grepcode.com/file/repo1.maven.org/maven2/org.apache.zookeeper/zookeeper/3.3.0/org/apache/zookeeper/server/ZooKeeperServer.java#664&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;you can see that if you do not set a minSessionTimeout or maxSessionTimeout then zookeeper will default to&lt;/p&gt;

&lt;p&gt;minSessionTimeout == 2 x ticktime&lt;/p&gt;

&lt;p&gt;maxSessionTimeout == 20 x ticktime&lt;/p&gt;

&lt;p&gt;The ticktime is milliseconds, so that means your configuration is currently:&lt;/p&gt;

&lt;p&gt;tickTime == 2 seconds&lt;br/&gt;
minSessionTimeout == 4 seconds&lt;br/&gt;
maxSessionTimeout == 40 seconds&lt;/p&gt;

&lt;p&gt;My configuration is the same.  So your zkSessionTimeout is within the accepted range the server will allow, but what I&apos;ve been finding is that  with my setup the server only became stable at the higher end of that timeout range.   In my case I set it to 40 seconds, the maximum the zookeeper server would allow.&lt;/p&gt;

&lt;p&gt;I think what&apos;s going on is that the code i ZooKeeperGroup.scala, e.g., at&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/activemq/blob/master/activemq-leveldb-store/src/main/scala/org/apache/activemq/leveldb/replicated/groups/ZooKeeperGroup.scala#L142&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/master/activemq-leveldb-store/src/main/scala/org/apache/activemq/leveldb/replicated/groups/ZooKeeperGroup.scala#L142&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;isn&apos;t handling all the possible exceptions that might get thrown, like with a timeout, and breaks if the timeout gets hit.&lt;/p&gt;

&lt;p&gt;I&apos;ve been too busy on other things to dig into it any more, but I&apos;m pretty confident that the activemq zookeeper client code that interacts with zookeeper server needs to be reevaluated to handle the different ways a connection might be lost.&lt;/p&gt;</comment>
                            <comment id="14730336" author="anujkhandelwal" created="Fri, 4 Sep 2015 05:19:18 +0000"  >&lt;p&gt;Thanks Jim for the detailed explanation. I will increase the value of &apos;zkSessionTimeout&apos; to 35 sec and see how it goes. &lt;/p&gt;

&lt;p&gt;&amp;gt; zookeeper client code that interacts with zookeeper server needs to be reevaluated to handle the different ways a connection might be lost.&lt;br/&gt;
I completely agree with you. We have also faced some weird issue after moving to replicated leveldb which I have posted: &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://activemq.2283324.n4.nabble.com/Durable-client-removal-caused-broker-to-shutdown-in-replicated-leveldb-td4701209.html#a4701241&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.2283324.n4.nabble.com/Durable-client-removal-caused-broker-to-shutdown-in-replicated-leveldb-td4701209.html#a4701241&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Anuj&lt;/p&gt;</comment>
                            <comment id="15030598" author="abin" created="Sat, 28 Nov 2015 17:31:36 +0000"  >&lt;p&gt;at recently, my replicated leveldb stored cluster is broken.   if zookeeper session is expired , my zookeeper client will restart to reconnect the zookeeper server that have been connected   and activemq cluser is not elected a master .  though all of the activemq node is connecting the zookeeper,   a master  will not be elected.&lt;/p&gt;


&lt;p&gt;my zkSessiontimeout is 25s and the zookeeper server ticktime=2000,,my activemq cluser is three activemq node.   it offen happens recently, please  fixed this bug.   because it reconnects and do not elected a master.&lt;/p&gt;

&lt;p&gt;why all of the activemq node do not select a master that all reconnect the zookeeper when zookeeper session has expired.&lt;/p&gt;

&lt;p&gt;sorry, my english is pool , i do not know that everyone can understand my problem,&lt;/p&gt;

&lt;p&gt;thinks!!!!&lt;/p&gt;

&lt;p&gt;my environment is produce.&lt;br/&gt;
Affects Version/s: 5.11.1&lt;/p&gt;


&lt;p&gt;but i use 5.12.1 now ,    the problem is still exists.&lt;/p&gt;</comment>
                            <comment id="15043823" author="abin" created="Sun, 6 Dec 2015 11:05:07 +0000"  >&lt;p&gt;for this,  if you set ticktime is short time, Can you try it  in the environment of produce?&lt;/p&gt;

&lt;p&gt;short time is wrong,  my ticktime is 2000 that  this wrong is appearing for a while tiime &lt;/p&gt;</comment>
                            <comment id="15055052" author="scottmf" created="Sun, 13 Dec 2015 17:09:02 +0000"  >&lt;p&gt;I cannot change the environment without risking that it will fail again.&lt;/p&gt;

&lt;p&gt;I suggest you try something similar to settings i have provided and increase your timeouts so that your zookeeper connections don&apos;t get into the state you are describing.  I have been running for several months now without any issues after applying Jim&apos;s patch.&lt;/p&gt;</comment>
                            <comment id="15064099" author="glstephen" created="Fri, 18 Dec 2015 15:36:18 +0000"  >&lt;p&gt;We are seeing something very similar to this in our development environment.&lt;/p&gt;

&lt;p&gt;We have a 3-node ActiveMQ cluster where each node has ActiveMQ 5.12.0 and Zookeeper 3.4.6 (*note, we have done some testing with Zookeeper 3.4.7, but this has failed to resolve the issue. Time constraints have so far prevented us from testing ActiveMQ 5.13).&lt;/p&gt;

&lt;p&gt;What we have found is that when we stop the master ZooKeeper process (via the &quot;end process tree&quot; command in Task Manager), the remaining two ZooKeeper nodes continue to function as normal. Sometimes the ActiveMQ cluster is able to handle this, but sometimes it does not.&lt;/p&gt;

&lt;p&gt;When the cluster fails, we typically see this in the ActiveMQ log:&lt;/p&gt;

&lt;p&gt;2015-12-18 09:08:45,157 | WARN  | Too many cluster members are connected.  Expected at most 3 members but there are 4 connected. | org.apache.activemq.leveldb.replicated.MasterElector | WrapperSimpleAppMain-EventThread&lt;br/&gt;
...&lt;br/&gt;
...&lt;br/&gt;
2015-12-18 09:27:09,722 | WARN  | Session 0x351b43b4a560016 for server null, unexpected error, closing socket connection and attempting reconnect | org.apache.zookeeper.ClientCnxn | WrapperSimpleAppMain-SendThread(192.168.0.10:2181)&lt;br/&gt;
java.net.ConnectException: Connection refused: no further information&lt;br/&gt;
	at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.7.0_79&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at sun.nio.ch.SocketChannelImpl.finishConnect(Unknown Source)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.7.0_79&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:361)&lt;span class=&quot;error&quot;&gt;&amp;#91;zookeeper-3.4.6.jar:3.4.6-1569965&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1081)&lt;span class=&quot;error&quot;&gt;&amp;#91;zookeeper-3.4.6.jar:3.4.6-1569965&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;We were immediately concerned by the fact that (A)ActiveMQ seems to think there are four members in the cluster when it is only configured with 3 and (B) when the exception is raised, the server appears to be null. We then increased ActiveMQ&apos;s logging level to DEBUG in order to display the list of members:&lt;/p&gt;

&lt;p&gt;2015-12-18 09:33:04,236 | DEBUG | ZooKeeper group changed: Map(localhost -&amp;gt; ListBuffer((0000000156,&lt;/p&gt;
{&quot;id&quot;:&quot;localhost&quot;,&quot;container&quot;:null,&quot;address&quot;:null,&quot;position&quot;:-1,&quot;weight&quot;:5,&quot;elected&quot;:null}
&lt;p&gt;), (0000000157,&lt;/p&gt;
{&quot;id&quot;:&quot;localhost&quot;,&quot;container&quot;:null,&quot;address&quot;:null,&quot;position&quot;:-1,&quot;weight&quot;:1,&quot;elected&quot;:null}
&lt;p&gt;), (0000000158,&lt;/p&gt;
{&quot;id&quot;:&quot;localhost&quot;,&quot;container&quot;:null,&quot;address&quot;:&quot;tcp://192.168.0.11:61619&quot;,&quot;position&quot;:-1,&quot;weight&quot;:10,&quot;elected&quot;:null}
&lt;p&gt;), (0000000159,&lt;/p&gt;
{&quot;id&quot;:&quot;localhost&quot;,&quot;container&quot;:null,&quot;address&quot;:null,&quot;position&quot;:-1,&quot;weight&quot;:10,&quot;elected&quot;:null}
&lt;p&gt;))) | org.apache.activemq.leveldb.replicated.MasterElector | ActiveMQ BrokerService&lt;span class=&quot;error&quot;&gt;&amp;#91;localhost&amp;#93;&lt;/span&gt; Task-14&lt;/p&gt;

&lt;p&gt;Can anyone suggest why this may be happening and/or suggest a way to resolve this?&lt;/p&gt;</comment>
                            <comment id="15064107" author="glstephen" created="Fri, 18 Dec 2015 15:38:03 +0000"  >&lt;p&gt;Attaching log/config files (zookeeper-failover-logs.7z)&lt;/p&gt;</comment>
                            <comment id="15363636" author="djj0809" created="Wed, 6 Jul 2016 02:21:04 +0000"  >&lt;p&gt;Does this issue have any progress? We also ran into the same situation with version 5.11, And have no idea how to avoid it&lt;/p&gt;</comment>
                            <comment id="15851595" author="tabish121" created="Fri, 3 Feb 2017 15:02:41 +0000"  >&lt;p&gt;LevelDB has been deprecated and is no longer supported.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12633523" name="03-07.tgz" size="649535" author="scottmf" created="Sat, 8 Mar 2014 03:14:43 +0000"/>
                            <attachment id="12639859" name="amq_5082_threads.tar.gz" size="3972" author="krm1312" created="Fri, 11 Apr 2014 20:06:50 +0000"/>
                            <attachment id="12632749" name="mq-node1-cluster.failure" size="13752" author="scottmf" created="Wed, 5 Mar 2014 03:04:42 +0000"/>
                            <attachment id="12632752" name="mq-node2-cluster.failure" size="48529" author="scottmf" created="Wed, 5 Mar 2014 03:04:42 +0000"/>
                            <attachment id="12632751" name="mq-node3-cluster.failure" size="103603" author="scottmf" created="Wed, 5 Mar 2014 03:04:42 +0000"/>
                            <attachment id="12778502" name="zookeeper-failover-logs.7z" size="275008" author="glstephen" created="Fri, 18 Dec 2015 15:38:03 +0000"/>
                            <attachment id="12632750" name="zookeeper.out-cluster.failure" size="14454" author="scottmf" created="Wed, 5 Mar 2014 03:04:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>377144</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 41 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1szlb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>377439</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>