<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:41:16 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2210] Infinite loop: WARN  PrefetchSubscription           - Ack before disaptch, waiting for recovery dispatch: MessageAck</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2210</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Reproduce steps:&lt;br/&gt;
1. setup 4 network of brokers with multicast discovery&lt;br/&gt;
2. start client consumers and producers&lt;br/&gt;
3. let the producer produce message constantly&lt;br/&gt;
4. in jconsole, stop() the broker the consumers are connecting to&lt;br/&gt;
5. after the consumers failover to another broker, the newly connected broker will get into an infinite loop:&lt;/p&gt;

&lt;p&gt;WARN  PrefetchSubscription           - Ack before disaptch, waiting for recovery dispatch: MessageAck &lt;/p&gt;
{commandId = 1232, responseRequired = true, ackType = 2, consumerId = ID:host01-39430-1239887122787-0:0:2:1, firstMessageId = ID:host01-39430-1239887122787-0:0:87:1:5, lastMessageId = ID:host01-39430-1239887122787-0:0:87:1:5, destination = queue://Consumer.A-host01-1527-1239887124983.VirtualTopic.B, transactionId = TX:ID:host01-39430-1239887122787-0:0:38, messageCount = 1}

&lt;p&gt;This broker will stop functioning and consumer is not processing messages. &lt;/p&gt;
</description>
                <environment>&lt;p&gt;solaris 10 trunk version 764403&lt;/p&gt;</environment>
        <key id="12482550">AMQ-2210</key>
            <summary>Infinite loop: WARN  PrefetchSubscription           - Ack before disaptch, waiting for recovery dispatch: MessageAck</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="yinghe0101">ying</reporter>
                        <labels>
                    </labels>
                <created>Thu, 16 Apr 2009 13:52:12 +0000</created>
                <updated>Thu, 14 Nov 2013 14:54:16 +0000</updated>
                            <resolved>Fri, 17 Apr 2009 09:37:48 +0000</resolved>
                                    <version>5.2.0</version>
                                    <fixVersion>5.3.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>1</watches>
                                                                                                                                                            <comments>
                            <comment id="12941172" author="gtully" created="Thu, 16 Apr 2009 15:35:20 +0000"  >&lt;p&gt;The intention of that wait is to allow a master/slave broker to start or restart and redeliver messages before an outstanding ack from a client is processed. In a network of brokers scenario, any unacked message will remain on the original broker so it will never get redelivered. In this case, it makes sense to get an unmatched ack exception.&lt;br/&gt;
The simple fix is to limit that wait to a few seconds and process the ack in the normal way even if the wait expires. Worst case scenario there is an unmatched ack exception and the message is eventually redelivered and should be seen as a duplicate.&lt;/p&gt;

&lt;p&gt;So failover among a network of brokers will always be a little more lossy in terms of message ordering than master slave.&lt;/p&gt;</comment>
                            <comment id="12941182" author="gtully" created="Fri, 17 Apr 2009 09:37:48 +0000"  >&lt;p&gt;resolved in r765921&lt;/p&gt;

&lt;p&gt;related issue that introduced this problem is &lt;a href=&quot;https://issues.apache.org/activemq/browse/AMQ-2149&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/activemq/browse/AMQ-2149&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12941181" author="gtully" created="Fri, 17 Apr 2009 09:39:22 +0000"  >&lt;p&gt;wait introduced in the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2149&quot; title=&quot;Shared Filesystem Master Slave: missing messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-2149&quot;&gt;&lt;del&gt;AMQ-2149&lt;/del&gt;&lt;/a&gt; needed to be reverted to resolve this issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12482954">AMQ-2149</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75024</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 32 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rzmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161415</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>