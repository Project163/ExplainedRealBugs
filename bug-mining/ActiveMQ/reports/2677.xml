<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:24:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6004] TcpTransportServer#socketHandlerThread should be intterrupted to stop the socket handler (daemon) thread</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6004</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I am trying to achieve a clean shutdown of an embedded broker in a web application running in Tomcat. When the web application is shut down, Tomcat is always complaining about a running thread:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;09:09:55.948 WARN  [o.a.c.loader.WebappClassLoaderBase] [] The web application [xxx] appears to have started a thread named [ActiveMQ Transport Server &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; Handler: tcp:&lt;span class=&quot;code-comment&quot;&gt;//0.0.0.0:12345] but has failed to stop it. This is very likely to create a memory leak. Stack trace of thread:
&lt;/span&gt; sun.misc.Unsafe.park(Native Method)
 java.util.concurrent.locks.LockSupport.parkNanos(Unknown Source)
 java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(Unknown Source)
 java.util.concurrent.LinkedBlockingQueue.poll(Unknown Source)
 org.apache.activemq.transport.tcp.TcpTransportServer$2.run(TcpTransportServer.java:427)
 java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(Unknown Source)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I am pretty sure this can be easily fixed by interrupting the socket handler thread, as suggested by Andreas Hartmann in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-3451?focusedCommentId=13170863&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13170863&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;AMQ-3451&lt;/a&gt;. Please see attached patch.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12903308">AMQ-6004</key>
            <summary>TcpTransportServer#socketHandlerThread should be intterrupted to stop the socket handler (daemon) thread</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="erikgb">Erik Godding Boye</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Oct 2015 09:25:25 +0000</created>
                <updated>Wed, 18 Nov 2015 16:21:38 +0000</updated>
                            <resolved>Thu, 8 Oct 2015 12:15:13 +0000</resolved>
                                    <version>5.12.0</version>
                                    <fixVersion>5.12.1</fixVersion>
                    <fixVersion>5.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14948556" author="jira-bot" created="Thu, 8 Oct 2015 12:13:27 +0000"  >&lt;p&gt;Commit 4adc8e4f4e57a4335643f49c3072e5fd531c7f27 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4adc8e4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4adc8e4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6004&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6004&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Calling socketHandlerThread.interrupt() on TcpTransportServer stop to&lt;br/&gt;
make sure the broker shutsdown cleanly.&lt;/p&gt;

&lt;p&gt;Patch applied with thanks to Erik Godding Boye&lt;/p&gt;</comment>
                            <comment id="14948561" author="jira-bot" created="Thu, 8 Oct 2015 12:14:24 +0000"  >&lt;p&gt;Commit a0d8a15465eccec04e1273acfb7594f042ffdf46 in activemq&apos;s branch refs/heads/activemq-5.12.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=a0d8a15&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=a0d8a15&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6004&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6004&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Calling socketHandlerThread.interrupt() on TcpTransportServer stop to&lt;br/&gt;
make sure the broker shutsdown cleanly.&lt;/p&gt;

&lt;p&gt;Patch applied with thanks to Erik Godding Boye&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 4adc8e4f4e57a4335643f49c3072e5fd531c7f27)&lt;/p&gt;</comment>
                            <comment id="14948564" author="christopher.l.shannon" created="Thu, 8 Oct 2015 12:15:13 +0000"  >&lt;p&gt;This is a good idea to do to make sure things shutdown cleanly.  Patch applied with thanks.&lt;/p&gt;</comment>
                            <comment id="15011305" author="jira-bot" created="Wed, 18 Nov 2015 16:21:38 +0000"  >&lt;p&gt;Commit 15412bae64bf265687b1099e19cba008bac9c825 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=15412ba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=15412ba&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;AMQ4221Test - remove system exit as it breaks surefire fork, &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6004&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6004&lt;/a&gt; interrupt causes errors on shutdown. Two are sorted but the check for errors in the logs may still cause intermittent failures&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12765554" name="Interrupt_socket_handler_thread_to_stop_daemon_thread.patch" size="802" author="erikgb" created="Thu, 8 Oct 2015 09:25:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mqrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>