<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:34:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6221] ActiveMQTextMessage should synchronize on state changes</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6221</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;In &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5857&quot; title=&quot;Message content stored twice while sending&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5857&quot;&gt;&lt;del&gt;AMQ-5857&lt;/del&gt;&lt;/a&gt;, the text field was changed to be cleared after calling beforeMarshall on a text message.  This is causing general concurrency issues when multiple threads access the message.  The most notable issue is when using the VM transport and concurrent store and dispatch is turned on for KahaDB as seen in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6218&quot; title=&quot;Message content returns null occasionally from Virtual Topic to the consumer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6218&quot;&gt;&lt;del&gt;AMQ-6218&lt;/del&gt;&lt;/a&gt;.  In that ticket I re-arranged the order a bit on copy to help with the race condition but it is still theoretically possible.  We need to add explicit synchronization when reading/writing the marshalled/unmarshalled state fields to prevent the race condition in ActiveMQTextMessage.&lt;/p&gt;

&lt;p&gt;Right now ActiveMQTextMessage is the main issue since it has been changed to clear out text on marshalling by default.   Map and Object messages don&apos;t currently clear out their data by default like text message does so they aren&apos;t currently affected but would need synchronization added in a future commit if the same strategy was followed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12952465">AMQ-6221</key>
            <summary>ActiveMQTextMessage should synchronize on state changes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="cshannon">Christopher L. Shannon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Mar 2016 14:54:28 +0000</created>
                <updated>Mon, 11 Apr 2016 12:22:45 +0000</updated>
                            <resolved>Mon, 11 Apr 2016 12:22:13 +0000</resolved>
                                    <version>5.13.2</version>
                                    <fixVersion>5.13.3</fixVersion>
                    <fixVersion>5.14.0</fixVersion>
                                    <component>Broker</component>
                    <component>JMS client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15206684" author="jira-bot" created="Tue, 22 Mar 2016 16:16:36 +0000"  >&lt;p&gt;Commit e0c549996479c2a1ccf70029ad4462cb987650f6 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e0c5499&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e0c5499&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6221&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6221&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Synchronizing ActiveMQText message on state changes for the content and&lt;br/&gt;
text fields so that they are always changed together.  This will prevent&lt;br/&gt;
race conditions where data can be lost when using concurrent store and&lt;br/&gt;
dispatch.&lt;/p&gt;</comment>
                            <comment id="15206687" author="christopher.l.shannon" created="Tue, 22 Mar 2016 16:17:35 +0000"  >&lt;p&gt;Fix applied, a test will be included as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6222&quot; title=&quot;Message content can be cleared by mistake when isReduceMemoryFootprint is enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6222&quot;&gt;&lt;del&gt;AMQ-6222&lt;/del&gt;&lt;/a&gt; which can be used to debug both this issue and &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6218&quot; title=&quot;Message content returns null occasionally from Virtual Topic to the consumer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6218&quot;&gt;&lt;del&gt;AMQ-6218&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15207045" author="jira-bot" created="Tue, 22 Mar 2016 18:57:16 +0000"  >&lt;p&gt;Commit 6c2a825ebb516e9b37cdb913800de0306ed7e670 in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=6c2a825&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=6c2a825&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6221&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6221&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Synchronizing ActiveMQText message on state changes for the content and&lt;br/&gt;
text fields so that they are always changed together.  This will prevent&lt;br/&gt;
race conditions where data can be lost when using concurrent store and&lt;br/&gt;
dispatch.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit e0c549996479c2a1ccf70029ad4462cb987650f6)&lt;/p&gt;</comment>
                            <comment id="15234967" author="jira-bot" created="Mon, 11 Apr 2016 12:18:29 +0000"  >&lt;p&gt;Commit 837da7e58222e49c76da062c6aa8e3d32432a1a7 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=837da7e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=837da7e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;https://issues.apache.org/jira/browse/AMQ-6221&quot;&lt;/p&gt;

&lt;p&gt;Reverting commit to keep sync out of the client messages&lt;/p&gt;

&lt;p&gt;This reverts commit e0c549996479c2a1ccf70029ad4462cb987650f6.&lt;/p&gt;</comment>
                            <comment id="15234968" author="jira-bot" created="Mon, 11 Apr 2016 12:19:25 +0000"  >&lt;p&gt;Commit 078da5e7f8b2cff44899332dde5db53bfc3a7ffc in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=078da5e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=078da5e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;https://issues.apache.org/jira/browse/AMQ-6221&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 6c2a825ebb516e9b37cdb913800de0306ed7e670.&lt;/p&gt;</comment>
                            <comment id="15234976" author="christopher.l.shannon" created="Mon, 11 Apr 2016 12:22:45 +0000"  >&lt;p&gt;As discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6142&quot; title=&quot;ActiveMQBytesMessage decompress throws DataFormatException incorrect header check&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6142&quot;&gt;&lt;del&gt;AMQ-6142&lt;/del&gt;&lt;/a&gt;, backing out the sync changes as the goal with the message api is that messages will be copied when changes are made.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12951170">AMQ-6218</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12952488">AMQ-6222</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2v147:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>