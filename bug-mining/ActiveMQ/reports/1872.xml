<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:59:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4472] consumer.close() on transacted session does not release prefetched messages</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4472</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When using transactions an issue can arise where the consumer has messages in it&apos;s prefetch and when consumer.close() is called the consumer is not closed and does not release the messages.  &lt;/p&gt;


&lt;p&gt;The use case is as follows:&lt;/p&gt;

&lt;p&gt;1) Create producer&lt;br/&gt;
2) Create consumer&lt;br/&gt;
3) Send message to queue&lt;br/&gt;
4) Commit session&lt;br/&gt;
5) Send a new message&lt;br/&gt;
6) Close the consumer&lt;br/&gt;
7) Start a new consumer&lt;br/&gt;
8) Try to receive the message&lt;/p&gt;

&lt;p&gt;Test case will be attached shortly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12642778">AMQ-4472</key>
            <summary>consumer.close() on transacted session does not release prefetched messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chirino">Hiram R. Chirino</assignee>
                                    <reporter username="jsherman1">Jason Sherman</reporter>
                        <labels>
                            <label>transactions</label>
                    </labels>
                <created>Tue, 16 Apr 2013 17:50:54 +0000</created>
                <updated>Wed, 16 Jul 2014 20:30:24 +0000</updated>
                            <resolved>Fri, 26 Apr 2013 15:43:10 +0000</resolved>
                                    <version>5.8.0</version>
                                    <fixVersion>5.9.0</fixVersion>
                                    <component>JMS client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13633083" author="jsherman1" created="Tue, 16 Apr 2013 17:55:38 +0000"  >&lt;p&gt;If you commit after the close, the test will work as expected and the first consumer is shutdown.&lt;/p&gt;</comment>
                            <comment id="13638097" author="gtully" created="Mon, 22 Apr 2013 15:22:53 +0000"  >&lt;p&gt;prefetch=0 works around this. but the problem is that a new transaction is created on the session by the second send, and the close is deferred till that commits (the close registers a synchroniztion if there is a transaction).&lt;br/&gt;
With prefetch=0, the consumer has no pending messages so the effect of the deferred close is invisible.&lt;/p&gt;</comment>
                            <comment id="13640814" author="chirino" created="Wed, 24 Apr 2013 19:16:42 +0000"  >&lt;p&gt;So using preftech=0 is just a work-around. It should also work for any preftech value.&lt;br/&gt;
IMO, as long as the consumer has not acked any of the prefetched messages, it should not consider itself as being part of the transaction.&lt;/p&gt;</comment>
                            <comment id="13642966" author="gtully" created="Fri, 26 Apr 2013 15:43:10 +0000"  >&lt;p&gt;fix in &lt;a href=&quot;http://svn.apache.org/r1471673&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1471673&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12727771">AMQNET-484</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12578985" name="amq-4472.zip" size="25502" author="jsherman1" created="Tue, 16 Apr 2013 18:57:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323192</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jrev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323537</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>