<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:02:31 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4906] advisory producerCount = 0 is not received on temporary queue</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4906</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;i notice i never receive producer advisory messages (ActiveMQ.Advisory.Producer.Queue .&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;) with producerCount=0 when the client message producers on temporary queue are closed. i do receive producerCount &amp;gt; 0. &lt;/p&gt;

&lt;p&gt;However, the consumerCount (from ActiveMQ.Advisory.Consumer.Queue.&lt;span class=&quot;error&quot;&gt;&amp;#91;...&amp;#93;&lt;/span&gt;) appears to work as expected.&lt;/p&gt;

&lt;p&gt;From looking into org.apache.activemq.advisory.AdvisoryBroker.java&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void removeProducer(ConnectionContext context, ProducerInfo info) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.removeProducer(context, info);

        &lt;span class=&quot;code-comment&quot;&gt;// Don&apos;t advise advisory topics.
&lt;/span&gt;        ActiveMQDestination dest = info.getDestination();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (info.getDestination() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !AdvisorySupport.isAdvisoryTopic(dest)) {
            ActiveMQTopic topic = AdvisorySupport.getProducerAdvisoryTopic(dest);
            producers.remove(info.getProducerId());
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!dest.isTemporary() || destinations.contains(dest)) { &lt;span class=&quot;code-comment&quot;&gt;// PLEASE NOTE: &amp;lt;== could &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; actually be destinations.containsKey(dest)
&lt;/span&gt;                fireProducerAdvisory(context, dest,topic, info.createRemoveCommand());
            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;as reference, the &quot;working&quot; removeConsumer method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void removeConsumer(ConnectionContext context, ConsumerInfo info) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;.removeConsumer(context, info);

        &lt;span class=&quot;code-comment&quot;&gt;// Don&apos;t advise advisory topics.
&lt;/span&gt;        ActiveMQDestination dest = info.getDestination();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!AdvisorySupport.isAdvisoryTopic(dest)) {
            ActiveMQTopic topic = AdvisorySupport.getConsumerAdvisoryTopic(dest);
            consumers.remove(info);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!dest.isTemporary() || destinations.containsKey(dest)) {
                fireConsumerAdvisory(context,dest, topic, info.createRemoveCommand());
            }
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please note the destinations.containsKey(dest) vs destinations.contains(dest) (for concurrentHashMaps this is identical to containsValue()). I&apos;m assuming the logic is to make sure the producer destination do exist in both cases&lt;/p&gt;

&lt;p&gt;I tested this with 5.7.0. the code is similar in 5.9.0&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12681674">AMQ-4906</key>
            <summary>advisory producerCount = 0 is not received on temporary queue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="cmamen">Christian Mamen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Nov 2013 22:30:26 +0000</created>
                <updated>Wed, 3 Dec 2014 20:36:56 +0000</updated>
                            <resolved>Thu, 28 Nov 2013 12:58:12 +0000</resolved>
                                    <version>5.7.0</version>
                                    <fixVersion>5.10.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13843450" author="cmamen" created="Mon, 9 Dec 2013 19:32:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajdavies&quot; class=&quot;user-hover&quot; rel=&quot;rajdavies&quot;&gt;rajdavies&lt;/a&gt; Hi, will you commit a fix to the trunk prior to 5.10.0 release ?&lt;/p&gt;</comment>
                            <comment id="13843454" author="rajdavies" created="Mon, 9 Dec 2013 19:36:05 +0000"  >&lt;p&gt;It should be in trunk already - you could try it with the latest SNAPSHOT - see &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13843656" author="cmamen" created="Mon, 9 Dec 2013 22:55:01 +0000"  >&lt;p&gt;Yes it is, i didnt see it properly, thanks&lt;/p&gt;</comment>
                            <comment id="13843967" author="rajdavies" created="Tue, 10 Dec 2013 05:29:44 +0000"  >&lt;p&gt;Phew! I always worry I might have done something stupid! Thanks Christian for the fix!&lt;/p&gt;</comment>
                            <comment id="14020957" author="artnaseef" created="Sat, 7 Jun 2014 20:30:04 +0000"  >&lt;p&gt;Git commit: &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;a=commit;h=11781d3cf2a351ea5f3ef80f29f351ac42d3538e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;a=commit;h=11781d3cf2a351ea5f3ef80f29f351ac42d3538e&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12759263">AMQ-5474</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>360938</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 24 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1q7wv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>361237</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>