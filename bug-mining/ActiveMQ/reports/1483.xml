<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:53:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3804] NullPointerException logged every 30 seconds while attempting to clear expired messages </title>
                <link>https://issues.apache.org/jira/browse/AMQ-3804</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;this is a duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-3677&quot; title=&quot;NullPointerException in MessageDatabase leaves message stuck in KahaDB&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-3677&quot;&gt;&lt;del&gt;AMQ-3677&lt;/del&gt;&lt;/a&gt; which was marked resolved. however i am still noticing this issue using the 5.6 snapshot release from apr 11, 2012. in this case activemq server was shutdown by terminating the java process. when the server is started again, following exception is logged every 30 seconds:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2012-04-11 14:06:53,786 org.apache.activemq.broker.region.Topic[ActiveMQ Broker[ZyrionMessageBus] Scheduler]: (ERROR) (   Topic.java:683) Failed to remove expired Message from the store 
java.lang.NullPointerException
	at org.apache.activemq.store.kahadb.MessageDatabase.removeAckLocation(MessageDatabase.java:2005)
	at org.apache.activemq.store.kahadb.MessageDatabase.updateIndex(MessageDatabase.java:1259)
	at org.apache.activemq.store.kahadb.MessageDatabase$15.execute(MessageDatabase.java:1046)
	at org.apache.kahadb.page.Transaction.execute(Transaction.java:769)
	at org.apache.activemq.store.kahadb.MessageDatabase.process(MessageDatabase.java:1044)
	at org.apache.activemq.store.kahadb.MessageDatabase$13.visit(MessageDatabase.java:977)
	at org.apache.activemq.store.kahadb.data.KahaRemoveMessageCommand.visit(KahaRemoveMessageCommand.java:220)
	at org.apache.activemq.store.kahadb.MessageDatabase.process(MessageDatabase.java:969)
	at org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:881)
	at org.apache.activemq.store.kahadb.MessageDatabase.store(MessageDatabase.java:863)
	at org.apache.activemq.store.kahadb.KahaDBStore$KahaDBTopicMessageStore.doAcknowledge(KahaDBStore.java:715)
	at org.apache.activemq.store.kahadb.KahaDBStore$KahaDBTopicMessageStore.acknowledge(KahaDBStore.java:701)
	at org.apache.activemq.store.kahadb.KahaDBTransactionStore.acknowledge(KahaDBTransactionStore.java:519)
	at org.apache.activemq.store.kahadb.KahaDBTransactionStore$2.acknowledge(KahaDBTransactionStore.java:222)
	at org.apache.activemq.broker.region.Topic.acknowledge(Topic.java:489)
	at org.apache.activemq.broker.region.Topic.messageExpired(Topic.java:681)
	at org.apache.activemq.broker.region.Topic.doBrowse(Topic.java:562)
	at org.apache.activemq.broker.region.Topic.access$100(Topic.java:62)
	at org.apache.activemq.broker.region.Topic$6.run(Topic.java:662)
	at org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)
	at java.util.TimerThread.mainLoop(Unknown Source)
	at java.util.TimerThread.run(Unknown Source)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;here is the server configuration:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;beans
    xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.springframework.org/schema/beans&quot;&lt;/span&gt;
&lt;/span&gt;    xmlns:amq=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//activemq.apache.org/schema/core&quot;&lt;/span&gt;
&lt;/span&gt;    xmlns:xsi=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.w3.org/2001/XMLSchema-instance&quot;&lt;/span&gt;
&lt;/span&gt;    xsi:schemaLocation=&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-2.0.xsd
&lt;/span&gt;    http:&lt;span class=&quot;code-comment&quot;&gt;//activemq.apache.org/schema/core http://activemq.apache.org/schema/core/activemq-core.xsd&quot;&amp;gt;
&lt;/span&gt;
  &amp;lt;!-- Allows us to use system properties as variables in &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; configuration file --&amp;gt;
  &amp;lt;bean class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;&lt;/span&gt;/&amp;gt;
  
  &amp;lt;!-- Configure the ActiveMQ broker --&amp;gt;
  &amp;lt;broker
      xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//activemq.apache.org/schema/core&quot;&lt;/span&gt;
&lt;/span&gt;      brokerName=&lt;span class=&quot;code-quote&quot;&gt;&quot;ZyrionMessageBus&quot;&lt;/span&gt; 
      useJmx=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;
      dataDirectory=&lt;span class=&quot;code-quote&quot;&gt;&quot;${activemq.base}/../../utils/spool/jms&quot;&lt;/span&gt;
      deleteAllMessagesOnStartup=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;
      advisorySupport=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;
      offlineDurableSubscriberTimeout=&lt;span class=&quot;code-quote&quot;&gt;&quot;7200000&quot;&lt;/span&gt;
      offlineDurableSubscriberTaskSchedule=&lt;span class=&quot;code-quote&quot;&gt;&quot;1800000&quot;&lt;/span&gt;&amp;gt;

    [...]

    &amp;lt;!-- Configure message persistence &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the broker --&amp;gt;
    &amp;lt;persistenceAdapter&amp;gt;
      &amp;lt;kahaDB directory=&lt;span class=&quot;code-quote&quot;&gt;&quot;${activemq.base}/../../utils/spool/jms/kahadb&quot;&lt;/span&gt; ignoreMissingJournalfiles=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; checkForCorruptJournalFiles=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt; checksumJournalFiles=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/persistenceAdapter&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;i can provide a copy of the kahadb directory if necessary to duplicate the issue. let me know if you require any additional information. thanks&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Windows XP SP3&lt;/p&gt;</environment>
        <key id="12550585">AMQ-3804</key>
            <summary>NullPointerException logged every 30 seconds while attempting to clear expired messages </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="rajib_rashid">Rajib Rashid</reporter>
                        <labels>
                    </labels>
                <created>Wed, 11 Apr 2012 21:20:43 +0000</created>
                <updated>Mon, 16 Apr 2012 17:42:47 +0000</updated>
                            <resolved>Mon, 16 Apr 2012 17:35:01 +0000</resolved>
                                    <version>5.6.0</version>
                                    <fixVersion>5.6.0</fixVersion>
                                    <component>Message Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13254814" author="johno" created="Mon, 16 Apr 2012 17:09:51 +0000"  >&lt;p&gt;If the stacktrace is fresh this could mean that the stored destination does not have any message references to the given message sequence (returns null) and when we try and unbox the Long we hit an NPE.&lt;/p&gt;</comment>
                            <comment id="13254829" author="rajdavies" created="Mon, 16 Apr 2012 17:35:01 +0000"  >&lt;p&gt;I believe Johno is correct in his diagnosis - resolved by SVN revision 1326692&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12522816" name="AMQ-3804.patch" size="121371" author="johno" created="Mon, 16 Apr 2012 17:42:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>235449</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ahxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59179</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>