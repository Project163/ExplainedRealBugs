<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:02:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4740] heart-beat is disabled when connecting to web socket</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4740</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;If I use the stomp.js library to connect to ActiveMQ over its WebSocket url (ws://localhost:61614), the CONNECTED frame returns with disabled heart-beat:&lt;/p&gt;

&lt;p&gt;CONNECTED&lt;br/&gt;
heart-beat:0,0&lt;br/&gt;
session:ID:retsina.local-63633-1380117269290-2:1&lt;br/&gt;
server:ActiveMQ/5.8.0&lt;br/&gt;
version:1.1&lt;/p&gt;

&lt;p&gt;If I connect to its TCP socket (localhost:61613), the CONNECT frame will have heart-beat:&lt;/p&gt;

&lt;p&gt;CONNECTED&lt;br/&gt;
heart-beat:10000,10000&lt;br/&gt;
session:ID:retsina.local-63384-1380115729700-2:12&lt;br/&gt;
server:ActiveMQ/5.8.0&lt;br/&gt;
version:1.1&lt;/p&gt;

&lt;p&gt;In both case, the stomp.js send the same CONNECT frame with heart-beat:&lt;/p&gt;

&lt;p&gt;CONNECT&lt;br/&gt;
login:user&lt;br/&gt;
passcode:password&lt;br/&gt;
accept-version:1.1,1.0&lt;br/&gt;
heart-beat:10000,10000&lt;/p&gt;

&lt;p&gt;Is heart-beat disabled on purpose for Web Socket? Please note that the stomp.js does support heart-beat (using window.setInterval in a Web browser)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Google Chrome 29.0.1547.76 (Official Build 223446) &lt;/p&gt;</environment>
        <key id="12670485">AMQ-4740</key>
            <summary>heart-beat is disabled when connecting to web socket</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jmesnil">Jeff Mesnil</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Sep 2013 13:56:34 +0000</created>
                <updated>Tue, 31 Mar 2015 21:38:07 +0000</updated>
                            <resolved>Tue, 31 Mar 2015 21:38:07 +0000</resolved>
                                    <version>5.8.0</version>
                    <version>5.10.0</version>
                                    <fixVersion>5.9.1</fixVersion>
                    <fixVersion>5.10.0</fixVersion>
                                        <due></due>
                            <votes>6</votes>
                                    <watches>15</watches>
                                                                                                                <comments>
                            <comment id="13781955" author="tabish121" created="Mon, 30 Sep 2013 15:56:38 +0000"  >&lt;p&gt;Have you tested with the latest 5.9-SNAPSHOT?  Can you create a unit test to reproduce?  &lt;/p&gt;</comment>
                            <comment id="13802753" author="kearls" created="Wed, 23 Oct 2013 09:57:47 +0000"  >&lt;p&gt;This was failing because StompSocket did not have an InactivityMonitor defined, so I have added an instance of StompInactivityMonitor.&lt;/p&gt;

&lt;p&gt;I tested this manually.  We now return the correct heartbeat, and the server will terminate the connection properly.  I did not add an automated test.  We have some old tests which use Selenium that could be extended to test this, but they are currently deactivated.&lt;/p&gt;</comment>
                            <comment id="13802998" author="tabish121" created="Wed, 23 Oct 2013 16:25:23 +0000"  >&lt;p&gt;Patch applied, thanks.&lt;/p&gt;</comment>
                            <comment id="13958800" author="jprillaman" created="Thu, 3 Apr 2014 13:19:48 +0000"  >&lt;p&gt;I have applied this patch to version 5.9.0 and have also installed a 5.10.0 snapshot. With each version I receive the following error after establishing a connection and heartbeat through stomp.js. This seems to occur after the &apos;PING&apos; is sent.&lt;/p&gt;

&lt;p&gt;---------- stomp.js output&lt;br/&gt;
&amp;lt;&amp;lt;&amp;lt; CONNECTED&lt;br/&gt;
heart-beat:10000,10000&lt;br/&gt;
session:ID:localhost.localdomain-45596-1396530920609-2:2&lt;br/&gt;
server:ActiveMQ/5.10-SNAPSHOT&lt;br/&gt;
version:1.1&lt;/p&gt;

&lt;p&gt;send PING every 10000ms &lt;br/&gt;
check PONG every 10000ms &lt;br/&gt;
&amp;lt;&amp;lt;&amp;lt; PONG &lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; PING &lt;br/&gt;
did not receive server activity for the last 20005ms &lt;br/&gt;
Whoops! Lost connection to ws://172.16.99.73:61614/stomp &lt;/p&gt;

&lt;p&gt;--------------------- activemq console ---------------&lt;br/&gt;
WARN | Transport Connection to: StompSocket_19548821 failed: java.io.IOException&lt;br/&gt;
Exception in thread &quot;ActiveMQ InactivityMonitor Worker&quot; java.lang.NullPointerException&lt;br/&gt;
	at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)&lt;br/&gt;
	at org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:722)&lt;/p&gt;


&lt;p&gt;WARN | Transport Connection to: StompSocket_19548821 failed: java.io.IOException&lt;br/&gt;
Exception in thread &quot;ActiveMQ InactivityMonitor Worker&quot; java.lang.NullPointerException&lt;br/&gt;
	at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)&lt;br/&gt;
	at org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:722)&lt;/p&gt;</comment>
                            <comment id="13986831" author="pcarman" created="Thu, 1 May 2014 18:19:05 +0000"  >&lt;p&gt;I&apos;m using version 5.9.1.  I still see this issue when I connect to the broker using STOMP over websocket. Output from the console:&lt;/p&gt;

&lt;p&gt;WARN | Transport Connection to: StompSocket_5104867 failed: java.io.IOException&lt;br/&gt;
Exception in thread &quot;ActiveMQ InactivityMonitor Worker&quot; java.lang.NullPointerException&lt;br/&gt;
        at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)&lt;br/&gt;
        at org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:722)&lt;/p&gt;</comment>
                            <comment id="13986982" author="jakanapes" created="Thu, 1 May 2014 20:53:11 +0000"  >&lt;p&gt;Seeing the same exception as Paddy.&lt;/p&gt;

&lt;p&gt;I&apos;m using the 5.9.1 homebrew version locally, but seeing the same thing on our staging environment.&lt;/p&gt;

&lt;p&gt;If I set the heartbeat to 0,0, the browser receives messages, even though it disconnects every 5 minutes and has to reconnect. &lt;/p&gt;

&lt;p&gt;With the heartbeat set to 10000,10000, the browser never receives messages.&lt;/p&gt;</comment>
                            <comment id="13987625" author="tcharl" created="Fri, 2 May 2014 12:10:21 +0000"  >&lt;p&gt;Same as Paddy here too with 5.9.1.&lt;/p&gt;

&lt;p&gt;Please reopen&lt;/p&gt;</comment>
                            <comment id="14008393" author="chadkelly" created="Sun, 25 May 2014 18:14:42 +0000"  >&lt;p&gt;Please reopen this ticket. The bug described above is still present in 5.9.1. I tried both cases, heartbeat set to  0,0 and 10000,10000. Slightly different buggy behaviors, but it still does not work. Please:&lt;br/&gt;
1) download 5.9.1&lt;br/&gt;
2) bin/activemq console xbean:examples/conf/activemq-demo.xml&lt;br/&gt;
3) open two browsers (firefox/chrome) to &lt;a href=&quot;http://localhost:8161/demo/websocket/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8161/demo/websocket/index.html&lt;/a&gt;&lt;br/&gt;
4) type a few messages over a 5 minute period&lt;/p&gt;

&lt;p&gt; WARN | Transport Connection to: StompSocket_1998606381 failed: java.io.IOException&lt;br/&gt;
 WARN | Transport Connection to: StompSocket_178709817 failed: java.io.IOException&lt;br/&gt;
Exception in thread &quot;ActiveMQ InactivityMonitor Worker&quot; java.lang.NullPointerException&lt;br/&gt;
        at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)&lt;br/&gt;
        at org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
Exception in thread &quot;ActiveMQ InactivityMonitor Worker&quot; java.lang.NullPointerException&lt;br/&gt;
        at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)&lt;br/&gt;
        at org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:745)&lt;/p&gt;</comment>
                            <comment id="14010995" author="bergamot" created="Wed, 28 May 2014 10:16:01 +0000"  >&lt;p&gt;I also already opened a ticket for the above heartbeat bug: &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5155&quot; title=&quot;Heartbeat fails in STOMP over WebSockets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5155&quot;&gt;&lt;del&gt;AMQ-5155&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14027792" author="jmesnil" created="Wed, 11 Jun 2014 14:07:20 +0000"  >&lt;p&gt;Issue is still happening with ActiveMQ 5.10.0.&lt;/p&gt;

&lt;p&gt;In the log:&lt;/p&gt;

&lt;p&gt;2014-06-11 15:27:59,776 | WARN  | Transport Connection to: StompSocket_1430955985 failed: java.io.IOException | org.apache.activemq.broker.TransportConnection.Transport | qtp542980314-29&lt;/p&gt;

&lt;p&gt;The corresponding STOMP frames were:&lt;/p&gt;

&lt;p&gt;CONNECT&lt;br/&gt;
accept-version:1.1,1.0&lt;br/&gt;
heart-beat:20000,60000&lt;/p&gt;

&lt;p&gt;CONNECTED&lt;br/&gt;
server:ActiveMQ/5.10.0&lt;br/&gt;
heart-beat:60000,20000&lt;br/&gt;
session:ID:jeff.local-51540-1402496252734-2:1&lt;br/&gt;
version:1.1&lt;/p&gt;

&lt;p&gt;And the Web Socket client was sending PING frames every 20 seconds.&lt;/p&gt;
</comment>
                            <comment id="14352886" author="sebsjo" created="Mon, 9 Mar 2015 12:31:50 +0000"  >&lt;p&gt;The StompSocket IOException seems to still be an issue with ActiveMQ 5.11.1 (and jetty-8.1.17).&lt;/p&gt;

&lt;p&gt;I did some further investigations, and it seems like the java.io.IOException is caused by a java.io.EOFException that in its turn is caused by an InputStream being closed (since there is no more data to be read) and this is not handled gracefully. Quickly added a try-catch block for EOFException and it now seems to work. Should probably be handled in a better way though than what is in the attached &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4740&quot; title=&quot;heart-beat is disabled when connecting to web socket&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4740&quot;&gt;&lt;del&gt;AMQ-4740&lt;/del&gt;&lt;/a&gt;-EOF.diff.&lt;/p&gt;

&lt;p&gt;This patch does not solve the heart-beat issue though, but by applying the suggested code from Claudio in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5155&quot; title=&quot;Heartbeat fails in STOMP over WebSockets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5155&quot;&gt;&lt;del&gt;AMQ-5155&lt;/del&gt;&lt;/a&gt; this seems to work fine, at least when testing with stomp.js:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Opening Web Socket...
Web Socket Opened...
&amp;gt;&amp;gt;&amp;gt; CONNECT
login:
passcode:password
accept-version:1.1,1.0
heart-beat:10000,10000

&amp;lt;&amp;lt;&amp;lt; CONNECTED
heart-beat:10000,10000
session:ID:server01-55719-1425899064567-4:58
server:ActiveMQ/5.11.1
version:1.1

connected to server ActiveMQ/5.11.1
send PING every 10000ms
check PONG every 10000ms
connected to Stomp
&amp;gt;&amp;gt;&amp;gt; SUBSCRIBE
id:sub-0
destination:/topic/chat.general

&amp;lt;&amp;lt;&amp;lt; PONG
&amp;gt;&amp;gt;&amp;gt; PING
&amp;lt;&amp;lt;&amp;lt; PONG
&amp;gt;&amp;gt;&amp;gt; PING
&amp;lt;&amp;lt;&amp;lt; PONG
&amp;gt;&amp;gt;&amp;gt; PING
&amp;lt;&amp;lt;&amp;lt; PONG
&amp;gt;&amp;gt;&amp;gt; PING
&amp;lt;&amp;lt;&amp;lt; PONG
&amp;gt;&amp;gt;&amp;gt; PING
&amp;lt;&amp;lt;&amp;lt; PONG
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14389465" author="tabish121" created="Tue, 31 Mar 2015 21:38:07 +0000"  >&lt;p&gt;Fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5155&quot; title=&quot;Heartbeat fails in STOMP over WebSockets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5155&quot;&gt;&lt;del&gt;AMQ-5155&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10020">
                    <name>Cloners</name>
                                                                <inwardlinks description="is cloned by">
                                        <issuelink>
            <issuekey id="12711964">AMQ-5169</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12709955">AMQ-5155</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12709955">AMQ-5155</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12703415" name="AMQ-4740-EOF.diff" size="2613" author="sebsjo" created="Mon, 9 Mar 2015 12:32:16 +0000"/>
                            <attachment id="12609835" name="AMQ-4740.patch" size="1097" author="kearls" created="Wed, 23 Oct 2013 09:57:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>350314</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 34 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1oehr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>350607</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>