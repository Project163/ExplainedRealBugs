<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:47:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2952] Message groups with small prefetch</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2952</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Closing and starting message groups with a lot of consumers and a small prefetch could result in messages being dispatched to wrong consumers. The problem is that message group logic is done before we detecting weather the consumer is full or not. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12483838">AMQ-2952</key>
            <summary>Message groups with small prefetch</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dejanb">Dejan Bosanac</assignee>
                                    <reporter username="dejanb">Dejan Bosanac</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Sep 2010 14:55:33 +0000</created>
                <updated>Fri, 29 Oct 2010 18:30:46 +0000</updated>
                            <resolved>Thu, 30 Sep 2010 15:10:03 +0000</resolved>
                                    <version>5.4.1</version>
                                    <fixVersion>5.4.2</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12943012" author="dejanb" created="Thu, 30 Sep 2010 15:10:03 +0000"  >&lt;p&gt;Fixed with svn commit 1003096, by doing message group operations only if consumer is not full&lt;/p&gt;</comment>
                            <comment id="12943160" author="rjanney" created="Fri, 29 Oct 2010 18:29:09 +0000"  >&lt;p&gt;We ran into this issue with one of our 5.4.1 AMQ instances in production.  We found that once all consumers are full, the remaining messages are all assigned to a single consumer.  When we reproduced this issue in test &amp;amp; stepped through the Queue class in AMQ, we found that this happens because the group logic is done before the full detection.&lt;/p&gt;

&lt;p&gt;For example, we had 15 consumers with a prefetch size of 1 and a backlog of 1000 messages.  Each consumer had at least 1 message assigned to it &amp;amp; some had a few more than that (possibly finished processing the first message before all consumers were full).  Once all 15 consumers were full, the remaining 980 or so messages were assigned to the same consumer &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  This lead to a significant performance problem where we had all the work waiting on a single thread and the other 14 threads idle doing nothing.&lt;/p&gt;

&lt;p&gt;We were able to work around this problem by setting the pre-fetch to 100 for our 15 consumers.   This allowed the messages to be dispatched in a  round-robin fashion for the first 1500 messages in the queue.&lt;/p&gt;

&lt;p&gt;The fix above to only do group operations on non-full consumers should also resolve the effect we observed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14830</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 4 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ba0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63734</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>