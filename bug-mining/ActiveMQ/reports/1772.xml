<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:58:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1870] JDBC exception when sending and receiving a lot of messages (MySQL 5 in use for persistence)</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1870</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;The number of messages that were on the queue was approx 3 million when this exception happened. Would it be possible to modify the code so that the setMaxRows value is kept to a much lower number?&lt;/p&gt;

&lt;p&gt;java.sql.SQLException: setMaxRows() out of range. 50871918 &amp;gt; 50000000.&lt;br/&gt;
        at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:1055)&lt;br/&gt;
        at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:956)&lt;br/&gt;
        at com.mysql.jdbc.SQLError.createSQLException(SQLError.java:926)&lt;br/&gt;
        at com.mysql.jdbc.StatementImpl.setMaxRows(StatementImpl.java:2412)&lt;br/&gt;
        at org.apache.commons.dbcp.DelegatingStatement.setMaxRows(DelegatingStatement.java:186)&lt;br/&gt;
        at org.apache.activemq.store.jdbc.adapter.DefaultJDBCAdapter.doRecoverNextMessages(DefaultJDBCAdapter.java:703)&lt;br/&gt;
        at org.apache.activemq.store.jdbc.JDBCMessageStore.recoverNextMessages(JDBCMessageStore.java:230)&lt;br/&gt;
        at org.apache.activemq.store.ProxyMessageStore.recoverNextMessages(ProxyMessageStore.java:83)&lt;br/&gt;
        at org.apache.activemq.broker.region.cursors.QueueStorePrefetch.doFillBatch(QueueStorePrefetch.java:75)&lt;br/&gt;
        at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.fillBatch(AbstractStoreCursor.java:188)&lt;br/&gt;
        at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.hasNext(AbstractStoreCursor.java:104)&lt;br/&gt;
        at org.apache.activemq.broker.region.cursors.StoreQueueCursor.hasNext(StoreQueueCursor.java:136)&lt;br/&gt;
        at org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:1092)&lt;br/&gt;
        at org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1178)&lt;br/&gt;
        at org.apache.activemq.broker.region.Queue.iterate(Queue.java:956)&lt;br/&gt;
        at org.apache.activemq.thread.DeterministicTaskRunner.runTask(DeterministicTaskRunner.java:84)&lt;br/&gt;
        at org.apache.activemq.thread.DeterministicTaskRunner$1.run(DeterministicTaskRunner.java:41)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Active MQ 5.1, Windows XP, MySQL 5.0.45, MySQL Connector/J 5.1.5&lt;/p&gt;</environment>
        <key id="12483938">AMQ-1870</key>
            <summary>JDBC exception when sending and receiving a lot of messages (MySQL 5 in use for persistence)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="pj.fanning">PJ Fanning</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Jul 2008 10:35:50 +0000</created>
                <updated>Thu, 13 Jun 2013 15:17:14 +0000</updated>
                            <resolved>Tue, 29 Jan 2013 15:29:11 +0000</resolved>
                                                    <fixVersion>5.8.0</fixVersion>
                                    <component>JMS client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13471206" author="davsclaus" created="Sun, 7 Oct 2012 12:17:45 +0000"  >&lt;p&gt;Yeah there should IMHO be some upper limit to cap, so the max rows wont get as large as yours.&lt;/p&gt;</comment>
                            <comment id="13472242" author="davsclaus" created="Tue, 9 Oct 2012 09:33:30 +0000"  >&lt;p&gt;A patch that caps at max rows.&lt;/p&gt;</comment>
                            <comment id="13472244" author="davsclaus" created="Tue, 9 Oct 2012 09:34:55 +0000"  >&lt;p&gt;Gary do you mind taking a look at this, and the proposed patch.&lt;/p&gt;

&lt;p&gt;As the default max rows is at 200, it may be lowered than maxReturned * 2.&lt;/p&gt;</comment>
                            <comment id="13472309" author="gtully" created="Tue, 9 Oct 2012 12:38:38 +0000"  >&lt;p&gt;I wonder what is causing the request for 50871918. It should be based on the page size for the destination. &lt;br/&gt;
@PJ, can you attach your xml configuration.&lt;/p&gt;

&lt;p&gt;The original intent of maxrows was to force a table scan to see more than page size messages such that priority messages or selector matching would work independent of the prefetch size or requested dispatch size. It was not intended as a limit, rather as a way of extending the scan.&lt;br/&gt;
In this case, it looks like the value being requested is way too large through some error.&lt;/p&gt;

&lt;p&gt;Making maxRows an upper limit means we need to pick a better default value, one that is based on the destination pageSize I think.&lt;br/&gt;
For the priority and sparse selecto use case, explicit values for pageSize are needed in any event.&lt;/p&gt;</comment>
                            <comment id="13472330" author="pj.fanning" created="Tue, 9 Oct 2012 12:58:40 +0000"  >&lt;p&gt;Hi Gary, Claus,&lt;br/&gt;
I raised this issue in 2008 and I don&apos;t really use ActiveMQ much these days.&lt;br/&gt;
I have never modified the ActiveMQ default config, other than to set some environmental settings (eg the MySQL connection details).&lt;br/&gt;
Thanks for looking at the issue though.&lt;br/&gt;
For the prefetch logic, it does seem sensible to limit the rows to the 100s as opposed to 1000s.&lt;br/&gt;
Sorry I can&apos;t be of much assistance.&lt;/p&gt;</comment>
                            <comment id="13565458" author="gtully" created="Tue, 29 Jan 2013 15:29:11 +0000"  >&lt;p&gt;fix in &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1439933&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1439933&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;maxRows is now a max value, limiting the statements result set. the min of maxrows and the current request is used&lt;/p&gt;</comment>
                            <comment id="13679214" author="koppenheim" created="Sun, 9 Jun 2013 22:54:21 +0000"  >&lt;p&gt;Hi Gary,&lt;/p&gt;

&lt;p&gt;It appears that maxRows is still computed using the max of maxrows and the current request rather than the min in one of the DefaultJDBCAdapter#doRecoverNextMessages overloads.  Please see line 1037 in DefaultJDBCAdapter.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Keith &lt;/p&gt;</comment>
                            <comment id="13682333" author="gtully" created="Thu, 13 Jun 2013 15:17:14 +0000"  >&lt;p&gt;@Keith, thanks for the catch - fix in &lt;a href=&quot;http://svn.apache.org/r1492698&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1492698&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12548386" name="AMQ-1870.patch" size="2279" author="davsclaus" created="Tue, 9 Oct 2012 09:33:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95933</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05x0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32445</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>