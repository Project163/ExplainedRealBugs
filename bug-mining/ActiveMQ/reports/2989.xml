<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:39:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6555] Failed to browse topic warnings caused by orphaned expire message tasks in Sceduler</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6555</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When using a FixedCountSubscriptionRecoveryPolicy on a topic I get millions of warnings when the topic is gc&apos;d after inactivity. The impact is that warn logging has to be turned off which is not ideal. Looking in detail it seems this is caused by a couple of things. Firstly the Topic start method can be invoked twice, once when adding the destination to the RegionBroker and second when the regionBroker is started. &lt;/p&gt;

&lt;p&gt;That causes the same expireMessagesTask to get scheduled twice which reveals the crux of the problem. The Scheduler allows the same task to be scheduled again in new TimerTasks, even though it will use the same key and ophan any existing (and running) TimerTasks. This is what&apos;s happening here. When the topic gets stopped, the orphaned tasks continue to run causing these spurious warnings that clog up the logs.&lt;/p&gt;

&lt;p&gt;My suggestion would be for the scheduler to check if the task has already been registered using a putIfAbsent and fail if it already exists:&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/activemq/blob/d9350912984f12356e9d51b0f00b5a28f5cfa58d/activemq-client/src/main/java/org/apache/activemq/thread/Scheduler.java#L42&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/d9350912984f12356e9d51b0f00b5a28f5cfa58d/activemq-client/src/main/java/org/apache/activemq/thread/Scheduler.java#L42&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;These are the warnings we see:&lt;/p&gt;

&lt;p&gt;2017-01-10 11:36:13,885 &lt;span class=&quot;error&quot;&gt;&amp;#91;host&amp;#93;&lt;/span&gt; Scheduler] - WARN  Topic                          - Failed to browse Topic: myTopic&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.activemq.broker.region.policy.FixedCountSubscriptionRecoveryPolicy.browse(FixedCountSubscriptionRecoveryPolicy.java:103)&lt;br/&gt;
	at org.apache.activemq.broker.region.policy.RetainedMessageSubscriptionRecoveryPolicy.browse(RetainedMessageSubscriptionRecoveryPolicy.java:111)&lt;br/&gt;
	at org.apache.activemq.broker.region.Topic.doBrowse(Topic.java:677)&lt;br/&gt;
	at org.apache.activemq.broker.region.Topic.access$1(Topic.java:639)&lt;br/&gt;
	at org.apache.activemq.broker.region.Topic$2.run(Topic.java:791)&lt;br/&gt;
	at org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)&lt;br/&gt;
	at java.util.TimerThread.mainLoop(Timer.java:555)&lt;br/&gt;
	at java.util.TimerThread.run(Timer.java:505&lt;/p&gt;</description>
                <environment></environment>
        <key id="13033359">AMQ-6555</key>
            <summary>Failed to browse topic warnings caused by orphaned expire message tasks in Sceduler</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="kapowie">jack</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Jan 2017 12:08:32 +0000</created>
                <updated>Wed, 11 Jan 2017 11:36:12 +0000</updated>
                            <resolved>Tue, 10 Jan 2017 15:28:03 +0000</resolved>
                                    <version>5.14.1</version>
                                    <fixVersion>5.15.0</fixVersion>
                    <fixVersion>5.14.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15814978" author="christopher.l.shannon" created="Tue, 10 Jan 2017 13:32:10 +0000"  >&lt;p&gt;I think the main fix here is to prevent the start method from being called a second time and a check can also be added to the Scheduler as a precaution as well.  However instead of a put if absent it might be better to cancel the old task and then start/add the new one in case the period has changed.  We can log a warning as well.  I can&apos;t really think of any current use cases where this would/should happen but figure it&apos;s worth putting the check in there as a precaution.&lt;/p&gt;</comment>
                            <comment id="15815276" author="jira-bot" created="Tue, 10 Jan 2017 15:27:15 +0000"  >&lt;p&gt;Commit 2769298cf64a10cd74320ad132b3677bac20a6cc in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2769298&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2769298&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6555&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6555&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing Scheduler so that a rescheduled task will first cancel the&lt;br/&gt;
existing task so it does not get orphaned from the task map.  Also&lt;br/&gt;
fixing Topic start so that it will only start once and not twice.&lt;/p&gt;</comment>
                            <comment id="15815281" author="jira-bot" created="Tue, 10 Jan 2017 15:27:54 +0000"  >&lt;p&gt;Commit e4da98bd790566ba2208246541f71a28b4a00c0f in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e4da98b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e4da98b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6555&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6555&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing Scheduler so that a rescheduled task will first cancel the&lt;br/&gt;
existing task so it does not get orphaned from the task map.  Also&lt;br/&gt;
fixing Topic start so that it will only start once and not twice.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 2769298cf64a10cd74320ad132b3677bac20a6cc)&lt;/p&gt;</comment>
                            <comment id="15818074" author="kapowie" created="Wed, 11 Jan 2017 11:36:12 +0000"  >&lt;p&gt;Thanks Christopher for the swift action to resolve this! It encourages me to report more &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 44 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38hs7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>