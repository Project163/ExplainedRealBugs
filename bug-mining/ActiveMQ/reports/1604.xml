<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:55:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3996] NIO + SSL: Client certificates are null</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3996</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;If using protocol nio+ssl, the ConnectionInfo transportContext property does not contains peer certificates (which are present in the plain tcp ssl transport).&lt;/p&gt;

&lt;p&gt;The problem is that in the NIO transport, calling sslSession.getPeerCertificates() returns null.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12605185">AMQ-3996</key>
            <summary>NIO + SSL: Client certificates are null</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="francesco.romano">Francesco Romano</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Aug 2012 07:52:05 +0000</created>
                <updated>Tue, 23 Oct 2012 15:20:25 +0000</updated>
                            <resolved>Mon, 22 Oct 2012 12:44:01 +0000</resolved>
                                    <version>5.6.0</version>
                    <version>5.7.0</version>
                                    <fixVersion>5.8.0</fixVersion>
                                        <due></due>
                            <votes>3</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13443609" author="tabish121" created="Tue, 28 Aug 2012 22:42:37 +0000"  >&lt;p&gt;Added the missing code to NIOSSLTransport to attempt to set the property on the ConnectionInfo if the certificates are available.&lt;/p&gt;

&lt;p&gt;You can try out the next 5.7-SNAPSHOT and see if this works for you. &lt;/p&gt;</comment>
                            <comment id="13444028" author="francesco.romano" created="Wed, 29 Aug 2012 13:00:03 +0000"  >&lt;p&gt;Sorry... I can&apos;t change right now the version of ActiveMQ.&lt;/p&gt;

&lt;p&gt;Are the changing only in the NIOSSLTransport class? I can compile it from the 5.7 sources and &quot;inject&quot; it (only the class) in my 5.6 jar ? &lt;/p&gt;</comment>
                            <comment id="13444033" author="tabish121" created="Wed, 29 Aug 2012 13:07:01 +0000"  >&lt;p&gt;Yes, changes in NIOSSLTransport, see the source tab for this issue to review the changeset.&lt;/p&gt;</comment>
                            <comment id="13444048" author="ceposta" created="Wed, 29 Aug 2012 13:28:51 +0000"  >&lt;p&gt;Tim, &lt;br/&gt;
I tried that too, doesn&apos;t seem to solve it.&lt;br/&gt;
The JaasCertificateAuthenticationPlugin seems to require the certificate from the connection also, so I&apos;ve written a test for NIO+SSL that uses that auth plugin. It will fail also because of this JIRA. I&apos;ll attach test case&lt;/p&gt;</comment>
                            <comment id="13444050" author="ceposta" created="Wed, 29 Aug 2012 13:30:20 +0000"  >&lt;p&gt;Testcase&lt;/p&gt;</comment>
                            <comment id="13444062" author="francesco.romano" created="Wed, 29 Aug 2012 13:49:04 +0000"  >&lt;p&gt;I tested and it does not work.&lt;br/&gt;
The SSLSession in NIO has almost everything null (also local certificate and peer certificate).&lt;/p&gt;

&lt;p&gt;The &quot;toString&quot; of the eclipse debug shows this:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Session-1, SSL_NULL_WITH_NULL_NULL&amp;#93;&lt;/span&gt;&lt;br/&gt;
In the &quot;standard&quot; ssl it shows&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;Session-1, SSL_RSA_WITH_RC4_128_MD5&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;If you need other information just ask &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13444138" author="ceposta" created="Wed, 29 Aug 2012 15:31:09 +0000"  >&lt;p&gt;Updated my test case... first version didn&apos;t set up client credentials properly&lt;/p&gt;</comment>
                            <comment id="13444148" author="tabish121" created="Wed, 29 Aug 2012 16:01:07 +0000"  >&lt;p&gt;The &apos;SSL_NULL_WITH_NULL_NULL&apos; issue is because the initial call we make to get the sslSession returns an session that&apos;s not initialized since the getSession() method can&apos;t block.  To fix that we need to update our sslSession in the finishHandshake() method.&lt;/p&gt;</comment>
                            <comment id="13444324" author="tabish121" created="Wed, 29 Aug 2012 18:59:26 +0000"  >&lt;p&gt;@Christian the config for the nio+ssl in the attached xml should be transport.needClientAuth=true although that doesn&apos;t actually make things work it at least sets the option to require the client to send its cert.  &lt;/p&gt;</comment>
                            <comment id="13444333" author="ceposta" created="Wed, 29 Aug 2012 19:09:46 +0000"  >&lt;p&gt;@Tim good catch, thank you!&lt;/p&gt;</comment>
                            <comment id="13444335" author="tabish121" created="Wed, 29 Aug 2012 19:14:00 +0000"  >&lt;p&gt;Added the change to update the SSLSession instance post handshake so that the session in use contains accurate data about the cipher suites etc that are in play for that current session. &lt;/p&gt;</comment>
                            <comment id="13447233" author="francesco.romano" created="Mon, 3 Sep 2012 11:48:07 +0000"  >&lt;p&gt;It&apos;s a bit better... Now at least the session is no more empty.&lt;br/&gt;
But still some information are missing.. in particular information about the host (ip and port) and the peer certificates.&lt;/p&gt;

&lt;p&gt;I attach two screenshot of the debug window in eclipse for ssl and nio+ssl&lt;/p&gt;</comment>
                            <comment id="13476870" author="davsclaus" created="Tue, 16 Oct 2012 09:24:28 +0000"  >&lt;p&gt;Francesco, so are you indicating that on the 2 screenshots, the nio+ssl has some details missing that are on the ssl screenshot?&lt;/p&gt;</comment>
                            <comment id="13476874" author="davsclaus" created="Tue, 16 Oct 2012 09:27:09 +0000"  >&lt;p&gt;Tim do you have some time to work on this. It would be great to get fixed for 5.8.0 release.&lt;/p&gt;</comment>
                            <comment id="13476878" author="lionel.cons" created="Tue, 16 Oct 2012 09:44:00 +0000"  >&lt;p&gt;We use X.509 authentication on our SSL connectors.&lt;/p&gt;

&lt;p&gt;Because of this bug, STOMP+NIO+SSL authentication always fails with: java.lang.SecurityException: User name &lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt; or password is invalid.&lt;/p&gt;</comment>
                            <comment id="13477073" author="cghersi" created="Tue, 16 Oct 2012 15:15:35 +0000"  >&lt;p&gt;Hi Claus, I&apos;m a colleague of Francesco Romano , and I &apos;mwriting on behalf of him.&lt;/p&gt;

&lt;p&gt;If you compare the two screenshots, you&apos;ll find that the peerCerts field is null in nio+ssl environment and is valued in ssl one.&lt;/p&gt;
</comment>
                            <comment id="13478233" author="tabish121" created="Wed, 17 Oct 2012 18:50:44 +0000"  >&lt;p&gt;Updated test case, self contained now so we don&apos;t need the broker xml config file.&lt;/p&gt;</comment>
                            <comment id="13478234" author="tabish121" created="Wed, 17 Oct 2012 18:51:48 +0000"  >&lt;p&gt;This one&apos;s got be a bit stumped.&lt;/p&gt;</comment>
                            <comment id="13478404" author="tabish121" created="Wed, 17 Oct 2012 21:24:36 +0000"  >&lt;p&gt;Ok, committed what I believe is the fix for all this now.  In order to test it fully you need to completely setup the Jaas Certificate stuff with the login.config files and such.  For those with the proper config I&apos;d appreciate if you can test out the next SNAPSHOT build and see if this resolves all the problems. &lt;/p&gt;</comment>
                            <comment id="13478701" author="lionel.cons" created="Thu, 18 Oct 2012 05:47:31 +0000"  >&lt;p&gt;Tim, could you please be a bit more specific in what is needed in terms of configuration?&lt;/p&gt;

&lt;p&gt;We use the jaasDualAuthenticationPlugin with two domains configured in login.config (one with SSL, the other one without) and this works fine with stomp+ssl.&lt;/p&gt;

&lt;p&gt;Changing the connector to stomp+nio+ssl breaks the authentication (we get java.lang.SecurityException: User name &lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt; or password is invalid).&lt;/p&gt;

&lt;p&gt;Do we need to add configuration bits that are specific to NIO?&lt;/p&gt;</comment>
                            <comment id="13478951" author="tabish121" created="Thu, 18 Oct 2012 12:35:18 +0000"  >&lt;p&gt;There&apos;s nothing specific to NIO.  The configuration is the same.  See this documentation on the setup for JaasCertificateAuthenticationPlugin&lt;br/&gt;
&lt;a href=&quot;http://fusesource.com/docs/broker/5.3/security/Auth-JAAS-CertAuthentPlugin.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fusesource.com/docs/broker/5.3/security/Auth-JAAS-CertAuthentPlugin.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13478953" author="ceposta" created="Thu, 18 Oct 2012 12:38:33 +0000"  >&lt;p&gt;Tried it out, and it works.&lt;/p&gt;

&lt;p&gt;At first I was getting the same errors that Lionel was getting (it got past that part in JaasCertificateAuthenticationBroker.addConnection() where it was making sure the TransportContext was an instance of X509Certificate which is where it was failing previously, but then it would fail at the call to LoginContext.login() with User name &lt;span class=&quot;error&quot;&gt;&amp;#91;null&amp;#93;&lt;/span&gt; or password invalid error) but then I changed the user.properties a little bit to match what the client was presenting in its cert and my tests passed.&lt;/p&gt;</comment>
                            <comment id="13478998" author="lionel.cons" created="Thu, 18 Oct 2012 13:39:11 +0000"  >&lt;p&gt;Christian, in our case the exact same user.properties file works fine without NIO. It is strange that enabling NIO would change the certificate format... What did you change to have your tests pass?&lt;/p&gt;</comment>
                            <comment id="13479004" author="ceposta" created="Thu, 18 Oct 2012 13:47:30 +0000"  >&lt;p&gt;Lionel,&lt;/p&gt;

&lt;p&gt;I changed the user.properties file referenced by my login.conf to match the client with what was in the cert. &lt;/p&gt;

&lt;p&gt;client=CN=client, OU=activemq, O=apache&lt;br/&gt;
#client=CN=client, OU=activemq, O=apache, L=Unknown, ST=Unknown, C=Unknown&lt;/p&gt;

&lt;p&gt;Now that I think about it, I should have verified the client&apos;s cert to make sure it wasn&apos;t indeed passing the data in the commented out (second) line and that the SSL code only saw the first line.&lt;/p&gt;
</comment>
                            <comment id="13479657" author="lionel.cons" created="Fri, 19 Oct 2012 06:09:04 +0000"  >&lt;p&gt;Christian/Tim, in our setup, we use the jaasDualAuthenticationPlugin. Its code contains:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   isSSL = (transportConnector.getServer() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; SslTransportServer);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This does not seem to be correct with NIO. Could you please check if you can make cert auth work with jaasDualAuthenticationPlugin?&lt;/p&gt;</comment>
                            <comment id="13480109" author="tabish121" created="Fri, 19 Oct 2012 16:23:24 +0000"  >&lt;p&gt;Ok, think that&apos;s all fixed now as well.  Would be good to validate under your own configuration using the next nightly SNAPSHOT to ensure I got it all sorted. &lt;/p&gt;</comment>
                            <comment id="13481340" author="tabish121" created="Mon, 22 Oct 2012 12:44:01 +0000"  >&lt;p&gt;This is now fixed on trunk. &lt;/p&gt;</comment>
                            <comment id="13482304" author="mpaladin" created="Tue, 23 Oct 2012 13:11:45 +0000"  >&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;it still fails for us with jaasDualAuthenticationPlugin and certificate authentication.&lt;br/&gt;
Attached you find the unit test with its configuration files.&lt;/p&gt;</comment>
                            <comment id="13482316" author="tabish121" created="Tue, 23 Oct 2012 13:26:43 +0000"  >&lt;p&gt;Issues with the Jaas Authentication isn&apos;t related to the certificates not being present any longer so I&apos;d recommend you open a new issue for this test so we can track that work there.&lt;/p&gt;</comment>
                            <comment id="13482400" author="mpaladin" created="Tue, 23 Oct 2012 15:20:25 +0000"  >&lt;p&gt;Ok, I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4126&quot; title=&quot;stomp+nio+ssl + jaasDualAuthenticationPlugin + certificate authentication fails&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4126&quot;&gt;&lt;del&gt;AMQ-4126&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12550451" name="AMQ3996.tgz" size="2488" author="mpaladin" created="Tue, 23 Oct 2012 13:11:45 +0000"/>
                            <attachment id="12549551" name="NIOSSLTransportWithJaasCertificateAuthBrokerTest.java" size="6340" author="tabish" created="Wed, 17 Oct 2012 18:50:44 +0000"/>
                            <attachment id="12542931" name="NIOSSLTransportWithJaasCertificateAuthBrokerTest.java" size="2648" author="ceposta" created="Wed, 29 Aug 2012 15:31:09 +0000"/>
                            <attachment id="12542919" name="NIOSSLTransportWithJaasCertificateAuthBrokerTest.java" size="1953" author="ceposta" created="Wed, 29 Aug 2012 13:30:20 +0000"/>
                            <attachment id="12542930" name="broker-jaas-ssl-nio.xml" size="2864" author="ceposta" created="Wed, 29 Aug 2012 15:31:09 +0000"/>
                            <attachment id="12543535" name="nio+ssl.png" size="60706" author="francesco.romano" created="Mon, 3 Sep 2012 11:49:16 +0000"/>
                            <attachment id="12543536" name="ssl.png" size="59287" author="francesco.romano" created="Mon, 3 Sep 2012 11:49:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>248946</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0a2nj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56703</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>