<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:52:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3547] Calling Connection.close() on interrupted thread generates InterruptedIOException and leaks Connection</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3547</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-3529&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-3529&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;call close() method on connection raise JMSException with InterruptedIOException as cause&lt;/p&gt;

&lt;p&gt;Sample program:&lt;/p&gt;

&lt;p&gt;public static void main(String[] args) throws Exception {&lt;br/&gt;
	ConnectionFactory connectionFactory = new ActiveMQConnectionFactory(&quot;tcp://localhost:61616&quot;);&lt;br/&gt;
	Connection connection = connectionFactory.createConnection();&lt;br/&gt;
	Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);&lt;br/&gt;
	final Thread mainThread = Thread.currentThread();&lt;br/&gt;
	new Thread() {&lt;/p&gt;

&lt;p&gt;		public void run() {&lt;br/&gt;
			// this thread interrupt main thread after 1s&lt;br/&gt;
			try &lt;/p&gt;
{
				Thread.sleep(1000);
			}
&lt;p&gt; catch (InterruptedException e) {&lt;br/&gt;
			}&lt;br/&gt;
			mainThread.interrupt();&lt;br/&gt;
		};&lt;br/&gt;
	}.start();&lt;/p&gt;

&lt;p&gt;	try &lt;/p&gt;
{
		//wait for interrupt
		Thread.sleep(10000);
	}
&lt;p&gt; catch (InterruptedException e) &lt;/p&gt;
{
		Thread.currentThread().interrupt();
	}

&lt;p&gt;	try &lt;/p&gt;
{
		// this generate exception - bug???
		connection.close();
	}
&lt;p&gt; catch (JMSException e) &lt;/p&gt;
{
		e.printStackTrace();
	}
&lt;p&gt;	// non-daemon thread responsible for connection still running, program&lt;br/&gt;
	// will not terminate&lt;br/&gt;
}&lt;/p&gt;


&lt;p&gt;when I remove line with Session obtain, everything works OK&lt;/p&gt;</description>
                <environment></environment>
        <key id="12527550">AMQ-3547</key>
            <summary>Calling Connection.close() on interrupted thread generates InterruptedIOException and leaks Connection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="martin.beranek">Martin Ber&#225;nek</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Oct 2011 08:13:59 +0000</created>
                <updated>Fri, 27 Nov 2015 14:13:31 +0000</updated>
                            <resolved>Sat, 29 Oct 2011 21:44:53 +0000</resolved>
                                    <version>5.5.0</version>
                                    <fixVersion>5.6.0</fixVersion>
                    <fixVersion>5.13.0</fixVersion>
                                    <component>JMS client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13129785" author="tabish121" created="Tue, 18 Oct 2011 15:08:57 +0000"  >&lt;p&gt;Attached a unit test based on your sample code.  No exceptions or errors are seen when run against trunk.&lt;/p&gt;</comment>
                            <comment id="13133149" author="tabish121" created="Fri, 21 Oct 2011 22:35:02 +0000"  >&lt;p&gt;Could not reproduce this with supplied code, if you can make the attached JUnit test case reproduce this behavior please reopen and attach the new test.&lt;/p&gt;</comment>
                            <comment id="13136859" author="martin.beranek" created="Thu, 27 Oct 2011 07:15:09 +0000"  >&lt;p&gt;new junit test that correctly simulate problem&lt;/p&gt;</comment>
                            <comment id="13136860" author="martin.beranek" created="Thu, 27 Oct 2011 07:16:24 +0000"  >&lt;p&gt;corrected test&lt;/p&gt;</comment>
                            <comment id="13137147" author="gtully" created="Thu, 27 Oct 2011 13:49:56 +0000"  >&lt;p&gt;@Martin, you need to tick the license grant option on that latest test attachment.&lt;/p&gt;</comment>
                            <comment id="13137520" author="tabish121" created="Thu, 27 Oct 2011 20:43:02 +0000"  >&lt;p&gt;The fix looks to be fairly trivial, if you can update your test attachment with the license grant we should be able to get this in a 5.6 release.&lt;/p&gt;</comment>
                            <comment id="13139152" author="martin.beranek" created="Sat, 29 Oct 2011 08:28:20 +0000"  >&lt;p&gt;I have to reupload junit test bacause of license.&lt;/p&gt;</comment>
                            <comment id="13139457" author="tabish121" created="Sat, 29 Oct 2011 21:44:53 +0000"  >&lt;p&gt;Fix applied in trunk, thanks for getting the test going.&lt;/p&gt;</comment>
                            <comment id="15029856" author="gtully" created="Fri, 27 Nov 2015 13:00:45 +0000"  >&lt;p&gt;As part of the reqworked fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2191&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-2191&lt;/a&gt; - the need to wrap close operaitons with suspended interrupts goes away. There is a more general form of your test that verifies all is still good.&lt;br/&gt;
Essentially, the suspend/resume interrupt is moved into FutureResponse where the InterruptedException is handled as a failure &apos;only&apos; during a request. Requests and oneways can be safely invoked while interrupted and the interrupted state is retained.&lt;/p&gt;

&lt;p&gt;It would be great if you could cast your eyes over the reworked fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2191&quot; title=&quot;Incorrect handling of interruptions during commit or rollback of a transaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-2191&quot;&gt;&lt;del&gt;AMQ-2191&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="15029908" author="tabish121" created="Fri, 27 Nov 2015 14:13:31 +0000"  >&lt;p&gt;Looks good, ship it!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12526328">AMQ-3529</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12483097">AMQ-2191</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12501437" name="AMQ3529Test.java" size="2967" author="martin.beranek" created="Sat, 29 Oct 2011 08:28:20 +0000"/>
                            <attachment id="12499548" name="AMQ3529Test.java" size="2702" author="tabish" created="Tue, 18 Oct 2011 15:08:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>88768</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 51 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0aipb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59303</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>