<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:13:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5895] FilteredDestinations do not work when loaded by runtimeConfigurationPlugin</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5895</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When adding a FilteredDestination to VirtualDestinations in activemq.xml, the runtimeConfigurationPlugin will not update the configuration correct for the filteredDestination. The log does not give any errors until we send a message towards the CompositeTopic/Queue that contains the FilteredDestination, then the message is not forwarded and the following error is written in the log:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.IllegalArgumentException: Unknown mapped destination type java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;@7a141450
        at org.apache.activemq.broker.region.virtual.CompositeDestination.getMappedDestinations(CompositeDestination.java:124)[activemq-broker-5.11.1.jar:5.11.1] &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It works if we restart activeMQ, because then the configuration is not loaded by the runtimeConfigurationPlugin, however we really want to avoid that.&lt;/p&gt;

&lt;p&gt;Solution: It seems that the translation from JAXB objects to ActiveMQ objects is not translating DtoFilteredDestination to FilteredDestinations in org.apache.activemq.plugin.JAXBUtils.&lt;/p&gt;

&lt;p&gt;When I added the following code to the method &quot;inferTargetObject&quot;, then the problem was solved:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (DtoFilteredDestination.&lt;span class=&quot;code-keyword&quot;&gt;class.&lt;/span&gt;isAssignableFrom(elementContent.getClass())) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FilteredDestination();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Why this matters: In my organisation we really like to use ActiveMQ VirtualDestinations with FilteredDestinations, because it is a much more minimalistic than having to make many simple subscriptions in Camel and it has many benefits compared to durable subscribers. However, we do not wish to restart ActiveMQ every time we modify the VirtualDestinations, hence we need to be able to updated the VirtualDestinations using runtimeConfigurationPlugin and this does not work right now due to this bug.&lt;/p&gt;

&lt;p&gt;I have added some files to this issue: a patch file, a full stacktrace and some steps to reproduce the problem.&lt;/p&gt;

&lt;p&gt;Perhaps I can also commit the bug fix myself if that can speed up the process.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Both windows / linux, IBM java 6 / Oracle Java 7&lt;/p&gt;</environment>
        <key id="12845910">AMQ-5895</key>
            <summary>FilteredDestinations do not work when loaded by runtimeConfigurationPlugin</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="AndersAaberg">Anders Aaberg</reporter>
                        <labels>
                            <label>runtime-configuration</label>
                            <label>virtualDestinations</label>
                    </labels>
                <created>Fri, 17 Jul 2015 15:34:54 +0000</created>
                <updated>Wed, 29 Jul 2015 11:50:58 +0000</updated>
                            <resolved>Wed, 29 Jul 2015 11:50:58 +0000</resolved>
                                    <version>5.11.1</version>
                                    <fixVersion>5.12.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14632027" author="gtully" created="Fri, 17 Jul 2015 22:25:10 +0000"  >&lt;p&gt;thanks for the patch. if you add a junit test case it will be golden! &lt;/p&gt;</comment>
                            <comment id="14632943" author="andersaaberg" created="Sun, 19 Jul 2015 22:26:06 +0000"  >&lt;p&gt;The fix is in JAXBUtils.java - the rest is unittest.&lt;/p&gt;</comment>
                            <comment id="14632948" author="andersaaberg" created="Sun, 19 Jul 2015 22:34:11 +0000"  >&lt;p&gt;Thanks for the quick reply and sorry about the missing test. I have extended VirtualDestTest (added a unittest that tests basic composite queue filtering and update using runtimeConfigurationPlugin) such that the test will fail if the fix is not implemented in the JABXUtils class. I have updated the activemq.patch file to also include the unittest.&lt;/p&gt;</comment>
                            <comment id="14645914" author="jira-bot" created="Wed, 29 Jul 2015 11:49:56 +0000"  >&lt;p&gt;Commit 4a603a9936b1880eba501d7f0e6fff812ae29d2f in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4a603a9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4a603a9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5895&quot; title=&quot;FilteredDestinations do not work when loaded by runtimeConfigurationPlugin&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5895&quot;&gt;&lt;del&gt;AMQ-5895&lt;/del&gt;&lt;/a&gt; - apply patch with thanks to Anders Aaberg&lt;/p&gt;</comment>
                            <comment id="14645916" author="gtully" created="Wed, 29 Jul 2015 11:50:58 +0000"  >&lt;p&gt;Patch (with lovely test) applied with thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12746032" name="activemq.patch" size="12540" author="AndersAaberg" created="Sun, 19 Jul 2015 22:26:06 +0000"/>
                            <attachment id="12745829" name="stacktrace.txt" size="3474" author="AndersAaberg" created="Fri, 17 Jul 2015 15:37:16 +0000"/>
                            <attachment id="12745831" name="steps_to_reproduce.txt" size="1022" author="AndersAaberg" created="Fri, 17 Jul 2015 15:47:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 16 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2he2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>