<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:40:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6599] MQTT+NIO+SSL transport: transport.soTimeout is not applied during SSL handshake</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6599</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Currently I have trouble with many established TCP connections and threads hanging in the NIO+SSL handshake step. The hardware devices I use often have problems during SSL handshake and do not respond any more. So I thought configuring a transport.soTimeout value should solve the problem of hanging connections, because something like the MQTT  transport.defaultKeepAlive check is not applicable in this step yet. But setting transport.soTimeout=30000 had no effect.&lt;br/&gt;
I made a remote debug session to the ActiveMQ broker and saw lots of threads waiting at NIOSSLTransport.java Line 430:&lt;/p&gt;

&lt;p&gt;    int keyCount = selector.select(this.getSoTimeout());&lt;br/&gt;
    if (keyCount == 0 &amp;amp;&amp;amp; this.getSoTimeout() &amp;gt; 0 &amp;amp;&amp;amp; ((System.currentTimeMillis() - now) &amp;gt;= this.getSoTimeout())) &lt;/p&gt;
{
        throw new SocketTimeoutException(&quot;Timeout during handshake&quot;);
    }

&lt;p&gt;At this point this.getSoTimeout returns always 0, which results in infinite timeout.&lt;br/&gt;
I tried to figure out why the soTimeout setting works not as configured and found the code where the NIOSSLTransport object is created: TcpTransportServer.java function doHandleSocket(Socket socket). Here in line 580:&lt;/p&gt;

&lt;p&gt;    options.putAll(transportOptions);&lt;/p&gt;

&lt;p&gt;The soTimeout value is already removed from the transportOptions but it was apperantly not applied to the relevant object.&lt;/p&gt;

&lt;p&gt;To solve my problem for now I tried if the transport.soTimeout configuration works in a MQTT+SSL Stack (without using NIO) and it worked.&lt;/p&gt;

&lt;p&gt;May you please be so kind and solve this issue, so that the transport.soTimeout configurations works during SSL handshake and payload transfer as well for NIO.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 16.04&lt;br/&gt;
openjdk version &quot;1.8.0_121&quot;&lt;br/&gt;
OpenJDK Runtime Environment (build 1.8.0_121-8u121-b13-0ubuntu1.16.04.2-b13)&lt;br/&gt;
OpenJDK 64-Bit Server VM (build 25.121-b13, mixed mode)&lt;/p&gt;</environment>
        <key id="13042895">AMQ-6599</key>
            <summary>MQTT+NIO+SSL transport: transport.soTimeout is not applied during SSL handshake</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="thomas.winterhalder">Thomas Winterhalder</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Feb 2017 10:26:32 +0000</created>
                <updated>Fri, 17 Feb 2017 23:23:10 +0000</updated>
                            <resolved>Fri, 17 Feb 2017 13:07:37 +0000</resolved>
                                    <version>5.14.3</version>
                                    <fixVersion>5.15.0</fixVersion>
                    <fixVersion>5.14.4</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15871820" author="jira-bot" created="Fri, 17 Feb 2017 13:04:48 +0000"  >&lt;p&gt;Commit f6bf823dedba54dea40b597f1762ac6d7308ffa6 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=f6bf823&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=f6bf823&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6599&quot; title=&quot;MQTT+NIO+SSL transport: transport.soTimeout is not applied during SSL handshake&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6599&quot;&gt;&lt;del&gt;AMQ-6599&lt;/del&gt;&lt;/a&gt; - Properly apply soTimeout value to TcpTransport&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6599&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6599&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The soTimeout value needs to be applied to the TcpTransport as well as&lt;br/&gt;
the socket because the NIO transports use the value later on when&lt;br/&gt;
establishing a connection&lt;/p&gt;</comment>
                            <comment id="15871821" author="jira-bot" created="Fri, 17 Feb 2017 13:04:52 +0000"  >&lt;p&gt;Commit f6bf823dedba54dea40b597f1762ac6d7308ffa6 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=f6bf823&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=f6bf823&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6599&quot; title=&quot;MQTT+NIO+SSL transport: transport.soTimeout is not applied during SSL handshake&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6599&quot;&gt;&lt;del&gt;AMQ-6599&lt;/del&gt;&lt;/a&gt; - Properly apply soTimeout value to TcpTransport&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6599&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6599&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The soTimeout value needs to be applied to the TcpTransport as well as&lt;br/&gt;
the socket because the NIO transports use the value later on when&lt;br/&gt;
establishing a connection&lt;/p&gt;</comment>
                            <comment id="15871823" author="jira-bot" created="Fri, 17 Feb 2017 13:05:42 +0000"  >&lt;p&gt;Commit 7c84aca59f89523c20daeced2b5f849d0fac0740 in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=7c84aca&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=7c84aca&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6599&quot; title=&quot;MQTT+NIO+SSL transport: transport.soTimeout is not applied during SSL handshake&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6599&quot;&gt;&lt;del&gt;AMQ-6599&lt;/del&gt;&lt;/a&gt; - Properly apply soTimeout value to TcpTransport&lt;/p&gt;

&lt;p&gt;The soTimeout value needs to be applied to the TcpTransport as well as&lt;br/&gt;
the socket because the NIO transports use the value later on when&lt;br/&gt;
establishing a connection&lt;/p&gt;

&lt;p&gt;(cherry picked from commit f6bf823dedba54dea40b597f1762ac6d7308ffa6)&lt;/p&gt;</comment>
                            <comment id="15871825" author="christopher.l.shannon" created="Fri, 17 Feb 2017 13:07:25 +0000"  >&lt;p&gt;The issue was the soTimeout value was being remove from the options map after being applied to the Socket so it was not applied on the TcpTransport itself.  For normal transports this is not a problem but for the NIO transports this causes the soTimeout value to always be 0 later on when it is used on selector.select(soTimeout) as you found.  I&apos;m planning on working on the 5.14.4 release next week so the fix should be out soon.&lt;/p&gt;</comment>
                            <comment id="15872724" author="thomas.winterhalder" created="Fri, 17 Feb 2017 23:23:10 +0000"  >&lt;p&gt;Thanks for fixing this issue so fast!&lt;br/&gt;
&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3a1un:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>