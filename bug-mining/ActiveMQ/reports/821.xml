<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:44:29 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2571] Sender sometimes, involuntary, autocreates new, consumerless, TempQueue when trying to send to removed TempQueue.</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2571</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Please see this post for discussion:&lt;br/&gt;
&lt;a href=&quot;http://old.nabble.com/Problems-with-prefetch-and-TemporaryQueues-td27130529.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://old.nabble.com/Problems-with-prefetch-and-TemporaryQueues-td27130529.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve tested this on 4.1.1, and briefly on 5.3.0 with the same result.&lt;/p&gt;

&lt;p&gt;Scenario:&lt;br/&gt;
We have a server and a client. The client posts a message on the servers queue in order to subscribe to updates.&lt;br/&gt;
The server takes the reply address from the client and starts sending messages to a TempQueue created by the client.&lt;/p&gt;

&lt;p&gt;When the client disconnects without notifying the server the following might happen:&lt;br/&gt;
1. The temporary queue is removed correctly when the client exits and closes its connection.&lt;/p&gt;

&lt;p&gt;From here we have three scenarios:&lt;br/&gt;
2.a The server gets an exception the next time it tries to send a message to the TempQueue. This is wanted behaviour. It can then simply drop the &quot;subscription&quot;.&lt;/p&gt;

&lt;p&gt;2.b The server isn&apos;t notified in time and sends some messages before it gets the exception. Due to AutoCreateDestination being enabled one of these messages creates a new TempQueue with the same name as the one removed. It is of course missing a consumer.&lt;br/&gt;
But since the server gets the exception it will stop posting to the TempQueue. However, when the server closes its connection the TempQueue is not removed and is left lying around with no consumer.&lt;/p&gt;

&lt;p&gt;2.c The server recreates the TempQueue in the same way as in 2.b, but here it never gets the exception for some reason. The server then has no idea that the client left and keeps pilling up messages on the TempQueue until the broker object hits its memory limit and everything connected to the broker halts.&lt;/p&gt;


&lt;p&gt;I think there are three problems here:&lt;br/&gt;
1. The exception is not thrown every time.&lt;br/&gt;
2. When the TempQueue is recreated it is not removed when the server closes its connection. Also, the server gets an InvalidDestinationException if I, at server side, try to connect a consumer to the TempQueue. I guess this means that although the server is the initiator for the auto(re)creation it does not become the owner of the TempQueue. But who is then the owner? The broker itself?&lt;/p&gt;

&lt;p&gt;3. Due to AutoCreateDestination being enabled by default for TempQueues, every post to a TempQueue could result in unknowingly creating a new TempQueue.&lt;/p&gt;


&lt;p&gt;Suggestions&lt;br/&gt;
Setting AutoCreateDestination to false for TempQueues solves all three problems.&lt;br/&gt;
So exposing that option in an easily accessible way is important.&lt;/p&gt;

&lt;p&gt;But even then, 1 and 2 should perhaps be examined separately.&lt;/p&gt;

&lt;p&gt;I&apos;ll attach a JUnit test case for this. Unfortunately it is not 100% reliable in detecting the problem. One has to run it multiple times.&lt;br/&gt;
On my test setup it failed correctly 8 times out of 10 runs. You might be able to improve it.&lt;/p&gt;

&lt;p&gt;Best Regards&lt;br/&gt;
Nimos&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 9.10, P4 2.6 GHz HT, 3 GB RAM. &lt;/p&gt;</environment>
        <key id="12483233">AMQ-2571</key>
            <summary>Sender sometimes, involuntary, autocreates new, consumerless, TempQueue when trying to send to removed TempQueue.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="nimos">Simon</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Jan 2010 21:45:55 +0000</created>
                <updated>Wed, 3 Feb 2010 08:04:35 +0000</updated>
                            <resolved>Wed, 3 Feb 2010 08:04:35 +0000</resolved>
                                    <version>4.1.1</version>
                                    <fixVersion>5.4.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12942019" author="nimos" created="Fri, 15 Jan 2010 21:49:55 +0000"  >&lt;p&gt;My attempt at writing a JUnit test for this.&lt;br/&gt;
I used JUnit 3 as it seemed to be the version used for the ActiveMQ in the source package.&lt;/p&gt;

&lt;p&gt;Unfortunately since this seems to be a timing issue it might not be able to provoke the problem every time.&lt;br/&gt;
So it should be run multiple times to increase the chance of detecting the problem.&lt;/p&gt;

&lt;p&gt;A warning might be in place, when it does succeed in provoking the error it will leave empty TempQueues lying around in the broker.&lt;/p&gt;

&lt;p&gt;Regards&lt;br/&gt;
Nimos&lt;/p&gt;</comment>
                            <comment id="12942056" author="rajdavies" created="Thu, 21 Jan 2010 19:21:12 +0000"  >&lt;p&gt;I know this issue was raised on 4.x - but also found on 5.3.0 - but I have not been able to reproduce after many tries on trunk. &lt;br/&gt;
Added a test case - org.apache.activemq.bugs.AMQ2571 by SVN revision 901832&lt;/p&gt;</comment>
                            <comment id="12942060" author="nimos" created="Fri, 22 Jan 2010 10:21:22 +0000"  >&lt;p&gt;I am still able to reproduce the problem on the 5.4 snapshot downloaded today from the ActiveMQ page:&lt;br/&gt;
&lt;a href=&quot;http://activemq.apache.org/download.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/download.html&lt;/a&gt;&lt;br/&gt;
I ran the JUnit test case 10 times which resulted in 5 failures =&amp;gt; 5 consumerless TempQueues lying around indefinetly (or actually until broker restart) in the broker. It might be that I have a slow computer, but the problem is there.&lt;/p&gt;

&lt;p&gt;So I can&apos;t consider this fixed in the 5.4 version available at ActiveMQ homepage.&lt;/p&gt;

&lt;p&gt;Best Regards&lt;br/&gt;
Simon&lt;/p&gt;</comment>
                            <comment id="12942066" author="nimos" created="Fri, 22 Jan 2010 10:22:55 +0000"  >&lt;p&gt;Fixed misspelling (Settings -&amp;gt; Setting).&lt;/p&gt;</comment>
                            <comment id="12942072" author="rajdavies" created="Tue, 26 Jan 2010 23:21:36 +0000"  >&lt;p&gt;luckily I have a slow laptop so have been able to validate it there&lt;/p&gt;</comment>
                            <comment id="12942143" author="rajdavies" created="Wed, 3 Feb 2010 08:04:35 +0000"  >&lt;p&gt;Fixed by SVN revision 905926&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461597" name="TempQueueClosing.java" size="2690" author="nimos" created="Fri, 15 Jan 2010 21:49:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14630</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 42 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b9lz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63669</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>