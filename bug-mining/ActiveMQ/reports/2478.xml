<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:08:37 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5598] MQTT+NIO+SSL: Concurrent connections lead to 100% CPU usage</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5598</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Connecting with multiple instances of  mqtt clients via ssl at the same time causes the borker server to run on 100% CPU usage forever. Only restart of ActiveMQ helps. Thread count maximizes during connection attempt.&lt;/p&gt;

&lt;p&gt;Critical: It doesn&apos;t matter if the certificate is valid or not, I am able to shut down the broker from one client with 500 concurrent connecting instances. The payload size is not important. The problem is somewhere at the ssl handshake located. Without ssl everything works fine. Single ssl connections work.&lt;/p&gt;

&lt;p&gt;Similar issues (with older versions) described are here:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;&lt;a href=&quot;http://activemq.2283324.n4.nabble.com/SSL-handshake-stalls-broker-with-NIO-td4677916.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.2283324.n4.nabble.com/SSL-handshake-stalls-broker-with-NIO-td4677916.html&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://stackoverflow.com/questions/19395769/activemq-mqtt-maxes-cpu-on-first-client-connect&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/19395769/activemq-mqtt-maxes-cpu-on-first-client-connect&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


</description>
                <environment>&lt;p&gt;Red Hat Enterprise Linux Server release 6.6 (Santiago), Open JDK 64bit 1.7.0.75, 3Gig RAM, 30Gig HDD - 1x ActiveMQ 5.10&lt;/p&gt;

&lt;p&gt;Windows 7 x64, Java 64bit 1.7.0, 8Gig RAM, 1x ActiveMQ 5.10, 1x ActiveMQ 5.11&lt;/p&gt;</environment>
        <key id="12776131">AMQ-5598</key>
            <summary>MQTT+NIO+SSL: Concurrent connections lead to 100% CPU usage</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="JA">Josef Awad</reporter>
                        <labels>
                            <label>performance</label>
                            <label>security</label>
                    </labels>
                <created>Thu, 19 Feb 2015 11:38:45 +0000</created>
                <updated>Wed, 22 Apr 2015 05:33:17 +0000</updated>
                            <resolved>Thu, 2 Apr 2015 22:56:41 +0000</resolved>
                                    <version>5.10.0</version>
                    <version>5.11.0</version>
                                                    <component>MQTT</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14333370" author="tabish121" created="Mon, 23 Feb 2015 15:00:00 +0000"  >&lt;p&gt;Recommend you create a unit test to demonstrate the problem.&lt;/p&gt;</comment>
                            <comment id="14350921" author="tabish121" created="Fri, 6 Mar 2015 21:29:03 +0000"  >&lt;p&gt;I attempted to recreate this but could not.  Added a parallel connection test on master everything seems to work as expected.&lt;/p&gt;</comment>
                            <comment id="14351423" author="artnaseef" created="Sat, 7 Mar 2015 05:29:20 +0000"  >&lt;p&gt;Hey Timothy - does the MQTT code in question go through the following code by any chance?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;org.apache.qpid.amqp_1_0.framing.ConnectionHandler$BytesOutputHandler.run(ConnectionHandler.java:403)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I haven&apos;t had time to follow-up, but I found from past excessively slow tests that this QPID code appears to be using busy waits, and somehow gets into a state in which it never gets what it wants.  I&apos;ll attach a screen shot showing the same using almost 100% of all 8 cores of my system for a long time.&lt;/p&gt;

&lt;p&gt;If it&apos;s the same code, let me know and I&apos;ll paste full stack dumps taken during the time of the problem.&lt;/p&gt;</comment>
                            <comment id="14351424" author="artnaseef" created="Sat, 7 Mar 2015 05:30:40 +0000"  >&lt;p&gt;screen shot showing the excessive CPU usage during tests that trace back into qpid code.&lt;/p&gt;</comment>
                            <comment id="14351565" author="tabish121" created="Sat, 7 Mar 2015 13:24:40 +0000"  >&lt;p&gt;No, the MQTT code does not move through the AMQP code.  There are issues with the legacy AMQP 1.0 JMS client that we use for testing, some of which are fixed in the upcoming 0.32 release but in general that client is not heavily maintained or tested.  The is a new one in the works that myself and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gemmellr&quot; class=&quot;user-hover&quot; rel=&quot;gemmellr&quot;&gt;gemmellr&lt;/a&gt; are working on which will be compliant with the JMS over AMQP mapping spec we are also working on.  Once there is an initial release of that we will probably switch ActiveMQ to using that in its tests to resolve those problems. &lt;/p&gt;</comment>
                            <comment id="14393663" author="tabish121" created="Thu, 2 Apr 2015 22:56:41 +0000"  >&lt;p&gt;Have not been able to reproduce this at all.  If a means of reproducing it becomes available please reopen. &lt;/p&gt;</comment>
                            <comment id="14506456" author="artnaseef" created="Wed, 22 Apr 2015 05:33:17 +0000"  >&lt;p&gt;I see - thank you for the clarification.  MQTT and AMQP are still vague in my mind and hence I lump them together - I need to find time to learn them.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12703221" name="Screen Shot 2015-02-12 at 8.31.58 PM.png" size="227158" author="artnaseef" created="Sat, 7 Mar 2015 05:30:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25szb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>