<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 07:00:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-9747] Kahadb checkpoint runner thread dies without catching exception</title>
                <link>https://issues.apache.org/jira/browse/AMQ-9747</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;This bug affects all version of activemq, I have added a few ones starting 5.18.4.&#160; This is a really critical bug, which causes checkpoint runner thread to SILENTLY GET KILLED (exception eaten away), causing kahadb journal files to KEEP GROWING, till you restart activemq.&#160; There is a bug in handling of io exception... see screen shot below.&#160; In the catch block its calls brokerService.handleIOException().&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13077672/13077672_image-2025-07-21-11-14-20-510.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; iif you take a look at the default io exception handler which is used, it will throw this SuppressReplyException at &lt;a href=&quot;https://github.com/apache/activemq/blob/main/activemq-broker/src/main/java/org/apache/activemq/util/DefaultIOExceptionHandler.java#L165&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/main/activemq-broker/src/main/java/org/apache/activemq/util/DefaultIOExceptionHandler.java#L165&lt;/a&gt;&#160; and if stopStartConnectors is true (which is if you use LeaseLockerIOExceptionHandler) then also it throws this SuppressReplyException at &#160;&lt;a href=&quot;https://github.com/apache/activemq/blob/main/activemq-broker/src/main/java/org/apache/activemq/util/DefaultIOExceptionHandler.java#L155&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/main/activemq-broker/src/main/java/org/apache/activemq/util/DefaultIOExceptionHandler.java#L155&lt;/a&gt; and because of this, the CheckPoint runner thread as shown in above screen shot would silently die, even though broker is still running...&#160; &#160;&lt;/p&gt;

&lt;p&gt;it seems the checkpoint runner should not be dying.... we had a situation where we were using EFS as our storage for kahadb... and due to a blip in connection EFS, an io exception in page.flush in MessageDatabase was thrown (we were using LeaseLockerIOExceptionHandler)... that caused DefaultIOExceptionHandler logic to start and stop connectors and return SuppressReplyException as i mentioned above, causing CheckPoint runner to silient get killed... while broker was still running....&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;we had this in production and the fix we did is to extend LeaseLockerIOExceptionHandler and catch exception throw from handle(IOException ex) method and log it as warn and not propogate it up to checkpoint runner thread... but this is temporary fix.. i am not even sure if CheckpointRunner needs to use DefaultIOExceptionHandler.... it shouldn&apos;t die silently...&lt;/p&gt;</description>
                <environment></environment>
        <key id="13624164">AMQ-9747</key>
            <summary>Kahadb checkpoint runner thread dies without catching exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="ritesh.adval">ritesh adval</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Jul 2025 18:32:09 +0000</created>
                <updated>Wed, 23 Jul 2025 21:13:57 +0000</updated>
                            <resolved>Wed, 23 Jul 2025 21:13:57 +0000</resolved>
                                    <version>6.1.4</version>
                    <version>6.1.6</version>
                    <version>5.18.7</version>
                    <version>6.1.7</version>
                                    <fixVersion>6.2.0</fixVersion>
                    <fixVersion>5.19.1</fixVersion>
                    <fixVersion>6.1.8</fixVersion>
                                    <component>KahaDB</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="18009107" author="christopher.l.shannon" created="Tue, 22 Jul 2025 22:47:31 +0000"  >&lt;p&gt;Thanks for the detailed bug report. I agree that if the broker continues to run, the checkpoint runner should not stop. Most likely this issue hasn&apos;t come up before because most users just use standard KahaDB and are not using LeaseLockerIOExceptionHandler so the startStopConnectors flag is false. That means if there is an IOException that is thrown by the runner, the entire broker will just shut down.&lt;/p&gt;

&lt;p&gt;I think the fix is probably to do some variation of what you already did. I still think the DefaultIOExceptionHandler should be used because it will shut the broker down on IOException under the standard use case (and it implements the IOExceptionHandler so it&apos;s easy for a user to replace the behavior). But instead of letting unchecked exceptions propagate and kill the thread, we should catch and log a warning or error so that the user can be alerted but let the cleanup thread keep running.&lt;/p&gt;</comment>
                            <comment id="18009316" author="JIRAUSER305516" created="Wed, 23 Jul 2025 16:20:21 +0000"  >&lt;p&gt;Thx &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;, fix looks good in pr.&lt;/p&gt;</comment>
                            <comment id="18009318" author="christopher.l.shannon" created="Wed, 23 Jul 2025 16:25:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ritesh.adval&quot; class=&quot;user-hover&quot; rel=&quot;ritesh.adval&quot;&gt;ritesh.adval&lt;/a&gt; - cool thanks for taking a look, i&apos;ll merge it as soon as the tests finish and will backport it&lt;/p&gt;</comment>
                            <comment id="18009392" author="jira-bot" created="Wed, 23 Jul 2025 21:10:37 +0000"  >&lt;p&gt;Commit 2eb0d6675008a5e7fd6cbec4a177ab13fde3b8f2 in activemq&apos;s branch refs/heads/main from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=2eb0d66750&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=2eb0d66750&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9747&quot; title=&quot;Kahadb checkpoint runner thread dies without catching exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9747&quot;&gt;&lt;del&gt;AMQ-9747&lt;/del&gt;&lt;/a&gt; - Handle IOExceptionHandler thrown exceptions in KahaDB (#1474)&lt;/p&gt;

&lt;p&gt;Update the KahaDB scheduled tasks to catch any runtime exceptions thrown&lt;br/&gt;
by the configured IOExceptionHandler. This will prevent the tasks from&lt;br/&gt;
being killed and no longer running if the IOExceptionHandler does&lt;br/&gt;
not shut down the broker.&lt;/p&gt;</comment>
                            <comment id="18009393" author="jira-bot" created="Wed, 23 Jul 2025 21:12:13 +0000"  >&lt;p&gt;Commit ffb34de55f342514db372546137a5edc711e7ebd in activemq&apos;s branch refs/heads/activemq-6.1.x from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=ffb34de55f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=ffb34de55f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9747&quot; title=&quot;Kahadb checkpoint runner thread dies without catching exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9747&quot;&gt;&lt;del&gt;AMQ-9747&lt;/del&gt;&lt;/a&gt; - Handle IOExceptionHandler thrown exceptions in KahaDB (#1474)&lt;/p&gt;

&lt;p&gt;Update the KahaDB scheduled tasks to catch any runtime exceptions thrown&lt;br/&gt;
by the configured IOExceptionHandler. This will prevent the tasks from&lt;br/&gt;
being killed and no longer running if the IOExceptionHandler does&lt;br/&gt;
not shut down the broker.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 2eb0d6675008a5e7fd6cbec4a177ab13fde3b8f2)&lt;/p&gt;</comment>
                            <comment id="18009394" author="jira-bot" created="Wed, 23 Jul 2025 21:13:12 +0000"  >&lt;p&gt;Commit 3d2e2a94d311e5ceebd1a0af98ef44c498513e0c in activemq&apos;s branch refs/heads/activemq-5.19.x from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=3d2e2a94d3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=3d2e2a94d3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9747&quot; title=&quot;Kahadb checkpoint runner thread dies without catching exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9747&quot;&gt;&lt;del&gt;AMQ-9747&lt;/del&gt;&lt;/a&gt; - Handle IOExceptionHandler thrown exceptions in KahaDB (#1474)&lt;/p&gt;

&lt;p&gt;Update the KahaDB scheduled tasks to catch any runtime exceptions thrown&lt;br/&gt;
by the configured IOExceptionHandler. This will prevent the tasks from&lt;br/&gt;
being killed and no longer running if the IOExceptionHandler does&lt;br/&gt;
not shut down the broker.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 2eb0d6675008a5e7fd6cbec4a177ab13fde3b8f2)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13077672" name="image-2025-07-21-11-14-20-510.png" size="45396" author="ritesh.adval" created="Mon, 21 Jul 2025 18:14:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1wvls:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>