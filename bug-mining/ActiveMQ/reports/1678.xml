<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:56:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4106] STOMP+NIO and Heartbeats gives consistent InactivityIOException</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4106</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When a stomp 1.1 client:&lt;/p&gt;

&lt;p&gt;a) connects to a stomp+nio transport&lt;br/&gt;
b) elects to send heartbeats when the network is idle&lt;/p&gt;

&lt;p&gt;the first several heartbeat sends appear to succeed, but then the connection is forcibly closed by the broker.&lt;/p&gt;

&lt;p&gt;From activemq.log:&lt;/p&gt;

&lt;p&gt;2012-10-14 09:53:07,755 | WARN  | Transport Connection to: tcp://127.0.0.1:36440 failed: org.apache.activemq.transport.InactivityIOException: Channel was inactive for too (&amp;gt;10000) long: tcp://127.0.0.1:36440 | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ InactivityMonitor Worker&lt;/p&gt;

&lt;p&gt;From wrapper.log:&lt;/p&gt;

&lt;p&gt;INFO   | jvm 1    | 2012/10/14 09:53:07 |  WARN | Transport Connection to: tcp://127.0.0.1:36440 failed: org.apache.activemq.transport.InactivityIOException: Channel was inactive for too (&amp;gt;10000) long: tcp://127.0.0.1:36440&lt;/p&gt;


&lt;p&gt;I am able to reproduce this with either:&lt;/p&gt;

&lt;p&gt;a) the current Ruby stomp gem&lt;br/&gt;
b) the current golang stompngo package&lt;/p&gt;

&lt;p&gt;It is unclear to me whether:&lt;/p&gt;

&lt;p&gt;a) the AMQ heartbeat code is not tolerant as the specification suggests&lt;br/&gt;
b) the AMQ heartbeat receiver is not reading or recognizing heartbeats at all&lt;/p&gt;

&lt;p&gt;In all cases these tests succeed with either:&lt;/p&gt;

&lt;p&gt;a) AMQ 5.7.0 stomp without nio&lt;br/&gt;
b) Apollo&lt;br/&gt;
c) RabbitMQ&lt;br/&gt;
d) a client that only receives heartbeats, but does not send them&lt;/p&gt;

&lt;p&gt;I will attach a Ruby client example shortly.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Kernel:Linux tjjackson 3.0.0-26-generic #43-Ubuntu SMP Tue Sep 25 17:19:22 UTC 2012 x86_64 x86_64 x86_64 GNU/Linux&lt;/p&gt;

&lt;p&gt;AMQ: 5.7.0&lt;br/&gt;
Ubuntu: 11.10&lt;br/&gt;
Java: 1.6.0_24&lt;/p&gt;

&lt;p&gt;From activemq.xml:&lt;/p&gt;

&lt;p&gt;&amp;lt;transportConnector name=&quot;stomp&quot; &lt;br/&gt;
  uri=&quot;stomp+nio://0.0.0.0:61613?trace=true&quot;/&amp;gt;&lt;/p&gt;
</environment>
        <key id="12611754">AMQ-4106</key>
            <summary>STOMP+NIO and Heartbeats gives consistent InactivityIOException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="gmallard">Guy Allard</reporter>
                        <labels>
                    </labels>
                <created>Sun, 14 Oct 2012 14:22:43 +0000</created>
                <updated>Tue, 23 Oct 2012 19:16:21 +0000</updated>
                            <resolved>Tue, 23 Oct 2012 19:14:24 +0000</resolved>
                                    <version>5.7.0</version>
                                    <fixVersion>5.8.0</fixVersion>
                                    <component>STOMP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13475841" author="gmallard" created="Sun, 14 Oct 2012 14:24:18 +0000"  >&lt;p&gt;Ruby client example.&lt;/p&gt;</comment>
                            <comment id="13481830" author="tabish121" created="Mon, 22 Oct 2012 21:44:29 +0000"  >&lt;p&gt;Was able to reproduce some issue in a JUnit, will take a look.&lt;/p&gt;</comment>
                            <comment id="13482411" author="tabish121" created="Tue, 23 Oct 2012 15:32:12 +0000"  >&lt;p&gt;There&apos;s a couple issues in the NIO layer mainly relating to not keeping the TcpTransports receiverCounter moving which causes the InactivityMonitor to think that no reads are occurring when we are only getting STOMP keep alives which are just newlines.  The StompCodec also has a bug that&apos;s causing it to get stuck because of this. &lt;/p&gt;</comment>
                            <comment id="13482588" author="tabish121" created="Tue, 23 Oct 2012 19:14:24 +0000"  >&lt;p&gt;Fixed now, also should fix a similar issue with AMQP and MQTT NIO transports. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12549068" name="nioheartb.rb" size="1805" author="gmallard" created="Sun, 14 Oct 2012 14:24:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>248564</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i09w2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>55637</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>