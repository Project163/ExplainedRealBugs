<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:12:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5888] Transport Connection to: tcp://127.0.0.1:41062 failed: java.io.EOFException shows up in log when closing connection normally</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5888</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Closing an ActiveMQConnection by calling the close() method caused the following warning message to show in the log&lt;/p&gt;

&lt;p&gt;17:59:05,384 | WARN  | org.apache.activemq.broker.TransportConnection:245 Transport Connection to: tcp://127.0.0.1:41062 failed: java.io.EOFException&lt;/p&gt;

&lt;p&gt;This exception is harmless but this WARN message appears repeatedly in the logs which is a source of false alarm.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12845246">AMQ-5888</key>
            <summary>Transport Connection to: tcp://127.0.0.1:41062 failed: java.io.EOFException shows up in log when closing connection normally</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gmurthy">Ganesh Murthy</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Jul 2015 12:38:46 +0000</created>
                <updated>Wed, 2 Oct 2019 17:55:12 +0000</updated>
                            <resolved>Thu, 16 Jul 2015 11:18:47 +0000</resolved>
                                    <version>5.11.1</version>
                                    <fixVersion>5.12.0</fixVersion>
                                    <component>JMS client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14628027" author="ganeshmurthy" created="Wed, 15 Jul 2015 13:09:01 +0000"  >&lt;p&gt;The log message is output from the public void serviceTransportException(IOException e) method of the org.apache.activemq.broker.TransportConnection class only if the stopping and the pendingStop flags have not been already set before the serviceTransportException(IOException e)  is called as seen from the following code snippet - &lt;/p&gt;

&lt;p&gt;        if (!stopping.get() &amp;amp;&amp;amp; !pendingStop) {&lt;br/&gt;
            transportException.set(e);&lt;br/&gt;
            if (TRANSPORTLOG.isDebugEnabled()) &lt;/p&gt;
{
                TRANSPORTLOG.debug(this + &quot; failed: &quot; + e, e);
            }
&lt;p&gt; else if (TRANSPORTLOG.isWarnEnabled() &amp;amp;&amp;amp; !expected(e)) &lt;/p&gt;
{
                TRANSPORTLOG.warn(this + &quot; failed: &quot; + e);   //--&amp;gt; This is where the WARN is written to the log.
            }
&lt;p&gt;            stopAsync(e);&lt;br/&gt;
        }&lt;/p&gt;

&lt;p&gt;Sequence of events - &lt;br/&gt;
1. The close() method on the ActiveMQConnection sends a ShutdownInfo to the server and immediately closes the socket from the client side. &lt;br/&gt;
2. The broker&apos;s TcpTransportConnection is handling this ShutdownInfo but it so happens that the Inactivity monitor also fires off a write to the closed socket and fails with an EOFException or SocketException.&lt;br/&gt;
3. The public void stopAsync() in the org.apache.activemq.broker.jmx.ManagedTransportConnection makes a call to unregister the MBeans and then sets the  stopping flag. The latency involved in unregistering the beans is causing the stopping flag to not be set in time, so the WARN message is caused. &lt;/p&gt;

&lt;p&gt;Moving the stopping flag to be set before the unregister bean call should set the stopping flag to be set and prevent the WARN message from being written to the log.&lt;/p&gt;

&lt;p&gt;I have attached a patch a test.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="14628132" author="gtully" created="Wed, 15 Jul 2015 14:28:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gmurthy&quot; class=&quot;user-hover&quot; rel=&quot;gmurthy&quot;&gt;gmurthy&lt;/a&gt;  peeking at the patch - it looks like the mbeans won&apos;t get unregistered b/c the stopping flag will be flipped by the super stopAsync.&lt;/p&gt;</comment>
                            <comment id="14628209" author="ganeshmurthy" created="Wed, 15 Jul 2015 15:15:05 +0000"  >&lt;p&gt;Good catch Gary. Gosh, I introduced a regression. I have attached a new patch after doing some testing. I removed the if(!isStopping()) conditional. The unregister now gets called.&lt;/p&gt;

&lt;p&gt;Please see patch &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5888&quot; title=&quot;Transport Connection to: tcp://127.0.0.1:41062 failed: java.io.EOFException shows up in log when closing connection normally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5888&quot;&gt;&lt;del&gt;AMQ-5888&lt;/del&gt;&lt;/a&gt;-GMURTHY-NEW-PATCH.TXT  &lt;/p&gt;</comment>
                            <comment id="14629576" author="jira-bot" created="Thu, 16 Jul 2015 11:16:51 +0000"  >&lt;p&gt;Commit 2b5b890db9810ff282479d7688c36e3c78e32c73 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2b5b890&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2b5b890&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5888&quot; title=&quot;Transport Connection to: tcp://127.0.0.1:41062 failed: java.io.EOFException shows up in log when closing connection normally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5888&quot;&gt;&lt;del&gt;AMQ-5888&lt;/del&gt;&lt;/a&gt; add patch from GMURTHY with thanks - fix and test&lt;/p&gt;</comment>
                            <comment id="14629579" author="gtully" created="Thu, 16 Jul 2015 11:18:47 +0000"  >&lt;p&gt;fix and test applied via patch with thanks to Ganesh Murthy&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://git1-us-west.apache.org/repos/asf/activemq/repo?p=activemq.git;a=commit;h=2b5b890db9810ff282479d7688c36e3c78e32c73&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git1-us-west.apache.org/repos/asf/activemq/repo?p=activemq.git;a=commit;h=2b5b890db9810ff282479d7688c36e3c78e32c73&lt;/a&gt; &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12745468" name="AMQ-5888-GMURTHY-NEW-PATCH.TXT" size="5478" author="gmurthy" created="Wed, 15 Jul 2015 15:52:04 +0000"/>
                            <attachment id="12745439" name="AMQ-5888-GMURTHY-PATCH.TXT" size="1088" author="gmurthy" created="Wed, 15 Jul 2015 13:10:31 +0000"/>
                            <attachment id="12745440" name="TcpTransportCloseConnectionTest.java" size="3907" author="gmurthy" created="Wed, 15 Jul 2015 13:12:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 18 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ha4n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>