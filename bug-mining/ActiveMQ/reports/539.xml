<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:39:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2080] InitialReconnectDelay appears to be ignored in Discovery transport URLs</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2080</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Using a connection URL of&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;discovery:(multicast://default?group=test)?maxReconnectAttempts=13&amp;amp;initialReconnectDelay=1000&amp;amp;useExponentialBackOff=false&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;one would expect initial connection attempts to go on for at least 13 seconds (13 reconnect attempts with 1000ms delay between attempts) but in fact the error &quot;No uris available to connect to&quot; returned in less than a second.  Changing  &lt;tt&gt;useExponentialBackOff&lt;/tt&gt; to &lt;tt&gt;true&lt;/tt&gt; delays a failure report to about 41 seconds, which is 10ms * 2^12, which is what you&apos;d expect with 12 reconnect attempts (13 connect attempts) starting with the default 10ms delay and doubling with every attempt, since 2^0+2^1+2^2+...2^n-1 is approx 2^n.  (I guess maxReconnectAttempts should be called maxConnectAttempts, but I&apos;m not opening a bug about that.)  Changing maxReconnectAttempts to 12 causes the delay to be about 20 seconds, half of what it is for 13, so that checks out.&lt;/p&gt;

&lt;p&gt;Altogether this points to the initialReconnectDelay parameter being ignored on initial connection attempts.   It is supposed to work per  &lt;a href=&quot;http://activemq.apache.org/discovery-transport-reference.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/discovery-transport-reference.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows XP SP3&lt;/p&gt;</environment>
        <key id="12482722">AMQ-2080</key>
            <summary>InitialReconnectDelay appears to be ignored in Discovery transport URLs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="jgro">Jeremy Grodberg</reporter>
                        <labels>
                    </labels>
                <created>Tue, 20 Jan 2009 02:20:27 +0000</created>
                <updated>Tue, 27 Jan 2009 21:09:21 +0000</updated>
                            <resolved>Tue, 27 Jan 2009 13:08:41 +0000</resolved>
                                    <version>5.2.0</version>
                                    <fixVersion>5.2.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12940701" author="gtully" created="Mon, 26 Jan 2009 14:41:51 +0000"  >&lt;p&gt;the initialReconnectDelay kicks in when a candidate url is returned by the discovery agent. Up to that point, the reconnectDelay is in effect and this defaults to 10 ms. I think there is some value in leaving things are they are such that it is possible to have a different initial reconnect delay for discovery finding some candidate urls and for connecting to these urls.&lt;/p&gt;

&lt;p&gt;I added a test that verifies the setting of reconnectDelay takes effect when no broker can be found. It uses a uri of the form: &quot;discovery:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;(multicast:&lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;)?useExponentialBackOff=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;maxReconnectAttempts=2&amp;amp;reconnectDelay=4000&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Does this work for you. If so I can update the documentation with a reference to reconnectDelay&lt;/p&gt;</comment>
                            <comment id="12940704" author="jgro" created="Mon, 26 Jan 2009 19:53:57 +0000"  >&lt;p&gt;I support the idea of different behavior before the discoveryAgent discovers a broker as opposed to after, since the delay to discover a broker is a completely different set of issues compared to the delay to connect to a broker that is advertising that it is alive.  Because of this, I think the different behaviors should be completely separately configurable with regard to delay between attempts, number of attempts, and backoff strategy.  &lt;/p&gt;

&lt;p&gt;In any case, though there may be good reasons it evolved this way, I find it counter-intuitive and confusing that it would be the &quot;reconnectDelay&quot; and not the &quot;initialReconnectDelay&quot; that is the reconnect delay used in the initial attempt to find a broker.&lt;/p&gt;

&lt;p&gt;For my immediate needs I can just deal with the current behavior, in part because there is some other bug (perhaps in the JVM or the Win2K TCP stack) that is causing any attempts to discover the broker to fail after the discovery agent has been running for a few minutes.   I suspect this is a Windows bug because it affects other processes running in separate JVMs, but I&apos;m not a Windows expert so I don&apos;t know how reasonable it is to believe there&apos;s this kind of bug still existing in the OS.  &lt;/p&gt;</comment>
                            <comment id="12940695" author="gtully" created="Tue, 27 Jan 2009 13:08:40 +0000"  >&lt;p&gt;agree, it is not intuitive, but the original value of the reconnectDelay is in use prior to the discovery component returning a list of candidate urls to connect to.&lt;br/&gt;
Added a reference to the documentation: &lt;a href=&quot;http://activemq.apache.org/discovery-transport-reference.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/discovery-transport-reference.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Re your current problem, I think it is unlikely to be a JVM of OS issue.&lt;br/&gt;
Have you enabled debug logging for the class: org.apache.activemq.transport.discovery.multicast.MulticastDiscoveryAgent to see if there is any indicator there. Some of the configuration options on the &lt;a href=&quot;http://activemq.apache.org/maven/5.2.0/activemq-core/apidocs/src-html/org/apache/activemq/transport/discovery/multicast/MulticastDiscoveryAgent.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;MulticastDiscoveryAgent&lt;/a&gt; may not be appropriate to your scenario.&lt;br/&gt;
The discoveryAgent properties are set like the group attribute: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;discovery:(multicast:&lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;?group=test&amp;amp;keepAliveInterval=1000)...&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12940679" author="jgro" created="Tue, 27 Jan 2009 17:35:11 +0000"  >&lt;p&gt;Thank you for updating the documentation.&lt;/p&gt;

&lt;p&gt;Is there a way to use exponential backoff for reconnects to a discovered URL but constant delays while waiting to discover the broker?  If not, can we make that a feature request?&lt;/p&gt;

&lt;p&gt;Re my current problem, yes, I had turned on trace-level debugging for MulticastDiscoveryAgent and it didn&apos;t tell me anything other than I had properly set the group.  Once the parameter parsing is completed I don&apos;t get any more logging until the exception is thrown that the connection failed because no URIs were discovered.  It doesn&apos;t appear to matter whether I set loopback to true or not (not surprising since nothing but the broker is running on the broker machine).  &lt;/p&gt;
</comment>
                            <comment id="12940690" author="jgro" created="Tue, 27 Jan 2009 21:09:21 +0000"  >&lt;p&gt;Also, is this consistent with the behavior of the failover transport?  If so, then the failover transport documentation should be updated, too.  If not.....&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95989</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 44 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14ccf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233463</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>