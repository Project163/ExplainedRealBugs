<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:37:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1860] soTimeout transport property- Incorrect documentation (or code, you pick)</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1860</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;The documentation for TCP transport, shows soTimeout, connectionTimeout and socketBufferSize as properties without a prefix.&lt;br/&gt;
The code in TcpTransportServer.java doesn&apos;t have the support for these properties.&lt;br/&gt;
hence setting a URL to tcp://192.168.3.3:61616?soTimeout=180000 does nothing, and defaults to soTimeout=0 (which is a bad value due to how sockets get closed, and can cause the system to hang on  a socketWrite call, causing the rest of the server to hang, but I can explain that on the dev lists for those interested)&lt;/p&gt;

&lt;p&gt;Bug description: Transport properties are incorrectly document or implemented&lt;/p&gt;

&lt;p&gt;There are two solutions to this bug:&lt;/p&gt;

&lt;p&gt;1. The preferred, would be to fix the documentation&lt;br/&gt;
&lt;a href=&quot;http://activemq.apache.org/tcp-transport-reference.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/tcp-transport-reference.html&lt;/a&gt;&lt;br/&gt;
the mentioned options will work if they are prefixed with &quot;transport.&quot;&lt;br/&gt;
so the URL would be &lt;br/&gt;
tcp://192.168.3.3:61616?transport.soTimeout=180000&lt;/p&gt;

&lt;p&gt;2. Add the properties with their getters/setters into TcpTransportServer.java and then during the handleSocket method add them to the options map&lt;/p&gt;

&lt;p&gt;Please note, this bug refers to the soTimeout setting on the socket that gets created on the server when a producer/consumer connects in using TCP&lt;/p&gt;

&lt;p&gt;best&lt;br/&gt;
Filip&lt;/p&gt;</description>
                <environment>&lt;p&gt;All&lt;/p&gt;</environment>
        <key id="12482608">AMQ-1860</key>
            <summary>soTimeout transport property- Incorrect documentation (or code, you pick)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="fhanik">Filip Hanik</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Jul 2008 18:26:08 +0000</created>
                <updated>Fri, 3 Jun 2011 15:06:41 +0000</updated>
                            <resolved>Tue, 2 Sep 2008 07:03:47 +0000</resolved>
                                    <version>5.0.0</version>
                    <version>5.1.0</version>
                                    <fixVersion>5.2.0</fixVersion>
                                    <component>Broker</component>
                    <component>Documentation</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12939979" author="fhanik" created="Fri, 18 Jul 2008 19:03:13 +0000"  >&lt;p&gt;As a side note, and not relevant to this issue, let me explain why soTimeout=0 is a bad default value&lt;/p&gt;

&lt;p&gt;Lets say you have a connection between a consumer and the AMQ server, that connections gets terminated.&lt;/p&gt;

&lt;p&gt;When a socket is closed, it doesn&apos;t really mean its closed - this is explained in:&lt;br/&gt;
&lt;a href=&quot;http://java.sun.com/j2se/1.5.0/docs/guide/net/articles/connection_release.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://java.sun.com/j2se/1.5.0/docs/guide/net/articles/connection_release.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;On the server the following will happen&lt;/p&gt;

&lt;p&gt;yy.yy.yy.yy.61616    xx.xx.xx.xx.44674    49152      0 49330      0 CLOSE_WAIT&lt;/p&gt;

&lt;p&gt;And inside of the AMQ you&apos;ll see the following stack trace&lt;br/&gt;
&quot;ActiveMQ Transport: tcp:///xx.xx.xx.xx:44674&quot; daemon prio=4 tid=0x002ebc88 nid=0x2a runnable &lt;span class=&quot;error&quot;&gt;&amp;#91;0xd10ff000..0xd10ffc70&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.net.SocketOutputStream.socketWrite0(Native Method)&lt;br/&gt;
        at java.net.SocketOutputStream.socketWrite(SocketOutputStream.java:92)&lt;br/&gt;
        at java.net.SocketOutputStream.write(SocketOutputStream.java:136)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpBufferedOutputStream.flush(TcpBufferedOutputStream.java:105)&lt;br/&gt;
        at java.io.DataOutputStream.flush(DataOutputStream.java:106)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:154)&lt;br/&gt;
        at org.apache.activemq.transport.InactivityMonitor.oneway(InactivityMonitor.java:157)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;locked &amp;lt;0xd8775fc0&amp;gt; (a org.apache.activemq.transport.InactivityMonitor$2)&lt;br/&gt;
        at org.apache.activemq.transport.TransportFilter.oneway(TransportFilter.java:82)&lt;br/&gt;
        at org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:91)&lt;br/&gt;
        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0xd8775da8&amp;gt; (a java.lang.Object)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1151)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:766)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.dispatchSync(TransportConnection.java:727)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;please remember, the client is no longer connected, and is no longer reading data. The server now has a CLOSE_WAIT connection and a thread that is stuck in this state.&lt;br/&gt;
The socketWrite0 will only return after a TCP packets has moved on the connection (which it wont since the client is no longer present) or until it times out (which it wont since soTimeout is 0)&lt;/p&gt;

&lt;p&gt;As you can see this thread is also holding a bunch of locks, some of these interfer with other server threads, causing the system to display systems of being hung. The only work around ar this point is to restart the AMQ server.&lt;/p&gt;

&lt;p&gt;Hope this makes sense. My recommendation would be to have a &amp;gt;0 soTimeout value as default, (and the property name be documented properly of course&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; )&lt;/p&gt;

&lt;p&gt;best&lt;br/&gt;
Filip&lt;/p&gt;</comment>
                            <comment id="12940034" author="fhanik" created="Tue, 5 Aug 2008 04:03:08 +0000"  >&lt;p&gt;Looks like the problems go further than just the documentation being incorrect. On the server, it the soTimeout setting wont take into effect unless you use transport.soTimeout property.&lt;br/&gt;
However, trying to apply this setting to a client URL, the system bombs out&lt;br/&gt;
Caused by: java.lang.IllegalArgumentException: Invalid connect parameters: &lt;/p&gt;
{transport.soTimeout=180000}
&lt;p&gt;    at org.apache.activemq.transport.TransportFactory.doConnect(TransportFactory.java:133)&lt;br/&gt;
    at org.apache.activemq.transport.TransportFactory.doConnect(TransportFactory.java:47)&lt;br/&gt;
    at org.apache.activemq.transport.TransportFactory.connect(TransportFactory.java:76)&lt;br/&gt;
    at org.apache.activemq.ActiveMQConnectionFactory.createTransport(ActiveMQConnectionFactory.java:235)&lt;/p&gt;

&lt;p&gt;then it would probably be better to just allow the property soTimeout, but it looks like the entire socket property settings need to have a look over, since there is no consistent way of setting these properties. And because the soTimeout property is not set, the whoe server locks up if there is a client that is deciding to stop receiving data.&lt;/p&gt;
</comment>
                            <comment id="12940024" author="fhanik" created="Tue, 5 Aug 2008 04:03:44 +0000"  >&lt;p&gt;Example of how to make the soTimeout property work on the server&lt;/p&gt;</comment>
                            <comment id="12940028" author="fhanik" created="Tue, 5 Aug 2008 04:05:59 +0000"  >&lt;p&gt;Example of how to make the soTimeout work for the server, one must of course verify that the client is picking up the option too&lt;/p&gt;</comment>
                            <comment id="12940030" author="rajdavies" created="Thu, 14 Aug 2008 08:31:09 +0000"  >&lt;p&gt;Thanks Filip - applied the patch in SVN revision 685808&lt;/p&gt;</comment>
                            <comment id="12940038" author="fhanik" created="Thu, 14 Aug 2008 17:08:44 +0000"  >&lt;p&gt;Rob, looks like I wrote the patch with my head up my rear,&lt;/p&gt;

&lt;p&gt;this&lt;/p&gt;

&lt;p&gt;+            options.put(&quot;soTimeout&quot;, Integer.valueOf(soTimeout));&lt;br/&gt;
+            options.put(&quot;soTimeout&quot;, Integer.valueOf(soTimeout));&lt;br/&gt;
+            options.put(&quot;connectionTimeout&quot;, Integer.valueOf(socketBufferSize));&lt;/p&gt;

&lt;p&gt;should be&lt;/p&gt;

&lt;p&gt;+            options.put(&quot;soTimeout&quot;, Integer.valueOf(soTimeout));&lt;br/&gt;
+            options.put(&quot;socketBufferSize&quot;, Integer.valueOf(socketBufferSize));&lt;br/&gt;
+            options.put(&quot;connectionTimeout&quot;, Integer.valueOf(connectionTimeout));&lt;/p&gt;</comment>
                            <comment id="12940067" author="fhanik" created="Fri, 15 Aug 2008 16:50:38 +0000"  >&lt;p&gt;See previous note, copy paste error in the included patch&lt;/p&gt;</comment>
                            <comment id="12940143" author="rajdavies" created="Tue, 2 Sep 2008 07:03:47 +0000"  >&lt;p&gt;no problem! - updated in SVN revision 691129&lt;/p&gt;</comment>
                            <comment id="13042156" author="jacques.le.roux" created="Wed, 1 Jun 2011 13:16:14 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Why, unlike proposed  Filip, the soTimeout is still at 0 by default?&lt;/p&gt;

&lt;p&gt;This is from the current documentation at &lt;a href=&quot;http://activemq.apache.org/tcp-transport-reference.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/tcp-transport-reference.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I had a quick look at the 5.4.2 code and I see that TcpTransportServer.configureServerSocket() sets soTimeout to 2000 and is called in TcpTransportServer.bind() which is itself used by TransportServer.doBind(). I stopped there, so maybe I&apos;m missing something...&lt;/p&gt;</comment>
                            <comment id="13042167" author="gtully" created="Wed, 1 Jun 2011 13:36:38 +0000"  >&lt;p&gt;The default for client transports and server side accepted connections (and underlying transports) is still 0, configureServerSocket is a bit of an anomaly, it applies to just the listen socket, the socket that does an accept loop such that the accept thread won&apos;t block a shutdown.&lt;/p&gt;

&lt;p&gt;There is a distinction on the server/broker side between the listen transport and accepted transports (new connections).&lt;/p&gt;

&lt;p&gt;Transport options on the broker side that need to be applied to newly accepted connections need to use the &quot;transport.&quot; prefix. without the prefix, they are applied just to the listener.&lt;/p&gt;</comment>
                            <comment id="13042239" author="jacques.le.roux" created="Wed, 1 Jun 2011 15:34:39 +0000"  >&lt;p&gt;Thanks Garry,&lt;/p&gt;

&lt;p&gt;This helped much &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13042422" author="jacques.le.roux" created="Wed, 1 Jun 2011 20:47:04 +0000"  >&lt;p&gt;Just one question more,&lt;/p&gt;

&lt;p&gt;When in activemq.xml I put&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;transportConnector name=&lt;span class=&quot;code-quote&quot;&gt;&quot;openwire&quot;&lt;/span&gt; uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//0.0.0.0:61616?transport.soTimeout=60000&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I don&apos;t see anymore information dynamically changing at &lt;a href=&quot;http://server:8161/admin/topics.jsp&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://server:8161/admin/topics.jsp&lt;/a&gt; (we use a topic to broadcast), is it normal?&lt;br/&gt;
I checked with lsof and netstat there are connections created and removed. &lt;/p&gt;
</comment>
                            <comment id="13042662" author="jacques.le.roux" created="Thu, 2 Jun 2011 09:28:08 +0000"  >&lt;p&gt;OK Forget my question, it&apos;s actually dynamically changing but far, far less than before...&lt;/p&gt;

&lt;p&gt;I think I will have some other questions but I have to check how our application (based on Apache OFBiz which uses JNDI to connect to the broker) handles some parts before&lt;/p&gt;</comment>
                            <comment id="13043387" author="jacques.le.roux" created="Fri, 3 Jun 2011 15:06:41 +0000"  >&lt;p&gt;OK, it&apos;s all clear, thanks again&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461212" name="transport-options.patch" size="1909" author="fhanik" created="Tue, 5 Aug 2008 04:05:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72166</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s20v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161804</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>