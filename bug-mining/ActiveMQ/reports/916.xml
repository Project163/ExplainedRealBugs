<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:46:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2564] Pure Master Slave broker hangs when storage limit is reached</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2564</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;The pure master slave broker hangs when the storage limit is reached and dequeueing messages from the queue is not possible.&lt;/p&gt;

&lt;p&gt;The behavior can be reproduced with a producer which sends messages to the master broker until the slave broker writes&lt;br/&gt;
 &quot;INFO | Usage Manager Store is Full. Stopping producer (ID:karkand-51292-1263305705067-0:0:1:1) to prevent flooding queue://TestQueue. See &lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html&lt;/a&gt; for more info&quot;&lt;br/&gt;
this message to the console.&lt;br/&gt;
To reproduce the store is full message on the slave broker maybe 2 - 3 attempts are necessary otherwise&lt;br/&gt;
the messages appears on the console of the master broker.&lt;/p&gt;

&lt;p&gt;Any attempts by a test consumer to dequeue messages fail, it just hangs.&lt;/p&gt;

&lt;p&gt;The following information gather with JMX might be interesting:&lt;br/&gt;
MASTER: StorePercentUsage=99&lt;br/&gt;
SLAVE:    StorePercentUsage=100&lt;/p&gt;

&lt;p&gt;The attributes for the Queue are identical on both &lt;br/&gt;
brokers.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 9.10 Desktop, Java 1.6 (build 1.6.0_16-b01)&lt;/p&gt;</environment>
        <key id="12483260">AMQ-2564</key>
            <summary>Pure Master Slave broker hangs when storage limit is reached</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="joern">J&#246;rn Kottmann</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Jan 2010 14:32:35 +0000</created>
                <updated>Tue, 25 May 2010 12:04:03 +0000</updated>
                            <resolved>Fri, 21 May 2010 11:43:21 +0000</resolved>
                                    <version>5.3.0</version>
                                    <fixVersion>5.4.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12941981" author="gtully" created="Tue, 12 Jan 2010 16:21:55 +0000"  >&lt;p&gt;can you validate that this is still a problem with a current 5.4-SNAPSHOT? There was one deadlock issue resolve in the past few weeks in the context of being full and not resuming leading to hung consumers. this was not related to pure master slave however but it may be the difference.&lt;/p&gt;</comment>
                            <comment id="12941987" author="joern" created="Tue, 12 Jan 2010 16:51:25 +0000"  >&lt;p&gt;I repeated the test with the apache-activemq-5.4-SNAPSHOT build from Wed Jan 06 15:02:31 GMT+00:00 2010 (http time stamp on the download site).&lt;br/&gt;
The result was the same as described above.&lt;/p&gt;

&lt;p&gt;After stopping the slave broker it was possible to dequeue messages again from the master broker.&lt;/p&gt;

&lt;p&gt;The 5.4-SNAPSHOT version prints out more information to the console:&lt;br/&gt;
 INFO | ActiveMQ JMS Message Broker (slave, ID:karkand-43612-1263314151269-1:0) started&lt;br/&gt;
 INFO | Usage Manager Store is Full. Producer (ID:karkand-58702-1263314161468-0:0:1:1) stopped to prevent flooding queue://TestQueue. See &lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html&lt;/a&gt; for more info (blocking for: 30s)&lt;br/&gt;
 INFO | Usage Manager Store is Full. Producer (ID:karkand-58702-1263314161468-0:0:1:1) stopped to prevent flooding queue://TestQueue. See &lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html&lt;/a&gt; for more info (blocking for: 60s)&lt;br/&gt;
 INFO | Usage Manager Store is Full. Producer (ID:karkand-58702-1263314161468-0:0:1:1) stopped to prevent flooding queue://TestQueue. See &lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html&lt;/a&gt; for more info (blocking for: 90s)&lt;br/&gt;
 INFO | Usage Manager Store is Full. Producer (ID:karkand-58702-1263314161468-0:0:1:1) stopped to prevent flooding queue://TestQueue. See &lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html&lt;/a&gt; for more info (blocking for: 121s)&lt;br/&gt;
 INFO | Usage Manager Store is Full. Producer (ID:karkand-58702-1263314161468-0:0:1:1) stopped to prevent flooding queue://TestQueue. See &lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html&lt;/a&gt; for more info (blocking for: 151s)&lt;br/&gt;
 INFO | Usage Manager Store is Full. Producer (ID:karkand-58702-1263314161468-0:0:1:1) stopped to prevent flooding queue://TestQueue. See &lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html&lt;/a&gt; for more info (blocking for: 182s)&lt;br/&gt;
 INFO | Usage Manager Store is Full. Producer (ID:karkand-58702-1263314161468-0:0:1:1) stopped to prevent flooding queue://TestQueue. See &lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html&lt;/a&gt; for more info (blocking for: 212s)&lt;br/&gt;
 INFO | Usage Manager Store is Full. Producer (ID:karkand-58702-1263314161468-0:0:1:1) stopped to prevent flooding queue://TestQueue. See &lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html&lt;/a&gt; for more info (blocking for: 242s)&lt;br/&gt;
 INFO | Usage Manager Store is Full. Producer (ID:karkand-58702-1263314161468-0:0:1:1) stopped to prevent flooding queue://TestQueue. See &lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html&lt;/a&gt; for more info (blocking for: 272s)&lt;br/&gt;
 INFO | Usage Manager Store is Full. Producer (ID:karkand-58702-1263314161468-0:0:1:1) stopped to prevent flooding queue://TestQueue. See &lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html&lt;/a&gt; for more info (blocking for: 303s)&lt;br/&gt;
 INFO | Usage Manager Store is Full. Producer (ID:karkand-58702-1263314161468-0:0:1:1) stopped to prevent flooding queue://TestQueue. See &lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html&lt;/a&gt; for more info (blocking for: 333s)&lt;br/&gt;
 INFO | Usage Manager Store is Full. Producer (ID:karkand-58702-1263314161468-0:0:1:1) stopped to prevent flooding queue://TestQueue. See &lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html&lt;/a&gt; for more info (blocking for: 363s)&lt;/p&gt;

&lt;p&gt;The producer was directly connected to the master broker and not the slave broker. These messages must be about a connection between the master and slave broker.&lt;/p&gt;</comment>
                            <comment id="12941996" author="joern" created="Tue, 12 Jan 2010 17:09:32 +0000"  >&lt;p&gt;I added the  sendFailIfNoSpace=&quot;true&quot; attribute to the systemUsage element of he slave broker config, repeated the test and the following exception was printed to the console of the master broker:&lt;/p&gt;

&lt;p&gt;ERROR | Slave Failed&lt;br/&gt;
javax.jms.ResourceAllocationException: Usage Manager Store is Full. Producer (ID:karkand-45529-1263315817291-0:0:1:1) stopped to prevent flooding queue://TestQueue. See &lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html&lt;/a&gt; for more info&lt;br/&gt;
	at org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:500)&lt;br/&gt;
	at org.apache.activemq.broker.region.Queue.send(Queue.java:474)&lt;br/&gt;
	at org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:354)&lt;br/&gt;
	at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:445)&lt;br/&gt;
	at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:224)&lt;br/&gt;
	at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:126)&lt;br/&gt;
	at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:95)&lt;br/&gt;
	at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:133)&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:443)&lt;br/&gt;
	at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:631)&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:297)&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:175)&lt;br/&gt;
	at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)&lt;br/&gt;
	at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)&lt;br/&gt;
	at org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:207)&lt;br/&gt;
	at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)&lt;br/&gt;
	at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)&lt;/p&gt;</comment>
                            <comment id="12942715" author="gtully" created="Fri, 21 May 2010 11:43:21 +0000"  >&lt;p&gt;r 946974 should resolve this. One thing to note is to ensure that the usage limits on the slave are a little higher than the master such that flow control happens only on the master, other wise replication can block which can block message consumption.&lt;/p&gt;

&lt;p&gt;the revision provides a test and  resolves a hang situation where the producer missed a reply because the replication messed with the correlation id. Normally the ids are in sync, but when a message is queued waiting for space, they can be mismatched. having the replicator (MasterBroker filter) copy the underlying message resolved this issue,&lt;/p&gt;</comment>
                            <comment id="12942725" author="joern" created="Tue, 25 May 2010 11:49:01 +0000"  >&lt;p&gt;Finding the right higher value on the slave seems to be tricky, since it depends on the message size which is usually dynamic,&lt;br/&gt;
which means that depending on the configuration the broker could work for quite some time and then fail suddenly when a bunch of bigger messages is received (which might happen, depending on the application).&lt;/p&gt;

&lt;p&gt;Users which choose a PureMasterSlave configurtion are really focused on stability.&lt;br/&gt;
For this particular issue the slave should maybe disable the flow control completely when the master is healthy, &lt;br/&gt;
what do you think Gary ?&lt;/p&gt;</comment>
                            <comment id="12942724" author="gtully" created="Tue, 25 May 2010 12:04:03 +0000"  >&lt;p&gt;Agree, this is not ideal, but it is not just flow control, it is any memory limit because the default behavior is to block a send if the memory limit is reached. So the slave should be configured with large memory limits or left unbounded.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461591" name="activemq-master.xml" size="2432" author="joern" created="Tue, 12 Jan 2010 14:35:59 +0000"/>
                            <attachment id="12461592" name="activemq-slave.xml" size="2487" author="joern" created="Tue, 12 Jan 2010 14:35:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74892</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 27 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0jxg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>114349</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>