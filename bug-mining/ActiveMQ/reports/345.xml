<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:36:46 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1681] Memory leak when creating large numbers of TemporaryQueues (Log4J related)</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1681</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When using an embedded broker and using Log4J, there is a memory leak in the broker for each new TemporaryQueue created.&lt;/p&gt;

&lt;p&gt;This seems to be the offending code (taken from 5.0.0-release source):&lt;/p&gt;

&lt;p&gt;org.apache.activemq.broker.region.Queue:&lt;/p&gt;

&lt;p&gt;    public Queue(Broker broker, ActiveMQDestination destination, final SystemUsage systemUsage, MessageStore store, DestinationStatistics parentStats,&lt;br/&gt;
                 TaskRunnerFactory taskFactory, Store tmpStore) throws Exception &lt;/p&gt;
{

        ... skipped....

        // let&apos;s copy the enabled property from the parent DestinationStatistics
        this.destinationStatistics.setEnabled(parentStats.isEnabled());
        destinationStatistics.setParent(parentStats);
        this.log = LogFactory.getLog(getClass().getName() + &quot;.&quot; + destination.getPhysicalName());
    }

&lt;p&gt;What happens here is that for each new TemporaryQueue created a new log instance is created with rather large string as it&apos;s name.&lt;br/&gt;
This instance is unique for each new TemoraryQueue and because of the way Log4J handles those instances, it is never removed once initalized.&lt;/p&gt;

&lt;p&gt;We hit this bug when we were testing performance together with Spring-based synchronous JMS API, which is implemented in such a way that &lt;br/&gt;
for each new message it creates a new TemporaryQueue. We got OutOfMemory after about 40000 messages with 128M heap.&lt;/p&gt;

&lt;p&gt;I am not sure what this special log instance is used for, but assuming it&apos;s not very important, it will be easy to fix this bug with just using some predefined log name always.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Embedded broker using Log4J&lt;/p&gt;</environment>
        <key id="12482383">AMQ-1681</key>
            <summary>Memory leak when creating large numbers of TemporaryQueues (Log4J related)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chirino">Hiram R. Chirino</assignee>
                                    <reporter username="gregory.mostizky">Gregory Mostizky</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Apr 2008 11:19:14 +0000</created>
                <updated>Thu, 24 Apr 2008 15:59:37 +0000</updated>
                            <resolved>Thu, 24 Apr 2008 15:59:37 +0000</resolved>
                                    <version>5.0.0</version>
                                    <fixVersion>5.1.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12939557" author="chirino" created="Thu, 24 Apr 2008 15:59:37 +0000"  >&lt;p&gt;This also occurred with temp topics. &lt;/p&gt;


&lt;p&gt;Fixed in revision 651300&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84614</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 31 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s1sv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161768</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>