<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:40:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6606] Journal partial write can result in batch corruption on restart</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6606</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Recovery checking on kahadb will ignore a partial journal write at the end of the journal. However repeated write errors increment the write offset and if a subsequent write succeeds recovery fails reporting a corrupt block.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; MessageDatabase  | emq.store.kahadb.MessageDatabase | Detected corrupt journal files. [34:43883209 &amp;gt;= key &amp;lt; 34:47226069]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;One scenario is write failure for no space followed by gc which allows subsequent writes to complete.&lt;br/&gt;
A failed write or sync should fail with an exception and should revert any offset increment such that a subsequent write reuses that offset, avoiding a partial write corruption. &lt;/p&gt;</description>
                <environment></environment>
        <key id="13044893">AMQ-6606</key>
            <summary>Journal partial write can result in batch corruption on restart</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Feb 2017 17:02:16 +0000</created>
                <updated>Mon, 13 Mar 2017 13:47:18 +0000</updated>
                            <resolved>Tue, 7 Mar 2017 12:34:02 +0000</resolved>
                                    <version>5.14.0</version>
                                    <fixVersion>5.15.0</fixVersion>
                    <fixVersion>5.14.4</fixVersion>
                    <fixVersion>5.14.5</fixVersion>
                                    <component>KahaDB</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15876296" author="jira-bot" created="Tue, 21 Feb 2017 17:06:42 +0000"  >&lt;p&gt;Commit d53b8f8d424e3cf51646b215007fc017717edf44 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=d53b8f8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=d53b8f8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6606&quot; title=&quot;Journal partial write can result in batch corruption on restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6606&quot;&gt;&lt;del&gt;AMQ-6606&lt;/del&gt;&lt;/a&gt; avoid partial writes to the end of the journal - revert offset increment on ioexception, fix and test&lt;/p&gt;</comment>
                            <comment id="15880630" author="jira-bot" created="Thu, 23 Feb 2017 15:22:17 +0000"  >&lt;p&gt;Commit 79069598b1435cadaef504d8d3de31777b869c59 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=7906959&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=7906959&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6606&quot; title=&quot;Journal partial write can result in batch corruption on restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6606&quot;&gt;&lt;del&gt;AMQ-6606&lt;/del&gt;&lt;/a&gt; - fix typo&lt;/p&gt;</comment>
                            <comment id="15880634" author="jira-bot" created="Thu, 23 Feb 2017 15:22:36 +0000"  >&lt;p&gt;Commit 7ca411feee1700e17d08529962197bbb4696ed78 in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=7ca411f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=7ca411f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6606&quot; title=&quot;Journal partial write can result in batch corruption on restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6606&quot;&gt;&lt;del&gt;AMQ-6606&lt;/del&gt;&lt;/a&gt; - fix typo&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 79069598b1435cadaef504d8d3de31777b869c59)&lt;/p&gt;</comment>
                            <comment id="15880639" author="christopher.l.shannon" created="Thu, 23 Feb 2017 15:24:55 +0000"  >&lt;p&gt;Oops, the typo I fixed was supposed to be for &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6602&quot; title=&quot;Memory leak when undeploying webapp with ActiveMQ client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6602&quot;&gt;&lt;del&gt;AMQ-6602&lt;/del&gt;&lt;/a&gt;.  I put &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6606&quot; title=&quot;Journal partial write can result in batch corruption on restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6606&quot;&gt;&lt;del&gt;AMQ-6606&lt;/del&gt;&lt;/a&gt; into the commit message by mistake.&lt;/p&gt;</comment>
                            <comment id="15883375" author="jira-bot" created="Fri, 24 Feb 2017 19:24:31 +0000"  >&lt;p&gt;Commit 22d5b51a0c69b48665f32ea19bad5046d7237426 in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=22d5b51&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=22d5b51&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6606&quot; title=&quot;Journal partial write can result in batch corruption on restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6606&quot;&gt;&lt;del&gt;AMQ-6606&lt;/del&gt;&lt;/a&gt; avoid partial writes to the end of the journal - revert offset increment on ioexception, fix and test&lt;/p&gt;

&lt;p&gt;(cherry picked from commit d53b8f8d424e3cf51646b215007fc017717edf44)&lt;/p&gt;</comment>
                            <comment id="15897168" author="gtully" created="Mon, 6 Mar 2017 11:58:27 +0000"  >&lt;p&gt;This needs more work.. readjustment of offset needs to terminate next pending write batch.&lt;/p&gt;</comment>
                            <comment id="15899363" author="jira-bot" created="Tue, 7 Mar 2017 12:29:22 +0000"  >&lt;p&gt;Commit 21ae1ef2e658a14f89bde79a83a32af340fb351a in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=21ae1ef&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=21ae1ef&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6606&quot; title=&quot;Journal partial write can result in batch corruption on restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6606&quot;&gt;&lt;del&gt;AMQ-6606&lt;/del&gt;&lt;/a&gt; - reset next batch so it does not get reused after error and refine fix to sync write batches b/c async locations will already be in the index&lt;/p&gt;</comment>
                            <comment id="15899365" author="gtully" created="Tue, 7 Mar 2017 12:34:02 +0000"  >&lt;p&gt;the fix is refined to just sync batches such that index updates from async writes do not get reused. In the sync case, the index is not updated till completion.&lt;/p&gt;</comment>
                            <comment id="15899397" author="jira-bot" created="Tue, 7 Mar 2017 13:09:05 +0000"  >&lt;p&gt;Commit 7e3f344ea7708650bac8452fa585e6125ebe083e in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=7e3f344&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=7e3f344&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6606&quot; title=&quot;Journal partial write can result in batch corruption on restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6606&quot;&gt;&lt;del&gt;AMQ-6606&lt;/del&gt;&lt;/a&gt; - reset next batch so it does not get reused after error and refine fix to sync write batches b/c async locations will already be in the index&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 21ae1ef2e658a14f89bde79a83a32af340fb351a)&lt;/p&gt;</comment>
                            <comment id="15899398" author="christopher.l.shannon" created="Tue, 7 Mar 2017 13:09:32 +0000"  >&lt;p&gt;I&apos;m not sure if there will be a 5.14.5 release or if we&apos;ll just do a 5.15.0 but I backported the new commit just in case.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13050564">AMQ-6625</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12482718">AMQ-2042</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3adyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>