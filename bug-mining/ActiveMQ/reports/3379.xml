<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:51:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-8117] VirtualSelectorCacheBrokerPlugin throws false positive exception</title>
                <link>https://issues.apache.org/jira/browse/AMQ-8117</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Dear,&lt;/p&gt;

&lt;p&gt;The VirtualSelectorCacheBrokerPlugin throws an error in the following method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(desc.getName().equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;java.lang.&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&quot;&lt;/span&gt;) || desc.getName().startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;java.util.&quot;&lt;/span&gt;))) {
 &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InvalidClassException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unauthorized deserialization attempt&quot;&lt;/span&gt;, desc.getName());
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This exception is thrown because there are some lines in the selector cache file that do not match the given &quot;startsWith(&quot;java.util.&quot;)&quot;. The code will throw an exception because of the &quot;[L&quot; prefix in front of some java.util. elements in the file:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13018288/13018288_image-2021-01-07-09-36-50-044.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;My activemq.xml and file.data are attached to this ticket.&lt;/p&gt;

&lt;p&gt;The selector cache is working fine if I use ActiveMQ version 5.15.11 or below.&lt;/p&gt;

&lt;p&gt;I have tried to add jdk.serialFilters for the Concurrent Hashmap, like:&lt;/p&gt;

&lt;p&gt;wrapper.java.additional.13=-Djdk.serialFilter=java.util.** (wrapper.conf) and also tried to add this to the java security file, but that did not work.&lt;/p&gt;

&lt;p&gt;I hope this issue can be fixed or if it is not a bug, the documentation can be complemented with some notes on how to configure this filters the right way.&lt;/p&gt;

&lt;p&gt;Best regards,&lt;/p&gt;

&lt;p&gt;Joost&lt;/p&gt;</description>
                <environment></environment>
        <key id="13350828">AMQ-8117</key>
            <summary>VirtualSelectorCacheBrokerPlugin throws false positive exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbonofre">Jean-Baptiste Onofr&#233;</assignee>
                                    <reporter username="jvanc">Joost</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Jan 2021 08:42:09 +0000</created>
                <updated>Fri, 4 Jun 2021 08:28:37 +0000</updated>
                            <resolved>Fri, 4 Jun 2021 04:17:34 +0000</resolved>
                                    <version>5.16.0</version>
                    <version>5.15.12</version>
                    <version>5.15.13</version>
                    <version>5.15.14</version>
                                    <fixVersion>5.15.16</fixVersion>
                    <fixVersion>5.16.3</fixVersion>
                    <fixVersion>5.17.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="6000">1h 40m</timespent>
                                <comments>
                            <comment id="17261009" author="jbonofre" created="Fri, 8 Jan 2021 05:19:48 +0000"  >&lt;p&gt;Let me take a look (to qualify). If a fix is needed (it could be just a documentation concern), I&apos;m not sure I will have time to integrate for 5.16.1/5.15.15.&lt;/p&gt;</comment>
                            <comment id="17339721" author="simonvalter" created="Wed, 5 May 2021 15:39:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=coheigea&quot; class=&quot;user-hover&quot; rel=&quot;coheigea&quot;&gt;coheigea&lt;/a&gt; found an existing issue on this.&lt;/p&gt;

&lt;p&gt;its reproducible in all versions 5.15.13-&amp;gt;5.16.2 and leaves the&#160;VirtualSelectorCacheBrokerPlugin unable to read the cache it wrote.&lt;/p&gt;

&lt;p&gt;steps to reproduce:&lt;/p&gt;

&lt;p&gt;do a clean install.&lt;/p&gt;

&lt;p&gt;enable the plugin&#160;VirtualSelectorCacheBrokerPlugin&lt;/p&gt;

&lt;p&gt;start activemq&lt;/p&gt;

&lt;p&gt;stop activemq - cache have now been written.&lt;/p&gt;

&lt;p&gt;start active mq and observe exception.&lt;/p&gt;</comment>
                            <comment id="17339755" author="jbonofre" created="Wed, 5 May 2021 16:26:16 +0000"  >&lt;p&gt;It seems related to the security enforcement we added.&lt;/p&gt;</comment>
                            <comment id="17339850" author="simonvalter" created="Wed, 5 May 2021 18:56:52 +0000"  >&lt;p&gt;&#160;ConcurrentHashMap does write a Segments array once serialized and so getName would be&#160;&#160;[Ljava.util.concurrent.ConcurrentHashMap$Segment;&lt;/p&gt;

&lt;p&gt;my own quickfix i guess can just be to add&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt; desc.getName().startsWith(&quot;[Ljava.util.&quot;)&lt;/th&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;but i wonder how come this is there in the first place and not just depending on what can be done via&#160;jdk.serialFilter as understand it was backported to java 6,7,8 and is pretty much the same or is the reason you have to support older jvm&apos;s ?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17356439" author="coheigea" created="Thu, 3 Jun 2021 13:44:09 +0000"  >&lt;p&gt;PR submitted: &lt;a href=&quot;https://github.com/apache/activemq/pull/667&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/667&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17357047" author="jira-bot" created="Fri, 4 Jun 2021 04:15:51 +0000"  >&lt;p&gt;Commit 7ca7118a9544fd6b2aac4dd72fd3a6edc3369aca in activemq&apos;s branch refs/heads/main from Colm O hEigeartaigh&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=7ca7118&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=7ca7118&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8117&quot; title=&quot;VirtualSelectorCacheBrokerPlugin throws false positive exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8117&quot;&gt;&lt;del&gt;AMQ-8117&lt;/del&gt;&lt;/a&gt; - Allow java.util arrays for deserialization&lt;/p&gt;</comment>
                            <comment id="17357048" author="jira-bot" created="Fri, 4 Jun 2021 04:15:52 +0000"  >&lt;p&gt;Commit c73998477879a7f1cccd371f0254ffd3829aa5ab in activemq&apos;s branch refs/heads/main from Jean-Baptiste Onofr&#233;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=c739984&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=c739984&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #667 from coheigea/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8117&quot; title=&quot;VirtualSelectorCacheBrokerPlugin throws false positive exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8117&quot;&gt;&lt;del&gt;AMQ-8117&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8117&quot; title=&quot;VirtualSelectorCacheBrokerPlugin throws false positive exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8117&quot;&gt;&lt;del&gt;AMQ-8117&lt;/del&gt;&lt;/a&gt; - Allow java.util arrays for deserialization&lt;/p&gt;</comment>
                            <comment id="17357049" author="jira-bot" created="Fri, 4 Jun 2021 04:15:54 +0000"  >&lt;p&gt;Commit c73998477879a7f1cccd371f0254ffd3829aa5ab in activemq&apos;s branch refs/heads/main from Jean-Baptiste Onofr&#233;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=c739984&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=c739984&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #667 from coheigea/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8117&quot; title=&quot;VirtualSelectorCacheBrokerPlugin throws false positive exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8117&quot;&gt;&lt;del&gt;AMQ-8117&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8117&quot; title=&quot;VirtualSelectorCacheBrokerPlugin throws false positive exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8117&quot;&gt;&lt;del&gt;AMQ-8117&lt;/del&gt;&lt;/a&gt; - Allow java.util arrays for deserialization&lt;/p&gt;</comment>
                            <comment id="17357050" author="jira-bot" created="Fri, 4 Jun 2021 04:16:30 +0000"  >&lt;p&gt;Commit f3e90aab446bb1fc88feba64e710d80dcc03dab1 in activemq&apos;s branch refs/heads/activemq-5.16.x from Colm O hEigeartaigh&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=f3e90aa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=f3e90aa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8117&quot; title=&quot;VirtualSelectorCacheBrokerPlugin throws false positive exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8117&quot;&gt;&lt;del&gt;AMQ-8117&lt;/del&gt;&lt;/a&gt; - Allow java.util arrays for deserialization&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 7ca7118a9544fd6b2aac4dd72fd3a6edc3369aca)&lt;/p&gt;</comment>
                            <comment id="17357051" author="jira-bot" created="Fri, 4 Jun 2021 04:16:54 +0000"  >&lt;p&gt;Commit e5d0abba025cd84c141b7bfdc9084dce912f2308 in activemq&apos;s branch refs/heads/activemq-5.15.x from Colm O hEigeartaigh&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=e5d0abb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=e5d0abb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8117&quot; title=&quot;VirtualSelectorCacheBrokerPlugin throws false positive exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8117&quot;&gt;&lt;del&gt;AMQ-8117&lt;/del&gt;&lt;/a&gt; - Allow java.util arrays for deserialization&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 7ca7118a9544fd6b2aac4dd72fd3a6edc3369aca)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13018289" name="activemq.xml" size="5891" author="jvanc" created="Thu, 7 Jan 2021 08:30:55 +0000"/>
                            <attachment id="13018290" name="file.data" size="1002" author="jvanc" created="Thu, 7 Jan 2021 08:30:41 +0000"/>
                            <attachment id="13018288" name="image-2021-01-07-09-36-50-044.png" size="12101" author="jvanc" created="Thu, 7 Jan 2021 08:36:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 23 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0mccg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>