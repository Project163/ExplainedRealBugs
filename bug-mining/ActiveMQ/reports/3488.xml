<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:59:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-8398] 4-byte Unicode message from JMS to STOMP will be corrupted</title>
                <link>https://issues.apache.org/jira/browse/AMQ-8398</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When sending a message from:&lt;br/&gt;
JMS producer to STOMP consumer&lt;br/&gt;
or&lt;br/&gt;
STOMP producer to JMS consumer&lt;br/&gt;
which contains a 4-byte unicode code points e.g. &lt;a href=&quot;https://unicode-table.com/en/1F5A4/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://unicode-table.com/en/1F5A4/&lt;/a&gt; there is a corruption of the message.&lt;br/&gt;
In the JMS to STOMP case the code point gets converted to:&lt;br/&gt;
&lt;tt&gt;ef bf bd ef bf bd&lt;/tt&gt; when it should be &lt;tt&gt;f0 9f 96 a4&lt;/tt&gt;.&lt;br/&gt;
and in the STOMP to JMS case the JMS client throws an exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; javax.jms.JMSException: java.io.UTFDataFormatException
        at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:72)
        at org.apache.activemq.command.ActiveMQTextMessage.decodeContent(ActiveMQTextMessage.java:104)
        at org.apache.activemq.command.ActiveMQTextMessage.getText(ActiveMQTextMessage.java:84)
        at testkonsument.App.JMS(App.java:86)
        at testkonsument.App.main(App.java:42)
Caused by: java.io.UTFDataFormatException
        at org.apache.activemq.util.MarshallingSupport.convertUTF8WithBuf(MarshallingSupport.java:389)
        at org.apache.activemq.util.MarshallingSupport.readUTF8(MarshallingSupport.java:358)
        at org.apache.activemq.command.ActiveMQTextMessage.decodeContent(ActiveMQTextMessage.java:101)
        ... 3 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Using 4-byte unicode points&lt;br/&gt;
from STOMP to STOMP&lt;br/&gt;
or&lt;br/&gt;
from JMS to JMS&lt;br/&gt;
is not a problem, both works and does not corrupt the code point.&lt;/p&gt;

&lt;p&gt;Note that 2- (e.g. &lt;a href=&quot;https://unicode-table.com/en/00F6/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://unicode-table.com/en/00F6/&lt;/a&gt;) or 3-byte (e.g. &lt;a href=&quot;https://unicode-table.com/en/2614/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://unicode-table.com/en/2614/&lt;/a&gt;) Unicode code points does NOT get corrupted, even if the same message includes a 4-byte Unicode code point.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13405222">AMQ-8398</key>
            <summary>4-byte Unicode message from JMS to STOMP will be corrupted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="simmel">Simon Lundstrom</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Oct 2021 15:05:45 +0000</created>
                <updated>Wed, 18 Dec 2024 23:43:52 +0000</updated>
                            <resolved>Wed, 28 Aug 2024 19:07:29 +0000</resolved>
                                    <version>5.16.3</version>
                                    <fixVersion>6.2.0</fixVersion>
                    <fixVersion>5.18.6</fixVersion>
                    <fixVersion>6.1.4</fixVersion>
                                    <component>Broker</component>
                    <component>STOMP</component>
                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="28200">7h 50m</timespent>
                                <comments>
                            <comment id="17484376" author="jbonofre" created="Sun, 30 Jan 2022 15:10:46 +0000"  >&lt;p&gt;Is it a regression (compare to previous version) ?&lt;/p&gt;</comment>
                            <comment id="17484509" author="simmel" created="Mon, 31 Jan 2022 06:02:14 +0000"  >&lt;p&gt;I don&apos;t know if it ever has worked correctly. I do know though that at least 5.15.3 is affected.&lt;/p&gt;</comment>
                            <comment id="17555829" author="JIRAUSER291175" created="Sat, 18 Jun 2022 04:09:09 +0000"  >&lt;p&gt;Hello&#160;&lt;/p&gt;

&lt;p&gt;I observed kind of similar behavior.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;if I submit a valid utf-8 via stomp that contains an &lt;ins&gt;&lt;b&gt;4-byte unicode code points&lt;/b&gt;&lt;/ins&gt; as decrypted above (example from golang stomp producer) &#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;and I try to consume the message via Java.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;JMS/Java client is unable to decode (bytes) the message, unable to consume the message (java.io.UTFDataFormatException)&#160;in my observation the exception is not&#160;throws, blocking other valid messages.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If I try to consume/clean the message with a python stomp consumer (the messages not get consume)&#160;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Active MQ web console the message show &quot;Error&quot; if try to read the content in that way.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;&lt;b&gt;AmazonMQ 5.16.2&lt;/b&gt;&lt;/ins&gt;&lt;/p&gt;

&lt;p&gt;golang producer (go 1.16 + github.com/go-stomp/stomp/v3 v3.0.1)&#160;&lt;/p&gt;

&lt;p&gt;java consumer (org.apache.activemq 5.17.0)&lt;/p&gt;

&lt;p&gt;python3 consumer (stomp.py 7.0.0)&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17738173" author="simmel" created="Wed, 28 Jun 2023 15:14:39 +0000"  >&lt;p&gt;Any idea when this will be fixed?&lt;/p&gt;</comment>
                            <comment id="17738175" author="jbonofre" created="Wed, 28 Jun 2023 15:25:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=simmel&quot; class=&quot;user-hover&quot; rel=&quot;simmel&quot;&gt;simmel&lt;/a&gt; I was not able to reproduce it. So I still need time to reproduce/investigate. The target is ActiveMQ 5.18.3/5.17.6.&lt;/p&gt;</comment>
                            <comment id="17738181" author="simmel" created="Wed, 28 Jun 2023 15:38:01 +0000"  >&lt;p&gt;Ah, I wish I had time over at work then I&apos;d easily be able to provide an Minimal Reproducible Example = /&lt;/p&gt;</comment>
                            <comment id="17870274" author="azotcsit" created="Thu, 1 Aug 2024 19:21:53 +0000"  >&lt;p&gt;I experience the same problem with Python STOMP producer and TCP consumer.&lt;/p&gt;

&lt;p&gt;Here is how to reproduce the problem:&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;STOMP producer&lt;/ins&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; stomp
c = stomp.Connection(host_and_ports=[(&lt;span class=&quot;code-quote&quot;&gt;&apos;localhost&apos;&lt;/span&gt;, 61613)], auto_content_length=False)
c.connect(username=&lt;span class=&quot;code-quote&quot;&gt;&apos;admin&apos;&lt;/span&gt;, passcode=&lt;span class=&quot;code-quote&quot;&gt;&apos;admin&apos;&lt;/span&gt;, wait=True)
c.send(body=&lt;span class=&quot;code-quote&quot;&gt;&quot;&#128579;&#128578;&quot;&lt;/span&gt;, destination=&lt;span class=&quot;code-quote&quot;&gt;&apos;test&apos;&lt;/span&gt;)
c.disconnect() &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;ins&gt;JMS consumer&lt;/ins&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./bin/activemq consumer --destination queue:&lt;span class=&quot;code-comment&quot;&gt;//test --messageCount 1
&lt;/span&gt;INFO | Connecting to URL: failover:&lt;span class=&quot;code-comment&quot;&gt;//tcp://localhost:61616 as user: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;INFO | Consuming queue:&lt;span class=&quot;code-comment&quot;&gt;//test
&lt;/span&gt;INFO | Sleeping between receives 0 ms
INFO | Running 1 parallel threads
INFO | Successfully connected to tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:61616
&lt;/span&gt;INFO | consumer-1 wait until 1 messages are consumed
javax.jms.JMSException: java.io.UTFDataFormatException
&#8195;&#8195;at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:72)
&#8195;&#8195;at org.apache.activemq.command.ActiveMQTextMessage.decodeContent(ActiveMQTextMessage.java:104)
&#8195;&#8195;at org.apache.activemq.command.ActiveMQTextMessage.getText(ActiveMQTextMessage.java:84)
&#8195;&#8195;at org.apache.activemq.util.ConsumerThread.run(ConsumerThread.java:64)
Caused by: java.io.UTFDataFormatException
&#8195;&#8195;at org.apache.activemq.util.MarshallingSupport.convertUTF8WithBuf(MarshallingSupport.java:389)
&#8195;&#8195;at org.apache.activemq.util.MarshallingSupport.readUTF8(MarshallingSupport.java:358)
&#8195;&#8195;at org.apache.activemq.command.ActiveMQTextMessage.decodeContent(ActiveMQTextMessage.java:101)
&#8195;&#8195;... 2 more
INFO | consumer-1 Consumed: 0 messages
INFO | consumer-1 Consumer thread finished &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Whenever I use STOMP consumer, everything works as expected:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
from stomp &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; *
c = Connection([(&lt;span class=&quot;code-quote&quot;&gt;&apos;localhost&apos;&lt;/span&gt;, 61613)])
c.set_listener(&apos;&apos;, PrintingListener())
c.connect(&lt;span class=&quot;code-quote&quot;&gt;&apos;admin&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;admin&apos;&lt;/span&gt;, wait=True)
c.subscribe(&lt;span class=&quot;code-quote&quot;&gt;&apos;/queue/test&apos;&lt;/span&gt;, 123)
&amp;gt;&amp;gt;&amp;gt; on_message {&lt;span class=&quot;code-quote&quot;&gt;&apos;expires&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;0&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;destination&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;/queue/test&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;subscription&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;123&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;priority&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;4&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;message-id&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;ID:local-60233-1722449795714-3:11:-1:1:1&apos;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&apos;timestamp&apos;&lt;/span&gt;: &lt;span class=&quot;code-quote&quot;&gt;&apos;1722539590063&apos;&lt;/span&gt;} &#128579;&#128578; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Environment details:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;AMQ 5.16.3 (default configuration)&lt;/li&gt;
	&lt;li&gt;Python 3.9.19&lt;/li&gt;
	&lt;li&gt;stomp-py 8.1.2&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;UPDATE:&lt;br/&gt;
I can see the same behavior in AMQ 5.18.5 and 6.1.2 versions.&lt;/p&gt;</comment>
                            <comment id="17877470" author="christopher.l.shannon" created="Wed, 28 Aug 2024 17:01:37 +0000"  >&lt;p&gt;I opened up a PR which should fix this issue: &lt;a href=&quot;https://github.com/apache/activemq/pull/1290&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/1290&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17877509" author="jira-bot" created="Wed, 28 Aug 2024 19:04:07 +0000"  >&lt;p&gt;Commit 3ddf5155973f46b080ad4500000281e06ad8c372 in activemq&apos;s branch refs/heads/main from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=3ddf515597&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=3ddf515597&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8398&quot; title=&quot;4-byte Unicode message from JMS to STOMP will be corrupted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8398&quot;&gt;&lt;del&gt;AMQ-8398&lt;/del&gt;&lt;/a&gt; - Fix Stomp to OpenWire UTF-8 translation&lt;/p&gt;

&lt;p&gt;This commit fixes conversion of messages that are sent or received&lt;br/&gt;
using Stomp when the body contains characters that require 4 bytes&lt;br/&gt;
for encoding using standard UTF-8.&lt;/p&gt;

&lt;p&gt;ActiveMQ and OpenWire currently use a modified UTF-8&lt;br/&gt;
encoding that only uses 3 bytes so the conversion previously was&lt;br/&gt;
breaking because the body was encoded using standard JDK UTF-8 encoding&lt;br/&gt;
and set directly on an ActiveMQText message which was leading to&lt;br/&gt;
decoding errors later when the ActiveMQMessage tried to decode using the&lt;br/&gt;
modified encoder. The reverse was also was true and was breaking&lt;br/&gt;
in some cases.&lt;/p&gt;

&lt;p&gt;The fix now makes sure to correctly decode the Stomp message back to a&lt;br/&gt;
String first and set that on the ActiveMQ message so it can be&lt;br/&gt;
re-encoded correctly. The reverse is fixed as well so both&lt;br/&gt;
conversion from Stomp -&amp;gt; OpenWire and OpenWire -&amp;gt; Stomp work. Tests have&lt;br/&gt;
been added for Stomp -&amp;gt; OpenWire, OpenWire -&amp;gt; Stomp, and Stomp -&amp;gt; Stomp&lt;br/&gt;
which is really Stomp -&amp;gt; OpenWire -&amp;gt; Stomp.&lt;/p&gt;</comment>
                            <comment id="17877510" author="jira-bot" created="Wed, 28 Aug 2024 19:04:08 +0000"  >&lt;p&gt;Commit e1bcbb9f3ec377367d1d72a21bfbff7410e33105 in activemq&apos;s branch refs/heads/main from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=e1bcbb9f3e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=e1bcbb9f3e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #1290 from cshannon/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8398&quot; title=&quot;4-byte Unicode message from JMS to STOMP will be corrupted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8398&quot;&gt;&lt;del&gt;AMQ-8398&lt;/del&gt;&lt;/a&gt;-stomp-fix&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8398&quot; title=&quot;4-byte Unicode message from JMS to STOMP will be corrupted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8398&quot;&gt;&lt;del&gt;AMQ-8398&lt;/del&gt;&lt;/a&gt; - Fix Stomp to OpenWire UTF-8 translation&lt;/p&gt;</comment>
                            <comment id="17877511" author="jira-bot" created="Wed, 28 Aug 2024 19:05:37 +0000"  >&lt;p&gt;Commit 73a8d5ca67bd897d7b4ec05b13a5e7f450a13a4e in activemq&apos;s branch refs/heads/activemq-6.1.x from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=73a8d5ca67&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=73a8d5ca67&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8398&quot; title=&quot;4-byte Unicode message from JMS to STOMP will be corrupted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8398&quot;&gt;&lt;del&gt;AMQ-8398&lt;/del&gt;&lt;/a&gt; - Fix Stomp to OpenWire UTF-8 translation&lt;/p&gt;

&lt;p&gt;This commit fixes conversion of messages that are sent or received&lt;br/&gt;
using Stomp when the body contains characters that require 4 bytes&lt;br/&gt;
for encoding using standard UTF-8.&lt;/p&gt;

&lt;p&gt;ActiveMQ and OpenWire currently use a modified UTF-8&lt;br/&gt;
encoding that only uses 3 bytes so the conversion previously was&lt;br/&gt;
breaking because the body was encoded using standard JDK UTF-8 encoding&lt;br/&gt;
and set directly on an ActiveMQText message which was leading to&lt;br/&gt;
decoding errors later when the ActiveMQMessage tried to decode using the&lt;br/&gt;
modified encoder. The reverse was also was true and was breaking&lt;br/&gt;
in some cases.&lt;/p&gt;

&lt;p&gt;The fix now makes sure to correctly decode the Stomp message back to a&lt;br/&gt;
String first and set that on the ActiveMQ message so it can be&lt;br/&gt;
re-encoded correctly. The reverse is fixed as well so both&lt;br/&gt;
conversion from Stomp -&amp;gt; OpenWire and OpenWire -&amp;gt; Stomp work. Tests have&lt;br/&gt;
been added for Stomp -&amp;gt; OpenWire, OpenWire -&amp;gt; Stomp, and Stomp -&amp;gt; Stomp&lt;br/&gt;
which is really Stomp -&amp;gt; OpenWire -&amp;gt; Stomp.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 3ddf5155973f46b080ad4500000281e06ad8c372)&lt;/p&gt;</comment>
                            <comment id="17877513" author="jira-bot" created="Wed, 28 Aug 2024 19:06:50 +0000"  >&lt;p&gt;Commit 6f2b70d8d51c22fa1c707ee08393a002d564bcf8 in activemq&apos;s branch refs/heads/activemq-5.18.x from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=6f2b70d8d5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=6f2b70d8d5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8398&quot; title=&quot;4-byte Unicode message from JMS to STOMP will be corrupted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8398&quot;&gt;&lt;del&gt;AMQ-8398&lt;/del&gt;&lt;/a&gt; - Fix Stomp to OpenWire UTF-8 translation&lt;/p&gt;

&lt;p&gt;This commit fixes conversion of messages that are sent or received&lt;br/&gt;
using Stomp when the body contains characters that require 4 bytes&lt;br/&gt;
for encoding using standard UTF-8.&lt;/p&gt;

&lt;p&gt;ActiveMQ and OpenWire currently use a modified UTF-8&lt;br/&gt;
encoding that only uses 3 bytes so the conversion previously was&lt;br/&gt;
breaking because the body was encoded using standard JDK UTF-8 encoding&lt;br/&gt;
and set directly on an ActiveMQText message which was leading to&lt;br/&gt;
decoding errors later when the ActiveMQMessage tried to decode using the&lt;br/&gt;
modified encoder. The reverse was also was true and was breaking&lt;br/&gt;
in some cases.&lt;/p&gt;

&lt;p&gt;The fix now makes sure to correctly decode the Stomp message back to a&lt;br/&gt;
String first and set that on the ActiveMQ message so it can be&lt;br/&gt;
re-encoded correctly. The reverse is fixed as well so both&lt;br/&gt;
conversion from Stomp -&amp;gt; OpenWire and OpenWire -&amp;gt; Stomp work. Tests have&lt;br/&gt;
been added for Stomp -&amp;gt; OpenWire, OpenWire -&amp;gt; Stomp, and Stomp -&amp;gt; Stomp&lt;br/&gt;
which is really Stomp -&amp;gt; OpenWire -&amp;gt; Stomp.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 3ddf5155973f46b080ad4500000281e06ad8c372)&lt;br/&gt;
(cherry picked from commit 73a8d5ca67bd897d7b4ec05b13a5e7f450a13a4e)&lt;/p&gt;</comment>
                            <comment id="17878366" author="azotcsit" created="Sat, 31 Aug 2024 16:40:49 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt; !&lt;/p&gt;

&lt;p&gt;I gave a round of testing to the fix in my local. It works fine!&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./bin/activemq consumer --destination queue:&lt;span class=&quot;code-comment&quot;&gt;//test --messageCount 1                                    
&lt;/span&gt;INFO: Loading &lt;span class=&quot;code-quote&quot;&gt;&apos;/Users/alekseizotov/opt/apache-activemq-5.18.5&lt;span class=&quot;code-comment&quot;&gt;//bin/env&apos;&lt;/span&gt;
&lt;/span&gt;INFO: Using java &lt;span class=&quot;code-quote&quot;&gt;&apos;/Users/alekseizotov/opt/jdk/current/Contents/Home/bin/java&apos;&lt;/span&gt;
ACTIVEMQ_HOME: /Users/alekseizotov/opt/apache-activemq-5.18.5
ACTIVEMQ_BASE: /Users/alekseizotov/opt/apache-activemq-5.18.5
ACTIVEMQ_CONF: /Users/alekseizotov/opt/apache-activemq-5.18.5/conf
ACTIVEMQ_DATA: /Users/alekseizotov/opt/apache-activemq-5.18.5/data
 INFO | Connecting to URL: failover:&lt;span class=&quot;code-comment&quot;&gt;//tcp://localhost:61616 as user: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt; INFO | Consuming queue:&lt;span class=&quot;code-comment&quot;&gt;//test
&lt;/span&gt; INFO | Sleeping between receives 0 ms
 INFO | Running 1 parallel threads
 INFO | Successfully connected to tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:61616
&lt;/span&gt; INFO | consumer-1 wait until 1 messages are consumed
 INFO | consumer-1 Received &#128579;&#128578;
 INFO | consumer-1 Consumed: 1 messages
 INFO | consumer-1 Consumer thread finished &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Do you have any idea when we can expect 5.18.6 to be released?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;PS:&lt;/p&gt;

&lt;p&gt;For those who might be interested to see details of the original brainstorming:&#160;&lt;a href=&quot;https://github.com/apache/activemq/pull/1284&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/1284&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17879353" author="jira-bot" created="Wed, 4 Sep 2024 19:35:32 +0000"  >&lt;p&gt;Commit f5fb6c91b2f302459ab13b247630d4869ed8ce75 in activemq&apos;s branch refs/heads/main from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=f5fb6c91b2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=f5fb6c91b2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8398&quot; title=&quot;4-byte Unicode message from JMS to STOMP will be corrupted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8398&quot;&gt;&lt;del&gt;AMQ-8398&lt;/del&gt;&lt;/a&gt; - Fix Stomp to Stomp Unicode UTF-8 test&lt;/p&gt;

&lt;p&gt;The connection receive was out of order and causing failures in some of&lt;br/&gt;
the Stomp tests like StompNIOSSL&lt;/p&gt;</comment>
                            <comment id="17879354" author="jira-bot" created="Wed, 4 Sep 2024 19:41:42 +0000"  >&lt;p&gt;Commit 2e912079807e57567cede0ecdb812976a34dde97 in activemq&apos;s branch refs/heads/activemq-6.1.x from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=2e91207980&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=2e91207980&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8398&quot; title=&quot;4-byte Unicode message from JMS to STOMP will be corrupted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8398&quot;&gt;&lt;del&gt;AMQ-8398&lt;/del&gt;&lt;/a&gt; - Fix Stomp to Stomp Unicode UTF-8 test&lt;/p&gt;

&lt;p&gt;The connection receive was out of order and causing failures in some of&lt;br/&gt;
the Stomp tests like StompNIOSSL&lt;/p&gt;

&lt;p&gt;(cherry picked from commit f5fb6c91b2f302459ab13b247630d4869ed8ce75)&lt;/p&gt;</comment>
                            <comment id="17879355" author="jira-bot" created="Wed, 4 Sep 2024 19:46:51 +0000"  >&lt;p&gt;Commit 82b6d138f64bab8cf59a29fb43dff87a731bcb60 in activemq&apos;s branch refs/heads/activemq-5.18.x from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=82b6d138f6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=82b6d138f6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8398&quot; title=&quot;4-byte Unicode message from JMS to STOMP will be corrupted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8398&quot;&gt;&lt;del&gt;AMQ-8398&lt;/del&gt;&lt;/a&gt; - Fix Stomp to Stomp Unicode UTF-8 test&lt;/p&gt;

&lt;p&gt;The connection receive was out of order and causing failures in some of&lt;br/&gt;
the Stomp tests like StompNIOSSL&lt;/p&gt;

&lt;p&gt;(cherry picked from commit f5fb6c91b2f302459ab13b247630d4869ed8ce75)&lt;/p&gt;</comment>
                            <comment id="17880328" author="jira-bot" created="Mon, 9 Sep 2024 13:07:41 +0000"  >&lt;p&gt;Commit f914001035b2f1ae3984b11ec134f953406d044f in activemq&apos;s branch refs/heads/main from Aleksei Zotov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=f914001035&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=f914001035&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8398&quot; title=&quot;4-byte Unicode message from JMS to STOMP will be corrupted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8398&quot;&gt;&lt;del&gt;AMQ-8398&lt;/del&gt;&lt;/a&gt; - Add missing super.tearDown() call to Stomp NIOSSLLargeMessageTest&lt;/p&gt;</comment>
                            <comment id="17880329" author="jira-bot" created="Mon, 9 Sep 2024 13:07:42 +0000"  >&lt;p&gt;Commit cf8cbead374d54651bb658bb8417963a02ba7150 in activemq&apos;s branch refs/heads/main from JB Onofr&#233;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=cf8cbead37&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=cf8cbead37&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #1292 from azotcsit/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8398&quot; title=&quot;4-byte Unicode message from JMS to STOMP will be corrupted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8398&quot;&gt;&lt;del&gt;AMQ-8398&lt;/del&gt;&lt;/a&gt;-main&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8398&quot; title=&quot;4-byte Unicode message from JMS to STOMP will be corrupted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8398&quot;&gt;&lt;del&gt;AMQ-8398&lt;/del&gt;&lt;/a&gt; - Add missing super.tearDown() call to Stomp NIOSSLLargeMessageTest&lt;/p&gt;</comment>
                            <comment id="17880330" author="jira-bot" created="Mon, 9 Sep 2024 13:08:39 +0000"  >&lt;p&gt;Commit 9a82c6a3058eed54dcceafa6d8de0843cd1db6a0 in activemq&apos;s branch refs/heads/activemq-6.1.x from Aleksei Zotov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=9a82c6a305&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=9a82c6a305&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8398&quot; title=&quot;4-byte Unicode message from JMS to STOMP will be corrupted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8398&quot;&gt;&lt;del&gt;AMQ-8398&lt;/del&gt;&lt;/a&gt; - Add missing super.tearDown() call to Stomp NIOSSLLargeMessageTest&lt;/p&gt;

&lt;p&gt;(cherry picked from commit f914001035b2f1ae3984b11ec134f953406d044f)&lt;/p&gt;</comment>
                            <comment id="17880331" author="jira-bot" created="Mon, 9 Sep 2024 13:08:56 +0000"  >&lt;p&gt;Commit 6d02fb7a88a1fa12a41bf30158d5630070860939 in activemq&apos;s branch refs/heads/activemq-6.0.x from Aleksei Zotov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=6d02fb7a88&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=6d02fb7a88&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8398&quot; title=&quot;4-byte Unicode message from JMS to STOMP will be corrupted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8398&quot;&gt;&lt;del&gt;AMQ-8398&lt;/del&gt;&lt;/a&gt; - Add missing super.tearDown() call to Stomp NIOSSLLargeMessageTest&lt;/p&gt;

&lt;p&gt;(cherry picked from commit f914001035b2f1ae3984b11ec134f953406d044f)&lt;/p&gt;</comment>
                            <comment id="17880332" author="jira-bot" created="Mon, 9 Sep 2024 13:10:00 +0000"  >&lt;p&gt;Commit 692c67a601310667feea76e79bb0a7c6bfcf9e75 in activemq&apos;s branch refs/heads/activemq-5.18.x from Aleksei Zotov&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=692c67a601&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=692c67a601&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8398&quot; title=&quot;4-byte Unicode message from JMS to STOMP will be corrupted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8398&quot;&gt;&lt;del&gt;AMQ-8398&lt;/del&gt;&lt;/a&gt; - Add missing super.tearDown() call to Stomp NIOSSLLargeMessageTest&lt;/p&gt;

&lt;p&gt;(cherry picked from commit f914001035b2f1ae3984b11ec134f953406d044f)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13590356">OPENWIRE-76</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 9 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0vm74:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>