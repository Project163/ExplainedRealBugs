<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:42:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2413] Hangs possible because of Queue.doPageIn</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2413</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I don&apos;t understand the intent of the following code in Queue.doPageIn() and in rev 818147 it was causing delivery to the consumer to get hung (temporarily until message expiration check kickstarts it again). See the commented out lines of code that determine how many messages to attempt to page in. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; List&amp;lt;QueueMessageReference&amp;gt; doPageIn(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; force) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        List&amp;lt;QueueMessageReference&amp;gt; result = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        List&amp;lt;QueueMessageReference&amp;gt; resultList = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt;(dispatchMutex) {
            &lt;span class=&quot;code-comment&quot;&gt;//WHAT IS THIS DOING?
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; toPageIn = getMaxPageSize() + &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(0, (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)destinationStatistics.getInflight().getCount()) -pagedInMessages.size();
&lt;/span&gt;
            &lt;span class=&quot;code-comment&quot;&gt;//DOES THIS MAKE MORE SENSE:
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; toPageIn = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(getMaxPageSize(), messages.size());
            
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isDebugEnabled()) {
                LOG.debug(destination.getPhysicalName() + &lt;span class=&quot;code-quote&quot;&gt;&quot; toPageIn: &quot;&lt;/span&gt;  + toPageIn + &lt;span class=&quot;code-quote&quot;&gt;&quot;, Inflight: &quot;&lt;/span&gt;
                        + destinationStatistics.getInflight().getCount()
                        + &lt;span class=&quot;code-quote&quot;&gt;&quot;, pagedInMessages.size &quot;&lt;/span&gt; + pagedInMessages.size());
            }
            
            &lt;span class=&quot;code-comment&quot;&gt;//WHAT IS THIS DOING?
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;//toPageIn = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(0, &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(toPageIn, getMaxPageSize()));
&lt;/span&gt;                       
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isLazyDispatch()&amp;amp;&amp;amp; !force) {
                &lt;span class=&quot;code-comment&quot;&gt;// Only page in the minimum number of messages which can be dispatched immediately.
&lt;/span&gt;                toPageIn = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.min(getConsumerMessageCountBeforeFull(), toPageIn);
            }
   
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is definitely possible that I&apos;m just not understanding the intent of the code, but whatever it is, it&apos;s not working, and consequently I&apos;m not sure that the subsequent fixes on the branch have eliminated the problem. The attached patch contains both a unit test, that tests several combinations of ack mode, vm cursoring, and delivery mode, as well as version of Queue which should be applied against revirion 818147 &amp;#8211; this version has the fix commented out and preserves the buggy behavior&lt;/p&gt;</description>
                <environment>&lt;p&gt;5.4 branch 818147. Some changes after this hide this error, but I&apos;m still concerned it might be a problem.&lt;/p&gt;</environment>
        <key id="12483007">AMQ-2413</key>
            <summary>Hangs possible because of Queue.doPageIn</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="cmacnaug">Colin MacNaughton</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Sep 2009 01:26:23 +0000</created>
                <updated>Fri, 25 Sep 2009 08:34:17 +0000</updated>
                            <resolved>Fri, 25 Sep 2009 08:34:17 +0000</resolved>
                                    <version>5.4.0</version>
                                    <fixVersion>5.3.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12941378" author="cmacnaug" created="Fri, 25 Sep 2009 01:29:47 +0000"  >&lt;p&gt;Patch with unit test and proposed fix. &lt;/p&gt;</comment>
                            <comment id="12941434" author="rajdavies" created="Fri, 25 Sep 2009 08:34:17 +0000"  >&lt;p&gt;Patch looks good to me - applied in SVN 818762&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461371" name="AMQ-2413patch.txt" size="20431" author="cmacnaug" created="Fri, 25 Sep 2009 01:29:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74954</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s06n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161506</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>