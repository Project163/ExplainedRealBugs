<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:09:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5155] Heartbeat fails in STOMP over WebSockets</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5155</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;From &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4740&quot; title=&quot;heart-beat is disabled when connecting to web socket&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4740&quot;&gt;&lt;del&gt;AMQ-4740&lt;/del&gt;&lt;/a&gt;:&lt;br/&gt;
I receive the following error after establishing a connection and heartbeat through stomp.js. This seems to occur after the &apos;PING&apos; is sent.&lt;br/&gt;
---------- stomp.js output&lt;br/&gt;
&amp;lt;&amp;lt;&amp;lt; CONNECTED&lt;br/&gt;
heart-beat:10000,10000&lt;br/&gt;
session:ID:localhost.localdomain-45596-1396530920609-2:2&lt;br/&gt;
server:ActiveMQ/5.10-SNAPSHOT&lt;br/&gt;
version:1.1&lt;br/&gt;
send PING every 10000ms &lt;br/&gt;
check PONG every 10000ms &lt;br/&gt;
&amp;lt;&amp;lt;&amp;lt; PONG &lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; PING &lt;br/&gt;
did not receive server activity for the last 20005ms &lt;br/&gt;
Whoops! Lost connection to ws://172.16.99.73:61614/stomp&lt;br/&gt;
--------------------- activemq console ---------------&lt;br/&gt;
WARN | Transport Connection to: StompSocket_19548821 failed: java.io.IOException&lt;br/&gt;
Exception in thread &quot;ActiveMQ InactivityMonitor Worker&quot; java.lang.NullPointerException&lt;br/&gt;
at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)&lt;br/&gt;
at org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
at java.lang.Thread.run(Thread.java:722)&lt;br/&gt;
WARN | Transport Connection to: StompSocket_19548821 failed: java.io.IOException&lt;br/&gt;
Exception in thread &quot;ActiveMQ InactivityMonitor Worker&quot; java.lang.NullPointerException&lt;br/&gt;
at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)&lt;br/&gt;
at org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)&lt;br/&gt;
at java.lang.Thread.run(Thread.java:722)&lt;/p&gt;

&lt;p&gt;For me it looks as if the StompInactivityMonitor is delivering its events to the wrong Transport, i.e. it needs a &quot;narrow()&quot; when setting it up.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12709955">AMQ-5155</key>
            <summary>Heartbeat fails in STOMP over WebSockets</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="bergamot">Arjan van den Berg</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Apr 2014 07:16:20 +0000</created>
                <updated>Mon, 11 May 2015 23:37:47 +0000</updated>
                            <resolved>Tue, 28 Apr 2015 22:11:45 +0000</resolved>
                                    <version>5.9.1</version>
                    <version>5.10.0</version>
                                    <fixVersion>5.12.0</fixVersion>
                                        <due></due>
                            <votes>12</votes>
                                    <watches>22</watches>
                                                                                                                <comments>
                            <comment id="14027280" author="chadkelly" created="Wed, 11 Jun 2014 00:53:36 +0000"  >&lt;p&gt;Someone please help resolve this ticket. The bug described above is still present in 5.9.1. I tried both cases, heartbeat set to 0,0 and 10000,10000. Slightly different buggy behaviors, but it still does not work. Please:&lt;br/&gt;
1) download 5.9.1&lt;br/&gt;
2) bin/activemq console xbean:examples/conf/activemq-demo.xml&lt;br/&gt;
3) open two browsers (firefox/chrome) to &lt;a href=&quot;http://localhost:8161/demo/websocket/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8161/demo/websocket/index.html&lt;/a&gt;&lt;br/&gt;
4) type a few messages over a 5 minute period&lt;/p&gt;

&lt;p&gt;WARN | Transport Connection to: StompSocket_1998606381 failed: java.io.IOException&lt;br/&gt;
WARN | Transport Connection to: StompSocket_178709817 failed: java.io.IOException&lt;br/&gt;
Exception in thread &quot;ActiveMQ InactivityMonitor Worker&quot; java.lang.NullPointerException&lt;br/&gt;
at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)&lt;br/&gt;
at org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
at java.lang.Thread.run(Thread.java:745)&lt;br/&gt;
Exception in thread &quot;ActiveMQ InactivityMonitor Worker&quot; java.lang.NullPointerException&lt;br/&gt;
at org.apache.activemq.transport.AbstractInactivityMonitor.onException(AbstractInactivityMonitor.java:314)&lt;br/&gt;
at org.apache.activemq.transport.AbstractInactivityMonitor$4.run(AbstractInactivityMonitor.java:215)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)&lt;br/&gt;
at java.lang.Thread.run(Thread.java:745)&lt;/p&gt;</comment>
                            <comment id="14027304" author="tabish121" created="Wed, 11 Jun 2014 01:19:00 +0000"  >&lt;p&gt;Why not try and create a unit test and submit a patch that fixes it?&lt;/p&gt;</comment>
                            <comment id="14262395" author="tcharl" created="Wed, 31 Dec 2014 19:56:09 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
Can we pull up the Priority, as it is a real blocker for websocket users? I really hope that it will be corrected in 5.10.1: our enterprise stack is stuck with 5.8 because of it.&lt;br/&gt;
@Timothy, I&apos;m sorry, I tried but the AMQ internals are not so easy to understand, I&apos;m sure that it&apos;ll not be so difficult for an expert like you, but it&apos;s really red hairing for noobs like me...&lt;/p&gt;

&lt;p&gt;Regards,&lt;/p&gt;</comment>
                            <comment id="14264112" author="zhaiyun" created="Mon, 5 Jan 2015 00:31:21 +0000"  >&lt;p&gt;Can we pull up the Priority&lt;br/&gt;
-&amp;gt; we all think so.&lt;/p&gt;</comment>
                            <comment id="14348653" author="gigaclood" created="Thu, 5 Mar 2015 11:49:11 +0000"  >&lt;p&gt;Hi, &lt;br/&gt;
I have created a patch for activemq 5.9.1 version that seems to work.&lt;/p&gt;

&lt;p&gt;These are my changes for org.apache.activemq.transport.ws.StompSocket:&lt;/p&gt;

&lt;p&gt;1. in doStart() I set transportListener to remove NPE:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Override
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void doStart() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        socketTransportStarted.countDown();
		stompInactivityMonitor.setTransportListener(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getTransportListener());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2. in onMessage(String data) I managed keepalive frame:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!transportStartedAtLeastOnce()) {
            LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; StompSocket to be properly started...&quot;&lt;/span&gt;);
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                socketTransportStarted.await();
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
                LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;While waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; StompSocket to be properly started, we got interrupted!! Should be okay, but you could see race conditions...&quot;&lt;/span&gt;);
            }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
	      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (data!=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; data.equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;\n&quot;&lt;/span&gt;))
		{
		    sendToActiveMQ(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KeepAliveInfo());
		}
	      &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
		   protocolConverter.onStompCommand((StompFrame)wireFormat.unmarshal(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteSequence(data.getBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;UTF-8&quot;&lt;/span&gt;))));
		}
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            onException(IOExceptionSupport.create(e));
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can I share with you my code in a better way?&lt;br/&gt;
Thanks&lt;br/&gt;
Claudio Parodi&lt;/p&gt;</comment>
                            <comment id="14352888" author="sebsjo" created="Mon, 9 Mar 2015 12:34:10 +0000"  >&lt;p&gt;Hi Claudio,&lt;/p&gt;

&lt;p&gt;I tried your code with ActiveMQ 5.11.1 and it seems to work fine now, at least with the stomp.js example chat test.&lt;br/&gt;
Made some diffs for the 5.11.1 version that I&apos;ll attach to this ticket.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14379347" author="amonaco" created="Wed, 25 Mar 2015 05:53:53 +0000"  >&lt;p&gt;I&apos;ve tried every version &amp;gt;= 5.9.1 to 5.12-SNAPSHOT and I can reproduce the reported issue. I guess for now some people will have to stick to 5.8 for production. This is a bug that affects everyone using Websockets and it&apos;s been open for almost a year :|&lt;/p&gt;</comment>
                            <comment id="14389365" author="tabish121" created="Tue, 31 Mar 2015 20:42:22 +0000"  >&lt;p&gt;Applied a slightly tweaked version of the patch, thanks for looking into it.  &lt;/p&gt;</comment>
                            <comment id="14392271" author="peter.pfort" created="Thu, 2 Apr 2015 07:13:03 +0000"  >&lt;p&gt;Hi Timothy,&lt;br/&gt;
your change in version 5.12 isn&apos;t complete. You forget the &quot;else&quot; before the &quot;onStompCommand ...&quot;, like in the snippet from Claudio.&lt;/p&gt;

&lt;p&gt;The &quot;(StompFrame)wireFormat.unmarshal&quot; throw an EOFException, because the KeepAlive command isn&apos;t handled in it. Then the session is marked as failed.&lt;/p&gt;

&lt;p&gt;Please complete the code.&lt;/p&gt;

&lt;p&gt;Peter&lt;/p&gt;</comment>
                            <comment id="14392674" author="tabish121" created="Thu, 2 Apr 2015 13:11:07 +0000"  >&lt;p&gt;Added a fix, let me know if it works for you.&lt;/p&gt;</comment>
                            <comment id="14482775" author="peter.pfort" created="Tue, 7 Apr 2015 08:04:21 +0000"  >&lt;p&gt;It&apos;s works now.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="14487669" author="chadkelly" created="Thu, 9 Apr 2015 17:05:32 +0000"  >&lt;p&gt;Even though the above bug was fixed, a related bug now occurs. This may deserve a new ticket? Can someone confirm the following:&lt;br/&gt;
1) Download a recent 5.12 SNOPSHOT that works and contains the patch above. I used &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/5.12-SNAPSHOT/apache-activemq-5.12-20150407.222248-96-bin.tar.gz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/5.12-SNAPSHOT/apache-activemq-5.12-20150407.222248-96-bin.tar.gz&lt;/a&gt;&lt;br/&gt;
2) bin/activemq console xbean:examples/conf/activemq-demo.xml&lt;br/&gt;
3) open two browsers (firefox/chrome) to &lt;a href=&quot;http://localhost:8161/demo/websocket/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8161/demo/websocket/index.html&lt;/a&gt;&lt;br/&gt;
4) In a single browser window, type 1, 2, 3, ... 9 with a return/enter after each number &lt;br/&gt;
5) Half of the chat ends up in one browser, and half in the other. &lt;/p&gt;

&lt;p&gt;This bug causes the receiving browser to only get 1/2 the chats. Could this bug relate to the new added code that uses &quot;/n&quot;?&lt;/p&gt;

&lt;p&gt;Can someone confirm this?&lt;/p&gt;</comment>
                            <comment id="14487682" author="tabish121" created="Thu, 9 Apr 2015 17:14:03 +0000"  >&lt;p&gt;This is not a bug, the default address  string in that example is: /queue/test which means that the messages are load balanced across connections, try it with /topic/test and it should work as expected. &lt;/p&gt;</comment>
                            <comment id="14487704" author="chadkelly" created="Thu, 9 Apr 2015 17:28:26 +0000"  >&lt;p&gt;You are correct, using /topic/test works as expected. I performed various tests and no issues to report.&lt;br/&gt;
Thank you very much for solving this bug. This is the one feature I needed in order to use ActiveMQ. I appreciate everyone&apos;s contribution in resolving this problem and look forward to the release of 5.12. &lt;/p&gt;</comment>
                            <comment id="14487732" author="tabish121" created="Thu, 9 Apr 2015 17:40:09 +0000"  >&lt;p&gt;Keep testing it and report back if you find any other gremlins.  &lt;/p&gt;</comment>
                            <comment id="14501051" author="chadkelly" created="Sat, 18 Apr 2015 03:01:00 +0000"  >&lt;p&gt;REVISION&lt;br/&gt;
Can someone confirm this bug occurs in their environment? If so, this bug relates to &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5155&quot; title=&quot;Heartbeat fails in STOMP over WebSockets&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5155&quot;&gt;&lt;del&gt;AMQ-5155&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4674&quot; title=&quot;ActiveMQ 5.x does not support the notion of a grace-period for heart beats as supported by the STOMP protocol&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4674&quot;&gt;&lt;del&gt;AMQ-4674&lt;/del&gt;&lt;/a&gt;. I recommend that the ActiveMQ WebSocket example should work as is, regardless of using parameters like transport.hbGracePeriodMultiplier. Using Fedora/Firefox would cause the bug 50% of the times after 50-500 PINGs, but NO bug to report in Fedora/Chrome because of timing conditions.&lt;/p&gt;

&lt;p&gt;The bug manifests itself in &quot;/activemq-client/src/main/java/org/apache/activemq/transport/AbstractInactivityMonitor.java&quot; when the timing of onCommand() (generated by the web browser PING or message) crosses over the timing of readCheck(). In other words, the 10 second timing of onCommand() via web browser&apos;s PING occurs before  the 10 second thread timing of readCheck(), but with a small time drift, the timing of readCheck() starts to occur before onCommand(). At this exact cross over point,  readCheck() will occur twice, and this will cause the bug. In the log below, the timing sequence is:&lt;br/&gt;
17:05:21,162 | DEBUG | onCommand()&lt;br/&gt;
17:05:21,162 | DEBUG | readCheck()&lt;br/&gt;
17:05:31,162 | DEBUG | readCheck()&lt;br/&gt;
17:05:31,164 | DEBUG | onCommand()&lt;/p&gt;

&lt;p&gt;Opening Web Socket...&lt;br/&gt;
Web Socket Opened...&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; CONNECT&lt;br/&gt;
accept-version:1.1,1.0&lt;br/&gt;
heart-beat:10000,10000&lt;br/&gt;
login:guesttgg&lt;br/&gt;
passcode:guest&lt;/p&gt;

&lt;p&gt;&amp;lt;&amp;lt;&amp;lt; CONNECTED&lt;br/&gt;
server:ActiveMQ/5.12-SNAPSHOT&lt;br/&gt;
heart-beat:10000,10000&lt;br/&gt;
session:ID:c1-39862-1429234022608-4:2&lt;br/&gt;
version:1.1&lt;/p&gt;

&lt;p&gt;connected to server ActiveMQ/5.12-SNAPSHOT&lt;br/&gt;
send PING every 10000ms&lt;br/&gt;
check PONG every 10000ms&lt;br/&gt;
connected to Stomp&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; SUBSCRIBE&lt;br/&gt;
id:sub-0&lt;br/&gt;
destination:/queue/test (same behavor for /topic/test)&lt;/p&gt;

&lt;p&gt;&amp;lt;&amp;lt;&amp;lt; PONG&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; PING&lt;br/&gt;
... 395 times this case, but 50-500 times in general&lt;br/&gt;
&amp;lt;&amp;lt;&amp;lt; PONG&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; PING&lt;br/&gt;
&amp;lt;&amp;lt;&amp;lt; PONG&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; PING&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; PING&lt;br/&gt;
&amp;gt;&amp;gt;&amp;gt; PING&lt;br/&gt;
did not receive server activity for the last 20003ms&lt;br/&gt;
Whoops! Lost connection to ws://localhost:61614/stomp&lt;/p&gt;


&lt;p&gt;INFO version of data/activemq.log&lt;br/&gt;
2015-04-17 15:49:12,750 | WARN  | Transport Connection to: StompSocket_919027643 failed: org.apache.activemq.transport.InactivityIOException: Channel was inactive for too (&amp;gt;10000) long: StompSocket_919027643 | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ InactivityMonitor Worker&lt;/p&gt;

&lt;p&gt;DEBUG with special coding version of data/activemq.log&lt;br/&gt;
2015-04-19 17:05:21,162 | DEBUG | onCommand() | org.apache.activemq.transport.AbstractInactivityMonitor | qtp1493158871-33&lt;br/&gt;
2015-04-19 17:05:21,162 | DEBUG | 10000ms elapsed since last read check. | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor ReadCheckTimer&lt;br/&gt;
2015-04-19 17:05:21,162 | DEBUG | readCheck() | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor ReadCheckTimer&lt;br/&gt;
2015-04-19 17:05:31,161 | DEBUG | WriteChecker: 10000ms elapsed since last write check. | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor WriteCheckTimer&lt;br/&gt;
2015-04-19 17:05:31,161 | DEBUG | Running WriteCheck&lt;span class=&quot;error&quot;&gt;&amp;#91;StompSocket_1693369093&amp;#93;&lt;/span&gt; | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor Worker&lt;br/&gt;
2015-04-19 17:05:31,162 | DEBUG | 10000ms elapsed since last read check. | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor ReadCheckTimer&lt;br/&gt;
2015-04-19 17:05:31,162 | DEBUG | readCheck() | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor ReadCheckTimer&lt;br/&gt;
2015-04-19 17:05:31,163 | DEBUG | No message received since last read check for org.apache.activemq.transport.ws.jetty8.StompSocket@64eec305. Throwing InactivityIOException. | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor ReadCheckTimer&lt;br/&gt;
2015-04-19 17:05:31,164 | DEBUG | Running ReadCheck&lt;span class=&quot;error&quot;&gt;&amp;#91;StompSocket_1693369093&amp;#93;&lt;/span&gt; | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor Worker&lt;br/&gt;
2015-04-19 17:05:31,164 | DEBUG | onCommand() | org.apache.activemq.transport.AbstractInactivityMonitor | qtp1493158871-30&lt;/p&gt;</comment>
                            <comment id="14504231" author="chadkelly" created="Tue, 21 Apr 2015 03:33:39 +0000"  >&lt;p&gt;/activemq-client/src/main/java/org/apache/activemq/transport/AbstractInactivityMonitor.java&lt;/p&gt;</comment>
                            <comment id="14504267" author="chadkelly" created="Tue, 21 Apr 2015 03:56:05 +0000"  >&lt;p&gt;Hi Timothy,&lt;br/&gt;
The included patch will give the read check thread a 2nd chance (via 1 second) before exception and termination. It also designs the read check thread and write check thread to be nearly identical. I will implement other approaches should this one NOT be satisfactory. The attached patchfile.txt is for &#8220;/activemq-client/src/main/java/org/apache/activemq/transport/AbstractInactivityMonitor.java&#8221;.&lt;/p&gt;

&lt;p&gt;I believe there is a fundamental design problem with AMQ heartbeats, because the timing of web browsers heartbeats has a cadence equal to the timing for AMQ to check heartbeats. Eventually, due to very small changes in time, the web browser heartbeat can eventually cross over AMQ checks for heartbeats. In the included example, the web browser client is sending at the rate of 10 seconds, and AMQ server is also checking at the rate of 10 seconds. Longer term testing, with a variety of websocket enabled browsers, show that the heartbeats can cross over. &lt;/p&gt;</comment>
                            <comment id="14506059" author="chadkelly" created="Tue, 21 Apr 2015 23:59:33 +0000"  >&lt;p&gt;Please retest 5.12-SNAPSHOT in your environment using Firefox. I want to confirm that the problem still persists in other environments under more extensive testing. Patch included above (patchfile.txt) has not failed in 5.12-SNAPSHOT for 32+ hours of testing. The websocket chat example using the current SNAPHOT will fail for me in Fedora 21/Firefox.&lt;/p&gt;

&lt;p&gt;1) download the latest 5.12-SNAPSHOT at &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/5.12-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/5.12-SNAPSHOT/&lt;/a&gt;&lt;br/&gt;
2) bin/activemq start xbean:examples/conf/activemq-demo.xml&lt;br/&gt;
3) open three instances of Firefox (because it has greater time variation) to &lt;a href=&quot;http://localhost:8161/demo/websocket/index.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:8161/demo/websocket/index.html&lt;/a&gt; and view for 20 minutes.&lt;/p&gt;</comment>
                            <comment id="14517699" author="tabish121" created="Tue, 28 Apr 2015 19:12:43 +0000"  >&lt;p&gt;Will look into reported disconnects when heartbeats are flowing.  &lt;/p&gt;</comment>
                            <comment id="14518103" author="tabish121" created="Tue, 28 Apr 2015 21:25:50 +0000"  >&lt;p&gt;The main problem here is that the StompSocket is not providing a valid received counter value for the inactivity monitor to track continuing read progress, and a few other nits that needs fixing.  I also looks like there might be a memory leak in play also but I&apos;m still investigating that.&lt;/p&gt;</comment>
                            <comment id="14518204" author="tabish121" created="Tue, 28 Apr 2015 22:11:45 +0000"  >&lt;p&gt;Added fix that ensures the inactivity monitor can properly determine heartbeat and normal STOMP traffic when performing read checks. &lt;/p&gt;</comment>
                            <comment id="14519926" author="chadkelly" created="Wed, 29 Apr 2015 18:47:33 +0000"  >&lt;p&gt;Timothy, I will test out your patch on May 9-11 and report back. Thank you very much for your contribution.&lt;/p&gt;</comment>
                            <comment id="14535378" author="chris.hinshaw" created="Fri, 8 May 2015 19:52:53 +0000"  >&lt;p&gt;Verified that the issue appears to be resolved with the 5.12 snapshot from May 8th. Thanks you very very much.&lt;/p&gt;</comment>
                            <comment id="14535383" author="peter.pfort" created="Fri, 8 May 2015 19:53:40 +0000"  >&lt;p&gt;Guten Tag, vielen Dank f&#252;r Ihre Nachricht! Ich bin vom 01.05.2015 bis zum 25.05.2015 nicht im B&#252;ro. Ihre Emails werden in dieser Zeit weder gelesen noch weitergeleitet. In dringenden F&#228;llen wenden Sie sich bitte an den alfa Support (+49 (0) 6074 / 3104 - 333). Nach meiner R&#252;ckkehr werde ich Ihre Nachricht umgehend beantworten. Mit freundlichen Gr&#252;&#223;en Best regards Peter Pfort&lt;/p&gt;</comment>
                            <comment id="14538857" author="chadkelly" created="Mon, 11 May 2015 23:21:00 +0000"  >&lt;p&gt;Timothy, I performed various tests and no issues to report. 30+ hours of testing with 6 concurrent web browser connections  using Firefox/Chrome.&lt;/p&gt;</comment>
                            <comment id="14538885" author="tabish121" created="Mon, 11 May 2015 23:37:47 +0000"  >&lt;p&gt;Great, thanks for reporting back.  &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12670485">AMQ-4740</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12670485">AMQ-4740</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12703417" name="AMQ-5155-jetty8.diff" size="1765" author="sebsjo" created="Mon, 9 Mar 2015 12:34:21 +0000"/>
                            <attachment id="12703418" name="AMQ-5155-jetty9.diff" size="1750" author="sebsjo" created="Mon, 9 Mar 2015 12:34:21 +0000"/>
                            <attachment id="12726334" name="firefox_bug_example1.pcapng" size="13008" author="chadkelly" created="Sat, 18 Apr 2015 02:58:43 +0000"/>
                            <attachment id="12726768" name="patchfile.txt" size="4422" author="chadkelly" created="Tue, 21 Apr 2015 03:33:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>388277</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 28 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1uvv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>388532</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>