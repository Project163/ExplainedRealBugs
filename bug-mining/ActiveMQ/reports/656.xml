<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:42:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2283] New Multicast discovery agent thread is created for each message</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2283</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I found out that a new thread is started for each message I send, but that thread is staying alive for the whole program lifetime.&lt;br/&gt;
The number of live &quot;multicast discovery agent notifier&quot; threads scales up linearly.&lt;br/&gt;
Eventually I ended up with 10000 threads of the above type running&lt;br/&gt;
It doesn&apos;t seems to be a camel issue since when I try with tcp://localhost:61616 everything works fine.&lt;br/&gt;
I&apos;m suspecting a bug. and I wanted to share it with you before I open a ticket.&lt;br/&gt;
Eric&lt;/p&gt;

&lt;p&gt;=============&lt;br/&gt;
package com.mycompany.CamelExample;&lt;br/&gt;
import javax.jms.ConnectionFactory;&lt;br/&gt;
import org.apache.activemq.ActiveMQConnectionFactory;&lt;br/&gt;
import org.apache.camel.CamelContext;&lt;br/&gt;
import org.apache.camel.ProducerTemplate;&lt;br/&gt;
import org.apache.camel.builder.RouteBuilder;&lt;br/&gt;
import org.apache.camel.component.jms.JmsComponent;&lt;br/&gt;
import org.apache.camel.impl.DefaultCamelContext;&lt;br/&gt;
import org.apache.log4j.Logger;&lt;br/&gt;
public final class App {&lt;br/&gt;
   private static Logger log = Logger.getLogger(&quot;CamelTestApp&quot;);&lt;br/&gt;
   public static void main(String args[]) throws Exception {&lt;br/&gt;
        CamelContext context = new DefaultCamelContext();&lt;br/&gt;
        ConnectionFactory connectionFactory =&lt;br/&gt;
                    new ActiveMQConnectionFactory(&quot;failover:(discovery:(multicast://224.1.2.3:6255?group=default),tcp://localhost:61616)&quot;);&lt;br/&gt;
        final String JMSTOPID = &quot;test-jms&quot;;&lt;br/&gt;
        final String DEST_TOPIC = &quot;test-jms:topic:TCommandRequest&quot;;&lt;br/&gt;
        final String SRC_TOPIC = &quot;test-jms:topic:TCommandRequest&quot;;&lt;br/&gt;
        context.addComponent(&quot;test-jms&quot;, JmsComponent.jmsComponentAutoAcknowledge(connectionFactory));&lt;br/&gt;
        context.addRoutes(new RouteBuilder() {&lt;br/&gt;
            public void configure() {from(SRC_TOPIC).to(&quot;mock:test&quot;);}});&lt;br/&gt;
        ProducerTemplate template = context.createProducerTemplate();&lt;br/&gt;
        context.start();&lt;br/&gt;
           while (true) &lt;/p&gt;
{
                template.sendBody(DEST_TOPIC, &quot;TEST_TEXT&quot;);
               Thread.sleep(5000);
            }
&lt;p&gt;    }&lt;br/&gt;
}&lt;br/&gt;
======================&lt;br/&gt;
My log shows:&lt;/p&gt;

&lt;p&gt;12:02:06,212  INFO DefaultCamelContext:729 - Apache Camel 2.0-M1 (CamelContext:camel-1) is starting&lt;br/&gt;
12:02:06,582  WARN ObjectHelper:523 - Cannot find class: org.apache.xalan.xsltc.trax.DOM2SAX&lt;br/&gt;
12:02:07,137  INFO DiscoveryTransport:73 - Adding new broker connection URL: tcp://192.168.0.1:61616&lt;br/&gt;
12:02:07,220  INFO FailoverTransport:714 - Successfully connected to tcp://192.168.0.1:61616&lt;br/&gt;
12:02:07,222  INFO FailoverTransport:714 - Successfully connected to discovery:(multicast://224.1.2.3:6255?group=default)&lt;br/&gt;
12:02:07,247  INFO DefaultCamelContext:771 - Apache Camel 2.0-M1 (CamelContext:camel-1) started&lt;br/&gt;
12:02:07,640  INFO DiscoveryTransport:73 - Adding new broker connection URL: tcp://192.168.0.1:61616&lt;br/&gt;
12:02:07,715  INFO FailoverTransport:714 - Successfully connected to tcp://192.168.0.1:61616&lt;br/&gt;
12:02:07,716  INFO FailoverTransport:714 - Successfully connected to discovery:(multicast://224.1.2.3:6255?group=default)&lt;br/&gt;
12:02:13,181  INFO DiscoveryTransport:73 - Adding new broker connection URL: tcp://192.168.64.1:61616&lt;br/&gt;
12:02:13,220  INFO FailoverTransport:714 - Successfully connected to tcp://192.168.0.1:61616&lt;br/&gt;
12:02:13,222  INFO FailoverTransport:714 - Successfully connected to discovery:(multicast://224.1.2.3:6255?group=default)&lt;br/&gt;
12:02:18,731  INFO DiscoveryTransport:73 - Adding new broker connection URL: tcp://192.168.0.1:61616&lt;br/&gt;
12:02:18,961  INFO FailoverTransport:714 - Successfully connected to tcp://192.168.0.1:61616&lt;br/&gt;
12:02:18,963  INFO FailoverTransport:714 - Successfully connected to discovery:(multicast://224.1.2.3:6255?group=default)&lt;br/&gt;
.&lt;br/&gt;
.&lt;br/&gt;
. &lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux, jdk6u13, jdk6u14&lt;/p&gt;</environment>
        <key id="12482601">AMQ-2283</key>
            <summary>New Multicast discovery agent thread is created for each message</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="ericbouer">Eric Bouer</reporter>
                        <labels>
                    </labels>
                <created>Sun, 7 Jun 2009 12:59:41 +0000</created>
                <updated>Wed, 8 Jul 2009 13:01:10 +0000</updated>
                            <resolved>Wed, 8 Jul 2009 13:01:10 +0000</resolved>
                                    <version>5.2.0</version>
                                    <fixVersion>5.3.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12941472" author="ee7arh" created="Fri, 12 Jun 2009 11:12:07 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I have exactly the same problem and it eventually  leads to my application running out of memory. I have had to disable multicast now for stability reasons but would like to use it again so hopefully this can be fixed.&lt;/p&gt;

&lt;p&gt;  &amp;lt;!-- configure the Camel JMS consumer to use the ActiveMQ broker declared above --&amp;gt;&lt;br/&gt;
    &amp;lt;bean id=&quot;jmsExternal&quot; class=&quot;org.apache.camel.component.jms.JmsComponent&quot;&amp;gt;&lt;br/&gt;
        &amp;lt;property name=&quot;connectionFactory&quot;&amp;gt;&lt;br/&gt;
            &amp;lt;bean class=&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;!-- use multicast to detect other broker - group=groupName of network to look for --&amp;gt;&lt;br/&gt;
                &amp;lt;property name=&quot;brokerURL&quot; value=&quot;discovery:(multicast://default?group=testbroker)?initialReconnectDelay=100&quot;/&amp;gt;&lt;br/&gt;
            &amp;lt;/bean&amp;gt;&lt;br/&gt;
        &amp;lt;/property&amp;gt;&lt;br/&gt;
    &amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;To send a message to the external queue &quot;jmsExternal&quot; I call the method in POJO object:&lt;/p&gt;

&lt;p&gt;camelTemplate.sendBody(x,y);&lt;/p&gt;

&lt;p&gt;I am using activeMQ 5.2.0 but the brokers which are being discovered are using the FUSE 5.3 version.&lt;/p&gt;

&lt;p&gt;If select one of the thousands of Multicast threads displayed in Jconsole, they all have the same stack trace as this:&lt;/p&gt;

&lt;p&gt;Name: Multicast Discovery Agent Notifier&lt;br/&gt;
State: WAITING on java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject@1ce7f98&lt;br/&gt;
Total blocked: 0  Total waited: 1&lt;/p&gt;

&lt;p&gt;Stack trace:&lt;br/&gt;
sun.misc.Unsafe.park(Native Method)&lt;br/&gt;
java.util.concurrent.locks.LockSupport.park(LockSupport.java:158)&lt;br/&gt;
java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:1925)&lt;br/&gt;
java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:358)&lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor.getTask(ThreadPoolExecutor.java:947)&lt;br/&gt;
java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)&lt;br/&gt;
java.lang.Thread.run(Thread.java:619) &lt;/p&gt;

&lt;p&gt;BRegards&lt;br/&gt;
Andrew&lt;/p&gt;</comment>
                            <comment id="12941704" author="gtully" created="Wed, 8 Jul 2009 13:01:10 +0000"  >&lt;p&gt;fixed in r792127&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74997</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 20 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s213:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161805</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>