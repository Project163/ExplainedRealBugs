<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:36:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1659] SSL Transport configured in wantClientAuth mode never asks for the client certificate during the SSL Handshake</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1659</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;See: &lt;a href=&quot;http://java.sun.com/javase/6/docs/api/javax/net/ssl/SSLServerSocket.html#setWantClientAuth(boolean&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://java.sun.com/javase/6/docs/api/javax/net/ssl/SSLServerSocket.html#setWantClientAuth(boolean&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;&quot;&lt;br/&gt;
A socket&apos;s client authentication setting is one of the following:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;client authentication required&lt;/li&gt;
	&lt;li&gt;client authentication requested&lt;/li&gt;
	&lt;li&gt;no client authentication desired&lt;br/&gt;
&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;In the API it indicates that if you call either setWantClientAuth, or setNeedClientAuth it will override the call to the other.&lt;/p&gt;

&lt;p&gt;Therefor I believe the following code only allows for ActiveMQ to be in two states:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Client Authentication Required (needClientAuth==true)&lt;/li&gt;
	&lt;li&gt;No client Authentication Desired (needClientAuth==false)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;activemq-core/src/main/java/org/apache/activemq/transport/tcp/SslTransportServer.java&lt;/p&gt;


&lt;p&gt;As setWantClientAuth is overridden by setNeedClientAuth.&lt;br/&gt;
public void bind() throws IOException {&lt;br/&gt;
  super.bind();&lt;br/&gt;
  ((SSLServerSocket)this.serverSocket).setWantClientAuth(wantClientAuth);&lt;br/&gt;
  ((SSLServerSocket)this.serverSocket).setNeedClientAuth(needClientAuth);&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;I believe this the same issue as this Jetty issue: &lt;a href=&quot;http://jira.codehaus.org/browse/JETTY-86&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://jira.codehaus.org/browse/JETTY-86&lt;/a&gt;&lt;/p&gt;</description>
                <environment>&lt;p&gt;I think this is for all environments, it may be JDK dependent though.&lt;/p&gt;

&lt;p&gt;I tested on:&lt;br/&gt;
Linux  2.6.20-gentoo-r7&lt;br/&gt;
java version &quot;1.6.0&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.6.0-b105)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 1.6.0-b105, mixed mode)&lt;/p&gt;</environment>
        <key id="12482453">AMQ-1659</key>
            <summary>SSL Transport configured in wantClientAuth mode never asks for the client certificate during the SSL Handshake</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="djencks">David Jencks</assignee>
                                    <reporter username="ericdwhite">Eric White</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Apr 2008 09:15:11 +0000</created>
                <updated>Fri, 11 Apr 2008 08:21:43 +0000</updated>
                            <resolved>Thu, 10 Apr 2008 19:42:24 +0000</resolved>
                                    <version>4.1.1</version>
                    <version>5.0.0</version>
                                    <fixVersion>4.1.2</fixVersion>
                    <fixVersion>5.1.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="172800">48h</timeoriginalestimate>
                            <timeestimate seconds="172800">48h</timeestimate>
                                        <comments>
                            <comment id="12939541" author="ericdwhite" created="Thu, 10 Apr 2008 12:36:02 +0000"  >&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 
activemq-core/src/main/java/org/apache/activemq/transport/tcp/SslTransportServer.java
public void bind() throws IOException { 
    super.bind();
    ((SSLServerSocket)this.serverSocket).setWantClientAuth(wantClientAuth);
    ((SSLServerSocket)this.serverSocket).setNeedClientAuth(needClientAuth); &amp;lt;--- This overrides setWantClientAuth
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="12939512" author="ericdwhite" created="Thu, 10 Apr 2008 12:45:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/activemq/secure/attachment/16326/amq-411-complex-version.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/activemq/secure/attachment/16326/amq-411-complex-version.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This file is for ActiveMQ 4.1.1&lt;/p&gt;

&lt;p&gt;I have tested this file locally and it works for me.  &lt;/p&gt;

&lt;p&gt;In this version Boolean properties are used instead of just boolean. This makes it possible to distinguish between true, false, and null.  Corresponding to the underlying properties being set to true, false or not set at all.&lt;/p&gt;</comment>
                            <comment id="12939523" author="ericdwhite" created="Thu, 10 Apr 2008 12:47:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/activemq/secure/attachment/16327/amq-411-simple-version.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/activemq/secure/attachment/16327/amq-411-simple-version.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This file is for ActiveMQ 4.1.1&lt;/p&gt;

&lt;p&gt;I have tested this file locally and it works for me.  &lt;/p&gt;

&lt;p&gt;In this version only boolean properties are used.  This make it impossible to know if the property was set on the Transport URL or not.&lt;/p&gt;

&lt;p&gt;My personal belief is the complex version is better, but I supplied both as I&apos;m unsure how the maintainers would like to see the issue resolved.&lt;/p&gt;</comment>
                            <comment id="12939552" author="ericdwhite" created="Thu, 10 Apr 2008 12:48:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/activemq/secure/attachment/16328/amq-500-complex-version.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/activemq/secure/attachment/16328/amq-500-complex-version.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This file is for ActiveMQ 5.0.0&lt;/p&gt;

&lt;p&gt;I have NOT TESTED this on ActiveMQ 5, but the looking at the source code, I think the issue is there.  This patch does compile.&lt;/p&gt;

&lt;p&gt;In this version Boolean properties are used instead of just boolean. This makes it possible to distinguish between true, false, and null.  Corresponding to the underlying properties being set to true, false or not set at all.&lt;/p&gt;</comment>
                            <comment id="12939508" author="ericdwhite" created="Thu, 10 Apr 2008 12:49:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/activemq/secure/attachment/16329/amq-500-simple-version.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/activemq/secure/attachment/16329/amq-500-simple-version.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This file is for ActiveMQ 5.0.0&lt;/p&gt;

&lt;p&gt;I have NOT TESTED this on ActiveMQ 5, but the looking at the source code, I think the issue is there.  This patch does compile.&lt;/p&gt;

&lt;p&gt;In this version only boolean properties are used.  This make it impossible to know if the property was set on the Transport URL or not.&lt;/p&gt;

&lt;p&gt;My personal belief is the complex version is better, but I supplied both as I&apos;m unsure how the maintainers would like to see the issue resolved.&lt;/p&gt;</comment>
                            <comment id="12939443" author="djencks" created="Thu, 10 Apr 2008 17:07:50 +0000"  >&lt;p&gt;In the past I&apos;ve fixed this bug (in other projects) like this:&lt;/p&gt;

&lt;p&gt;    public void bind() throws IOException {&lt;br/&gt;
        super.bind();&lt;br/&gt;
        if (needClientAuth) &lt;/p&gt;
{
            ((SSLServerSocket)this.serverSocket).setNeedClientAuth(true);
        }
&lt;p&gt; else if (wantClientAuth) &lt;/p&gt;
{
            ((SSLServerSocket)this.serverSocket).setWantClientAuth(true);
        }
&lt;p&gt;    }&lt;/p&gt;


&lt;p&gt;which to me corresponds better to natural language usage like &quot;I not only want client auth, I need it!&quot;&lt;/p&gt;

&lt;p&gt;Is there some reason you think that setting both flags true should be disallowed?&lt;/p&gt;</comment>
                            <comment id="12939531" author="djencks" created="Thu, 10 Apr 2008 17:13:36 +0000"  >&lt;p&gt;with luck 4.1.2 is out the door.... should be able to get it in 5.1.0 though&lt;/p&gt;</comment>
                            <comment id="12939536" author="djencks" created="Thu, 10 Apr 2008 19:40:43 +0000"  >&lt;p&gt;looks like it will make it into 4.1.2&lt;/p&gt;</comment>
                            <comment id="12939540" author="djencks" created="Thu, 10 Apr 2008 19:42:24 +0000"  >&lt;p&gt;The test needed quite a bit of fixing up also.  The proposed patches would definitely have broken the tests as they test all 4 combinations, and do not expect an exception if both flags are true.&lt;br/&gt;
4.1 rev 646928&lt;br/&gt;
trunk rev 646936&lt;/p&gt;</comment>
                            <comment id="12939498" author="ericdwhite" created="Fri, 11 Apr 2008 08:21:43 +0000"  >

&lt;p&gt;The reason I though throwing an exception was a good idea was, in&lt;br/&gt;
reading the JDK API, these two options are really mutually exclusive,&lt;br/&gt;
if you set one the other is unset.  So, my thinking was URIs&lt;br/&gt;
containing: needClientAuth=true&amp;amp;wantClientAuth=true are technically&lt;br/&gt;
incorrect.&lt;/p&gt;

&lt;p&gt;That being said, I prefer the approach that you took.  Because from&lt;br/&gt;
the end users perspective it is very difficult to know that&lt;br/&gt;
needClientAuth and wantClientAuth override each other deep down inside&lt;br/&gt;
of the JDK.  So as you say if the user configuring ActiveMQ and sets&lt;br/&gt;
needClientAuth then that should take precedence over wantClientAuth.&lt;br/&gt;
This is because needClientAuth is more restrictive of the two.&lt;/p&gt;

&lt;p&gt;I&apos;m sorry I didn&apos;t run the tests, that was a lapse of judgment on my part.&lt;/p&gt;

&lt;p&gt;Would it be possible to update this page:&lt;br/&gt;
&lt;a href=&quot;http://activemq.apache.org/contributing.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/contributing.html&lt;/a&gt;&lt;br/&gt;
To include something like this in the &quot;Submitting patches&quot; section:&lt;/p&gt;

&lt;p&gt;Quick Check List:&lt;br/&gt;
1. Does the patch apply clean to the version it is supposed to fix.&lt;br/&gt;
2. Does the resutling patched code complie&lt;br/&gt;
3. Do the Unit tests run cleanly&lt;/p&gt;

&lt;p&gt;All of these are obvious, but it never hurts, to remind everyone.&lt;/p&gt;

&lt;p&gt;Thank you very much for fixing this in time for ActiveMQ 4.1.2.  I&lt;br/&gt;
really appreciate the quick turn around.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Eric&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461029" name="amq-411-complex-version.patch" size="2677" author="ericdwhite" created="Thu, 10 Apr 2008 12:45:31 +0000"/>
                            <attachment id="12460927" name="amq-411-simple-version.patch" size="1092" author="ericdwhite" created="Thu, 10 Apr 2008 12:47:31 +0000"/>
                            <attachment id="12461071" name="amq-500-complex-version.patch" size="2661" author="ericdwhite" created="Thu, 10 Apr 2008 12:48:51 +0000"/>
                            <attachment id="12460905" name="amq-500-simple-version.patch" size="1092" author="ericdwhite" created="Thu, 10 Apr 2008 12:49:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84513</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 33 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tsmv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>171948</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>