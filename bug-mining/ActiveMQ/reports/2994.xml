<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:39:44 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6567] Broker failure when deleting files in gc can cause missing journal errors on restart</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6567</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;A broker stop or failure while deleting journal data files or archiving data files can result in partial deletion and no index updates. &lt;br/&gt;
Leading to errors on restart of the form: &lt;br/&gt;
java.io.IOException: Detected missing journal files.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR BrokerService                  - Failed to start Apache ActiveMQ (localhost, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
java.io.IOException: Detected missing journal files. [1, 2, 3, 4]
	at org.apache.activemq.store.kahadb.MessageDatabase.recoverIndex(MessageDatabase.java:978)
	at org.apache.activemq.store.kahadb.MessageDatabase$5.execute(MessageDatabase.java:714)
	at org.apache.activemq.store.kahadb.disk.page.Transaction.execute(Transaction.java:779)
	at org.apache.activemq.store.kahadb.MessageDatabase.recover(MessageDatabase.java:711)
	at org.apache.activemq.store.kahadb.MessageDatabase.open(MessageDatabase.java:464)
	at org.apache.activemq.store.kahadb.MessageDatabase.load(MessageDatabase.java:483)
	at org.apache.activemq.store.kahadb.MessageDatabase.doStart(MessageDatabase.java:297)
	at org.apache.activemq.store.kahadb.KahaDBStore.doStart(KahaDBStore.java:218)
	at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:55)
	at org.apache.activemq.store.kahadb.KahaDBPersistenceAdapter.doStart(KahaDBPersistenceAdapter.java:226)
	at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:55)
	at org.apache.activemq.broker.BrokerService.doStartPersistenceAdapter(BrokerService.java:674)
	at org.apache.activemq.broker.BrokerService.startPersistenceAdapter(BrokerService.java:658)
	at org.apache.activemq.broker.BrokerService.start(BrokerService.java:622)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The file deletion of the gc candidates is part of the index transaction, so partial deletion can occur but the index does not get updated.&lt;br/&gt;
For gc, the index updates need to complete to remove references to the data files first. Only after a successful update to the index should the removal proceed. If the removal fails, on restart the orphaned data files will get gc ed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13035546">AMQ-6567</key>
            <summary>Broker failure when deleting files in gc can cause missing journal errors on restart</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Jan 2017 14:01:27 +0000</created>
                <updated>Fri, 24 Feb 2017 19:25:14 +0000</updated>
                            <resolved>Wed, 18 Jan 2017 11:39:58 +0000</resolved>
                                    <version>5.14.0</version>
                                    <fixVersion>5.15.0</fixVersion>
                    <fixVersion>5.14.4</fixVersion>
                                    <component>KahaDB</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="15826093" author="jira-bot" created="Tue, 17 Jan 2017 14:08:27 +0000"  >&lt;p&gt;Commit 20522394cc747e64bd9f87e2e0b64d886c4dec62 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2052239&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2052239&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6567&quot; title=&quot;Broker failure when deleting files in gc can cause missing journal errors on restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6567&quot;&gt;&lt;del&gt;AMQ-6567&lt;/del&gt;&lt;/a&gt; ensure gc file removal/move is completed after index updates to avoid dangling index referenced on partial failure. Fix and test&lt;/p&gt;</comment>
                            <comment id="15883374" author="jira-bot" created="Fri, 24 Feb 2017 19:24:28 +0000"  >&lt;p&gt;Commit 1a67318fe97b1339ea1fbbd74cc7232c46e8f27c in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=1a67318&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=1a67318&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6567&quot; title=&quot;Broker failure when deleting files in gc can cause missing journal errors on restart&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6567&quot;&gt;&lt;del&gt;AMQ-6567&lt;/del&gt;&lt;/a&gt; ensure gc file removal/move is completed after index updates to avoid dangling index referenced on partial failure. Fix and test&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 20522394cc747e64bd9f87e2e0b64d886c4dec62)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i38th3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>