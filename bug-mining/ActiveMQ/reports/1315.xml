<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:51:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3465] TransactionContext produces errors in concurrent environment</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3465</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Method &quot;isInXATransaction&quot; of class org.apache.activemq.TransactionContext seems to be implemeted incorrectly. Here is the code:&lt;/p&gt;

&lt;p&gt;public boolean isInXATransaction() {&lt;br/&gt;
    return (transactionId != null &amp;amp;&amp;amp; transactionId.isXATransaction()) || !ENDED_XA_TRANSACTION_CONTEXTS.isEmpty();&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Map &quot;ENDED_XA_TRANSACTION_CONTEXTS&quot; is a static field. TransactionContext instances are used for both outbound and inbound communications. Suppose a thread creating a new non-transactional session. It calls isInXATransaction and gets true, just because another thread is completing transactional message delivery at the same time. After XAResource.end() call but before XAResource.commit() call the map is not empty and it results in a JMSException in the first thread (see org.apache.activemq.ra.ManagedTransactionContext.setUseSharedTxContext(boolean)&quot;).&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Windows XP SP2, Oracle JDK 1.6.0_23&lt;/p&gt;</environment>
        <key id="12519821">AMQ-3465</key>
            <summary>TransactionContext produces errors in concurrent environment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="a.a.akimov">Alexei Akimov</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Aug 2011 12:52:38 +0000</created>
                <updated>Thu, 31 Jan 2013 13:11:43 +0000</updated>
                            <resolved>Mon, 3 Oct 2011 12:44:13 +0000</resolved>
                                    <version>5.5.0</version>
                                    <fixVersion>5.6.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13105051" author="wyoumans" created="Thu, 15 Sep 2011 01:38:11 +0000"  >&lt;p&gt;I am experiencing similar issue as described in this JIRA bug report and in the nabble link.&lt;/p&gt;</comment>
                            <comment id="13115527" author="tabish121" created="Tue, 27 Sep 2011 14:23:09 +0000"  >&lt;p&gt;Fix and new unit test added to trunk.&lt;/p&gt;</comment>
                            <comment id="13119155" author="a.a.akimov" created="Mon, 3 Oct 2011 06:23:31 +0000"  >&lt;p&gt;The patch, provided by Timothy Bish, seems to be incorrect. Here is declaration of ENDED_XA_TRANSACTION_CONTEXTS:&lt;/p&gt;

&lt;p&gt;private final static ConcurrentHashMap&amp;lt;TransactionId, List&amp;lt;TransactionContext&amp;gt;&amp;gt; ENDED_XA_TRANSACTION_CONTEXTS = ...&lt;/p&gt;

&lt;p&gt;So the type of map values is List&amp;lt;TransactionContext&amp;gt;. And here is the patched code:&lt;/p&gt;

&lt;p&gt;public boolean isInXATransaction() {&lt;br/&gt;
    return (transactionId != null &amp;amp;&amp;amp; transactionId.isXATransaction()) || (!ENDED_XA_TRANSACTION_CONTEXTS.isEmpty() &amp;amp;&amp;amp; ENDED_XA_TRANSACTION_CONTEXTS.containsValue(this));&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;It is clear, the last condition ENDED_XA_TRANSACTION_CONTEXTS.containsValue(this) never holds just because the map contains lists of TransactionContext but not Transaction context itself.&lt;/p&gt;</comment>
                            <comment id="13119272" author="tabish121" created="Mon, 3 Oct 2011 12:44:13 +0000"  >&lt;p&gt;Fix applied in trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12630127">AMQ-4287</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12532296">AMQ-3602</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19332</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0aj0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59353</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>