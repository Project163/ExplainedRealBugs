<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:39:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2054] Deadlock in org.apache.activemq.usage.Usage</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2054</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;In highly concurrent environment, client deadlocks with this stack trace. Obiously, there are too many synchronized statements in Usage class. Either you add statements on method declaration, or use synchronized on mutex object. Now for example stop method is declared as synchronized and also locks usageMutex and this causes deadlock.&lt;/p&gt;

&lt;p&gt;Found one Java-level deadlock:&lt;br/&gt;
=============================&lt;br/&gt;
&quot;jmsConnector.dispatcher.486&quot;:&lt;br/&gt;
  waiting to lock monitor 0x08528fb0 (object 0xa4b01390, a java.lang.Object),&lt;br/&gt;
  which is held by &quot;ActiveMQ Transport: tcp://localhost/127.0.0.1:61616&quot;&lt;br/&gt;
&quot;ActiveMQ Transport: tcp://localhost/127.0.0.1:61616&quot;:&lt;br/&gt;
  waiting to lock monitor 0x08528a38 (object 0xa4b01348, a org.apache.activemq.usage.MemoryUsage),&lt;br/&gt;
  which is held by &quot;jmsConnector.dispatcher.486&quot;&lt;/p&gt;

&lt;p&gt;Java stack information for the threads listed above:&lt;br/&gt;
===================================================&lt;br/&gt;
&quot;jmsConnector.dispatcher.486&quot;:&lt;br/&gt;
        at org.apache.activemq.usage.Usage.stop(Usage.java:306)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0xa4b01390&amp;gt; (a java.lang.Object)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0xa4b01348&amp;gt; (a org.apache.activemq.usage.MemoryUsage)&lt;br/&gt;
        at org.apache.activemq.ActiveMQMessageProducer.dispose(ActiveMQMessageProducer.java:156)&lt;br/&gt;
        at org.apache.activemq.ActiveMQSession.dispose(ActiveMQSession.java:589)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0xa4b091d8&amp;gt; (a org.apache.activemq.ActiveMQSession)&lt;br/&gt;
        at org.apache.activemq.ActiveMQSession.close(ActiveMQSession.java:555)&lt;br/&gt;
        at org.apache.activemq.pool.SessionPool.destroyObject(SessionPool.java:81)&lt;br/&gt;
        at org.apache.commons.pool.impl.GenericObjectPool.addObjectToPool(GenericObjectPool.java:1128)&lt;br/&gt;
        at org.apache.commons.pool.impl.GenericObjectPool.returnObject(GenericObjectPool.java:1076)&lt;br/&gt;
        at org.apache.activemq.pool.SessionPool.returnSession(SessionPool.java:67)&lt;br/&gt;
        at org.apache.activemq.pool.PooledSession.close(PooledSession.java:124)&lt;br/&gt;
        at org.mule.providers.jms.JmsConnector.close(JmsConnector.java:1003)&lt;br/&gt;
        at org.mule.providers.jms.JmsConnector.closeQuietly(JmsConnector.java:1017)&lt;br/&gt;
        at org.mule.providers.jms.JmsMessageDispatcher.dispatchMessage(JmsMessageDispatcher.java:323)&lt;br/&gt;
        at org.mule.providers.jms.JmsMessageDispatcher.doDispatch(JmsMessageDispatcher.java:64)&lt;br/&gt;
        at org.mule.providers.AbstractMessageDispatcher$Worker.run(AbstractMessageDispatcher.java:561)&lt;br/&gt;
        at org.mule.impl.work.WorkerContext.run(WorkerContext.java:310)&lt;br/&gt;
        at edu.emory.mathcs.backport.java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:987)&lt;br/&gt;
        at edu.emory.mathcs.backport.java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:528)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
&quot;ActiveMQ Transport: tcp://localhost/127.0.0.1:61616&quot;:&lt;br/&gt;
        at org.apache.activemq.usage.Usage.getExecutor(Usage.java:404)&lt;/li&gt;
	&lt;li&gt;waiting to lock &amp;lt;0xa4b01348&amp;gt; (a org.apache.activemq.usage.MemoryUsage)&lt;br/&gt;
        at org.apache.activemq.usage.Usage.fireEvent(Usage.java:271)&lt;br/&gt;
        at org.apache.activemq.usage.Usage.setPercentUsage(Usage.java:232)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0xa4b01390&amp;gt; (a java.lang.Object)&lt;br/&gt;
        at org.apache.activemq.usage.MemoryUsage.decreaseUsage(MemoryUsage.java:146)&lt;br/&gt;
        at org.apache.activemq.ActiveMQMessageProducer.onProducerAck(ActiveMQMessageProducer.java:289)&lt;br/&gt;
        at org.apache.activemq.ActiveMQConnection$2.processProducerAck(ActiveMQConnection.java:1675)&lt;br/&gt;
        at org.apache.activemq.command.ProducerAck.visit(ProducerAck.java:56)&lt;br/&gt;
        at org.apache.activemq.ActiveMQConnection.onCommand(ActiveMQConnection.java:1647)&lt;br/&gt;
        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:104)&lt;br/&gt;
        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)&lt;br/&gt;
        at org.apache.activemq.transport.failover.FailoverTransport$3.onCommand(FailoverTransport.java:167)&lt;br/&gt;
        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:143)&lt;br/&gt;
        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:206)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x752c53e8&amp;gt; (a org.apache.activemq.transport.InactivityMonitor$1)&lt;br/&gt;
        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:203)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:185)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Found 1 deadlock.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12482781">AMQ-2054</key>
            <summary>Deadlock in org.apache.activemq.usage.Usage</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="jurna">Danielius Jurna</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Jan 2009 12:45:04 +0000</created>
                <updated>Tue, 13 Jan 2009 22:16:20 +0000</updated>
                            <resolved>Tue, 13 Jan 2009 22:16:20 +0000</resolved>
                                    <version>5.2.0</version>
                                    <fixVersion>5.3.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12940633" author="jurna" created="Thu, 8 Jan 2009 08:27:00 +0000"  >&lt;p&gt;I&apos;ve added a patch to Usage class. All (3) synchronized statments in method declarations were removed. In start and stop they are not necessary, because those methods are guarded by atomic booleans. getExecutor() needs more care, but I would prefere lock on usageMutex, because in order to prevent deadlocks, you need as little mutexes as possible. Also mutex is used only on executor initialisation. If it&apos;s already initialized, no locks are made.&lt;/p&gt;</comment>
                            <comment id="12940642" author="gtully" created="Tue, 13 Jan 2009 22:16:20 +0000"  >&lt;p&gt;patch applied in r734256 with thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461307" name="Usage.java.patch" size="2636" author="jurna" created="Thu, 8 Jan 2009 08:20:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75099</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s07z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161512</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>