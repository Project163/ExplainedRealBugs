<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:51:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3488] Temporary destinations&apos; DestinationInfo commands over VM transport prevent connection closure</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3488</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;ActiveMQTempDestinations hold onto the source connection that created them. When the source connection is closed, its temporary destinations are deleted. Unfortunately, DestinationInfo commands convey the destination object with its source connection to all other connections on the same VMTransportServer. Hence when these other connections are closed, they attempt to delete the source connection&apos;s temporary destination.&lt;/p&gt;

&lt;p&gt;Note that enabling marshaling on the VM transport works around this bug because destination serialization and deserialization does not maintain the source connection reference.&lt;/p&gt;

&lt;p&gt;This bug was not present in 5.4.2.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12521829">AMQ-3488</key>
            <summary>Temporary destinations&apos; DestinationInfo commands over VM transport prevent connection closure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dretzlaff">Dan Retzlaff</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Sep 2011 22:27:38 +0000</created>
                <updated>Mon, 23 Apr 2012 17:48:36 +0000</updated>
                            <resolved>Sun, 11 Sep 2011 19:56:39 +0000</resolved>
                                    <version>5.5.0</version>
                                    <fixVersion>5.6.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13099616" author="dretzlaff" created="Wed, 7 Sep 2011 22:28:34 +0000"  >&lt;p&gt;The attached test case demonstrates this bug by having a consumer active on the source connection, which causes a &quot;Consumer is consuming from the temporary destination&quot; exception when a separate connection is created and closed.&lt;/p&gt;</comment>
                            <comment id="13102334" author="tabish121" created="Sun, 11 Sep 2011 19:56:39 +0000"  >&lt;p&gt;Fixed in trunk, thanks for the great test case.&lt;/p&gt;</comment>
                            <comment id="13259771" author="djohle" created="Mon, 23 Apr 2012 17:48:36 +0000"  >&lt;p&gt;I have some additional notes about some other side effects I&apos;ve encountered that I can attribute to this same bug.  Just posting them here in case anyone else not running 5.6.0 yet is running into them and trying to figure out what is going on.&lt;/p&gt;

&lt;p&gt;I noticed that, when using a temporary destination and then closing a connection and subsequently receiving the &quot;Consumer is consuming...&quot; exception, the consumer for the queue I closed a connection to was left dangling.&lt;/p&gt;

&lt;p&gt;That is, I start up my application with X amount of consumers and look at the queue via JMX under org.apache.activemq-&amp;gt;myBrokerName-&amp;gt;Queue-&amp;gt;myQueuName-&amp;gt;Attributes-&amp;gt;Subscriptions&lt;br/&gt;
and see X amount subscriptions to that queue as expected.  I then instruct my application to shut down Y amount of consumers, and the Subscriptions count remains at X instead of the expected value of X - Y = Z.&lt;/p&gt;

&lt;p&gt;If I disable the portion of my application that uses the temporary queue, then no exceptions happen, and the above shutdown test does cause the Subscriptions count to drop to Z accordingly.&lt;/p&gt;


&lt;p&gt;What&apos;s worse is that it&apos;s not just excess JMX ObjectNames left behind, but the actual consumer subscriptions they relate to are also still there and registered with ActiveMQ / bound to that queue as MessageListeners.  That can be verified via JMX as well, under org.apache.activemq-&amp;gt;myBrokerName-&amp;gt;Subscription-&amp;gt;Non-Durable-&amp;gt;Queue-&amp;gt;myQueueName.&lt;/p&gt;

&lt;p&gt;So what happens next is...&lt;/p&gt;

&lt;p&gt;I then trigger my application to produce a bunch of messages into myQueueName.  Most of them are consumed by the remaining Z consumers, but a certain number of them just get stuck in the queue.  And not just any number, but precisely the number Y * prefetchSize.&lt;/p&gt;

&lt;p&gt;If I restart my entire application the messages then get re-delivered to the fresh consumers and flushed out of myQueueName.  That is, unless I don&apos;t get to it in time, at which point they expire and end up in the DLQ instead.&lt;/p&gt;

&lt;p&gt;Again, disabling the use of temporary qeueus avoids this issue.  The problem, of course, is that I need the temps for proper app functionality!&lt;/p&gt;


&lt;p&gt;I also tested this scenario with the current 5.6.0-SNAPSHOT and can confirm that it does indeed resolve the issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12493522" name="TempQueueDeleteOnCloseTest.java" size="994" author="dretzlaff" created="Wed, 7 Sep 2011 22:28:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60089</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 31 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0aiy7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59343</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>