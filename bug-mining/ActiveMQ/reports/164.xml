<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:33:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1093] Client deadlock during failover</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1093</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;In 4.1.0 there&apos;s deadlock on connection failover. There is the scenario: &lt;br/&gt;
1. Client consumes message using message listener &lt;br/&gt;
2. Conection is lost &lt;br/&gt;
3. Client sends message to another queue from messagle listener and waits until connection is restored. &lt;br/&gt;
4. Reconnect task blocks on reconnecting. &lt;/p&gt;

&lt;p&gt;This bug is new to 4.1.0. The problem is in ActiveMQMessageConsumre.dispatch . There is new lock on unconsumedMessages.getMutex() . So the reconnect task cannot invoke ActiveMQMessageConsumre.clearMessagesInProgress(), because lock is acquired by message listener, which waits untill message is sent (untill connection is resumed). Here is stack traces: &lt;/p&gt;

&lt;p&gt;&quot;ActiveMQ Session Task&quot; daemon prio=1 tid=0x0000002b27774260 nid=0x4778 in Object.wait() &lt;span class=&quot;error&quot;&gt;&amp;#91;0x0000000040ef3000..0x0000000040ef4db0&amp;#93;&lt;/span&gt; &lt;br/&gt;
        at java.lang.Object.wait(Native Method) &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting on &amp;lt;0x0000002b0020a7c8&amp;gt; (a edu.emory.mathcs.backport.java.util.concurrent.locks.CondVar)&lt;br/&gt;
        at java.lang.Object.wait(Object.java:474) &lt;br/&gt;
        at edu.emory.mathcs.backport.java.util.concurrent.locks.CondVar.await(CondVar.java:75) &lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x0000002b0020a7c8&amp;gt; (a edu.emory.mathcs.backport.java.util.concurrent.locks.CondVar)&lt;br/&gt;
        at edu.emory.mathcs.backport.java.util.concurrent.ArrayBlockingQueue.take(ArrayBlockingQueue.java:318) &lt;br/&gt;
        at org.apache.activemq.transport.FutureResponse.getResult(FutureResponse.java:42) &lt;br/&gt;
        at org.apache.activemq.transport.ResponseCorrelator.request(ResponseCorrelator.java:75) &lt;br/&gt;
        at org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1171) &lt;br/&gt;
        at org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1548) &lt;br/&gt;
        at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:465) &lt;br/&gt;
        at org.apache.activemq.pool.PooledProducer.send(PooledProducer.java:75) &lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x0000002b173fa480&amp;gt; (a org.apache.activemq.ActiveMQMessageProducer)&lt;br/&gt;
        at org.apache.activemq.pool.PooledProducer.send(PooledProducer.java:60) &lt;br/&gt;
        at org.springframework.jms.core.JmsTemplate.doSend(JmsTemplate.java:537) &lt;br/&gt;
        at org.springframework.jms.core.JmsTemplate.doSend(JmsTemplate.java:513) &lt;br/&gt;
        at org.springframework.jms.core.JmsTemplate$2.doInJms(JmsTemplate.java:479) &lt;br/&gt;
        at org.springframework.jms.core.JmsTemplate.execute(JmsTemplate.java:430) &lt;br/&gt;
        at org.springframework.jms.core.JmsTemplate.send(JmsTemplate.java:477) &lt;br/&gt;
        at lt.elitnet.dbp.das.impl.storage.HI2StorageImpl.storeHI2Message(HI2StorageImpl.java:57) &lt;br/&gt;
        at lt.elitnet.dbp.das.impl.hi2.HI2PersistanceBase.saveIRIContent(HI2PersistanceBase.java:77) &lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor185.invoke(Unknown Source) &lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25) &lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585) &lt;br/&gt;
        at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:318) &lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:203) &lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:162) &lt;br/&gt;
        at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:107) &lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:185) &lt;br/&gt;
        at org.springframework.orm.hibernate3.HibernateInterceptor.invoke(HibernateInterceptor.java:104) &lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:185) &lt;br/&gt;
        at lt.elitnet.dbp.das.impl.alarming.DataBaseConnectionAlarmsPublisher.invoke(DataBaseConnectionAlarmsPublisher.java:59) &lt;br/&gt;
        at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:185) &lt;br/&gt;
        at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:209) &lt;br/&gt;
        at $Proxy24.saveIRIContent(Unknown Source) &lt;br/&gt;
        at lt.elitnet.dbp.das.impl.hi2.HI2MessageListener.onMessage(HI2MessageListener.java:40) &lt;br/&gt;
        at lt.elitnet.dbp.commons.messaging.TextMessageListener.deliverMessage(TextMessageListener.java:84) &lt;br/&gt;
        at lt.elitnet.dbp.commons.messaging.TextMessageListener.onMessage(TextMessageListener.java:50) &lt;br/&gt;
        at org.springframework.jms.listener.AbstractMessageListenerContainer.doInvokeListener(AbstractMessageListenerContainer.java:854) &lt;br/&gt;
        at org.springframework.jms.listener.AbstractMessageListenerContainer.invokeListener(AbstractMessageListenerContainer.java:793) &lt;br/&gt;
        at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:763) &lt;br/&gt;
        at org.springframework.jms.listener.AbstractMessageListenerContainer.executeListener(AbstractMessageListenerContainer.java:743) &lt;br/&gt;
        at org.springframework.jms.listener.SimpleMessageListenerContainer$2.onMessage(SimpleMessageListenerContainer.java:190) &lt;br/&gt;
        at org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:840) &lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x0000002b1771ddc0&amp;gt; (a java.lang.Object)&lt;br/&gt;
        at org.apache.activemq.ActiveMQSessionExecutor.dispatch(ActiveMQSessionExecutor.java:96) &lt;br/&gt;
        at org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:165) &lt;br/&gt;
        at org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:111) &lt;br/&gt;
        at org.apache.activemq.thread.PooledTaskRunner.access$100(PooledTaskRunner.java:26) &lt;br/&gt;
        at org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:44) &lt;br/&gt;
        at edu.emory.mathcs.backport.java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:650) &lt;br/&gt;
        at edu.emory.mathcs.backport.java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:675) &lt;br/&gt;
        at java.lang.Thread.run(Thread.java:595) &lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&quot;ActiveMQ Transport: tcp:///192.168.2.55:61616&quot; prio=1 tid=0x0000002b2e814660 nid=0x4773 waiting for monitor entry &lt;span class=&quot;error&quot;&gt;&amp;#91;0x0000000040e82000..0x0000000040e82c30&amp;#93;&lt;/span&gt; &lt;br/&gt;
        at org.apache.activemq.MessageDispatchChannel.clear(MessageDispatchChannel.java:135) &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x0000002b1771ddc0&amp;gt; (a java.lang.Object)&lt;br/&gt;
        at org.apache.activemq.ActiveMQMessageConsumer.clearMessagesInProgress(ActiveMQMessageConsumer.java:546) &lt;br/&gt;
        at org.apache.activemq.ActiveMQSession.clearMessagesInProgress(ActiveMQSession.java:524) &lt;br/&gt;
        at org.apache.activemq.ActiveMQConnection.transportInterupted(ActiveMQConnection.java:1547) &lt;br/&gt;
        at org.apache.activemq.transport.TransportFilter.transportInterupted(TransportFilter.java:100) &lt;br/&gt;
        at org.apache.activemq.transport.TransportFilter.transportInterupted(TransportFilter.java:100) &lt;br/&gt;
        at org.apache.activemq.transport.failover.FailoverTransport.handleTransportFailure(FailoverTransport.java:236) &lt;br/&gt;
        at org.apache.activemq.transport.failover.FailoverTransport.access$300(FailoverTransport.java:55) &lt;br/&gt;
        at org.apache.activemq.transport.failover.FailoverTransport$1.onException(FailoverTransport.java:120) &lt;br/&gt;
        at org.apache.activemq.transport.TransportFilter.onException(TransportFilter.java:96) &lt;br/&gt;
        at org.apache.activemq.transport.WireFormatNegotiator.onException(WireFormatNegotiator.java:147) &lt;br/&gt;
        at org.apache.activemq.transport.InactivityMonitor.onException(InactivityMonitor.java:150) &lt;br/&gt;
        at org.apache.activemq.transport.TransportSupport.onException(TransportSupport.java:97) &lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:150) &lt;br/&gt;
        at java.lang.Thread.run(Thread.java:595)&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;Linux 2.6, java 1.5.0&lt;/p&gt;</environment>
        <key id="12481828">AMQ-1093</key>
            <summary>Client deadlock during failover</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jurna">Danielius Jurna</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 Dec 2006 07:05:11 +0000</created>
                <updated>Thu, 14 Dec 2006 15:25:45 +0000</updated>
                            <resolved>Thu, 14 Dec 2006 15:25:45 +0000</resolved>
                                    <version>4.1.0</version>
                                    <fixVersion>5.0.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12938705" author="jstrachan" created="Thu, 14 Dec 2006 15:25:45 +0000"  >&lt;p&gt;I&apos;ve just committed a patch to trunk for this which I think resolves the issue. &lt;/p&gt;

&lt;p&gt;There&apos;s no test case to easily verify its resolved though (its a tad hard to recreate) so I wonder could you try and see if this is now fixed - if not let us know and we can reopen this issue&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84492</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s0d3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161535</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>