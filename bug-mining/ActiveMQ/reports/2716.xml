<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:32:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6097] KahaDB message size metrics can be inaccurate</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6097</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I have found during testing that the reported size of the messages in a KahaDB store can be shown as too high in certain cases.  The message count values are accurate, however.&lt;/p&gt;

&lt;p&gt;My testing as shown that when publishing a large quantity of messages with several producers (a couple hundred thousand) and then consuming them with several consumers, when all the messages are consumed and the count is 0, the reported size will still be greater than 0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12923093">AMQ-6097</key>
            <summary>KahaDB message size metrics can be inaccurate</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="cshannon">Christopher L. Shannon</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Dec 2015 18:29:08 +0000</created>
                <updated>Thu, 4 Feb 2016 14:40:48 +0000</updated>
                            <resolved>Tue, 22 Dec 2015 13:26:36 +0000</resolved>
                                    <version>5.12.1</version>
                    <version>5.13.0</version>
                                    <fixVersion>5.12.2</fixVersion>
                    <fixVersion>5.13.1</fixVersion>
                    <fixVersion>5.14.0</fixVersion>
                                    <component>Broker</component>
                    <component>KahaDB</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15064428" author="christopher.l.shannon" created="Fri, 18 Dec 2015 18:32:39 +0000"  >&lt;p&gt;I did some debugging and the problem is that in certain cases, the wrong marshaller is being used for the messages keys in the message order index.  During updates in KahaDB the size is being read as -1 and not initialized since the used marshaller doesn&apos;t know how to serialize the message size.  Normally the location index is used for size information so this problem doesn&apos;t always show up.&lt;/p&gt;</comment>
                            <comment id="15064623" author="jira-bot" created="Fri, 18 Dec 2015 19:46:43 +0000"  >&lt;p&gt;Commit 246ccb8e04515c6e85544b32035537f60d92b5b9 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=246ccb8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=246ccb8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing KahaDB so that the correct marshaller is used for the message&lt;br/&gt;
keys inside of the message order index.  This will ensure that message&lt;br/&gt;
size metrics are accurate.&lt;/p&gt;</comment>
                            <comment id="15064631" author="jira-bot" created="Fri, 18 Dec 2015 19:48:46 +0000"  >&lt;p&gt;Commit 370b1810995c48129521d1c86d7b0a31d1d966d9 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=370b181&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=370b181&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;remove un-needed import statements&lt;/p&gt;</comment>
                            <comment id="15064638" author="christopher.l.shannon" created="Fri, 18 Dec 2015 19:50:40 +0000"  >&lt;p&gt;Patch applied...I will resolve and backport the fix to 5.12.x and 5.13.x if tests pass.&lt;/p&gt;</comment>
                            <comment id="15066686" author="jira-bot" created="Mon, 21 Dec 2015 16:47:31 +0000"  >&lt;p&gt;Commit 507d40a79f15449ba6d79ef85d7fdf6bf50a3a65 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=507d40a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=507d40a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing JournalCorruptionEofIndexRecoveryTest class&lt;/p&gt;

&lt;p&gt;Because of the size being stored in the message order index, the test&lt;br/&gt;
testRecoveryAftercorruptionCheckSumExistingIndex was no longer passing&lt;br/&gt;
as that test was corrupting the size value in the journal, but not the&lt;br/&gt;
size value in the index.  The test now corrupts both values so that the&lt;br/&gt;
expect exception occurs again.&lt;/p&gt;</comment>
                            <comment id="15068084" author="jira-bot" created="Tue, 22 Dec 2015 13:14:57 +0000"  >&lt;p&gt;Commit 51aa70eaae69f7fa9941c40d2f31b90c7f5a81ab in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=51aa70e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=51aa70e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing KahaDB so that the correct marshaller is used for the message&lt;br/&gt;
keys inside of the message order index.  This will ensure that message&lt;br/&gt;
size metrics are accurate.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 246ccb8e04515c6e85544b32035537f60d92b5b9)&lt;/p&gt;</comment>
                            <comment id="15068085" author="jira-bot" created="Tue, 22 Dec 2015 13:14:58 +0000"  >&lt;p&gt;Commit b103932ccd24235fad91c104f46b5c5194500bfb in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=b103932&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=b103932&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;remove un-needed import statements&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 370b1810995c48129521d1c86d7b0a31d1d966d9)&lt;/p&gt;</comment>
                            <comment id="15068086" author="jira-bot" created="Tue, 22 Dec 2015 13:14:59 +0000"  >&lt;p&gt;Commit a73ada062960e72b5f22bb8cbb914997f72f4a37 in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=a73ada0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=a73ada0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing JournalCorruptionEofIndexRecoveryTest class&lt;/p&gt;

&lt;p&gt;Because of the size being stored in the message order index, the test&lt;br/&gt;
testRecoveryAftercorruptionCheckSumExistingIndex was no longer passing&lt;br/&gt;
as that test was corrupting the size value in the journal, but not the&lt;br/&gt;
size value in the index.  The test now corrupts both values so that the&lt;br/&gt;
expect exception occurs again.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 507d40a79f15449ba6d79ef85d7fdf6bf50a3a65)&lt;/p&gt;</comment>
                            <comment id="15068107" author="jira-bot" created="Tue, 22 Dec 2015 13:26:22 +0000"  >&lt;p&gt;Commit 28f711e50e94cda4d1235da8290c148719487e40 in activemq&apos;s branch refs/heads/activemq-5.12.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=28f711e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=28f711e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing KahaDB so that the correct marshaller is used for the message&lt;br/&gt;
keys inside of the message order index.  This will ensure that message&lt;br/&gt;
size metrics are accurate.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 246ccb8e04515c6e85544b32035537f60d92b5b9)&lt;/p&gt;</comment>
                            <comment id="15068108" author="jira-bot" created="Tue, 22 Dec 2015 13:26:23 +0000"  >&lt;p&gt;Commit 041191679301554c669451cd0a628c49e07bb039 in activemq&apos;s branch refs/heads/activemq-5.12.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=0411916&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=0411916&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;remove un-needed import statements&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 370b1810995c48129521d1c86d7b0a31d1d966d9)&lt;/p&gt;</comment>
                            <comment id="15068109" author="jira-bot" created="Tue, 22 Dec 2015 13:26:24 +0000"  >&lt;p&gt;Commit 7eb1425733324caeac7619d9510288c6c1527300 in activemq&apos;s branch refs/heads/activemq-5.12.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=7eb1425&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=7eb1425&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing JournalCorruptionEofIndexRecoveryTest class&lt;/p&gt;

&lt;p&gt;Because of the size being stored in the message order index, the test&lt;br/&gt;
testRecoveryAftercorruptionCheckSumExistingIndex was no longer passing&lt;br/&gt;
as that test was corrupting the size value in the journal, but not the&lt;br/&gt;
size value in the index.  The test now corrupts both values so that the&lt;br/&gt;
expect exception occurs again.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 507d40a79f15449ba6d79ef85d7fdf6bf50a3a65)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12824372">AMQ-5748</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12936744">AMQ-6158</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 48 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2q3on:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>