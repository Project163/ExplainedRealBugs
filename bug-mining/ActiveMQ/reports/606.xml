<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:41:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2241] On failover it is possible to get duplicate connections broker side which can result in: Cannot add a consumer to a session that had not been registered:</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2241</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;localhost Cannot add a consumer to a session that had not been registered: ID:localhost-40888-1241048176812-0:19:-1&lt;br/&gt;
	at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:49)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnection.syncSendPacket(ActiveMQConnection.java:1255)&lt;br/&gt;
	at org.apache.activemq.AdvisoryConsumer.&amp;lt;init&amp;gt;(AdvisoryConsumer.java:50)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnection.ensureConnectionInfoSent(ActiveMQConnection.java:1359)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnection.createSession(ActiveMQConnection.java:300)&lt;br/&gt;
	at org.apache.activemq.ra.ManagedConnectionProxy.createSessionProxy(ManagedConnectionProxy.java:119)&lt;br/&gt;
	at org.apache.activemq.ra.ManagedConnectionProxy.createSession(ManagedConnectionProxy.java:105)&lt;br/&gt;
	at org.springframework.jms.support.JmsAccessor.createSession(JmsAccessor.java:196)&lt;br/&gt;
	at org.springframework.jms.core.JmsTemplate.execute(JmsTemplate.java:462)&lt;br/&gt;
	... 35 more&lt;br/&gt;
Caused by: java.lang.IllegalStateException: localhost Cannot add a consumer to a session that had not been registered: ID:localhost-40888-1241048176812-0:19:-1&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection.processAddConsumer(TransportConnection.java:540)&lt;br/&gt;
	at org.apache.activemq.command.ConsumerInfo.visit(ConsumerInfo.java:349)&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:308)&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:182)&lt;br/&gt;
	at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)&lt;br/&gt;
	at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:143)&lt;br/&gt;
	at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:210)&lt;br/&gt;
	at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)&lt;br/&gt;
	at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:203)&lt;br/&gt;
	at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:185)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12482803">AMQ-2241</key>
            <summary>On failover it is possible to get duplicate connections broker side which can result in: Cannot add a consumer to a session that had not been registered:</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 May 2009 15:44:15 +0000</created>
                <updated>Mon, 11 May 2009 10:26:17 +0000</updated>
                            <resolved>Tue, 5 May 2009 13:29:40 +0000</resolved>
                                    <version>5.2.0</version>
                                    <fixVersion>5.3.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                                                            <comments>
                            <comment id="12941247" author="gtully" created="Fri, 1 May 2009 15:45:56 +0000"  >&lt;p&gt;problem is that on a duplicate connection, for instance on failover but when the broker has not yet disposed of its connection info, it is possible to get a duplicate connection request. the state is reset to have the second connection take over which is ok, but the default session is not recreated on the reset state so the submission of the advisory consumer fails with no session.&lt;/p&gt;</comment>
                            <comment id="12941256" author="gtully" created="Tue, 5 May 2009 13:29:40 +0000"  >&lt;p&gt;resolved in r771718&lt;/p&gt;</comment>
                            <comment id="12941273" author="gtully" created="Mon, 11 May 2009 10:26:17 +0000"  >&lt;p&gt;similar behavior can also be the result of &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2178&quot; title=&quot;Memory leak in ConnectionStateTracker (cannot remove connections, sessions or consumers)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-2178&quot;&gt;&lt;del&gt;AMQ-2178&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12482964">AMQ-2178</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75015</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s287:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161837</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>