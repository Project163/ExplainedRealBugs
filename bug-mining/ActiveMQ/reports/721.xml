<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:42:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2401] Hangs in fan-in to DUPS_OK_ACKNOWLEDGE queue receivers</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2401</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;While running performance tests I I was seeing hangs in several tests  involving dups ok queue receivers. My suspicion is that this is related to &quot;too lazy&quot; dups_ok acknowledgements. Changing the queue prefetchLimit to 100 caused this problem to go away. This needs more investigation, but it seems like we can get ourselves in to trouble if the queue size is smaller than the receiver&apos;s prefetchLimit, and this should be avoid. It is also possible that there is something more complicated happening in my tests. I haven&apos;t yet been able to reproduce this outside my performance test environment. &lt;/p&gt;</description>
                <environment>&lt;p&gt;Running with the following config:&lt;/p&gt;

&lt;p&gt;&amp;lt;destinationPolicy&amp;gt;&lt;br/&gt;
 &amp;lt;policyMap&amp;gt;&lt;br/&gt;
   &amp;lt;policyEntries&amp;gt;&lt;br/&gt;
     &amp;lt;policyEntry topic=&quot;&amp;gt;&quot; producerFlowControl=&quot;true&quot; memoryLimit=&quot;1mb&quot;&amp;gt;                      &lt;br/&gt;
       &amp;lt;pendingSubscriberPolicy&amp;gt;&lt;br/&gt;
         &amp;lt;vmCursor/&amp;gt;&lt;br/&gt;
       &amp;lt;/pendingSubscriberPolicy&amp;gt;&lt;br/&gt;
     &amp;lt;/policyEntry&amp;gt;&lt;br/&gt;
     &amp;lt;policyEntry queue=&quot;&amp;gt;&quot; producerFlowControl=&quot;true&quot; memoryLimit=&quot;1mb&quot;/&amp;gt;&lt;br/&gt;
   &amp;lt;/policyEntries&amp;gt;&lt;br/&gt;
 &amp;lt;/policyMap&amp;gt;&lt;br/&gt;
&amp;lt;/destinationPolicy&amp;gt;&lt;/p&gt;</environment>
        <key id="12482929">AMQ-2401</key>
            <summary>Hangs in fan-in to DUPS_OK_ACKNOWLEDGE queue receivers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cmacnaug">Colin MacNaughton</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Sep 2009 19:59:33 +0000</created>
                <updated>Thu, 24 Sep 2009 14:37:28 +0000</updated>
                            <resolved>Thu, 24 Sep 2009 14:37:28 +0000</resolved>
                                    <version>5.3.0</version>
                                    <fixVersion>5.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12939202" author="cmacnaug" created="Tue, 22 Sep 2009 02:50:33 +0000"  >&lt;p&gt;Path file for Unit Test Reproducing the issue.&lt;/p&gt;</comment>
                            <comment id="12939233" author="cmacnaug" created="Tue, 22 Sep 2009 03:07:38 +0000"  >&lt;p&gt;The attached unit test can be used to demonstrate two issues. If you set PRODUCER_COUNT=1 and CONSUMER_COUNT=1, and change the producer message size to 1300 bytes. You can see that this will indeed produce a hang since the consumer&apos;s prefetch is 1000 and less than number fit into the queue. &lt;/p&gt;

&lt;p&gt;However, using the test as is unmodified (e.g. 50 producers, and a message size of 1024 doesn&apos;t result in a hang, but does result in a serious performance bottleneck. There is some sort of contention happening in the broker. This is the behavior that I was seeing in my original performance runs ... simply a sever slow down. &lt;/p&gt;</comment>
                            <comment id="12940843" author="cmacnaug" created="Tue, 22 Sep 2009 21:02:37 +0000"  >&lt;p&gt;After some changes committed by Rob and Dejan in 5.4 trunk, the 50_1_1 usecase is better than before. However, setting the pending queue policy to vm results in the old buggy behavior, which is problematic for those thar don&apos;t wish to page messages to disk:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Modify setup to include vm pending cursor,java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;entry.setPendingQueuePolicy(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; VMPendingQueueMessageStoragePolicy());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12941095" author="chirino" created="Wed, 23 Sep 2009 19:45:04 +0000"  >&lt;p&gt;I think the safest bet will be to change the client so that he acks more frequently at least in a queue dups ok case.&lt;/p&gt;</comment>
                            <comment id="12941106" author="chirino" created="Wed, 23 Sep 2009 20:55:39 +0000"  >&lt;p&gt;Attaching patch which changes the DUPS_OK queue consumer behavior to match that of AUTO_ACK.  The topic should still behave as before.&lt;/p&gt;</comment>
                            <comment id="12941310" author="chirino" created="Thu, 24 Sep 2009 14:37:28 +0000"  >&lt;p&gt;I added the test case to the build.. slightly modified so that it would exacerbate the DUPS_OK problem to get a quicker failure.&lt;br/&gt;
rev: 818496&lt;br/&gt;
The fix for the test case went in as rev: 818487&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461561" name="AMQ-2401.patch" size="3467" author="chirino" created="Wed, 23 Sep 2009 20:55:39 +0000"/>
                            <attachment id="12461560" name="AMQ2401.txt" size="8266" author="cmacnaug" created="Tue, 22 Sep 2009 02:50:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74957</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 9 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14chz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233488</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>