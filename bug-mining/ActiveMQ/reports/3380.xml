<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:51:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6660] Deadlock closing a connection due to an exception</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6660</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;While recovering from a period of network instability, our application deadlocked in ActiveMQ code.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Found one Java-level deadlock:
=============================
&quot;ActiveMQ Connection Executor: tcp:///&amp;lt;ip address&amp;gt;:61616@51026&quot;:
  waiting to lock monitor 0x00007f60fc0060b8 (object 0x0000000773f00308, a java.lang.Object),
  which is held by &quot;privateJmsInPriority.container-1&quot;
&quot;privateJmsInPriority.container-1&quot;:
  waiting to lock monitor 0x00007f610840dbc8 (object 0x0000000773f99930, a org.apache.activemq.ActiveMQConnection),
  which is held by &quot;ActiveMQ Connection Executor: tcp:///&amp;lt;ip address&amp;gt;:61616@51026&quot;

Java stack information for the threads listed above:
===================================================
&quot;ActiveMQ Connection Executor: tcp:///&amp;lt;ip address&amp;gt;:61616@51026&quot;:
        at org.apache.activemq.SimplePriorityMessageDispatchChannel.close(SimplePriorityMessageDispatchChannel.java:154)
        - waiting to lock &amp;lt;0x0000000773f00308&amp;gt; (a java.lang.Object)
        at org.apache.activemq.ActiveMQMessageConsumer.dispose(ActiveMQMessageConsumer.java:800)
        at org.apache.activemq.ActiveMQSession.dispose(ActiveMQSession.java:689)
        - locked &amp;lt;0x0000000773f003d8&amp;gt; (a org.apache.activemq.ActiveMQSession)
        at org.apache.activemq.ActiveMQConnection.close(ActiveMQConnection.java:659)
        - locked &amp;lt;0x0000000773f99930&amp;gt; (a org.apache.activemq.ActiveMQConnection)
        at org.springframework.jms.connection.SingleConnectionFactory.closeConnection(SingleConnectionFactory.java:456)
        at org.springframework.jms.connection.SingleConnectionFactory.resetConnection(SingleConnectionFactory.java:345)
        - locked &amp;lt;0x0000000773f9a590&amp;gt; (a java.lang.Object)
        at org.springframework.jms.connection.CachingConnectionFactory.resetConnection(CachingConnectionFactory.java:207)
        at org.springframework.jms.connection.SingleConnectionFactory.onException(SingleConnectionFactory.java:323)
        at org.springframework.jms.connection.SingleConnectionFactory$AggregatedExceptionListener.onException(SingleConnectionFactory.java:673)
        - locked &amp;lt;0x0000000773f9a590&amp;gt; (a java.lang.Object)
        at org.apache.activemq.ActiveMQConnection$5.run(ActiveMQConnection.java:1976)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.Thread.run(Thread.java:745)
&quot;privateJmsInPriority.container-1&quot;:
        at org.apache.activemq.ActiveMQConnection.getScheduler(ActiveMQConnection.java:2519)
        - waiting to lock &amp;lt;0x0000000773f99930&amp;gt; (a org.apache.activemq.ActiveMQConnection)
        at org.apache.activemq.ActiveMQSession.getScheduler(ActiveMQSession.java:2074)
        at org.apache.activemq.ActiveMQMessageConsumer.rollback(ActiveMQMessageConsumer.java:1241)
        - locked &amp;lt;0x0000000773f01030&amp;gt; (a java.util.LinkedList)
        - locked &amp;lt;0x0000000773f00308&amp;gt; (a java.lang.Object)
        at org.apache.activemq.ActiveMQMessageConsumer$5.afterRollback(ActiveMQMessageConsumer.java:1032)
        at org.apache.activemq.TransactionContext.afterRollback(TransactionContext.java:157)
        at org.apache.activemq.TransactionContext.commit(TransactionContext.java:332)
        at org.apache.activemq.ActiveMQSession.commit(ActiveMQSession.java:561)
        at sun.reflect.GeneratedMethodAccessor897.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
        at java.lang.reflect.Method.invoke(Method.java:498)
        at org.springframework.jms.connection.CachingConnectionFactory$CachedSessionInvocationHandler.invoke(CachingConnectionFactory.java:386)
        at com.sun.proxy.$Proxy49.commit(Unknown Source)
        at org.springframework.jms.support.JmsUtils.commitIfNecessary(JmsUtils.java:217)
        at org.springframework.jms.listener.AbstractMessageListenerContainer.commitIfNecessary(AbstractMessageListenerContainer.java:761)
        at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:665)
        at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:319)
        at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:257)
        at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1166)
        at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1158)
        at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:1055)
        at java.lang.Thread.run(Thread.java:745)

Found 1 deadlock.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="13066004">AMQ-6660</key>
            <summary>Deadlock closing a connection due to an exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="dgplexxi">Dan Groves</reporter>
                        <labels>
                    </labels>
                <created>Fri, 21 Apr 2017 21:23:05 +0000</created>
                <updated>Tue, 29 Jun 2021 22:05:16 +0000</updated>
                            <resolved>Fri, 25 Jun 2021 15:40:34 +0000</resolved>
                                    <version>5.16.1</version>
                                    <fixVersion>5.16.3</fixVersion>
                    <fixVersion>5.17.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="15979422" author="tabish121" created="Fri, 21 Apr 2017 21:30:56 +0000"  >&lt;p&gt;5.8.0 is rather ancient, have you tried with a current release?&lt;/p&gt;</comment>
                            <comment id="15979427" author="dgplexxi" created="Fri, 21 Apr 2017 21:33:30 +0000"  >&lt;p&gt;No, I have not tried that yet.  &lt;/p&gt;</comment>
                            <comment id="17244077" author="mattrpav" created="Fri, 4 Dec 2020 15:57:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dgplexxi&quot; class=&quot;user-hover&quot; rel=&quot;dgplexxi&quot;&gt;dgplexxi&lt;/a&gt; This issue is being marked close-pending and will be closed in 30 days if there is no response. This issue is most likely resolved in more recent releases than 5.8.0.&lt;/p&gt;

&lt;p&gt;Please test with a 5.15.14 or 5.16.0 release and report back if this is still an issue.&lt;/p&gt;</comment>
                            <comment id="17266126" author="mattrpav" created="Fri, 15 Jan 2021 15:40:39 +0000"  >&lt;p&gt;Closing this issue due to inactivity. To re-open, please test with 5.16.1 or newer.&lt;/p&gt;</comment>
                            <comment id="17313450" author="aweinstein" created="Thu, 1 Apr 2021 21:51:01 +0000"  >&lt;p&gt;Please re-open this ticket to investigate since we&apos;re seeing this deadlock again even after upgrading to 5.16.1:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;ActiveMQ Connection Executor: 
    tcp://********&quot;:

      waiting to lock monitor 0x00007fb9ec008898 (object 0x000000008512c448, a java.lang.Object),
  which is held by &quot;DefaultMessageListenerContainer-502&quot;
    

    &quot;DefaultMessageListenerContainer-502&quot;:

      waiting to lock monitor 0x00007fba440325e8 (object 0x0000000085048718, a org.apache.activemq.ActiveMQConnection),
  which is held by &quot;ActiveMQ Connection Executor: tcp://********&quot;

&quot;ActiveMQ Connection Executor: 
    tcp://********&quot;:

    	at org.apache.activemq.SimplePriorityMessageDispatchChannel.close(SimplePriorityMessageDispatchChannel.java:166)
	- waiting to lock &amp;lt;0x000000008512c448&amp;gt; (a java.lang.Object)
	at org.apache.activemq.ActiveMQMessageConsumer.dispose(ActiveMQMessageConsumer.java:859)
	at org.apache.activemq.ActiveMQSession.dispose(ActiveMQSession.java:729)
	- locked &amp;lt;0x000000008506fd50&amp;gt; (a org.apache.activemq.ActiveMQSession)
	at org.apache.activemq.ActiveMQConnection.close(ActiveMQConnection.java:671)
	- locked &amp;lt;0x0000000085048718&amp;gt; (a org.apache.activemq.ActiveMQConnection)
	at org.springframework.jms.connection.SingleConnectionFactory.closeConnection(SingleConnectionFactory.java:501)
	at org.springframework.jms.connection.SingleConnectionFactory.resetConnection(SingleConnectionFactory.java:389)
	- locked &amp;lt;0x000000008145d510&amp;gt; (a java.lang.Object)
	at org.springframework.jms.connection.CachingConnectionFactory.resetConnection(CachingConnectionFactory.java:205)
	at org.springframework.jms.connection.SingleConnectionFactory.onException(SingleConnectionFactory.java:367)
	at org.springframework.jms.connection.SingleConnectionFactory$AggregatedExceptionListener.onException(SingleConnectionFactory.java:721)
	at org.apache.activemq.ActiveMQConnection$5.run(ActiveMQConnection.java:1967)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.Thread.run(Thread.java:748)
    

    &quot;DefaultMessageListenerContainer-502&quot;:

    	at org.apache.activemq.ActiveMQConnection.getScheduler(ActiveMQConnection.java:2387)
	- waiting to lock &amp;lt;0x0000000085048718&amp;gt; (a org.apache.activemq.ActiveMQConnection)
	at org.apache.activemq.ActiveMQSession.getScheduler(ActiveMQSession.java:2250)
	at org.apache.activemq.ActiveMQMessageConsumer.rollback(ActiveMQMessageConsumer.java:1291)
	- locked &amp;lt;0x000000008512c5d0&amp;gt; (a java.util.LinkedList)
	- locked &amp;lt;0x000000008512c448&amp;gt; (a java.lang.Object)
	at org.apache.activemq.ActiveMQMessageConsumer$5.afterRollback(ActiveMQMessageConsumer.java:1094)
	at org.apache.activemq.TransactionContext.afterRollback(TransactionContext.java:162)
	at org.apache.activemq.TransactionContext.commit(TransactionContext.java:340)
	at org.apache.activemq.ActiveMQSession.commit(ActiveMQSession.java:582)
	at sun.reflect.GeneratedMethodAccessor101.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.jms.connection.CachingConnectionFactory$CachedSessionInvocationHandler.invoke(CachingConnectionFactory.java:383)
	at com.sun.proxy.$Proxy162.commit(Unknown Source)
	at org.springframework.jms.support.JmsUtils.commitIfNecessary(JmsUtils.java:218)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.commitIfNecessary(AbstractMessageListenerContainer.java:776)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:680)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:318)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:257)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1189)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1179)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:1076)
	at java.lang.Thread.run(Thread.java:748)


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="17369164" author="juanavelez" created="Fri, 25 Jun 2021 00:12:26 +0000"  >&lt;p&gt;We are experiencing the same issue as above using 5.16.1. This is caused by network instability similar to what the original poster experienced. Any help is greatly appreciated.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Found one Java-level deadlock:
=============================
&lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ Connection Executor: tcp:&lt;span class=&quot;code-comment&quot;&gt;//********&quot;&lt;/span&gt;:
&lt;/span&gt;  waiting to lock monitor 0x00007f9de400c838 (object 0x00000000878f5188, a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;),
  which is held by &lt;span class=&quot;code-quote&quot;&gt;&quot;DefaultMessageListenerContainer-73&quot;&lt;/span&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;DefaultMessageListenerContainer-73&quot;&lt;/span&gt;:
  waiting to lock monitor 0x00007f9de4010f18 (object 0x0000000084212820, a org.apache.activemq.ActiveMQConnection),
  which is held by &lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ Connection Executor: tcp:&lt;span class=&quot;code-comment&quot;&gt;//********&quot;&lt;/span&gt;Java stack information &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the threads listed above:
&lt;/span&gt;===================================================
&lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ Connection Executor: tcp:&lt;span class=&quot;code-comment&quot;&gt;//********&quot;&lt;/span&gt;:
&lt;/span&gt;	at org.apache.activemq.SimplePriorityMessageDispatchChannel.close(SimplePriorityMessageDispatchChannel.java:167)
	- waiting to lock &amp;lt;0x00000000878f5188&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
	at org.apache.activemq.ActiveMQMessageConsumer.dispose(ActiveMQMessageConsumer.java:859)
	at org.apache.activemq.ActiveMQSession.dispose(ActiveMQSession.java:729)
	- locked &amp;lt;0x0000000084837318&amp;gt; (a org.apache.activemq.ActiveMQSession)
	at org.apache.activemq.ActiveMQConnection.close(ActiveMQConnection.java:671)
	- locked &amp;lt;0x0000000084212820&amp;gt; (a org.apache.activemq.ActiveMQConnection)
	at org.springframework.jms.connection.SingleConnectionFactory.closeConnection(SingleConnectionFactory.java:501)
	at org.springframework.jms.connection.SingleConnectionFactory.resetConnection(SingleConnectionFactory.java:389)
	- locked &amp;lt;0x0000000081768c60&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
	at org.springframework.jms.connection.CachingConnectionFactory.resetConnection(CachingConnectionFactory.java:205)
	at org.springframework.jms.connection.SingleConnectionFactory.onException(SingleConnectionFactory.java:367)
	at org.springframework.jms.connection.SingleConnectionFactory$AggregatedExceptionListener.onException(SingleConnectionFactory.java:721)
	at org.apache.activemq.ActiveMQConnection$5.run(ActiveMQConnection.java:1967)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)
&lt;span class=&quot;code-quote&quot;&gt;&quot;DefaultMessageListenerContainer-73&quot;&lt;/span&gt;:
	at org.apache.activemq.ActiveMQConnection.getScheduler(ActiveMQConnection.java:2387)
	- waiting to lock &amp;lt;0x0000000084212820&amp;gt; (a org.apache.activemq.ActiveMQConnection)
	at org.apache.activemq.ActiveMQSession.getScheduler(ActiveMQSession.java:2250)
	at org.apache.activemq.ActiveMQMessageConsumer.rollback(ActiveMQMessageConsumer.java:1291)
	- locked &amp;lt;0x00000000878f5310&amp;gt; (a java.util.LinkedList)
	- locked &amp;lt;0x00000000878f5188&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
	at org.apache.activemq.ActiveMQMessageConsumer$5.afterRollback(ActiveMQMessageConsumer.java:1094)
	at org.apache.activemq.TransactionContext.afterRollback(TransactionContext.java:162)
	at org.apache.activemq.TransactionContext.commit(TransactionContext.java:340)
	at org.apache.activemq.ActiveMQSession.commit(ActiveMQSession.java:582)
	at sun.reflect.GeneratedMethodAccessor180.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.springframework.jms.connection.CachingConnectionFactory$CachedSessionInvocationHandler.invoke(CachingConnectionFactory.java:383)
	at com.sun.proxy.$Proxy162.commit(Unknown Source)
	at org.springframework.jms.support.JmsUtils.commitIfNecessary(JmsUtils.java:218)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.commitIfNecessary(AbstractMessageListenerContainer.java:776)
	at org.springframework.jms.listener.AbstractMessageListenerContainer.doExecuteListener(AbstractMessageListenerContainer.java:680)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.doReceiveAndExecute(AbstractPollingMessageListenerContainer.java:318)
	at org.springframework.jms.listener.AbstractPollingMessageListenerContainer.receiveAndExecute(AbstractPollingMessageListenerContainer.java:257)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.invokeListener(DefaultMessageListenerContainer.java:1189)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.executeOngoingLoop(DefaultMessageListenerContainer.java:1179)
	at org.springframework.jms.listener.DefaultMessageListenerContainer$AsyncMessageListenerInvoker.run(DefaultMessageListenerContainer.java:1076)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:748)Found 1 deadlock.

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="17369466" author="mattrpav" created="Fri, 25 Jun 2021 13:24:59 +0000"  >&lt;p&gt;Users reporting issues with 5.16.1&lt;/p&gt;</comment>
                            <comment id="17369509" author="christopher.l.shannon" created="Fri, 25 Jun 2021 14:42:14 +0000"  >&lt;p&gt;The culprit seems to be the synchronized block here: &lt;a href=&quot;https://github.com/apache/activemq/blob/activemq-5.16.1/activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java#L2386&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/activemq-5.16.1/activemq-client/src/main/java/org/apache/activemq/ActiveMQConnection.java#L2386&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The idea here seems to be to delay starting a new thread unless needed but the synchronized block is causing the issue. This could probably be fixed by creating the Scheduler object on connection creation to avoid needing to lock when calling getScheduler(). The call to start() could still be delayed until the first time it is needed because it&apos;s thread safe (uses compare/set)&#160;&lt;/p&gt;

&lt;p&gt;I can do a quick patch for this&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17369514" author="christopher.l.shannon" created="Fri, 25 Jun 2021 14:49:05 +0000"  >&lt;p&gt;On second thought I&apos;m going to probably just still delay object creation and use a different lock or CAS/Atomic to avoid locking on the connection because creating a Scheduler without any purpose would still create a fair amount of empty objects to clean up later for no reason&lt;/p&gt;</comment>
                            <comment id="17369548" author="jira-bot" created="Fri, 25 Jun 2021 15:37:36 +0000"  >&lt;p&gt;Commit 3f5abd4433d3dca911ac418d899346e7dd675b7b in activemq&apos;s branch refs/heads/main from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=3f5abd4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=3f5abd4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6660&quot; title=&quot;Deadlock closing a connection due to an exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6660&quot;&gt;&lt;del&gt;AMQ-6660&lt;/del&gt;&lt;/a&gt; - Use a separate lock for lazy scheduler creation to prevent&lt;br/&gt;
deadlocks&lt;/p&gt;

&lt;p&gt;Switch to using a dedicated lock to initialize the Scheduler object&lt;br/&gt;
inside of ActiveMQConnection to prevent a deadlock scenario that occurs&lt;br/&gt;
when using the intrinsic ActiveMQConnection lock. This is using double&lt;br/&gt;
checked locking so this lock will only be contended with during lazy&lt;br/&gt;
creation and then will rely on the volatile reference for future reads&lt;br/&gt;
and when stopping/closing.&lt;/p&gt;</comment>
                            <comment id="17369550" author="jira-bot" created="Fri, 25 Jun 2021 15:39:35 +0000"  >&lt;p&gt;Commit dc786edeccb55cc16facb73b48466b3ef55263fa in activemq&apos;s branch refs/heads/activemq-5.16.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=dc786ed&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=dc786ed&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6660&quot; title=&quot;Deadlock closing a connection due to an exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6660&quot;&gt;&lt;del&gt;AMQ-6660&lt;/del&gt;&lt;/a&gt; - Use a separate lock for lazy scheduler creation to prevent&lt;br/&gt;
deadlocks&lt;/p&gt;

&lt;p&gt;Switch to using a dedicated lock to initialize the Scheduler object&lt;br/&gt;
inside of ActiveMQConnection to prevent a deadlock scenario that occurs&lt;br/&gt;
when using the intrinsic ActiveMQConnection lock. This is using double&lt;br/&gt;
checked locking so this lock will only be contended with during lazy&lt;br/&gt;
creation and then will rely on the volatile reference for future reads&lt;br/&gt;
and when stopping/closing.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 3f5abd4433d3dca911ac418d899346e7dd675b7b)&lt;/p&gt;</comment>
                            <comment id="17369551" author="christopher.l.shannon" created="Fri, 25 Jun 2021 15:40:34 +0000"  >&lt;p&gt;Resolved by using a dedicated scheduler lock for the double-checked locking implementation on the scheduler initialization which will break the deadlock as the Connection lock won&apos;t be acquired anymore&lt;/p&gt;</comment>
                            <comment id="17371687" author="juanavelez" created="Tue, 29 Jun 2021 22:05:16 +0000"  >&lt;p&gt;Somehow I never got notifications about your posts/comments but I am glad to see that a fix took place. Thank you all for your help.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 20 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3dy9b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>