<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:05:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5315] NullPointerException in DemandForwardingBridgeSupport.collectBrokerInfos</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5315</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;We have seen the following NPE setting up a demand forwarding bridge&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.activemq.network.DemandForwardingBridgeSupport.collectBrokerInfos(DemandForwardingBridgeSupport.java:365) [activemq-broker-5.10.0.jar:5.10.0]
	at org.apache.activemq.network.DemandForwardingBridgeSupport.access$400(DemandForwardingBridgeSupport.java:105) [activemq-broker-5.10.0.jar:5.10.0]
	at org.apache.activemq.network.DemandForwardingBridgeSupport$5.run(DemandForwardingBridgeSupport.java:331) [activemq-broker-5.10.0.jar:5.10.0]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:1.7.0_60]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_60]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_60]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This occurred in one of our tests but only under load so seems to be a race condition of some sort.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12732737">AMQ-5315</key>
            <summary>NullPointerException in DemandForwardingBridgeSupport.collectBrokerInfos</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="leebutts">Lee Butts</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Aug 2014 01:20:46 +0000</created>
                <updated>Thu, 18 Dec 2014 00:27:56 +0000</updated>
                            <resolved>Fri, 29 Aug 2014 14:07:32 +0000</resolved>
                                    <version>5.10.0</version>
                                    <fixVersion>5.10.1</fixVersion>
                    <fixVersion>5.11.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14090199" author="leebutts" created="Fri, 8 Aug 2014 02:18:13 +0000"  >&lt;p&gt;Test logs of bridge failure&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2014-08-07 23:01:10,467       INFO  ceUtil-StartThread-1 o.a.a.broker.BrokerService     activemq.broker=testBroker-T1oFi-LDN-1 Apache ActiveMQ 5.10.0 (testBroker-T1oFi-LDN-1, ID:leeimac.local-57747-1407452432914-0:48) is starting
2014-08-07 23:01:10,467       INFO  ceUtil-StartThread-1 o.a.a.b.BrokerPluginSupport    activemq.broker=testBroker-T1oFi-LDN-1 Broker Plugin com.x.jms.AbstractActiveMQTest$BrokerEventListener started
2014-08-07 23:01:10,468       INFO  ceUtil-StartThread-1 t.TransportServerThreadSupport activemq.broker=testBroker-T1oFi-LDN-1 Listening &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; connections at: tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:57986?socket.tcpNoDelay=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;soTimeout=60000&amp;amp;closeAsync=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/span&gt;2014-08-07 23:01:10,468       INFO  ceUtil-StartThread-1 o.a.a.b.TransportConnector     activemq.broker=testBroker-T1oFi-LDN-1 Connector tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:57986?socket.tcpNoDelay=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;soTimeout=60000&amp;amp;closeAsync=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; started
&lt;/span&gt;2014-08-07 23:01:10,468       INFO  ceUtil-StartThread-1 .a.n.DiscoveryNetworkConnector activemq.broker=testBroker-T1oFi-LDN-1 Establishing network connection from vm:&lt;span class=&quot;code-comment&quot;&gt;//testBroker-T1oFi-LDN-1?async=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;network=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; to tcp://localhost:57985?socket.tcpNoDelay=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;soTimeout=60000&amp;amp;closeAsync=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/span&gt;2014-08-07 23:01:10,469       INFO  ceUtil-StartThread-1 o.a.a.b.TransportConnector     activemq.broker=testBroker-T1oFi-LDN-1 Connector vm:&lt;span class=&quot;code-comment&quot;&gt;//testBroker-T1oFi-LDN-1 started
&lt;/span&gt;2014-08-07 23:01:10,470       INFO  ceUtil-StartThread-1 o.a.a.network.NetworkConnector activemq.broker=testBroker-T1oFi-LDN-1 Network Connector DiscoveryNetworkConnector:NC-LOCAL-localhost:BrokerService[testBroker-T1oFi-LDN-1] started
2014-08-07 23:01:10,470       INFO  ceUtil-StartThread-1 .a.n.DiscoveryNetworkConnector activemq.broker=testBroker-T1oFi-LDN-1 Establishing network connection from vm:&lt;span class=&quot;code-comment&quot;&gt;//testBroker-T1oFi-LDN-1?async=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;network=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; to failover:(tcp://localhost:57987,tcp://localhost:57988)?nested.socket.tcpNoDelay=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;amp;nested.soTimeout=60000&amp;amp;nested.closeAsync=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;randomize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;maxReconnectAttempts=0
&lt;/span&gt;2014-08-07 23:01:10,471       INFO  ceUtil-StartThread-1 o.a.a.network.NetworkConnector activemq.broker=testBroker-T1oFi-LDN-1 Network Connector DiscoveryNetworkConnector:NC-WAN-NYC-DefaultDynamic-0:BrokerService[testBroker-T1oFi-LDN-1] started
2014-08-07 23:01:10,471       INFO  ceUtil-StartThread-1 o.a.a.broker.BrokerService     activemq.broker=testBroker-T1oFi-LDN-1 Apache ActiveMQ 5.10.0 (testBroker-T1oFi-LDN-1, ID:leeimac.local-57747-1407452432914-0:48) started
2014-08-07 23:01:10,471       INFO  ceUtil-StartThread-1 o.a.a.broker.BrokerService     activemq.broker=testBroker-T1oFi-LDN-1 For help or more information please see: http:&lt;span class=&quot;code-comment&quot;&gt;//activemq.apache.org
&lt;/span&gt;2014-08-07 23:01:10,471       WARN  ceUtil-StartThread-1 o.a.a.broker.BrokerService     activemq.broker=testBroker-T1oFi-LDN-1 Store limit is 102400 mb (current store usage is 0 mb). The data directory: /&lt;span class=&quot;code-keyword&quot;&gt;var&lt;/span&gt;/folders/zd/s8yvndzs0tb08zq2hbm5h89r0000gn/T/testBroker-T1oFi-LDN-1/testBroker-T1oFi-LDN-1/KahaDB only has 38816 mb of usable space - resetting to maximum available disk space: 38816 mb
2014-08-07 23:01:10,471       ERROR ActiveMQ Task-1      o.a.a.t.f.FailoverTransport    activemq.broker=testBroker-T1oFi-LDN-1 Failed to connect to [tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:57987, tcp://localhost:57988] after: 1 attempt(s)
&lt;/span&gt;2014-08-07 23:01:10,472       INFO  oker-T1oFi-LDN-1#190 .DemandForwardingBridgeSupport activemq.broker=testBroker-T1oFi-LDN-1 Network connection between vm:&lt;span class=&quot;code-comment&quot;&gt;//testBroker-T1oFi-LDN-1#190 and tcp://localhost/127.0.0.1:57985@57994 (testBroker-T1oFi-LDN-0) has been established.
&lt;/span&gt;2014-08-07 23:01:10,472       INFO  oker-T1oFi-LDN-1#192 .DemandForwardingBridgeSupport activemq.broker=testBroker-T1oFi-LDN-1 Network connection between vm:&lt;span class=&quot;code-comment&quot;&gt;//testBroker-T1oFi-LDN-1#192 and unconnected shutdown due to a local error: {}
&lt;/span&gt;java.lang.NullPointerException: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.activemq.network.DemandForwardingBridgeSupport.collectBrokerInfos(DemandForwardingBridgeSupport.java:365) [activemq-broker-5.10.0.jar:5.10.0]
	at org.apache.activemq.network.DemandForwardingBridgeSupport.access$400(DemandForwardingBridgeSupport.java:105) [activemq-broker-5.10.0.jar:5.10.0]
	at org.apache.activemq.network.DemandForwardingBridgeSupport$5.run(DemandForwardingBridgeSupport.java:331) [activemq-broker-5.10.0.jar:5.10.0]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145) [na:1.7.0_60]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615) [na:1.7.0_60]
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745) [na:1.7.0_60]
2014-08-07 23:01:10,472       INFO  -T1oFi-LDN-1] Task-3 .DemandForwardingBridgeSupport activemq.broker=testBroker-T1oFi-LDN-1 testBroker-T1oFi-LDN-1 bridge to Unknown stopped
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14090994" author="tabish121" created="Fri, 8 Aug 2014 17:28:29 +0000"  >&lt;p&gt;One case that looks like a possibility is in the collectBrokerInfos method:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            remoteBrokerInfo = futureRemoteBrokerInfo.get();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (remoteBrokerInfo == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                fireBridgeFailed();
            }
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
            serviceRemoteException(e);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;we should probably be returning after the call to fireBridgeFailed otherwise the method would continue on with the remoteBrokerInfo being null which could lead to this error.  The futureRemoteBrokerInfo future is cancelled in transport listener set in the start method.  &lt;/p&gt;</comment>
                            <comment id="14091047" author="tabish121" created="Fri, 8 Aug 2014 17:58:00 +0000"  >&lt;p&gt;Added a fix for an NPE case&lt;/p&gt;</comment>
                            <comment id="14092975" author="morogan" created="Mon, 11 Aug 2014 16:55:54 +0000"  >&lt;p&gt;That results in a different NPE at:&lt;/p&gt;

&lt;p&gt;as the idGeneratory will be null, usually set org/apache/activemq/network/DemandForwardingBridgeSupport.java:383 or org/apache/activemq/network/DemandForwardingBridgeSupport.java:385&lt;/p&gt;

&lt;p&gt;java.lang.NullPointerException: null&lt;br/&gt;
        at org.apache.activemq.network.DemandForwardingBridgeSupport.startLocalBridge(DemandForwardingBridgeSupport.java:441) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-broker-5.10.0-MAHI.jar:5.10.0-MAHI&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.activemq.network.DemandForwardingBridgeSupport.doStartLocalAndRemoteBridges(DemandForwardingBridgeSupport.java:422) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-broker-5.10.0-MAHI.jar:5.10.0-MAHI&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.activemq.network.DemandForwardingBridgeSupport.access$500(DemandForwardingBridgeSupport.java:105) &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-broker-5.10.0-MAHI.jar:5.10.0-MAHI&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="14092994" author="tabish121" created="Mon, 11 Aug 2014 17:12:36 +0000"  >&lt;p&gt;Suggest you work on a unit test that can reproduce otherwise we will just keep stabbing in the dark. &lt;/p&gt;</comment>
                            <comment id="14113226" author="leebutts" created="Thu, 28 Aug 2014 02:20:02 +0000"  >&lt;p&gt;Unit test attached, recreates NPE in log output&lt;/p&gt;</comment>
                            <comment id="14115265" author="tabish121" created="Fri, 29 Aug 2014 14:07:32 +0000"  >&lt;p&gt;Should be fixed now, thanks for the test case. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12664802" name="BridgeNPETest.java" size="5226" author="leebutts" created="Thu, 28 Aug 2014 02:20:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>410765</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yo5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>410758</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>