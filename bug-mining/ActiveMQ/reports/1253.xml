<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:50:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3353] Durable subscribers on durable topics don&apos;t receive messages after network disconnect</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3353</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I&apos;ve set up a durable topic with the default (persistent) delivery mode on one machine that is publishing a simple text message every 5 seconds. I created a durable subscriber that consumes messages published to the above topic on another machine. I am using broker to broker communication between the two machines.&lt;br/&gt;
I start up the two programs on either machine and see the messages coming through to the subscriber. If I then pull the network cable to disconnect the network between the two machines, wait for a minute and then plug it back in, my subscriber doesn&apos;t receive the messages any more. I can see from the output that the publisher is still publishing them (Temporary topics, non-durable queues all continue to sync up in our production environment, it is only the durable topics that don&apos;t work after network reconnect)&lt;/p&gt;

&lt;p&gt;If I were to tweak a setting on the publisher&apos;s broker (that was introduced only in 5.5.0), suppressDuplicateTopicSubscriptions=false, then the topics work correctly after network reconnect. But this may have other unintended consequences and I was hoping to get a better idea of:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;is this a known issue ? if so, then are there any specific challenges that have caused it not to be fixed?&lt;/li&gt;
	&lt;li&gt;are other people out there using durable topics and subscribers without a failover option that have run into this problem? What have they done to work around?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Here is how my subscriber and publisher are set up:&lt;br/&gt;
Topic Publisher (Machine 1)&lt;br/&gt;
        publisherConnection = connFactory.createConnection();&lt;br/&gt;
        publisherConnection.setClientID( &quot;ProducerCliID&quot; );&lt;br/&gt;
        publisherConnection.start();&lt;/p&gt;

&lt;p&gt;        session = publisherConnection.createSession( true, -1 );&lt;br/&gt;
        Destination producerTopic = session.createTopic( TEST_TOPIC_NAME );&lt;br/&gt;
        producer = session.createProducer( (Topic)producerTopic );&lt;br/&gt;
....&lt;br/&gt;
....&lt;br/&gt;
....&lt;br/&gt;
    // On a timer, keep sending this out every 5 seconds&lt;br/&gt;
                 String text = &quot;HELLO &quot; + count++;&lt;br/&gt;
                TextMessage msg = session.createTextMessage( text );&lt;br/&gt;
                System.out.println( &quot;Sending TextMessage = &quot; + msg.getText() );&lt;br/&gt;
                producer.send( msg );&lt;br/&gt;
                session.commit();&lt;/p&gt;

&lt;p&gt;Subscriber ( Machine 2):&lt;br/&gt;
        Connection clientConnection = connFactory.createConnection();&lt;br/&gt;
        clientConnection.setClientID(&quot;cliID&quot;);&lt;br/&gt;
        clientConnection.start();&lt;br/&gt;
        Session session = clientConnection.createSession( false, Session.AUTO_ACKNOWLEDGE );&lt;/p&gt;

&lt;p&gt;        Destination topic = session.createTopic( topicName );&lt;br/&gt;
        MessageConsumer subscriber = session.createDurableSubscriber( (Topic)topic, &quot;subName&quot; );&lt;/p&gt;

&lt;p&gt;        TestMessageListener msgListener = new TestMessageListener( 1000 );&lt;br/&gt;
        subscriber.setMessageListener( msgListener );&lt;br/&gt;
.....&lt;br/&gt;
.....&lt;br/&gt;
         // TestMessageListener&apos;s onMessage method simply outputs the message:&lt;br/&gt;
        public void onMessage(Message message)&lt;br/&gt;
        {&lt;br/&gt;
            if ( message instanceof TextMessage )&lt;/p&gt;
            {
                System.out.println( &quot;Message received = &quot; + ((TextMessage)message) );
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;I can provide the jars for you to run the program if need be.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows &amp;amp; Linux&lt;br/&gt;
JDK 1.6&lt;/p&gt;</environment>
        <key id="12509120">AMQ-3353</key>
            <summary>Durable subscribers on durable topics don&apos;t receive messages after network disconnect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="sfali16">Syed Faraz Ali</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Jun 2011 19:31:20 +0000</created>
                <updated>Thu, 28 Mar 2013 14:26:44 +0000</updated>
                            <resolved>Wed, 21 Mar 2012 10:33:06 +0000</resolved>
                                    <version>5.3.1</version>
                    <version>5.5.0</version>
                                    <fixVersion>5.6.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>9</watches>
                                                                                                                <comments>
                            <comment id="13050356" author="acalvo" created="Thu, 16 Jun 2011 11:28:23 +0000"  >&lt;p&gt;same problem here.&lt;/p&gt;

&lt;p&gt;Tried with 5.4.2, 5.5.0, 5.6.0-SNAPSHOT and still having the same issue.&lt;/p&gt;

&lt;p&gt;I&apos;ve set up an environment with two brokers, and the producer and consumer provided in the example directory using durable topics.&lt;/p&gt;

&lt;p&gt;After being disconnected for more than 1m, brokers are able to reconnect but consumer seems to be in an offline state which don&apos;t pending messages.&lt;br/&gt;
However, upon restarting the consumer, it&apos;d get all pending messages.&lt;/p&gt;

&lt;p&gt;Is there some kind of timeout between the consumer and the broker?&lt;/p&gt;</comment>
                            <comment id="13053944" author="joeniski" created="Thu, 23 Jun 2011 16:07:33 +0000"  >&lt;p&gt;i also have this problem on AMQ 5.3.0 (in production), and in our AMQ 5.4.2 test environment (both on 32-bit RedHat Enterprise Linux, v.5.5). &lt;/p&gt;

&lt;p&gt;We have a store &amp;amp; forward network of brokers, much like the back-office/retail store example in ActiveMQ in Action. i use a duplexed networkConnector on the subscribers, with durable topic subscriptions. Queues and topics are defined as &amp;lt;dynamicallyIncludedDestinations&amp;gt; in the &amp;lt;networkConnector&amp;gt; configuration.&lt;/p&gt;

&lt;p&gt;After a disconnect, i can see the brokers reconnecting in both the publisher&apos;s and subscribers&apos; logs. Also, the AMQ web console on the publisher continues to show the durable ssubscriptions as on-line. But topic messages published during/after the outage aren&apos;t picked up unless i restart the subscriber broker.&lt;/p&gt;

&lt;p&gt;Furthermore, queue messages &lt;b&gt;do&lt;/b&gt; flow successfully between the two brokers after the reconnect.&lt;/p&gt;

&lt;p&gt;i&apos;ve added &quot;keepAlive=true&quot; and &quot;useExponentialBackoff=false&quot; to the URIs for my openwire and ssl transportConnectors, but neither setting has made any difference in the problem behavior.&lt;/p&gt;

&lt;p&gt;Our current work-around is to monitor the message counts on publisher&apos;s and subscriber&apos;s topics, send an alert to our sysadmin team when they get out of synch, and manually restart the subscriber.&lt;/p&gt;

&lt;p&gt;It&apos;s a relief to know that i&apos;m not the only one...&lt;/p&gt;</comment>
                            <comment id="13060344" author="acalvo" created="Wed, 6 Jul 2011 07:46:54 +0000"  >&lt;p&gt;(initial) JUnit case&lt;/p&gt;</comment>
                            <comment id="13060410" author="gtully" created="Wed, 6 Jul 2011 08:55:05 +0000"  >&lt;p&gt;Andreas, thanks for the unit test. It has 32 tests in it (with all the variations), is that expected? I am giving it a run to see what it produces.&lt;/p&gt;</comment>
                            <comment id="13060412" author="acalvo" created="Wed, 6 Jul 2011 08:59:26 +0000"  >&lt;p&gt;Gary,&lt;br/&gt;
We set up a bunch of options, such as failover over static, dynamic only, maxInactivity on wireFormat, and so on.&lt;br/&gt;
It should work always, but some are failing.&lt;/p&gt;

&lt;p&gt;Moreover, it also performs a close or pause on the socket to simulate the network drop. &lt;/p&gt;</comment>
                            <comment id="13060448" author="acalvo" created="Wed, 6 Jul 2011 09:45:27 +0000"  >&lt;p&gt;surefire report&lt;/p&gt;</comment>
                            <comment id="13060452" author="acalvo" created="Wed, 6 Jul 2011 10:03:24 +0000"  >&lt;p&gt;we found out that it is able to recover while performing a socket.pause() but not with a socket.close() (which, by the way, is the closest behavior that we expect)&lt;/p&gt;</comment>
                            <comment id="13060470" author="gtully" created="Wed, 6 Jul 2011 10:45:29 +0000"  >&lt;p&gt;the problem is the default value for setSuppressDuplicateTopicSubscriptions.&lt;/p&gt;

&lt;p&gt;In the test, add &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;connector.setSuppressDuplicateTopicSubscriptions(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; to &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; org.apache.activemq.usecases.DurableSubscriberWithNetworkDisconnectTest#bridgeBrokers&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That option was added for cyclic network topologies, where there are more than one route to a broker. But it should ignore durable subscriptions as they are already unique based on their subscription id.&lt;/p&gt;</comment>
                            <comment id="13060475" author="acalvo" created="Wed, 6 Jul 2011 11:02:43 +0000"  >&lt;p&gt;We&apos;re concerned about the cyclic topology with a network of brokers.&lt;br/&gt;
If a durable topic subscription is requested more than once on the same broker, will ignore it?&lt;br/&gt;
thanks!&lt;/p&gt;</comment>
                            <comment id="13060527" author="gtully" created="Wed, 6 Jul 2011 12:18:48 +0000"  >&lt;p&gt;yes, durable subs must be unique based on their connection id and subscriber name. A duplicate will be suppressed. Validated with a variation on the duplicate suppression test.&lt;br/&gt;
Am going to ensure that setSuppressDuplicateTopicSubscriptions ignores duplicate subs, such that it does not get in the way of normal durable sub reconnect, where the networked durable sub is offline pending a reconnect.&lt;/p&gt;</comment>
                            <comment id="13064022" author="gtully" created="Tue, 12 Jul 2011 17:27:49 +0000"  >&lt;p&gt;Thinking more on this, the failover: protocol on a client is relevant here in that the networkConsumerId on a consumer advisory will be the same in the failover case, and different in the not failover case. this is distinct from the subscriberName:clientId pair. It may be that the networkConsumerId needs to be composed of the subscriberName:clientId for durable subs to properly implement duplicate subscription suppression.  &lt;/p&gt;</comment>
                            <comment id="13196067" author="acalvo" created="Mon, 30 Jan 2012 11:50:15 +0000"  >&lt;p&gt;@Gary&lt;br/&gt;
We are still trying to figure out this issue.&lt;br/&gt;
Using the latest SNAPSHOT for 5.6 doesn&apos;t solve it.&lt;br/&gt;
Our main concern is that using a NoB with static connections (and creating the responder from the central broker with duplex from the embedded broker) seems to throw an error.&lt;br/&gt;
However, using failover does not throw an error, but does not work either.&lt;/p&gt;

&lt;p&gt;PS: NoB architecture is hub-and-spoke using embedded brokers&lt;br/&gt;
broker 1 (embedded) &amp;lt; - &amp;gt; central broker &amp;lt; - &amp;gt; broker 2 (embedded)&lt;/p&gt;</comment>
                            <comment id="13196070" author="joeniski" created="Mon, 30 Jan 2012 11:53:08 +0000"  >&lt;p&gt;Greetings:&lt;/p&gt;

&lt;p&gt;As of Friday, 16 December, i&apos;m no longer working at NWEA.&lt;/p&gt;

&lt;p&gt;If you need assistance with Web-based MAP messaging, please contact Scott Dietrich (scott.dietreich@nwea.org) or Aaron Zoller (aaron.zoller@nwea.org).&lt;/p&gt;

&lt;p&gt;Kind regards,&lt;br/&gt;
Joe&lt;/p&gt;</comment>
                            <comment id="13196071" author="joeniski" created="Mon, 30 Jan 2012 11:53:10 +0000"  >&lt;p&gt;Greetings:&lt;/p&gt;

&lt;p&gt;As of Friday, 16 December, i&apos;m no longer working at NWEA.&lt;/p&gt;

&lt;p&gt;If you need assistance with Web-based MAP messaging, please contact Scott Dietrich (scott.dietreich@nwea.org) or Aaron Zoller (aaron.zoller@nwea.org).&lt;/p&gt;

&lt;p&gt;Kind regards,&lt;br/&gt;
Joe&lt;/p&gt;</comment>
                            <comment id="13198704" author="gtully" created="Thu, 2 Feb 2012 11:30:20 +0000"  >&lt;p&gt;@Andreas, so where do we stand?&lt;br/&gt;
Do you have a variant of the test that shows the problem you are seeing that I can play with? Ie: a variant of the current test (DurableSubscriberWithNetworkDisconnectTest) from trunk that will fail? Please attach it to this jira if you do.&lt;/p&gt;</comment>
                            <comment id="13234259" author="gtully" created="Wed, 21 Mar 2012 10:33:07 +0000"  >&lt;p&gt;resolving pending additional unit test that shows that there still is a problem.&lt;/p&gt;</comment>
                            <comment id="13284802" author="acalvo" created="Tue, 29 May 2012 13:22:44 +0000"  >&lt;p&gt;@Gary,&lt;br/&gt;
We&apos;re still having the same issue.&lt;br/&gt;
It has become critical since it affects the brokers in a newtork of brokers when one of them is &quot;pulled out&quot; of the network and reconnected back after the inactivity timeout.&lt;br/&gt;
We&apos;ll try to update our test case with the latest stable release of 5.6 and report back.&lt;/p&gt;

&lt;p&gt;A small snippet of the output after the client is being reconnected (removed broker pluged into the network):&lt;br/&gt;
jvm 1    |  INFO | brokerA Shutting down&lt;br/&gt;
jvm 1    |  WARN | Could not start network bridge between: vm://brokerA?async=false&amp;amp;network=true and: ssl://10.4.0.164:61616 due to: java.net.SocketTimeoutException: connect timed out&lt;br/&gt;
jvm 1    |  INFO | Establishing network connection from vm://brokerA?async=false&amp;amp;network=true to ssl://10.4.0.164:61616&lt;br/&gt;
jvm 1    |  INFO | Network connection between vm://brokerA#42 and ssl://10.4.0.164/10.4.0.164:61616(brokerB) has been established.&lt;/p&gt;

&lt;p&gt;Notice how it is identified as connected it is not show as a durable subscriber in the topic.&lt;/p&gt;</comment>
                            <comment id="13288566" author="acalvo" created="Mon, 4 Jun 2012 13:49:04 +0000"  >&lt;p&gt;Use Case updated to stable ActiveMQ 5.6.&lt;br/&gt;
Notice how the timeout parameter in the failover transport protocol has changed and now is using -1 instead of 0&lt;/p&gt;</comment>
                            <comment id="13288572" author="tabish121" created="Mon, 4 Jun 2012 14:07:52 +0000"  >&lt;p&gt;Tried you new test case against the latest trunk SNAPSHOT and it passes.  There&apos;s been a couple recent fixes since 5.6.0 for issues that could affect durable consumers so you may want to try out a 5.7-SNAPSHOT.&lt;/p&gt;</comment>
                            <comment id="13289222" author="acalvo" created="Tue, 5 Jun 2012 07:46:44 +0000"  >&lt;p&gt;New test with 3 combinations for the maxReconnectAttemps (0,1 and -1).&lt;br/&gt;
It fails 13 out of 24.&lt;br/&gt;
Using 5.7-SNAPSHOT.&lt;/p&gt;

&lt;p&gt;Repository Root: &lt;a href=&quot;https://svn.apache.org/repos/asf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf&lt;/a&gt;&lt;br/&gt;
Repository UUID: 13f79535-47bb-0310-9956-ffa450edef68&lt;br/&gt;
Revision: 1346054&lt;br/&gt;
Node Kind: directory&lt;br/&gt;
Schedule: normal&lt;br/&gt;
Last Changed Author: gtully&lt;br/&gt;
Last Changed Rev: 1345202&lt;br/&gt;
Last Changed Date: 2012-06-01 16:32:50 +0200 (Fri, 01 Jun 2012)&lt;/p&gt;</comment>
                            <comment id="13294334" author="acalvo" created="Wed, 13 Jun 2012 10:38:31 +0000"  >&lt;p&gt;To discard a bad implementation of the process, I&apos;ve reproduced the problem using the examples provided in the stable release.&lt;br/&gt;
I&apos;ve had to modify the java code for both the ConsumerTool and ProducerTool to add a string property with the sender string.&lt;br/&gt;
I am reusing the producerClientId parameter to set the sender name.&lt;br/&gt;
The file example.tar.gz contains the example directory from ActiveMQ-5.6 stable release with the modified files.&lt;/p&gt;

&lt;p&gt;The instructions.txt contains a detailed description of the process used.&lt;/p&gt;</comment>
                            <comment id="13449772" author="anavarrog" created="Thu, 6 Sep 2012 16:15:38 +0000"  >&lt;p&gt;As Andreas Calvo pointed in post: &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-3353?focusedCommentId=13294334&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13294334&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-3353?focusedCommentId=13294334&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13294334&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;this problem is already present in activemq 5.6, it&apos;s not fixed, I don&apos;t understand why it&apos;s closed, I&apos;m affected too, exactly the same situation Andreas is experiencing.&lt;/p&gt;

&lt;p&gt;Andreas?, is it fixed for you?.&lt;/p&gt;</comment>
                            <comment id="13586149" author="noelady" created="Mon, 25 Feb 2013 19:05:59 +0000"  >&lt;p&gt;We have been experiencing this same issue on 5.7.0. When AMQ server is rebooted all clients reconnect as expected. However durable subscribers show as active but the consumer is not pulling new messages. You can see on the subscribers page, messages are being en-queued to the durable sub but not being de-queued. It has caused some expensive mistakes recently. Havng read through the above , I am still unclear on what the best workaround is or if a fix is in progress? &lt;/p&gt;</comment>
                            <comment id="13586360" author="gtully" created="Mon, 25 Feb 2013 22:09:53 +0000"  >&lt;p&gt;peek at the test case that works on trunk: &lt;a href=&quot;https://github.com/apache/activemq/blob/trunk/activemq-unit-tests/src/test/java/org/apache/activemq/usecases/DurableSubscriberWithNetworkDisconnectTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/trunk/activemq-unit-tests/src/test/java/org/apache/activemq/usecases/DurableSubscriberWithNetworkDisconnectTest.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;note how it is configured.&lt;br/&gt;
To demonstrate a bug, please make some changes to that test case or add some additional scenarios and then reopen this issue if it breaks.&lt;/p&gt;</comment>
                            <comment id="13586381" author="acalvo" created="Mon, 25 Feb 2013 22:31:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;,&lt;br/&gt;
Thanks for the quick reply.&lt;br/&gt;
However, although when I made the test it failed (and now it doesn&apos;t), I don&apos;t think it captures truly the situation.&lt;br/&gt;
Using a proxy can throw the Inactivity Monitor (even if it&apos;s paused or closed), but it does not capture an abrupt stop of the broker or it&apos;s connections.&lt;br/&gt;
While doing more tests in the lab, throwing a socket disconnect error (that means, unplugging the network cable) seems to, as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=noelady&quot; class=&quot;user-hover&quot; rel=&quot;noelady&quot;&gt;noelady&lt;/a&gt; expressed, leave the durable subscribers in a zombie state: they seem to exists and receive packages, but aren&apos;t able to dequeue anything.&lt;br/&gt;
This fails as of ActiveMQ 5.7, haven&apos;t tested yet on 5.8.&lt;/p&gt;

&lt;p&gt;If there is any way to cause a socket disconnect error programmatically, it may give us a hint.&lt;/p&gt;

&lt;p&gt;I may note that, while using ActiveMQ the results are really bad, using fuse-09-16 seems to give better results.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="13586449" author="noelady" created="Mon, 25 Feb 2013 23:20:05 +0000"  >&lt;p&gt;Thanks Gary. I can confirm my results are as Andreas Calvo previously stated. The situation occurs when you pull the network plug (or do a reboot on the hosting operating system). The problem does not occur when you stop and restart the activemq broker.Although as Andreas, I have not tried this against 5.8.0. I noticed there is a fix in 5.8.0 regarding durable subs, but specifically to offline deletions. I intend to run tests against this version before re-opening this bug.&lt;/p&gt;</comment>
                            <comment id="13587208" author="gtully" created="Tue, 26 Feb 2013 15:48:41 +0000"  >&lt;p&gt;There is a test case that simulates a very flaky network by randomly closing the socket locally. It uses a tcpfaulty://.. transport.&lt;br/&gt;
see: org.apache.activemq.usecases.MulticastDiscoveryOnFaultyNetworkTest&lt;/p&gt;

&lt;p&gt;Maybe you can use some variant of that to reproduce in a unit test.&lt;br/&gt;
When the network cable is unpluged, there is a delay in getting socket feedback that depends on the tcp stack settings for timeouts and retries. So from a java app perspective, connections that are half closed can appear valid for some period. Whatever the case, the broker should be able to deal with it though, and once the tcp stack reports the real state of the network, things should come back to normal. &lt;/p&gt;</comment>
                            <comment id="13616202" author="alin_aron_oana@yahoo.ca" created="Thu, 28 Mar 2013 12:07:09 +0000"  >&lt;p&gt;I&apos;m seeing the exact same behavior when using a javax.jms.MessageConsumer.&lt;br/&gt;
Whenever I&apos;m powering off or unplugging the master broker machine,The slave broker will take over the master role but the  consumers will not reconnect to the new master broker.&lt;br/&gt;
There are no logged errors or other type of messages on the consumer side. The consumer behaves like it is still connected to the previous master instance and it is waiting for the messages to arrive in the queue.  &lt;/p&gt;

&lt;p&gt;I was thinking of implementing a thread on my consumer side which will query the JMS connection from time to time, hopefully this way the fail-over mechanism will kick in. Although I&apos;m not convinced that this is the right approach.&lt;/p&gt;

&lt;p&gt;The broker URL I&apos;m using is: &lt;br/&gt;
failover:(tcp://server1:61616?keepAlive=true&amp;amp;wireFormat.maxInactivityDuration=0,tcp://server2:61616?keepAlive=true&amp;amp;wireFormat.maxInactivityDuration=0)?randomize=false&amp;amp;updateURIsSupported=false&amp;amp;jms.prefetchPolicy.all=1&lt;/p&gt;


&lt;p&gt;The ActiveMQ version I&apos;m using is 5.8.0&lt;br/&gt;
The client side libraries were 5.4.2, 5.7.0 and 5.8.0&lt;/p&gt;</comment>
                            <comment id="13616287" author="tabish121" created="Thu, 28 Mar 2013 14:26:44 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;wireFormat.maxInactivityDuration=0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Turns off the built in keep alive functionality and the default TCP keepalive is usually two hours so you&apos;d need to tune the OS to rely on that.  Why not just turn on the standard inactivity monitoring instead of trying to reinvent the wheel?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12530913" name="DurableSubscriberWithNetworkDisconnectTest.java" size="9807" author="acalvo" created="Tue, 5 Jun 2012 07:46:43 +0000"/>
                            <attachment id="12530778" name="DurableSubscriberWithNetworkDisconnectTest.java" size="9576" author="acalvo" created="Mon, 4 Jun 2012 13:49:04 +0000"/>
                            <attachment id="12485386" name="DurableSubscriberWithNetworkDisconnectTest.java" size="9347" author="acalvo" created="Wed, 6 Jul 2011 07:46:54 +0000"/>
                            <attachment id="12530912" name="TEST-org.apache.activemq.usecases.DurableSubscriberWithNetworkDisconnectTest.xml" size="491468" author="acalvo" created="Tue, 5 Jun 2012 07:46:42 +0000"/>
                            <attachment id="12485397" name="TEST-org.apache.activemq.usecases.DurableSubscriberWithNetworkDisconnectTest.xml" size="66277" author="acalvo" created="Wed, 6 Jul 2011 09:45:27 +0000"/>
                            <attachment id="12531946" name="embedded1.xml" size="4164" author="acalvo" created="Wed, 13 Jun 2012 10:38:31 +0000"/>
                            <attachment id="12531947" name="embedded2.xml" size="4165" author="acalvo" created="Wed, 13 Jun 2012 10:38:31 +0000"/>
                            <attachment id="12531948" name="example.tar.gz" size="19762" author="acalvo" created="Wed, 13 Jun 2012 10:38:31 +0000"/>
                            <attachment id="12531949" name="instructions.txt" size="2188" author="acalvo" created="Wed, 13 Jun 2012 10:38:31 +0000"/>
                            <attachment id="12531950" name="standalone1.xml" size="4151" author="acalvo" created="Wed, 13 Jun 2012 10:38:31 +0000"/>
                            <attachment id="12531951" name="standalone2.xml" size="4145" author="acalvo" created="Wed, 13 Jun 2012 10:38:31 +0000"/>
                            <attachment id="12485398" name="test-results.ods" size="12655" author="acalvo" created="Wed, 6 Jul 2011 10:03:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14548</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 34 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ajav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59400</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>