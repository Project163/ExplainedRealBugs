<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:51:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3157] Garbage collecting inactive destinations does not work with queue mirroring</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3157</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When using the garbage collection feature of inactive queues, the queues are not collected if queue mirroring is turned on.  The following snippet shows a basic configuration for reproducing the problem:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&amp;lt;broker xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http://activemq.apache.org/schema/core&quot;&lt;/span&gt;
          brokerName=&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;
          dataDirectory=&lt;span class=&quot;code-quote&quot;&gt;&quot;${activemq.base}/data&quot;&lt;/span&gt;
          destroyApplicationContextOnStop=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt;
          schedulePeriodForDestinationPurge=&lt;span class=&quot;code-quote&quot;&gt;&quot;10000&quot;&lt;/span&gt;&amp;gt;

        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;destinationInterceptors&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;mirroredQueue copyMessage=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; postfix=&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot; prefix=&quot;&lt;/span&gt;Monitor.&quot;/&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/destinationInterceptors&amp;gt;&lt;/span&gt;

        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;destinationPolicy&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;policyMap&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;policyEntries&amp;gt;&lt;/span&gt;
                    &lt;span class=&quot;code-tag&quot;&gt;&lt;span class=&quot;code-comment&quot;&gt;&amp;lt;!-- Set auto-cleanup of inactive topics and queues --&amp;gt;&lt;/span&gt;&lt;/span&gt;
                    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;policyEntry queue=&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&lt;/span&gt;&quot;&lt;/span&gt; producerFlowControl=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; memoryLimit=&lt;span class=&quot;code-quote&quot;&gt;&quot;50mb&quot;&lt;/span&gt; gcInactiveDestinations=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; inactiveTimoutBeforeGC=&lt;span class=&quot;code-quote&quot;&gt;&quot;30000&quot;&lt;/span&gt;&amp;gt;
                        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;pendingQueuePolicy&amp;gt;&lt;/span&gt;
                            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;vmQueueCursor/&amp;gt;&lt;/span&gt;
                        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/pendingQueuePolicy&amp;gt;&lt;/span&gt;
                    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/policyEntry&amp;gt;&lt;/span&gt;
                    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;policyEntry topic=&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&lt;/span&gt;&quot;&lt;/span&gt; producerFlowControl=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; memoryLimit=&lt;span class=&quot;code-quote&quot;&gt;&quot;50mb&quot;&lt;/span&gt; gcInactiveDestinations=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; inactiveTimoutBeforeGC=&lt;span class=&quot;code-quote&quot;&gt;&quot;30000&quot;&lt;/span&gt;&amp;gt;
                        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;pendingSubscriberPolicy&amp;gt;&lt;/span&gt;
                            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;vmCursor /&amp;gt;&lt;/span&gt;
                        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/pendingSubscriberPolicy&amp;gt;&lt;/span&gt;
                    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/policyEntry&amp;gt;&lt;/span&gt;
                &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/policyEntries&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/policyMap&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/destinationPolicy&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/broker&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With this configuration, the topics will be collected, but the queues will not be collected.  In order to get the queues to be collected, the &lt;tt&gt;&amp;lt;destinationInterceptors&amp;gt;&lt;/tt&gt; section needs to be commented out.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 2003 Server, Java JDK 1.6&lt;/p&gt;</environment>
        <key id="12496720">AMQ-3157</key>
            <summary>Garbage collecting inactive destinations does not work with queue mirroring</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jgomes">Jim Gomes</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Jan 2011 20:26:23 +0000</created>
                <updated>Tue, 22 Nov 2011 08:30:44 +0000</updated>
                            <resolved>Fri, 26 Aug 2011 22:25:51 +0000</resolved>
                                    <version>5.4.2</version>
                                    <fixVersion>5.6.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13060755" author="tabish121" created="Wed, 6 Jul 2011 18:46:14 +0000"  >&lt;p&gt;Would be great if you could throw together a JUnit test for this.&lt;/p&gt;</comment>
                            <comment id="13081886" author="tabish121" created="Tue, 9 Aug 2011 20:20:00 +0000"  >&lt;p&gt;Created a little test case to demonstrate the issue.&lt;/p&gt;</comment>
                            <comment id="13092092" author="tabish121" created="Fri, 26 Aug 2011 22:15:12 +0000"  >&lt;p&gt;Updated test, old version wasn&apos;t quite right.&lt;/p&gt;</comment>
                            <comment id="13092096" author="tabish121" created="Fri, 26 Aug 2011 22:25:51 +0000"  >&lt;p&gt;fix applied in trunk.&lt;/p&gt;</comment>
                            <comment id="13154948" author="darius.schier" created="Tue, 22 Nov 2011 08:30:44 +0000"  >&lt;p&gt;Not sure if we have exactly the same problem but it looks pretty familiar.&lt;br/&gt;
We gave the snapshot a try, unfortunately we still have very similar problems as described by Jim.&lt;br/&gt;
Same as above: GC seems to work fine with destinations that are available after restart but not with dynamically created ones.&lt;br/&gt;
Also queues that were created before restart dynamically and still have some load work fine (as the server creates them on startup).&lt;/p&gt;

&lt;p&gt;Here is our configuration.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;destinationInterceptors&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;mirroredQueue copyMessage = &lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt; postfix=&lt;span class=&quot;code-quote&quot;&gt;&quot;.qmirror&quot;&lt;/span&gt; prefix=&quot;&quot;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/destinationInterceptors&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;destinationPolicy&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;policyMap&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;policyEntries&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;policyEntry topic=&lt;span class=&quot;code-quote&quot;&gt;&quot;testQueue.&amp;gt;&lt;/span&gt;&quot;&lt;/span&gt; producerFlowControl=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt; memoryLimit=&lt;span class=&quot;code-quote&quot;&gt;&quot;1 mb&quot;&lt;/span&gt; optimizedDispatch=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/policyEntry&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;policyEntry queue=&lt;span class=&quot;code-quote&quot;&gt;&quot;testQueue.&amp;gt;&lt;/span&gt;&quot;&lt;/span&gt; producerFlowControl=&lt;span class=&quot;code-quote&quot;&gt;&quot;false&quot;&lt;/span&gt; memoryLimit=&lt;span class=&quot;code-quote&quot;&gt;&quot;1 mb&quot;&lt;/span&gt; optimizedDispatch=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt;&amp;gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/policyEntry&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/policyEntries&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/policyMap&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/destinationPolicy&amp;gt;&lt;/span&gt;

&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;persistenceAdapter&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;kahaDB directory=&lt;span class=&quot;code-quote&quot;&gt;&quot;${activemq.base}/data/kahadb&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/persistenceAdapter&amp;gt;&lt;/span&gt;

&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;systemUsage&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;systemUsage&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;memoryUsage&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;memoryUsage limit=&lt;span class=&quot;code-quote&quot;&gt;&quot;10 mb&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/memoryUsage&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;storeUsage&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;storeUsage limit=&lt;span class=&quot;code-quote&quot;&gt;&quot;10 gb&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/storeUsage&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;tempUsage&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;tempUsage limit=&lt;span class=&quot;code-quote&quot;&gt;&quot;10 mb&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/tempUsage&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/systemUsage&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/systemUsage&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;Would you mind to reopen this issue? &lt;br/&gt;
We use mirrors a lot. From our point of view this could lead to OOM, so we think the priority could/should be increased.&lt;/p&gt;

&lt;p&gt;Regards&lt;br/&gt;
Darius&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12491842" name="AMQ3157Test.java" size="6712" author="tabish" created="Fri, 26 Aug 2011 22:15:12 +0000"/>
                            <attachment id="12489881" name="AMQ3157Test.java" size="6463" author="tabish" created="Tue, 9 Aug 2011 20:20:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>60092</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ajyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59508</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>