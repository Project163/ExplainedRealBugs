<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:33:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6089] org.apache.activemq.TransactionContext.recover(int flag) should return null or an empty array when it receives the flag  XAResource.TMNOFLAGS as it has return all transactions when called with  XAResource.TMSTARTRSCAN. or XAResource. TMENDRSCAN.</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6089</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;org.apache.activemq.TransactionContext implements XAResource.  The recover method currently ignores the flag parameter, returning all transaction regardless of flags passed to it.  This behaviour cause our transaction manager (IIB) to go into an indefinite loop.  It is expecting to get an empty array or null when XAResource.TMNOFLAGS is passed as all transactions where returned by the prior XAResource.TMSTARTRSCAN call.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12921893">AMQ-6089</key>
            <summary>org.apache.activemq.TransactionContext.recover(int flag) should return null or an empty array when it receives the flag  XAResource.TMNOFLAGS as it has return all transactions when called with  XAResource.TMSTARTRSCAN. or XAResource. TMENDRSCAN.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="chrisr45">Chris Roberts</reporter>
                        <labels>
                            <label>newbie</label>
                    </labels>
                <created>Tue, 15 Dec 2015 07:59:18 +0000</created>
                <updated>Wed, 6 Jan 2016 12:58:02 +0000</updated>
                            <resolved>Wed, 6 Jan 2016 12:58:02 +0000</resolved>
                                    <version>5.12.1</version>
                                    <fixVersion>5.14.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15057916" author="gtully" created="Tue, 15 Dec 2015 11:40:14 +0000"  >&lt;p&gt;the transaction context does not maintain any state at the moment. I can see a case for returning an empty array if TMENDRSCAN is specified. Because the default behaviour is to return all of the pending xids.&lt;/p&gt;

&lt;p&gt;Please add a little test case that demos the usage pattern of your TM, from the patch it is not clear that data will be of 0 length.&lt;/p&gt;</comment>
                            <comment id="15059222" author="chrisr45" created="Wed, 16 Dec 2015 00:45:48 +0000"  >&lt;p&gt;As requested a test client to demonstrate the IIB recovery behaviour &lt;/p&gt;</comment>
                            <comment id="15059449" author="chrisr45" created="Wed, 16 Dec 2015 03:55:52 +0000"  >&lt;p&gt;My reading of the spec was that TMENDRSCAN can be used with a TMSTARTRSCAN, hence all pending xids being returned by either call seems logical as activeMQ does not currently maintain a cursor or state.&lt;/p&gt;

&lt;p&gt;With no state being maintained and all pending xids are returned by both TMSTARTRSCAN and TMSTARTRSCAN a TM that has implemented cursor support has no way of knowing it has all received all pending xids if all three flags return the same result.&lt;/p&gt;</comment>
                            <comment id="15085471" author="gtully" created="Wed, 6 Jan 2016 12:11:19 +0000"  >&lt;p&gt;I agree, I had a read of &lt;a href=&quot;http://pubs.opengroup.org/onlinepubs/009680699/toc.pdf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://pubs.opengroup.org/onlinepubs/009680699/toc.pdf&lt;/a&gt; - the javadoc does not seem to have this level of detail.&lt;br/&gt;
returning noting in the case of TMNOFLAGS makes sense, the only caveat is that we won&apos;t have any way to record that a scan is in progress. Because TMNOFLAGS must be exclusive and we always return the full array, it will work ok.&lt;/p&gt;</comment>
                            <comment id="15085501" author="gtully" created="Wed, 6 Jan 2016 12:45:50 +0000"  >&lt;p&gt;peeking at the patch, not sure there is any value in the round trip to the broker because the returned data is ignored. Will just return an empty array if TMNOFLAGS is specified&lt;/p&gt;</comment>
                            <comment id="15085504" author="jira-bot" created="Wed, 6 Jan 2016 12:54:47 +0000"  >&lt;p&gt;Commit 16bc0f0d750530643333695ba20f6a736704271c in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=16bc0f0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=16bc0f0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6089&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6089&lt;/a&gt; - support TMNOFLAGS as a scan end to allow looping calls to recover to terminate&lt;/p&gt;</comment>
                            <comment id="15085508" author="gtully" created="Wed, 6 Jan 2016 12:58:02 +0000"  >&lt;p&gt;thanks for the test. I merged in the looping code from your test into an existing test that exercised the recovery calls with pending transactions to verify a loop can now exit.&lt;br/&gt;
The fix is a little different from the patch b/c it bypases the broker roundtrip.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12777875" name="AMQRecoveryTester.java" size="4049" author="chrisr45" created="Wed, 16 Dec 2015 00:45:48 +0000"/>
                            <attachment id="12777876" name="XAHandlerXid.java" size="3286" author="chrisr45" created="Wed, 16 Dec 2015 00:45:48 +0000"/>
                            <attachment id="12780665" name="activemq 5.12.patch" size="782" author="chrisr45" created="Wed, 6 Jan 2016 04:07:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 45 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2pwaf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>