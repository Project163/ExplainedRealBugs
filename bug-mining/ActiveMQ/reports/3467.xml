<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:59:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-9435] KahaDB durable sub tracking breaks on duplicate messages</title>
                <link>https://issues.apache.org/jira/browse/AMQ-9435</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;There is a bug in KahaDB on message add where if a message is marked as a duplicate the orderIndex next message Id is not rolled back. When a duplicate is detected and ignored the index is supposed to be rolled back so that the state isn&apos;t broken but in this case the sequence id is still incremented and this leads to gaps in the order index sequence.&lt;/p&gt;

&lt;p&gt;KahaDB tracks pending messages that need to be acknowledged for durable subs in a SequenceSet and that set is expected to be contiguous and if it isn&apos;t it breaks. The gaps lead to the store reporting messages still exist for durables and they appear as &quot;stuck&quot; even though there are no messages.&lt;/p&gt;

&lt;p&gt;The fix is to roll back the counter (this is already done in another spot) so it is only incremented if the message is stored. If an existing store is broken by this bug an index rebuild is likely necessary but then it wouldn&apos;t come back.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13568599">AMQ-9435</key>
            <summary>KahaDB durable sub tracking breaks on duplicate messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="cshannon">Christopher L. Shannon</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Feb 2024 14:31:43 +0000</created>
                <updated>Thu, 15 Feb 2024 23:22:04 +0000</updated>
                            <resolved>Thu, 15 Feb 2024 16:55:43 +0000</resolved>
                                    <version>5.18.3</version>
                    <version>6.0.1</version>
                                    <fixVersion>6.1.0</fixVersion>
                    <fixVersion>5.18.4</fixVersion>
                    <fixVersion>5.17.7</fixVersion>
                    <fixVersion>6.0.2</fixVersion>
                                    <component>KahaDB</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17817715" author="jira-bot" created="Thu, 15 Feb 2024 15:37:46 +0000"  >&lt;p&gt;Commit 10d94bd16585df7bf9c266958c5e45bb556e8c14 in activemq&apos;s branch refs/heads/main from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=10d94bd16&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=10d94bd16&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9435&quot; title=&quot;KahaDB durable sub tracking breaks on duplicate messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9435&quot;&gt;&lt;del&gt;AMQ-9435&lt;/del&gt;&lt;/a&gt; - Ensure orderIndex next id is rolled back on duplicates&lt;/p&gt;

&lt;p&gt;This commit fixes a bug in KahaDB that caused gaps in sequence ack&lt;br/&gt;
tracking for durables that would lead to the appearance of stuck&lt;br/&gt;
messages on durable subs if duplicate messages were detected. The&lt;br/&gt;
sequence is now correctly rolled back so that there is no gap if the&lt;br/&gt;
message is not added to the order index&lt;/p&gt;</comment>
                            <comment id="17817716" author="jira-bot" created="Thu, 15 Feb 2024 15:37:46 +0000"  >&lt;p&gt;Commit 30d54c4299d3bf3573bfcfbb414af2428066acad in activemq&apos;s branch refs/heads/main from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=30d54c429&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=30d54c429&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #1153 from cshannon/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9435&quot; title=&quot;KahaDB durable sub tracking breaks on duplicate messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9435&quot;&gt;&lt;del&gt;AMQ-9435&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9435&quot; title=&quot;KahaDB durable sub tracking breaks on duplicate messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9435&quot;&gt;&lt;del&gt;AMQ-9435&lt;/del&gt;&lt;/a&gt; - Ensure orderIndex next id is rolled back on duplicates&lt;/p&gt;</comment>
                            <comment id="17817722" author="jira-bot" created="Thu, 15 Feb 2024 16:02:12 +0000"  >&lt;p&gt;Commit 2b856f4da6de0395619bc5b87366d1400dcbb49d in activemq&apos;s branch refs/heads/activemq-6.0.x from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=2b856f4da&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=2b856f4da&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9435&quot; title=&quot;KahaDB durable sub tracking breaks on duplicate messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9435&quot;&gt;&lt;del&gt;AMQ-9435&lt;/del&gt;&lt;/a&gt; - Ensure orderIndex next id is rolled back on duplicates&lt;/p&gt;

&lt;p&gt;This commit fixes a bug in KahaDB that caused gaps in sequence ack&lt;br/&gt;
tracking for durables that would lead to the appearance of stuck&lt;br/&gt;
messages on durable subs if duplicate messages were detected. The&lt;br/&gt;
sequence is now correctly rolled back so that there is no gap if the&lt;br/&gt;
message is not added to the order index&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 10d94bd16585df7bf9c266958c5e45bb556e8c14)&lt;/p&gt;</comment>
                            <comment id="17817733" author="jira-bot" created="Thu, 15 Feb 2024 16:48:47 +0000"  >&lt;p&gt;Commit 722a075e2c4a331c258510618cfec3330f014c73 in activemq&apos;s branch refs/heads/activemq-5.18.x from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=722a075e2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=722a075e2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9435&quot; title=&quot;KahaDB durable sub tracking breaks on duplicate messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9435&quot;&gt;&lt;del&gt;AMQ-9435&lt;/del&gt;&lt;/a&gt; - Ensure orderIndex next id is rolled back on duplicates&lt;/p&gt;

&lt;p&gt;This commit fixes a bug in KahaDB that caused gaps in sequence ack&lt;br/&gt;
tracking for durables that would lead to the appearance of stuck&lt;br/&gt;
messages on durable subs if duplicate messages were detected. The&lt;br/&gt;
sequence is now correctly rolled back so that there is no gap if the&lt;br/&gt;
message is not added to the order index&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 10d94bd16585df7bf9c266958c5e45bb556e8c14)&lt;br/&gt;
(cherry picked from commit 2b856f4da6de0395619bc5b87366d1400dcbb49d)&lt;/p&gt;</comment>
                            <comment id="17817814" author="jira-bot" created="Thu, 15 Feb 2024 23:21:42 +0000"  >&lt;p&gt;Commit 99568ef1fd8366cf57da7ca4ee0862fcaca2c2b7 in activemq&apos;s branch refs/heads/activemq-5.17.x from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=99568ef1f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=99568ef1f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9435&quot; title=&quot;KahaDB durable sub tracking breaks on duplicate messages&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9435&quot;&gt;&lt;del&gt;AMQ-9435&lt;/del&gt;&lt;/a&gt; - Ensure orderIndex next id is rolled back on duplicates&lt;/p&gt;

&lt;p&gt;This commit fixes a bug in KahaDB that caused gaps in sequence ack&lt;br/&gt;
tracking for durables that would lead to the appearance of stuck&lt;br/&gt;
messages on durable subs if duplicate messages were detected. The&lt;br/&gt;
sequence is now correctly rolled back so that there is no gap if the&lt;br/&gt;
message is not added to the order index&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 10d94bd16585df7bf9c266958c5e45bb556e8c14)&lt;br/&gt;
(cherry picked from commit 2b856f4da6de0395619bc5b87366d1400dcbb49d)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 38 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1nf4w:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>