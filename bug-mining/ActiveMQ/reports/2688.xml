<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:24:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5898] Physical queues forwarded from many virtual destinations no longer supported</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5898</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Hi Tim,&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5187&quot; title=&quot;Virtual destination consumers do not support retroactive message recovery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5187&quot;&gt;&lt;del&gt;AMQ-5187&lt;/del&gt;&lt;/a&gt; breaks some of our message routing where we use virtual queues to control mirroring/replication of messages.&lt;/p&gt;

&lt;p&gt;A simple example...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;VIRTUAL.PUB.ALL
-&amp;gt; queue:&lt;span class=&quot;code-comment&quot;&gt;//SUBSCRIBER1
&lt;/span&gt;-&amp;gt; queue:&lt;span class=&quot;code-comment&quot;&gt;//SUBSCRIBER2
&lt;/span&gt;
VIRTUAL.PUB.SUBSCRIBER1
-&amp;gt; queue:&lt;span class=&quot;code-comment&quot;&gt;//SUBSCRIBER1&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...fails &lt;a href=&quot;https://github.com/apache/activemq/commit/f55edcfa25de1b55659a7113be60360c531ffa8a#diff-0def63df6ee6c0e4f8adcf00011b2f07R70&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;this assert&lt;/a&gt; because there are two composite destinations that route to &lt;tt&gt;queue://SUBSCRIBER1&lt;/tt&gt;. With asserts disabled messages are routed as expected.&lt;/p&gt;

&lt;p&gt;I have attached a test case exemplifying this.&lt;/p&gt;

&lt;p&gt;We use layers of composite queues to achieve explicit routing of messages to either one consumer or all consumers, and (also with static subscriptions) to target optimal routes across a mixture of LAN and WAN links.&lt;/p&gt;

&lt;p&gt;Fully appreciate that subscription recovery from virtual topics of a mapped queue is a beneficial thing to do, however from our perspective it is also useful to retain the behaviour of being able to have a many-to-one mapping between composite queues and physical queues. For our own use case we don&apos;t have any requirement for subscription recovery - we require cast-iron guarantees around messaging so all messages persistent and are delivered to one or more physical queues on brokers with persistence enabled, so this obviates the need for subscription recovery.&lt;/p&gt;

&lt;p&gt;Could this validation relaxed, could it be made possible for the new behaviour to be disabled or do you have any suggestions as to how else we could achieve our use case?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
James&lt;/p&gt;</description>
                <environment></environment>
        <key id="12846902">AMQ-5898</key>
            <summary>Physical queues forwarded from many virtual destinations no longer supported</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="furn">James Furness</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Jul 2015 14:00:49 +0000</created>
                <updated>Wed, 25 Nov 2015 19:23:01 +0000</updated>
                            <resolved>Wed, 25 Nov 2015 13:49:26 +0000</resolved>
                                    <version>5.11.1</version>
                                    <fixVersion>5.13.0</fixVersion>
                    <fixVersion>5.12.2</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14637023" author="furn" created="Wed, 22 Jul 2015 14:50:51 +0000"  >&lt;p&gt;Add test case - passes with asserts disabled.&lt;/p&gt;

&lt;p&gt;With &lt;tt&gt;-ea&lt;/tt&gt; fails:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: java.lang.Throwable: java.lang.AssertionError: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
	at org.apache.activemq.broker.region.virtual.VirtualDestinationInterceptor.intercept(VirtualDestinationInterceptor.java:70)
	at org.apache.activemq.broker.region.CompositeDestinationInterceptor.intercept(CompositeDestinationInterceptor.java:38)
	at org.apache.activemq.broker.region.AbstractRegion.addDestination(AbstractRegion.java:139)
	at org.apache.activemq.broker.region.RegionBroker.addDestination(RegionBroker.java:348)
	at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:172)
	at org.apache.activemq.advisory.AdvisoryBroker.addDestination(AdvisoryBroker.java:197)
	at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:172)
	at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:172)
	at org.apache.activemq.broker.MutableBrokerFilter.addDestination(MutableBrokerFilter.java:177)
	at org.apache.activemq.broker.region.AbstractRegion.lookup(AbstractRegion.java:467)
	at org.apache.activemq.broker.region.AbstractRegion.addConsumer(AbstractRegion.java:261)
	at org.apache.activemq.broker.region.RegionBroker.addConsumer(RegionBroker.java:427)
	at org.apache.activemq.broker.jmx.ManagedRegionBroker.addConsumer(ManagedRegionBroker.java:244)
	at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:102)
	at org.apache.activemq.advisory.AdvisoryBroker.addConsumer(AdvisoryBroker.java:104)
	at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:102)
	at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:102)
	at org.apache.activemq.broker.MutableBrokerFilter.addConsumer(MutableBrokerFilter.java:107)
	at org.apache.activemq.broker.TransportConnection.processAddConsumer(TransportConnection.java:663)
	at org.apache.activemq.command.ConsumerInfo.visit(ConsumerInfo.java:348)
	at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:334)
	at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:188)
	at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)
	at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)
	at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:270)
	at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)
	at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)
	at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)
	... 1 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15026127" author="leebutts" created="Wed, 25 Nov 2015 03:54:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt; this is a showstopper for us upgrading from 5.10 -  could we get a fix for this into 5.13?&lt;/p&gt;</comment>
                            <comment id="15026707" author="christopher.l.shannon" created="Wed, 25 Nov 2015 12:44:15 +0000"  >&lt;p&gt;If you don&apos;t run with assertions turned on, does your use case work? &lt;/p&gt;

&lt;p&gt;It seems like the only fix here is to just drop the assertion line because I can&apos;t really think of a good reason not to allow multiple composite destinations to route to the same queue. In fact, I have done this several times but never noticed this problem because I don&apos;t use assertions accept during unit testing.&lt;/p&gt;</comment>
                            <comment id="15026708" author="furn" created="Wed, 25 Nov 2015 12:50:41 +0000"  >&lt;p&gt;Hi, yep passes with asserts disabled. We don&apos;t run our application with assertions turned on in production but we do for UAT and unit tests so would be good to get this fixed. Obviously the concern was that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt; added that assert to trap some undesirable edge case. If removing it is valid we&apos;d be happy with this fix.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
James&lt;/p&gt;</comment>
                            <comment id="15026784" author="jira-bot" created="Wed, 25 Nov 2015 13:45:54 +0000"  >&lt;p&gt;Commit 35b7ac250b5fa0b8c8dbf728881cc9dbf6edce19 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=35b7ac2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=35b7ac2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5898&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5898&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Removing assertion in VirtualDestinationInterceptor to allow&lt;br/&gt;
multiple composite destinations to forward to a physical destination&lt;/p&gt;</comment>
                            <comment id="15026787" author="jira-bot" created="Wed, 25 Nov 2015 13:47:06 +0000"  >&lt;p&gt;Commit a38c3d4b6b9a4e828c80e88dd5a33c86fae99a06 in activemq&apos;s branch refs/heads/activemq-5.12.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=a38c3d4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=a38c3d4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5898&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5898&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Removing assertion in VirtualDestinationInterceptor to allow&lt;br/&gt;
multiple composite destinations to forward to a physical destination&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 35b7ac250b5fa0b8c8dbf728881cc9dbf6edce19)&lt;/p&gt;</comment>
                            <comment id="15026790" author="christopher.l.shannon" created="Wed, 25 Nov 2015 13:49:26 +0000"  >&lt;p&gt;I have applied a patch for this because the assertion doesn&apos;t make any sense to me to have it in there.&lt;/p&gt;

&lt;p&gt;Thanks for the test case &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=furn&quot; class=&quot;user-hover&quot; rel=&quot;furn&quot;&gt;furn&lt;/a&gt;, I have applied a modified version of it to this patch to make sure that this doesn&apos;t happen again.&lt;/p&gt;</comment>
                            <comment id="15026793" author="furn" created="Wed, 25 Nov 2015 13:50:26 +0000"  >&lt;p&gt;Great, thanks for your help.&lt;/p&gt;</comment>
                            <comment id="15027419" author="jira-bot" created="Wed, 25 Nov 2015 19:23:01 +0000"  >&lt;p&gt;Commit 95f58fa7c4e26b5b2d73a80bd8e1cb2bee8ebf47 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=95f58fa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=95f58fa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6027&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6027&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Adding back in test case now that &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5898&quot; title=&quot;Physical queues forwarded from many virtual destinations no longer supported&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5898&quot;&gt;&lt;del&gt;AMQ-5898&lt;/del&gt;&lt;/a&gt; is resolved&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12714571">AMQ-5187</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12746551" name="ActiveManyCompositeQueuesToOnePhysicalQueueTest.java" size="5125" author="furn" created="Wed, 22 Jul 2015 14:50:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2hk1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>