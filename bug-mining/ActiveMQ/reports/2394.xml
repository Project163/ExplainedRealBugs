<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:07:19 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5403] remove extra expiration and timestamp manipulaton which will cause problems</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5403</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Once the incoming AMQP message has been converted to a JMS message, there may be some further manipulation performed on the expiration and timestamp in AmqpProtocolConverter:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  // Lets handle the case where the expiration was set, but the timestamp
  // was not set by the client. Lets assign the timestamp now, and adjust
  // the expiration.
  if (message.getExpiration() != 0) {
      if (message.getTimestamp() == 0) {
      message.setTimestamp(System.currentTimeMillis());
      message.setExpiration(message.getTimestamp() + message.getExpiration());
      }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This was added in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5002&quot; title=&quot;AMQP: If a proton client only sets the ttl, and not the message timestamp, ActiveMQ does not handle the expiration correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5002&quot;&gt;&lt;del&gt;AMQ-5002&lt;/del&gt;&lt;/a&gt; as a workaround for a problem in some old message conversation code contributed to &apos;proton-jms&apos;, where the JMSExpiration value was being set to the TTL value from the AMQP message when these actually have different semantics and values. That defect was since resolved via &lt;a href=&quot;https://issues.apache.org/jira/browse/PROTON-474&quot; title=&quot;Incorrect mapping of TTL to JMSExpiration in JMS InboundTransformer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PROTON-474&quot;&gt;&lt;del&gt;PROTON-474&lt;/del&gt;&lt;/a&gt; for inclusion in Proton 0.8. Now that &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5346&quot; title=&quot;Update Proton to version 0.8&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5346&quot;&gt;&lt;del&gt;AMQ-5346&lt;/del&gt;&lt;/a&gt; is underway, that means we are using the updated proton-jms code and the workaround must be removed otherwise it causes various issues itself:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;It may set a timestamp value where none existed, which could lead to addition of a creation-time field on outbound AMQP messages, whereas the Properties section of the AMQP message is meant to be immutable.&lt;/li&gt;
	&lt;li&gt;When setting JMSExpiration to &apos;new timestamp + old expiration&apos;, if the expiration was actually based on the absolute-expiry-time field of the incoming AMQP message then the new JMSExpiration value will be incorrect, much higher than actually requested and preventing the messages from expiring for years longer.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12749236">AMQ-5403</key>
            <summary>remove extra expiration and timestamp manipulaton which will cause problems</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="robbie">Robbie Gemmell</reporter>
                        <labels>
                    </labels>
                <created>Mon, 20 Oct 2014 12:41:09 +0000</created>
                <updated>Mon, 20 Oct 2014 13:57:20 +0000</updated>
                            <resolved>Mon, 20 Oct 2014 13:57:20 +0000</resolved>
                                                    <fixVersion>5.11.0</fixVersion>
                                    <component>AMQP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14176874" author="gemmellr" created="Mon, 20 Oct 2014 12:44:12 +0000"  >&lt;p&gt;Attaching patch to remove the relevant code.&lt;/p&gt;</comment>
                            <comment id="14176909" author="tabish121" created="Mon, 20 Oct 2014 13:57:20 +0000"  >&lt;p&gt;Patch applied, thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12692105">AMQ-5002</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12682533">PROTON-474</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12739903">AMQ-5346</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12675818" name="0001-AMQ-5403-remove-old-expiration-workaround-it-is-no-l.patch" size="1726" author="robbie" created="Mon, 20 Oct 2014 12:44:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i21csf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>