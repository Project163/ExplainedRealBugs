<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:40:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6587] Failed to remove inactive destination Topic: Destination still has an active subscription</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6587</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;broker setSchedulePeriodForDestinationPurge, wildcard topic subscriber and anonymous publishers to new destinations. &lt;br/&gt;
Race between addDestination and markForGc and canGc&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ERROR region.RegionBroker: Failed to remove inactive destination Topic: destination=A.4725, subscriptions=1
javax.jms.JMSException: Destination still has an active subscription: topic:&lt;span class=&quot;code-comment&quot;&gt;//A.4725
&lt;/span&gt;	at org.apache.activemq.broker.region.AbstractRegion.removeDestination(AbstractRegion.java:271)
	at org.apache.activemq.broker.region.RegionBroker.removeDestination(RegionBroker.java:354)
	at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:179)
	at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:179)
	at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:179)
	at org.apache.activemq.broker.region.RegionBroker.purgeInactiveDestinations(RegionBroker.java:897)
	at org.apache.activemq.broker.region.RegionBroker$1.run(RegionBroker.java:118)
	at org.apache.activemq.thread.SchedulerTimerTask.run(SchedulerTimerTask.java:33)
	at java.util.TimerThread.mainLoop(Timer.java:555)
	at java.util.TimerThread.run(Timer.java:505)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13039432">AMQ-6587</key>
            <summary>Failed to remove inactive destination Topic: Destination still has an active subscription</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Feb 2017 11:13:56 +0000</created>
                <updated>Fri, 10 Feb 2017 17:05:54 +0000</updated>
                            <resolved>Tue, 7 Feb 2017 13:57:54 +0000</resolved>
                                    <version>5.14.0</version>
                                    <fixVersion>5.15.0</fixVersion>
                    <fixVersion>5.14.4</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15848247" author="gtully" created="Wed, 1 Feb 2017 11:22:07 +0000"  >&lt;p&gt;There is some locking in RegionBroker using inactiveDestinationsPurgeLock. This does not cover addDestination which is probably intentional b/c it uses the shared destination map which allows for concurrent access. However new destinations are added to the map before matching subs are added. Which causes a race between gc and the addition of wildcard subscriptions. Adding subs before adding to the destination map looks like the simplest fix.&lt;/p&gt;</comment>
                            <comment id="15848249" author="gtully" created="Wed, 1 Feb 2017 11:23:13 +0000"  >&lt;p&gt;The fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6188&quot; title=&quot;Queues containing PERSISTENT messages can be garbage collected due to Inactivity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6188&quot;&gt;&lt;del&gt;AMQ-6188&lt;/del&gt;&lt;/a&gt;  which resets lastActiveTime on publish/send helps mitigate the problem but does not fully resolve it.&lt;/p&gt;</comment>
                            <comment id="15848473" author="jira-bot" created="Wed, 1 Feb 2017 15:10:33 +0000"  >&lt;p&gt;Commit e415d2921ec7eabeccdf7db4d1850caa68486de3 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e415d29&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e415d29&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6587&quot; title=&quot;Failed to remove inactive destination Topic: Destination still has an active subscription&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6587&quot;&gt;&lt;del&gt;AMQ-6587&lt;/del&gt;&lt;/a&gt; ensure subs added to new destination before destination is exposed in the destination map. sort gc contention with wildcard subs and anonymous publish. fix and test&lt;/p&gt;</comment>
                            <comment id="15848601" author="jira-bot" created="Wed, 1 Feb 2017 16:43:19 +0000"  >&lt;p&gt;Commit 64b3203713161ee0dd5d8d1dbd74f4c4602f546c in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=64b3203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=64b3203&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6587&quot; title=&quot;Failed to remove inactive destination Topic: Destination still has an active subscription&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6587&quot;&gt;&lt;del&gt;AMQ-6587&lt;/del&gt;&lt;/a&gt; - fix typo in test that needs 1.7 final&lt;/p&gt;</comment>
                            <comment id="15854048" author="jira-bot" created="Mon, 6 Feb 2017 14:08:45 +0000"  >&lt;p&gt;Commit 95dc0eba2b93232c60a1f4aa7ed319eff69d6a1d in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=95dc0eb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=95dc0eb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6587&quot; title=&quot;Failed to remove inactive destination Topic: Destination still has an active subscription&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6587&quot;&gt;&lt;del&gt;AMQ-6587&lt;/del&gt;&lt;/a&gt; ensure subs added to new destination before destination is exposed in the destination map. sort gc contention with wildcard subs and anonymous publish. fix and test&lt;/p&gt;

&lt;p&gt;(cherry picked from commit e415d2921ec7eabeccdf7db4d1850caa68486de3)&lt;/p&gt;</comment>
                            <comment id="15854049" author="jira-bot" created="Mon, 6 Feb 2017 14:08:49 +0000"  >&lt;p&gt;Commit 8af72c2157dd570172acb744c56602b8b0a786ef in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=8af72c2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=8af72c2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6587&quot; title=&quot;Failed to remove inactive destination Topic: Destination still has an active subscription&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6587&quot;&gt;&lt;del&gt;AMQ-6587&lt;/del&gt;&lt;/a&gt; - fix typo in test that needs 1.7 final&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 64b3203713161ee0dd5d8d1dbd74f4c4602f546c)&lt;/p&gt;</comment>
                            <comment id="15856023" author="gtully" created="Tue, 7 Feb 2017 13:54:52 +0000"  >&lt;p&gt;This warn/error can also appear when a wildcard sub arrives during the gc process&lt;/p&gt;</comment>
                            <comment id="15856030" author="jira-bot" created="Tue, 7 Feb 2017 13:56:34 +0000"  >&lt;p&gt;Commit 0ee4f5b84302daf8901363556d038e274c2defd5 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=0ee4f5b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=0ee4f5b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6587&quot; title=&quot;Failed to remove inactive destination Topic: Destination still has an active subscription&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6587&quot;&gt;&lt;del&gt;AMQ-6587&lt;/del&gt;&lt;/a&gt; additional contention window with new sub while gc is in progress - need to verify new sub is actually subscribed to the candidate for deletion. Fix and test&lt;/p&gt;</comment>
                            <comment id="15856032" author="gtully" created="Tue, 7 Feb 2017 13:57:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt; note the additional fix for a second variant of this problem&lt;/p&gt;</comment>
                            <comment id="15856165" author="jira-bot" created="Tue, 7 Feb 2017 15:04:55 +0000"  >&lt;p&gt;Commit 2d4fb4cbabb27f7fbb9ef5a86fa310d9741393c3 in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2d4fb4c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2d4fb4c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6587&quot; title=&quot;Failed to remove inactive destination Topic: Destination still has an active subscription&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6587&quot;&gt;&lt;del&gt;AMQ-6587&lt;/del&gt;&lt;/a&gt; additional contention window with new sub while gc is in progress - need to verify new sub is actually subscribed to the candidate for deletion. Fix and test&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 0ee4f5b84302daf8901363556d038e274c2defd5)&lt;/p&gt;</comment>
                            <comment id="15856166" author="christopher.l.shannon" created="Tue, 7 Feb 2017 15:05:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;, got it, thanks for the heads up.&lt;/p&gt;</comment>
                            <comment id="15861157" author="jira-bot" created="Fri, 10 Feb 2017 11:41:12 +0000"  >&lt;p&gt;Commit d86c98a68772aaa879e6a573fed1ab8382568c9e in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=d86c98a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=d86c98a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6587&quot; title=&quot;Failed to remove inactive destination Topic: Destination still has an active subscription&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6587&quot;&gt;&lt;del&gt;AMQ-6587&lt;/del&gt;&lt;/a&gt; - fix root cause of deletion candidate seeing sub. contention between adding sub to dests and adding dests to sub, also removing sub from dests twice could leave dest stat negative allowing invalid candidate for gc&lt;/p&gt;</comment>
                            <comment id="15861230" author="jira-bot" created="Fri, 10 Feb 2017 13:06:18 +0000"  >&lt;p&gt;Commit 727000f112b81aa3ca34087ee44a641b1d5088f6 in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=727000f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=727000f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6587&quot; title=&quot;Failed to remove inactive destination Topic: Destination still has an active subscription&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6587&quot;&gt;&lt;del&gt;AMQ-6587&lt;/del&gt;&lt;/a&gt; - fix root cause of deletion candidate seeing sub. contention between adding sub to dests and adding dests to sub, also removing sub from dests twice could leave dest stat negative allowing invalid candidate for gc&lt;/p&gt;

&lt;p&gt;(cherry picked from commit d86c98a68772aaa879e6a573fed1ab8382568c9e)&lt;/p&gt;</comment>
                            <comment id="15861541" author="gtully" created="Fri, 10 Feb 2017 17:05:54 +0000"  >&lt;p&gt;note: the root cause could result in a wildcard sub missing a newly created destination, one created by an &lt;b&gt;anonymous&lt;/b&gt; publish that coincides with the subscription creation. the check in destination gc exposed this window.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12945035">AMQ-6188</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 40 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39gk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>