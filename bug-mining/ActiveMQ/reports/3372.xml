<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:50:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-8201] ACK compaction with local transactions</title>
                <link>https://issues.apache.org/jira/browse/AMQ-8201</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I have a consumer running with transacted sessions, and looking in KahaDB, I can see a KAHA_REMOVE_MESSAGE_COMMAND, with the local transaction ID added to the journal, and then a KAHA_COMMIT_COMMAND after it. Some time later, I see the exact same&#160;KAHA_REMOVE_MESSAGE_COMMAND appended to the journal again, with the exact same transaction information, but no corresponding&#160;KAHA_COMMIT_COMMAND. This appears to follow a KAHA_REWRITTEN_DATA_FILE_COMMAND.&lt;br/&gt;
&#160;&lt;br/&gt;
It looks like the ack compaction method is forwarding the acknowledgement, but not the commit - it appears that the commit is only forwarded&#160;in the case of an XA transaction.&lt;br/&gt;
&#160;&lt;br/&gt;
A test and patch is available in the PR here:&#160;&lt;a href=&quot;https://github.com/apache/activemq/pull/636&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/636&lt;/a&gt;&lt;br/&gt;
&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13367192">AMQ-8201</key>
            <summary>ACK compaction with local transactions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbonofre">Jean-Baptiste Onofr&#233;</assignee>
                                    <reporter username="jgallimore">Jonathan Gallimore</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Mar 2021 09:29:39 +0000</created>
                <updated>Thu, 25 Mar 2021 11:43:45 +0000</updated>
                            <resolved>Thu, 25 Mar 2021 11:43:45 +0000</resolved>
                                    <version>5.15.14</version>
                    <version>5.16.1</version>
                                    <fixVersion>5.15.15</fixVersion>
                    <fixVersion>5.16.2</fixVersion>
                    <fixVersion>5.17.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17307707" author="jgallimore" created="Wed, 24 Mar 2021 09:34:21 +0000"  >&lt;p&gt;This is related to Jira issue&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7067&quot; title=&quot;KahaDB Recovery can experience a dangling transaction when prepare and commit occur on different data files.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7067&quot;&gt;&lt;del&gt;AMQ-7067&lt;/del&gt;&lt;/a&gt; (&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7067&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-7067&lt;/a&gt;)&#160;- the previous functionality only forwarded the remove message command, and was changed to also forward commits with XA transactions - it looks like local transactions were missed.&#160;&lt;/p&gt;

&lt;p&gt;Thank you Chris, Gary and JB for your review and feedback!&lt;/p&gt;</comment>
                            <comment id="17308587" author="jira-bot" created="Thu, 25 Mar 2021 11:03:02 +0000"  >&lt;p&gt;Commit edd0515d90d8bdb01e3455bf2c4c132f9a6add29 in activemq&apos;s branch refs/heads/master from Jonathan Gallimore&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=edd0515&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=edd0515&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8201&quot; title=&quot;ACK compaction with local transactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8201&quot;&gt;&lt;del&gt;AMQ-8201&lt;/del&gt;&lt;/a&gt; Forward commit commands for local transactions as well as XA transactions during ACK compaction&lt;/p&gt;</comment>
                            <comment id="17308611" author="jira-bot" created="Thu, 25 Mar 2021 11:43:21 +0000"  >&lt;p&gt;Commit 468cd9c5cc5fc81c4742b3b23cc15ef303e2eb66 in activemq&apos;s branch refs/heads/activemq-5.16.x from Jonathan Gallimore&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=468cd9c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=468cd9c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8201&quot; title=&quot;ACK compaction with local transactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8201&quot;&gt;&lt;del&gt;AMQ-8201&lt;/del&gt;&lt;/a&gt; Forward commit commands for local transactions as well as XA transactions during ACK compaction&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 631342d76a0a2cf7aa039db9d34db15f8234559f)&lt;/p&gt;</comment>
                            <comment id="17308612" author="jira-bot" created="Thu, 25 Mar 2021 11:43:42 +0000"  >&lt;p&gt;Commit eaa272e19bb59c57ce36f244b247965fd6ad90b1 in activemq&apos;s branch refs/heads/activemq-5.15.x from Jonathan Gallimore&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=eaa272e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=eaa272e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8201&quot; title=&quot;ACK compaction with local transactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8201&quot;&gt;&lt;del&gt;AMQ-8201&lt;/del&gt;&lt;/a&gt; Forward commit commands for local transactions as well as XA transactions during ACK compaction&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 631342d76a0a2cf7aa039db9d34db15f8234559f)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13189438">AMQ-7067</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 33 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0p4i8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>