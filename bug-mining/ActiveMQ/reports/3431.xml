<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:52:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-9168] Message expired advisory is not sent when Topic Subscriptions expire a message</title>
                <link>https://issues.apache.org/jira/browse/AMQ-9168</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I noticed that when enabling advisories for expiration that Topic Subscriptions do not send the advisory. this is because the server code calls discard so the discard advisory is sent instead. This should be fixed so that if the message is expired by the subscription on the server (usually on dispatch) that the advisory sent is the expired and not discarded advisory.&lt;/p&gt;

&lt;p&gt;Also, on another note, just like how we don&apos;t currently fire message consumed advisories for topic subscriptions for the same reason, expired advisories are not fired if the client does the expiration (only if server expires). This only applies to Topic subs (and not durable or queue subs) because Topic Subs are different in that they do not track the original message for dispatched messages. &lt;/p&gt;

&lt;p&gt;This is done for performance and to save memory as default topic prefetch is quite high at Short.MAX (over 32k) so just some metadata is saved. We would need to track the original message to be able to use it when the acks were sent by the client for consumed, expiration, etc to do this but since this feature seems to be rarely used and off by default probably not worth it for now. If we ever wanted to fix it we would likely want to lower prefetch to be a lot lower (maybe default 1000) like durables to prevent blowing heap.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13502884">AMQ-9168</key>
            <summary>Message expired advisory is not sent when Topic Subscriptions expire a message</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="cshannon">Christopher L. Shannon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Nov 2022 11:42:08 +0000</created>
                <updated>Wed, 16 Nov 2022 11:54:12 +0000</updated>
                            <resolved>Wed, 16 Nov 2022 11:54:12 +0000</resolved>
                                    <version>5.17.2</version>
                                    <fixVersion>5.18.0</fixVersion>
                    <fixVersion>5.17.3</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17634792" author="jira-bot" created="Wed, 16 Nov 2022 11:45:44 +0000"  >&lt;p&gt;Commit 757a712890996d71cf380c56fc2cefbd5a82ec88 in activemq&apos;s branch refs/heads/main from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=757a71289&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=757a71289&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9168&quot; title=&quot;Message expired advisory is not sent when Topic Subscriptions expire a message&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9168&quot;&gt;&lt;del&gt;AMQ-9168&lt;/del&gt;&lt;/a&gt; - Send message expired advisory and not discard advisory when&lt;br/&gt;
Topic subscriptions expire a message&lt;/p&gt;

&lt;p&gt;This fixes topic subs to send the right advisory type, if enabled, when&lt;br/&gt;
the server discards a message on dispatch to a topic sub. Also add some&lt;br/&gt;
more expiration tests for other subscription types&lt;/p&gt;</comment>
                            <comment id="17634797" author="jira-bot" created="Wed, 16 Nov 2022 11:49:49 +0000"  >&lt;p&gt;Commit f90a7bf5355e371972b7f4011779019c50d4ee48 in activemq&apos;s branch refs/heads/activemq-5.17.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=f90a7bf53&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=f90a7bf53&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9168&quot; title=&quot;Message expired advisory is not sent when Topic Subscriptions expire a message&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9168&quot;&gt;&lt;del&gt;AMQ-9168&lt;/del&gt;&lt;/a&gt; - Send message expired advisory and not discard advisory when&lt;br/&gt;
Topic subscriptions expire a message&lt;/p&gt;

&lt;p&gt;This fixes topic subs to send the right advisory type, if enabled, when&lt;br/&gt;
the server discards a message on dispatch to a topic sub. Also add some&lt;br/&gt;
more expiration tests for other subscription types&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 757a712890996d71cf380c56fc2cefbd5a82ec88)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1c7g8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>