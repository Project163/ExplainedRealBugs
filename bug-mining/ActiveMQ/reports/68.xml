<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:31:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-731] Redeliveries don&apos;t work with resource adapter and Jencks</title>
                <link>https://issues.apache.org/jira/browse/AMQ-731</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;During a rollback in a JTA transaction, this exception is generated a few times:&lt;/p&gt;

&lt;p&gt;org.apache.activemq.broker.AbstractConnection.serviceException Async&lt;br/&gt;
error occurred: javax.jms.JMSException: Could not correlate&lt;br/&gt;
acknowledgment with dispatched message: MessageAck &lt;/p&gt;
{commandId = 137,
responseRequired = false, ackType = 1, consumerId =
ID:xxx-2276-1148335783189-2:5:-1:2, firstMessageId =
ID:xxx-2276-1148335783189-2:1:1:1:2, lastMessageId =
ID:xxx-2276-1148335783189-2:1:1:1:2, destination = queue://xxxQueue,
transactionId = null, messageCount = 1}
&lt;p&gt;javax.jms.JMSException: Could not correlate acknowledgment with&lt;br/&gt;
dispatched message: MessageAck &lt;/p&gt;
{commandId = 137, responseRequired =
false, ackType = 1, consumerId = ID:xxx-2276-1148335783189-2:5:-1:2,
firstMessageId = ID:xxx-2276-1148335783189-2:1:1:1:2, lastMessageId =
ID:xxx-2276-1148335783189-2:1:1:1:2, destination = queue://xxxQueue,
transactionId = null, messageCount = 1}
&lt;p&gt;        at&lt;br/&gt;
org.apache.activemq.broker.region.PrefetchSubscription.acknowledge(PrefetchSubscription.java:175)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.broker.region.AbstractRegion.acknowledge(AbstractRegion.java:233)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.broker.region.RegionBroker.acknowledge(RegionBroker.java:362)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.broker.TransactionBroker.acknowledge(TransactionBroker.java:176)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:65)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.broker.BrokerFilter.acknowledge(BrokerFilter.java:65)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.broker.MutableBrokerFilter.acknowledge(MutableBrokerFilter.java:78)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.broker.AbstractConnection.processMessageAck(AbstractConnection.java:356)&lt;br/&gt;
        at org.apache.activemq.command.MessageAck.visit(MessageAck.java:178)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.broker.AbstractConnection.service(AbstractConnection.java:201)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:62)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:97)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:63)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.transport.vm.VMTransport.oneway(VMTransport.java:76)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:44)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:1111)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.ActiveMQSession.asyncSendPacket(ActiveMQSession.java:1655)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.ActiveMQSession$2.afterRollback(ActiveMQSession.java:720)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.TransactionContext.afterRollback(TransactionContext.java:134)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.TransactionContext.rollback(TransactionContext.java:409)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.ra.LocalAndXATransaction.rollback(LocalAndXATransaction.java:126)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.geronimo.transaction.manager.WrapperNamedXAResource.rollback(WrapperNamedXAResource.java:78)&lt;br/&gt;
        at&lt;br/&gt;
com.caucho.transaction.TransactionImpl.rollbackInt(TransactionImpl.java:787)&lt;br/&gt;
        at&lt;br/&gt;
com.caucho.transaction.TransactionImpl.commit(TransactionImpl.java:560)&lt;br/&gt;
        at org.jencks.XAEndpoint.afterDelivery(XAEndpoint.java:103)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.ra.MessageEndpointProxy$MessageEndpointAlive.afterDelivery(MessageEndpointProxy.java:125)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.ra.MessageEndpointProxy.afterDelivery(MessageEndpointProxy.java:64)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.ra.ServerSessionImpl.afterDelivery(ServerSessionImpl.java:214)&lt;br/&gt;
        at org.apache.activemq.ActiveMQSession.run(ActiveMQSession.java:751)&lt;br/&gt;
        at&lt;br/&gt;
org.apache.activemq.ra.ServerSessionImpl.run(ServerSessionImpl.java:163)&lt;br/&gt;
        at com.caucho.jca.WorkThread.run(WorkThread.java:99)&lt;br/&gt;
        at com.caucho.util.ThreadPool.runTasks(ThreadPool.java:490)&lt;br/&gt;
        at com.caucho.util.ThreadPool.run(ThreadPool.java:423)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:595) &lt;/p&gt;

&lt;p&gt;Note that the ackType is a poison ack.  This shouldn&apos;t be the case as the configuration (below) on the resource adapter and the managed connection factory both specify 9 redeliveries.  Redelivery does not happen.&lt;/p&gt;

&lt;p&gt;Broker configuration:&lt;/p&gt;

&lt;p&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;beans xmlns=&quot;http://activemq.org/config/1.0&quot;&amp;gt;&lt;/p&gt;

&lt;p&gt;        &amp;lt;broker persistent=&quot;false&quot; useJmx=&quot;false&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;transportConnectors&amp;gt;&lt;br/&gt;
                        &amp;lt;transportConnector uri=&quot;vm://localhost&quot; /&amp;gt;&lt;br/&gt;
                &amp;lt;/transportConnectors&amp;gt;&lt;/p&gt;

&lt;p&gt;                &amp;lt;persistenceAdapter&amp;gt;&lt;br/&gt;
                        &amp;lt;memoryPersistenceAdapter /&amp;gt;&lt;br/&gt;
                &amp;lt;/persistenceAdapter&amp;gt;&lt;br/&gt;
        &amp;lt;/broker&amp;gt;&lt;/p&gt;

&lt;p&gt;&amp;lt;/beans&amp;gt;&lt;/p&gt;

&lt;p&gt;Spring configuration:&lt;/p&gt;

&lt;p&gt;        &amp;lt;bean id=&quot;jms.connectionFactory&quot;&lt;br/&gt;
class=&quot;org.springframework.jca.support.LocalConnectionFactoryBean&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;property name=&quot;connectionManager&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;bean class=&quot;com.xxx.jca.ResinConnectionManagerFactoryBean&quot;&amp;gt;&lt;br/&gt;
                                &amp;lt;property name=&quot;localTransaction&quot;&amp;gt;&lt;br/&gt;
                                        &amp;lt;value&amp;gt;false&amp;lt;/value&amp;gt;&lt;br/&gt;
                                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                                &amp;lt;property name=&quot;localTransactionOptimization&quot;&amp;gt;&lt;br/&gt;
                                        &amp;lt;value&amp;gt;false&amp;lt;/value&amp;gt;&lt;br/&gt;
                                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                                &amp;lt;property name=&quot;managedConnectionFactory&quot;&amp;gt;&lt;br/&gt;
                                        &amp;lt;ref local=&quot;jms.managedConnectionFactory&quot; /&amp;gt;&lt;br/&gt;
                                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                                &amp;lt;property name=&quot;xaTransaction&quot;&amp;gt;&lt;br/&gt;
                                        &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
                                &amp;lt;/property&amp;gt;&lt;br/&gt;
                        &amp;lt;/bean&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                &amp;lt;property name=&quot;managedConnectionFactory&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;ref local=&quot;jms.managedConnectionFactory&quot; /&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;br/&gt;
        &amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;        &amp;lt;bean id=&quot;jms.jcaContainer&quot; class=&quot;org.jencks.JCAContainer&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;property name=&quot;bootstrapContext&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;bean class=&quot;com.xxx.jca.ResinBootstrapContextFactoryBean&quot; /&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                &amp;lt;property name=&quot;resourceAdapter&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;ref local=&quot;jms.resourceAdapter&quot; /&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;br/&gt;
        &amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;        &amp;lt;bean id=&quot;jms.managedConnectionFactory&quot;&lt;br/&gt;
class=&quot;org.apache.activemq.ra.ActiveMQManagedConnectionFactory&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;property name=&quot;allPrefetchValues&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;value&amp;gt;1&amp;lt;/value&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                &amp;lt;property name=&quot;initialRedeliveryDelay&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;value&amp;gt;2000&amp;lt;/value&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                &amp;lt;property name=&quot;maximumRedeliveries&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;value&amp;gt;9&amp;lt;/value&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                &amp;lt;property name=&quot;redeliveryBackOffMultiplier&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;value&amp;gt;2&amp;lt;/value&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                &amp;lt;property name=&quot;redeliveryUseExponentialBackOff&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                &amp;lt;property name=&quot;resourceAdapter&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;ref local=&quot;jms.resourceAdapter&quot; /&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;br/&gt;
        &amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;        &amp;lt;bean id=&quot;jms.broker&quot; class=&quot;org.apache.activemq.xbean.BrokerFactoryBean&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;property name=&quot;config&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;value&amp;gt;classpath:activemq.xml&amp;lt;/value&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                &amp;lt;property name=&quot;start&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;br/&gt;
        &amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;        &amp;lt;bean id=&quot;jms.resourceAdapter&quot;&lt;br/&gt;
class=&quot;org.apache.activemq.ra.ActiveMQResourceAdapter&quot;&lt;br/&gt;
depends-on=&quot;jms.broker&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;property name=&quot;allPrefetchValues&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;value&amp;gt;1&amp;lt;/value&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                &amp;lt;property name=&quot;initialRedeliveryDelay&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;value&amp;gt;2000&amp;lt;/value&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                &amp;lt;property name=&quot;maximumRedeliveries&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;value&amp;gt;9&amp;lt;/value&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                &amp;lt;property name=&quot;redeliveryBackOffMultiplier&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;value&amp;gt;2&amp;lt;/value&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                &amp;lt;property name=&quot;redeliveryUseExponentialBackOff&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;                &amp;lt;property name=&quot;serverUrl&quot;&amp;gt;&lt;br/&gt;
                        &amp;lt;value&amp;gt;vm://localhost&amp;lt;/value&amp;gt;&lt;br/&gt;
                &amp;lt;/property&amp;gt;&lt;br/&gt;
        &amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;I have written a test case using Geronimo&apos;s TM, but it succeeds.  The configuration is very different, so I don&apos;t think it can be attributed to just a simple change in TM.  A lot of other configuration changes had to be made.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Sun JDK 1.5.0_06, Jencks 1.1.3, AMQ 4.0, Resin Pro 3.0.14&lt;/p&gt;</environment>
        <key id="12481638">AMQ-731</key>
            <summary>Redeliveries don&apos;t work with resource adapter and Jencks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jstrachan">James Strachan</assignee>
                                    <reporter username="cgs">Christopher G. Stach II</reporter>
                        <labels>
                    </labels>
                <created>Wed, 31 May 2006 02:20:11 +0000</created>
                <updated>Fri, 9 Jun 2006 13:45:18 +0000</updated>
                            <resolved>Fri, 9 Jun 2006 13:45:18 +0000</resolved>
                                    <version>4.0</version>
                                    <fixVersion>4.0.1</fixVersion>
                    <fixVersion>4.1.0</fixVersion>
                                    <component>Connector</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12937960" author="cgs" created="Sat, 3 Jun 2006 01:32:08 +0000"  >&lt;p&gt;Okay, here&apos;s a bit more information.  While stepping through a rollback, I&apos;ve found l.elementData in TransactionContext.rollback(Xid) to contain 24 entries for the &lt;em&gt;same&lt;/em&gt; TransactionContext.  The loop at line 407 iterates over all of these, calling afterRollback on each.  afterRollback calls Synchronization.afterRollback at ActiveMQSession line 706 where redelivery is evaluated.  Since max redeliveries is set at 9 and there are 24 entries, the redeliveries are exhausted before this loop completes.&lt;/p&gt;

&lt;p&gt;So, the question is, why 24 entries?&lt;/p&gt;</comment>
                            <comment id="12936226" author="cgs" created="Sat, 3 Jun 2006 01:47:41 +0000"  >&lt;p&gt;Oh, I should add, that once the redeliveries are exhausted, it ends up getting a ConnectionClosedException and jumping down to TransactionContext line 414.&lt;/p&gt;</comment>
                            <comment id="12937993" author="cgs" created="Sat, 3 Jun 2006 02:36:12 +0000"  >&lt;p&gt;Okay, this is the stack trace with a breakpoint put at TransactionContext line 560.  It happens over and over and over, each time the transaction is suspended.&lt;/p&gt;

&lt;p&gt;Thread &lt;span class=&quot;error&quot;&gt;&amp;#91;resin-30&amp;#93;&lt;/span&gt; (Suspended (breakpoint at line 560 in TransactionContext))	&lt;br/&gt;
	TransactionContext.setXid(Xid) line: 560	&lt;br/&gt;
	TransactionContext.end(Xid, int) line: 327	&lt;br/&gt;
	LocalAndXATransaction.end(Xid, int) line: 89	&lt;br/&gt;
	WrapperNamedXAResource.end(Xid, int) line: 51	&lt;br/&gt;
	TransactionImpl.suspend() line: 448	&lt;br/&gt;
	TransactionManagerImpl.suspend() line: 201	&lt;br/&gt;
	TreeCache.suspend() line: 101	&lt;br/&gt;
	TreeCache.put(Object, Object) line: 71	&lt;br/&gt;
	UpdateTimestampsCache.preinvalidate(Serializable[]) line: 54	&lt;br/&gt;
	ActionQueue.execute(Executable) line: 244	&lt;br/&gt;
	DefaultSaveOrUpdateEventListener(AbstractSaveEventListener).performSaveOrReplicate(Object, EntityKey, EntityPersister, boolean, Object, EventSource, boolean) line: 290	&lt;br/&gt;
	DefaultSaveOrUpdateEventListener(AbstractSaveEventListener).performSave(Object, Serializable, EntityPersister, boolean, Object, EventSource, boolean) line: 180	&lt;br/&gt;
	DefaultSaveOrUpdateEventListener(AbstractSaveEventListener).saveWithGeneratedId(Object, String, Object, EventSource, boolean) line: 108	&lt;br/&gt;
	DefaultSaveOrUpdateEventListener.saveWithGeneratedOrRequestedId(SaveOrUpdateEvent) line: 186	&lt;br/&gt;
	DefaultSaveOrUpdateEventListener.entityIsTransient(SaveOrUpdateEvent) line: 175	&lt;br/&gt;
	DefaultSaveOrUpdateEventListener.performSaveOrUpdate(SaveOrUpdateEvent) line: 98	&lt;br/&gt;
	DefaultSaveOrUpdateEventListener.onSaveOrUpdate(SaveOrUpdateEvent) line: 70	&lt;br/&gt;
	SessionImpl.fireSaveOrUpdate(SaveOrUpdateEvent) line: 509	&lt;br/&gt;
	SessionImpl.saveOrUpdate(String, Object) line: 501	&lt;br/&gt;
	SessionImpl.saveOrUpdate(Object) line: 497	&lt;br/&gt;
	HibernateTemplate$18.doInHibernate(Session) line: 693	&lt;br/&gt;
	HibernateTemplate.execute(HibernateCallback, boolean) line: 366	&lt;br/&gt;
	HibernateTemplate.saveOrUpdate(Object) line: 690	&lt;br/&gt;
	LeadDAOImpl(AbstractDAOImpl&amp;lt;E&amp;gt;).saveOrUpdate(E) line: 281	&lt;br/&gt;
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available &lt;span class=&quot;error&quot;&gt;&amp;#91;native method&amp;#93;&lt;/span&gt;	&lt;br/&gt;
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 39	&lt;br/&gt;
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 25	&lt;br/&gt;
	Method.invoke(Object, Object...) line: 585	&lt;br/&gt;
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 287	&lt;br/&gt;
	ReflectiveMethodInvocation.invokeJoinpoint() line: 181	&lt;br/&gt;
	ReflectiveMethodInvocation.proceed() line: 148	&lt;br/&gt;
	TransactionInterceptor.invoke(MethodInvocation) line: 96	&lt;br/&gt;
	ReflectiveMethodInvocation.proceed() line: 170	&lt;br/&gt;
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 176	&lt;br/&gt;
	$Proxy46.saveOrUpdate(Object) line: not available	&lt;br/&gt;
	RefinanceLeadImpl(LeadImpl).save() line: 545	&lt;br/&gt;
	ProcessorImpl.processLead(DistributionContext, Lead) line: 126	&lt;br/&gt;
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available &lt;span class=&quot;error&quot;&gt;&amp;#91;native method&amp;#93;&lt;/span&gt;	&lt;br/&gt;
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 39	&lt;br/&gt;
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 25	&lt;br/&gt;
	Method.invoke(Object, Object...) line: 585	&lt;br/&gt;
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 287	&lt;br/&gt;
	ReflectiveMethodInvocation.invokeJoinpoint() line: 181	&lt;br/&gt;
	ReflectiveMethodInvocation.proceed() line: 148	&lt;br/&gt;
	TransactionInterceptor.invoke(MethodInvocation) line: 96	&lt;br/&gt;
	ReflectiveMethodInvocation.proceed() line: 170	&lt;br/&gt;
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 176	&lt;br/&gt;
	$Proxy74.processLead(DistributionContext, Lead) line: not available	&lt;br/&gt;
	ProcessorFacadeImpl$1.run() line: 92	&lt;br/&gt;
	ProcessorFacadeImpl(DistributionContextWrapper).wrap(DistributionContextWrapper$DistributionContextRunnable) line: 124	&lt;br/&gt;
	ProcessorFacadeImpl.processLead(Lead) line: 89	&lt;br/&gt;
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available &lt;span class=&quot;error&quot;&gt;&amp;#91;native method&amp;#93;&lt;/span&gt;	&lt;br/&gt;
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 39	&lt;br/&gt;
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 25	&lt;br/&gt;
	Method.invoke(Object, Object...) line: 585	&lt;br/&gt;
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 287	&lt;br/&gt;
	ReflectiveMethodInvocation.invokeJoinpoint() line: 181	&lt;br/&gt;
	ReflectiveMethodInvocation.proceed() line: 148	&lt;br/&gt;
	TransactionInterceptor.invoke(MethodInvocation) line: 96	&lt;br/&gt;
	ReflectiveMethodInvocation.proceed() line: 170	&lt;br/&gt;
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 176	&lt;br/&gt;
	$Proxy75.processLead(Lead) line: not available	&lt;br/&gt;
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available &lt;span class=&quot;error&quot;&gt;&amp;#91;native method&amp;#93;&lt;/span&gt;	&lt;br/&gt;
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 39	&lt;br/&gt;
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 25	&lt;br/&gt;
	Method.invoke(Object, Object...) line: 585	&lt;br/&gt;
	AopUtils.invokeJoinpointUsingReflection(Object, Method, Object[]) line: 287	&lt;br/&gt;
	ReflectiveMethodInvocation.invokeJoinpoint() line: 181	&lt;br/&gt;
	ReflectiveMethodInvocation.proceed() line: 148	&lt;br/&gt;
	RemoteInvocationTraceInterceptor.invoke(MethodInvocation) line: 68	&lt;br/&gt;
	ReflectiveMethodInvocation.proceed() line: 170	&lt;br/&gt;
	JdkDynamicAopProxy.invoke(Object, Method, Object[]) line: 176	&lt;br/&gt;
	$Proxy0.processLead(Lead) line: not available	&lt;br/&gt;
	NativeMethodAccessorImpl.invoke0(Method, Object, Object[]) line: not available &lt;span class=&quot;error&quot;&gt;&amp;#91;native method&amp;#93;&lt;/span&gt;	&lt;br/&gt;
	NativeMethodAccessorImpl.invoke(Object, Object[]) line: 39	&lt;br/&gt;
	DelegatingMethodAccessorImpl.invoke(Object, Object[]) line: 25	&lt;br/&gt;
	Method.invoke(Object, Object...) line: 585	&lt;br/&gt;
	LingoInvocation(RemoteInvocation).invoke(Object) line: 179	&lt;br/&gt;
	DefaultRemoteInvocationExecutor.invoke(RemoteInvocation, Object) line: 33	&lt;br/&gt;
	JmsServiceExporterMessageListener(RemoteInvocationBasedExporter).invoke(RemoteInvocation, Object) line: 76	&lt;br/&gt;
	JmsServiceExporterMessageListener(RemoteInvocationBasedExporter).invokeAndCreateResult(RemoteInvocation, Object) line: 112	&lt;br/&gt;
	JmsServiceExporterMessageListener(JmsServiceExporterSupport).onMessage(Message) line: 85	&lt;br/&gt;
	XAEndpoint.onMessage(Message) line: 126	&lt;br/&gt;
	MessageEndpointProxy$MessageEndpointAlive.onMessage(MessageEndpointProxy, Message) line: 120	&lt;br/&gt;
	MessageEndpointProxy.onMessage(Message) line: 60	&lt;br/&gt;
	ActiveMQSession.run() line: 692	&lt;br/&gt;
	ServerSessionImpl.run() line: 163	&lt;br/&gt;
	WorkThread.run() line: 99	&lt;br/&gt;
	ThreadPool.runTasks() line: 490	&lt;br/&gt;
	ThreadPool.run() line: 423	&lt;br/&gt;
	Thread.run() line: 595	&lt;/p&gt;</comment>
                            <comment id="12937922" author="cgs" created="Sat, 3 Jun 2006 02:38:36 +0000"  >&lt;p&gt;So, with that being said, should endedXATransactionContexts actually be a Map of LinkedHashSets?&lt;/p&gt;</comment>
                            <comment id="12937880" author="cgs" created="Mon, 5 Jun 2006 23:47:56 +0000"  >&lt;p&gt;Comparing Resin&apos;s and Geronmio&apos;s TransactionManagerImpl suspend methods, Geronimo&apos;s doesn&apos;t even suspend the transaction.  The test case I have could probably never work, and it&apos;s no wonder that none of the AMQ developers have come across this if testing is only done with Geronimo.&lt;/p&gt;</comment>
                            <comment id="12937825" author="cgs" created="Tue, 6 Jun 2006 00:12:50 +0000"  >&lt;p&gt;Resin&apos;s TransactionImpl.suspend() method, which doesn&apos;t exist in Geronimo, calls XAResource.end(Xid, XAResource.TMSUSPEND),  WrapperNamedXAResource.end(Xid, int) line: 51 in the above stack trace.&lt;/p&gt;</comment>
                            <comment id="12937832" author="djencks" created="Tue, 6 Jun 2006 00:36:04 +0000"  >&lt;p&gt;Resin&apos;s  tx implementation is wrong.  suspend is only supposed to remove the thread/tx association, not change what resources are enrolled in the tx.&lt;/p&gt;</comment>
                            <comment id="12938064" author="cgs" created="Tue, 6 Jun 2006 01:19:34 +0000"  >&lt;p&gt;How would a single connection be used for multiple transaction branches if end is never called with TMSUSPEND?&lt;/p&gt;</comment>
                            <comment id="12938215" author="djencks" created="Tue, 6 Jun 2006 02:42:28 +0000"  >&lt;p&gt;I assume you mean mutliple jta transactions rather than multiple branches of a single jta transaction.  In this case something else such as the connector framework is responsible for delisting the connection(s) from the first tx and enlisting them in the 2nd tx.  IIRC this is stated rather unclearly in the jta spec and slightly more clearly but in terms of c programming in the xa spec.&lt;/p&gt;

&lt;p&gt;In geronimo we normally don&apos;t do this.  The only time you can change transactions with suspend/resume is going into an ejb RequiresNew method and in this case we just give you new connections.  There is an experimental way of delisting connections and reusing them in the new transaction, but AFAIK no one has ever used it.  What are the circumstances that lead Resin to suspend/resume?&lt;/p&gt;</comment>
                            <comment id="12938121" author="cgs" created="Tue, 6 Jun 2006 02:51:01 +0000"  >&lt;p&gt;It could be multiple transactions or multiple branches.  For example, a single database connection can support X number of concurrent transactions as well as Y number of branches within each transaction.  I assume that since Resin is the application server, the transaction manager, and the JCA container, it is calling end on the enlisted XAResources.&lt;/p&gt;

&lt;p&gt;Check out the stack trace above.  JBoss TreeCache is calling suspend on the TM to do some work outside of the transaction (TreeCache.suspend() line: 101).  We use Hibernate&apos;s connection after_statement release mode, which is appropriate for connections using JTA.&lt;/p&gt;</comment>
                            <comment id="12936227" author="cgs" created="Tue, 6 Jun 2006 03:27:05 +0000"  >&lt;p&gt;This simple patch fixes the whole problem.&lt;/p&gt;</comment>
                            <comment id="12936297" author="jstrachan" created="Fri, 9 Jun 2006 13:45:18 +0000"  >&lt;p&gt;Patch applied with thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12460787" name="amq-txcontext.patch" size="876" author="cgs" created="Tue, 6 Jun 2006 03:27:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84346</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            19 years, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s2lz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161899</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>