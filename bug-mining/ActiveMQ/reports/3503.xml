<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:59:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-9689] Network of Broker durable sync TTL fixes and improvements</title>
                <link>https://issues.apache.org/jira/browse/AMQ-9689</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Some recent testing has shown a few issues related to the syncing and reactivation of durable subscriptions over a network of brokers related to TTL. &lt;/p&gt;

&lt;p&gt;The root cause of the problem is that when the durable subscriptions are first created the original consumer info is attached to the advisories and TTL information is available so that the consumerTTL can be checked and subscriptions will not propagate where they shouldn&apos;t. The problem is when brokers are restarted, the durable sync that is done (and also re-activation of durables when dynamicOnly is false) may process the durables when they are offline still and those durables will be missing the consumer info and not contain the brokerPath anymore for what created the durable. &lt;/p&gt;

&lt;p&gt;This means that in some scenarios extra demand and durables get created when they shouldn&apos;t based on TTL. There was a minor bug as well where the clientId for the network durables during sync was not looked at so the sending side would send extra durables over. The receiving side should have still filtered but this may have not worked all the time, it&apos;s hard to tell. Either way the new version filters properly both on the send/receiving side and reduces traffic as well.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Note:&lt;/b&gt; We can some of the bugs and issues, but for TTL &amp;gt; 1, the only true way to prevent demand from propagating on broker restarts with offline durables in all cases is to set &lt;tt&gt;dynamicOnly&lt;/tt&gt; to &lt;b&gt;true&lt;/b&gt; and allow fully consumer driven demand.  Otherwise on restart and sync, if the durables are still offline, TTL info is missing. We can still handle the ttl -1 and TTL 1 case entirely.&lt;/p&gt;

&lt;p&gt;The following updates and fixes are being made to address the issues:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;A fix for a bug during durable sync where the cliendId was not used to filter durables on send so the subscription list could contain extra durables that it shouldn&apos;t. In theory on the receiving side it should have checked and filtered but I think there may have been cases that could cause a loop, either way this reduces the extra traffic and is an improvement on the sync.&lt;/li&gt;
	&lt;li&gt;During reactivation, when &lt;tt&gt;dynamicOnly&lt;/tt&gt; is false, we should make sure to include the TTL information (full broker path) from the online consumer attached to durables so that TTL info is properly propagated so we don&apos;t incorrectly create demand. This only works if consumers are online, so for TTL &amp;gt; 1 it is still recommended to set dynamicOnly to true and allow only online consumers drive demand.&lt;/li&gt;
	&lt;li&gt;For TTL 1, a bug has been fixed as well on the sync for proxy durables. We can improve the filtering and now handle sync correctly on restarts even if durables are offline and missing consumer TTL info because we know that we should ignore proxy durables (bridge durables for other bridges) entirely because they will be &amp;gt; 1 hop away. Previously extra demand could be created on broker restart due to the missing TTL info so this is a bug fixed by this.&lt;/li&gt;
	&lt;li&gt;Some other minor improvements were made like filtering everything if TTL is 0 and also consolidating logic.&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="13614868">AMQ-9689</key>
            <summary>Network of Broker durable sync TTL fixes and improvements</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="cshannon">Christopher L. Shannon</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Apr 2025 14:54:51 +0000</created>
                <updated>Fri, 11 Apr 2025 14:04:30 +0000</updated>
                            <resolved>Fri, 11 Apr 2025 14:04:30 +0000</resolved>
                                    <version>5.19.0</version>
                    <version>6.1.6</version>
                                    <fixVersion>6.2.0</fixVersion>
                    <fixVersion>5.19.1</fixVersion>
                    <fixVersion>6.1.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4200">1h 10m</timespent>
                                <comments>
                            <comment id="17943538" author="jira-bot" created="Fri, 11 Apr 2025 12:14:14 +0000"  >&lt;p&gt;Commit 953737ca082e1ff67cf0b408e7ec72cd89be75ac in activemq&apos;s branch refs/heads/main from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=953737ca08&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=953737ca08&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9689&quot; title=&quot;Network of Broker durable sync TTL fixes and improvements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9689&quot;&gt;&lt;del&gt;AMQ-9689&lt;/del&gt;&lt;/a&gt; - Network of Broker durable sync TTL fixes and improvements (#1419)&lt;/p&gt;

&lt;p&gt;This commit makes several improvements and fixes for syncing durable&lt;br/&gt;
subscriptions when a network bridge connects.&lt;/p&gt;

&lt;p&gt;1) A bug was fixed during durable sync that would cause the clientId&lt;br/&gt;
to not always be included for durables in the subscription list which&lt;br/&gt;
could cause a loop to be created as the other broker would not be able&lt;br/&gt;
to tell where the network subscription came from.&lt;/p&gt;

&lt;p&gt;2) During reactivation when dynamicOnly is false and durable sync is set&lt;br/&gt;
to true, we make sure to include the TTL information (full broker path)&lt;br/&gt;
from the online consumer attached to durables so that TTL info is properly&lt;br/&gt;
 propagated so we don&apos;t incorrectly create demand. Thisonly works if&lt;br/&gt;
consumers are online, so for TTL &amp;gt; 1 it is still recommended to set&lt;br/&gt;
dynamicOnly to true and allow only online consumers drive demand.&lt;/p&gt;

&lt;p&gt;3) For TTL 1, we can handle sync correctly on restarts even if durables&lt;br/&gt;
are offline and missing consumer TTL info because we know that we should&lt;br/&gt;
ignore proxy durables (bridge durables for other bridges) entirely because&lt;br/&gt;
they will be &amp;gt; 1 hop away.&lt;/p&gt;

&lt;p&gt;4) Some other minor improvements were made like filtering everything if&lt;br/&gt;
TTL is 0 and also consolidating logic.&lt;/p&gt;</comment>
                            <comment id="17943563" author="christopher.l.shannon" created="Fri, 11 Apr 2025 13:43:26 +0000"  >&lt;p&gt;Because these changes are to fix bugs and the improvements correct invalid behavior I think this can be treated entirely as a bug fix and back ported. Also, the durableSync feature is off by default in general anyways and most people probably do not use this feature.&lt;/p&gt;</comment>
                            <comment id="17943568" author="jira-bot" created="Fri, 11 Apr 2025 13:48:44 +0000"  >&lt;p&gt;Commit 182c598df544661e0d2e947dafaf1020ca331d6d in activemq&apos;s branch refs/heads/activemq-6.1.x from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=182c598df5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=182c598df5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9689&quot; title=&quot;Network of Broker durable sync TTL fixes and improvements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9689&quot;&gt;&lt;del&gt;AMQ-9689&lt;/del&gt;&lt;/a&gt; - Network of Broker durable sync TTL fixes and improvements (#1419)&lt;/p&gt;

&lt;p&gt;This commit makes several improvements and fixes for syncing durable&lt;br/&gt;
subscriptions when a network bridge connects.&lt;/p&gt;

&lt;p&gt;1) A bug was fixed during durable sync that would cause the clientId&lt;br/&gt;
to not always be included for durables in the subscription list which&lt;br/&gt;
could cause a loop to be created as the other broker would not be able&lt;br/&gt;
to tell where the network subscription came from.&lt;/p&gt;

&lt;p&gt;2) During reactivation when dynamicOnly is false and durable sync is set&lt;br/&gt;
to true, we make sure to include the TTL information (full broker path)&lt;br/&gt;
from the online consumer attached to durables so that TTL info is properly&lt;br/&gt;
 propagated so we don&apos;t incorrectly create demand. Thisonly works if&lt;br/&gt;
consumers are online, so for TTL &amp;gt; 1 it is still recommended to set&lt;br/&gt;
dynamicOnly to true and allow only online consumers drive demand.&lt;/p&gt;

&lt;p&gt;3) For TTL 1, we can handle sync correctly on restarts even if durables&lt;br/&gt;
are offline and missing consumer TTL info because we know that we should&lt;br/&gt;
ignore proxy durables (bridge durables for other bridges) entirely because&lt;br/&gt;
they will be &amp;gt; 1 hop away.&lt;/p&gt;

&lt;p&gt;4) Some other minor improvements were made like filtering everything if&lt;br/&gt;
TTL is 0 and also consolidating logic.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 953737ca082e1ff67cf0b408e7ec72cd89be75ac)&lt;/p&gt;</comment>
                            <comment id="17943578" author="jira-bot" created="Fri, 11 Apr 2025 14:02:36 +0000"  >&lt;p&gt;Commit 58006d4894b08ab7adae7dbf0ade220bd30850ac in activemq&apos;s branch refs/heads/activemq-5.19.x from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=58006d4894&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=58006d4894&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9689&quot; title=&quot;Network of Broker durable sync TTL fixes and improvements&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9689&quot;&gt;&lt;del&gt;AMQ-9689&lt;/del&gt;&lt;/a&gt; - Network of Broker durable sync TTL fixes and improvements (#1419)&lt;/p&gt;

&lt;p&gt;This commit makes several improvements and fixes for syncing durable&lt;br/&gt;
subscriptions when a network bridge connects.&lt;/p&gt;

&lt;p&gt;1) A bug was fixed during durable sync that would cause the clientId&lt;br/&gt;
to not always be included for durables in the subscription list which&lt;br/&gt;
could cause a loop to be created as the other broker would not be able&lt;br/&gt;
to tell where the network subscription came from.&lt;/p&gt;

&lt;p&gt;2) During reactivation when dynamicOnly is false and durable sync is set&lt;br/&gt;
to true, we make sure to include the TTL information (full broker path)&lt;br/&gt;
from the online consumer attached to durables so that TTL info is properly&lt;br/&gt;
 propagated so we don&apos;t incorrectly create demand. Thisonly works if&lt;br/&gt;
consumers are online, so for TTL &amp;gt; 1 it is still recommended to set&lt;br/&gt;
dynamicOnly to true and allow only online consumers drive demand.&lt;/p&gt;

&lt;p&gt;3) For TTL 1, we can handle sync correctly on restarts even if durables&lt;br/&gt;
are offline and missing consumer TTL info because we know that we should&lt;br/&gt;
ignore proxy durables (bridge durables for other bridges) entirely because&lt;br/&gt;
they will be &amp;gt; 1 hop away.&lt;/p&gt;

&lt;p&gt;4) Some other minor improvements were made like filtering everything if&lt;br/&gt;
TTL is 0 and also consolidating logic.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 953737ca082e1ff67cf0b408e7ec72cd89be75ac)&lt;br/&gt;
(cherry picked from commit 182c598df544661e0d2e947dafaf1020ca331d6d)&lt;/p&gt;</comment>
                            <comment id="17943580" author="christopher.l.shannon" created="Fri, 11 Apr 2025 14:04:20 +0000"  >&lt;p&gt;The git comment mentions a potential looping bug fixed but I&apos;m not entirely sure if that was actually a problem after all, either way this improves things and I amended the description. The TTL 1 bug is still fixed, and other improvements with sync still to make things work more correctly that are nice so this should still be treated as a bug fix.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1vanc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>