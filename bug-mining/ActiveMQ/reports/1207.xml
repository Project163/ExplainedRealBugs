<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:50:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3222] Failover and SimpleDiscovery - query parameters getting dropped</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3222</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Using failover with static discovery makes sense in a master slave scenario. &lt;br/&gt;
With simple static discovery with a pair of uri&apos;s, &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;networkConnector uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;:(tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:32258,tcp://localhost:32259)&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; static discovery will continue to try and connect to both uris which leads to repeated logging of failed attempts to bridge to the slave that is not active yet.&lt;br/&gt;
Using failover&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;networkConnector uri=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;:(failover:(tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:32258,tcp://localhost:32259)?randomize=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&amp;amp;amp;maxReconnectAttempts=1)&quot;&lt;/span&gt;/&amp;gt;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; improves on this as the failover: transport will be content with just one uri, from the broker perspective there is a single network bridge, rather than two.&lt;br/&gt;
Currently query parameter are not correctly applied.&lt;br/&gt;
Query parameter parsing is problematic when options for a transport are duplicated by the discovery mechanism, e.g: maxReconnectAttempts. There have been some related efforts to resolve this, &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2981&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-2981&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2598&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-2598&lt;/a&gt;. Parameters are stripped from transport uris and applied to both the transport and the discovery mechanism. &lt;br/&gt;
The end result, and fix, is that additional transport options that need to be applied to discovered transport (which typically have all query parameters removed) need to be isolated from normal query parameters using a dot (prefixed with &quot;discovered.&quot;) notation. e.g: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;discovery:(multicast:&lt;span class=&quot;code-comment&quot;&gt;//&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;)?initialReconnectDelay=100&amp;amp;discovered.closeAsync=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; &lt;/p&gt;</description>
                <environment></environment>
        <key id="12501600">AMQ-3222</key>
            <summary>Failover and SimpleDiscovery - query parameters getting dropped</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                            <label>failover</label>
                            <label>networkBridge</label>
                            <label>networkConnector</label>
                    </labels>
                <created>Wed, 16 Mar 2011 16:56:44 +0000</created>
                <updated>Fri, 24 Apr 2015 14:57:06 +0000</updated>
                            <resolved>Mon, 21 Mar 2011 10:30:32 +0000</resolved>
                                    <version>5.4.2</version>
                                    <fixVersion>5.5.0</fixVersion>
                                    <component>Broker</component>
                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13009091" author="gtully" created="Mon, 21 Mar 2011 10:30:32 +0000"  >&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc?rev=1082333&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1082333&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For non static discovery of networks or client connections, parameters that need to be applied to all discovered uris should be specified on the discovery uri using the prefix &quot;discovered.&quot;.&lt;br/&gt;
Static discovery just adds the parameters in the normal way.&lt;/p&gt;</comment>
                            <comment id="14146791" author="tbain98" created="Wed, 24 Sep 2014 19:45:43 +0000"  >&lt;p&gt;Gary, contrary to your comment on 21/Mar/11, I found that I could only set socketBufferSize for the underlying transports in a static: discovery URI when prefixing with &quot;discovered.&quot;, just as you say I would need to do for a failover: discovery URI.&lt;/p&gt;

&lt;p&gt;My working URI, for ActiveMQ 5.8.0:&lt;br/&gt;
static:(tcp://hostname:port)?discovered.socketBufferSize=2498560&lt;/p&gt;

&lt;p&gt;Can you please clarify your comment to explain how query parameters should be applied to the static discovery transport and/or to the underlying discovered transports within those static discovery transports?&lt;/p&gt;</comment>
                            <comment id="14511171" author="gtully" created="Fri, 24 Apr 2015 14:57:06 +0000"  >&lt;p&gt;I would expect&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt;:(tcp:&lt;span class=&quot;code-comment&quot;&gt;//hostname:port?socketBufferSize=2498560)&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; to work also. The discovered. option to static will work too, but in the static case there is only one url to augment.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12541859">AMQ-3707</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14674</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 30 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ajpb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59465</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>