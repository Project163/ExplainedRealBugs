<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:03:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4712] MQTT unit tests fail</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4712</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Running org.apache.activemq.transport.mqtt.MQTTNioTest&lt;br/&gt;
Tests run: 19, Failures: 0, Errors: 2, Skipped: 0, Time elapsed: 160.808 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
Running org.apache.activemq.transport.mqtt.MQTTSSLTest&lt;br/&gt;
Tests run: 18, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 161.426 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
Running org.apache.activemq.transport.mqtt.MQTTTest&lt;br/&gt;
Tests run: 18, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 158.184 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;/p&gt;

&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests in error:&lt;br/&gt;
  testPingOnMQTTNIO(org.apache.activemq.transport.mqtt.MQTTNioTest): The client id MUST be configured when clean session is set to false&lt;br/&gt;
  testReceiveMessageSentWhileOffline(org.apache.activemq.transport.mqtt.MQTTNioTest): String index out of range: -6&lt;br/&gt;
  testReceiveMessageSentWhileOffline(org.apache.activemq.transport.mqtt.MQTTSSLTest): Command from server contained an invalid message id: 1&lt;br/&gt;
  testReceiveMessageSentWhileOffline(org.apache.activemq.transport.mqtt.MQTTTest): Command from server contained an invalid message id: 1&lt;/p&gt;

&lt;p&gt;Tests run: 55, Failures: 0, Errors: 4, Skipped: 0&lt;/p&gt;</description>
                <environment></environment>
        <key id="12666642">AMQ-4712</key>
            <summary>MQTT unit tests fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kearls">Kevin Anthony Earls</assignee>
                                    <reporter username="jbonofre">Jean-Baptiste Onofr&#233;</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Sep 2013 05:12:40 +0000</created>
                <updated>Wed, 2 Apr 2014 22:01:37 +0000</updated>
                            <resolved>Mon, 31 Mar 2014 15:31:24 +0000</resolved>
                                    <version>5.9.0</version>
                                    <fixVersion>5.9.1</fixVersion>
                    <fixVersion>5.10.0</fixVersion>
                                    <component>MQTT</component>
                    <component>Test Cases</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="13783808" author="davsclaus" created="Wed, 2 Oct 2013 10:43:27 +0000"  >&lt;p&gt;Yeah I got test failures also sometimes. But not consistent.&lt;/p&gt;</comment>
                            <comment id="13783809" author="davsclaus" created="Wed, 2 Oct 2013 10:45:03 +0000"  >&lt;p&gt;-------------------------------------------------------&lt;br/&gt;
 T E S T S&lt;br/&gt;
-------------------------------------------------------&lt;br/&gt;
Running org.apache.activemq.transport.mqtt.MQTTNioTest&lt;br/&gt;
Tests run: 20, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 44.976 sec&lt;br/&gt;
Running org.apache.activemq.transport.mqtt.MQTTSSLTest&lt;br/&gt;
Tests run: 18, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 42.161 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!&lt;br/&gt;
Running org.apache.activemq.transport.mqtt.MQTTTest&lt;br/&gt;
Tests run: 18, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 41.016 sec&lt;/p&gt;

&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests in error:&lt;br/&gt;
  testReceiveMessageSentWhileOffline(org.apache.activemq.transport.mqtt.MQTTSSLTest): Command from server contained an invalid message id: 1&lt;/p&gt;

&lt;p&gt;Tests run: 56, Failures: 0, Errors: 1, Skipped: 0&lt;/p&gt;</comment>
                            <comment id="13784877" author="davsclaus" created="Thu, 3 Oct 2013 07:09:11 +0000"  >&lt;p&gt;Rob did you have hours to spare to look into MQTT test failures?&lt;/p&gt;

&lt;p&gt;Would be good to get this fixed for the 5.9 release.&lt;br/&gt;
Also if there is some issues on the mqtt-client side you can get that fixed and a new release out.&lt;/p&gt;</comment>
                            <comment id="13790017" author="ceposta" created="Wed, 9 Oct 2013 04:23:30 +0000"  >&lt;p&gt;Hey JB, can you re-run the tests? I think &lt;b&gt;at least one (the first one)&lt;/b&gt; of them should be fixed now.&lt;/p&gt;

&lt;p&gt;When I run the tests, I can only get the one Claus posted about to fail. Let us know what you find.&lt;/p&gt;</comment>
                            <comment id="13790019" author="jbonofre" created="Wed, 9 Oct 2013 04:33:33 +0000"  >&lt;p&gt;Thanks for the update. Let me try again.&lt;/p&gt;

&lt;p&gt;I keep you posted.&lt;/p&gt;</comment>
                            <comment id="13792401" author="ceposta" created="Fri, 11 Oct 2013 06:40:25 +0000"  >&lt;p&gt;Guys, I took a look at this tonight. Goes deep... I won&apos;t have time to continue looking at it for a few days because i&apos;ll be with family, but if someone else wants to pick it up, here&apos;s what I found..&lt;/p&gt;

&lt;p&gt;Somehow, the MQTT client is seeing two SUBACK frames for the same messageId (as indicated from the error: Command from server contained an invalid message id: 1). The broker logs that it only sends it once.  &lt;/p&gt;

&lt;p&gt;So I took a peak at the SSLTransport and MQTTProtocolCodec... seems things are okay in that the next action is advanced properly from header to body, but for some reason, the readBuffers actually do have two instances of the SUBACK frame....&lt;/p&gt;

&lt;p&gt;Digging deeper, it seems the SSL Transport is &quot;reading&quot; those frames off the wire, but I suspect incorrectly. It &lt;b&gt;might&lt;/b&gt; have some issues w/ how it deals with buffer underflow/overflow, but I couldn&apos;t pin it down for sure.&lt;/p&gt;

&lt;p&gt;If nobody else gets to it, i&apos;ll pick it up later this weekend when I get a sec.  &lt;/p&gt;</comment>
                            <comment id="13792613" author="tabish121" created="Fri, 11 Oct 2013 13:28:59 +0000"  >&lt;p&gt;I&apos;ve seen this on all the transports not just SSL transport, all the MQTT tests will fail with this extra SUBACK packet from time to time.&lt;/p&gt;</comment>
                            <comment id="13822471" author="kearls" created="Thu, 14 Nov 2013 14:20:11 +0000"  >&lt;p&gt;I just saw a case where testSendMQTTReceiveJMS hung on one of the CI boxes.  I&apos;ll attach a stack trace.&lt;/p&gt;</comment>
                            <comment id="13877487" author="kearls" created="Tue, 21 Jan 2014 14:11:31 +0000"  >&lt;p&gt;Added @Ignore to testReceiveMessageSentWhileOffline in both MQTTSSLTest and MQTTNioTest as both were failing regularly on CI.&lt;/p&gt;</comment>
                            <comment id="13955266" author="tabish121" created="Mon, 31 Mar 2014 15:05:57 +0000"  >&lt;p&gt;@Kevin I think you can probably close this one now, the tests all seem pretty stable for MQTT&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12613834" name="MQTTTest.testSendMQTTReceiveJMS.stack" size="9998" author="kearls" created="Thu, 14 Nov 2013 14:21:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346580</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 34 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1nrj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346881</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>