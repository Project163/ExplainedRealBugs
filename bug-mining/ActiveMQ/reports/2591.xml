<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:11:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5814] Wrong with role-based authorization when using right permission</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5814</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Since version 5.10, the problem has been caused by broker. It was behaving wrong with role-based authorization. I have configured right SimpleAuthorization plugin but no luck.  &lt;/p&gt;

&lt;p&gt;I guess it has problem from &lt;del&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5160&quot; title=&quot;Wildcard subscriptions bypass Authentication / Authorization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5160&quot;&gt;&lt;del&gt;AMQ-5160&lt;/del&gt;&lt;/a&gt;&lt;/del&gt; &lt;/p&gt;

&lt;p&gt;Here my test cases on github, please review and let me know if you have any questions: &lt;a href=&quot;https://github.com/hongphu8790/activemq/tree/master/mqtt-authorization-test&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hongphu8790/activemq/tree/master/mqtt-authorization-test&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Project test-case descriptions:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Using debug mode for broker to view detail&lt;br/&gt;
problem.&lt;/li&gt;
	&lt;li&gt;Repeat with pom.xml file&lt;br/&gt;
+ With AMQ 5.9.1 (it will pass all test cases)&lt;br/&gt;
+ With AMQ &amp;gt;= 5.10.0 (it will pass only test cases with using publisher have super permission&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Here my log occurred when the test case failed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Log debug mode - activemq.log&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2015-05-29 10:30:24,746 | DEBUG | AbstractRegion                 | Subscription denied &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; TopicSubscription: consumer=ID:XXXXXX-50828-1432870224218-2:2:-1:1, destinations=0, dispatched=0, delivered=0, matched=0, discarded=0 to destination topic:&lt;span class=&quot;code-comment&quot;&gt;//dcu.id: User publisher is not authorized to read from: topic://dcu.id&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;Unix, Windows&lt;/p&gt;</environment>
        <key id="12833667">AMQ-5814</key>
            <summary>Wrong with role-based authorization when using right permission</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="hongphu8790">PhuNH5-VTICT</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 May 2015 04:27:42 +0000</created>
                <updated>Tue, 4 Aug 2015 12:51:37 +0000</updated>
                            <resolved>Thu, 2 Jul 2015 15:41:19 +0000</resolved>
                                    <version>5.10.0</version>
                    <version>5.10.2</version>
                    <version>5.11.0</version>
                    <version>5.11.1</version>
                                    <fixVersion>5.11.2</fixVersion>
                    <fixVersion>5.12.0</fixVersion>
                                    <component>Broker</component>
                    <component>MQTT</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14564913" author="tabish121" created="Fri, 29 May 2015 14:43:36 +0000"  >&lt;p&gt;Have you tried against a 5.12-SNAPSHOT, there have been some fixes in this area I think. &lt;/p&gt;</comment>
                            <comment id="14565799" author="hongphu8790" created="Sat, 30 May 2015 02:47:54 +0000"  >&lt;p&gt;Hi Timothy Bish,&lt;/p&gt;

&lt;p&gt;I was tested again with 5.12-snapshot, and no luck. Please view my attachment: activemq-snapshot-5.12-20150529.223833.txt&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14572736" author="hongphu8790" created="Thu, 4 Jun 2015 13:17:21 +0000"  >&lt;p&gt;Hi Timothy Bish,&lt;/p&gt;

&lt;p&gt;This was a big problem for my production. I couldn&apos;t use AMQ version greater than version 5.9.1.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14609680" author="hongphu8790" created="Wed, 1 Jul 2015 07:28:15 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Please help me to reproduce this error, we couldn&apos;t use AMQ version greater than 5.9.1 with SimpleAuthorization support.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14611077" author="tabish121" created="Wed, 1 Jul 2015 22:12:29 +0000"  >&lt;p&gt;I wrote a little test that doesn&apos;t requite MQTT to reproduce, the difference from previous behaviour seems to have come from the changes made for &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5160&quot; title=&quot;Wildcard subscriptions bypass Authentication / Authorization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5160&quot;&gt;&lt;del&gt;AMQ-5160&lt;/del&gt;&lt;/a&gt;.  Some further investigation is needed.  &lt;/p&gt;</comment>
                            <comment id="14611078" author="tabish121" created="Wed, 1 Jul 2015 22:13:18 +0000"  >&lt;p&gt;Changes here seem to have introduced this behavior&lt;/p&gt;</comment>
                            <comment id="14611809" author="christopher.l.shannon" created="Thu, 2 Jul 2015 11:26:05 +0000"  >&lt;p&gt;I looked at this a little yesterday.  When the producer sends a message it causes a new destination to get created because the subscriber is listening on a wildcard destination.  The issue seems to be that during destination creation, the ConnectionContext of the producer is used to create the destination, instead of the consumer.  (Happens in addSubscriptionsForDestination method of TopicRegion).  The end result is the security check fails in the addSubscription method of AuthorizationDestinationFilter because it uses the producer&apos;s ACLs instead of the consumer&apos;s ACLs to determine if the subscription is allowed.&lt;/p&gt;</comment>
                            <comment id="14611818" author="hongphu8790" created="Thu, 2 Jul 2015 11:39:42 +0000"  >&lt;p&gt;This is a big bug, i think so. Could you tell me how to bypass or fix this problem. We have waited a long time since first release AMQ 5.9.1.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14611887" author="githubbot" created="Thu, 2 Jul 2015 12:35:56 +0000"  >&lt;p&gt;GitHub user cshannon opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/125&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/125&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5814&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5814&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This fixes an issue where a producer&apos;s connection context was being&lt;br/&gt;
    used to create a subscription instead of the consumer&apos;s context&lt;br/&gt;
    which could lead to permission check failures.&lt;/p&gt;

&lt;p&gt;    Thanks to hongphu8790@gmail.com for providing the test case.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/cshannon/activemq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/cshannon/activemq&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5814&quot; title=&quot;Wrong with role-based authorization when using right permission&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5814&quot;&gt;&lt;del&gt;AMQ-5814&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/125.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/125.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #125&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit ef552fcc8bb14eea33170019aca2850e3c03467d&lt;br/&gt;
Author: Christopher L. Shannon (cshannon) &amp;lt;christopher.l.shannon@gmail.com&amp;gt;&lt;br/&gt;
Date:   2015-07-02T12:33:16Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5814&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5814&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    This fixes an issue where a producer&apos;s connection context was being&lt;br/&gt;
    used to create a subscription instead of the consumer&apos;s context&lt;br/&gt;
    which could lead to permission check failures.&lt;/p&gt;

&lt;p&gt;    Thanks to hongphu8790@gmail.com for providing the test case.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14611893" author="christopher.l.shannon" created="Thu, 2 Jul 2015 12:40:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hongphu8790&quot; class=&quot;user-hover&quot; rel=&quot;hongphu8790&quot;&gt;hongphu8790&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;I have pushed up a pull request to fix this issue and included your test case in the patch to make sure that the issue stays fixed.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Can you take a look and make sure it looks ok?  It seemed like a very simple fix but I just want to make sure what I changed wouldn&apos;t have any unintended consequences.  I ran through some of the tests relating to &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5160&quot; title=&quot;Wildcard subscriptions bypass Authentication / Authorization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5160&quot;&gt;&lt;del&gt;AMQ-5160&lt;/del&gt;&lt;/a&gt; and they all still seemed to pass.  I&apos;m running through all the tests right now but that will take a while to finish.&lt;/p&gt;</comment>
                            <comment id="14611912" author="tabish121" created="Thu, 2 Jul 2015 12:55:05 +0000"  >&lt;p&gt;I was testing a similar fix last night, guess I should have assigned this one to myself to avoid duplication of effort, oops.  So I made basically the same change although I tried to ensure that a valid context was always passed along by checking that the context in the sub was non-null and using the pass in context if none was supplied in the subscription.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;        ConnectionContext originalContext = sub.getContext() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? sub.getContext() : context;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From a run of the tests with this change I didn&apos;t see any new failures so I don&apos;t think there are any hidden surprises.  If you want to update your PR and do some additional sanity checks we can just push that.&lt;/p&gt;

&lt;p&gt;I also created a simpler OpenWire only test since this actually affects any client connection which I will show below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;/**
 * Licensed to the Apache Software Foundation (ASF) under one or more
 * contributor license agreements.  See the NOTICE file distributed with
 * &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; work &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; additional information regarding copyright ownership.
 * The ASF licenses &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; file to You under the Apache License, Version 2.0
 * (the &lt;span class=&quot;code-quote&quot;&gt;&quot;License&quot;&lt;/span&gt;); you may not use &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; file except in compliance with
 * the License.  You may obtain a copy of the License at
 *
 *      http:&lt;span class=&quot;code-comment&quot;&gt;//www.apache.org/licenses/LICENSE-2.0
&lt;/span&gt; *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &lt;span class=&quot;code-quote&quot;&gt;&quot;AS IS&quot;&lt;/span&gt; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the specific language governing permissions and
 * limitations under the License.
 */
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.apache.activemq.bugs;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; org.junit.Assert.assertNotNull;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.net.URI;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.ArrayList;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.util.List;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.jms.Connection;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.jms.ConnectionFactory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.jms.MessageConsumer;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.jms.MessageProducer;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.jms.Session;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.jms.Topic;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.activemq.ActiveMQConnectionFactory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.activemq.broker.BrokerPlugin;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.activemq.broker.BrokerService;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.activemq.broker.TransportConnector;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.activemq.filter.DestinationMapEntry;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.activemq.security.AuthenticationUser;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.activemq.security.AuthorizationEntry;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.activemq.security.AuthorizationPlugin;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.activemq.security.DefaultAuthorizationMap;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.activemq.security.SimpleAuthenticationPlugin;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.After;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.Before;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.Test;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;AMQ5814Test {

    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; BrokerService brokerService;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; openwireClientUrl;

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; BrokerPlugin configureAuthentication() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        List&amp;lt;AuthenticationUser&amp;gt; users = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
        users.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AuthenticationUser(&lt;span class=&quot;code-quote&quot;&gt;&quot;publisher&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;publisher&quot;&lt;/span&gt;));
        users.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AuthenticationUser(&lt;span class=&quot;code-quote&quot;&gt;&quot;subscriber&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;subscriber&quot;&lt;/span&gt;));
        users.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AuthenticationUser(&lt;span class=&quot;code-quote&quot;&gt;&quot;admin&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;publisher,subscriber&quot;&lt;/span&gt;));

        SimpleAuthenticationPlugin authenticationPlugin = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SimpleAuthenticationPlugin(users);

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; authenticationPlugin;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; BrokerPlugin configureAuthorization() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

        @SuppressWarnings(&lt;span class=&quot;code-quote&quot;&gt;&quot;rawtypes&quot;&lt;/span&gt;)
        List&amp;lt;DestinationMapEntry&amp;gt; authorizationEntries = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();

        AuthorizationEntry entry = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AuthorizationEntry();
        entry.setTopic(&lt;span class=&quot;code-quote&quot;&gt;&quot;dcu.&amp;gt;&quot;&lt;/span&gt;);
        entry.setRead(&lt;span class=&quot;code-quote&quot;&gt;&quot;subscriber&quot;&lt;/span&gt;);
        entry.setWrite(&lt;span class=&quot;code-quote&quot;&gt;&quot;publisher&quot;&lt;/span&gt;);
        entry.setAdmin(&lt;span class=&quot;code-quote&quot;&gt;&quot;publisher,subscriber&quot;&lt;/span&gt;);
        authorizationEntries.add(entry);

        entry = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AuthorizationEntry();
        entry.setTopic(&lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ.Advisory.&amp;gt;&quot;&lt;/span&gt;);
        entry.setRead(&lt;span class=&quot;code-quote&quot;&gt;&quot;publisher,subscriber&quot;&lt;/span&gt;);
        entry.setWrite(&lt;span class=&quot;code-quote&quot;&gt;&quot;publisher,subscriber&quot;&lt;/span&gt;);
        entry.setAdmin(&lt;span class=&quot;code-quote&quot;&gt;&quot;publisher,subscriber&quot;&lt;/span&gt;);
        authorizationEntries.add(entry);

        DefaultAuthorizationMap authorizationMap = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultAuthorizationMap(authorizationEntries);
        AuthorizationPlugin authorizationPlugin = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AuthorizationPlugin(authorizationMap);

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; authorizationPlugin;
    }

    @Before
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setup() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {

        TransportConnector openwireConnector = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TransportConnector();
        openwireConnector.setUri(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; URI(&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//localhost:0&quot;&lt;/span&gt;));
&lt;/span&gt;        openwireConnector.setName(&lt;span class=&quot;code-quote&quot;&gt;&quot;openwire&quot;&lt;/span&gt;);

        ArrayList&amp;lt;BrokerPlugin&amp;gt; plugins = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&amp;gt;();
        plugins.add(configureAuthentication());
        plugins.add(configureAuthorization());

        brokerService = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BrokerService();
        brokerService.setPersistent(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
        brokerService.addConnector(openwireConnector);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!plugins.isEmpty()) {
            BrokerPlugin[] array = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BrokerPlugin[plugins.size()];
            brokerService.setPlugins(plugins.toArray(array));
        }
        brokerService.start();
        brokerService.waitUntilStarted();

        openwireClientUrl = openwireConnector.getPublishableConnectString();
    }

    @After
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void shutdown() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (brokerService != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            brokerService.stop();
            brokerService.waitUntilStopped();
            brokerService = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        }
    }

    @Test(timeout=30000)
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testProduceConsumeWithAuthorization() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        ConnectionFactory factory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ActiveMQConnectionFactory(openwireClientUrl);
        Connection connection1 = factory.createConnection(&lt;span class=&quot;code-quote&quot;&gt;&quot;subscriber&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt;);
        Session session1 = connection1.createSession(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, Session.AUTO_ACKNOWLEDGE);
        Topic wildCarded = session1.createTopic(&lt;span class=&quot;code-quote&quot;&gt;&quot;dcu.&amp;gt;&quot;&lt;/span&gt;);
        MessageConsumer consumer = session1.createConsumer(wildCarded);
        connection1.start();

        Connection connection2 = factory.createConnection(&lt;span class=&quot;code-quote&quot;&gt;&quot;publisher&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;123&quot;&lt;/span&gt;);
        Session session2 = connection2.createSession(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, Session.AUTO_ACKNOWLEDGE);
        Topic named = session2.createTopic(&lt;span class=&quot;code-quote&quot;&gt;&quot;dcu.id&quot;&lt;/span&gt;);
        MessageProducer producer = session2.createProducer(named);
        producer.send(session2.createTextMessage(&lt;span class=&quot;code-quote&quot;&gt;&quot;test&quot;&lt;/span&gt;));

        assertNotNull(consumer.receive(2000));

        connection1.close();
        connection2.close();
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14611945" author="christopher.l.shannon" created="Thu, 2 Jul 2015 13:23:20 +0000"  >&lt;p&gt;Not a problem, I only spent a few minutes on this as it was only a one line fix.  Since you created the OpenWire test I&apos;ll let you go ahead and push up the fix and I&apos;ll close my PR.&lt;/p&gt;</comment>
                            <comment id="14611948" author="githubbot" created="Thu, 2 Jul 2015 13:24:42 +0000"  >&lt;p&gt;Github user cshannon closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/125&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/125&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14612093" author="tabish121" created="Thu, 2 Jul 2015 15:41:19 +0000"  >&lt;p&gt;Fix and test added on master &lt;/p&gt;</comment>
                            <comment id="14612745" author="hongphu8790" created="Fri, 3 Jul 2015 01:45:42 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=christopher.l.shannon&quot; class=&quot;user-hover&quot; rel=&quot;christopher.l.shannon&quot;&gt;christopher.l.shannon&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;It&apos;s working fine now. When is it released or a nightly build version? I&apos;m looking forward to it.&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12710147">AMQ-5160</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12736307" name="activemq-snapshot-5.12-20150529.223833.txt" size="15806" author="hongphu8790" created="Sat, 30 May 2015 02:44:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fczj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10092"><![CDATA[Unit Test Broken]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>