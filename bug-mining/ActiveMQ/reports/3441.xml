<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:54:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-9202] Reentrant locks should always be locked outside of a try block</title>
                <link>https://issues.apache.org/jira/browse/AMQ-9202</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I saw an exception happen today that turned out to be improper use of Reentrant locks. Acquiring the lock should always be done before the try block so that the finally clause to unlock will never execute unless the lock is acquired. More info: &lt;a href=&quot;https://stackoverflow.com/questions/31058681/java-locking-structure-best-pattern&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://stackoverflow.com/questions/31058681/java-locking-structure-best-pattern&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The issue is inside of AbstractRuntimeConfigurationBroker, for example: &lt;a href=&quot;https://github.com/apache/activemq/blob/d8ce1d9ff0fa2296f3c56b59602e5cddb6ffe4a9/activemq-runtime-config/src/main/java/org/apache/activemq/plugin/AbstractRuntimeConfigurationBroker.java#L81&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/blob/d8ce1d9ff0fa2296f3c56b59602e5cddb6ffe4a9/activemq-runtime-config/src/main/java/org/apache/activemq/plugin/AbstractRuntimeConfigurationBroker.java#L81&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I saw a IllegalMonitorStateException exception occur due to&#160;lockInterruptibly() throwing an exception so when the finally block tried to unlock it threw the IllegalMonitorStateException since it was not owned by the thread.&lt;/p&gt;

&lt;p&gt;I went through the rest of the code and most places are correct but a couple spots need to be fixed as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13522540">AMQ-9202</key>
            <summary>Reentrant locks should always be locked outside of a try block</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="cshannon">Christopher L. Shannon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Feb 2023 16:12:59 +0000</created>
                <updated>Wed, 1 Feb 2023 16:34:23 +0000</updated>
                            <resolved>Wed, 1 Feb 2023 16:34:23 +0000</resolved>
                                    <version>5.17.3</version>
                                    <fixVersion>5.18.0</fixVersion>
                    <fixVersion>5.17.4</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17683083" author="jira-bot" created="Wed, 1 Feb 2023 16:32:44 +0000"  >&lt;p&gt;Commit ed924cddac90b96bdc47b215852a68155d818bcd in activemq&apos;s branch refs/heads/main from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=ed924cdda&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=ed924cdda&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9202&quot; title=&quot;Reentrant locks should always be locked outside of a try block&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9202&quot;&gt;&lt;del&gt;AMQ-9202&lt;/del&gt;&lt;/a&gt; - Make sure Reentrant locks are acquired outside a try block&lt;/p&gt;

&lt;p&gt;This is best practice and will prevent unlock from being attempted&lt;br/&gt;
inside of a finally block when the thread doesn&apos;t actually own the&lt;br/&gt;
lock which can happen when the lock attempt throws an exception&lt;br/&gt;
such as calling lockInterruptibly()&lt;/p&gt;</comment>
                            <comment id="17683084" author="jira-bot" created="Wed, 1 Feb 2023 16:32:45 +0000"  >&lt;p&gt;Commit 3f68f49939064477e57a40c02db9a727a3a2f4d1 in activemq&apos;s branch refs/heads/main from Christopher L. Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=3f68f4993&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=3f68f4993&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #959 from cshannon/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9202&quot; title=&quot;Reentrant locks should always be locked outside of a try block&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9202&quot;&gt;&lt;del&gt;AMQ-9202&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9202&quot; title=&quot;Reentrant locks should always be locked outside of a try block&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9202&quot;&gt;&lt;del&gt;AMQ-9202&lt;/del&gt;&lt;/a&gt; - Make sure Reentrant locks are acquired outside a try block&lt;/p&gt;</comment>
                            <comment id="17683086" author="jira-bot" created="Wed, 1 Feb 2023 16:34:08 +0000"  >&lt;p&gt;Commit 6d91d71c1acab166a607425e88a228ba28d06bab in activemq&apos;s branch refs/heads/activemq-5.17.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=6d91d71c1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=6d91d71c1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9202&quot; title=&quot;Reentrant locks should always be locked outside of a try block&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9202&quot;&gt;&lt;del&gt;AMQ-9202&lt;/del&gt;&lt;/a&gt; - Make sure Reentrant locks are acquired outside a try block&lt;/p&gt;

&lt;p&gt;This is best practice and will prevent unlock from being attempted&lt;br/&gt;
inside of a finally block when the thread doesn&apos;t actually own the&lt;br/&gt;
lock which can happen when the lock attempt throws an exception&lt;br/&gt;
such as calling lockInterruptibly()&lt;/p&gt;

&lt;p&gt;(cherry picked from commit ed924cddac90b96bdc47b215852a68155d818bcd)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 40 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1fk80:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>