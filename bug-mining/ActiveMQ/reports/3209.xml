<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:45:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-7086] KahaDB - optionally perform expensive gc run on shutdown</title>
                <link>https://issues.apache.org/jira/browse/AMQ-7086</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;when looking at the speed of broker.stop with kahadb and the scheduler store. There is a full gc run, which can be expensive as the whole index needs to be traversed.&lt;/p&gt;

&lt;p&gt;Fast stop/restart is important for fast failover. Leaving gc for runtime, where it has an effect on latency in the normal way, rather than availability, is better.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I am wondering if there is a use case for gc only at&#160;shutdown if the&#160;cleanupInterval&#160;&amp;lt;= 0, indicating that there were no gc at runtime. The alternative is adding another boolean to the config or adding that back in if the need arises.&lt;/p&gt;

&lt;p&gt;I am leaning towards just removing the gc&#160;call during shutdown.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Note: matching the indexCacheSize to the index file size, trading off with memory, does help to speed up the index (read) traversal.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13194120">AMQ-7086</key>
            <summary>KahaDB - optionally perform expensive gc run on shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 Oct 2018 11:11:48 +0000</created>
                <updated>Wed, 31 Oct 2018 14:35:28 +0000</updated>
                            <resolved>Wed, 31 Oct 2018 14:35:28 +0000</resolved>
                                    <version>5.15.0</version>
                                    <fixVersion>5.16.0</fixVersion>
                                    <component>KahaDB</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16663646" author="gtully" created="Thu, 25 Oct 2018 12:01:55 +0000"  >&lt;p&gt;The checkpoint=0 use case is from:&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-3646&quot; title=&quot;Allow KahaDB to run without disk syncs, higher through put without the jms persistence guarantee&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-3646&quot;&gt;&lt;del&gt;AMQ-3646&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;disabling gc on shutdown will need to be configurable I think.&lt;/p&gt;</comment>
                            <comment id="16663888" author="jgenender" created="Thu, 25 Oct 2018 15:20:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt; my .02 is making it configurable is the way to go.&lt;/p&gt;</comment>
                            <comment id="16670173" author="jira-bot" created="Wed, 31 Oct 2018 14:29:27 +0000"  >&lt;p&gt;Commit bf8eb08acaeec653d04daa0b8b6dd889ef990bed in activemq&apos;s branch refs/heads/master from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=bf8eb08&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=bf8eb08&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7086&quot; title=&quot;KahaDB - optionally perform expensive gc run on shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7086&quot;&gt;&lt;del&gt;AMQ-7086&lt;/del&gt;&lt;/a&gt; - make kahadb gc/cleanup on shutdown optional to trade availability over disk usage for fast failover&lt;/p&gt;</comment>
                            <comment id="16670179" author="gtully" created="Wed, 31 Oct 2018 14:35:28 +0000"  >&lt;p&gt;new kahaDB boolean attribute:&#160;&lt;/p&gt;

&lt;p&gt;cleanupOnStop - default to true as before.&lt;/p&gt;

&lt;p&gt;When disabled, the gc/cleanup iteration on broker stop won&apos;t happen, which will speed up shutdown.&lt;/p&gt;

&lt;p&gt;Use case is with really large db or scheduler db where total index traversal is not cheap.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12536294">AMQ-3646</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 2 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3zmp3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>