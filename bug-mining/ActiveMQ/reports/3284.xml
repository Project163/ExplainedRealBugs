<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:48:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-7142] Inserting Bouncy Castle Provider Early in Java Security Provider Chain Breaks KeyStore Loading</title>
                <link>https://issues.apache.org/jira/browse/AMQ-7142</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;The insertion of the Bouncy Castle Provider in the&#160;org.apache.activemq.broker.BrokerService class is causing issues with our app that expecting one of the default&#160;SunJCE Ciphers to be called, but a Bouncy Castle Cipher is returned instead.&lt;/p&gt;

&lt;p&gt;This causes our Spring Security SAML keystores to not be loaded correctly because the Bouncy Castle Cipher thinks that the keystore was tampered with.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I believe that the source of the problem is this line in the&#160;BrokerService class:&lt;/p&gt;

&lt;p&gt;Security.insertProviderAt(bouncycastle, Integer.getInteger(&quot;org.apache.activemq.broker.BouncyCastlePosition&quot;, 2));&lt;/p&gt;

&lt;p&gt;Looking at the Java 11 source code there are 6 providers installed by the java.security.Security class in the initializeStatic method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void initializeStatic() {
 props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;security.provider.1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;sun.security.provider.Sun&quot;&lt;/span&gt;);
 props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;security.provider.2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;sun.security.rsa.SunRsaSign&quot;&lt;/span&gt;);
 props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;security.provider.3&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;com.sun.net.ssl.internal.ssl.Provider&quot;&lt;/span&gt;);
 props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;security.provider.4&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;com.sun.crypto.provider.SunJCE&quot;&lt;/span&gt;);
 props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;security.provider.5&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;sun.security.jgss.SunProvider&quot;&lt;/span&gt;);
 props.put(&lt;span class=&quot;code-quote&quot;&gt;&quot;security.provider.6&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;com.sun.security.sasl.Provider&quot;&lt;/span&gt;);
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;If possible it would be great if the&#160;org.apache.activemq.broker.BrokerService class would call&#160;&lt;/p&gt;

&lt;p&gt;addProvider instead of insertProviderAt.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for your time.&lt;/p&gt;</description>
                <environment>&lt;p&gt;OpenJDK 11 (AdoptOpenJDK).&lt;/p&gt;

&lt;p&gt;Mac OS&lt;/p&gt;</environment>
        <key id="13212286">AMQ-7142</key>
            <summary>Inserting Bouncy Castle Provider Early in Java Security Provider Chain Breaks KeyStore Loading</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="coheigea">Colm O hEigeartaigh</assignee>
                                    <reporter username="nhook">Nathan Hook</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Jan 2019 18:07:00 +0000</created>
                <updated>Mon, 27 Jan 2020 12:43:04 +0000</updated>
                            <resolved>Mon, 27 Jan 2020 12:43:04 +0000</resolved>
                                    <version>5.15.2</version>
                                    <fixVersion>5.16.0</fixVersion>
                    <fixVersion>5.15.12</fixVersion>
                                    <component>Camel</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16998976" author="victorbucutea" created="Wed, 18 Dec 2019 09:25:59 +0000"  >&lt;p&gt;same issue here. Is there a work-around ?&lt;/p&gt;</comment>
                            <comment id="17020221" author="coheigea" created="Tue, 21 Jan 2020 13:15:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=victorbucutea&quot; class=&quot;user-hover&quot; rel=&quot;victorbucutea&quot;&gt;victorbucutea&lt;/a&gt; - I&apos;ll fix this. A workaround is to already install the BouncyCastleProvider at a different position before the AMQ code is called.&lt;/p&gt;</comment>
                            <comment id="17024319" author="jira-bot" created="Mon, 27 Jan 2020 12:42:17 +0000"  >&lt;p&gt;Commit 127852d2e7098436e99c573bc7b30e3facdb634b in activemq&apos;s branch refs/heads/master from Colm O hEigeartaigh&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=127852d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=127852d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7142&quot; title=&quot;Inserting Bouncy Castle Provider Early in Java Security Provider Chain Breaks KeyStore Loading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7142&quot;&gt;&lt;del&gt;AMQ-7142&lt;/del&gt;&lt;/a&gt; - Inserting Bouncy Castle Provider Early in Java Security Provider Chain Breaks KeyStore Loading&lt;/p&gt;</comment>
                            <comment id="17024320" author="jira-bot" created="Mon, 27 Jan 2020 12:42:19 +0000"  >&lt;p&gt;Commit b589b61f2d5154f9a3b3db6f86fc16b4ca5d829e in activemq&apos;s branch refs/heads/master from Jean-Baptiste Onofr&#233;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=b589b61&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=b589b61&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #431 from coheigea/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7142&quot; title=&quot;Inserting Bouncy Castle Provider Early in Java Security Provider Chain Breaks KeyStore Loading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7142&quot;&gt;&lt;del&gt;AMQ-7142&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7142&quot; title=&quot;Inserting Bouncy Castle Provider Early in Java Security Provider Chain Breaks KeyStore Loading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7142&quot;&gt;&lt;del&gt;AMQ-7142&lt;/del&gt;&lt;/a&gt; - Inserting Bouncy Castle Provider Early in Java Security Pr&#8230;&lt;/p&gt;</comment>
                            <comment id="17024321" author="jira-bot" created="Mon, 27 Jan 2020 12:42:21 +0000"  >&lt;p&gt;Commit b589b61f2d5154f9a3b3db6f86fc16b4ca5d829e in activemq&apos;s branch refs/heads/master from Jean-Baptiste Onofr&#233;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=b589b61&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=b589b61&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #431 from coheigea/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7142&quot; title=&quot;Inserting Bouncy Castle Provider Early in Java Security Provider Chain Breaks KeyStore Loading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7142&quot;&gt;&lt;del&gt;AMQ-7142&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7142&quot; title=&quot;Inserting Bouncy Castle Provider Early in Java Security Provider Chain Breaks KeyStore Loading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7142&quot;&gt;&lt;del&gt;AMQ-7142&lt;/del&gt;&lt;/a&gt; - Inserting Bouncy Castle Provider Early in Java Security Pr&#8230;&lt;/p&gt;</comment>
                            <comment id="17024322" author="jira-bot" created="Mon, 27 Jan 2020 12:42:58 +0000"  >&lt;p&gt;Commit dae85b3dcc7cff5c88e4c301cdf56d3db312058f in activemq&apos;s branch refs/heads/activemq-5.15.x from Colm O hEigeartaigh&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=dae85b3&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=dae85b3&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7142&quot; title=&quot;Inserting Bouncy Castle Provider Early in Java Security Provider Chain Breaks KeyStore Loading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7142&quot;&gt;&lt;del&gt;AMQ-7142&lt;/del&gt;&lt;/a&gt; - Inserting Bouncy Castle Provider Early in Java Security Provider Chain Breaks KeyStore Loading&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 127852d2e7098436e99c573bc7b30e3facdb634b)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 42 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|yi0e60:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>