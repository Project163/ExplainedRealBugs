<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:36:55 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6431] BitArrayBin doesn&apos;t work well with index larger than Integer.MAX_VALUE</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6431</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I have a problem with &quot;messageid deplicate&quot;. Then I found it&apos;s a bug(&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5016&quot; title=&quot;BitArrayBin doesn&amp;#39;t work well with index larger than Integer.MAX_VALUE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5016&quot;&gt;&lt;del&gt;AMQ-5016&lt;/del&gt;&lt;/a&gt;) in activemq5.9.0 , so I download the activemq5.14.0. I run the BitArrayBinTest.java:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
       BitArrayBin toTest = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BitArrayBin(1024);
       &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; largeNum = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE*2L +100L;
       toTest.setBit(largeNum, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
       &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(toTest.getBit(largeNum));   
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt; I expect the results to be &quot;true&quot;,but the result of running the above code is &quot;false&quot;. &lt;br/&gt;
I debug the code,and I  found a method &apos;getBin(long index)&apos; in class BitArrayBin. Code as follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; getBin(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; index) {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; answer = 0;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (longFirstIndex &amp;lt; 0) {
            longFirstIndex = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) (index - (index % BitArray.LONG_SIZE));
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (longFirstIndex &amp;gt;= 0) {
            answer = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)((index - longFirstIndex) / BitArray.LONG_SIZE);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; answer;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt; I think the problem is in  code &#8216;longFirstIndex = (int) (index - (index % BitArray.LONG_SIZE))&#8216;.  When  index is larger than Integer.MAX_VALUE, longFirstIndex will be negative.  I think this line of code should be modified to  &#8216;longFirstIndex = (long) (index - (index % BitArray.LONG_SIZE));&#8217;&lt;/p&gt;



</description>
                <environment></environment>
        <key id="13005478">AMQ-6431</key>
            <summary>BitArrayBin doesn&apos;t work well with index larger than Integer.MAX_VALUE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="wangqinghuan">qinghuan wang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Sep 2016 16:16:24 +0000</created>
                <updated>Fri, 23 Sep 2016 18:33:12 +0000</updated>
                            <resolved>Fri, 23 Sep 2016 18:33:12 +0000</resolved>
                                    <version>5.14.0</version>
                                    <fixVersion>5.14.1</fixVersion>
                    <fixVersion>5.15.0</fixVersion>
                                    <component>JMS client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15496765" author="tabish121" created="Fri, 16 Sep 2016 16:37:35 +0000"  >&lt;p&gt;Suggest you add to or create a unit tests for this class that can demonstrate the issue.&lt;/p&gt;</comment>
                            <comment id="15499051" author="wangqinghuan" created="Sat, 17 Sep 2016 13:44:18 +0000"  >&lt;p&gt;A unit test that expose the issue.&lt;/p&gt;</comment>
                            <comment id="15517196" author="jira-bot" created="Fri, 23 Sep 2016 18:31:18 +0000"  >&lt;p&gt;Commit 09456480b838efd97297679840d33f7949449e21 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=0945648&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=0945648&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6431&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6431&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing BitArrayBin to not overflow in certain cases with numbers larger&lt;br/&gt;
than Int max&lt;/p&gt;</comment>
                            <comment id="15517197" author="jira-bot" created="Fri, 23 Sep 2016 18:31:33 +0000"  >&lt;p&gt;Commit bf7a19eead5ed9fac08f4220a3ec82dc6abdb7e3 in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=bf7a19e&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=bf7a19e&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6431&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6431&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing BitArrayBin to not overflow in certain cases with numbers larger&lt;br/&gt;
than Int max&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 09456480b838efd97297679840d33f7949449e21)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12829058" name="BitArrayBinTest.java" size="477" author="wangqinghuan" created="Sat, 17 Sep 2016 13:44:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33pyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>