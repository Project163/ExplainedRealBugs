<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:54:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-9199] Race condition in creating store directory for new queues</title>
                <link>https://issues.apache.org/jira/browse/AMQ-9199</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;After introducing dynamically created STOMP queues in our production system we&apos;ve observed exceptions thrown from &lt;tt&gt;IOHelper.mkdirs()&lt;/tt&gt; caused by a race condition in creating directories for a new STOMP queue. The exception is thrown during two different actions:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;on processing the STOMP subscription action&lt;/li&gt;
	&lt;li&gt;on sending a persistent JMS message to any already existing queue, when &lt;tt&gt;store.size()&lt;/tt&gt; is performed&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Stack traces:&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;STOMP subscription (from ActiveMQ logs):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2022-12-29 09:09:14,704 | ERROR | java.lang.RuntimeException: Failed to start per destination persistence adapter &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; destination: queue:&lt;span class=&quot;code-comment&quot;&gt;//STOMP.x-queue-userpn4ckpkl, (...)java.io.IOException: Failed to create directory &lt;span class=&quot;code-quote&quot;&gt;&apos;(...)/activemq/data/kahadb/queue#3a#2f#2fSTOMP.x-queue-userpn4ckpkl&apos;&lt;/span&gt;
&lt;/span&gt;&#160; &#160; &#160; &#160; at org.apache.activemq.util.IOHelper.mkdirs(IOHelper.java:331)
&#160; &#160; &#160; &#160; at org.apache.activemq.store.kahadb.MessageDatabase.load(MessageDatabase.java:494)
&#160; &#160; &#160; &#160; at org.apache.activemq.store.kahadb.MessageDatabase.doStart(MessageDatabase.java:309)
&#160; &#160; &#160; &#160; at org.apache.activemq.store.kahadb.KahaDBStore.doStart(KahaDBStore.java:212)
&#160; &#160; &#160; &#160; at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:55)
&#160; &#160; &#160; &#160; at org.apache.activemq.store.kahadb.KahaDBPersistenceAdapter.doStart(KahaDBPersistenceAdapter.java:232)
&#160; &#160; &#160; &#160; at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:55)
&#160; &#160; &#160; &#160; at org.apache.activemq.store.kahadb.MultiKahaDBPersistenceAdapter.startAdapter(MultiKahaDBPersistenceAdapter.java:211)
&#160; &#160; &#160; &#160; at org.apache.activemq.store.kahadb.MultiKahaDBPersistenceAdapter.getMatchingPersistenceAdapter(MultiKahaDBPersistenceAdapter.java:204)
&#160; &#160; &#160; &#160; at org.apache.activemq.store.kahadb.MultiKahaDBPersistenceAdapter.createQueueMessageStore(MultiKahaDBPersistenceAdapter.java:188)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.region.DestinationFactoryImpl.createDestination(DestinationFactoryImpl.java:84)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.region.AbstractRegion.createDestination(AbstractRegion.java:629)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.jmx.ManagedQueueRegion.createDestination(ManagedQueueRegion.java:56)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.region.AbstractRegion.addDestination(AbstractRegion.java:155)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.region.RegionBroker.addDestination(RegionBroker.java:357)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:174)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:174)
&#160; &#160; &#160; &#160; at org.apache.activemq.advisory.AdvisoryBroker.addDestination(AdvisoryBroker.java:244)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:174)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:174)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:174)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:174)
&#160; &#160; &#160; &#160; at org.apache.activemq.security.AuthorizationBroker.addDestination(AuthorizationBroker.java:118)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:174)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:174)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:174)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.region.AbstractRegion.lookup(AbstractRegion.java:561)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.region.AbstractRegion.addConsumer(AbstractRegion.java:346)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.region.RegionBroker.addConsumer(RegionBroker.java:436)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.jmx.ManagedRegionBroker.addConsumer(ManagedRegionBroker.java:243)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:104)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:104)
&#160; &#160; &#160; &#160; at org.apache.activemq.advisory.AdvisoryBroker.addConsumer(AdvisoryBroker.java:131)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:104)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:104)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:104)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:104)
&#160; &#160; &#160; &#160; at org.apache.activemq.security.AuthorizationBroker.addConsumer(AuthorizationBroker.java:183)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:104)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:104)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.BrokerFilter.addConsumer(BrokerFilter.java:104)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.TransportConnection.processAddConsumer(TransportConnection.java:705)
&#160; &#160; &#160; &#160; at org.apache.activemq.command.ConsumerInfo.visit(ConsumerInfo.java:352)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:335)
&#160; &#160; &#160; &#160; at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:200)
&#160; &#160; &#160; &#160; at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:45)
&#160; &#160; &#160; &#160; at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:302)
&#160; &#160; &#160; &#160; at org.apache.activemq.transport.stomp.StompTransportFilter.sendToActiveMQ(StompTransportFilter.java:97)
&#160; &#160; &#160; &#160; at org.apache.activemq.transport.stomp.ProtocolConverter.sendToActiveMQ(ProtocolConverter.java:179)
&#160; &#160; &#160; &#160; at org.apache.activemq.transport.stomp.ProtocolConverter.onStompSubscribe(ProtocolConverter.java:679)
&#160; &#160; &#160; &#160; at org.apache.activemq.transport.stomp.ProtocolConverter.onStompCommand(ProtocolConverter.java:249)
&#160; &#160; &#160; &#160; at org.apache.activemq.transport.stomp.StompTransportFilter.onCommand(StompTransportFilter.java:85)
&#160; &#160; &#160; &#160; at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)
&#160; &#160; &#160; &#160; at org.apache.activemq.transport.tcp.SslTransport.doConsume(SslTransport.java:172)
&#160; &#160; &#160; &#160; at org.apache.activemq.transport.stomp.StompSslTransportFactory$1$1.doConsume(StompSslTransportFactory.java:73)
&#160; &#160; &#160; &#160; at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:233)
&#160; &#160; &#160; &#160; at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:215)
&#160; &#160; &#160; &#160; at java.base/java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:829)
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;JMS message send (from JBOSS running application):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2023-01-12T09:57:47,360Z WARN &#160;[org.jboss.jca.core.connectionmanager.listener.TxConnectionListener] (...): javax.jms.JMSException: java.io.IOException: Failed to create directory &lt;span class=&quot;code-quote&quot;&gt;&apos;(...)/activemq/kahadb/queue#3a#2f#2fSTOMP.x-queue-useref42egyx&apos;&lt;/span&gt;
&#160; &#160; at org.apache.activemq.util.JMSExceptionSupport.create(JMSExceptionSupport.java:56)
&#160; &#160; at org.apache.activemq.ActiveMQConnection.onAsyncException(ActiveMQConnection.java:1973)
&#160; &#160; at org.apache.activemq.ActiveMQConnection$3$1.run(ActiveMQConnection.java:1882)
&#160; &#160; at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)
&#160; &#160; at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)
&#160; &#160; at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:750)
Caused by: java.lang.RuntimeException: java.io.IOException: Failed to create directory &lt;span class=&quot;code-quote&quot;&gt;&apos;(...)/activemq/kahadb/queue#3a#2f#2fSTOMP.x-queue-useref42egyx&apos;&lt;/span&gt;
&#160; &#160; at org.apache.activemq.store.kahadb.KahaDBStore.size(KahaDBStore.java:1379)
&#160; &#160; at org.apache.activemq.store.kahadb.KahaDBPersistenceAdapter.size(KahaDBPersistenceAdapter.java:223)
&#160; &#160; at org.apache.activemq.store.kahadb.MultiKahaDBPersistenceAdapter.size(MultiKahaDBPersistenceAdapter.java:366)
&#160; &#160; at org.apache.activemq.usage.StoreUsage.retrieveUsage(StoreUsage.java:53)
&#160; &#160; at org.apache.activemq.usage.Usage.caclPercentUsage(Usage.java:283)
&#160; &#160; at org.apache.activemq.usage.Usage.isFull(Usage.java:126)
&#160; &#160; at org.apache.activemq.broker.region.Queue.checkUsage(Queue.java:939)
&#160; &#160; at org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:875)
&#160; &#160; at org.apache.activemq.broker.region.Queue.send(Queue.java:756)
&#160; &#160; at org.apache.activemq.broker.region.DestinationFilter.send(DestinationFilter.java:138)
&#160; &#160; at org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:511)
&#160; &#160; at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:477)
&#160; &#160; at org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:293)
&#160; &#160; at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:154)
&#160; &#160; at org.apache.activemq.broker.scheduler.SchedulerBroker.send(SchedulerBroker.java:320)
&#160; &#160; at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:154)
&#160; &#160; at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)
&#160; &#160; at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:295)
&#160; &#160; at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:154)
&#160; &#160; at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:154)
&#160; &#160; at org.apache.activemq.security.AuthorizationBroker.send(AuthorizationBroker.java:226)
&#160; &#160; at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:154)
&#160; &#160; at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:154)
&#160; &#160; at org.apache.activemq.plugin.StatisticsBroker.send(StatisticsBroker.java:229)
&#160; &#160; at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:154)
&#160; &#160; at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:580)
&#160; &#160; at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:769)
&#160; &#160; at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:335)
&#160; &#160; at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:200)
&#160; &#160; at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)
&#160; &#160; at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:125)
&#160; &#160; at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:301)
&#160; &#160; at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)
&#160; &#160; at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:233)
&#160; &#160; at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:215)
&#160; &#160; ... 1 more
Caused by: java.io.IOException: Failed to create directory &lt;span class=&quot;code-quote&quot;&gt;&apos;(...)/activemq/kahadb/queue#3a#2f#2fSTOMP.x-queue-useref42egyx&apos;&lt;/span&gt;
&#160; &#160; at org.apache.activemq.util.IOHelper.mkdirs(IOHelper.java:331)
&#160; &#160; at org.apache.activemq.store.kahadb.MessageDatabase.createPageFile(MessageDatabase.java:3381)
&#160; &#160; at org.apache.activemq.store.kahadb.MessageDatabase.getPageFile(MessageDatabase.java:3556)
&#160; &#160; at org.apache.activemq.store.kahadb.KahaDBStore.size(KahaDBStore.java:1377)
&#160; &#160; ... 35 more &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Background&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;We had KahaDB configured with &lt;tt&gt;preallocationStrategy=os_kernel_copy&lt;/tt&gt; and size set to 32MB which probably slowed things down. After disabling preallocation for STOMP queues, we no longer observe the issue, but it&apos;s just a matter of decreased probability.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;There&apos;s a pull request with a test case reproducing the issue and a fix proposal: &lt;a href=&quot;https://github.com/apache/activemq/pull/957&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/957&lt;/a&gt;&#160;&lt;/p&gt;</description>
                <environment>&lt;ul&gt;
	&lt;li&gt;ActiveMQ 5.17.3&lt;/li&gt;
	&lt;li&gt;JBoss EAP 7.4&lt;/li&gt;
	&lt;li&gt;Amazon Linux 2&lt;/li&gt;
&lt;/ul&gt;
</environment>
        <key id="13519886">AMQ-9199</key>
            <summary>Race condition in creating store directory for new queues</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbonofre">Jean-Baptiste Onofr&#233;</assignee>
                                    <reporter username="mjanczykowski">Michal Janczykowski</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Jan 2023 11:09:19 +0000</created>
                <updated>Thu, 2 Feb 2023 13:45:21 +0000</updated>
                            <resolved>Thu, 2 Feb 2023 13:45:21 +0000</resolved>
                                    <version>5.16.5</version>
                    <version>5.17.3</version>
                                    <fixVersion>5.18.0</fixVersion>
                    <fixVersion>5.17.4</fixVersion>
                                    <component>KahaDB</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="17683419" author="jira-bot" created="Thu, 2 Feb 2023 13:43:47 +0000"  >&lt;p&gt;Commit 7de7ba2aa92dd1a98f48175fac5a538bd6e8579b in activemq&apos;s branch refs/heads/main from Micha&#322; Janczykowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=7de7ba2aa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=7de7ba2aa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9199&quot; title=&quot;Race condition in creating store directory for new queues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9199&quot;&gt;&lt;del&gt;AMQ-9199&lt;/del&gt;&lt;/a&gt; Fixed race condition in creating store directory&lt;/p&gt;

&lt;p&gt;A store directory is created by MessageDatabase#getPageFile which&lt;br/&gt;
is called in two cases:&lt;br/&gt;
1. KahaDBStore.start() when creating a queue&lt;br/&gt;
2. KahaDBStore.size() which is performed when sending any persistent message&lt;/p&gt;

&lt;p&gt;If both methods are called concurrently it&apos;s possible to get an IOException&lt;br/&gt;
thrown from the IOHelper.mkdirs method.&lt;/p&gt;</comment>
                            <comment id="17683420" author="jira-bot" created="Thu, 2 Feb 2023 13:43:47 +0000"  >&lt;p&gt;Commit 13ec5d5b7ace619e84ff2982da9e80091bb64e66 in activemq&apos;s branch refs/heads/main from Micha&#322; Janczykowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=13ec5d5b7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=13ec5d5b7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9199&quot; title=&quot;Race condition in creating store directory for new queues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9199&quot;&gt;&lt;del&gt;AMQ-9199&lt;/del&gt;&lt;/a&gt; reordered imports&lt;/p&gt;</comment>
                            <comment id="17683421" author="jira-bot" created="Thu, 2 Feb 2023 13:43:48 +0000"  >&lt;p&gt;Commit c86cd20029b5e00bc9bb6c8a9710fc1e3a5f81c7 in activemq&apos;s branch refs/heads/main from JB Onofr&#233;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=c86cd2002&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=c86cd2002&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #957 from mjanczykowski/bugfix/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9199&quot; title=&quot;Race condition in creating store directory for new queues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9199&quot;&gt;&lt;del&gt;AMQ-9199&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9199&quot; title=&quot;Race condition in creating store directory for new queues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9199&quot;&gt;&lt;del&gt;AMQ-9199&lt;/del&gt;&lt;/a&gt; Fixed race condition in creating store directory&lt;/p&gt;</comment>
                            <comment id="17683422" author="jira-bot" created="Thu, 2 Feb 2023 13:45:11 +0000"  >&lt;p&gt;Commit c5ecf53bdca0f9b163c514eefc01eff15b4b5d81 in activemq&apos;s branch refs/heads/activemq-5.17.x from Micha&#322; Janczykowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=c5ecf53bd&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=c5ecf53bd&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9199&quot; title=&quot;Race condition in creating store directory for new queues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9199&quot;&gt;&lt;del&gt;AMQ-9199&lt;/del&gt;&lt;/a&gt; Fixed race condition in creating store directory&lt;/p&gt;

&lt;p&gt;A store directory is created by MessageDatabase#getPageFile which&lt;br/&gt;
is called in two cases:&lt;br/&gt;
1. KahaDBStore.start() when creating a queue&lt;br/&gt;
2. KahaDBStore.size() which is performed when sending any persistent message&lt;/p&gt;

&lt;p&gt;If both methods are called concurrently it&apos;s possible to get an IOException&lt;br/&gt;
thrown from the IOHelper.mkdirs method.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 7de7ba2aa92dd1a98f48175fac5a538bd6e8579b)&lt;/p&gt;</comment>
                            <comment id="17683423" author="jira-bot" created="Thu, 2 Feb 2023 13:45:11 +0000"  >&lt;p&gt;Commit b1f5d6beb3d265bf9a9c1db6e43260fdf314457e in activemq&apos;s branch refs/heads/activemq-5.17.x from Micha&#322; Janczykowski&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=b1f5d6beb&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=b1f5d6beb&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9199&quot; title=&quot;Race condition in creating store directory for new queues&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9199&quot;&gt;&lt;del&gt;AMQ-9199&lt;/del&gt;&lt;/a&gt; reordered imports&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 13ec5d5b7ace619e84ff2982da9e80091bb64e66)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 40 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1f3zs:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>