<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:33:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1235] Scheduler.cancel uses incorrect argument to shutdown threads</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1235</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;looking at the code from 4.1.1 in org.apache.activemq.thread.Scheduler, in the cancel method:&lt;/p&gt;

&lt;p&gt;the Runnable task argument is passed to clockDaemon.remove(). i think this is incorrect. ScheduledFuture ticket should be passed to clockDaemon.remove().&lt;/p&gt;

&lt;p&gt;the javadocs of ScheduledThreadPoolExecutor.remove discuss the possibility that Runnables might be stored in some other form internally, so calling remove with a plain Runnable might not do anything. I think the solution is to call remove with a ScheduledFuture, which is how they are stored internally in ScheduledThreadPoolExecutor.&lt;/p&gt;


&lt;p&gt;i came across this bug after upgrading to the java 5 version of backport-util-concurrent 3.0. that version makes more assumptions about the types that are passed into ScheduledThreadPoolExecutor.remove, so when you pass in a regular Runnable you&apos;ll get a ClassCastException.&lt;/p&gt;


&lt;p&gt;this is trivial to fix, so i don&apos;t think a patch is necessary. also i think this might address the memory leak mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-1205&quot; title=&quot;Memory leak in Scheduler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-1205&quot;&gt;&lt;del&gt;AMQ-1205&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12481887">AMQ-1235</key>
            <summary>Scheduler.cancel uses incorrect argument to shutdown threads</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                            <parent id="12482234">AMQ-1205</parent>
                                    <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chirino">Hiram R. Chirino</assignee>
                                    <reporter username="aburgel">Alex Burgel</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Apr 2007 13:03:25 +0000</created>
                <updated>Tue, 1 May 2007 12:51:47 +0000</updated>
                            <resolved>Mon, 30 Apr 2007 13:17:57 +0000</resolved>
                                    <version>4.1.1</version>
                                    <fixVersion>4.1.2</fixVersion>
                    <fixVersion>5.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12938940" author="aburgel" created="Tue, 24 Apr 2007 21:11:03 +0000"  >&lt;p&gt;a quick clarification....&lt;/p&gt;

&lt;p&gt;you can&apos;t call ScheduledThreadPoolExecutor.remove with a ScheduledFuture, because it expects a Runnable.&lt;/p&gt;

&lt;p&gt;two alternatives are&lt;/p&gt;

&lt;p&gt;1) don&apos;t call ScheduledThreadPoolExecutor.remove at all... which is equivalent to the current behavior, tho this wil leave the executor with lots of cancelled tasks (see &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-1205&quot; title=&quot;Memory leak in Scheduler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-1205&quot;&gt;&lt;del&gt;AMQ-1205&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;2) cast ticket to RunnableScheduledFuture, and call remove on that. this will work because in this case ticket is a RunnableScheduledFuture, tho its probably worthwhile adding an instanceof check just to be sure.&lt;/p&gt;</comment>
                            <comment id="12938920" author="aburgel" created="Tue, 24 Apr 2007 21:42:10 +0000"  >&lt;p&gt;here&apos;s a patch.&lt;/p&gt;</comment>
                            <comment id="12936653" author="chirino" created="Mon, 30 Apr 2007 13:17:57 +0000"  >&lt;p&gt;Good patch!  Thanks for figuring this out.  Applied.&lt;/p&gt;</comment>
                            <comment id="12936658" author="jstrachan" created="Tue, 1 May 2007 12:51:46 +0000"  >&lt;p&gt;I made an amendment to the patch to check for instanceof Runnable rather than RunnableScheduledFuture which is a Java 6 specific class&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12460999" name="scheduler.patch" size="994" author="aburgel" created="Tue, 24 Apr 2007 21:42:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84581</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s09j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161519</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>