<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:56:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1719] Resource adapter stops consuming messages after broker is forcefully stopped/restarted during XA transaction.</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1719</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Have attached logs from websphere, activeMQ and also the content of the datadirectory for details of data state ( plus the smal program used to create the scenario).&lt;/p&gt;

&lt;p&gt;#1. Installed the resource adapter that came with ActiveMQ into the websperhe applicationserver and configured it to connect to external broker using failover.&lt;br/&gt;
#2. Setup a JDBC XA datasource ( Oracle ) and JMS XA destination ( ActiveMQ ).&lt;br/&gt;
#3. Created a small Message Driven bean that receives a JMS message that it tries to store in the database after which it sleeps for 5 secs. And deployed it to the WebSphere appserver.&lt;br/&gt;
#4. Started the activemq broker without doing any modifications since the download and extract into the filesystem.&lt;br/&gt;
#5. Started applicationserver. &lt;br/&gt;
#6. Started publishing messages to the broker&lt;br/&gt;
#7. As expected the Message driven bean received the messages one-by-one and processed them.&lt;br/&gt;
#8. Used to ctrl-C on the broker to halt it in the middle of the processing. Resulting in a failed commit of XA transaction.&lt;br/&gt;
#9. Waited a while and then started broker again.&lt;br/&gt;
#10. Received Exception on client side and nothing more happened. &lt;/p&gt;

&lt;p&gt;Exception in thread &quot;ActiveMQ Transport: tcp://localhost/127.0.0.1:61616&quot; java.lang.NullPointerException&lt;br/&gt;
    at org.apache.activemq.state.ConnectionStateTracker$RemoveTransactionAction.run(ConnectionStateTracker.java:84)&lt;br/&gt;
    at org.apache.activemq.state.Tracked.onResponses(Tracked.java:31)&lt;br/&gt;
    at org.apache.activemq.transport.failover.FailoverTransport$3.onCommand(FailoverTransport.java:148)&lt;br/&gt;
    at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:143)&lt;br/&gt;
    at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:206)&lt;br/&gt;
    at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)&lt;br/&gt;
    at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:196)&lt;br/&gt;
    at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:183)&lt;br/&gt;
    at java.lang.Thread.run(Thread.java:801)&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows XP, IBM WebSphere 6.1.0.15, Oracle 10.2.0.3, Java 1.5.0 ( IBM J9 VM), ActiveMQ 5.1.0 downloaded 2008-May-12.&lt;/p&gt;</environment>
        <key id="12483350">AMQ-1719</key>
            <summary>Resource adapter stops consuming messages after broker is forcefully stopped/restarted during XA transaction.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="johan.eke">Johan Ekesparr</reporter>
                        <labels>
                    </labels>
                <created>Mon, 12 May 2008 12:47:29 +0000</created>
                <updated>Sun, 7 Oct 2012 10:52:40 +0000</updated>
                            <resolved>Sun, 7 Oct 2012 10:52:40 +0000</resolved>
                                    <version>5.1.0</version>
                                    <fixVersion>5.8.0</fixVersion>
                                    <component>Broker</component>
                    <component>Connector</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12939642" author="johan.eke" created="Mon, 12 May 2008 12:49:55 +0000"  >&lt;p&gt;Ooops! Should be WebSphere 6.1.0.11&lt;/p&gt;</comment>
                            <comment id="12939884" author="jerryshea" created="Wed, 25 Jun 2008 00:19:48 +0000"  >&lt;p&gt;We are getting a similar exception thrown occasionally during our stress tests. Exception happens on start up of some of our consumers. I am working on some reproduction code now but stack trace looks like this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 
Exception in thread &quot;ActiveMQ Transport: tcp://localhost/127.0.0.1:62616&quot; java.lang.NullPointerException
        at org.apache.activemq.state.ConnectionStateTracker$RemoveTransactionAction.run(ConnectionStateTracker.java:84)
        at org.apache.activemq.state.Tracked.onResponses(Tracked.java:31)
        at org.apache.activemq.transport.failover.FailoverTransport$3.onCommand(FailoverTransport.java:148)
        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:143)
        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:206)
        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)
        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:196)
        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:183)
        at java.lang.Thread.run(Unknown Source)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
&lt;p&gt;We are using AMQ5.1, Jencks 2.1 on Windows XP SP2, Sun JDK1.6.03&lt;/p&gt;</comment>
                            <comment id="12939894" author="hansb" created="Tue, 1 Jul 2008 21:20:19 +0000"  >&lt;p&gt;The NullPointerException occurs at the last line of the &apos;run()&apos; method of RemoveTransactionAction:&lt;/p&gt;

&lt;p&gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;ConnectionStateTracker.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;RemoveTransactionAction &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TransactionInfo info;   

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; RemoveTransactionAction(TransactionInfo info) {
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.info = info;
        }

        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run() {
            ConnectionId connectionId = info.getConnectionId();
            ConnectionState cs = connectionStates.get(connectionId);
            cs.removeTransactionState(info.getTransactionId());
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Apparently there is no ConnectionState for &quot;connectionId&quot; (anymore).&lt;/p&gt;

&lt;p&gt;&quot;removeTransactionState&quot; removes the TransactionState identified by &quot;transactionId&quot; from a local Map, but since ConnectionState does not exist anymore, this is bogus.&lt;/p&gt;

&lt;p&gt;The NullPointerException itself is not a problem, but can be avoided by putting an &lt;/p&gt;

&lt;p&gt;   &quot;if (cs != null) &lt;/p&gt;
{...}
&lt;p&gt;&quot;&lt;/p&gt;

&lt;p&gt;around the last statement.&lt;/p&gt;

&lt;p&gt;The problem probably existed already.&lt;/p&gt;
</comment>
                            <comment id="13471195" author="davsclaus" created="Sun, 7 Oct 2012 10:52:40 +0000"  >&lt;p&gt;I looked in the latest code, and added a fix for the potential NPE.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461047" name="ASF.LICENSE.NOT.GRANTED--DemoEAR.ear" size="5094" author="johan.eke" created="Mon, 12 May 2008 12:47:29 +0000"/>
                            <attachment id="12461004" name="ASF.LICENSE.NOT.GRANTED--apache-activemq-5.1.0_data.tar.zip" size="70226" author="johan.eke" created="Mon, 12 May 2008 12:47:29 +0000"/>
                            <attachment id="12461103" name="ASF.LICENSE.NOT.GRANTED--websphere_trace.log" size="100031" author="johan.eke" created="Mon, 12 May 2008 12:47:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84791</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 7 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05wyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32437</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>