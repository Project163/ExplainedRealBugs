<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:59:03 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-9376] Fix concurrent modification in ActiveMQServiceFactory</title>
                <link>https://issues.apache.org/jira/browse/AMQ-9376</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Need a class instance level lock or duplicate list around the broker map when doing a .destroy() caused by bundle refesh&lt;/p&gt;

&lt;p&gt;Calling .destroy() loops over a map which calls deleted.. which fails when there is more than one bundle and the bundle is shutdown first (not a service(s) removed via .cfg delete or osgi service shutdown lifecycle).&lt;/p&gt;

&lt;p&gt;#1. OSGi calls.. &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    synchronized public void destroy() {
        for (String broker : brokers.keySet()) {
            deleted(broker);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;#2. Which blows up here.. due to concurrent modification on the &lt;em&gt;brokers&lt;/em&gt; collection&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    @Override
    synchronized public void deleted(String pid) {
        ServiceRegistration&amp;lt;BrokerService&amp;gt; reg = brokerRegs.remove(pid);
        if (reg != null) {
            reg.unregister();
        }
        BrokerService broker = brokers.remove(pid);
        if (broker != null) {
            stop(pid, broker);
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13556476">AMQ-9376</key>
            <summary>Fix concurrent modification in ActiveMQServiceFactory</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mattrpav">Matt Pavlovich</assignee>
                                    <reporter username="mattrpav">Matt Pavlovich</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Nov 2023 04:47:21 +0000</created>
                <updated>Thu, 9 Nov 2023 13:06:19 +0000</updated>
                            <resolved>Thu, 9 Nov 2023 13:06:19 +0000</resolved>
                                                    <fixVersion>6.0.0</fixVersion>
                    <fixVersion>5.18.4</fixVersion>
                    <fixVersion>5.17.7</fixVersion>
                                    <component>OSGi/Karaf</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="17784443" author="jira-bot" created="Thu, 9 Nov 2023 13:04:36 +0000"  >&lt;p&gt;Commit 19696254dddf169fa62d502a53fa0351bad3d080 in activemq&apos;s branch refs/heads/main from Matt Pavlovich&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=19696254d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=19696254d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9376&quot; title=&quot;Fix concurrent modification in ActiveMQServiceFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9376&quot;&gt;&lt;del&gt;AMQ-9376&lt;/del&gt;&lt;/a&gt; Fix ConcurrentModificationException during a destroy()&lt;/p&gt;</comment>
                            <comment id="17784444" author="jira-bot" created="Thu, 9 Nov 2023 13:04:37 +0000"  >&lt;p&gt;Commit ca35e5921cf6da481ad2e2fb91be2a839f4f00ec in activemq&apos;s branch refs/heads/main from JB Onofr&#233;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=ca35e5921&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=ca35e5921&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #1108 from hyteio/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9376&quot; title=&quot;Fix concurrent modification in ActiveMQServiceFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9376&quot;&gt;&lt;del&gt;AMQ-9376&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9376&quot; title=&quot;Fix concurrent modification in ActiveMQServiceFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9376&quot;&gt;&lt;del&gt;AMQ-9376&lt;/del&gt;&lt;/a&gt; Fix ConcurrentModificationException during a destroy()&lt;/p&gt;</comment>
                            <comment id="17784445" author="jira-bot" created="Thu, 9 Nov 2023 13:05:27 +0000"  >&lt;p&gt;Commit f9e28b916a5e8b3ad78672d538c08a2cb1f9304a in activemq&apos;s branch refs/heads/activemq-5.18.x from Matt Pavlovich&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=f9e28b916&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=f9e28b916&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9376&quot; title=&quot;Fix concurrent modification in ActiveMQServiceFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9376&quot;&gt;&lt;del&gt;AMQ-9376&lt;/del&gt;&lt;/a&gt; Fix ConcurrentModificationException during a destroy()&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 19696254dddf169fa62d502a53fa0351bad3d080)&lt;/p&gt;</comment>
                            <comment id="17784446" author="jira-bot" created="Thu, 9 Nov 2023 13:05:50 +0000"  >&lt;p&gt;Commit 46667fbce107b3bbbe37865ebfaf8fd75576776d in activemq&apos;s branch refs/heads/activemq-5.17.x from Matt Pavlovich&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=46667fbce&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=46667fbce&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-9376&quot; title=&quot;Fix concurrent modification in ActiveMQServiceFactory&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-9376&quot;&gt;&lt;del&gt;AMQ-9376&lt;/del&gt;&lt;/a&gt; Fix ConcurrentModificationException during a destroy()&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 19696254dddf169fa62d502a53fa0351bad3d080)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1lcoo:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>