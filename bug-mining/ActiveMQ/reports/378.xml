<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:37:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1712] Recovery of TransactionBroker fails because of missing Subscriptions</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1712</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I am testing recovery of ActiveMQ by having a client continuously putting messages to a queue and then stopping the broker (Ctrl-C) and restarting it. During startup I get the following stack trace on ActiveMQ trunk version:&lt;/p&gt;

&lt;p&gt;ERROR: java.lang.Exception: org.springframework.beans.factory.BeanCreationException: Error creating bean with name &apos;org.apache.act&lt;br/&gt;
ivemq.xbean.XBeanBrokerService#0&apos; defined in class path resource &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq.xml&amp;#93;&lt;/span&gt;: Invocation of init method failed; nested exceptio&lt;br/&gt;
n is java.io.IOException: Recovery Failed: The subscription does not exist: ID:FE-Z2965-2798-1210158536046-1:0:-1:2&lt;br/&gt;
java.lang.Exception: org.springframework.beans.factory.BeanCreationException: Error creating bean with name &apos;org.apache.activemq.x&lt;br/&gt;
bean.XBeanBrokerService#0&apos; defined in class path resource &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq.xml&amp;#93;&lt;/span&gt;: Invocation of init method failed; nested exception is ja&lt;br/&gt;
va.io.IOException: Recovery Failed: The subscription does not exist: ID:FE-Z2965-2798-1210158536046-1:0:-1:2&lt;br/&gt;
        at org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:99)&lt;br/&gt;
        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)&lt;br/&gt;
        at org.apache.activemq.console.command.ShellCommand.runTask(ShellCommand.java:129)&lt;br/&gt;
        at org.apache.activemq.console.command.AbstractCommand.execute(AbstractCommand.java:57)&lt;br/&gt;
        at org.apache.activemq.console.command.ShellCommand.main(ShellCommand.java:79)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.apache.activemq.console.Main.runTaskClass(Main.java:222)&lt;br/&gt;
        at org.apache.activemq.console.Main.main(Main.java:106)&lt;br/&gt;
Caused by: org.springframework.beans.factory.BeanCreationException: Error creating bean with name &apos;org.apache.activemq.xbean.XBean&lt;br/&gt;
BrokerService#0&apos; defined in class path resource &lt;span class=&quot;error&quot;&gt;&amp;#91;activemq.xml&amp;#93;&lt;/span&gt;: Invocation of init method failed; nested exception is java.io.IOEx&lt;br/&gt;
ception: Recovery Failed: The subscription does not exist: ID:FE-Z2965-2798-1210158536046-1:0:-1:2&lt;br/&gt;
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBean&lt;br/&gt;
Factory.java:1260)&lt;br/&gt;
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.doCreateBean(AbstractAutowireCapableBeanFa&lt;br/&gt;
ctory.java:438)&lt;br/&gt;
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory$1.run(AbstractAutowireCapableBeanFactory.j&lt;br/&gt;
ava:383)&lt;br/&gt;
        at java.security.AccessController.doPrivileged(Native Method)&lt;br/&gt;
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.createBean(AbstractAutowireCapableBeanFact&lt;br/&gt;
ory.java:353)&lt;br/&gt;
        at org.springframework.beans.factory.support.AbstractBeanFactory$1.getObject(AbstractBeanFactory.java:245)&lt;br/&gt;
        at org.springframework.beans.factory.support.DefaultSingletonBeanRegistry.getSingleton(DefaultSingletonBeanRegistry.java:1&lt;br/&gt;
69)&lt;br/&gt;
        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:242)&lt;br/&gt;
        at org.springframework.beans.factory.support.AbstractBeanFactory.getBean(AbstractBeanFactory.java:164)&lt;br/&gt;
        at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactor&lt;br/&gt;
y.java:400)&lt;br/&gt;
        at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationConte&lt;br/&gt;
xt.java:736)&lt;br/&gt;
        at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:369)&lt;br/&gt;
        at org.apache.xbean.spring.context.ResourceXmlApplicationContext.&amp;lt;init&amp;gt;(ResourceXmlApplicationContext.java:64)&lt;br/&gt;
        at org.apache.xbean.spring.context.ResourceXmlApplicationContext.&amp;lt;init&amp;gt;(ResourceXmlApplicationContext.java:52)&lt;br/&gt;
        at org.apache.activemq.xbean.XBeanBrokerFactory.createApplicationContext(XBeanBrokerFactory.java:96)&lt;br/&gt;
        at org.apache.activemq.xbean.XBeanBrokerFactory.createBroker(XBeanBrokerFactory.java:52)&lt;br/&gt;
        at org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:71)&lt;br/&gt;
        at org.apache.activemq.broker.BrokerFactory.createBroker(BrokerFactory.java:54)&lt;br/&gt;
        at org.apache.activemq.console.command.StartCommand.startBroker(StartCommand.java:111)&lt;br/&gt;
        at org.apache.activemq.console.command.StartCommand.runTask(StartCommand.java:73)&lt;br/&gt;
        ... 10 more&lt;br/&gt;
Caused by: java.io.IOException: Recovery Failed: The subscription does not exist: ID:FE-Z2965-2798-1210158536046-1:0:-1:2&lt;br/&gt;
        at org.apache.activemq.util.IOExceptionSupport.create(IOExceptionSupport.java:27)&lt;br/&gt;
        at org.apache.activemq.broker.TransactionBroker.start(TransactionBroker.java:110)&lt;br/&gt;
        at org.apache.activemq.broker.BrokerFilter.start(BrokerFilter.java:153)&lt;br/&gt;
        at org.apache.activemq.broker.BrokerFilter.start(BrokerFilter.java:153)&lt;br/&gt;
        at org.apache.activemq.broker.MutableBrokerFilter.start(MutableBrokerFilter.java:160)&lt;br/&gt;
        at org.apache.activemq.broker.BrokerService.start(BrokerService.java:444)&lt;br/&gt;
        at org.apache.activemq.xbean.XBeanBrokerService.afterPropertiesSet(XBeanBrokerService.java:50)&lt;br/&gt;
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.invokeInitMethods(AbstractAutowireCapableB&lt;br/&gt;
eanFactory.java:1288)&lt;br/&gt;
        at org.springframework.beans.factory.support.AbstractAutowireCapableBeanFactory.initializeBean(AbstractAutowireCapableBean&lt;br/&gt;
Factory.java:1257)&lt;br/&gt;
        ... 29 more&lt;br/&gt;
Caused by: java.lang.IllegalArgumentException: The subscription does not exist: ID:FE-Z2965-2798-1210158536046-1:0:-1:2&lt;br/&gt;
        at org.apache.activemq.broker.region.AbstractRegion.acknowledge(AbstractRegion.java:357)&lt;br/&gt;
        at org.apache.activemq.broker.region.RegionBroker.acknowledge(RegionBroker.java:470)&lt;br/&gt;
        at org.apache.activemq.broker.TransactionBroker.acknowledge(TransactionBroker.java:194)&lt;br/&gt;
        at org.apache.activemq.broker.TransactionBroker$1.recover(TransactionBroker.java:100)&lt;br/&gt;
        at org.apache.activemq.store.amq.AMQTransactionStore.recover(AMQTransactionStore.java:196)&lt;br/&gt;
        at org.apache.activemq.broker.TransactionBroker.start(TransactionBroker.java:92)&lt;br/&gt;
        ... 36 more&lt;/p&gt;


&lt;p&gt;I am wondering whether the &lt;em&gt;AbstractRegion.acknowledge()&lt;/em&gt; method shouldn&apos;t consider the &lt;em&gt;ConsumerBrokerExchange.getConnectionContext().getInRecoveryMode()&lt;/em&gt; flag and then NOT throw an &lt;em&gt;IllegalArgumentException&lt;/em&gt; if no matching Subscription is available (while recovering during startup of the TransactionBroker there won&apos;t be any Subscriptions available anyway, right?) ...&lt;/p&gt;

&lt;p&gt;Any thoughts?&lt;/p&gt;

&lt;p&gt;Kai&lt;/p&gt;</description>
                <environment></environment>
        <key id="12482497">AMQ-1712</key>
            <summary>Recovery of TransactionBroker fails because of missing Subscriptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="hudalla">Kai Hudalla</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 May 2008 11:55:49 +0000</created>
                <updated>Fri, 6 Jun 2008 15:21:44 +0000</updated>
                            <resolved>Fri, 6 Jun 2008 15:21:44 +0000</resolved>
                                    <version>4.1.2</version>
                    <version>5.0.0</version>
                                    <fixVersion>5.2.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                                                            <comments>
                            <comment id="12939755" author="hudalla" created="Fri, 30 May 2008 06:47:50 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I have created a patch for this issue targeted at TRUNK. The patch adds a check for the &lt;em&gt;ConnectionContext.getRecoveryMode()&lt;/em&gt; flag as indicated in my original posting.&lt;br/&gt;
Could someone who is more into the recovery code please cross check whether this makes any sense?&lt;/p&gt;

&lt;p&gt;Kai&lt;/p&gt;</comment>
                            <comment id="12939735" author="hudalla" created="Fri, 30 May 2008 06:48:59 +0000"  >&lt;p&gt;Proposed fix, to be applied to org/apache/activemq/broker/region/AbstractRegion.java&lt;/p&gt;</comment>
                            <comment id="12939692" author="rajdavies" created="Fri, 6 Jun 2008 15:21:44 +0000"  >&lt;p&gt;Fixed by SVN revision 663980&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461117" name="amq-1712.diff" size="1164" author="hudalla" created="Fri, 30 May 2008 06:48:59 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12483010">AMQ-1711</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84588</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s1y7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161792</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>