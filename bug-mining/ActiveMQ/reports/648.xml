<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:42:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1282] Bad conversion of nonexistent data in MapMessage</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1282</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Consider simple reception code like this:&lt;/p&gt;

&lt;p&gt;        MapMessage message = (MapMessage) consumer.receive(1000);&lt;br/&gt;
        int x = message.getInt(&quot;foo&quot;));&lt;/p&gt;

&lt;p&gt;I notice that x is now set to zero even though there was no &quot;foo&quot; value in the map. I would have expected an exception.&lt;/p&gt;

&lt;p&gt;According to Gaurav Hariani &amp;lt;gaurav@blackspark.com&amp;gt; 	&lt;/p&gt;

&lt;p&gt;also from the spec api: &lt;a href=&quot;http://java.sun.com/j2ee/1.4/docs/api/javax/jms/MapMessage.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://java.sun.com/j2ee/1.4/docs/api/javax/jms/MapMessage.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Attempting to read a null value as a primitive type must be treated as calling the primitive&apos;s corresponding valueOf(String) conversion method with a null value. Since char does not support a String conversion, attempting to read a null value as a char must throw a NullPointerException.&lt;/p&gt;

&lt;p&gt;.. so you are right that it is a bug ... since Integer.valueOf(null) throws an Exception&lt;/p&gt;</description>
                <environment></environment>
        <key id="12482987">AMQ-1282</key>
            <summary>Bad conversion of nonexistent data in MapMessage</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="eharold">Elliotte Rusty Harold</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Jun 2007 19:20:41 +0000</created>
                <updated>Tue, 7 Jul 2009 05:34:28 +0000</updated>
                            <resolved>Tue, 7 Jul 2009 05:34:28 +0000</resolved>
                                    <version>4.1.1</version>
                                    <fixVersion>5.3.0</fixVersion>
                                    <component>JMS client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12936183" author="eharold" created="Fri, 15 Jun 2007 13:56:46 +0000"  >&lt;p&gt;In fact this fails for all types except char and boolean as the following unit tests demonstrate:&lt;/p&gt;


&lt;p&gt;import javax.jms.Connection;&lt;br/&gt;
import javax.jms.ConnectionFactory;&lt;br/&gt;
import javax.jms.JMSException;&lt;br/&gt;
import javax.jms.MapMessage;&lt;br/&gt;
import javax.jms.Session;&lt;/p&gt;

&lt;p&gt;import org.apache.activemq.ActiveMQConnectionFactory;&lt;/p&gt;

&lt;p&gt;import junit.framework.TestCase;&lt;/p&gt;

&lt;p&gt;public class MapMessageTest extends TestCase {&lt;/p&gt;

&lt;p&gt;    private ConnectionFactory factory;&lt;br/&gt;
    private Connection connection;   &lt;br/&gt;
    private MapMessage message;&lt;/p&gt;

&lt;p&gt;    protected void setUp() throws Exception &lt;/p&gt;
{
        factory = new ActiveMQConnectionFactory(&quot;vm://localhost?broker.persistent=false&quot;);
        connection = factory.createConnection();
        connection.start();             
        Session session = connection.createSession(false, Session.AUTO_ACKNOWLEDGE);
        message = session.createMapMessage();
        super.setUp();
    }

&lt;p&gt;    protected void tearDown() throws Exception &lt;/p&gt;
{
        connection.close();
        super.tearDown();
    }
&lt;p&gt;    &lt;/p&gt;


&lt;p&gt;    public void testUnmappedBooleanMessage() throws JMSException {&lt;/p&gt;

&lt;p&gt;        Object expected;&lt;br/&gt;
        try &lt;/p&gt;
{
            expected = Boolean.valueOf(null);
        }
&lt;p&gt;        catch (Exception ex) &lt;/p&gt;
{
            expected = ex;
        }&lt;br/&gt;
&lt;br/&gt;
        try {
            Boolean actual = message.getBoolean(&quot;foo&quot;);
            assertEquals(expected, actual);
        }&lt;br/&gt;
        catch (Exception ex) {
            assertEquals(expected, ex);
        }&lt;br/&gt;
        &lt;br/&gt;
    }&lt;br/&gt;
    &lt;br/&gt;
    public void testUnmappedIntegerMessage() throws JMSException {&lt;br/&gt;
        &lt;br/&gt;
        Object expected;&lt;br/&gt;
        try {
            expected = Integer.valueOf(null);
        }&lt;br/&gt;
        catch (Exception ex) {            expected = ex;        }

&lt;p&gt;        try &lt;/p&gt;
{
            Integer actual = message.getInt(&quot;foo&quot;);
            assertEquals(expected, actual);
        }
&lt;p&gt;        catch (Exception ex) &lt;/p&gt;
{
            assertEquals(expected, ex);
        }&lt;br/&gt;
        &lt;br/&gt;
    }&lt;br/&gt;
    &lt;br/&gt;
    &lt;br/&gt;
    public void testUnmappedShortMessage() throws JMSException {&lt;br/&gt;
        &lt;br/&gt;
        Object expected;&lt;br/&gt;
        try {
            expected = Short.valueOf(null);
        }&lt;br/&gt;
        catch (Exception ex) {
            expected = ex;
        }&lt;br/&gt;
&lt;br/&gt;
        try {
            Short actual = message.getShort(&quot;foo&quot;);
            assertEquals(expected, actual);
        }&lt;br/&gt;
        catch (Exception ex) {            assertEquals(expected, ex);        }

&lt;p&gt;    }&lt;/p&gt;


&lt;p&gt;    public void testUnmappedLongMessage() throws JMSException {&lt;/p&gt;

&lt;p&gt;        Object expected;&lt;br/&gt;
        try &lt;/p&gt;
{
            expected = Long.valueOf(null);
        }
&lt;p&gt;        catch (Exception ex) &lt;/p&gt;
{
            expected = ex;
        }&lt;br/&gt;
&lt;br/&gt;
        try {
            Long actual = message.getLong(&quot;foo&quot;);
            assertEquals(expected, actual);
        }&lt;br/&gt;
        catch (Exception ex) {
            assertEquals(expected, ex);
        }&lt;br/&gt;
        &lt;br/&gt;
    }&lt;br/&gt;
    &lt;br/&gt;
    &lt;br/&gt;
    public void testUnmappedStringMessage() throws JMSException {&lt;br/&gt;
        Object expected;&lt;br/&gt;
        try {
            expected = String.valueOf(null);
        }&lt;br/&gt;
        catch (Exception ex) {            expected = ex;        }

&lt;p&gt;        try &lt;/p&gt;
{
            String actual = message.getString(&quot;foo&quot;);
            assertEquals(expected, actual);
        }
&lt;p&gt;        catch (Exception ex) &lt;/p&gt;
{
            assertEquals(expected, ex);
        }&lt;br/&gt;
    }&lt;br/&gt;
   &lt;br/&gt;
&lt;br/&gt;
    public void testUnmappedCharMessage() throws JMSException {&lt;br/&gt;
        try {
            message.getChar(&quot;foo&quot;);
            fail(&quot;should have thrown NullPointerException&quot;);
        }&lt;br/&gt;
        catch (NullPointerException success) {
            assertNotNull(success);
        }&lt;br/&gt;
    } &lt;br/&gt;
    &lt;br/&gt;
    public void testUnmappedByteMessage() throws JMSException {&lt;br/&gt;
        Object expected;&lt;br/&gt;
        try {
            expected = Byte.valueOf(null);
        }&lt;br/&gt;
        catch (Exception ex) {
            expected = ex;
        }&lt;br/&gt;
&lt;br/&gt;
        try {
            Byte actual = message.getByte(&quot;foo&quot;);
            assertEquals(expected, actual);
        }&lt;br/&gt;
        catch (Exception ex) {            assertEquals(expected, ex);        }


&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;    public void testUnmappedDoubleMessage() throws JMSException {&lt;/p&gt;

&lt;p&gt;        Object expected;&lt;br/&gt;
        try &lt;/p&gt;
{
            expected = Double.valueOf(null);
        }
&lt;p&gt;        catch (Exception ex) &lt;/p&gt;
{
            expected = ex;
        }&lt;br/&gt;
&lt;br/&gt;
        try {
            Double actual = message.getDouble(&quot;foo&quot;);
            assertEquals(expected, actual);
        }&lt;br/&gt;
        catch (Exception ex) {
            assertEquals(expected, ex);
        }&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
    }&lt;br/&gt;
    &lt;br/&gt;
    public void testUnmappedFloatMessage() throws JMSException {&lt;br/&gt;
        &lt;br/&gt;
        Object expected;&lt;br/&gt;
        try {
            expected = Float.valueOf(null);
        }&lt;br/&gt;
        catch (Exception ex) {            expected = ex;        }

&lt;p&gt;        try &lt;/p&gt;
{
            Float actual = message.getFloat(&quot;foo&quot;);
            assertEquals(expected, actual);
        }
&lt;p&gt;        catch (Exception ex) &lt;/p&gt;
{
            assertEquals(expected, ex);
        }

&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;}&lt;/p&gt;</comment>
                            <comment id="12936192" author="eharold" created="Fri, 15 Jun 2007 13:58:30 +0000"  >&lt;p&gt;JUnit test case demonstrating bugs in MapMessage class with conversion of unmapped values&lt;/p&gt;</comment>
                            <comment id="12940127" author="memelet" created="Tue, 2 Sep 2008 16:35:02 +0000"  >&lt;p&gt;#getBytes also appears to be incorrect in two ways. &lt;/p&gt;

&lt;p&gt;First, from  &lt;a href=&quot;http://java.sun.com/j2ee/1.4/docs/api/javax/jms/MapMessage.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;MapMessage.html&lt;/a&gt; this method should return null if the entry does not exist. From the code, it appears as if MessageFormatException is thrown instead.&lt;/p&gt;

&lt;p&gt;Second, if an attempt is made to MessageFormatException for a null value, an NPE will be generated due to the &quot;value.getClass().getName()&quot;.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] getBytes(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; JMSException {
        initializeReading();
        &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; value = map.get(name);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[])value;
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MessageFormatException(&lt;span class=&quot;code-quote&quot;&gt;&quot; cannot read a &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] from &quot;&lt;/span&gt; + value.getClass().getName());
        }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12941691" author="rajdavies" created="Tue, 7 Jul 2009 05:34:28 +0000"  >&lt;p&gt;Fixed by SVN revision 791708&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12460882" name="MapMessageTest.java" size="5041" author="eharold" created="Fri, 15 Jun 2007 13:58:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84572</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14c7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233441</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>