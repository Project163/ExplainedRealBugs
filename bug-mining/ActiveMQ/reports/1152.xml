<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:49:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3124] Failover transport client gets corrupted connectedBrokers data </title>
                <link>https://issues.apache.org/jira/browse/AMQ-3124</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When clients use the Failover transport, the broker will deliver a list of its own uri and also brokers it peers with to the client.  This happens on initial connection and, if configured, as brokers come in and out of the cluster.&lt;/p&gt;

&lt;p&gt;The problem is that the entire URI is given, including query string information.  If the query string contains commas in it then the Failover client breaks it up into unusable client uris and will attempt to connect to them.  Also, in 5.4.2, this leads to the same failure that occurs in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-3085&quot; title=&quot;IndexOutOfBoundsException on FailoverTransport.updateURIs after: already known: java.net.UnknownHostException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-3085&quot;&gt;&lt;del&gt;AMQ-3085&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Also, there doesn&apos;t seem to be a point in the client trying to use the same query string parameters that the server is using.&lt;/p&gt;

&lt;p&gt;Attached patch strips the query string before sending uris to the client.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt;Broker1:&lt;/p&gt;

&lt;p&gt;        &amp;lt;transportConnectors&amp;gt;&lt;br/&gt;
            &amp;lt;transportConnector name=&quot;openwire+ssl&quot; uri=&quot;ssl://0.0.0.0:61616?needClientAuth=true&amp;amp;enabledCipherSuites=SSL_RSA_WITH_RC4_128_SHA,SSL_RSA_WITH_3DES_EDE_CBC_SHA,SSL_DHE_DSS_WITH_3DES_EDE_CBC_SHA,SSL_DHE_RSA_WITH_3DES_EDE_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_DSS_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_128_CBC_SHA,TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_DHE_DSS_WITH_AES_256_CBC_SHA,TLS_RSA_WITH_AES_256_CBC_SHA&quot; /&amp;gt;&lt;br/&gt;
        &amp;lt;/transportConnectors&amp;gt;&lt;/p&gt;


&lt;p&gt;With a client connecting to:  failover:(ssl://broker1:61616), you will see (extra debugging added by me):&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Failover add: u&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; is: ssl://broker1:61616&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Reconnect was triggered but transport is not started yet. Wait for start to connect the transport.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Started.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Waking up reconnect task&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - urlList connectionList:&lt;span class=&quot;error&quot;&gt;&amp;#91;ssl://broker1:61616&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Attempting connect to: ssl://broker1:61616&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Failover add: u&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt; is: TLS_RSA_WITH_AES_256_CBC_SHA&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Failover add: u&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; is: TLS_DHE_DSS_WITH_AES_256_CBC_SHA&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Failover add: u&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt; is: TLS_RSA_WITH_AES_128_CBC_SHA&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Failover add: u&lt;span class=&quot;error&quot;&gt;&amp;#91;3&amp;#93;&lt;/span&gt; is: TLS_DHE_RSA_WITH_AES_128_CBC_SHA&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Failover add: u&lt;span class=&quot;error&quot;&gt;&amp;#91;4&amp;#93;&lt;/span&gt; is: ssl://broker1:61616?needClientAuth=true&amp;amp;enabledCipherSuites=SSL_RSA_WITH_RC4_128_SHA&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Failover add: u&lt;span class=&quot;error&quot;&gt;&amp;#91;5&amp;#93;&lt;/span&gt; is: TLS_DHE_DSS_WITH_AES_128_CBC_SHA&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;WARN&amp;#93;&lt;/span&gt; FailoverTransport - Transport (broker1/10.73.76.102:61616) failed to ssl://broker1:61616 , attempting to automatically reconnect due to: java.io.IOException: Unexpected error occured&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Transport failed with the following exception: &amp;lt;java.io.IOException: Unexpected error occured&amp;gt;java.io.IOException: Unexpected error occured&lt;br/&gt;
	at org.apache.activemq.transport.failover.FailoverTransport.add(FailoverTransport.java:614)&lt;br/&gt;
	at org.apache.activemq.transport.failover.FailoverTransport.updateURIs(FailoverTransport.java:1049)&lt;br/&gt;
	at org.apache.activemq.transport.failover.FailoverTransport.processNewTransports(FailoverTransport.java:285)&lt;br/&gt;
	at org.apache.activemq.transport.failover.FailoverTransport.handleConnectionControl(FailoverTransport.java:265)&lt;br/&gt;
	at org.apache.activemq.transport.failover.FailoverTransport$3.onCommand(FailoverTransport.java:177)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - urlList connectionList:&lt;span class=&quot;error&quot;&gt;&amp;#91;TLS_RSA_WITH_AES_256_CBC_SHA, ssl://broker1:61616&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Attempting connect to: TLS_RSA_WITH_AES_256_CBC_SHA&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Connect fail to: TLS_RSA_WITH_AES_256_CBC_SHA, reason: java.io.IOException: Transport not scheme specified: &lt;span class=&quot;error&quot;&gt;&amp;#91;TLS_RSA_WITH_AES_256_CBC_SHA&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Attempting connect to: ssl://broker1:61616&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; FailoverTransport - Connection established&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; FailoverTransport - Successfully reconnected to ssl://broker1:61616&lt;/p&gt;

&lt;p&gt;Note that the stacktrace occurs for the same reason as &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-3085&quot; title=&quot;IndexOutOfBoundsException on FailoverTransport.updateURIs after: already known: java.net.UnknownHostException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-3085&quot;&gt;&lt;del&gt;AMQ-3085&lt;/del&gt;&lt;/a&gt;, but all the extra work attempting to connect to invalid uris is wasteful.  Also, the client has no need for the query string parameters of the server uris.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12495009">AMQ-3124</key>
            <summary>Failover transport client gets corrupted connectedBrokers data </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="asussman">Adam Sussman</reporter>
                        <labels>
                    </labels>
                <created>Sat, 8 Jan 2011 01:59:23 +0000</created>
                <updated>Tue, 1 Feb 2011 12:44:54 +0000</updated>
                            <resolved>Tue, 11 Jan 2011 10:30:58 +0000</resolved>
                                    <version>5.4.2</version>
                                    <fixVersion>5.5.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12979064" author="asussman" created="Sat, 8 Jan 2011 02:01:10 +0000"  >&lt;p&gt;Proposed patch.  Strips query string from uris.&lt;/p&gt;</comment>
                            <comment id="12980045" author="gtully" created="Tue, 11 Jan 2011 10:30:58 +0000"  >&lt;p&gt;fix applied in r1057565&lt;br/&gt;
reused TransportConnetor.getPublishableConnectString() for the propagated uri in cluster update&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12483854">AMQ-2632</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12467784" name="amq-3124.patch" size="1186" author="asussman" created="Sat, 8 Jan 2011 02:01:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14704</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ak2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59524</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>