<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:00:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4591] CronParser bug on getNextScheduledTime to handle the once per minute case &quot;* * * * *&quot;</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4591</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;There is a Bug on handle the once per minute case.&lt;br/&gt;
For the cronentry: &quot;* * * * *&quot; &lt;br/&gt;
The Next Scheduled time is not the top of the next minute.&lt;br/&gt;
Instead, is the current Time plus 60 seconds&lt;/p&gt;

&lt;p&gt;The problem is that the code is trying to set the precision at seconds, but the precision must have to be at minutes. &lt;/p&gt;

&lt;p&gt;You can check the patch attached to see the change required to fix this issue.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Any&lt;/p&gt;</environment>
        <key id="12653876">AMQ-4591</key>
            <summary>CronParser bug on getNextScheduledTime to handle the once per minute case &quot;* * * * *&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="ralfaro">Rafael Alfaro</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Thu, 20 Jun 2013 07:08:23 +0000</created>
                <updated>Mon, 8 Jul 2013 14:22:04 +0000</updated>
                            <resolved>Mon, 8 Jul 2013 14:22:04 +0000</resolved>
                                    <version>5.8.0</version>
                    <version>5.9.0</version>
                                    <fixVersion>5.9.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="13688960" author="ralfaro" created="Thu, 20 Jun 2013 07:09:59 +0000"  >&lt;p&gt;Patch to handle the cronEntry &quot;* * * * *&quot;&lt;/p&gt;</comment>
                            <comment id="13700658" author="tabish121" created="Fri, 5 Jul 2013 13:28:05 +0000"  >&lt;p&gt;Can you link to appropriate documentation that states that the intended behavior of the &quot;* * * * *&quot; entry is current time + 60 seconds instead of the top of every minute. &lt;/p&gt;</comment>
                            <comment id="13701630" author="ralfaro" created="Sun, 7 Jul 2013 18:55:15 +0000"  >&lt;p&gt;No, what I tried to mean, is that the current behaviour with the current code on SVN is that the next schedule time is the current time + 60 seconds for the pattern &quot;* * * * *&quot;.&lt;br/&gt;
But the correct behaviour, must have to be, to calculate the top of the next minute.&lt;/p&gt;

&lt;p&gt;If you look at the code:&lt;br/&gt;
&lt;a href=&quot;https://svn.apache.org/repos/asf/activemq/trunk/activemq-client/src/main/java/org/apache/activemq/broker/scheduler/CronParser.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/activemq/trunk/activemq-client/src/main/java/org/apache/activemq/broker/scheduler/CronParser.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The issue is at the line 47:&lt;/p&gt;

&lt;p&gt;            result = result / 1000 * 1000;&lt;/p&gt;

&lt;p&gt;the previous formula, sets the precision to &quot;seconds&quot;, so, if the current time is 00:01:40, de next scheduled time will be 00:02:40&lt;br/&gt;
That is not correct, because the next scheduled time must have to be the top of the next minute.&lt;br/&gt;
So, to calculate the top of the next minute, the previous formula must have to be:&lt;/p&gt;

&lt;p&gt;            result = result / 60000 * 60000;&lt;/p&gt;



&lt;p&gt;That is the why I proposed to following patch:&lt;/p&gt;


&lt;p&gt;Index: activemq-client/src/main/java/org/apache/activemq/broker/scheduler/CronParser.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; activemq-client/src/main/java/org/apache/activemq/broker/scheduler/CronParser.java	(revision 1494862)&lt;br/&gt;
+++ activemq-client/src/main/java/org/apache/activemq/broker/scheduler/CronParser.java	(working copy)&lt;br/&gt;
@@ -44,7 +44,7 @@&lt;br/&gt;
         // starting the next event at the top of the minute.&lt;br/&gt;
         if (cronEntry.equals(&quot;* * * * *&quot;)) &lt;/p&gt;
{
             result = currentTime + 60 * 1000;
-            result = result / 1000 * 1000;
+            result = result / 60000 * 60000;
             return result;
         }
</comment>
                            <comment id="13702020" author="tabish121" created="Mon, 8 Jul 2013 14:22:04 +0000"  >&lt;p&gt;Fixed on trunk, thanks for the patch. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12588773" name="CronParser.java.patch" size="670" author="ralfaro" created="Thu, 20 Jun 2013 07:09:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334153</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 20 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ln53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334479</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>