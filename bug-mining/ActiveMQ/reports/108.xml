<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:31:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-776] ConduitBridge can malfunction when first of a set of consumers goes away</title>
                <link>https://issues.apache.org/jira/browse/AMQ-776</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When the following scenario is followed, any of the subsequent consumers will stop receiving messages.  I&apos;ve reproduced this using the ConsumerTool, and ProducerTool supplied in the example area of the distribution.&lt;/p&gt;

&lt;p&gt;+++++++++++++++++++++++&lt;br/&gt;
Start Broker A&lt;/p&gt;

&lt;p&gt;Start Broker B&lt;/p&gt;

&lt;p&gt;Start Consumer 1, connecting to Broker B, consuming FOO&lt;/p&gt;

&lt;p&gt;Start Consumer 2, connecting to Broker B, consuming FOO&lt;/p&gt;

&lt;p&gt;Start Publisher, connecting to Broker A, publishing FOO&lt;/p&gt;

&lt;p&gt;Ctl-C out of Consumer 1&lt;/p&gt;

&lt;p&gt;Consumer 2 stops receiving messages&lt;br/&gt;
+++++++++++++++++++&lt;/p&gt;

&lt;p&gt;Seems to me that ConduitBridge is supposed to track all consumers for a given subscription, by way of DemandSubscription.  It is seeding DemandSubscription with the originating consumer, but when subsequent consumers are added, the ConduitBridge::addToAlreadyInterestedConsumers re-adds the original subscriber to the DemandSubscription&apos;s map - so the map only ever has the original subscription.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached a patch.  Hope the change is good.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12481697">AMQ-776</key>
            <summary>ConduitBridge can malfunction when first of a set of consumers goes away</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="yaussy">Kevin Yaussy</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Jun 2006 20:56:16 +0000</created>
                <updated>Sat, 30 Dec 2006 07:30:58 +0000</updated>
                            <resolved>Sat, 30 Dec 2006 07:30:58 +0000</resolved>
                                    <version>4.0.1</version>
                                    <fixVersion>5.0.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12938268" author="yaussy" created="Sat, 8 Jul 2006 02:43:01 +0000"  >&lt;p&gt;I found another scenario, but have not had time to discover whether it is due to problem in ConduitBridge or not.  But, it seems likely:&lt;/p&gt;

&lt;p&gt;+++++++++++++++++++++++++++&lt;br/&gt;
Start Broker A&lt;/p&gt;

&lt;p&gt;Start Publisher, connecting to Broker A, publishing FOO&lt;/p&gt;

&lt;p&gt;Start Broker B&lt;/p&gt;

&lt;p&gt;Start Consumer, connecting to Broker B, consuming FOO (needs to use failover on connect url, but just connect to Broker B)&lt;/p&gt;

&lt;p&gt;kill-9 Broker B&lt;/p&gt;

&lt;p&gt;Restart Broker B&lt;/p&gt;

&lt;p&gt;Consumer no longer gets FOO&lt;br/&gt;
+++++++++++++++++++++++++++++++++&lt;/p&gt;

&lt;p&gt;This problem happens regardless of whether the patched ConduitBridge code is used. &lt;/p&gt;</comment>
                            <comment id="12936308" author="yaussy" created="Wed, 19 Jul 2006 18:30:47 +0000"  >&lt;p&gt;Any reason why &quot;clearDownSubscriptions&quot; in DemandForwardingBridgeSupport is uncoded?  Or perhaps overridden in ConduitBridge?&lt;/p&gt;

&lt;p&gt;I&apos;ve coded an override method in ConduitBridge and this seems to take care of the issue.&lt;/p&gt;

&lt;p&gt;Maybe you coded it once, but some test cases failed?&lt;/p&gt;</comment>
                            <comment id="12938273" author="rajdavies" created="Thu, 10 Aug 2006 09:20:40 +0000"  >&lt;p&gt;Hi Kevin,&lt;/p&gt;

&lt;p&gt;not sure I understood the last comment ? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; - clearDownSubscriptions in DemandForwardingBridgeSupport clears the subscription maps - do you do something different ?&lt;/p&gt;</comment>
                            <comment id="12938393" author="yaussy" created="Mon, 14 Aug 2006 13:45:13 +0000"  >&lt;p&gt;Rob,&lt;/p&gt;

&lt;p&gt;The code for clearDownSubscriptions in DemandForwardingBridgeSupport.java is not present (empty method) in 4.0.1.  Perhaps you are looking at 4.0.2 or 4.1?  I haven&apos;t downloaded those versions yet.&lt;/p&gt;</comment>
                            <comment id="12938330" author="yaussy" created="Mon, 14 Aug 2006 20:31:43 +0000"  >&lt;p&gt;I&apos;ll attach a patch file for DemandForwardingBridgeSupport.java which is baselined on the 4.0.1 version.  It includes the logging changes from my other call, which you&apos;ve already applied to 4.0.2.&lt;/p&gt;

&lt;p&gt;When I was analyzing the problem, it looked to me like there was more to the problem than just clearing out the subscription maps (which is what the 4.0.2 code does).  It needed to forward the subscription removal to the broker, which is why my patch calls removeSubscription, which forwards the removal to the broker code, but also removes the entry from the local subscription map.  It did not make any difference whether I cleared the remote subscription map, so that step is not in the patch (but could be for cleanliness).&lt;/p&gt;

&lt;p&gt;I&apos;ve downloaded the current 4.0.2 snapshot, and applied this change (replacing the 4.0.2 version of clearDownSubscriptions).  However, the problem still persists in 4.0.2.  So, given other changes in 4.0.2, the change is not compatible - which is bad.&lt;/p&gt;

&lt;p&gt;The first patch for this call, ConduitBridge.patch, is applicable to 4.0.2.&lt;/p&gt;</comment>
                            <comment id="12938399" author="chirino" created="Mon, 2 Oct 2006 16:48:56 +0000"  >&lt;p&gt;This issue looks like it&apos;s still not resolved.&lt;/p&gt;</comment>
                            <comment id="12938581" author="yaussy" created="Tue, 3 Oct 2006 12:36:12 +0000"  >&lt;p&gt;Hiram,&lt;/p&gt;

&lt;p&gt;I have been very busy with some other items around here, so I&apos;ve not worked on this for about a month.  I&apos;m planning on downloading the recent 4.0.2 and looking there again.  But, also, it looks like 4.1 is pretty active?  I&apos;ll download that and test this scenario there as well.&lt;/p&gt;</comment>
                            <comment id="12938425" author="yaussy" created="Mon, 9 Oct 2006 14:24:58 +0000"  >&lt;p&gt;Hiram,&lt;/p&gt;

&lt;p&gt;With help from Holger Bruch on &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-961&quot; title=&quot;Problem with subscription passing with network of brokers in AMQ 4.0.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-961&quot;&gt;&lt;del&gt;AMQ-961&lt;/del&gt;&lt;/a&gt;, this issue I think can be resolved.  For AMQ 4.0.2, apply the ConduitBridge patch, which fixes the first part of this issue.  Apply Holger&apos;s patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-961&quot; title=&quot;Problem with subscription passing with network of brokers in AMQ 4.0.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-961&quot;&gt;&lt;del&gt;AMQ-961&lt;/del&gt;&lt;/a&gt; to DemandForwardingBridgeSupport.  That fixes the issue from &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-961&quot; title=&quot;Problem with subscription passing with network of brokers in AMQ 4.0.2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-961&quot;&gt;&lt;del&gt;AMQ-961&lt;/del&gt;&lt;/a&gt;, but also the second part of this issue.&lt;/p&gt;</comment>
                            <comment id="12936491" author="rajdavies" created="Sat, 30 Dec 2006 07:30:57 +0000"  >&lt;p&gt;patch applied for associated issue: &lt;a href=&quot;http://issues.apache.org/activemq/browse/AMQ-961&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://issues.apache.org/activemq/browse/AMQ-961&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12460578" name="ASF.LICENSE.NOT.GRANTED--ConduitBridge.patch" size="637" author="yaussy" created="Mon, 26 Jun 2006 20:56:16 +0000"/>
                            <attachment id="12460686" name="DemandForwardingBridgeSupport.patch" size="1860" author="yaussy" created="Mon, 14 Aug 2006 20:32:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84407</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 48 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s01b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161482</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>