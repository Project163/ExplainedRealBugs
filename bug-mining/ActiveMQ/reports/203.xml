<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:33:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1152] ActiveMQ connectionFactory ignores redeliveryPolicy</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1152</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Run mvn -Dtest=JmsTest test in the attached sample application.&lt;br/&gt;
Redelivery is ignored and failed messages will not stop redelivering.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12482151">AMQ-1152</key>
            <summary>ActiveMQ connectionFactory ignores redeliveryPolicy</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="gchen77">Tim Chen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Feb 2007 19:11:37 +0000</created>
                <updated>Fri, 15 Nov 2013 18:49:24 +0000</updated>
                            <resolved>Fri, 11 Sep 2009 18:21:26 +0000</resolved>
                                    <version>4.1.0</version>
                                    <fixVersion>5.3.0</fixVersion>
                                        <due></due>
                            <votes>7</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="12938969" author="gchen77" created="Mon, 12 Mar 2007 23:22:42 +0000"  >&lt;p&gt;Can someone at least respond to this?&lt;br/&gt;
This seems like a very key feature of ActiveMQ that is missing.&lt;/p&gt;</comment>
                            <comment id="12938839" author="jstrachan" created="Tue, 13 Mar 2007 17:24:37 +0000"  >&lt;p&gt;I wonder; could you test that the XML configuration really is configuring the connection factories RedeliveryPolicy? i.e. is ths some kinda bug in the XML configuration stuff or is there really an issue with the redelivery.&lt;/p&gt;</comment>
                            <comment id="12938924" author="gchen77" created="Wed, 14 Mar 2007 22:06:59 +0000"  >&lt;p&gt;If you mean if this is due to using xbean then no it isn&apos;t.&lt;br/&gt;
I have the same configuration using standard spring configurations on a live project that doesn&apos;t use xbean configuration and it is the same.&lt;/p&gt;</comment>
                            <comment id="12939043" author="jstrachan" created="Wed, 23 May 2007 10:20:43 +0000"  >&lt;p&gt;Incidentally I&apos;ve created a test case (method testUseURIToConfigureRedeliveryPolicy()) in &lt;a href=&quot;http://svn.apache.org/repos/asf/activemq/trunk/activemq-core/src/test/java/org/apache/activemq/ActiveMQConnectionFactoryTest.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;ActiveMQConnectionFactoryTest&lt;/a&gt; which configures the redelivery policy via URI and shows its passed through into the consumer. Am unsure how to reproduce this issue&lt;/p&gt;</comment>
                            <comment id="12938979" author="gnt" created="Wed, 23 May 2007 16:30:36 +0000"  >&lt;p&gt;The problem with spring jms support for consuming messages is that it each time a message is consumed, a new jms consumer is created.  And the redelivery policy is handled on the consumer side, not on the broker side.  Hence, the broker redispatch the message immediately.&lt;/p&gt;

&lt;p&gt;Here is a diff to fix a small bug on 4.1.1 found while debugging this issue, but as explained above, the problem lies elsewhere.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Index: src/main/java/org/apache/activemq/ActiveMQMessageConsumer.java
===================================================================
--- src/main/java/org/apache/activemq/ActiveMQMessageConsumer.java      (revision 540956)
+++ src/main/java/org/apache/activemq/ActiveMQMessageConsumer.java      (working copy)
@@ -598,7 +598,9 @@
             &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((session.isTransacted() || session.isDupsOkAcknowledge())) {
                 acknowledge();
             }
-            deliveredMessages.clear();
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!session.isTransacted()) {
+                deliveredMessages.clear();
+            }
             unconsumedMessages.close();
             &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.session.removeConsumer(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
         }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12936418" author="jstrachan" created="Tue, 12 Jun 2007 14:45:32 +0000"  >&lt;p&gt;does setting the caching level in the spring message listener stuff help?&lt;/p&gt;</comment>
                            <comment id="12937184" author="phammer" created="Tue, 21 Aug 2007 10:41:39 +0000"  >&lt;p&gt;I had a similar problem (Spring+ActiveMQ, redelivery kept going if an exception was thrown in my listener). Setting &amp;lt;property name=&quot;cacheLevelName&quot; value=&quot;CACHE_CONSUMER&quot; /&amp;gt;  on my DefaultMessageListenerContainer fixed the problem, and my consumer now only receives the message once - with no redelivery if the consumer throws an exception.&lt;/p&gt;

&lt;p&gt;This is a workable solution for my circumstance, but I won&apos;t pretend to know enough about the JMS spec to say if it&apos;s the Correct Behaviour or not.&lt;/p&gt;</comment>
                            <comment id="12939179" author="yvonnedaher" created="Wed, 31 Oct 2007 19:06:10 +0000"  >&lt;p&gt;I have the same problem:&lt;br/&gt;
I set a redeliverypolicy with a max redelivery of 1 (I want to disable redeliveries) but I keep on receiving the messages... For information : in my message listener, message.getJMSRedelivered() returns true.&lt;/p&gt;

&lt;p&gt;I cannot set the cacheLevel to CACHE_CONSUMER in my application and I find it really weird to have the redelivery count per consumer.&lt;/p&gt;

&lt;p&gt;Did anyone find a solution to that ?&lt;/p&gt;</comment>
                            <comment id="12941597" author="rajdavies" created="Fri, 11 Sep 2009 18:21:26 +0000"  >&lt;p&gt;This looks fixed to me in 5.3 ?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12679430">AMQ-4891</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12460636" name="ASF.LICENSE.NOT.GRANTED--jms.tar.bz2" size="3546" author="gchen77" created="Tue, 6 Feb 2007 19:11:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84479</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s1jb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161725</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>