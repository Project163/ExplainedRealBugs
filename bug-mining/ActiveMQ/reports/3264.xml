<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:45:51 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-7312] virtualSelectorCacheBrokerPlugin fails on &quot;browse&quot; action</title>
                <link>https://issues.apache.org/jira/browse/AMQ-7312</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;We have a VirtualTopic &quot;VirtualTopic.multi_dest&quot; and 2 consumers :&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Consumer.alpha.VirtualTopic.multi_dest&lt;/li&gt;
	&lt;li&gt;Consumer.beta.VirtualTopic.multi_dest&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Message producer send messages on that vTopic with various &quot;tenant&quot; header value.&lt;/p&gt;

&lt;p&gt;Each consumer use a selector to receive only desired data :&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;tenant=&apos;alpha&apos; for Consumer.alpha.VirtualTopic.multi_dest&lt;/li&gt;
	&lt;li&gt;tenant=&apos;beta&apos; for Consumer.beta.VirtualTopic.multi_dest&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;To avoid to get many pending message on each consumer queue, we activated selectorAware=&quot;true&quot; in broker settings.&lt;/p&gt;

&lt;p&gt;To avoid to lose message on temporary consumer deconnection, we activated virtualSelectorCacheBrokerPlugin plugin.&lt;/p&gt;

&lt;p&gt;Steps to reproduce bug :&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;launch message producer and both message consumers alpha and beta&lt;/li&gt;
	&lt;li&gt;stop alpha consumer&lt;/li&gt;
	&lt;li&gt;notice on console pending messages on alpha queue increase&lt;/li&gt;
	&lt;li&gt;if we restart alpha consumer, all pending messages are consumed =&amp;gt; ok, only messages matching selector were in queue&lt;/li&gt;
	&lt;li&gt;restop alpha consumer&lt;/li&gt;
	&lt;li&gt;go on console and click on &quot;Browse&quot; link for alpha consumer queue&lt;/li&gt;
	&lt;li&gt;restart alpha consumer =&amp;gt; it will consume pending messages matching selector&lt;/li&gt;
	&lt;li&gt;notice there are other waiting messages that do not match selector, so the consumer queue is fastly full of useless messages =&amp;gt; ko&lt;/li&gt;
	&lt;li&gt;even after broker restart, the alpha consumer queue continues to receive message that do not match selectors =&amp;gt; ko&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;After code analysis, I notice &quot;Browse&quot; action create a new consumer on queue. In virtualSelectorCacheBrokerPlugin, the addConsumer method update &quot;subSelectorCache&quot; variable with &apos;TRUE&apos; selector.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;A pull request is submitted to fix that issue (&lt;a href=&quot;https://github.com/apache/activemq/pull/395&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/395&lt;/a&gt;), could you merge it for the next patch 5.15.11 ?&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13259523">AMQ-7312</key>
            <summary>virtualSelectorCacheBrokerPlugin fails on &quot;browse&quot; action</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jbonofre">Jean-Baptiste Onofr&#233;</assignee>
                                    <reporter username="danlek">Dany LECOQ</reporter>
                        <labels>
                    </labels>
                <created>Sun, 29 Sep 2019 14:00:23 +0000</created>
                <updated>Fri, 18 Oct 2019 17:10:23 +0000</updated>
                            <resolved>Fri, 18 Oct 2019 17:10:23 +0000</resolved>
                                    <version>5.15.10</version>
                                    <fixVersion>5.15.11</fixVersion>
                    <fixVersion>5.16.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1200">20m</timespent>
                                <comments>
                            <comment id="16940428" author="danlek" created="Sun, 29 Sep 2019 14:01:44 +0000"  >&lt;p&gt;Relates to &lt;a href=&quot;http://activemq.2283324.n4.nabble.com/VirtualTopic-issue-with-virtualSelectorCacheBrokerPlugin-td4751846.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.2283324.n4.nabble.com/VirtualTopic-issue-with-virtualSelectorCacheBrokerPlugin-td4751846.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16954827" author="jira-bot" created="Fri, 18 Oct 2019 17:09:41 +0000"  >&lt;p&gt;Commit 86a069ac5db9742ae58e396e162a0b3e2bdc66c3 in activemq&apos;s branch refs/heads/master from Dany LECOQ&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=86a069a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=86a069a&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7312&quot; title=&quot;virtualSelectorCacheBrokerPlugin fails on &amp;quot;browse&amp;quot; action&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7312&quot;&gt;&lt;del&gt;AMQ-7312&lt;/del&gt;&lt;/a&gt; virtualSelectorCacheBrokerPlugin addConsumer issue&lt;/p&gt;</comment>
                            <comment id="16954828" author="jira-bot" created="Fri, 18 Oct 2019 17:09:43 +0000"  >&lt;p&gt;Commit a5f06025057afb927d00c941412d1143c8614098 in activemq&apos;s branch refs/heads/master from Jean-Baptiste Onofr&#233;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=a5f0602&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=a5f0602&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #395 from couclock/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7312&quot; title=&quot;virtualSelectorCacheBrokerPlugin fails on &amp;quot;browse&amp;quot; action&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7312&quot;&gt;&lt;del&gt;AMQ-7312&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7312&quot; title=&quot;virtualSelectorCacheBrokerPlugin fails on &amp;quot;browse&amp;quot; action&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7312&quot;&gt;&lt;del&gt;AMQ-7312&lt;/del&gt;&lt;/a&gt; virtualSelectorCacheBrokerPlugin addConsumer issue&lt;/p&gt;</comment>
                            <comment id="16954829" author="jira-bot" created="Fri, 18 Oct 2019 17:09:45 +0000"  >&lt;p&gt;Commit a5f06025057afb927d00c941412d1143c8614098 in activemq&apos;s branch refs/heads/master from Jean-Baptiste Onofr&#233;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=a5f0602&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=a5f0602&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #395 from couclock/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7312&quot; title=&quot;virtualSelectorCacheBrokerPlugin fails on &amp;quot;browse&amp;quot; action&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7312&quot;&gt;&lt;del&gt;AMQ-7312&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7312&quot; title=&quot;virtualSelectorCacheBrokerPlugin fails on &amp;quot;browse&amp;quot; action&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7312&quot;&gt;&lt;del&gt;AMQ-7312&lt;/del&gt;&lt;/a&gt; virtualSelectorCacheBrokerPlugin addConsumer issue&lt;/p&gt;</comment>
                            <comment id="16954831" author="jira-bot" created="Fri, 18 Oct 2019 17:10:18 +0000"  >&lt;p&gt;Commit 1d8ae314bd8a18ed6ed3c0dea0ced08cadb6d1b8 in activemq&apos;s branch refs/heads/activemq-5.15.x from Dany LECOQ&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=1d8ae31&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=1d8ae31&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7312&quot; title=&quot;virtualSelectorCacheBrokerPlugin fails on &amp;quot;browse&amp;quot; action&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7312&quot;&gt;&lt;del&gt;AMQ-7312&lt;/del&gt;&lt;/a&gt; virtualSelectorCacheBrokerPlugin addConsumer issue&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 86a069ac5db9742ae58e396e162a0b3e2bdc66c3)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13184976">AMQ-7051</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 4 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z074og:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>