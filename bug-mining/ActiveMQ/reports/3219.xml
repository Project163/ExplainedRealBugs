<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:45:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-7126] Prevent OOM when recovering KahaDB and memory space is insufficient to load full page</title>
                <link>https://issues.apache.org/jira/browse/AMQ-7126</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;We have some brokers that are having OOM issues (on reboot) after having accepted messages without OOM. We investigated the problem and diagnosed that this happens when we attempt to load a full page during recovery.&lt;/p&gt;

&lt;p&gt;If we update KahaDBStore recoverNextMessage to use the following:&lt;br/&gt;
&quot;if (counter &amp;gt;= maxReturned || !listener.hasSpace())&quot;&lt;br/&gt;
To check if we have enough space to load the next message, than our OOM is averted.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4495&quot; title=&quot;Improve cursor memory management&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4495&quot;&gt;&lt;del&gt;AMQ-4495&lt;/del&gt;&lt;/a&gt; had the above change that was backed out due to performance concerns, our testing does not show us a degradation - perhaps we could provide an optional parameter to use this code?&lt;/p&gt;</description>
                <environment></environment>
        <key id="13207370">AMQ-7126</key>
            <summary>Prevent OOM when recovering KahaDB and memory space is insufficient to load full page</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jgoodyear">Jamie Mark Goodyear</assignee>
                                    <reporter username="heathkesler">Heath Kesler</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Jan 2019 22:14:55 +0000</created>
                <updated>Tue, 8 Jan 2019 00:55:48 +0000</updated>
                            <resolved>Thu, 3 Jan 2019 19:18:47 +0000</resolved>
                                    <version>5.15.8</version>
                                    <fixVersion>5.15.9</fixVersion>
                    <fixVersion>5.16.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16733396" author="jira-bot" created="Thu, 3 Jan 2019 19:11:59 +0000"  >&lt;p&gt;Commit 2ed15d563c4e7c259deb0748e403030957a6dde3 in activemq&apos;s branch refs/heads/activemq-5.15.x from Jamie Mark Goodyear&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2ed15d5&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2ed15d5&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7126&quot; title=&quot;Prevent OOM when recovering KahaDB and memory space is insufficient to load full page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7126&quot;&gt;&lt;del&gt;AMQ-7126&lt;/del&gt;&lt;/a&gt; Prevent OOM when recovering KahaDB and memory space is insufficient to load full page&lt;/p&gt;</comment>
                            <comment id="16733404" author="jira-bot" created="Thu, 3 Jan 2019 19:17:07 +0000"  >&lt;p&gt;Commit b86c666c4058e2c4ef09e77409044732959eacb6 in activemq&apos;s branch refs/heads/master from Jamie Mark Goodyear&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=b86c666&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=b86c666&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7126&quot; title=&quot;Prevent OOM when recovering KahaDB and memory space is insufficient to load full page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7126&quot;&gt;&lt;del&gt;AMQ-7126&lt;/del&gt;&lt;/a&gt; Prevent OOM when recovering KahaDB and memory space is insufficient to load full page. Thank you Heath Kesler and Johan Edstrom for investigation and patch.&lt;/p&gt;</comment>
                            <comment id="16733406" author="jgoodyear" created="Thu, 3 Jan 2019 19:18:10 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=heathkesler&quot; class=&quot;user-hover&quot; rel=&quot;heathkesler&quot;&gt;heathkesler&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=joed&quot; class=&quot;user-hover&quot; rel=&quot;joed&quot;&gt;joed&lt;/a&gt; for the investigation and patch supplied for this card.&lt;/p&gt;</comment>
                            <comment id="16736533" author="jira-bot" created="Tue, 8 Jan 2019 00:51:35 +0000"  >&lt;p&gt;Commit 9845853b6860619588e50b7a56a2f80af024d28e in activemq&apos;s branch refs/heads/activemq-5.15.x from Jamie Mark Goodyear&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9845853&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9845853&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7126&quot; title=&quot;Prevent OOM when recovering KahaDB and memory space is insufficient to load full page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7126&quot;&gt;&lt;del&gt;AMQ-7126&lt;/del&gt;&lt;/a&gt; Improvement to perf of 5266Test&lt;/p&gt;</comment>
                            <comment id="16736534" author="jira-bot" created="Tue, 8 Jan 2019 00:52:48 +0000"  >&lt;p&gt;Commit 4a21edc8d544474c477e2b38ac3f939f9873bfee in activemq&apos;s branch refs/heads/master from Jamie Mark Goodyear&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4a21edc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4a21edc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7126&quot; title=&quot;Prevent OOM when recovering KahaDB and memory space is insufficient to load full page&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7126&quot;&gt;&lt;del&gt;AMQ-7126&lt;/del&gt;&lt;/a&gt; Improvement to perf of 5266Test&lt;/p&gt;</comment>
                            <comment id="16736542" author="jgoodyear" created="Tue, 8 Jan 2019 00:55:48 +0000"  >&lt;p&gt;Performance did indeed appear to be an issue so submitted a change that does not affect performance&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12953540" name="OOM.patch" size="5757" author="joed" created="Wed, 2 Jan 2019 22:33:47 +0000"/>
                            <attachment id="12953670" name="amq7126.patch" size="4581" author="jgoodyear" created="Thu, 3 Jan 2019 19:02:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 45 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u00gsg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>