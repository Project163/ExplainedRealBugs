<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:50:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3276] ConcurrentModificationException in embedded 5.5.0 broker</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3276</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;We just migrated from ActiveMQ 5.4.2 to ActiveMQ 5.5.0.  So far so good, with one exception (pun not intended).  In one case where we have an embedded broker, we&apos;re seeing this exception get logged on occasion:&lt;/p&gt;

&lt;p&gt;WARNING; 08-Apr-2011 11:11:41; tid:45931; TransportConnection stopAsync; cannot create async transport stopper thread.. not waiting for stop to complete, reason:&lt;br/&gt;
java.util.ConcurrentModificationException&lt;br/&gt;
        at java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)&lt;br/&gt;
        at java.util.HashMap$EntryIterator.next(HashMap.java:834)&lt;br/&gt;
        at java.util.HashMap$EntryIterator.next(HashMap.java:832)&lt;br/&gt;
        at java.util.HashMap.putAllForCreate(HashMap.java:435)&lt;br/&gt;
        at java.util.HashMap.&amp;lt;init&amp;gt;(HashMap.java:225)&lt;br/&gt;
        at org.slf4j.helpers.BasicMDCAdapter.getCopyOfContextMap(BasicMDCAdapter.java:130)&lt;br/&gt;
        at org.slf4j.MDC.getCopyOfContextMap(MDC.java:182)&lt;br/&gt;
        at org.apache.activemq.util.MDCHelper.getCopyOfContextMap(MDCHelper.java:30)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.stopAsync(TransportConnection.java:946)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.processShutdown(TransportConnection.java:353)&lt;br/&gt;
        at org.apache.activemq.command.ShutdownInfo.visit(ShutdownInfo.java:35)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:306)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:179)&lt;br/&gt;
        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:116)&lt;br/&gt;
        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:69)&lt;br/&gt;
        at org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:218)&lt;br/&gt;
        at org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:127)&lt;br/&gt;
        at org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:48)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;

&lt;p&gt;Up until this morning, I had only seen that logged during shutdown of the app context.  But just now, it popped out independently, out of the blue.&lt;/p&gt;

&lt;p&gt;For what it&apos;s worth, here&apos;s the app context config:&lt;/p&gt;


&lt;p&gt;  &amp;lt;broker xmlns=&quot;http://activemq.apache.org/schema/core&quot;&lt;br/&gt;
          id=&quot;embeddedActivemqBroker&quot;&lt;br/&gt;
          useJmx=&quot;true&quot;&lt;br/&gt;
          persistent=&quot;true&quot;&lt;br/&gt;
          schedulerSupport=&quot;false&quot;&lt;br/&gt;
          advisorySupport=&quot;false&quot;&lt;br/&gt;
          enableStatistics=&quot;true&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;destinationPolicy&amp;gt;&lt;br/&gt;
      &amp;lt;policyMap&amp;gt;&lt;br/&gt;
        &amp;lt;policyEntries&amp;gt;&lt;br/&gt;
          &amp;lt;policyEntry queue=&quot;&amp;gt;&quot; producerFlowControl=&quot;false&quot; memoryLimit=&quot;20mb&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;/policyEntries&amp;gt;&lt;br/&gt;
      &amp;lt;/policyMap&amp;gt;&lt;br/&gt;
    &amp;lt;/destinationPolicy&amp;gt;&lt;br/&gt;
    &amp;lt;persistenceAdapter&amp;gt;&lt;br/&gt;
      &amp;lt;kahaDB directory=&quot;${EmbeddedBroker.dataDirectory}&quot;&lt;br/&gt;
              concurrentStoreAndDispatchQueues=&quot;false&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/persistenceAdapter&amp;gt;&lt;br/&gt;
  &amp;lt;/broker&amp;gt;&lt;/p&gt;

&lt;p&gt;Has anybody else seen this ConcurrentModificationException happening with 5.5.0 (or otherwise)?  Any ideas?&lt;/p&gt;

&lt;p&gt;I suppose I should also mention that we&apos;re using slf4j 1.6.1.  Not sure if that has anything to do with this, since the stack trace does show it happening in slf4j land...&lt;/p&gt;

&lt;p&gt;    &amp;lt;dependency&amp;gt;&lt;br/&gt;
      &amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;&lt;br/&gt;
      &amp;lt;artifactId&amp;gt;slf4j-api&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
      &amp;lt;version&amp;gt;1.6.1&amp;lt;/version&amp;gt;&lt;br/&gt;
      &amp;lt;scope&amp;gt;runtime&amp;lt;/scope&amp;gt;&lt;br/&gt;
    &amp;lt;/dependency&amp;gt;&lt;br/&gt;
    &amp;lt;dependency&amp;gt;&lt;br/&gt;
      &amp;lt;groupId&amp;gt;org.slf4j&amp;lt;/groupId&amp;gt;&lt;br/&gt;
      &amp;lt;artifactId&amp;gt;slf4j-jdk14&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
      &amp;lt;version&amp;gt;1.6.1&amp;lt;/version&amp;gt;&lt;br/&gt;
      &amp;lt;scope&amp;gt;runtime&amp;lt;/scope&amp;gt;&lt;br/&gt;
    &amp;lt;/dependency&amp;gt; &lt;/p&gt;</description>
                <environment>&lt;p&gt;jdk 1.6.0_24, Spring 3.0.5, ActiveMQ 5.5.0, Camel 2.7.0, slf4j 1.6.1&lt;/p&gt;</environment>
        <key id="12503739">AMQ-3276</key>
            <summary>ConcurrentModificationException in embedded 5.5.0 broker</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="dcheckoway">Dan Checkoway</reporter>
                        <labels>
                    </labels>
                <created>Fri, 8 Apr 2011 13:47:23 +0000</created>
                <updated>Tue, 20 Sep 2011 10:42:06 +0000</updated>
                            <resolved>Fri, 8 Apr 2011 16:21:59 +0000</resolved>
                                    <version>5.5.0</version>
                                    <fixVersion>5.6.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13017517" author="gtully" created="Fri, 8 Apr 2011 16:21:59 +0000"  >&lt;p&gt;reverted the explicit copy/set of the MDC context on thread creation as the underlying mdc impl used an inherited thread local for the context which makes the copy unnecessary and can cause contention. &lt;br/&gt;
the changes in &lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1090320&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=1090320&lt;/a&gt; should resolve the concurrent mod exception. I kicked off a new 5.6-SNAPSHOT deploy so if you get a chance please validate.&lt;/p&gt;</comment>
                            <comment id="13017561" author="dcheckoway" created="Fri, 8 Apr 2011 17:30:12 +0000"  >&lt;p&gt;Thanks for the very quick turnaround, Gary.  Unfortnately, the only place we&apos;ve seen this issue is in our loaded production environment.  SNAPSHOTs are all but off limits, sad to say.&lt;/p&gt;

&lt;p&gt;I&apos;m guessing 5.6.0 will be a while?  Do you think there will be a 5.5.1 release in the near term?&lt;/p&gt;</comment>
                            <comment id="13017640" author="dkulp" created="Fri, 8 Apr 2011 20:59:31 +0000"  >&lt;p&gt;&lt;br/&gt;
Just a note that while testing CXF with 5.5.0, I also run into this occasionally.   The CXF test suite will need to remain on 5.4.2 for now.&lt;/p&gt;</comment>
                            <comment id="13032919" author="famod" created="Fri, 13 May 2011 09:03:10 +0000"  >&lt;p&gt;Dan Checkoway wrote:&lt;br/&gt;
&quot;I&apos;m guessing 5.6.0 will be a while? Do you think there will be a 5.5.1 release in the near term?&quot;&lt;/p&gt;

&lt;p&gt;Same questions here!&lt;/p&gt;</comment>
                            <comment id="13085690" author="hondong" created="Tue, 16 Aug 2011 13:30:54 +0000"  >&lt;p&gt;Hi, have a look at Fuse 5.5.0 00.43: &lt;a href=&quot;http://fusesource.com/wiki/display/ProdInfo/FUSE+Message+Broker+v5.5.0-fuse+Release+Notes&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fusesource.com/wiki/display/ProdInfo/FUSE+Message+Broker+v5.5.0-fuse+Release+Notes&lt;/a&gt;&lt;br/&gt;
This Issue seems to be fixed there.&lt;/p&gt;</comment>
                            <comment id="13085692" author="hondong" created="Tue, 16 Aug 2011 13:31:36 +0000"  >&lt;p&gt;You can download it here: &lt;a href=&quot;http://repo.fusesource.com/nexus/content/repositories/releases/org/apache/activemq/apache-activemq/5.5.0-fuse-00-43/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://repo.fusesource.com/nexus/content/repositories/releases/org/apache/activemq/apache-activemq/5.5.0-fuse-00-43/&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14624</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 15 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ajjj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59439</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>