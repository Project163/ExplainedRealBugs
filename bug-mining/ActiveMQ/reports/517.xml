<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:39:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2049] Race condition cleaning connection using VMTransport</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2049</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;This problem arises when the server side has a RegionBroker installed and there is a configured clientID for the connection.&lt;/p&gt;

&lt;p&gt;ActiveMQConnection.ensureConnectionInfoSent sends the ConnectionInfo object with the configured clientID off to the server.  Currently this results in the same ConnectionInfo object in the AMQConnection and the TransportConnection.&lt;/p&gt;

&lt;p&gt;Now when you get to AMQConnection.cleanup() it asynchronously sends a message to the broker to clean up and immediately sets the configured clientID to null.  When the RegionBroker processes the remove message the clientID is no longer set (assuming bad luck in thread scheduling) and it complains:&lt;/p&gt;

&lt;p&gt;    public void removeConnection(ConnectionContext context, ConnectionInfo info, Throwable error) throws Exception {&lt;br/&gt;
        String clientId = info.getClientId();&lt;br/&gt;
        if (clientId == null) &lt;/p&gt;
{
            throw new InvalidClientIDException(&quot;No clientID specified for connection disconnect request&quot;);
        }

&lt;p&gt;One fix for this is to copy the connectionInfo before sending it to the broker.  This is a small but unnecessary cost for non-vm transports but works.&lt;br/&gt;
Another fix might be to send the close message synchronously so it&apos;s processed before the clientID is nulled out.&lt;/p&gt;

&lt;p&gt;I&apos;m committing the &quot;copy&quot; solution but IMO this should be reviewed by experts.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12482751">AMQ-2049</key>
            <summary>Race condition cleaning connection using VMTransport</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="djencks">David Jencks</assignee>
                                    <reporter username="djencks">David Jencks</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Dec 2008 19:23:44 +0000</created>
                <updated>Tue, 30 Dec 2008 20:07:07 +0000</updated>
                            <resolved>Tue, 30 Dec 2008 20:07:07 +0000</resolved>
                                    <version>5.3.0</version>
                                    <fixVersion>5.3.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12940570" author="djencks" created="Tue, 30 Dec 2008 20:07:07 +0000"  >&lt;p&gt;rev 730226 solves this by copying.  Review would be great.  I also added a TODO about a question in AMQConnection.. line 1336&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75103</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 48 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14cd3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233466</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>