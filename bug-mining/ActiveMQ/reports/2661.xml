<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:23:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6014] Offline Durable Topic Subscription exceeds memory limits</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6014</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;To reproduce:&lt;br/&gt;
1) Start two durable subscriptions using the openwire swissarmy examples:&lt;/p&gt;

&lt;p&gt;ant consumer -Dtopic=true -Ddurable=true -Dsubject=test -Duser=admin -Dpassword=admin -Dmax 500000&lt;/p&gt;

&lt;p&gt;ant consumer -Dtopic=true -Ddurable=true -Dsubject=test -Duser=admin -Dpassword=admin -DclientId=c2&lt;/p&gt;

&lt;p&gt;2) Start a producer using the following command:&lt;/p&gt;

&lt;p&gt;ant producer -Dtopic=true -Ddurable=true -Dsubject=test -Duser=admin -Dpassword=admin -Dmax=500000&lt;/p&gt;

&lt;p&gt;3) Kill one of the durable topic subscribers and let the test run&lt;/p&gt;

&lt;p&gt;4) the broker will go OOM&lt;/p&gt;

&lt;p&gt;The cache for the offline durable sub is not recording is cached messages against system memory usage as it should. Hence the limits are not hit.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12905926">AMQ-6014</key>
            <summary>Offline Durable Topic Subscription exceeds memory limits</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Oct 2015 12:28:45 +0000</created>
                <updated>Tue, 5 Jan 2016 15:08:49 +0000</updated>
                            <resolved>Mon, 19 Oct 2015 16:19:01 +0000</resolved>
                                    <version>5.12.0</version>
                                    <fixVersion>5.13.0</fixVersion>
                    <fixVersion>5.12.2</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14963461" author="jira-bot" created="Mon, 19 Oct 2015 15:23:21 +0000"  >&lt;p&gt;Commit 1ad0117932ae73603b963860c92c0980a3572b9e in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=1ad0117&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=1ad0117&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6014&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6014&lt;/a&gt; - fix up reference counting for durable subs such that ack on one sub does not decrement usage for offline subs. Fix and test&lt;/p&gt;</comment>
                            <comment id="14963551" author="gtully" created="Mon, 19 Oct 2015 16:19:01 +0000"  >&lt;p&gt;ref count was off, causing an ack on one sub to decrement usage shared across other offline or slow subs.&lt;/p&gt;</comment>
                            <comment id="14966705" author="jira-bot" created="Wed, 21 Oct 2015 12:06:27 +0000"  >&lt;p&gt;Commit 92d5efc32ca79b23225a2fa5225fe07083a0c3e5 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=92d5efc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=92d5efc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6014&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6014&lt;/a&gt; - test needs more time in ci. need to figure why it is sooo slow&lt;/p&gt;</comment>
                            <comment id="15004481" author="jira-bot" created="Fri, 13 Nov 2015 18:42:38 +0000"  >&lt;p&gt;Commit e54c9ccfa0a2bbc419fc10c39825610bf078c3db in activemq&apos;s branch refs/heads/activemq-5.12.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e54c9cc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e54c9cc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6014&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6014&lt;/a&gt; - fix up reference counting for durable subs such that ack on one sub does not decrement usage for offline subs. Fix and test&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 1ad0117932ae73603b963860c92c0980a3572b9e)&lt;/p&gt;</comment>
                            <comment id="15004482" author="jira-bot" created="Fri, 13 Nov 2015 18:42:39 +0000"  >&lt;p&gt;Commit 14f6abc552f535ee5bfcdf1e4f1d5f6caa89a4ef in activemq&apos;s branch refs/heads/activemq-5.12.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=14f6abc&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=14f6abc&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6014&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6014&lt;/a&gt; - test needs more time in ci. need to figure why it is sooo slow&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 92d5efc32ca79b23225a2fa5225fe07083a0c3e5)&lt;/p&gt;</comment>
                            <comment id="15021022" author="christopher.l.shannon" created="Sun, 22 Nov 2015 14:33:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Looks like this fix is causing a test failure in this test: org.apache.activemq.usecases.DurableSubscriberNonPersistentMessageTest.testDurableSubscriberNonPersistentMessage&lt;/p&gt;

&lt;p&gt;It seems that the issue is the extra call node.incrementReferenceCount() in the createMessageDispatch() method of DurableTopicSubscription is causing the cursorMemoryUsage value checked in the test to no longer be 0.  Not sure if this is an actual regression or if the failing test just needs to be adjusted for the new behavior that you added in this patch.&lt;/p&gt;</comment>
                            <comment id="15022034" author="jira-bot" created="Mon, 23 Nov 2015 12:37:32 +0000"  >&lt;p&gt;Commit 4318eba4a34ad64b1dad549ba94dadd155149b4a in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4318eba&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4318eba&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6014&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6014&lt;/a&gt; - topic store prefetch should take ownership like in the non persistent case - DurableSubscriberNonPersistentMessageTest regression&lt;/p&gt;</comment>
                            <comment id="15022037" author="gtully" created="Mon, 23 Nov 2015 12:41:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt; thanks for the heads up. that test was in a browser tab on the todo list but was not getting the priority it deserved. It is indeed a regression. I added a comment at the time and I think it was on the money, the cursor should take ownership of the reference.&lt;/p&gt;</comment>
                            <comment id="15022057" author="christopher.l.shannon" created="Mon, 23 Nov 2015 12:56:24 +0000"  >&lt;p&gt;Thanks for looking at that so quickly Gary.  I&apos;m just trying to get some of these tests cleaned up in preparation of a 5.13.0 release next week &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15083091" author="jira-bot" created="Tue, 5 Jan 2016 14:09:43 +0000"  >&lt;p&gt;Commit e3df09b9db09d6cf2834b0beb901c253be9b6120 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e3df09b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e3df09b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6094&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6094&lt;/a&gt; - regression via &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6014&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6014&lt;/a&gt; - incorrect ref count on message expiry event during cursor move for dispatch. Fix and test - thanks for the test&lt;/p&gt;</comment>
                            <comment id="15083198" author="jira-bot" created="Tue, 5 Jan 2016 15:08:09 +0000"  >&lt;p&gt;Commit 26665fa1b98a9004fc90a6eeea26ca06eb53d118 in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=26665fa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=26665fa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6094&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6094&lt;/a&gt; - regression via &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6014&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6014&lt;/a&gt; - incorrect ref count on message expiry event during cursor move for dispatch. Fix and test - thanks for the test&lt;/p&gt;

&lt;p&gt;(cherry picked from commit e3df09b9db09d6cf2834b0beb901c253be9b6120)&lt;/p&gt;</comment>
                            <comment id="15083201" author="jira-bot" created="Tue, 5 Jan 2016 15:08:49 +0000"  >&lt;p&gt;Commit 6f8942387e98f3dd41612dc331fa72f3fa718613 in activemq&apos;s branch refs/heads/activemq-5.12.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=6f89423&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=6f89423&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6094&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6094&lt;/a&gt; - regression via &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6014&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6014&lt;/a&gt; - incorrect ref count on message expiry event during cursor move for dispatch. Fix and test - thanks for the test&lt;/p&gt;

&lt;p&gt;(cherry picked from commit e3df09b9db09d6cf2834b0beb901c253be9b6120)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12922954">AMQ-6094</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 46 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2n6q7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>