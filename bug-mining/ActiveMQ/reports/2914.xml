<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:36:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6430] noLocal=true in durable subscriptions is ignored after reconnect</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6430</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I create a connection to my local ActiveMQ and open two sessions. In the first session I create a durable topic subscriber with noLocal=true. In the second session I send a message to the same topic. Then I close both sessions and the connection. The first time I do this, everything works well, that means I send but do not receive the message. The second time I run the same application I send AND receive the message.&lt;/p&gt;

&lt;p&gt;After removing all files and directories in ActiveMQ&apos;s data directory, not receiving my own message works again, but only once.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 14.04, OpenJDK 1.7.0_111 and Oracle JDK 1.8.0.74, other environments not testet&lt;/p&gt;</environment>
        <key id="13005198">AMQ-6430</key>
            <summary>noLocal=true in durable subscriptions is ignored after reconnect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="daniel.faber@agiltech.de">Daniel Faber</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Sep 2016 15:57:00 +0000</created>
                <updated>Fri, 23 Sep 2016 15:26:36 +0000</updated>
                            <resolved>Wed, 21 Sep 2016 13:36:37 +0000</resolved>
                                    <version>5.13.4</version>
                    <version>5.14.0</version>
                                    <fixVersion>5.14.1</fixVersion>
                    <fixVersion>5.15.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="15493757" author="daniel.faber@agiltech.de" created="Thu, 15 Sep 2016 15:58:45 +0000"  >&lt;p&gt;Attached sample application that reproduces the problem.&lt;/p&gt;</comment>
                            <comment id="15493782" author="daniel.faber@agiltech.de" created="Thu, 15 Sep 2016 16:10:42 +0000"  >&lt;p&gt;Steps to reproduce:&lt;/p&gt;

&lt;p&gt;1. start ActiveMQ: &lt;tt&gt;~/bin/apache-activemq-5.14.0 $ bin/activemq start&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;2. run attached test application, output is&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;message sent:     ID:hostname-44638-1473955333904-1:1:2:1:1; body: test-message
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;as expected.&lt;/p&gt;

&lt;p&gt;3. run test application again, output is&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;message sent:     ID:hostname-55628-1473955434257-1:1:2:1:1; body: test-message
incoming message: ID:hostname-55628-1473955434257-1:1:2:1:1; body: test-message
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;but this time I receive my own message which I didn&apos;t expect.&lt;/p&gt;

&lt;p&gt;4. stop ActiveMQ: &lt;tt&gt;~/bin/apache-activemq-5.14.0 $ bin/activemq stop&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;5. remove ActiveMQ&apos;s data files: &lt;tt&gt;~/bin/apache-activemq-5.14.0 $ rm -r data/*&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;6. start ActiveMQ: &lt;tt&gt;~/bin/apache-activemq-5.14.0 $ bin/activemq start&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;7. run test application, output is&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;message sent:     ID:hostname-46012-1473955651268-1:1:2:1:1; body: test-message
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;it seems to work, but..&lt;/p&gt;

&lt;p&gt;8. run test application again, output is&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;message sent:     ID:hostname-56206-1473955682047-1:1:2:1:1; body: test-message
incoming message: ID:hostname-56206-1473955682047-1:1:2:1:1; body: test-message
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;again, I receive my own message which I didn&apos;t expect.&lt;/p&gt;</comment>
                            <comment id="15495754" author="dbonn" created="Fri, 16 Sep 2016 08:37:38 +0000"  >&lt;p&gt;Successfully tried to reproduce this Issue using ActiveMQ 5.13.3&lt;/p&gt;</comment>
                            <comment id="15509755" author="christopher.l.shannon" created="Wed, 21 Sep 2016 12:25:48 +0000"  >&lt;p&gt;I took a look at this and there are actually two problems here with how noLocal is handled with durables.  The main issue you are seeing is that when the durable comes back online the new connectionId is not being captured for the NoLocal expression parser which means that when messages are sent after broker restart the logic thinks that the message isn&apos;t coming from the current subscription when it is.  The fix here is to make sure the connectionId is updated properly when the new consumer comes online.&lt;/p&gt;

&lt;p&gt;The second issue is that the JMS spec says that &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;A client can change an existing durable subscription by creating a durable
TopicSubscriber with the same name and a new topic and/or message selector,
or NoLocal attribute. Changing a durable subscription is equivalent to deleting
and recreating it.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Right now we aren&apos;t checking if that NoLocal attribute changes at all when a new consumer comes online.  Based on the spec I think we should update the activation check such that if the NoLocal attribute changes (ie goes from false to true or true to false) we treat it as a selector change and process it the same way (delete and recreate the sub)&lt;/p&gt;

&lt;p&gt;I am working on a patch and fix now to go out with our 5.14.1 release.&lt;/p&gt;</comment>
                            <comment id="15509813" author="christopher.l.shannon" created="Wed, 21 Sep 2016 12:49:02 +0000"  >&lt;p&gt;Looks like there are two places where the NoLocal attribute needs to be checked, it is done in one location but not the other.&lt;/p&gt;</comment>
                            <comment id="15509926" author="jira-bot" created="Wed, 21 Sep 2016 13:35:16 +0000"  >&lt;p&gt;Commit 7c293b661f22245ce21bf2b5aa1c5bf4192cb8c5 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=7c293b6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=7c293b6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6430&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6430&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When a nolocal durable consumer reconnects the new connectionId is properly captured for&lt;br/&gt;
the NoLocal expression so that nolocal works on reconnect.  Also fixed&lt;br/&gt;
the detection of the nolocal value changing on consumer connect.&lt;/p&gt;</comment>
                            <comment id="15509928" author="jira-bot" created="Wed, 21 Sep 2016 13:35:51 +0000"  >&lt;p&gt;Commit d3b86e77ddfe7d0185ff150520a0dddc9c6cf53e in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=d3b86e7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=d3b86e7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6430&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6430&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;When a nolocal durable consumer reconnects the new connectionId is properly captured for&lt;br/&gt;
the NoLocal expression so that nolocal works on reconnect.  Also fixed&lt;br/&gt;
the detection of the nolocal value changing on consumer connect.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 7c293b661f22245ce21bf2b5aa1c5bf4192cb8c5)&lt;/p&gt;</comment>
                            <comment id="15516688" author="christopher.l.shannon" created="Fri, 23 Sep 2016 14:58:50 +0000"  >&lt;p&gt;There are some test failures because JDBC and LevelDB don&apos;t support storing the noLocal flag.  Working on a fix now such that the noLocal flag only applies to stores that persist the flag (currently the memory store and kahadb/multikahadb when using openwire version &amp;gt;=11).  If JDBC and LevelDB are updated in the future such that this flag is stored then an update can be done so that this patch applies to those stores as well.&lt;/p&gt;</comment>
                            <comment id="15516746" author="jira-bot" created="Fri, 23 Sep 2016 15:26:14 +0000"  >&lt;p&gt;Commit 18571ce09b6385d8560200928a353e9da1a1ffe4 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=18571ce&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=18571ce&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6430&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6430&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Modifying patch so that only stores that persist the noLocal flag will&lt;br/&gt;
check if this flag has changed to prevent a subscription from being&lt;br/&gt;
deleted by mistake&lt;/p&gt;</comment>
                            <comment id="15516747" author="jira-bot" created="Fri, 23 Sep 2016 15:26:36 +0000"  >&lt;p&gt;Commit e0c70b843fb963cfa5e3be322c0d271ba61709bb in activemq&apos;s branch refs/heads/activemq-5.14.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e0c70b8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e0c70b8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6430&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6430&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Modifying patch so that only stores that persist the noLocal flag will&lt;br/&gt;
check if this flag has changed to prevent a subscription from being&lt;br/&gt;
deleted by mistake&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 18571ce09b6385d8560200928a353e9da1a1ffe4)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12902000">AMQ-5996</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12828665" name="ActiveMQNoLocalTest.java" size="1942" author="daniel.faber@agiltech.de" created="Thu, 15 Sep 2016 15:58:45 +0000"/>
                            <attachment id="12828664" name="pom.xml" size="918" author="daniel.faber@agiltech.de" created="Thu, 15 Sep 2016 15:58:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33o8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>