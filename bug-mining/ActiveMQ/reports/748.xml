<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:43:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2457] 5.3.0 broke a message selector that worked in 5.2.0</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2457</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;We have a MDB that connects to a topic in a standalone ActiveMQ trough the resource adapter (rar).&lt;/p&gt;

&lt;p&gt;The MDB has following message selector annotation:&lt;br/&gt;
@ActivationConfigProperty(propertyName = &quot;messageSelector&quot;, propertyValue = &quot;systemCausingEvent = &apos;pmntgw&apos; AND eventType = &apos;paymentStatusChange&apos;&quot;)&lt;/p&gt;

&lt;p&gt;This has worked fine in ActiveMQ 5.2.0. When I upgraded the RAR to 5.3.0, I&apos;m running into following exception:&lt;/p&gt;

&lt;p&gt;2009-10-19 09:20:46,457 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;org.jboss.system.ServiceController&amp;#93;&lt;/span&gt; Problem starting service jboss.j2ee:ear=rmm-ear-1.19.1-SNAPSHOT.ear,jar=rmm-ejb-1.19.1-SNAPSHOT.jar,name=OrderStatusEventListenerMDB,service=EJB3&lt;br/&gt;
org.jboss.deployment.DeploymentException: Unable to create activation spec ra=jboss.jca:service=RARDeployment,name=&apos;commonmq.rar&apos; messaging-type=javax.jms.MessageListener properties=&lt;/p&gt;
{subscriptionName=ActivationConfigProperty(subscriptionName=RMMOrderStatusEventListenerSubscription), acknowledgeMode=ActivationConfigProperty(acknowledgeMode=Auto-acknowledge), destination=ActivationConfigProperty(destination=EventService.Listener.Topic), messageSelector=ActivationConfigProperty(messageSelector=systemCausingEvent = &apos;ordermgt&apos; AND eventType = &apos;orderStatusChange&apos;), clientId=ActivationConfigProperty(clientId=RMMOrderStatusEventListener), destinationType=ActivationConfigProperty(destinationType=javax.jms.Topic), subscriptionDurability=ActivationConfigProperty(subscriptionDurability=Durable)}
&lt;p&gt;; - nested throwable: (javax.resource.spi.InvalidPropertyException: Invalid settings: messageSelector not set to valid message selector: null)&lt;br/&gt;
	at org.jboss.deployment.DeploymentException.rethrowAsDeploymentException(DeploymentException.java:53)&lt;br/&gt;
	at org.jboss.ejb3.mdb.inflow.JBossMessageEndpointFactory.createActivationSpec(JBossMessageEndpointFactory.java:290)&lt;br/&gt;
	at org.jboss.ejb3.mdb.inflow.JBossMessageEndpointFactory.start(JBossMessageEndpointFactory.java:189)&lt;br/&gt;
	at org.jboss.ejb3.mdb.MessagingContainer.startProxies(MessagingContainer.java:190)&lt;br/&gt;
	at org.jboss.ejb3.mdb.MessagingContainer.start(MessagingContainer.java:156)&lt;br/&gt;
	at org.jboss.ejb3.mdb.MDB.start(MDB.java:126)&lt;br/&gt;
 ...&lt;/p&gt;

&lt;p&gt;Caused by: javax.resource.spi.InvalidPropertyException: Invalid settings: messageSelector not set to valid message selector: null&lt;br/&gt;
	at org.apache.activemq.ra.ActiveMQActivationSpec.validate(ActiveMQActivationSpec.java:136)&lt;br/&gt;
	at org.jboss.resource.deployment.ActivationSpecFactory.createActivationSpec(ActivationSpecFactory.java:143)&lt;br/&gt;
	at org.jboss.resource.deployment.RARDeployment.createActivationSpec(RARDeployment.java:254)&lt;br/&gt;
	at org.jboss.resource.deployment.RARDeployment.internalInvoke(RARDeployment.java:218)&lt;br/&gt;
	at org.jboss.system.ServiceDynamicMBeanSupport.invoke(ServiceDynamicMBeanSupport.java:156)&lt;br/&gt;
	at org.jboss.mx.server.RawDynamicInvoker.invoke(RawDynamicInvoker.java:164)&lt;br/&gt;
	at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659)&lt;br/&gt;
	at org.jboss.system.server.jmx.LazyMBeanServer.invoke(LazyMBeanServer.java:291)&lt;br/&gt;
	at org.jboss.ejb3.JmxClientKernelAbstraction.invoke(JmxClientKernelAbstraction.java:44)&lt;br/&gt;
	at org.jboss.ejb3.mdb.inflow.JBossMessageEndpointFactory.createActivationSpec(JBossMessageEndpointFactory.java:285)&lt;br/&gt;
	... 147 more&lt;/p&gt;

&lt;p&gt;I briefly looked at ActiveMQ source and it seems like SelectorParser.parse(messageSelector) is throwing an exception without a message.&lt;br/&gt;
I don&apos;t know JavaCC so this is as far as I got debugging the problem.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Resource adapter running in JBoss 4.2.2&lt;/p&gt;</environment>
        <key id="12483101">AMQ-2457</key>
            <summary>5.3.0 broke a message selector that worked in 5.2.0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="koivuju">Jukka Koivusalo</reporter>
                        <labels>
                    </labels>
                <created>Mon, 19 Oct 2009 07:23:10 +0000</created>
                <updated>Wed, 21 Oct 2009 08:17:14 +0000</updated>
                            <resolved>Wed, 21 Oct 2009 06:58:45 +0000</resolved>
                                    <version>5.3.0</version>
                                                    <component>Selector</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12940867" author="gtully" created="Tue, 20 Oct 2009 12:59:39 +0000"  >&lt;p&gt;is it possible to see the exception from the parse? Does debug level logging help any? &lt;br/&gt;
Is there any chance you have a trivial mdb example that can easily reproduce?&lt;/p&gt;</comment>
                            <comment id="12941103" author="koivuju" created="Wed, 21 Oct 2009 06:45:33 +0000"  >&lt;p&gt;I checked out 5.3.0 tag, built a version with a little more debug added and got my hands on the actual exception:&lt;/p&gt;

&lt;p&gt;java.lang.IncompatibleClassChangeError&lt;br/&gt;
	at org.apache.activemq.ra.ActiveMQActivationSpec.isValidMessageSelector(ActiveMQActivationSpec.java:168)&lt;br/&gt;
	at org.apache.activemq.ra.ActiveMQActivationSpec.validate(ActiveMQActivationSpec.java:109)&lt;br/&gt;
	at org.jboss.resource.deployment.ActivationSpecFactory.createActivationSpec(ActivationSpecFactory.java:143)&lt;br/&gt;
	at org.jboss.resource.deployment.RARDeployment.createActivationSpec(RARDeployment.java:254)&lt;br/&gt;
	at org.jboss.resource.deployment.RARDeployment.internalInvoke(RARDeployment.java:218)&lt;br/&gt;
	at org.jboss.system.ServiceDynamicMBeanSupport.invoke(ServiceDynamicMBeanSupport.java:156)&lt;br/&gt;
	at org.jboss.mx.server.RawDynamicInvoker.invoke(RawDynamicInvoker.java:164)&lt;br/&gt;
	at org.jboss.mx.server.MBeanServerImpl.invoke(MBeanServerImpl.java:659)&lt;br/&gt;
	at org.jboss.system.server.jmx.LazyMBeanServer.invoke(LazyMBeanServer.java:291)&lt;br/&gt;
	at org.jboss.ejb3.JmxClientKernelAbstraction.invoke(JmxClientKernelAbstraction.java:44)&lt;br/&gt;
	at org.jboss.ejb3.mdb.inflow.JBossMessageEndpointFactory.createActivationSpec(JBossMessageEndpointFactory.java:285)&lt;br/&gt;
	at org.jboss.ejb3.mdb.inflow.JBossMessageEndpointFactory.start(JBossMessageEndpointFactory.java:189)&lt;br/&gt;
	at org.jboss.ejb3.mdb.MessagingContainer.startProxies(MessagingContainer.java:190)&lt;br/&gt;
	at org.jboss.ejb3.mdb.MessagingContainer.start(MessagingContainer.java:156)&lt;br/&gt;
	at org.jboss.ejb3.mdb.MDB.start(MDB.java:126)&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;Weird... This could also be an issue with the environment setup. I&apos;ll debug this further.&lt;/p&gt;</comment>
                            <comment id="12941104" author="koivuju" created="Wed, 21 Oct 2009 06:58:45 +0000"  >&lt;p&gt;Our deployment generator was adding activemq-core-5.2.0.jar to JBoss lib directory for unknown reason. This caused the class version incompatibility. &lt;/p&gt;

&lt;p&gt;The java.lang.IncompatibleClassChangeError that was thrown didn&apos;t have a message and the error logging didn&apos;t print the exception class name, which made the problem non-obvious.&lt;/p&gt;</comment>
                            <comment id="12941112" author="gtully" created="Wed, 21 Oct 2009 08:17:13 +0000"  >&lt;p&gt;made a small code modification so that the exception class  is visible in the error message. glad you were able to track it down.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96118</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tvev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>172398</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>