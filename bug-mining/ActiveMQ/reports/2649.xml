<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:23:32 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5961] Deadlock in client blocks all application server threads</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5961</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When we run JBoss EAP 6.4 with high load using AMQ 6.2 (ActiveMQ 5.11) everything grinds to a halt after a few hours. We have 170 threads blocked on the same lock:&lt;/p&gt;

&lt;p&gt;&quot;default-threads - 1400&quot; #406720 prio=5 os_prio=0 tid=0x00007f1b8402b800 nid=0xfe2d waiting for monitor entry &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007f19ccdd5000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: BLOCKED (on object monitor)&lt;br/&gt;
	at org.apache.activemq.TransactionContext.setXid(TransactionContext.java:729)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;waiting to lock &amp;lt;0x000000063ac688b8&amp;gt; (a java.util.HashMap)&lt;br/&gt;
	at org.apache.activemq.TransactionContext.end(TransactionContext.java:418)&lt;br/&gt;
	at org.apache.activemq.ra.LocalAndXATransaction.end(LocalAndXATransaction.java:98)&lt;br/&gt;
	at org.jboss.jca.core.tx.jbossts.XAResourceWrapperImpl.end(XAResourceWrapperImpl.java:118)&lt;br/&gt;
	at com.arjuna.ats.internal.jta.resources.arjunacore.XAResourceRecord.topLevelPrepare(XAResourceRecord.java:208)&lt;br/&gt;
	at com.arjuna.ats.arjuna.coordinator.BasicAction.doPrepare(BasicAction.java:2530)&lt;br/&gt;
	at com.arjuna.ats.arjuna.coordinator.BasicAction.doPrepare(BasicAction.java:2497)&lt;br/&gt;
	at com.arjuna.ats.arjuna.coordinator.BasicAction.prepare(BasicAction.java:2074)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x000000067461c090&amp;gt; (a com.arjuna.ats.internal.jta.transaction.arjunacore.AtomicAction)&lt;br/&gt;
	at com.arjuna.ats.arjuna.coordinator.BasicAction.End(BasicAction.java:1485)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x000000067461c090&amp;gt; (a com.arjuna.ats.internal.jta.transaction.arjunacore.AtomicAction)&lt;br/&gt;
	at com.arjuna.ats.arjuna.coordinator.TwoPhaseCoordinator.end(TwoPhaseCoordinator.java:98)&lt;br/&gt;
	at com.arjuna.ats.arjuna.AtomicAction.commit(AtomicAction.java:162)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This lock is owned by a thread that is waiting for another lock:&lt;/p&gt;

&lt;p&gt;&quot;default-threads - 1381&quot; #404073 prio=5 os_prio=0 tid=0x00007f1a6403c000 nid=0x7d49 waiting on condition &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007f19d8a91000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: WAITING (parking)&lt;br/&gt;
	at sun.misc.Unsafe.park(Native Method)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;parking to wait for  &amp;lt;0x000000063ab2a260&amp;gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync)&lt;br/&gt;
	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175)&lt;br/&gt;
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:836)&lt;br/&gt;
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:870)&lt;br/&gt;
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1199)&lt;br/&gt;
	at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:209)&lt;br/&gt;
	at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:285)&lt;br/&gt;
	at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:66)&lt;br/&gt;
	at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1309)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:1303)&lt;br/&gt;
	at org.apache.activemq.ActiveMQSession.asyncSendPacket(ActiveMQSession.java:2008)&lt;br/&gt;
	at org.apache.activemq.ActiveMQSession$5.afterRollback(ActiveMQSession.java:973)&lt;br/&gt;
	at org.apache.activemq.TransactionContext.afterRollback(TransactionContext.java:162)&lt;br/&gt;
	at org.apache.activemq.TransactionContext.prepare(TransactionContext.java:482)&lt;/li&gt;
	&lt;li&gt;locked &amp;lt;0x000000063ac688b8&amp;gt; (a java.util.HashMap)&lt;br/&gt;
	at org.apache.activemq.ra.LocalAndXATransaction.prepare(LocalAndXATransaction.java:130)&lt;br/&gt;
	at com.arjuna.ats.internal.jta.resources.arjunacore.XAResourceRecord.topLevelPrepare(XAResourceRecord.java:213)&lt;br/&gt;
	at com.arjuna.ats.arjuna.coordinator.BasicAction.doPrepare(BasicAction.java:2530)&lt;br/&gt;
	at com.arjuna.ats.arjuna.coordinator.BasicAction.doPrepare(BasicAction.java:2497)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The locked object is ENDED_XA_TRANSACTION_CONTEXTS in TransactionContext. The thread that has the lock calls afterRollback without first releasing it and afterRollback does not return promptly (not at all in fact, we need to restart the server to fix this). The same can happen with afterCommit, which is also called from within a synchronized block causing a potential deadlock.&lt;/p&gt;

&lt;p&gt;I think I have a fix for this and will create a pull request in github, or if you prefer I can send a patch? It simply means moving the external calls out from the synchronized blocks and would both remove the very real deadlock risks and improve performance.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Platform independent&lt;/p&gt;</environment>
        <key id="12863111">AMQ-5961</key>
            <summary>Deadlock in client blocks all application server threads</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="erik.wramner">Erik Wramner</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Sep 2015 16:38:49 +0000</created>
                <updated>Thu, 1 Oct 2015 13:36:56 +0000</updated>
                            <resolved>Thu, 1 Oct 2015 13:36:56 +0000</resolved>
                                    <version>5.11.0</version>
                    <version>5.11.1</version>
                                    <fixVersion>5.13.0</fixVersion>
                                    <component>JMS client</component>
                    <component>RAR</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                                <comments>
                            <comment id="14739101" author="githubbot" created="Thu, 10 Sep 2015 16:51:36 +0000"  >&lt;p&gt;GitHub user erik-wramner opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/141&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Prevent deadlock by moving calls to afterCommit&lt;br/&gt;
    and afterRollback out of synchronized blocks.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/erik-wramner/activemq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/erik-wramner/activemq&lt;/a&gt; master&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/141.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/141.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #141&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit bb2a9acaca34be9a96fa785396cca8d34255e8cd&lt;br/&gt;
Author: erik-wramner &amp;lt;erik@wramner.name&amp;gt;&lt;br/&gt;
Date:   2015-09-10T16:44:36Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Prevent deadlock by moving calls to afterCommit&lt;br/&gt;
    and afterRollback out of synchronized blocks.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14877273" author="githubbot" created="Sat, 19 Sep 2015 18:56:24 +0000"  >&lt;p&gt;Github user erik-wramner closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/141&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/141&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14877456" author="erik.wramner" created="Sun, 20 Sep 2015 08:10:10 +0000"  >&lt;p&gt;Pull request submitted, tests passed. How do I go about getting this into the release?&lt;/p&gt;</comment>
                            <comment id="14899892" author="christopher.l.shannon" created="Sun, 20 Sep 2015 12:06:46 +0000"  >&lt;p&gt;It looks like the pull request is closed and doesn&apos;t show any commits, can you reopen it so I can take a look?&lt;/p&gt;</comment>
                            <comment id="14899907" author="erik.wramner" created="Sun, 20 Sep 2015 12:44:25 +0000"  >&lt;p&gt;Sorry, I moved the commit to a dedicated branch in order to rebase. I have created a new pull request with the same code now, I didn&apos;t know that moving the commit would close the pull request.&lt;/p&gt;</comment>
                            <comment id="14899921" author="githubbot" created="Sun, 20 Sep 2015 13:12:32 +0000"  >&lt;p&gt;GitHub user erik-wramner opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/143&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Prevent deadlock by moving calls to afterCommit and afterRollback out of synchronized blocks.&lt;br/&gt;
    Same commit as before, moved it to separate branch.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/erik-wramner/activemq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/erik-wramner/activemq&lt;/a&gt; amq5961-deadlock&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/143.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/143.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #143&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 7c98fdd2819a34fe06b38555601ceaecd5f53aaa&lt;br/&gt;
Author: erik-wramner &amp;lt;erik@wramner.name&amp;gt;&lt;br/&gt;
Date:   2015-09-10T16:44:36Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Prevent deadlock by moving calls to afterCommit&lt;br/&gt;
    and afterRollback out of synchronized blocks.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14899946" author="christopher.l.shannon" created="Sun, 20 Sep 2015 13:57:01 +0000"  >&lt;p&gt;That patch might work but I&apos;m a little concerned that the iteration of the list outside of a synchronization block could cause other issues such as concurrent modification exceptions if another thread tried to insert into the list.&lt;/p&gt;

&lt;p&gt;Since this is only a partial thread dump, I am wondering why the afterRollback() call is never returning and stuck waiting for the MutexTransport write lock.  Is there an actual deadlock in that sense that the thread that has acquired the MutexTransport lock is waiting to acquire the ENDED_XA_TRANSACTION_CONTEXTS lock or is there some other reason why the MutexTransport lock can&apos;t be acquired? &lt;/p&gt;</comment>
                            <comment id="14900024" author="erik.wramner" created="Sun, 20 Sep 2015 18:40:47 +0000"  >&lt;p&gt;That is a valid point. I have changed the code so that it synchronizes on the list, keeping the global lock on the map short.&lt;/p&gt;

&lt;p&gt;The thread with the MutexTransport is waiting for the communication channel to the broker to be reestablished. I&apos;m not sure why that doesn&apos;t happen. It may be that the thread that should take care of that is blocked on the global map or it may be due to something else. We have two issues here. We are trying to sort out the communication issue with Red Hat. The broker is live and working, but obviously something is wrong.&lt;/p&gt;

&lt;p&gt;However, even if everything had worked out the global lock must hurt performance. It makes all other threads working with other destinations and transactions wait for this specific thread and transaction to complete its afterCommit or afterRollback calls. That must hurt. And it may cause the server to hang as it does in this case.&lt;/p&gt;</comment>
                            <comment id="14901308" author="christopher.l.shannon" created="Mon, 21 Sep 2015 20:12:38 +0000"  >&lt;p&gt;Looks like the PR got closed again. &lt;/p&gt;

&lt;p&gt;And as you pointed out, we can look at seeing if it makes sense to get rid of the global lock for performance reasons.  But this specific bug in this case certainly seems to be that the afterRollback is stuck.  Even if you took away the locking, you&apos;d have all of your threads stuck waiting forever for afterRollback to finish which would still cause the broker to quit working eventually.&lt;/p&gt;</comment>
                            <comment id="14904020" author="erik.wramner" created="Wed, 23 Sep 2015 06:08:52 +0000"  >&lt;p&gt;Pull request 143 (&lt;a href=&quot;https://github.com/apache/activemq/pull/143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/143&lt;/a&gt;) is open, 141 is closed.&lt;/p&gt;

&lt;p&gt;As for all threads becoming stuck I don&apos;t agree for two reasons. First it might be that the thread that is supposed to reestablish communication is blocked on the locked HashMap. I don&apos;t know the code base well enough to easily find out, but I can dig into the stack trace. If that is the case we have a true deadlock and it would help to get rid of the global lock. Second even if afterRollback blocks forever that will kill one thread and one transaction, but without the global lock it may be possible for the other 169 threads to proceed with their work for new transactions (possibly for other queues/topics if the queue/topic is broken). They may also get blocked by other things, but it is possible that they can proceed. That could make the difference between a panic and a planned restart after peak times.&lt;/p&gt;

&lt;p&gt;By the way, I changed the code again so that it doesn&apos;t lock the list when it has been removed from the map. Instead all additions to the list are within the map&apos;s lock. That way additions are protected and nothing can modify the list when it has been removed, so it can be processed safely without locks. That gets rid of the possible global lock in isInXATransaction, where the previous version locked the map and then tried to get a lock on the list.&lt;/p&gt;</comment>
                            <comment id="14906176" author="christopher.l.shannon" created="Thu, 24 Sep 2015 10:30:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;, Can you take a look at this when you get a chance to see what you think about the proposed changes of to the transactional behavior here? &lt;/p&gt;</comment>
                            <comment id="14908162" author="gtully" created="Fri, 25 Sep 2015 15:31:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erik.wramner&quot; class=&quot;user-hover&quot; rel=&quot;erik.wramner&quot;&gt;erik.wramner&lt;/a&gt; can you attach the full thread dump, just to determine why there is no response from the broker. thanks&lt;/p&gt;</comment>
                            <comment id="14909175" author="erik.wramner" created="Sat, 26 Sep 2015 09:29:25 +0000"  >&lt;p&gt;Stack trace, application-specific package/class names replaced.&lt;/p&gt;</comment>
                            <comment id="14933473" author="gtully" created="Mon, 28 Sep 2015 15:49:32 +0000"  >&lt;p&gt;peeking at the thread dump the root cause is: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;at org.apache.activemq.transport.failover.FailoverTransport.oneway(FailoverTransport.java:614)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;. There was a recent fix (&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5951&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5951&lt;/a&gt;) in that area but there is also a workaround via timeout=1 for the failover transport.&lt;br/&gt;
The RAR does it&apos;s own reconnection and as a result the failover transport should not block on a reconnect and rather propagate the failure back to the caller, ie: maxReconnectAttempts=0 needs to be used on the failover url.&lt;br/&gt;
Peeking more at the fix, I think the canReconnect check may also be needed at line 609. Need to verify that.&lt;/p&gt;</comment>
                            <comment id="14933860" author="erik.wramner" created="Mon, 28 Sep 2015 19:40:51 +0000"  >&lt;p&gt;I&apos;m quite sure we were using maxReconnectAttempts=0, but not timeout=1. Good to know.&lt;/p&gt;

&lt;p&gt;Still, unless you think the global lock is needed in order to ensure correctness somehow I would still argue for getting rid of it. It must hurt performance to make all the other threads wait for the afterCommit/afterRollback processing to complete and as illustrated here there is always a risk for liveness problems.&lt;/p&gt;</comment>
                            <comment id="14936704" author="gtully" created="Wed, 30 Sep 2015 10:52:13 +0000"  >&lt;p&gt;I think the pull request looks fine and I see your point about liveness. The only issue is the lack of tests in this area and no additional test are included. However if you found some benefit in your use case it can make some sense to include this.&lt;br/&gt;
I can&apos;t see any point in holding the lock for callback processing from an transaction integrity point of view &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14939537" author="erik.wramner" created="Thu, 1 Oct 2015 09:05:27 +0000"  >&lt;p&gt;Good. I like tests, but I can&apos;t see how I could write a good one for this. It happens after a few hours of heavy load. I guess I can mock it, but then the test would just work the way I intended...&lt;/p&gt;

&lt;p&gt;If you are happy with the pull request perhaps you or Christopher can accept it?&lt;/p&gt;

&lt;p&gt;-Erik&lt;/p&gt;</comment>
                            <comment id="14939803" author="christopher.l.shannon" created="Thu, 1 Oct 2015 13:26:28 +0000"  >&lt;p&gt;I can merge this in and we can let Jenkins run and see if it causes any regressions on the existing tests.  Thanks for reviewing this Gary.&lt;/p&gt;</comment>
                            <comment id="14939814" author="jira-bot" created="Thu, 1 Oct 2015 13:35:04 +0000"  >&lt;p&gt;Commit 9a78bc689f06dde61ba38be1ebc840a53ca02b68 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erik.wramner&quot; class=&quot;user-hover&quot; rel=&quot;erik.wramner&quot;&gt;erik.wramner&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9a78bc6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9a78bc6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Prevent deadlock by moving calls to afterCommit&lt;br/&gt;
and afterRollback out of synchronized blocks.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;br/&gt;
Lock list but keep global hashmap out for deadlock protection.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;br/&gt;
Lock safely in isInXATransaction.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;br/&gt;
Don&apos;t synchronize on list as we have an exclusive reference.&lt;/p&gt;</comment>
                            <comment id="14939815" author="jira-bot" created="Thu, 1 Oct 2015 13:35:05 +0000"  >&lt;p&gt;Commit 9a78bc689f06dde61ba38be1ebc840a53ca02b68 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erik.wramner&quot; class=&quot;user-hover&quot; rel=&quot;erik.wramner&quot;&gt;erik.wramner&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9a78bc6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9a78bc6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Prevent deadlock by moving calls to afterCommit&lt;br/&gt;
and afterRollback out of synchronized blocks.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;br/&gt;
Lock list but keep global hashmap out for deadlock protection.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;br/&gt;
Lock safely in isInXATransaction.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;br/&gt;
Don&apos;t synchronize on list as we have an exclusive reference.&lt;/p&gt;</comment>
                            <comment id="14939816" author="jira-bot" created="Thu, 1 Oct 2015 13:35:06 +0000"  >&lt;p&gt;Commit 9a78bc689f06dde61ba38be1ebc840a53ca02b68 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erik.wramner&quot; class=&quot;user-hover&quot; rel=&quot;erik.wramner&quot;&gt;erik.wramner&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9a78bc6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9a78bc6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Prevent deadlock by moving calls to afterCommit&lt;br/&gt;
and afterRollback out of synchronized blocks.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;br/&gt;
Lock list but keep global hashmap out for deadlock protection.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;br/&gt;
Lock safely in isInXATransaction.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;br/&gt;
Don&apos;t synchronize on list as we have an exclusive reference.&lt;/p&gt;</comment>
                            <comment id="14939817" author="jira-bot" created="Thu, 1 Oct 2015 13:35:07 +0000"  >&lt;p&gt;Commit 9a78bc689f06dde61ba38be1ebc840a53ca02b68 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=erik.wramner&quot; class=&quot;user-hover&quot; rel=&quot;erik.wramner&quot;&gt;erik.wramner&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9a78bc6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9a78bc6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Prevent deadlock by moving calls to afterCommit&lt;br/&gt;
and afterRollback out of synchronized blocks.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;br/&gt;
Lock list but keep global hashmap out for deadlock protection.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;br/&gt;
Lock safely in isInXATransaction.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;br/&gt;
Don&apos;t synchronize on list as we have an exclusive reference.&lt;/p&gt;</comment>
                            <comment id="14939818" author="jira-bot" created="Thu, 1 Oct 2015 13:35:08 +0000"  >&lt;p&gt;Commit 450a5226e01a6a75e5dda4efbf088933fc0878a4 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=450a522&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=450a522&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5961&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This closes #143&lt;/p&gt;

&lt;p&gt;Applying patch with thanks to Erik Wramner&lt;/p&gt;</comment>
                            <comment id="14939820" author="githubbot" created="Thu, 1 Oct 2015 13:35:18 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/143&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/143&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14939823" author="christopher.l.shannon" created="Thu, 1 Oct 2015 13:36:56 +0000"  >&lt;p&gt;I squashed the commits/rebased and applied the change.  If everything looks good after CI runs I can backport the fix to 5.12.1.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12762510" name="edited-trace.txt" size="1332029" author="erik.wramner" created="Sat, 26 Sep 2015 09:29:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k093:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>