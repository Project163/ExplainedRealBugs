<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:56:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4062] durableTopicPrefetch attribute in policyEntry in activemq.xml dont take effect</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4062</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;There are three methods to configure the prefetchSize of a consumer,per broker,per connection and per destination.I configured the policyEntry element in activemq.xml and set durableTopicPrefetch=&quot;5&quot;.Then a durable topic Consumer connected to the broker ,but the prefetchSize instance variable of ConsumerInfo object was 100, the default value for durable topic consumer.Some messages of the topic consumer were stored in the kahaDB.&lt;/p&gt;</description>
                <environment>&lt;p&gt;windows XP jdk1.6&lt;/p&gt;</environment>
        <key id="12607997">AMQ-4062</key>
            <summary>durableTopicPrefetch attribute in policyEntry in activemq.xml dont take effect</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="liuming">Ming Liu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Sep 2012 02:42:12 +0000</created>
                <updated>Thu, 15 Nov 2012 22:33:30 +0000</updated>
                            <resolved>Thu, 15 Nov 2012 22:33:30 +0000</resolved>
                                    <version>5.6.0</version>
                                    <fixVersion>5.7.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13457585" author="tabish121" created="Tue, 18 Sep 2012 03:57:52 +0000"  >&lt;p&gt;It would be useful if you could create and attach a JUnit test case that demonstrates your issue.  This will allow for quicker turnaround and ensure that the fix stays into the future.  &lt;/p&gt;</comment>
                            <comment id="13460127" author="liuming" created="Fri, 21 Sep 2012 02:02:01 +0000"  >&lt;p&gt;test case.unzip and put it the src/test/java&lt;/p&gt;</comment>
                            <comment id="13460130" author="liuming" created="Fri, 21 Sep 2012 02:16:57 +0000"  >&lt;p&gt;I&apos;ve created a testcase.The PolicyEntry configure the DurableTopicSubscription correctly when there&apos;s nothing for the topic in the Kaha storage.When KahaDB contains some messages for that topic,Destination and Subscription info will be recovered and ConsumerInfo will be created in addSubscriptionsForDestination method in TopicRegion class.After that the value of prefetchSize of the ConsumerInfo is zero.&lt;/p&gt;</comment>
                            <comment id="13460360" author="tabish121" created="Fri, 21 Sep 2012 08:47:23 +0000"  >&lt;p&gt;Modified version of the attached test that puts everything into one file.&lt;/p&gt;</comment>
                            <comment id="13460361" author="tabish121" created="Fri, 21 Sep 2012 08:48:22 +0000"  >&lt;p&gt;I modified the test case and ran it against 5.7-SNAPSHOT tests all pass without issue.  A cursory review of the code would seem to indicate that everything is working as it should be.&lt;/p&gt;</comment>
                            <comment id="13460881" author="liuming" created="Fri, 21 Sep 2012 22:15:32 +0000"  >&lt;p&gt;the code &lt;br/&gt;
assertEquals(100, info.getPrefetchSize()) &lt;br/&gt;
in testSecondStart should be &lt;br/&gt;
assertEquals(5, info.getPrefetchSize());&lt;br/&gt;
because &lt;br/&gt;
policy.setDurableTopicPrefetch(PREFETCH_SIZE_5);&lt;/p&gt;</comment>
                            <comment id="13462824" author="tabish121" created="Tue, 25 Sep 2012 15:03:50 +0000"  >&lt;p&gt;I think I see what&apos;s going wrong, will start working on a fix.&lt;/p&gt;</comment>
                            <comment id="13463280" author="tabish121" created="Tue, 25 Sep 2012 22:22:33 +0000"  >&lt;p&gt;Fixed on trunk.&lt;/p&gt;</comment>
                            <comment id="13497430" author="gtully" created="Wed, 14 Nov 2012 20:55:38 +0000"  >&lt;p&gt;This change seems to break org.apache.activemq.store.MessagePriorityTest#testDurableSubs&lt;br/&gt;
the problem is that the pendingmessage cursor is reset on activate but with the default keepDurableSubsActive, the state in that cursor about subscribed destinations is lost.&lt;br/&gt;
I think we should not call policyentry.configure if keepDurableSubsActive is set and we have been deactivated. Not sure if there is an easy way to determine that.&lt;/p&gt;</comment>
                            <comment id="13497431" author="gtully" created="Wed, 14 Nov 2012 20:57:03 +0000"  >&lt;p&gt;the unusual thing about that test is that it sets a setPendingDurableSubscriberPolicy via a policy, which triggers the reset.&lt;br/&gt;
The test works if brokerService.setKeepDurableSubsActive(false) is used.&lt;/p&gt;</comment>
                            <comment id="13497542" author="tabish121" created="Wed, 14 Nov 2012 22:39:56 +0000"  >&lt;p&gt;So far I don&apos;t see any way to tell if the sub was just deactivated or is coming back from a clean broker start, seems the only way so far is to only reconfigure on setKeepDurableSubsActive(false)&lt;/p&gt;</comment>
                            <comment id="13498405" author="tabish121" created="Thu, 15 Nov 2012 22:33:30 +0000"  >&lt;p&gt;Updated fix applied the settings only if keepDurableSubsActive is false the policy is only applied if durable subs go inactive otherwise they retain their original configuration. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12546016" name="AMQ4062Test.java" size="8580" author="tabish" created="Fri, 21 Sep 2012 08:47:23 +0000"/>
                            <attachment id="12546104" name="AMQ4062TestNew.java" size="8790" author="liuming" created="Fri, 21 Sep 2012 22:15:32 +0000"/>
                            <attachment id="12545990" name="ming.zip" size="3379" author="liuming" created="Fri, 21 Sep 2012 02:02:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249731</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ah5j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59052</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>