<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:34:48 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6209] Unmatched messages on consumer queues when using SubQueueCacheSelectorPlugin in network of brokers</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6209</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When using SubQueueSelectorCachePlugin to preserve consumers&apos; selectors in network of brokers, the queues start matching all messages after consumers failover between brokers.&lt;/p&gt;

&lt;p&gt;The underlying reason is, that &lt;tt&gt;SubQueueSelectorCacheBroker&lt;/tt&gt; would cache selector &lt;tt&gt;TRUE&lt;/tt&gt; for connected demand subscription, and therefore will permanently match all messages even if actual consumer reconnects.&lt;/p&gt;

&lt;p&gt;Additionally, browsing the queue will also cause &lt;tt&gt;TRUE&lt;/tt&gt; selector to be persisted.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12949797">AMQ-6209</key>
            <summary>Unmatched messages on consumer queues when using SubQueueCacheSelectorPlugin in network of brokers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="pdudits">Patrik Dudits</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Mar 2016 08:22:16 +0000</created>
                <updated>Tue, 17 Oct 2023 09:33:41 +0000</updated>
                            <resolved>Tue, 17 Oct 2023 09:33:41 +0000</resolved>
                                    <version>5.13.2</version>
                                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="2400">40m</timespent>
                                <comments>
                            <comment id="15192902" author="pdudits" created="Mon, 14 Mar 2016 08:22:43 +0000"  >&lt;p&gt;I&apos;ll provide a test and a pull request&lt;/p&gt;</comment>
                            <comment id="15192936" author="githubbot" created="Mon, 14 Mar 2016 09:04:21 +0000"  >&lt;p&gt;GitHub user pdudits opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/174&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/174&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6209&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6209&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    SubQueueSelectorCacheBroker should ignore selectors of network subscriptions and queue browsers, as these shouldn&apos;t permanently extend the number of matching messages of a consumer queue.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/pdudits/activemq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/pdudits/activemq&lt;/a&gt; amq-6209&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/174.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/174.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #174&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 4617e0cd891ff57e2bdaf454f7fcdbfab5599fac&lt;br/&gt;
Author: Patrik Dudits &amp;lt;patrik@dudits.net&amp;gt;&lt;br/&gt;
Date:   2016-03-14T09:01:17Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6209&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6209&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    SubQueueSelectorCacheBroker should ignore selectors of network subscriptions and queue browsers, as these shouldn&apos;t permanently extend the number of matching&lt;br/&gt;
    messages of a consumer queue.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15272742" author="tabish121" created="Thu, 5 May 2016 18:07:25 +0000"  >&lt;p&gt;Can you rebase your PR against master?&lt;/p&gt;</comment>
                            <comment id="15280573" author="pdudits" created="Wed, 11 May 2016 18:23:58 +0000"  >&lt;p&gt;Yes, I just pushed updated PR.&lt;/p&gt;</comment>
                            <comment id="15281906" author="tabish121" created="Thu, 12 May 2016 18:43:38 +0000"  >&lt;p&gt;I gave the patch a quick spin and the test fails with the below:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.reflect.UndeclaredThrowableException
	at com.sun.proxy.$Proxy4.selectorsForDestination(Unknown Source)
	at org.apache.activemq.usecases.TwoBrokerVirtualTopicSelectorFailoverTest.testLeaksAtFailover(TwoBrokerVirtualTopicSelectorFailoverTest.java:137)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at junit.framework.TestCase.runTest(TestCase.java:176)
	at junit.framework.TestCase.runBare(TestCase.java:141)
	at org.apache.activemq.CombinationTestSupport.runBare(CombinationTestSupport.java:107)
	at org.apache.activemq.CombinationTestSupport.runBare(CombinationTestSupport.java:113)
	at junit.framework.TestResult$1.protect(TestResult.java:122)
	at junit.framework.TestResult.runProtected(TestResult.java:142)
	at junit.framework.TestResult.run(TestResult.java:125)
	at junit.framework.TestCase.run(TestCase.java:129)
	at junit.framework.TestSuite.runTest(TestSuite.java:252)
	at junit.framework.TestSuite.run(TestSuite.java:247)
	at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:86)
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:86)
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:459)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:675)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:382)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:192)
Caused by: javax.management.InstanceNotFoundException: org.apache.activemq:type=Broker,brokerName=BrokerA,service=plugin,virtualDestinationSelectoCache=virtualDestinationCache
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getMBean(DefaultMBeanServerInterceptor.java:1095)
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.invoke(DefaultMBeanServerInterceptor.java:816)
	at com.sun.jmx.mbeanserver.JmxMBeanServer.invoke(JmxMBeanServer.java:801)
	at javax.management.MBeanServerInvocationHandler.invoke(MBeanServerInvocationHandler.java:292)
	... 23 more

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So you might need to do some more work on the test to ensure it&apos;s sound.  There are also some warnings in the test for simple things that can be fixed like missing types to an ArrayList create etc.  &lt;/p&gt;</comment>
                            <comment id="15284283" author="pdudits" created="Mon, 16 May 2016 09:04:13 +0000"  >&lt;p&gt;I will gladly comply, however I need to know what code did you run and in what environment, as &lt;a href=&quot;https://github.com/apache/activemq/pull/174/files#diff-8a4e7ffbae789929bba4db6912813a58R137&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&lt;tt&gt;TwoBrokerVirtualTopicSelectorFailoverTest.java:137&lt;/tt&gt;&lt;/a&gt; is start of multiline comment in the PR and the test passes for me on Windows, JDK 1.8.0_45 and Maven 3.3.9.&lt;/p&gt;

&lt;p&gt;Since that method is only used once, it might correspond to line 124. And it could fail only if broker A failed to restart - a situation that is not explicitly checked in the test (&lt;tt&gt;broker.waitUntilStarted&lt;/tt&gt; returning &lt;tt&gt;false&lt;/tt&gt;). Is there more information in your test output why that happened?&lt;/p&gt;</comment>
                            <comment id="15284493" author="pdudits" created="Mon, 16 May 2016 13:39:32 +0000"  >&lt;p&gt;I cleaned up the test a bit, however the functionality remains the same until I will have a hint what might go wrong during restart - it doesn&apos;t seem to be different from other such test cases.&lt;/p&gt;</comment>
                            <comment id="15285202" author="tabish121" created="Mon, 16 May 2016 20:08:52 +0000"  >&lt;p&gt;Test fails using the latest patch, I don&apos;t have time to debug it so here is the console output from the test.  &lt;/p&gt;

&lt;p&gt;PS. You should squash the commits in you PR otherwise we won&apos;t be able to apply it when the time comes.  &lt;/p&gt;</comment>
                            <comment id="15285607" author="pdudits" created="Mon, 16 May 2016 23:01:21 +0000"  >&lt;p&gt;Ok, so from the input, RMI registry port was already taken. I switched off creation of JMX connector.&lt;/p&gt;

&lt;p&gt;And for the actual cause of failure on JDK7, items in &lt;tt&gt;broker&lt;/tt&gt; map were returned in different order than on JDK 8, leading to incorrect failover URL to be used in the test.&lt;/p&gt;

&lt;p&gt;I updated the PR, please let me know if it works for you, I&apos;ll squash it right after that.&lt;/p&gt;</comment>
                            <comment id="15286778" author="tabish121" created="Tue, 17 May 2016 14:58:46 +0000"  >&lt;p&gt;I ran your updated test and it does indeed pass, however it also passes without the fix applied which is a problem as it doesn&apos;t validate the problem and protect the fix into the future. &lt;/p&gt;</comment>
                            <comment id="15286935" author="pdudits" created="Tue, 17 May 2016 16:20:38 +0000"  >&lt;p&gt;That is surprising, as I was starting with a failing test. I&apos;ll have to check in different environments again. It may take few days to get back to this.&lt;/p&gt;</comment>
                            <comment id="17776094" author="jbonofre" created="Tue, 17 Oct 2023 09:33:41 +0000"  >&lt;p&gt;The test doesn&apos;t fail even before the change. So, I don&apos;t see problem or way to reproduce it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12804247" name="testOuput.tx" size="78243" author="tabish" created="Mon, 16 May 2016 20:08:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ul53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>