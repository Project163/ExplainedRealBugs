<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:05:07 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5016] BitArrayBin doesn&apos;t work well with index larger than Integer.MAX_VALUE</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5016</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;In BitArrayBin class, the index&apos;s unit type is long. It also has a variable called firstIndex, which store the index where the window starts. And that firstindex&apos;s unit is int. If the index is bigger than Integer.MAX_VALUE, setBit() and getBit() starts to return bad value.&lt;/p&gt;

&lt;p&gt;The defect causes activemq client to perform badly when receiving message that sequence id is bigger than max interger. It spends most of the time to shift window, and also blocks other consumer threads. Below is the jstack log that shows the problem.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ Session Task-869879&quot;&lt;/span&gt; prio=10 tid=0x00007f412d6ee000 nid=0x3cbe runnable [0x00007f405b7b6000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: RUNNABLE
        at java.util.LinkedList.linkLast(LinkedList.java:140)
        at java.util.LinkedList.add(LinkedList.java:336)
        at org.apache.activemq.util.BitArrayBin.getBitArray(BitArrayBin.java:123)
        at org.apache.activemq.util.BitArrayBin.setBit(BitArrayBin.java:59)
        at org.apache.activemq.ActiveMQMessage AuditNoSync.isDuplicate(ActiveMQMessageAuditNoSyn c.java:160)
        at org.apache.activemq.ActiveMQMessageAudit.isDuplicate(ActiveMQMessageAudit.java:59)
        - locked &amp;lt;0x00007f46a0138ab0&amp;gt; (a org.apache.activemq.ActiveMQMessageAudit)
        at org.apache.activemq.ActiveMQMessage AuditNoSync.isDuplicate(ActiveMQMessageAuditNoSyn c.java:140)
        at org.apache.activemq.ConnectionAudit.isDuplicate(ConnectionAudit.java:52)
        - locked &amp;lt;0x00007f4881e6b968&amp;gt; (a org.apache.activemq.ConnectionAudit)
        at org.apache.activemq.ActiveMQConnection.isDuplicate(ActiveMQConnection.java:2291)
        at org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:1223)
        - locked &amp;lt;0x00007f45db222fb8&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
        at org.apache.activemq.ActiveMQSessionExecutor.dispatch(ActiveMQSessionExecutor.java:134)
        at org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:205)
        at org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:127)
        at org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:48)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1110)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:603)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:722)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12692898">AMQ-5016</key>
            <summary>BitArrayBin doesn&apos;t work well with index larger than Integer.MAX_VALUE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="susu119">Dan Yu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Feb 2014 16:40:26 +0000</created>
                <updated>Sun, 18 Sep 2016 05:58:56 +0000</updated>
                            <resolved>Wed, 6 Aug 2014 14:23:09 +0000</resolved>
                                    <version>5.9.0</version>
                                    <fixVersion>5.11.0</fixVersion>
                                    <component>JMS client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13889608" author="susu119" created="Mon, 3 Feb 2014 16:42:46 +0000"  >&lt;p&gt;A unit test that expose the issue.&lt;/p&gt;</comment>
                            <comment id="14028151" author="tabish121" created="Wed, 11 Jun 2014 18:20:43 +0000"  >&lt;p&gt;Fixed on trunk.&lt;/p&gt;</comment>
                            <comment id="14086406" author="gtully" created="Tue, 5 Aug 2014 15:51:20 +0000"  >&lt;p&gt;the fix breaks serializability and as a result reading the producer audit from the store. I guess we need to declare incompatibility and use a new serialVersionUID or maybe implement a custom read that can deal with migration.&lt;br/&gt;
I came across this exception&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2014-08-05 15:24:07,992 [main           ] - WARN  MessageDatabase                - Cannot recover message audit
java.io.InvalidClassException: org.apache.activemq.util.BitArrayBin; incompatible types &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; field firstIndex
	at java.io.ObjectStreamClass.matchFields(ObjectStreamClass.java:2254)
	at java.io.ObjectStreamClass.getReflector(ObjectStreamClass.java:2149)
	at java.io.ObjectStreamClass.initNonProxy(ObjectStreamClass.java:657)
	at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1622)
	at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1517)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1771)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1350)
	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:370)
	at java.util.HashMap.readObject(HashMap.java:1180)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at java.io.ObjectStreamClass.invokeReadObject(ObjectStreamClass.java:1017)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1893)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1798)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1350)
	at java.io.ObjectInputStream.defaultReadFields(ObjectInputStream.java:1990)
	at java.io.ObjectInputStream.readSerialData(ObjectInputStream.java:1915)
	at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1798)
	at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1350)
	at java.io.ObjectInputStream.readObject(ObjectInputStream.java:370)
	at org.apache.activemq.store.kahadb.MessageDatabase.recoverProducerAudit(MessageDatabase.java:692)
	at org.apache.activemq.store.kahadb.MessageDatabase.recover(MessageDatabase.java:595)
	at org.apache.activemq.store.kahadb.MessageDatabase.open(MessageDatabase.java:400)
	at org.apache.activemq.store.kahadb.MessageDatabase.load(MessageDatabase.java:418)
	at org.apache.activemq.store.kahadb.MessageDatabase.doStart(MessageDatabase.java:262)
	at org.apache.activemq.store.kahadb.KahaDBStore.doStart(KahaDBStore.java:204)
	at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:55)
	at org.apache.activemq.store.kahadb.KahaDBPersistenceAdapter.doStart(KahaDBPersistenceAdapter.java:223)
	at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:55)
	at org.apache.activemq.broker.BrokerService.doStartPersistenceAdapter(BrokerService.java:642)
	at org.apache.activemq.broker.BrokerService.startPersistenceAdapter(BrokerService.java:631)
	at org.apache.activemq.broker.BrokerService.start(BrokerService.java:596)
	at org.apache.activemq.broker.Main.main(Main.java:50)
2014-08-05 15:24:08,000 [main           ] - INFO  MessageDatabase                - Recovering from the journal ...
2014-08-05 15:24:09,639 [main           ] - INFO  MessageDatabase                - @8:3797562, 100000 entries recovered ..
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; which is fairly ugly.&lt;/p&gt;</comment>
                            <comment id="14087709" author="gtully" created="Wed, 6 Aug 2014 14:23:09 +0000"  >&lt;p&gt;add long field so that existing serialized records can be read.&lt;br/&gt;
&lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/activemq/commit/58ae402b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/activemq/commit/58ae402b&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15496523" author="wangqinghuan" created="Fri, 16 Sep 2016 15:00:31 +0000"  >&lt;p&gt;I downloaded activemq 5.11.0 source.jar, i found the only change is that firstIndex is declared as long type. Then  I run the example :&lt;/p&gt;
 &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) {
       BitArrayBin toTest = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BitArrayBin(1024);
       &lt;span class=&quot;code-comment&quot;&gt;//I  commented out the following code
&lt;/span&gt;       &lt;span class=&quot;code-comment&quot;&gt;//toTest.setBit(1, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);       
&lt;/span&gt;       &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; largeNum = &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE*2L +100L;
       toTest.setBit(largeNum, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
       &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(toTest.getBit(largeNum));   
	  
   }
    &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the result  of running the above code is &quot;false&quot;.  I expect the results to be true,but I got a false&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12765039">AMQ-5507</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12765039">AMQ-5507</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12626678" name="BitArrayBinTest.java" size="427" author="susu119" created="Mon, 3 Feb 2014 16:42:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>371484</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1s0tj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>371787</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>