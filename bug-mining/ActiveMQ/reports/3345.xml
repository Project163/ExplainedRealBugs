<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:50:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-8023] Network bridge shutdown, race on MQTT virtual topic clean session and resubscribe</title>
                <link>https://issues.apache.org/jira/browse/AMQ-8023</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;With MQTT clients using virtual topic subscriptions and clean session. In a network of brokers when the remove destination operations are bridged, it is possible for the re-subscribe to beat the removeDestination advisory and cause the remove to fail with an error, causing the bridge to fail. The advisories are in order, but are executed out of order on the remote network bridge, in error.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
WARN  | pool-16-thread-1 | Service   | ivemq.broker.TransportConnection  304 | 162 - org.apache.activemq.activemq-osgi | Async error occurred: javax.jms.JMSException: Destination still has an active subscription: queue:&lt;span class=&quot;code-comment&quot;&gt;//Consumer.340601550021719:AT_LEAST_ONCE.VirtualTopic.IMPORTANT.&amp;gt;
&lt;/span&gt;INFO  | Task-310 | DemandForwardingBridgeSupport    | rk.DemandForwardingBridgeSupport  908 | 162 - org.apache.activemq.activemq-osgi | Network connection between vm:&lt;span class=&quot;code-comment&quot;&gt;//AMQ1 and ssl:///x.x.x:x shutdown due to a local error: javax.jms.JMSException: Destination still has an active subscription: queue://Consumer.340601550021719:AT_LEAST_ONCE.VirtualTopic.IMPORTANT.&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; Two necessary config options:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;networkConnector destinationFilter=&quot;ActiveMQ.Advisory.Consumer.Queue.&amp;gt;,ActiveMQ.Advisory.Queue&quot;&lt;/li&gt;
	&lt;li&gt;&amp;amp;transport.subscriptionStrategy=mqtt-virtual-topic-subscriptions&lt;/li&gt;
&lt;/ol&gt;
</description>
                <environment></environment>
        <key id="13324451">AMQ-8023</key>
            <summary>Network bridge shutdown, race on MQTT virtual topic clean session and resubscribe</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Aug 2020 11:30:07 +0000</created>
                <updated>Fri, 28 Aug 2020 08:17:00 +0000</updated>
                            <resolved>Fri, 28 Aug 2020 08:16:59 +0000</resolved>
                                    <version>5.16.0</version>
                                    <fixVersion>5.17.0</fixVersion>
                                    <component>MQTT</component>
                    <component>Network of Brokers</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17184158" author="jira-bot" created="Tue, 25 Aug 2020 15:57:11 +0000"  >&lt;p&gt;Commit 0e2b24be3652eb225fb0a758d373f086000fd72b in activemq&apos;s branch refs/heads/master from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=0e2b24b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=0e2b24b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8023&quot; title=&quot;Network bridge shutdown, race on MQTT virtual topic clean session and resubscribe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8023&quot;&gt;&lt;del&gt;AMQ-8023&lt;/del&gt;&lt;/a&gt; - serialize sub add with destination removal advisory processing to avoid resub blocking a necessary purge via removal, fix and test via mqtt clean session scenario&lt;/p&gt;</comment>
                            <comment id="17184164" author="gtully" created="Tue, 25 Aug 2020 16:04:24 +0000"  >&lt;p&gt;Use of the serial executor keeps the advisory processing in order, they were already serialised but unordered via the local transport.&lt;/p&gt;</comment>
                            <comment id="17185196" author="jira-bot" created="Wed, 26 Aug 2020 13:40:06 +0000"  >&lt;p&gt;Commit c0e6d47121c1fdf81ab86fb4272464219f947141 in activemq&apos;s branch refs/heads/master from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=c0e6d47&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=c0e6d47&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8023&quot; title=&quot;Network bridge shutdown, race on MQTT virtual topic clean session and resubscribe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8023&quot;&gt;&lt;del&gt;AMQ-8023&lt;/del&gt;&lt;/a&gt; - retain sync add call, duplicate sub suppression depends on it, regression in AMQ3274Test&lt;/p&gt;</comment>
                            <comment id="17185449" author="gtully" created="Wed, 26 Aug 2020 20:09:20 +0000"  >&lt;p&gt;There is another problem in&#160;AMQ2439Test that suggests the fix for the&#160;AMQ3274Test regression is not correct &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&#160;- on it.&lt;/p&gt;</comment>
                            <comment id="17186028" author="jira-bot" created="Thu, 27 Aug 2020 18:09:45 +0000"  >&lt;p&gt;Commit 5c8086961fb9e052e30a5846e6b738267de7c4a0 in activemq&apos;s branch refs/heads/master from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=5c80869&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=5c80869&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8023&quot; title=&quot;Network bridge shutdown, race on MQTT virtual topic clean session and resubscribe&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8023&quot;&gt;&lt;del&gt;AMQ-8023&lt;/del&gt;&lt;/a&gt; - rework fix to deal with addSub interleaved with removeDestination advisory processing, serialise add/remove dest such that add is not lost and new sub resubscribes ok, extra verifications in the test&lt;/p&gt;</comment>
                            <comment id="17186373" author="gtully" created="Fri, 28 Aug 2020 08:17:00 +0000"  >&lt;p&gt;dealing with possible addSub before removal works best; leaving add sub sync. However both add/remove dest processing needed to be serialised to ensure add was not lost!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0i2iw:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>