<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:43:39 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2487] MemoryUsage not properly accounted for when expiring messages to DLQ: can lead to hang.</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2487</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Given the following broker destination policy&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt; 
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;destinationPolicy&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;policyMap&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;policyEntries&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;policyEntry topic=&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&lt;/span&gt;&quot;&lt;/span&gt; producerFlowControl=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt;
            memoryLimit=&lt;span class=&quot;code-quote&quot;&gt;&quot;1mb&quot;&lt;/span&gt;&amp;gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;pendingSubscriberPolicy&amp;gt;&lt;/span&gt;
              &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;vmCursor /&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/pendingSubscriberPolicy&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/policyEntry&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;policyEntry queue=&lt;span class=&quot;code-quote&quot;&gt;&quot;&amp;gt;&lt;/span&gt;&quot;&lt;/span&gt; producerFlowControl=&lt;span class=&quot;code-quote&quot;&gt;&quot;true&quot;&lt;/span&gt;
            memoryLimit=&lt;span class=&quot;code-quote&quot;&gt;&quot;1mb&quot;&lt;/span&gt;&amp;gt;
            &amp;lt;!--
              Use VM cursor for better latency For more information,
              see: http://activemq.apache.org/message-cursors.html
            --&amp;gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;pendingQueuePolicy&amp;gt;&lt;/span&gt;
              &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;vmQueueCursor /&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/pendingQueuePolicy&amp;gt;&lt;/span&gt;
          &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/policyEntry&amp;gt;&lt;/span&gt;
        &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/policyEntries&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/policyMap&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/destinationPolicy&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I send message to queue://TESTQ1 with an expiration of 1second, with an unreliable/slow receiver, the publisher eventually hangs sending to the queue. The underlying problem is that when the message is expired to the DLQ the MemoryUsage reference is left pointing the TESTQ1&apos;s memory limiter, instead of being reset to the DLQ limiter, and when it is added to the DLQ, TESTQ1&apos;s memory limiter is updated counteracting the decrement that is done by the TESTQ1 when the message is expired. &lt;/p&gt;</description>
                <environment>&lt;p&gt;N/A&lt;/p&gt;</environment>
        <key id="12483091">AMQ-2487</key>
            <summary>MemoryUsage not properly accounted for when expiring messages to DLQ: can lead to hang.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="cmacnaug">Colin MacNaughton</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Nov 2009 07:45:21 +0000</created>
                <updated>Thu, 19 Nov 2009 10:36:55 +0000</updated>
                            <resolved>Thu, 19 Nov 2009 10:36:55 +0000</resolved>
                                    <version>5.3.0</version>
                                    <fixVersion>5.3.1</fixVersion>
                    <fixVersion>5.4.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12941801" author="cmacnaug" created="Thu, 12 Nov 2009 07:48:04 +0000"  >&lt;p&gt;Patch file attached. It is worth investigating if there are other problematic scenarios where BrokerRegion.doResend might be using the wrong MemoryUsage&lt;/p&gt;</comment>
                            <comment id="12941599" author="gtully" created="Thu, 12 Nov 2009 10:44:49 +0000"  >&lt;p&gt;resolve in r835325, modified an existing test to verify.&lt;/p&gt;</comment>
                            <comment id="12941532" author="gtully" created="Thu, 12 Nov 2009 17:03:43 +0000"  >&lt;p&gt;moveMessages and other jmx operations seem to suffer from the same memory usage reuse issue. need to track those down and fix them before closing this.&lt;/p&gt;</comment>
                            <comment id="12941840" author="gtully" created="Thu, 19 Nov 2009 10:36:55 +0000"  >&lt;p&gt;resolved in r882096 - some more validation of memory usage and fix issue with storequeuecursor and browse effecting memory usage.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461447" name="AMQ-2487patch.txt" size="678" author="cmacnaug" created="Thu, 12 Nov 2009 07:48:04 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74923</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 1 week, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rqkv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>159950</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>