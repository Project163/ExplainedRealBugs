<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:05:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5269] NIO transports using blocking accept calls, very slow shutdown</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5269</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>
&lt;p&gt;Currently, all the TCP based transports are using the old blocking style of socket.accept() to accept connections.   This works &quot;OK&quot; except that for sockets that have a channel associated with them, the socket.close() doesn&apos;t cause it to return immediately.  It still waits for the SoTimeout which is currently set a 2 seconds.   That can cause 2 second delays for any shutdown which causes long, unnecessary delays, particularly in the tests.&lt;/p&gt;

&lt;p&gt;One possible &quot;fix&quot; is to drop the socket.setSoTimeout(2000) call to something much smaller.   However, that would turn the accept thread into a more &quot;busy wait&quot; scenario which is undesirable.&lt;/p&gt;

&lt;p&gt;A better fix is to change the accepts for the sockets that have a ServerSocketChannel to use the NIO based selectors for the accept operations.   The selector.disable()/selector.close() allows the socket and everything to close immediately.  The result is that the NIO based tests now take the same amount of time as the non-NIO based tests (for which socket.close() causes the accept to return immediately).&lt;/p&gt;

&lt;p&gt;Pull request forthcoming.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12726598">AMQ-5269</key>
            <summary>NIO transports using blocking accept calls, very slow shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dkulp">Daniel Kulp</assignee>
                                    <reporter username="dkulp">Daniel Kulp</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Jul 2014 14:55:48 +0000</created>
                <updated>Thu, 10 Jul 2014 20:38:47 +0000</updated>
                            <resolved>Thu, 10 Jul 2014 20:34:03 +0000</resolved>
                                    <version>5.10.0</version>
                                    <fixVersion>5.11.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14057645" author="dkulp" created="Thu, 10 Jul 2014 16:34:07 +0000"  >&lt;p&gt;Attaching a patch for now as my &quot;git&quot; stuff is in a bit of a mess and I need to clean that up.   &lt;/p&gt;</comment>
                            <comment id="14057830" author="githubbot" created="Thu, 10 Jul 2014 19:22:53 +0000"  >&lt;p&gt;GitHub user dkulp opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/33&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/33&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5269&quot; title=&quot;NIO transports using blocking accept calls, very slow shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5269&quot;&gt;&lt;del&gt;AMQ-5269&lt;/del&gt;&lt;/a&gt; Update NIO based transports to use a Select mechanism&lt;/p&gt;

&lt;p&gt;    Update NIO based transports to use a Select mechanism for the accepts instead of the blocking select.&lt;/p&gt;

&lt;p&gt;    Cuts about 10 minutes off the activemq-stomp tests, drops the NIO test execution time down to equal to the non-NIO based tests.&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/dkulp/activemq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/dkulp/activemq&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5269&quot; title=&quot;NIO transports using blocking accept calls, very slow shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5269&quot;&gt;&lt;del&gt;AMQ-5269&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/33.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/33.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #33&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 52ef9745d9bafbeab940ed4937c014be3abc9655&lt;br/&gt;
Author: Daniel Kulp &amp;lt;dkulp@apache.org&amp;gt;&lt;br/&gt;
Date:   2014-07-10T14:57:44Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5269&quot; title=&quot;NIO transports using blocking accept calls, very slow shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-5269&quot;&gt;&lt;del&gt;AMQ-5269&lt;/del&gt;&lt;/a&gt; Update NIO based transports to use a Select mechanism for the accepts instead of the blocking select.&lt;br/&gt;
    Cuts about 10 minutes off the activemq-stomp tests, drops the NIO test execution time down to equal to the non-NIO based tests.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="14057831" author="dkulp" created="Thu, 10 Jul 2014 19:24:05 +0000"  >&lt;p&gt;On my Mac:&lt;/p&gt;

&lt;p&gt;Before:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Running org.apache.activemq.transport.stomp.Stomp11NIOSSLTest
Tests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 126.509 sec - in org.apache.activemq.transport.stomp.Stomp11NIOSSLTest
Running org.apache.activemq.transport.stomp.Stomp11NIOTest
Tests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 124.051 sec - in org.apache.activemq.transport.stomp.Stomp11NIOTest
Running org.apache.activemq.transport.stomp.Stomp11SslAuthTest
Tests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 73.105 sec - in org.apache.activemq.transport.stomp.Stomp11SslAuthTest
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Running org.apache.activemq.transport.stomp.Stomp11NIOSSLTest
Tests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 71.824 sec - in org.apache.activemq.transport.stomp.Stomp11NIOSSLTest
Running org.apache.activemq.transport.stomp.Stomp11NIOTest
Tests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 70.408 sec - in org.apache.activemq.transport.stomp.Stomp11NIOTest
Running org.apache.activemq.transport.stomp.Stomp11SslAuthTest
Tests run: 27, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 72.747 sec - in org.apache.activemq.transport.stomp.Stomp11SslAuthTest
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14057864" author="tabish121" created="Thu, 10 Jul 2014 20:01:32 +0000"  >&lt;p&gt;Reviewed and ran a bunch of the tests here and everything seems good, can commit if you are satisfied with the current changeset&lt;/p&gt;</comment>
                            <comment id="14057917" author="tabish121" created="Thu, 10 Jul 2014 20:34:03 +0000"  >&lt;p&gt;Fixed on trunk, thanks.&lt;/p&gt;</comment>
                            <comment id="14057927" author="githubbot" created="Thu, 10 Jul 2014 20:38:47 +0000"  >&lt;p&gt;Github user dkulp closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/33&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/33&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12655028" name="AMQ-5269.patch" size="9502" author="dkulp" created="Thu, 10 Jul 2014 16:34:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>404705</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 19 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xnfb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>404743</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>