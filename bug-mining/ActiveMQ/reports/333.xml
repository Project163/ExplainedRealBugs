<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:36:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-765] ActiveMQ RA serialization issue on Glassfish</title>
                <link>https://issues.apache.org/jira/browse/AMQ-765</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I&apos;ve been trying to work through an issue with a NullPointerException run using the JCA 1.5 resource adapter on Glassfish.  In the course of debugging, Siva from the Glassfish team provided this information:&lt;/p&gt;

&lt;p&gt;&quot;Thanks for trying out GlassFish. Since I have only the trace snippet above, I tried to debug this problem by going through ActiveMQ RA&apos;s source available at &lt;a href=&quot;https://svn.apache.org/repos/asf/incubator/activemq/trunk/activemq-ra/src/main/java/org/apache/activemq/ra/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/incubator/activemq/trunk/activemq-ra/src/main/java/org/apache/activemq/ra/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is what I understand happens. Please correct me if there are errors. When ActiveMQConnectionFactory &lt;a href=&quot;https://svn.apache.org/repos/asf/incubator/activemq/trunk/activemq-ra/src/main/java/org/apache/activemq/ra/ActiveMQConnectionFactory.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/incubator/activemq/trunk/activemq-ra/src/main/java/org/apache/activemq/ra/ActiveMQConnectionFactory.java&lt;/a&gt; is created at the createConnectionFactory method of &lt;a href=&quot;https://svn.apache.org/repos/asf/incubator/activemq/trunk/activemq-ra/src/main/java/org/apache/activemq/ra/ActiveMQManagedConnectionFactory.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://svn.apache.org/repos/asf/incubator/activemq/trunk/activemq-ra/src/main/java/org/apache/activemq/ra/ActiveMQManagedConnectionFactory.java&lt;/a&gt;, the ConnectionManager is initialized to a &lt;b&gt;transient&lt;/b&gt; variable &quot;manager&quot;. Since ConnectionFactory instances can be serialized/deserialized while publishing to JNDI (as is the case in Project GlassFish), the connectionManager reference is lost and hence the NPE. The fix ideally should be in the ActiveMQRA&apos;s code. You could copy me &lt;span class=&quot;error&quot;&gt;&amp;#91;sivakumart AT sun DOT com&amp;#93;&lt;/span&gt; while you are discussing this with ActiveMQ, if you wish. If you still have any issues, please provide a copy of your domain.xml &lt;span class=&quot;error&quot;&gt;&amp;#91;connector connection pool, resource configuratin information&amp;#93;&lt;/span&gt; and the entire trace in server.log.&quot; &lt;/p&gt;</description>
                <environment>&lt;p&gt;Glassfish&lt;/p&gt;</environment>
        <key id="12482131">AMQ-765</key>
            <summary>ActiveMQ RA serialization issue on Glassfish</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                            <parent id="12482373">AMQ-1696</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="rhavyn">Chris Conrad</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Jun 2006 00:09:17 +0000</created>
                <updated>Mon, 28 Apr 2008 16:56:38 +0000</updated>
                            <resolved>Tue, 12 Feb 2008 13:10:55 +0000</resolved>
                                    <version>4.0</version>
                    <version>4.0.1</version>
                                    <fixVersion>5.1.0</fixVersion>
                                    <component>Connector</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12938156" author="rhavyn" created="Wed, 21 Jun 2006 00:10:19 +0000"  >&lt;p&gt;The mailing list discussion related to this issue can be found at: &lt;a href=&quot;http://www.nabble.com/NullPointerException-with-RA-on-Glassfish-t1814940.html#a4959128&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.nabble.com/NullPointerException-with-RA-on-Glassfish-t1814940.html#a4959128&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12938390" author="zombiepeanutbutter" created="Fri, 6 Oct 2006 18:32:53 +0000"  >&lt;p&gt;The same thing happens on oracle (oc4j) 10.1.3, except that I am using ActiveMQTopicConnectionFactory, instead of the managed connection factory.&lt;br/&gt;
Same error, same line.&lt;/p&gt;

&lt;p&gt;Details:&lt;br/&gt;
-I deploy the resource adapter exactly as it comes packaged in v4.0.1&lt;br/&gt;
-I&apos;m using an external broker, running on the same machine.&lt;br/&gt;
-I create one topic connection factory&lt;br/&gt;
-I create one topic&lt;/p&gt;

&lt;p&gt;In the code, the context lookups for the topics go through just fine (the objects are found), but upon calling factory.createTopicConnection(), I get the NPE.  Setting UseInboundSession to true lets this go through just fine, but I&apos;m not writing a message driven bean, so this doesn&apos;t help me out very much.&lt;/p&gt;</comment>
                            <comment id="12936529" author="jstrachan" created="Tue, 12 Jun 2007 14:51:21 +0000"  >&lt;p&gt;Does anyone know if this is still an issue with 4.1.1 or 5.0.0?&lt;/p&gt;</comment>
                            <comment id="12938952" author="michalk" created="Tue, 6 Nov 2007 23:31:57 +0000"  >&lt;p&gt;It is still an issue in 4.1.1. &lt;/p&gt;</comment>
                            <comment id="12938921" author="michalk" created="Tue, 6 Nov 2007 23:35:12 +0000"  >&lt;p&gt;The exception log I get on ActiveMQ 4.1.1  with&lt;br/&gt;
Sun Java System Application Server 9.1 (build b58g-fcs)&lt;/p&gt;</comment>
                            <comment id="12939214" author="michalk" created="Wed, 7 Nov 2007 15:29:52 +0000"  >&lt;p&gt;After further investigation :&lt;/p&gt;

&lt;p&gt;In version 4.1.1 the manager is not transient and not null, but I think I am getting the same error with the transient managed connection factory. &lt;/p&gt;

&lt;p&gt;Everything starts here:&lt;/p&gt;

&lt;p&gt;        @Resource(mappedName = &quot;jms/UserUpdateConnectionFactory&quot;)&lt;br/&gt;
	private ConnectionFactory jmsConnectionFactory;&lt;/p&gt;

&lt;p&gt;	@PostConstruct&lt;br/&gt;
	public void jmsConfigure()&lt;br/&gt;
	{&lt;/p&gt;
                        {....}&lt;br/&gt;
			jmsConnection = jmsConnectionFactory.createConnection(); //at this point the jmsConnectionFactory is of class ActiveMQConnectionFactory but it&apos;s managed connection factory is null&lt;br/&gt;
                         {....}
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;Iam not sure if this because I didnt configure something or because of the fact that managed connection factory is transient.&lt;/p&gt;

&lt;p&gt;after calling ActiveMQConnectionFactory.createConnection the null mcf is passed to ConnectionManagerImpl.allocateConnection.&lt;br/&gt;
(&lt;a href=&quot;http://fisheye5.cenqua.com/browse/glassfish/appserv-core/src/java/com/sun/enterprise/connectors/ConnectionManagerImpl.java?r=1.6#l231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fisheye5.cenqua.com/browse/glassfish/appserv-core/src/java/com/sun/enterprise/connectors/ConnectionManagerImpl.java?r=1.6#l231&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;in this method there is a check:&lt;/p&gt;

&lt;p&gt;if(_logger.isLoggable(Level.INFO)){&lt;br/&gt;
            if (! freshMCF.equals(mcf)) &lt;/p&gt;
{
                _logger.info(&quot;conmgr.mcf_not_equal&quot;);
            }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;the fresh mcf retrieved from pool meta data PoolMetaData pmd = registry.getPoolMetaData( poolName );   ManagedConnectionFactory freshMCF = pmd.getMCF(); is a proper activemq mcf but the value is used only for logging purposes: &lt;/p&gt;

&lt;p&gt;this conmgr.mcf_not_equal translates to The mcf being used to allocate the connection and the MCF in the pool are not equal. in the attached log-finest.txt log file.&lt;/p&gt;

&lt;p&gt;Finally when ConnectorAllocator.createResource method is called the mcf is null :&lt;br/&gt;
&lt;a href=&quot;http://fisheye5.cenqua.com/browse/glassfish/appserv-core/src/java/com/sun/enterprise/resource/ConnectorAllocator.java?r=1.6#l136&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fisheye5.cenqua.com/browse/glassfish/appserv-core/src/java/com/sun/enterprise/resource/ConnectorAllocator.java?r=1.6#l136&lt;/a&gt;&lt;/p&gt;




</comment>
                            <comment id="12939325" author="hudalla" created="Mon, 24 Dec 2007 16:33:49 +0000"  >&lt;p&gt;I have tried to work around the problem described by Michal by simply declaring the factory property of ActiveMQConnectionFactory to not be transient. However, after running my test driver for accessing a ConnectionFactory managed by the ActiveMQ RA, I ran into the following problem:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.RuntimeException: Cant copy Serializable object:&lt;br/&gt;
        at com.sun.enterprise.naming.NamingUtils.makeCopyOfObject(NamingUtils.java:82)&lt;br/&gt;
        at com.sun.enterprise.naming.NamingManagerImpl.lookup(NamingManagerImpl.java:842)&lt;br/&gt;
        at com.sun.enterprise.naming.java.javaURLContext.lookup(javaURLContext.java:173)&lt;br/&gt;
        ... 66 more&lt;br/&gt;
Caused by: java.io.NotSerializableException: com.sun.enterprise.connectors.BootstrapContextImpl&lt;br/&gt;
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1156)&lt;br/&gt;
        at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1509)&lt;br/&gt;
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1474)&lt;br/&gt;
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)&lt;br/&gt;
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)&lt;br/&gt;
        at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1509)&lt;br/&gt;
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1474)&lt;br/&gt;
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)&lt;br/&gt;
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)&lt;br/&gt;
        at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1509)&lt;br/&gt;
        at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1474)&lt;br/&gt;
        at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1392)&lt;br/&gt;
        at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1150)&lt;br/&gt;
        at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:326)&lt;br/&gt;
        at com.sun.enterprise.naming.NamingUtils.makeCopyOfObject(NamingUtils.java:64)&lt;br/&gt;
        ... 68 more&lt;/p&gt;


&lt;p&gt;After having spent some time looking at the RA source code of version 5.0.0 my feeling is that the ActiveMQManagedConnectionFactory violates the javax.resource.spi.ManagedConnectionFactory contract because it is not Serializable.&lt;/p&gt;

&lt;p&gt; ActiveMQManagedConnectionFactory has a property of type org.apache.activemq.ra.MessageResourceAdapter which extends the javax.resource.spi.ResourceAdapter interface which itself does NOT extend Serializable, i.e. implementors are not required to be serializable. The ActiveMQResourceAdapter implementing the MessageResourceAdapter interface, however, claims to be serializable but does have a property of type javax.resource.spi.BootstrapContext. But BootstrapContext implementations are not required to be Serializable. In case of glassfish the passed in com.sun.enterprise.connectors.BootstrapContextImpl class is NOT serializable.&lt;/p&gt;

&lt;p&gt;Therefore, declaring the factory property to NOT be transient is not working because ActiveMQManagedConnectionFactory is not serializable as mandated by the JCA spec.&lt;/p&gt;

&lt;p&gt;Any thoughts?&lt;/p&gt;

&lt;p&gt;Kai&lt;/p&gt;</comment>
                            <comment id="12939089" author="hudalla" created="Mon, 14 Jan 2008 15:49:40 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I have spent some time fixing the Resource Adapter&apos;s serialization issue in order to make it work in glassfish v2. Therefore I made some changes to ActiveMQConnectionFactory, ActiveMQManagedConnectionFactory and ActiveMQResourceAdapter. I have also created additional test cases and updated the existing ones to reflect my changes. I have successfully tested it in my local environment using glassfish v2 and v2 UR1 on JDK 1.5.0_14. I have also attached a patch for the 5.1 SNAPSHOT code in SVN. Could someone test it against Geronimo in order to see if it&apos;s still working there?&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Kai&lt;/p&gt;</comment>
                            <comment id="12939093" author="hudalla" created="Mon, 14 Jan 2008 15:50:23 +0000"  >&lt;p&gt;Patch to fix serialization issue on glassfish.&lt;/p&gt;</comment>
                            <comment id="12939021" author="hudalla" created="Tue, 12 Feb 2008 13:09:49 +0000"  >&lt;p&gt;Already fixed in 5.1 instead of 5.2&lt;/p&gt;</comment>
                            <comment id="12939036" author="hudalla" created="Tue, 12 Feb 2008 13:10:55 +0000"  >&lt;p&gt;Resource Adapter has been fixed to support serialization of RA components as performed by glasfish.&lt;/p&gt;</comment>
                            <comment id="12939466" author="gdaswani" created="Tue, 1 Apr 2008 07:59:28 +0000"  >&lt;p&gt;Is this problem really fixed on the latest 5.1 snapshots?  I tried the 03/29/08 5.1-SNAPSHOT but I&apos;m still running into the following error&lt;/p&gt;

&lt;p&gt;---------------------- CUT -------------------&lt;br/&gt;
javax.jms.JMSException: Error in allocating a connection. Cause: null&lt;br/&gt;
	at org.apache.activemq.ra.ActiveMQConnectionFactory.createConnection(ActiveMQConnectionFactory.java:98)&lt;br/&gt;
	at org.apache.activemq.ra.ActiveMQConnectionFactory.createConnection(ActiveMQConnectionFactory.java:64)&lt;br/&gt;
---------------------- CUT -------------------&lt;/p&gt;

&lt;p&gt;when trying to use outbound connections&lt;/p&gt;</comment>
                            <comment id="12939574" author="rajdavies" created="Wed, 16 Apr 2008 15:46:03 +0000"  >&lt;p&gt;Applied patch to trunk - in SVN Committed revision 648727&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461063" name="ASF.LICENSE.NOT.GRANTED--RA.patch" size="54952" author="hudalla" created="Mon, 14 Jan 2008 15:50:23 +0000"/>
                            <attachment id="12461014" name="finest-log.txt" size="7359" author="michalk" created="Wed, 7 Nov 2007 15:29:52 +0000"/>
                            <attachment id="12460947" name="log.txt" size="4049" author="michalk" created="Tue, 6 Nov 2007 23:35:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84335</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s1j3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161724</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>