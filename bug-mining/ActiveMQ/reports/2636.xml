<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:22:18 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5960] Durable subscriber pendingQueueSize wrong after force shutdown of the broker</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5960</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;The main reason for this is that ackPositions (based on which pendingQueueSize is calculated) is not rebuilt correctly during index recover.&lt;/p&gt;

&lt;p&gt;To reproduce it:&lt;br/&gt;
1. Start the broker&lt;br/&gt;
2. Start producer and durable consumer on a topic, making a load&lt;br/&gt;
3. Kill the broker with -9&lt;br/&gt;
4. Restart the broker&lt;/p&gt;

&lt;p&gt;The durable consumer pendingQueueSize is off by one and is never corrected&lt;/p&gt;</description>
                <environment></environment>
        <key id="12862989">AMQ-5960</key>
            <summary>Durable subscriber pendingQueueSize wrong after force shutdown of the broker</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dejanb">Dejan Bosanac</assignee>
                                    <reporter username="dejanb">Dejan Bosanac</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Sep 2015 09:09:13 +0000</created>
                <updated>Thu, 16 May 2019 11:59:42 +0000</updated>
                            <resolved>Thu, 10 Sep 2015 09:16:15 +0000</resolved>
                                    <version>5.12.0</version>
                                    <fixVersion>5.13.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14738458" author="jira-bot" created="Thu, 10 Sep 2015 09:10:44 +0000"  >&lt;p&gt;Commit 4ab55f13ae4097de1dad14af36b65a89eda9b81d in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dejanb&quot; class=&quot;user-hover&quot; rel=&quot;dejanb&quot;&gt;dejanb&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4ab55f1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4ab55f1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5960&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5960&lt;/a&gt; - durable sub pendingQueueSize after force shutdown&lt;/p&gt;</comment>
                            <comment id="14738619" author="christopher.l.shannon" created="Thu, 10 Sep 2015 11:49:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dejanb&quot; class=&quot;user-hover&quot; rel=&quot;dejanb&quot;&gt;dejanb&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;Looks like your patch caused this failure:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/view/All/job/ActiveMQ-Java8/org.apache.activemq$activemq-kahadb-store/471/testReport/junit/org.apache.activemq.store.kahadb/JournalCorruptionEofIndexRecoveryTest/testRecoverIndex/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/view/All/job/ActiveMQ-Java8/org.apache.activemq$activemq-kahadb-store/471/testReport/junit/org.apache.activemq.store.kahadb/JournalCorruptionEofIndexRecoveryTest/testRecoverIndex/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Probably just need a null check added.&lt;/p&gt;</comment>
                            <comment id="14738642" author="jira-bot" created="Thu, 10 Sep 2015 12:14:02 +0000"  >&lt;p&gt;Commit f4a2543def0d7240fc97f850a53f6be48dc74562 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dejanb&quot; class=&quot;user-hover&quot; rel=&quot;dejanb&quot;&gt;dejanb&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=f4a2543&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=f4a2543&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5960&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5960&lt;/a&gt; - durable sub pendingQueueSize after force shutdown - fix npe test failure&lt;/p&gt;</comment>
                            <comment id="14738644" author="dejanb" created="Thu, 10 Sep 2015 12:16:17 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;! I missed that, it should be OK now.&lt;/p&gt;</comment>
                            <comment id="14904413" author="jira-bot" created="Wed, 23 Sep 2015 12:15:50 +0000"  >&lt;p&gt;Commit fcabcd282dc01c6faaff3c7627882f42a64543b4 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=fcabcd2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=fcabcd2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5960&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5960&lt;/a&gt; - rework fix to reset the next sequence so that the next ack position and message reference gets cleared up in normal operation&lt;/p&gt;</comment>
                            <comment id="15956982" author="jreock" created="Wed, 5 Apr 2017 14:58:57 +0000"  >&lt;p&gt;I don&apos;t believe this issue is fixed, it is still reproducible in 5.14.4.  Same test case, create durable subs with persistent messages, connect consumers and start draining.  Hard-kill the broker and restart it, allow consumers to drain.  There will be &quot;lingering&quot; pendingQueueSize counts, although there is no actual message loss.  KahaDB just doesn&apos;t update the ack position.  Tested with LevelDB and cannot recreate, this only happens with Kaha.&lt;/p&gt;</comment>
                            <comment id="16841246" author="gtully" created="Thu, 16 May 2019 11:59:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jreock&quot; class=&quot;user-hover&quot; rel=&quot;jreock&quot;&gt;jreock&lt;/a&gt; I was investigating a similar issue just now, it looks like the fix for&#160;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7129&quot; title=&quot;Durable subscription messages can be orphaned when using individual ack mode with KahaDB&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7129&quot;&gt;&lt;del&gt;AMQ-7129&lt;/del&gt;&lt;/a&gt; and its dependent &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7091&quot; title=&quot;O(n) Memory consumption when broker has inactive durable subscribes causing OOM&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7091&quot;&gt;&lt;del&gt;AMQ-7091&lt;/del&gt;&lt;/a&gt; fully resolves this issue, they are in 5.15.9&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13196142">AMQ-7091</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="13208618">AMQ-7129</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jzhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>