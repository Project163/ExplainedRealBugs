<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:34:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1246] Sporatic ArrayOutOfBoundsException with Kaha persistence (in org.apache.activemq.kaha.impl.index.hash.HashPage.addHashEntry)</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1246</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;This error just started occurring after restarting activemq after its memory got fairly high (we&apos;ve been running our app with this same ActiveMQ 4.2 build for several months without ever seeing this).  It&apos;s happening on a persistent topic and doesn&apos;t happen after each message is added to the topic but happens every 20 - 30 messages (the occurrence isn&apos;t very consistent).&lt;/p&gt;

&lt;p&gt;java.lang.IndexOutOfBoundsException: Index: 25, Size: 22&lt;br/&gt;
        at java.util.ArrayList.add(ArrayList.java:368)&lt;br/&gt;
        at org.apache.activemq.kaha.impl.index.hash.HashPage.addHashEntry(HashPage.java:197)&lt;br/&gt;
        at org.apache.activemq.kaha.impl.index.hash.HashPageInfo.addHashEntry(HashPageInfo.java:65)&lt;br/&gt;
        at org.apache.activemq.kaha.impl.index.hash.HashBin.addHashEntry(HashBin.java:181)&lt;br/&gt;
        at org.apache.activemq.kaha.impl.index.hash.HashBin.put(HashBin.java:144)&lt;br/&gt;
        at org.apache.activemq.kaha.impl.index.hash.HashIndex.store(HashIndex.java:230)&lt;br/&gt;
        at org.apache.activemq.kaha.impl.container.MapContainerImpl.place(MapContainerImpl.java:389)&lt;br/&gt;
        at org.apache.activemq.store.kahadaptor.KahaTopicMessageStore.addMessage(KahaTopicMessageStore.java:62)&lt;br/&gt;
        at org.apache.activemq.store.kahadaptor.KahaTransactionStore.addMessage(KahaTransactionStore.java:133)&lt;br/&gt;
        at org.apache.activemq.store.kahadaptor.KahaTransactionStore$2.addMessage(KahaTransactionStore.java:68)&lt;br/&gt;
        at org.apache.activemq.broker.region.Topic.doMessageSend(Topic.java:349)&lt;br/&gt;
        at org.apache.activemq.broker.region.Topic.send(Topic.java:341)&lt;br/&gt;
        at org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:306)&lt;br/&gt;
        at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:407)&lt;br/&gt;
        at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:203)&lt;br/&gt;
        at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:127)&lt;br/&gt;
        at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:97)&lt;br/&gt;
        at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:137)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:474)&lt;br/&gt;
        at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:618)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:282)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:188)&lt;br/&gt;
        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:65)&lt;br/&gt;
        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:133)&lt;br/&gt;
        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:121)&lt;br/&gt;
        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:137)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:595)&lt;/p&gt;</description>
                <environment>&lt;p&gt;4.2-SNAPSHOT (build from 3/26/2007)&lt;/p&gt;</environment>
        <key id="12482117">AMQ-1246</key>
            <summary>Sporatic ArrayOutOfBoundsException with Kaha persistence (in org.apache.activemq.kaha.impl.index.hash.HashPage.addHashEntry)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="cwbrandon">Chad Brandon</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 May 2007 15:16:20 +0000</created>
                <updated>Fri, 2 Nov 2007 20:10:33 +0000</updated>
                            <resolved>Fri, 2 Nov 2007 07:25:03 +0000</resolved>
                                    <version>5.0.0</version>
                                    <fixVersion>5.0.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12936360" author="cwbrandon" created="Fri, 8 Jun 2007 22:59:13 +0000"  >&lt;p&gt;I&apos;m now consistently seeing this issue (in a build of 4.2-SNAPSHOT as of yesterday 6/7/2007 as well).    When I get around 200k messages into the topic (the consumer can&apos;t pull them off as fast as they are published) I start getting these errors consistently when I try to send any more messages.  The error even occurs after the consumer pulls all messages from the topic and there are no more messages waiting.   The only way to get rid of it (from what I can tell), is to delete the data in the $ACTIVEMQ_HOME/data directory and restart activemq.&lt;/p&gt;

&lt;p&gt;java.lang.IndexOutOfBoundsException: Index: 169, Size: 168&lt;br/&gt;
        at java.util.ArrayList.add(ArrayList.java:368)&lt;br/&gt;
        at org.apache.activemq.kaha.impl.index.hash.HashPage.addHashEntry(HashPage.java:197)&lt;br/&gt;
        at org.apache.activemq.kaha.impl.index.hash.HashPageInfo.addHashEntry(HashPageInfo.java:65)&lt;br/&gt;
        at org.apache.activemq.kaha.impl.index.hash.HashBin.addHashEntry(HashBin.java:181)&lt;br/&gt;
        at org.apache.activemq.kaha.impl.index.hash.HashBin.put(HashBin.java:144)&lt;br/&gt;
        at org.apache.activemq.kaha.impl.index.hash.HashIndex.store(HashIndex.java:230)&lt;br/&gt;
        at org.apache.activemq.kaha.impl.container.MapContainerImpl.place(MapContainerImpl.java:389)&lt;br/&gt;
        at org.apache.activemq.store.kahadaptor.KahaTopicMessageStore.addMessage(KahaTopicMessageStore.java:62)&lt;br/&gt;
        at org.apache.activemq.store.kahadaptor.KahaTransactionStore.addMessage(KahaTransactionStore.java:133)&lt;br/&gt;
        at org.apache.activemq.store.kahadaptor.KahaTransactionStore$2.addMessage(KahaTransactionStore.java:68)&lt;br/&gt;
        at org.apache.activemq.broker.region.Topic.doMessageSend(Topic.java:349)&lt;br/&gt;
        at org.apache.activemq.broker.region.Topic.send(Topic.java:341)&lt;br/&gt;
        at org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:306)&lt;br/&gt;
        at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:407)&lt;br/&gt;
        at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:203)&lt;br/&gt;
        at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:127)&lt;br/&gt;
        at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:97)&lt;br/&gt;
        at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:137)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:474)&lt;br/&gt;
        at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:618)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:282)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:188)&lt;br/&gt;
        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:65)&lt;br/&gt;
        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:133)&lt;br/&gt;
        at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:121)&lt;br/&gt;
        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:84)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:137)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:595)&lt;br/&gt;
2007-06-08 18:26:19,363 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;STDERR&amp;#93;&lt;/span&gt; Exception in thread &quot;pool-3-thread-1&quot;&lt;br/&gt;
2007-06-08 18:26:19,363 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;STDERR&amp;#93;&lt;/span&gt; javax.ejb.EJBException: java.lang.IndexOutOfBoundsException: Index: 169, Size: 168&lt;/p&gt;</comment>
                            <comment id="12936391" author="rajdavies" created="Mon, 30 Jul 2007 07:16:27 +0000"  >&lt;p&gt;This should now be fixed - there was an issue with hashcode resolution&lt;/p&gt;</comment>
                            <comment id="12939056" author="sachin_mittal" created="Mon, 27 Aug 2007 11:19:39 +0000"  >&lt;p&gt;Re-opening this issue.&lt;/p&gt;

&lt;p&gt;We still face the same issue and steps of reproductions are more or less same as described by the original filer.&lt;/p&gt;

&lt;p&gt;We are using activemq-5.0 snapshot dated 5th august 2007&lt;br/&gt;
Here is the latest stack trace:&lt;/p&gt;

&lt;p&gt;Caused by: java.lang.IndexOutOfBoundsException: Index: 163, Size: 162&lt;br/&gt;
	at java.util.ArrayList.add(Unknown Source)&lt;br/&gt;
	at org.apache.activemq.kaha.impl.index.hash.HashPage.addHashEntry(HashPage.java:191)&lt;br/&gt;
	at org.apache.activemq.kaha.impl.index.hash.HashPageInfo.addHashEntry(HashPageInfo.java:65)&lt;br/&gt;
	at org.apache.activemq.kaha.impl.index.hash.HashBin.addHashEntry(HashBin.java:192)&lt;br/&gt;
	at org.apache.activemq.kaha.impl.index.hash.HashBin.put(HashBin.java:151)&lt;br/&gt;
	at org.apache.activemq.kaha.impl.index.hash.HashIndex.store(HashIndex.java:230)&lt;br/&gt;
	at org.apache.activemq.kaha.impl.container.MapContainerImpl.put(MapContainerImpl.java:292)&lt;br/&gt;
	at org.apache.activemq.store.kahadaptor.KahaMessageStore.addMessage(KahaMessageStore.java:55)&lt;br/&gt;
	at org.apache.activemq.store.kahadaptor.KahaTransactionStore.addMessage(KahaTransactionStore.java:133)&lt;br/&gt;
	at org.apache.activemq.store.kahadaptor.KahaTransactionStore$1.addMessage(KahaTransactionStore.java:56)&lt;br/&gt;
	at org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:447)&lt;br/&gt;
	at org.apache.activemq.broker.region.Queue.send(Queue.java:436)&lt;br/&gt;
	at org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:305)&lt;br/&gt;
	at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:412)&lt;br/&gt;
	at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:220)&lt;br/&gt;
	at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:97)&lt;br/&gt;
	at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:136)&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:454)&lt;br/&gt;
	at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:617)&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:302)&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:206)&lt;br/&gt;
	at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:65)&lt;br/&gt;
	at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:133)&lt;br/&gt;
	at org.apache.activemq.transport.InactivityMonitor.onCommand(InactivityMonitor.java:126)&lt;br/&gt;
	at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:85)&lt;br/&gt;
	at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:154)&lt;br/&gt;
	at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:140)&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Sachin&lt;/p&gt;
</comment>
                            <comment id="12938970" author="rajdavies" created="Thu, 30 Aug 2007 12:19:47 +0000"  >&lt;p&gt;ok - could you add a test case ?&lt;/p&gt;</comment>
                            <comment id="12939187" author="rajdavies" created="Thu, 1 Nov 2007 22:43:14 +0000"  >&lt;p&gt;Potentional fix by SVN revision 591160&lt;/p&gt;</comment>
                            <comment id="12939197" author="rajdavies" created="Fri, 2 Nov 2007 07:25:03 +0000"  >&lt;p&gt;Fixed by  SVN revision 591160&lt;/p&gt;</comment>
                            <comment id="12939245" author="rajdavies" created="Fri, 2 Nov 2007 20:10:33 +0000"  >&lt;p&gt;Further enhancement by SVN revision 591442 &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>42097</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            18 years, 4 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s1hz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161719</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>