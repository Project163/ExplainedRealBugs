<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:50:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-8183] Setting a maxFrameSize can lead to infinite loop and high cpu usage</title>
                <link>https://issues.apache.org/jira/browse/AMQ-8183</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;There is a regression caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7106&quot; title=&quot;TransportConnection pendingStop support during start is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7106&quot;&gt;&lt;del&gt;AMQ-7106&lt;/del&gt;&lt;/a&gt; that can lead to an infinite loop and high cpu usage when using the nio+ssl transport if maxFrameSize is configured. The issue shows up when several messages come into the broker that exceed the max frame size. The broker properly detects the error and kills the connection in another thread but the transport thread can get stuck in an infinite loop inside serviceRead() method of NIOSSLTransport.&lt;/p&gt;

&lt;p&gt;It&apos;s a bit hard to tell what is going on but the issue appears to be due to the fact that the transport has already been stopped but there&apos;s no condition being hit to break the loop. The transport logic appears to get into a weird state trying to process a partial frame in a local buffer in the serviceRead() method but the logic just keeps spinning and never tries to re-read from the socket because the currentBuffer in the transport is wasn&apos;t allocated due to the async shutdown.&lt;/p&gt;

&lt;p&gt;The fix here is pretty simple and that is to check if the transport has been stopped and exit the loop. I have only seen this with OpenWire and nio+ssl but the fix I&apos;m adding will work for all nio+ssl and nio transports.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13363870">AMQ-8183</key>
            <summary>Setting a maxFrameSize can lead to infinite loop and high cpu usage</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="cshannon">Christopher L. Shannon</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Mar 2021 14:55:07 +0000</created>
                <updated>Thu, 11 Mar 2021 16:15:50 +0000</updated>
                            <resolved>Thu, 11 Mar 2021 15:04:31 +0000</resolved>
                                    <version>5.16.1</version>
                                    <fixVersion>5.16.2</fixVersion>
                    <fixVersion>5.17.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17299617" author="jira-bot" created="Thu, 11 Mar 2021 15:02:00 +0000"  >&lt;p&gt;Commit 944ca6c7e1dc4f44b61ce05b77c180c686e2ae76 in activemq&apos;s branch refs/heads/master from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=944ca6c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=944ca6c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8183&quot; title=&quot;Setting a maxFrameSize can lead to infinite loop and high cpu usage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8183&quot;&gt;&lt;del&gt;AMQ-8183&lt;/del&gt;&lt;/a&gt; - prevent infinite loop when maxFrameSize is exceeded&lt;/p&gt;

&lt;p&gt;This makes sure the nio transport thread properly terminates if&lt;br/&gt;
maxFrameSize is exceeded with OpenWire to prevent an infinite loop that&lt;br/&gt;
uses up all the cpu&lt;/p&gt;</comment>
                            <comment id="17299619" author="jira-bot" created="Thu, 11 Mar 2021 15:02:41 +0000"  >&lt;p&gt;Commit 51a4014c54f1f766fd9ea80178c284a7abb2bb97 in activemq&apos;s branch refs/heads/activemq-5.16.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=51a4014&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=51a4014&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8183&quot; title=&quot;Setting a maxFrameSize can lead to infinite loop and high cpu usage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8183&quot;&gt;&lt;del&gt;AMQ-8183&lt;/del&gt;&lt;/a&gt; - prevent infinite loop when maxFrameSize is exceeded&lt;/p&gt;

&lt;p&gt;This makes sure the nio transport thread properly terminates if&lt;br/&gt;
maxFrameSize is exceeded with OpenWire to prevent an infinite loop that&lt;br/&gt;
uses up all the cpu&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 944ca6c7e1dc4f44b61ce05b77c180c686e2ae76)&lt;/p&gt;</comment>
                            <comment id="17299679" author="jira-bot" created="Thu, 11 Mar 2021 16:15:24 +0000"  >&lt;p&gt;Commit 2712464b78f76affd34cc0b097a2248f211ea0c7 in activemq&apos;s branch refs/heads/master from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=2712464&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=2712464&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8183&quot; title=&quot;Setting a maxFrameSize can lead to infinite loop and high cpu usage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8183&quot;&gt;&lt;del&gt;AMQ-8183&lt;/del&gt;&lt;/a&gt; - apply maxFrameSize high cpu usage fix to Auto nio transport&lt;br/&gt;
also&lt;/p&gt;</comment>
                            <comment id="17299681" author="jira-bot" created="Thu, 11 Mar 2021 16:15:50 +0000"  >&lt;p&gt;Commit 0a099af4c4b9841a4517970fec47c34e3f95c91e in activemq&apos;s branch refs/heads/activemq-5.16.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=0a099af&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=0a099af&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8183&quot; title=&quot;Setting a maxFrameSize can lead to infinite loop and high cpu usage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8183&quot;&gt;&lt;del&gt;AMQ-8183&lt;/del&gt;&lt;/a&gt; - apply maxFrameSize high cpu usage fix to Auto nio transport&lt;br/&gt;
also&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 2712464b78f76affd34cc0b097a2248f211ea0c7)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310560">
                    <name>Problem/Incident</name>
                                                                <inwardlinks description="is caused by">
                                        <issuelink>
            <issuekey id="13199803">AMQ-7106</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 35 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ok48:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>