<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:50:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-8012] ConcurrentModificationException in SubQueueSelectorCacheBroker</title>
                <link>https://issues.apache.org/jira/browse/AMQ-8012</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Standard info log output:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2020-07-16 01:34:57,349 | WARN  | Async error occurred: java.util.ConcurrentModificationException | org.apache.activemq.broker.TransportConnection.Service | ActiveMQ Transport: tcp:///x.x.x.x:yyyyyy@61616
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Debug log output:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.util.ConcurrentModificationException
        at java.util.HashMap$HashIterator.nextNode(HashMap.java:1442)[:1.8.0_161]
        at java.util.HashMap$KeyIterator.next(HashMap.java:1466)[:1.8.0_161]
        at org.apache.activemq.broker.region.virtual.SelectorAwareVirtualTopicInterceptor.tryMatchingCachedSubs(SelectorAwareVirtualTopicInterceptor.java:82)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.region.virtual.SelectorAwareVirtualTopicInterceptor.shouldDispatch(SelectorAwareVirtualTopicInterceptor.java:68)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.region.virtual.VirtualTopicInterceptor.send(VirtualTopicInterceptor.java:114)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.region.virtual.VirtualTopicInterceptor.send(VirtualTopicInterceptor.java:67)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.region.DestinationFilter.send(DestinationFilter.java:132)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:505)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:459)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:293)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:154)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:293)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:154)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:154)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:154)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.security.AuthorizationBroker.send(AuthorizationBroker.java:226)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:154)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:572)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:768)[activemq-client-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:330)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:194)[activemq-broker-5.15.3.jar:5.15.3]
        at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)[activemq-client-5.15.3.jar:5.15.3]
        at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:125)[activemq-client-5.15.3.jar:5.15.3]
        at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:301)[activemq-client-5.15.3.jar:5.15.3]
        at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)[activemq-client-5.15.3.jar:5.15.3]
        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:233)[activemq-client-5.15.3.jar:5.15.3]
        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:215)[activemq-client-5.15.3.jar:5.15.3]
        at java.lang.Thread.run(Thread.java:748)[:1.8.0_161]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13319201">AMQ-8012</key>
            <summary>ConcurrentModificationException in SubQueueSelectorCacheBroker</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mattrpav">Matt Pavlovich</assignee>
                                    <reporter username="mattrpav">Matt Pavlovich</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Jul 2020 17:20:03 +0000</created>
                <updated>Sat, 29 Aug 2020 19:37:06 +0000</updated>
                            <resolved>Fri, 24 Jul 2020 18:19:16 +0000</resolved>
                                    <version>5.16.0</version>
                    <version>5.15.13</version>
                                    <fixVersion>5.16.1</fixVersion>
                    <fixVersion>5.17.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="17164569" author="jira-bot" created="Fri, 24 Jul 2020 18:15:42 +0000"  >&lt;p&gt;Commit 083acb9691dba818aae3c0f72e7675c8a39d500a in activemq&apos;s branch refs/heads/master from Matt Pavlovich&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=083acb9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=083acb9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8012&quot; title=&quot;ConcurrentModificationException in SubQueueSelectorCacheBroker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8012&quot;&gt;&lt;del&gt;AMQ-8012&lt;/del&gt;&lt;/a&gt; Fix for ConcurrentModificationException in SubQueueSelectorCacheBroker&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Remove non-thread-safe method getSelectors()&lt;/li&gt;
	&lt;li&gt;Update all references to use the thread-safe getSelectorsForDestination() method&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="17164570" author="jira-bot" created="Fri, 24 Jul 2020 18:15:43 +0000"  >&lt;p&gt;Commit 1dcc7d4b2c989c9efa03de42b169686b4c5eb8af in activemq&apos;s branch refs/heads/master from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=1dcc7d4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=1dcc7d4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge branch &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8012&quot; title=&quot;ConcurrentModificationException in SubQueueSelectorCacheBroker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8012&quot;&gt;&lt;del&gt;AMQ-8012&lt;/del&gt;&lt;/a&gt;&apos;&lt;/p&gt;

&lt;p&gt;This closes #553&lt;/p&gt;</comment>
                            <comment id="17164571" author="jira-bot" created="Fri, 24 Jul 2020 18:15:44 +0000"  >&lt;p&gt;Commit 62f5576fe5dc8bc06eefc1e26b8e66a10781fe32 in activemq&apos;s branch refs/heads/master from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=62f5576&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=62f5576&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8012&quot; title=&quot;ConcurrentModificationException in SubQueueSelectorCacheBroker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8012&quot;&gt;&lt;del&gt;AMQ-8012&lt;/del&gt;&lt;/a&gt; - Improve thread safety of SubQueueSelectorCacheBroker&lt;/p&gt;

&lt;p&gt;When returning a copy of the set of selectors we need to synchronize&lt;/p&gt;</comment>
                            <comment id="17164573" author="jira-bot" created="Fri, 24 Jul 2020 18:18:20 +0000"  >&lt;p&gt;Commit dbf6e36e2c5400d920355ed362c231995b1efe61 in activemq&apos;s branch refs/heads/activemq-5.16.x from Matt Pavlovich&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=dbf6e36&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=dbf6e36&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8012&quot; title=&quot;ConcurrentModificationException in SubQueueSelectorCacheBroker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8012&quot;&gt;&lt;del&gt;AMQ-8012&lt;/del&gt;&lt;/a&gt; Fix for ConcurrentModificationException in SubQueueSelectorCacheBroker&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Remove non-thread-safe method getSelectors()&lt;/li&gt;
	&lt;li&gt;Update all references to use the thread-safe getSelectorsForDestination() method&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;(cherry picked from commit 083acb9691dba818aae3c0f72e7675c8a39d500a)&lt;/p&gt;</comment>
                            <comment id="17164574" author="jira-bot" created="Fri, 24 Jul 2020 18:18:21 +0000"  >&lt;p&gt;Commit 795e917cbee3b9fb3101cd40205c0013c10cff28 in activemq&apos;s branch refs/heads/activemq-5.16.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=795e917&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=795e917&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8012&quot; title=&quot;ConcurrentModificationException in SubQueueSelectorCacheBroker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8012&quot;&gt;&lt;del&gt;AMQ-8012&lt;/del&gt;&lt;/a&gt; - Improve thread safety of SubQueueSelectorCacheBroker&lt;/p&gt;

&lt;p&gt;When returning a copy of the set of selectors we need to synchronize&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 62f5576fe5dc8bc06eefc1e26b8e66a10781fe32)&lt;/p&gt;</comment>
                            <comment id="17164575" author="christopher.l.shannon" created="Fri, 24 Jul 2020 18:19:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mattrpav&quot; class=&quot;user-hover&quot; rel=&quot;mattrpav&quot;&gt;mattrpav&lt;/a&gt;&#160;- Ok this should be good now. I merged in your fix (thanks btw) and then fixed the thread safety by locking on the synchronized map which is necessary on iteration (which occurs when copying to a new set) plus fixed a couple other methods.&lt;/p&gt;</comment>
                            <comment id="17164618" author="jira-bot" created="Fri, 24 Jul 2020 20:23:31 +0000"  >&lt;p&gt;Commit 0a189f833e1041e589ffa9523bdbe2285a678eed in activemq&apos;s branch refs/heads/master from Christopher Shannon&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=0a189f8&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=0a189f8&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8012&quot; title=&quot;ConcurrentModificationException in SubQueueSelectorCacheBroker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8012&quot;&gt;&lt;del&gt;AMQ-8012&lt;/del&gt;&lt;/a&gt; - Move synchronized block after null check&lt;/p&gt;</comment>
                            <comment id="17164622" author="jira-bot" created="Fri, 24 Jul 2020 20:30:12 +0000"  >&lt;p&gt;Commit 2fa7f09fb958e320e7c458908a5c6310ed0a6a1b in activemq&apos;s branch refs/heads/activemq-5.16.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=2fa7f09&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=2fa7f09&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8012&quot; title=&quot;ConcurrentModificationException in SubQueueSelectorCacheBroker&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8012&quot;&gt;&lt;del&gt;AMQ-8012&lt;/del&gt;&lt;/a&gt; - Move synchronized block after null check&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 0a189f833e1041e589ffa9523bdbe2285a678eed)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0h694:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>