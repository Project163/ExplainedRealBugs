<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:38:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1849] Slave threads increasing when sending to temporary queue</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1849</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Deployed the attached TextMDB (modified JBoss example) to our JBoss 4.0.5 GA server (cluster).&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;send a message to &quot;queue.A&quot; with Reply To set to &quot;queue.REPLY_A&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The TextMDB bean: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;creates a temporary queue with NON_PERSISTENT delivery mode&lt;/li&gt;
	&lt;li&gt;forwards message body to &quot;queue.B&quot; and sets the reply queue to this temporary queue&lt;/li&gt;
	&lt;li&gt;another (or the same) instance of TextMDB replies and adds some text, replies to the temporary queue&lt;/li&gt;
	&lt;li&gt;the first TextMDB replies to &quot;queue.REPLY_A&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Works fine, except that every time a temporary queue message is sent, the number of threads on the slave increases by 3.&lt;/p&gt;

&lt;p&gt;On the master the threads are destroyed after a while, but on the slave they persist, growing to &quot;OutOfMemoryError: unable to create new native thread&quot;&lt;/p&gt;

&lt;p&gt;Temporary queue Thread Name example: TempQueue:  ID:&lt;/p&gt;
{HOSTNAME}
&lt;p&gt;-59619-1215591084487-0:16:5&lt;br/&gt;
+ 2 topic threads&lt;/p&gt;

&lt;p&gt;That thread ID can be found ActiveMQ messages in the attached JBoss log.&lt;/p&gt;

&lt;p&gt;Have I created a bug im my code or have I found a bug in the ActiveMQ server?&lt;/p&gt;</description>
                <environment>&lt;p&gt;Pure master/slave&lt;br/&gt;
JBoss 4.0.5 GA   (on Java 1.5.0_14)&lt;br/&gt;
few days old ActiveMQ 5.2.0-SNAPSHOT (on Java  &quot;1.6.0_06&quot;)&lt;/p&gt;</environment>
        <key id="12482689">AMQ-1849</key>
            <summary>Slave threads increasing when sending to temporary queue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                            <parent id="12482194">AMQ-1979</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="hansb">Hans Bausewein</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Jul 2008 17:29:33 +0000</created>
                <updated>Tue, 14 Oct 2008 12:57:07 +0000</updated>
                            <resolved>Fri, 5 Sep 2008 20:52:31 +0000</resolved>
                                    <version>5.2.0</version>
                                    <fixVersion>5.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12939969" author="hansb" created="Thu, 10 Jul 2008 09:41:02 +0000"  >&lt;p&gt;Update 0.0.2:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;added a stand-alone test&lt;/li&gt;
	&lt;li&gt;delete the temporary queue and close its (locally created) session&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;The problem on the slave persists.&lt;/p&gt;

&lt;p&gt;To run the test do something like:&lt;/p&gt;

&lt;p&gt;java -cp conf:lib/log4j-1.2.14.jar:lib/activemq-all-5.2-SNAPSHOT.jar:lib/activemqjee-0.0.2.jar org.activemq.jms.StandaloneApp&lt;/p&gt;

&lt;p&gt;With libraries in &quot;lib&quot; and &quot;log4j.xml&quot; and &quot;jndi.properties&quot; in &quot;conf&quot;.&lt;/p&gt;

&lt;p&gt;&quot;jndi.properties&quot; contains the fail-over URL:&lt;/p&gt;

&lt;p&gt;  java.naming.provider.url=failover:(tcp://masterhost:61616,tcp://slavehost:61616)&lt;/p&gt;


&lt;p&gt;BTW: Pure master/slave does not work with 5.1.0, so I cannot test that one. ( see &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-1585&quot; title=&quot;Problems with pure master/slave configuration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-1585&quot;&gt;&lt;del&gt;AMQ-1585&lt;/del&gt;&lt;/a&gt; )&lt;/p&gt;
</comment>
                            <comment id="12939964" author="hansb" created="Thu, 10 Jul 2008 10:43:13 +0000"  >&lt;p&gt;Everytime it happens, I get a ClassCastException in &quot;data/activemq.log&quot; on the slave host:&lt;/p&gt;

&lt;p&gt;2008-07-10 11:48:33,907 &lt;a href=&quot;#1&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;t: vm://slavehost#1&lt;/a&gt; ERROR Queue                          - Failed to page in more queue messages &lt;br/&gt;
java.lang.ClassCastException: org.apache.activemq.command.ActiveMQTextMessage cannot be cast to org.apache.activemq.broker.region.QueueMessageReference&lt;br/&gt;
        at org.apache.activemq.broker.region.Queue.messageExpired(Queue.java:1045)&lt;br/&gt;
        at org.apache.activemq.broker.region.Queue.messageExpired(Queue.java:1037)&lt;br/&gt;
        at org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:1117)&lt;br/&gt;
        at org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1196)&lt;br/&gt;
        at org.apache.activemq.broker.region.Queue.iterate(Queue.java:951)&lt;br/&gt;
        at org.apache.activemq.broker.region.Queue.wakeup(Queue.java:1077)&lt;br/&gt;
        at org.apache.activemq.broker.region.Queue.sendMessage(Queue.java:1072)&lt;br/&gt;
        at org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:470)&lt;br/&gt;
        at org.apache.activemq.broker.region.Queue.send(Queue.java:413)&lt;br/&gt;
        at org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:350)&lt;br/&gt;
        at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:437)&lt;br/&gt;
        at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:224)&lt;br/&gt;
        at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:126)&lt;br/&gt;
        at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:95)&lt;br/&gt;
        at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:133)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:437)&lt;br/&gt;
        at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:624)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:292)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:180)&lt;br/&gt;
        at org.apache.activemq.transport.ResponseCorrelator.onCommand(ResponseCorrelator.java:104)&lt;br/&gt;
        at org.apache.activemq.transport.TransportFilter.onCommand(TransportFilter.java:68)&lt;br/&gt;
        at org.apache.activemq.transport.vm.VMTransport.iterate(VMTransport.java:205)&lt;br/&gt;
        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:98)&lt;br/&gt;
        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:36)&lt;/p&gt;</comment>
                            <comment id="12939942" author="hansb" created="Thu, 10 Jul 2008 15:18:37 +0000"  >&lt;p&gt;Deployed build 675511 from svn: the exception is gone, but the number of threads on the slave still increases every time I send a message.&lt;/p&gt;

&lt;p&gt;Tested both with the stand-alone client and with the TextMDB.&lt;/p&gt;</comment>
                            <comment id="12940009" author="hansb" created="Wed, 30 Jul 2008 07:03:35 +0000"  >&lt;p&gt;Tried 680628 yesterday, but the issue is still there.&lt;/p&gt;

&lt;p&gt;Any ideas where it fails? Can I do something?&lt;/p&gt;</comment>
                            <comment id="12940186" author="gtully" created="Fri, 5 Sep 2008 20:52:31 +0000"  >&lt;p&gt;temp queues are now cleaned up in the slave.&lt;/p&gt;</comment>
                            <comment id="12940167" author="hansb" created="Fri, 5 Sep 2008 21:47:41 +0000"  >&lt;p&gt;That&apos;s good news!&lt;/p&gt;

&lt;p&gt;I&apos;ll test it, monday.&lt;/p&gt;</comment>
                            <comment id="12940205" author="hansb" created="Mon, 8 Sep 2008 11:28:33 +0000"  >&lt;p&gt;The test with the attached &quot;activemqjee-0.0.2&quot; worked fine.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461166" name="ASF.LICENSE.NOT.GRANTED--jboss.log" size="3787" author="hansb" created="Wed, 9 Jul 2008 17:29:33 +0000"/>
                            <attachment id="12461232" name="activemqjee-0.0.2-src.tar.gz" size="4926" author="hansb" created="Thu, 10 Jul 2008 09:41:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>95927</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 12 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tsnz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>171953</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>