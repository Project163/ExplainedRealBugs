<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:47:25 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2883] EOFException if stomp+nio after ActiveMQ has sent the first bytes message</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2883</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Starting broker with C:\Java\apache-activemq-5.4.0\bin\activemq-admin.bat start xbean:activemq-stomp.xml&lt;/p&gt;

&lt;p&gt;The Stomp client sends a number of binary messages but receives only the first one, the broker log on the console looks like this:&lt;/p&gt;

&lt;p&gt;Java Runtime: Sun Microsystems Inc. 1.6.0_07 C:\Program Files\Java\jdk1.6.0_07\j&lt;br/&gt;
re&lt;br/&gt;
  Heap sizes: current=5056k  free=4360k  max=520256k&lt;br/&gt;
    JVM args: -Dcom.sun.management.jmxremote -Xmx512M -Dorg.apache.activemq.UseD&lt;br/&gt;
edicatedTaskRunner=true -Djava.util.logging.config.file=logging.properties -Dact&lt;br/&gt;
ivemq.classpath=C:\Java\apache-activemq-5.4.0\bin\../conf; -Dactivemq.home=C:\Ja&lt;br/&gt;
va\apache-activemq-5.4.0\bin\.. -Dactivemq.base=C:\Java\apache-activemq-5.4.0\bi&lt;br/&gt;
n\..&lt;br/&gt;
ACTIVEMQ_HOME: C:\Java\apache-activemq-5.4.0\bin\..&lt;br/&gt;
ACTIVEMQ_BASE: C:\Java\apache-activemq-5.4.0\bin\..&lt;br/&gt;
Loading message broker from: xbean:activemq-stomp.xml&lt;br/&gt;
 INFO | PListStore:C:\Java\apache-activemq-5.4.0\bin\..\data\localhost\tmp_stora&lt;br/&gt;
ge started&lt;br/&gt;
 INFO | Using Persistence Adapter: KahaDBPersistenceAdapter[C:\Java\apache-activ&lt;br/&gt;
emq-5.4.0\bin\..\data\kahadb]&lt;br/&gt;
 INFO | ActiveMQ 5.4.0 JMS Message Broker (localhost) is starting&lt;br/&gt;
 INFO | For help or more information please see: &lt;a href=&quot;http://activemq.apache.org/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/&lt;/a&gt;&lt;br/&gt;
 INFO | Scheduler using directory: activemq-data\scheduler&lt;br/&gt;
 INFO | Listening for connections at: stomp://mj-PC:61612?transport.closeAsync=f&lt;br/&gt;
alse&lt;br/&gt;
 INFO | Connector stomp Started&lt;br/&gt;
 INFO | Listening for connections at: stomp+nio://mj-PC:61613?transport.closeAsy&lt;br/&gt;
nc=false&lt;br/&gt;
 INFO | Connector stomp+nio Started&lt;br/&gt;
 INFO | ActiveMQ JMS Message Broker (localhost, ID:mj-PC-49520-1283080154792-0:0&lt;br/&gt;
) started&lt;br/&gt;
 INFO | Logging to org.slf4j.impl.JCLLoggerAdapter(org.eclipse.jetty.util.log) v&lt;br/&gt;
ia org.eclipse.jetty.util.log.Slf4jLog&lt;br/&gt;
 INFO | jetty-7.0.1.v20091125&lt;br/&gt;
 INFO | ActiveMQ WebConsole initialized.&lt;br/&gt;
 INFO | Initializing Spring FrameworkServlet &apos;dispatcher&apos;&lt;br/&gt;
 INFO | ActiveMQ Console at &lt;a href=&quot;http://0.0.0.0:8161/admin&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://0.0.0.0:8161/admin&lt;/a&gt;&lt;br/&gt;
 INFO | Initializing Spring root WebApplicationContext&lt;br/&gt;
 INFO | Connector vm://localhost Started&lt;br/&gt;
 INFO | Camel Console at &lt;a href=&quot;http://0.0.0.0:8161/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://0.0.0.0:8161/camel&lt;/a&gt;&lt;br/&gt;
 INFO | ActiveMQ Web Demos at &lt;a href=&quot;http://0.0.0.0:8161/demo&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://0.0.0.0:8161/demo&lt;/a&gt;&lt;br/&gt;
 INFO | RESTful file access application at &lt;a href=&quot;http://0.0.0.0:8161/fileserver&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://0.0.0.0:8161/fileserver&lt;/a&gt;&lt;br/&gt;
 INFO | Started SelectChannelConnector@0.0.0.0:8161&lt;br/&gt;
 INFO | Transport failed: java.io.EOFException&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at org.apache.activemq.transport.stomp.StompNIOTransport.serviceRead(Sto&lt;br/&gt;
mpNIOTransport.java:106)&lt;br/&gt;
        at org.apache.activemq.transport.stomp.StompNIOTransport.access$000(Stom&lt;br/&gt;
pNIOTransport.java:51)&lt;br/&gt;
        at org.apache.activemq.transport.stomp.StompNIOTransport$1.onSelect(Stom&lt;br/&gt;
pNIOTransport.java:80)&lt;br/&gt;
        at org.apache.activemq.transport.nio.SelectorSelection.onSelect(Selector&lt;br/&gt;
Selection.java:94)&lt;br/&gt;
        at org.apache.activemq.transport.nio.SelectorWorker$1.run(SelectorWorker&lt;br/&gt;
.java:119)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExec&lt;br/&gt;
utor.java:885)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor&lt;br/&gt;
.java:907)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;The Stomp client log is:&lt;/p&gt;

&lt;p&gt;TCoreIndyTests.TestBytesMessages&lt;br/&gt;
send:&lt;br/&gt;
CONNECT&lt;/p&gt;



&lt;p&gt;received:&lt;br/&gt;
CONNECTED&lt;br/&gt;
session:ID:mj-PC-49520-1283080154792-5:0&lt;/p&gt;


&lt;p&gt;send:&lt;br/&gt;
SUBSCRIBE&lt;br/&gt;
destination:/queue/HabariSpeedTest&lt;br/&gt;
ack:auto&lt;br/&gt;
id:&lt;/p&gt;
{E4BD9658-B92E-4C57-AD9F-F5357BA66FC2}&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
send:&lt;br/&gt;
SEND&lt;br/&gt;
destination:/queue/HabariSpeedTest&lt;br/&gt;
content-length:4&lt;br/&gt;
correlation-id:{5B735F2D-349E-4A8A-B2AE-6493A1569F88}&lt;br/&gt;
&lt;br/&gt;
&#9786;&#9787;&#9829;1&lt;br/&gt;
&lt;br/&gt;
send:&lt;br/&gt;
SEND&lt;br/&gt;
destination:/queue/HabariSpeedTest&lt;br/&gt;
content-length:4&lt;br/&gt;
correlation-id:{5B735F2D-349E-4A8A-B2AE-6493A1569F88}&lt;br/&gt;
&lt;br/&gt;
&#9786;&#9787;&#9829;2&lt;br/&gt;
&lt;br/&gt;
send:&lt;br/&gt;
&lt;br/&gt;
(more messages, ten total)&lt;br/&gt;
&lt;br/&gt;
received:&lt;br/&gt;
MESSAGE&lt;br/&gt;
message-id:ID:mj-PC-49520-1283080154792-5:0:-1:1:1&lt;br/&gt;
destination:/queue/HabariSpeedTest&lt;br/&gt;
timestamp:1283080192048&lt;br/&gt;
expires:0&lt;br/&gt;
subscription:{E4BD9658-B92E-4C57-AD9F-F5357BA66FC2}
&lt;p&gt;content-length:4&lt;br/&gt;
priority:0&lt;br/&gt;
correlation-id:&lt;/p&gt;
{5B735F2D-349E-4A8A-B2AE-6493A1569F88}

&lt;p&gt;&#9786;&#9787;&#9829;1&lt;/p&gt;

&lt;p&gt;Received 1 messages&lt;br/&gt;
Elapsed: 10000 msec (limit: 10000 msec) - giving up&lt;br/&gt;
send:&lt;br/&gt;
DISCONNECT&lt;/p&gt;



&lt;p&gt;Not sure if this is related but I also see an error in the startup log on later restarts. I reinstalled the broker and the message disappears.&lt;/p&gt;

&lt;p&gt; INFO | jetty-7.0.1.v20091125&lt;br/&gt;
 INFO | ActiveMQ WebConsole initialized.&lt;br/&gt;
 INFO | Initializing Spring FrameworkServlet &apos;dispatcher&apos;&lt;br/&gt;
 INFO | ActiveMQ Console at &lt;a href=&quot;http://0.0.0.0:8161/admin&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://0.0.0.0:8161/admin&lt;/a&gt;&lt;br/&gt;
 INFO | Initializing Spring root WebApplicationContext&lt;br/&gt;
ERROR | Could not accept connection : java.nio.channels.ClosedSelectorException  &amp;lt;------------------&lt;br/&gt;
 INFO | Connector vm://localhost Started&lt;br/&gt;
 INFO | Camel Console at &lt;a href=&quot;http://0.0.0.0:8161/camel&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://0.0.0.0:8161/camel&lt;/a&gt;&lt;br/&gt;
 INFO | ActiveMQ Web Demos at &lt;a href=&quot;http://0.0.0.0:8161/demo&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://0.0.0.0:8161/demo&lt;/a&gt;&lt;br/&gt;
 INFO | RESTful file access application at &lt;a href=&quot;http://0.0.0.0:8161/fileserver&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://0.0.0.0:8161/fileserver&lt;/a&gt;&lt;br/&gt;
 INFO | Started SelectChannelConnector@0.0.0.0:8161&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows Vista&lt;/p&gt;</environment>
        <key id="12483468">AMQ-2883</key>
            <summary>EOFException if stomp+nio after ActiveMQ has sent the first bytes message</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="mjustin">Michael Justin</reporter>
                        <labels>
                    </labels>
                <created>Sun, 29 Aug 2010 11:21:16 +0000</created>
                <updated>Wed, 1 Sep 2010 14:25:43 +0000</updated>
                            <resolved>Mon, 30 Aug 2010 15:48:48 +0000</resolved>
                                    <version>5.4.0</version>
                                    <fixVersion>5.4.1</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="12942763" author="tabish121" created="Sun, 29 Aug 2010 19:13:16 +0000"  >&lt;p&gt;Would be helpful if you could create a unit test that reproduces this error, take a look at the StompTest.java for some sample to work from.&lt;/p&gt;</comment>
                            <comment id="12942786" author="daniel.peters" created="Mon, 30 Aug 2010 11:38:10 +0000"  >&lt;p&gt;I just updated our server from 5.3.2 to 5.4.0 and I get the same error with Stomp:&lt;br/&gt;
2010-08-30 12:43:11,681 | INFO  | Transport failed: java.io.EOFException | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ NIO Worker&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at org.apache.activemq.transport.stomp.StompNIOTransport.serviceRead(StompNIOTransport.java:106)&lt;br/&gt;
        at org.apache.activemq.transport.stomp.StompNIOTransport.access$000(StompNIOTransport.java:51)&lt;br/&gt;
        at org.apache.activemq.transport.stomp.StompNIOTransport$1.onSelect(StompNIOTransport.java:80)&lt;br/&gt;
        at org.apache.activemq.transport.nio.SelectorSelection.onSelect(SelectorSelection.java:94)&lt;br/&gt;
        at org.apache.activemq.transport.nio.SelectorWorker$1.run(SelectorWorker.java:119)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;We had to switch back to 5.3.2 because we have alot stomp clients. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;It doesnt work without NIO either:&lt;br/&gt;
2010-08-30 12:55:15,536 | INFO  | Transport failed: java.io.EOFException | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ Transport: tcp:///192.168.2.89:37025&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at java.io.DataInputStream.readByte(DataInputStream.java:250)&lt;br/&gt;
        at org.apache.activemq.transport.stomp.StompWireFormat.readLine(StompWireFormat.java:146)&lt;br/&gt;
        at org.apache.activemq.transport.stomp.StompWireFormat.parseAction(StompWireFormat.java:162)&lt;br/&gt;
        at org.apache.activemq.transport.stomp.StompWireFormat.unmarshal(StompWireFormat.java:92)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:226)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:218)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:201)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;</comment>
                            <comment id="12942790" author="tabish121" created="Mon, 30 Aug 2010 15:48:48 +0000"  >&lt;p&gt;Fixed in trunk.  &lt;/p&gt;</comment>
                            <comment id="12942775" author="nuvan" created="Tue, 31 Aug 2010 14:27:52 +0000"  >&lt;p&gt;Daniel,&lt;br/&gt;
We had the same problem and because we have lots of Stomp Clients (a couple of hundred), we implemented a workaround with StompConnect.&lt;/p&gt;

&lt;p&gt;Since ActiveMQ 5.4.0 solves a lot of issues (and brings camel 2.4) in 5.3.2 that had impact in our applications we have upgraded our instances use StompConnect instead of somp(+nio) transport connector.&lt;br/&gt;
To implement this solution, you just need the StompConnect jar (available at Codehaus) in your class path, and use the following Spring configuration outside of your broker context:&lt;/p&gt;

&lt;p&gt;&amp;lt;bean id=&quot;myFactory&quot; class=&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;property name=&quot;brokerURL&quot; value=&quot;tcp://localhost:61616&quot;/&lt;br/&gt;
      &amp;lt;property name=&quot;userName&quot; value=&quot;username&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;property name=&quot;password&quot; value=&quot;password&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/bean&amp;gt;&lt;/p&gt;


&lt;p&gt;&amp;lt;bean id=&quot;stompConnector&quot; class=&quot;org.codehaus.stomp.jms.StompConnect&quot; init-method=&quot;start&quot;&amp;gt; &lt;br/&gt;
      &amp;lt;property name=&quot;connectionFactory&quot; ref=&quot;myFactory&quot;/&amp;gt; &lt;br/&gt;
      &amp;lt;property name=&quot;uri&quot;               value=&quot;tcp://localhost:61612&quot;/&amp;gt;&lt;br/&gt;
&amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;This way you comment your stomp+nio transport connector and leave the forward to your desired ip/port. (this example assumes a user named &quot;user&quot; and password &quot;password&quot;. Also assumes that your Stomp messages are heading to localhost:61612 and that the openwire transport connector listens in localhost:61616)&lt;/p&gt;

&lt;p&gt;Hope this helps. &lt;br/&gt;
Best regards,&lt;br/&gt;
Nuno Valente.&lt;/p&gt;</comment>
                            <comment id="12942814" author="daniel.peters" created="Wed, 1 Sep 2010 14:25:43 +0000"  >&lt;p&gt;@Timothy:&lt;br/&gt;
Thanks for the fast fix! Could you maybe backport this fix to a 5.4 branch? I think alot users that rely on Stomp would appriciate it .&lt;/p&gt;

&lt;p&gt;@Nuno:&lt;br/&gt;
good idea too, thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14791</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 12 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ba7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63765</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>