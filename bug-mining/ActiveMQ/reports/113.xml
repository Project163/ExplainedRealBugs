<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:31:50 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-895] JMS to JMS Bridge never reconnects under remote broker restarts.</title>
                <link>https://issues.apache.org/jira/browse/AMQ-895</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I&apos;m using ActiveMQ (4.0.1) JMS to JMS Bridge functionality to connect to a  SunMQ JMS Broker (3.6 SP3  (Build 02-A)). I&apos;m using two queues, an input and an output one, with the following configuration:&lt;/p&gt;


&lt;p&gt;    &amp;lt;jmsBridgeConnectors&amp;gt;&lt;br/&gt;
      &amp;lt;jmsQueueConnector outboundQueueConnectionFactory=&quot;#REMOTE&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;outboundQueueBridges&amp;gt;&lt;br/&gt;
        &amp;lt;outboundQueueBridge outboundQueueName=&quot;SUNRECV&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;/outboundQueueBridges&amp;gt;&lt;br/&gt;
      &amp;lt;inboundQueueBridges&amp;gt;&lt;br/&gt;
        &amp;lt;inboundQueueBridge inboundQueueName=&quot;SUNSEND&quot;/&amp;gt;&lt;br/&gt;
      &amp;lt;/inboundQueueBridges&amp;gt;&lt;br/&gt;
      &amp;lt;/jmsQueueConnector&amp;gt;&lt;br/&gt;
    &amp;lt;/jmsBridgeConnectors&amp;gt;&lt;/p&gt;


&lt;p&gt;The system works really well until the SunMQ broker needed to be restarted. This is what I found:&lt;br/&gt;
1.-ActiveMQ is not aware of the remote broker shutdown. I waited for a while, but no log on ActiveMQ indicates knowledge about the new situation.&lt;br/&gt;
2.-When I send a message to the output queue SUNRECV, ActiveMQ complains that the producer is closed:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/25.09:47:12.039&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Session Task&amp;#93;&lt;/span&gt;failed to forward message: ActiveMQTextMessage &lt;/p&gt;
{commandId = 5, responseRequired = false, messageId = ID:trabucco-43457-1156491843149-3:4:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:trabucco-43457-1156491843149-3:4:1:1, destination = queue://SUNRECV, transactionId = null, expiration = 0, timestamp = 1156492032027, arrival = 0, correlationId = null, replyTo = null, persistent = false, type = null, priority = 0, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = null, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 2, properties = null, readOnlyProperties = true, readOnlyBody = true, text = 1}
&lt;p&gt;(&lt;span class=&quot;error&quot;&gt;&amp;#91;C4064&amp;#93;&lt;/span&gt;: Cannot perform operation, producer is closed.)&lt;/p&gt;

&lt;p&gt; After this, it is automatically queueing messages without sending them, showing the log:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/25.09:47:42.721&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;RMI TCP Connection(4)-10.95.89.20&amp;#93;&lt;/span&gt;No subscriptions registered, will not dispatch message at this time.&lt;/p&gt;

&lt;p&gt; Even if SunMQ is started again, ActiveMQ is not detecting the new situation, and continues queueing messages sent to SUNRECV.&lt;/p&gt;

&lt;p&gt;Please, make me know if more information is needed to understand the situation.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12483417">AMQ-895</key>
            <summary>JMS to JMS Bridge never reconnects under remote broker restarts.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                            <parent id="12483795">AMQ-2455</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mteira">Manuel Teira Paz</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Aug 2006 10:52:20 +0000</created>
                <updated>Wed, 28 Apr 2010 13:59:28 +0000</updated>
                            <resolved>Wed, 28 Apr 2010 13:59:28 +0000</resolved>
                                    <version>4.0 RC2</version>
                    <version>4.0.1</version>
                                    <fixVersion>5.4.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>5</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="12938372" author="jstrachan" created="Fri, 25 Aug 2006 11:00:16 +0000"  >&lt;p&gt;I&apos;ve tried adding a fix to SVN trunk. I wonder could you try it out for me to see if it fixes your issue? Basically I&apos;ve patched the code to try reconnecting (by default a maximum of 10 times per message) if the send() fails before stopping the bridge.&lt;/p&gt;

&lt;p&gt;Grab the latest code here...&lt;br/&gt;
&lt;a href=&quot;http://incubator.apache.org/activemq/source.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://incubator.apache.org/activemq/source.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;then build it...&lt;br/&gt;
&lt;a href=&quot;http://incubator.apache.org/activemq/building.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://incubator.apache.org/activemq/building.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12938386" author="mteira" created="Fri, 25 Aug 2006 11:41:23 +0000"  >&lt;p&gt;Thanks a lot, James. &lt;/p&gt;

&lt;p&gt;I&apos;m not familiar with maven usage and I&apos;m getting an error I don&apos;t know the cause of:&lt;/p&gt;

&lt;p&gt;Downloading: &lt;a href=&quot;http://ibiblio.org/maven2//directory-shared/ldap-common/0.9.1/ldap-&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://ibiblio.org/maven2//directory-shared/ldap-common/0.9.1/ldap-&lt;/a&gt;&lt;br/&gt;
common-0.9.1.pom&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; BUILD ERROR&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Error building POM (may not be this project&apos;s POM).&lt;/p&gt;


&lt;p&gt;Project ID: directory-shared:ldap-common&lt;/p&gt;

&lt;p&gt;Reason: Error getting POM for &apos;directory-shared:ldap-common&apos; from the repository&lt;br/&gt;
: Error transferring file&lt;br/&gt;
  directory-shared:ldap-common:pom:0.9.1&lt;/p&gt;


&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="12936355" author="mteira" created="Mon, 28 Aug 2006 07:26:07 +0000"  >&lt;p&gt;I&apos;ve updated my local svn copy this morning, and have seen that the ldap-common version have been bumped up to 0.9.2. But now, I&apos;m running into a different problem:&lt;/p&gt;

&lt;p&gt;...&lt;br/&gt;
Downloading: &lt;a href=&quot;http://people.apache.org/repo/m2-snapshot-repository/org/codehaus/p&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/repo/m2-snapshot-repository/org/codehaus/p&lt;/a&gt;&lt;br/&gt;
lexus/plexus-archiver/1.0-alpha-7-SNAPSHOT/plexus-archiver-1.0-alpha-7-SNAPSHOT.&lt;br/&gt;
jar&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;WARNING&amp;#93;&lt;/span&gt; Unable to get resource from repository apache.snapshots (&lt;a href=&quot;http://people&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people&lt;/a&gt;&lt;br/&gt;
.apache.org/repo/m2-snapshot-repository)&lt;br/&gt;
Downloading: &lt;a href=&quot;http://people.apache.org/repo/m2-snapshot-repository/org/apache/mav&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/repo/m2-snapshot-repository/org/apache/mav&lt;/a&gt;&lt;br/&gt;
en/maven-archiver/2.2-SNAPSHOT/maven-archiver-2.2-20060826.152218-3.jar&lt;br/&gt;
11K downloaded&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; BUILD ERROR&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Failed to resolve artifact.&lt;/p&gt;

&lt;p&gt;Missing:&lt;br/&gt;
----------&lt;br/&gt;
1) org.codehaus.plexus:plexus-archiver:jar:1.0-alpha-7-SNAPSHOT&lt;/p&gt;

&lt;p&gt;  Try downloading the file manually from the project website.&lt;/p&gt;

&lt;p&gt;  Then, install it using the command:&lt;br/&gt;
      mvn install:install-file -DgroupId=org.codehaus.plexus -DartifactId=plexus&lt;br/&gt;
-archiver \&lt;br/&gt;
          -Dversion=1.0-alpha-7-SNAPSHOT -Dpackaging=jar -Dfile=/path/to/file&lt;/p&gt;

&lt;p&gt;  Path to dependency:&lt;br/&gt;
        1) org.apache.maven.plugins:maven-jar-plugin:maven-plugin:2.1-20060826.1&lt;br/&gt;
62339-6&lt;br/&gt;
        2) org.apache.maven:maven-archiver:jar:2.2-SNAPSHOT&lt;br/&gt;
        3) org.codehaus.plexus:plexus-archiver:jar:1.0-alpha-7-SNAPSHOT&lt;/p&gt;

&lt;p&gt;----------&lt;br/&gt;
1 required artifact is missing.&lt;/p&gt;

&lt;p&gt;for artifact:&lt;br/&gt;
  org.apache.maven.plugins:maven-jar-plugin:maven-plugin:2.1-20060826.162339-6&lt;/p&gt;

&lt;p&gt;from the specified remote repositories:&lt;br/&gt;
  central (&lt;a href=&quot;http://repo1.maven.org/maven2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://repo1.maven.org/maven2&lt;/a&gt;),&lt;br/&gt;
  apache.snapshots (&lt;a href=&quot;http://people.apache.org/repo/m2-snapshot-repository&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/repo/m2-snapshot-repository&lt;/a&gt;),&lt;br/&gt;
  apache-snapshots (&lt;a href=&quot;http://people.apache.org/maven-snapshot-repository&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/maven-snapshot-repository&lt;/a&gt;)&lt;/p&gt;


&lt;p&gt;I tried to follow the intructions into the error, downloaded a version of plexus-archiver and got this new error:&lt;/p&gt;

&lt;p&gt;C:\src\activemq\trunk&amp;gt;mvn install:install-file -DgroupId=org.codehaus.plexus -Da&lt;br/&gt;
rtifactId=plexus-archiver -Dversion=1.0-alpha-7-SNAPSHOT -Dpackaging=jar -Dfile=&lt;br/&gt;
&quot;C:\Documents and Settings\Administrador\Escritorio\plexus-archiver-1.0-alpha-7-&lt;br/&gt;
20060827.121315-6.jar&quot;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Scanning for projects...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; FATAL ERROR&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Error building POM (may not be this project&apos;s POM).&lt;/p&gt;


&lt;p&gt;Project ID: org.apache.activemq:activemq-core&lt;br/&gt;
POM Location: C:\src\activemq\trunk\activemq-core\pom.xml&lt;br/&gt;
Validation Messages:&lt;/p&gt;

&lt;p&gt;    &lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;  &apos;dependencies.dependency.version&apos; is missing for org.apache.activemq:activemq-jaas&lt;/p&gt;


&lt;p&gt;Reason: Failed to validate POM&lt;/p&gt;


&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Trace&lt;br/&gt;
org.apache.maven.reactor.MavenExecutionException: Failed to validate POM&lt;br/&gt;
        at org.apache.maven.DefaultMaven.getProjects(DefaultMaven.java:365)&lt;br/&gt;
        at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:278)&lt;br/&gt;
        at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:115)&lt;br/&gt;
        at org.apache.maven.cli.MavenCli.main(MavenCli.java:256)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.&lt;br/&gt;
java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces&lt;br/&gt;
sorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.codehaus.classworlds.Launcher.launchEnhanced(Launcher.java:315)&lt;br/&gt;
        at org.codehaus.classworlds.Launcher.launch(Launcher.java:255)&lt;br/&gt;
        at org.codehaus.classworlds.Launcher.mainWithExitCode(Launcher.java:430)&lt;/p&gt;

&lt;p&gt;        at org.codehaus.classworlds.Launcher.main(Launcher.java:375)&lt;br/&gt;
Caused by: org.apache.maven.project.InvalidProjectModelException: Failed to vali&lt;br/&gt;
date POM&lt;br/&gt;
        at org.apache.maven.project.DefaultMavenProjectBuilder.processProjectLog&lt;br/&gt;
ic(DefaultMavenProjectBuilder.java:926)&lt;br/&gt;
        at org.apache.maven.project.DefaultMavenProjectBuilder.buildInternal(Def&lt;br/&gt;
aultMavenProjectBuilder.java:737)&lt;br/&gt;
        at org.apache.maven.project.DefaultMavenProjectBuilder.buildFromSourceFi&lt;br/&gt;
leInternal(DefaultMavenProjectBuilder.java:416)&lt;br/&gt;
        at org.apache.maven.project.DefaultMavenProjectBuilder.build(DefaultMave&lt;br/&gt;
nProjectBuilder.java:192)&lt;br/&gt;
        at org.apache.maven.DefaultMaven.getProject(DefaultMaven.java:515)&lt;br/&gt;
        at org.apache.maven.DefaultMaven.collectProjects(DefaultMaven.java:447)&lt;br/&gt;
        at org.apache.maven.DefaultMaven.collectProjects(DefaultMaven.java:491)&lt;br/&gt;
        at org.apache.maven.DefaultMaven.getProjects(DefaultMaven.java:351)&lt;br/&gt;
        ... 11 more&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Total time: 1 second&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Finished at: Mon Aug 28 09:17:31 CEST 2006&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Final Memory: 1M/3M&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;/p&gt;


&lt;p&gt;At this stage, I don&apos;t know if this error is produced by a wrong setup of maven (I just followed the instructions in the ActiveMQ website (running maven 2.0.4)) or is something related with activemq itself. &lt;/p&gt;

&lt;p&gt;Any hint? &lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="12938420" author="mteira" created="Mon, 28 Aug 2006 07:49:39 +0000"  >&lt;p&gt;I&apos;ve avoided the previous problem launching &apos;mvn install:install-file ...&apos; outside of the activemq directory. This way I reached compiling activemq-core, but it failed with this error:&lt;/p&gt;

&lt;p&gt;Downloading: &lt;a href=&quot;http://repo1.maven.org/maven2/ant/ant/1.6.2/ant-1.6.2.jar&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://repo1.maven.org/maven2/ant/ant/1.6.2/ant-1.6.2.jar&lt;/a&gt;&lt;br/&gt;
976K downloaded&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; [xbean:mapping &lt;/p&gt;
{execution: default}
&lt;p&gt;]&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; FATAL ERROR&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; com.thoughtworks.qdox.parser.ParseException: syntax error @&lt;span class=&quot;error&quot;&gt;&amp;#91;90,25&amp;#93;&lt;/span&gt; in fil&lt;br/&gt;
e:/C:/src/activemq/trunk/activemq-core/src/main/java/org/apache/activemq/network&lt;br/&gt;
/jms/JmsConnector.java&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Trace&lt;br/&gt;
com.thoughtworks.qdox.parser.ParseException: syntax error @&lt;span class=&quot;error&quot;&gt;&amp;#91;90,25&amp;#93;&lt;/span&gt; in &lt;a href=&quot;file:/C:/s&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/C:/s&lt;/a&gt;&lt;br/&gt;
rc/activemq/trunk/activemq-core/src/main/java/org/apache/activemq/network/jms/Jm&lt;br/&gt;
sConnector.java&lt;br/&gt;
        at org.apache.xbean.maven.XBeanMojo.execute(XBeanMojo.java:185)&lt;br/&gt;
        at org.apache.maven.plugin.DefaultPluginManager.executeMojo(DefaultPlugi&lt;br/&gt;
nManager.java:412)&lt;br/&gt;
        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoals(Defa&lt;br/&gt;
ultLifecycleExecutor.java:534)&lt;br/&gt;
        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalWithLi&lt;br/&gt;
fecycle(DefaultLifecycleExecutor.java:475)&lt;br/&gt;
        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoal(Defau&lt;br/&gt;
ltLifecycleExecutor.java:454)&lt;br/&gt;
        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalAndHan&lt;br/&gt;
dleFailures(DefaultLifecycleExecutor.java:306)&lt;br/&gt;
        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeTaskSegmen&lt;br/&gt;
ts(DefaultLifecycleExecutor.java:273)&lt;br/&gt;
        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.execute(DefaultLi&lt;br/&gt;
fecycleExecutor.java:140)&lt;br/&gt;
        at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:322)&lt;br/&gt;
        at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:115)&lt;br/&gt;
        at org.apache.maven.cli.MavenCli.main(MavenCli.java:256)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.&lt;br/&gt;
java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces&lt;br/&gt;
sorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.codehaus.classworlds.Launcher.launchEnhanced(Launcher.java:315)&lt;br/&gt;
        at org.codehaus.classworlds.Launcher.launch(Launcher.java:255)&lt;br/&gt;
        at org.codehaus.classworlds.Launcher.mainWithExitCode(Launcher.java:430)&lt;/p&gt;

&lt;p&gt;        at org.codehaus.classworlds.Launcher.main(Launcher.java:375)&lt;br/&gt;
Caused by: com.thoughtworks.qdox.parser.ParseException: syntax error @&lt;span class=&quot;error&quot;&gt;&amp;#91;90,25&amp;#93;&lt;/span&gt; in&lt;br/&gt;
 &lt;a href=&quot;file:/C:/src/activemq/trunk/activemq-core/src/main/java/org/apache/activemq/net&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/C:/src/activemq/trunk/activemq-core/src/main/java/org/apache/activemq/net&lt;/a&gt;&lt;br/&gt;
work/jms/JmsConnector.java&lt;br/&gt;
        at com.thoughtworks.qdox.parser.impl.Parser.yyerror(Parser.java:611)&lt;br/&gt;
        at com.thoughtworks.qdox.parser.impl.Parser.yyparse(Parser.java:719)&lt;br/&gt;
        at com.thoughtworks.qdox.parser.impl.Parser.parse(Parser.java:592)&lt;br/&gt;
        at com.thoughtworks.qdox.JavaDocBuilder.addSource(JavaDocBuilder.java:30&lt;br/&gt;
0)&lt;br/&gt;
        at com.thoughtworks.qdox.JavaDocBuilder.addSource(JavaDocBuilder.java:31&lt;br/&gt;
6)&lt;br/&gt;
        at com.thoughtworks.qdox.JavaDocBuilder.addSource(JavaDocBuilder.java:31&lt;br/&gt;
2)&lt;br/&gt;
        at org.apache.xbean.spring.generator.QdoxMappingLoader.loadNamespaces(Qd&lt;br/&gt;
oxMappingLoader.java:96)&lt;br/&gt;
        at org.apache.xbean.maven.XBeanMojo.execute(XBeanMojo.java:153)&lt;br/&gt;
        ... 18 more&lt;br/&gt;
&amp;#8212; Nested Exception &amp;#8212;&lt;br/&gt;
com.thoughtworks.qdox.parser.ParseException: syntax error @&lt;span class=&quot;error&quot;&gt;&amp;#91;90,25&amp;#93;&lt;/span&gt; in &lt;a href=&quot;file:/C:/s&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;file:/C:/s&lt;/a&gt;&lt;br/&gt;
rc/activemq/trunk/activemq-core/src/main/java/org/apache/activemq/network/jms/Jm&lt;br/&gt;
sConnector.java&lt;br/&gt;
        at com.thoughtworks.qdox.parser.impl.Parser.yyerror(Parser.java:611)&lt;br/&gt;
        at com.thoughtworks.qdox.parser.impl.Parser.yyparse(Parser.java:719)&lt;br/&gt;
        at com.thoughtworks.qdox.parser.impl.Parser.parse(Parser.java:592)&lt;br/&gt;
        at com.thoughtworks.qdox.JavaDocBuilder.addSource(JavaDocBuilder.java:30&lt;br/&gt;
0)&lt;br/&gt;
        at com.thoughtworks.qdox.JavaDocBuilder.addSource(JavaDocBuilder.java:31&lt;br/&gt;
6)&lt;br/&gt;
        at com.thoughtworks.qdox.JavaDocBuilder.addSource(JavaDocBuilder.java:31&lt;br/&gt;
2)&lt;br/&gt;
        at org.apache.xbean.spring.generator.QdoxMappingLoader.loadNamespaces(Qd&lt;br/&gt;
oxMappingLoader.java:96)&lt;br/&gt;
        at org.apache.xbean.maven.XBeanMojo.execute(XBeanMojo.java:153)&lt;br/&gt;
        at org.apache.maven.plugin.DefaultPluginManager.executeMojo(DefaultPlugi&lt;br/&gt;
nManager.java:412)&lt;br/&gt;
        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoals(Defa&lt;br/&gt;
ultLifecycleExecutor.java:534)&lt;br/&gt;
        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalWithLi&lt;br/&gt;
fecycle(DefaultLifecycleExecutor.java:475)&lt;br/&gt;
        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoal(Defau&lt;br/&gt;
ltLifecycleExecutor.java:454)&lt;br/&gt;
        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeGoalAndHan&lt;br/&gt;
dleFailures(DefaultLifecycleExecutor.java:306)&lt;br/&gt;
        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.executeTaskSegmen&lt;br/&gt;
ts(DefaultLifecycleExecutor.java:273)&lt;br/&gt;
        at org.apache.maven.lifecycle.DefaultLifecycleExecutor.execute(DefaultLi&lt;br/&gt;
fecycleExecutor.java:140)&lt;br/&gt;
        at org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:322)&lt;br/&gt;
        at org.apache.maven.DefaultMaven.execute(DefaultMaven.java:115)&lt;br/&gt;
        at org.apache.maven.cli.MavenCli.main(MavenCli.java:256)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.&lt;br/&gt;
java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAcces&lt;br/&gt;
sorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:585)&lt;br/&gt;
        at org.codehaus.classworlds.Launcher.launchEnhanced(Launcher.java:315)&lt;br/&gt;
        at org.codehaus.classworlds.Launcher.launch(Launcher.java:255)&lt;br/&gt;
        at org.codehaus.classworlds.Launcher.mainWithExitCode(Launcher.java:430)&lt;/p&gt;

&lt;p&gt;        at org.codehaus.classworlds.Launcher.main(Launcher.java:375)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Total time: 5 minutes 10 seconds&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Finished at: Mon Aug 28 09:35:45 CEST 2006&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Final Memory: 15M/28M&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;/p&gt;

&lt;p&gt;It seems that JmsConnector.java is one of the modified files for the fix we&apos;re on. Anyway, I don&apos;t know what that qdox.parser is expecting to find, the java code looks fine to me, and making a diff against the previous svn version of the file at that point is only finding some cosmetic changes.&lt;/p&gt;

&lt;p&gt;Waiting for help. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12936425" author="mteira" created="Wed, 30 Aug 2006 10:47:00 +0000"  >&lt;p&gt;Previous error was produced by bug: &lt;a href=&quot;https://issues.apache.org/activemq/browse/AMQ-901&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/activemq/browse/AMQ-901&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Checking todays svn trunk version finished with a successful compilation. However, reconnection seems not to work. &lt;/p&gt;

&lt;p&gt;The scenario is as follows:&lt;/p&gt;

&lt;p&gt;===Scenario #1===&lt;br/&gt;
ActiveMQ broker with a bridged Sun MQ Broker.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Start ActiveMQ&lt;/li&gt;
	&lt;li&gt;Send a message to a bridged queue.
	&lt;ul&gt;
		&lt;li&gt;The message gets into the queue, the jmx console shows:&lt;br/&gt;
     EnqueueCount: 1&lt;br/&gt;
     DequeueCount: 0&lt;br/&gt;
     QueueSize: 1&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Start SunMQ&lt;/li&gt;
	&lt;li&gt;Send a new message to the bridged queue.
	&lt;ul&gt;
		&lt;li&gt;Messages are not delivered to the SunMQ broker.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;===Scenario #2===&lt;br/&gt;
ActiveMQ broker with a bridged SunMQ Broker.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Start SunMQ&lt;/li&gt;
	&lt;li&gt;Start ActiveMQ&lt;/li&gt;
	&lt;li&gt;Send a message to a bridged queue.
	&lt;ul&gt;
		&lt;li&gt;The message is bridged to SunMQ Broker queue. The jmx console shows:&lt;br/&gt;
    ConsumerCount: 1&lt;br/&gt;
     EnqueueCount: 1&lt;br/&gt;
     DequeueCount: 1&lt;br/&gt;
     QueueSize: 0&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Stop SunMQ&lt;/li&gt;
	&lt;li&gt;Send a new message to the bridged queue.
	&lt;ul&gt;
		&lt;li&gt;Message is not delivered to the SunMQ broker.&lt;/li&gt;
		&lt;li&gt;The jmx console shows, for the queue:&lt;br/&gt;
    ConsumerCount: 1&lt;br/&gt;
    EnqueueCount: 2&lt;br/&gt;
    DequeueCount: 2&lt;br/&gt;
    QueueSize: 1&lt;br/&gt;
**The log shows:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:40:57.849&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport Server: tcp://localhost:61635&amp;#93;&lt;/span&gt;Sending: WireFormatInfo 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: { version=2, properties={TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, StackTraceEnabled=true, MaxInactivityDuration=30000, CacheEnabled=true}, magic=&lt;span class=&quot;error&quot;&gt;&amp;#91;A,c,t,i,v,e,M,Q&amp;#93;&lt;/span&gt;}&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:40:57.849&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport Server: tcp://localhost:61635&amp;#93;&lt;/span&gt;Sending: WireFormatInfo { version=2, properties={TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, StackTraceEnabled=true, MaxInactivityDuration=30000, CacheEnabled=true}, magic=[A,c,t,i,v,e,M,Q]}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:40:57.887&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47305&amp;#93;&lt;/span&gt;Received WireFormat: WireFormatInfo &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: { version=2, properties={StackTraceEnabled=true, TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, MaxInactivityDuration=30000, CacheEnabled=true}, magic=&lt;span class=&quot;error&quot;&gt;&amp;#91;A,c,t,i,v,e,M,Q&amp;#93;&lt;/span&gt;}&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:40:57.888&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47305&amp;#93;&lt;/span&gt;tcp:///127.0.0.1:47305 before negotiation: OpenWireFormat{version=1, cacheEnabled=false, stackTraceEnabled=false, tightEncodingEnabled=false, sizePrefixDisabled=false}&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:40:57.889&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47305&amp;#93;&lt;/span&gt;tcp:///127.0.0.1:47305 after negotiation: OpenWireFormat{version=2, cacheEnabled=true, stackTraceEnabled=true, tightEncodingEnabled=true, sizePrefixDisabled=false}&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:40:57.887&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47305&amp;#93;&lt;/span&gt;Received WireFormat: WireFormatInfo { version=2, properties={StackTraceEnabled=true, TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, MaxInactivityDuration=30000, CacheEnabled=true}, magic=[A,c,t,i,v,e,M,Q]}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:40:57.888&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47305&amp;#93;&lt;/span&gt;tcp:///127.0.0.1:47305 before negotiation: OpenWireFormat&lt;/p&gt;
{version=1, cacheEnabled=false, stackTraceEnabled=false, tightEncodingEnabled=false, sizePrefixDisabled=false}&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:40:57.889&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47305&amp;#93;&lt;/span&gt;tcp:///127.0.0.1:47305 after negotiation: OpenWireFormat{version=2, cacheEnabled=true, stackTraceEnabled=true, tightEncodingEnabled=true, sizePrefixDisabled=false}&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:40:58.479&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47305&amp;#93;&lt;/span&gt;Adding consumer: ID:trabucco-47304-1156934456973-1:0:-1:1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:40:58.479&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47305&amp;#93;&lt;/span&gt;Adding consumer: ID:trabucco-47304-1156934456973-1:0:-1:1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:40:58.976&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47305&amp;#93;&lt;/span&gt;Removing consumer: ID:trabucco-47304-1156934456973-1:0:-1:1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:40:59.266&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Session Task&amp;#93;&lt;/span&gt;failed to forward message on attempt: 1 reason: javax.jms.IllegalStateException: &lt;span class=&quot;error&quot;&gt;&amp;#91;C4064&amp;#93;&lt;/span&gt;: Cannot perform operation, producer is closed. message: ActiveMQBytesMessage {commandId = 5, responseRequired = true, messageId = ID:trabucco-47304-1156934456973-1:0:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:trabucco-47304-1156934456973-1:0:1:1, destination = queue://SUNRECV, transactionId = null, expiration = 0, timestamp = 1156934458928, arrival = 0, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activeio.packet.ByteSequence@1a5e68a, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 529, properties = null, readOnlyProperties = true, readOnlyBody = true} ActiveMQBytesMessage{ bytesOut = null, dataOut = null, dataIn = null }(&lt;span class=&quot;error&quot;&gt;&amp;#91;C4064&amp;#93;&lt;/span&gt;: Cannot perform operation, producer is closed.)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:40:58.976&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47305&amp;#93;&lt;/span&gt;Removing consumer: ID:trabucco-47304-1156934456973-1:0:-1:1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:40:59.266&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Session Task&amp;#93;&lt;/span&gt;failed to forward message on attempt: 1 reason: javax.jms.IllegalStateException: &lt;span class=&quot;error&quot;&gt;&amp;#91;C4064&amp;#93;&lt;/span&gt;: Cannot perform operation, producer is closed. message: ActiveMQBytesMessage {commandId = 5, responseRequired = true, messageId = ID:trabucco-47304-1156934456973-1:0:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:trabucco-47304-1156934456973-1:0:1:1, destination = queue://SUNRECV, transactionId = null, expiration = 0, timestamp = 1156934458928, arrival = 0, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activeio.packet.ByteSequence@1a5e68a, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 529, properties = null, readOnlyProperties = true, readOnlyBody = true} ActiveMQBytesMessage{ bytesOut = null, dataOut = null, dataIn = null }(&lt;span class=&quot;error&quot;&gt;&amp;#91;C4064&amp;#93;&lt;/span&gt;: Cannot perform operation, producer is closed.)&lt;br/&gt;
*Start SunMQ again&lt;br/&gt;
** Nothing happens in activemq (as expected)&lt;br/&gt;
*Send a new message to the bridged queue.&lt;br/&gt;
** Message is not delivered to the SunMQ Broker.&lt;br/&gt;
**The jmx console shows, for the queue:&lt;br/&gt;
   ConsumerCount: 1&lt;br/&gt;
   EnqueueCount: 3&lt;br/&gt;
   DequeueCount: 3&lt;br/&gt;
   QueueSize: 2&lt;br/&gt;
**The log shows this:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:43:19.803&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport Server: tcp://localhost:61635&amp;#93;&lt;/span&gt;Sending: WireFormatInfo { version=2, properties={TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, StackTraceEnabled=true, MaxInactivityDuration=30000, CacheEnabled=true}, magic=&lt;span class=&quot;error&quot;&gt;&amp;#91;A,c,t,i,v,e,M,Q&amp;#93;&lt;/span&gt;}&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:43:19.805&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47315&amp;#93;&lt;/span&gt;Received WireFormat: WireFormatInfo { version=2, properties={StackTraceEnabled=true, TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, MaxInactivityDuration=30000, CacheEnabled=true}, magic=&lt;span class=&quot;error&quot;&gt;&amp;#91;A,c,t,i,v,e,M,Q&amp;#93;&lt;/span&gt;}&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:43:19.806&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47315&amp;#93;&lt;/span&gt;tcp:///127.0.0.1:47315 before negotiation: OpenWireFormat{version=1, cacheEnabled=false, stackTraceEnabled=false, tightEncodingEnabled=false, sizePrefixDisabled=false}
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:43:19.807&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47315&amp;#93;&lt;/span&gt;tcp:///127.0.0.1:47315 after negotiation: OpenWireFormat&lt;/p&gt;
{version=2, cacheEnabled=true, stackTraceEnabled=true, tightEncodingEnabled=true, sizePrefixDisabled=false}&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:43:19.803&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport Server: tcp://localhost:61635&amp;#93;&lt;/span&gt;Sending: WireFormatInfo { version=2, properties={TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, StackTraceEnabled=true, MaxInactivityDuration=30000, CacheEnabled=true}, magic=&lt;span class=&quot;error&quot;&gt;&amp;#91;A,c,t,i,v,e,M,Q&amp;#93;&lt;/span&gt;}&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:43:19.805&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47315&amp;#93;&lt;/span&gt;Received WireFormat: WireFormatInfo { version=2, properties={StackTraceEnabled=true, TightEncodingEnabled=true, TcpNoDelayEnabled=true, SizePrefixDisabled=false, MaxInactivityDuration=30000, CacheEnabled=true}, magic=&lt;span class=&quot;error&quot;&gt;&amp;#91;A,c,t,i,v,e,M,Q&amp;#93;&lt;/span&gt;}&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:43:19.806&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47315&amp;#93;&lt;/span&gt;tcp:///127.0.0.1:47315 before negotiation: OpenWireFormat{version=1, cacheEnabled=false, stackTraceEnabled=false, tightEncodingEnabled=false, sizePrefixDisabled=false}&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:43:19.807&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47315&amp;#93;&lt;/span&gt;tcp:///127.0.0.1:47315 after negotiation: OpenWireFormat{version=2, cacheEnabled=true, stackTraceEnabled=true, tightEncodingEnabled=true, sizePrefixDisabled=false}
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:43:20.433&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47315&amp;#93;&lt;/span&gt;Adding consumer: ID:trabucco-47314-1156934598004-1:0:-1:1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:43:20.433&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47315&amp;#93;&lt;/span&gt;Adding consumer: ID:trabucco-47314-1156934598004-1:0:-1:1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:43:20.921&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Session Task&amp;#93;&lt;/span&gt;failed to forward message on attempt: 1 reason: javax.jms.IllegalStateException: &lt;span class=&quot;error&quot;&gt;&amp;#91;C4064&amp;#93;&lt;/span&gt;: Cannot perform operation, producer is closed. message: ActiveMQBytesMessage &lt;/p&gt;
{commandId = 5, responseRequired = true, messageId = ID:trabucco-47314-1156934598004-1:0:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:trabucco-47314-1156934598004-1:0:1:1, destination = queue://SUNRECV, transactionId = null, expiration = 0, timestamp = 1156934600848, arrival = 0, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activeio.packet.ByteSequence@1e29b99, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 529, properties = null, readOnlyProperties = true, readOnlyBody = true}
&lt;p&gt; ActiveMQBytesMessage&lt;/p&gt;
{ bytesOut = null, dataOut = null, dataIn = null }(&lt;span class=&quot;error&quot;&gt;&amp;#91;C4064&amp;#93;&lt;/span&gt;: Cannot perform operation, producer is closed.)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:43:20.933&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47315&amp;#93;&lt;/span&gt;Removing consumer: ID:trabucco-47314-1156934598004-1:0:-1:1&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:43:20.921&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Session Task&amp;#93;&lt;/span&gt;failed to forward message on attempt: 1 reason: javax.jms.IllegalStateException: &lt;span class=&quot;error&quot;&gt;&amp;#91;C4064&amp;#93;&lt;/span&gt;: Cannot perform operation, producer is closed. message: ActiveMQBytesMessage {commandId = 5, responseRequired = true, messageId = ID:trabucco-47314-1156934598004-1:0:1:1:1, originalDestination = null, originalTransactionId = null, producerId = ID:trabucco-47314-1156934598004-1:0:1:1, destination = queue://SUNRECV, transactionId = null, expiration = 0, timestamp = 1156934600848, arrival = 0, correlationId = null, replyTo = null, persistent = true, type = null, priority = 4, groupID = null, groupSequence = 0, targetConsumerId = null, compressed = false, userID = null, content = org.apache.activeio.packet.ByteSequence@1e29b99, marshalledProperties = null, dataStructure = null, redeliveryCounter = 0, size = 529, properties = null, readOnlyProperties = true, readOnlyBody = true} ActiveMQBytesMessage{ bytesOut = null, dataOut = null, dataIn = null }
&lt;p&gt;(&lt;span class=&quot;error&quot;&gt;&amp;#91;C4064&amp;#93;&lt;/span&gt;: Cannot perform operation, producer is closed.)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;2006/08/30.12:43:20.933&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:47315&amp;#93;&lt;/span&gt;Removing consumer: ID:trabucco-47314-1156934598004-1:0:-1:1&lt;/p&gt;&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Furthermore, after restarting the activeMQ broker with non delivered messages in the bridged queue, can lead to lose those messages.&lt;/p&gt;

&lt;p&gt;Regards&lt;/p&gt;</comment>
                            <comment id="12938463" author="kaitchuc" created="Thu, 21 Sep 2006 21:03:54 +0000"  >&lt;p&gt;This patch fixes what appears to be a bug in the origional fix. I have not yet been able to test it, as I have not yet setup a system to reproduce the problem, but can someone try it out?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="12938980" author="wrpkm" created="Thu, 12 Apr 2007 14:02:06 +0000"  >&lt;p&gt;I have come across this issue in an attempt to use the JMS to JMS bridge in version 4.1.1.&lt;/p&gt;

&lt;p&gt;I am trying to bridge ActiveMQ to Websphere MQ and I am running the bridge in its own process and everything connects and works properly.&lt;/p&gt;

&lt;p&gt;The remote Websphere MQ broker is being shutdown every night for backups and when this occurs the bridge does not see the disconnect of the remote broker.&lt;/p&gt;

&lt;p&gt;I performed a netstat of the socket connections to see if the bridge was still attempting a connection and found that the socket connections to the remote broker are in a CLOSE_WAIT state.&lt;/p&gt;

&lt;p&gt;If you have any ideas or wish to try a test I am willing to do what every is needed to resolve this issue.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;William&lt;/p&gt;</comment>
                            <comment id="12938918" author="ehelseth" created="Fri, 13 Apr 2007 08:47:45 +0000"  >&lt;p&gt;I&apos;m currently trying out a similar issue bridging ActiveMQ to Sun CAPS, but is struggling.&lt;/p&gt;

&lt;p&gt;Could you share some light and tell me how you hav configured the &quot;#REMOTE&quot; element in the XML-file. &lt;br/&gt;
Might just be helpful!&lt;/p&gt;

&lt;p&gt;br&lt;br/&gt;
-Alf&lt;/p&gt;</comment>
                            <comment id="12938999" author="mteira" created="Fri, 13 Apr 2007 09:32:41 +0000"  >&lt;p&gt;It was a little tricked, perhaps caused by my ignorance, but I didn&apos;t find a suitable way to directly create a bean for the sunmq broker, as broker hostname and port are configured using a common method: setProperty. &lt;br/&gt;
So, I had to write a simple wrapper to adapt it to have standard setters. like this:&lt;/p&gt;

&lt;p&gt;package es.tid.planb.spci.sunmq;&lt;/p&gt;

&lt;p&gt;import com.sun.messaging.ConnectionFactory;&lt;br/&gt;
import com.sun.messaging.ConnectionConfiguration;&lt;br/&gt;
import javax.jms.JMSException;&lt;/p&gt;

&lt;p&gt;public class ConnectionFactoryBean extends com.sun.messaging.QueueConnectionFactory&lt;br/&gt;
{&lt;br/&gt;
    public ConnectionFactoryBean()&lt;/p&gt;
    {
        super();
    }

&lt;p&gt;    public void setBrokerHostName( String hostname )&lt;br/&gt;
        throws JMSException&lt;/p&gt;
    {
        super.setProperty( ConnectionConfiguration.imqBrokerHostName,
                           hostname );
    }

&lt;p&gt;    public void setBrokerHostPort( String port )&lt;br/&gt;
        throws JMSException&lt;/p&gt;
    {
        super.setProperty( ConnectionConfiguration.imqBrokerHostPort,
                           port );
    }


&lt;p&gt;    public String getBrokerHostName()&lt;br/&gt;
        throws JMSException&lt;/p&gt;
    {
        return super.getProperty( ConnectionConfiguration.imqBrokerHostName );
    }

&lt;p&gt;    public String getBrokerHostPort()&lt;br/&gt;
        throws JMSException&lt;/p&gt;
    {
        return super.getProperty( ConnectionConfiguration.imqBrokerHostPort );
    }
&lt;p&gt;}&lt;/p&gt;



&lt;p&gt;And then, use it in a bean like this:&lt;/p&gt;

&lt;p&gt;  &amp;lt;bean id=&quot;REMOTE&quot;&lt;br/&gt;
        class=&quot;es.tid.planb.spci.sunmq.ConnectionFactoryBean&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;brokerHostName&quot; value=&quot;localhost&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;brokerHostPort&quot; value=&quot;7676&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;/bean&amp;gt;&lt;/p&gt;


&lt;p&gt;Regards.&lt;/p&gt;
</comment>
                            <comment id="12938932" author="wrpkm" created="Fri, 13 Apr 2007 13:31:49 +0000"  >&lt;p&gt;Alf,&lt;/p&gt;

&lt;p&gt;Here is the bridge settings that I am using for Websphere MQ.&lt;/p&gt;

&lt;p&gt;        &amp;lt;jmsQueueConnector name=&quot;bridge-test-request&quot;                                               &lt;br/&gt;
                                   outboundQueueConnectionFactory=&quot;#remoteFactory&quot;                                                  &lt;br/&gt;
                                                   localPassword=&quot;test2&quot;&lt;br/&gt;
                                   localQueueConnectionFactory=&quot;#localFactory&quot;&lt;br/&gt;
                                                   localUsername=&quot;test2&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;inboundQueueBridges&amp;gt;&lt;br/&gt;
                        &amp;lt;inboundQueueBridge&lt;br/&gt;
                                  localQueueName=&quot;test.request&quot;&lt;br/&gt;
                          inboundQueueName=&quot;queue:///SIT.TEST.REQ&quot; /&amp;gt;&lt;br/&gt;
                &amp;lt;/inboundQueueBridges&amp;gt;&lt;br/&gt;
        &amp;lt;/jmsQueueConnector&amp;gt;&lt;/p&gt;

&lt;p&gt;        &amp;lt;jmsQueueConnector name=&quot;bridge-test-response&quot;&lt;br/&gt;
                                   outboundQueueConnectionFactory=&quot;#remoteFactory&quot;&lt;br/&gt;
                                                   localPassword=&quot;test4&quot;&lt;br/&gt;
                                   localQueueConnectionFactory=&quot;#localFactory&quot;&lt;br/&gt;
                                                   localUsername=&quot;test4&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;outboundQueueBridges&amp;gt;&lt;br/&gt;
                        &amp;lt;outboundQueueBridge&lt;br/&gt;
                                  localQueueName=&quot;test.response&quot;&lt;br/&gt;
                          outboundQueueName=&quot;queue:///SIT.TEST.RSP&quot; /&amp;gt;&lt;br/&gt;
                &amp;lt;/outboundQueueBridges&amp;gt;&lt;br/&gt;
        &amp;lt;/jmsQueueConnector&amp;gt;&lt;/p&gt;


&lt;p&gt;&amp;lt;bean id=&quot;remoteFactory&quot;&lt;br/&gt;
  class=&quot;com.ibm.mq.jms.MQQueueConnectionFactory&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;property name=&quot;transportType&quot; value=&quot;1&quot; /&amp;gt;&lt;br/&gt;
  &amp;lt;property name=&quot;hostName&quot; value=&quot;127.0.0.1&quot; /&amp;gt;&lt;br/&gt;
  &amp;lt;property name=&quot;port&quot; value=&quot;9876&quot; /&amp;gt;&lt;br/&gt;
  &amp;lt;property name=&quot;queueManager&quot; value=&quot;QMUAT&quot; /&amp;gt;&lt;br/&gt;
  &amp;lt;property name=&quot;channel&quot; value=&quot;SIT.UAT.SVR&quot; /&amp;gt;&lt;br/&gt;
&amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;I hope this helps.&lt;/p&gt;

&lt;p&gt;Thx,&lt;br/&gt;
William&lt;/p&gt;</comment>
                            <comment id="12938992" author="ehelseth" created="Fri, 13 Apr 2007 13:43:04 +0000"  >&lt;p&gt;Thanks, that really helped me a lot!&lt;/p&gt;

&lt;p&gt;I was now able to create a simple wrapper similar to yours and managed finally to make i all work.&lt;br/&gt;
Am wrapping around the class com.stc.jms.client.STCQueueConnectionFactory (from JCAPS), and this must have hostname &amp;amp; port number in the constructor. Handled this by hard-coding these values in the wrapper so far, but would like to fetch these from properties as well, but don&apos;t  know how...?&lt;br/&gt;
Like this:&lt;/p&gt;

&lt;p&gt;public class connectionFactoryWrapper extends com.stc.jms.client.STCQueueConnectionFactory {&lt;/p&gt;

&lt;p&gt;    public connectionFactoryWrapper() throws JMSException&lt;/p&gt;
    { 
        super(&quot;localhost&quot;, 18007); 
    }
&lt;p&gt;....&lt;/p&gt;



&lt;p&gt;Then the bridging works only one way, namely from AMQ to JCAPS. &lt;br/&gt;
The other way AMQ gets a ClassCastException upon receiving the message from the JCAPS queue:&lt;/p&gt;

&lt;p&gt;ERROR DestinationBridge              - failed to forward message on attempt: 1 reason: java.lang.ClassCastException: org.apache.activemq.command.ActiveMQQueue message: com.stc.jms.message.STCTextMessage@1e22632 &lt;br/&gt;
java.lang.ClassCastException: org.apache.activemq.command.ActiveMQQueue&lt;br/&gt;
        at com.stc.jms.message.STCMessage.setJMSDestination(STCMessage.java:611)&lt;br/&gt;
        at org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1505)&lt;br/&gt;
        at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:465)&lt;br/&gt;
        at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:415)&lt;br/&gt;
        at org.apache.activemq.ActiveMQQueueSender.send(ActiveMQQueueSender.java:116)&lt;br/&gt;
        at org.apache.activemq.network.jms.QueueBridge.sendMessage(QueueBridge.java:87)&lt;br/&gt;
        at org.apache.activemq.network.jms.DestinationBridge.onMessage(DestinationBridge.java:134)&lt;br/&gt;
        at com.stc.jms.client.SessionImpl.processAsyncDataAvailable(SessionImpl.java:1659)&lt;br/&gt;
        at com.stc.jms.client.SessionImpl.processAsync(SessionImpl.java:1748)&lt;br/&gt;
        at com.stc.jms.client.SessionImpl.asyncEnter(SessionImpl.java:1776)&lt;br/&gt;
        at com.stc.jms.client.SessionImpl.access$500(SessionImpl.java:56)&lt;br/&gt;
        at com.stc.jms.client.SessionImpl$3.run(SessionImpl.java:1899)&lt;br/&gt;
        at com.stc.jms.client.SessionImpl$2.run(SessionImpl.java:1807)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:595)&lt;/p&gt;


&lt;p&gt;The problem seems to be the STCTextMessage class, is it possible to handle this in some way?&lt;/p&gt;


&lt;p&gt;Regards&lt;br/&gt;
-Alf&lt;/p&gt;</comment>
                            <comment id="12939004" author="mteira" created="Mon, 16 Apr 2007 12:57:03 +0000"  >&lt;p&gt;I think you don&apos;t need to wrap  STCQueueConnectionFactory, as it provides a constructor with the required arguments, and spring is able to handle that directly. That is not the case for imq, that doesn&apos;t have such a constructor neither the required setters. It should be enough for you to use:&lt;/p&gt;

&lt;p&gt;&amp;lt;bean id=&quot;REMOTE&quot;&lt;br/&gt;
class=&quot;com.stc.jms.client.STCQueueConnectionFactory&quot;&amp;gt;&lt;br/&gt;
  &amp;lt;constructor-arg&amp;gt;&amp;lt;value&amp;gt;localhost&amp;lt;/value&amp;gt;&amp;lt;/constructor-arg&amp;gt;&lt;br/&gt;
  &amp;lt;constructor-arg&amp;gt;&amp;lt;value&amp;gt;18007&amp;lt;/value&amp;gt;&amp;lt;/constructor-arg&amp;gt;&lt;br/&gt;
&amp;lt;/bean&amp;gt;&lt;/p&gt;

&lt;p&gt;About the error you get, it seems you&apos;re trying to handle directly a STC message implementation using AMQ. That&apos;s not the right way. The bridge should automatically convert incoming messages to the AMQ native types. You shouldn&apos;t need to use directly the STC nor AMQ Message classes, just ask for java.jmx.Message or javax.jms.TextMessage to your consumers. The AMQ broker will redirect incoming messages from the bridged foreign broker to your program, and they will internally be AMQ* types, but you shouln&apos;t need to be aware of that.&lt;/p&gt;</comment>
                            <comment id="12938995" author="ehelseth" created="Tue, 17 Apr 2007 13:03:13 +0000"  >&lt;p&gt;Thanks Manuel!&lt;/p&gt;

&lt;p&gt;I now got rid of the wrapper, the &amp;lt;constructor-arg&amp;gt; stuff worked out just fine!&lt;/p&gt;

&lt;p&gt;So to the ClassCastException, it really comes from the ActiveMQ program itself, the moment I try to send a message into the queue on the JCAPS broker queue that is defined to be inboundQueueName, and the bridge tries to fetch it into AMQ.&lt;br/&gt;
The other way around messages (sendt to the outboundQueueName on AMQ) are bridged correctly over to JCAPS.&lt;/p&gt;

&lt;p&gt;The consumer/provider programs are using javax.jms.TextMessage as contents. &lt;br/&gt;
I have also tried to use the JMXConsole connected to AMQ for sending simple test messages.&lt;/p&gt;

&lt;p&gt;You says that the bridge should automatically convert incoming messages to native AMQ - seems to me that that&apos;s where the error occurs ?&lt;/p&gt;

&lt;p&gt;Br&lt;br/&gt;
Alf (with steep learning curve regarding ActiveMQ...)&lt;/p&gt;</comment>
                            <comment id="12938996" author="mteira" created="Tue, 17 Apr 2007 13:12:14 +0000"  >&lt;p&gt;Be careful with your jndi properties. Perhaps you&apos;re trying to connect directly to the JCAPS broker, and that&apos;s a mistake. AMQ should make that job for you: you only need to send the message to the local AMQ queue you&apos;re mapping to the remote bridge (and hence, use the proper jndi.properties to do so), and the broker will automatically forward the message to the foreign broker.&lt;/p&gt;

&lt;p&gt;You can even try it using the AMQ JMX console, and try to send a message to the mapped queue, if you want to test it easily.&lt;/p&gt;

&lt;p&gt;Hope it works.&lt;/p&gt;


</comment>
                            <comment id="12936575" author="ehelseth" created="Wed, 18 Apr 2007 06:59:18 +0000"  >&lt;p&gt;Thanks Manuel for your patient replies!&lt;/p&gt;

&lt;p&gt;I think I&apos;ve been a bit unclear about this and how the problems I discover occurs. I&apos;ll try to clearify:&lt;br/&gt;
I&apos;m trying to bridge from AMQ to JCAPS, one queue as outbound, and one queue to be bridged the opposite direction, from JCAPS to AMQ (setting it up as AMQ inbound queue). Here is a snippet from the activemq.xml-file:&lt;/p&gt;

&lt;p&gt;&amp;lt;jmsBridgeConnectors&amp;gt;&lt;br/&gt;
    &amp;lt;jmsQueueConnector&lt;br/&gt;
      outboundQueueConnectionFactory=&quot;#remoteFactory&quot;&amp;gt;&lt;br/&gt;
      &amp;lt;inboundQueueBridges&amp;gt;&lt;br/&gt;
        &amp;lt;inboundQueueBridge&lt;br/&gt;
          inboundQueueName=&quot;quBridgeFromJCAPS&quot; /&amp;gt;&lt;br/&gt;
      &amp;lt;/inboundQueueBridges&amp;gt;&lt;br/&gt;
      &amp;lt;outboundQueueBridges&amp;gt;&lt;br/&gt;
        &amp;lt;outboundQueueBridge&lt;br/&gt;
          outboundQueueName=&quot;quBridgeToJCAPS&quot; /&amp;gt;&lt;br/&gt;
      &amp;lt;/outboundQueueBridges&amp;gt;&lt;br/&gt;
    &amp;lt;/jmsQueueConnector&amp;gt;&lt;br/&gt;
  &amp;lt;/jmsBridgeConnectors&amp;gt;&lt;br/&gt;
...&lt;br/&gt;
  &amp;lt;bean id=&quot;remoteFactory&quot;&lt;br/&gt;
     class=&quot;com.stc.jms.client.STCQueueConnectionFactory&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;constructor-arg value=&quot;localhost&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;constructor-arg value=&quot;18007&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;/bean&amp;gt;&lt;/p&gt;


&lt;p&gt;Now for tesing both the AMQ broker and the JCAPS broker is running on localhost.&lt;/p&gt;

&lt;p&gt;I&apos;ve made simple &quot;clients&quot; to send messages to the local brokers, one for AMQ and one for JCAPS. They both send jmx.jms.TextMessages. Here is a snippet of the clients:&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Put a message on a STC queue&lt;/li&gt;
	&lt;li&gt;@author alfeh Mar 9, 2007&lt;br/&gt;
     */&lt;br/&gt;
    private void sendMsg() throws Exception 
{
        QueueConnectionFactory qcf = new STCQueueConnectionFactory(&quot;localhost&quot;, 18007);
        conn = qcf.createQueueConnection();
        conn.start();
        QueueSession sess = conn.createQueueSession(true, Session.AUTO_ACKNOWLEDGE);
        Queue q = sess.createQueue(&quot;quTest1&quot;);
        QueueSender sender = sess.createSender(q);
        TextMessage msg = sess.createTextMessage(&quot;Hello to the world!!!&quot;);
        msg.getText();
        sender.send(msg);
        sess.commit();
        System.out.println(&quot;Sendt message &apos;&quot; + msg.getText() + &quot;&apos;&quot;);
        sess.close();
        conn.close();
    }&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Put a message on a AMQ queue&lt;/li&gt;
	&lt;li&gt;@author alfeh Mar 9, 2007&lt;br/&gt;
     */&lt;br/&gt;
    private void sendMsg() throws Exception 
{
        conn = ActiveMQConnection.makeConnection(&quot;tcp://localhost:62616&quot;);
        conn.start();
        QueueSession sess = conn.createQueueSession(true, Session.AUTO_ACKNOWLEDGE);
        Queue q = sess.createQueue(&quot;quBridgeToJCAPS&quot;);
        QueueSender sender = sess.createSender(q);
        TextMessage msg = sess.createTextMessage(&quot;Hello to the world!!!&quot;);
        msg.getText();
        sender.send(msg);
        sess.commit();
        System.out.println(&quot;Sendt message &apos;&quot; + msg.getText() + &quot;&apos;&quot;);
        sess.close();
        conn.close();
    }&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Pretty simple and stright-forward I think, and seems to be working OK regarding posting the messages to the &quot;local&quot; brokers.&lt;br/&gt;
In addittion, I can send messages to the AMQ broker via the JMXConsole, and the JCAPS broker has its own WEB GUI (Enterprise Manager), and it can be used for sending and reading messages on that broker.&lt;/p&gt;

&lt;p&gt;When I fire it all up (first the JCAPS broker then the AMQ broker) it all seems OK.&lt;br/&gt;
The AMQ&apos;s inbound bridge queue (quBridgeFromJCAPS) is created inside the JCAPS broker upon first startup of AMQ.&lt;/p&gt;

&lt;p&gt;The problem occurs after successfully posting a message onto that queue on the JCAPS broker.&lt;br/&gt;
AMQ seems to try to bridge it into the AMQ&apos;s quBridgeFromJCAPS, causing the exception to be thrown from inside the AMQ code. No message arrives to the AMQ queue, but seems to be thrown back to the JCAPS queue (which ends up with two copies of that same message). The exception is shown in a previous post, and is thrown from line 1505 in class ActiveMQSession.&lt;br/&gt;
Here is a snippet of that code:&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Sends the message for dispatch by the broker.&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;@param producer -&lt;/li&gt;
	&lt;li&gt;message producer.&lt;/li&gt;
	&lt;li&gt;@param destination -&lt;/li&gt;
	&lt;li&gt;message destination.&lt;/li&gt;
	&lt;li&gt;@param message -&lt;/li&gt;
	&lt;li&gt;message to be sent.&lt;/li&gt;
	&lt;li&gt;@param deliveryMode -&lt;/li&gt;
	&lt;li&gt;JMS messsage delivery mode.&lt;/li&gt;
	&lt;li&gt;@param priority -&lt;/li&gt;
	&lt;li&gt;message priority.&lt;/li&gt;
	&lt;li&gt;@param timeToLive -&lt;/li&gt;
	&lt;li&gt;message expiration.&lt;/li&gt;
	&lt;li&gt;@throws JMSException&lt;br/&gt;
     */&lt;br/&gt;
    protected void send(ActiveMQMessageProducer producer, ActiveMQDestination destination, Message message, int deliveryMode,&lt;br/&gt;
            int priority, long timeToLive) throws JMSException {&lt;br/&gt;
        checkClosed();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;        if( destination.isTemporary() &amp;amp;&amp;amp; connection.isDeleted(destination) ) &lt;/p&gt;
{
            throw new JMSException(&quot;Cannot publish to a deleted Destination: &quot;+destination);
        }

&lt;p&gt;        // tell the Broker we are about to start a new transaction&lt;br/&gt;
        doStartTransaction();&lt;br/&gt;
        TransactionId txid = transactionContext.getTransactionId();&lt;/p&gt;

&lt;p&gt;        message.setJMSDestination(destination); // (###### This is line 1505, here is the exception thrown! ###)&lt;br/&gt;
        message.setJMSDeliveryMode(deliveryMode);        &lt;br/&gt;
        long expiration = 0L;&lt;/p&gt;

&lt;p&gt;        if (!producer.getDisableMessageTimestamp()) {&lt;br/&gt;
            long timeStamp = System.currentTimeMillis();&lt;br/&gt;
            message.setJMSTimestamp(timeStamp);&lt;br/&gt;
            if (timeToLive &amp;gt; 0) &lt;/p&gt;
{
                expiration = timeToLive + timeStamp;
            }
&lt;p&gt;        }&lt;br/&gt;
.....&lt;/p&gt;




&lt;p&gt;If I on the other hand try to send a message into the AMQ broker&apos;s outbound queue (quBridgeToJCAPS) (e.g with the JMXConsole) it imidiately shows up in the JCAPS broker (queue with the same name) and the contents seems OK.&lt;/p&gt;

&lt;p&gt;See ? 50% success... would like to reach 100%...!&lt;/p&gt;

&lt;p&gt;Any ideas?&lt;/p&gt;

&lt;p&gt;Br&lt;br/&gt;
-Alf&lt;/p&gt;</comment>
                            <comment id="12936683" author="mteira" created="Wed, 18 Apr 2007 07:40:22 +0000"  >&lt;p&gt;It looks correct to me, both the code and the experiment.&lt;/p&gt;

&lt;p&gt;I&apos;m afraid I don&apos;t know the reason, but I&apos;m not activemq skilled. &lt;/p&gt;

&lt;p&gt;Looking at the exception stack, it seems that what activemq has is a JCAPS client running, listening for messages on that queue. When one of those messages arrive, it is redelivered to the activemq queue, and it seems that when it tries to do so, the message (of type com.stc.jms.message.STCTextMessage) does not accept to be set a destination of type org.apache.activemq.command.ActiveMQQueue in message.setJMSDestination(destination);&lt;/p&gt;

&lt;p&gt;I don&apos;t know if this should work, (i.e: a message should accept any  javax.jms.Destination regardless of its implementation) or perhaps the problem is that the JCAPS code is not aware of org.apache.activemq.command.ActiveMQQueue as a javax.jms.Destination implementation (some classpath issue?)&lt;/p&gt;

&lt;p&gt;Perhaps asking in the mail list ?&lt;/p&gt;

&lt;p&gt;Best regards&lt;/p&gt;</comment>
                            <comment id="12938908" author="ehelseth" created="Wed, 18 Apr 2007 13:02:00 +0000"  >&lt;p&gt;Seems that you&apos;re all right Manuel.&lt;/p&gt;

&lt;p&gt;It is not possible to read a message from JCAPS (type com.stc.jms.message.STCTextMessage) and send it to a AMQ queue. &lt;br/&gt;
The opposite direction is no problem.&lt;/p&gt;

&lt;p&gt;I&apos;ve tried to do the same outside the AMQ bridge (in a simple Java application) (reading from an JCAPS queue and posting the same message to a AMQ queue), and the same exception occurs.&lt;/p&gt;

&lt;p&gt;Might be some non-JMS-standard behaviour of the JCAPS messages?&lt;/p&gt;

&lt;p&gt;I&apos;ve been able to kind of &quot;go around&quot; the problem in my Java app, by creating a new (native AMQ) message and copy all the values &amp;amp; settings from the JCAPS message. &lt;br/&gt;
But that is not the preferred way to go...&lt;/p&gt;

&lt;p&gt;Thanks again for help &amp;amp; advices!&lt;/p&gt;



&lt;p&gt;BR&lt;br/&gt;
-Alf&lt;/p&gt;</comment>
                            <comment id="12939051" author="ngzax" created="Mon, 17 Sep 2007 20:44:08 +0000"  >&lt;p&gt;I have just tested this patch on my ActiveMQ-5.0-SNAPSHOT, rev 554694 broker bridged to SonicMQ 7.5 and it does NOT work.&lt;/p&gt;

&lt;p&gt;It does try to reconnect 10 times, but they all fail.&lt;/p&gt;

&lt;p&gt;I am working on it a bit more.&lt;/p&gt;</comment>
                            <comment id="12939646" author="jsilva" created="Thu, 1 May 2008 23:36:41 +0000"  >&lt;p&gt;the attached patch has a slight error&lt;/p&gt;

&lt;p&gt;while (maximumRetries &amp;gt; 0 &amp;amp;&amp;amp; attempt &amp;gt;= maximumRetries);&lt;/p&gt;

&lt;p&gt;should be&lt;/p&gt;

&lt;p&gt;while (maximumRetries &amp;gt; 0 &amp;amp;&amp;amp; attempt &amp;lt;= maximumRetries);&lt;/p&gt;

&lt;p&gt;correct?  &lt;/p&gt;

&lt;p&gt;Even with this change, you can see the number of retries increment, but the producer does not begin sending.  I have also tried the patch in the comments of &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-1220&quot; title=&quot;2007-04-05 08:46:47,241 [ActiveMQ Transport: tcp://mymachinename:61616] WARN  org.apache.activemq.ActiveMQConnection - Async exception with no exception listener: java.io.EOFException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-1220&quot;&gt;&lt;del&gt;AMQ-1220&lt;/del&gt;&lt;/a&gt; and this actually does reconnect the bridge (no more connection failures) but the producer fails to send the messages which are enqueued during the time the foreign connection is down.  &lt;/p&gt;

&lt;p&gt;The exception in 4.1.1 is:&lt;/p&gt;

&lt;p&gt;javax.jms.IllegalStateException: The producer is closed&lt;br/&gt;
        at org.apache.activemq.ActiveMQMessageProducer.checkClosed(ActiveMQMessa&lt;br/&gt;
geProducer.java:333)&lt;br/&gt;
        at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProdu&lt;br/&gt;
cer.java:445)&lt;br/&gt;
        at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProdu&lt;br/&gt;
cer.java:415)&lt;br/&gt;
        at org.apache.activemq.ActiveMQQueueSender.send(ActiveMQQueueSender.java&lt;br/&gt;
:116)&lt;br/&gt;
        at org.apache.activemq.network.jms.QueueBridge.sendMessage(QueueBridge.j&lt;br/&gt;
ava:87)&lt;br/&gt;
        at org.apache.activemq.network.jms.DestinationBridge.onMessage(Destinati&lt;br/&gt;
onBridge.java:134)&lt;br/&gt;
        at org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageC&lt;br/&gt;
onsumer.java:854)&lt;br/&gt;
        at org.apache.activemq.ActiveMQSessionExecutor.dispatch(ActiveMQSessionE&lt;br/&gt;
xecutor.java:99)&lt;br/&gt;
        at org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionEx&lt;br/&gt;
ecutor.java:166)&lt;br/&gt;
        at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskR&lt;br/&gt;
unner.java:101)&lt;br/&gt;
        at org.apache.activemq.thread.DedicatedTaskRunner.access$000(DedicatedTa&lt;br/&gt;
skRunner.java:25)&lt;br/&gt;
        at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRun&lt;br/&gt;
ner.java:39)&lt;/p&gt;

&lt;p&gt;My foreign queue is using https if that makes a difference.&lt;/p&gt;</comment>
                            <comment id="12939672" author="jsilva" created="Mon, 12 May 2008 17:38:58 +0000"  >&lt;p&gt;This problem was solved without code changes by using the failover transport on the remote queue factory in 4.1.1, if anyone is looking for a workaround.&lt;/p&gt;</comment>
                            <comment id="12942243" author="jschmied" created="Sat, 20 Feb 2010 22:18:34 +0000"  >&lt;p&gt;See Patch at:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/activemq/browse/AMQ-2455&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/activemq/browse/AMQ-2455&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I can reconnect to a Oracle AQ Session now.&lt;/p&gt;</comment>
                            <comment id="12942536" author="gtully" created="Wed, 28 Apr 2010 13:59:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/activemq/browse/AMQ-2455&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/activemq/browse/AMQ-2455&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12482104">AMQ-1228</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12460743" name="test_patch.diff" size="3547" author="kaitchuc" created="Thu, 21 Sep 2006 21:03:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>43740</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 30 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rpzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>159855</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>