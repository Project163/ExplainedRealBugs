<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:49:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-7131] ActiveMQ JMS pool has no borrow timeout causing starvation</title>
                <link>https://issues.apache.org/jira/browse/AMQ-7131</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;A maxPoolSize of 1 can cause starvation during createConnection if the only connection gets evicted concurrently since borrow method of pool has no timeout waiting forever.&lt;/p&gt;

&lt;p&gt;Maybe introduce a new variable connectionTimeout with default 30000ms.&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13208847">AMQ-7131</key>
            <summary>ActiveMQ JMS pool has no borrow timeout causing starvation</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="graben">Benjamin Graf</assignee>
                                    <reporter username="graben">Benjamin Graf</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Jan 2019 19:18:04 +0000</created>
                <updated>Mon, 18 Oct 2021 18:03:08 +0000</updated>
                            <resolved>Sat, 29 Feb 2020 06:09:17 +0000</resolved>
                                    <version>5.15.8</version>
                                    <fixVersion>5.16.0</fixVersion>
                    <fixVersion>5.15.12</fixVersion>
                                    <component>Pool</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="7800">2h 10m</timespent>
                                <comments>
                            <comment id="16739808" author="tabish121" created="Thu, 10 Jan 2019 21:47:17 +0000"  >&lt;p&gt;Blocking and throwing an error seems like the wrong thing to do, if the connection timed out it should be replaced by a new one.&#160; Perhaps not blocking and handling the NoSuchElementException to replenish the pool entry would be a better idea.&lt;/p&gt;

&lt;p&gt;Do you have a test for this?&lt;/p&gt;</comment>
                            <comment id="16740128" author="graben" created="Fri, 11 Jan 2019 07:54:11 +0000"  >&lt;p&gt;Hi&#160;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;actually I only get this tested by manually debugging both threads causing the &quot;collision&quot; in the small open window. For me the patch with the connectionTimeout work good. Camel/Spring-jms for example immediately tries to reconnect after exception. I think most consuming frameworks will act like that. In this way a connection get created, too. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;By the way it seems extremely rare to occur, but it does.&lt;/p&gt;

&lt;p&gt;Benjamin&lt;/p&gt;</comment>
                            <comment id="16740132" author="graben" created="Fri, 11 Jan 2019 07:56:34 +0000"  >&lt;p&gt;Is the Github integration to AMQ project broken? No link to&#160;&lt;a href=&quot;https://github.com/apache/activemq/pull/335&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;PR&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16740329" author="graben" created="Fri, 11 Jan 2019 12:01:59 +0000"  >&lt;p&gt;Actually thinking about this enhancement. Feels a bit odd.&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (connection == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        connection = connectionsPool.borrowObject(key);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (NoSuchElementException ex) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;code-quote&quot;&gt;&quot;Timeout waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; idle object&quot;&lt;/span&gt;.equals(ex.getMessage())) {
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; ex;
        }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (connection != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (connection) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (connection.getConnection() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                connection.incrementReferenceCount();
                &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
            }

            &lt;span class=&quot;code-comment&quot;&gt;// Return the bad one to the pool and let &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; get destroyed as normal.
&lt;/span&gt;            connectionsPool.returnObject(key, connection);
            connection = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        }
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16744768" author="graben" created="Thu, 17 Jan 2019 07:54:26 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;, any comment to last actions?&lt;/p&gt;</comment>
                            <comment id="16745230" author="tabish121" created="Thu, 17 Jan 2019 15:50:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=graben&quot; class=&quot;user-hover&quot; rel=&quot;graben&quot;&gt;graben&lt;/a&gt; while the change looks a bit odd it isn&apos;t much worse than some of the other code in there that works around behaviours in the commons pool that clash with how a Connection pool needs to operate so that isn&apos;t as bad as one might think.&#160; The connect timeout fix seems more awkward to me because it forces a lengthy wait on something we can know is going to fail and then puts the requirement on the caller to respond appropriately to that failure.&#160; &lt;/p&gt;

&lt;p&gt;It doesn&apos;t appear there is anything else we can do in the pool configuration to prevent the key from being removed when the entries hit zero due to the single connection being evicted but maybe you want to poke around in there to see for sure.&#160;&lt;/p&gt;</comment>
                            <comment id="16745396" author="graben" created="Thu, 17 Jan 2019 19:05:53 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;well, I think it&apos;s okay this way. We can also think about your solution from messaginghub, but I&apos;m not 100% convinced that always have a min of 1 and no option to tune is better.&lt;/p&gt;

&lt;p&gt;Up to you, merging. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Benjamin&lt;/p&gt;</comment>
                            <comment id="16864702" author="graben" created="Sat, 15 Jun 2019 14:17:01 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish&quot; class=&quot;user-hover&quot; rel=&quot;tabish&quot;&gt;tabish&lt;/a&gt;,&lt;/p&gt;

&lt;p&gt;long time ago no reponse on this yet.&lt;/p&gt;

&lt;p&gt;Benjamin&lt;/p&gt;</comment>
                            <comment id="16976883" author="jbonofre" created="Mon, 18 Nov 2019 20:57:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=graben&quot; class=&quot;user-hover&quot; rel=&quot;graben&quot;&gt;graben&lt;/a&gt; PR looks good to me. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish&quot; class=&quot;user-hover&quot; rel=&quot;tabish&quot;&gt;tabish&lt;/a&gt; any comment ?&lt;/p&gt;</comment>
                            <comment id="17048205" author="jira-bot" created="Sat, 29 Feb 2020 06:07:54 +0000"  >&lt;p&gt;Commit 92dec52e1c1ecd26014fa62f5aad7072ecdbb265 in activemq&apos;s branch refs/heads/master from Benjamin Graf&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=92dec52&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=92dec52&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7131&quot; title=&quot;ActiveMQ JMS pool has no borrow timeout causing starvation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7131&quot;&gt;&lt;del&gt;AMQ-7131&lt;/del&gt;&lt;/a&gt; Add connectionTimeout to avoid starvation&lt;/p&gt;</comment>
                            <comment id="17048206" author="jira-bot" created="Sat, 29 Feb 2020 06:07:56 +0000"  >&lt;p&gt;Commit ce6fc913f9cbbc0cb6c2caa54c048153ab82b3ba in activemq&apos;s branch refs/heads/master from Jean-Baptiste Onofr&#233;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=ce6fc91&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=ce6fc91&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #477 from jbonofre/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7131&quot; title=&quot;ActiveMQ JMS pool has no borrow timeout causing starvation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7131&quot;&gt;&lt;del&gt;AMQ-7131&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7131&quot; title=&quot;ActiveMQ JMS pool has no borrow timeout causing starvation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7131&quot;&gt;&lt;del&gt;AMQ-7131&lt;/del&gt;&lt;/a&gt; Add connectionTimeout to avoid starvation&lt;/p&gt;</comment>
                            <comment id="17048207" author="jira-bot" created="Sat, 29 Feb 2020 06:07:59 +0000"  >&lt;p&gt;Commit ce6fc913f9cbbc0cb6c2caa54c048153ab82b3ba in activemq&apos;s branch refs/heads/master from Jean-Baptiste Onofr&#233;&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=ce6fc91&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=ce6fc91&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge pull request #477 from jbonofre/&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7131&quot; title=&quot;ActiveMQ JMS pool has no borrow timeout causing starvation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7131&quot;&gt;&lt;del&gt;AMQ-7131&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7131&quot; title=&quot;ActiveMQ JMS pool has no borrow timeout causing starvation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7131&quot;&gt;&lt;del&gt;AMQ-7131&lt;/del&gt;&lt;/a&gt; Add connectionTimeout to avoid starvation&lt;/p&gt;</comment>
                            <comment id="17048208" author="jira-bot" created="Sat, 29 Feb 2020 06:09:07 +0000"  >&lt;p&gt;Commit 314d898ebbd41434c95ec337df598b07a9bcd60e in activemq&apos;s branch refs/heads/activemq-5.15.x from Benjamin Graf&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=314d898&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=314d898&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7131&quot; title=&quot;ActiveMQ JMS pool has no borrow timeout causing starvation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7131&quot;&gt;&lt;del&gt;AMQ-7131&lt;/del&gt;&lt;/a&gt; Add connectionTimeout to avoid starvation&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 92dec52e1c1ecd26014fa62f5aad7072ecdbb265)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 37 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|u00pw8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>