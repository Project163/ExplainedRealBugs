<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:58:53 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4392] MQTT BlockingConnection disconnect doesn&apos;t disconnects the client connection</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4392</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;The disconnect method doesn&apos;t work (especially when a client id is supplied).&lt;/p&gt;

&lt;p&gt;If the connection object is reused, the client throws the following exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.lang.IllegalStateException: Already connected
	at org.fusesource.mqtt.client.CallbackConnection.connect(CallbackConnection.java:109)
	at org.fusesource.mqtt.client.FutureConnection$2.run(FutureConnection.java:94)
	at org.fusesource.hawtdispatch.internal.SerialDispatchQueue.run(SerialDispatchQueue.java:96)
	at org.fusesource.hawtdispatch.internal.pool.SimpleThread.run(SimpleThread.java:77)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the connection object is not reused and the client id is, the client throws the following exception:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.io.IOException: Could not connect: CONNECTION_REFUSED_SERVER_UNAVAILABLE
	at org.fusesource.mqtt.client.CallbackConnection$LoginHandler$1.onTransportCommand(CallbackConnection.java:313)
	at org.fusesource.hawtdispatch.transport.TcpTransport.drainInbound(TcpTransport.java:660)
	at org.fusesource.hawtdispatch.transport.TcpTransport$6.run(TcpTransport.java:538)
	at org.fusesource.hawtdispatch.internal.NioDispatchSource$3.run(NioDispatchSource.java:226)
	at org.fusesource.hawtdispatch.internal.SerialDispatchQueue.run(SerialDispatchQueue.java:96)
	at org.fusesource.hawtdispatch.internal.pool.SimpleThread.run(SimpleThread.java:77)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and, the server logs the following messages:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-03-20 11:36:04,893 WARN  [org.apache.activemq.broker.TransportConnection] (ActiveMQ Transport: tcp:///192.168.205.2:59401@1883) Failed to add Connection ID:TestServer-58505-1363685123521-2:34, reason: javax.jms.InvalidClientIDException: Broker: localhost - Client: test_id already connected from tcp://192.168.205.2:59398
2013-03-20 11:36:04,893 WARN  [org.apache.activemq.broker.TransportConnection.Transport] (ActiveMQ Transport: tcp:///192.168.205.2:59401@1883) Transport Connection to: tcp://192.168.205.2:59401 failed: java.io.IOException: Broker: localhost - Client: test_id already connected from tcp://192.168.205.2:59398
2013-03-20 11:37:59,867 WARN  [org.apache.activemq.broker.TransportConnection.Transport] (MQTTInactivityMonitor Async Task: java.util.concurrent.ThreadPoolExecutor$Worker@c7892e[State = 0, empty queue]) Transport Connection to: tcp://192.168.205.2:59398 failed: org.apache.activemq.transport.InactivityIOException: Channel was inactive for too (&amp;gt;45000) long: tcp://192.168.205.2:59398
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;Code example (reusing connection):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;MQTT mqtt = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MQTT();
mqtt.setHost(url);
mqtt.setUserName(user);
mqtt.setPassword(password);
BlockingConnection connection = mqtt.blockingConnection();

&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0;
&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
	connection.connect();
	&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; message = &lt;span class=&quot;code-quote&quot;&gt;&quot;TestMessage: &quot;&lt;/span&gt; + i;
	connection.publish(&lt;span class=&quot;code-quote&quot;&gt;&quot;VendorOrderTopic&quot;&lt;/span&gt;, message.getBytes(), QoS.AT_LEAST_ONCE, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
	&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Vendor: Sent message.&quot;&lt;/span&gt;);

	&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(2500);
	connection.disconnect();
	&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(2500);
	i++;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Code example (multiple connections):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;MQTT mqtt = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MQTT();
mqtt.setHost(url);
mqtt.setUserName(user);
mqtt.setPassword(password);
mqtt.setClientId(&lt;span class=&quot;code-quote&quot;&gt;&quot;test_id&quot;&lt;/span&gt;);

&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0;
&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
	BlockingConnection connection = mqtt.blockingConnection();
	connection.connect();
	&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; message = &lt;span class=&quot;code-quote&quot;&gt;&quot;TestMessage: &quot;&lt;/span&gt; + i;
	connection.publish(&lt;span class=&quot;code-quote&quot;&gt;&quot;VendorOrderTopic&quot;&lt;/span&gt;, message.getBytes(), QoS.AT_LEAST_ONCE, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
	&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;Vendor: Sent message.&quot;&lt;/span&gt;);

	&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(2500);
	connection.disconnect();
	&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(2500);
	i++;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This problem also occurs when using the eclipse paho client API.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12637972">AMQ-4392</key>
            <summary>MQTT BlockingConnection disconnect doesn&apos;t disconnects the client connection</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="pmarques">Pedro Marques</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Mar 2013 13:08:00 +0000</created>
                <updated>Tue, 23 Apr 2013 17:04:32 +0000</updated>
                            <resolved>Wed, 20 Mar 2013 15:57:24 +0000</resolved>
                                    <version>5.8.0</version>
                                    <fixVersion>5.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13607731" author="tabish121" created="Wed, 20 Mar 2013 15:39:14 +0000"  >&lt;p&gt;In the case of the first code snippet it appears to be a client issue, the broker is registering the disconnect, but the client doesn&apos;t seem to reset itself to a usable state as the second connect call never reaches the broker.&lt;/p&gt;

&lt;p&gt;In the second snippet there appears to be a bug on the Broker side. &lt;/p&gt;</comment>
                            <comment id="13607761" author="tabish121" created="Wed, 20 Mar 2013 15:57:02 +0000"  >&lt;p&gt;Fixed, client&apos;s weren&apos;t getting unregistered from the Broker. Still will see issues with your first case since its on the client end, but the second case should be better now. &lt;/p&gt;</comment>
                            <comment id="13607762" author="tabish121" created="Wed, 20 Mar 2013 15:57:24 +0000"  >&lt;p&gt;Fixed on trunk, will be in the next nightly. &lt;/p&gt;</comment>
                            <comment id="13637519" author="minkim" created="Sun, 21 Apr 2013 09:33:21 +0000"  >&lt;p&gt;I could be wrong about this, but don&apos;t you need to do the same in onTransportError() as well?&lt;/p&gt;

&lt;p&gt;onTransportError() called from the inactivity monitor would also not unregister from the broker properly. right?&lt;/p&gt;</comment>
                            <comment id="13639243" author="tabish121" created="Tue, 23 Apr 2013 17:04:32 +0000"  >&lt;p&gt;If you believe that there are lingering issues then the way to determine is with a test cause that validates your assumptions.  &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>318450</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1iy4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>318791</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>