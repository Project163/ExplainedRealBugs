<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:52:28 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2730] Transport failed: java.io.EOFException</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2730</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;We see many Exceptions of this type in the broker logs: &lt;br/&gt;
2010-05-12 14:10:03,490 | DEBUG | Transport failed: java.io.EOFException | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ Transport: tcp:///10.231.233.55:50809&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at java.io.DataInputStream.readInt(DataInputStream.java:375)&lt;br/&gt;
        at org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:269)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:211)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:203)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:186)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;This exception occurs with a lot of clients that run on different machines.&lt;/p&gt;

&lt;p&gt;One case where we almost always see this exception is when shutting down a bridge. We did a tcp dump on the broker and on the client machine: there a no packets lost.&lt;/p&gt;


&lt;p&gt;LOG ON BRIDGE:&lt;br/&gt;
2010-05-12 14:10:02,634 INFO  org.apache.activemq.broker.BrokerService - ActiveMQ Message Broker (solr-2073bridge, ID:solr-2073-50804-&lt;br/&gt;
1273665033782-0:0) is shutting down&lt;br/&gt;
2010-05-12 14:10:02,799 INFO  org.apache.activemq.network.jms.JmsConnector - JMS Connector Connector:0 Stopped&lt;br/&gt;
2010-05-12 14:10:02,819 INFO  org.apache.activemq.broker.BrokerService - ActiveMQ JMS Message Broker (solr-2073bridge, ID:solr-2073-50&lt;br/&gt;
804-1273665033782-0:0) stopped&lt;/p&gt;

&lt;p&gt;LOG ON BROKER:&lt;br/&gt;
2010-05-12 14:10:03,490 | DEBUG | Transport failed: java.io.EOFException | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ Transport: tcp:///10.231.233.55:50809&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at java.io.DataInputStream.readInt(DataInputStream.java:375)&lt;br/&gt;
        at org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:269)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:211)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:203)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:186)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
2010-05-12 14:10:03,492 | DEBUG | Stopping connection: /10.231.233.55:50809 | org.apache.activemq.broker.TransportConnection | ActiveMQ Task&lt;br/&gt;
2010-05-12 14:10:03,492 | DEBUG | Stopping transport tcp:///10.231.233.55:50809 | org.apache.activemq.transport.tcp.TcpTransport | ActiveMQ Task&lt;br/&gt;
2010-05-12 14:10:03,493 | DEBUG | Stopped transport: /10.231.233.55:50809 | org.apache.activemq.broker.TransportConnection | ActiveMQ Task&lt;br/&gt;
2010-05-12 14:10:03,493 | DEBUG | Cleaning up connection resources: /10.231.233.55:50809 | org.apache.activemq.broker.TransportConnection | ActiveMQ Task&lt;br/&gt;
2010-05-12 14:10:03,493 | DEBUG | remove connection id: ID:solr-2073-50804-1273665033782-2:0 | org.apache.activemq.broker.TransportConnection | ActiveMQ Task&lt;br/&gt;
2010-05-12 14:10:03,493 | DEBUG | jms1 removing consumer: ID:solr-2073-50804-1273665033782-2:0:225:1 for destination: temp-queue://ID:solr-2073-50804-1273665033782-2:0:105 | org.apache.activemq.broker.region.AbstractRegion | ActiveMQ Task&lt;br/&gt;
2010-05-12 14:10:03,493 | DEBUG | remove sub: QueueSubscription: consumer=ID:solr-2073-50804-1273665033782-2:0:225:1, destinations=1, dispatched=0, delivered=0, pending=0, lastDeliveredSeqId: 0, dequeues: 0, dispatched: 0, inflight: 0 | org.apache.activemq.broker.region.Queue | ActiveMQ Task&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Red hat enterprise&lt;/p&gt;</environment>
        <key id="12483862">AMQ-2730</key>
            <summary>Transport failed: java.io.EOFException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jteetel">Dennis Klinkott</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 May 2010 12:55:17 +0000</created>
                <updated>Wed, 6 Apr 2016 07:28:24 +0000</updated>
                            <resolved>Thu, 25 Aug 2011 20:02:50 +0000</resolved>
                                    <version>5.3.1</version>
                                                        <due></due>
                            <votes>5</votes>
                                    <watches>14</watches>
                                                                                                                <comments>
                            <comment id="12942628" author="jteetel" created="Wed, 12 May 2010 13:00:18 +0000"  >&lt;p&gt;The screenshot shows the communication between the broker (ip: 10.231.233.125) and the bridge (solr-2073, ip: 10.231.233.55) at the time the exception occurred.&lt;/p&gt;</comment>
                            <comment id="12942646" author="jteetel" created="Fri, 14 May 2010 08:09:24 +0000"  >&lt;p&gt;The strange thing is that we get the EOFException shortly before the connection is stopped:&lt;/p&gt;

&lt;p&gt;2010-05-12 14:10:03,490 | DEBUG | Transport failed: java.io.EOFException&lt;/p&gt;

&lt;p&gt;2010-05-12 14:10:03,492 | DEBUG | Stopping connection&lt;/p&gt;</comment>
                            <comment id="12943009" author="bsnyder" created="Tue, 28 Sep 2010 18:38:29 +0000"  >&lt;p&gt;The EOFException is difficult to explain because there is no additional info pointing at what may have happened, i.e., it&apos;s simply an abrupt failure. The important question here is, &apos;What is causing the abrupt failure?&apos; &lt;/p&gt;

&lt;p&gt;Just a few of questions: &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Can you reproduce the errors?
	&lt;ul&gt;
		&lt;li&gt;If so, can you sniff the network (e.g., using Wireshark) to see what is happening just before the exception occurs?&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;Is there a client-side exception to match the exception on the broker side?&lt;/li&gt;
	&lt;li&gt;Is the broker running in a virtualized environment perhaps?&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12943015" author="puska" created="Wed, 29 Sep 2010 11:41:04 +0000"  >&lt;p&gt;Same problem here. I tried versions 5.4.0 and 5.4.1.&lt;/p&gt;

&lt;p&gt;On client-side there is an exception:&lt;br/&gt;
javax.jms.JMSException: Wire format negotiation timeout: peer did not send his wire format.&lt;br/&gt;
 at org.apache.activemq.util.JMSExceptionSupport.create (JMSExceptionSupport.java:62)&lt;br/&gt;
    org.apache.activemq.ActiveMQConnection.syncSendPacket (ActiveMQConnection.java:1298)&lt;br/&gt;
    org.apache.activemq.ActiveMQConnection.ensureConnectionInfoSent (ActiveMQConnection.java:1382)&lt;br/&gt;
    org.apache.activemq.ActiveMQConnection.createSession (ActiveMQConnection.java:309)&lt;br/&gt;
    sun.reflect.GeneratedMethodAccessor18.invoke (:-1)&lt;br/&gt;
    sun.reflect.DelegatingMethodAccessorImpl.invoke (DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
    java.lang.reflect.Method.invoke (Method.java:597)&lt;br/&gt;
    clojure.lang.Reflector.invokeMatchingMethod (Reflector.java:90)&lt;br/&gt;
    clojure.lang.Reflector.invokeInstanceMethod (Reflector.java:28)&lt;br/&gt;
    ...&lt;br/&gt;
Caused by: java.io.IOException: Wire format negotiation timeout: peer did not send his wire format.&lt;br/&gt;
 at org.apache.activemq.transport.WireFormatNegotiator.oneway (WireFormatNegotiator.java:98)&lt;br/&gt;
    org.apache.activemq.transport.MutexTransport.oneway (MutexTransport.java:40)&lt;br/&gt;
    org.apache.activemq.transport.ResponseCorrelator.asyncRequest (ResponseCorrelator.java:81)&lt;br/&gt;
    org.apache.activemq.transport.ResponseCorrelator.request (ResponseCorrelator.java:86)&lt;br/&gt;
    org.apache.activemq.ActiveMQConnection.syncSendPacket (ActiveMQConnection.java:1276)&lt;br/&gt;
    org.apache.activemq.ActiveMQConnection.ensureConnectionInfoSent (ActiveMQConnection.java:1382)&lt;br/&gt;
    org.apache.activemq.ActiveMQConnection.createSession (ActiveMQConnection.java:309)&lt;br/&gt;
    sun.reflect.GeneratedMethodAccessor18.invoke (:-1)&lt;br/&gt;
    sun.reflect.DelegatingMethodAccessorImpl.invoke (DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
    java.lang.reflect.Method.invoke (Method.java:597)&lt;/p&gt;</comment>
                            <comment id="12943027" author="bsnyder" created="Wed, 29 Sep 2010 17:25:59 +0000"  >&lt;p&gt;@IP, That error is different and can occur for a couple of reasons:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The resources available to the broker are so consumed that there are not enough available to spawn the necessary thread to allow the handshake or the broker is so slow in creating the thread that a timeout occurs before the handshake.
	&lt;ul&gt;
		&lt;li&gt;The solution is to either free up resources or give the broker more resources (i.e., memory).&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;A client connects to a port that is not an endpoint for the TCP transport. Even though the client connects to the broker, the full handshake is not completed and a timeout occurs.
	&lt;ul&gt;
		&lt;li&gt;The solution is to connect to the correct port number.&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Actually there is a FAQ entry for this problem that says basically the same things: &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://activemq.apache.org/javaxjmsjmsexception-wire-format-negociation-timeout-peer-did-not-send-his-wire-format.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/javaxjmsjmsexception-wire-format-negociation-timeout-peer-did-not-send-his-wire-format.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12942955" author="remer" created="Tue, 5 Oct 2010 09:33:12 +0000"  >&lt;p&gt;Hi ,&lt;br/&gt;
1. Do You mean configuration of memory in ApacheMQ in bin Directory? It looks like -it is not reason of problem?&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Set jvm memory configuration&lt;br/&gt;
ACTIVEMQ_OPTS_MEMORY=&quot;-Xms256M -Xmx512M&quot;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;2. What do You mean? It is Stomp configurationc for ApacheMQ: there is only Port 61612. How can client try to contact other ports? Is it possible?&lt;/p&gt;

&lt;p&gt;3. FAQ. Only one configuration&apos;s property works with STOMP protocol. so it doesn&apos;t work: &lt;br/&gt;
&amp;lt;transportConnector name=&quot;stomp&quot; uri=&quot;stomp://0.0.0.0:61612?transport.closeAsync=false&amp;amp;soTimeout=30000&amp;amp;wireFormat.maxInactivityDurationInitalDelay=30000&quot;/&amp;gt; &lt;/p&gt;

&lt;p&gt;(only one property is possible, for example ....?wireFormat.maxInactivityDurationInitalDelay=30000&quot;/&amp;gt; ):&lt;/p&gt;


&lt;p&gt;so by me it is not solved... or do i right follow You?&lt;/p&gt;</comment>
                            <comment id="12942980" author="remer" created="Thu, 7 Oct 2010 12:17:14 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
what can i configure in case of using Loadbalancer?&lt;br/&gt;
It sends constantly check bytes to Port 61612...&lt;br/&gt;
So exceptions come in Stomp Protocol -error of reading of line...&lt;br/&gt;
What is right solution?&lt;/p&gt;</comment>
                            <comment id="12942781" author="bsnyder" created="Thu, 7 Oct 2010 15:43:38 +0000"  >&lt;blockquote&gt;
&lt;p&gt;1. Do You mean configuration of memory in ApacheMQ in bin Directory? It looks like -it is not reason of problem?&lt;br/&gt;
Set jvm memory configuration&lt;br/&gt;
ACTIVEMQ_OPTS_MEMORY=&quot;-Xms256M -Xmx512M&quot;&lt;/p&gt;&lt;/blockquote&gt; 

&lt;p&gt;Yes, one possibility is memory resources have been exhausted. By default, the ActiveMQ startup script allocates 512mb to the JVM in which ActiveMQ runs. In addition to the memory allocated to the JVM, you also need to configure the memory that is made available to the broker via the &lt;tt&gt;&amp;lt;systemUsage&amp;gt;&lt;/tt&gt; element in the activemq.xml file. See the docs for the &lt;tt&gt;&amp;lt;systemUsage&amp;gt;&lt;/tt&gt; element for more info: &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://activemq.apache.org/producer-flow-control.html#ProducerFlowControl-Systemusage&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/producer-flow-control.html#ProducerFlowControl-Systemusage&lt;/a&gt;  &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2. What do You mean? It is Stomp configurationc for ApacheMQ: there is only Port 61612. How can client try to contact other ports? Is it possible?&lt;/p&gt;&lt;/blockquote&gt; 

&lt;p&gt;I mean that the client may be connecting to a port that does not have a TCP transport connector registered to it. It is possible for a client to use TCP to connect to ActiveMQ via a port that has a non-TCP endpoint registered. However, the client will not get a full handshake and an error will be thrown. &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;3. FAQ. Only one configuration&apos;s property works with STOMP protocol. so it doesn&apos;t work: &lt;br/&gt;
&amp;lt;transportConnector name=&quot;stomp&quot; uri=&quot;stomp://0.0.0.0:61612?transport.closeAsync=false&amp;amp;soTimeout=30000&amp;amp;wireFormat.maxInactivityDurationInitalDelay=30000&quot;/&amp;gt;&lt;/p&gt;&lt;/blockquote&gt; 

&lt;p&gt;FAQ item #3 is referring to the failover transport connector which is used on the client-side, not the Stomp transport connector which is used on the broker-side. Here are the docs for the failover transport: &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://activemq.apache.org/failover-transport-reference.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/failover-transport-reference.html&lt;/a&gt; &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Hi,&lt;br/&gt;
what can i configure in case of using Loadbalancer?&lt;br/&gt;
It sends constantly check bytes to Port 61612...&lt;br/&gt;
So exceptions come in Stomp Protocol -error of reading of line...&lt;br/&gt;
What is right solution?&lt;/p&gt;&lt;/blockquote&gt; 

&lt;p&gt;Typically people have a TCP or NIO transport connector defined in the broker config for this purpose. The load balancer just opens a socket with the broker via the TCP transport and if it is able to connect, it assumes that the broker is up and running. More sophisticated setups that I have seen actually have the load balancer run a script that connects the broker and sends/receives a message on a destination to ensure that the broker is actually processing messages. &lt;/p&gt;</comment>
                            <comment id="12942987" author="remer" created="Fri, 8 Oct 2010 08:59:12 +0000"  >&lt;p&gt;Thanks!&lt;br/&gt;
Can be broker configured so that it will ignore check bytes of Loadbalncer to STOMP connector Port and will not write Exception in log file each second ?&lt;br/&gt;
NIO has the same trouble if You meaned that NIO transport connector would not see check bytes of Loadbalancer as Exceptions by reading of STOMP messages...&lt;br/&gt;
Sure java source can be changed to ignore some exceptions or such bytes, but it is not  good solution - new versions Apache MQ need than such changes in case of update.   &lt;/p&gt;


{Typically people have a TCP or NIO transport connector defined in the broker config for this purpose. The load balancer just opens a socket with the broker via the TCP transport and if it is able to connect, it assumes that the broker is up and running. More sophisticated setups that I have seen actually have the load balancer run a script that connects the broker and sends/receives a message on a destination to ensure that the broker is actually processing messages. }</comment>
                            <comment id="12943159" author="remer" created="Wed, 3 Nov 2010 08:18:33 +0000"  >&lt;p&gt;Hello Bruse,&lt;/p&gt;

&lt;p&gt;do You have any example of xml configuration file or its part (is it appachemq.xml or spring confi xml?) of adding own transporter listerner? &lt;br/&gt;
so that this exception would be processed by own transport listener.&lt;br/&gt;
i haven&apos;t found any example of xml.&lt;/p&gt;

&lt;p&gt;Thanks in advance!&lt;/p&gt;</comment>
                            <comment id="12965097" author="bsnyder" created="Tue, 30 Nov 2010 05:31:19 +0000"  >&lt;p&gt;@Sergey, A transport listener can be set on the ActiveMQ connection factory to monitor the status of the failover transport from the client side, not from the broker side. Using this method, every connection that is created via this connection factory will have the transport listener enabled. Below is an example using a Spring XML config: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-xml&quot;&gt;&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean class=&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.activemq.ActiveMQConnectionFactory&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;brokerURL&quot;&lt;/span&gt; value=&lt;span class=&quot;code-quote&quot;&gt;&quot;failover:(tcp://localhost:61616)&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;property name=&lt;span class=&quot;code-quote&quot;&gt;&quot;transportListener&quot;&lt;/span&gt;&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;bean class=&lt;span class=&quot;code-quote&quot;&gt;&quot;com.mycompany.MyTransportListener&quot;&lt;/span&gt; /&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/property&amp;gt;&lt;/span&gt;
&lt;span class=&quot;code-tag&quot;&gt;&amp;lt;/bean&amp;gt;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;A transport listener can also be set on the ActiveMQ connection directly, but this is usually done programmatically. Below is an example using Java code: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
Connection conn = connectionFactory.createConnection();
conn.addTransportListener(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MyTransportListener() {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void onCommand(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o) {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;onCommand invoked&quot;&lt;/span&gt;); 
  }

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void onException(IOException error) {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;onException invoked&quot;&lt;/span&gt;); 
  }
});
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;A transport listener can also be added directly to a &lt;a href=&quot;http://activemq.apache.org/maven/5.3.1/activemq-core/apidocs/org/apache/activemq/transport/Transport.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Transport&lt;/a&gt;, but this is only done when working directly with a &lt;a href=&quot;http://activemq.apache.org/maven/5.3.1/activemq-core/apidocs/org/apache/activemq/transport/Transport.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;Transport&lt;/a&gt;. Below is an example of doing this using Java code: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
transport.setTransportListener(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DefaultTransportListener() {
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void onCommand(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; o) {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;onCommand invoked&quot;&lt;/span&gt;); 
  }

  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void onException(IOException error) {
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;onException invoked&quot;&lt;/span&gt;); 
  }
});
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;I hope these examples help answer your questions. &lt;/p&gt;</comment>
                            <comment id="13017577" author="scotte" created="Fri, 8 Apr 2011 18:12:10 +0000"  >&lt;p&gt;Related to the ORIGINAL description of this bug, here&apos;s our experience in debugging EOFException errors with AMQ 5.4.2 on linux, using a failover connector:&lt;/p&gt;

&lt;p&gt;We just spent some time debugging a similar EOFException situation and believe the cause is memory related on the ActiveMQ server, even though the server may not ever throw an OutOfMemory exception. In our case, this cause was not the least bit obvious as the server would appear to function fine, but at some point the inactivity timer would kick in and cause reconnects. When this would happen, new connections (from our Java clients) to the server would be immediately closed and the client would start hammering the server up until the max reconnect attempts is hit (even though the documentation says the default is unlimited, it&apos;s actually 1000 in TaskRunnerFactory - due to DefaultThreadPools having what we think is the right code commented out, unless that means something different). Because of synchronization in this code, a single thread will hit this loop, while all the other threads are stuck waiting on the mutex (which is fine, because nobody can do any work anyway). Once the 1000 connection attempts are done, the client JVM becomes effectively useless for any JMS activity, as the thread in the reconnection loop will give up and end up waiting forever on an event that will never occur. All other threads are stuck waiting on this mutex.&lt;/p&gt;

&lt;p&gt;We have seen many cases where restarting the client appears fine (it reconnects to ActiveMQ server just fine), giving a false sense that all is well. At some point, the client will once again get into this state. Because of this, we &lt;/p&gt;

&lt;p&gt;While there is little the client code can do in this situation, there are things that can be done to help with this situation. Here&apos;s my suggestions, if it helps:&lt;/p&gt;

&lt;p&gt;1. In the TaskRunnerFactory, if we hit the max reconnect attempts, a high severity log entry should be written saying that AMQ client is effectively dead and giving up. This message should repeat at some reasonable interval so it doesn&apos;t get buried in logs.&lt;/p&gt;

&lt;p&gt;2. Improve AMQ client logging when it is this reconnect loop. We found that we had to enable TRACE level logging to really get enough detail to see what was going on.&lt;/p&gt;

&lt;p&gt;3. Improve AMQ server logging, if possible, to indicate why it is closing sockets from the client.&lt;/p&gt;

&lt;p&gt;4. Validate if the current code in DefaultThreadPools is indeed correct (not the commented out code).&lt;/p&gt;

&lt;p&gt;5. I don&apos;t know what the default memoryUsage limit is in the example activemq.xml, but make sure that it&apos;s a sane value considering the default max heap is 512MB.&lt;/p&gt;</comment>
                            <comment id="13017579" author="scotte" created="Fri, 8 Apr 2011 18:14:09 +0000"  >&lt;p&gt;In my previous comment, I forgot a couple of important details.&lt;/p&gt;

&lt;p&gt;First, the memory condition was a result of having memoryUsage limit of &quot;512 mb&quot; with a max heap of 512MB due to a misconfiguration in this particular environment.&lt;/p&gt;

&lt;p&gt;Second, stack trace for the java.io.EOFException:&lt;/p&gt;

&lt;p&gt;java.io.DataInputStream.readInt(DataInputStream.java:358)&lt;br/&gt;
org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:269)&lt;br/&gt;
org.apache.activemq.transport.tcp.TcpTransport.readCommand(TcpTransport.java:227)&lt;br/&gt;
org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:219)&lt;br/&gt;
org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:202)&lt;br/&gt;
java.lang.Thread.run(Thread.java:595)&lt;/p&gt;</comment>
                            <comment id="13059868" author="lexsoto" created="Tue, 5 Jul 2011 12:41:01 +0000"  >&lt;p&gt;Running into this exact same problem, sometimes resulting in &quot;Too many open files&quot; error that really renders the server unusable.  Adjusting memory settings as suggested by Scott Emmons seem to help with the &quot;Too many open files&quot; errors, but I am still seeing the &quot;Transport failed: java.io.EOFException&quot; errors in the server.  I am afraid this error will cause some other problem eventually. Please help!&lt;/p&gt;</comment>
                            <comment id="13060258" author="scotte" created="Wed, 6 Jul 2011 03:34:25 +0000"  >&lt;p&gt;A couple of comments on this...&lt;/p&gt;

&lt;p&gt;1 - TaskRunnerFactory bug mentioned above has not, to my knowledge been fixed. This is a rather serious condition in that ActiveMQ will only try 1000 times (regardless of how configured) if the configuration is as described above, and then give up - silently and forever wedging the connection.&lt;/p&gt;

&lt;p&gt;2. Since my comments a few months back, we have discovered an additional, and very common source of EOFExceptions - and it&apos;s not a problem, but the logging of ActiveMQ is sort of misleading. Whenever a client closes a JMS connection under normal conditions, the server will report an EOFException. This also can happen in a network of brokers after a connection is idle for some period of time. Unfortunately, the logging does not disambiguate EOFExceptions as a result of normal connection shutdown (it could, if the client reported this fact to the server). On our spring-based clients we see this alot, because it creates/destroys JMS connections - but I don&apos;t know if this is due to bad code or configuration on our part, or is a limitation of spring.&lt;/p&gt;

&lt;p&gt;Hope this helps lead in the right direction...&lt;/p&gt;</comment>
                            <comment id="13085553" author="fjjiaboming" created="Tue, 16 Aug 2011 06:05:20 +0000"  >&lt;p&gt;Transport failed: java.io.EOFException&lt;br/&gt;
ActiveMQ 5.5, too. &lt;/p&gt;

&lt;p&gt;And ActiveMQ cannot restore.  &lt;br/&gt;
cd ${mq_dir}/bin&lt;br/&gt;
way 1: ./activemq stop&lt;br/&gt;
      then ./activemq start&lt;br/&gt;
way 2: ./activemq restart&lt;/p&gt;

&lt;p&gt;when every client connect the broker , the ActiveMQ server print Transport failed: java.io.EOFException...&lt;/p&gt;


&lt;p&gt;&amp;#8211;&lt;br/&gt;
And then I found a detail , after a while , such two minute or more,&lt;br/&gt;
the client , the ActiveMQ server doesnot print Transport failed . Why no Exception???&lt;/p&gt;</comment>
                            <comment id="13085555" author="jeronimo.azevedo@dt.ept.lu" created="Tue, 16 Aug 2011 06:08:28 +0000"  >&lt;p&gt;I am out of office statring monday 08 august till friday 19 august.&lt;br/&gt;
For any APS/WebServices please contact Jerome Neumanns.&lt;br/&gt;
For any other questions you can contact bb-staff@ept.lu&lt;/p&gt;
</comment>
                            <comment id="13091267" author="tabish121" created="Thu, 25 Aug 2011 20:02:50 +0000"  >&lt;p&gt;These sorts or error messages are normal when the connections are broken between client and server.&lt;/p&gt;</comment>
                            <comment id="13159972" author="gtully" created="Wed, 30 Nov 2011 11:00:35 +0000"  >&lt;p&gt;spotted the comment above about the task runner and build a quick sanity test. When the max iterations is exceeded the task is enqueued if not done and the reconnects can continue. &lt;a href=&quot;http://svn.apache.org/viewvc?rev=1208377&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1208377&amp;amp;view=rev&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14261958" author="siddeshwar_hiremath" created="Wed, 31 Dec 2014 05:49:29 +0000"  >&lt;p&gt;2014-12-31 05:41:38,396 | DEBUG | Running WriteCheck&lt;span class=&quot;error&quot;&gt;&amp;#91;tcp://127.0.0.1:52513&amp;#93;&lt;/span&gt; | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor Worker&lt;br/&gt;
2014-12-31 05:41:40,132 | DEBUG | 30000ms elapsed since last read check. | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor ReadCheckTimer&lt;br/&gt;
2014-12-31 05:41:40,134 | DEBUG | WriteChecker: 9999ms elapsed since last write check. | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor WriteCheckTimer&lt;br/&gt;
2014-12-31 05:41:40,135 | DEBUG | Running WriteCheck&lt;span class=&quot;error&quot;&gt;&amp;#91;tcp://127.0.0.1:52516&amp;#93;&lt;/span&gt; | org.apache.activemq.transport.AbstractInactivityMonitor | ActiveMQ InactivityMonitor Worker&lt;br/&gt;
2014-12-31 05:41:41,008 | DEBUG | Transport Connection to: tcp://127.0.0.1:52770 failed: java.io.EOFException | org.apache.activemq.broker.TransportConnection.Transport | ActiveMQ NIO Worker 2&lt;br/&gt;
java.io.EOFException&lt;br/&gt;
        at org.apache.activemq.transport.nio.NIOTransport.serviceRead(NIOTransport.java:98)&lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-client-5.10.0.jar:5.10.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.activemq.transport.nio.NIOTransport$1.onSelect(NIOTransport.java:69)&lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-client-5.10.0.jar:5.10.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.activemq.transport.nio.SelectorSelection.onSelect(SelectorSelection.java:94)&lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-client-5.10.0.jar:5.10.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.activemq.transport.nio.SelectorWorker$1.run(SelectorWorker.java:119)&lt;span class=&quot;error&quot;&gt;&amp;#91;activemq-client-5.10.0.jar:5.10.0&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.7.0_40&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.7.0_40&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:724)&lt;span class=&quot;error&quot;&gt;&amp;#91;:1.7.0_40&amp;#93;&lt;/span&gt;&lt;br/&gt;
2014-12-31 05:41:41,009 | DEBUG | Unregistering MBean org.apache.activemq:type=Broker,brokerName=localhost,connector=clientConnectors,connectorName=nio_//localhost_61616&amp;qe;transport.keepAlive&amp;amp;true&amp;amp;transport.wireFormat.maxFrameSize&amp;amp;104857600&amp;amp;useQueueForAccept&amp;amp;false,connectionViewType=remoteAddress,connectionName=tcp_//127.0.0.1_52770 | org.apache.activemq.broker.jmx.ManagementContext | ActiveMQ NIO Worker 2&lt;br/&gt;
2014-12-31 05:41:41,013 | DEBUG | Stopping connection: tcp://127.0.0.1:52770 | org.apache.activemq.broker.TransportConnection | ActiveMQ BrokerService&lt;span class=&quot;error&quot;&gt;&amp;#91;localhost&amp;#93;&lt;/span&gt; Task-3&lt;br/&gt;
2014-12-31 05:41:41,015 | DEBUG | Stopping transport tcp:///127.0.0.1:52770@61616 | org.apache.activemq.transport.tcp.TcpTransport | ActiveMQ BrokerService&lt;span class=&quot;error&quot;&gt;&amp;#91;localhost&amp;#93;&lt;/span&gt; Task-3&lt;br/&gt;
2014-12-31 05:41:41,017 | DEBUG | Initialized TaskRunnerFactory&lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Task&amp;#93;&lt;/span&gt; using ExecutorService: java.util.concurrent.ThreadPoolExecutor@6721ffbf&lt;span class=&quot;error&quot;&gt;&amp;#91;Running, pool size = 0, active threads = 0, queued tasks = 0, completed tasks = 0&amp;#93;&lt;/span&gt; | org.apache.activemq.thread.TaskRunnerFactory | ActiveMQ BrokerService&lt;span class=&quot;error&quot;&gt;&amp;#91;localhost&amp;#93;&lt;/span&gt; Task-3&lt;br/&gt;
2014-12-31 05:41:41,018 | DEBUG | Closed socket Socket&lt;span class=&quot;error&quot;&gt;&amp;#91;unconnected&amp;#93;&lt;/span&gt; | org.apache.activemq.transport.tcp.TcpTransport | ActiveMQ Task-1&lt;br/&gt;
2014-12-31 05:41:41,020 | DEBUG | Forcing shutdown of ExecutorService: java.util.concurrent.ThreadPoolExecutor@6721ffbf&lt;span class=&quot;error&quot;&gt;&amp;#91;Running, pool size = 1, active threads = 1, queued tasks = 0, completed tasks = 0&amp;#93;&lt;/span&gt; | org.apache.activemq.util.ThreadPoolUtils | ActiveMQ BrokerService&lt;span class=&quot;error&quot;&gt;&amp;#91;localhost&amp;#93;&lt;/span&gt; Task-3&lt;br/&gt;
2014-12-31 05:41:41,020 | DEBUG | Stopped transport: null | org.apache.activemq.broker.TransportConnection | ActiveMQ BrokerService&lt;span class=&quot;error&quot;&gt;&amp;#91;localhost&amp;#93;&lt;/span&gt; Task-3&lt;br/&gt;
2014-12-31 05:41:41,020 | DEBUG | Connection Stopped: null | org.apache.activemq.broker.TransportConnection | ActiveMQ BrokerService&lt;span class=&quot;error&quot;&gt;&amp;#91;localhost&amp;#93;&lt;/span&gt; Task-3&lt;br/&gt;
2014-12-31 05:41:42,629 | DEBUG | Checkpoint started. | org.apache.activemq.store.kahadb.MessageDatabase | ActiveMQ Journal Checkpoint Worker&lt;/p&gt;</comment>
                            <comment id="14261969" author="siddeshwar_hiremath" created="Wed, 31 Dec 2014 06:10:57 +0000"  >&lt;p&gt;java.io.EOFException&lt;/p&gt;

&lt;p&gt;see the above log trace for complete detail.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12956411">AMQ-6229</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12461697" name="TCP Dump.jpg" size="620101" author="jteetel" created="Wed, 12 May 2010 12:56:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63713</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 46 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0sui7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>166419</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>