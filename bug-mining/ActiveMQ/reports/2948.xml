<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:38:40 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6494] Exceptions and timeouts during shutdown of connectors</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6494</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;During shutdown there are a number of BrokerStoppedException(s) thrown unnecessarily and unnecessary timeouts.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13017249">AMQ-6494</key>
            <summary>Exceptions and timeouts during shutdown of connectors</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hadrian">Hadrian Zbarcea</assignee>
                                    <reporter username="hadrian">Hadrian Zbarcea</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Nov 2016 14:24:25 +0000</created>
                <updated>Thu, 3 Oct 2019 10:08:35 +0000</updated>
                            <resolved>Sat, 24 Jun 2017 12:51:52 +0000</resolved>
                                    <version>5.14.0</version>
                                    <fixVersion>5.15.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="15629210" author="githubbot" created="Wed, 2 Nov 2016 14:59:37 +0000"  >&lt;p&gt;GitHub user hzbarcea opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/208&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/208&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6494&quot; title=&quot;Exceptions and timeouts during shutdown of connectors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6494&quot;&gt;&lt;del&gt;AMQ-6494&lt;/del&gt;&lt;/a&gt; Process SHUTDOWN_INFO and REMOVE_INFO to avoid timeouts&lt;/p&gt;

&lt;p&gt;    More details regarding this bug in jira.&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6494&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6494&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/hzbarcea/activemq&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/hzbarcea/activemq&lt;/a&gt; amq-6494&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/208.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/208.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #208&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 197495c7fc954f187740fe59ffbc2c5a374d9b96&lt;br/&gt;
Author: Hadrian Zbarcea &amp;lt;hadrian@apache.org&amp;gt;&lt;br/&gt;
Date:   2016-11-02T14:56:37Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6494&quot; title=&quot;Exceptions and timeouts during shutdown of connectors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6494&quot;&gt;&lt;del&gt;AMQ-6494&lt;/del&gt;&lt;/a&gt; Process SHUTDOWN_INFO and REMOVE_INFO to avoid timeouts&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="15629414" author="hadrian" created="Wed, 2 Nov 2016 16:04:42 +0000"  >&lt;p&gt;This issue is visible in tests such as DestinationBridgeAccessorsTest.&lt;/p&gt;

&lt;p&gt;During shutdown, in BrokerService around line 2208 where JmsConnectors are stopped a few SHUTDOWN_INFO and REMOVE_INFO messages are sent. However, the transport listener in TransportConnection, checks for !brokerService.isStopping() (around line 192) and ignores and skips processing of those messages during shutdown. This causes the exceptions and 15 sec timeouts.&lt;/p&gt;

&lt;p&gt;The PR above solves the problem. I didn&apos;t commit it just yet giving it a bit of time for review, if anybody could think of any edge case that could cause problems.&lt;/p&gt;
</comment>
                            <comment id="15636352" author="jira-bot" created="Fri, 4 Nov 2016 13:39:04 +0000"  >&lt;p&gt;Commit dce2b61f870245a0c12b634d12cd0fa3a8a60daa in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=hadrian&quot; class=&quot;user-hover&quot; rel=&quot;hadrian&quot;&gt;hadrian&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=dce2b61&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=dce2b61&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6494&quot; title=&quot;Exceptions and timeouts during shutdown of connectors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6494&quot;&gt;&lt;del&gt;AMQ-6494&lt;/del&gt;&lt;/a&gt; Return ExceptionResponse during broker service shutdown&lt;/p&gt;</comment>
                            <comment id="15636354" author="githubbot" created="Fri, 4 Nov 2016 13:39:28 +0000"  >&lt;p&gt;Github user asfgit closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/activemq/pull/208&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/208&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15636374" author="hadrian" created="Fri, 4 Nov 2016 13:46:25 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt; for the feedback.&lt;/p&gt;</comment>
                            <comment id="15647545" author="jira-bot" created="Tue, 8 Nov 2016 13:20:28 +0000"  >&lt;p&gt;Commit dca066287ebd7ffe465544f647e213e1c4d5744a in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=dca0662&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=dca0662&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6494&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6494&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Ignoring test that currently fails. The parent test is already ignored&lt;br/&gt;
in the build so I&apos;m adding this one to be ignored as well.  It&lt;br/&gt;
currently fails on exceptions that are expected and needs to be fixed.&lt;/p&gt;</comment>
                            <comment id="15647547" author="christopher.l.shannon" created="Tue, 8 Nov 2016 13:21:36 +0000"  >&lt;p&gt;I ignored a test failure that seemed to be caused by this patch.  The test itself is the issue and needs to be fixed as it is failing on errors that are now expected so I went ahead and ignored the test for now.  It&apos;s just failing for level db as the parent test that runs on KahaDB has already been ignored.&lt;/p&gt;</comment>
                            <comment id="15878266" author="gtully" created="Wed, 22 Feb 2017 14:08:40 +0000"  >&lt;p&gt;There are a few tests in the activemq.all set that fail (65+ runs) with this change. &lt;br/&gt;
I peeked at one, org.apache.activemq.bugs.AMQ2149Test and the failure results in a brokerstopped jms exception bubbling up to the client with the changes. Without the changes the IOException from a disconnect is being handled under the covers by failover: which does a resend.&lt;/p&gt;

&lt;p&gt;The fix is to have the app handle that JMS exception which is really a behaviour change. I wonder if there is some middle ground here that will solve the original problem but not change the behaviour and keep those existing failover tests working?&lt;br/&gt;
Fixing the test is accepting this new behaviour which may come as a surprise to existing users.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/ActiveMQ-Java8-All-UnitTests/org.apache.activemq$activemq-unit-tests/633/testReport/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://builds.apache.org/job/ActiveMQ-Java8-All-UnitTests/org.apache.activemq$activemq-unit-tests/633/testReport/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15883362" author="christopher.l.shannon" created="Fri, 24 Feb 2017 19:16:42 +0000"  >&lt;p&gt;I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt; that this should probably be revisited so I&apos;m reopening the issue.&lt;/p&gt;</comment>
                            <comment id="15955123" author="gtully" created="Tue, 4 Apr 2017 13:25:09 +0000"  >&lt;p&gt;reverted &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;a=commit;h=0f7561e85ab18912ce65120dde465aef5acda12a&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;a=commit;h=0f7561e85ab18912ce65120dde465aef5acda12a&lt;/a&gt; and added a fix to the vm transport such that it won&apos;t ignore exceptions. I think that is the root cause of the original test delay on stop via the shutdown hook.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;a=commit;h=729766e4925ec05ec05410887df146dd27adbbf4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;a=commit;h=729766e4925ec05ec05410887df146dd27adbbf4&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15958638" author="jira-bot" created="Thu, 6 Apr 2017 09:24:12 +0000"  >&lt;p&gt;Commit 63b2e5c4eabfbdc54ff6ebb155092f7033e7bf22 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=63b2e5c&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=63b2e5c&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6494&quot; title=&quot;Exceptions and timeouts during shutdown of connectors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6494&quot;&gt;&lt;del&gt;AMQ-6494&lt;/del&gt;&lt;/a&gt; fix check order of close state for  onException handler&lt;/p&gt;</comment>
                            <comment id="16061964" author="christopher.l.shannon" created="Sat, 24 Jun 2017 12:51:52 +0000"  >&lt;p&gt;Resolving based off of Gary&apos;s commit&lt;/p&gt;</comment>
                            <comment id="16943475" author="jira-bot" created="Thu, 3 Oct 2019 10:08:35 +0000"  >&lt;p&gt;Commit 4af6f4018656e01989136042a8ad4ec1ab64c137 in activemq&apos;s branch refs/heads/master from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=4af6f40&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=4af6f40&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6494&quot; title=&quot;Exceptions and timeouts during shutdown of connectors&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6494&quot;&gt;&lt;del&gt;AMQ-6494&lt;/del&gt;&lt;/a&gt; is related, fix intermittent failure of RedeliveryPolicyTest related to vm transport server being shutdown while in use via async onException handler&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 6 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35qdr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>