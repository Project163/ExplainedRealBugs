<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:46:23 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2757] AMQ startup fails during Startup due to NullPointerException in KahaDB</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2757</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;During a long-time test run several message consumers listening to peristent queues crashed.&lt;br/&gt;
The queues were filling up rapidly, so that KahaDB allocated 3GB of disk space (max. limit 10GB) after 5hours (approx 800k messages).&lt;br/&gt;
At that point the broker was extremely slow and non-responsive to new messages.&lt;br/&gt;
JConsole showed that 1GB of RAM was used and most effort was necessary for garbage collection.&lt;br/&gt;
Although the max memory usage limit is configured to 1GB, AMQ should rather allocate disc space for messages to queues without containers.&lt;/p&gt;

&lt;p&gt;AMQ shutdown took extremely long (several limits).&lt;br/&gt;
The subsequent AMQ restart keeps failing with the following exception:&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.kahadb.index.BTreeNode$BTreeIterator.findNextPage(BTreeNode.java:109)&lt;br/&gt;
	at org.apache.kahadb.index.BTreeNode$BTreeIterator.hasNext(BTreeNode.java:120)&lt;br/&gt;
	at org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore$4.execute(KahaDBStore.java:223)&lt;br/&gt;
	at org.apache.kahadb.page.Transaction.execute(Transaction.java:728)&lt;br/&gt;
	at org.apache.activemq.store.kahadb.KahaDBStore$KahaDBMessageStore.recover(KahaDBStore.java:220)&lt;br/&gt;
	at org.apache.activemq.broker.region.Queue.initialize(Queue.java:252)&lt;br/&gt;
	at org.apache.activemq.broker.region.DestinationFactoryImpl.createDestination(DestinationFactoryImpl.java:83)&lt;br/&gt;
	at org.apache.activemq.broker.region.AbstractRegion.createDestination(AbstractRegion.java:464)&lt;br/&gt;
	at org.apache.activemq.broker.jmx.ManagedQueueRegion.createDestination(ManagedQueueRegion.java:56)&lt;br/&gt;
	at org.apache.activemq.broker.region.AbstractRegion.addDestination(AbstractRegion.java:120)&lt;br/&gt;
	at org.apache.activemq.broker.region.RegionBroker.addDestination(RegionBroker.java:268)&lt;br/&gt;
	at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:142)&lt;br/&gt;
	at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:142)&lt;br/&gt;
	at org.apache.activemq.broker.MutableBrokerFilter.addDestination(MutableBrokerFilter.java:149)&lt;br/&gt;
	at org.apache.activemq.broker.region.AbstractRegion.start(AbstractRegion.java:94)&lt;br/&gt;
	at org.apache.activemq.broker.region.RegionBroker.start(RegionBroker.java:178)&lt;br/&gt;
	at org.apache.activemq.broker.jmx.ManagedRegionBroker.start(ManagedRegionBroker.java:101)&lt;br/&gt;
	at org.apache.activemq.broker.BrokerFilter.start(BrokerFilter.java:154)&lt;br/&gt;
	at org.apache.activemq.broker.TransactionBroker.start(TransactionBroker.java:112)&lt;br/&gt;
	at org.apache.activemq.broker.BrokerService$3.start(BrokerService.java:1713)&lt;br/&gt;
	at org.apache.activemq.broker.BrokerService.start(BrokerService.java:473)&lt;br/&gt;
	at org.apache.activemq.xbean.XBeanBrokerService.afterPropertiesSet(XBeanBrokerService.java:85)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;The problem is reproducible also reproducible with recent nightly builds of AMQ/Fuse 5.4.0.&lt;/p&gt;


&lt;p&gt;-Tom&lt;/p&gt;</description>
                <environment>&lt;p&gt;Red Hat Enterprise Linux, Kernel V2.6.18&lt;/p&gt;</environment>
        <key id="12482804">AMQ-2757</key>
            <summary>AMQ startup fails during Startup due to NullPointerException in KahaDB</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="tschoeftner">Thomas Sch&#246;ftner</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Jun 2010 11:29:44 +0000</created>
                <updated>Mon, 12 Jul 2010 11:20:21 +0000</updated>
                            <resolved>Mon, 12 Jul 2010 11:20:21 +0000</resolved>
                                    <version>5.2.0</version>
                    <version>5.3.0</version>
                    <version>5.3.1</version>
                                    <fixVersion>5.4.0</fixVersion>
                                    <component>Message Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12942741" author="tschoeftner" created="Wed, 2 Jun 2010 11:40:36 +0000"  >&lt;p&gt;attached wrapper config&lt;/p&gt;</comment>
                            <comment id="12942694" author="tschoeftner" created="Thu, 10 Jun 2010 05:27:07 +0000"  >&lt;p&gt;The problem is related to the VMQueueCursor being active.&lt;br/&gt;
If the queues are switched back to the default queue cursor, AMQ starts up smoothly.&lt;br/&gt;
However, the behaviour is strange as AMQ is nowhere near it&apos;s memory limits when it crashes.&lt;/p&gt;</comment>
                            <comment id="12942532" author="chirino" created="Tue, 22 Jun 2010 00:00:07 +0000"  >&lt;p&gt;Just committed a fix that should resolved the issue reported here.  &lt;/p&gt;

&lt;p&gt;Fixed in rev 956741 on trunk.  Try it out in a subsequent snapshot.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461715" name="activemq.log" size="7680" author="tschoeftner" created="Wed, 2 Jun 2010 11:35:06 +0000"/>
                            <attachment id="12461717" name="activemq.xml" size="7466" author="tschoeftner" created="Wed, 2 Jun 2010 11:35:06 +0000"/>
                            <attachment id="12461718" name="wrapper.conf" size="6196" author="tschoeftner" created="Wed, 2 Jun 2010 11:40:36 +0000"/>
                            <attachment id="12461716" name="wrapper.log" size="32228" author="tschoeftner" created="Wed, 2 Jun 2010 11:35:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74812</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rq8f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>159894</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>