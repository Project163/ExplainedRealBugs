<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:00:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4595] QueueBrowser hangs when browsing large queues</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4595</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When trying to browse a queue with a QueueBrowser, the browsing will hang and never complete. This appears to happen only with &quot;a lot&quot; of message in the queue. 1000 messages works correctly, but 10000 hangs.&lt;/p&gt;

&lt;p&gt;I have attached a unit test that exhibits the problem. Change the &quot;messageToSend&quot; variable in the test method to see the difference between small queue size and large queue size. &lt;/p&gt;

&lt;p&gt;I&apos;ve attached the unit test code as well as the output from one of the runs with 10000 messages. &lt;/p&gt;</description>
                <environment>&lt;p&gt;All&lt;/p&gt;</environment>
        <key id="12654150">AMQ-4595</key>
            <summary>QueueBrowser hangs when browsing large queues</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="ravv">Nicholas Rahn</reporter>
                        <labels>
                            <label>QueueBrowser</label>
                    </labels>
                <created>Fri, 21 Jun 2013 13:53:15 +0000</created>
                <updated>Mon, 1 Sep 2014 16:17:42 +0000</updated>
                            <resolved>Mon, 15 Jul 2013 14:22:21 +0000</resolved>
                                    <version>5.8.0</version>
                                    <fixVersion>5.9.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="13690291" author="ravv" created="Fri, 21 Jun 2013 13:56:13 +0000"  >&lt;p&gt;Unit test code and output from a run with 10000 messages.&lt;/p&gt;</comment>
                            <comment id="13705951" author="tabish121" created="Thu, 11 Jul 2013 16:24:21 +0000"  >&lt;p&gt;For such a large Queue the destination policy needs to be updated to use a larger maxAuditDepth to avoid spinning as the audit rolls over. &lt;/p&gt;</comment>
                            <comment id="13706061" author="tabish121" created="Thu, 11 Jul 2013 18:19:37 +0000"  >&lt;p&gt;Updated test case showing how to make this work on a 5.9 SNAPSHOT.&lt;/p&gt;</comment>
                            <comment id="13706068" author="tabish121" created="Thu, 11 Jul 2013 18:22:01 +0000"  >&lt;p&gt;Since the Queue depth exceeds the maxAuditDepth on the Queue the browse runs into the problem similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4487&quot; title=&quot;java.lang.OutOfMemoryError: Java heap space&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4487&quot;&gt;&lt;del&gt;AMQ-4487&lt;/del&gt;&lt;/a&gt; which can be resolved by setting maxAuditDepth to some higher value.  Then you must also take into account that the browse will end when the memory limit is reached so you would need to configure a very large limit for this test case to get all 10,000 messages since they have a larger payload.  The updated test case shows how its done. &lt;/p&gt;</comment>
                            <comment id="13706779" author="tmielke" created="Fri, 12 Jul 2013 08:12:15 +0000"  >&lt;p&gt;Hi Tim,&lt;/p&gt;

&lt;p&gt;Do you mind explaining a bit more why maxAuditDepth needs to be raised in order to browse a higher number of messages? &lt;br/&gt;
Also, I barely found any documentation on this property. Can we get it added to &lt;a href=&quot;http://activemq.apache.org/per-destination-policies.html?&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/per-destination-policies.html?&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;Would the current behavior (when not setting maxAuditDepth) not rather be a bug? From a client&apos;s point of view should a queue browser not be used like an ordinary consumer and not require any broker side config changes? &lt;br/&gt;
I am concerned that no ActiveMQ user will think of raising maxAuditDepth in order to browse more than the default 400 messages. This does not seem intuitive.&lt;/p&gt;

&lt;p&gt;And finally I want to add that you also need to use version 5.9-SNAPSHOT as even the updated test case does not work with 5.8.0. I presume due to the fix that went in for &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4487&quot; title=&quot;java.lang.OutOfMemoryError: Java heap space&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4487&quot;&gt;&lt;del&gt;AMQ-4487&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13707024" author="tabish121" created="Fri, 12 Jul 2013 15:38:55 +0000"  >&lt;p&gt;The current behavior is definitely still a bug, however there are ways to work around it.  I&apos;m pretty sure you could get around it by setting a lower memory limit in 5.8 so it doesn&apos;t page in so many messages but I didn&apos;t try that.  The fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4487&quot; title=&quot;java.lang.OutOfMemoryError: Java heap space&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4487&quot;&gt;&lt;del&gt;AMQ-4487&lt;/del&gt;&lt;/a&gt; allows the audit settings to be set in the destination policy, previously they were being ignored. &lt;/p&gt;

&lt;p&gt;The problem is that the Message Audit that&apos;s don&apos;t to prevent the messages that are redispatched when not acked by a closed consumer from getting dropped into a browser a second time since they are read from the pending dispatch message list.  Since this list can grow quite long in this test case it exceeds the audit depth so we get into a loop since the messages in the list don&apos;t appear to be duplicates.  Its a flaw in the way Queue Browsers are designed currently.  It wasn&apos;t really an issue until we made the change to page in messages for browsers instead of limiting them to a single page.  &lt;/p&gt;</comment>
                            <comment id="13707283" author="tabish121" created="Fri, 12 Jul 2013 19:24:27 +0000"  >&lt;p&gt;I think the simplest fix right now short of rewriting the Queue Browser code to have its own message cursor implementation is to just give each QueueBrowserSubscription it&apos;s own unbounded duplicate tracker so that we just let them browse until MemoryUsage limits are reached.  &lt;/p&gt;</comment>
                            <comment id="13708300" author="ravv" created="Mon, 15 Jul 2013 08:10:00 +0000"  >&lt;p&gt;We make extensive use of the QueueBrowser in our application (our app is similar to the activemq web console app where you can view all queues, connections, messages; and move messages between any 2 queues). So having a solution that does not require us to change a queue&apos;s configuration is important as we don&apos;t know queue names, message size or queue size before hand. &lt;/p&gt;

&lt;p&gt;I&apos;m not all that familiar with the internals of AMQ, but in the old AMQ 4.0 series (we&apos;re upgrading from that series, btw), we would not have memory issues unless you browsed a &lt;b&gt;very&lt;/b&gt; large queue (100000s messages). Upgrading the Queue Browser code would also benefit the activemq web console app, as anyone using that will also be bitten by this bug.&lt;/p&gt;</comment>
                            <comment id="13708494" author="tabish121" created="Mon, 15 Jul 2013 14:22:21 +0000"  >&lt;p&gt;Fixed on trunk, the QueueBrowser will just track all message Audits since its a transient subscription the overhead will be short lived. &lt;/p&gt;</comment>
                            <comment id="13730864" author="ravv" created="Tue, 6 Aug 2013 15:44:44 +0000"  >&lt;p&gt;I verified that this works in the latest 5.9-SNAPSHOT.&lt;/p&gt;

&lt;p&gt;@Torsten - I don&apos;t have rights to comment on support cases at RH anymore since my subscription expired. You can close the support ticket there too.&lt;/p&gt;</comment>
                            <comment id="13731719" author="tmielke" created="Wed, 7 Aug 2013 07:13:15 +0000"  >&lt;p&gt;@Nicholas - Thx for the update. Will do.&lt;/p&gt;</comment>
                            <comment id="13782682" author="cwikman" created="Tue, 1 Oct 2013 07:10:31 +0000"  >&lt;p&gt;We are using 5.8.0 in production and got hit very hard by this bug and &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4487&quot; title=&quot;java.lang.OutOfMemoryError: Java heap space&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4487&quot;&gt;&lt;del&gt;AMQ-4487&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Does any anyone have a patched 5.8.0 with this fixed? Or is there any other workaround? &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12738296">AMQ-5340</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12644624">AMQ-4487</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12591883" name="AMQ4595Test.java" size="5528" author="tabish" created="Thu, 11 Jul 2013 18:19:37 +0000"/>
                            <attachment id="12589064" name="AMQ580BrowsingBug.java" size="3765" author="ravv" created="Fri, 21 Jun 2013 13:56:13 +0000"/>
                            <attachment id="12589067" name="amq-test-20130621T155120.log" size="2364013" author="ravv" created="Fri, 21 Jun 2013 13:59:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334427</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 8 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lotz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334753</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>