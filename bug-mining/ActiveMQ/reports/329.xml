<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:36:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1255] Advisory queues don&apos;t disappear for TEMPORARY queues/topics</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1255</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;My ActiveMQ clients create TEMPORARY queues and I have been looking through the active queues recently and I noticed a number of advisory queues are sticking around (mostly ones that have ActiveMQ.Advisory.Producer.*) that refer to the temporary queues that I created. It seems that even though the temporary queues are gone the advisory topics are still there. Over time this looks like it degrades the performance of ActiveMQ.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12481967">AMQ-1255</key>
            <summary>Advisory queues don&apos;t disappear for TEMPORARY queues/topics</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="sparky2708">Denis Abramov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 May 2007 19:14:08 +0000</created>
                <updated>Mon, 14 Apr 2008 15:59:56 +0000</updated>
                            <resolved>Mon, 14 Apr 2008 15:59:56 +0000</resolved>
                                    <version>4.1.0</version>
                                    <fixVersion>5.1.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="12939065" author="rajdavies" created="Thu, 4 Oct 2007 15:33:38 +0000"  >&lt;p&gt;Denis - is this still a problem on the latest?&lt;/p&gt;</comment>
                            <comment id="12939362" author="sparky2708" created="Mon, 25 Feb 2008 23:40:30 +0000"  >&lt;p&gt;Tried 5.1 snapshot and still seems like it is happening.&lt;/p&gt;</comment>
                            <comment id="12939361" author="mooseroy" created="Sun, 2 Mar 2008 01:23:49 +0000"  >&lt;p&gt;I am having similar problems with Advisory queues not disappearing after a topic is destroyed, and have found one code path that leaks advisory topics in my application.  If I create a topic, add a consumer for said topic, send some messages, remove the consumer, and explicitly destroy the topic, there are times that advisory topics for the topic are left behind.  The path that lead to this situation in my app was in AdvisoryBroker.addConsumer.  When I create the topic in the client, no addDestination occurs on the server, but when I add the consumer, the addConsumer occurs.  The AdvisoryBroker&apos;s addConsumer method does:&lt;br/&gt;
ActiveMQTopic topic = AdvisorySupport.getConsumerAdvisoryTopic(info.getDestination());&lt;br/&gt;
consumers.put(info.getConsumerId(), info);&lt;br/&gt;
fireConsumerAdvisory(context, topic, info);&lt;/p&gt;

&lt;p&gt;Which in turn causes an addDestination to occur within the RegionBroker when the advisory event is sent to the ConsumerAdvisoryTopic created above.  What seems to be missing is when the removeDestination  method occurs, it looks within the AdvisoryBroker&apos;s destinations map for an entry for the destination getting closed, but in my situation there is no entry for my topic since addDestination never occured within the AdvisoryBroker.  This leaves behind the ConsumerAdvisoryTopic for my topic within the RegionBroker.&lt;/p&gt;

&lt;p&gt;I&apos;m not at all familiar with the inner workings of the Advisory system, but for my system I was able to greatly reduce the leaks by changing the addConsumer to look like this:&lt;/p&gt;

&lt;p&gt;ActiveMQTopic topic = AdvisorySupport.getConsumerAdvisoryTopic(info.getDestination());&lt;br/&gt;
consumers.put(info.getConsumerId(), info);&lt;br/&gt;
if(!destinations.containsKey(info.getDestination())) {&lt;br/&gt;
  DestinationInfo destInfo = new DestinationInfo(context.getConnectionId(), DestinationInfo.ADD_OPERATION_TYPE, topic);&lt;br/&gt;
  fireAdvisory(context, topic, destInfo);&lt;br/&gt;
  destinations.put(info.getDestination(), destInfo);&lt;br/&gt;
}&lt;br/&gt;
 fireConsumerAdvisory(context, topic, info);&lt;/p&gt;

&lt;p&gt;By doing this, when a destination is destroyed, the AdvisoryBroker has an entry in the map for the destination, so is able to remove the advisory topics from the RegionBroker.  I also did something similar in the addProducer.&lt;/p&gt;

&lt;p&gt;As I said, this was simply a blind attempt to solve the leak within my application without any knowledge of the Advisory system, so I have no idea if this will cause side effects or unwanted behavior, but it might point someone with more understanding to the source of the problem.&lt;/p&gt;</comment>
                            <comment id="12939504" author="rajdavies" created="Thu, 10 Apr 2008 06:29:35 +0000"  >&lt;p&gt;Cannot reproduce this on snapshot for 5.1&lt;/p&gt;</comment>
                            <comment id="12939579" author="rajdavies" created="Fri, 11 Apr 2008 13:09:33 +0000"  >&lt;p&gt;my mistake - problem is there&lt;/p&gt;</comment>
                            <comment id="12939539" author="rajdavies" created="Mon, 14 Apr 2008 15:59:56 +0000"  >&lt;p&gt;Resolved by SVN revision 647872&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84453</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 33 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s2v3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161940</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>