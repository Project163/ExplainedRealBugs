<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:02:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4841]  lease-database-locker does not use the configured tablePrefix in UPDATE statement</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4841</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Using the configuration&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&amp;lt;persistenceAdapter&amp;gt;
  &amp;lt;jdbcPersistenceAdapter dataDirectory=&lt;span class=&quot;code-quote&quot;&gt;&quot;${activemq.data}&quot;&lt;/span&gt; dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;#mysql-ds&quot;&lt;/span&gt; lockKeepAlivePeriod=&lt;span class=&quot;code-quote&quot;&gt;&quot;5000&quot;&lt;/span&gt;&amp;gt;
    &amp;lt;locker&amp;gt;
      &amp;lt;lease-database-locker lockAcquireSleepInterval=&lt;span class=&quot;code-quote&quot;&gt;&quot;10000&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/locker&amp;gt;
    &amp;lt;statements&amp;gt;
      &amp;lt;statements tablePrefix=&lt;span class=&quot;code-quote&quot;&gt;&quot;TTT_&quot;&lt;/span&gt; messageTableName=&lt;span class=&quot;code-quote&quot;&gt;&quot;AMQ_MSGS&quot;&lt;/span&gt; durableSubAcksTableName=&lt;span class=&quot;code-quote&quot;&gt;&quot;AMQ_ACKS&quot;&lt;/span&gt; lockTableName=&lt;span class=&quot;code-quote&quot;&gt;&quot;AMQ_LOCK&quot;&lt;/span&gt;/&amp;gt;
    &amp;lt;/statements&amp;gt;
    &amp;lt;adapter&amp;gt;
       &amp;lt;mysql-jdbc-adapter/&amp;gt;
     &amp;lt;/adapter&amp;gt;
  &amp;lt;/jdbcPersistenceAdapter&amp;gt;
&amp;lt;/persistenceAdapter&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The logging show the Lock table was created WITH the configured prefix but the lease locker UPDATE statement does not use that prefix&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2013-10-30 14:33:03,245 | DEBUG | Executing SQL: CREATE TABLE TTT_AMQ_LOCK( ID BIGINT NOT NULL, TIME BIGINT, BROKER_NAME VARCHAR(250), PRIMARY KEY (ID) ) ENGINE=INNODB | org.apache.activemq.store.jdbc.adapter.DefaultJDBCAdapter | main

...

2013-10-30 14:33:10,889 | DEBUG | jdbcBroker, lease keepAlive Query is UPDATE ACTIVEMQ_LOCK SET BROKER_NAME=?, TIME=? WHERE BROKER_NAME=? AND ID = 1 | org.apache.activemq.store.jdbc.LeaseDatabaseLocker | ActiveMQ JDBC PA Scheduled Task
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;tested on latest trunk&lt;/li&gt;
&lt;/ul&gt;
</environment>
        <key id="12676937">AMQ-4841</key>
            <summary> lease-database-locker does not use the configured tablePrefix in UPDATE statement</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="davsclaus">Claus Ibsen</assignee>
                                    <reporter username="pgfox">Pat Fox</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 Oct 2013 19:33:50 +0000</created>
                <updated>Wed, 2 Apr 2014 23:59:28 +0000</updated>
                            <resolved>Fri, 1 Nov 2013 11:45:56 +0000</resolved>
                                    <version>5.9.0</version>
                                    <fixVersion>5.9.1</fixVersion>
                    <fixVersion>5.10.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13810600" author="pgfox" created="Thu, 31 Oct 2013 19:34:59 +0000"  >&lt;p&gt;JDBCLockTablePrefixTest attached&lt;/p&gt;</comment>
                            <comment id="13810608" author="pgfox" created="Thu, 31 Oct 2013 19:38:21 +0000"  >&lt;p&gt;WORKAROUND&lt;br/&gt;
============&lt;br/&gt;
A simple workaround to this is to reorder the configured elements within  &quot;jdbcPersistenceAdapter&quot; element so &quot;locker&quot; is after the &quot;statement&quot; element.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;persistenceAdapter&amp;gt;
    &amp;lt;jdbcPersistenceAdapter dataDirectory=&lt;span class=&quot;code-quote&quot;&gt;&quot;${activemq.data}&quot;&lt;/span&gt; dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;#mysql-ds&quot;&lt;/span&gt; lockKeepAlivePeriod=&lt;span class=&quot;code-quote&quot;&gt;&quot;5000&quot;&lt;/span&gt;&amp;gt;
	&amp;lt;statements&amp;gt;
	  &amp;lt;statements tablePrefix=&lt;span class=&quot;code-quote&quot;&gt;&quot;TTT_&quot;&lt;/span&gt; messageTableName=&lt;span class=&quot;code-quote&quot;&gt;&quot;AMQ_MSGS&quot;&lt;/span&gt; durableSubAcksTableName=&lt;span class=&quot;code-quote&quot;&gt;&quot;AMQ_ACKS&quot;&lt;/span&gt; lockTableName=&lt;span class=&quot;code-quote&quot;&gt;&quot;AMQ_LOCK&quot;&lt;/span&gt;/&amp;gt;
	&amp;lt;/statements&amp;gt;
        &amp;lt;adapter&amp;gt;
	  &amp;lt;mysql-jdbc-adapter/&amp;gt;
	&amp;lt;/adapter&amp;gt;
	&amp;lt;locker&amp;gt;
	  &amp;lt;lease-database-locker lockAcquireSleepInterval=&lt;span class=&quot;code-quote&quot;&gt;&quot;10000&quot;&lt;/span&gt;/&amp;gt;
	&amp;lt;/locker&amp;gt;
  &amp;lt;/jdbcPersistenceAdapter&amp;gt;
&amp;lt;/persistenceAdapter&amp;gt;

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The above config results in the locker using the prefix table name in the UPDATE statement&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;...
2013-10-30 14:36:01,041 | DEBUG | jdbcBroker, lease keepAlive Query is UPDATE TTT_AMQ_LOCK SET BROKER_NAME=?, TIME=? WHERE BROKER_NAME=? AND ID = 1 | org.apache.activemq.store.jdbc.LeaseDatabaseLocker | ActiveMQ JDBC PA Scheduled Task
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13811143" author="davsclaus" created="Fri, 1 Nov 2013 10:04:22 +0000"  >&lt;p&gt;Yeah its an ordering issue, the locker gets the &quot;default&quot; statements. And no the later configured.&lt;/p&gt;</comment>
                            <comment id="13811187" author="davsclaus" created="Fri, 1 Nov 2013 11:45:56 +0000"  >&lt;p&gt;Thanks Pat for reporting the issue, the workaround, and the test case.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12611460" name="JDBCLockTablePrefixTest.java" size="4784" author="pgfox" created="Thu, 31 Oct 2013 19:34:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356313</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 3 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pfcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>356601</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>