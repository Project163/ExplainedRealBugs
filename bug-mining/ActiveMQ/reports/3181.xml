<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:44:41 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-7017] ProducerBrokerExchange.getPercentageBlocked() throws ArithmeticException (divide by zero)</title>
                <link>https://issues.apache.org/jira/browse/AMQ-7017</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I found this when testing a broker plugin for tracking messages sent (including some stats like&#160;getPercentageBlocked). When there have been no blocked messages an ArithmeticException is thrown due to an unchecked divide by zero.&#160;&lt;/p&gt;

&lt;p&gt;I fixed it and added a couple unit tests.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13173614">AMQ-7017</key>
            <summary>ProducerBrokerExchange.getPercentageBlocked() throws ArithmeticException (divide by zero)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.svg">Trivial</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="mstratto">Matthew Stratton</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Sat, 21 Jul 2018 17:52:13 +0000</created>
                <updated>Fri, 27 Jul 2018 11:41:35 +0000</updated>
                            <resolved>Fri, 27 Jul 2018 11:41:35 +0000</resolved>
                                    <version>5.15.4</version>
                                    <fixVersion>5.15.5</fixVersion>
                    <fixVersion>5.16.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16552635" author="christopher.l.shannon" created="Mon, 23 Jul 2018 10:44:02 +0000"  >&lt;p&gt;Seems like there might be more to fix here.&#160; Checking for 0 is a good idea however it doesn&apos;t make sense that you would run into this condition in the first place...It seems odd you would have a positive number for sends blocked but have 0 for total sends&lt;/p&gt;</comment>
                            <comment id="16552771" author="mstratto" created="Mon, 23 Jul 2018 12:41:13 +0000"  >&lt;p&gt;Perhaps, but I think it may just be an extreme edge case.&lt;/p&gt;

&lt;p&gt;The plugin I&#160;wrote&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; logs message information for audit purposes and happens&#160;before authentication even happens to ensure we get information regardless of the outcome of the operation. It is including percentage blocked regardless of send count or block count. The unit test for the plugin instantiates a new broker&#160;and a new connection to that broker, so the first time this plugin fires on the connection, the send count is zero. If I move the log statement to after calling `super.send(producerExchange, messageSend);` the test does not throw the&#160;ArithmeticException. There are plenty of ways to work around it in the plugin.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;-&#160;&lt;a href=&quot;https://gist.github.com/macgregor/c108f1ca5051e6d9b08ab388d17d0126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gist.github.com/macgregor/c108f1ca5051e6d9b08ab388d17d0126&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16559616" author="jira-bot" created="Fri, 27 Jul 2018 11:41:17 +0000"  >&lt;p&gt;Commit b79fcd0a768e5c7d45a7f68febf447d8379cbaf4 in activemq&apos;s branch refs/heads/master from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=b79fcd0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=b79fcd0&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7017&quot; title=&quot;ProducerBrokerExchange.getPercentageBlocked() throws ArithmeticException (divide by zero)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7017&quot;&gt;&lt;del&gt;AMQ-7017&lt;/del&gt;&lt;/a&gt; - Prevent ArithmeticException in ProducerBrokerExchange&lt;/p&gt;

&lt;p&gt;Check for zero to prevent divide by zero error inside&lt;br/&gt;
getPercentageBlocked() method&lt;/p&gt;

&lt;p&gt;Thank you to Matthew Stratton for the patch&lt;/p&gt;</comment>
                            <comment id="16559617" author="jira-bot" created="Fri, 27 Jul 2018 11:41:30 +0000"  >&lt;p&gt;Commit e3f76e169325f4741c4ddf0c38c10ca65fa1c385 in activemq&apos;s branch refs/heads/activemq-5.15.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e3f76e1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=e3f76e1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7017&quot; title=&quot;ProducerBrokerExchange.getPercentageBlocked() throws ArithmeticException (divide by zero)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7017&quot;&gt;&lt;del&gt;AMQ-7017&lt;/del&gt;&lt;/a&gt; - Prevent ArithmeticException in ProducerBrokerExchange&lt;/p&gt;

&lt;p&gt;Check for zero to prevent divide by zero error inside&lt;br/&gt;
getPercentageBlocked() method&lt;/p&gt;

&lt;p&gt;Thank you to Matthew Stratton for the patch&lt;/p&gt;

&lt;p&gt;(cherry picked from commit b79fcd0a768e5c7d45a7f68febf447d8379cbaf4)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12932564" name="fix-producer-exchange-divide-by-zero.txt" size="2597" author="mstratto" created="Sat, 21 Jul 2018 17:16:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3w53b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>