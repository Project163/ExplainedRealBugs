<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:45:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-7085] Queue.start() does not call systemUsage.start() so TempStore usage is not handled correctly</title>
                <link>https://issues.apache.org/jira/browse/AMQ-7085</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I have an application using ActiveMQ and have a situation where a producer is blocked with this log message due to the temp usage limit being hit:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[ActiveMQ Transport: tcp:///aaa.bbb.ccc.ddd:65119@64759] 82567721 INFO&#160; org.apache.activemq.broker.region.Queue - Usage(Main:temp:queue://aaabbb:temp) percentUsage=99%, usage=61771109932, limit=61771104256, percentUsageMinDelta=1%;Parent:Usage(Main:temp) percentUsage=100%, usage=61771109932, limit=61771104256, percentUsageMinDelta=1%: Temp Store is Full (99% of 61771104256). Stopping producer (ID:aaaaa-3:1:1:1) to prevent flooding queue://aaabbb. See&#160;http://activemq.apache.org/producer-flow-control.html&#160;for more info (blocking for: 8512s)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In the past I have been able to use JConsole and update the broker&apos;s TempLimit value to a higher value to allow things to continue.&lt;br/&gt;
&#160;&lt;br/&gt;
However on this occasion, the messages above when output again show that the parent&apos;s temp limit has updated however the child&apos;s limit (the queue) is unchanged.&#160; So it seems the broker&apos;s TempUsage does not know about the queue&apos;s TempUsage.&#160;&lt;br/&gt;
&#160;&lt;br/&gt;
In looking at the code.. it seems a child Usage class has to call start() in order for this parent -&amp;gt; children link to be established and for parent limit changes to be propagated down to children.&#160; However the Queue start() method doesn&apos;t call systemUsage.getTempUsage().start() for some reason (or even just systemUsage.start()).&lt;br/&gt;
&#160;&lt;br/&gt;
Is this a bug?&lt;br/&gt;
&#160;&lt;br/&gt;
DestinationView sadly does not expose setTempLimit() either so&#160;this wasn&apos;t an option either.&lt;br/&gt;
&#160;&lt;br/&gt;
From Queue:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Override
&#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void start() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
&#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (started.compareAndSet(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;)) {
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (memoryUsage != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; memoryUsage.start();
&#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (systemUsage.getStoreUsage() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; systemUsage.getStoreUsage().start();
&#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; systemUsage.getMemoryUsage().addUsageListener(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
&#160; &#160; &#160; &#160; &#160; &#160; messages.start();
&#160; &#160; &#160; &#160; &#160; &#160; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getExpireMessagesPeriod() &amp;gt; 0) {
&#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; scheduler.executePeriodically(expireMessagesTask, getExpireMessagesPeriod());
&#160; &#160; &#160; &#160; &#160; &#160; }
&#160; &#160; &#160; &#160; &#160; &#160; doPageIn(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
&#160; &#160; &#160; &#160; }
&#160; &#160; }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160; &#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13193696">AMQ-7085</key>
            <summary>Queue.start() does not call systemUsage.start() so TempStore usage is not handled correctly</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="sits">David Sitsky</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Oct 2018 22:04:55 +0000</created>
                <updated>Wed, 23 Feb 2022 12:43:46 +0000</updated>
                            <resolved>Thu, 17 Jan 2019 13:03:01 +0000</resolved>
                                    <version>5.15.6</version>
                                    <fixVersion>5.15.9</fixVersion>
                    <fixVersion>5.16.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="16666602" author="sits" created="Sun, 28 Oct 2018 23:43:45 +0000"  >&lt;p&gt;Hi -&#160;just curious if there is any feedback for this issue?&#160; Thanks.&#160;&lt;/p&gt;</comment>
                            <comment id="16676375" author="gtully" created="Tue, 6 Nov 2018 08:57:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sits&quot; class=&quot;user-hover&quot; rel=&quot;sits&quot;&gt;sits&lt;/a&gt; even for a small change, it is best to include a test case to validate the use case and to protect your change into the future. It also makes it easy to integrate b/c the bug becomes&#160;trivial to understand&#160;with the test case in code.&lt;/p&gt;</comment>
                            <comment id="16691433" author="sits" created="Mon, 19 Nov 2018 09:12:25 +0000"  >&lt;p&gt;Fair enough.. I&apos;ve added two tests which demonstrate the fix.  Many thanks.&lt;/p&gt;</comment>
                            <comment id="16744664" author="sits" created="Thu, 17 Jan 2019 03:52:05 +0000"  >&lt;p&gt;Hi - what else is required to get this committed?  I submitted a patch with a test case almost two months ago.&lt;/p&gt;</comment>
                            <comment id="16744999" author="christopher.l.shannon" created="Thu, 17 Jan 2019 12:33:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sits&quot; class=&quot;user-hover&quot; rel=&quot;sits&quot;&gt;sits&lt;/a&gt; - sorry for the delay, I will take a look now.&lt;/p&gt;</comment>
                            <comment id="16745022" author="jira-bot" created="Thu, 17 Jan 2019 13:01:51 +0000"  >&lt;p&gt;Commit daea192eefe683a8cba63b5136dc8c2b39722cfe in activemq&apos;s branch refs/heads/master from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=daea192&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=daea192&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7085&quot; title=&quot;Queue.start() does not call systemUsage.start() so TempStore usage is not handled correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7085&quot;&gt;&lt;del&gt;AMQ-7085&lt;/del&gt;&lt;/a&gt; - Properly start TempUsage inside Queue start&lt;/p&gt;

&lt;p&gt;This fix allows temp usage changes to the broker temp usage to propagate&lt;br/&gt;
properly to a Queue&apos;s temp usage settings&lt;/p&gt;

&lt;p&gt;Patch applied with thanks to David Sitsky&lt;/p&gt;</comment>
                            <comment id="16745023" author="jira-bot" created="Thu, 17 Jan 2019 13:02:12 +0000"  >&lt;p&gt;Commit db814982c782505c2ce754d5c3a1e8a08c2e6369 in activemq&apos;s branch refs/heads/activemq-5.15.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=db81498&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=db81498&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7085&quot; title=&quot;Queue.start() does not call systemUsage.start() so TempStore usage is not handled correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7085&quot;&gt;&lt;del&gt;AMQ-7085&lt;/del&gt;&lt;/a&gt; - Properly start TempUsage inside Queue start&lt;/p&gt;

&lt;p&gt;This fix allows temp usage changes to the broker temp usage to propagate&lt;br/&gt;
properly to a Queue&apos;s temp usage settings&lt;/p&gt;

&lt;p&gt;Patch applied with thanks to David Sitsky&lt;/p&gt;

&lt;p&gt;(cherry picked from commit daea192eefe683a8cba63b5136dc8c2b39722cfe)&lt;/p&gt;</comment>
                            <comment id="16745024" author="christopher.l.shannon" created="Thu, 17 Jan 2019 13:03:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sits&quot; class=&quot;user-hover&quot; rel=&quot;sits&quot;&gt;sits&lt;/a&gt; - Patch looks good to me, thanks.&#160; I have applied it with a couple of minor tweaks to both 5.15.x and 5.16.x (master) branches&lt;/p&gt;</comment>
                            <comment id="16745527" author="sits" created="Thu, 17 Jan 2019 21:32:16 +0000"  >&lt;p&gt;Excellent - thank you.&lt;/p&gt;</comment>
                            <comment id="17496726" author="jira-bot" created="Wed, 23 Feb 2022 12:41:59 +0000"  >&lt;p&gt;Commit df354fa0237dba309592277e3cfecbe1d55690be in activemq&apos;s branch refs/heads/main from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=df354fa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=df354fa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8509&quot; title=&quot;Queues do not stop TempStore Usage leading to a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8509&quot;&gt;&lt;del&gt;AMQ-8509&lt;/del&gt;&lt;/a&gt;: Update TempStore Usage test to verify cleanup&lt;/p&gt;

&lt;p&gt;Add a unit test to the previous tests added in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7085&quot; title=&quot;Queue.start() does not call systemUsage.start() so TempStore usage is not handled correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7085&quot;&gt;&lt;del&gt;AMQ-7085&lt;/del&gt;&lt;/a&gt; to verify&lt;br/&gt;
TempUsage is cleaned up and stopped on Queue.stop()&lt;/p&gt;</comment>
                            <comment id="17496730" author="jira-bot" created="Wed, 23 Feb 2022 12:43:46 +0000"  >&lt;p&gt;Commit 8674538d617d61f55fe5ef0c80f5f74e75115b77 in activemq&apos;s branch refs/heads/activemq-5.16.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=8674538&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=8674538&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8509&quot; title=&quot;Queues do not stop TempStore Usage leading to a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8509&quot;&gt;&lt;del&gt;AMQ-8509&lt;/del&gt;&lt;/a&gt;: Update TempStore Usage test to verify cleanup&lt;/p&gt;

&lt;p&gt;Add a unit test to the previous tests added in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7085&quot; title=&quot;Queue.start() does not call systemUsage.start() so TempStore usage is not handled correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7085&quot;&gt;&lt;del&gt;AMQ-7085&lt;/del&gt;&lt;/a&gt; to verify&lt;br/&gt;
TempUsage is cleaned up and stopped on Queue.stop()&lt;/p&gt;

&lt;p&gt;(cherry picked from commit df354fa0237dba309592277e3cfecbe1d55690be)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13430205">AMQ-8509</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12948679" name="AQM-7085.patch" size="12998" author="sits" created="Mon, 19 Nov 2018 09:14:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310250" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10430"><![CDATA[Patch]]></customfieldvalue>
    <customfieldvalue key="10431"><![CDATA[Important]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 37 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3zk3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>