<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:38:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1911] Kaha store can not retrieve messages with non ASCII charcaters</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1911</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Scenario:&lt;br/&gt;
A client with the host name &quot;mei&#223;en&quot; (German special character &#223; aka sz) sends an ObjectMessage to a persistent queue.&lt;br/&gt;
This message goes from the client to the broker and from the broker to the kaha store without problems.&lt;br/&gt;
After that, the broker cannot read it from the kaha store. Error message:&lt;br/&gt;
ERROR 2008-08-21 12:14:10.906       AbstractStoreCursor - Failed to fill batch&lt;br/&gt;
java.io.IOException: Failed to read to journal for: offset = 4770274, file = 9, size = 2317, type = 0. Reason: java.io.UTFDataFormatException: bad string&lt;br/&gt;
  at org.apache.activemq.util.IOExceptionSupport.create(IOExceptionSupport.java:33)&lt;br/&gt;
  at org.apache.activemq.store.amq.AMQPersistenceAdapter.createReadException(AMQPersistenceAdapter.java:637)&lt;br/&gt;
  at org.apache.activemq.store.amq.AMQPersistenceAdapter.readCommand(AMQPersistenceAdapter.java:523)&lt;br/&gt;
  at org.apache.activemq.store.amq.AMQMessageStore.getMessage(AMQMessageStore.java:432)&lt;br/&gt;
  at org.apache.activemq.store.amq.RecoveryListenerAdapter.recoverMessageReference(RecoveryListenerAdapter.java:54)&lt;br/&gt;
  at org.apache.activemq.store.kahadaptor.KahaReferenceStore.recoverReference(KahaReferenceStore.java:82)&lt;br/&gt;
  at org.apache.activemq.store.kahadaptor.KahaReferenceStore.recoverNextMessages(KahaReferenceStore.java:120)&lt;br/&gt;
  at org.apache.activemq.store.amq.AMQMessageStore.recoverNextMessages(AMQMessageStore.java:533)&lt;br/&gt;
  at org.apache.activemq.broker.region.cursors.QueueStorePrefetch.doFillBatch(QueueStorePrefetch.java:75)&lt;br/&gt;
  at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.fillBatch(AbstractStoreCursor.java:188)&lt;br/&gt;
  at org.apache.activemq.broker.region.cursors.AbstractStoreCursor.hasNext(AbstractStoreCursor.java:104)&lt;br/&gt;
  at org.apache.activemq.broker.region.cursors.StoreQueueCursor.hasNext(StoreQueueCursor.java:136)&lt;br/&gt;
  at org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:1108)&lt;br/&gt;
  at org.apache.activemq.broker.region.Queue.pageInMessages(Queue.java:1196)&lt;br/&gt;
  at org.apache.activemq.broker.region.Queue.iterate(Queue.java:951)&lt;br/&gt;
  at org.apache.activemq.thread.DeterministicTaskRunner.runTask(DeterministicTaskRunner.java:84)&lt;br/&gt;
  at org.apache.activemq.thread.DeterministicTaskRunner$1.run(DeterministicTaskRunner.java:41)&lt;br/&gt;
  at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:885)&lt;br/&gt;
  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:907)&lt;br/&gt;
  at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
Caused by: java.io.UTFDataFormatException: bad string&lt;br/&gt;
  at org.apache.activemq.util.DataByteArrayInputStream.readUTF(DataByteArrayInputStream.java:286)&lt;br/&gt;
  at org.apache.activemq.openwire.v3.BaseDataStreamMarshaller.looseUnmarshalString(BaseDataStreamMarshaller.java:572)&lt;br/&gt;
  at org.apache.activemq.openwire.v3.ProducerIdMarshaller.looseUnmarshal(ProducerIdMarshaller.java:115)&lt;br/&gt;
  at org.apache.activemq.openwire.OpenWireFormat.looseUnmarshalNestedObject(OpenWireFormat.java:471)&lt;br/&gt;
  at org.apache.activemq.openwire.v3.BaseDataStreamMarshaller.looseUnmarsalCachedObject(BaseDataStreamMarshaller.java:488)&lt;br/&gt;
  at org.apache.activemq.openwire.v3.MessageIdMarshaller.looseUnmarshal(MessageIdMarshaller.java:115)&lt;br/&gt;
  at org.apache.activemq.openwire.OpenWireFormat.looseUnmarshalNestedObject(OpenWireFormat.java:471)&lt;br/&gt;
  at org.apache.activemq.openwire.v3.BaseDataStreamMarshaller.looseUnmarsalNestedObject(BaseDataStreamMarshaller.java:467)&lt;br/&gt;
  at org.apache.activemq.openwire.v3.MessageMarshaller.looseUnmarshal(MessageMarshaller.java:210)&lt;br/&gt;
  at org.apache.activemq.openwire.v3.ActiveMQMessageMarshaller.looseUnmarshal(ActiveMQMessageMarshaller.java:102)&lt;br/&gt;
  at org.apache.activemq.openwire.v3.ActiveMQObjectMessageMarshaller.looseUnmarshal(ActiveMQObjectMessageMarshaller.java:102)&lt;br/&gt;
  at org.apache.activemq.openwire.OpenWireFormat.doUnmarshal(OpenWireFormat.java:364)&lt;br/&gt;
  at org.apache.activemq.openwire.OpenWireFormat.unmarshal(OpenWireFormat.java:204)&lt;br/&gt;
  at org.apache.activemq.store.amq.AMQPersistenceAdapter.readCommand(AMQPersistenceAdapter.java:521)&lt;br/&gt;
  ... 17 more&lt;br/&gt;
ERROR 2008-08-21 12:14:10.906       AbstractStoreCursor - Failed to fill batch&lt;/p&gt;


&lt;p&gt;Unfortunately the problem occurs first in the broker. This makes it very difficult to find out the real cause of the problem, the host name with a special character.&lt;br/&gt;
Further on it is not possible to recover from this problem and even worse all new messages which are put into this kaha store will be also lost.&lt;/p&gt;

&lt;p&gt;Special characters within the message (TextMessage, MappedMessage and ObjectMessage seems to be ok.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Producer: Windows XP , Broker: Windows 2003 Server, Consumer Windows 2003 Server, all activemq-5.2-20080803.231633-26&lt;/p&gt;</environment>
        <key id="12482661">AMQ-1911</key>
            <summary>Kaha store can not retrieve messages with non ASCII charcaters</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="pruente">Kai Pruente</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Aug 2008 11:01:09 +0000</created>
                <updated>Thu, 14 Jan 2021 22:56:34 +0000</updated>
                            <resolved>Fri, 29 Aug 2008 09:16:48 +0000</resolved>
                                    <version>5.2.0</version>
                                    <fixVersion>5.2.0</fixVersion>
                                    <component>Message Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12940135" author="gtully" created="Fri, 29 Aug 2008 09:16:48 +0000"  >&lt;p&gt;fixed in rev 690155.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13352368">AMQ-8122</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75178</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 13 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s067:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161504</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>