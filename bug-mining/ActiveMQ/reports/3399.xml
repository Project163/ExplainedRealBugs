<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:51:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-8509] Queues do not stop TempStore Usage leading to a memory leak</title>
                <link>https://issues.apache.org/jira/browse/AMQ-8509</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7085&quot; title=&quot;Queue.start() does not call systemUsage.start() so TempStore usage is not handled correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7085&quot;&gt;&lt;del&gt;AMQ-7085&lt;/del&gt;&lt;/a&gt; updated Queue.start() method to properly start the TempUsage tracking just like StoreUsage and MemoryUsage but the stop() method doesn&apos;t call stop on it so there is a memory leak when Queues are now stopped.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13430205">AMQ-8509</key>
            <summary>Queues do not stop TempStore Usage leading to a memory leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="cshannon">Christopher L. Shannon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Feb 2022 12:11:05 +0000</created>
                <updated>Wed, 23 Feb 2022 12:44:05 +0000</updated>
                            <resolved>Wed, 23 Feb 2022 12:44:05 +0000</resolved>
                                    <version>5.16.4</version>
                                    <fixVersion>5.17.0</fixVersion>
                    <fixVersion>5.16.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17496717" author="christopher.l.shannon" created="Wed, 23 Feb 2022 12:26:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/apache/activemq/pull/778&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/pull/778&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17496723" author="jira-bot" created="Wed, 23 Feb 2022 12:41:57 +0000"  >&lt;p&gt;Commit d1e9ba68b3cbea3e9294cf4993d005c3c8ea86f2 in activemq&apos;s branch refs/heads/main from Artur Pedroso&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=d1e9ba6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=d1e9ba6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8509&quot; title=&quot;Queues do not stop TempStore Usage leading to a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8509&quot;&gt;&lt;del&gt;AMQ-8509&lt;/del&gt;&lt;/a&gt;: Fix TempUsage memory leak&lt;/p&gt;

&lt;p&gt;If you have an application that creates lots of queues it will eventually&lt;br/&gt;
fail with OOM because TempUsage is started on Queue#start but never stopped.&lt;/p&gt;

&lt;p&gt;The `systemUsage.getTempUsage().start()` used on the Queue#start&lt;br/&gt;
adds elements on a List from TempUsage parent and these elements&lt;br/&gt;
are never removed.&lt;/p&gt;

&lt;p&gt;To reproduce this issue you need to leave an application&lt;br/&gt;
running for a long time creating different queues.&lt;/p&gt;

&lt;p&gt;The only way to avoid the leak right now is to stop the BrokerService,&lt;br/&gt;
which isn&apos;t a solution.&lt;/p&gt;</comment>
                            <comment id="17496724" author="jira-bot" created="Wed, 23 Feb 2022 12:41:58 +0000"  >&lt;p&gt;Commit fb7ae908efea46b9c9ff12ad3727d20a9374ebae in activemq&apos;s branch refs/heads/main from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=fb7ae90&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=fb7ae90&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Merge branch &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8509&quot; title=&quot;Queues do not stop TempStore Usage leading to a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8509&quot;&gt;&lt;del&gt;AMQ-8509&lt;/del&gt;&lt;/a&gt;&apos; into main&lt;/p&gt;

&lt;p&gt;This closes #778&lt;/p&gt;</comment>
                            <comment id="17496725" author="jira-bot" created="Wed, 23 Feb 2022 12:41:58 +0000"  >&lt;p&gt;Commit df354fa0237dba309592277e3cfecbe1d55690be in activemq&apos;s branch refs/heads/main from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=df354fa&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=df354fa&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8509&quot; title=&quot;Queues do not stop TempStore Usage leading to a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8509&quot;&gt;&lt;del&gt;AMQ-8509&lt;/del&gt;&lt;/a&gt;: Update TempStore Usage test to verify cleanup&lt;/p&gt;

&lt;p&gt;Add a unit test to the previous tests added in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7085&quot; title=&quot;Queue.start() does not call systemUsage.start() so TempStore usage is not handled correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7085&quot;&gt;&lt;del&gt;AMQ-7085&lt;/del&gt;&lt;/a&gt; to verify&lt;br/&gt;
TempUsage is cleaned up and stopped on Queue.stop()&lt;/p&gt;</comment>
                            <comment id="17496728" author="jira-bot" created="Wed, 23 Feb 2022 12:43:45 +0000"  >&lt;p&gt;Commit 84a28d78f27541b3c9790b3d8d9430566954378b in activemq&apos;s branch refs/heads/activemq-5.16.x from Artur Pedroso&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=84a28d7&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=84a28d7&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8509&quot; title=&quot;Queues do not stop TempStore Usage leading to a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8509&quot;&gt;&lt;del&gt;AMQ-8509&lt;/del&gt;&lt;/a&gt;: Fix TempUsage memory leak&lt;/p&gt;

&lt;p&gt;If you have an application that creates lots of queues it will eventually&lt;br/&gt;
fail with OOM because TempUsage is started on Queue#start but never stopped.&lt;/p&gt;

&lt;p&gt;The `systemUsage.getTempUsage().start()` used on the Queue#start&lt;br/&gt;
adds elements on a List from TempUsage parent and these elements&lt;br/&gt;
are never removed.&lt;/p&gt;

&lt;p&gt;To reproduce this issue you need to leave an application&lt;br/&gt;
running for a long time creating different queues.&lt;/p&gt;

&lt;p&gt;The only way to avoid the leak right now is to stop the BrokerService,&lt;br/&gt;
which isn&apos;t a solution.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit d1e9ba68b3cbea3e9294cf4993d005c3c8ea86f2)&lt;/p&gt;</comment>
                            <comment id="17496729" author="jira-bot" created="Wed, 23 Feb 2022 12:43:45 +0000"  >&lt;p&gt;Commit 8674538d617d61f55fe5ef0c80f5f74e75115b77 in activemq&apos;s branch refs/heads/activemq-5.16.x from Christopher L. Shannon (cshannon)&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=8674538&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=8674538&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-8509&quot; title=&quot;Queues do not stop TempStore Usage leading to a memory leak&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-8509&quot;&gt;&lt;del&gt;AMQ-8509&lt;/del&gt;&lt;/a&gt;: Update TempStore Usage test to verify cleanup&lt;/p&gt;

&lt;p&gt;Add a unit test to the previous tests added in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7085&quot; title=&quot;Queue.start() does not call systemUsage.start() so TempStore usage is not handled correctly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7085&quot;&gt;&lt;del&gt;AMQ-7085&lt;/del&gt;&lt;/a&gt; to verify&lt;br/&gt;
TempUsage is cleaned up and stopped on Queue.stop()&lt;/p&gt;

&lt;p&gt;(cherry picked from commit df354fa0237dba309592277e3cfecbe1d55690be)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13193696">AMQ-7085</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 37 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0zvcg:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>