<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:49:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3075] Auto-create database fails with PostgreSQL (Error in SQL: &apos;drop primary key&apos;)</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3075</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Trying to do a fresh install with persistence fails to create the database, with a listed database error.&lt;/p&gt;

&lt;p&gt;Persistence support added to activemq.xml file:&lt;/p&gt;

&lt;p&gt;  &amp;lt;bean id=&quot;postgres-ds&quot; class=&quot;org.postgresql.ds.PGPoolingDataSource&quot;&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;serverName&quot; value=&quot;localhost&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;databaseName&quot; value=&quot;activemq&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;portNumber&quot; value=&quot;5432&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;user&quot; value=&quot;activemq&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;password&quot; value=&quot;activemq&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;dataSourceName&quot; value=&quot;postgres&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;initialConnections&quot; value=&quot;1&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;property name=&quot;maxConnections&quot; value=&quot;10&quot;/&amp;gt;&lt;br/&gt;
  &amp;lt;/bean&amp;gt;&lt;br/&gt;
....&lt;br/&gt;
        &amp;lt;persistenceAdapter&amp;gt;&lt;br/&gt;
           &amp;lt;jdbcPersistenceAdapter dataSource=&quot;#postgres-ds&quot; useDatabaseLock=&quot;false&quot;/&amp;gt;&lt;br/&gt;
        &amp;lt;/persistenceAdapter&amp;gt;&lt;/p&gt;

&lt;p&gt;postgresql-8.4-701.jdbc4.jar added to the lib directory&lt;/p&gt;

&lt;p&gt;Log from startup:&lt;/p&gt;

&lt;p&gt; INFO | Pre-instantiating singletons in org.springframework.beans.factory.support.DefaultListableBeanFactory@40b0095d: defining beans &lt;a href=&quot;#0,postgres-ds,org.apache.activemq.xbean.XBeanBrokerService#0,securityLoginService,securityConstraint,securityConstraintMapping,securityHandler,contexts,Server&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer#0,postgres-ds,org.apache.activemq.xbean.XBeanBrokerService#0,securityLoginService,securityConstraint,securityConstraintMapping,securityHandler,contexts,Server&lt;/a&gt;; root of factory hierarchy&lt;br/&gt;
 WARN | destroyApplicationContextOnStop parameter is deprecated, please use shutdown hooks instead&lt;br/&gt;
 INFO | PListStore:/home/wolpert/Downloads/apache-activemq-5.4.2/data/localhost/tmp_storage started&lt;br/&gt;
 INFO | Using Persistence Adapter: JDBCPersistenceAdapter(org.postgresql.ds.PGPoolingDataSource@3302fc5)&lt;br/&gt;
 INFO | Database adapter driver override recognized for : &lt;span class=&quot;error&quot;&gt;&amp;#91;postgresql_native_driver&amp;#93;&lt;/span&gt; - adapter: class org.apache.activemq.store.jdbc.adapter.PostgresqlJDBCAdapter&lt;br/&gt;
 WARN | Could not create JDBC tables; they could already exist. Failure was: ALTER TABLE ACTIVEMQ_ACKS DROP PRIMARY KEY Message: ERROR: syntax error at or near &quot;PRIMARY&quot;&lt;br/&gt;
  Position: 32 SQLState: 42601 Vendor code: 0&lt;br/&gt;
 WARN | Failure details: ERROR: syntax error at or near &quot;PRIMARY&quot;&lt;br/&gt;
  Position: 32&lt;br/&gt;
org.postgresql.util.PSQLException: ERROR: syntax error at or near &quot;PRIMARY&quot;&lt;br/&gt;
  Position: 32&lt;br/&gt;
        at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2062)&lt;br/&gt;
        at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:1795)&lt;br/&gt;
        at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:257)&lt;br/&gt;
        at org.postgresql.jdbc2.AbstractJdbc2Statement.execute(AbstractJdbc2Statement.java:479)&lt;br/&gt;
        at org.postgresql.jdbc2.AbstractJdbc2Statement.executeWithFlags(AbstractJdbc2Statement.java:353)&lt;br/&gt;
        at org.postgresql.jdbc2.AbstractJdbc2Statement.execute(AbstractJdbc2Statement.java:345)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.postgresql.ds.jdbc23.AbstractJdbc23PooledConnection$StatementHandler.invoke(AbstractJdbc23PooledConnection.java:455)&lt;br/&gt;
        at $Proxy5.execute(Unknown Source)&lt;br/&gt;
        at org.apache.activemq.store.jdbc.adapter.DefaultJDBCAdapter.doCreateTables(DefaultJDBCAdapter.java:101)&lt;br/&gt;
        at org.apache.activemq.store.jdbc.JDBCPersistenceAdapter.start(JDBCPersistenceAdapter.java:272)&lt;br/&gt;
        at org.apache.activemq.broker.BrokerService.start(BrokerService.java:485)&lt;br/&gt;
        at org.apache.activemq.xbean.XBeanBrokerService.afterPropertiesSet(XBeanBrokerService.java:60)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;Database reports the following with its log turned on full.&lt;/p&gt;

&lt;p&gt;2010-12-08 14:35:31 MST LOG:  execute &amp;lt;unnamed&amp;gt;: SET SESSION CHARACTERISTICS AS TRANSACTION ISOLATION LEVEL READ UNCOMMITTED&lt;br/&gt;
2010-12-08 14:35:31 MST LOG:  execute S_1: BEGIN&lt;br/&gt;
2010-12-08 14:35:31 MST LOG:  execute &amp;lt;unnamed&amp;gt;: SELECT NULL AS TABLE_CAT, n.nspname AS TABLE_SCHEM, c.relname AS TABLE_NAME,  CASE n.nspname ~ &apos;^pg_&apos; OR n.nspname = &apos;information_schema&apos;  WHEN true THEN CASE  WHEN n.nspname = &apos;pg_catalog&apos; OR n.nspname = &apos;information_schema&apos; THEN CASE c.relkind   WHEN &apos;r&apos; THEN &apos;SYSTEM TABLE&apos;   WHEN &apos;v&apos; THEN &apos;SYSTEM VIEW&apos;   WHEN &apos;i&apos; THEN &apos;SYSTEM INDEX&apos;   ELSE NULL   END  WHEN n.nspname = &apos;pg_toast&apos; THEN CASE c.relkind   WHEN &apos;r&apos; THEN &apos;SYSTEM TOAST TABLE&apos;   WHEN &apos;i&apos; THEN &apos;SYSTEM TOAST INDEX&apos;   ELSE NULL   END  ELSE CASE c.relkind   WHEN &apos;r&apos; THEN &apos;TEMPORARY TABLE&apos;   WHEN &apos;i&apos; THEN &apos;TEMPORARY INDEX&apos;   ELSE NULL   END  END  WHEN false THEN CASE c.relkind  WHEN &apos;r&apos; THEN &apos;TABLE&apos;  WHEN &apos;i&apos; THEN &apos;INDEX&apos;  WHEN &apos;S&apos; THEN &apos;SEQUENCE&apos;  WHEN &apos;v&apos; THEN &apos;VIEW&apos;  ELSE NULL  END  ELSE NULL  END  AS TABLE_TYPE, d.description AS REMARKS  FROM pg_catalog.pg_namespace n, pg_catalog.pg_class c  LEFT JOIN pg_catalog.pg_description d ON (c.oid = d.objoid AND d.objsubid = 0)  LEFT JOIN pg_catalog.pg_class dc ON (d.classoid=dc.oid AND dc.relname=&apos;pg_class&apos;)  LEFT JOIN pg_catalog.pg_namespace dn ON (dn.oid=dc.relnamespace AND dn.nspname=&apos;pg_catalog&apos;)  WHERE c.relnamespace = n.oid  AND c.relname LIKE &apos;ACTIVEMQ_MSGS&apos;  AND (false  OR ( c.relkind = &apos;r&apos; AND n.nspname !~ &apos;^pg_&apos; AND n.nspname &amp;lt;&amp;gt; &apos;information_schema&apos; ) )  ORDER BY TABLE_TYPE,TABLE_SCHEM,TABLE_NAME &lt;br/&gt;
2010-12-08 14:35:31 MST LOG:  execute &amp;lt;unnamed&amp;gt;: CREATE TABLE ACTIVEMQ_MSGS(ID BIGINT NOT NULL, CONTAINER VARCHAR(250), MSGID_PROD VARCHAR(250), MSGID_SEQ BIGINT, EXPIRATION BIGINT, MSG BYTEA, PRIMARY KEY ( ID ) )&lt;br/&gt;
2010-12-08 14:35:31 MST LOG:  execute &amp;lt;unnamed&amp;gt;: CREATE INDEX ACTIVEMQ_MSGS_MIDX ON ACTIVEMQ_MSGS (MSGID_PROD,MSGID_SEQ)&lt;br/&gt;
2010-12-08 14:35:31 MST LOG:  execute &amp;lt;unnamed&amp;gt;: CREATE INDEX ACTIVEMQ_MSGS_CIDX ON ACTIVEMQ_MSGS (CONTAINER)&lt;br/&gt;
2010-12-08 14:35:31 MST LOG:  execute &amp;lt;unnamed&amp;gt;: CREATE INDEX ACTIVEMQ_MSGS_EIDX ON ACTIVEMQ_MSGS (EXPIRATION)&lt;br/&gt;
2010-12-08 14:35:31 MST LOG:  execute &amp;lt;unnamed&amp;gt;: CREATE TABLE ACTIVEMQ_ACKS(CONTAINER VARCHAR(250) NOT NULL, SUB_DEST VARCHAR(250), CLIENT_ID VARCHAR(250) NOT NULL, SUB_NAME VARCHAR(250) NOT NULL, SELECTOR VARCHAR(250), LAST_ACKED_ID BIGINT, PRIMARY KEY ( CONTAINER, CLIENT_ID, SUB_NAME))&lt;br/&gt;
2010-12-08 14:35:31 MST LOG:  execute &amp;lt;unnamed&amp;gt;: CREATE TABLE ACTIVEMQ_LOCK( ID BIGINT NOT NULL, TIME BIGINT, BROKER_NAME VARCHAR(250), PRIMARY KEY (ID) )&lt;br/&gt;
2010-12-08 14:35:32 MST LOG:  execute &amp;lt;unnamed&amp;gt;: INSERT INTO ACTIVEMQ_LOCK(ID) VALUES (1)&lt;br/&gt;
2010-12-08 14:35:32 MST LOG:  execute &amp;lt;unnamed&amp;gt;: ALTER TABLE ACTIVEMQ_MSGS ADD PRIORITY BIGINT&lt;br/&gt;
2010-12-08 14:35:32 MST LOG:  execute &amp;lt;unnamed&amp;gt;: CREATE INDEX ACTIVEMQ_MSGS_PIDX ON ACTIVEMQ_MSGS (PRIORITY)&lt;br/&gt;
2010-12-08 14:35:32 MST LOG:  execute &amp;lt;unnamed&amp;gt;: ALTER TABLE ACTIVEMQ_ACKS ADD PRIORITY BIGINT DEFAULT 5 NOT NULL&lt;br/&gt;
2010-12-08 14:35:32 MST ERROR:  syntax error at or near &quot;PRIMARY&quot; at character 32&lt;br/&gt;
2010-12-08 14:35:32 MST STATEMENT:  ALTER TABLE ACTIVEMQ_ACKS DROP PRIMARY KEY&lt;br/&gt;
2010-12-08 14:35:32 MST ERROR:  current transaction is aborted, commands ignored until end of transaction block&lt;br/&gt;
2010-12-08 14:35:32 MST STATEMENT:  ALTER TABLE ACTIVEMQ_ACKS ADD PRIMARY KEY (CONTAINER, CLIENT_ID, SUB_NAME, PRIORITY)&lt;br/&gt;
2010-12-08 14:35:32 MST LOG:  execute S_2: COMMIT&lt;br/&gt;
2010-12-08 14:35:32 MST LOG:  execute &amp;lt;unnamed&amp;gt;: SET SESSION CHARACTERISTICS AS TRANSACTION ISOLATION LEVEL READ UNCOMMITTED&lt;br/&gt;
2010-12-08 14:35:32 MST LOG:  execute S_1: BEGIN&lt;br/&gt;
2010-12-08 14:35:32 MST ERROR:  relation &quot;activemq_lock&quot; does not exist at character 15&lt;br/&gt;
2010-12-08 14:35:32 MST STATEMENT:  SELECT * FROM ACTIVEMQ_LOCK FOR UPDATE&lt;br/&gt;
2010-12-08 14:35:32 MST LOG:  execute S_3: ROLLBACK&lt;br/&gt;
2010-12-08 14:35:32 MST LOG:  unexpected EOF on client connection&lt;/p&gt;


&lt;p&gt;The specific error is: ALTER TABLE ACTIVEMQ_ACKS DROP PRIMARY KEY&lt;/p&gt;

&lt;p&gt;The first obvious question is why is the primary key being created anyways if your just dropping it. Though its likely due to upgrading the database for 5.4 from an earlier version. If the goal is to drop the &apos;primary key constraint&apos;, the code should execute this instead:&lt;/p&gt;

&lt;p&gt;ALTER TABLE activemq_acks drop constraint activemq_acks_pkey;&lt;/p&gt;</description>
                <environment>&lt;p&gt;ActiveMQ 5.4.2 fresh install, Ubuntu 64-bit OpenJDK 6b20-1.9.2-0ubuntu1 PostgreSQL 8.4&lt;/p&gt;</environment>
        <key id="12492768">AMQ-3075</key>
            <summary>Auto-create database fails with PostgreSQL (Error in SQL: &apos;drop primary key&apos;)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10101">Abandoned</resolution>
                                        <assignee username="dejanb">Dejan Bosanac</assignee>
                                    <reporter username="wolpert">Ned Wolpert</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Dec 2010 22:04:42 +0000</created>
                <updated>Sun, 13 Mar 2022 14:02:23 +0000</updated>
                            <resolved>Sun, 13 Mar 2022 14:02:23 +0000</resolved>
                                    <version>5.4.2</version>
                                    <fixVersion>5.5.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>3</votes>
                                    <watches>8</watches>
                                                                                                                <comments>
                            <comment id="12971249" author="gtully" created="Tue, 14 Dec 2010 12:34:48 +0000"  >&lt;p&gt;Thanks for the detailed log information.&lt;br/&gt;
Yes, the use case is auto upgrading an existing datastore.&lt;br/&gt;
Can you validate that the rest of the statements  work on postgresql by making the changed to the xml  configuration using a spring property update of the form. This can also provide a workaround.&lt;/p&gt;

&lt;p&gt;Think we can pull out the alter table statements to have them easily overridden by the postgresql adapter.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;persistenceAdapter&amp;gt;
 &amp;lt;jdbcPersistenceAdapter dataSource=&lt;span class=&quot;code-quote&quot;&gt;&quot;#postgres-ds&quot;&lt;/span&gt; useDatabaseLock=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;&amp;gt;
         &amp;lt;statements&amp;gt;
            &amp;lt;statements&amp;gt;
                        &amp;lt;property xmlns=&lt;span class=&quot;code-quote&quot;&gt;&quot;http:&lt;span class=&quot;code-comment&quot;&gt;//www.springframework.org/schema/beans&quot;&lt;/span&gt; name=&lt;span class=&quot;code-quote&quot;&gt;&quot;createSchemaStatements&quot;&lt;/span&gt;&amp;gt;
&lt;/span&gt;                            &amp;lt;list&amp;gt;
                             &amp;lt;value&amp;gt;CREATE TABLE ACTIVEMQ_MSGS(ID BIGINT NOT NULL, CONTAINER VARCHAR(250), MSGID_PROD
                                VARCHAR(250), MSGID_SEQ BIGINT, EXPIRATION BIGINT, MSG BYTEA, PRIMARY KEY ( ID ) )&amp;lt;/value&amp;gt;
                             &amp;lt;value&amp;gt;CREATE INDEX ACTIVEMQ_MSGS_MIDX ON ACTIVEMQ_MSGS (MSGID_PROD,MSGID_SEQ)&amp;lt;/value&amp;gt;
                             &amp;lt;value&amp;gt;CREATE INDEX ACTIVEMQ_MSGS_CIDX ON ACTIVEMQ_MSGS (CONTAINER)&amp;lt;/value&amp;gt;
                             &amp;lt;value&amp;gt;CREATE INDEX ACTIVEMQ_MSGS_EIDX ON ACTIVEMQ_MSGS (EXPIRATION)&amp;lt;/value&amp;gt;
                             &amp;lt;value&amp;gt;CREATE TABLE ACTIVEMQ_ACKS(CONTAINER VARCHAR(250) NOT NULL, SUB_DEST VARCHAR(250), CLIENT_ID VARCHAR(250) NOT NULL, SUB_NAME VARCHAR(250) NOT NULL, SELECTOR VARCHAR(250), LAST_ACKED_ID BIGINT, PRIMARY KEY ( CONTAINER, CLIENT_ID, SUB_NAME))&amp;lt;/value&amp;gt;
                             &amp;lt;value&amp;gt;CREATE TABLE ACTIVEMQ_LOCK( ID BIGINT NOT NULL, TIME BIGINT, BROKER_NAME VARCHAR(250), PRIMARY KEY (ID) )&amp;lt;/value&amp;gt;
                             &amp;lt;value&amp;gt;INSERT INTO ACTIVEMQ_LOCK(ID) VALUES (1)&amp;lt;/value&amp;gt;
                             &amp;lt;value&amp;gt;ALTER TABLE ACTIVEMQ_MSGS ADD PRIORITY BIGINT&amp;lt;/value&amp;gt;
                             &amp;lt;value&amp;gt;CREATE INDEX ACTIVEMQ_MSGS_PIDX ON ACTIVEMQ_MSGS (PRIORITY)&amp;lt;/value&amp;gt;
                             &amp;lt;value&amp;gt;ALTER TABLE ACTIVEMQ_ACKS ADD PRIORITY BIGINT DEFAULT 5 NOT NULL&amp;lt;/value&amp;gt;
                             &amp;lt;value&amp;gt; ALTER TABLE activemq_acks drop constraint activemq_acks_pkey&amp;lt;/value&amp;gt;
                             &amp;lt;value&amp;gt;ALTER TABLE ACTIVEMQ_ACKS ADD PRIMARY KEY (CONTAINER, CLIENT_ID, SUB_NAME, PRIORITY)&amp;lt;/value&amp;gt;
                         &amp;lt;/list&amp;gt;
                 &amp;lt;/property&amp;gt;
      &amp;lt;/statements&amp;gt;
   &amp;lt;/statements&amp;gt;
 &amp;lt;/jdbcPersistenceAdapter&amp;gt;
&amp;lt;/persistenceAdapter&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12971250" author="gtully" created="Tue, 14 Dec 2010 12:36:38 +0000"  >&lt;p&gt;or maybe the &quot;ALTER TABLE activemq_acks drop constraint activemq_acks_pkey&quot; syntax will work across the board.&lt;/p&gt;</comment>
                            <comment id="12971284" author="gtully" created="Tue, 14 Dec 2010 15:19:56 +0000"  >&lt;p&gt;r1049122&lt;/p&gt;

&lt;p&gt;Postgres adapter overrides the alter statement to resolve. new attribute on statements to expose the variability and acksPkName attribute on posgres adapter in case generated name of pk constraint changes.&lt;/p&gt;</comment>
                            <comment id="12971290" author="wolpert" created="Tue, 14 Dec 2010 15:56:20 +0000"  >&lt;p&gt;I&apos;ll check out the update and double-check that it solves the issue. I don&apos;t know if the alter table statement is thee same for every db AMQ supports, but I can test out psql with what&apos;s in there.&lt;/p&gt;</comment>
                            <comment id="12983333" author="kaiqinsun" created="Tue, 18 Jan 2011 19:04:19 +0000"  >&lt;p&gt;Hi Gary, &lt;/p&gt;

&lt;p&gt;SQL Server 2005 has the same problem as PostgreSQL. Could you please update TransactJDBCAdapter as well?&lt;/p&gt;

&lt;p&gt;--Kevin&lt;/p&gt;</comment>
                            <comment id="12983646" author="gtully" created="Wed, 19 Jan 2011 10:34:40 +0000"  >&lt;p&gt;@Kevin, do you know what a sensible default name for the PK in SQLServer is?&lt;br/&gt;
As there is no name provided when the constraint is created the name auto-generated by sql server, seems to be of the form &quot;PK...&quot;&lt;/p&gt;</comment>
                            <comment id="12983706" author="kaiqinsun" created="Wed, 19 Jan 2011 13:31:59 +0000"  >&lt;p&gt;Hi Gary,&lt;/p&gt;

&lt;p&gt;You are right. &quot;ACTIVEMQ_ACKS&quot; has a composite primary key and the contraint has the form like this: PK_&lt;em&gt;ACTIVEMQ_ACKS&lt;/em&gt;_6DC22B62. This primary key constraint is auto-generated by SQL Server and also everytime the contraint is different.&lt;br/&gt;
This script works &quot;ALTER TABLE &lt;span class=&quot;error&quot;&gt;&amp;#91;dbo&amp;#93;&lt;/span&gt;.&lt;span class=&quot;error&quot;&gt;&amp;#91;ACTIVEMQ_ACKS&amp;#93;&lt;/span&gt; DROP CONSTRAINT &lt;span class=&quot;error&quot;&gt;&amp;#91;PK__ACTIVEMQ_ACKS__6DC22B62&amp;#93;&lt;/span&gt;&quot; and I have tried &quot;ALTER TABLE &lt;span class=&quot;error&quot;&gt;&amp;#91;dbo&amp;#93;&lt;/span&gt;.&lt;span class=&quot;error&quot;&gt;&amp;#91;ACTIVEMQ_ACKS&amp;#93;&lt;/span&gt; DROP CONSTRAINT &lt;span class=&quot;error&quot;&gt;&amp;#91;PK__ACTIVEMQ_ACKS&amp;#93;&lt;/span&gt;&quot; but it doesn&apos;t work.&lt;/p&gt;

&lt;p&gt;We could use &quot;select name from sysobjects where xtype = &apos;PK&apos; and parent_obj = object_id(&apos;ACTIVEMQ_ACKS&apos;)&quot; to get the contraint name. It may need to use dynamic SQL to drop the primary key from SQL Server.&lt;/p&gt;

&lt;p&gt;There are also some links may give some hints:&lt;br/&gt;
SQL Server: drop table primary key, without knowing its name: &lt;a href=&quot;http://stackoverflow.com/questions/1587812/sql-server-drop-table-primary-key-without-knowing-its-name&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/1587812/sql-server-drop-table-primary-key-without-knowing-its-name&lt;/a&gt;&lt;br/&gt;
SQL SERVER - How to Drop Primary Key Contraint: &lt;a href=&quot;http://blog.sqlauthority.com/2009/05/12/sql-server-how-to-drop-primary-key-contraint/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://blog.sqlauthority.com/2009/05/12/sql-server-how-to-drop-primary-key-contraint/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;--Kevin&lt;/p&gt;</comment>
                            <comment id="12983715" author="kaiqinsun" created="Wed, 19 Jan 2011 14:05:34 +0000"  >&lt;p&gt;Hi Gary,&lt;/p&gt;

&lt;p&gt;Could we define the primary key constraint name when creating ACTIVEMQ_ACKS? Then we could have a fixed constraint name and this name could be used in ALTER SQL.&lt;br/&gt;
For instance, when creating the table we use the following SQL: &lt;/p&gt;

&lt;p&gt;CREATE TABLE ACTIVEMQ_ACKS&lt;br/&gt;
(&lt;/p&gt;

&lt;p&gt;   CONTAINER VARCHAR(250) NOT NULL, &lt;br/&gt;
   SUB_DEST VARCHAR(250), &lt;br/&gt;
   CLIENT_ID VARCHAR(250) NOT NULL, &lt;br/&gt;
   SUB_NAME VARCHAR(250) NOT NULL, &lt;br/&gt;
   SELECTOR VARCHAR(250), &lt;br/&gt;
   LAST_ACKED_ID BIGINT, &lt;br/&gt;
   CONSTRAINT PK_ACTIVEMQ_ACKS PRIMARY KEY&lt;br/&gt;
   (&lt;br/&gt;
        CONTAINER, &lt;br/&gt;
        CLIENT_ID, &lt;br/&gt;
        SUB_NAME&lt;br/&gt;
    )&lt;br/&gt;
)&lt;/p&gt;

&lt;p&gt;We could have the unique CONSTRAINT name as PK_ACTIVEMQ_ACKS. Then we could drop the constraint like this:ALTER TABLE ACTIVEMQ_ACKS DROP CONSTRAINT PK_ACTIVEMQ_ACKS.&lt;br/&gt;
This solution works for SQL server and could work for Oracle as well. I am not sure if this could work for other DBs.&lt;/p&gt;

&lt;p&gt;It seems for MySQL we should use this SQL to drop primary key. &lt;br/&gt;
ALTER TABLE ACTIVEMQ_ACKS DROP PRIMARY KEY&lt;/p&gt;

&lt;p&gt;--Kevin&lt;/p&gt;</comment>
                            <comment id="12983896" author="gtully" created="Wed, 19 Jan 2011 21:58:31 +0000"  >&lt;p&gt;I think we may have to go with the dynamic sql to find the pk, the problem is an upgrade from a schema where the pk name was not provided when the constraint was created. Adding the pk name is probably a good idea though for the future.&lt;/p&gt;</comment>
                            <comment id="13037819" author="gtully" created="Mon, 23 May 2011 09:38:59 +0000"  >&lt;p&gt;need to add some dynamic sql to determine the pk for the drop statements.&lt;/p&gt;</comment>
                            <comment id="15522294" author="rui.b.zhang" created="Mon, 26 Sep 2016 07:06:42 +0000"  >&lt;p&gt;Will this be included into the next release, maybe 5.14.1?&lt;/p&gt;</comment>
                            <comment id="15689497" author="volkerk" created="Wed, 23 Nov 2016 09:25:34 +0000"  >&lt;p&gt;The issue remains on SQLserver in 5.14.1 and prevents broker startup, as the tables do not get created. Despite the existence of a workaround (manually precreate tables) it&apos;s rather stunning that such a critical issue remains unfixed.&lt;/p&gt;</comment>
                            <comment id="17266267" author="mattrpav" created="Fri, 15 Jan 2021 18:10:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wolpert&quot; class=&quot;user-hover&quot; rel=&quot;wolpert&quot;&gt;wolpert&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=volkerk&quot; class=&quot;user-hover&quot; rel=&quot;volkerk&quot;&gt;volkerk&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rui.b.zhang&quot; class=&quot;user-hover&quot; rel=&quot;rui.b.zhang&quot;&gt;rui.b.zhang&lt;/a&gt; This issue is quite dated and may be resolved in the heavy JDBC updates that came up through 5.16.1. Is this still an issue? &lt;/p&gt;</comment>
                            <comment id="17266290" author="pberkman" created="Fri, 15 Jan 2021 18:46:27 +0000"  >&lt;p&gt;Matt, thank you for reviewing - we upgraded to v 5.15 not too long ago and will be upgrading again within a few months.&#160; Once we do, I&apos;ll remove my &quot;hack&quot; and see if it works - I&apos;ll keep this ticket up to date as I go.&lt;/p&gt;</comment>
                            <comment id="17266301" author="wolpert" created="Fri, 15 Jan 2021 19:07:11 +0000"  >&lt;p&gt;Matt... I have no insight into this anymore, and no longer have access to an environment (production or otherwise) that uses ActiveMQ.&lt;/p&gt;</comment>
                            <comment id="17266305" author="volkerk" created="Fri, 15 Jan 2021 19:10:50 +0000"  >&lt;p&gt;Same here&lt;/p&gt;</comment>
                            <comment id="17505520" author="christopher.l.shannon" created="Sun, 13 Mar 2022 14:02:23 +0000"  >&lt;p&gt;Closing very old jiras that were created more than 10 years ago&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14749</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 35 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b9uf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63707</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>