<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:53:22 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3719] Tracked command IOException causes FailoverTransport to hang until failure occurs for untracked command</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3719</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I have only encountered this failure when the broker is experiencing heavy load and a new connection attempt is made.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;The FailoverTransport tracks commands that have been issued so that it can restore the state upon a failure/reconnect event.&lt;/li&gt;
	&lt;li&gt;If an IOException occurs when sending a tracked command, the oneway() method returns, assuming that the IOException is indicative of a transport failure and will result in a failure/reconnect event.&lt;/li&gt;
	&lt;li&gt;Some IOExceptions (like WireFormatNegotiation timesouts) are not always indicative of transport failure however.  In this case since no subsequent failure/reconnect event occurs, the command will never be resent.  If this is a synchronous command (like that generated by starting a connection) the calling thread will hang.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Incidentally, my reading of the code is that only non-tracked commands can generate the IOException that triggers the handleTransportFailure command.  Is that what we really want?  &lt;/p&gt;

&lt;p&gt;My belief is that the IOExceptions should always result in the triggering of the handleTransportFailure, regardless of origin.&lt;/p&gt;

&lt;p&gt;I will attach a unit test and fix shortly.  The test will often fail (i.e. hang) without the fix, but not always since I use a wireFormat.maxInactivityDurationInitalDelay=1 option to trigger the behavior.  If the system runs fast enough, it sometimes will not get the timeout.  I wasn&apos;t sure exactly how such a test should be written...The test will fail if connection does not succeed within 60s&lt;/p&gt;</description>
                <environment>&lt;p&gt;Intel(R) Core(TM) i5 CPU M 540 @2.53GHz&lt;br/&gt;
8 GB, 64-bit&lt;/p&gt;</environment>
        <key id="12542745">AMQ-3719</key>
            <summary>Tracked command IOException causes FailoverTransport to hang until failure occurs for untracked command</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="mserrano">Martin Serrano</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Feb 2012 20:12:28 +0000</created>
                <updated>Wed, 14 Mar 2012 21:32:07 +0000</updated>
                            <resolved>Wed, 14 Mar 2012 21:32:07 +0000</resolved>
                                                    <fixVersion>5.6.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13208780" author="mserrano" created="Wed, 15 Feb 2012 20:45:40 +0000"  >&lt;p&gt;test and patch for bug attached&lt;/p&gt;</comment>
                            <comment id="13226900" author="tabish121" created="Sat, 10 Mar 2012 17:20:02 +0000"  >&lt;p&gt;This does appear to be an issue.  I don&apos;t think the patch is quite correct since it doesn&apos;t hop out of the redelivery attempt loop inside of oneway though which would cause the same tracked command to be attempted a second time which is shouldn&apos;t be since its already in the state tracker.  Perhaps the correct thing here is simply an else clause on the if (tracked == null) that calls the handleTransportFailure and then allows the method to return as usual.  &lt;/p&gt;</comment>
                            <comment id="13229646" author="tabish121" created="Wed, 14 Mar 2012 21:32:07 +0000"  >&lt;p&gt;Fixed on trunk, thanks for doing the leg work on this one.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12514702" name="amq-3719.patch" size="7597" author="mserrano" created="Wed, 15 Feb 2012 20:45:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>228031</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 36 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ai6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59220</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>