<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:30:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-662] Infinite Loop after message resend</title>
                <link>https://issues.apache.org/jira/browse/AMQ-662</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;when a runtime exception in onMessage the messages are getting rolledback/resent as expected, however AMQ appears to go into an infinite loop at this point taking up 100% of the CPU. Turning debug on shows the following repeated:&lt;br/&gt;
...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; 2006-03-21 16:55:37,586 - org.apache.activemq.ra.ServerSessionImpl:1 (ServerSessionImpl.java:159)- run loop start&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; 2006-03-21 16:55:37,586 - org.apache.activemq.ra.ServerSessionImpl:3 (ServerSessionImpl.java:172)- run loop end&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; 2006-03-21 16:55:37,586 - org.apache.activemq.ra.ServerSessionImpl:22 (ServerSessionImpl.java:172)- run loop end&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; 2006-03-21 16:55:37,586 - org.apache.activemq.ra.ServerSessionImpl:11 (ServerSessionImpl.java:159)- run loop start&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; 2006-03-21 16:55:37,586 - org.apache.activemq.ra.ServerSessionImpl:0 (ServerSessionImpl.java:172)- run loop end&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; 2006-03-21 16:55:37,586 - org.apache.activemq.ra.ServerSessionImpl:17 (ServerSessionImpl.java:172)- run loop end&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;DEBUG&amp;#93;&lt;/span&gt; 2006-03-21 16:55:37,586 - org.apache.activemq.ra.ServerSessionImpl:1 (ServerSessionImpl.java:172)- run loop end &lt;/p&gt;

&lt;p&gt;The resend (and resulting infinte loop) was triggered by throwing a RuntimeException in the onMessage method of the POJO MDB.&lt;/p&gt;

&lt;p&gt;This is being used alongside Spring 1.2.7, Jencks 1.1.1 in a POJO message driven bean setup. Attached are the configurations producing the error. &lt;/p&gt;</description>
                <environment>&lt;p&gt;JDK 1.5&lt;/p&gt;</environment>
        <key id="12481277">AMQ-662</key>
            <summary>Infinite Loop after message resend</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="chirino">Hiram R. Chirino</assignee>
                                    <reporter username="jpederzolli">John Titor</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Mar 2006 23:43:58 +0000</created>
                <updated>Fri, 7 Apr 2006 23:10:45 +0000</updated>
                            <resolved>Fri, 7 Apr 2006 23:10:45 +0000</resolved>
                                    <version>4.0 RC2</version>
                                    <fixVersion>3.2.4</fixVersion>
                    <fixVersion>4.0 RC3</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12937615" author="jpederzolli" created="Thu, 30 Mar 2006 11:45:40 +0000"  >&lt;p&gt;I&apos;ve been looking into this further and it appears to be a synchronization issue in or related to ServerSessionImpl.java. If I individually send messages which are then forced to resend, everything works fine. This infinite loop only occurs when I send several messages in a row. &lt;/p&gt;</comment>
                            <comment id="12937747" author="jpederzolli" created="Wed, 5 Apr 2006 00:25:38 +0000"  >
&lt;p&gt;I found what seems to be the source of the infinite loop - in MessageDispatchChannel.java, in the method dequeueNoWait (line 91):&lt;/p&gt;

&lt;p&gt;    public MessageDispatch dequeueNoWait() {&lt;br/&gt;
        synchronized (mutex) {&lt;br/&gt;
            if (closed || !running || list.isEmpty()) &lt;/p&gt;
{
                return null;
            }
&lt;p&gt;            return (MessageDispatch) list.removeFirst();&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;The thread that keeps on spinning has values of closed=false, running=false, and a nonEmpty list. With those values, a null is returned up to the run() method of ActiveMqSession.java (line 640), causing it do do nothing and then finally up to ServerSessionImpl.java&apos;s run() method (line 156) where in the finally block the following code that is responsible for breaking out of the while loop (line 170):&lt;/p&gt;

&lt;p&gt;            finally {&lt;br/&gt;
                InboundContextSupport.unregister(this);                &lt;br/&gt;
                log.debug(&quot;run loop end&quot;);            &lt;br/&gt;
                synchronized (runControlMutex) {&lt;br/&gt;
                    // This endpoint may have gone stale due to error&lt;br/&gt;
                    if( stale) &lt;/p&gt;
{
                        runningFlag = false;
                        pool.removeFromPool(this);
                        break;
                    }
&lt;p&gt;                    if( !session.hasUncomsumedMessages() ) &lt;/p&gt;
{
                        runningFlag = false;
                        pool.returnToPool(this);
                        break;
                    }
&lt;p&gt;                &lt;br/&gt;
                }&lt;/p&gt;

&lt;p&gt;Neither break statement is hit since the endpoint is not stale and it has unconsumed messages - and the infinite loop begins. &lt;/p&gt;</comment>
                            <comment id="12936338" author="chirino" created="Fri, 7 Apr 2006 23:10:44 +0000"  >&lt;p&gt;fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12460785" name="ASF.LICENSE.NOT.GRANTED--activemq.xml" size="419" author="jpederzolli" created="Mon, 27 Mar 2006 23:43:58 +0000"/>
                            <attachment id="12460721" name="ASF.LICENSE.NOT.GRANTED--applicationContext.xml" size="2406" author="jpederzolli" created="Mon, 27 Mar 2006 23:43:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49289</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            19 years, 34 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0s007:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>161477</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>