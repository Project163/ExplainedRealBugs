<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:43:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2472] NullPointerException during startup of DiscoveryNetworkConnector when using an HTTP URL for an inactive remote broker.</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2472</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Symptom&lt;br/&gt;
========&lt;br/&gt;
When starting a statically-configured network of two AMQ brokers, each of which uses HTTP as their transport, if one of the brokers is not running when the other starts up, the following NPE appears in the logs:&lt;/p&gt;

&lt;p&gt;2009-11-01 11:05:53,626 &lt;span class=&quot;error&quot;&gt;&amp;#91;AlarmPoint Node-main&amp;#93;&lt;/span&gt; INFO    -  - Using Persistence Adapter: MemoryPersistenceAdapter&lt;br/&gt;
2009-11-01 11:05:53,626 &lt;span class=&quot;error&quot;&gt;&amp;#91;AlarmPoint Node-main&amp;#93;&lt;/span&gt; INFO    -  - ActiveMQ 5.3.0 JMS Message Broker (localhost) is starting&lt;br/&gt;
2009-11-01 11:05:53,626 &lt;span class=&quot;error&quot;&gt;&amp;#91;AlarmPoint Node-main&amp;#93;&lt;/span&gt; INFO    -  - For help or more information please see: &lt;a href=&quot;http://activemq.apache.org/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/&lt;/a&gt;&lt;br/&gt;
2009-11-01 11:05:53,829 &lt;span class=&quot;error&quot;&gt;&amp;#91;AlarmPoint Node-main&amp;#93;&lt;/span&gt; WARN    -  - 2009-11-01 11:05:53.445::INFO:  Logging to STDERR via org.mortbay.log.StdErrLog&lt;br/&gt;
2009-11-01 11:05:53,876 &lt;span class=&quot;error&quot;&gt;&amp;#91;AlarmPoint Node-main&amp;#93;&lt;/span&gt; WARN    -  - 2009-11-01 11:05:53.492::INFO:  jetty-6.1.9&lt;br/&gt;
2009-11-01 11:05:53,922 &lt;span class=&quot;error&quot;&gt;&amp;#91;AlarmPoint Node-main&amp;#93;&lt;/span&gt; WARN    -  - 2009-11-01 11:05:53.538::INFO:  Started SocketConnector@localhost:50000&lt;br/&gt;
2009-11-01 11:05:53,922 &lt;span class=&quot;error&quot;&gt;&amp;#91;AlarmPoint Node-main&amp;#93;&lt;/span&gt; INFO    -  - Connector &lt;a href=&quot;http://localhost:50000&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:50000&lt;/a&gt; Started&lt;br/&gt;
2009-11-01 11:05:53,922 &lt;span class=&quot;error&quot;&gt;&amp;#91;AlarmPoint Node-main&amp;#93;&lt;/span&gt; INFO    -  - Establishing network connection from vm://localhost to &lt;a href=&quot;http://192.168.168.44:50001&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://192.168.168.44:50001&lt;/a&gt;&lt;br/&gt;
2009-11-01 11:05:53,938 &lt;span class=&quot;error&quot;&gt;&amp;#91;AlarmPoint Node-main&amp;#93;&lt;/span&gt; DEBUG   -  - binding to broker: localhost&lt;br/&gt;
2009-11-01 11:05:53,938 &lt;span class=&quot;error&quot;&gt;&amp;#91;AlarmPoint Node-main&amp;#93;&lt;/span&gt; INFO    -  - Connector vm://localhost Started&lt;br/&gt;
2009-11-01 11:05:57,954 &lt;span class=&quot;error&quot;&gt;&amp;#91;AlarmPoint Node-main&amp;#93;&lt;/span&gt; DEBUG   -  - Shutting down VM connectors for broker: localhost&lt;br/&gt;
2009-11-01 11:05:57,954 &lt;a href=&quot;#0&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ActiveMQ Transport Stopper: vm://localhost#0&lt;/a&gt; DEBUG   -  - Stopping connection: vm://localhost#0&lt;br/&gt;
2009-11-01 11:05:57,954 &lt;a href=&quot;#0&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ActiveMQ Transport Stopper: vm://localhost#0&lt;/a&gt; DEBUG   -  - Stopped transport: vm://localhost#0&lt;br/&gt;
2009-11-01 11:05:57,954 &lt;a href=&quot;#0&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;ActiveMQ Transport Stopper: vm://localhost#0&lt;/a&gt; DEBUG   -  - Connection Stopped: vm://localhost#0&lt;br/&gt;
2009-11-01 11:05:57,954 &lt;span class=&quot;error&quot;&gt;&amp;#91;AlarmPoint Node-main&amp;#93;&lt;/span&gt; INFO    -  - Connector vm://localhost Stopped&lt;br/&gt;
2009-11-01 11:05:57,954 &lt;span class=&quot;error&quot;&gt;&amp;#91;AlarmPoint Node-main&amp;#93;&lt;/span&gt; ERROR   -  - Could not stop service: HTTP Reader &lt;a href=&quot;http://192.168.168.44:50001&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://192.168.168.44:50001&lt;/a&gt;. Reason: java.lang.NullPointerException&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.activemq.transport.http.HttpClientTransport.doStop(HttpClientTransport.java:202)&lt;br/&gt;
	at org.apache.activemq.util.ServiceSupport.stop(ServiceSupport.java:69)&lt;br/&gt;
	at org.apache.activemq.transport.TransportFilter.stop(TransportFilter.java:64)&lt;br/&gt;
	at org.apache.activemq.transport.TransportFilter.stop(TransportFilter.java:64)&lt;br/&gt;
	at org.apache.activemq.transport.ResponseCorrelator.stop(ResponseCorrelator.java:125)&lt;br/&gt;
	at org.apache.activemq.util.ServiceSupport.dispose(ServiceSupport.java:43)&lt;br/&gt;
	at org.apache.activemq.network.DiscoveryNetworkConnector.onServiceAdd(DiscoveryNetworkConnector.java:134)&lt;br/&gt;
	at org.apache.activemq.transport.discovery.simple.SimpleDiscoveryAgent.start(SimpleDiscoveryAgent.java:77)&lt;br/&gt;
	at org.apache.activemq.network.DiscoveryNetworkConnector.handleStart(DiscoveryNetworkConnector.java:182)&lt;br/&gt;
	at org.apache.activemq.network.NetworkConnector$1.doStart(NetworkConnector.java:56)&lt;br/&gt;
	at org.apache.activemq.util.ServiceSupport.start(ServiceSupport.java:53)&lt;br/&gt;
	at org.apache.activemq.network.NetworkConnector.start(NetworkConnector.java:199)&lt;br/&gt;
	at org.apache.activemq.broker.BrokerService.startAllConnectors(BrokerService.java:1933)&lt;br/&gt;
	at org.apache.activemq.broker.BrokerService.start(BrokerService.java:471)&lt;br/&gt;
	at com.invoqsystems.foundation.component.communication.MessageBusImpl.startJmsBroker(MessageBusImpl.java:602)&lt;br/&gt;
	at com.invoqsystems.foundation.component.communication.MessageBusImpl.start(MessageBusImpl.java:364)&lt;br/&gt;
	at com.invoqsystems.apex.component.communication.NodeMessageBusImpl.start(NodeMessageBusImpl.java:207)&lt;br/&gt;
	at com.invoqsystems.apex.component.node.manager.NodeManager.startMessagingServer(NodeManager.java:975)&lt;br/&gt;
	at com.invoqsystems.apex.component.node.manager.NodeManager.start(NodeManager.java:199)&lt;br/&gt;
	at com.invoqsystems.apex.AlarmPointNode.startNodeManager(AlarmPointNode.vaja:162)&lt;br/&gt;
	at com.invoqsystems.apex.AlarmPointNode.run(AlarmPointNode.java:62)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:595)&lt;/p&gt;

&lt;p&gt;Reproduction&lt;br/&gt;
===========&lt;br/&gt;
Configure one broker to listen to &lt;a href=&quot;http://localhost:50000&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:50000&lt;/a&gt; and the other broker to list to &lt;a href=&quot;http://localhost:50001&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:50001&lt;/a&gt;.  Network the brokers together using the SimpleDiscoveryAgent (static) configuration:&lt;/p&gt;

&lt;p&gt;&amp;lt;broker brokerName=&quot;broker1&quot; persistent=&quot;false&quot; useJmx=&quot;false&quot;&amp;gt;  &lt;br/&gt;
    &amp;lt;networkConnectors&amp;gt;&lt;br/&gt;
      &amp;lt;networkConnector uri=&quot;static&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;a href=&quot;http://localhost:50001&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:50001&lt;/a&gt;)&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/networkConnectors&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;persistenceAdapter&amp;gt;&lt;br/&gt;
      &amp;lt;memoryPersistenceAdapter/&amp;gt;&lt;br/&gt;
    &amp;lt;/persistenceAdapter&amp;gt;&lt;/p&gt;

&lt;p&gt;   &amp;lt;transportConnectors&amp;gt;&lt;br/&gt;
      &amp;lt;transportConnector uri=&quot;http://localhost:50000&quot;/&amp;gt;    &lt;br/&gt;
   &amp;lt;/transportConnectors&amp;gt;&lt;br/&gt;
&amp;lt;/broker&amp;gt;&lt;/p&gt;

&lt;p&gt;and the other broker as:&lt;/p&gt;

&lt;p&gt;&amp;lt;broker brokerName=&quot;broker2&quot; persistent=&quot;false&quot; useJmx=&quot;false&quot;&amp;gt;  &lt;br/&gt;
    &amp;lt;networkConnectors&amp;gt;&lt;br/&gt;
      &amp;lt;networkConnector uri=&quot;static&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;a href=&quot;http://localhost:50000&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:50000&lt;/a&gt;)&quot;/&amp;gt;&lt;br/&gt;
    &amp;lt;/networkConnectors&amp;gt;&lt;/p&gt;

&lt;p&gt;    &amp;lt;persistenceAdapter&amp;gt;&lt;br/&gt;
      &amp;lt;memoryPersistenceAdapter/&amp;gt;&lt;br/&gt;
    &amp;lt;/persistenceAdapter&amp;gt;&lt;/p&gt;

&lt;p&gt;   &amp;lt;transportConnectors&amp;gt;&lt;br/&gt;
      &amp;lt;transportConnector uri=&quot;http://localhost:50001&quot;/&amp;gt;    &lt;br/&gt;
   &amp;lt;/transportConnectors&amp;gt;&lt;br/&gt;
&amp;lt;/broker&amp;gt;&lt;/p&gt;

&lt;p&gt;Start broker1, but do not start broker2.  Observe the stacktrace in broker1&apos;s logs.&lt;/p&gt;

&lt;p&gt;Cause&lt;br/&gt;
======&lt;br/&gt;
During startup, the following code executes in DiscoveryNetworkConnector#onServiceAdd(DiscoveryEvent event):&lt;/p&gt;

&lt;p&gt;            NetworkBridge bridge = createBridge(localTransport, remoteTransport, event);&lt;br/&gt;
            try &lt;/p&gt;
{
                bridge.start();
                bridges.put(uri, bridge);
            }
&lt;p&gt; catch (Exception e) {&lt;br/&gt;
                ServiceSupport.dispose(localTransport);&lt;br/&gt;
                ServiceSupport.dispose(remoteTransport);&lt;br/&gt;
                LOG.warn(&quot;Could not start network bridge between: &quot; + localURIName + &quot; and: &quot; + uri + &quot; due to: &quot; + e);&lt;/p&gt;

&lt;p&gt;A bridge is created to connect broker1 to broker2 (&lt;a href=&quot;http://localhost:50000&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:50000&lt;/a&gt; to &lt;a href=&quot;http://localhost:50001&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://localhost:50001&lt;/a&gt;), but since broker2 is not started, bridge.start() will throw a &quot;Connection refused&quot; exception.  In handling this exception, ServiceSupport.dispose(remoteTransport) is called, which eventually calls through to HttpClientTransport#doStop(ServiceStopper stopper):&lt;/p&gt;

&lt;p&gt;    protected void doStop(ServiceStopper stopper) throws Exception &lt;/p&gt;
{
            httpMethod.abort();
    }

&lt;p&gt;The NPE is caused becuase httpMethod is null.&lt;/p&gt;

&lt;p&gt;When bridge.start() is called, it will pass through to HttpClientTransport#doStart():&lt;/p&gt;

&lt;p&gt;        LOG.trace(&quot;HTTP GET consumer thread starting: &quot; + this);&lt;br/&gt;
        HttpClient httpClient = getReceiveHttpClient();&lt;br/&gt;
        URI remoteUrl = getRemoteUrl();&lt;/p&gt;

&lt;p&gt;        HeadMethod httpMethod = new HeadMethod(remoteUrl.toString());&lt;br/&gt;
        configureMethod(httpMethod);&lt;/p&gt;

&lt;p&gt;        int answer = httpClient.executeMethod(httpMethod);&lt;/p&gt;

&lt;p&gt;The httpClient.executeMethod(httpMethod) throws the &quot;connection refused&quot; exception because the HEAD command cannot connect.  The httpMethod in doStart() is a local var, while the object-scope httpMethod is only set once the transport starts running,  which never occurs due to the HEAD failure.&lt;/p&gt;

&lt;p&gt;Solution&lt;br/&gt;
=======&lt;br/&gt;
Check that httpMethod is not null before disposing in HttpClientTransport:&lt;/p&gt;

&lt;p&gt;protected void doStop(ServiceStopper stopper) throws Exception {&lt;br/&gt;
   if(httpMethod != null)&lt;/p&gt;
   {
     httpMethod.abort();
   }
&lt;p&gt;}&lt;/p&gt;</description>
                <environment>&lt;p&gt;ActiveMQ 5.3.0 release (08/10/2009), Windows XP&lt;/p&gt;</environment>
        <key id="12483072">AMQ-2472</key>
            <summary>NullPointerException during startup of DiscoveryNetworkConnector when using an HTTP URL for an inactive remote broker.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="stirlingc">Stirling Chow</reporter>
                        <labels>
                    </labels>
                <created>Sun, 1 Nov 2009 20:40:31 +0000</created>
                <updated>Thu, 12 Nov 2009 11:31:10 +0000</updated>
                            <resolved>Mon, 2 Nov 2009 09:03:11 +0000</resolved>
                                    <version>5.3.0</version>
                                    <fixVersion>5.3.1</fixVersion>
                    <fixVersion>5.4.0</fixVersion>
                                    <component>Connector</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12941521" author="stirlingc" created="Sun, 1 Nov 2009 20:46:05 +0000"  >&lt;p&gt;Patch with changes required to address this issue.  Unused imports have also been removed.&lt;/p&gt;</comment>
                            <comment id="12941528" author="stirlingc" created="Sun, 1 Nov 2009 20:46:54 +0000"  >&lt;p&gt;Patch with fix as well as cleanup of unused imports.&lt;/p&gt;</comment>
                            <comment id="12941598" author="gtully" created="Mon, 2 Nov 2009 09:03:11 +0000"  >&lt;p&gt;patch applied with thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461330" name="patch.txt" size="728" author="stirlingc" created="Sun, 1 Nov 2009 20:46:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74930</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rq9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>159901</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>