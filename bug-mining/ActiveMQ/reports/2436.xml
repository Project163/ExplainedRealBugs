<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:07:45 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5468] AMQ MQTT doesn&apos;t reject remote connection after a long time </title>
                <link>https://issues.apache.org/jira/browse/AMQ-5468</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Test steps:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Using jConsole to explore JMX MBean clientConnectors (MQTT+NIO connector).&lt;/li&gt;
	&lt;li&gt;Using telnet client connect to MQTT+NIO port&lt;/li&gt;
	&lt;li&gt;On jConsole: clientConnectors/mqtt+nio/remoteAddess appear a new connection with IP and local port which connect to.&lt;/li&gt;
	&lt;li&gt;Close telnet program&lt;/li&gt;
	&lt;li&gt;Waiting a long time (could be more than a day) and view remoteAddess again on jConsole but Remote IP (telnet) does not remove.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Imagine that if a human open a thousand or million connections to server, AMQ not release connections after short time, then AMQ could be throws the ERROR &quot;To many open files&quot; and it doesn&apos;t access new connection.&lt;/p&gt;

&lt;p&gt;In production server (ulimit max-open-files 65000), i&apos;m using 2 thousand clients but after 2 days, many ERROR &quot;To many open files&quot; in activemq.log to be throws.&lt;br/&gt;
On jConsole, number of clientId is equals with clients, but RemoteIP contains more than 65000 IPs.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux&lt;/p&gt;</environment>
        <key id="12758816">AMQ-5468</key>
            <summary>AMQ MQTT doesn&apos;t reject remote connection after a long time </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="hongphu8790">PhuNH5-VTICT</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Dec 2014 02:58:54 +0000</created>
                <updated>Sun, 8 Feb 2015 14:28:56 +0000</updated>
                            <resolved>Mon, 5 Jan 2015 23:55:00 +0000</resolved>
                                    <version>5.9.0</version>
                    <version>5.9.1</version>
                    <version>5.10.0</version>
                                    <fixVersion>5.11.0</fixVersion>
                                    <component>Connector</component>
                    <component>MQTT</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="14233496" author="tabish121" created="Wed, 3 Dec 2014 20:42:51 +0000"  >&lt;p&gt;You can configure max connections on a transport connector to limit max open connections.&lt;/p&gt;

&lt;p&gt;            &amp;lt;transportConnector name=&quot;mqtt&quot; uri=&quot;mqtt://0.0.0.0:5673?maximumConnections=1000/&amp;gt;&lt;/p&gt;</comment>
                            <comment id="14233497" author="tabish121" created="Wed, 3 Dec 2014 20:43:26 +0000"  >&lt;p&gt;Configuration can fix this.  For questions on configuration please post on the users list.&lt;/p&gt;</comment>
                            <comment id="14236684" author="hongphu8790" created="Sat, 6 Dec 2014 08:21:12 +0000"  >&lt;p&gt;Hi @Timothy Bish, thanks for your quick reply,&lt;/p&gt;

&lt;p&gt;I have been configured max connections on a transport connector and real number of clients  (wireless devices) is 2000, but connections count when invoke operator in JMX and losf (command linux) more than 65000 TCP opened.&lt;/p&gt;

&lt;p&gt;The fact that, at a time only one a socket is opened. But connection not release when client disconnect not properly, client MQTT is removed on broker, but TCP socket don&apos;t. &lt;br/&gt;
You can use telnet client to double check:&lt;br/&gt;
Example: Please try three simple steps:&lt;br/&gt;
1/ telnet &amp;lt;broker ip&amp;gt;:port&lt;br/&gt;
2/ view on Jconsole for JMX connector: image bellow&lt;br/&gt;
Socket tcp appear in folder remoteAddress&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;http://s3.postimg.org/xbplh535f/amq.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;3/ Close telnet client, waiting a long time (could be 1 hour, 1 day,...), socket tcp not release, so a humman could be attack by open many sockets &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;In real-production, my clients could be disconnect not properly and many tcp not release and cause max-openfiles error.&lt;/p&gt;

&lt;p&gt;Sorry my English!&lt;/p&gt;</comment>
                            <comment id="14238620" author="tabish121" created="Mon, 8 Dec 2014 23:01:12 +0000"  >&lt;p&gt;You can add the keepAlive option to your transport connector and configure the OS to check on a more regular interval than the default two hour value.  When you close the telnet session you leave a half open socket and the broker needs the TCP stack to signal that it has gone so keepAlive would be a good solution.  &lt;/p&gt;</comment>
                            <comment id="14265233" author="tabish121" created="Mon, 5 Jan 2015 22:26:48 +0000"  >&lt;p&gt;Given that many MQTT clients will run on potentially unreliable connections it&apos;s probably not a bad idea to add in connection negotiation timeout detection simillar to that of the OpenWire transport.  Unlike STOMP MQTT is binary and would not be usable in telnet which is why the STOMP transport doesn&apos;t implement this.  &lt;/p&gt;</comment>
                            <comment id="14265368" author="tabish121" created="Mon, 5 Jan 2015 23:55:00 +0000"  >&lt;p&gt;Fixed on trunk, you can use the &apos;transport.connectAttemptTimeout&apos; option to configure how long before the opened connection is kept around without receiving a CONNECT frame from the client.  Default value is set to 30 seconds.&lt;/p&gt;</comment>
                            <comment id="14311335" author="hongphu8790" created="Sun, 8 Feb 2015 14:28:56 +0000"  >&lt;p&gt;Thanks Timothy Bish, &lt;/p&gt;

&lt;p&gt;Great &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I have problem with amq version 5.9.1. Since amq version 5.11 it OK, after 60000 ms, zoombie of socket session (telnet etc..) auto destroy properly &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;But i have another problem with version 5.10 and above. Comsumer JMS (Resource adapter + Glassfish) working not properly, i created a problem here: &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5570&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5570&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Many thanks Timothy!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22y9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>