<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:41:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6809] activemq-client returns unexpected length code on first read from stream containing empty byte array</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6809</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Consider this code&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;	&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void testEmptyBufferInput() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; JMSException {
		&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] readList = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[BYTE_LIST.length - 1];
		&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] emptyList = {};
		LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Streaming BYTE_LIST message testing EMPTY buffer input&quot;&lt;/span&gt;);
		stream.writeBytes(emptyList);
		stream.reset();
		LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Reading BYTE_LIST message testing EMPTY buffer input&quot;&lt;/span&gt;);
		&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; IS_EMPTY = 0;
		assertThat(stream.readBytes(readList)).isEqualTo(IS_EMPTY);
	}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The code above works with qpid-jms, but fails with activemq-client on the &lt;tt&gt;assertThat&lt;/tt&gt; with error message &lt;tt&gt;java.lang.AssertionError: Not true that &amp;lt;-1&amp;gt; is equal to &amp;lt;0&amp;gt;&lt;/tt&gt;. Judging by documentation &lt;a href=&quot;http://docs.oracle.com/javaee/6/api/javax/jms/StreamMessage.html#readBytes(byte[&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://docs.oracle.com/javaee/6/api/javax/jms/StreamMessage.html#readBytes(byte[&lt;/a&gt;]), I think that qpid-jms behavior is correct and what activemq-client does is a bug.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13102496">AMQ-6809</key>
            <summary>activemq-client returns unexpected length code on first read from stream containing empty byte array</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="jdanek">Jiri Dan&#283;k</reporter>
                        <labels>
                    </labels>
                <created>Fri, 15 Sep 2017 08:06:03 +0000</created>
                <updated>Wed, 20 Sep 2017 19:51:24 +0000</updated>
                            <resolved>Wed, 20 Sep 2017 19:51:24 +0000</resolved>
                                    <version>5.14.5</version>
                                    <fixVersion>5.15.1</fixVersion>
                    <fixVersion>5.16.0</fixVersion>
                                    <component>JMS client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16167980" author="tabish121" created="Fri, 15 Sep 2017 15:04:32 +0000"  >&lt;p&gt;Could you provide a more complete unit test, there&apos;s a lot of things not defined or a bit unclear here.  The name &quot;stream&quot; implies something other than a BytesMessage so it would be good to have a complete test.  &lt;/p&gt;</comment>
                            <comment id="16168015" author="jdanek" created="Fri, 15 Sep 2017 15:22:25 +0000"  >&lt;p&gt;Sorry, that was not very useful code to provide. Here it is in full.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.activemq.ActiveMQConnectionFactory;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.Test;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; javax.jms.*;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; com.google.common.truth.Truth.assertThat;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;EmptyBufferInputTest {
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testEmptyBufferInput() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; JMSException {
        ConnectionFactory connectionFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ActiveMQConnectionFactory(&lt;span class=&quot;code-quote&quot;&gt;&quot;tcp:&lt;span class=&quot;code-comment&quot;&gt;//127.0.0.1:61616&quot;&lt;/span&gt;);
&lt;/span&gt;        Connection connection = connectionFactory.createConnection();
        Session session = connection.createSession(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, Session.AUTO_ACKNOWLEDGE);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] BYTE_LIST = {1, 2, 4};
        StreamMessage stream = session.createStreamMessage();
        stream.clearBody();
        &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] readList = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[BYTE_LIST.length - 1];
        &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] emptyList = {};
        stream.writeBytes(emptyList);
        stream.reset();
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; IS_EMPTY = 0;
        assertThat(stream.readBytes(readList)).isEqualTo(IS_EMPTY);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.AssertionError: Not true that &amp;lt;-1&amp;gt; is equal to &amp;lt;0&amp;gt;

	at com.redhat.mqe.jms.main.EmptyBufferInputTest.testEmptyBufferInput(EmptyBufferInputTest.java:24)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:498)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:50)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:47)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:325)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:78)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:57)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:290)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:71)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:288)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:58)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:268)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:363)
	at org.junit.runner.JUnitCore.run(JUnitCore.java:137)
	at com.intellij.junit4.JUnit4IdeaTestRunner.startRunnerWithArgs(JUnit4IdeaTestRunner.java:68)
	at com.intellij.rt.execution.junit.IdeaTestRunner$Repeater.startRunnerWithArgs(IdeaTestRunner.java:47)
	at com.intellij.rt.execution.junit.JUnitStarter.prepareStreamsAndStart(JUnitStarter.java:242)
	at com.intellij.rt.execution.junit.JUnitStarter.main(JUnitStarter.java:70)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16168018" author="jdanek" created="Fri, 15 Sep 2017 15:24:45 +0000"  >&lt;p&gt;Now, let me check what is valid for StreamMessage and why I linked BytesMessage.&lt;/p&gt;

&lt;p&gt;edit: done checking, I think the Jira still stands. StreamMessage and BytesMessage should behave the same in this aspect.&lt;/p&gt;</comment>
                            <comment id="16168021" author="tabish121" created="Fri, 15 Sep 2017 15:26:55 +0000"  >&lt;p&gt;Ok, that helps, I am trying to figure out which we are talking about as that has implications on what the expected behavior is &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="16173744" author="jira-bot" created="Wed, 20 Sep 2017 19:50:17 +0000"  >&lt;p&gt;Commit 61d3231d3647fc136b12fd88a9165b783e36585b in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=61d3231&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=61d3231&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6809&quot; title=&quot;activemq-client returns unexpected length code on first read from stream containing empty byte array&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6809&quot;&gt;&lt;del&gt;AMQ-6809&lt;/del&gt;&lt;/a&gt; Fix issue where stream message getBytes returned wrong value&lt;/p&gt;

&lt;p&gt;StreamMessage implementation should return zero when the full value of a&lt;br/&gt;
written byte array has been consumed before then returning -1 on the&lt;br/&gt;
next read.  Ands fix and additional testing of ActiveMQStreamMessage&lt;/p&gt;</comment>
                            <comment id="16173746" author="jira-bot" created="Wed, 20 Sep 2017 19:51:03 +0000"  >&lt;p&gt;Commit 592b31343e62d909be52be79845a55833813c2ce in activemq&apos;s branch refs/heads/activemq-5.15.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=592b313&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=592b313&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6809&quot; title=&quot;activemq-client returns unexpected length code on first read from stream containing empty byte array&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6809&quot;&gt;&lt;del&gt;AMQ-6809&lt;/del&gt;&lt;/a&gt; Fix issue where stream message getBytes returned wrong value&lt;/p&gt;

&lt;p&gt;StreamMessage implementation should return zero when the full value of a&lt;br/&gt;
written byte array has been consumed before then returning -1 on the&lt;br/&gt;
next read.  Ands fix and additional testing of ActiveMQStreamMessage&lt;br/&gt;
(cherry picked from commit 61d3231d3647fc136b12fd88a9165b783e36585b)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13103574">QPIDJMS-325</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 8 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3k3yn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>