<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:39:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2087] Redelivery after rollback does not seem to work well </title>
                <link>https://issues.apache.org/jira/browse/AMQ-2087</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description></description>
                <environment></environment>
        <key id="12482763">AMQ-2087</key>
            <summary>Redelivery after rollback does not seem to work well </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                            <parent id="12482772">AMQ-1730</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gnodet">Guillaume Nodet</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Jan 2009 13:00:36 +0000</created>
                <updated>Tue, 21 Apr 2015 15:06:13 +0000</updated>
                            <resolved>Fri, 30 Jan 2009 09:36:18 +0000</resolved>
                                    <version>5.2.0</version>
                                    <fixVersion>5.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="12940688" author="gnt" created="Wed, 28 Jan 2009 13:01:26 +0000"  >&lt;p&gt;Test case reproducing the problem&lt;/p&gt;</comment>
                            <comment id="12940698" author="gtully" created="Wed, 28 Jan 2009 18:37:04 +0000"  >&lt;p&gt;This is a case of amq treating delivery as delivery to the consumer session rather than to the actual consumer implementation. In the test case, all of the 10 messages get redelivered to each consumer and they very quickly reach the default max redelivery count of 6 and get sent to the DLQ!&lt;/p&gt;

&lt;p&gt;one solution is to configure the redelivery policy:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;ConnectionFactory connectionFactory =
     &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ActiveMQConnectionFactory(&lt;span class=&quot;code-quote&quot;&gt;&quot;vm:&lt;span class=&quot;code-comment&quot;&gt;//localhost?jms.redeliveryPolicy.maximumRedeliveries=100&quot;&lt;/span&gt;);
&lt;/span&gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;An alternative is to use prefetch=0 so that each consumer will only get what it can use.&lt;/p&gt;

&lt;p&gt;There are a bunch of related open issues on this behavior, with the wire format change in 6.0 it will be possible to address this. A subscription remove command needs to indicate to the broker the last delivered ack that it has produced. An alternative is that the subscription trys to keep track of this information (which may be simpler).&lt;/p&gt;

&lt;p&gt;Is it ok to close this as there are so many open related issues: see: &lt;a href=&quot;https://issues.apache.org/activemq/secure/IssueNavigator.jspa?reset=true&amp;amp;&amp;amp;query=redelivery&amp;amp;summary=true&amp;amp;description=true&amp;amp;body=true&amp;amp;type=1&amp;amp;pid=10520&amp;amp;status=1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://issues.apache.org/activemq/secure/IssueNavigator.jspa?reset=true&amp;amp;&amp;amp;query=redelivery&amp;amp;summary=true&amp;amp;description=true&amp;amp;body=true&amp;amp;type=1&amp;amp;pid=10520&amp;amp;status=1&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="12940684" author="gtully" created="Wed, 28 Jan 2009 18:38:05 +0000"  >&lt;p&gt;ps: I committed your test with a few variants. thanks,&lt;/p&gt;</comment>
                            <comment id="12940708" author="gtully" created="Thu, 29 Jan 2009 16:41:37 +0000"  >&lt;p&gt;going to bite the bullit on this and augment the close command (RemoveInfo) with a deliveredSequenceId so that the broker can determine which of the prefetched messages were actually delivered to the end consumer.&lt;br/&gt;
This will require some api changes in the destination which will break DestinationFilters but something has got to give. &lt;/p&gt;</comment>
                            <comment id="12940725" author="gtully" created="Fri, 30 Jan 2009 09:36:18 +0000"  >&lt;p&gt;resolved in r739008&lt;br/&gt;
new long attribute to RemoveInfo where the last delivered broker sequence id is passed back to the broker, prefetched messages with ids greater than this value now don&apos;t get their redelivery count incremented, requires wireformat version increment to 5 and Destination api change. Any existing DestinationFilters will need to be modified. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12482795">AMQ-1601</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12822692">AMQ-5735</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12482782">AMQ-1952</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12482790">AMQ-1593</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12461207" name="AMQ-2087.test.diff" size="3104" author="gnodet" created="Wed, 28 Jan 2009 13:01:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75080</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 43 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14c33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233421</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>