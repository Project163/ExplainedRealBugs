<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:59:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4212] Broker may be unable to recover durable topic subscription from the kahadb journal</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4212</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;KahaDB is supposed to recover its index from the journal &lt;b&gt;completely&lt;/b&gt;. &lt;br/&gt;
Such recovery can be enforced by stopping the broker, deleting the db.data index file and restarting the broker. &lt;/p&gt;

&lt;p&gt;The recovery process may however not be able to recover inactive durable topic subscriptions. &lt;br/&gt;
This is because the kahadb cleanup task will not consider any active subscription entries in the journal files when marking journal files for deletion. &lt;/p&gt;

&lt;p&gt;E.g. If a durable sub info was written to e.g. the journal file db-1.log but kahadb has already rolled over to writing to db-2.log, the cleanup task may delete db1.log (in case all msgs in db1.log got acked). The durable sub however is still alive. &lt;br/&gt;
When stopping the broker this durable sub info is still present in the index file and will be restored at broker restart.&lt;br/&gt;
If however the index file gets deleted in order to enforce a recovery of the index from the journal, then the broker has lost the information about this durable sub.&lt;br/&gt;
The broker is therefore not able to recover its state fully from the journal files.&lt;/p&gt;

&lt;p&gt;If the durable subscriber remains inactive (i.e. does not reconnect to broker immediately after broker restart), it may miss messages as the broker has no knowledge of this durable sub. &lt;/p&gt;



</description>
                <environment>&lt;p&gt;kahadb and durable topic subscribers&lt;/p&gt;</environment>
        <key id="12622917">AMQ-4212</key>
            <summary>Broker may be unable to recover durable topic subscription from the kahadb journal</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="tmielke">Torsten Mielke</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Dec 2012 16:03:02 +0000</created>
                <updated>Mon, 18 Jan 2016 22:29:28 +0000</updated>
                            <resolved>Mon, 15 Apr 2013 18:17:54 +0000</resolved>
                                    <version>5.7.0</version>
                                    <fixVersion>5.9.0</fixVersion>
                                    <component>Message Store</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13552819" author="tabish121" created="Mon, 14 Jan 2013 15:59:52 +0000"  >&lt;p&gt;@Torsten do you have any tests for this issue we can use to evaluate?&lt;/p&gt;</comment>
                            <comment id="13556387" author="tmielke" created="Thu, 17 Jan 2013 17:23:19 +0000"  >&lt;p&gt;@Tim, don&apos;t have a unit test yet but presumably can create one. It will have to wait until February though as I am currently on vacation.&lt;/p&gt;</comment>
                            <comment id="13556733" author="tabish121" created="Thu, 17 Jan 2013 23:24:17 +0000"  >&lt;p&gt;Ok, created a test case that reproduces the issue. &lt;/p&gt;</comment>
                            <comment id="13557375" author="tabish121" created="Fri, 18 Jan 2013 17:32:10 +0000"  >&lt;p&gt;Fixing this is a bit tricky and would involve tracking the location of the subscription commands in the log files for the StoredDestination and the durable subs associated with each.  The downside here is that you can start retaining log files for only that one subscription command which isn&apos;t really ideal.  &lt;/p&gt;

&lt;p&gt;Fixing this might lead down the path of needing periodic compaction or a means at least of triggering one otherwise its quite hard to control how much wasted spaced you&apos;d have for the leftovers. &lt;/p&gt;</comment>
                            <comment id="13579293" author="gtully" created="Fri, 15 Feb 2013 16:33:52 +0000"  >&lt;p&gt;the workaround is to archive data files when they are gc&apos;ed by the persistence adapter. Then revert to the archived data before rebuilding the index.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;archiveDataLogs=&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;  attribute of kahadb&lt;/p&gt;</comment>
                            <comment id="13628113" author="tabish121" created="Wed, 10 Apr 2013 18:55:50 +0000"  >&lt;p&gt;updated test case&lt;/p&gt;</comment>
                            <comment id="13628444" author="tabish121" created="Wed, 10 Apr 2013 23:37:59 +0000"  >&lt;p&gt;Adds additional test to show that when fixed the recovered messages from the journal can be replayed because acks on GC&apos;d files can get lost. &lt;/p&gt;</comment>
                            <comment id="13630683" author="tabish121" created="Fri, 12 Apr 2013 22:08:05 +0000"  >&lt;p&gt;Current patch for this issue and &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2832&quot; title=&quot;Possible replay of old messages post index recovery from journal - data files containing acks reclaimed/cleaned up in error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-2832&quot;&gt;&lt;del&gt;AMQ-2832&lt;/del&gt;&lt;/a&gt;.  Adding it now so it doesn&apos;t get lost, will get back to testing next week.&lt;/p&gt;</comment>
                            <comment id="13631968" author="tabish121" created="Mon, 15 Apr 2013 18:17:55 +0000"  >&lt;p&gt;fix and tests added to trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12932249">AMQ-6131</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12482705">AMQ-2832</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12578522" name="AMQ4212Patch.txt" size="59355" author="tabish" created="Fri, 12 Apr 2013 22:08:05 +0000"/>
                            <attachment id="12578110" name="AMQ4212Test.java" size="13548" author="tabish" created="Wed, 10 Apr 2013 23:37:59 +0000"/>
                            <attachment id="12578060" name="AMQ4212Test.java" size="8400" author="tabish" created="Wed, 10 Apr 2013 18:55:50 +0000"/>
                            <attachment id="12565397" name="AMQ4212Test.java" size="8101" author="tabish" created="Thu, 17 Jan 2013 23:44:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>296495</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i149rr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233046</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>