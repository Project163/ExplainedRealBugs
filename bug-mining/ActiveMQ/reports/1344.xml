<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:52:06 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2526] Questionable processing of interruptions in TcpTransport::doStop</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2526</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Imagine you are processing a few jobs by a thread pool. A timeout is set for the whole batch. A job should send a JMS message. If the timeout expires before all the jobs are completed the pool will interrupt still running jobs. &lt;/p&gt;

&lt;p&gt;Most of the time the interruption will be caught and processed deep inside of ActiveMQ TCP transport classes. While I&apos;m not entirely convinced it&apos;s a good idea to shut down and reopen the connection to the ActiveMQ server if a client thread is merely interrupted what really seems ugly is:&lt;/p&gt;

&lt;p&gt;15:12:53,745 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.transport.tcp.TcpTransport&amp;#93;&lt;/span&gt; Could not stop service: tcp:///x.x.x.x:61616. Reason: java.lang.InterruptedException&lt;br/&gt;
java.lang.InterruptedException&lt;br/&gt;
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.tryAcquireSharedNanos(AbstractQueuedSynchronizer.java:1200)&lt;br/&gt;
	at java.util.concurrent.CountDownLatch.await(CountDownLatch.java:245)&lt;br/&gt;
	at org.apache.activemq.transport.tcp.TcpTransport.doStop(TcpTransport.java:482)&lt;br/&gt;
	at org.apache.activemq.util.ServiceSupport.stop(ServiceSupport.java:69)&lt;br/&gt;
	at org.apache.activemq.transport.tcp.TcpTransport.stop(TcpTransport.java:499)&lt;br/&gt;
	at org.apache.activemq.transport.InactivityMonitor.stop(InactivityMonitor.java:113)&lt;br/&gt;
	at org.apache.activemq.transport.TransportFilter.stop(TransportFilter.java:64)&lt;br/&gt;
	at org.apache.activemq.transport.WireFormatNegotiator.stop(WireFormatNegotiator.java:87)&lt;br/&gt;
	at org.apache.activemq.util.ServiceSupport.dispose(ServiceSupport.java:43)&lt;br/&gt;
	at org.apache.activemq.transport.failover.FailoverTransport.handleTransportFailure(FailoverTransport.java:201)&lt;br/&gt;
	at org.apache.activemq.transport.failover.FailoverTransport.oneway(FailoverTransport.java:471)&lt;br/&gt;
	at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)&lt;br/&gt;
	at org.apache.activemq.transport.ResponseCorrelator.oneway(ResponseCorrelator.java:60)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnection.doAsyncSendPacket(ActiveMQConnection.java:1214)&lt;br/&gt;
	at org.apache.activemq.ActiveMQConnection.asyncSendPacket(ActiveMQConnection.java:1208)&lt;br/&gt;
	at org.apache.activemq.ActiveMQSession.send(ActiveMQSession.java:1643)&lt;br/&gt;
	at org.apache.activemq.ActiveMQMessageProducer.send(ActiveMQMessageProducer.java:227)&lt;br/&gt;
	at org.apache.activemq.ActiveMQMessageProducerSupport.send(ActiveMQMessageProducerSupport.java:241)&lt;/p&gt;

&lt;p&gt;and the reason for it is that the await call on the CountDownLatch in TcpTransport::doStop will throws an InterruptedException if the calling thread is already interrupted. No attempt is made (in both 5.2 or 5.3) to gracefully process InterruptedException, the exception itself is logged as ERROR with a rather menacing message and the log file gets full of meaningless stack traces although no real harm was done.&lt;/p&gt;

&lt;p&gt;Calling latch.await(1,TimeUnit.SECONDS) in a try block seems like a no-brainer but there could be even smarted approaches to processing InterruptedExceptions differently than, say, IOEs and other genuine problems. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12483785">AMQ-2526</key>
            <summary>Questionable processing of interruptions in TcpTransport::doStop</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ndolgov">Nikita Dolgov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Dec 2009 02:37:25 +0000</created>
                <updated>Tue, 25 Oct 2011 21:22:06 +0000</updated>
                            <resolved>Tue, 25 Oct 2011 21:22:06 +0000</resolved>
                                    <version>5.2.0</version>
                    <version>5.3.0</version>
                                    <fixVersion>5.6.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                <comments>
                            <comment id="13135441" author="tabish121" created="Tue, 25 Oct 2011 21:22:06 +0000"  >&lt;p&gt;Fix applied in trunk, handle the interrupted exception and reset the thread&apos;s interrupted state.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461337" name="Test.java" size="3651" author="ndolgov" created="Wed, 9 Dec 2009 02:38:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74907</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ah0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59030</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>