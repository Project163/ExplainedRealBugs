<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:49:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2985] Missing messages in durable subscription with selector and KahaDB</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2985</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;With a selector and reconnecting durable sub, some messages appear missing as if they were acked in error.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12483454">AMQ-2985</key>
            <summary>Missing messages in durable subscription with selector and KahaDB</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Oct 2010 09:22:18 +0000</created>
                <updated>Tue, 23 Nov 2010 19:22:10 +0000</updated>
                            <resolved>Tue, 23 Nov 2010 19:22:10 +0000</resolved>
                                    <version>5.4.1</version>
                                    <fixVersion>5.4.2</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12943058" author="gtully" created="Mon, 18 Oct 2010 09:29:25 +0000"  >&lt;p&gt;resolved in r1023704 &lt;/p&gt;</comment>
                            <comment id="12943096" author="gtully" created="Tue, 19 Oct 2010 12:23:22 +0000"  >&lt;p&gt;TODO: A jdbc variant of the test would be a nice addition.&lt;/p&gt;</comment>
                            <comment id="12943100" author="gtully" created="Thu, 21 Oct 2010 11:01:56 +0000"  >&lt;p&gt;jdbc variant of test complete. (showed up issue with cleanup task not respecting priority) resolved in r1025939&lt;/p&gt;</comment>
                            <comment id="12943192" author="gtully" created="Wed, 10 Nov 2010 13:43:33 +0000"  >&lt;p&gt;found another variant of the test that fails&lt;/p&gt;</comment>
                            <comment id="12943199" author="gtully" created="Wed, 10 Nov 2010 16:46:19 +0000"  >&lt;p&gt;Issue sorted in r1033581 new test now enabled. detail in svn record&lt;/p&gt;</comment>
                            <comment id="12943322" author="jijwang" created="Fri, 12 Nov 2010 19:17:59 +0000"  >&lt;p&gt;I just tried on Nov 12th SNAPSHOT build. It now will receive the same message more than once. For example, I have some durable message sent out every 20 minutes. A client may receive accumulated durable message 3-7 when it first reconnects. Then the client disconnected. After more than 20 minutes, it reconnected second time and received message 8. It then disconnected again. After another 20 more minutes, it reconnected the third time, but this time, it received message 3-9. So message 3-8 were delivered with duplicate.&lt;/p&gt;

&lt;p&gt;I have the following configuration for AMQ broker:&lt;br/&gt;
&amp;lt;destinationPolicy&amp;gt;&lt;br/&gt;
            &amp;lt;policyMap&amp;gt;&lt;br/&gt;
              &amp;lt;policyEntries&amp;gt;&lt;br/&gt;
                &amp;lt;policyEntry topic=&quot;&amp;gt;&quot; producerFlowControl=&quot;false&quot; memoryLimit=&quot;1mb&quot;&amp;gt;&lt;br/&gt;
                  &amp;lt;pendingSubscriberPolicy&amp;gt;&lt;br/&gt;
                    &amp;lt;fileCursor /&amp;gt;&lt;br/&gt;
                  &amp;lt;/pendingSubscriberPolicy&amp;gt;&lt;br/&gt;
                &amp;lt;/policyEntry&amp;gt;&lt;br/&gt;
                &amp;lt;policyEntry queue=&quot;&amp;gt;&quot; producerFlowControl=&quot;false&quot; memoryLimit=&quot;1mb&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;/policyEntry&amp;gt;&lt;br/&gt;
              &amp;lt;/policyEntries&amp;gt;&lt;br/&gt;
            &amp;lt;/policyMap&amp;gt;&lt;br/&gt;
        &amp;lt;/destinationPolicy&amp;gt; &lt;br/&gt;
 ...&lt;br/&gt;
        &amp;lt;systemUsage&amp;gt;&lt;br/&gt;
            &amp;lt;systemUsage sendFailIfNoSpaceAfterTimeout=&quot;3000&quot;&amp;gt;&lt;br/&gt;
                &amp;lt;memoryUsage&amp;gt;&lt;br/&gt;
                    &amp;lt;memoryUsage limit=&quot;20 mb&quot;/&amp;gt;&lt;br/&gt;
                &amp;lt;/memoryUsage&amp;gt;&lt;br/&gt;
            &amp;lt;/systemUsage&amp;gt;&lt;br/&gt;
        &amp;lt;/systemUsage&amp;gt;&lt;/p&gt;

</comment>
                            <comment id="12943211" author="gtully" created="Fri, 12 Nov 2010 21:07:13 +0000"  >&lt;p&gt;thanks for the feedback. Do you think you could reproduce your scenario with some variation of &lt;a href=&quot;http://svn.apache.org/viewvc/activemq/trunk/activemq-core/src/test/java/org/apache/activemq/usecases/DurableSubscriptionOfflineTest.java?view=markup&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc/activemq/trunk/activemq-core/src/test/java/org/apache/activemq/usecases/DurableSubscriptionOfflineTest.java?view=markup&lt;/a&gt; - a test case would be a great help.&lt;/p&gt;</comment>
                            <comment id="12943321" author="jijwang" created="Sat, 13 Nov 2010 02:00:08 +0000"  >&lt;p&gt;Gary:&lt;/p&gt;

&lt;p&gt;Please see some broker configuration in my previous post. In our test case, each client did a durable subscription with selector using sql like criteria, for example: (bs LIKE &apos;%!10!%&apos;) OR (bs LIKE &apos;%!20!%&apos;) .... OR (bs LIKE &apos;%!100!%&apos;) The TopicConnection is nonTransactioned and with Session.AUTO_ACKNOWLEDGE. The message is sent with a possible string property of &apos;bs&apos;. Its value could be something like &lt;span class=&quot;error&quot;&gt;Unable to render embedded object: File (20!30!40) not found.&lt;/span&gt;. The message was sent every 20 minutes. Then the client connects and reconnects from time to time.&lt;/p&gt;

</comment>
                            <comment id="12943257" author="gtully" created="Tue, 23 Nov 2010 15:25:04 +0000"  >&lt;p&gt;It is possible to receive duplicates when the messageOrdercursor reverts back to the start when there are no new messages. &lt;br/&gt;
With priority in the mix, the last ack location needs to include priority such that it can reset just the correct cursors.&lt;/p&gt;</comment>
                            <comment id="12943255" author="gtully" created="Tue, 23 Nov 2010 19:22:10 +0000"  >&lt;p&gt;r1038276 - ackLocations are created on message send, such that subs can ack at their will, due to unmatched or out of order due to priority. subscription acks hold priority along with the last ack, such that the order cursors can be correctly chosen after a restart or reset. This ensures that duplicates are not dispatched as the current position is now ack aware rather than shared across priority.&lt;br/&gt;
This brings kahaDb more in line with JDBC w.r.t priority and durable subs. Tests now work with both stores.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14737</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0b9tr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>63704</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>