<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:08:01 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5564] activemq-pool - Either adds new mbeans or add/remove pair of mbean for each producer in use</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5564</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;On the AMQ dev mailing list we have talked about a new issue.&lt;br/&gt;
&lt;a href=&quot;http://activemq.2283324.n4.nabble.com/VOTE-Apache-ActiveMQ-5-11-0-rc3-tp4690743.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.2283324.n4.nabble.com/VOTE-Apache-ActiveMQ-5-11-0-rc3-tp4690743.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I found out that using the camel-example-management, which has an embedded AMQ broker and using Camel with the VM transport to produce/consume messages, then there is mbean issues.&lt;/p&gt;

&lt;p&gt;It works fine in AMQ 5.10.0. But is wrong in AMQ 5.10.1 and 5.11.0.&lt;/p&gt;

&lt;p&gt;See the attached screenshots.&lt;/p&gt;

&lt;p&gt;Notice how the mbean tree for dynamic producers keeps growing for 5.10.1 and 5.11.0.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12772307">AMQ-5564</key>
            <summary>activemq-pool - Either adds new mbeans or add/remove pair of mbean for each producer in use</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.svg">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="davsclaus">Claus Ibsen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 4 Feb 2015 09:36:56 +0000</created>
                <updated>Mon, 16 Mar 2015 14:08:40 +0000</updated>
                            <resolved>Thu, 5 Feb 2015 22:56:16 +0000</resolved>
                                    <version>5.10.1</version>
                    <version>5.11.0</version>
                                    <fixVersion>5.10.2</fixVersion>
                    <fixVersion>5.11.1</fixVersion>
                    <fixVersion>5.12.0</fixVersion>
                                    <component>Pool</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14304833" author="davsclaus" created="Wed, 4 Feb 2015 09:37:51 +0000"  >&lt;p&gt;Running the camel-example-management with&lt;br/&gt;
mvn clean install camel:run&lt;/p&gt;

&lt;p&gt;And using different version of ActiveMQ, that is the only change.&lt;/p&gt;
</comment>
                            <comment id="14307288" author="davsclaus" created="Thu, 5 Feb 2015 14:38:04 +0000"  >&lt;p&gt;Okay after using git bitsect on the 5.10.x branch between the working 5.10.0 and not working 5.10.1 releases, I was able to narrow it down to this commit causing the breakings&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;davsclaus:~/workspace/activemq ((no branch))/$ git bisect good
ac57ce9f68e2b3c5f2d004f507383d64161de3ec is the first bad commit
commit ac57ce9f68e2b3c5f2d004f507383d64161de3ec
Author: Timothy Bish &amp;lt;tabish121@gmail.com&amp;gt;
Date:   Thu Jun 12 19:12:56 2014 -0400

    https:&lt;span class=&quot;code-comment&quot;&gt;//issues.apache.org/jira/browse/AMQ-5015
&lt;/span&gt;
    Refactor the way sessions are pooled.  We don&apos;t need to keep the
    PooledSession instances around since the state is unique to the session
    it wraps we only need to keep the Session instances in the SessionPool
    and create a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PooledSession on borrow to manage that session.  This
    allows the PooledSession to have a real closed state that protects
    against multiple close calls placing duplicate PooledSession instances
    into the SessionPool.  This also simplifies the code in the
    XaConnectionPool since it doesn&apos;t need to &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; and reset state in
    PouledSessions before placing them back as it gets a fresh wrapper each
    time with the correct state.

:040000 040000 d2fcf1c9eee5b8405cf0923e72484be53385fc78 fac1f9bec90c049bf21a9cdd986b76f010cfb90e M	activemq-jms-pool
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14307943" author="tabish121" created="Thu, 5 Feb 2015 20:38:56 +0000"  >&lt;p&gt;Previous fixes that have gone in were meant to ensure that resources linked to the pooled session and connection which should be closed or deleted such as temp destinations happened correctly at connection close even though the connection itself was kept in the pool for future use.  The issue here is that the anonymous producer that is created for a pooled session is being lost along the way and a new one gets created every time an existing session is reused in the pool.  &lt;/p&gt;</comment>
                            <comment id="14308100" author="artnaseef" created="Thu, 5 Feb 2015 22:15:51 +0000"  >&lt;p&gt;So, the anonymous producer is getting created and not removed?  Or, that was the old operation?&lt;/p&gt;

&lt;p&gt;It sounds like the right result here is the anonymous producer should get closed if it was created with session.createProducer(...)- unless there is a way to create the anonymous producer specifically as a cached producer.  The reasoning is this &amp;#8211; closing an ordinary (i.e. non-pooled) connection removes producers and consumers created for all sessions in that connection.  Some applications may expect that, so they can bypass the need to do their own cleanup.&lt;/p&gt;</comment>
                            <comment id="14308180" author="tabish121" created="Thu, 5 Feb 2015 22:56:16 +0000"  >&lt;p&gt;Fix added on trunk&lt;/p&gt;</comment>
                            <comment id="14308726" author="davsclaus" created="Fri, 6 Feb 2015 06:58:35 +0000"  >&lt;p&gt;Yay just tested with the Camel example and it now works. Thanks Tim.&lt;/p&gt;</comment>
                            <comment id="14308740" author="davsclaus" created="Fri, 6 Feb 2015 07:13:41 +0000"  >&lt;p&gt;Backported to 5.10.x branch and tested that it worked.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12771416">AMQ-5555</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12696420" name="amq-5100.png" size="378938" author="davsclaus" created="Wed, 4 Feb 2015 09:37:51 +0000"/>
                            <attachment id="12696421" name="amq-5101.png" size="216511" author="davsclaus" created="Wed, 4 Feb 2015 09:37:51 +0000"/>
                            <attachment id="12696422" name="amq-5110.png" size="264151" author="davsclaus" created="Wed, 4 Feb 2015 09:37:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            10 years, 41 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i25667:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>