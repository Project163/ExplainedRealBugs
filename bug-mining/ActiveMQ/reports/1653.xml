<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:56:34 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3851] Infinite TemqQueue advisory messages</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3851</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I&apos;m seeing a behavior that looks like a race condition of some kind. I have two brokers (MSSD5D101, MSTMIP103). MSSD5D101 has a duplex network connector connecting it to MSTMIP103. The two machines are in different US states so there is a VPN in between. I have two consumer services that reply to queued messages. One consumer (WISD5P101) connects to MSSD5D101 and the other consumer (POSD5P101) connects to MSTMIP103. I also have a web portal that sends messages out to different queues expecting a response. The web portal, and two consumers are all .NET based. &lt;/p&gt;

&lt;p&gt;What is happening is that after some number of messages, something goes crazy and floods the network of brokers with advisory messages pertaining to temp queues being added or removed. By restarting one or the other of the ActiveMQ servers, things return to normal. But, while the flood is happening, one of the machines will be at 100% CPU and become worthless. I will be attaching logs and some code that I&apos;m using to interact with ActiveMQ.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12556454">AMQ-3851</key>
            <summary>Infinite TemqQueue advisory messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dejanb">Dejan Bosanac</assignee>
                                    <reporter username="chrisdrobison">Chris Robison</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 May 2012 20:58:42 +0000</created>
                <updated>Thu, 4 Oct 2012 11:40:14 +0000</updated>
                            <resolved>Thu, 4 Oct 2012 11:40:14 +0000</resolved>
                                    <version>5.6.0</version>
                                    <fixVersion>5.8.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13279180" author="chrisdrobison" created="Fri, 18 May 2012 20:59:17 +0000"  >&lt;p&gt;Logs&lt;/p&gt;</comment>
                            <comment id="13279182" author="chrisdrobison" created="Fri, 18 May 2012 21:01:34 +0000"  >&lt;p&gt;This is the code I use to wrap the ActiveMQ library that all my other software uses.&lt;/p&gt;</comment>
                            <comment id="13279185" author="chrisdrobison" created="Fri, 18 May 2012 21:09:31 +0000"  >&lt;p&gt;Snippet of code used in the web portal to send messages and receive responses.&lt;/p&gt;</comment>
                            <comment id="13279188" author="chrisdrobison" created="Fri, 18 May 2012 21:12:10 +0000"  >&lt;p&gt;ActiveMQ configuration files&lt;/p&gt;</comment>
                            <comment id="13279195" author="chrisdrobison" created="Fri, 18 May 2012 21:14:58 +0000"  >&lt;p&gt;ActiveMQ server configuration files&lt;/p&gt;</comment>
                            <comment id="13285952" author="chrisdrobison" created="Wed, 30 May 2012 19:42:44 +0000"  >&lt;p&gt;I profiled the server instance using YourKit while the flood was taking place. I&apos;ve included the trace to hopefully help in the debugging process. I&apos;ve found that when I disable any kind of authorization that things seems to work fine. Looking at the trace, it looks like there might be a problem related to the AuthorizationBroker, but I&apos;m not sure.&lt;/p&gt;</comment>
                            <comment id="13286695" author="chrisdrobison" created="Thu, 31 May 2012 16:12:12 +0000"  >&lt;p&gt;After more testing, I think there is a race condition in DefaultAuthorizationMap. Instead of going to LDAP, I defined the authorization entries in configuration and was able to reproduce the issue.&lt;/p&gt;</comment>
                            <comment id="13286904" author="chrisdrobison" created="Thu, 31 May 2012 20:31:52 +0000"  >&lt;p&gt;I&apos;ve done further testing, I now think the problem is higher up than the DefaultAuthorizationMap in the AuthorizationBroker. I created a very simple class that implements AuthorizationMap that always returns a static set of ACLs and I was able to reproduce the flooding.&lt;/p&gt;</comment>
                            <comment id="13467734" author="dejanb" created="Tue, 2 Oct 2012 14:00:41 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;I see you&apos;re using some kind of a custom &amp;lt;solidInstanceCachedLDAPAuthorizationMap/&amp;gt; authorization plugin. Are you sure the problem isn&apos;t somewhere in there. &lt;/p&gt;

&lt;p&gt;Can you give Cached LDAP Authorization Module a try &lt;a href=&quot;http://activemq.apache.org/cached-ldap-authorization-module.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://activemq.apache.org/cached-ldap-authorization-module.html&lt;/a&gt; and see if it helps.&lt;/p&gt;

&lt;p&gt;Also, can you share more info on your further testings and how do you reproduce the problem&lt;/p&gt;</comment>
                            <comment id="13467783" author="chrisdrobison" created="Tue, 2 Oct 2012 15:18:26 +0000"  >&lt;p&gt;No, I just made some changes so that the regular cachedLDAPAuthorizationMap would work with Active Directory. Those changes have now been put into trunk so I could still go back to using the regular one and still see the problem. In a previous comment I said that I wrote an extremely simple plugin that always returned the same ACLs and was still able to reproduce the problem. To reproduce the issue, I just setup a simple request/reply system using text messages. I believe I&apos;ve attached the code I used. There was never a set number of messages I had to send before the flooding started. At first I was only able to reproduce the problem going over VPN, but eventually I was able to reproduce the problem between VMs.&lt;/p&gt;</comment>
                            <comment id="13468386" author="mbright" created="Wed, 3 Oct 2012 07:27:06 +0000"  >&lt;p&gt;Hi.&lt;/p&gt;

&lt;p&gt;I think we are seeing the same issue with fuse version 5.5.1-fuse-08-15 (was already the case for previous versions). We are running 2 brokers is a cluster with dynamic temporary queue forwarding. After some time, the 2 brokers get into some &quot;vicious circle&quot;, whereby the same temporary queues are repeatedly added then removed from each of the brokers. As Chris mentions, this seems to use up a single thread on each process, presumably the thread removing &amp;amp; creating this temporary queues. It looks like the temporary queues are simply passed back and forth between the 2 brokers, and never get removed correctly. Only a restart of the brokers fixes the problem.&lt;/p&gt;</comment>
                            <comment id="13468391" author="mbright" created="Wed, 3 Oct 2012 07:35:55 +0000"  >&lt;p&gt;Forgot to add: we are using the SimpleAuthenticationPlugin with a tempDestinationAuthorizationEntry in the AuthorizationMap.&lt;/p&gt;</comment>
                            <comment id="13468440" author="dejanb" created="Wed, 3 Oct 2012 09:32:12 +0000"  >&lt;p&gt;Thanks for confirming. I see one potential problem that can cause it. I&apos;ll try to reproduce it now.&lt;/p&gt;</comment>
                            <comment id="13469297" author="dejanb" created="Thu, 4 Oct 2012 11:40:14 +0000"  >&lt;p&gt;It should be fixed now with svn revision 1393988.&lt;/p&gt;

&lt;p&gt;I did some refactoring of AdvisoryBroker to handle addDestinationInfo case properly.&lt;/p&gt;

&lt;p&gt;Can you test the latest snapshot&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/5.8-SNAPSHOT/apache-activemq-5.8-20121004.112554-4-bin.tar.gz&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-activemq/5.8-SNAPSHOT/apache-activemq-5.8-20121004.112554-4-bin.tar.gz&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and report back if you still see the problem.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12528149" name="ActiveMqMessagingProvider.cs" size="13810" author="chrisdrobison" created="Fri, 18 May 2012 21:01:34 +0000"/>
                            <attachment id="12528150" name="ActiveMqRequestReceiver.cs" size="2029" author="chrisdrobison" created="Fri, 18 May 2012 21:01:34 +0000"/>
                            <attachment id="12528146" name="Log.zip" size="160107" author="chrisdrobison" created="Fri, 18 May 2012 20:59:17 +0000"/>
                            <attachment id="12528158" name="mssd5d101-activemq.xml" size="5745" author="chrisdrobison" created="Fri, 18 May 2012 21:14:57 +0000"/>
                            <attachment id="12528159" name="mstmip103-activemq.xml" size="5967" author="chrisdrobison" created="Fri, 18 May 2012 21:14:57 +0000"/>
                            <attachment id="12530260" name="run-2012-05-30.snapshot" size="5134469" author="chrisdrobison" created="Wed, 30 May 2012 19:42:43 +0000"/>
                            <attachment id="12528153" name="web-portal-code-snippet.cs" size="2434" author="chrisdrobison" created="Fri, 18 May 2012 21:09:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>240022</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 7 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00vin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3038</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>