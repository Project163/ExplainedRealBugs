<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:37:14 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-1779] RA does not reconnect correctly to a failed broker</title>
                <link>https://issues.apache.org/jira/browse/AMQ-1779</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;The Resource Adapter does not cleanly reconnect to a failed broker:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;it uses stale sessions to deliver messages to an Endpoint resulting in messages not being delivered at all anymore after the connection has been re-established&lt;/li&gt;
	&lt;li&gt;the code for connecting/reconnecting to the broker is not synchronized properly leading to race conditions/deadlocks in some situations&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Kai&lt;/p&gt;</description>
                <environment></environment>
        <key id="12482440">AMQ-1779</key>
            <summary>RA does not reconnect correctly to a failed broker</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="rajdavies">Robert Davies</assignee>
                                    <reporter username="hudalla">Kai Hudalla</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jun 2008 13:59:46 +0000</created>
                <updated>Fri, 6 Jun 2008 18:59:55 +0000</updated>
                            <resolved>Fri, 6 Jun 2008 18:59:55 +0000</resolved>
                                    <version>5.0.0</version>
                    <version>5.1.0</version>
                                    <fixVersion>5.2.0</fixVersion>
                                    <component>Connector</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                                                                                                            <comments>
                            <comment id="12939759" author="hudalla" created="Fri, 6 Jun 2008 14:15:33 +0000"  >&lt;p&gt;The work done by David Jencks on the 4.x branch in &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-1632&quot; title=&quot;PrefetchSubscription may not wake up if messages delivered in transaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-1632&quot;&gt;&lt;del&gt;AMQ-1632&lt;/del&gt;&lt;/a&gt; still has some issues regarding synchronization:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;When the RA tries to connect to the broker, it does so by subsequently scheduling the connectWork using the WorkManager. However, the monitor on connectWork may be lost when the connectWork is re-scheduled after an unsuccessful attempt, making it possible that the getConnection() method gets the monitor and returns null instead of the re-established connection.&lt;/li&gt;
	&lt;li&gt;The code for registering a ConnectionConsumer on the ActiveMQConnection leads to a deadlock if there are some messages left to be delivered from before the broker has failed. In that case, the ServerSessionPoolImpl.createServerSessionImpl() method will be triggered by the next message delivery. However, the createServerSessionImpl() method needs to wait for the EndpointWorker.getConnection() method to return which is also synchronized on the connectWork that is trying to register the ConnectionConsumer. The problem here is that the constructor of the ActiveMQConnectionConsumer uses syncSendPacket() instead of asyncSendPacket() in order to register the consumer with the broker. Thus the instantiation of the ActiveMQConnectionConsumer blocks until the first message has been delivered, leading to the deadlock.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Kai&lt;/p&gt;</comment>
                            <comment id="12939698" author="hudalla" created="Fri, 6 Jun 2008 14:22:13 +0000"  >&lt;p&gt;I have changed the connectWork to loop until it finally gets a connection to the broker instead of re-scheduling itself after a failed connection attempt. This way, the monitor on connectWork is kept until the connection succeeds. In order to make this work, the ActiveMQConnectionConsumer needs to use asyncSendPacket() for registering itself with the consumer to avoid a deadlock on the connectWork.&lt;/p&gt;

&lt;p&gt;The patch also includes David&apos;s fix for the prefetchSize calculation in the EndpointWorker.&lt;/p&gt;

&lt;p&gt;Kai&lt;/p&gt;</comment>
                            <comment id="12939736" author="rajdavies" created="Fri, 6 Jun 2008 18:59:55 +0000"  >&lt;p&gt;Patch applied by SVN revision 664079 and 664082&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461078" name="amq-1779.patch" size="24503" author="hudalla" created="Fri, 6 Jun 2008 14:22:13 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12482378">AMQ-1632</subtask>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>84601</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 25 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14ba7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233291</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>