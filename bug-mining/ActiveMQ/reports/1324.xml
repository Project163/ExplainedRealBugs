<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:51:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3324] ActiveMQ.Advisory.xxxxxx.TempQueue.xxx, AMQ.A.xxx.Queue.xxx and AMQ.A.xxx.Topic.xxx Topics don&apos;t get removed when the originating tempQueue, Queue or Topic is removed so is somewhat a memory leak</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3324</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Seems like support for removing some Advisories topics when their originating queue, topic, tempQueue or tempTopic is removed has not been provided.&lt;/p&gt;

&lt;p&gt;In RegionBroker.java :&lt;/p&gt;

&lt;p&gt;    public void removeAdvisoryTopics(String destinationType, ConnectionContext context, ActiveMQDestination destination, long timeout) throws Exception {&lt;br/&gt;
        if (this.brokerService.isAdvisorySupport()) {&lt;br/&gt;
            String producerAdvisoryTopic = AdvisorySupport.PRODUCER_ADVISORY_TOPIC_PREFIX + destinationType + destination.getPhysicalName();&lt;br/&gt;
            String consumerAdvisoryTopic = AdvisorySupport.CONSUMER_ADVISORY_TOPIC_PREFIX + destinationType + destination.getPhysicalName();&lt;/p&gt;

&lt;p&gt;            ActiveMQDestination dests[] = getDestinations();&lt;br/&gt;
            for (ActiveMQDestination dest: dests) {&lt;br/&gt;
                String name = dest.getPhysicalName();&lt;br/&gt;
                if ( name.equals(producerAdvisoryTopic) || name.equals(consumerAdvisoryTopic) ) {&lt;br/&gt;
                    try &lt;/p&gt;
{
                        removeDestination(context, dest, timeout);
                    }
&lt;p&gt; catch (JMSException ignore) &lt;/p&gt;
{
                        // at least ignore the Unknown Destination Type JMSException
                    }
&lt;p&gt;                }&lt;br/&gt;
            }&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;/p&gt;


&lt;p&gt;   Seem like PRODUCER_ADVISORY_TOPIC and CONSUMER_ADVISORY_TOPIC topics are the only advisories removed when originating destination is removed. Most advisories when enabled in the policy do not get removed. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12507442">AMQ-3324</key>
            <summary>ActiveMQ.Advisory.xxxxxx.TempQueue.xxx, AMQ.A.xxx.Queue.xxx and AMQ.A.xxx.Topic.xxx Topics don&apos;t get removed when the originating tempQueue, Queue or Topic is removed so is somewhat a memory leak</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="marcelcasado">Marcel Casado</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 May 2011 03:06:57 +0000</created>
                <updated>Tue, 27 Jul 2021 19:11:00 +0000</updated>
                            <resolved>Mon, 10 Oct 2011 15:31:42 +0000</resolved>
                                    <version>5.4.2</version>
                    <version>5.5.0</version>
                                                    <component>Broker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13058717" author="tabish121" created="Fri, 1 Jul 2011 19:14:45 +0000"  >&lt;p&gt;Not enough info to produce a test case.  I tried a few scenarios but couldn&apos;t create any leaks.  If you can provide a test case please reopen.&lt;/p&gt;</comment>
                            <comment id="13059152" author="marcelcasado" created="Sun, 3 Jul 2011 01:59:44 +0000"  >&lt;p&gt;Providing test case and screenshots &lt;/p&gt;</comment>
                            <comment id="13059153" author="marcelcasado" created="Sun, 3 Jul 2011 02:02:20 +0000"  >&lt;p&gt;See test testAdvisoryRemovedWhenTempQueueRemoved&lt;/p&gt;</comment>
                            <comment id="13059154" author="marcelcasado" created="Sun, 3 Jul 2011 02:05:31 +0000"  >&lt;p&gt;jconsole screenshoots on how to reproduce this problem. &lt;/p&gt;</comment>
                            <comment id="13059155" author="marcelcasado" created="Sun, 3 Jul 2011 02:11:17 +0000"  >&lt;p&gt;The attached classes provide the modifications to fix this issue&lt;/p&gt;</comment>
                            <comment id="13091970" author="tabish121" created="Fri, 26 Aug 2011 19:28:32 +0000"  >&lt;p&gt;Is it possible for you to include your fixes as a patch file, and ensure that you check the grant license to apache when you upload it, your current submissions don&apos;t have the lic grant.&lt;/p&gt;</comment>
                            <comment id="13123127" author="artnaseef" created="Fri, 7 Oct 2011 19:56:54 +0000"  >&lt;p&gt;I&apos;m going to take a look at this one as we&apos;ve been hit with a temporary destination leak that gets ugly when we setup a test environment to test failover periodically (spoke node failing between two nodes every 15 minutes).&lt;/p&gt;

&lt;p&gt;If all goes well, I&apos;ll post the patch.&lt;/p&gt;</comment>
                            <comment id="13124015" author="gtully" created="Mon, 10 Oct 2011 12:11:08 +0000"  >&lt;p&gt;does gc of inactive destinations, &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2821&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-2821&lt;/a&gt; not work in this case?&lt;/p&gt;</comment>
                            <comment id="13124172" author="tabish121" created="Mon, 10 Oct 2011 15:31:42 +0000"  >&lt;p&gt;Added a test to show that the Purge inactive destinations feature handles this situation.  &lt;/p&gt;</comment>
                            <comment id="13124345" author="artnaseef" created="Mon, 10 Oct 2011 18:05:58 +0000"  >&lt;p&gt;We have &lt;tt&gt;gcInactiveDestinations=true&lt;/tt&gt; and still see this problem.&lt;/p&gt;

&lt;p&gt;The entire sequence of events is unclear, but it appears to be related to the network of brokers awhen producers and consumers are on different brokers.  It may also be related to failover; when we see a broker failover (even one not involved in the flow of the destinations), traffic on &lt;tt&gt;ActiveMQ.Advisory.TempTopic&lt;/tt&gt; jumps.&lt;/p&gt;

&lt;p&gt;Note that messages on the &lt;tt&gt;ActiveMQ.Advisory.TempTopic&lt;/tt&gt; appear to cause the destinations to be re-created as they are unmarshalled by the protocol.  That seems problematic to me - especially for temporary destinations which need to get attached to a connection.&lt;/p&gt;

&lt;p&gt;I&apos;ll try to produce a test case.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Dreaming:&lt;/b&gt; I really wish I knew a way to see the sequence of all of the broker internal activity for a specific destination across the network of brokers.  Or, better yet, a way to capture that information and review it later since the specific destination involved may not be known until after the fact.&lt;/p&gt;</comment>
                            <comment id="13124413" author="gtully" created="Mon, 10 Oct 2011 19:33:05 +0000"  >&lt;p&gt;Arthur, just a thought, if you don&apos;t want temp destinations to propagate across a network, use &amp;lt;networkConnector bridgeTempDestinations=&quot;false&quot; /&amp;gt;&lt;/p&gt;

&lt;p&gt;A test case is the answer alright &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13124417" author="artnaseef" created="Mon, 10 Oct 2011 19:38:30 +0000"  >&lt;p&gt;Thanks Gary - we do need them to propagate across the network.&lt;/p&gt;</comment>
                            <comment id="17388257" author="in-fke" created="Tue, 27 Jul 2021 19:11:00 +0000"  >&lt;p&gt;Looks we are also in trouble if we use JMX BrokerViewMBean.removeQueue(String) and then the Advisory Destinations leaves us with thousands of Threads all of the form:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;Topic  ActiveMQ.Advisory.Consumer.Queue.03a3514d-c225-49b3-88e3-c39bca91b6cd.input&quot; #342596 daemon prio=5 os_prio=0 tid=0x0000000800f33000 nid=0x2e384 in Object.wait() [0x00000008b646f000]
   java.lang.Thread.State: WAITING (on object monitor)
	at java.lang.Object.wait(Native Method)
	at java.lang.Object.wait(Unknown Source)
	at org.apache.activemq.thread.DedicatedTaskRunner.runTask(DedicatedTaskRunner.java:119)
	- locked &amp;lt;0x00000000d8208348&amp;gt; (a java.lang.Object)
	at org.apache.activemq.thread.DedicatedTaskRunner$1.run(DedicatedTaskRunner.java:42)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;eventually draining the system handles (Windows).&lt;/p&gt;

&lt;p&gt;I guess in this case we have two workarounds?&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;explicitly removing the Advisory Queues along the actual queue?&lt;/li&gt;
	&lt;li&gt;disabling advisory queues?&lt;/li&gt;
&lt;/ol&gt;

</comment>
                    </comments>
                    <attachments>
                            <attachment id="12479427" name="AdvisorySupport.java" size="30410" author="marcelcasado" created="Tue, 17 May 2011 03:09:12 +0000"/>
                            <attachment id="12485075" name="AdvisoryTempDestinationTests.java" size="14811" author="marcelcasado" created="Sun, 3 Jul 2011 02:02:20 +0000"/>
                            <attachment id="12479428" name="RegionBroker.java" size="38869" author="marcelcasado" created="Tue, 17 May 2011 03:09:12 +0000"/>
                            <attachment id="12485076" name="amq_no_queue_yet.tiff" size="222882" author="marcelcasado" created="Sun, 3 Jul 2011 02:05:31 +0000"/>
                            <attachment id="12485078" name="amq_test_queue_advisories_created_after_sent_message_to_queue.tiff" size="157580" author="marcelcasado" created="Sun, 3 Jul 2011 02:05:31 +0000"/>
                            <attachment id="12485077" name="amq_test_queue_created.tiff" size="137724" author="marcelcasado" created="Sun, 3 Jul 2011 02:05:31 +0000"/>
                            <attachment id="12485079" name="amq_test_queue_removed_but_advisory_mesage_delivered_not.tiff" size="144052" author="marcelcasado" created="Sun, 3 Jul 2011 02:05:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>50502</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ebpb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>81658</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>