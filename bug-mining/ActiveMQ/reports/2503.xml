<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:09:05 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5665] memory store is broken in 5.11.0 for advisories (and probably other issues as well)</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5665</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;We&apos;re running 5.10.2 and don&apos;t encounter this issue.  We&apos;re running a non-persistent broker in production and testing so that&apos;s why we found this issue.&lt;/p&gt;

&lt;p&gt;It looks like 5.11.0 introduced this issue.&lt;/p&gt;

&lt;p&gt;Essentially Advisories fail to fire. &lt;/p&gt;

&lt;p&gt;It looks like it&#8217;s a bug with MemoryTransactionStore. Switching to persistent brokers fixes the problem.&lt;/p&gt;

&lt;p&gt;It&#8217;s because addMessage calls:&lt;/p&gt;

&lt;p&gt;        } else &lt;/p&gt;
{
            destination.addMessage(null, message);
        }

&lt;p&gt;.. with an explicit null.&lt;/p&gt;

&lt;p&gt;the message given is:&lt;/p&gt;

&lt;p&gt;2015-03-16 12:54:17,538 WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;ActiveMQ Transport: tcp:///127.0.0.1:56468@16161&amp;#93;&lt;/span&gt; org.apache.activemq.advisory.AdvisoryBroker Failed to fire delivered advisory, reason: java.lang.NullPointerException&lt;/p&gt;

&lt;p&gt;&#8230; and I saw this when I was running mvn test in the main ActiveMQ test suite (or at least pretty sure I did) so this is happening not just in my code. &lt;/p&gt;

&lt;p&gt;The full exception , which I captured by setting a break point is below. &lt;/p&gt;


&lt;p&gt;java.lang.NullPointerException&lt;br/&gt;
	at org.apache.activemq.advisory.AdvisoryBroker.fireAdvisory(AdvisoryBroker.java:626)&lt;br/&gt;
	at org.apache.activemq.advisory.AdvisoryBroker.messageDelivered(AdvisoryBroker.java:397)&lt;br/&gt;
	at org.apache.activemq.broker.BrokerFilter.messageDelivered(BrokerFilter.java:349)&lt;br/&gt;
	at org.apache.activemq.broker.BrokerFilter.messageDelivered(BrokerFilter.java:349)&lt;br/&gt;
	at org.apache.activemq.broker.MutableBrokerFilter.messageDelivered(MutableBrokerFilter.java:360)&lt;br/&gt;
	at org.apache.activemq.broker.MutableBrokerFilter.messageDelivered(MutableBrokerFilter.java:360)&lt;br/&gt;
	at org.apache.activemq.broker.region.BaseDestination.messageDelivered(BaseDestination.java:518)&lt;br/&gt;
	at org.apache.activemq.broker.region.Queue.messageSent(Queue.java:1806)&lt;br/&gt;
	at org.apache.activemq.broker.region.Queue.doPendingCursorAdditions(Queue.java:794)&lt;br/&gt;
	at org.apache.activemq.broker.region.Queue.orderedCursorAdd(Queue.java:875)&lt;br/&gt;
	at org.apache.activemq.broker.region.Queue.doMessageSend(Queue.java:854)&lt;br/&gt;
	at org.apache.activemq.broker.region.Queue.send(Queue.java:733)&lt;br/&gt;
	at org.apache.activemq.broker.region.AbstractRegion.send(AbstractRegion.java:419)&lt;br/&gt;
	at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:468)&lt;br/&gt;
	at org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:297)&lt;br/&gt;
	at org.apache.activemq.broker.BrokerFilter.send(BrokerFilter.java:152)&lt;br/&gt;
	at org.apache.activemq.broker.CompositeDestinationBroker.send(CompositeDestinationBroker.java:96)&lt;br/&gt;
	at org.apache.activemq.broker.TransactionBroker.send(TransactionBroker.java:307)&lt;br/&gt;
	at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:157)&lt;br/&gt;
	at org.apache.activemq.broker.MutableBrokerFilter.send(MutableBrokerFilter.java:157)&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection.processMessage(TransportConnection.java:541)&lt;br/&gt;
	at org.apache.activemq.command.ActiveMQMessage.visit(ActiveMQMessage.java:768)&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:334)&lt;br/&gt;
	at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:188)&lt;br/&gt;
	at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)&lt;br/&gt;
	at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)&lt;br/&gt;
	at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:270)&lt;br/&gt;
	at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)&lt;br/&gt;
	at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)&lt;br/&gt;
	at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:724)&lt;/p&gt;

&lt;p&gt;... the core issue here looks like the message doesn&apos;t have a TransactionId and MemoryTransactionStore has an addMessages which has a fall through of addMessage with a null context which then causes the NPE.&lt;/p&gt;

&lt;p&gt;Did messages have an implicit transaction Id before?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12782372">AMQ-5665</key>
            <summary>memory store is broken in 5.11.0 for advisories (and probably other issues as well)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dejanb">Dejan Bosanac</assignee>
                                    <reporter username="burtonator">Kevin Burton</reporter>
                        <labels>
                    </labels>
                <created>Mon, 16 Mar 2015 21:35:15 +0000</created>
                <updated>Tue, 26 Apr 2016 17:52:41 +0000</updated>
                            <resolved>Thu, 9 Apr 2015 11:32:45 +0000</resolved>
                                    <version>5.11.0</version>
                                    <fixVersion>5.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="14485218" author="tabish121" created="Wed, 8 Apr 2015 13:22:07 +0000"  >&lt;p&gt;Would recommend you try and create a small unit test that shows the problem, that way any fix will be maintained into the future.  &lt;/p&gt;</comment>
                            <comment id="14487176" author="dejanb" created="Thu, 9 Apr 2015 11:32:45 +0000"  >&lt;p&gt;I ran into this writing a test for advisories&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://git-wip-us.apache.org/repos/asf/activemq/commit/69767a2f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://git-wip-us.apache.org/repos/asf/activemq/commit/69767a2f&lt;/a&gt; fixes it&lt;/p&gt;

&lt;p&gt;The test for another issue I&apos;m working on will be used to verify and guard the fix&lt;/p&gt;</comment>
                            <comment id="14963496" author="wmfowlkes" created="Mon, 19 Oct 2015 15:50:47 +0000"  >&lt;p&gt;Still seeing this in release 5.12.0.   Please advise.&lt;/p&gt;</comment>
                            <comment id="15258315" author="wmfowlkes" created="Tue, 26 Apr 2016 15:50:18 +0000"  >&lt;p&gt;WARN  | Failed to fire delivered advisory, reason: java.lang.NullPointerException | org.apache.activemq.advisory.AdvisoryBroker&lt;/p&gt;

&lt;p&gt;Still seeing the above in release 5.12.0 for every message fired.  Can&apos;t see the forest for the trees in the logs.&lt;/p&gt;</comment>
                            <comment id="15258320" author="tabish121" created="Tue, 26 Apr 2016 15:53:55 +0000"  >&lt;p&gt;Try the latest release (5.13.2) and write a test case that reproduces if you see it there.  &lt;/p&gt;</comment>
                            <comment id="15258544" author="christopher.l.shannon" created="Tue, 26 Apr 2016 17:52:41 +0000"  >&lt;p&gt;If you enable debug logging you will see the full stack trace which is helpful so we know the line it is getting the NPE on.  As Tim pointed out, the best thing to do would be to write a small test case against the latest relesae that we could run to help us figure out the scenario that is triggering the NPE.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 30 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26u1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>