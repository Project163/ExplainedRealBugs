<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:59:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4468] TimeStampPlugin doesn&apos;t work with Stomp</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4468</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Stomp producers cannot set the JMSTimestamp or timestamp header. Activemq always adds a timestamp header and overrides a set value. Therefore, the expires header cannot be recalculated according to Activemq time according to the description for TimeStampPlugin. TimeStampPlugin works for JMS producers because the JMSExpiration UTC can be adjusted up/down according to the difference between JMSTimestamp and Activemq UTC.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt;ActiveMQ time is 2pm UTC&lt;br/&gt;
Stomp producer time is 1:03pm UTC.&lt;br/&gt;
Stomp expires time is 1:03pm + 15 minutes: 1:18pm UTC.&lt;/p&gt;

&lt;p&gt;ActiveMQ will throw this message away with TimeStampPlugin enabled.&lt;br/&gt;
ActiveMQ will deliver this message for a JMSProducer.&lt;/p&gt;

&lt;p&gt;Recommendation:&lt;/p&gt;

&lt;p&gt;1)&lt;/p&gt;

&lt;p&gt;ActiveMQ should allow Stomp producers to set a timestamp or JMSTimestamp header.&lt;/p&gt;

&lt;p&gt;if( Stomp Message Timestamp Header ) {&lt;/p&gt;

&lt;p&gt;use header&lt;br/&gt;
}&lt;br/&gt;
else {&lt;/p&gt;

&lt;p&gt;add timestamp header&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;2)&lt;/p&gt;

&lt;p&gt;Add the disableTimeStampsByDefault=true feature to the stomp protocol URI.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Ubuntu 12.04.1 LTS Precise, OpenJDK Runtime Environment (IcedTea7 2.3.3) (7u9-2.3.3-0ubuntu1~12.04.1)&lt;/p&gt;</environment>
        <key id="12642198">AMQ-4468</key>
            <summary>TimeStampPlugin doesn&apos;t work with Stomp</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="aletheia7">Erik</reporter>
                        <labels>
                            <label>JMSExpiration</label>
                            <label>JMSExpires</label>
                            <label>JMSTimestamp</label>
                            <label>TimeStampPlugin</label>
                            <label>activemq</label>
                            <label>disableTimeStampsByDefault</label>
                            <label>expires</label>
                            <label>stomp</label>
                            <label>timestamp</label>
                    </labels>
                <created>Fri, 12 Apr 2013 07:05:42 +0000</created>
                <updated>Tue, 28 May 2013 17:18:12 +0000</updated>
                            <resolved>Tue, 28 May 2013 17:18:12 +0000</resolved>
                                    <version>5.8.0</version>
                                                    <component>STOMP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13632217" author="tabish121" created="Mon, 15 Apr 2013 21:28:09 +0000"  >&lt;p&gt;Please try to create a unit test to demonstrate your issue.&lt;/p&gt;</comment>
                            <comment id="13632329" author="aletheia7" created="Mon, 15 Apr 2013 22:50:10 +0000"  >&lt;p&gt;My test code that verifies the problem is written in php. I am not a  java developer. I do not have the ability to create a JMS unit test. Do you want a tar file of php? It&apos;s a very simple test. Use a language binding other than java JMS and send a message.  Perhaps NMS? The &quot;timestamp&quot; header is added. If a timestamp existed, it is still changed. This is the essence of the bug.&lt;/p&gt;</comment>
                            <comment id="13648522" author="tabish121" created="Fri, 3 May 2013 16:01:14 +0000"  >&lt;p&gt;Yea, not sure why we forcedly overwrite the user defined timestamp when its present, will look into this.&lt;/p&gt;</comment>
                            <comment id="13648798" author="tabish121" created="Fri, 3 May 2013 20:58:53 +0000"  >&lt;p&gt;Fixed on trunk&lt;/p&gt;</comment>
                            <comment id="13651598" author="aletheia7" created="Wed, 8 May 2013 03:55:40 +0000"  >&lt;p&gt;Issue not resolved. The code change fixed the issue where a stomp &quot;timestamp&quot; header was overwritten. However, the TimeStampPlugin does not work as expected. I sent a message to a queue to test the plugin. The message was not delivered to the queue; i.e. probably delivered to the DLQ. Details:&lt;/p&gt;

&lt;p&gt;Expected Result: The message should be sitting in the queue. There were no consumers. The TimeStampPlugin was enabled. Although the message timestamp and expire UTCs where 1 day in the past, the plugin should have used the difference between the expires and timestamp UTCs to rewrite a new expires and timestamp using the Activemq server local time. The rewrite did not occur.&lt;/p&gt;

&lt;p&gt;Activemq Server Time: 2013-05-07 20:27:51,995&lt;br/&gt;
Message timestamp header: 2013-05-06T20:27:51-07:00 (1 day earlier than Activemq time)&lt;br/&gt;
Message expire header: 2013-05-06T22:27:51-07:00 (2 hours ahead of timestamp, still less than Activemq UTC time)&lt;br/&gt;
Using activemq binary snapshot: apache-activemq-5.9-20130507.083009-49-bin.tar.gz&lt;/p&gt;

&lt;p&gt;Here is the stomp.log:&lt;/p&gt;

&lt;p&gt;2013-05-07 20:27:51,995 &lt;span class=&quot;error&quot;&gt;&amp;#91;127.0.0.1:43950&amp;#93;&lt;/span&gt; TRACE StompIO                        - Received:&lt;br/&gt;
SEND&lt;br/&gt;
b_expires:2013-05-06T22:27:51-07:00&lt;br/&gt;
JMSTimestamp:1367897271000&lt;br/&gt;
destination:/queue/trinity.test_send&lt;br/&gt;
b_timestamp:2013-05-06T20:27:51-07:00&lt;br/&gt;
timestamp:1367897271000&lt;br/&gt;
expires:1367904471000&lt;br/&gt;
json:1&lt;br/&gt;
content-length:2&lt;br/&gt;
b_ct:50&lt;/p&gt;

&lt;p&gt;50&lt;/p&gt;</comment>
                            <comment id="13651931" author="tabish121" created="Wed, 8 May 2013 14:27:27 +0000"  >&lt;p&gt;If you feel there&apos;s an issue the way to help is to create a unit test to reproduce your case&lt;/p&gt;</comment>
                            <comment id="13654620" author="tabish121" created="Fri, 10 May 2013 17:18:13 +0000"  >&lt;p&gt;Downgrade until a test case is provided.&lt;/p&gt;</comment>
                            <comment id="13656287" author="tabish121" created="Mon, 13 May 2013 19:48:03 +0000"  >&lt;p&gt;Seems to be working as expected.  If you can provide a test that shows something wrong please do. &lt;/p&gt;</comment>
                            <comment id="13657604" author="aletheia7" created="Tue, 14 May 2013 22:25:39 +0000"  >&lt;p&gt;Steps to reproduce the problem:&lt;/p&gt;

&lt;p&gt;1) Enable TimeStampPlugin&lt;br/&gt;
2) Send a message to a topic with the timestamp header set to -1 day earlier and the expire header set to -1 day + 10 minutes using the STOMP protocol. JMS will not work.&lt;br/&gt;
4) Use the http://&amp;lt;&amp;gt;:8161/admin interface to see that the message is not present, or use active-admin browse to verify the message is not located in the topic.&lt;/p&gt;

&lt;p&gt;Further details of how the timestampplugin should work can be found here: &lt;a href=&quot;http://tmielke.blogspot.com/2011/01/sync-your-machine-clocks.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://tmielke.blogspot.com/2011/01/sync-your-machine-clocks.html&lt;/a&gt; . Timestampplugin does not work as expected in this article with the STOMP protocol.&lt;/p&gt;</comment>
                            <comment id="13657608" author="tabish121" created="Tue, 14 May 2013 22:29:17 +0000"  >&lt;p&gt;You need to come up with a unit test that demonstrates the problem.  The attached test case should provide you with everything you need.  &lt;/p&gt;</comment>
                            <comment id="13657759" author="aletheia7" created="Wed, 15 May 2013 00:46:13 +0000"  >&lt;p&gt;What exactly do I do with the *.java file? How do I run/install it?&lt;/p&gt;</comment>
                            <comment id="13668464" author="tabish121" created="Tue, 28 May 2013 17:18:12 +0000"  >&lt;p&gt;Test added to activemq-stomp StompTimeStampingBrokerPluginTest which does what was described in this issue, two messages sent with timestamp set for previous day, and a set expiration.  One message received, then wait for the set expiration time and observe that the second message is no longer on the Queue. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12582970" name="StompTimeStampingBrokerPluginTest.java" size="5391" author="tabish" created="Mon, 13 May 2013 19:47:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322612</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jnu7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322957</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>