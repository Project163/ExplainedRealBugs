<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:00:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3405] DLQ messages moved/copied into original queue disappear after failing processing for a second time</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3405</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;1. Message in queue A fails enough times to be moved to the DLQ.&lt;br/&gt;
2. We move/copy the message back to queue A to attempt reprocessing. Invoking the retry operation from JMX can also be used.&lt;br/&gt;
3. The consumer once again fails to consume the message greater than the max number of times.&lt;br/&gt;
4. The message is not put back into the DLQ. If it was moved rather than copied, it means we have a message that was never successfully consumed, but has nevertheless disappeared.&lt;/p&gt;

&lt;p&gt;This is all with the default ActiveMQ settings, though I tried adjusted the DLQ configuration to support both expired and non-persistent messages.&lt;/p&gt;

&lt;p&gt;I found this posting which seems to indicate the same issue I am seeing: &lt;a href=&quot;http://www.mail-archive.com/users@activemq.apache.org/msg09683.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.mail-archive.com/users@activemq.apache.org/msg09683.html&lt;/a&gt;. One difference that I am seeing is that restarting ActiveMQ does not cause the message to show up in the DLQ again. Once it is lost, it is lost forever.&lt;/p&gt;

&lt;p&gt;To replicate this, I believe you can use a consumer that just fails on every invocation.&lt;/p&gt;

&lt;p&gt;One interesting thing is that if I put a message into the DLQ directly, then move it to a queue with a consumer, it will end up in the DLQ again as you would expect. If I then move the DLQ message back to the original queue, it will then show the bevahiour outlined above.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Windows 7, Java 64bit 1.6 update 20, Client and server 5.4.2&lt;/p&gt;</environment>
        <key id="12514497">AMQ-3405</key>
            <summary>DLQ messages moved/copied into original queue disappear after failing processing for a second time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="carfey">Carey Flichel</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Jul 2011 19:57:10 +0000</created>
                <updated>Wed, 31 Jul 2019 18:09:50 +0000</updated>
                            <resolved>Mon, 17 Jun 2013 22:27:37 +0000</resolved>
                                    <version>5.4.2</version>
                                    <fixVersion>5.9.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13067262" author="tabish121" created="Mon, 18 Jul 2011 20:05:03 +0000"  >&lt;p&gt;It would be really helpful if you could take a stab at creating a JUnit test to reproduce the issue, this will also ensure that if it gets fixed it won&apos;t break again.&lt;/p&gt;</comment>
                            <comment id="13076087" author="sbrandwoo" created="Tue, 2 Aug 2011 07:49:50 +0000"  >&lt;p&gt;I can confirm that this issue also affects version 5.5.0. It also occurs for any message created by the admin console, they just never go to the DLQ at all.&lt;/p&gt;


&lt;p&gt;Does anyone know of a workaround?&lt;/p&gt;</comment>
                            <comment id="13086035" author="tabish121" created="Tue, 16 Aug 2011 23:23:05 +0000"  >&lt;p&gt;The reason the Message do not reappear in the DLQ is due to Message Audit on the DLQ filtering what would be duplicate messages.  I&apos;ve created a test case and included it in trunk to show that if Audit is disabled on the DLQ then the Messages are moved back in.  The Move operation places the message onto the destination without modifying its Message Id so any Audited resource will filter it as a duplicate if it was delivered to that destination previously. &lt;/p&gt;</comment>
                            <comment id="13086036" author="tabish121" created="Tue, 16 Aug 2011 23:23:47 +0000"  >&lt;p&gt;Working as designed.  See AMQ3405Test.java in trunk for an example.&lt;/p&gt;</comment>
                            <comment id="13086187" author="sbrandwoo" created="Wed, 17 Aug 2011 07:58:48 +0000"  >&lt;p&gt;Timothy, I have found that any message I create through the admin console will also not be sent to the DLQ, even if I set it as persistent. Do you know the cause for this?&lt;/p&gt;</comment>
                            <comment id="13685961" author="tabish121" created="Mon, 17 Jun 2013 20:46:28 +0000"  >&lt;p&gt;While we can work around this with disable of the Audit, it would be better to fix this so that the Audit of the Message is rolled back as messages are moved out of the DLQ.&lt;/p&gt;</comment>
                            <comment id="13686098" author="tabish121" created="Mon, 17 Jun 2013 22:27:37 +0000"  >&lt;p&gt;Fixed now on trunk, when a message is moved out of a DLQ its rolled back from the DLQ&apos;s Audit so subsequent failures will result in it reappearing in the DLQ.  &lt;/p&gt;</comment>
                            <comment id="16504511" author="jira-bot" created="Thu, 7 Jun 2018 10:39:08 +0000"  >&lt;p&gt;Commit 1ebf1862795286505dc2ce2d36e91008029061a3 in activemq&apos;s branch refs/heads/master from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=1ebf186&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=1ebf186&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-3405&quot; title=&quot;DLQ messages moved/copied into original queue disappear after failing processing for a second time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-3405&quot;&gt;&lt;del&gt;AMQ-3405&lt;/del&gt;&lt;/a&gt; - rework fix to use original destination strategy which may be different from the default shared strategy. new test&lt;/p&gt;</comment>
                            <comment id="16897401" author="jira-bot" created="Wed, 31 Jul 2019 18:09:50 +0000"  >&lt;p&gt;Commit 509c781669fa681eded9d11681e1cb92e5f5d553 in activemq&apos;s branch refs/heads/activemq-5.15.x from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=509c781&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=509c781&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-3405&quot; title=&quot;DLQ messages moved/copied into original queue disappear after failing processing for a second time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-3405&quot;&gt;&lt;del&gt;AMQ-3405&lt;/del&gt;&lt;/a&gt; - rework fix to use original destination strategy which may be different from the default shared strategy. new test&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 1ebf1862795286505dc2ce2d36e91008029061a3)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12656116">AMQ-4616</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>64822</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 15 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0suiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>166422</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>