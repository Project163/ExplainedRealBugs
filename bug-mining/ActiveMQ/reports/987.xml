<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:47:13 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2857] ActiveMQ fails to create tables in MySQL 5.5.5</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2857</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Running an embedded ActiveMQ database, using MySQL as the JDBC data source worked fine under MySQL 5.4.  After upgrading to MySQL 5.5.5, ActiveMQ works fine as long as the three required tables in the activemq database already exist (activemq_acks, activemq_lock, activemq_msgs).  However, if they don&apos;t exist, it fails to create the tables, whereas the tables would be automatically created under MySQL 5.4.&lt;/p&gt;

&lt;p&gt;The problem appears to be in the create table script that&apos;s used.  In previous versions of MySQL, it was legal (though deprecated as of 4.1) to specify the engine using the &quot;TYPE=INNODB&quot; syntax.  The preferred non-deprecated way to do it was to use &quot;ENGINE=INNODB&quot; instead.  Under 5.5.5, it appears that the &quot;TYPE&quot; syntax is now completely illegal, requiring use of the &quot;ENGINE&quot; syntax instead.&lt;/p&gt;

&lt;p&gt;A relevant MySQL bug discussing the issue: &lt;a href=&quot;http://bugs.mysql.com/bug.php?id=17501&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://bugs.mysql.com/bug.php?id=17501&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The following is an example of the actual SQL that is generated by ActiveMQ:&lt;/p&gt;

&lt;p&gt;CREATE TABLE ACTIVEMQ_MSGS(ID BIGINT NOT NULL, CONTAINER VARCHAR(250),&lt;br/&gt;
MSGID_PROD VARCHAR(250), MSGID_SEQ BIGINT, EXPIRATION BIGINT, MSG LONGBLOB, PRIMARY KEY ( ID ) ) TYPE=INNODB&lt;/p&gt;

&lt;p&gt;I have not yet tested it, but it seems likely that the culprit is MySqlJDBCAdapter.java.  It includes the line:&lt;/p&gt;

&lt;p&gt;String typeClause = &quot; TYPE=&quot;+type;&lt;/p&gt;

&lt;p&gt;which should probably change to&lt;/p&gt;

&lt;p&gt;String typeClause = &quot; ENGINE=&quot;+type;&lt;/p&gt;</description>
                <environment>&lt;p&gt;MySQL 5.5.5&lt;/p&gt;</environment>
        <key id="12482192">AMQ-2857</key>
            <summary>ActiveMQ fails to create tables in MySQL 5.5.5</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="matthewj">Matthew J.</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Aug 2010 14:18:24 +0000</created>
                <updated>Fri, 13 Aug 2010 19:34:53 +0000</updated>
                            <resolved>Fri, 13 Aug 2010 10:24:11 +0000</resolved>
                                    <version>5.3.2</version>
                                    <fixVersion>5.4.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12938795" author="matthewj" created="Thu, 12 Aug 2010 22:19:20 +0000"  >&lt;p&gt;Attaching patch file which fixes MySqlJDBCAdapter.java.  Tested this locally, and it did appear to fix the issue.&lt;/p&gt;</comment>
                            <comment id="12938901" author="gtully" created="Fri, 13 Aug 2010 10:24:11 +0000"  >&lt;p&gt;variant of patch applied in r985151&lt;br/&gt;
added typeStatement attribute to make this configurable for backwards compatibility, default to new ENGINE statement so it will work out of the box with MySQL 5.5&lt;br/&gt;
Tanks for the patch. Would be great if you could validate a 5.5 snapshot over the next few days.&lt;/p&gt;</comment>
                            <comment id="12939042" author="matthewj" created="Fri, 13 Aug 2010 19:34:53 +0000"  >&lt;p&gt;Downloaded the latest snapshot, and it does appear to be working correctly for me.&lt;/p&gt;

&lt;p&gt;One thing I noticed in the class was that the &quot;ENGINE&quot; string is still being used directly when using NDBCLUSTER:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;           
l.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;ALTER TABLE &quot;&lt;/span&gt;+statements.getFullMessageTableName()+&lt;span class=&quot;code-quote&quot;&gt;&quot; ENGINE=&quot;&lt;/span&gt;+NDBCLUSTER);
l.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;ALTER TABLE &quot;&lt;/span&gt;+statements.getFullAckTableName()+&lt;span class=&quot;code-quote&quot;&gt;&quot; ENGINE=&quot;&lt;/span&gt;+NDBCLUSTER);
l.add(&lt;span class=&quot;code-quote&quot;&gt;&quot;ALTER TABLE &quot;&lt;/span&gt;+statements.getFullLockTableName()+&lt;span class=&quot;code-quote&quot;&gt;&quot; ENGINE=&quot;&lt;/span&gt;+NDBCLUSTER);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks like NDBCLUSTER was added in MySQL 5.x, so the ENGINE statement will always be correct in the MySQL versions that support it.    It just looks strange that we&apos;re using the &quot;typeStatement&quot; variable in some cases but not in others.  Would it be worth changing these lines as well merely for the sake of consistency?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12461796" name="mysqlpatch.txt" size="900" author="matthewj" created="Thu, 12 Aug 2010 22:19:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>74775</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 years, 15 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310041" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Patch Info</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10042"><![CDATA[Patch Available]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0rpjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>159784</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>