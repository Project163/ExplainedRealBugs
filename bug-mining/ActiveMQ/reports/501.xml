<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:38:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-2032] Redelivered messages to consumer skiped due to false duplicate detection on message rollback with Spring and cacheLevel=CACHE_NONE</title>
                <link>https://issues.apache.org/jira/browse/AMQ-2032</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;The failover default brokerUrl in 5.2 activates the message audit facility to catch possible duplicate message delivery in the event of failover. This mechanism can get in the way of message redelivery, particularly when sessions are closed and an automatic rollback kicks in.&lt;/p&gt;

&lt;p&gt;Original user comment:&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;Redelivery of message fails after a rollback with Spring DMLC with cacheLevel=CACHE_NONE due to a bug in class : &apos;org.apache.activemq.ActiveMQMessageConsumer&apos;. Redelivered messages are wrongly detected as duplicates. It fails to call &apos;rollbackDuplicates&apos; on messages processed by consumer on rollback call on the consumer.&lt;/p&gt;

&lt;p&gt;Sequence: ( See: &lt;a href=&quot;http://fisheye1.atlassian.com/browse/springframework/spring/src/org/springframework/jms/listener/AbstractPollingMessageListenerContainer.java?r=1.14&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://fisheye1.atlassian.com/browse/springframework/spring/src/org/springframework/jms/listener/AbstractPollingMessageListenerContainer.java?r=1.14&lt;/a&gt; )&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Spring creates a transaction&lt;/li&gt;
	&lt;li&gt;Spring creates a JMS consumer&lt;/li&gt;
	&lt;li&gt;Spring give message to Application MessageListener class&lt;/li&gt;
	&lt;li&gt;Spring closes the consumer&lt;/li&gt;
	&lt;li&gt;Spring try to commit&lt;/li&gt;
	&lt;li&gt;Commit fails due to a RuntimeException thrown in Application MessageListener class&lt;/li&gt;
	&lt;li&gt;Spring marks the message as RollbackOnly&lt;/li&gt;
	&lt;li&gt;Spring rollbacks message&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;When ActiveMQ closes the consumer ( org.apache.activemq.ActiveMQMessageConsumer ), it clears &apos;deliveredMessages&apos; list. But this list is needed in rollback method of ActiveMQMessageConsumer to rollback duplicates ! Then consumer cannot rollback duplicates on rollback if consumer is closed before rollback action. The only way I found, is to not clear &apos;deliveredMessages&apos; list on close. It seems, there is no side effect, since after a call to &apos;close&apos; method, the consumer is not used anymore.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Spring DMLC, cacheLevel=CACHE_NONE&lt;/p&gt;</environment>
        <key id="12482185">AMQ-2032</key>
            <summary>Redelivered messages to consumer skiped due to false duplicate detection on message rollback with Spring and cacheLevel=CACHE_NONE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Dec 2008 13:06:55 +0000</created>
                <updated>Thu, 11 Dec 2008 16:56:10 +0000</updated>
                            <resolved>Thu, 11 Dec 2008 16:56:10 +0000</resolved>
                                    <version>5.2.0</version>
                                    <fixVersion>5.3.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12940561" author="gtully" created="Thu, 11 Dec 2008 16:56:10 +0000"  >&lt;p&gt;resolved in 725737&lt;br/&gt;
test case included with the commit.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>75114</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 years, 50 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0tsmf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>171946</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>