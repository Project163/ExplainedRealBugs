<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:35:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5426] ActiveMQMessageConsumer could run into NPE due to concurrent access to internal state</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5426</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;ActiveMQMessageConsumer could run into NPE when the consumer is closing and a message arrived at the same time.&lt;/p&gt;

&lt;p&gt;Here is the stacktrace:&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
at org.apache.activemq.ActiveMQMessageConsumer.ackLater(ActiveMQMessageConsumer.java:979)&lt;br/&gt;
at org.apache.activemq.ActiveMQMessageConsumer.afterMessageIsConsumed(ActiveMQMessageConsumer.java:929)&lt;br/&gt;
at org.apache.activemq.ActiveMQMessageConsumer.dispatch(ActiveMQMessageConsumer.java:1323)&lt;br/&gt;
at org.apache.activemq.ActiveMQSessionExecutor.dispatch(ActiveMQSessionExecutor.java:131)&lt;br/&gt;
at org.apache.activemq.ActiveMQSessionExecutor.iterate(ActiveMQSessionExecutor.java:202)&lt;br/&gt;
at org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:129)&lt;br/&gt;
at org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:47)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)&lt;br/&gt;
at java.lang.Thread.run(Thread.java:745)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12753581">AMQ-5426</key>
            <summary>ActiveMQMessageConsumer could run into NPE due to concurrent access to internal state</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="michael_khw">Michael Wong</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Nov 2014 01:13:06 +0000</created>
                <updated>Wed, 6 Jul 2016 15:08:08 +0000</updated>
                            <resolved>Tue, 5 Jul 2016 20:11:01 +0000</resolved>
                                    <version>5.8.0</version>
                    <version>5.9.1</version>
                    <version>5.10.0</version>
                                    <fixVersion>5.13.4</fixVersion>
                    <fixVersion>5.14.0</fixVersion>
                                    <component>JMS client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="14201352" author="michael_khw" created="Fri, 7 Nov 2014 01:14:01 +0000"  >&lt;p&gt;Do we need to lock deliveredMessages on accessing pendingAck?&lt;/p&gt;</comment>
                            <comment id="14213441" author="michael_khw" created="Sat, 15 Nov 2014 07:20:36 +0000"  >&lt;p&gt;Finally able to reproduce the NPE. Test attached.&lt;/p&gt;</comment>
                            <comment id="15362671" author="william.crowell" created="Tue, 5 Jul 2016 15:55:41 +0000"  >&lt;p&gt;Any update on this?  &lt;/p&gt;</comment>
                            <comment id="15363069" author="christopher.l.shannon" created="Tue, 5 Jul 2016 19:24:29 +0000"  >&lt;p&gt;This appears to have gotten lost in the shuffle.  I took a look and it is still broken. The test only fails for me sometimes (maybe one out of 10 runs) but I can see what the issue is.  I will fix it for 5.13.4 and 5.14.0&lt;/p&gt;</comment>
                            <comment id="15363133" author="jira-bot" created="Tue, 5 Jul 2016 20:07:17 +0000"  >&lt;p&gt;Commit 6bfa13b6e707fb3465a9193cd44c478514fcd948 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=6bfa13b&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=6bfa13b&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5426&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5426&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing a race condition in ActiveMQMessageConsumer that could cause a&lt;br/&gt;
NPE when the consumer is closing&lt;/p&gt;

&lt;p&gt;Thanks to Michael Wong for providing the test case for this issue.&lt;/p&gt;</comment>
                            <comment id="15363136" author="jira-bot" created="Tue, 5 Jul 2016 20:08:27 +0000"  >&lt;p&gt;Commit 2ec32b67af3f494d65a076b32f71560168bb6ec9 in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2ec32b6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2ec32b6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5426&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5426&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing a race condition in ActiveMQMessageConsumer that could cause a&lt;br/&gt;
NPE when the consumer is closing&lt;/p&gt;

&lt;p&gt;Thanks to Michael Wong for providing the test case for this issue.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 6bfa13b6e707fb3465a9193cd44c478514fcd948)&lt;/p&gt;</comment>
                            <comment id="15363140" author="christopher.l.shannon" created="Tue, 5 Jul 2016 20:11:01 +0000"  >&lt;p&gt;Fix has been applied and I also included a modified version of the test case provided to try and catch any issues in the future.   I modified the test to run a bit faster (takes about 10 seconds for me now) because in my testing if it was going to fail for that run it always failed within the first few seconds.  The test case only fails for me about 1/3 of the time before the fix was applied so it isn&apos;t perfect but it&apos;s better than nothing.&lt;/p&gt;</comment>
                            <comment id="15363187" author="jira-bot" created="Tue, 5 Jul 2016 20:38:30 +0000"  >&lt;p&gt;Commit 3856c3999ac8a29171c09de99bd0e8bf9cdaff4e in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=3856c39&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=3856c39&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;https://issues.apache.org/jira/browse/AMQ-5426&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 6bfa13b6e707fb3465a9193cd44c478514fcd948.&lt;/p&gt;</comment>
                            <comment id="15363188" author="jira-bot" created="Tue, 5 Jul 2016 20:38:31 +0000"  >&lt;p&gt;Commit c02bc648460059b6dbc201fa21b7ee0ce2445082 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=c02bc64&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=c02bc64&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5426&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5426&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing a race condition in ActiveMQMessageConsumer that could cause a&lt;br/&gt;
NPE when the consumer is closing by only modifing pendingAck inside of&lt;br/&gt;
the deliveredMessagesMutex&lt;/p&gt;

&lt;p&gt;Thanks to Michael Wong for providing the test case for this issue.&lt;/p&gt;</comment>
                            <comment id="15363190" author="jira-bot" created="Tue, 5 Jul 2016 20:39:16 +0000"  >&lt;p&gt;Commit 72c3a6d0b4e72ffce30d07b7395031152009fe53 in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=72c3a6d&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=72c3a6d&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;https://issues.apache.org/jira/browse/AMQ-5426&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 2ec32b67af3f494d65a076b32f71560168bb6ec9.&lt;/p&gt;</comment>
                            <comment id="15363191" author="jira-bot" created="Tue, 5 Jul 2016 20:39:17 +0000"  >&lt;p&gt;Commit 8812cb9b8e7c91647230e8479dc2aca8762d458a in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=8812cb9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=8812cb9&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5426&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5426&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing a race condition in ActiveMQMessageConsumer that could cause a&lt;br/&gt;
NPE when the consumer is closing by only modifing pendingAck inside of&lt;br/&gt;
the deliveredMessagesMutex&lt;/p&gt;

&lt;p&gt;Thanks to Michael Wong for providing the test case for this issue.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit c02bc648460059b6dbc201fa21b7ee0ce2445082)&lt;/p&gt;</comment>
                            <comment id="15363201" author="christopher.l.shannon" created="Tue, 5 Jul 2016 20:45:24 +0000"  >&lt;p&gt;I reverted the original fix as there was still a bit of a race condition in that it was possible an ack could be blown away or missed if the timer task for batch ack dispatch executed while a message was received.&lt;/p&gt;

&lt;p&gt;The new fix is a lot simpler because it leverages the already existing deliveredMessages lock to protect the pendingAck variable and will make sure that everything is consistent.  &lt;/p&gt;</comment>
                            <comment id="15363320" author="william.crowell" created="Tue, 5 Jul 2016 21:46:51 +0000"  >&lt;p&gt;Christopher, thanks for the quick reply.  Do you happen to know the release date for 5.13.4 and 5.14.0?&lt;/p&gt;</comment>
                            <comment id="15364429" author="christopher.l.shannon" created="Wed, 6 Jul 2016 15:08:08 +0000"  >&lt;p&gt;5.14.0 might be a little while still but I&apos;m hoping to do a 5.13.4 release next week.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12753580">AMQ-5425</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12681718" name="AMQ5426Test.java" size="7650" author="michael_khw" created="Sat, 15 Nov 2014 07:28:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 19 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2235j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>