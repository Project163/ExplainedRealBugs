<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:45:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-7185] XA durable sub prepared acks don&apos;t block redelivery</title>
                <link>https://issues.apache.org/jira/browse/AMQ-7185</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;If a durable sub acks a message in an XA transaction, on prepare the disk image is updated and on recovery the messages is pending an outcome and won&apos;t be redelivered.&lt;/p&gt;

&lt;p&gt;however if the durable sub disconnects and reconnects&#160;without a broker restart, it can receive the same messages again. Acked and prepared messages should be blocked pending the xa transaction outcome.&lt;/p&gt;

&lt;p&gt;This duplicate delivery can result in duplicate acks and early deletion of the message due to the reference count. The end result, another sub may see the&#160;message pending but not be able to receive it b/c it has already been removed from the store.&lt;/p&gt;

&lt;p&gt;symptom in other words:&lt;/p&gt;

&lt;p&gt;durableSub1 and durableStub2 registered, send one message to the topic. The message reference count is 2.&lt;br/&gt;
durabelSub1 does receive in xa transaction, prepares and dies. The ack needs recovery and completion via the transaction manager.&lt;br/&gt;
durableSub1 reconnects and gets the same message again! commits success. The message reference count is decremented to 1.&lt;br/&gt;
the first xa transaction gets recovered and commits, the duplicate ack gets processed; the message reference count is 0 and the message gets deleted in error.&lt;br/&gt;
durableSub2 tries to receive, message pending is 1, but it does not get any message!&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13228594">AMQ-7185</key>
            <summary>XA durable sub prepared acks don&apos;t block redelivery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gtully">Gary Tully</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Apr 2019 13:21:38 +0000</created>
                <updated>Tue, 24 Sep 2019 16:34:54 +0000</updated>
                            <resolved>Wed, 17 Apr 2019 14:36:02 +0000</resolved>
                                    <version>5.15.0</version>
                                    <fixVersion>5.16.0</fixVersion>
                                    <component>Broker</component>
                    <component>XA</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="16820103" author="jira-bot" created="Wed, 17 Apr 2019 13:50:28 +0000"  >&lt;p&gt;Commit 487d4a112e01777ca128c39033a76dd29155e755 in activemq&apos;s branch refs/heads/master from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=487d4a1&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=487d4a1&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7185&quot; title=&quot;XA durable sub prepared acks don&amp;#39;t block redelivery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7185&quot;&gt;&lt;del&gt;AMQ-7185&lt;/del&gt;&lt;/a&gt; - track durable sub prepared acks in preCommit callback and release/remove on xa outcome, avoid duplicate delivery; fix and test&lt;/p&gt;</comment>
                            <comment id="16922493" author="davidhilton68" created="Wed, 4 Sep 2019 13:41:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gtully&quot; class=&quot;user-hover&quot; rel=&quot;gtully&quot;&gt;gtully&lt;/a&gt;&#160; Do you have any feeling as to when 5.16.x might get released ?&lt;/p&gt;</comment>
                            <comment id="16922572" author="gtully" created="Wed, 4 Sep 2019 14:40:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davidhilton68&quot; class=&quot;user-hover&quot; rel=&quot;davidhilton68&quot;&gt;davidhilton68&lt;/a&gt; I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbonofre&quot; class=&quot;user-hover&quot; rel=&quot;jbonofre&quot;&gt;jbonofre&lt;/a&gt; is on the job based on the 5.15.10 vote thread, see: &lt;a href=&quot;https://lists.apache.org/thread.html/810bb99c63ca545210582ad2fa51690f1a83e65402da057960e264a9@%3Cdev.activemq.apache.org%3E&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://lists.apache.org/thread.html/810bb99c63ca545210582ad2fa51690f1a83e65402da057960e264a9@%3Cdev.activemq.apache.org%3E&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="16922574" author="jbonofre" created="Wed, 4 Sep 2019 14:42:38 +0000"  >&lt;p&gt;Hi guys, yes, I confirm that now ActiveMQ 5.15.10 is out, I will start triage and working on 5.16.0.&lt;/p&gt;</comment>
                            <comment id="16922765" author="christopher.l.shannon" created="Wed, 4 Sep 2019 19:06:48 +0000"  >&lt;p&gt;5.16.0 can go out whenever, biggest thing is making sure JDK 11 is working ok with everything including OSGi and the main piece I needed help with was the OSGi/Karaf stuff which I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jbonofre&quot; class=&quot;user-hover&quot; rel=&quot;jbonofre&quot;&gt;jbonofre&lt;/a&gt;&#160;will look at&lt;/p&gt;</comment>
                            <comment id="16936970" author="jira-bot" created="Tue, 24 Sep 2019 16:34:54 +0000"  >&lt;p&gt;Commit 644b529ef64800ee162ddbd7c46551f2508c4c92 in activemq&apos;s branch refs/heads/master from gtully&lt;br/&gt;
[ &lt;a href=&quot;https://gitbox.apache.org/repos/asf?p=activemq.git;h=644b529&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://gitbox.apache.org/repos/asf?p=activemq.git;h=644b529&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-7185&quot; title=&quot;XA durable sub prepared acks don&amp;#39;t block redelivery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-7185&quot;&gt;&lt;del&gt;AMQ-7185&lt;/del&gt;&lt;/a&gt; - rework to leave tx-inflight messages pending in the cursor to avoid duplicates on completion, fix and test&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 8 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z01vpc:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>