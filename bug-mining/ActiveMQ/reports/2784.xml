<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:34:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6222] Message content can be cleared by mistake when isReduceMemoryFootprint is enabled</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6222</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;In a Queue when isReduceMemoryFootprint is enabled the message state should be cleared after persisting to the store.  The idea is that once the data is marshalled into its byte content we can clear out the properties, text, etc to free up memory.&lt;/p&gt;

&lt;p&gt;The problem is that when concurrent dispatch is enabled, messages are added to the store asynchronously and queued up.  There is a race condition because it&apos;s possible for the state to be cleared before the store has a chance to process the message so that when it gets to it, it will be null.  This is most notable when using the VM transport as messages with null content will get dispatched.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12952488">AMQ-6222</key>
            <summary>Message content can be cleared by mistake when isReduceMemoryFootprint is enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="cshannon">Christopher L. Shannon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Mar 2016 15:47:51 +0000</created>
                <updated>Mon, 18 Apr 2016 11:55:29 +0000</updated>
                            <resolved>Tue, 22 Mar 2016 18:57:35 +0000</resolved>
                                    <version>5.13.2</version>
                                    <fixVersion>5.13.3</fixVersion>
                    <fixVersion>5.14.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="15206901" author="jira-bot" created="Tue, 22 Mar 2016 17:54:31 +0000"  >&lt;p&gt;Commit 75990ef14a092b629bf8d2127bc4786e51b31684 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=75990ef&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=75990ef&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6222&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6222&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Moving clearedMarshalledState execution to the async listener on an&lt;br/&gt;
async add to the message store.  This is necessary to make sure this&lt;br/&gt;
logic doens&apos;t execute until after the message is marshalled for the&lt;br/&gt;
store.&lt;/p&gt;</comment>
                            <comment id="15207046" author="jira-bot" created="Tue, 22 Mar 2016 18:57:17 +0000"  >&lt;p&gt;Commit 7f5c09f2d77c77f87a47fb738870c5ee5bc78c27 in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=7f5c09f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=7f5c09f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6222&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6222&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Moving clearedMarshalledState execution to the async listener on an&lt;br/&gt;
async add to the message store.  This is necessary to make sure this&lt;br/&gt;
logic doens&apos;t execute until after the message is marshalled for the&lt;br/&gt;
store.&lt;/p&gt;

&lt;p&gt;(cherry picked from commit 75990ef14a092b629bf8d2127bc4786e51b31684)&lt;/p&gt;</comment>
                            <comment id="15245465" author="gtully" created="Mon, 18 Apr 2016 11:02:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt; I think this is another candidate for revert following&lt;br/&gt;
&lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;a=blobdiff;f=activemq-broker/src/main/java/org/apache/activemq/broker/region/Queue.java;h=9540a9336da22f0a63f01d21404e49cec69db32c;hp=786640e8b7723b08c8f9074bbdf1d58a3d11bcca;hb=3291340;hpb=dc3c5a719b47fc40b5affce8412390ead67ce8ef&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;a=blobdiff;f=activemq-broker/src/main/java/org/apache/activemq/broker/region/Queue.java;h=9540a9336da22f0a63f01d21404e49cec69db32c;hp=786640e8b7723b08c8f9074bbdf1d58a3d11bcca;hb=3291340;hpb=dc3c5a719b47fc40b5affce8412390ead67ce8ef&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;the beforeMarshal is now always called before the async call.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6256&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6256&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15245513" author="christopher.l.shannon" created="Mon, 18 Apr 2016 11:48:49 +0000"  >&lt;p&gt;Agreed, this should no longer be needed anymore so I will back out the change to Queue.&lt;/p&gt;</comment>
                            <comment id="15245517" author="jira-bot" created="Mon, 18 Apr 2016 11:51:22 +0000"  >&lt;p&gt;Commit 9c8bd3360faf89c8fb054b02040458027782f48f in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9c8bd33&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9c8bd33&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6222&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6222&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Reverting the change to move clearMarshalledState into the callback&lt;br/&gt;
listener as beforeMarshall is now called before the async message add&lt;/p&gt;

&lt;p&gt;Revert 75990ef14a092b629bf8d2127bc4786e51b31684&lt;/p&gt;</comment>
                            <comment id="15245524" author="jira-bot" created="Mon, 18 Apr 2016 11:55:29 +0000"  >&lt;p&gt;Commit 9d545cf11f2ed999d68da7b5a16e46adee095a08 in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9d545cf&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9d545cf&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6222&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6222&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Reverting the change to move clearMarshalledState into the callback&lt;br/&gt;
listener as beforeMarshall is now called before the async message add&lt;/p&gt;

&lt;p&gt;Revert 7f5c09f2d77c77f87a47fb738870c5ee5bc78c27&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12952465">AMQ-6221</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="12959158">AMQ-6256</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 31 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2v19b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>