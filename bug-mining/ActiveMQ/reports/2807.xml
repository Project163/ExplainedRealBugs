<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:34:30 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5819] Failover Transport - Sleep for Reconnect Delay happens twice per iteration</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5819</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When the failover transport is attempting to reconnect, it appears to sleep two different times, resulting in more than the expected reconnect delay.&lt;/p&gt;

&lt;p&gt;To reproduce:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;start a jms client with brokerUrl: failover:(tcp://hostname:61616)?randomize=false&amp;amp;warnAfterReconnectAttempts=1&lt;/li&gt;
	&lt;li&gt;turn on debug logging for logger &apos;org.apache.activemq.transport.failover.FailoverTransport&apos;&lt;/li&gt;
	&lt;li&gt;Once the application has connected, stop the broker on hostname&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;While the broker is down, observe the logs from org.apache.activemq.transport.failover.FailoverTransport, and you will see the following pattern for each iteration:&lt;/p&gt;

&lt;p&gt;=====================&lt;br/&gt;
WARN - Failed to connect to &lt;span class=&quot;error&quot;&gt;&amp;#91;tcp://hostname:61616&amp;#93;&lt;/span&gt; after: n attempt(s) continuing to retry.&lt;br/&gt;
DEBUG - Waiting &amp;lt;reconnectDelay&amp;gt; ms before attempting connection&lt;br/&gt;
&amp;#8211; sleep happens here&lt;br/&gt;
DEBUG - urlList connectionList:&lt;span class=&quot;error&quot;&gt;&amp;#91;tcp://hostname:61616&amp;#93;&lt;/span&gt;, from: &lt;span class=&quot;error&quot;&gt;&amp;#91;tcp://hostname:61616&amp;#93;&lt;/span&gt;&lt;br/&gt;
DEBUG - Waiting &amp;lt;reconnectDelay&amp;gt; ms before attempting connection&lt;br/&gt;
&amp;#8212; sleep happens here&lt;br/&gt;
DEBUG - Attempting  nth  connect to: tcp://hostname:61616&lt;br/&gt;
DEBUG - Connect fail to: tcp://hostname:61616, reason: java.net.ConnectException: Connection refused: connect&lt;br/&gt;
=====================&lt;/p&gt;

&lt;p&gt;The above sequence is repeated for as long as the broker is down, with the exponent applied to the reconnectDelay in between the above two instances of sleep. In the configuration above, once the maxReconnectDelay is reached (30 seconds) it is actually 1 minute between attempts to reconnect to the broker. Log output with timestamps is shown below, and you can see that it is 1 minute between attempting the 13th connection and attempting to 14th connection, even though maxReconnectDelay is 30 seconds:&lt;/p&gt;


&lt;p&gt;log4j.appender.CONSOLE.layout.ConversionPattern=%d &lt;span class=&quot;error&quot;&gt;&amp;#91;%C:%-4L&amp;#93;&lt;/span&gt; %-5p - %m%n&lt;br/&gt;
=====================&lt;br/&gt;
2015-06-02 10:39:19,824 &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.transport.failover.FailoverTransport:1024&amp;#93;&lt;/span&gt; DEBUG - Attempting  13th  connect to: tcp://hostname:61616&lt;br/&gt;
2015-06-02 10:39:20,860 &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.transport.failover.FailoverTransport:1075&amp;#93;&lt;/span&gt; DEBUG - Connect fail to: tcp://hostname:61616, reason: java.net.ConnectException: Connection refused: connect&lt;br/&gt;
2015-06-02 10:39:20,860 &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.transport.failover.FailoverTransport:1119&amp;#93;&lt;/span&gt; WARN  - Failed to connect to &lt;span class=&quot;error&quot;&gt;&amp;#91;tcp://hostname:61616&amp;#93;&lt;/span&gt; after: 14 attempt(s) continuing to retry.&lt;br/&gt;
2015-06-02 10:39:20,860 &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.transport.failover.FailoverTransport:1135&amp;#93;&lt;/span&gt; DEBUG - Waiting 30000 ms before attempting connection&lt;br/&gt;
2015-06-02 10:39:50,868 &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.transport.failover.FailoverTransport:814 &amp;#93;&lt;/span&gt; DEBUG - urlList connectionList:&lt;span class=&quot;error&quot;&gt;&amp;#91;tcp://hostname:61616&amp;#93;&lt;/span&gt;, from: &lt;span class=&quot;error&quot;&gt;&amp;#91;tcp://hostname:61616&amp;#93;&lt;/span&gt;&lt;br/&gt;
2015-06-02 10:39:50,868 &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.transport.failover.FailoverTransport:1000&amp;#93;&lt;/span&gt; DEBUG - Waiting 30000 ms before attempting connection.&lt;br/&gt;
2015-06-02 10:40:20,870 &lt;span class=&quot;error&quot;&gt;&amp;#91;org.apache.activemq.transport.failover.FailoverTransport:1024&amp;#93;&lt;/span&gt; DEBUG - Attempting  14th  connect to: tcp://hostname:61616&lt;br/&gt;
=====================&lt;/p&gt;</description>
                <environment></environment>
        <key id="12834644">AMQ-5819</key>
            <summary>Failover Transport - Sleep for Reconnect Delay happens twice per iteration</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="eric.wyles">Eric Wyles</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Jun 2015 15:52:58 +0000</created>
                <updated>Fri, 15 Apr 2016 16:51:55 +0000</updated>
                            <resolved>Fri, 15 Apr 2016 16:51:55 +0000</resolved>
                                    <version>5.10.0</version>
                    <version>5.10.1</version>
                    <version>5.10.2</version>
                    <version>5.11.0</version>
                    <version>5.11.1</version>
                                    <fixVersion>5.13.3</fixVersion>
                    <fixVersion>5.14.0</fixVersion>
                                    <component>JMS client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14569328" author="eric.wyles" created="Tue, 2 Jun 2015 15:57:39 +0000"  >&lt;p&gt;Workarounds:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If using exponential backoff, set maxReconnectDelay to half of actual max you want to configure&lt;/li&gt;
	&lt;li&gt;if not using exponential backoff, set initialReconnectDelay to half of the reconnect delay you want&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15243211" author="jira-bot" created="Fri, 15 Apr 2016 16:49:59 +0000"  >&lt;p&gt;Commit c8af70f0949e38270b313b7b8ce305c5870362da in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=c8af70f&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=c8af70f&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5819&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5819&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Only apply the initialReconnectDelay on the first reconnection attempt&lt;br/&gt;
after a connected transport has failed.  &lt;/p&gt;</comment>
                            <comment id="15243212" author="jira-bot" created="Fri, 15 Apr 2016 16:51:04 +0000"  >&lt;p&gt;Commit 2f935a260b00577eea64d8c50fa1437b6874e5b9 in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2f935a2&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=2f935a2&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5819&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5819&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Only apply the initialReconnectDelay on the first reconnection attempt&lt;br/&gt;
after a connected transport has failed.&lt;br/&gt;
(cherry picked from commit c8af70f0949e38270b313b7b8ce305c5870362da)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fiuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>