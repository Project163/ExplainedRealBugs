<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:55:20 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3785] ActiveMQSslConnectionFactory does not detect ssl request in failover URIs when creating transports</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3785</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;The createTransport method in ActiveMQSslConnectionFactory delegates to the super class if the URI scheme &lt;br/&gt;
is not ssl. Failover URIs have &apos;failover&apos; as the URI scheme and so always delegate to the superclass. This causes&lt;br/&gt;
ssl connections that need key or trust stores manipulated by code to hang or fail  as the credentials are not available. &lt;/p&gt;

&lt;p&gt;Code from  SVN trunk for ActiveMQSslConnectionFactory shows why&lt;/p&gt;

&lt;p&gt; protected Transport createTransport() throws JMSException {&lt;br/&gt;
        // If the given URI is non-ssl, let superclass handle it.&lt;br/&gt;
        if (!brokerURL.getScheme().equals(&quot;ssl&quot;)) &lt;/p&gt;
{
            return super.createTransport();
        }
&lt;p&gt;// !! jackf comment Code below never reached for failover URIs like failover:ssl:... or failover:(tcp:..., ssl...)&lt;br/&gt;
// because the URI Scheme is failover, not ssl.&lt;br/&gt;
// Therefore connections that need a keyManager or trustManager fail&lt;/p&gt;

&lt;p&gt;        try {&lt;br/&gt;
            if (keyManager == null || trustManager == null) &lt;/p&gt;
{
                trustManager = createTrustManager();
                keyManager = createKeyManager();
                // secureRandom can be left as null
            }
&lt;p&gt;            SslTransportFactory sslFactory = new SslTransportFactory();&lt;br/&gt;
            SslContext ctx = new SslContext(keyManager, trustManager, secureRandom);&lt;br/&gt;
            SslContext.setCurrentSslContext(ctx);&lt;br/&gt;
            return sslFactory.doConnect(brokerURL);&lt;br/&gt;
        } catch (Exception e) &lt;/p&gt;
{
            throw JMSExceptionSupport.create(&quot;Could not create Transport. Reason: &quot; + e, e);
        }
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;(Vague) Solution: 1) need better pattern match than URI scheme to detect requests for ssl connections. 2) A failover URI is  essentially a list of URIs so multiple ssl transport requests may be in the failover list. A first start is to require that the same key and trust stores are used for all failover connections but you may want to consider allowing customized stores for each of the ssl connections.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Looks global from SVN source but I detected with JDK 1.6.0_31 on Redhat Linux client using AMQ 5.5.0&lt;/p&gt;</environment>
        <key id="12547959">AMQ-3785</key>
            <summary>ActiveMQSslConnectionFactory does not detect ssl request in failover URIs when creating transports</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="jackf">Jack Fitch</reporter>
                        <labels>
                    </labels>
                <created>Sat, 24 Mar 2012 15:46:47 +0000</created>
                <updated>Mon, 17 Dec 2012 16:11:46 +0000</updated>
                            <resolved>Mon, 16 Jul 2012 12:13:13 +0000</resolved>
                                    <version>5.5.0</version>
                                    <fixVersion>5.7.0</fixVersion>
                                    <component>Transport</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13253808" author="tabish121" created="Fri, 13 Apr 2012 22:25:02 +0000"  >&lt;p&gt;Should provide unit tests and patch&lt;/p&gt;</comment>
                            <comment id="13415046" author="gtully" created="Mon, 16 Jul 2012 12:13:13 +0000"  >&lt;p&gt;fix in &lt;a href=&quot;http://svn.apache.org/viewvc?rev=1361984&amp;amp;view=rev&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?rev=1361984&amp;amp;view=rev&lt;/a&gt;&lt;br/&gt;
the sslfactory was bypassing normal transport factory resolution. fix is to have it use the sslcontext thread local, which is respected by the ssltransport factory.&lt;/p&gt;</comment>
                            <comment id="13440423" author="bryce" created="Thu, 23 Aug 2012 16:34:57 +0000"  >&lt;p&gt;I downloaded the ActiveMQ 5.7 snapshot Jars and still had a similar issue. See attached zip file.&lt;/p&gt;</comment>
                            <comment id="13440427" author="bryce" created="Thu, 23 Aug 2012 16:38:22 +0000"  >&lt;p&gt;Here it is. &lt;/p&gt;

&lt;p&gt;The SSL failover fails with a certificate_unknown error using&lt;br/&gt;
ActiveMQSslConnectionFactory.setKeyAndTrustManagers&lt;/p&gt;

&lt;p&gt;If, however, that line of code is commented out and Thread.setSslContext is used instead it does work.&lt;/p&gt;</comment>
                            <comment id="13530391" author="ccorsi" created="Wed, 12 Dec 2012 21:52:24 +0000"  >&lt;p&gt;This patch fixes the original issue that was brought up with here.  &lt;/p&gt;

&lt;p&gt;The problem was that the getUrlOrResourceAsStream method would assume that the passed store name was formatted as a url or was available on the classpath.  It does not take into account the possibility that the store was not located in the classpath and that the passed store name was not converted into a url.&lt;/p&gt;

&lt;p&gt;This patch fixes this issue. &lt;/p&gt;

&lt;p&gt;Note that the attached stores are copies from the activemq-stomp module.&lt;/p&gt;</comment>
                            <comment id="13534029" author="ccorsi" created="Mon, 17 Dec 2012 16:11:46 +0000"  >&lt;p&gt;I have created a new issue, &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-4227&quot; title=&quot;ActiveMQSslConnectionFactory does not allow for regular files to be found unless a valid URL is provided or is located on the classpath&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-4227&quot;&gt;&lt;del&gt;AMQ-4227&lt;/del&gt;&lt;/a&gt;, to track the bug that I noticed using the test case that was attached to this issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12542149" name="ActiveMQFailoverTest.zip" size="3741028" author="bryce" created="Thu, 23 Aug 2012 16:38:22 +0000"/>
                            <attachment id="12560649" name="client.keystore" size="2201" author="ccorsi" created="Wed, 12 Dec 2012 21:52:24 +0000"/>
                            <attachment id="12560650" name="server.keystore" size="2201" author="ccorsi" created="Wed, 12 Dec 2012 21:52:24 +0000"/>
                            <attachment id="12560648" name="ssltruststore.patch" size="8600" author="ccorsi" created="Wed, 12 Dec 2012 21:52:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233056</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ahzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59189</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>