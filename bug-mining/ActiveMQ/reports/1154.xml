<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:49:42 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-3077] ArraysIndexOutOfBoundsException : -32768 in &quot;BrokerService[xxx] Task&quot; thread</title>
                <link>https://issues.apache.org/jira/browse/AMQ-3077</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Exception in thread &quot;BrokerService&lt;span class=&quot;error&quot;&gt;&amp;#91;SUP-tterdp31v&amp;#93;&lt;/span&gt; Task&quot; java.lang.ArrayIndexOutOfBoundsException: -32767&lt;br/&gt;
        at org.apache.activemq.openwire.BooleanStream.writeBoolean(BooleanStream.java:54)&lt;br/&gt;
        at org.apache.activemq.openwire.OpenWireFormat.tightMarshalNestedObject1(OpenWireFormat.java:377)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalNestedObject1(BaseDataStreamMarshaller.java:131)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalObjectArray1(BaseDataStreamMarshaller.java:357)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BrokerInfoMarshaller.tightMarshal1(BrokerInfoMarshaller.java:106)&lt;br/&gt;
        at org.apache.activemq.openwire.OpenWireFormat.tightMarshalNestedObject1(OpenWireFormat.java:397)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalNestedObject1(BaseDataStreamMarshaller.java:131)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalObjectArray1(BaseDataStreamMarshaller.java:357)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BrokerInfoMarshaller.tightMarshal1(BrokerInfoMarshaller.java:106)&lt;br/&gt;
        at org.apache.activemq.openwire.OpenWireFormat.tightMarshalNestedObject1(OpenWireFormat.java:397)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalNestedObject1(BaseDataStreamMarshaller.java:131)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalObjectArray1(BaseDataStreamMarshaller.java:357)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BrokerInfoMarshaller.tightMarshal1(BrokerInfoMarshaller.java:106)&lt;br/&gt;
        at org.apache.activemq.openwire.OpenWireFormat.tightMarshalNestedObject1(OpenWireFormat.java:397)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalNestedObject1(BaseDataStreamMarshaller.java:131)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalObjectArray1(BaseDataStreamMarshaller.java:357)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BrokerInfoMarshaller.tightMarshal1(BrokerInfoMarshaller.java:106)&lt;br/&gt;
        at org.apache.activemq.openwire.OpenWireFormat.tightMarshalNestedObject1(OpenWireFormat.java:397)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalNestedObject1(BaseDataStreamMarshaller.java:131)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalObjectArray1(BaseDataStreamMarshaller.java:357)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BrokerInfoMarshaller.tightMarshal1(BrokerInfoMarshaller.java:106)&lt;br/&gt;
        at org.apache.activemq.openwire.OpenWireFormat.tightMarshalNestedObject1(OpenWireFormat.java:397)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalNestedObject1(BaseDataStreamMarshaller.java:131)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalObjectArray1(BaseDataStreamMarshaller.java:357)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BrokerInfoMarshaller.tightMarshal1(BrokerInfoMarshaller.java:106)&lt;br/&gt;
        at org.apache.activemq.openwire.OpenWireFormat.tightMarshalNestedObject1(OpenWireFormat.java:397)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalNestedObject1(BaseDataStreamMarshaller.java:131)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalObjectArray1(BaseDataStreamMarshaller.java:357)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BrokerInfoMarshaller.tightMarshal1(BrokerInfoMarshaller.java:106)&lt;br/&gt;
        at org.apache.activemq.openwire.OpenWireFormat.tightMarshalNestedObject1(OpenWireFormat.java:397)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalNestedObject1(BaseDataStreamMarshaller.java:131)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalObjectArray1(BaseDataStreamMarshaller.java:357)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BrokerInfoMarshaller.tightMarshal1(BrokerInfoMarshaller.java:106)&lt;br/&gt;
        at org.apache.activemq.openwire.OpenWireFormat.marshal(OpenWireFormat.java:228)&lt;br/&gt;
        at org.apache.activemq.transport.tcp.TcpTransport.oneway(TcpTransport.java:181)&lt;br/&gt;
        at org.apache.activemq.transport.InactivityMonitor.oneway(InactivityMonitor.java:255)&lt;br/&gt;
        at org.apache.activemq.transport.TransportFilter.oneway(TransportFilter.java:85)&lt;br/&gt;
        at org.apache.activemq.transport.WireFormatNegotiator.oneway(WireFormatNegotiator.java:104)&lt;br/&gt;
        at org.apache.activemq.transport.MutexTransport.oneway(MutexTransport.java:40)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.dispatch(TransportConnection.java:1249)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.processDispatch(TransportConnection.java:810)&lt;br/&gt;
        at org.apache.activemq.broker.TransportConnection.iterate(TransportConnection.java:846)&lt;br/&gt;
        at org.apache.activemq.thread.PooledTaskRunner.runTask(PooledTaskRunner.java:122)&lt;br/&gt;
        at org.apache.activemq.thread.PooledTaskRunner$1.run(PooledTaskRunner.java:43)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;Today this exception is not written in ActiveMQ logs but on the standard output. &lt;br/&gt;
It seems that happens when network of brokers connections are stopped, but I&apos;m not sure at all. (the number of &quot;bridge to ... stopped&quot; seems to be the same as the number of Exceptions detected)&lt;/p&gt;

&lt;p&gt;So I need to dig into this problem to be more precise.&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux, Java 6, Fuse Message Brokers 5.4.0-1 or 5.4.1-1&lt;/p&gt;</environment>
        <key id="12492805">AMQ-3077</key>
            <summary>ArraysIndexOutOfBoundsException : -32768 in &quot;BrokerService[xxx] Task&quot; thread</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="eric-awl">Eric</reporter>
                        <labels>
                    </labels>
                <created>Thu, 9 Dec 2010 08:52:35 +0000</created>
                <updated>Tue, 15 Mar 2011 08:02:09 +0000</updated>
                            <resolved>Thu, 13 Jan 2011 14:26:12 +0000</resolved>
                                    <version>5.4.0</version>
                    <version>5.4.1</version>
                                    <fixVersion>5.5.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="12969680" author="elisa41" created="Thu, 9 Dec 2010 10:16:49 +0000"  >&lt;p&gt;I confirm that, into each broker experiencing java.lang.ArrayIndexOutOfBoundsException, there is as much number of exceptions as number of &quot;bridge to ... stopped&quot; messages.&lt;/p&gt;</comment>
                            <comment id="12970108" author="eric-awl" created="Fri, 10 Dec 2010 09:22:03 +0000"  >&lt;p&gt;Since I see a lot of &quot;imbrications&quot; of &lt;/p&gt;

&lt;p&gt;at org.apache.activemq.openwire.OpenWireFormat.tightMarshalNestedObject1(OpenWireFormat.java:397)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalNestedObject1(BaseDataStreamMarshaller.java:131)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BaseDataStreamMarshaller.tightMarshalObjectArray1(BaseDataStreamMarshaller.java:357)&lt;br/&gt;
        at org.apache.activemq.openwire.v6.BrokerInfoMarshaller.tightMarshal1(BrokerInfoMarshaller.java:106)&lt;/p&gt;

&lt;p&gt;perhaps a &quot;short&quot; usage in the BooleanStream.writeBoolean is not enough to manage complexity of the message sent ?&lt;/p&gt;

&lt;p&gt;public void writeBoolean(boolean value) throws IOException {&lt;br/&gt;
        if (bytePos == 0) {&lt;br/&gt;
            arrayLimit++;&lt;br/&gt;
            if (arrayLimit &amp;gt;= data.length) &lt;/p&gt;
{
                // re-grow the array.
                byte d[] = new byte[data.length * 2];
                System.arraycopy(data, 0, d, 0, data.length);
                data = d;
            }
&lt;p&gt;        }&lt;br/&gt;
        if (value) &lt;/p&gt;
{
            data[arrayPos] |= 0x01 &amp;lt;&amp;lt; bytePos;
        }
&lt;p&gt;        bytePos++;&lt;br/&gt;
        if (bytePos &amp;gt;= 8) &lt;/p&gt;
{
            bytePos = 0;
            arrayPos++;
        }
&lt;p&gt;    }&lt;/p&gt;


&lt;p&gt;            data&lt;span class=&quot;error&quot;&gt;&amp;#91;arrayPos&amp;#93;&lt;/span&gt; |= 0x01 &amp;lt;&amp;lt; bytePos;&lt;/p&gt;

&lt;p&gt;arrayPos would become too big and reached 32768 limit of the &quot;short usage&quot; into the BooleanStream object ? (8 * 32768 bits =&amp;gt; 262144 individual informations to send)&lt;/p&gt;

&lt;p&gt;We are in a complex network of brokers situation  (that will have to be far, far more complex for our needs in the future with more than 1000 servers and 4 imbricated networks of brokers)&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;</comment>
                            <comment id="12970745" author="eric-awl" created="Mon, 13 Dec 2010 08:41:15 +0000"  >&lt;p&gt;Here is a Gary Tully&apos;s comment added on User discussion forum :&lt;/p&gt;

&lt;p&gt;That looks like some concurrent access to the brokerInfos. Can you &lt;br/&gt;
open a jira issue and attach as much relevant info about your setup as &lt;br/&gt;
possible. &lt;/p&gt;

&lt;p&gt;I think the problem is in the &lt;br/&gt;
org.apache.activemq.command.BrokerInfo#copy() method, it does not deep &lt;br/&gt;
copy the brokerInfo array. &lt;/p&gt;

&lt;p&gt;Gary, what happened with &quot;peerBrokerInfo&quot; and BrokerInfoMarshaller if one broker A is &quot;network connected&quot; on broker B and broker B is connected on broker A  too ? It&apos;s our configuration.&lt;/p&gt;

&lt;p&gt;eric-AWL&lt;/p&gt;
</comment>
                            <comment id="12970765" author="eric-awl" created="Mon, 13 Dec 2010 10:04:30 +0000"  >&lt;p&gt;TransportConnection.java &lt;/p&gt;

&lt;p&gt;start() in 5.4.1&lt;/p&gt;

&lt;p&gt;public void start() throws Exception {&lt;br/&gt;
        starting = true;&lt;br/&gt;
        try {&lt;br/&gt;
            synchronized (this) {&lt;br/&gt;
                if (taskRunnerFactory != null) &lt;/p&gt;
{
                    taskRunner = taskRunnerFactory.createTaskRunner(this, &quot;ActiveMQ Connection Dispatcher: &quot;
                            + getRemoteAddress());
                }
&lt;p&gt; else &lt;/p&gt;
{
                    taskRunner = null;
                }&lt;br/&gt;
                transport.start();&lt;br/&gt;
                active = true;&lt;br/&gt;
                BrokerInfo info = connector.getBrokerInfo().copy();&lt;br/&gt;
                info.setPeerBrokerInfos(this.broker.getPeerBrokerInfos());&lt;br/&gt;
                dispatchAsync(info);&lt;br/&gt;
                &lt;br/&gt;
                connector.onStarted(this);&lt;br/&gt;
            }&lt;br/&gt;
        } catch (Exception e) {
            // Force clean up on an error starting up.
            stop();
            throw e;
        } finally {&lt;br/&gt;
            // stop() can be called from within the above block,&lt;br/&gt;
            // but we want to be sure start() completes before&lt;br/&gt;
            // stop() runs, so queue the stop until right now:&lt;br/&gt;
            starting = false;&lt;br/&gt;
            if (pendingStop) {
                LOG.debug(&quot;Calling the delayed stop()&quot;);
                stop();
            }&lt;br/&gt;
        }&lt;br/&gt;
    }&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
and start() in 5.3.2&lt;br/&gt;
&lt;br/&gt;
public void start() throws Exception {&lt;br/&gt;
        starting = true;&lt;br/&gt;
        try {&lt;br/&gt;
            synchronized (this) {&lt;br/&gt;
                if (taskRunnerFactory != null) {
                    taskRunner = taskRunnerFactory.createTaskRunner(this, &quot;ActiveMQ Connection Dispatcher: &quot;
                            + getRemoteAddress());
                } else {                    taskRunner = null;                }
&lt;p&gt;                transport.start();&lt;br/&gt;
                active = true;&lt;br/&gt;
                dispatchAsync(connector.getBrokerInfo());&lt;br/&gt;
                connector.onStarted(this);&lt;br/&gt;
            }&lt;br/&gt;
        } catch (Exception e) &lt;/p&gt;
{
            // Force clean up on an error starting up.
            stop();
            throw e;
        }
&lt;p&gt; finally {&lt;br/&gt;
            // stop() can be called from within the above block,&lt;br/&gt;
            // but we want to be sure start() completes before&lt;br/&gt;
            // stop() runs, so queue the stop until right now:&lt;br/&gt;
            starting = false;&lt;br/&gt;
            if (pendingStop) &lt;/p&gt;
{
                LOG.debug(&quot;Calling the delayed stop()&quot;);
                stop();
            }
&lt;p&gt;        }&lt;br/&gt;
    }&lt;/p&gt;


&lt;p&gt;BrokerInfo info = connector.getBrokerInfo().copy();&lt;br/&gt;
info.setPeerBrokerInfos(this.broker.getPeerBrokerInfos());&lt;br/&gt;
dispatchAsync(info);&lt;/p&gt;

&lt;p&gt;vs&lt;/p&gt;

&lt;p&gt;dispatchAsync(connector.getBrokerInfo());&lt;/p&gt;


&lt;p&gt;I suspect the difference with what happened in 5.3.2 is here ...        &lt;br/&gt;
We are in a configuration with &quot;no duplex connectors&quot; where A is connected to B and B is connected to A.&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;</comment>
                            <comment id="12971206" author="eric-awl" created="Tue, 14 Dec 2010 09:17:22 +0000"  >&lt;p&gt; public Response processBrokerInfo(BrokerInfo info) {&lt;br/&gt;
        if (info.isSlaveBroker()) {&lt;br/&gt;
            BrokerService bService = connector.getBrokerService();&lt;br/&gt;
            // Do we only support passive slaves - or does the slave want to be&lt;br/&gt;
            // passive ?&lt;br/&gt;
            boolean passive = bService.isPassiveSlave() || info.isPassiveSlave();&lt;br/&gt;
            if (passive == false) &lt;/p&gt;
{
                
                // stream messages from this broker (the master) to
                // the slave
                MutableBrokerFilter parent = (MutableBrokerFilter) broker.getAdaptor(MutableBrokerFilter.class);
                masterBroker = new MasterBroker(parent, transport);
                masterBroker.startProcessing();
            }
&lt;p&gt;            LOG.info((passive?&quot;Passive&quot;:&quot;Active&quot;)+&quot; Slave Broker &quot; + info.getBrokerName() + &quot; is attached&quot;);&lt;br/&gt;
            bService.slaveConnectionEstablished();&lt;br/&gt;
        } else if (info.isNetworkConnection() &amp;amp;&amp;amp; info.isDuplexConnection()) {&lt;br/&gt;
            // so this TransportConnection is the rear end of a network bridge&lt;br/&gt;
            // We have been requested to create a two way pipe ...&lt;br/&gt;
            try {&lt;br/&gt;
                // We first look if existing network connection already exists for the same broker Id&lt;br/&gt;
                // It&apos;s possible in case of brief network fault to have this transport connector side of the connection always active&lt;br/&gt;
                // and the duplex network connector side wanting to open a new one&lt;br/&gt;
                // In this case, the old connection must be broken&lt;br/&gt;
                BrokerId	remoteBrokerId = info.getBrokerId();&lt;br/&gt;
                setDuplexRemoteBrokerId(remoteBrokerId);&lt;br/&gt;
                CopyOnWriteArrayList&amp;lt;TransportConnection&amp;gt; connections = this.connector.getConnections();&lt;br/&gt;
                for (Iterator&amp;lt;TransportConnection&amp;gt; iter = connections.iterator(); iter.hasNext()&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; {&lt;br/&gt;
            		TransportConnection c = iter.next();&lt;br/&gt;
                    if ((c != this) &amp;amp;&amp;amp; (remoteBrokerId.equals(c.getDuplexRemoteBrokerId()))) &lt;/p&gt;
{
                        LOG.warn(&quot;An existing duplex active connection already exists for this broker (&quot; + remoteBrokerId + &quot;). Stopping it.&quot;);
                        c.stop();
                    }
&lt;p&gt;                }&lt;br/&gt;
                Properties properties = MarshallingSupport.stringToProperties(info.getNetworkProperties());&lt;br/&gt;
                Map&amp;lt;String, String&amp;gt; props = createMap(properties);&lt;br/&gt;
                NetworkBridgeConfiguration config = new NetworkBridgeConfiguration();&lt;br/&gt;
                IntrospectionSupport.setProperties(config, props, &quot;&quot;);&lt;br/&gt;
                config.setBrokerName(broker.getBrokerName());&lt;br/&gt;
                URI uri = broker.getVmConnectorURI();&lt;br/&gt;
                HashMap&amp;lt;String, String&amp;gt; map = new HashMap&amp;lt;String, String&amp;gt;(URISupport.parseParameters(uri));&lt;br/&gt;
                map.put(&quot;network&quot;, &quot;true&quot;);&lt;br/&gt;
                map.put(&quot;async&quot;, &quot;false&quot;);&lt;br/&gt;
                uri = URISupport.createURIWithQuery(uri, URISupport.createQueryString(map));&lt;br/&gt;
                Transport localTransport = TransportFactory.connect(uri);&lt;br/&gt;
                Transport remoteBridgeTransport = new ResponseCorrelator(transport);&lt;br/&gt;
                duplexBridge = NetworkBridgeFactory.createBridge(config, localTransport, remoteBridgeTransport);&lt;br/&gt;
                duplexBridge.setBrokerService(broker.getBrokerService());&lt;br/&gt;
                // now turn duplex off this side&lt;br/&gt;
                info.setDuplexConnection(false);&lt;br/&gt;
                duplexBridge.setCreatedByDuplex(true);&lt;br/&gt;
                duplexBridge.duplexStart(this, brokerInfo, info);&lt;br/&gt;
                LOG.info(&quot;Created Duplex Bridge back to &quot; + info.getBrokerName());&lt;br/&gt;
                return null;&lt;br/&gt;
            } catch (TransportDisposedIOException e) &lt;/p&gt;
{
                LOG.warn(&quot;Duplex Bridge back to &quot; + info.getBrokerName() + &quot; was correctly stopped before it was correctly started.&quot;);
                return null;
            }
&lt;p&gt; catch (Exception e) &lt;/p&gt;
{
                LOG.error(&quot;Creating duplex network bridge&quot;, e);
            }
&lt;p&gt;        }&lt;br/&gt;
        // We only expect to get one broker info command per connection&lt;br/&gt;
        if (this.brokerInfo != null) &lt;/p&gt;
{
            LOG.warn(&quot;Unexpected extra broker info command received: &quot; + info);
        }
&lt;p&gt;        this.brokerInfo = info;&lt;br/&gt;
        broker.addBroker(this, info);&lt;br/&gt;
        networkConnection = true;&lt;br/&gt;
        List&amp;lt;TransportConnectionState&amp;gt; connectionStates = listConnectionStates();&lt;br/&gt;
        for (TransportConnectionState cs : connectionStates) &lt;/p&gt;
{
            cs.getContext().setNetworkConnection(true);
        }
&lt;p&gt;        return null;&lt;br/&gt;
    }&lt;/p&gt;


&lt;p&gt;=&amp;gt; broker.addBroker(this, info)&lt;/p&gt;

&lt;p&gt;&quot;info&quot; object seems to become very big in the case of a lot of brokers with a lot of network connections between them . (That&apos;s our case !)&lt;/p&gt;

&lt;p&gt;Why is it now necessary (since 5.4) for a &quot;transport connector side&quot; broker to export already established peer connections to each new &quot;initator side (network connector)&quot; broker ?&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;</comment>
                            <comment id="12971568" author="eric-awl" created="Wed, 15 Dec 2010 08:03:48 +0000"  >&lt;p&gt;TransportConnection.java &lt;/p&gt;

&lt;p&gt;BrokerInfo info = connector.getBrokerInfo().copy();&lt;br/&gt;
info.setPeerBrokerInfos(this.broker.getPeerBrokerInfos());&lt;br/&gt;
dispatchAsync(info);&lt;/p&gt;


&lt;p&gt;I think it is useful for Openwire v6 ConnectionControl (connectedBrokers). I don&apos;t find that ActiveMQ internal process need to know that broker A is connected to B that is connected to C, that is connected to D, that is connected to A .........&lt;/p&gt;

&lt;p&gt;info.setPeerBrokerInfos(this.broker.getPeerBrokerInfos()) =&amp;gt; Don&apos;t we need to break the BrokerInfo recursivity here, and only keep the first level of peerBrokers before sending it to the network connector side ????&lt;/p&gt;

&lt;p&gt;We have a lot of brokers that are all connected together in the two ways with not duplex network connection.&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;</comment>
                            <comment id="12971673" author="gtully" created="Wed, 15 Dec 2010 13:08:57 +0000"  >&lt;p&gt;yea, at a minimum there should be duplicate detection, only add one that is not already present.&lt;/p&gt;

&lt;p&gt;If this is the root of your problem, it should be easy to create a test case that trys to serialize X brokerInfos, this should blow the boolean output stream.&lt;/p&gt;

&lt;p&gt;Also, I think the propagation of peer broker infos should be configurable, it is used to let the clients know about the list of alternative brokers, so it should only be gathered if necessary. &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2632&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-2632&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We need to get some test cases that can demonstrate this problem and can validate and protect the changes when it is fixed.&lt;/p&gt;</comment>
                            <comment id="12971735" author="eric-awl" created="Wed, 15 Dec 2010 16:47:56 +0000"  >&lt;p&gt;If I add an algorithm that &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;adds only the first level of peerbrokers in  TransportConnection.start() instead of &quot;info.setPeerBrokerInfos(this.broker.getPeerBrokerInfos());&quot;&lt;/li&gt;
	&lt;li&gt;detects that a peerbroker = current broker in TransportConnection.processBrokerInfo(....) before &quot;broker.addBroker(this, info);&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Is it always compatible with &quot;Automatic cluster update and rebalance&quot; new 5.4 feature ?&lt;/p&gt;

&lt;p&gt;(If it is the case, I will try to create specific test case too).&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;</comment>
                            <comment id="12971742" author="gtully" created="Wed, 15 Dec 2010 17:19:18 +0000"  >&lt;p&gt;not sure on the first part, the first level restriction, I think that should be configurable because it is topology dependent.&lt;/p&gt;

&lt;p&gt;great, patches with tests are always most welcome. There are a few update rebalance feature tests in activemq-core that will protect that feature with your changes. &lt;/p&gt;</comment>
                            <comment id="12972117" author="eric-awl" created="Thu, 16 Dec 2010 15:42:46 +0000"  >&lt;p&gt;mmmhhh.&lt;/p&gt;

&lt;p&gt;I just added this into openwire/v6/BrokerInfoMarshaller.java&lt;/p&gt;

&lt;p&gt;    public void tightUnmarshal(OpenWireFormat wireFormat, Object o, DataInput dataIn, BooleanStream bs) throws IOException {&lt;br/&gt;
        super.tightUnmarshal(wireFormat, o, dataIn, bs);&lt;/p&gt;

&lt;p&gt;        BrokerInfo info = (BrokerInfo)o;&lt;br/&gt;
        info.setBrokerId((org.apache.activemq.command.BrokerId) tightUnmarsalCachedObject(wireFormat, dataIn, bs));&lt;br/&gt;
        info.setBrokerURL(tightUnmarshalString(dataIn, bs));&lt;/p&gt;

&lt;p&gt;        if (bs.readBoolean()) {&lt;br/&gt;
            short size = dataIn.readShort();&lt;br/&gt;
            org.apache.activemq.command.BrokerInfo value[] = new org.apache.activemq.command.BrokerInfo&lt;span class=&quot;error&quot;&gt;&amp;#91;size&amp;#93;&lt;/span&gt;;&lt;br/&gt;
            for( int i=0; i &amp;lt; size; i++ ) &lt;/p&gt;
{


                System.out.println(&quot;Nouveau sous-niveau : i = &quot; + (i+1) +  &quot;/(size = &quot; + size + &quot;)&quot;);

                value[i] = (org.apache.activemq.command.BrokerInfo) tightUnmarsalNestedObject(wireFormat,dataIn, bs);

                System.out.println(&quot;Fin du sous-niveau : i = &quot; + (i+1) +  &quot;/(size = &quot; + size + &quot;)&quot;);
            }
&lt;p&gt;            info.setPeerBrokerInfos(value);&lt;br/&gt;
        }&lt;br/&gt;
        else &lt;/p&gt;
{
            info.setPeerBrokerInfos(null);
        }

&lt;p&gt;/* Eric Vincent remplacement 3 lignes a la place de la ligne suivante */&lt;br/&gt;
        String brokerName = tightUnmarshalString(dataIn, bs);&lt;br/&gt;
        System.out.println(&quot;BrokerInfo / BrokerName = &quot; + brokerName);&lt;br/&gt;
        info.setBrokerName(brokerName);&lt;/p&gt;

&lt;p&gt;/* Eric Vincent&lt;br/&gt;
        info.setBrokerName(tightUnmarshalString(dataIn, bs));&lt;br/&gt;
*/&lt;br/&gt;
        info.setSlaveBroker(bs.readBoolean());&lt;br/&gt;
        info.setMasterBroker(bs.readBoolean());&lt;br/&gt;
        info.setFaultTolerantConfiguration(bs.readBoolean());&lt;br/&gt;
        info.setDuplexConnection(bs.readBoolean());&lt;br/&gt;
        info.setNetworkConnection(bs.readBoolean());&lt;br/&gt;
        info.setConnectionId(tightUnmarshalLong(wireFormat, dataIn, bs));&lt;br/&gt;
        info.setBrokerUploadUrl(tightUnmarshalString(dataIn, bs));&lt;br/&gt;
        info.setNetworkProperties(tightUnmarshalString(dataIn, bs));&lt;/p&gt;

&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;And you will find in the log file I put into this thread, what I get with no more than 9 embedded brokers (4 sibBusModule, 1 busSupervisor, 2 servers) on 4 servers (td0sib&lt;span class=&quot;error&quot;&gt;&amp;#91;01,02&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;s,v&amp;#93;&lt;/span&gt; that are connected togethers with different network of brokers or direct connections.&lt;/p&gt;

&lt;p&gt;I think that the current algorithm (without any level constraint) is not good at all for ActiveMQ global scalability.&lt;/p&gt;

&lt;p&gt;I will try to change something, but I don&apos;t know exactly why it is necessary that each broker knows the global connection hierarchy beyond the first level... And when there are loops, I don&apos;t know what could happen ....&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;
</comment>
                            <comment id="12972120" author="eric-awl" created="Thu, 16 Dec 2010 15:45:21 +0000"  >&lt;p&gt;the result of the launch of an embedded broker (sibBusModule-TestDeCharge-td0sib01s) &lt;/p&gt;

&lt;p&gt;when &quot;busModule is alive&quot;, the jms connect to the embedded broker is OK &lt;/p&gt;</comment>
                            <comment id="12972404" author="eric-awl" created="Fri, 17 Dec 2010 09:16:37 +0000"  >&lt;p&gt;I forgot to say that all these brokers are not in the same network of brokers.&lt;/p&gt;

&lt;p&gt;SIBBusModules brokers have similar activemq.xml configurations&lt;br/&gt;
Serveur brokers have similar activemq.xml configurations&lt;br/&gt;
SibBusSupervisor broker has a specific activemq.xml configuration.&lt;/p&gt;
</comment>
                            <comment id="12972406" author="eric-awl" created="Fri, 17 Dec 2010 09:21:49 +0000"  >&lt;p&gt;3 activemq.xml attached.&lt;/p&gt;</comment>
                            <comment id="12972415" author="eric-awl" created="Fri, 17 Dec 2010 09:39:02 +0000"  >&lt;p&gt;If this important change was made only to provide the &quot;automatic dynamic failover&quot; capability, it seems that a new concept (failover brokers with a specific discovery process) should be implemented instead of using standard network of brokers implementation....&lt;/p&gt;

&lt;p&gt;Perhaps, it should be better to add a parameter in network of brokers definition, that specify that a network of brokers is dedicated for failover capability, and use a &quot;ConcurrentHashMap&amp;lt;String, BrokerInfo[]&amp;gt; peerBrokers&quot; in brokerInfo structure (String = the name of the network of broker) instead of a simple peerBrokers[] array ????&lt;/p&gt;

&lt;p&gt;The problem is then completely different....&lt;/p&gt;

&lt;p&gt;bsm.log shows us that on a small environment, we can receive a very big &quot;BrokerInfo&quot; message with doubles and potential loops. Our production environment is far more complex than this.  I&apos;m quite convinced that it&apos;s why we get this &quot;ArrayOutOfBoundsException&quot; issue. (We have more than 262000 boolean values to code in the same BrokerInfo structure).&lt;/p&gt;

&lt;p&gt;Unfortunately, I will be forced to indicate to production environment that we can not use the 5.4 version. It&apos;s a big problem for us, since I already added a patch for duplex network of brokers in 5.3.2 that is now integrated in 5.4 .&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;</comment>
                            <comment id="12972475" author="eric-awl" created="Fri, 17 Dec 2010 13:06:26 +0000"  >&lt;p&gt;Is this an acceptable workaround, if I add in TransportConnection.java the condition below :&lt;/p&gt;


&lt;p&gt;BrokerInfo info = connector.getBrokerInfo().copy();&lt;/p&gt;

&lt;p&gt;if (this.connector.isUpdateClusterClients())&lt;br/&gt;
              info.setPeerBrokerInfos(this.broker.getPeerBrokerInfos());&lt;/p&gt;

&lt;p&gt;dispatchAsync(info);&lt;/p&gt;

&lt;p&gt;and tests it with Maven Tests to verify regressions ?&lt;/p&gt;

&lt;p&gt;By this way, if the transport connector is not used for automatic failover purpose (this is the default), it will not export its own peer brokers.&lt;/p&gt;

&lt;p&gt;Since I don&apos;t use this 5.4 new failover function, I think it will resolve our problem on our complex network of brokers architecture (with exchanges of too big brokerInfo objects), without changing anything for those who now want to use it ...&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;</comment>
                            <comment id="12972482" author="gtully" created="Fri, 17 Dec 2010 13:46:32 +0000"  >&lt;p&gt;yes, I think the behavior should be conditional on isUpdateClusterClients, the other place that that condition should be checked is in org.apache.activemq.broker.TransportConnector#getConnectionControl() before the peer brokers are added to the connectedBrokers string, such that the info is only passed to clients if needed.&lt;/p&gt;

&lt;p&gt;See previous comment and related issue ref: &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-3077?focusedCommentId=12971673&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12971673&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-3077?focusedCommentId=12971673&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12971673&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;A patch, validated with mvn clean test in activemq-core would be great.&lt;/p&gt;

&lt;p&gt;When that feature is enabled, we need to weed out duplicates from the list to ensure the list does not grow in cyclic networks. &lt;/p&gt;</comment>
                            <comment id="12972495" author="eric-awl" created="Fri, 17 Dec 2010 14:39:06 +0000"  >&lt;p&gt;Ok. &lt;/p&gt;

&lt;p&gt;I just changed the 2 places by adding the condition (isUpdateClusterClients()) and did a small test with my own traces. There are no longer a hierarchy of brokerInfo daughter structures, just the connected broker brokerInfo structure brokerName is written on standard output.&lt;/p&gt;

&lt;p&gt;I will ask Jean-Marcel to patch our &quot;big qualify environment&quot; to validate that there is no longer ArrayOutOfBoundsException .&lt;/p&gt;

&lt;p&gt;If maven tests are OK with these 2 small changes, do you consider that these 2 additional conditions will be integrated into future versions without any needs to program a specific new test to demonstrate anymore the problem ?&lt;/p&gt;</comment>
                            <comment id="12972528" author="gtully" created="Fri, 17 Dec 2010 15:49:00 +0000"  >&lt;p&gt;a test is the only way to protect your changes into the future. So I think a test is necessary. Think of it as an insurance policy to protect your use case, worth the premium of time that it takes to write.&lt;/p&gt;</comment>
                            <comment id="12972529" author="eric-awl" created="Fri, 17 Dec 2010 15:55:42 +0000"  >&lt;p&gt;What is the simplest way to simulate a complex network of brokers situation in a small test ? (one JVM that launches X embedded brokers with one transport connector and the corresponding multicast network connector ?)&lt;/p&gt;

&lt;p&gt;Is there an existing JUnit test that I can use as an initial pattern ?&lt;/p&gt;</comment>
                            <comment id="12972589" author="gtully" created="Fri, 17 Dec 2010 18:46:40 +0000"  >&lt;p&gt;something like org.apache.activemq.usecases.ThreeBrokerQueueNetworkTest is what you need. There are a bunch of tests that extend org.apache.activemq.JmsMultipleBrokersTestSupport to do that sort of thing.&lt;/p&gt;</comment>
                            <comment id="12973191" author="eric-awl" created="Mon, 20 Dec 2010 13:23:14 +0000"  >&lt;p&gt;Patch (TransportConnection.java + TransportConnector.java) + test (20 brokers with specific stop/start)&lt;/p&gt;</comment>
                            <comment id="12973192" author="eric-awl" created="Mon, 20 Dec 2010 13:27:09 +0000"  >&lt;p&gt;The patch consists in adding 2 conditions (isUpdateClusterClient()) on the BrokerInfo structure sent.&lt;/p&gt;

&lt;p&gt;The test consists in&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;starting 20 brokers with a transport connector and a network connector in a way all brokers are connected to the 19 other ones.&lt;/li&gt;
	&lt;li&gt;stopping the 10 first ones&lt;/li&gt;
	&lt;li&gt;restarting the 10 first ones.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Without the patch, the &quot;arrayOutOfBoundsException&quot; is raised during the 10 first ones are restarted  (loop ?).&lt;/p&gt;

&lt;p&gt;This patch is just a workaround to be compatible with 5.3 version usage, and not a final solution of the identified problem&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;</comment>
                            <comment id="12974601" author="eric-awl" created="Thu, 23 Dec 2010 11:03:55 +0000"  >&lt;p&gt;Hi Gary&lt;/p&gt;

&lt;p&gt;Do you have some news for me about this problem after I provided a patch and a JUnit Test ? &lt;/p&gt;

&lt;p&gt;Thank you&lt;br/&gt;
Eric-AWL&lt;/p&gt;</comment>
                            <comment id="12977669" author="eric-awl" created="Wed, 5 Jan 2011 08:02:36 +0000"  >&lt;p&gt;Hi Gary&lt;/p&gt;

&lt;p&gt;I wish you an happy new year. How can we progress together on this particular subject ? We use this patch on our test environment, and don&apos;t get anymore exceptions.&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;</comment>
                            <comment id="12977710" author="gtully" created="Wed, 5 Jan 2011 10:09:00 +0000"  >&lt;p&gt;hny to you too. next step is to review your changes and test, then integrate them. I will hopefully get some time to do this in the next few days.&lt;/p&gt;</comment>
                            <comment id="12980787" author="eric-awl" created="Wed, 12 Jan 2011 16:34:17 +0000"  >&lt;p&gt;Hi Gary&lt;/p&gt;

&lt;p&gt;No news ?&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;</comment>
                            <comment id="12980806" author="gtully" created="Wed, 12 Jan 2011 16:56:48 +0000"  >&lt;p&gt;I was able to reproduce the issue from your test, thanks. I am working on the fix. Part of the problem is that the peer broker info is duplicated on each networked broker. The other issue is that the peerBrokerInfo needs to be cleared before a list of peer brokers is created for propagation to a client or to a peer, as the second level information is not relevant at the moment.&lt;br/&gt;
Some of my tests are showing blocking with duplex network connector start and I want to get to the bottom of that before progressing further.&lt;/p&gt;</comment>
                            <comment id="12980819" author="eric-awl" created="Wed, 12 Jan 2011 17:31:28 +0000"  >&lt;p&gt;Thank you for your information. I think this will be difficult to fully resolve since automatic failover cluster group concept is ambitious in architecture that is complex as ours  (with loops and a lot of connected brokers in duplex and non duplex).&lt;/p&gt;

&lt;p&gt;Don&apos;t you think a specific new &quot;dedicated failover network of brokers&quot; (with discover mechanism) concept different from &quot;duplex/non duplex network of brokers&quot; used for scalability and role isolation, wouldn&apos;t be more easier to manage and program (instead of propagating the full network of brokers topology to each broker and associate them all, a role as potential failover broker)  ? So, failover and scalability/isolation problems would be totally distinguished.&lt;/p&gt;

&lt;p&gt;All my brokers connected in my different network of brokers, have not the same role. So, in my architecture with a lot of brokers, even if I wanted to use failover, it should be good for me that I could decide by a dedicated discovery rule, what brokers in the global network of brokers, can be chosen as failover broker,and this, for each specific client to broker connection.&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;</comment>
                            <comment id="12980828" author="gtully" created="Wed, 12 Jan 2011 17:50:12 +0000"  >&lt;p&gt;I agree. There is a bunch of relevant configuration around the cluster update feature, filters etc and it is configurable per transport connector. Also, the fact that currently the entire topology is propagated is wrong, part of the fix will limit the information to a single level.&lt;/p&gt;</comment>
                            <comment id="12981258" author="gtully" created="Thu, 13 Jan 2011 14:26:12 +0000"  >&lt;p&gt;fix in r1058577&lt;/p&gt;

&lt;p&gt;Fixed issue with duplication and size of collected peer broker info that was propagated around a network.&lt;br/&gt;
In a network a peer is the other end of a network bridge, such that a consumer can connect to it to get a chance at the same destinations. It is not a real peer ( as in a two way association) unless the network is duplex or there is another bridge in the opposite direction.&lt;br/&gt;
This is relevant for &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2632&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-2632&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12981261" author="gtully" created="Thu, 13 Jan 2011 14:28:50 +0000"  >&lt;p&gt;RE: Link as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-2632&quot; title=&quot;Update client connections with information about a cluster of networked brokers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-2632&quot;&gt;&lt;del&gt;AMQ-2632&lt;/del&gt;&lt;/a&gt;: These fixes ensure that transport connector config (setRebalanceClusterClients, setUpdateClusterClients) is respected for cluster updates.&lt;br/&gt;
Also of note is the fact that the cluster members respect the oneway nature of a network connector (demand forwarding bridge). &lt;/p&gt;</comment>
                            <comment id="12981295" author="eric-awl" created="Thu, 13 Jan 2011 15:50:35 +0000"  >&lt;p&gt;Hi Gary&lt;/p&gt;

&lt;p&gt;Thank you very much.&lt;/p&gt;

&lt;p&gt;I don&apos;t fully understand. Do you mean, that there is a risk that problems appear with network of brokers with Duplex connections ?&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;</comment>
                            <comment id="12981296" author="gtully" created="Thu, 13 Jan 2011 15:54:10 +0000"  >&lt;p&gt;no, what do u not understand?&lt;/p&gt;</comment>
                            <comment id="12981314" author="eric-awl" created="Thu, 13 Jan 2011 16:23:24 +0000"  >&lt;p&gt;We use ActiveMQ brokers with complex configuration (now we have around 50 brokers in production on 2 sites for a french electricity provider smart-meter project. Our final goal is between 100 and 1000 brokers on several sites, connected by several different network of brokers).&lt;/p&gt;

&lt;p&gt;In some cases, we want to use duplex configuration : when there is an identified &quot;client broker&quot; that connects to an &quot;applicative service provider broker&quot; (example an &quot;SMS gateway&quot; that sends SMS to SMS operator and asynchronously send SMS corresponding notifications to client application) &lt;/p&gt;

&lt;p&gt;And in some other cases, we want to use two single half-duplex configurations (when the two brokers are simultaneously client and provider for some parts of a global applicative service).&lt;/p&gt;

&lt;p&gt;My original test only showed that 20 brokers with 2 half-duplex configurations didn&apos;t work. The original test didn&apos;t try with duplex connections : a loop in peers configuration was created with 2 half-duplex connections, and this loop was the easier way to generate such exception for the test.&lt;/p&gt;

&lt;p&gt;In production environment now, we only use 2 half-duplex connections everywhere (for our 50 brokers) with 5.3.2 version. &lt;/p&gt;

&lt;p&gt;We want to be able to use duplex connections, but a bug was discovered with duplex connections and &quot;not straight&quot; network outages (we corrected this bug together some months ago). So we looked for a stable 5.4 version ...&lt;/p&gt;

&lt;p&gt;We won&apos;t use at all failover mechanism since (and to resume), all application has its own embedded broker.&lt;/p&gt;

&lt;p&gt;Thank you.&lt;br/&gt;
Eric-AWL&lt;/p&gt;</comment>
                            <comment id="12981365" author="gtully" created="Thu, 13 Jan 2011 16:55:20 +0000"  >&lt;p&gt;Try a test with duplex connections to be sure, but I think you will be fine now.&lt;/p&gt;</comment>
                            <comment id="12981675" author="eric-awl" created="Fri, 14 Jan 2011 08:32:45 +0000"  >&lt;p&gt;Does the 5.5-SNAPSHOT (download page) compiled today (January 14th), include the correction ?&lt;/p&gt;</comment>
                            <comment id="12981695" author="gtully" created="Fri, 14 Jan 2011 09:58:54 +0000"  >&lt;p&gt;yes.&lt;/p&gt;</comment>
                            <comment id="12988536" author="johnkidd" created="Sun, 30 Jan 2011 03:46:56 +0000"  >&lt;p&gt;we are seeing this issue in production with 5.4.2. We have a network of brokers consisting of about 20 broker instances. What is the side effect of this issue? Lost data? Brokers dropped out of the broker network permanently?&lt;/p&gt;

&lt;p&gt;Thanks for any comments.&lt;/p&gt;</comment>
                            <comment id="13006454" author="ratman" created="Mon, 14 Mar 2011 15:06:55 +0000"  >&lt;p&gt;Hi guys,&lt;br/&gt;
I have the same problem using AMQ 5.4.2 on my production environment.&lt;br/&gt;
Is this problem critical? What are the side effects?&lt;br/&gt;
I can&apos;t use AMQ RC 5.5 in production.&lt;br/&gt;
Any suggestions?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13006826" author="eric-awl" created="Tue, 15 Mar 2011 08:02:09 +0000"  >&lt;p&gt;Hi&lt;/p&gt;

&lt;p&gt;The problem could appear if you have a loop in your network of brokers topology. If it is not the case, it is likely that you won&apos;t be impacted at all.&lt;/p&gt;

&lt;p&gt;Eric-AWL&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12483854">AMQ-2632</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12466628" name="NetworkOfTwentyBrokersTest.java" size="4581" author="eric-awl" created="Mon, 20 Dec 2010 13:23:14 +0000"/>
                            <attachment id="12466626" name="TransportConnection.java" size="58047" author="eric-awl" created="Mon, 20 Dec 2010 13:23:14 +0000"/>
                            <attachment id="12466627" name="TransportConnector.java" size="18357" author="eric-awl" created="Mon, 20 Dec 2010 13:23:14 +0000"/>
                            <attachment id="12466453" name="activemq_SIBBusModule.xml" size="4739" author="eric-awl" created="Fri, 17 Dec 2010 09:21:49 +0000"/>
                            <attachment id="12466454" name="activemq_SIBBusSupervisor.xml" size="13781" author="eric-awl" created="Fri, 17 Dec 2010 09:21:49 +0000"/>
                            <attachment id="12466452" name="activemq_Serveur.xml" size="3641" author="eric-awl" created="Fri, 17 Dec 2010 09:21:49 +0000"/>
                            <attachment id="12466389" name="bsm.log" size="23277" author="eric-awl" created="Thu, 16 Dec 2010 15:45:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14705</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0agxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59016</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>