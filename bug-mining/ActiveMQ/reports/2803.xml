<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:34:27 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-6218] Message content returns null occasionally from Virtual Topic to the consumer</title>
                <link>https://issues.apache.org/jira/browse/AMQ-6218</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;I have 1 Virtual Topic and 40 Consumer to consume the messages sent by the topic. The problem is when I am sending thousands of Messages lets say 10000 via Virtual Topic I have noticed that 2 or 3 consumer are getting null as a text when I do message.getText(), but virtual topic is not sending a null as a text message if it so then all 40 consumer should report same.&lt;/p&gt;

&lt;p&gt;I have also noticed this problem is not happening in AMQ v5.11 or with levelDB in AMQ v5.12.2/5.13.2. It is happening only in when you use kahaDB with AMQ v5.12.2/5.13.2&lt;/p&gt;</description>
                <environment></environment>
        <key id="12951170">AMQ-6218</key>
            <summary>Message content returns null occasionally from Virtual Topic to the consumer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cshannon">Christopher L. Shannon</assignee>
                                    <reporter username="rohitsonawat@gmail.com">Rohit Sonawat</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Mar 2016 12:33:15 +0000</created>
                <updated>Tue, 14 Jun 2016 14:37:52 +0000</updated>
                            <resolved>Mon, 21 Mar 2016 19:58:44 +0000</resolved>
                                    <version>5.12.2</version>
                    <version>5.13.2</version>
                                    <fixVersion>5.13.3</fixVersion>
                    <fixVersion>5.14.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="15199423" author="rohitsonawat@gmail.com" created="Thu, 17 Mar 2016 12:37:09 +0000"  >&lt;p&gt;Attached sample Java code that used to replicate the issue with actual log generated by the same. And i used default configuration provided in activemq.xml &lt;/p&gt;
</comment>
                            <comment id="15202243" author="tabish121" created="Fri, 18 Mar 2016 22:02:28 +0000"  >&lt;p&gt;Converted app based test to a JUnit test.  Can reproduce on a loaded system if the VM transport is used but does not reproduce on the TCP transport.  &lt;/p&gt;</comment>
                            <comment id="15204959" author="jira-bot" created="Mon, 21 Mar 2016 19:40:56 +0000"  >&lt;p&gt;Commit ea09159a4087212964787e7cf68ef30170d115f0 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ea09159&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ea09159&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6218&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6218&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing copy method of ActiveMQTextMessage to prevent a race condition&lt;br/&gt;
when concurrent store and dispatch is used with Queues&lt;/p&gt;

&lt;p&gt;We may need explicity synchronization between the text and content fields&lt;br/&gt;
in the future if other issues pop up&lt;/p&gt;</comment>
                            <comment id="15204961" author="jira-bot" created="Mon, 21 Mar 2016 19:42:41 +0000"  >&lt;p&gt;Commit 93bc7030e263d6ed5bab7b778b15d50d46fe2c66 in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=93bc703&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=93bc703&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6218&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6218&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Fixing copy method of ActiveMQTextMessage to prevent a race condition&lt;br/&gt;
when concurrent store and dispatch is used with Queues&lt;/p&gt;

&lt;p&gt;We may need explicity synchronization between the text and content fields&lt;br/&gt;
in the future if other issues pop up&lt;/p&gt;

&lt;p&gt;(cherry picked from commit ea09159a4087212964787e7cf68ef30170d115f0)&lt;/p&gt;</comment>
                            <comment id="15204986" author="christopher.l.shannon" created="Mon, 21 Mar 2016 19:58:45 +0000"  >&lt;p&gt;There was a race condition when using concurrent store and dispatch for queues.  The issue is that KahaDB calls beoreMarshall() when storing which then calls storeContentAndClear() on the message which clears out the text field.  With concurrent store and dispatch on this can cause both content and text to end up null if the marshalling happens at the same time the message is being copied in another thread.  &lt;/p&gt;

&lt;p&gt;I fixed this by grabbing a copy of the text before the rest of the copy method is called and then using that as the value.  The other methods in ActiveMQTextMessage follow a similar pattern of grabbing local references of the text and content fields to try and minimize other threads from interfering.&lt;/p&gt;

&lt;p&gt;I did not add synchronization to prevent a performance hit but If other issues pop up we might need to explicitly synchronize access on those two fields in a future version to prevent other race conditions.&lt;/p&gt;</comment>
                            <comment id="15207050" author="christopher.l.shannon" created="Tue, 22 Mar 2016 18:58:58 +0000"  >&lt;p&gt;A new fix has been applied as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6221&quot; title=&quot;ActiveMQTextMessage should synchronize on state changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6221&quot;&gt;&lt;del&gt;AMQ-6221&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15242921" author="jira-bot" created="Fri, 15 Apr 2016 13:02:45 +0000"  >&lt;p&gt;Commit 9c929b6870ae4c19cf4f227fa13472b09ebac729 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9c929b6&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=9c929b6&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;https://issues.apache.org/jira/browse/AMQ-6218&quot;&lt;/p&gt;

&lt;p&gt;Reverting commit in favor of a better approach&lt;/p&gt;

&lt;p&gt;This reverts commit ea09159a4087212964787e7cf68ef30170d115f0.&lt;/p&gt;</comment>
                            <comment id="15242927" author="jira-bot" created="Fri, 15 Apr 2016 13:07:05 +0000"  >&lt;p&gt;Commit 4a3fa320e75870cef83f46ab125eda0dfc0cc69f in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cshannon&quot; class=&quot;user-hover&quot; rel=&quot;cshannon&quot;&gt;cshannon&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4a3fa32&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=4a3fa32&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Revert &quot;https://issues.apache.org/jira/browse/AMQ-6218&quot;&lt;/p&gt;

&lt;p&gt;This reverts commit 93bc7030e263d6ed5bab7b778b15d50d46fe2c66.&lt;/p&gt;</comment>
                            <comment id="15242934" author="christopher.l.shannon" created="Fri, 15 Apr 2016 13:08:40 +0000"  >&lt;p&gt;The proper fix is now part of &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6256&quot; title=&quot;ConcurentStoreAndDispatch can lead to inconsistent message states using VM Transport&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-6256&quot;&gt;&lt;del&gt;AMQ-6256&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12952465">AMQ-6221</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12959158">AMQ-6256</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12978816">AMQ-6323</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12794266" name="AMQ6218Test.java" size="8228" author="tabish" created="Fri, 18 Mar 2016 22:02:28 +0000"/>
                            <attachment id="12793968" name="App.java" size="4647" author="rohitsonawat@gmail.com" created="Thu, 17 Mar 2016 12:37:08 +0000"/>
                            <attachment id="12793969" name="Full app.log" size="9577234" author="rohitsonawat@gmail.com" created="Thu, 17 Mar 2016 12:37:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311020" key="com.atlassian.jira.plugin.system.customfieldtypes:url">
                        <customfieldname>External issue URL</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[http://activemq.2283324.n4.nabble.com/Message-content-returns-null-occasionally-from-Virtual-Topic-to-the-consumer-td4709151.html]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2utlb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>