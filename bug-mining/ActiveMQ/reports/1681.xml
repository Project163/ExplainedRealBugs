<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:56:56 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4033] AMQ Broker - Uses custom RMIServerSocketFactory class which cannot be unloaded due socket reuse</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4033</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When embedding ActiveMQ Broker in a container, such as Tomcat or others. And if you have JMX enabled on the broker, then a RMI registry is created to allow JMX/RMI over TCP.&lt;/p&gt;

&lt;p&gt;This uses a custom RMIServerSocketFactory that gets enlisted into the JDK RMI registry. But when you undeploy the AMQ broker, there is no API in the JDK to unregister your custom RMIServerSocketFactory class.&lt;/p&gt;

&lt;p&gt;And therefore the JDK (system class) has a strong reference to the custom RMIServerSocketFactory, which prevents the container classloader to fully unload all classes.&lt;/p&gt;

&lt;p&gt;Disabling JMX on the broker, allows to unload all the classes.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12606761">AMQ-4033</key>
            <summary>AMQ Broker - Uses custom RMIServerSocketFactory class which cannot be unloaded due socket reuse</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10101">Abandoned</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="davsclaus">Claus Ibsen</reporter>
                        <labels>
                    </labels>
                <created>Sun, 9 Sep 2012 08:38:05 +0000</created>
                <updated>Sun, 13 Mar 2022 14:08:03 +0000</updated>
                            <resolved>Sun, 13 Mar 2022 14:08:03 +0000</resolved>
                                    <version>5.6.0</version>
                                    <fixVersion>NEEDS_REVIEW</fixVersion>
                                    <component>Broker</component>
                    <component>JMX</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13451893" author="davsclaus" created="Mon, 10 Sep 2012 11:16:25 +0000"  >&lt;p&gt;The class com.sun.rmi.transports.tcp.TCPEndpoint is having a strong reference to the org.apache.activemq.broker.jmx.ManagementContext$2 class, which is that factory class.  There is no API to unregister this factory class.&lt;/p&gt;</comment>
                            <comment id="13451896" author="davsclaus" created="Mon, 10 Sep 2012 11:30:55 +0000"  >&lt;p&gt;If we remove the custom server socket factory, then there is no issues.&lt;/p&gt;

&lt;p&gt;eg this code instead&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    registry = LocateRegistry.createRegistry(connectorPort);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13451899" author="davsclaus" created="Mon, 10 Sep 2012 11:33:23 +0000"  >&lt;p&gt;Its this commit which introduced the custom factory&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=833376&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/viewvc?view=revision&amp;amp;revision=833376&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13451908" author="gtully" created="Mon, 10 Sep 2012 11:45:49 +0000"  >&lt;p&gt;I think it is safe to remove that soReuseAddr, I am not convinced that it is really a problem for the ci builds. If it proves to be, we can pull it back in conditionally.&lt;br/&gt;
We know now it is a problem for embedded brokers.&lt;/p&gt;</comment>
                            <comment id="13483201" author="gtully" created="Wed, 24 Oct 2012 13:05:22 +0000"  >&lt;p&gt;one thought on this. In an embedded case, where there is a third party container. the broker is best reusing the jvms mbean server rather than creating its own. Or reusing the mbean server provided by the container. It is just less moving parts.&lt;br/&gt;
So managementContext.createMBeanServer=false should be used&lt;/p&gt;</comment>
                            <comment id="13654588" author="aogail" created="Fri, 10 May 2013 16:36:53 +0000"  >&lt;p&gt;It looks like the fix for this issue undid the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-3915&quot; title=&quot;JMX connector does not bind to a specific host when a connectHost is specified on the managementContext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-3915&quot;&gt;&lt;del&gt;AMQ-3915&lt;/del&gt;&lt;/a&gt;. You can see this at line 503 of: &lt;a href=&quot;https://fisheye6.atlassian.com/changelog/activemq?cs=1382852&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://fisheye6.atlassian.com/changelog/activemq?cs=1382852&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Was this intentional?&lt;/p&gt;</comment>
                            <comment id="13656981" author="gtully" created="Tue, 14 May 2013 11:43:13 +0000"  >&lt;p&gt;looks like we need to make the registration of a socketfactory conditional such that we can reinstate the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-3915&quot; title=&quot;JMX connector does not bind to a specific host when a connectHost is specified on the managementContext&quot; class=&quot;issue-link&quot; data-issue-key=&quot;AMQ-3915&quot;&gt;&lt;del&gt;AMQ-3915&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;maybe only use a socketfactory it if &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;connectorHost&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; is explicitly set. Folks running embedded will most probably (or should) be ussing the containers jmx mbean server.&lt;/p&gt;</comment>
                            <comment id="17505587" author="christopher.l.shannon" created="Sun, 13 Mar 2022 14:08:03 +0000"  >&lt;p&gt;Closing very old/abandoned jiras not updated in more than 7 years&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12518840">AMQ-3451</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12544451" name="MMC.png" size="108924" author="davsclaus" created="Mon, 10 Sep 2012 11:15:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249747</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 35 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ah93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>59068</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310080" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Regression</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10091"><![CDATA[Regression]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>