<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:04:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5144] stomp+nio+ssl very slow message sending</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5144</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;Hi there &lt;/p&gt;

&lt;p&gt;I have following broker config: &lt;/p&gt;

&lt;p&gt; &amp;lt;transportConnector name=&quot;stomp&quot; uri=&quot;stomp+nio+ssl://0.0.0.0:61612?maximumConnections=10000&amp;amp;wireFormat.maxFrameSize=104857600&quot;/&amp;gt;&lt;/p&gt;

&lt;p&gt;ACTIVEMQ_OPTS_MEMORY=&quot;-Xms1G -Xmx2G -Dorg.apache.activemq.UseDedicatedTaskRunner=false&quot;&lt;/p&gt;


&lt;p&gt;And followind code snippet:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; @Test
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void plainStompTest() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {


    StompConnection sender = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StompConnection();
    StompConnection receiver = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StompConnection();

    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;javax.net.ssl.keyStore&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/user/.keystore/client.ks&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;javax.net.ssl.trustStore&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;/home/user/.keystore/client.ts&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;javax.net.ssl.keyStorePassword&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;changeme&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.setProperty(&lt;span class=&quot;code-quote&quot;&gt;&quot;javax.net.ssl.trustStorePassword&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;changeme&quot;&lt;/span&gt;);

    SSLSocketFactory factory = (SSLSocketFactory) SSLSocketFactory.getDefault();
    SSLSocket sslsocket1 = (SSLSocket) factory.createSocket(&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;, 61612);
    SSLSocket sslsocket2 = (SSLSocket) factory.createSocket(&lt;span class=&quot;code-quote&quot;&gt;&quot;localhost&quot;&lt;/span&gt;, 61612);

    sender.open(sslsocket1);
    receiver.open(sslsocket2);

    sender.connect(&lt;span class=&quot;code-quote&quot;&gt;&quot;admin&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;admin&quot;&lt;/span&gt;);
    receiver.connect(&lt;span class=&quot;code-quote&quot;&gt;&quot;admin&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;admin&quot;&lt;/span&gt;);

    receiver.subscribe(&lt;span class=&quot;code-quote&quot;&gt;&quot;/queue/receiver&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000); &lt;span class=&quot;code-comment&quot;&gt;// wait until subscribed
&lt;/span&gt;
    &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;[] data = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;char&lt;/span&gt;[toSendBytesMsgSize];
    Arrays.fill(data, &lt;span class=&quot;code-quote&quot;&gt;&apos;a&apos;&lt;/span&gt;);

    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; startTime = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
    logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Sending message - size &quot;&lt;/span&gt; + toSendBytesMsgSize / 1024 + &lt;span class=&quot;code-quote&quot;&gt;&quot; kb&quot;&lt;/span&gt;);

    sender.send(&lt;span class=&quot;code-quote&quot;&gt;&quot;/queue/receiver&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;(data));
    StompFrame frame = receiver.receive(0);

    &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] body = frame.getBody().getBytes();

    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; stopTime = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; elapsedTime = stopTime - startTime;

    logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Reply received&quot;&lt;/span&gt;);

    logger.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Execution time = &quot;&lt;/span&gt; + elapsedTime / 1000 + &lt;span class=&quot;code-quote&quot;&gt;&quot; seconds&quot;&lt;/span&gt; + &lt;span class=&quot;code-quote&quot;&gt;&quot;[&quot;&lt;/span&gt; + elapsedTime + &lt;span class=&quot;code-quote&quot;&gt;&quot; ms]&quot;&lt;/span&gt;);

    assertEquals(toSendBytesMsgSize, body.length);


  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Results for stomp+ssl : &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Sending message - size 1000 kb
Reply received
 Execution time = 0 seconds[221 ms]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Results for stomp+nio :  (i modified test client to not use ssl socket)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Sending message - size 1000 kb
Reply received
 Execution time = 0 seconds[399 ms]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Results for stomp+nio+ssl : &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Sending message - size 1000 kb
Reply received
Execution time = 54 seconds[54162 ms]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;So from above we see that for stomp+nio+ssl it takes very long time to send a message. &lt;/p&gt;

&lt;p&gt;Anyone knows whats wrong ?&lt;/p&gt;
</description>
                <environment>&lt;p&gt;Linux  3.11.0-15-generic #23-Ubuntu SMP Mon Dec 9 18:17:04 UTC 2013 x86_64 x86_64 x86_64 GNU/Linuxjava version &quot;1.7.0_45&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.7.0_45-b18)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 24.45-b08, mixed mode&lt;/p&gt;</environment>
        <key id="12708258">AMQ-5144</key>
            <summary>stomp+nio+ssl very slow message sending</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="kibibyte">B</reporter>
                        <labels>
                    </labels>
                <created>Mon, 14 Apr 2014 13:30:43 +0000</created>
                <updated>Thu, 8 May 2014 16:58:07 +0000</updated>
                            <resolved>Thu, 8 May 2014 16:58:07 +0000</resolved>
                                    <version>5.9.0</version>
                                    <fixVersion>5.10.0</fixVersion>
                                    <component>STOMP</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13983457" author="tabish121" created="Mon, 28 Apr 2014 19:45:12 +0000"  >&lt;p&gt;Have you tried using a profiler to see where the time is being spent on the stomp+nio+ssl case vs the others, perhaps that will shed some light on things.  &lt;/p&gt;</comment>
                            <comment id="13989912" author="tabish121" created="Mon, 5 May 2014 19:59:58 +0000"  >&lt;p&gt;I&apos;d recommend looking at the STOMP unit tests and trying to construct a little performance measuring test we can use to track this down.  &lt;/p&gt;</comment>
                            <comment id="13992922" author="tabish121" created="Thu, 8 May 2014 16:58:07 +0000"  >&lt;p&gt;Found the trouble spot and fixed it, should fix issues across all protocols with their NIO+SSL performance. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386581</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 28 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ulgn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>386845</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>