<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:00:33 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4634] Rar losing messages when there is a XA trx timeout (jboss)</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4634</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;ActiveMQ does a trx commit when there is a transaction timeout (EJBTransactionRolledbackException). In this way we are losing messages when there is any timeout.&lt;br/&gt;
We have seen that the activemq connections are enlist in XA.&lt;br/&gt;
The attribute transactionContext from ActiveMQSession class has the global transaction reference (xid) before calling the MDB (messageListener.onMessage(message)).&lt;br/&gt;
When the timeout is reached and the RuntimeException is throwned, the transactionContext losed the xid reference.&lt;br/&gt;
Later, when ActiveMQSession call the method transactionContext.isInXATransaction() the result is false because there is no xid reference.&lt;/p&gt;

&lt;p&gt;This situation only happened when the MDB calls other EJB (Stateless) with CMT - TransactionAttributeType.REQUIRES_NEW, and the exception is throwed inside the Stateless.&lt;/p&gt;


&lt;p&gt;I&apos;ve tried to reproduce this without calling the stateless ejb but it works well.&lt;br/&gt;
The ActiveMQSession class should retain the original transactionContext.&lt;/p&gt;
</description>
                <environment>&lt;p&gt;JBoss 6.1.&lt;br/&gt;
ActiveMQ 5.8.0 (also tested in 5.7.0 and 5.6.0) standalone mode.&lt;/p&gt;</environment>
        <key id="12657995">AMQ-4634</key>
            <summary>Rar losing messages when there is a XA trx timeout (jboss)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gtully">Gary Tully</assignee>
                                    <reporter username="gastonscapusio">Gaston Scapusio</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Jul 2013 13:04:04 +0000</created>
                <updated>Fri, 19 Jul 2013 09:07:03 +0000</updated>
                            <resolved>Fri, 19 Jul 2013 09:06:14 +0000</resolved>
                                    <version>5.6.0</version>
                    <version>5.7.0</version>
                    <version>5.8.0</version>
                                    <fixVersion>5.9.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="13709742" author="gastonscapusio" created="Tue, 16 Jul 2013 13:05:56 +0000"  >&lt;p&gt;JBoss server log&lt;/p&gt;</comment>
                            <comment id="13711637" author="gtully" created="Wed, 17 Jul 2013 21:17:40 +0000"  >&lt;p&gt;@Gaston I think your issue is fixed by &lt;a href=&quot;http://svn.apache.org/r1504279&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1504279&lt;/a&gt;&lt;br/&gt;
the only caveat is that my use case does not need a call to another ejb. The scenario was an MDB spending longer than the TM timeout in onMessage so that the CMT had aborted on its return from onMessage. That was enough to loose a message through an auto ack in a local transaction. All in error.&lt;/p&gt;

&lt;p&gt;Can you try out tonights snapshot to verify?&lt;br/&gt;
many thanks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13712520" author="gastonscapusio" created="Thu, 18 Jul 2013 17:23:27 +0000"  >&lt;p&gt;It&apos;s working!&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="13713468" author="gtully" created="Fri, 19 Jul 2013 09:06:14 +0000"  >&lt;p&gt;thanks for the verification.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12592542" name="logs.txt" size="8690" author="gastonscapusio" created="Tue, 16 Jul 2013 13:05:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>338189</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 18 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mbyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>338510</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>