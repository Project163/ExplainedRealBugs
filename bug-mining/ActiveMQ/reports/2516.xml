<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 06:09:12 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-5153] LevelDB does not store subscribedDestination for durable subscriptions</title>
                <link>https://issues.apache.org/jira/browse/AMQ-5153</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;LevelDB store does not save the subscribedDestination of the SubscriptionInfo for a durable subscription.  This is important because when a restart happens you have no clue if this durable subscription goes with the topic or to a different topic (because of wildcarding).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12709191">AMQ-5153</key>
            <summary>LevelDB does not store subscribedDestination for durable subscriptions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="badavis">Brian Davis</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Apr 2014 00:51:15 +0000</created>
                <updated>Tue, 19 Apr 2016 13:56:46 +0000</updated>
                            <resolved>Tue, 19 Apr 2016 13:55:40 +0000</resolved>
                                    <version>5.9.1</version>
                                    <fixVersion>5.13.3</fixVersion>
                    <fixVersion>5.14.0</fixVersion>
                                    <component>LevelDB</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>7</watches>
                                                                                                                <comments>
                            <comment id="14102252" author="tabish121" created="Tue, 19 Aug 2014 14:42:10 +0000"  >&lt;p&gt;Do you have a test case or some additional information that would help in investigating this issue?&lt;/p&gt;</comment>
                            <comment id="14103856" author="badavis" created="Wed, 20 Aug 2014 13:13:53 +0000"  >&lt;p&gt;Here is how to reproduce the issue:&lt;/p&gt;

&lt;p&gt;create a topic testing.durable.&amp;gt;&lt;br/&gt;
create a topic testing.durable.test&lt;br/&gt;
create a durable on testing.durable.&amp;gt;&lt;br/&gt;
create a different durable on testing.durable.test&lt;br/&gt;
send message to testing.durable.&amp;gt;&lt;/p&gt;

&lt;p&gt;restart broker&lt;/p&gt;

&lt;p&gt;when you look at the subscribers all durables are tied to testing.durable.test&lt;/p&gt;

&lt;p&gt;this happens because the consumers get added to all matching subscribers creating them in the LevelDB store, but because the store does not store the subscribedDestination on a restart levelDB loses the durable&apos;s real topic.&lt;/p&gt;
</comment>
                            <comment id="14103862" author="tabish121" created="Wed, 20 Aug 2014 13:28:25 +0000"  >&lt;p&gt;Recommend you create a unit test and try it against the latest release. &lt;/p&gt;</comment>
                            <comment id="14502946" author="ceposta" created="Mon, 20 Apr 2015 14:49:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=badavis&quot; class=&quot;user-hover&quot; rel=&quot;badavis&quot;&gt;badavis&lt;/a&gt; can you try on a more recent version?&lt;br/&gt;
I&apos;ve committed a unit test here: &lt;a href=&quot;https://github.com/apache/activemq/commit/01f56d0ca255852bf9c12b889abd8d1297a2b5a9&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/activemq/commit/01f56d0ca255852bf9c12b889abd8d1297a2b5a9&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;that shows this works correctly. If you can alter that unit test to show failure, then we can take a closer look.&lt;/p&gt;

&lt;p&gt;let us know!&lt;/p&gt;</comment>
                            <comment id="14512216" author="badavis" created="Sat, 25 Apr 2015 03:33:40 +0000"  >&lt;p&gt;I did not get enough time to go through your test and change it to show the issue.  I did go through what I did before and reproduced the bug.   I also think I know what is wrong with your test.&lt;/p&gt;

&lt;p&gt;If you do the steps I stated on a broker that you can restart (kill the process and bring back a new process) it will show the bug.  I did my test through the web console and the bug is still there on 5.11.1.  The key is restarting the broker.  I believe that is also the issue with your test.  You never get a new broker you reuse a broker, stopping  and starting it.  My guess is the LevelDBPersistentAdapter probably does not get rid of state on the stop of a broker and reuses that state on a start.&lt;/p&gt;

&lt;p&gt;Hope this helps.&lt;/p&gt;
</comment>
                            <comment id="15242615" author="osmanrafiq" created="Fri, 15 Apr 2016 08:04:06 +0000"  >&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;We are having an issue related (the same?) to the one &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=badavis&quot; class=&quot;user-hover&quot; rel=&quot;badavis&quot;&gt;badavis&lt;/a&gt; is describing on both ActiveMQ 5.11.1 and 5.12.2.&lt;/p&gt;

&lt;p&gt;From our loggings it seems that the Level DB adapter somehow replaces the &lt;b&gt;subscribedDestination&lt;/b&gt; field of SubscriptionInfo with the &lt;b&gt;desitnation&lt;/b&gt; field.&lt;br/&gt;
Before restart (what is being sent to LevelDB):&lt;br/&gt;
2016-04-14 15:23:21,601 | DEBUG | alphabet.a store adding subscription: SubscriptionInfo {&lt;b&gt;subscribedDestination = topic://alphabet.&amp;gt;, destination = topic://alphabet.a&lt;/b&gt;, clientId = CFH.BO.TCS, subscriptionName = alphabet.&amp;gt;, selector = null} | org.apache.activemq.store.LoggingTopicMessageStore | ActiveMQ Transport: tcp:///10.0.6.1:55924@61616&lt;/p&gt;

&lt;p&gt;After restart (what broker is reading back from LevelDB):&lt;br/&gt;
2016-04-14 15:24:15,774 | DEBUG | Restoring durable subscription: SubscriptionInfo {&lt;b&gt;subscribedDestination = topic://alphabet.a, destination = null&lt;/b&gt;, clientId = CFH.BO.TCS, subscriptionName = alphabet.&amp;gt;, selector = null} | org.apache.activemq.broker.region.TopicRegion&lt;/p&gt;

&lt;p&gt;I have attached an updated version of the previously mentioned unit test to  verify the issue hopefully.&lt;/p&gt;

&lt;p&gt;Note that the bug alone is not that severe as the TopicRegion correctly replaces the restored faulty subscription when reconnecting the durable subscriber. &lt;/p&gt;

&lt;p&gt;However, if the broker is being used with broker plugins (especially the authorization/authentication plugins) then the TopicRegion is not able to replace the faulty subscription and you end up having a ghost subscriber.&lt;/p&gt;</comment>
                            <comment id="15247775" author="jira-bot" created="Tue, 19 Apr 2016 13:54:23 +0000"  >&lt;p&gt;Commit b027e655538226b56f1fe277a426e0df41501fc6 in activemq&apos;s branch refs/heads/master from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=b027e65&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=b027e65&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5153&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5153&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6254&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6254&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Store the original subscribed destination along with the target&lt;br/&gt;
destination in the subscription info object to ensure that wildcard&lt;br/&gt;
subscriptions remain linked.  &lt;/p&gt;</comment>
                            <comment id="15247778" author="jira-bot" created="Tue, 19 Apr 2016 13:54:54 +0000"  >&lt;p&gt;Commit ad07ee4612bd537ad4a441464ded701d98b0fcc1 in activemq&apos;s branch refs/heads/activemq-5.13.x from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tabish121&quot; class=&quot;user-hover&quot; rel=&quot;tabish121&quot;&gt;tabish121&lt;/a&gt;&lt;br/&gt;
[ &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ad07ee4&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=activemq.git;h=ad07ee4&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-5153&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-5153&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/AMQ-6254&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/AMQ-6254&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Store the original subscribed destination along with the target&lt;br/&gt;
destination in the subscription info object to ensure that wildcard&lt;br/&gt;
subscriptions remain linked.&lt;br/&gt;
(cherry picked from commit b027e655538226b56f1fe277a426e0df41501fc6)&lt;/p&gt;</comment>
                            <comment id="15247783" author="tabish121" created="Tue, 19 Apr 2016 13:55:40 +0000"  >&lt;p&gt;New subscriptions will now properly store the subscribed destination&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12959106">AMQ-6254</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12798917" name="AMQ5153LevelDBSubscribedDestTest.java" size="4225" author="osmanrafiq" created="Fri, 15 Apr 2016 08:04:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>387514</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 31 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ur73:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>387776</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>