<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Wed Nov 12 05:59:21 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF Jira</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[AMQ-4513] Deadlock can occur on dispose of TempQueue that contains expired Messages</title>
                <link>https://issues.apache.org/jira/browse/AMQ-4513</link>
                <project id="12311210" key="AMQ">ActiveMQ Classic</project>
                    <description>&lt;p&gt;When a TempQueue is being torn down and it contains expired Messages its possible for a deadlock occurs if the advisory for expired Message or DLQd fires at the same time as another Destination is created on the Broker.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Found one Java-level deadlock:
=============================
&lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ Transport: tcp:&lt;span class=&quot;code-comment&quot;&gt;///127.0.0.1:53182@60490&quot;&lt;/span&gt;:
&lt;/span&gt;  waiting to lock monitor 0x00007f9630020c80 (object 0x00000007c4541ff0, a java.util.concurrent.ConcurrentHashMap),
  which is held by &lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ Transport: tcp:&lt;span class=&quot;code-comment&quot;&gt;///127.0.0.1:53158@60490&quot;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ Transport: tcp:&lt;span class=&quot;code-comment&quot;&gt;///127.0.0.1:53158@60490&quot;&lt;/span&gt;:
&lt;/span&gt;  waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ownable synchronizer 0x00000007c4600f98, (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync),
  which is held by &lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ Transport: tcp:&lt;span class=&quot;code-comment&quot;&gt;///127.0.0.1:53099@60490&quot;&lt;/span&gt;
&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ Transport: tcp:&lt;span class=&quot;code-comment&quot;&gt;///127.0.0.1:53099@60490&quot;&lt;/span&gt;:
&lt;/span&gt;  waiting to lock monitor 0x00007f9630020c80 (object 0x00000007c4541ff0, a java.util.concurrent.ConcurrentHashMap),
  which is held by &lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ Transport: tcp:&lt;span class=&quot;code-comment&quot;&gt;///127.0.0.1:53158@60490&quot;&lt;/span&gt;
&lt;/span&gt;
Java stack information &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the threads listed above:
===================================================
&lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ Transport: tcp:&lt;span class=&quot;code-comment&quot;&gt;///127.0.0.1:53182@60490&quot;&lt;/span&gt;:
&lt;/span&gt;	at org.apache.activemq.broker.region.RegionBroker.addDestination(RegionBroker.java:271)
	- waiting to lock &amp;lt;0x00000007c4541ff0&amp;gt; (a java.util.concurrent.ConcurrentHashMap)
	at org.apache.activemq.broker.region.RegionBroker.addDestinationInfo(RegionBroker.java:297)
	at org.apache.activemq.advisory.AdvisoryBroker.addDestinationInfo(AdvisoryBroker.java:189)
	at org.apache.activemq.broker.BrokerFilter.addDestinationInfo(BrokerFilter.java:217)
	at org.apache.activemq.broker.BrokerFilter.addDestinationInfo(BrokerFilter.java:217)
	at org.apache.activemq.broker.MutableBrokerFilter.addDestinationInfo(MutableBrokerFilter.java:223)
	at org.apache.activemq.broker.TransportConnection.processAddDestination(TransportConnection.java:527)
	at org.apache.activemq.command.DestinationInfo.visit(DestinationInfo.java:122)
	at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:329)
	at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:184)
	at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)
	at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)
	at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:288)
	at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)
	at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)
	at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:722)
&lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ Transport: tcp:&lt;span class=&quot;code-comment&quot;&gt;///127.0.0.1:53158@60490&quot;&lt;/span&gt;:
&lt;/span&gt;	at sun.misc.Unsafe.park(Native Method)
	- parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  &amp;lt;0x00000007c4600f98&amp;gt; (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)
	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:867)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1197)
	at java.util.concurrent.locks.ReentrantReadWriteLock$WriteLock.lock(ReentrantReadWriteLock.java:945)
	at org.apache.activemq.broker.region.AbstractRegion.addDestination(AbstractRegion.java:128)
	at org.apache.activemq.broker.region.RegionBroker.addDestination(RegionBroker.java:279)
	- locked &amp;lt;0x00000007c4541ff0&amp;gt; (a java.util.concurrent.ConcurrentHashMap)
	at org.apache.activemq.broker.region.RegionBroker.addDestinationInfo(RegionBroker.java:297)
	at org.apache.activemq.advisory.AdvisoryBroker.addDestinationInfo(AdvisoryBroker.java:189)
	at org.apache.activemq.broker.BrokerFilter.addDestinationInfo(BrokerFilter.java:217)
	at org.apache.activemq.broker.BrokerFilter.addDestinationInfo(BrokerFilter.java:217)
	at org.apache.activemq.broker.MutableBrokerFilter.addDestinationInfo(MutableBrokerFilter.java:223)
	at org.apache.activemq.broker.TransportConnection.processAddDestination(TransportConnection.java:527)
	at org.apache.activemq.command.DestinationInfo.visit(DestinationInfo.java:122)
	at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:329)
	at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:184)
	at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)
	at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)
	at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:288)
	at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)
	at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)
	at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:722)
&lt;span class=&quot;code-quote&quot;&gt;&quot;ActiveMQ Transport: tcp:&lt;span class=&quot;code-comment&quot;&gt;///127.0.0.1:53099@60490&quot;&lt;/span&gt;:
&lt;/span&gt;	at org.apache.activemq.broker.region.RegionBroker.addDestination(RegionBroker.java:271)
	- waiting to lock &amp;lt;0x00000007c4541ff0&amp;gt; (a java.util.concurrent.ConcurrentHashMap)
	at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:145)
	at org.apache.activemq.advisory.AdvisoryBroker.addDestination(AdvisoryBroker.java:174)
	at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:145)
	at org.apache.activemq.broker.BrokerFilter.addDestination(BrokerFilter.java:145)
	at org.apache.activemq.broker.MutableBrokerFilter.addDestination(MutableBrokerFilter.java:151)
	at org.apache.activemq.broker.region.RegionBroker.send(RegionBroker.java:389)
	at org.apache.activemq.broker.jmx.ManagedRegionBroker.send(ManagedRegionBroker.java:282)
	at org.apache.activemq.advisory.AdvisoryBroker.fireAdvisory(AdvisoryBroker.java:550)
	at org.apache.activemq.advisory.AdvisoryBroker.messageExpired(AdvisoryBroker.java:291)
	at org.apache.activemq.broker.BrokerFilter.messageExpired(BrokerFilter.java:257)
	at org.apache.activemq.broker.BrokerFilter.messageExpired(BrokerFilter.java:257)
	at org.apache.activemq.broker.MutableBrokerFilter.messageExpired(MutableBrokerFilter.java:269)
	at org.apache.activemq.broker.region.Queue.messageExpired(Queue.java:1793)
	at org.apache.activemq.broker.region.Queue.messageExpired(Queue.java:1786)
	at org.apache.activemq.broker.region.Queue.doPageInForDispatch(Queue.java:1911)
	at org.apache.activemq.broker.region.Queue.doPageIn(Queue.java:1854)
	at org.apache.activemq.broker.region.Queue.purge(Queue.java:1244)
	at org.apache.activemq.broker.region.TempQueue.dispose(TempQueue.java:95)
	at org.apache.activemq.broker.region.AbstractTempRegion.dispose(AbstractTempRegion.java:100)
	- locked &amp;lt;0x00000007c45a8718&amp;gt; (a org.apache.activemq.broker.jmx.ManagedTempQueueRegion)
	at org.apache.activemq.broker.region.AbstractRegion.removeDestination(AbstractRegion.java:216)
	at org.apache.activemq.broker.region.TempQueueRegion.removeDestination(TempQueueRegion.java:63)
	at org.apache.activemq.broker.jmx.ManagedTempQueueRegion.removeDestination(ManagedTempQueueRegion.java:63)
	at org.apache.activemq.broker.region.RegionBroker.removeDestination(RegionBroker.java:290)
	at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:149)
	at org.apache.activemq.advisory.AdvisoryBroker.removeDestination(AdvisoryBroker.java:202)
	at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:149)
	at org.apache.activemq.broker.BrokerFilter.removeDestination(BrokerFilter.java:149)
	at org.apache.activemq.broker.MutableBrokerFilter.removeDestination(MutableBrokerFilter.java:155)
	at org.apache.activemq.broker.TransportConnection.processRemoveConnection(TransportConnection.java:815)
	- locked &amp;lt;0x00000007c46b1168&amp;gt; (a org.apache.activemq.broker.jmx.ManagedTransportConnection)
	at org.apache.activemq.command.RemoveInfo.visit(RemoveInfo.java:72)
	at org.apache.activemq.broker.TransportConnection.service(TransportConnection.java:329)
	at org.apache.activemq.broker.TransportConnection$1.onCommand(TransportConnection.java:184)
	at org.apache.activemq.transport.MutexTransport.onCommand(MutexTransport.java:50)
	at org.apache.activemq.transport.WireFormatNegotiator.onCommand(WireFormatNegotiator.java:113)
	at org.apache.activemq.transport.AbstractInactivityMonitor.onCommand(AbstractInactivityMonitor.java:288)
	at org.apache.activemq.transport.TransportSupport.doConsume(TransportSupport.java:83)
	at org.apache.activemq.transport.tcp.TcpTransport.doRun(TcpTransport.java:214)
	at org.apache.activemq.transport.tcp.TcpTransport.run(TcpTransport.java:196)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:722)

Found 1 deadlock.

Heap
 PSYoungGen      total 56064K, used 53316K [0x00000007c1600000, 0x00000007c8380000, 0x0000000800000000)
  eden space 48064K, 96% used [0x00000007c1600000,0x00000007c43411b0,0x00000007c44f0000)
  from space 8000K, 87% used [0x00000007c44f0000,0x00000007c4bc0000,0x00000007c4cc0000)
  to   space 8000K, 0% used [0x00000007c7bb0000,0x00000007c7bb0000,0x00000007c8380000)
 ParOldGen       total 128256K, used 2922K [0x0000000744200000, 0x000000074bf40000, 0x00000007c1600000)
  object space 128256K, 2% used [0x0000000744200000,0x00000007444daab8,0x000000074bf40000)
 PSPermGen       total 21248K, used 13151K [0x000000073f000000, 0x00000007404c0000, 0x0000000744200000)
  object space 21248K, 61% used [0x000000073f000000,0x000000073fcd7eb8,0x00000007404c0000)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12646318">AMQ-4513</key>
            <summary>Deadlock can occur on dispose of TempQueue that contains expired Messages</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.svg">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tabish">Timothy A. Bish</assignee>
                                    <reporter username="tabish">Timothy A. Bish</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 May 2013 22:30:31 +0000</created>
                <updated>Tue, 7 May 2013 16:16:27 +0000</updated>
                            <resolved>Tue, 7 May 2013 16:16:27 +0000</resolved>
                                    <version>5.7.0</version>
                    <version>5.8.0</version>
                                    <fixVersion>5.9.0</fixVersion>
                                    <component>Broker</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="13651007" author="tabish121" created="Tue, 7 May 2013 16:16:27 +0000"  >&lt;p&gt;fix applied on trunk&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>326676</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 29 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1kcvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>327021</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>