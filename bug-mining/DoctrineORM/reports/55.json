{"url":"https://api.github.com/repos/doctrine/orm/issues/11117","repository_url":"https://api.github.com/repos/doctrine/orm","labels_url":"https://api.github.com/repos/doctrine/orm/issues/11117/labels{/name}","comments_url":"https://api.github.com/repos/doctrine/orm/issues/11117/comments","events_url":"https://api.github.com/repos/doctrine/orm/issues/11117/events","html_url":"https://github.com/doctrine/orm/issues/11117","id":2039449232,"node_id":"I_kwDOAAkff855j4aQ","number":11117,"title":"DOMDocument schemaValidate error migrating to PHP 8.2","user":{"login":"yard-mschwartz","id":97032489,"node_id":"U_kgDOBciZKQ","avatar_url":"https://avatars.githubusercontent.com/u/97032489?v=4","gravatar_id":"","url":"https://api.github.com/users/yard-mschwartz","html_url":"https://github.com/yard-mschwartz","followers_url":"https://api.github.com/users/yard-mschwartz/followers","following_url":"https://api.github.com/users/yard-mschwartz/following{/other_user}","gists_url":"https://api.github.com/users/yard-mschwartz/gists{/gist_id}","starred_url":"https://api.github.com/users/yard-mschwartz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yard-mschwartz/subscriptions","organizations_url":"https://api.github.com/users/yard-mschwartz/orgs","repos_url":"https://api.github.com/users/yard-mschwartz/repos","events_url":"https://api.github.com/users/yard-mschwartz/events{/privacy}","received_events_url":"https://api.github.com/users/yard-mschwartz/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":41,"created_at":"2023-12-13T10:53:09Z","updated_at":"2024-01-18T11:17:40Z","closed_at":"2024-01-16T21:32:05Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### BC Break Report\r\n\r\n|    Q        |   A\r\n|------------ | ------\r\n| BC Break    | not sure\r\n| Version     | 2.17.1 (latest at time of writing)\r\n\r\n#### Summary\r\n\r\nCurrently upgrading one our projects to PHP 8.2 from PHP 7.4. Application runs fine on PHP 7.4 with `doctrine/orm` already on 2.17.1. However, when I bump the PHP-version to `^8.2` and run `composer upgrade`, the subsequent `symfony console cache:clear` fails with an `Warning: DOMDocument::schemaValidate(): Invalid Schema` error.\r\n\r\n#### Previous behavior\r\n\r\nThe commands `symfony console cache:clear` works just fine.\r\n\r\n#### Current behavior\r\n\r\nWhen I bump the PHP-version to `^8.2` and run `composer upgrade`, the subsequent `symfony console cache:clear` fails with the following error:\r\n\r\n```\r\n [WARNING] Some commands could not be registered:                                                                       \r\n\r\nIn XmlDriver.php line 1006:\r\n\r\n  Warning: DOMDocument::schemaValidate(): Invalid Schema\r\n```\r\n\r\nLine 1006 is the `schemaValidate()` in the following code block in `[...]/vendor/doctrine/orm/lib/Doctrine/ORM/Mapping/Driver/XmlDriver.php`:\r\n\r\n```\r\n$backedUpErrorSetting = libxml_use_internal_errors(true);\r\n\r\ntry {\r\n    $document = new DOMDocument();\r\n    $document->load($file);\r\n\r\n    if (! $document->schemaValidate(__DIR__ . '/../../../../../doctrine-mapping.xsd')) {\r\n        throw MappingException::fromLibXmlErrors(libxml_get_errors());\r\n    }\r\n\r\n    // more code here\r\n}\r\n```\r\n\r\nWhen I dump the `$file` that's being processed, it outputs `[...]/vendor/friendsofsymfony/user-bundle/Resources/config/doctrine-mapping/User.orm.xml`. So you might think this problem is related to that particular bundle, where I also created [an issue](https://github.com/FriendsOfSymfony/FOSUserBundle/issues/3065), however that packages also didn't change versions during the version bump to PHP 8.2. Both `doctrine/orm` and `friendsofsymfony/user-bundle` were already on the latest version.\r\n\r\nI messed around a little bit, to see if I could get some more info on the error. If I change the first line of that code block to `$backedUpErrorSetting = libxml_use_internal_errors(false);`, it shows a bit more information:\r\n\r\n```\r\n [WARNING] Some commands could not be registered:                                                                       \r\n\r\nIn XmlDriver.php line 1006:\r\n\r\n  Warning: DOMDocument::schemaValidate(): complex type 'sql-result-set-mapping': The content model is not determinist.\r\n```\r\n\r\nI assume I have an error somewhere in my model definition, that somehow was acceptable before the upgrade, but I have a hard time pinpointing where that might be. The [`friendsofsymfony/user-bundle` file](https://github.com/FriendsOfSymfony/FOSUserBundle/blob/master/Resources/config/doctrine-mapping/User.orm.xml) looks fine, and also works fine in another project we upgraded to PHP 8.2.\r\n\r\n_EDIT package overview and User model removed, because in the end they had nothing to do with this issue_\r\n\r\nAny suggestions?","closed_by":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/11117/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doctrine/orm/issues/11117/timeline","performed_via_github_app":null,"state_reason":"completed"}