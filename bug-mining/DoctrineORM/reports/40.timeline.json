[{"actor":{"login":"josephLaurent","id":48292541,"node_id":"MDQ6VXNlcjQ4MjkyNTQx","avatar_url":"https://avatars.githubusercontent.com/u/48292541?v=4","gravatar_id":"","url":"https://api.github.com/users/josephLaurent","html_url":"https://github.com/josephLaurent","followers_url":"https://api.github.com/users/josephLaurent/followers","following_url":"https://api.github.com/users/josephLaurent/following{/other_user}","gists_url":"https://api.github.com/users/josephLaurent/gists{/gist_id}","starred_url":"https://api.github.com/users/josephLaurent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josephLaurent/subscriptions","organizations_url":"https://api.github.com/users/josephLaurent/orgs","repos_url":"https://api.github.com/users/josephLaurent/repos","events_url":"https://api.github.com/users/josephLaurent/events{/privacy}","received_events_url":"https://api.github.com/users/josephLaurent/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-10T12:36:45Z","updated_at":"2022-08-10T12:36:45Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/brefphp/bref/issues/1258","repository_url":"https://api.github.com/repos/brefphp/bref","labels_url":"https://api.github.com/repos/brefphp/bref/issues/1258/labels{/name}","comments_url":"https://api.github.com/repos/brefphp/bref/issues/1258/comments","events_url":"https://api.github.com/repos/brefphp/bref/issues/1258/events","html_url":"https://github.com/brefphp/bref/issues/1258","id":1331538506,"node_id":"I_kwDOBrcNFs5PXapK","number":1258,"title":"Temp folder full","user":{"login":"josephLaurent","id":48292541,"node_id":"MDQ6VXNlcjQ4MjkyNTQx","avatar_url":"https://avatars.githubusercontent.com/u/48292541?v=4","gravatar_id":"","url":"https://api.github.com/users/josephLaurent","html_url":"https://github.com/josephLaurent","followers_url":"https://api.github.com/users/josephLaurent/followers","following_url":"https://api.github.com/users/josephLaurent/following{/other_user}","gists_url":"https://api.github.com/users/josephLaurent/gists{/gist_id}","starred_url":"https://api.github.com/users/josephLaurent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josephLaurent/subscriptions","organizations_url":"https://api.github.com/users/josephLaurent/orgs","repos_url":"https://api.github.com/users/josephLaurent/repos","events_url":"https://api.github.com/users/josephLaurent/events{/privacy}","received_events_url":"https://api.github.com/users/josephLaurent/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":765938930,"node_id":"MDU6TGFiZWw3NjU5Mzg5MzA=","url":"https://api.github.com/repos/brefphp/bref/labels/bug","name":"bug","color":"ee0701","default":true,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2022-08-08T08:44:46Z","updated_at":"2022-08-10T12:37:24Z","closed_at":"2022-08-10T12:37:24Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":112659734,"node_id":"MDEwOlJlcG9zaXRvcnkxMTI2NTk3MzQ=","name":"bref","full_name":"brefphp/bref","private":false,"owner":{"login":"brefphp","id":45861341,"node_id":"MDEyOk9yZ2FuaXphdGlvbjQ1ODYxMzQx","avatar_url":"https://avatars.githubusercontent.com/u/45861341?v=4","gravatar_id":"","url":"https://api.github.com/users/brefphp","html_url":"https://github.com/brefphp","followers_url":"https://api.github.com/users/brefphp/followers","following_url":"https://api.github.com/users/brefphp/following{/other_user}","gists_url":"https://api.github.com/users/brefphp/gists{/gist_id}","starred_url":"https://api.github.com/users/brefphp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brefphp/subscriptions","organizations_url":"https://api.github.com/users/brefphp/orgs","repos_url":"https://api.github.com/users/brefphp/repos","events_url":"https://api.github.com/users/brefphp/events{/privacy}","received_events_url":"https://api.github.com/users/brefphp/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/brefphp/bref","description":"Serverless PHP on AWS Lambda","fork":false,"url":"https://api.github.com/repos/brefphp/bref","forks_url":"https://api.github.com/repos/brefphp/bref/forks","keys_url":"https://api.github.com/repos/brefphp/bref/keys{/key_id}","collaborators_url":"https://api.github.com/repos/brefphp/bref/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/brefphp/bref/teams","hooks_url":"https://api.github.com/repos/brefphp/bref/hooks","issue_events_url":"https://api.github.com/repos/brefphp/bref/issues/events{/number}","events_url":"https://api.github.com/repos/brefphp/bref/events","assignees_url":"https://api.github.com/repos/brefphp/bref/assignees{/user}","branches_url":"https://api.github.com/repos/brefphp/bref/branches{/branch}","tags_url":"https://api.github.com/repos/brefphp/bref/tags","blobs_url":"https://api.github.com/repos/brefphp/bref/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/brefphp/bref/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/brefphp/bref/git/refs{/sha}","trees_url":"https://api.github.com/repos/brefphp/bref/git/trees{/sha}","statuses_url":"https://api.github.com/repos/brefphp/bref/statuses/{sha}","languages_url":"https://api.github.com/repos/brefphp/bref/languages","stargazers_url":"https://api.github.com/repos/brefphp/bref/stargazers","contributors_url":"https://api.github.com/repos/brefphp/bref/contributors","subscribers_url":"https://api.github.com/repos/brefphp/bref/subscribers","subscription_url":"https://api.github.com/repos/brefphp/bref/subscription","commits_url":"https://api.github.com/repos/brefphp/bref/commits{/sha}","git_commits_url":"https://api.github.com/repos/brefphp/bref/git/commits{/sha}","comments_url":"https://api.github.com/repos/brefphp/bref/comments{/number}","issue_comment_url":"https://api.github.com/repos/brefphp/bref/issues/comments{/number}","contents_url":"https://api.github.com/repos/brefphp/bref/contents/{+path}","compare_url":"https://api.github.com/repos/brefphp/bref/compare/{base}...{head}","merges_url":"https://api.github.com/repos/brefphp/bref/merges","archive_url":"https://api.github.com/repos/brefphp/bref/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/brefphp/bref/downloads","issues_url":"https://api.github.com/repos/brefphp/bref/issues{/number}","pulls_url":"https://api.github.com/repos/brefphp/bref/pulls{/number}","milestones_url":"https://api.github.com/repos/brefphp/bref/milestones{/number}","notifications_url":"https://api.github.com/repos/brefphp/bref/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/brefphp/bref/labels{/name}","releases_url":"https://api.github.com/repos/brefphp/bref/releases{/id}","deployments_url":"https://api.github.com/repos/brefphp/bref/deployments","created_at":"2017-11-30T20:57:40Z","updated_at":"2025-11-10T12:47:22Z","pushed_at":"2025-11-06T15:44:04Z","git_url":"git://github.com/brefphp/bref.git","ssh_url":"git@github.com:brefphp/bref.git","clone_url":"https://github.com/brefphp/bref.git","svn_url":"https://github.com/brefphp/bref","homepage":"https://bref.sh","size":18472,"stargazers_count":3315,"watchers_count":3315,"language":"PHP","has_issues":true,"has_projects":false,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":370,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":67,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["aws-lambda","bref","faas","lambda","lambda-layer","php","serverless"],"visibility":"public","forks":370,"open_issues":67,"watchers":3315,"default_branch":"master","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"\r\nHello,\r\n\r\nLately, we came across the following issue using bref and lambda.\r\n\r\n`cache.WARNING: Failed to save key \"0c97290e3f217e7b24eed5e136876318\" of type Doctrine\\ORM\\Query\\ParserResult: fwrite(): Write of 5359 bytes failed with errno=28 No space left on device`\r\n\r\nAt first, we though that it came from the code using the /tmp folder and making it full.\r\nBut after some investigation, I found out that a folder is created (/tmp/cac0c3b3d1db88ccd79feeec7173b6f1) and grow bigger during the execution until that, sometime the cache become full.\r\nI found out that doctrine (and maybe some other library) are writting in this folder but it only happens with this layer: ${bref:layer.php-81}.\r\nWith the layer: ${bref:layer.php-81-fpm}  I don't have any issue.\r\nWe are using a lot of lambda function using both layer and all the event-driven functions (using ${bref:layer.php-81}) have the same issue, all the other don't.\r\nThe cache doesn't become full on every lambda but this folder (/tmp/cac0c3b3d1db88ccd79feeec7173b6f1) is always created.\r\nI found out that the folder name change if we change the layer version, else it always stay the same.\r\nAlso, the tmp folder look like this just before it fails:\r\n\r\n```\r\n/tmp (514M)\r\n |-- /vendor (156M) -> Because we are using 'separateVendor' option in this example but it also happens without this option.\r\n |-- /cache (106M)\r\n |-- /cac0c3b3d1db88ccd79feeec7173b6f1 (253M) -> The undesired folder\r\n      |-- /tmp (235M)\r\n           |-- /vendor (45M)\r\n           |-- /cache (190M)\r\n```\r\n\r\n\r\nA part of our serverless.yml:\r\n\r\n```\r\nfunctions:\r\n    import:\r\n        handler: import.php\r\n        description: 'Import'\r\n        reservedConcurrency: ${env:RESERVED_CONCURRENCY_IMPORT, 5}\r\n        memorySize: 2048\r\n        timeout: 900\r\n        layers:\r\n            - ${bref:layer.php-81}\r\n        events:\r\n            - sqs:\r\n                arn:\r\n                    Fn::GetAtt:\r\n                        - import\r\n                        - Arn\r\n                batchSize: 1\r\n\r\n\r\n    ...\r\n\r\nresources:\r\n    import:\r\n        Type: \"AWS::SQS::Queue\"\r\n        Properties:\r\n            QueueName: mobireport-import-${opt:stage, self:provider.stage}\r\n            VisibilityTimeout: 900\r\n            MessageRetentionPeriod: 900\r\n\r\n```\r\n\r\n\r\nAlso, increasing the ephemeral storage of the lambda resolve the issue (at least for some lambda execution) but I hope there is a better solution.\r\nI don't know if this is a bug or if I miss something but in any case, help is welcome :)\r\nThanks in advance\r\n","reactions":{"url":"https://api.github.com/repos/brefphp/bref/issues/1258/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/brefphp/bref/issues/1258/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1210626300","html_url":"https://github.com/doctrine/orm/issues/9917#issuecomment-1210626300","issue_url":"https://api.github.com/repos/doctrine/orm/issues/9917","id":1210626300,"node_id":"IC_kwDOAAkff85IKLD8","user":{"login":"josephLaurent","id":48292541,"node_id":"MDQ6VXNlcjQ4MjkyNTQx","avatar_url":"https://avatars.githubusercontent.com/u/48292541?v=4","gravatar_id":"","url":"https://api.github.com/users/josephLaurent","html_url":"https://github.com/josephLaurent","followers_url":"https://api.github.com/users/josephLaurent/followers","following_url":"https://api.github.com/users/josephLaurent/following{/other_user}","gists_url":"https://api.github.com/users/josephLaurent/gists{/gist_id}","starred_url":"https://api.github.com/users/josephLaurent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josephLaurent/subscriptions","organizations_url":"https://api.github.com/users/josephLaurent/orgs","repos_url":"https://api.github.com/users/josephLaurent/repos","events_url":"https://api.github.com/users/josephLaurent/events{/privacy}","received_events_url":"https://api.github.com/users/josephLaurent/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-10T12:47:31Z","updated_at":"2022-08-10T12:47:31Z","body":"I got exactly the same issue, for me removing the following lines in the symfony config fix the issue:\r\n```\r\ndoctrine:\r\n    orm:\r\n        auto_generate_proxy_classes: false\r\n        metadata_cache_driver:\r\n            type: pool\r\n            pool: doctrine.system_cache_pool\r\n        query_cache_driver:\r\n            type: pool\r\n            pool: doctrine.system_cache_pool\r\n        result_cache_driver:\r\n            type: pool\r\n            pool: doctrine.result_cache_pool\r\n```\r\nAlso, put this in the `php.ini` file prevent using the opcache and so fix the issue as well:\r\n```\r\nopcache.file_cache = NULL\r\nopcache.file_cache_only = 0\r\n```\r\nBut this are only quick fix that have impact on performances.\r\nIs there any update on a possible fix on doctrine ?","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1210626300/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"josephLaurent","id":48292541,"node_id":"MDQ6VXNlcjQ4MjkyNTQx","avatar_url":"https://avatars.githubusercontent.com/u/48292541?v=4","gravatar_id":"","url":"https://api.github.com/users/josephLaurent","html_url":"https://github.com/josephLaurent","followers_url":"https://api.github.com/users/josephLaurent/followers","following_url":"https://api.github.com/users/josephLaurent/following{/other_user}","gists_url":"https://api.github.com/users/josephLaurent/gists{/gist_id}","starred_url":"https://api.github.com/users/josephLaurent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josephLaurent/subscriptions","organizations_url":"https://api.github.com/users/josephLaurent/orgs","repos_url":"https://api.github.com/users/josephLaurent/repos","events_url":"https://api.github.com/users/josephLaurent/events{/privacy}","received_events_url":"https://api.github.com/users/josephLaurent/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1211000444","html_url":"https://github.com/doctrine/orm/issues/9917#issuecomment-1211000444","issue_url":"https://api.github.com/repos/doctrine/orm/issues/9917","id":1211000444,"node_id":"IC_kwDOAAkff85ILmZ8","user":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-10T17:03:07Z","updated_at":"2022-08-10T17:03:07Z","body":"I would not expect the metadata cache or the query cache to grow indefinitely. I would try removing only the line about the result cache. How do you use that cache inside your app, by the way. Regarding the news, we did not discuss this issue in private or in other threads AFAIK. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1211000444/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1211636182","html_url":"https://github.com/doctrine/orm/issues/9917#issuecomment-1211636182","issue_url":"https://api.github.com/repos/doctrine/orm/issues/9917","id":1211636182,"node_id":"IC_kwDOAAkff85IOBnW","user":{"login":"josephLaurent","id":48292541,"node_id":"MDQ6VXNlcjQ4MjkyNTQx","avatar_url":"https://avatars.githubusercontent.com/u/48292541?v=4","gravatar_id":"","url":"https://api.github.com/users/josephLaurent","html_url":"https://github.com/josephLaurent","followers_url":"https://api.github.com/users/josephLaurent/followers","following_url":"https://api.github.com/users/josephLaurent/following{/other_user}","gists_url":"https://api.github.com/users/josephLaurent/gists{/gist_id}","starred_url":"https://api.github.com/users/josephLaurent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josephLaurent/subscriptions","organizations_url":"https://api.github.com/users/josephLaurent/orgs","repos_url":"https://api.github.com/users/josephLaurent/repos","events_url":"https://api.github.com/users/josephLaurent/events{/privacy}","received_events_url":"https://api.github.com/users/josephLaurent/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-11T07:22:24Z","updated_at":"2022-08-11T07:22:24Z","body":"I also use doctrine 2.12.3 with symfony. The case where the cache doesn't stop growing is when I use doctrine to query the database with a paginator in production environment. If fact, I'm facing the same issue than @icedevelopment in exactly the same case scenario.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1211636182/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"josephLaurent","id":48292541,"node_id":"MDQ6VXNlcjQ4MjkyNTQx","avatar_url":"https://avatars.githubusercontent.com/u/48292541?v=4","gravatar_id":"","url":"https://api.github.com/users/josephLaurent","html_url":"https://github.com/josephLaurent","followers_url":"https://api.github.com/users/josephLaurent/followers","following_url":"https://api.github.com/users/josephLaurent/following{/other_user}","gists_url":"https://api.github.com/users/josephLaurent/gists{/gist_id}","starred_url":"https://api.github.com/users/josephLaurent/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/josephLaurent/subscriptions","organizations_url":"https://api.github.com/users/josephLaurent/orgs","repos_url":"https://api.github.com/users/josephLaurent/repos","events_url":"https://api.github.com/users/josephLaurent/events{/privacy}","received_events_url":"https://api.github.com/users/josephLaurent/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7169295516,"node_id":"MEE_lADOAAkff85OCfkUzwAAAAGrUsSc","url":"https://api.github.com/repos/doctrine/orm/issues/events/7169295516","actor":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-08-11T07:22:24Z","performed_via_github_app":null},{"id":7169295520,"node_id":"SE_lADOAAkff85OCfkUzwAAAAGrUsSg","url":"https://api.github.com/repos/doctrine/orm/issues/events/7169295520","actor":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-08-11T07:22:24Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1212017295","html_url":"https://github.com/doctrine/orm/issues/9917#issuecomment-1212017295","issue_url":"https://api.github.com/repos/doctrine/orm/issues/9917","id":1212017295,"node_id":"IC_kwDOAAkff85IPeqP","user":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-11T13:49:53Z","updated_at":"2022-08-11T13:52:54Z","body":"Well let's say your result set is millions of records. Why would you expect the cache not to grow? The result cache is not meant to be used on each and every query you make through Doctrine ORM, and isn't by default (you have to call `useResultCache` explicitly IIRC. The cache system is not going to magically hold all the data in a table for free. ","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1212017295/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1222244286","html_url":"https://github.com/doctrine/orm/issues/9917#issuecomment-1222244286","issue_url":"https://api.github.com/repos/doctrine/orm/issues/9917","id":1222244286,"node_id":"IC_kwDOAAkff85I2fe-","user":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-08-22T11:48:26Z","updated_at":"2022-08-22T11:48:26Z","body":"@greg0ire The issue here is with the query cache (DQL to SQL transformation), **not** with the result cache.\r\nFor every SQL query used in an HTTP request, Doctrine will always do the DQL to SQL parsing and create a new query cache file with the same contents but a new unique filename everytime. This will make your `var/cache/prod/pools/` grow on every HTTP request and wil increase your OPCache wasted memory all the way until it is forced to automatically restart.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1222244286/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7232077508,"node_id":"MEE_lADOAAkff85OCfkUzwAAAAGvEL7E","url":"https://api.github.com/repos/doctrine/orm/issues/events/7232077508","actor":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-08-22T11:48:26Z","performed_via_github_app":null},{"id":7232077515,"node_id":"SE_lADOAAkff85OCfkUzwAAAAGvEL7L","url":"https://api.github.com/repos/doctrine/orm/issues/events/7232077515","actor":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-08-22T11:48:26Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1246662014","html_url":"https://github.com/doctrine/orm/issues/9917#issuecomment-1246662014","issue_url":"https://api.github.com/repos/doctrine/orm/issues/9917","id":1246662014,"node_id":"IC_kwDOAAkff85KTo1-","user":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-14T12:02:22Z","updated_at":"2022-09-14T12:02:22Z","body":"@greg0ire have you been able to have a look at this issue? This looks like a pretty bad bug performance-wise.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1246662014/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7385144355,"node_id":"MEE_lADOAAkff85OCfkUzwAAAAG4MFwj","url":"https://api.github.com/repos/doctrine/orm/issues/events/7385144355","actor":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-09-14T12:02:22Z","performed_via_github_app":null},{"id":7385144365,"node_id":"SE_lADOAAkff85OCfkUzwAAAAG4MFwt","url":"https://api.github.com/repos/doctrine/orm/issues/events/7385144365","actor":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-09-14T12:02:23Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1250262766","html_url":"https://github.com/doctrine/orm/issues/9917#issuecomment-1250262766","issue_url":"https://api.github.com/repos/doctrine/orm/issues/9917","id":1250262766,"node_id":"IC_kwDOAAkff85KhX7u","user":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-18T12:43:01Z","updated_at":"2022-09-18T12:43:21Z","body":"I was on holidays and I don't use the ORM myself, so no. After looking into this a bit, I think a solution could be to use a special implementation of the query cache driver just for the `WHERE IN` query, instead of calling `expireQueryCache`. Such an implementation is provided by `symfony/cache`, but not by `psr/cache`, sadly.\r\n\r\nCan you try calling `$whereInQuery->setQueryCache(new Symfony\\Component\\Cache\\Adapter\\NullAdapter())` and let me know if that mitigates the issue? If it does, we will need to figure out what to do (build our own null implementation of `CacheItemPoolInterface` or reuse one).","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1250262766/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1265118558","html_url":"https://github.com/doctrine/orm/issues/9917#issuecomment-1265118558","issue_url":"https://api.github.com/repos/doctrine/orm/issues/9917","id":1265118558,"node_id":"IC_kwDOAAkff85LaC1e","user":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-03T08:39:57Z","updated_at":"2022-10-03T08:39:57Z","body":"Hey @greg0ire thank you for your help.\r\n\r\nI've just tried calling `$whereInQuery->setQueryCache(new \\Symfony\\Component\\Cache\\Adapter\\NullAdapter())` before `$whereInQuery->expireQueryCache();` and I can confirm that it does indeed mitigate the issue.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1265118558/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7505056735,"node_id":"MEE_lADOAAkff85OCfkUzwAAAAG_VhPf","url":"https://api.github.com/repos/doctrine/orm/issues/events/7505056735","actor":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-10-03T08:39:57Z","performed_via_github_app":null},{"id":7505056745,"node_id":"SE_lADOAAkff85OCfkUzwAAAAG_VhPp","url":"https://api.github.com/repos/doctrine/orm/issues/events/7505056745","actor":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-10-03T08:39:57Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1265151317","html_url":"https://github.com/doctrine/orm/issues/9917#issuecomment-1265151317","issue_url":"https://api.github.com/repos/doctrine/orm/issues/9917","id":1265151317,"node_id":"IC_kwDOAAkff85LaK1V","user":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-03T09:09:21Z","updated_at":"2022-10-03T09:09:21Z","body":"Thanks, that's great news! Would you be willing to work on a PR to use this trick instead of the `expireQueryCache` one?","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1265151317/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7515810753,"node_id":"REFE_lADOAAkff85OCfkUzwAAAAG_-ivB","url":"https://api.github.com/repos/doctrine/orm/issues/events/7515810753","actor":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"de55162aa207665fc44e03acc93361a44615e2dd","commit_url":"https://api.github.com/repos/icedevelopment/orm/commits/de55162aa207665fc44e03acc93361a44615e2dd","created_at":"2022-10-04T12:04:26Z","performed_via_github_app":null},{"id":7515898540,"node_id":"REFE_lADOAAkff85OCfkUzwAAAAG_-4Ks","url":"https://api.github.com/repos/doctrine/orm/issues/events/7515898540","actor":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"49d67771f4869eeac52447c001f582ac36e29301","commit_url":"https://api.github.com/repos/icedevelopment/orm/commits/49d67771f4869eeac52447c001f582ac36e29301","created_at":"2022-10-04T12:16:07Z","performed_via_github_app":null},{"actor":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-04T12:18:27Z","updated_at":"2022-10-04T12:18:27Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/doctrine/orm/issues/10095","repository_url":"https://api.github.com/repos/doctrine/orm","labels_url":"https://api.github.com/repos/doctrine/orm/issues/10095/labels{/name}","comments_url":"https://api.github.com/repos/doctrine/orm/issues/10095/comments","events_url":"https://api.github.com/repos/doctrine/orm/issues/10095/events","html_url":"https://github.com/doctrine/orm/pull/10095","id":1396180942,"node_id":"PR_kwDOAAkff85AIW5o","number":10095,"title":"Use NullCacheItemPool when using a Paginator.","user":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":11,"created_at":"2022-10-04T12:18:27Z","updated_at":"2023-01-23T12:14:49Z","closed_at":"2023-01-23T12:14:49Z","author_association":"NONE","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":597887,"node_id":"MDEwOlJlcG9zaXRvcnk1OTc4ODc=","name":"orm","full_name":"doctrine/orm","private":false,"owner":{"login":"doctrine","id":209254,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIwOTI1NA==","avatar_url":"https://avatars.githubusercontent.com/u/209254?v=4","gravatar_id":"","url":"https://api.github.com/users/doctrine","html_url":"https://github.com/doctrine","followers_url":"https://api.github.com/users/doctrine/followers","following_url":"https://api.github.com/users/doctrine/following{/other_user}","gists_url":"https://api.github.com/users/doctrine/gists{/gist_id}","starred_url":"https://api.github.com/users/doctrine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/doctrine/subscriptions","organizations_url":"https://api.github.com/users/doctrine/orgs","repos_url":"https://api.github.com/users/doctrine/repos","events_url":"https://api.github.com/users/doctrine/events{/privacy}","received_events_url":"https://api.github.com/users/doctrine/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/doctrine/orm","description":"Doctrine Object Relational Mapper (ORM)","fork":false,"url":"https://api.github.com/repos/doctrine/orm","forks_url":"https://api.github.com/repos/doctrine/orm/forks","keys_url":"https://api.github.com/repos/doctrine/orm/keys{/key_id}","collaborators_url":"https://api.github.com/repos/doctrine/orm/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/doctrine/orm/teams","hooks_url":"https://api.github.com/repos/doctrine/orm/hooks","issue_events_url":"https://api.github.com/repos/doctrine/orm/issues/events{/number}","events_url":"https://api.github.com/repos/doctrine/orm/events","assignees_url":"https://api.github.com/repos/doctrine/orm/assignees{/user}","branches_url":"https://api.github.com/repos/doctrine/orm/branches{/branch}","tags_url":"https://api.github.com/repos/doctrine/orm/tags","blobs_url":"https://api.github.com/repos/doctrine/orm/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/doctrine/orm/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/doctrine/orm/git/refs{/sha}","trees_url":"https://api.github.com/repos/doctrine/orm/git/trees{/sha}","statuses_url":"https://api.github.com/repos/doctrine/orm/statuses/{sha}","languages_url":"https://api.github.com/repos/doctrine/orm/languages","stargazers_url":"https://api.github.com/repos/doctrine/orm/stargazers","contributors_url":"https://api.github.com/repos/doctrine/orm/contributors","subscribers_url":"https://api.github.com/repos/doctrine/orm/subscribers","subscription_url":"https://api.github.com/repos/doctrine/orm/subscription","commits_url":"https://api.github.com/repos/doctrine/orm/commits{/sha}","git_commits_url":"https://api.github.com/repos/doctrine/orm/git/commits{/sha}","comments_url":"https://api.github.com/repos/doctrine/orm/comments{/number}","issue_comment_url":"https://api.github.com/repos/doctrine/orm/issues/comments{/number}","contents_url":"https://api.github.com/repos/doctrine/orm/contents/{+path}","compare_url":"https://api.github.com/repos/doctrine/orm/compare/{base}...{head}","merges_url":"https://api.github.com/repos/doctrine/orm/merges","archive_url":"https://api.github.com/repos/doctrine/orm/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/doctrine/orm/downloads","issues_url":"https://api.github.com/repos/doctrine/orm/issues{/number}","pulls_url":"https://api.github.com/repos/doctrine/orm/pulls{/number}","milestones_url":"https://api.github.com/repos/doctrine/orm/milestones{/number}","notifications_url":"https://api.github.com/repos/doctrine/orm/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/doctrine/orm/labels{/name}","releases_url":"https://api.github.com/repos/doctrine/orm/releases{/id}","deployments_url":"https://api.github.com/repos/doctrine/orm/deployments","created_at":"2010-04-06T21:42:59Z","updated_at":"2025-11-10T09:26:15Z","pushed_at":"2025-11-10T13:35:45Z","git_url":"git://github.com/doctrine/orm.git","ssh_url":"git@github.com:doctrine/orm.git","clone_url":"https://github.com/doctrine/orm.git","svn_url":"https://github.com/doctrine/orm","homepage":"https://www.doctrine-project.org/projects/orm.html","size":54667,"stargazers_count":10115,"watchers_count":10115,"language":"PHP","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":2553,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1301,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["hacktoberfest"],"visibility":"public","forks":2553,"open_issues":1301,"watchers":10115,"default_branch":"3.5.x","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/doctrine/orm/pulls/10095","html_url":"https://github.com/doctrine/orm/pull/10095","diff_url":"https://github.com/doctrine/orm/pull/10095.diff","patch_url":"https://github.com/doctrine/orm/pull/10095.patch","merged_at":null},"body":"This fixes a bug where Doctrine would recreate the DQL to SQL parsing\r\ncache on every request which would fill up OPCache with duplicates.\r\nWe now use a \"Null\" cache implementation instead of calling\r\nQuery::expireQueryCache().\r\n@see https://github.com/doctrine/orm/issues/9917","reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/10095/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doctrine/orm/issues/10095/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1266913625","html_url":"https://github.com/doctrine/orm/issues/9917#issuecomment-1266913625","issue_url":"https://api.github.com/repos/doctrine/orm/issues/9917","id":1266913625,"node_id":"IC_kwDOAAkff85Lg5FZ","user":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-04T12:27:17Z","updated_at":"2022-10-04T12:27:17Z","body":"> Thanks, that's great news! Would you be willing to work on a PR to use this trick instead of the `expireQueryCache` one?\r\n\r\nI just opened https://github.com/doctrine/orm/pull/10095.\r\nI created a new `NullCacheItemPool` based on `Symfony\\Component\\Cache\\Adapter\\NullAdapter`.\r\nLet me know what you think.","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1266913625/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":7516405833,"node_id":"REFE_lADOAAkff85OCfkUzwAAAAHAA0BJ","url":"https://api.github.com/repos/doctrine/orm/issues/events/7516405833","actor":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"a825c28d95ed8fdfd3d8368cb04bafb34b8bd447","commit_url":"https://api.github.com/repos/icedevelopment/orm/commits/a825c28d95ed8fdfd3d8368cb04bafb34b8bd447","created_at":"2022-10-04T13:15:43Z","performed_via_github_app":null},{"id":7516602396,"node_id":"REFE_lADOAAkff85OCfkUzwAAAAHABkAc","url":"https://api.github.com/repos/doctrine/orm/issues/events/7516602396","actor":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"691fbf6d19731a9732c36b83610f4783177a22a7","commit_url":"https://api.github.com/repos/icedevelopment/orm/commits/691fbf6d19731a9732c36b83610f4783177a22a7","created_at":"2022-10-04T13:36:25Z","performed_via_github_app":null},{"id":7517639756,"node_id":"REFE_lADOAAkff85OCfkUzwAAAAHAFhRM","url":"https://api.github.com/repos/doctrine/orm/issues/events/7517639756","actor":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"89722a664722dda1974222a3d4624d5555937858","commit_url":"https://api.github.com/repos/icedevelopment/orm/commits/89722a664722dda1974222a3d4624d5555937858","created_at":"2022-10-04T15:22:23Z","performed_via_github_app":null},{"id":7517665737,"node_id":"REFE_lADOAAkff85OCfkUzwAAAAHAFnnJ","url":"https://api.github.com/repos/doctrine/orm/issues/events/7517665737","actor":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"161701bc53d10e1652accaf2eae942bb55219c87","commit_url":"https://api.github.com/repos/icedevelopment/orm/commits/161701bc53d10e1652accaf2eae942bb55219c87","created_at":"2022-10-04T15:25:23Z","performed_via_github_app":null},{"id":7523736342,"node_id":"REFE_lADOAAkff85OCfkUzwAAAAHAcxsW","url":"https://api.github.com/repos/doctrine/orm/issues/events/7523736342","actor":{"login":"icedevelopment","id":4964448,"node_id":"MDQ6VXNlcjQ5NjQ0NDg=","avatar_url":"https://avatars.githubusercontent.com/u/4964448?v=4","gravatar_id":"","url":"https://api.github.com/users/icedevelopment","html_url":"https://github.com/icedevelopment","followers_url":"https://api.github.com/users/icedevelopment/followers","following_url":"https://api.github.com/users/icedevelopment/following{/other_user}","gists_url":"https://api.github.com/users/icedevelopment/gists{/gist_id}","starred_url":"https://api.github.com/users/icedevelopment/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/icedevelopment/subscriptions","organizations_url":"https://api.github.com/users/icedevelopment/orgs","repos_url":"https://api.github.com/users/icedevelopment/repos","events_url":"https://api.github.com/users/icedevelopment/events{/privacy}","received_events_url":"https://api.github.com/users/icedevelopment/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"7d9a04833b7ec9f0f2914cd840a564fd97121772","commit_url":"https://api.github.com/repos/icedevelopment/orm/commits/7d9a04833b7ec9f0f2914cd840a564fd97121772","created_at":"2022-10-05T09:49:12Z","performed_via_github_app":null},{"actor":{"login":"mpdude","id":1202333,"node_id":"MDQ6VXNlcjEyMDIzMzM=","avatar_url":"https://avatars.githubusercontent.com/u/1202333?v=4","gravatar_id":"","url":"https://api.github.com/users/mpdude","html_url":"https://github.com/mpdude","followers_url":"https://api.github.com/users/mpdude/followers","following_url":"https://api.github.com/users/mpdude/following{/other_user}","gists_url":"https://api.github.com/users/mpdude/gists{/gist_id}","starred_url":"https://api.github.com/users/mpdude/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mpdude/subscriptions","organizations_url":"https://api.github.com/users/mpdude/orgs","repos_url":"https://api.github.com/users/mpdude/repos","events_url":"https://api.github.com/users/mpdude/events{/privacy}","received_events_url":"https://api.github.com/users/mpdude/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-21T22:56:15Z","updated_at":"2023-01-21T22:56:15Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/doctrine/orm/issues/10434","repository_url":"https://api.github.com/repos/doctrine/orm","labels_url":"https://api.github.com/repos/doctrine/orm/issues/10434/labels{/name}","comments_url":"https://api.github.com/repos/doctrine/orm/issues/10434/comments","events_url":"https://api.github.com/repos/doctrine/orm/issues/10434/events","html_url":"https://github.com/doctrine/orm/pull/10434","id":1549584635,"node_id":"PR_kwDOAAkff85IJbhw","number":10434,"title":"Avoid wasting Opcache memory with Paginator queries","user":{"login":"mpdude","id":1202333,"node_id":"MDQ6VXNlcjEyMDIzMzM=","avatar_url":"https://avatars.githubusercontent.com/u/1202333?v=4","gravatar_id":"","url":"https://api.github.com/users/mpdude","html_url":"https://github.com/mpdude","followers_url":"https://api.github.com/users/mpdude/followers","following_url":"https://api.github.com/users/mpdude/following{/other_user}","gists_url":"https://api.github.com/users/mpdude/gists{/gist_id}","starred_url":"https://api.github.com/users/mpdude/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mpdude/subscriptions","organizations_url":"https://api.github.com/users/mpdude/orgs","repos_url":"https://api.github.com/users/mpdude/repos","events_url":"https://api.github.com/users/mpdude/events{/privacy}","received_events_url":"https://api.github.com/users/mpdude/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":296201252,"node_id":"MDU6TGFiZWwyOTYyMDEyNTI=","url":"https://api.github.com/repos/doctrine/orm/labels/Bug","name":"Bug","color":"e11d21","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/doctrine/orm/milestones/122","html_url":"https://github.com/doctrine/orm/milestone/122","labels_url":"https://api.github.com/repos/doctrine/orm/milestones/122/labels","id":8861303,"node_id":"MI_kwDOAAkff84AhzZ3","number":122,"title":"2.14.2","description":"2.14.x bugfix release (patch)","creator":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"open_issues":0,"closed_issues":42,"state":"closed","created_at":"2023-01-16T18:41:08Z","updated_at":"2023-04-12T13:59:26Z","due_on":null,"closed_at":"2023-04-12T13:59:26Z"},"comments":5,"created_at":"2023-01-19T17:09:36Z","updated_at":"2023-01-24T16:10:02Z","closed_at":"2023-01-23T12:14:47Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":597887,"node_id":"MDEwOlJlcG9zaXRvcnk1OTc4ODc=","name":"orm","full_name":"doctrine/orm","private":false,"owner":{"login":"doctrine","id":209254,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIwOTI1NA==","avatar_url":"https://avatars.githubusercontent.com/u/209254?v=4","gravatar_id":"","url":"https://api.github.com/users/doctrine","html_url":"https://github.com/doctrine","followers_url":"https://api.github.com/users/doctrine/followers","following_url":"https://api.github.com/users/doctrine/following{/other_user}","gists_url":"https://api.github.com/users/doctrine/gists{/gist_id}","starred_url":"https://api.github.com/users/doctrine/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/doctrine/subscriptions","organizations_url":"https://api.github.com/users/doctrine/orgs","repos_url":"https://api.github.com/users/doctrine/repos","events_url":"https://api.github.com/users/doctrine/events{/privacy}","received_events_url":"https://api.github.com/users/doctrine/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/doctrine/orm","description":"Doctrine Object Relational Mapper (ORM)","fork":false,"url":"https://api.github.com/repos/doctrine/orm","forks_url":"https://api.github.com/repos/doctrine/orm/forks","keys_url":"https://api.github.com/repos/doctrine/orm/keys{/key_id}","collaborators_url":"https://api.github.com/repos/doctrine/orm/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/doctrine/orm/teams","hooks_url":"https://api.github.com/repos/doctrine/orm/hooks","issue_events_url":"https://api.github.com/repos/doctrine/orm/issues/events{/number}","events_url":"https://api.github.com/repos/doctrine/orm/events","assignees_url":"https://api.github.com/repos/doctrine/orm/assignees{/user}","branches_url":"https://api.github.com/repos/doctrine/orm/branches{/branch}","tags_url":"https://api.github.com/repos/doctrine/orm/tags","blobs_url":"https://api.github.com/repos/doctrine/orm/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/doctrine/orm/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/doctrine/orm/git/refs{/sha}","trees_url":"https://api.github.com/repos/doctrine/orm/git/trees{/sha}","statuses_url":"https://api.github.com/repos/doctrine/orm/statuses/{sha}","languages_url":"https://api.github.com/repos/doctrine/orm/languages","stargazers_url":"https://api.github.com/repos/doctrine/orm/stargazers","contributors_url":"https://api.github.com/repos/doctrine/orm/contributors","subscribers_url":"https://api.github.com/repos/doctrine/orm/subscribers","subscription_url":"https://api.github.com/repos/doctrine/orm/subscription","commits_url":"https://api.github.com/repos/doctrine/orm/commits{/sha}","git_commits_url":"https://api.github.com/repos/doctrine/orm/git/commits{/sha}","comments_url":"https://api.github.com/repos/doctrine/orm/comments{/number}","issue_comment_url":"https://api.github.com/repos/doctrine/orm/issues/comments{/number}","contents_url":"https://api.github.com/repos/doctrine/orm/contents/{+path}","compare_url":"https://api.github.com/repos/doctrine/orm/compare/{base}...{head}","merges_url":"https://api.github.com/repos/doctrine/orm/merges","archive_url":"https://api.github.com/repos/doctrine/orm/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/doctrine/orm/downloads","issues_url":"https://api.github.com/repos/doctrine/orm/issues{/number}","pulls_url":"https://api.github.com/repos/doctrine/orm/pulls{/number}","milestones_url":"https://api.github.com/repos/doctrine/orm/milestones{/number}","notifications_url":"https://api.github.com/repos/doctrine/orm/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/doctrine/orm/labels{/name}","releases_url":"https://api.github.com/repos/doctrine/orm/releases{/id}","deployments_url":"https://api.github.com/repos/doctrine/orm/deployments","created_at":"2010-04-06T21:42:59Z","updated_at":"2025-11-10T09:26:15Z","pushed_at":"2025-11-10T13:35:45Z","git_url":"git://github.com/doctrine/orm.git","ssh_url":"git@github.com:doctrine/orm.git","clone_url":"https://github.com/doctrine/orm.git","svn_url":"https://github.com/doctrine/orm","homepage":"https://www.doctrine-project.org/projects/orm.html","size":54667,"stargazers_count":10115,"watchers_count":10115,"language":"PHP","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":2553,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":1301,"license":{"key":"mit","name":"MIT License","spdx_id":"MIT","url":"https://api.github.com/licenses/mit","node_id":"MDc6TGljZW5zZTEz"},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["hacktoberfest"],"visibility":"public","forks":2553,"open_issues":1301,"watchers":10115,"default_branch":"3.5.x","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/doctrine/orm/pulls/10434","html_url":"https://github.com/doctrine/orm/pull/10434","diff_url":"https://github.com/doctrine/orm/pull/10434.diff","patch_url":"https://github.com/doctrine/orm/pull/10434.patch","merged_at":"2023-01-23T12:14:47Z"},"body":"This PR prevents the Paginator from causing OpCache \"wasted memory\" to increase _on every request_ when used with Symfony's `PhpFilesAdapter` as the cache implementation for the query cache.\r\n\r\nDepending on configured thresholds, wasted memory this will either cause periodic opcache restarts or running out of memory and not being able to cache additional scripts ([Details](https://tideways.com/profiler/blog/fine-tune-your-opcache-configuration-to-avoid-caching-suprises)).\r\n\r\nFixes #9917, closes #10095.\r\n\r\n#### Problem analysis \r\n\r\nThere is a long story (#7820, #7821, #7837, #7865) behind how the Paginator can take care of DBAL type conversions when creating the pagination query. This conversion has to transform identifier values before they will be used as a query parameter, so it has to happen every time the Paginator is used.\r\n\r\nFor reasons, this conversion happens inside `WhereInWalker`. Tree walkers like this are used only during the DQL parsing/AST processing steps. Having a DQL query in the query cache short-cuts this step by fetching the parsing/processing result from the cache.\r\n\r\nSo, to make sure the conversion happens also with the query cache being enabled, this line\r\n\r\nhttps://github.com/doctrine/orm/blob/1753d035005c1125c9fb4855c3fa629341e5734d/lib/Doctrine/ORM/Tools/Pagination/Paginator.php#L165\r\n\r\nwas added in #7837. It causes `\\Doctrine\\ORM\\Query::parse()` to re-parse the query every time, but will also put the result into the query cache afterwards.\r\n\r\nAt this point, the setup described in #9917  which, to my knowledge, is the default in Symfony + DoctrineBundle projects will ultimately bring us to this code:\r\n\r\nhttps://github.com/symfony/symfony/blob/4b3391725f2fc4a072e776974f00a992cbc70515/src/Symfony/Component/Cache/Adapter/PhpFilesAdapter.php#L248-L249\r\n\r\nWhen writing a cache item with an already existing key, the driver has to make sure the opcache will honor the changed PHP file. This is what causes _wasted memory_ to increase.\r\n\r\n#### Suggested solution\r\n\r\nInstead of using `\\Doctrine\\ORM\\Query::expireQueryCache()`, which will force `\\Doctrine\\ORM\\Query::parse()` to parse the query again before putting it into the cache, use `\\Doctrine\\ORM\\Query::useQueryCache(false)`. The subtle difference is the latter will not place the processed query in the cache in the first place.\r\n\r\nA test case is added to check that repeated use of the paginator does not call the cache to update existing keys. That should suffice to make sure we're not running into the issue, while at the same time not complicating tests by using the `PhpFilesAdapter` directly.\r\n\r\nNote that in order to observe the described issue in tests, you will need to use the `PhpFilesDriver` and also make sure that OpCache is enabled and also activated for `php-cli` (which is running the unit tests).\r\n\r\n#### Performance remark\r\n\r\nThis particular subquery generated/used by the Paginator is not put into the query cache. The DQL parsing/to-SQL conversion has to happen _every time_ the Paginator is used. \r\n\r\nThis, however, was already the case before this PR. In other words, this PR only changes that we do not store/update the cached result every time, but instead completely omit caching the query.","reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/10434/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doctrine/orm/issues/10434/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1399349833","html_url":"https://github.com/doctrine/orm/issues/9917#issuecomment-1399349833","issue_url":"https://api.github.com/repos/doctrine/orm/issues/9917","id":1399349833,"node_id":"IC_kwDOAAkff85TaGJJ","user":{"login":"mpdude","id":1202333,"node_id":"MDQ6VXNlcjEyMDIzMzM=","avatar_url":"https://avatars.githubusercontent.com/u/1202333?v=4","gravatar_id":"","url":"https://api.github.com/users/mpdude","html_url":"https://github.com/mpdude","followers_url":"https://api.github.com/users/mpdude/followers","following_url":"https://api.github.com/users/mpdude/following{/other_user}","gists_url":"https://api.github.com/users/mpdude/gists{/gist_id}","starred_url":"https://api.github.com/users/mpdude/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mpdude/subscriptions","organizations_url":"https://api.github.com/users/mpdude/orgs","repos_url":"https://api.github.com/users/mpdude/repos","events_url":"https://api.github.com/users/mpdude/events{/privacy}","received_events_url":"https://api.github.com/users/mpdude/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-21T23:02:05Z","updated_at":"2023-01-21T23:02:05Z","body":"A suggested fix is in #10434.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/comments/1399349833/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"mpdude","id":1202333,"node_id":"MDQ6VXNlcjEyMDIzMzM=","avatar_url":"https://avatars.githubusercontent.com/u/1202333?v=4","gravatar_id":"","url":"https://api.github.com/users/mpdude","html_url":"https://github.com/mpdude","followers_url":"https://api.github.com/users/mpdude/followers","following_url":"https://api.github.com/users/mpdude/following{/other_user}","gists_url":"https://api.github.com/users/mpdude/gists{/gist_id}","starred_url":"https://api.github.com/users/mpdude/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mpdude/subscriptions","organizations_url":"https://api.github.com/users/mpdude/orgs","repos_url":"https://api.github.com/users/mpdude/repos","events_url":"https://api.github.com/users/mpdude/events{/privacy}","received_events_url":"https://api.github.com/users/mpdude/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":8329238287,"node_id":"REFE_lADOAAkff85OCfkUzwAAAAHwdhcP","url":"https://api.github.com/repos/doctrine/orm/issues/events/8329238287","actor":{"login":"mpdude","id":1202333,"node_id":"MDQ6VXNlcjEyMDIzMzM=","avatar_url":"https://avatars.githubusercontent.com/u/1202333?v=4","gravatar_id":"","url":"https://api.github.com/users/mpdude","html_url":"https://github.com/mpdude","followers_url":"https://api.github.com/users/mpdude/followers","following_url":"https://api.github.com/users/mpdude/following{/other_user}","gists_url":"https://api.github.com/users/mpdude/gists{/gist_id}","starred_url":"https://api.github.com/users/mpdude/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mpdude/subscriptions","organizations_url":"https://api.github.com/users/mpdude/orgs","repos_url":"https://api.github.com/users/mpdude/repos","events_url":"https://api.github.com/users/mpdude/events{/privacy}","received_events_url":"https://api.github.com/users/mpdude/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"df600530570fea758849a380068454c9187e6285","commit_url":"https://api.github.com/repos/mpdude/doctrine2/commits/df600530570fea758849a380068454c9187e6285","created_at":"2023-01-22T17:35:34Z","performed_via_github_app":null}]