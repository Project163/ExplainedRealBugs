{"url":"https://api.github.com/repos/doctrine/orm/issues/9902","repository_url":"https://api.github.com/repos/doctrine/orm","labels_url":"https://api.github.com/repos/doctrine/orm/issues/9902/labels{/name}","comments_url":"https://api.github.com/repos/doctrine/orm/issues/9902/comments","events_url":"https://api.github.com/repos/doctrine/orm/issues/9902/events","html_url":"https://github.com/doctrine/orm/issues/9902","id":1306773146,"node_id":"I_kwDOAAkff85N48aa","number":9902,"title":"Wrong mapping for ManyToMany JoinTable fields when use attributes ","user":{"login":"innerfly","id":3435361,"node_id":"MDQ6VXNlcjM0MzUzNjE=","avatar_url":"https://avatars.githubusercontent.com/u/3435361?v=4","gravatar_id":"","url":"https://api.github.com/users/innerfly","html_url":"https://github.com/innerfly","followers_url":"https://api.github.com/users/innerfly/followers","following_url":"https://api.github.com/users/innerfly/following{/other_user}","gists_url":"https://api.github.com/users/innerfly/gists{/gist_id}","starred_url":"https://api.github.com/users/innerfly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/innerfly/subscriptions","organizations_url":"https://api.github.com/users/innerfly/orgs","repos_url":"https://api.github.com/users/innerfly/repos","events_url":"https://api.github.com/users/innerfly/events{/privacy}","received_events_url":"https://api.github.com/users/innerfly/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2022-07-16T10:37:30Z","updated_at":"2023-05-04T21:52:48Z","closed_at":"2023-05-04T21:52:48Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Bug Report\r\n\r\n<!-- Fill in the relevant information below to help triage your issue. -->\r\n\r\n|    Q        |   A\r\n|------------ | ------\r\n| BC Break    | no\r\n| Version     | 2.12.3\r\n\r\n#### Summary\r\n\r\nI am trying to upgrade entities from annotations to attributes and got an strange behavior with ManyToMany relation. When use attributes, joinColumns and inverseJoinColumns are ignored and forced to use default field names. \r\n\r\nBelow is correct behavior with annotation:\r\n\r\nApp\\Entity\\User:\r\n```\r\n/**\r\n * @ORM\\Table(name=\"user\")\r\n * @ORM\\Entity(repositoryClass=\"App\\Repository\\UserRepository\")\r\n */\r\nclass User\r\n{\r\n    /**\r\n     * @ORM\\Column(name=\"u_id\", type=\"integer\", nullable=false)\r\n     * @ORM\\Id\r\n     * @ORM\\GeneratedValue(strategy=\"IDENTITY\")\r\n     */\r\n    private int $id;\r\n\r\n    /**\r\n     * @ORM\\ManyToMany(targetEntity=\"Group\", inversedBy=\"users\")\r\n     * @ORM\\JoinTable(name=\"users_groups\",\r\n     *   joinColumns={\r\n     *     @ORM\\JoinColumn(name=\"ug_u_id\", referencedColumnName=\"u_id\")\r\n     *   },\r\n     *   inverseJoinColumns={\r\n     *     @ORM\\JoinColumn(name=\"ug_g_id\", referencedColumnName=\"g_id\")\r\n     *   }\r\n     * )\r\n     */\r\n    private ArrayCollection $groups;\r\n}\r\n```\r\n\r\nApp\\EntityGroup\r\n\r\n```\r\n/**\r\n * @ORM\\Table(name=\"group\")\r\n * @ORM\\Entity(repositoryClass=\"App\\Repository\\GroupRepository\")\r\n */\r\nclass Group\r\n{\r\n    /**\r\n     * @ORM\\Column(name=\"g_id\", type=\"integer\", nullable=false)\r\n     * @ORM\\Id\r\n     * @ORM\\GeneratedValue(strategy=\"IDENTITY\")\r\n     */\r\n    private int $id;\r\n\r\n    /**\r\n     * @ORM\\ManyToMany(targetEntity=\"App\\Entity\\User\", mappedBy=\"groups\")\r\n     */\r\n    private ArrayCollection $users;\r\n}\r\n```\r\n\r\nMigration:\r\n```\r\n        $this->addSql('CREATE TABLE \"group\" (g_id SERIAL NOT NULL, PRIMARY KEY(g_id))');\r\n        $this->addSql('CREATE TABLE \"user\" (u_id SERIAL NOT NULL, PRIMARY KEY(u_id))');\r\n        $this->addSql('CREATE TABLE users_groups (ug_u_id INT NOT NULL, ug_g_id INT NOT NULL, PRIMARY KEY(ug_u_id, ug_g_id))');\r\n```\r\n\r\n#### Current behavior\r\n\r\nWrong behavior with attributes:\r\nApp\\Entity\\User\r\n```\r\n#[ORM\\Entity(repositoryClass: UserRepository::class)]\r\nclass User\r\n{\r\n    #[ORM\\Column(name: 'u_id', type: 'integer', nullable: false)]\r\n    #[ORM\\Id]\r\n    #[ORM\\GeneratedValue(strategy: 'IDENTITY')]\r\n    private int $id;\r\n\r\n    #[ORM\\ManyToMany(targetEntity: Group::class, inversedBy: \"users\")]\r\n    #[ORM\\JoinTable(\r\n        name: 'users_groups',\r\n        joinColumns: [new ORM\\JoinColumn(name: 'ug_u_id', referencedColumnName: 'u_id')],\r\n        inverseJoinColumns: [new ORM\\JoinColumn(name: 'ug_g_id', referencedColumnName: 'g_id')]\r\n    )]\r\n    private ArrayCollection $groups;\r\n}\r\n```\r\nApp\\Entity\\Group\r\n```\r\n#[ORM\\Entity(repositoryClass: GroupRepository::class)]\r\nclass Group\r\n{\r\n    #[ORM\\Column(name: 'g_id', type: 'integer', nullable: false)]\r\n    #[ORM\\Id]\r\n    #[ORM\\GeneratedValue(strategy: 'IDENTITY')]\r\n    private int $id;\r\n\r\n    #[ORM\\ManyToMany(targetEntity: User::class, mappedBy: \"groups\")]\r\n    private ArrayCollection $users;\r\n}\r\n```\r\nMigration with ignored JoinTable fields:\r\n```\r\n        $this->addSql('CREATE TABLE \"group\" (g_id SERIAL NOT NULL, PRIMARY KEY(g_id))');\r\n        $this->addSql('CREATE TABLE \"user\" (u_id SERIAL NOT NULL, PRIMARY KEY(u_id))');\r\n        $this->addSql('CREATE TABLE users_groups (user_id INT NOT NULL, group_id INT NOT NULL, PRIMARY KEY(user_id, group_id))');\r\n```\r\nGenerated schema causes 'Column not found' SQL errors.\r\n\r\n#### How to reproduce\r\n\r\nUse attributes in ManyToMany relation\r\n\r\n#### Expected behavior\r\n\r\nAs described in example with annotation\r\n\r\n","closed_by":{"login":"greg0ire","id":657779,"node_id":"MDQ6VXNlcjY1Nzc3OQ==","avatar_url":"https://avatars.githubusercontent.com/u/657779?v=4","gravatar_id":"","url":"https://api.github.com/users/greg0ire","html_url":"https://github.com/greg0ire","followers_url":"https://api.github.com/users/greg0ire/followers","following_url":"https://api.github.com/users/greg0ire/following{/other_user}","gists_url":"https://api.github.com/users/greg0ire/gists{/gist_id}","starred_url":"https://api.github.com/users/greg0ire/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg0ire/subscriptions","organizations_url":"https://api.github.com/users/greg0ire/orgs","repos_url":"https://api.github.com/users/greg0ire/repos","events_url":"https://api.github.com/users/greg0ire/events{/privacy}","received_events_url":"https://api.github.com/users/greg0ire/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/doctrine/orm/issues/9902/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/doctrine/orm/issues/9902/timeline","performed_via_github_app":null,"state_reason":"completed"}