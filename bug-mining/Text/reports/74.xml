<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:54:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TEXT-209] LookupTranslator returns count of chars consumed, not of codepoints consumed</title>
                <link>https://issues.apache.org/jira/browse/TEXT-209</link>
                <project id="12318221" key="TEXT">Commons Text</project>
                    <description>&lt;p&gt;&lt;tt&gt;The contract of abstract method &lt;a href=&quot;https://github.com/apache/commons-text/blob/c7361037993be487e0220069d76caf9f3698e2e3/src/main/java/org/apache/commons/text/translate/CharSequenceTranslator.java#L83&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;translate&lt;/a&gt; i&lt;/tt&gt;&lt;tt&gt;n the class &lt;a href=&quot;https://github.com/apache/commons-text/blob/c7361037993be487e0220069d76caf9f3698e2e3/src/main/java/org/apache/commons/text/translate/CharSequenceTranslator.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;CharSequenceTranslator&lt;/a&gt;&lt;/tt&gt;&lt;tt&gt;, and therefore also in the inherited &lt;a href=&quot;https://github.com/apache/commons-text/blob/c7361037993be487e0220069d76caf9f3698e2e3/src/main/java/org/apache/commons/text/translate/LookupTranslator.java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;LookupTranslator&lt;/a&gt;, is to return the &quot;&lt;em&gt;int count of codepoints consumed&lt;/em&gt;&quot;.&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Cf. their javadoc.&lt;/p&gt;

&lt;p&gt;However, LookupTranslator returns the number of chars.&lt;/p&gt;

&lt;p&gt;This can be seen in its source, in its implementation of the abstract method, where it returns &quot;i&quot;, which is the length &lt;em&gt;in chars&lt;/em&gt; of the longest matching substring.&lt;/p&gt;

&lt;p&gt;Test to reproduce:&lt;/p&gt;

&lt;p&gt;Define a mapping where a String with 1 supplementary character is mapped to 1 (basic) char.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;/* Key: string with Mathematical &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt;-struck capital A (U+1D538) */&lt;/span&gt;
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; symbol = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringBuilder().appendCodePoint(0x1D538).toString();

&lt;span class=&quot;code-comment&quot;&gt;/* Map U+1D538 to &lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt; */&lt;/span&gt;
Map&amp;lt;CharSequence, CharSequence&amp;gt; map = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&amp;gt;();
map.put(symbol, &lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;);

LookupTranslator translator = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; LookupTranslator(map);
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; translated = translator.translate(symbol + &lt;span class=&quot;code-quote&quot;&gt;&quot;=A&quot;&lt;/span&gt;);
		
&lt;span class=&quot;code-comment&quot;&gt;/* Fails: instead of &lt;span class=&quot;code-quote&quot;&gt;&quot;A=A&quot;&lt;/span&gt;, we get &lt;span class=&quot;code-quote&quot;&gt;&quot;AA&quot;&lt;/span&gt;. */&lt;/span&gt;
assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;A=A&quot;&lt;/span&gt;, translated);

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So when doing the translation, the supplementary character got mapped, but then you notice that the LookupTranslator erroneously &lt;ins&gt;&lt;em&gt;swallowed&lt;/em&gt; the following &quot;=&quot; character&lt;/ins&gt;.&lt;/p&gt;

&lt;p&gt;That is because its translate method returns the count of matched &lt;em&gt;chars&lt;/em&gt; (i.e. 2 = the high and low surrogate code unit&#160; (chars) that form the surrogate pair)&#160; , instead of the count of matched &lt;em&gt;codepoints&lt;/em&gt; (i.e. which is 1, and which the javadoc claims to return)&lt;/p&gt;</description>
                <environment></environment>
        <key id="13385163">TEXT-209</key>
            <summary>LookupTranslator returns count of chars consumed, not of codepoints consumed</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kinow">Bruno P. Kinoshita</assignee>
                                    <reporter username="belpk">K P</reporter>
                        <labels>
                            <label>Surrogates</label>
                            <label>Unicode</label>
                    </labels>
                <created>Tue, 22 Jun 2021 12:48:48 +0000</created>
                <updated>Thu, 19 May 2022 09:26:20 +0000</updated>
                            <resolved>Thu, 19 May 2022 09:26:20 +0000</resolved>
                                    <version>1.9</version>
                                    <fixVersion>1.10.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="1800">0.5h</timespent>
                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 20 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0s6j4:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>