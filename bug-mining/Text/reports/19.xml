<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:53:59 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TEXT-84] RandomStringGenerator claims to be immutable, but isn&apos;t</title>
                <link>https://issues.apache.org/jira/browse/TEXT-84</link>
                <project id="12318221" key="TEXT">Commons Text</project>
                    <description>&lt;p&gt;&lt;tt&gt;RandomStringGenerator&lt;/tt&gt; claims to be immutable in the Javadocs, however it accepts a &lt;tt&gt;TextRandomProvider&lt;/tt&gt; object through the builder pattern. This object may altered by external code, thus breaking the immutability claim of our generator.&lt;/p&gt;

&lt;p&gt;A possible solution is to adjust the documentation for &lt;tt&gt;TextRandomProvider&lt;/tt&gt; and require implementations to be immutable. Alternatively, we can relax the documentation in &lt;tt&gt;RandomStringGenerator&lt;/tt&gt; to remove the immutability claim or state that the mutability is linked to the mutability of the random source (when provided).&lt;/p&gt;

&lt;p&gt;I think we will have to do the latter, since the former would forbid callers from supplying a &lt;tt&gt;UniformRandomProvider&lt;/tt&gt; instance as suggested in the documentation. Thoughts welcome.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13074885">TEXT-84</key>
            <summary>RandomStringGenerator claims to be immutable, but isn&apos;t</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dmjones500">Duncan Jones</assignee>
                                    <reporter username="dmjones500">Duncan Jones</reporter>
                        <labels>
                    </labels>
                <created>Thu, 25 May 2017 15:52:42 +0000</created>
                <updated>Sun, 4 Jun 2017 07:35:43 +0000</updated>
                            <resolved>Sun, 4 Jun 2017 07:35:43 +0000</resolved>
                                    <version>1.1</version>
                                    <fixVersion>1.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16026262" author="erans" created="Fri, 26 May 2017 13:06:32 +0000"  >&lt;p&gt;Indeed, neither immutability nor thread-safety can be claimed when using an external source.&lt;br/&gt;
And you are right that in this case, it would not be reasonable to expect that a RNG is immutable or thread-safe.&lt;/p&gt;

&lt;p&gt;At one point, I had contemplated adding a &quot;ThreadLocalRandom&quot; implementation in &quot;Commons RNG&quot;, but did not do it eventually because it would have implied making an arbitrary choice of the RNG algorithm.&lt;br/&gt;
Now, if we assume that the &quot;thread local&quot; instance is used in multi-threaded settings, can we conclude that the performance variation among the different generators will be dwarfed by the context switches and/or other computations?  If so, we could use the period as the selection criterion.&lt;/p&gt;

&lt;p&gt;WDYT?&lt;/p&gt;</comment>
                            <comment id="16026279" author="kinow" created="Fri, 26 May 2017 13:26:20 +0000"  >&lt;p&gt;+1 for adjusting the documentation. There are other classes that state that instances are thread safe if a certain property is thread safe. Perhaps a similar comment here would be enough? Here&apos;s an &lt;a href=&quot;https://commons.apache.org/proper/commons-lang/apidocs/org/apache/commons/lang3/tuple/ImmutablePair.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;example from lang&lt;/a&gt; which reads:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;An immutable pair consisting of two Object elements.&lt;/p&gt;

&lt;p&gt;Although the implementation is immutable, there is no restriction on the objects that may be stored. If mutable objects are stored in the pair, then the pair itself effectively becomes mutable. The class is also final, so a subclass can not add undesirable behaviour.&lt;/p&gt;

&lt;p&gt;#ThreadSafe# if both paired objects are thread-safe&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="16027535" author="erans" created="Sat, 27 May 2017 18:48:55 +0000"  >&lt;p&gt;Is there a value in &quot;conditional immutability&quot;?&lt;br/&gt;
In your &quot;Pair&quot; example, when a bit of code is passed an instance, how does it know whether it is mutable or not?&lt;/p&gt;</comment>
                            <comment id="16028771" author="dmjones500" created="Tue, 30 May 2017 06:08:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;WDYT?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I suppose you could run some tests to prove your assumptions around performance?&lt;/p&gt;

&lt;p&gt;Supposing it existed, how would you propose to use ThreadLocalRandom with RandomStringGenerator? &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is there a value in &quot;conditional immutability&quot;?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In the Pair example, I could imagine some limited usefulness (perhaps when composing Pairs into another object). Less so with RandomStringGenerator. &lt;/p&gt;</comment>
                            <comment id="16028839" author="sebb@apache.org" created="Tue, 30 May 2017 08:19:33 +0000"  >&lt;p&gt;If we are not sure of the way to go, surely the obvious route is to document the conditions for immutability and thread-safety?&lt;br/&gt;
(I suspect that thread-safety is the more important criterion here)&lt;/p&gt;

&lt;p&gt;If it turns out that there really is a need for the RSG to be unconditionally thread-safe, this can be addressed at a later date.&lt;/p&gt;</comment>
                            <comment id="16029262" author="erans" created="Tue, 30 May 2017 11:01:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;I suppose you could run some tests to prove your assumptions around performance?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;First, I&apos;m not going to spend time on this, given the experience I had with trying to get (constructive) feedback about the subject when I was redesigning/implementing the RNG classes originally in &quot;Commons Math&quot; (see ML archive sometime around December 2015).&lt;/p&gt;

&lt;p&gt;Second, depending on the intended use-cases, it might not even be necessary to go beyond a crude estimation, by looking at the tables in the &lt;a href=&quot;http://commons.apache.org/proper/commons-rng/userguide/rng.html#a4._Performance&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&quot;Commons RNG&quot; userguide&lt;/a&gt;: For generating &lt;tt&gt;int&lt;/tt&gt; values (the case at hand for this discussion), the performance range is 44% to 124% that of &lt;tt&gt;java.util.Random&lt;/tt&gt; (which is &lt;b&gt;synchronized&lt;/b&gt;).&lt;/p&gt;

&lt;p&gt;The question is whether &quot;Commons Text&quot; wants to make an assumption about usage.&lt;br/&gt;
If not, it should also not assume that the RNG is thread-safe because it will necessarily hamper performance (alternatively, to have a non-synchronized, yet thread-safe RNG, it should be &lt;a href=&quot;https://docs.oracle.com/javase/8/docs/api/java/util/SplittableRandom.html#split--&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;&quot;splittable&quot;&lt;/a&gt; but it will seriously complicate the API).&lt;/p&gt;

&lt;p&gt;Currently, the default behaviour assumes that performance is not crucial since it uses &lt;tt&gt;java.concurrent.ThreadLocalRandom&lt;/tt&gt; (which &lt;b&gt;extends&lt;/b&gt;&lt;tt&gt;java.util.Random&lt;/tt&gt;).&lt;br/&gt;
The non-default behaviour explicitly allows better performance, at the &quot;cost&quot; of leaving parallelism issues to the caller.&lt;/p&gt;

&lt;p&gt;So an option is to leave the code as is, only changing the Javadoc to read:&lt;/p&gt;
&lt;hr /&gt;
&lt;p&gt;RandomStringGenerator instances are thread-safe only if using the default RNG.&lt;br/&gt;
If a custom RNG is set by calling the method &lt;a href=&quot;http://commons.apache.org/proper/commons-text/javadocs/api-release/org/apache/commons/text/RandomStringGenerator.Builder.html#usingRandom-org.apache.commons.text.TextRandomProvider-&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;usingRandom&lt;/a&gt;, thread-safety must be ensured externally.&lt;/p&gt;
&lt;hr /&gt;

&lt;blockquote&gt;&lt;p&gt;Supposing it existed, how would you propose to use ThreadLocalRandom with RandomStringGenerator?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It would still be up to the user to call &lt;tt&gt;usingRandom(RandomSource.current())&lt;/tt&gt;, similar to what is done with the &lt;tt&gt;ThreadLocalRandom&lt;/tt&gt; class of the JDK.&lt;/p&gt;</comment>
                            <comment id="16029381" author="chtompki" created="Tue, 30 May 2017 12:52:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;If we are not sure of the way to go, surely the obvious route is to document the conditions for immutability and thread-safety?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Documentation feels like a good path. I think the better question is: do we think that this warrants a 1.1.1? I&apos;m willing to go that route if we feel it urgent enough.&lt;/p&gt;</comment>
                            <comment id="16036202" author="dmjones500" created="Sun, 4 Jun 2017 07:35:43 +0000"  >&lt;p&gt;Fixed in 4004cfdee.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 23 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3fgzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>