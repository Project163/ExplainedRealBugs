<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 21:53:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[TEXT-64] Investigate locale issue in ExtendedMessageFormatTest</title>
                <link>https://issues.apache.org/jira/browse/TEXT-64</link>
                <project id="12318221" key="TEXT">Commons Text</project>
                    <description>&lt;p&gt;During release testing, Bruno found the following problem, needing investigation, (&lt;a href=&quot;http://markmail.org/message/hhio4ye2xlvdznlv&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/hhio4ye2xlvdznlv&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;/* &amp;#8212; snip &amp;#8211; */&lt;/p&gt;

&lt;p&gt;Results :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Failed tests: 
ExtendedMessageFormatTest.testBuiltInChoiceFormat:211-&amp;gt;checkBuiltInFormat:336-&amp;gt;checkBuiltInFormat:347-&amp;gt;checkBuiltInFormat:376
format Pattern=[1234.5: {0,choice,1#One|2#Two|3#Many {0,number}}], locale=[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;]
expected:&amp;lt;1234.5: Many 1[.234,]5&amp;gt; but was:&amp;lt;1234.5: Many 1[,234.]5&amp;gt;
ExtendedMessageFormatTest.testBuiltInDateTimeFormat:230-&amp;gt;checkBuiltInFormat:336-&amp;gt;checkBuiltInFormat:347-&amp;gt;checkBuiltInFormat:376
format Pattern=[1: {0,date,&lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt;}], locale=[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] expected:&amp;lt;1: [23/01]/07&amp;gt; but
was:&amp;lt;1: [1/23]/07&amp;gt;
ExtendedMessageFormatTest.testBuiltInNumberFormat:277-&amp;gt;checkBuiltInFormat:336-&amp;gt;checkBuiltInFormat:347-&amp;gt;checkBuiltInFormat:376
format Pattern=[1: {0,number}], locale=[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] expected:&amp;lt;1: 6[.543,]21&amp;gt; but
was:&amp;lt;1: 6[,543.]21&amp;gt;
ExtendedMessageFormatTest.testExtendedAndBuiltInFormats:141 &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; expected:&amp;lt;Name:
JOHN DOE DOB: [23/01/07 Salary: R$ 12.345,]67&amp;gt; but was:&amp;lt;Name: JOHN DOE DOB:
[1/23/07 Salary: $12,345.]67&amp;gt;
ExtendedMessageFormatTest.testOverriddenBuiltinFormat:253-&amp;gt;checkBuiltInFormat:347-&amp;gt;checkBuiltInFormat:376
format Pattern=[1: {0,date}], locale=[&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;] expected:&amp;lt;1: [23/01/]2007&amp;gt; but
was:&amp;lt;1: [Jan 23, ]2007&amp;gt;

Tests run: 476, Failures: 5, Errors: 0, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 11.385 s
[INFO] Finished at: 2017-02-06T14:07:52-02:00
[INFO] Final Memory: 30M/328M
[INFO] ------------------------------------------------------------------------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;/* &amp;#8212; snip &amp;#8211; */&lt;/p&gt;

&lt;p&gt;Here&apos;s my env:&lt;/p&gt;

&lt;p&gt;Apache Maven 3.3.9&lt;br/&gt;
Maven home: /usr/share/maven&lt;br/&gt;
Java version: 1.8.0_111, vendor: Oracle Corporation&lt;br/&gt;
Java home: /usr/lib/jvm/java-8-oracle/jre&lt;br/&gt;
Default locale: en_US, platform encoding: UTF-8&lt;br/&gt;
OS name: &quot;linux&quot;, version: &quot;4.4.0-59-generic&quot;, arch: &quot;amd64&quot;, family: &quot;unix&quot;&lt;/p&gt;

&lt;p&gt;Even though the JVM locale seems to be set to en_US, I&apos;m in Brazil right now&lt;br/&gt;
with the time in Ubuntu set to local time, as well as the locale (or so I&lt;br/&gt;
think). Here&apos;s my output of running the `locale` command.&lt;/p&gt;

&lt;p&gt;/* &amp;#8212; snip &amp;#8212; */&lt;br/&gt;
$ locale&lt;br/&gt;
LANG=en_US.UTF-8&lt;br/&gt;
LANGUAGE=en_US&lt;br/&gt;
LC_CTYPE=pt_BR.UTF-8&lt;br/&gt;
LC_NUMERIC=pt_BR.UTF-8&lt;br/&gt;
LC_TIME=pt_BR.UTF-8&lt;br/&gt;
LC_COLLATE=&quot;en_US.UTF-8&quot;&lt;br/&gt;
LC_MONETARY=pt_BR.UTF-8&lt;br/&gt;
LC_MESSAGES=&quot;en_US.UTF-8&quot;&lt;br/&gt;
LC_PAPER=pt_BR.UTF-8&lt;br/&gt;
LC_NAME=pt_BR.UTF-8&lt;br/&gt;
LC_ADDRESS=pt_BR.UTF-8&lt;br/&gt;
LC_TELEPHONE=pt_BR.UTF-8&lt;br/&gt;
LC_MEASUREMENT=pt_BR.UTF-8&lt;br/&gt;
LC_IDENTIFICATION=pt_BR.UTF-8&lt;br/&gt;
LC_ALL=&lt;br/&gt;
/* &amp;#8212; snip &amp;#8212; */&lt;/p&gt;</description>
                <environment></environment>
        <key id="13042289">TEXT-64</key>
            <summary>Investigate locale issue in ExtendedMessageFormatTest</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kinow">Bruno P. Kinoshita</assignee>
                                    <reporter username="chtompki">Rob Tompkins</reporter>
                        <labels>
                    </labels>
                <created>Sat, 11 Feb 2017 14:49:48 +0000</created>
                <updated>Fri, 17 Mar 2017 12:24:50 +0000</updated>
                            <resolved>Sat, 4 Mar 2017 01:11:28 +0000</resolved>
                                    <version>1.0-beta-1</version>
                                    <fixVersion>1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="15885024" author="chtompki" created="Mon, 27 Feb 2017 01:54:56 +0000"  >&lt;p&gt;I&apos;ve been unable to reproduce this on my OS X 10.12.3 machine. But, that doesn&apos;t mean that such an issue doesn&apos;t exist. &lt;/p&gt;

&lt;p&gt;At first look it feels like &lt;tt&gt;NumberFormat.getAvailableLocales()&lt;/tt&gt; is returning an array of length 0. I plan to pursue some further investigation to see what happens when I manufacture that outcome.&lt;/p&gt;</comment>
                            <comment id="15885728" author="chtompki" created="Mon, 27 Feb 2017 13:01:55 +0000"  >&lt;p&gt;The above hypothesis is incorrect. The scenario in which this is happening is under execution of: &lt;a href=&quot;https://github.com/apache/commons-text/blob/master/src/test/java/org/apache/commons/text/ExtendedMessageFormatTest.java#L372&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-text/blob/master/src/test/java/org/apache/commons/text/ExtendedMessageFormatTest.java#L372&lt;/a&gt;&lt;br/&gt;
which uses &lt;tt&gt;Locale.getDefault()&lt;/tt&gt; as the locale for which the tests get run.&lt;/p&gt;

&lt;p&gt;Before iterating through the array of available locales, we attempt with the default locale.&lt;/p&gt;</comment>
                            <comment id="15885774" author="chtompki" created="Mon, 27 Feb 2017 13:22:25 +0000"  >&lt;p&gt;We are comparing the results from &lt;tt&gt;java.text.MessageFormat&lt;/tt&gt; with those from &lt;tt&gt;org.apache.commons.text.ExtendedMessageFormat&lt;/tt&gt;, and there are slight differences when calling &lt;tt&gt;Locale.getDefault&lt;/tt&gt;. Namely:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; MessageFormat(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; pattern) {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.locale = Locale.getDefault(Locale.Category.FORMAT);
    applyPattern(pattern);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;versus&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ExtendedMessageFormat(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; pattern) {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;(pattern, Locale.getDefault());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The key differences here in the &lt;tt&gt;Locale&lt;/tt&gt; class reside in the &lt;tt&gt;initDefault&lt;/tt&gt; method:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Locale initDefault() {
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; language, region, script, country, variant;
    language = AccessController.doPrivileged(
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GetPropertyAction(&lt;span class=&quot;code-quote&quot;&gt;&quot;user.language&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;en&quot;&lt;/span&gt;));
    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; compatibility, check &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; old user.region property
&lt;/span&gt;    region = AccessController.doPrivileged(
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GetPropertyAction(&lt;span class=&quot;code-quote&quot;&gt;&quot;user.region&quot;&lt;/span&gt;));
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (region != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-comment&quot;&gt;// region can be of form country, country_variant, or _variant
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = region.indexOf(&lt;span class=&quot;code-quote&quot;&gt;&apos;_&apos;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i &amp;gt;= 0) {
            country = region.substring(0, i);
            variant = region.substring(i + 1);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            country = region;
            variant = &quot;&quot;;
        }
        script = &quot;&quot;;
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        script = AccessController.doPrivileged(
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GetPropertyAction(&lt;span class=&quot;code-quote&quot;&gt;&quot;user.script&quot;&lt;/span&gt;, &quot;&quot;));
        country = AccessController.doPrivileged(
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GetPropertyAction(&lt;span class=&quot;code-quote&quot;&gt;&quot;user.country&quot;&lt;/span&gt;, &quot;&quot;));
        variant = AccessController.doPrivileged(
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GetPropertyAction(&lt;span class=&quot;code-quote&quot;&gt;&quot;user.variant&quot;&lt;/span&gt;, &quot;&quot;));
    }

    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getInstance(language, script, country, variant, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
}

&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Locale initDefault(Locale.Category category) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getInstance(
        AccessController.doPrivileged(
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GetPropertyAction(category.languageKey, defaultLocale.getLanguage())),
        AccessController.doPrivileged(
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GetPropertyAction(category.scriptKey, defaultLocale.getScript())),
        AccessController.doPrivileged(
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GetPropertyAction(category.countryKey, defaultLocale.getCountry())),
        AccessController.doPrivileged(
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; GetPropertyAction(category.variantKey, defaultLocale.getVariant())),
        &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I suppose we could add the &lt;tt&gt;Locale.Category&lt;/tt&gt; to the default locale creation, but as I&apos;m unfamiliar with the mechanics here I plan to bubble this up to the ML.&lt;/p&gt;</comment>
                            <comment id="15895358" author="chtompki" created="Sat, 4 Mar 2017 01:11:01 +0000"  >&lt;p&gt;Adding Bruno&apos;s pr for tracking.&lt;/p&gt;</comment>
                            <comment id="15895359" author="chtompki" created="Sat, 4 Mar 2017 01:11:29 +0000"  >&lt;p&gt;Pull request has been merged.&lt;/p&gt;</comment>
                            <comment id="15929865" author="chtompki" created="Fri, 17 Mar 2017 12:24:50 +0000"  >&lt;p&gt;Released 1.0&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 35 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i39y4f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>