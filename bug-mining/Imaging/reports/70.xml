<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:30:35 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IMAGING-1] Loading Black and White PNGs produces darker images.</title>
                <link>https://issues.apache.org/jira/browse/IMAGING-1</link>
                <project id="12313421" key="IMAGING">Commons Imaging</project>
                    <description>&lt;p&gt;When saving and loading pngs with Sanselan, black and white images get&lt;br/&gt;
darker with each save and load. All images are held in&lt;br/&gt;
memory as BufferedImages (ARGB). Have you ever seen this weird behavior&lt;br/&gt;
before or how I may fix it?&lt;/p&gt;

&lt;p&gt;The affected images may be all PNGs, but I see this effect happening in images that contain mostly black and white pixels. The image I use to demonstrate this problem is from a wikipedia page of Linus Pauling: &lt;a href=&quot;http://en.wikipedia.org/wiki/Linus_Pauling&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://en.wikipedia.org/wiki/Linus_Pauling&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The image basically goes to black after saving and loading 3/4 times.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Mac OSX 10.5+, Java 1.5+, Sanselan 0.94&lt;/p&gt;</environment>
        <key id="12401560">IMAGING-1</key>
            <summary>Loading Black and White PNGs produces darker images.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bakeryreject">Kevin Theisen</reporter>
                        <labels>
                    </labels>
                <created>Sun, 3 Aug 2008 20:31:50 +0000</created>
                <updated>Mon, 7 May 2012 14:37:45 +0000</updated>
                            <resolved>Thu, 7 Aug 2008 05:31:30 +0000</resolved>
                                    <version>0.94-incubator</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                                <comments>
                            <comment id="12619379" author="clr" created="Sun, 3 Aug 2008 21:12:59 +0000"  >&lt;p&gt;Would it be possible to reproduce this issue with an image that can be licensed to Apache? Not a huge problem if not, but it would be nice to have a regression test case that can be checked into svn...&lt;/p&gt;
</comment>
                            <comment id="12619380" author="bakeryreject" created="Sun, 3 Aug 2008 21:42:28 +0000"  >&lt;p&gt;After further testing, this problem occurs on Windows as well. However, I did discover that only images WITHOUT alpha experience this problem. I am uploading the original darkening demonstration as well as two images I created, testImage.png and testImageNoAlpha.png. I release these images (testImage.png and testImageNoAlpha.png) to the public. If you read and write testImage.png, you will notice no change, while reading and writing testImageNoAlpha.png will experience the mentioned darkening. Is there a way to specify that a created PNG should always have transparency enabled?&lt;/p&gt;</comment>
                            <comment id="12619388" author="cmchen" created="Mon, 4 Aug 2008 00:14:29 +0000"  >&lt;p&gt;I can&apos;t reproduce this issue.  I can &lt;/p&gt;

&lt;p&gt;Kevin, can you please post a code snippet that reproduces this issue?&lt;/p&gt;

&lt;p&gt;Also, I&apos;ve made source and binary snapshots.  You might want to try to see if you can reproduce with them:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://people.apache.org/~cmchen/apache-sanselan-incubating-0.95-04082008-snapshot-bin.zip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~cmchen/apache-sanselan-incubating-0.95-04082008-snapshot-bin.zip&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://people.apache.org/~cmchen/apache-sanselan-incubating-0.95-04082008-snapshot-src.zip&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://people.apache.org/~cmchen/apache-sanselan-incubating-0.95-04082008-snapshot-src.zip&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="12619389" author="cmchen" created="Mon, 4 Aug 2008 00:16:56 +0000"  >&lt;p&gt;Also, I notice that image you linked is a Jpeg, not a Png.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://en.wikipedia.org/wiki/Linus_Pauling&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://en.wikipedia.org/wiki/Linus_Pauling&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="12619392" author="bakeryreject" created="Mon, 4 Aug 2008 00:42:07 +0000"  >&lt;p&gt;Charles,&lt;/p&gt;

&lt;p&gt;I have tested the snapshot and see the same behavior. The wikipedia image is a jpg, but all images in my apps are saved and then subsequently loaded as only pngs to easily transfer embedded images on all platforms (after the initial read to a BufferedImage). This, however, does explain why the buffered image that is loaded from the jpg does not have alpha.&lt;/p&gt;

&lt;p&gt;The code I use is as follows:&lt;/p&gt;

&lt;p&gt;TO READ:&lt;br/&gt;
final byte[] dataArray = Base64.decodeBase64(entire.getBytes()); //entire is just the Base64 string&lt;br/&gt;
final BufferedImage bi = Sanselan.getBufferedImage(dataArray);&lt;/p&gt;

&lt;p&gt;//I use org.apache.commons.codec.binary.Base64 to convert the binary to and from Base64 for ease in embedding into the text files, although I have used my own algorithms (which are 100% correct) for converting into HEX instead, and I still see the same problem&lt;/p&gt;

&lt;p&gt;TO WRITE:&lt;br/&gt;
//image is the BufferedImage&lt;br/&gt;
final byte[] bytes = Sanselan.writeImageToBytes(image, ImageFormat.IMAGE_FORMAT_PNG, null);&lt;br/&gt;
final byte[] base64Bytes = Base64.encodeBase64(bytes);&lt;br/&gt;
sb.append(new String(base64Bytes));&lt;/p&gt;

&lt;p&gt;I should also mention that between the reading and the display of the image, the BufferedImage passes through this function to obtain an image compatible with the current hardware (for rendering speed)&lt;/p&gt;

&lt;p&gt;public static BufferedImage toCompatibleImage(BufferedImage image) {&lt;br/&gt;
		if (isHeadless()) &lt;/p&gt;
{ return image; }&lt;br/&gt;
		if (image.getColorModel().equals(getGraphicsConfiguration().getColorModel())) { return image; }
&lt;p&gt;		final BufferedImage compatibleImage = getGraphicsConfiguration().createCompatibleImage(image.getWidth(), image.getHeight(), image.getTransparency());&lt;br/&gt;
		final Graphics g = compatibleImage.getGraphics();&lt;br/&gt;
		g.drawImage(image, 0, 0, null);&lt;br/&gt;
		g.dispose();&lt;br/&gt;
		return compatibleImage;&lt;br/&gt;
	}&lt;/p&gt;

&lt;p&gt;This may, in fact, be the factor that differentiates us.&lt;/p&gt;

&lt;p&gt;As mentioned above, I removed the Base64 package from the implementation and I still saw the same problem. I am not quite sure what I am doing wrong, but it may be that I am not specifying the correct attributes for the writer?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Kevin&lt;/p&gt;</comment>
                            <comment id="12619393" author="bakeryreject" created="Mon, 4 Aug 2008 00:44:11 +0000"  >&lt;p&gt;Forgot to add the getGraphicsConfiguration() function:&lt;/p&gt;

&lt;p&gt;// Returns the graphics configuration for the primary screen&lt;br/&gt;
	private static GraphicsConfiguration getGraphicsConfiguration() &lt;/p&gt;
{
		return GraphicsEnvironment.getLocalGraphicsEnvironment().getDefaultScreenDevice().getDefaultConfiguration();
	}</comment>
                            <comment id="12619697" author="cmchen" created="Mon, 4 Aug 2008 20:49:22 +0000"  >&lt;p&gt;Its very possible the problem lies in that toCompatibleImage() method.  I would write some code that examines whether that method is darkening the image.&lt;/p&gt;</comment>
                            <comment id="12620515" author="bakeryreject" created="Thu, 7 Aug 2008 05:30:46 +0000"  >&lt;p&gt;Hi Charles,&lt;/p&gt;

&lt;p&gt;Sorry for the late update, things got busy. I short-circuited the function and yes, the image no longer gets darker. Since this is not a problem with Sanselan I will close this issue, thanks for your help.&lt;/p&gt;

&lt;p&gt;I will look into this and hopefully find out what is going on, as that function is very important for applications painting many images. Hopefully I can figure it out soon. Let me know if you have any ideas.&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Kevin&lt;/p&gt;</comment>
                            <comment id="12620516" author="bakeryreject" created="Thu, 7 Aug 2008 05:31:30 +0000"  >&lt;p&gt;Not a problem with Sanselan.&lt;/p&gt;</comment>
                            <comment id="12620542" author="cmchen" created="Thu, 7 Aug 2008 07:57:28 +0000"  >&lt;p&gt;Thanks Kevin,&lt;/p&gt;

&lt;p&gt;   Please do let us know - using &quot;compatible&quot; images is a common performance technique, so unraveling this problem would definitely be interesting.  &lt;/p&gt;

&lt;p&gt;   I suppose my one guess would be that the compatible image might be doing some gamma correction to the specific gamma or even icc profile of that device - your monitor.   &lt;/p&gt;

&lt;p&gt;Charles.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12387433" name="PNGDarker.png" size="99966" author="bakeryreject" created="Sun, 3 Aug 2008 21:42:28 +0000"/>
                            <attachment id="12387434" name="testImage.png" size="3250" author="bakeryreject" created="Sun, 3 Aug 2008 21:42:28 +0000"/>
                            <attachment id="12387435" name="testImageNoAlpha.png" size="3511" author="bakeryreject" created="Sun, 3 Aug 2008 21:42:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>172234</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 years, 16 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0wo67:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>188721</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>