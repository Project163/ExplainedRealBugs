<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:30:02 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IMAGING-99] java.io.IOException: Could not read block</title>
                <link>https://issues.apache.org/jira/browse/IMAGING-99</link>
                <project id="12313421" key="IMAGING">Commons Imaging</project>
                    <description>&lt;p&gt;We have found that certain images could not be read with imaging, even they usually appear to be fine. This is the stack trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;java.io.IOException: Could not read block (block start: 442, block length: 8861, data length: 9301).
	at org.apache.commons.imaging.common.bytesource.ByteSourceArray.getBlock(ByteSourceArray.java:46)
	at org.apache.commons.imaging.formats.tiff.TiffReader.getJpegRawImageData(TiffReader.java:491)
	at org.apache.commons.imaging.formats.tiff.TiffReader.readDirectory(TiffReader.java:216)
	at org.apache.commons.imaging.formats.tiff.TiffReader.readDirectory(TiffReader.java:103)
	at org.apache.commons.imaging.formats.tiff.TiffReader.readDirectory(TiffReader.java:272)
	at org.apache.commons.imaging.formats.tiff.TiffReader.readDirectory(TiffReader.java:103)
	at org.apache.commons.imaging.formats.tiff.TiffReader.readDirectories(TiffReader.java:95)
	at org.apache.commons.imaging.formats.tiff.TiffReader.read(TiffReader.java:421)
	at org.apache.commons.imaging.formats.tiff.TiffReader.readContents(TiffReader.java:412)
	at org.apache.commons.imaging.formats.tiff.TiffImageParser.getMetadata(TiffImageParser.java:132)
	at org.apache.commons.imaging.ImageParser.getMetadata(ImageParser.java:203)
	at org.apache.commons.imaging.formats.jpeg.JpegImageParser.getExifMetadata(JpegImageParser.java:335)
	at org.apache.commons.imaging.formats.jpeg.JpegImageParser.getMetadata(JpegImageParser.java:295)
	at org.apache.commons.imaging.formats.jpeg.JpegImageParser.getImageInfo(JpegImageParser.java:668)
	at org.apache.commons.imaging.Imaging.getImageInfo(Imaging.java:683)
	at org.apache.commons.imaging.Imaging.getImageInfo(Imaging.java:615)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Further research showed that these images usually are made with a certain type of camera. I have searched flicker and found a image which shows the same problems. (This image does not belong to me, but I guess this should be fine for testing purposes)&lt;br/&gt;
&lt;a href=&quot;http://www.flickr.com/photos/sara-net/3880941727/sizes/o/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.flickr.com/photos/sara-net/3880941727/sizes/o/&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12616047">IMAGING-99</key>
            <summary>java.io.IOException: Could not read block</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="st.h">st.h</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Nov 2012 11:16:39 +0000</created>
                <updated>Fri, 3 May 2019 08:39:53 +0000</updated>
                            <resolved>Tue, 4 Dec 2012 04:39:52 +0000</resolved>
                                    <version>0.97</version>
                                    <fixVersion>1.0-alpha1</fixVersion>
                                    <component>Format: JPEG</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13499112" author="st.h" created="Fri, 16 Nov 2012 20:12:50 +0000"  >&lt;p&gt;The problem here appears to be a wrong JPEGInterchangeFormatLength Tag. The value specified is 8861, with an offset of 442 specified in JPEGInterchangeFormat. However, the actual data viewed in a hex editor appears to be 8860 bytes long (including SOI and EOI).&lt;/p&gt;

&lt;p&gt;I would suggest replacing this function in TiffReader:513&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; JpegImageData getJpegRawImageData(ByteSource byteSource,
            TiffDirectory directory) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ImageReadException, IOException {
        ImageDataElement element = directory.getJpegRawImageDataElement();
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; offset = element.offset;
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length = element.length;
        &lt;span class=&quot;code-comment&quot;&gt;// Sony DCR-PC110 has an off-by-one error.
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (offset + length == byteSource.getLength() + 1) {
            length--;
        }
        &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; data[] = byteSource.getBlock(offset, length);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JpegImageData(offset, length, data);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;with something, that is capable of dealing with more generic errors - instead of just using a fix for the Sony DCR-PC110 problem.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; JpegImageData getJpegRawImageData(ByteSource byteSource,
            TiffDirectory directory) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ImageReadException, IOException {
        ImageDataElement element = directory.getJpegRawImageDataElement();
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; offset = element.offset;
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length = element.length;
        &lt;span class=&quot;code-comment&quot;&gt;// In &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; the length is not correct, adjust it and check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the last read &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; actually is the end of the image
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (offset + length &amp;gt; byteSource.getLength()) {
            length = (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) byteSource.getLength() - offset;
        }
        &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; data[] = byteSource.getBlock(offset, length);
        &lt;span class=&quot;code-comment&quot;&gt;// check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the last read &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; is actually the end of the image data
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (data[data.length - 2] != -1 || data[data.length - 1] != -39) {
        	&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ImageReadException(&lt;span class=&quot;code-quote&quot;&gt;&quot;End of image could not be found at expected location&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; JpegImageData(offset, length, data);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Actually I am still somewhat confused, why the data byte array always seems to return an encoding independent format. Probably there has been a conversion somewhere before, but I haven&apos;t had the time yet to figure that out to be entirely sure. At least the above code works fine with the included tests.&lt;/p&gt;</comment>
                            <comment id="13509501" author="damjan" created="Tue, 4 Dec 2012 04:39:53 +0000"  >&lt;p&gt;Thank you, fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>257662</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 50 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0k3w7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>115448</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>