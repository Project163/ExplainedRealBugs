<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:29:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IMAGING-90] ClassCastException: [I cannot be cast to java.lang.Number in TiffReader.readDirectory(TiffReader.java:239) and JpegImageParser</title>
                <link>https://issues.apache.org/jira/browse/IMAGING-90</link>
                <project id="12313421" key="IMAGING">Commons Imaging</project>
                    <description>&lt;p&gt;Version 1.0 rc2. (Checked the trunk, but couldn&apos;t find any commits concerning this issue)&lt;/p&gt;

&lt;p&gt;When calling Imaging.getImageInfo on certain (in this case jpeg) images, there might be a ClassCastException in TiffReader:239 if the entry is not a Number.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; subDirectoryOffset = ((&lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt;) entry.getValue())
                            .intValue();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This may occur if the entry does not have any actual value. This is the entry shown by the debugger:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 40965 (0xa005: InteropOffset):  (0 &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A quick solution to this problem might be to check if entry.getValue() could be cast to a Number before doing so. Probably there is a more elegant way, but I haven&apos;t had the time to analyze this thoroughly.&lt;/p&gt;

&lt;p&gt;Here is the stack trace:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Caused by: java.lang.ClassCastException: [I cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to java.lang.&lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt;
        at org.apache.commons.imaging.formats.tiff.TiffReader.readDirectory(TiffReader.java:239)
        at org.apache.commons.imaging.formats.tiff.TiffReader.readDirectory(TiffReader.java:253)
        at org.apache.commons.imaging.formats.tiff.TiffReader.readDirectory(TiffReader.java:103)
        at org.apache.commons.imaging.formats.tiff.TiffReader.readDirectories(TiffReader.java:95)
        at org.apache.commons.imaging.formats.tiff.TiffReader.read(TiffReader.java:419)
        at org.apache.commons.imaging.formats.tiff.TiffReader.readContents(TiffReader.java:410)
        at org.apache.commons.imaging.formats.tiff.TiffImageParser.getMetadata(TiffImageParser.java:132)
        at org.apache.commons.imaging.ImageParser.getMetadata(ImageParser.java:203)
        at org.apache.commons.imaging.formats.jpeg.JpegImageParser.getExifMetadata(JpegImageParser.java:335)
        at org.apache.commons.imaging.formats.jpeg.JpegImageParser.getMetadata(JpegImageParser.java:295)
        at org.apache.commons.imaging.formats.jpeg.JpegImageParser.getImageInfo(JpegImageParser.java:668)
        at org.apache.commons.imaging.Imaging.getImageInfo(Imaging.java:683)
        at org.apache.commons.imaging.Imaging.getImageInfo(Imaging.java:615)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The same issue applies to similar uses of TiffField, for instance JpegImageParser around line 676.&lt;/p&gt;</description>
                <environment>&lt;p&gt;jdk 1.6.0_33&lt;/p&gt;</environment>
        <key id="12604214">IMAGING-90</key>
            <summary>ClassCastException: [I cannot be cast to java.lang.Number in TiffReader.readDirectory(TiffReader.java:239) and JpegImageParser</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="st.h">st.h</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Aug 2012 13:37:29 +0000</created>
                <updated>Fri, 3 May 2019 08:39:37 +0000</updated>
                            <resolved>Sun, 2 Dec 2012 10:00:35 +0000</resolved>
                                    <version>1.0-alpha1</version>
                                    <fixVersion>1.0-alpha1</fixVersion>
                                    <component>Format: JPEG</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="13446643" author="damjan" created="Sat, 1 Sep 2012 10:29:48 +0000"  >&lt;p&gt;Can I please see a sample image with this issue?&lt;/p&gt;</comment>
                            <comment id="13481338" author="st.h" created="Mon, 22 Oct 2012 12:43:12 +0000"  >&lt;p&gt;Sorry for the late update - I haven&apos;t received any notification about the comment. Unfortunately I can not provide a sample image at the moment as they do not belong to me. Sorry about that.&lt;/p&gt;</comment>
                            <comment id="13498748" author="st.h" created="Fri, 16 Nov 2012 11:45:28 +0000"  >&lt;p&gt;I finally had the time to look into this more thoroughly.&lt;br/&gt;
The problem appears to be that some images specify a count of 0 for the Interoperability Tag.&lt;br/&gt;
This is the content of the tag in hex of a big endian encoded image:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;A0 05 00 04 00 00 00 00 00 00 05 10
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I translated this to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;A0 05 = Interoperability tag
00 04 = LONG
00 00 00 00 = count 0
00 00 05 10 = 1296
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If I interprete JEITA CP-3451 correctly, it specifies a count of 1 for the Interoperability Tag. However, looking into the offset of 1296 beginning from the TIFF Header, I find this data:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;00 02
00 01 00 02 00 00 00 04 52 39 38 00 
00 02 00 07 00 00 00 04 30 31 30 30
00 00 00 00
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If I interprete this correctly, this looks like valid interoperability tags. So I guess the length of the Interoperability Tag has been set incorrectly.&lt;br/&gt;
I think the question here is if Tags of length 0 should be ignored, for the sake of being able to process the image? Probably a strict mode which throws an exception and a less strict mode which ignores the error might be a good idea?&lt;/p&gt;</comment>
                            <comment id="13508193" author="damjan" created="Sun, 2 Dec 2012 10:00:35 +0000"  >&lt;p&gt;Fixed by allowing for non-1 tag lengths in non-strict mode (and then ignoring those tags); getMetadata() should now work, and other methods may require explicitly setting strict mode to off. Thank you for your bug report.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250310</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            12 years, 50 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ax13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61624</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>