<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:30:10 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IMAGING-137] Can not set EXIF_TAG_EXIF_VERSION tag</title>
                <link>https://issues.apache.org/jira/browse/IMAGING-137</link>
                <project id="12313421" key="IMAGING">Commons Imaging</project>
                    <description>&lt;p&gt;I am unable to set EXIF_TAG_EXIF_VERSION.&lt;/p&gt;

&lt;p&gt;I am using Maven with the following settings (the build date is 3/25/2014):&lt;br/&gt;
&amp;lt;dependency&amp;gt;&lt;br/&gt;
      &amp;lt;groupId&amp;gt;org.apache.commons&amp;lt;/groupId&amp;gt;&lt;br/&gt;
      &amp;lt;artifactId&amp;gt;commons-imaging&amp;lt;/artifactId&amp;gt;&lt;br/&gt;
      &amp;lt;version&amp;gt;1.0-SNAPSHOT&amp;lt;/version&amp;gt;&lt;br/&gt;
      &amp;lt;scope&amp;gt;compile&amp;lt;/scope&amp;gt;&lt;br/&gt;
   &amp;lt;/dependency&amp;gt;&lt;/p&gt;

&lt;p&gt;   &amp;lt;repository&amp;gt;&lt;br/&gt;
      &amp;lt;id&amp;gt;apache.snapshots&amp;lt;/id&amp;gt;&lt;br/&gt;
      &amp;lt;url&amp;gt;&lt;a href=&quot;http://repository.apache.org/snapshots/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://repository.apache.org/snapshots/&lt;/a&gt;&amp;lt;/url&amp;gt;&lt;br/&gt;
   &amp;lt;/repository&amp;gt;&lt;/p&gt;

&lt;p&gt;I get exceptions because it expects only 1 byte.&lt;/p&gt;

&lt;p&gt;If I debug and inspect the metadata for a JPG file with proper Exif data, it shows 4 bytes (48,50,50,48). This is consistent with this reference&lt;/p&gt;

&lt;p&gt;Here is my code. To run, change the file names and run.&lt;/p&gt;

&lt;p&gt;import java.io.BufferedOutputStream;&lt;br/&gt;
import java.io.File;&lt;br/&gt;
import java.io.FileOutputStream;&lt;br/&gt;
import java.io.IOException;&lt;br/&gt;
import java.io.OutputStream;&lt;br/&gt;
import java.util.List;&lt;br/&gt;
import org.apache.commons.imaging.ImageReadException;&lt;br/&gt;
import org.apache.commons.imaging.ImageWriteException;&lt;br/&gt;
import org.apache.commons.imaging.Imaging;&lt;br/&gt;
import org.apache.commons.imaging.common.IImageMetadata;&lt;br/&gt;
import org.apache.commons.imaging.common.IImageMetadata.IImageMetadataItem;&lt;br/&gt;
import org.apache.commons.imaging.formats.jpeg.JpegImageMetadata;&lt;br/&gt;
import org.apache.commons.imaging.formats.jpeg.exif.ExifRewriter;&lt;br/&gt;
import org.apache.commons.imaging.formats.tiff.TiffImageMetadata;&lt;br/&gt;
import org.apache.commons.imaging.formats.tiff.constants.ExifTagConstants;&lt;br/&gt;
import org.apache.commons.imaging.formats.tiff.write.TiffOutputDirectory;&lt;br/&gt;
import org.apache.commons.imaging.formats.tiff.write.TiffOutputSet;&lt;/p&gt;

&lt;p&gt;public class ExifExample&lt;br/&gt;
{&lt;br/&gt;
    public static void logImageMetaData(final File jpgImageFile) throws ImageReadException, IOException&lt;br/&gt;
    {&lt;br/&gt;
        // Get all metadata stored in Exif format (i.e., from JPEG or TIFF).&lt;br/&gt;
        final IImageMetadata metadata = Imaging.getMetadata(jpgImageFile);&lt;/p&gt;

&lt;p&gt;        if (metadata instanceof JpegImageMetadata)&lt;br/&gt;
        {&lt;br/&gt;
            final JpegImageMetadata jpegMetadata = (JpegImageMetadata) metadata;&lt;/p&gt;

&lt;p&gt;            final List&amp;lt;IImageMetadataItem&amp;gt; items = jpegMetadata.getItems();&lt;br/&gt;
            for (int i = 0; i &amp;lt; items.size(); i++)&lt;/p&gt;
            {
                final IImageMetadataItem item = items.get(i);
                System.out.println(&quot;    &quot;
                        + &quot;item: &quot; + item);
            }
&lt;p&gt;        }&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    private static TiffOutputSet getMetadata(final File jpegImageFile) throws ImageReadException, IOException, ImageWriteException&lt;br/&gt;
    {&lt;br/&gt;
        TiffOutputSet outputSet = null;&lt;/p&gt;

&lt;p&gt;        // metadata might be null if no metadata is found.&lt;br/&gt;
        final IImageMetadata metadata = Imaging.getMetadata(jpegImageFile);&lt;br/&gt;
        final JpegImageMetadata jpegMetadata = (JpegImageMetadata) metadata;&lt;br/&gt;
        if (null != jpegMetadata)&lt;br/&gt;
        {&lt;br/&gt;
            // Exif might be null if no Exif metadata is found.&lt;br/&gt;
            final TiffImageMetadata exif = jpegMetadata.getExif();&lt;/p&gt;

&lt;p&gt;            if (null != exif)&lt;/p&gt;
            {
                /* TiffImageMetadata class is immutable (read-only).
                 * TiffOutputSet class represents the Exif data to write.
                 *
                 * Usually, we want to update existing Exif metadata by changing
                 * the values of a few fields, or adding a field.
                 * 
                 * In these cases, it is easiest to use getOutputSet() to
                 * start with a &quot;copy&quot; of the fields read from the image.
                 */
                outputSet = exif.getOutputSet();
            }
&lt;p&gt;        }&lt;br/&gt;
        return outputSet;&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;    public static void writeExifData(File jpegImageFile, File destImageFile) throws IOException, ImageReadException, ImageWriteException&lt;br/&gt;
    {&lt;br/&gt;
        try (OutputStream os = new BufferedOutputStream(new FileOutputStream(destImageFile)))&lt;/p&gt;
        {
            TiffOutputSet outputSet = new TiffOutputSet();

            // Create the Exif directory tags
            final TiffOutputDirectory exifDirectory = outputSet.getOrCreateExifDirectory();

            /*
             * TODO: How do you set ExifVersion
             * 
             * Exception in thread &quot;main&quot; org.apache.commons.imaging.ImageWriteException: Tag expects 1 value(s), not 4
               at org.apache.commons.imaging.formats.tiff.write.TiffOutputDirectory.add(TiffOutputDirectory.java:91)
               at com.ttinc.util.exif.ExifExample.writeExifData(ExifExample.java:81)
               at com.ttinc.util.exif.ExifExample.main(ExifExample.java:91)
             */
            exifDirectory.add(ExifTagConstants.EXIF_TAG_EXIF_VERSION, &quot;0221&quot;.getBytes());

            new ExifRewriter().updateExifMetadataLossless(jpegImageFile, os, outputSet);
        }
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;    public static void main(String args[]) throws Exception&lt;/p&gt;
    {
        File destinationImageFile = new File(&quot;C:\\temp\\DestImage.jpg&quot;);

        writeExifData(new File(&quot;C:\\temp\\SourceImage.jpg&quot;), destinationImageFile);

        logImageMetaData(destinationImageFile);
    }
&lt;p&gt;}&lt;/p&gt;</description>
                <environment>&lt;p&gt;java 1.7.0_55  Commons-Imaging (build date is 3/25/2014)&lt;/p&gt;</environment>
        <key id="12726303">IMAGING-137</key>
            <summary>Can not set EXIF_TAG_EXIF_VERSION tag</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="troccola">Ted Troccola</reporter>
                        <labels>
                            <label>features</label>
                    </labels>
                <created>Wed, 9 Jul 2014 12:18:55 +0000</created>
                <updated>Fri, 3 May 2019 08:39:44 +0000</updated>
                            <resolved>Sun, 19 Oct 2014 07:23:26 +0000</resolved>
                                    <version>1.0-alpha1</version>
                                    <fixVersion>1.0-alpha1</fixVersion>
                                    <component>Format: TIFF</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="14176240" author="damjan" created="Sun, 19 Oct 2014 07:23:26 +0000"  >&lt;p&gt;exifDirectory.add(ExifTagConstants.EXIF_TAG_EXIF_VERSION, 0, 2, 2, 1);&lt;br/&gt;
should work now. Resolving fixed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>404410</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 4 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xlm7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>404449</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>