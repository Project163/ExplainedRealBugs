<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:31:04 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IMAGING-312] Alpha-channel setting not interpreted from ExtraSamples tag</title>
                <link>https://issues.apache.org/jira/browse/IMAGING-312</link>
                <project id="12313421" key="IMAGING">Commons Imaging</project>
                    <description>&lt;p&gt;Commons Imaging sometimes misinterprets TIFF files that have 4-byte RGB samples but do not define alpha.   In some cases, these images are treated as semi-transparent when they should be opaque.   Commons Imaging is not unique in this regard...  Windows Photo Viewer does the same thing.&lt;/p&gt;

&lt;p&gt;The TIFF specification allows RGB images to be encoded with 4-bytes per pixel.  It would be natural to assume (as Commons Imaging does) that the 4th byte is the alpha channel and that it would have values of 0xff in the case where pixels were opaque. However, the interpretation of the 4th byte depends on information in the TIFF &quot;ExtraSamples&quot; tag. &lt;/p&gt;

&lt;p&gt;It turns out that there are images in-the-wild that use 4 bytes, but populate the 4th byte with junk values. For example, there are a number of older aerial photographs from the US Geological Survey (USGS) that do this.  These images give an ExtraSamples tag with a value of zero.  But the TIFF specification calls for images to be treated as having alpha channels only if the ExtraSamples field carries a value of either 1 or 2.   When ExtraSamples has a value of 0, the 4th byte is to be ignored. &lt;/p&gt;

&lt;p&gt;So while the USGS TIFF files are in compliance with the TIFF specification, they use an unintuitive behavior.  Because the Commons Imaging library assumes that the 4th byte would be specified with valid-alpha values, it does not render the images correctly.&lt;/p&gt;

&lt;p&gt;There are many examples of this phenomenon on the USGS Earth Explorer website. One specific example: &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;High Resolution Orthoimagery&lt;/li&gt;
	&lt;li&gt;Dataset: 201203_connecticut_state_lot1_ct_0x3000m_utm_cnir&lt;/li&gt;
	&lt;li&gt;Entity: 2818289_18TYL425825&lt;/li&gt;
	&lt;li&gt;File: 18tyl425825.tif&lt;/li&gt;
&lt;/ul&gt;





&lt;p&gt;&lt;b&gt;Proposed Fix&lt;/b&gt;&lt;br/&gt;
I propose to do the following:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Extend the TiffImageParser logic for detecting alpha to assume hasAlpha is true if and only if the ExtraSamples tag is supplied and contains values 1 or 2.&lt;/li&gt;
	&lt;li&gt;Provide a hasAlpha accessor for the ImageBuilder class (is should really have one anyway)&lt;/li&gt;
	&lt;li&gt;Enhance the DataReaderStrips and DataReaderTiles classes to check hasAlpha when processing RGB images that have 4 samples per pixel samples.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;&lt;b&gt;Concerns&lt;/b&gt;&lt;br/&gt;
At this time, I am not sure what to do if an RGB TIFF image uses 4-samples per pixel but the ExtraSamples tag is not provided.  At this time, I have not seen an example of this, but my collection of sample TIFF files is rather narrow and I would not rule it out.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13399284">IMAGING-312</key>
            <summary>Alpha-channel setting not interpreted from ExtraSamples tag</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kinow">Bruno P. Kinoshita</assignee>
                                    <reporter username="gwlucas">Gary Lucas</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Sep 2021 15:31:54 +0000</created>
                <updated>Thu, 19 May 2022 04:29:26 +0000</updated>
                            <resolved>Sun, 12 Sep 2021 21:12:36 +0000</resolved>
                                    <version>1.0-alpha2</version>
                                    <fixVersion>1.0-alpha3</fixVersion>
                                    <component>Format: TIFF</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="3600">1h</timespent>
                                <comments>
                            <comment id="17413677" author="gwlucas" created="Sun, 12 Sep 2021 08:38:38 +0000"  >&lt;p&gt;Here&apos;s an example comparing the image cited above as rendered by Windows Photo Viewer and the new version of the Commons Imaging API that I will be submitting in a couple of days.&#160; &#160;You can see the effect of misinterpreting the 4th byte for each pixel as giving alpha values.&#160; In reality, the metadata in the TIFF file indicates that the 4th byte should be ignored.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13033364/13033364_Imaging312.png&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt; &#160;&#160;&lt;/p&gt;</comment>
                            <comment id="17413798" author="kinow" created="Sun, 12 Sep 2021 21:03:53 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gwlucas&quot; class=&quot;user-hover&quot; rel=&quot;gwlucas&quot;&gt;gwlucas&lt;/a&gt; ,&lt;/p&gt;

&lt;p&gt;Excellent issue description, thanks a lot. I had a look at the TIFF spec rev 6.0 this morning. I think the specification could do a much better job at saying that when that field is 0 it must be ignored. I read it as values greater than 0 are used to choose what to do about the extra data... but since it didn&apos;t explicitly say &quot;if 0 then ignore the extra data&quot; I think I understand why a developer would forget to handle cases where ExtraSamples is to be ignored, even if we have the extra data.&lt;/p&gt;

&lt;p&gt;I think we should go with your solution and choose later - based on user feedback - whether we need a parameter to enable/disable it, or maybe raise an exception in some special situations.&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;

&lt;p&gt;Bruno&lt;/p&gt;</comment>
                            <comment id="17539230" author="kinow" created="Thu, 19 May 2022 04:29:26 +0000"  >&lt;p&gt;Apache Commons Imaging 1.0-alpha3 has been released.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13033364" name="Imaging312.png" size="380113" author="gwlucas" created="Sun, 12 Sep 2021 08:37:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ulko:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>