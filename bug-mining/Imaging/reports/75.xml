<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:30:38 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IMAGING-130] Reading of some GIF images throws java.io.IOException: AddStringToTable: codes: 4096 code_size: 12</title>
                <link>https://issues.apache.org/jira/browse/IMAGING-130</link>
                <project id="12313421" key="IMAGING">Commons Imaging</project>
                    <description>&lt;p&gt;Hi guys,&lt;/p&gt;

&lt;p&gt;for some GIF images Imaging.getBufferedImage(byte[] bytes) throws the following exception:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;java.io.IOException: AddStringToTable: codes: 4096 code_size: 12&lt;br/&gt;
	at org.apache.commons.imaging.common.mylzw.MyLzwDecompressor.addStringToTable(MyLzwDecompressor.java:112)&lt;br/&gt;
	at org.apache.commons.imaging.common.mylzw.MyLzwDecompressor.decompress(MyLzwDecompressor.java:168)&lt;br/&gt;
	at org.apache.commons.imaging.formats.gif.GifImageParser.readImageDescriptor(GifImageParser.java:388)&lt;br/&gt;
	at org.apache.commons.imaging.formats.gif.GifImageParser.readBlocks(GifImageParser.java:251)&lt;br/&gt;
	at org.apache.commons.imaging.formats.gif.GifImageParser.readFile(GifImageParser.java:455)&lt;br/&gt;
	at org.apache.commons.imaging.formats.gif.GifImageParser.readFile(GifImageParser.java:435)&lt;br/&gt;
	at org.apache.commons.imaging.formats.gif.GifImageParser.getBufferedImage(GifImageParser.java:646)&lt;br/&gt;
	at org.apache.commons.imaging.Imaging.getBufferedImage(Imaging.java:1378)&lt;br/&gt;
	at org.apache.commons.imaging.Imaging.getBufferedImage(Imaging.java:1292)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I have the same problem when using ImageIO.read(). In my post on Stackoverflow ( &lt;a href=&quot;http://stackoverflow.com/questions/22259714/arrayindexoutofboundsexception-4096-while-reading-gif-file&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/22259714/arrayindexoutofboundsexception-4096-while-reading-gif-file&lt;/a&gt; ) you will find an example image to reproduce the exception and a similar looking JDK bug report that I found using Google. Quote from the bug report:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;A DESCRIPTION OF THE PROBLEM :&lt;br/&gt;
according to specification&lt;br/&gt;
&lt;a href=&quot;http://www.w3.org/Graphics/GIF/spec-gif89a.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.w3.org/Graphics/GIF/spec-gif89a.txt&lt;/a&gt;&lt;br/&gt;
&amp;gt; There is not a requirement to send a clear code when the string table is full.&lt;/p&gt;

&lt;p&gt;However, GIFImageReader requires the clear code when the string table is full.&lt;br/&gt;
GIFImageReader violates the specification, clearly.&lt;br/&gt;
In the real world, sometimes people finds such high compressed gif image.&lt;br/&gt;
so you should fix this bug.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I hope you will find this information helpful.&lt;/p&gt;

&lt;p&gt;Kind regards&lt;br/&gt;
Dhyan&lt;/p&gt;</description>
                <environment>&lt;p&gt;Oracle JRE 1.7.0_45 on Windows 7&lt;br/&gt;
Oracle JRE 1.7.0_55-b13 on Debian 7.5&lt;/p&gt;</environment>
        <key id="12716532">IMAGING-130</key>
            <summary>Reading of some GIF images throws java.io.IOException: AddStringToTable: codes: 4096 code_size: 12</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kinow">Bruno P. Kinoshita</assignee>
                                    <reporter username="Dhyan">Dhyan Blum</reporter>
                        <labels>
                    </labels>
                <created>Sun, 25 May 2014 03:08:08 +0000</created>
                <updated>Fri, 7 Aug 2020 04:25:01 +0000</updated>
                            <resolved>Fri, 7 Jun 2019 00:59:39 +0000</resolved>
                                    <version>1.0-alpha1</version>
                                    <fixVersion>1.0-alpha2</fixVersion>
                                    <component>Format: GIF</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="4800">1h 20m</timespent>
                                <comments>
                            <comment id="16306706" author="kinow" created="Sat, 30 Dec 2017 10:51:50 +0000"  >&lt;p&gt;Quickly running through JHove, I get the following exception as well.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&amp;gt; jhove -m gif-hul  o23L9.gif 
java.lang.NegativeArraySizeException
	at edu.harvard.hul.ois.jhove.module.GifModule.readXMP(GifModule.java:899)
	at edu.harvard.hul.ois.jhove.module.GifModule.readAppExtension(GifModule.java:662)
	at edu.harvard.hul.ois.jhove.module.GifModule.readExtBlock(GifModule.java:528)
	at edu.harvard.hul.ois.jhove.module.GifModule.readBlock(GifModule.java:499)
	at edu.harvard.hul.ois.jhove.module.GifModule.parse(GifModule.java:300)
	at edu.harvard.hul.ois.jhove.JhoveBase.processFile(JhoveBase.java:840)
	at edu.harvard.hul.ois.jhove.JhoveBase.process(JhoveBase.java:598)
	at edu.harvard.hul.ois.jhove.JhoveBase.dispatch(JhoveBase.java:465)
	at Jhove.main(Jhove.java:296)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="16858221" author="kinow" created="Fri, 7 Jun 2019 00:48:11 +0000"  >&lt;p&gt;There is a GIF image (attached here for reference later, o23L9.gif) that is correctly rendered in Firefox/Chrome, but fails to be read by Apache Commons Imaging (also by the JDK decoder as reported in the SO answer).&lt;/p&gt;

&lt;p&gt;When I try the following code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.apache.commons.imaging;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.File;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;Test {

&#160;&#160; &#160;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
&#160;&#160; &#160;&#160;&#160; &#160;Imaging.getBufferedImage(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; File(&lt;span class=&quot;code-quote&quot;&gt;&quot;/home/kinow/Downloads/test.gif&quot;&lt;/span&gt;));
&#160;&#160; &#160;}
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I get:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Exception in thread &quot;main&quot; java.io.IOException: AddStringToTable: codes: 4096 code_size: 12
&#160;&#160; &#160;at org.apache.commons.imaging.common.mylzw.MyLzwDecompressor.addStringToTable(MyLzwDecompressor.java:112)
&#160;&#160; &#160;at org.apache.commons.imaging.common.mylzw.MyLzwDecompressor.decompress(MyLzwDecompressor.java:167)
&#160;&#160; &#160;at org.apache.commons.imaging.formats.gif.GifImageParser.readImageDescriptor(GifImageParser.java:397)
&#160;&#160; &#160;at org.apache.commons.imaging.formats.gif.GifImageParser.readBlocks(GifImageParser.java:260)
&#160;&#160; &#160;at org.apache.commons.imaging.formats.gif.GifImageParser.readFile(GifImageParser.java:460)
&#160;&#160; &#160;at org.apache.commons.imaging.formats.gif.GifImageParser.readFile(GifImageParser.java:444)
&#160;&#160; &#160;at org.apache.commons.imaging.formats.gif.GifImageParser.getBufferedImage(GifImageParser.java:649)
&#160;&#160; &#160;at org.apache.commons.imaging.Imaging.getBufferedImage(Imaging.java:1439)
&#160;&#160; &#160;at org.apache.commons.imaging.Imaging.getBufferedImage(Imaging.java:1401)
&#160;&#160; &#160;at org.apache.commons.imaging.TTT.main(TTT.java:8)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But using the code of the Pull request, no exception happens. What is discussed in the SO is ignoring when the string table is full.&lt;/p&gt;

&lt;p&gt;From what I understood, we are talking about the LZW (Lempel-Ziv Welch) compression algorithm used with the GIF format (or a variant of the original LZW). The string table is a table with strings, and strings are accumulators of characters (which can be a character, but for GIF they are color indexes), used to compress/decompress data in LZW.&lt;/p&gt;

&lt;p&gt;And there is a part of the GIF89a specification that states:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&#160;   There has been confusion about where clear codes can be found in the
    data stream.  As the specification says, they may appear at anytime.  There
    is not a requirement to send a clear code when the string table is full.

    It is the encoder&apos;s decision as to when the table should be cleared.  When
    the table is full, the encoder can chose to use the table as is, making no
    changes to it until the encoder chooses to clear it.  The encoder during
    this time sends out codes that are of the maximum Code Size.

    As we can see from the above, when the decoder&apos;s table is full, it must
    not change the table until a clear code is received.  The Code Size is that
    of the maximum Code Size.  Processing other than this is done normally.

    Because of a large base of decoders that do not handle the decompression in
    this manner, we ask developers of GIF encoding software to NOT implement
    this feature until at least January 1991 and later if they see that their
    particular market is not ready for it.  This will give developers of GIF
    decoding software time to implement this feature and to get it into the
    hands of their clients before the decoders start &quot;breaking&quot; on the new
    GIF&apos;s.  It is not required that encoders change their software to take
    advantage of the deferred clear code, but it is for decoders.&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Clear codes are used when you start creating your color table. But there is no requirement to send one when the table is full. It also doesn&apos;t say that you must throw an error when the string table is full.&lt;/p&gt;

&lt;p&gt;So the fix looks good to me. Tested, and I can successfully parse the GIF attached in the StackOverflow thread. Merging PR and adding to 1.0-alpha2.&lt;/p&gt;

&lt;p&gt;References I used besides this issue and SO:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;&lt;a href=&quot;https://www.w3.org/Graphics/GIF/spec-gif89a.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.w3.org/Graphics/GIF/spec-gif89a.txt&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;https://www.cs.cmu.edu/~cil/lzw.and.gif.txt&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://www.cs.cmu.edu/~cil/lzw.and.gif.txt&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thanks for creating the issue with good description, thanks to the contributor who submitted the PR, and will log in to thank others in StackOverflow as well.&lt;/p&gt;

&lt;p&gt;Bruno&lt;/p&gt;</comment>
                            <comment id="17172818" author="kinow" created="Fri, 7 Aug 2020 04:25:01 +0000"  >&lt;p&gt;Commons Imaging 1.0-alpha2 released!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12971128" name="o23L9.gif" size="1460705" author="kinow" created="Fri, 7 Jun 2019 01:23:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>394740</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1vyqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>394875</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>