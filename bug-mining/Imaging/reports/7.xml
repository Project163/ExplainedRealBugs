<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:29:58 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IMAGING-95] Some tiff processing takes very long</title>
                <link>https://issues.apache.org/jira/browse/IMAGING-95</link>
                <project id="12313421" key="IMAGING">Commons Imaging</project>
                    <description>&lt;p&gt;org.apache.commons.imaging.formats.tiff.TiffReader.getTiffRawImageData(ByteSource, TiffDirectory)	226635	1&lt;br/&gt;
org.apache.commons.imaging.common.bytesource.ByteSourceInputStream.getBlock(int, int)	226588	5616&lt;br/&gt;
org.apache.commons.imaging.common.BinaryFileFunctions.skipBytes(InputStream, int)	226526	5616&lt;br/&gt;
org.apache.commons.imaging.common.BinaryFileFunctions.skipBytes(InputStream, int, String)	226526	5616&lt;br/&gt;
org.apache.commons.imaging.common.bytesource.ByteSourceInputStream$CacheReadingInputStream.read(byte[], int, int)	226526	188656860&lt;br/&gt;
org.apache.commons.imaging.common.bytesource.ByteSourceInputStream$CacheBlock.getNext()	64581	188651244&lt;br/&gt;
skip bytes is being called repeatedly again and again, last column is invocation count in one call tree. Second column is total number of time taken by that method in that call tree..&lt;/p&gt;

&lt;p&gt;and skip method is not overridden org.apache.commons.imaging.common.bytesource.ByteSourceInputStream.CacheReadingInputStream and default implementation of InputStream tries to use read method (which is overridden in CacheReadingInputStream) to skip. &lt;/p&gt;

&lt;p&gt;In case of a tiff, which has large number of strips, skip is repeatedly called and use of read is inefficient as it tried to do a System.arraycopy. array copy is not needed in case of skip operation, as the bytes were already read in block/cached, we can simply jump the pointer (block by block)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12611897">IMAGING-95</key>
            <summary>Some tiff processing takes very long</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="amitgupt">Amit Gupta</reporter>
                        <labels>
                    </labels>
                <created>Mon, 15 Oct 2012 20:29:25 +0000</created>
                <updated>Fri, 3 May 2019 08:39:36 +0000</updated>
                            <resolved>Wed, 24 Oct 2012 05:24:05 +0000</resolved>
                                    <version>1.0-alpha1</version>
                                    <fixVersion>1.0-alpha1</fixVersion>
                                    <component>Format: TIFF</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13476411" author="amitgupt" created="Mon, 15 Oct 2012 20:31:25 +0000"  >&lt;p&gt;patch for skipping array copy for skip operation&lt;/p&gt;</comment>
                            <comment id="13476431" author="amitgupt" created="Mon, 15 Oct 2012 20:50:56 +0000"  >&lt;p&gt;patch 2, cleaned the code&lt;/p&gt;</comment>
                            <comment id="13476869" author="amitgupt" created="Tue, 16 Oct 2012 09:16:35 +0000"  >&lt;p&gt;somehow, I can not see check box to grant license for inclusion.&lt;/p&gt;</comment>
                            <comment id="13479142" author="gwlucas" created="Thu, 18 Oct 2012 16:59:40 +0000"  >&lt;p&gt;I&apos;m not part of the Apache Commons Imaging project team, but I am interested in this issue...  Few people would welcome a speed enhancement for TIFF images with more enthusiasm than I &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I tried your patch with a couple of test files I have and didn&apos;t see much difference in measured processing time.  Unfortunately, I&apos;ve got all sorts of security software running on my computer and it makes for a noisy test environment, so I can&apos;t be sure.   So I have a couple of questions:&lt;/p&gt;

&lt;p&gt;a) Are there specific TIFF formats where you&apos;ve observed an improvement?&lt;br/&gt;
b) Have you tried running before-and-after tests using the ApacheImagingSpeedAndMemoryTest.java application?&lt;/p&gt;

&lt;p&gt;The ApacheImagingSpeedAndMemory.java class is in the Commons Imaging code distribution under the path src\test\java\org\apache\commons\imaging\examples   There are detailed instructions for using it in the comments inside the code.  It is designed to give reasonably unambiguous timing information about how long it takes to load an image (it is coded for TIFF images, but can be edited to process other formats).&lt;/p&gt;

&lt;p&gt;That being said, I would encourage you to include test statistics and more specific details about your test procedures when posting about performance issues.  Speaking from personal experience, doing so does a lot to add credibility to your work (and who among us doesn&apos;t need more of that ?).&lt;/p&gt;</comment>
                            <comment id="13479190" author="gwlucas" created="Thu, 18 Oct 2012 18:00:16 +0000"  >&lt;p&gt;Well, I took another look at this, and it appears that my first tests weren&apos;t accessing the ByteSourceInputStream, but were using the ByteSourceFile.  So I tried it again, following my own suggestion about using the ApacheImagingSpeedAndMemoryTest application.&lt;/p&gt;

&lt;p&gt;The results loading a 3600 by 1800 pixel image&lt;/p&gt;

&lt;p&gt;   using current version:   763.8 milliseconds&lt;br/&gt;
   using your version:      176.4 milliseconds&lt;/p&gt;

&lt;p&gt;So it looks like you&apos;re on the right track.  Strictly as an aside,&lt;br/&gt;
I also tried testing with the ByteSourceFile and got a load time of&lt;br/&gt;
98 milliseconds.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;Using ByteSourceInputStream -------------------------------------
Processing file: BlueMarble.TIFF
 image size: 3600 by 1800

 time to load image    --         memory
 time ms      avg ms   --    used mb   total mb
  787.793     0.000    --     63.075    92.191 
  859.587     0.000    --     63.070    92.191 
  772.965   772.965    --     62.894    84.473 
  651.912   712.439    --     63.058    92.203 
  851.362   758.747    --     63.061    92.203 
  818.632   773.718    --     62.890    84.484 
  659.307   750.836    --     63.058    92.203 
  911.201   777.563    --     63.061    92.203 
  781.244   778.089    --     62.890    84.484 
  663.920   763.818    --     63.058    92.203 
 

Processing file: BlueMarble.TIFF
 image size: 3600 by 1800

 time to load image    --         memory
 time ms      avg ms   --    used mb   total mb
  295.915     0.000    --     63.073    92.188 
  193.905     0.000    --     63.068    92.188 
  191.630   191.630    --     62.892    84.473 
  214.639   203.134    --     63.056    92.199 
  211.340   205.870    --     63.059    92.199 
  182.537   200.036    --     62.888    84.480 
  175.037   195.037    --     63.056    92.199 
  166.024   190.201    --     63.059    92.199 
  149.707   184.416    --     62.888    84.480 
  176.374   183.411    --     63.057    92.199 



Using ByteSourceFile instead of ByteSourceInputStream  ------------------

Processing file: BlueMarble.TIFF
 image size: 3600 by 1800

 time to load image    --         memory
 time ms      avg ms   --    used mb   total mb
  184.074     0.000    --     26.417    40.285 
   90.738     0.000    --     29.509    51.410 
   88.949    88.949    --     30.485    47.816 
  104.790    96.869    --     26.166    40.289 
   99.904    97.881    --     26.084    40.289 
   98.153    97.949    --     26.084    40.289 
   98.774    98.114    --     26.084    40.289 
   98.111    98.113    --     26.084    40.289 
   97.828    98.073    --     26.084    40.289 
   98.742    98.156    --     26.084    40.289 

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13482983" author="damjan" created="Wed, 24 Oct 2012 05:24:06 +0000"  >&lt;p&gt;Fixed. Thank you for your patch!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12549206" name="tiff_perf_fix2.patch" size="1895" author="amitgupt" created="Mon, 15 Oct 2012 20:50:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>248811</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 years, 4 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0a04v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56295</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>