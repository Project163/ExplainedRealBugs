<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:30:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IMAGING-247] crash on reading tiff image</title>
                <link>https://issues.apache.org/jira/browse/IMAGING-247</link>
                <project id="12313421" key="IMAGING">Commons Imaging</project>
                    <description>&lt;p&gt;I get an index out of bounds exception trying to load the attached image.&lt;/p&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.ArrayIndexOutOfBoundsException: Index 255 out of bounds for length 2
	at org.apache.commons.imaging.formats.tiff.photometricinterpreters.PhotometricInterpreterPalette.interpretPixel(PhotometricInterpreterPalette.java:53)
	at org.apache.commons.imaging.formats.tiff.datareaders.DataReaderStrips.interpretStrip(DataReaderStrips.java:179)
	at org.apache.commons.imaging.formats.tiff.datareaders.DataReaderStrips.readImageData(DataReaderStrips.java:212)
	at org.apache.commons.imaging.formats.tiff.TiffImageParser.getBufferedImage(TiffImageParser.java:659)
	at org.apache.commons.imaging.formats.tiff.TiffDirectory.getTiffImage(TiffDirectory.java:163)
	at org.apache.commons.imaging.formats.tiff.TiffImageParser.getBufferedImage(TiffImageParser.java:469)
	at org.apache.commons.imaging.Imaging.getBufferedImage(Imaging.java:1442)
	at org.apache.commons.imaging.Imaging.getBufferedImage(Imaging.java:1404)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;I&apos;m calling getBufferedImage without any parameters.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13279127">IMAGING-247</key>
            <summary>crash on reading tiff image</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kinow">Bruno P. Kinoshita</assignee>
                                    <reporter username="rmo">Robin Morier</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Jan 2020 16:50:59 +0000</created>
                <updated>Fri, 7 Aug 2020 04:24:59 +0000</updated>
                            <resolved>Mon, 18 May 2020 08:45:15 +0000</resolved>
                                    <version>1.0-alpha1</version>
                                    <fixVersion>1.0-alpha2</fixVersion>
                                    <component>Format: TIFF</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                                                                <comments>
                            <comment id="17015002" author="kinow" created="Tue, 14 Jan 2020 10:46:59 +0000"  >&lt;p&gt;Thanks for reporting the issue and including the stacktrace and example image. Issue reproduced locally. exiftool and getImageInfo both work fine though.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ exiftool -validate -verbose neutre.TIFF 
  ExifToolVersion = 10.80
  FileName = neutre.TIFF
  Directory = .
  FileSize = 29708
  FileModifyDate = 1578998227
  FileAccessDate = 1578998243
  FileInodeChangeDate = 1578998229
  FilePermissions = 33204
  FileType = TIFF
  FileTypeExtension = TIF
  MIMEType = image/tiff
  ExifByteOrder = II
  + [IFD0 directory with 15 entries]
  | 0)  ImageWidth = 2388
  | 1)  ImageHeight = 1700
  | 2)  BitsPerSample = 1
  | 3)  Compression = 32773
  | 4)  PhotometricInterpretation = 3
  | 5)  StripOffsets = 8 224 440 656 872 1088 1304 1520 1736 1952 2168 2384 2600 2816 3[snip]
  | 6)  Orientation = 1
  | 7)  SamplesPerPixel = 1
  | 8)  RowsPerStrip = 27
  | 9)  StripByteCounts = 216 216 216 216 216 216 216 216 216 216 216 216 216 216 1615 [snip]
  | 10) XResolution = 199.9996033 (419429568/2097152)
  | 11) YResolution = 199.9996033 (419429568/2097152)
  | 12) PlanarConfiguration = 1
  | 13) ResolutionUnit = 2
  | 14) ColorMap = ......
  Warning = Invalid count for IFD0 tag 0x0140 ColorMap
  Validate = 0 1 0
Validate &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Format Details: Tiff v.42
Bits Per Pixel: 1
Comments: 15
	0: &apos;256 (0x100: ImageWidth): 2388 (1 Short)&apos;
	1: &apos;257 (0x101: ImageLength): 1700 (1 Short)&apos;
	2: &apos;258 (0x102: BitsPerSample): 1 (1 Short)&apos;
	3: &apos;259 (0x103: Compression): -32763 (1 Short)&apos;
	4: &apos;262 (0x106: PhotometricInterpretation): 3 (1 Short)&apos;
	5: &apos;273 (0x111: PreviewImageStart): 8, 224, 440, 656, 872, 1088, 1304, 1520, 1736, 1952, 2168, 2384, 2600, 2816, 3032, 4647, 5950, 6166, 6382, 6598, 6814, 7030, 7246, 7707, 12209, 12593, 12943, 13292, 13647, 14404, 15357, 15714, 16702, 18042, 18393, 18963, 21053, 21930, 22254, 22953, 23645, 23879, 24095, 24311, 24535, 24759, 24979, 25195, 25411, 25840, 26189... (63) (63 Long)&apos;
	6: &apos;274 (0x112: Orientation): 1 (1 Short)&apos;
	7: &apos;277 (0x115: SamplesPerPixel): 1 (1 Short)&apos;
	8: &apos;278 (0x116: RowsPerStrip): 27 (1 Short)&apos;
	9: &apos;279 (0x117: PreviewImageLength): 216, 216, 216, 216, 216, 216, 216, 216, 216, 216, 216, 216, 216, 216, 1615, 1303, 216, 216, 216, 216, 216, 216, 461, 4502, 384, 350, 349, 355, 757, 953, 357, 988, 1340, 351, 570, 2090, 877, 324, 699, 692, 234, 216, 216, 224, 224, 220, 216, 216, 429, 349, 216... (63) (63 Long)&apos;
	10: &apos;282 (0x11a: XResolution): 419429568/2097152 (200) (1 Rational)&apos;
	11: &apos;283 (0x11b: YResolution): 419429568/2097152 (200) (1 Rational)&apos;
	12: &apos;284 (0x11c: PlanarConfiguration): 1 (1 Short)&apos;
	13: &apos;296 (0x128: ResolutionUnit): 2 (1 Short)&apos;
	14: &apos;320 (0x140: ColorMap): 0, -1, 0, -1, 0, -1 (6 Short)&apos;
Format: TIFF
Format Name: TIFF Tag-based Image File Format
Compression Algorithm: PackBits
Height: 1700
MimeType: image/tiff
Number Of Images: 1
Physical Height Dpi: 200
Physical Height Inch: 8.500017
Physical Width Dpi: 200
Physical Width Inch: 11.940023
Width: 2388
Is Progressive: false
Is Transparent: false
Color Type: RGB
Uses Palette: true &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Will need some debugging to check what&apos;s going on.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17017866" author="rmo" created="Fri, 17 Jan 2020 10:02:12 +0000"  >&lt;p&gt;Thanks for investigating.&lt;br/&gt;
As a temporary workaround I&apos;m converting the TIFFs to white_is_zero scheme (so, without the palette).&lt;br/&gt;
I&apos;ve spent some time trying to understand the library code that leads to that faulty 255 sample value but couldn&apos;t quite get my mind around the meaning of the bit shifts etc...&lt;/p&gt;</comment>
                            <comment id="17087016" author="gwlucas" created="Sun, 19 Apr 2020 13:46:08 +0000"  >&lt;p&gt;I took a quick look at your sample image in debugger and it looks like the first two bytes in the sequence are -127, -1.&#160; &#160;From the TIFF specification for PackBits, -127 means &quot;repeat the next byte 128 times&quot;.&#160; Java uses signed bytes, so the -1 is the equivalent of 0b1111111, or 255.&lt;/p&gt;

&lt;p&gt;So the 255 is not necessarily a faulty value from the perspective of the PackBits encoding.&lt;/p&gt;

&lt;p&gt;But here&apos;s the problem...&#160; &#160;The BitsPerSample tag (see above) defines the data as having only one bit per sample.&#160; But the existing code in ImageDataReader does not take that into account.&#160; It just passes the 255 down to the PhotometricInterpreterPalette class.&lt;/p&gt;

&lt;p&gt;The PhotometricInterpreterPalette runs into a problem because the palette only defines two states.&#160; &#160;To make it more robust, it could implement a bounds-check and return a more informative ImageReadException, but that wouldn&apos;t do you much good.&lt;/p&gt;

&lt;p&gt;Not sure how to handle this, but I&apos;ll read through the TIFF spec some more and see what it indicates.&lt;/p&gt;

&lt;p&gt;P.S.&#160; I did a quick hack to the PhotometricInterpreterPalette just to mask the low-order bit, and got what looks like an address form.&#160; I&apos;ve attached the image to this issue.&#160; &#160;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17087522" author="rmo" created="Mon, 20 Apr 2020 09:19:24 +0000"  >&lt;p&gt;Gary,&lt;/p&gt;

&lt;p&gt;Thanks for looking into this. The .png you&apos;ve attached is indeed what it should look like.&lt;/p&gt;</comment>
                            <comment id="17110048" author="kinow" created="Mon, 18 May 2020 08:47:17 +0000"  >&lt;p&gt;Pull request merged. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gwlucas&quot; class=&quot;user-hover&quot; rel=&quot;gwlucas&quot;&gt;gwlucas&lt;/a&gt; !&lt;/p&gt;</comment>
                            <comment id="17172815" author="kinow" created="Fri, 7 Aug 2020 04:24:59 +0000"  >&lt;p&gt;Commons Imaging 1.0-alpha2 released!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13000430" name="IMAGING-247.png" size="30807" author="gwlucas" created="Sun, 19 Apr 2020 13:52:19 +0000"/>
                            <attachment id="12990749" name="neutre.TIFF" size="29708" author="rmo" created="Mon, 13 Jan 2020 16:32:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0agg0:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>