<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 18:30:57 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[IMAGING-265] ArrayIndexOutOfBoundsException on reading simple GeoTIFF</title>
                <link>https://issues.apache.org/jira/browse/IMAGING-265</link>
                <project id="12313421" key="IMAGING">Commons Imaging</project>
                    <description>&lt;p&gt;hi,&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;we on the OpenJUMP project cannot open some GeoTIFFs with commons.imaging . for details you may find a ticket in our bug tracker &lt;a href=&quot;https://sourceforge.net/p/jump-pilot/bugs/498/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://sourceforge.net/p/jump-pilot/bugs/498/&lt;/a&gt;&#160;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;the gist is: on loading the attached file getBufferedImage() fails with this stack&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; Caused by: java.lang.ArrayIndexOutOfBoundsException: 8000Caused by: 
java.lang.ArrayIndexOutOfBoundsException: 8000 at 
org.apache.commons.imaging.formats.tiff.datareaders.DataReaderStrips.interpretStrip(DataReaderStrips.java:196) at 
org.apache.commons.imaging.formats.tiff.datareaders.DataReaderStrips.readImageData(DataReaderStrips.java:254) at 
org.apache.commons.imaging.formats.tiff.TiffImageParser.getBufferedImage(TiffImageParser.java:665) at 
org.apache.commons.imaging.formats.tiff.TiffDirectory.getTiffImage(TiffDirectory.java:254) at 
org.apache.commons.imaging.formats.tiff.TiffImageParser.getBufferedImage(TiffImageParser.java:469) at 
org.apache.commons.imaging.Imaging.getBufferedImage(Imaging.java:1442) at 
org.apache.commons.imaging.Imaging.getBufferedImage(Imaging.java:1335) at 
org.apache.commons.imaging.Imaging.getBufferedImage(Imaging.java:1304) at 
com.vividsolutions.jump.workbench.imagery.graphic.CommonsImage.initImage(CommonsImage.java:108)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="13326197">IMAGING-265</key>
            <summary>ArrayIndexOutOfBoundsException on reading simple GeoTIFF</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kinow">Bruno P. Kinoshita</assignee>
                                    <reporter username="edso">edgar soldin</reporter>
                        <labels>
                    </labels>
                <created>Sun, 6 Sep 2020 16:13:35 +0000</created>
                <updated>Thu, 19 May 2022 04:29:27 +0000</updated>
                            <resolved>Thu, 8 Oct 2020 04:15:09 +0000</resolved>
                                    <version>1.0-alpha2</version>
                                    <fixVersion>1.0-alpha3</fixVersion>
                                    <component>Format: TIFF</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="13200">3h 40m</timespent>
                                <comments>
                            <comment id="17197298" author="gwlucas" created="Thu, 17 Sep 2020 00:14:23 +0000"  >&lt;p&gt;It took a while, but I&apos;ve identified the problem and I think that the original authors of TIFF were in love with complexity.&lt;/p&gt;

&lt;p&gt;It turns out that there is a specification in the TIFF standard on how a file may store the RGB components in a file. The arrangement is specified using a TIFF tag known as Planar Configuration and there are two variations:&lt;/p&gt;

&lt;p&gt;You may specify them in a sequence of bytes such as &lt;br/&gt;
 R1, G1, B1, R2, G2, B2, R3, G3, B3, ... , Rn, Gn, Bn (Planar Configuration 1)&lt;/p&gt;

&lt;p&gt;But you can also split the data into separate &quot;planes&quot; such as&lt;br/&gt;
 R1, R1, R2,... Rn, G1, G2, G3,...Gn, B1, B2, B3, ... Bn. (Planar Configuration 2)&lt;/p&gt;

&lt;p&gt;The problematic image uses Planar Configuration 2. Searching through the code, I don&apos;t find any evidence of Planar Configuration 2 implemented anywhere. So it looks like this configuration is not currently supported by Commons Imaging.&lt;/p&gt;

&lt;p&gt;The array bounds failure occurs because the small_world.tif file is organized into blocks of 8000 bytes representing strips of 20 rows 400 pixels wide. In Planar Configuration 1, the code would expect to see 3 bytes per pixel, or 24000 bytes per strip (block). In Planar Configuration 2, the data is split between 3 blocks of 8000 which have to be combined to get a full set of RGB values. Since Commons Imaging does not recognize Planar Configuration 2 (at least, not yet), it thinks it has 24000 bytes to process and wackiness ensues.&lt;/p&gt;

&lt;p&gt;THE USUAL PLEA FOR TEST DATA&lt;br/&gt;
 I have a fix in mind that will address this particular file. But it will only work for files using the RGB color model and organized into strips with no data compression. I could easily extend it for files organized with tiles, but I have no test data. And that still leaves the issue of different photometric interpreters and data compression. I&apos;m not sure that these options even matter, because I suspect that Planar Configuration 2 is unusual in modern data systems.&lt;/p&gt;

&lt;p&gt;For the OpenJUMP folks: As a temporary work-around, you can try to use interleaved RGB rather than the separate planes. I know that&apos;s not much of a help if you&apos;re not in control of the format for the images you receive, but at least you will know why some images don&apos;t work.&lt;/p&gt;

&lt;p&gt;And finally, just as a point of interest, I&apos;ve attached a JPEG showing the 3-plane content of the small world file. I hacked Commons Imaging so that it wouldn&apos;t crash when I read the file. But, clearly, I have more work to do to render it properly.&lt;br/&gt;
 &lt;span class=&quot;image-wrap&quot; style=&quot;&quot;&gt;&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/13011660/13011660_small_world_split.jpg&quot; style=&quot;border: 0px solid black&quot; /&gt;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="17198672" author="kinow" created="Sat, 19 Sep 2020 07:14:47 +0000"  >&lt;p&gt;&amp;gt;It took a while, but I&apos;ve identified the problem and I think that the original authors of TIFF were in love with complexity.&lt;/p&gt;

&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&amp;gt;The problematic image uses Planar Configuration 2. Searching through the code, I don&apos;t find any evidence of Planar Configuration 2 implemented anywhere. So it looks like this configuration is not currently supported by Commons Imaging.&lt;/p&gt;

&lt;p&gt;Great detective work! I didn&apos;t know about this planar configuration, nor can I remember seeing it anywhere in the TIFF image parser.&lt;/p&gt;

&lt;p&gt;&amp;gt;For the OpenJUMP folks&lt;/p&gt;

&lt;p&gt;Good to learn about OpenJUMP. Will give it a try later.&lt;/p&gt;

&lt;p&gt;Thanks for investigating the issue and for the detailed explanation &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gwlucas&quot; class=&quot;user-hover&quot; rel=&quot;gwlucas&quot;&gt;gwlucas&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="17198959" author="edso" created="Sun, 20 Sep 2020 11:29:44 +0000"  >&lt;p&gt;&amp;gt;&amp;gt;The problematic image uses Planar Configuration 2. Searching through the code, I don&apos;t find any evidence of Planar Configuration 2 implemented anywhere. So it looks like this configuration is not currently supported by Commons Imaging.&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Great detective work! I didn&apos;t know about this planar configuration, nor can I remember seeing it anywhere in the TIFF image parser.&lt;/p&gt;

&lt;p&gt;we are successfully using the TIFF JAI reader from&lt;br/&gt;
  &lt;a href=&quot;https://github.com/jai-imageio/jai-imageio-core&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/jai-imageio/jai-imageio-core&lt;/a&gt;&lt;br/&gt;
as well as earlier the one from imageio-ext project&lt;br/&gt;
  &lt;a href=&quot;https://github.com/geosolutions-it/imageio-ext&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/geosolutions-it/imageio-ext&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;to read a multitude of TIFF formats successfully. maybe these are sources to find inspirations and implementations to inspire missing support in apache imaging&apos;s TIFF reader.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;For the OpenJUMP folks&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Good to learn about OpenJUMP. Will give it a try later.&lt;/p&gt;

&lt;p&gt;do that. we are only around since 2011 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;..&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gwlucas&quot; class=&quot;user-hover&quot; rel=&quot;gwlucas&quot;&gt;gwlucas&lt;/a&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kinow&quot; class=&quot;user-hover&quot; rel=&quot;kinow&quot;&gt;kinow&lt;/a&gt; can you please point me to where can i find snapshots that include your fix?&lt;/p&gt;

&lt;p&gt;thx! ..ede&lt;/p&gt;</comment>
                            <comment id="17199714" author="gwlucas" created="Tue, 22 Sep 2020 00:16:07 +0000"  >&lt;p&gt;Thanks for the information.&#160; The original authors of the Commons Imaging project put an enormous amount of effort into creating the TIFF modules and I think they left the project with a pretty good foundation.&#160; Nowadays, it&apos;s unusual to find an example of a format that Commons Imaging doesn&apos;t support...&#160; unusual, but perhaps not quite unusual enough&#160;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;In the case of the samples you provided, they were created using an &quot;odd duck&quot; specification that we hadn&apos;t seen before.&#160; I knew there was something called a PlanarConfiguration, but I had no idea what it was about.&#160; So your image provided a good opportunity to expand our capabilities.&#160; Of course, nobody likes to learn about a new bug (or a new feature) that needs to be addressed... But it definitely leads to more robust code when we do.&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;

&lt;p&gt;P.S.&#160; Just to make sure there&apos;s no confusion here, I am not properly speaking a member of the Commons Imaging project and certainly do not speak for them. I help out with coding occasionally.&#160; My post above makes it sound like I know a lot more than I actually do...&#160; Hope I didn&apos;t give a false sense of authority.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17208598" author="kinow" created="Tue, 6 Oct 2020 09:18:14 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=edso&quot; class=&quot;user-hover&quot; rel=&quot;edso&quot;&gt;edso&lt;/a&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gwlucas&quot; class=&quot;user-hover&quot; rel=&quot;gwlucas&quot;&gt;gwlucas&lt;/a&gt; &apos; pull request fixes this issue. He included the file you provided in the test data, and added a simple unit test. I wasn&apos;t aware of this different planar configurations in TIFF, so thanks for the explanation &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gwlucas&quot; class=&quot;user-hover&quot; rel=&quot;gwlucas&quot;&gt;gwlucas&lt;/a&gt; .&lt;/p&gt;

&lt;p&gt;Pull request pretty much ready for review. I think we don&apos;t have a snapshot being created for imaging, even though I think commons-lang and/or other components in commons are publishing snapshots.&lt;/p&gt;

&lt;p&gt;If you need one from one of our Maven servers, I can take a look at our Jenkins server to see how to publish one. Otherwise you can either build the snapshot from `master` to test, or wait a bit for the next alpha release (aiming at a release now in Q4/2020), with the final 1.0 somewhere in 2021.&lt;/p&gt;

&lt;p&gt;Cheers&lt;/p&gt;

&lt;p&gt;Bruno&lt;/p&gt;</comment>
                            <comment id="17208605" author="edso" created="Tue, 6 Oct 2020 09:27:52 +0000"  >&lt;p&gt;&amp;gt; If you need one from one of our Maven servers, I can take a look at our Jenkins server to see how to publish one. Otherwise you can either build the snapshot from `master` to test, or wait a bit for the next alpha release (aiming at a release now in Q4/2020), with the final 1.0 somewhere in 2021.&lt;/p&gt;

&lt;p&gt;thanks. was just asking if. if not we will wait for your next scheduled alpha. thanks again, especially &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=gwlucas&quot; class=&quot;user-hover&quot; rel=&quot;gwlucas&quot;&gt;gwlucas&lt;/a&gt;.. ede/OJ&lt;/p&gt;</comment>
                            <comment id="17209994" author="kinow" created="Thu, 8 Oct 2020 04:15:33 +0000"  >&lt;p&gt;Fixed in master. Included in the changelog for the next alpha release.&lt;/p&gt;</comment>
                            <comment id="17539246" author="kinow" created="Thu, 19 May 2022 04:29:27 +0000"  >&lt;p&gt;Apache Commons Imaging 1.0-alpha3 has been released.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13011137" name="small_world.tif" size="240574" author="edso" created="Sun, 6 Sep 2020 16:12:57 +0000"/>
                            <attachment id="13011660" name="small_world_split.jpg" size="42238" author="gwlucas" created="Thu, 17 Sep 2020 00:12:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0ida8:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>