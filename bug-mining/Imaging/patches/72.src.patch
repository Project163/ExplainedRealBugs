diff --git a/src/main/java/org/apache/commons/imaging/formats/xpm/XpmImageParser.java b/src/main/java/org/apache/commons/imaging/formats/xpm/XpmImageParser.java
index 40533578..d6ccda71 100644
--- a/src/main/java/org/apache/commons/imaging/formats/xpm/XpmImageParser.java
+++ b/src/main/java/org/apache/commons/imaging/formats/xpm/XpmImageParser.java
@@ -665,6 +665,18 @@ public class XpmImageParser extends ImageParser {
         while (palette == null) {
             palette = paletteFactory.makeExactRgbPaletteSimple(src,
                     hasTransparency ? maxColors - 1 : maxColors);
+            
+            // leave the loop if numbers would go beyond Integer.MAX_VALUE to avoid infinite loops
+            // test every operation from below if it would increase an int value beyond Integer.MAX_VALUE
+            long nextMaxColors = maxColors * WRITE_PALETTE.length;
+            long nextCharsPerPixel = charsPerPixel + 1;
+            if (nextMaxColors > Integer.MAX_VALUE) {
+                throw new ImageWriteException("Xpm: Can't write images with more than Integer.MAX_VALUE colors.");
+            }
+            if (nextCharsPerPixel > Integer.MAX_VALUE) {
+                throw new ImageWriteException("Xpm: Can't write images with more than Integer.MAX_VALUE chars per pixel.");
+            }
+            // the code above makes sure that we never go beyond Integer.MAX_VALUE here
             if (palette == null) {
                 maxColors *= WRITE_PALETTE.length;
                 charsPerPixel++;
