diff --git a/src/main/java/org/apache/commons/imaging/formats/bmp/BmpImageParser.java b/src/main/java/org/apache/commons/imaging/formats/bmp/BmpImageParser.java
index 54f7f114..13e7da04 100644
--- a/src/main/java/org/apache/commons/imaging/formats/bmp/BmpImageParser.java
+++ b/src/main/java/org/apache/commons/imaging/formats/bmp/BmpImageParser.java
@@ -569,7 +569,7 @@ public class BmpImageParser extends AbstractImageParser<BmpImagingParameters> {
             debugNumber("expectedDataOffset", expectedDataOffset, 4);
         }
         final int extraBytes = bhi.bitmapDataOffset - expectedDataOffset;
-        if (extraBytes < 0) {
+        if ((extraBytes < 0) || (extraBytes > bhi.fileSize)) {
             throw new ImagingException("BMP has invalid image data offset: " + bhi.bitmapDataOffset + " (expected: " + expectedDataOffset + ", paletteLength: "
                     + paletteLength + ", headerSize: " + headerSize + ")");
         }
diff --git a/src/test/java/org/apache/commons/imaging/formats/ico/IcoImageParserTest.java b/src/test/java/org/apache/commons/imaging/formats/ico/IcoImageParserTest.java
new file mode 100644
index 00000000..2c0ae485
--- /dev/null
+++ b/src/test/java/org/apache/commons/imaging/formats/ico/IcoImageParserTest.java
@@ -0,0 +1,39 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+package org.apache.commons.imaging.formats.ico;
+
+import static org.junit.jupiter.api.Assertions.assertThrows;
+
+import org.apache.commons.imaging.ImagingException;
+import org.apache.commons.imaging.test.TestResources;
+import org.junit.jupiter.api.Test;
+
+import java.io.File;
+
+public class IcoImageParserTest {
+
+    /**
+     * For https://issues.apache.org/jira/browse/IMAGING-373.
+     * <p> There is a problem with loading bitmap stored in given ICO file, so the exception is originally thrown by BmpImageParser.
+     */
+    @Test
+    public void testImageWithInvalidBmpHeaders() {
+        final File ico = TestResources.resourceToFile("/IMAGING-373/OutOfMemory_epine.ico");
+        final IcoImageParser parser = new IcoImageParser();
+        assertThrows(ImagingException.class, () -> parser.getAllBufferedImages(ico));
+    }
+}
diff --git a/src/test/resources/IMAGING-373/OutOfMemory_epine.ico b/src/test/resources/IMAGING-373/OutOfMemory_epine.ico
new file mode 100644
index 00000000..4135db96
Binary files /dev/null and b/src/test/resources/IMAGING-373/OutOfMemory_epine.ico differ
