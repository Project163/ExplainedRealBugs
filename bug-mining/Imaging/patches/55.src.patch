diff --git a/src/changes/changes.xml b/src/changes/changes.xml
index 3237559b..d06dbbd4 100644
--- a/src/changes/changes.xml
+++ b/src/changes/changes.xml
@@ -46,6 +46,9 @@ The <action> type attribute can be add,update,fix,remove.
   <body>
 
     <release version="1.0" date="TBA" description="First major release">
+      <action issue="IMAGING-215" dev="kinow" type="fix">
+        ArrayIndexOutOfBoundsException in DhtSegment
+      </action>
       <action issue="IMAGING-203" dev="kinow" type="fix" due-to="Rody Kersten">
         JPEG segment size not validated
       </action>
diff --git a/src/main/java/org/apache/commons/imaging/formats/jpeg/segments/DhtSegment.java b/src/main/java/org/apache/commons/imaging/formats/jpeg/segments/DhtSegment.java
index 81cfd20c..8763aa8a 100644
--- a/src/main/java/org/apache/commons/imaging/formats/jpeg/segments/DhtSegment.java
+++ b/src/main/java/org/apache/commons/imaging/formats/jpeg/segments/DhtSegment.java
@@ -77,6 +77,9 @@ public class DhtSegment extends Segment {
             int si = huffSize[0];
             huffCode = new int[lastK];
             while (true) {
+                if (k >= lastK) {
+                    break;
+                }
                 huffCode[k] = code;
                 code++;
                 k++;
diff --git a/src/test/java/org/apache/commons/imaging/formats/jpeg/JpegWithInvalidDhtSegmentTest.java b/src/test/java/org/apache/commons/imaging/formats/jpeg/JpegWithInvalidDhtSegmentTest.java
new file mode 100644
index 00000000..75cd4f7e
--- /dev/null
+++ b/src/test/java/org/apache/commons/imaging/formats/jpeg/JpegWithInvalidDhtSegmentTest.java
@@ -0,0 +1,41 @@
+/*
+ * Licensed to the Apache Software Foundation (ASF) under one or more
+ * contributor license agreements.  See the NOTICE file distributed with
+ * this work for additional information regarding copyright ownership.
+ * The ASF licenses this file to You under the Apache License, Version 2.0
+ * (the "License"); you may not use this file except in compliance with
+ * the License.  You may obtain a copy of the License at
+ *
+ *      http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package org.apache.commons.imaging.formats.jpeg;
+
+import java.io.File;
+import java.util.Collections;
+import org.apache.commons.imaging.ImageReadException;
+import org.apache.commons.imaging.Imaging;
+import org.junit.Test;
+
+/**
+ * Test that an invalid segment will not cause an ArrayIndexOutOfBoundsException
+ * when the huffman table is created in a DHT segment.
+ */
+public class JpegWithInvalidDhtSegmentTest {
+
+    @Test(expected = ImageReadException.class)
+    public void testSingleImage() throws Exception {
+        // we cannot use ImagingTest and getImageByFileName, as it would cause others
+        // tests to fail
+        final File imageFile = new File(JpegWithInvalidDhtSegmentTest.class
+                .getResource("/IMAGING-215/ArrayIndexOutOfBoundsException_DhtSegment_79.jpeg")
+                .getFile());
+        Imaging.getMetadata(imageFile, Collections.<String, Object>emptyMap());
+    }
+}
diff --git a/src/test/resources/IMAGING-215/ArrayIndexOutOfBoundsException_DhtSegment_79.jpeg b/src/test/resources/IMAGING-215/ArrayIndexOutOfBoundsException_DhtSegment_79.jpeg
new file mode 100644
index 00000000..afc33cd0
Binary files /dev/null and b/src/test/resources/IMAGING-215/ArrayIndexOutOfBoundsException_DhtSegment_79.jpeg differ
