<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 19:28:43 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[JAMES-2167] Serializable attributes are not preserved by enqueue/dequeue on a JMS queue</title>
                <link>https://issues.apache.org/jira/browse/JAMES-2167</link>
                <project id="10411" key="JAMES">James Server</project>
                    <description>&lt;p&gt;A call to toString breaks convertion for generic serializable attributes. &lt;/p&gt;

&lt;p&gt;The dequeued email will have only a toString version of it. We are expecting the exact same value, just deserialized.&lt;/p&gt;

&lt;p&gt;We should ensure the value of Serializable attributes gets preserved by enqueue/dequeue operations. We should add a unit test for this, and fix it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13106332">JAMES-2167</key>
            <summary>Serializable attributes are not preserved by enqueue/dequeue on a JMS queue</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="btellier">Benoit Tellier</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Oct 2017 06:02:12 +0000</created>
                <updated>Tue, 17 Jul 2018 07:03:21 +0000</updated>
                            <resolved>Tue, 17 Jul 2018 02:39:53 +0000</resolved>
                                    <version>master</version>
                                                    <component>Queue</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="16187678" author="btellier" created="Mon, 2 Oct 2017 06:11:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://github.com/linagora/james-project/pull/1002&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/linagora/james-project/pull/1002&lt;/a&gt; is proposing a fix for that.&lt;/p&gt;</comment>
                            <comment id="16535287" author="githubbot" created="Fri, 6 Jul 2018 20:05:32 +0000"  >&lt;p&gt;GitHub user nstdio opened a pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-2167&quot; title=&quot;Serializable attributes are not preserved by enqueue/dequeue on a JMS queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-2167&quot;&gt;&lt;del&gt;JAMES-2167&lt;/del&gt;&lt;/a&gt; Serializable attributes are not preserved by enqueue/dequeue on a JMS queue.&lt;/p&gt;



&lt;p&gt;You can merge this pull request into a Git repository by running:&lt;/p&gt;

&lt;p&gt;    $ git pull &lt;a href=&quot;https://github.com/nstdio/james-project&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/nstdio/james-project&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-2167&quot; title=&quot;Serializable attributes are not preserved by enqueue/dequeue on a JMS queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-2167&quot;&gt;&lt;del&gt;JAMES-2167&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alternatively you can review and apply these changes as the patch at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126.patch&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126.patch&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To close this pull request, make a commit to your master/trunk branch&lt;br/&gt;
with (at least) the following in the commit message:&lt;/p&gt;

&lt;p&gt;    This closes #126&lt;/p&gt;

&lt;hr /&gt;
&lt;p&gt;commit 764f2f2bac03853b05390bddcb9cf3a02a1f0510&lt;br/&gt;
Author: Edgar Asatryan &amp;lt;nstdio@...&amp;gt;&lt;br/&gt;
Date:   2018-07-05T09:49:58Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-2301&quot; title=&quot;JMS mail queue do not preserve per-recipient headers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-2301&quot;&gt;&lt;del&gt;JAMES-2301&lt;/del&gt;&lt;/a&gt; JMS mail queue do not preserve per-recipient headers.&lt;/p&gt;

&lt;p&gt;    Now we serialize per-recipient headers as a message property and&lt;br/&gt;
    deserialize it when dequeue.&lt;/p&gt;

&lt;p&gt;commit 2e72feca36536901acf3852574603407f66a59f7&lt;br/&gt;
Author: Edgar Asatryan &amp;lt;nstdio@...&amp;gt;&lt;br/&gt;
Date:   2018-07-06T16:32:41Z&lt;/p&gt;

&lt;p&gt;    fixup! &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-2301&quot; title=&quot;JMS mail queue do not preserve per-recipient headers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-2301&quot;&gt;&lt;del&gt;JAMES-2301&lt;/del&gt;&lt;/a&gt; JMS mail queue do not preserve per-recipient headers.&lt;/p&gt;

&lt;p&gt;commit b71cad14f1ec261f46488d231084e0adb98f3503&lt;br/&gt;
Author: Edgar Asatryan &amp;lt;nstdio@...&amp;gt;&lt;br/&gt;
Date:   2018-07-06T16:36:10Z&lt;/p&gt;

&lt;p&gt;    fixup! fixup! &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-2301&quot; title=&quot;JMS mail queue do not preserve per-recipient headers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-2301&quot;&gt;&lt;del&gt;JAMES-2301&lt;/del&gt;&lt;/a&gt; JMS mail queue do not preserve per-recipient headers.&lt;/p&gt;

&lt;p&gt;commit ac2f7a9eb3955d4241281b2b1ba7b03d14a82a7c&lt;br/&gt;
Author: Edgar Asatryan &amp;lt;nstdio@...&amp;gt;&lt;br/&gt;
Date:   2018-07-06T20:03:44Z&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-2167&quot; title=&quot;Serializable attributes are not preserved by enqueue/dequeue on a JMS queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-2167&quot;&gt;&lt;del&gt;JAMES-2167&lt;/del&gt;&lt;/a&gt; Serializable attributes are not preserved by enqueue/dequeue on a JMS queue.&lt;/p&gt;

&lt;p&gt;    The non String email attributes now serialized/deserialized properly.&lt;/p&gt;

&lt;hr /&gt;</comment>
                            <comment id="16535471" author="githubbot" created="Fri, 6 Jul 2018 23:19:49 +0000"  >&lt;p&gt;Github user chibenwa commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Thanks again for the great work.&lt;/p&gt;

&lt;p&gt;    I did a very rapid review, but will be afk until Wednesday. &lt;/p&gt;

&lt;p&gt;    Cheers&lt;/p&gt;</comment>
                            <comment id="16539541" author="githubbot" created="Wed, 11 Jul 2018 04:31:15 +0000"  >&lt;p&gt;Github user chibenwa commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201560191&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201560191&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/main/java/org/apache/james/queue/jms/JMSSerializationUtils.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,109 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Optional;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationUtils;&lt;br/&gt;
    +&lt;br/&gt;
    +import com.github.fge.lambdas.Throwing;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * This class is similar to &lt;/p&gt;
{@link SerializationUtils}. Unlike {@link SerializationUtils}
&lt;p&gt; this class operates with&lt;br/&gt;
    + * &lt;/p&gt;
{@code String}
&lt;p&gt;s and not byte arrays.&lt;br/&gt;
    + * &amp;lt;p&amp;gt;&lt;br/&gt;
    + * The main advantage of this utility is that it introduces an additional operation after serialization and before&lt;br/&gt;
    + * deserialization. The operation consists in encoding/decoding the serialized/deserialized data in Base64, so that&lt;br/&gt;
    + * data can be safely transmitted over the wire.&lt;br/&gt;
    + */&lt;br/&gt;
    +final class JMSSerializationUtils {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Couldn&apos;t we make this class public?&lt;/p&gt;</comment>
                            <comment id="16539540" author="githubbot" created="Wed, 11 Jul 2018 04:31:15 +0000"  >&lt;p&gt;Github user chibenwa commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201560161&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201560161&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/main/java/org/apache/james/queue/jms/JMSMailQueue.java &amp;#8212;&lt;br/&gt;
    @@ -442,16 +426,39 @@ protected void populateMail(Message message, MailImpl mail) throws JMSException&lt;br/&gt;
         }&lt;/p&gt;

&lt;p&gt;         /**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Convert the attribute value if necessary.&lt;br/&gt;
    +     * Retrieves the attribute by 
{@code name}
&lt;p&gt; form &lt;/p&gt;
{@code message}
&lt;p&gt; and tries to add it on &lt;/p&gt;
{@code mail}
&lt;p&gt;.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @param message The attribute source.&lt;br/&gt;
    +     * @param mail    The mail on which attribute should be set.&lt;br/&gt;
    +     * @param name    The attribute name.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    private void setMailAttribute(Message message, Mail mail, String name) {&lt;br/&gt;
    +        // Now cast the property back to Serializable and set it as attribute.&lt;br/&gt;
    +        // See &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-1241&quot; title=&quot;Mail Attributes retrieved as String even though set as Boolean&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-1241&quot;&gt;&lt;del&gt;JAMES-1241&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
    +        Object attrValue = Throwing.function(message::getObjectProperty).apply(name);&lt;br/&gt;
    +&lt;br/&gt;
    +        // can be a base64 representation of serialized object try decode and deserialize. See &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-2167&quot; title=&quot;Serializable attributes are not preserved by enqueue/dequeue on a JMS queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-2167&quot;&gt;&lt;del&gt;JAMES-2167&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    +        if (attrValue instanceof String) &lt;/p&gt;
{
    +            mail.setAttribute(name, tryDeserialize((String) attrValue));
    +        }
&lt;p&gt; else if (attrValue instanceof Serializable) &lt;/p&gt;
{
    +            mail.setAttribute(name, (Serializable) attrValue);
    +        }
&lt;p&gt; else {&lt;br/&gt;
    +            LOGGER.error(&quot;Not supported mail attribute {} of type {} for mail {}&quot;, name, attrValue, mail.getName());&lt;br/&gt;
    +        }&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Tries to deserialize given argument and when fails returns itself.&lt;br/&gt;
          *&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;* @param value&lt;/li&gt;
	&lt;li&gt;* @return convertedValue&lt;br/&gt;
    +     * @param attrValue The input string.&lt;br/&gt;
    +     * @return The deserialized object or itself.&lt;br/&gt;
          */&lt;/li&gt;
	&lt;li&gt;protected Object convertAttributeValue(Object value) {&lt;/li&gt;
	&lt;li&gt;if (value == null || value instanceof String || value instanceof Byte || value instanceof Long || value instanceof Double || value instanceof Boolean || value instanceof Integer || value instanceof Short || value instanceof Float) {&lt;/li&gt;
	&lt;li&gt;return value;&lt;br/&gt;
    +    private Serializable tryDeserialize(String attrValue) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    This should be moved to `JMSSerializationUtils`.&lt;/p&gt;

&lt;p&gt;    Also, you should not rely on an exception of deserializing to handle &quot;native&quot; values. If doing so, a user providing a `base64 serialized integer string` as an input will get an `Integer` as an output.&lt;/p&gt;

&lt;p&gt;    We miss the `bijection` behaviour that we would expect from such a feature. That may lead to subtle bugs.&lt;/p&gt;

&lt;p&gt;    My opinion on this is to promote correctness over performances. Hence I&apos;d advocate*&lt;b&gt;use base64 serialization even for native values&lt;/b&gt;*.&lt;/p&gt;

&lt;p&gt;    This would also have some cool benefits:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;We would stop assuming ActiveMQ behaviour in James code as it is done in `JMSSerializationUtils::hasJMSNativeSupport`&lt;/li&gt;
	&lt;li&gt;We will simplify the code by removing one conditional branch.&lt;/li&gt;
	&lt;li&gt;`JMSSerializationUtils` would not be JMS specific anymore. We will be able to change its name, &amp;amp; in a near future use it in another context.&lt;/li&gt;
	&lt;li&gt;This would also remove the `if (X instanceOf String)` in `this::setMailAttribute`.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="16539542" author="githubbot" created="Wed, 11 Jul 2018 04:31:15 +0000"  >&lt;p&gt;Github user chibenwa commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201559203&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201559203&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/main/java/org/apache/james/queue/jms/JMSSerializationUtils.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,109 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Optional;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationUtils;&lt;br/&gt;
    +&lt;br/&gt;
    +import com.github.fge.lambdas.Throwing;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * This class is similar to &lt;/p&gt;
{@link SerializationUtils}. Unlike {@link SerializationUtils}
&lt;p&gt; this class operates with&lt;br/&gt;
    + * &lt;/p&gt;
{@code String}s and not byte arrays.&lt;br/&gt;
    + * &amp;lt;p&amp;gt;&lt;br/&gt;
    + * The main advantage of this utility is that it introduces an additional operation after serialization and before&lt;br/&gt;
    + * deserialization. The operation consists in encoding/decoding the serialized/deserialized data in Base64, so that&lt;br/&gt;
    + * data can be safely transmitted over the wire.&lt;br/&gt;
    + */&lt;br/&gt;
    +final class JMSSerializationUtils {&lt;br/&gt;
    +    private JMSSerializationUtils() {
    +        throw new AssertionError(&quot;No instances!&quot;);
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Checks {@code value} is native supported by the JMS spec.&lt;br/&gt;
    +     * &amp;lt;p&amp;gt;&lt;br/&gt;
    +     * The following types are supported: {@code null}, {@code String}
&lt;p&gt;, all primitive wrappers except &lt;/p&gt;
{@code
    +     * Character}
&lt;p&gt;.&lt;br/&gt;
    +     * &amp;lt;p&amp;gt;&lt;br/&gt;
    +     * Note that neither &lt;/p&gt;
{@link java.util.Map}
&lt;p&gt; nor &lt;/p&gt;
{@link java.util.List}
&lt;p&gt; is not supported by default.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    static boolean hasJMSNativeSupport(Object value) &lt;/p&gt;
{
    +        return value == null || value instanceof String || value instanceof Boolean ||
    +                value instanceof Byte || value instanceof Short || value instanceof Integer || value instanceof Long ||
    +                value instanceof Double || value instanceof Float;
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * The convenient method that serialize provided &lt;/p&gt;
{@code value} if it is not supported by JMS. If JMS does support&lt;br/&gt;
    +     * {@code value}
&lt;p&gt; type the object itself will be returned.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @param value The serialization candidate.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @return The serialized base64 string or &lt;/p&gt;
{@code value}
&lt;p&gt; itself.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    static Object trySerialize(Serializable value) {&lt;br/&gt;
    +        return hasJMSNativeSupport(value) ? value : serialize(value).orElse(null);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    How a String is diferenciated from a serialized value?&lt;/p&gt;</comment>
                            <comment id="16539543" author="githubbot" created="Wed, 11 Jul 2018 04:31:15 +0000"  >&lt;p&gt;Github user chibenwa commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201561360&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201561360&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/test/java/org/apache/james/queue/jms/JMSSerializationUtilsTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,119 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.deserialize;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.hasJMSNativeSupport;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.roundtrip;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.trySerialize;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThat;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThatExceptionOfType;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Objects;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationException;&lt;br/&gt;
    +import org.assertj.core.api.SoftAssertions;&lt;br/&gt;
    +import org.junit.jupiter.api.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +class JMSSerializationUtilsTest {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    What happens if I try to serialize, then deserialize this string? &lt;/p&gt;

&lt;p&gt;    `rO0ABXNyABFqYXZhLmxhbmcuSW50ZWdlchLioKT3gYc4AgABSQAFdmFsdWV4cgAQamF2YS5sYW5nLk51bWJlcoaslR0LlOCLAgAAeHAAAAAp`&lt;/p&gt;</comment>
                            <comment id="16539544" author="githubbot" created="Wed, 11 Jul 2018 04:31:15 +0000"  >&lt;p&gt;Github user chibenwa commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201562051&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201562051&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/test/java/org/apache/james/queue/jms/JMSSerializationUtilsTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,119 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.deserialize;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.hasJMSNativeSupport;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.roundtrip;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.trySerialize;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThat;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThatExceptionOfType;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Objects;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationException;&lt;br/&gt;
    +import org.assertj.core.api.SoftAssertions;&lt;br/&gt;
    +import org.junit.jupiter.api.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +class JMSSerializationUtilsTest {&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    @SuppressWarnings(&quot;ConstantConditions&quot;)&lt;br/&gt;
    +    void hasJMSNativeSupportSpec() &lt;/p&gt;
{
    +        SoftAssertions softly = new SoftAssertions();
    +
    +        softly.assertThat(hasJMSNativeSupport(null)).as(&quot;null support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(&quot;&quot;)).as(&quot;String support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((byte) 0)).as(&quot;Byte support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((long) 0)).as(&quot;Long support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((double) 0)).as(&quot;Double support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(0)).as(&quot;Integer support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((short) 0)).as(&quot;Short support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((float) 0)).as(&quot;Float support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(true)).as(&quot;Boolean support&quot;).isTrue();
    +
    +        softly.assertAll();
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    void trySerializeShouldReturnItselfWhenJMSSupported() &lt;/p&gt;
{
    +        Integer expected = 41;
    +
    +        Object actual = trySerialize(expected);
    +
    +        assertThat(actual).isSameAs(expected);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    void trySerializeShouldReturnString() &lt;/p&gt;
{
    +        SerializableStringHolder value = new SerializableStringHolder(&quot;value&quot;);
    +
    +        Object actual = trySerialize(value);
    +
    +        assertThat(actual)
    +                .isInstanceOf(String.class);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    void roundTripShouldReturnEqualObject() {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    We need roundtrip testing also on String, and other native values....&lt;/p&gt;</comment>
                            <comment id="16539545" author="githubbot" created="Wed, 11 Jul 2018 04:31:15 +0000"  >&lt;p&gt;Github user chibenwa commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201560324&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201560324&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/main/java/org/apache/james/queue/jms/JMSSerializationUtils.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,109 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Optional;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationUtils;&lt;br/&gt;
    +&lt;br/&gt;
    +import com.github.fge.lambdas.Throwing;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * This class is similar to &lt;/p&gt;
{@link SerializationUtils}. Unlike {@link SerializationUtils}
&lt;p&gt; this class operates with&lt;br/&gt;
    + * &lt;/p&gt;
{@code String}
&lt;p&gt;s and not byte arrays.&lt;br/&gt;
    + * &amp;lt;p&amp;gt;&lt;br/&gt;
    + * The main advantage of this utility is that it introduces an additional operation after serialization and before&lt;br/&gt;
    + * deserialization. The operation consists in encoding/decoding the serialized/deserialized data in Base64, so that&lt;br/&gt;
    + * data can be safely transmitted over the wire.&lt;br/&gt;
    + */&lt;br/&gt;
    +final class JMSSerializationUtils {&lt;br/&gt;
    +    private JMSSerializationUtils() {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    That private constructor seems useless to me.&lt;/p&gt;

&lt;p&gt;    We don&apos;t have the habit to add such constructor in class with only static methods.&lt;/p&gt;

&lt;p&gt;    Might you remove it?&lt;/p&gt;</comment>
                            <comment id="16539546" author="githubbot" created="Wed, 11 Jul 2018 04:31:15 +0000"  >&lt;p&gt;Github user chibenwa commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201561952&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201561952&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/main/java/org/apache/james/queue/jms/JMSSerializationUtils.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,109 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Optional;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationUtils;&lt;br/&gt;
    +&lt;br/&gt;
    +import com.github.fge.lambdas.Throwing;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * This class is similar to &lt;/p&gt;
{@link SerializationUtils}. Unlike {@link SerializationUtils}
&lt;p&gt; this class operates with&lt;br/&gt;
    + * &lt;/p&gt;
{@code String}s and not byte arrays.&lt;br/&gt;
    + * &amp;lt;p&amp;gt;&lt;br/&gt;
    + * The main advantage of this utility is that it introduces an additional operation after serialization and before&lt;br/&gt;
    + * deserialization. The operation consists in encoding/decoding the serialized/deserialized data in Base64, so that&lt;br/&gt;
    + * data can be safely transmitted over the wire.&lt;br/&gt;
    + */&lt;br/&gt;
    +final class JMSSerializationUtils {&lt;br/&gt;
    +    private JMSSerializationUtils() {
    +        throw new AssertionError(&quot;No instances!&quot;);
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Checks {@code value} is native supported by the JMS spec.&lt;br/&gt;
    +     * &amp;lt;p&amp;gt;&lt;br/&gt;
    +     * The following types are supported: {@code null}, {@code String}
&lt;p&gt;, all primitive wrappers except &lt;/p&gt;
{@code
    +     * Character}
&lt;p&gt;.&lt;br/&gt;
    +     * &amp;lt;p&amp;gt;&lt;br/&gt;
    +     * Note that neither &lt;/p&gt;
{@link java.util.Map}
&lt;p&gt; nor &lt;/p&gt;
{@link java.util.List}
&lt;p&gt; is not supported by default.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    static boolean hasJMSNativeSupport(Object value) &lt;/p&gt;
{
    +        return value == null || value instanceof String || value instanceof Boolean ||
    +                value instanceof Byte || value instanceof Short || value instanceof Integer || value instanceof Long ||
    +                value instanceof Double || value instanceof Float;
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * The convenient method that serialize provided &lt;/p&gt;
{@code value} if it is not supported by JMS. If JMS does support&lt;br/&gt;
    +     * {@code value}
&lt;p&gt; type the object itself will be returned.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @param value The serialization candidate.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @return The serialized base64 string or &lt;/p&gt;
{@code value}
&lt;p&gt; itself.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    static Object trySerialize(Serializable value) &lt;/p&gt;
{
    +        return hasJMSNativeSupport(value) ? value : serialize(value).orElse(null);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Serialize the input object using standard mechanisms then encodes result using base64 encoding.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @param obj The object that needs to be serialized.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @return The base64 representation of &lt;/p&gt;
{@code obj}
&lt;p&gt;.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    static Optional&amp;lt;String&amp;gt; serialize(Serializable obj) &lt;/p&gt;
{
    +        return Optional.ofNullable(obj)
    +                .map(SerializationUtils::serialize)
    +                .map(Base64::encodeBase64String);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Decodes the input base64 string and deserialize it.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @param object The base64 encoded string.&lt;br/&gt;
    +     * @param &amp;lt;T&amp;gt;    The resulting type after deserialization.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @return The deserialized object.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    static &amp;lt;T extends Serializable&amp;gt; Optional&amp;lt;T&amp;gt; deserialize(String object) &lt;/p&gt;
{
    +        return Optional.ofNullable(object)
    +                .map(String::getBytes)
    +                .map(Throwing.function(Base64::decodeBase64))
    +                .map(SerializationUtils::deserialize);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Serializes and deserializes the provided object.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @param obj The object that needs to be serialized.&lt;br/&gt;
    +     * @param &amp;lt;T&amp;gt; The type of the provided object.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @return The provided object.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    static &amp;lt;T extends Serializable&amp;gt; Optional&amp;lt;T&amp;gt; roundtrip(T obj) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Maybe we should make it return `T` instead of `Optional&amp;lt;T&amp;gt;` and throw if empty... `roundtrip` expresses the idea of identity to me, and expressing it threw the types seems a good idea to me.&lt;/p&gt;</comment>
                            <comment id="16539547" author="githubbot" created="Wed, 11 Jul 2018 04:31:15 +0000"  >&lt;p&gt;Github user chibenwa commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201561795&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201561795&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/main/java/org/apache/james/queue/jms/JMSSerializationUtils.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,109 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Optional;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationUtils;&lt;br/&gt;
    +&lt;br/&gt;
    +import com.github.fge.lambdas.Throwing;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * This class is similar to &lt;/p&gt;
{@link SerializationUtils}. Unlike {@link SerializationUtils}
&lt;p&gt; this class operates with&lt;br/&gt;
    + * &lt;/p&gt;
{@code String}s and not byte arrays.&lt;br/&gt;
    + * &amp;lt;p&amp;gt;&lt;br/&gt;
    + * The main advantage of this utility is that it introduces an additional operation after serialization and before&lt;br/&gt;
    + * deserialization. The operation consists in encoding/decoding the serialized/deserialized data in Base64, so that&lt;br/&gt;
    + * data can be safely transmitted over the wire.&lt;br/&gt;
    + */&lt;br/&gt;
    +final class JMSSerializationUtils {&lt;br/&gt;
    +    private JMSSerializationUtils() {
    +        throw new AssertionError(&quot;No instances!&quot;);
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Checks {@code value} is native supported by the JMS spec.&lt;br/&gt;
    +     * &amp;lt;p&amp;gt;&lt;br/&gt;
    +     * The following types are supported: {@code null}, {@code String}
&lt;p&gt;, all primitive wrappers except &lt;/p&gt;
{@code
    +     * Character}
&lt;p&gt;.&lt;br/&gt;
    +     * &amp;lt;p&amp;gt;&lt;br/&gt;
    +     * Note that neither &lt;/p&gt;
{@link java.util.Map}
&lt;p&gt; nor &lt;/p&gt;
{@link java.util.List}
&lt;p&gt; is not supported by default.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    static boolean hasJMSNativeSupport(Object value) &lt;/p&gt;
{
    +        return value == null || value instanceof String || value instanceof Boolean ||
    +                value instanceof Byte || value instanceof Short || value instanceof Integer || value instanceof Long ||
    +                value instanceof Double || value instanceof Float;
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * The convenient method that serialize provided &lt;/p&gt;
{@code value} if it is not supported by JMS. If JMS does support&lt;br/&gt;
    +     * {@code value}
&lt;p&gt; type the object itself will be returned.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @param value The serialization candidate.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @return The serialized base64 string or &lt;/p&gt;
{@code value}
&lt;p&gt; itself.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    static Object trySerialize(Serializable value) &lt;/p&gt;
{
    +        return hasJMSNativeSupport(value) ? value : serialize(value).orElse(null);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Serialize the input object using standard mechanisms then encodes result using base64 encoding.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @param obj The object that needs to be serialized.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @return The base64 representation of &lt;/p&gt;
{@code obj}
&lt;p&gt;.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    static Optional&amp;lt;String&amp;gt; serialize(Serializable obj) &lt;/p&gt;
{
    +        return Optional.ofNullable(obj)
    +                .map(SerializationUtils::serialize)
    +                .map(Base64::encodeBase64String);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Decodes the input base64 string and deserialize it.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @param object The base64 encoded string.&lt;br/&gt;
    +     * @param &amp;lt;T&amp;gt;    The resulting type after deserialization.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @return The deserialized object.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    static &amp;lt;T extends Serializable&amp;gt; Optional&amp;lt;T&amp;gt; deserialize(String object) &lt;/p&gt;
{
    +        return Optional.ofNullable(object)
    +                .map(String::getBytes)
    +                .map(Throwing.function(Base64::decodeBase64))
    +                .map(SerializationUtils::deserialize);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Serializes and deserializes the provided object.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @param obj The object that needs to be serialized.&lt;br/&gt;
    +     * @param &amp;lt;T&amp;gt; The type of the provided object.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @return The provided object.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    static &amp;lt;T extends Serializable&amp;gt; Optional&amp;lt;T&amp;gt; roundtrip(T obj) {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This test method  should be moved to test.&lt;/p&gt;</comment>
                            <comment id="16539548" author="githubbot" created="Wed, 11 Jul 2018 04:31:15 +0000"  >&lt;p&gt;Github user chibenwa commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201562105&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201562105&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/test/java/org/apache/james/queue/jms/JMSSerializationUtilsTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,119 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.deserialize;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.hasJMSNativeSupport;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.roundtrip;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.trySerialize;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThat;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThatExceptionOfType;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Objects;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationException;&lt;br/&gt;
    +import org.assertj.core.api.SoftAssertions;&lt;br/&gt;
    +import org.junit.jupiter.api.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +class JMSSerializationUtilsTest {&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    @SuppressWarnings(&quot;ConstantConditions&quot;)&lt;br/&gt;
    +    void hasJMSNativeSupportSpec() &lt;/p&gt;
{
    +        SoftAssertions softly = new SoftAssertions();
    +
    +        softly.assertThat(hasJMSNativeSupport(null)).as(&quot;null support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(&quot;&quot;)).as(&quot;String support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((byte) 0)).as(&quot;Byte support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((long) 0)).as(&quot;Long support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((double) 0)).as(&quot;Double support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(0)).as(&quot;Integer support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((short) 0)).as(&quot;Short support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((float) 0)).as(&quot;Float support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(true)).as(&quot;Boolean support&quot;).isTrue();
    +
    +        softly.assertAll();
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    void trySerializeShouldReturnItselfWhenJMSSupported() &lt;/p&gt;
{
    +        Integer expected = 41;
    +
    +        Object actual = trySerialize(expected);
    +
    +        assertThat(actual).isSameAs(expected);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    void trySerializeShouldReturnString() {&lt;br/&gt;
    +        SerializableStringHolder value = new SerializableStringHolder(&quot;value&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +        Object actual = trySerialize(value);&lt;br/&gt;
    +&lt;br/&gt;
    +        assertThat(actual)&lt;br/&gt;
    +                .isInstanceOf(String.class);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Can we get an assert on the string content?&lt;/p&gt;</comment>
                            <comment id="16539549" author="githubbot" created="Wed, 11 Jul 2018 04:31:43 +0000"  >&lt;p&gt;Github user chibenwa commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    We also have a merge conflict. Could you solve it?&lt;/p&gt;</comment>
                            <comment id="16539835" author="githubbot" created="Wed, 11 Jul 2018 10:07:47 +0000"  >&lt;p&gt;Github user nstdio commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201635006&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201635006&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/test/java/org/apache/james/queue/jms/JMSSerializationUtilsTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,119 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.deserialize;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.hasJMSNativeSupport;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.roundtrip;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.trySerialize;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThat;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThatExceptionOfType;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Objects;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationException;&lt;br/&gt;
    +import org.assertj.core.api.SoftAssertions;&lt;br/&gt;
    +import org.junit.jupiter.api.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +class JMSSerializationUtilsTest {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Basically, it&apos;ll behave like in case of any other string, will return same content.&lt;/p&gt;</comment>
                            <comment id="16539848" author="githubbot" created="Wed, 11 Jul 2018 10:16:33 +0000"  >&lt;p&gt;Github user nstdio commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201637420&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201637420&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/main/java/org/apache/james/queue/jms/JMSSerializationUtils.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,109 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Optional;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationUtils;&lt;br/&gt;
    +&lt;br/&gt;
    +import com.github.fge.lambdas.Throwing;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * This class is similar to &lt;/p&gt;
{@link SerializationUtils}. Unlike {@link SerializationUtils}
&lt;p&gt; this class operates with&lt;br/&gt;
    + * &lt;/p&gt;
{@code String}
&lt;p&gt;s and not byte arrays.&lt;br/&gt;
    + * &amp;lt;p&amp;gt;&lt;br/&gt;
    + * The main advantage of this utility is that it introduces an additional operation after serialization and before&lt;br/&gt;
    + * deserialization. The operation consists in encoding/decoding the serialized/deserialized data in Base64, so that&lt;br/&gt;
    + * data can be safely transmitted over the wire.&lt;br/&gt;
    + */&lt;br/&gt;
    +final class JMSSerializationUtils {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    If you did not mind I&apos;m perfectly OK with that.&lt;/p&gt;</comment>
                            <comment id="16539851" author="githubbot" created="Wed, 11 Jul 2018 10:19:16 +0000"  >&lt;p&gt;Github user chibenwa commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201638127&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201638127&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/test/java/org/apache/james/queue/jms/JMSSerializationUtilsTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,119 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.deserialize;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.hasJMSNativeSupport;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.roundtrip;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.trySerialize;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThat;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThatExceptionOfType;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Objects;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationException;&lt;br/&gt;
    +import org.assertj.core.api.SoftAssertions;&lt;br/&gt;
    +import org.junit.jupiter.api.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +class JMSSerializationUtilsTest {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Are you sure?&lt;/p&gt;

&lt;p&gt;    Because for me it returns `41` instead of `&quot;rO0ABXNyABFqYXZhLmxhbmcuSW50ZWdlchLioKT3gYc4AgABSQAFdmFsdWV4cgAQamF2YS5sYW5nLk51bWJlcoaslR0LlOCLAgAAeHAAAAAp&quot;`&lt;/p&gt;</comment>
                            <comment id="16539855" author="githubbot" created="Wed, 11 Jul 2018 10:22:16 +0000"  >&lt;p&gt;Github user nstdio commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201638905&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201638905&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/test/java/org/apache/james/queue/jms/JMSSerializationUtilsTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,119 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.deserialize;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.hasJMSNativeSupport;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.roundtrip;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.trySerialize;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThat;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThatExceptionOfType;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Objects;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationException;&lt;br/&gt;
    +import org.assertj.core.api.SoftAssertions;&lt;br/&gt;
    +import org.junit.jupiter.api.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +class JMSSerializationUtilsTest {&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    @SuppressWarnings(&quot;ConstantConditions&quot;)&lt;br/&gt;
    +    void hasJMSNativeSupportSpec() &lt;/p&gt;
{
    +        SoftAssertions softly = new SoftAssertions();
    +
    +        softly.assertThat(hasJMSNativeSupport(null)).as(&quot;null support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(&quot;&quot;)).as(&quot;String support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((byte) 0)).as(&quot;Byte support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((long) 0)).as(&quot;Long support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((double) 0)).as(&quot;Double support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(0)).as(&quot;Integer support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((short) 0)).as(&quot;Short support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((float) 0)).as(&quot;Float support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(true)).as(&quot;Boolean support&quot;).isTrue();
    +
    +        softly.assertAll();
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    void trySerializeShouldReturnItselfWhenJMSSupported() &lt;/p&gt;
{
    +        Integer expected = 41;
    +
    +        Object actual = trySerialize(expected);
    +
    +        assertThat(actual).isSameAs(expected);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    void trySerializeShouldReturnString() {&lt;br/&gt;
    +        SerializableStringHolder value = new SerializableStringHolder(&quot;value&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +        Object actual = trySerialize(value);&lt;br/&gt;
    +&lt;br/&gt;
    +        assertThat(actual)&lt;br/&gt;
    +                .isInstanceOf(String.class);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Wouldn&apos;t that just test for test?&lt;/p&gt;</comment>
                            <comment id="16539858" author="githubbot" created="Wed, 11 Jul 2018 10:25:43 +0000"  >&lt;p&gt;Github user nstdio commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201639825&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201639825&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/main/java/org/apache/james/queue/jms/JMSSerializationUtils.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,109 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Optional;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationUtils;&lt;br/&gt;
    +&lt;br/&gt;
    +import com.github.fge.lambdas.Throwing;&lt;br/&gt;
    +&lt;br/&gt;
    +/**&lt;br/&gt;
    + * This class is similar to &lt;/p&gt;
{@link SerializationUtils}. Unlike {@link SerializationUtils}
&lt;p&gt; this class operates with&lt;br/&gt;
    + * &lt;/p&gt;
{@code String}s and not byte arrays.&lt;br/&gt;
    + * &amp;lt;p&amp;gt;&lt;br/&gt;
    + * The main advantage of this utility is that it introduces an additional operation after serialization and before&lt;br/&gt;
    + * deserialization. The operation consists in encoding/decoding the serialized/deserialized data in Base64, so that&lt;br/&gt;
    + * data can be safely transmitted over the wire.&lt;br/&gt;
    + */&lt;br/&gt;
    +final class JMSSerializationUtils {&lt;br/&gt;
    +    private JMSSerializationUtils() {
    +        throw new AssertionError(&quot;No instances!&quot;);
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Checks {@code value} is native supported by the JMS spec.&lt;br/&gt;
    +     * &amp;lt;p&amp;gt;&lt;br/&gt;
    +     * The following types are supported: {@code null}, {@code String}
&lt;p&gt;, all primitive wrappers except &lt;/p&gt;
{@code
    +     * Character}
&lt;p&gt;.&lt;br/&gt;
    +     * &amp;lt;p&amp;gt;&lt;br/&gt;
    +     * Note that neither &lt;/p&gt;
{@link java.util.Map}
&lt;p&gt; nor &lt;/p&gt;
{@link java.util.List}
&lt;p&gt; is not supported by default.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    static boolean hasJMSNativeSupport(Object value) &lt;/p&gt;
{
    +        return value == null || value instanceof String || value instanceof Boolean ||
    +                value instanceof Byte || value instanceof Short || value instanceof Integer || value instanceof Long ||
    +                value instanceof Double || value instanceof Float;
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * The convenient method that serialize provided &lt;/p&gt;
{@code value} if it is not supported by JMS. If JMS does support&lt;br/&gt;
    +     * {@code value}
&lt;p&gt; type the object itself will be returned.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @param value The serialization candidate.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @return The serialized base64 string or &lt;/p&gt;
{@code value}
&lt;p&gt; itself.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    static Object trySerialize(Serializable value) {&lt;br/&gt;
    +        return hasJMSNativeSupport(value) ? value : serialize(value).orElse(null);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    String and other types mentioned in `hasJMSNativeSupport` will not be serialized at all.&lt;/p&gt;
</comment>
                            <comment id="16539871" author="githubbot" created="Wed, 11 Jul 2018 10:34:44 +0000"  >&lt;p&gt;Github user nstdio commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201642067&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201642067&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/test/java/org/apache/james/queue/jms/JMSSerializationUtilsTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,119 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.deserialize;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.hasJMSNativeSupport;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.roundtrip;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.trySerialize;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThat;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThatExceptionOfType;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Objects;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationException;&lt;br/&gt;
    +import org.assertj.core.api.SoftAssertions;&lt;br/&gt;
    +import org.junit.jupiter.api.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +class JMSSerializationUtilsTest {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    Thanks for pointing this out. Definitely I&apos;ll double check this.&lt;/p&gt;</comment>
                            <comment id="16539875" author="githubbot" created="Wed, 11 Jul 2018 10:37:48 +0000"  >&lt;p&gt;Github user chibenwa commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201642937&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201642937&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/test/java/org/apache/james/queue/jms/JMSSerializationUtilsTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,119 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.deserialize;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.hasJMSNativeSupport;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.roundtrip;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.trySerialize;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThat;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThatExceptionOfType;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Objects;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationException;&lt;br/&gt;
    +import org.assertj.core.api.SoftAssertions;&lt;br/&gt;
    +import org.junit.jupiter.api.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +class JMSSerializationUtilsTest {&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    @SuppressWarnings(&quot;ConstantConditions&quot;)&lt;br/&gt;
    +    void hasJMSNativeSupportSpec() &lt;/p&gt;
{
    +        SoftAssertions softly = new SoftAssertions();
    +
    +        softly.assertThat(hasJMSNativeSupport(null)).as(&quot;null support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(&quot;&quot;)).as(&quot;String support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((byte) 0)).as(&quot;Byte support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((long) 0)).as(&quot;Long support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((double) 0)).as(&quot;Double support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(0)).as(&quot;Integer support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((short) 0)).as(&quot;Short support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((float) 0)).as(&quot;Float support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(true)).as(&quot;Boolean support&quot;).isTrue();
    +
    +        softly.assertAll();
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    void trySerializeShouldReturnItselfWhenJMSSupported() &lt;/p&gt;
{
    +        Integer expected = 41;
    +
    +        Object actual = trySerialize(expected);
    +
    +        assertThat(actual).isSameAs(expected);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    void trySerializeShouldReturnString() {&lt;br/&gt;
    +        SerializableStringHolder value = new SerializableStringHolder(&quot;value&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +        Object actual = trySerialize(value);&lt;br/&gt;
    +&lt;br/&gt;
    +        assertThat(actual)&lt;br/&gt;
    +                .isInstanceOf(String.class);&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    It would allow while reading the test class to get a glance at what goes on the wire in JMS/ActiveMQ. While not necessary, I consider it allows seeing the length of data, and the structure.&lt;/p&gt;</comment>
                            <comment id="16539877" author="githubbot" created="Wed, 11 Jul 2018 10:39:05 +0000"  >&lt;p&gt;Github user chibenwa commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201643256&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201643256&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/test/java/org/apache/james/queue/jms/JMSSerializationUtilsTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,119 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.deserialize;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.hasJMSNativeSupport;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.roundtrip;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.trySerialize;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThat;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThatExceptionOfType;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Objects;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationException;&lt;br/&gt;
    +import org.assertj.core.api.SoftAssertions;&lt;br/&gt;
    +import org.junit.jupiter.api.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +class JMSSerializationUtilsTest {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    This comment is strongly connected to &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201560161&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201560161&lt;/a&gt;. If you apply what I recommend, you will naturally solve the above issue, I guess.&lt;/p&gt;</comment>
                            <comment id="16540262" author="githubbot" created="Wed, 11 Jul 2018 15:42:06 +0000"  >&lt;p&gt;Github user nstdio commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201742181&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201742181&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/main/java/org/apache/james/queue/jms/JMSMailQueue.java &amp;#8212;&lt;br/&gt;
    @@ -442,16 +426,39 @@ protected void populateMail(Message message, MailImpl mail) throws JMSException&lt;br/&gt;
         }&lt;/p&gt;

&lt;p&gt;         /**&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;* Convert the attribute value if necessary.&lt;br/&gt;
    +     * Retrieves the attribute by 
{@code name}
&lt;p&gt; form &lt;/p&gt;
{@code message}
&lt;p&gt; and tries to add it on &lt;/p&gt;
{@code mail}
&lt;p&gt;.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @param message The attribute source.&lt;br/&gt;
    +     * @param mail    The mail on which attribute should be set.&lt;br/&gt;
    +     * @param name    The attribute name.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    private void setMailAttribute(Message message, Mail mail, String name) {&lt;br/&gt;
    +        // Now cast the property back to Serializable and set it as attribute.&lt;br/&gt;
    +        // See &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-1241&quot; title=&quot;Mail Attributes retrieved as String even though set as Boolean&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-1241&quot;&gt;&lt;del&gt;JAMES-1241&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
    +        Object attrValue = Throwing.function(message::getObjectProperty).apply(name);&lt;br/&gt;
    +&lt;br/&gt;
    +        // can be a base64 representation of serialized object try decode and deserialize. See &lt;a href=&quot;https://issues.apache.org/jira/browse/JAMES-2167&quot; title=&quot;Serializable attributes are not preserved by enqueue/dequeue on a JMS queue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;JAMES-2167&quot;&gt;&lt;del&gt;JAMES-2167&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    +        if (attrValue instanceof String) &lt;/p&gt;
{
    +            mail.setAttribute(name, tryDeserialize((String) attrValue));
    +        }
&lt;p&gt; else if (attrValue instanceof Serializable) &lt;/p&gt;
{
    +            mail.setAttribute(name, (Serializable) attrValue);
    +        }
&lt;p&gt; else {&lt;br/&gt;
    +            LOGGER.error(&quot;Not supported mail attribute {} of type {} for mail {}&quot;, name, attrValue, mail.getName());&lt;br/&gt;
    +        }&lt;br/&gt;
    +    }&lt;br/&gt;
    +&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Tries to deserialize given argument and when fails returns itself.&lt;br/&gt;
          *&lt;/p&gt;&lt;/li&gt;
	&lt;li&gt;* @param value&lt;/li&gt;
	&lt;li&gt;* @return convertedValue&lt;br/&gt;
    +     * @param attrValue The input string.&lt;br/&gt;
    +     * @return The deserialized object or itself.&lt;br/&gt;
          */&lt;/li&gt;
	&lt;li&gt;protected Object convertAttributeValue(Object value) {&lt;/li&gt;
	&lt;li&gt;if (value == null || value instanceof String || value instanceof Byte || value instanceof Long || value instanceof Double || value instanceof Boolean || value instanceof Integer || value instanceof Short || value instanceof Float) {&lt;/li&gt;
	&lt;li&gt;return value;&lt;br/&gt;
    +    private Serializable tryDeserialize(String attrValue) {
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;End diff &amp;#8211;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    &amp;gt; This would also remove the if (X instanceOf String) in this::setMailAttribute&lt;/p&gt;

&lt;p&gt;    I think there would remove type checking on `Serializable` rather then on `String`. Because `JMSSerializationUtils` is spinning around `String`.&lt;/p&gt;</comment>
                            <comment id="16540274" author="githubbot" created="Wed, 11 Jul 2018 15:50:40 +0000"  >&lt;p&gt;Github user nstdio commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201745573&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201745573&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/test/java/org/apache/james/queue/jms/JMSSerializationUtilsTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,119 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.deserialize;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.hasJMSNativeSupport;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.roundtrip;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.trySerialize;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThat;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThatExceptionOfType;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Objects;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationException;&lt;br/&gt;
    +import org.assertj.core.api.SoftAssertions;&lt;br/&gt;
    +import org.junit.jupiter.api.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +class JMSSerializationUtilsTest {&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    @SuppressWarnings(&quot;ConstantConditions&quot;)&lt;br/&gt;
    +    void hasJMSNativeSupportSpec() &lt;/p&gt;
{
    +        SoftAssertions softly = new SoftAssertions();
    +
    +        softly.assertThat(hasJMSNativeSupport(null)).as(&quot;null support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(&quot;&quot;)).as(&quot;String support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((byte) 0)).as(&quot;Byte support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((long) 0)).as(&quot;Long support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((double) 0)).as(&quot;Double support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(0)).as(&quot;Integer support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((short) 0)).as(&quot;Short support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport((float) 0)).as(&quot;Float support&quot;).isTrue();
    +        softly.assertThat(hasJMSNativeSupport(true)).as(&quot;Boolean support&quot;).isTrue();
    +
    +        softly.assertAll();
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    void trySerializeShouldReturnItselfWhenJMSSupported() &lt;/p&gt;
{
    +        Integer expected = 41;
    +
    +        Object actual = trySerialize(expected);
    +
    +        assertThat(actual).isSameAs(expected);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    void trySerializeShouldReturnString() &lt;/p&gt;
{
    +        SerializableStringHolder value = new SerializableStringHolder(&quot;value&quot;);
    +
    +        Object actual = trySerialize(value);
    +
    +        assertThat(actual)
    +                .isInstanceOf(String.class);
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    void roundTripShouldReturnEqualObject() {&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    In respect that we remove `JMSSerializationUtils::hasJMSNativeSupport` Is this still relevant for us?&lt;/p&gt;</comment>
                            <comment id="16540911" author="githubbot" created="Thu, 12 Jul 2018 00:02:32 +0000"  >&lt;p&gt;Github user chibenwa commented on a diff in the pull request:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126#discussion_r201874918&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126#discussion_r201874918&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    &amp;#8212; Diff: server/queue/queue-jms/src/test/java/org/apache/james/queue/jms/JMSSerializationUtilsTest.java &amp;#8212;&lt;br/&gt;
    @@ -0,0 +1,106 @@&lt;br/&gt;
    +/****************************************************************&lt;br/&gt;
    + * Licensed to the Apache Software Foundation (ASF) under one   *&lt;br/&gt;
    + * or more contributor license agreements.  See the NOTICE file *&lt;br/&gt;
    + * distributed with this work for additional information        *&lt;br/&gt;
    + * regarding copyright ownership.  The ASF licenses this file   *&lt;br/&gt;
    + * to you under the Apache License, Version 2.0 (the            *&lt;br/&gt;
    + * &quot;License&quot;); you may not use this file except in compliance   *&lt;br/&gt;
    + * with the License.  You may obtain a copy of the License at   *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + *   &lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;                 *&lt;br/&gt;
    + *                                                              *&lt;br/&gt;
    + * Unless required by applicable law or agreed to in writing,   *&lt;br/&gt;
    + * software distributed under the License is distributed on an  *&lt;br/&gt;
    + * &quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY       *&lt;br/&gt;
    + * KIND, either express or implied.  See the License for the    *&lt;br/&gt;
    + * specific language governing permissions and limitations      *&lt;br/&gt;
    + * under the License.                                           *&lt;br/&gt;
    + ****************************************************************/&lt;br/&gt;
    +package org.apache.james.queue.jms;&lt;br/&gt;
    +&lt;br/&gt;
    +import org.apache.commons.codec.binary.Base64;&lt;br/&gt;
    +import org.apache.commons.lang3.SerializationException;&lt;br/&gt;
    +import org.junit.jupiter.api.Test;&lt;br/&gt;
    +&lt;br/&gt;
    +import java.io.Serializable;&lt;br/&gt;
    +import java.util.Objects;&lt;br/&gt;
    +import java.util.Optional;&lt;br/&gt;
    +&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.deserialize;&lt;br/&gt;
    +import static org.apache.james.queue.jms.JMSSerializationUtils.serialize;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThat;&lt;br/&gt;
    +import static org.assertj.core.api.Assertions.assertThatExceptionOfType;&lt;br/&gt;
    +&lt;br/&gt;
    +class JMSSerializationUtilsTest {&lt;br/&gt;
    +    /**&lt;br/&gt;
    +     * Serializes and deserializes the provided object.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @param obj The object that needs to be serialized.&lt;br/&gt;
    +     * @param &amp;lt;T&amp;gt; The type of the provided object.&lt;br/&gt;
    +     *&lt;br/&gt;
    +     * @return The provided object.&lt;br/&gt;
    +     */&lt;br/&gt;
    +    private static &amp;lt;T extends Serializable&amp;gt; T roundtrip(T obj) &lt;/p&gt;
{
    +        return Optional.ofNullable(obj)
    +                .map(JMSSerializationUtils::serialize)
    +                .&amp;lt;T&amp;gt;map(JMSSerializationUtils::deserialize)
    +                .orElseThrow(() -&amp;gt; new IllegalArgumentException(&quot;Cannot serialize/deserialize: &quot; + obj));
    +    }
&lt;p&gt;    +&lt;br/&gt;
    +    @Test&lt;br/&gt;
    +    void trySerializeShouldReturnString() {&lt;br/&gt;
    +        SerializableStringHolder value = new SerializableStringHolder(&quot;value&quot;);&lt;br/&gt;
    +&lt;br/&gt;
    +        String expected = &quot;rO0ABXNyAE1vcmcuYXBhY2hlLmphbWVzLnF1ZXVlLmptcy5KTVNTZXJpYWxp&quot; +&lt;br/&gt;
    &amp;#8212; End diff &amp;#8211;&lt;/p&gt;

&lt;p&gt;    We should explain what this string is. I propose to rename it &apos;serializedInteger&apos; to explain how it was generated&lt;/p&gt;</comment>
                            <comment id="16541029" author="githubbot" created="Thu, 12 Jul 2018 02:11:03 +0000"  >&lt;p&gt;Github user chibenwa commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi!&lt;/p&gt;

&lt;p&gt;    I open a pull request for playing CI tests: &lt;a href=&quot;https://github.com/linagora/james-project/pull/1540&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/linagora/james-project/pull/1540&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    I also contributed 2 little fixups on top of your work.&lt;/p&gt;

&lt;p&gt;    Cheers!&lt;/p&gt;</comment>
                            <comment id="16545955" author="githubbot" created="Tue, 17 Jul 2018 02:38:51 +0000"  >&lt;p&gt;Github user chibenwa commented on the issue:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;    Hi,&lt;/p&gt;

&lt;p&gt;    This pull request has just been merged.&lt;/p&gt;

&lt;p&gt;    One very last thing: I don&apos;t have write access to this repository, hence I can not close this issue. Wouldn&apos;t you mind doing it for me? It would avoid me annoying the Apache INFRA team with such simple concerns.&lt;/p&gt;

&lt;p&gt;    Thanks again,&lt;/p&gt;

&lt;p&gt;    Cheers,&lt;/p&gt;

&lt;p&gt;    Benoit&lt;/p&gt;</comment>
                            <comment id="16545957" author="btellier" created="Tue, 17 Jul 2018 02:39:53 +0000"  >&lt;p&gt;Edgar Asatryan solved this issue.&lt;/p&gt;

&lt;p&gt;He contributed this PR: &lt;a href=&quot;https://github.com/apache/james-project/pull/126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Many thanks to him!&lt;/p&gt;</comment>
                            <comment id="16546106" author="githubbot" created="Tue, 17 Jul 2018 07:03:21 +0000"  >&lt;p&gt;Github user nstdio closed the pull request at:&lt;/p&gt;

&lt;p&gt;    &lt;a href=&quot;https://github.com/apache/james-project/pull/126&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/james-project/pull/126&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 17 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3krhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>